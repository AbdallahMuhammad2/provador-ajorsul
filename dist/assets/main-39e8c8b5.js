(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const _ of document.querySelectorAll('link[rel="modulepreload"]'))d(_);new MutationObserver(_=>{for(const v of _)if(v.type==="childList")for(const b of v.addedNodes)b.tagName==="LINK"&&b.rel==="modulepreload"&&d(b)}).observe(document,{childList:!0,subtree:!0});function c(_){const v={};return _.integrity&&(v.integrity=_.integrity),_.referrerPolicy&&(v.referrerPolicy=_.referrerPolicy),_.crossOrigin==="use-credentials"?v.credentials="include":_.crossOrigin==="anonymous"?v.credentials="omit":v.credentials="same-origin",v}function d(_){if(_.ep)return;_.ep=!0;const v=c(_);fetch(_.href,v)}})();(function(){const h=document.createElement("link").relList;if(h&&h.supports&&h.supports("modulepreload"))return;for(const d of document.querySelectorAll('link[rel="modulepreload"]'))c(d);new MutationObserver(d=>{for(const _ of d)if(_.type==="childList")for(const v of _.addedNodes)v.tagName==="LINK"&&v.rel==="modulepreload"&&c(v)}).observe(document,{childList:!0,subtree:!0});function o(d){const _={};return d.integrity&&(_.integrity=d.integrity),d.referrerPolicy&&(_.referrerPolicy=d.referrerPolicy),d.crossOrigin==="use-credentials"?_.credentials="include":d.crossOrigin==="anonymous"?_.credentials="omit":_.credentials="same-origin",_}function c(d){if(d.ep)return;d.ep=!0;const _=o(d);fetch(d.href,_)}})();/*! For license information please see bundle.m.js.LICENSE.txt */var __webpackgi_modules__={774:function(h,o,c){var d=c(364),_=c.n(d)()(function(v){return v[1]});_.push([h.id,'.tippy-box[data-animation=fade][data-state=hidden]{opacity:0}[data-tippy-root]{max-width:calc(100vw - 10px)}.tippy-box{position:relative;background-color:#333;color:#fff;border-radius:4px;font-size:14px;line-height:1.4;white-space:normal;outline:0;transition-property:transform,visibility,opacity}.tippy-box[data-placement^=top]>.tippy-arrow{bottom:0}.tippy-box[data-placement^=top]>.tippy-arrow:before{bottom:-7px;left:0;border-width:8px 8px 0;border-top-color:initial;transform-origin:center top}.tippy-box[data-placement^=bottom]>.tippy-arrow{top:0}.tippy-box[data-placement^=bottom]>.tippy-arrow:before{top:-7px;left:0;border-width:0 8px 8px;border-bottom-color:initial;transform-origin:center bottom}.tippy-box[data-placement^=left]>.tippy-arrow{right:0}.tippy-box[data-placement^=left]>.tippy-arrow:before{border-width:8px 0 8px 8px;border-left-color:initial;right:-7px;transform-origin:center left}.tippy-box[data-placement^=right]>.tippy-arrow{left:0}.tippy-box[data-placement^=right]>.tippy-arrow:before{left:-7px;border-width:8px 8px 8px 0;border-right-color:initial;transform-origin:center right}.tippy-box[data-inertia][data-state=visible]{transition-timing-function:cubic-bezier(0.54, 1.5, 0.38, 1.11)}.tippy-arrow{width:16px;height:16px;color:#333}.tippy-arrow:before{content:"";position:absolute;border-color:rgba(0,0,0,0);border-style:solid}.tippy-content{position:relative;padding:5px 9px;z-index:1}',""]),o.A=_},611:function(h,o,c){var d=c(364),_=c.n(d)()(function(v){return v[1]});_.push([h.id,".loader{width:48px;height:48px;border:5px solid #333;border-bottom-color:rgba(0,0,0,0);border-radius:50%;display:inline-block;box-sizing:border-box;animation:rotation 1s linear infinite}@keyframes rotation{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}",""]),o.A=_},223:function(h,o,c){var d=c(364),_=c.n(d)()(function(v){return v[1]});_.push([h.id,"#assetManagerLoadingBar{z-index:400;position:absolute;top:0;left:0;right:0;width:100%;background-color:rgba(0,0,0,0);height:auto}#assetManagerLoadingBarContent{color:#fff;position:absolute;left:0;right:0;margin:auto;transition:width .5s;background-color:rgba(34,34,34,.6666666667);text-align:center;font-size:.5rem;line-height:.6rem;height:.6rem;border-radius:0 0 .125rem .125rem;border-bottom:#999 1px solid}.processState{font-weight:bold}",""]),o.A=_},646:function(h,o,c){var d=c(364),_=c.n(d)()(function(v){return v[1]});_.push([h.id,'#assetManagerLoadingScreen{z-index:300;position:absolute;bottom:0;right:0;min-width:100%;min-height:100%;color:#333;font-size:1rem;gap:1rem;display:flex;align-content:center;justify-content:center;align-items:center;flex-direction:column;opacity:1;transition:opacity .5s ease-in-out,min-width .5s,min-height .5s,bottom .5s,right .5s;overflow:hidden;background:rgba(0,0,0,0);-webkit-backdrop-filter:blur(16px);backdrop-filter:blur(16px);background-blend-mode:luminosity;--b-opacity: 0.8;--b-background: #ffffff}#assetManagerLoadingScreen::before{content:"";position:absolute;top:0;left:0;width:100%;height:100%;z-index:-1;opacity:var(--b-opacity);background:var(--b-background)}#assetManagerLoadingScreenContent{padding-top:.5rem}.loadingScreenProcessState{font-weight:bold}#assetManagerLoadingScreen.minimizedLoadingScreen{top:unset;left:unset;bottom:2rem;right:2rem;min-width:0;min-height:0;max-width:80vw;max-height:80vh;width:-moz-max-content;width:max-content;height:-moz-max-content;height:max-content;padding:1.5rem;border-radius:.5rem}.loadingScreenFilesElement{min-height:4rem;padding:1rem}.loadingScreenLogoElement{margin-bottom:.5rem;max-width:80%}.loadingScreenLogoElement img{min-height:3rem;max-height:5rem;max-width:100%;-o-object-fit:contain;object-fit:contain}.loadingScreenLogoImage{width:-moz-max-content;width:max-content;height:-moz-max-content;height:max-content}.minimizedLoadingScreen .loadingScreenLoadingElement{display:none}.minimizedLoadingScreen .loadingScreenFilesElement{min-height:0}.minimizedLoadingScreen .loadingScreenLogoElement{min-height:0;display:none}.minimizedLoadingScreen #assetManagerLoadingScreenContent{display:none}',""]),o.A=_},636:function(h,o,c){var d=c(364),_=c.n(d)()(function(v){return v[1]});_.push([h.id,"#assetManagerPopup{z-index:300;position:absolute;bottom:2rem;right:2rem;color:#fff;-webkit-backdrop-filter:blur(16px);backdrop-filter:blur(16px);background-blend-mode:luminosity;background-color:rgba(40,34,60,.6666666667);padding:1.5rem;font-size:1rem;width:-moz-max-content;width:max-content;max-width:80vw;max-height:80vh;overflow-y:scroll;border-radius:.5rem;height:-moz-max-content;height:max-content}#assetManagerPopupClose{position:absolute;top:0;right:0;padding:.5rem;cursor:pointer}#assetManagerPopupContent{padding-top:.5rem}.processState{font-weight:bold}",""]),o.A=_},757:function(h,o,c){var d=c(364),_=c.n(d)()(function(v){return v[1]});_.push([h.id,'.button-bar{background:var(--tp-base-background-color);width:fit-content;width:-moz-fit-content;height:auto;display:flex;flex-direction:row;justify-content:center;flex-wrap:wrap;z-index:200;padding:.25rem .5rem .5rem;border-radius:.5rem;pointer-events:auto;box-shadow:0 2px 4px var(--tp-base-shadow-color);gap:8px;font-size:.85rem;line-height:130%;font-family:Inter,"Roboto Mono","Source Code Pro",Menlo,Courier,monospace;opacity:1;transition:all .25s}.button-bar-button{background-color:rgba(0,0,0,0);cursor:pointer;width:auto;height:auto;font-weight:500;padding:.35rem .5rem;position:relative;-webkit-user-select:none;-moz-user-select:none;user-select:none;color:var(--tp-input-foreground-color, #cccccc);transition:color .25s}.button-bar-button:hover{color:var(--tp-label-foreground-color, #eeeeee)}.button-bar-selected{color:var(--tp-label-foreground-color, #eeeeee)}.button-bar-selected-box{color:var(--tp-label-foreground-color, #eeeeee)}.button-bar>.button-bar-button:not(:last-child)::after{content:"";position:absolute;right:-5px;top:20%;width:2px;height:60%;border-radius:1px;background-color:var(--tp-container-background-color-active, #413762)}.button-bar-button:before{left:50%;width:0;content:"";position:absolute}.button-bar-selected:before{left:25%;width:50%;bottom:0;height:2px;border-radius:1px;background-color:var(--tp-container-foreground-color, #cccccc);transition:width .25s,left .25s}.button-bar-selected-box{background-color:rgba(238,238,238,.3333333333);border-radius:.25rem;transition:all .25s}.round-button{width:1rem;height:1rem;padding:.6rem;background-color:var(--tp-base-background-color);border-radius:1.2rem;color:#ccc;cursor:pointer;box-shadow:0 2px 4px var(--tp-base-shadow-color);transition:all .25s;box-sizing:content-box !important}.round-button:hover{color:#fff}.util-buttons-container{bottom:1.25rem;right:1.25rem;position:absolute;gap:8px;padding:.25rem}.util-button{position:relative;width:auto;height:1.2rem;aspect-ratio:1;box-sizing:content-box !important}.mode-buttons-container{border-top:0;top:0;left:0;right:0;margin-left:auto;margin-right:auto;position:absolute;min-width:6rem;border-radius:0 0 .5rem .5rem;gap:8px;flex-wrap:nowrap !important;overflow-x:scroll;pointer-events:auto;max-width:100%;align-content:center;justify-content:flex-start;align-items:center;box-sizing:border-box}.mode-buttons-container::-webkit-scrollbar{display:none}.mode-buttons-container{-ms-overflow-style:none;scrollbar-width:none}.mode-button{font-weight:500}#webgi-logo{background-image:url("https://tiexbrasil.com.br/logo.svg");background-size:contain;background-repeat:no-repeat;background-position:center;bottom:1.25rem;left:1rem;z-index:100;width:7.5rem;height:2.5rem;position:absolute;cursor:pointer}#webgi-logo:hover{filter:grayscale(100%)}#fsToggle{position:absolute;right:1.25rem;top:1.25rem;color:var(--tp-container-foreground-color, #dddddd)}#assetManagerPopup{position:absolute;margin:auto;left:0;right:0;top:0;bottom:0;color:#fff;padding:1.5rem;font-size:.85rem;overflow-y:scroll;background-color:var(--tp-base-background-color)}::-webkit-scrollbar{width:8px;height:8px}::-webkit-scrollbar-track{background:rgba(40,34,60,.8) !important;border-radius:6px}::-webkit-scrollbar-thumb{background:hsla(0,0%,100%,.4);border-radius:6px}::-webkit-scrollbar-corner{background:rgba(0,0,0,.5)}.tippy-box[data-theme~=editor]{margin:.25rem !important;background-color:var(--tp-base-background-color) !important;font-size:.9rem !important;color:var(--tp-container-foreground-color, #dddddd) !important}#tweakpaneUiContainer{margin-top:4.5rem}#canvasContainer{display:flex;justify-content:center;align-items:center}@media only screen and (min-width: 920px){#canvasContainer{width:calc(min(100% - 3rem,100% - var(--tweakpane-ui-container-width, 300px)) - 3.5rem) !important;height:calc(100% - 5rem);margin:3.5rem 1.5rem 1.5rem 1.5rem;border-radius:.5rem;box-shadow:rgba(0,0,0,.25) 0px 25px 50px -12px}#mcanvas{border-radius:.5rem}#tweakpaneUiContainer{margin-top:3.5rem}}body{transition:background-color .5s ease;background-color:#d1d4e7}body.tpTheme-blue{background-color:#d1d4e7}body.tpTheme-white{background-color:#dcdcdc}body.tpTheme-black{background-color:#48495d}',""]),o.A=_},367:function(h,o,c){var d=c(364),_=c.n(d)()(function(v){return v[1]});_.push([h.id,':root{--tp-blade-unit-size: 26px;--tp-font-family: "Inter";--tp-element-border-radius: 0.25rem}:root{--tp-base-background-color: #0e0e0e;--tp-container-background-color: rgba(32, 32, 32, 0.2);--tp-container-background-color-hover: rgba(32, 32, 32, 0.3);--tp-container-background-color-active: rgba(50, 50, 50, 0.8);--tp-container-background-color-focus: rgba(50, 50, 50, 1.0);--tp-container-foreground-color: hsla(0, 0%, 90%, 0.90);--tp-label-foreground-color: hsla(0, 0%, 85%, 0.90)}:root .tpTheme-blue{--tp-base-background-color: #28223C;--tp-base-shadow-color: hsla(0, 0%, 0%, 0.2);--tp-button-background-color: hsla(230, 10%, 80%, 1.00);--tp-button-background-color-active: hsla(230, 10%, 95%, 1.00);--tp-button-background-color-focus: hsla(230, 10%, 90%, 1.00);--tp-button-background-color-hover: hsla(230, 10%, 85%, 1.00);--tp-button-foreground-color: hsla(230, 20%, 11%, 1.00);--tp-container-background-color: hsla(230, 25%, 16%, 0.65);--tp-container-background-color-active: hsla(230, 25%, 36%, 0.65);--tp-container-background-color-focus: hsla(230, 25%, 26%, 0.65);--tp-container-background-color-hover: hsla(230, 25%, 21%, 0.65);--tp-container-foreground-color: hsl(240, 10%, 92%);--tp-groove-foreground-color: hsla(230, 20%, 8%, 1.00);--tp-input-background-color: hsla(230, 20%, 8%, 1.00);--tp-input-background-color-active: hsla(230, 28%, 23%, 1.00);--tp-input-background-color-focus: hsla(230, 28%, 18%, 1.00);--tp-input-background-color-hover: hsla(230, 20%, 13%, 1.00);--tp-input-foreground-color: hsla(230, 10%, 80%, 1.00);--tp-monitor-background-color: hsla(230, 20%, 8%, 1.00);--tp-monitor-foreground-color: hsla(230, 12%, 48%, 1.00);--tp-label-foreground-color: #E4E2ED}:root .tpTheme-white{--tp-base-background-color: hsla(230, 5%, 90%, 1.00);--tp-base-shadow-color: hsla(0, 0%, 0%, 0.10);--tp-button-background-color: hsla(230, 7%, 85%, 1.00);--tp-button-background-color-active: hsla(230, 7%, 70%, 1.00);--tp-button-background-color-focus: hsla(230, 7%, 75%, 1.00);--tp-button-background-color-hover: hsla(230, 7%, 80%, 1.00);--tp-button-foreground-color: hsla(230, 10%, 30%, 1.00);--tp-container-background-color: hsla(230, 15%, 80%, 0.10);--tp-container-background-color-active: hsla(230, 15%, 70%, 0.32);--tp-container-background-color-focus: hsla(230, 15%, 70%, 0.28);--tp-container-background-color-hover: hsla(230, 15%, 70%, 0.24);--tp-container-foreground-color: hsla(230, 10%, 30%, 1.00);--tp-groove-foreground-color: hsla(230, 15%, 20%, 0.10);--tp-input-background-color: hsla(230, 15%, 30%, 0.10);--tp-input-background-color-active: hsla(230, 15%, 50%, 0.22);--tp-input-background-color-focus: hsla(230, 15%, 50%, 0.18);--tp-input-background-color-hover: hsla(230, 15%, 50%, 0.14);--tp-input-foreground-color: hsla(230, 10%, 20%, 1.00);--tp-label-foreground-color: hsla(230, 10%, 10%, 1.00);--tp-monitor-background-color: hsla(230, 15%, 30%, 0.10);--tp-monitor-foreground-color: hsla(230, 10%, 30%, 0.50)}.tp-fldv{margin-top:.25rem;margin-bottom:.25rem;background-blend-mode:luminosity;position:relative}.tp-fldv .tp-fldv{margin-top:.5rem;margin-bottom:.5rem}.tp-fldv_b{height:calc(var(--bld-us)*1.5 + 4px) !important;font-size:.9rem !important;transition:background-color .5s ease}.tp-fldv_b+.tp-brkv .tp-fldv_b{height:calc(var(--bld-us)*1.1 + 4px) !important;font-size:.7rem !important}.tp-lblv_l{font-size:.75rem !important;font-weight:500 !important;flex-grow:1 !important;flex-basis:20% !important}.tp-lblv_v{flex-grow:1 !important;flex-basis:50% !important}.tp-txtv_i{font-size:.75rem !important;font-weight:500 !important}.tp-fldv_t{font-weight:500 !important;padding-left:1.5rem !important}.tp-fldv_m{right:auto !important;left:.75rem;opacity:1 !important}.pluginOptionsButton{position:absolute;right:0;top:.75rem;padding-left:.5rem;padding-right:.5rem;height:-moz-min-content;height:min-content;background:rgba(0,0,0,0);color:var(--tp-container-foreground-color, #eeeeee);font-size:.9rem;border:none}.tp-sldv_k::after{background-color:var(--tp-input-foreground-color, hsl(230, 7%, 75%))}.tp-btnv_b{height:calc(var(--tp-blade-unit-size)*1.15)}.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{font-weight:500 !important}.tp-rotv{font-size:13px !important}',""]),o.A=_},160:function(h,o,c){var d=c(364),_=c.n(d)()(function(v){return v[1]});_.push([h.id,".wwise-perspective{perspective:1000px;position:fixed;left:0;top:0;width:100vw;height:100vh}.wwise-wrapper{position:fixed;width:0;height:0;font-weight:400}.wwise-wrapper.v-center{top:50%}.wwise-wrapper.h-center{left:50%}.wwise-wrapper.left{left:0}.wwise-wrapper.right{right:0}.wwise-wrapper.top{top:0}.wwise-wrapper.bottom{bottom:0}.wwise *.preset{color:#fafafa}.wwise *.preset.ok{background:rgba(45,193,80,.95)}.wwise *.preset.error{background:rgba(190,17,51,.95)}.wwise *.preset.info{background:rgba(40,34,60,.95)}.wwise *.preset.caution{background:rgba(239,128,0,.95)}.wwise-no-scroll{position:relative;overflow:hidden}.wwise-overlay{position:fixed;left:0;top:0;width:100vw;height:100vh;background:rgba(50,50,50,.5)}.wwise{position:absolute;left:0;top:0;display:flex;flex-direction:column;border-radius:5px;box-shadow:1px 1px 10px rgba(150,150,150,.5);box-sizing:border-box}.wwise.no-radius{border-radius:0}.wwise *{box-sizing:border-box}.wwise .clear{clear:both}.wwise>.content{padding:0;margin:0;flex-grow:1;border-radius:0 0 4px 4px;background:#fff;color:#333;box-shadow:0 1px 3px rgba(200,200,200,.5) inset}.wwise>.content.no-topbar{border-radius:4px;box-shadow:none}.wwise.no-radius>.content,.wwise.no-radius>.content.no-topbar{border-radius:0}.wwise .modal>.main{width:90vw;max-width:400px;border-radius:4px 4px 0 0;text-align:center;padding-bottom:10px;color:#fff}.wwise .modal>.main .icon{display:block;margin:0 auto;fill:#fff;width:100px}.wwise .modal>.main .title{font-size:30px}.wwise .modal>.main .text{margin:10px 0;font-weight:300;font-size:16px}.wwise .modal>.main.no-op{border-radius:4px}.wwise .modal>.main.ok{background:#2dc150}.wwise .modal>.main.error{background:#be1133}.wwise .modal>.main.info{background:#28223c}.wwise .modal>.main.caution{background:#ef8000}.wwise .modal>.operation .button-wrapper{text-align:center;margin:30px 0 20px 0}.wwise .modal>.operation .button{display:inline-block;line-height:18px;padding:8px 10px;margin:0 15px;line-height:18px;width:100px;border-radius:4px;border:1px solid #eee;box-shadow:1px 1px 3px rgba(220,220,220,.8);color:#555;transition:all ease .2s}.wwise .modal>.operation .button:hover{background:#f5f5f5;cursor:pointer}.wwise .modal>.operation .button.main{color:#fff}.wwise .modal>.operation.ok .main{background:#2dc150}.wwise .modal>.operation.ok .main:hover{background:rgb(35.3571428571,151.6428571429,62.8571428571)}.wwise .modal>.operation.error .main{background:#be1133}.wwise .modal>.operation.error .main:hover{background:rgb(143.1884057971,12.8115942029,38.4347826087)}.wwise .modal>.operation.info .main{background:#28223c}.wwise .modal>.operation.info .main:hover{background:rgb(18.2978723404,15.5531914894,27.4468085106)}.wwise .modal>.operation.caution .main{background:#ef8000}.wwise .modal>.operation.caution .main:hover{background:rgb(188,100.6861924686,0)}.wwise .input-wrapper{margin:15px auto -15px auto}.wwise .input-wrapper .input{display:block;margin:0 auto;width:95%;max-width:300px;outline:none;border:none;background:#f3f3f3;padding:15px;font-size:16px;border-radius:5px}.wwise .input-wrapper .error{width:95%;text-align:center;margin-top:10px;color:red}div:has(>.wwise-wrapper){position:absolute !important}.wwise-wrapper{position:absolute !important}.wwise .modal>.main{padding-top:10px}",""]),o.A=_},333:function(h){var o;o=function(){return function(c){var d={};function _(v){if(d[v])return d[v].exports;var b=d[v]={i:v,l:!1,exports:{}};return c[v].call(b.exports,b,b.exports,_),b.l=!0,b.exports}return _.m=c,_.c=d,_.i=function(v){return v},_.d=function(v,b,tt){_.o(v,b)||Object.defineProperty(v,b,{configurable:!1,enumerable:!0,get:tt})},_.n=function(v){var b=v&&v.__esModule?function(){return v.default}:function(){return v};return _.d(b,"a",b),b},_.o=function(v,b){return Object.prototype.hasOwnProperty.call(v,b)},_.p="",_(_.s=5)}([function(c,d,_){Object.defineProperty(d,"__esModule",{value:!0});var v={convertToObject:function(b){var tt=b.substring(b.indexOf("{")+1).trim().slice(0,-1),it={};return tt.split(";").map(function(nt){if(nt=nt.trim()){var lt=nt.split(":");it[lt[0].trim()]=lt[1].trim()}}),it},getFromSheets:function(b){var tt=document.styleSheets;for(var it in tt){var nt=null;try{nt=tt[it].rules||tt[it].cssRules}catch{}if(nt){for(var lt in nt)if(nt[lt].selectorText&&nt[lt].selectorText.split(",").indexOf(b)!=-1)return nt[lt].cssText?v.convertToObject(nt[lt].cssText):v.convertToObject(nt[lt].style.cssText)}}return{}},getPropertyDefault:function(b){return b=="timing-function"?"ease":b=="iteration-count"?1:b=="direction"?"normal":b=="fill-mode"?"none":null}};d.default=v},function(c,d,_){Object.defineProperty(d,"__esModule",{value:!0});var v={generateId:function(){for(var b="",tt=0;tt<8;++tt)b+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(Math.floor(62*Math.random()));return b},frameToString:function(b){var tt="";for(var it in b)tt+=it+":"+b[it]+";";return tt},convertTimeToMs:function(b){if(!b)return 0;if(typeof b=="number")return b;var tt=parseFloat(b);return b.indexOf("ms")!=-1?tt:1e3*tt},prefixes:["","-webkit-","-moz-","-o-"]};d.default=v},function(c,d,_){Object.defineProperty(d,"__esModule",{value:!0});var v,b=(v=_(0))&&v.__esModule?v:{default:v};d.default=function tt(it,nt){if(function(ht,_t){if(!(ht instanceof _t))throw new TypeError("Cannot call a class as a function")}(this,tt),this.styles=typeof it=="string"?b.default.getFromSheets(it):it,typeof nt=="string"){var lt=b.default.getFromSheets(nt);for(var ut in this.options={},lt)this.options[ut.replace("animation-","")]=lt[ut]}else this.options=typeof nt=="number"?{duration:nt}:nt}},function(c,d,_){Object.defineProperty(d,"__esModule",{value:!0});var v=function(){function ut(ht,_t){for(var ft=0;ft<_t.length;ft++){var bt=_t[ft];bt.enumerable=bt.enumerable||!1,bt.configurable=!0,"value"in bt&&(bt.writable=!0),Object.defineProperty(ht,bt.key,bt)}}return function(ht,_t,ft){return _t&&ut(ht.prototype,_t),ft&&ut(ht,ft),ht}}(),b=nt(_(4)),tt=nt(_(1)),it=nt(_(0));function nt(ut){return ut&&ut.__esModule?ut:{default:ut}}var lt=function(){function ut(ht,_t,ft,bt){if(function(wt,Pt){if(!(wt instanceof Pt))throw new TypeError("Cannot call a class as a function")}(this,ut),ht.constructor===Array?this.doms=ht:this.doms=[ht],_t.constructor===Array?this.frames=_t:this.frames=[_t],this.options={startFrom:0,pauseAt:[],prefix:!1,count:1,clear:!0,applyOnEnd:!1,instant:!1},ft!=null&&ft!=null)if(typeof ft=="boolean")this.options.instant=ft;else if(typeof ft=="number")this.options.count=ft,typeof bt=="boolean"&&(this.options.instant=bt);else for(var xt in ft)xt=="pauseAt"&&ft.pauseAt.constructor!==Array?this.options[xt]=[ft[xt]]:this.options[xt]=ft[xt];for(var St in this.promiseSupported=typeof Promise<"u"&&Promise.toString().indexOf("[native code]")!==-1,this.countRemainder=[],this.animations=[],this.styleDoms=[],this.superSets=[],this.eventHandler=[],this.options.prefix?this.prefixes=tt.default.prefixes:this.prefixes=[""],ht)this.countRemainder[St]=this.options.count-1;this.options.instant&&this.play()}return v(ut,[{key:"play",value:function(){var ht=this;for(var _t in this.clear(),this.promiseSupported&&(this.promise=new Promise(function(bt){ht.promiseResolve=bt})),this.doms){var ft=this.makeAnimation(this.doms[_t]);this.animations[_t]=ft.names,this.styleDoms[_t]=ft.styleDom,this.superSets[_t]=this.makeSuperSet(this.doms[_t],this.animations[_t]),this.playAnimation(this.doms[_t],this.superSets[_t]),this.eventHandler[_t]=this.handleAnimationEnd.bind(this,_t),this.doms[_t].addEventListener("animationend",this.eventHandler[_t])}if(this.promiseSupported)return this.promise}},{key:"clear",value:function(ht){if(!ht){for(var _t in this.doms)this.clear(_t);return this.animationEnded=0,this.promise=void 0,void(this.promiseResolve=void 0)}var ft=this.styleDoms[ht];for(var bt in ft&&ft.parentNode&&ft.parentNode.removeChild(ft),this.superSets[ht])for(var xt in this.prefixes)this.doms[ht].style[this.prefixes[xt]+"animation-"+bt]=null;for(var St in this.prefixes)this.doms[ht].style[this.prefixes[St]+"animation-play-state"]=null;this.doms[ht].removeEventListener("animationend",this.eventHandler[ht]),this.countRemainder[ht]=this.options.count-1}},{key:"replay",value:function(ht){var _t=this.doms[ht],ft=_t.cloneNode(!0);_t.parentNode.replaceChild(ft,_t),this.doms[ht].removeEventListener("animationend",this.eventHandler[ht]),this.doms[ht]=ft,this.doms[ht].addEventListener("animationend",this.eventHandler[ht])}},{key:"pause",value:function(){for(var ht in this.doms)this.pauseDom(this.doms[ht])}},{key:"resume",value:function(){for(var ht in this.doms)this.resumeDom(this.doms[ht])}},{key:"getPromise",value:function(){return this.promise}},{key:"handleAnimationEnd",value:function(ht,_t){var ft=_t.animationName,bt=ft.substring(ft.lastIndexOf("-")+1);this.options.pauseAt.includes(parseInt(bt))&&this.pauseDom(this.doms[ht]),bt==this.frames.length&&(this.countRemainder[ht]==-1?this.replay(ht):this.countRemainder[ht]>0?(this.countRemainder[ht]--,this.replay(ht)):(this.options.applyOnEnd&&this.applyOnEnd(ht),this.animationEnded++,this.animationEnded==this.doms.length&&(this.promiseSupported&&this.promiseResolve(),this.options.clear&&this.clear())))}},{key:"pauseDom",value:function(ht){for(var _t in this.prefixes)ht.style[this.prefixes[_t]+"animation-play-state"]="paused"}},{key:"resumeDom",value:function(ht){for(var _t in this.prefixes)ht.style[this.prefixes[_t]+"animation-play-state"]="running"}},{key:"applyOnEnd",value:function(ht){var _t=this.newFrames[this.frames.length];for(var ft in _t)this.doms[ht].style[ft]=_t[ft]}},{key:"makeAnimation",value:function(ht){var _t={},ft=[],bt={};for(var xt in this.frames)for(var St in ft.push(this.frames[xt].styles),ft[xt])bt[St]=!0;var wt=window.getComputedStyle(ht);for(var Pt in bt)_t[Pt]=wt[Pt];ft.unshift(_t);for(var Rt=[ft[0]],kt=1;kt<ft.length;++kt){var Gt=JSON.parse(JSON.stringify(Rt[kt-1]));for(var Dt in ft[kt])Gt[Dt]=ft[kt][Dt];Rt.push(Gt)}return this.newFrames=Rt,b.default.make(Rt,this.prefixes)}},{key:"makeSuperSet",value:function(ht,_t){var ft=0,bt={};for(var xt in this.frames)for(var St in this.frames[xt].options)bt[St]="";bt.name="",bt.duration="",bt.delay="";for(var wt=0;wt<this.frames.length;++wt){if(wt)for(var Pt in bt)bt[Pt]+=",";var Rt=tt.default.convertTimeToMs(this.frames[wt].options.duration),kt=tt.default.convertTimeToMs(this.frames[wt].options.delay);for(var Gt in wt<this.options.startFrom&&(Rt=0,kt=0),bt.name+=_t[wt],bt.duration+=Rt+"ms",bt.delay+=ft+kt+"ms",bt)Gt!="name"&&Gt!="duration"&&Gt!="delay"&&(bt[Gt]+=this.frames[wt].options[Gt]?this.frames[wt].options[Gt]:it.default.getPropertyDefault(Gt));var Dt=this.frames[wt].options["iteration-count"];ft+=Rt*parseInt(Dt||1)+kt}return bt}},{key:"playAnimation",value:function(ht,_t){for(var ft in _t)for(var bt in this.prefixes)ht.style[this.prefixes[bt]+"animation-"+ft]=_t[ft];this.options.pauseAt.includes(0)&&this.pauseDom(ht)}}]),ut}();d.default=lt},function(c,d,_){Object.defineProperty(d,"__esModule",{value:!0});var v,b=(v=_(1))&&v.__esModule?v:{default:v},tt={make:function(it,nt){for(var lt=[],ut="",ht="atr-"+b.default.generateId(),_t=document.createElement("style"),ft=0;ft<it.length-1;++ft)lt.push(ht+"-"+(ft+1)),ut+=tt.makeFromTwoFrames(it[ft],it[ft+1],lt[ft],nt);return _t.innerHTML=ut,_t.class="foo",document.getElementsByTagName("head")[0].appendChild(_t),{names:lt,styleDom:_t}},makeFromTwoFrames:function(it,nt,lt,ut){var ht="";for(var _t in ut)ht+="@"+ut[_t]+"keyframes "+lt+" {",ht+="0%",ht+="{"+b.default.frameToString(it)+"}",ht+="100%",ht+="{"+b.default.frameToString(nt)+"}",ht+="}";return ht}};d.default=tt},function(c,d,_){Object.defineProperty(d,"__esModule",{value:!0}),d.Queue=d.Frame=void 0;var v=tt(_(2)),b=tt(_(3));function tt(it){return it&&it.__esModule?it:{default:it}}d.Frame=v.default,d.Queue=b.default}])},h.exports=o()},364:function(h){h.exports=function(o){var c=[];return c.toString=function(){return this.map(function(d){var _=o(d);return d[2]?"@media ".concat(d[2]," {").concat(_,"}"):_}).join("")},c.i=function(d,_,v){typeof d=="string"&&(d=[[null,d,""]]);var b={};if(v)for(var tt=0;tt<this.length;tt++){var it=this[tt][0];it!=null&&(b[it]=!0)}for(var nt=0;nt<d.length;nt++){var lt=[].concat(d[nt]);v&&b[lt[0]]||(_&&(lt[2]?lt[2]="".concat(_," and ").concat(lt[2]):lt[2]=_),c.push(lt))}},c}},101:function(h,o,c){var d=c(986);function _(){this.argTypes=[],this.shimArgs=[],this.arrayArgs=[],this.arrayBlockIndices=[],this.scalarArgs=[],this.offsetArgs=[],this.offsetArgIndex=[],this.indexArgs=[],this.shapeArgs=[],this.funcName="",this.pre=null,this.body=null,this.post=null,this.debug=!1}h.exports=function(v){var b=new _;b.pre=v.pre,b.body=v.body,b.post=v.post;var tt=v.args.slice(0);b.argTypes=tt;for(var it=0;it<tt.length;++it){var nt=tt[it];if(nt==="array"||typeof nt=="object"&&nt.blockIndices){if(b.argTypes[it]="array",b.arrayArgs.push(it),b.arrayBlockIndices.push(nt.blockIndices?nt.blockIndices:0),b.shimArgs.push("array"+it),it<b.pre.args.length&&b.pre.args[it].count>0)throw new Error("cwise: pre() block may not reference array args");if(it<b.post.args.length&&b.post.args[it].count>0)throw new Error("cwise: post() block may not reference array args")}else if(nt==="scalar")b.scalarArgs.push(it),b.shimArgs.push("scalar"+it);else if(nt==="index"){if(b.indexArgs.push(it),it<b.pre.args.length&&b.pre.args[it].count>0)throw new Error("cwise: pre() block may not reference array index");if(it<b.body.args.length&&b.body.args[it].lvalue)throw new Error("cwise: body() block may not write to array index");if(it<b.post.args.length&&b.post.args[it].count>0)throw new Error("cwise: post() block may not reference array index")}else if(nt==="shape"){if(b.shapeArgs.push(it),it<b.pre.args.length&&b.pre.args[it].lvalue)throw new Error("cwise: pre() block may not write to array shape");if(it<b.body.args.length&&b.body.args[it].lvalue)throw new Error("cwise: body() block may not write to array shape");if(it<b.post.args.length&&b.post.args[it].lvalue)throw new Error("cwise: post() block may not write to array shape")}else{if(typeof nt!="object"||!nt.offset)throw new Error("cwise: Unknown argument type "+tt[it]);b.argTypes[it]="offset",b.offsetArgs.push({array:nt.array,offset:nt.offset}),b.offsetArgIndex.push(it)}}if(b.arrayArgs.length<=0)throw new Error("cwise: No array arguments specified");if(b.pre.args.length>tt.length)throw new Error("cwise: Too many arguments in pre() block");if(b.body.args.length>tt.length)throw new Error("cwise: Too many arguments in body() block");if(b.post.args.length>tt.length)throw new Error("cwise: Too many arguments in post() block");return b.debug=!!v.printCode||!!v.debug,b.funcName=v.funcName||"cwise",b.blockSize=v.blockSize||64,d(b)}},151:function(h,o,c){var d=c(161);function _(tt,it,nt){var lt,ut,ht=tt.length,_t=it.arrayArgs.length,ft=it.indexArgs.length>0,bt=[],xt=[],St=0,wt=0;for(lt=0;lt<ht;++lt)xt.push(["i",lt,"=0"].join(""));for(ut=0;ut<_t;++ut)for(lt=0;lt<ht;++lt)wt=St,St=tt[lt],lt===0?xt.push(["d",ut,"s",lt,"=t",ut,"p",St].join("")):xt.push(["d",ut,"s",lt,"=(t",ut,"p",St,"-s",wt,"*t",ut,"p",wt,")"].join(""));for(xt.length>0&&bt.push("var "+xt.join(",")),lt=ht-1;lt>=0;--lt)St=tt[lt],bt.push(["for(i",lt,"=0;i",lt,"<s",St,";++i",lt,"){"].join(""));for(bt.push(nt),lt=0;lt<ht;++lt){for(wt=St,St=tt[lt],ut=0;ut<_t;++ut)bt.push(["p",ut,"+=d",ut,"s",lt].join(""));ft&&(lt>0&&bt.push(["index[",wt,"]-=s",wt].join("")),bt.push(["++index[",St,"]"].join(""))),bt.push("}")}return bt.join(`
`)}function v(tt,it,nt){for(var lt=tt.body,ut=[],ht=[],_t=0;_t<tt.args.length;++_t){var ft=tt.args[_t];if(!(ft.count<=0)){var bt=new RegExp(ft.name,"g"),xt="",St=it.arrayArgs.indexOf(_t);switch(it.argTypes[_t]){case"offset":var wt=it.offsetArgIndex.indexOf(_t);St=it.offsetArgs[wt].array,xt="+q"+wt;case"array":xt="p"+St+xt;var Pt="l"+_t,Rt="a"+St;if(it.arrayBlockIndices[St]===0)ft.count===1?nt[St]==="generic"?ft.lvalue?(ut.push(["var ",Pt,"=",Rt,".get(",xt,")"].join("")),lt=lt.replace(bt,Pt),ht.push([Rt,".set(",xt,",",Pt,")"].join(""))):lt=lt.replace(bt,[Rt,".get(",xt,")"].join("")):lt=lt.replace(bt,[Rt,"[",xt,"]"].join("")):nt[St]==="generic"?(ut.push(["var ",Pt,"=",Rt,".get(",xt,")"].join("")),lt=lt.replace(bt,Pt),ft.lvalue&&ht.push([Rt,".set(",xt,",",Pt,")"].join(""))):(ut.push(["var ",Pt,"=",Rt,"[",xt,"]"].join("")),lt=lt.replace(bt,Pt),ft.lvalue&&ht.push([Rt,"[",xt,"]=",Pt].join("")));else{for(var kt=[ft.name],Gt=[xt],Dt=0;Dt<Math.abs(it.arrayBlockIndices[St]);Dt++)kt.push("\\s*\\[([^\\]]+)\\]"),Gt.push("$"+(Dt+1)+"*t"+St+"b"+Dt);if(bt=new RegExp(kt.join(""),"g"),xt=Gt.join("+"),nt[St]==="generic")throw new Error("cwise: Generic arrays not supported in combination with blocks!");lt=lt.replace(bt,[Rt,"[",xt,"]"].join(""))}break;case"scalar":lt=lt.replace(bt,"Y"+it.scalarArgs.indexOf(_t));break;case"index":lt=lt.replace(bt,"index");break;case"shape":lt=lt.replace(bt,"shape")}}}return[ut.join(`
`),lt,ht.join(`
`)].join(`
`).trim()}function b(tt){for(var it=new Array(tt.length),nt=!0,lt=0;lt<tt.length;++lt){var ut=tt[lt],ht=ut.match(/\d+/);ht=ht?ht[0]:"",ut.charAt(0)===0?it[lt]="u"+ut.charAt(1)+ht:it[lt]=ut.charAt(0)+ht,lt>0&&(nt=nt&&it[lt]===it[lt-1])}return nt?it[0]:it.join("")}h.exports=function(tt,it){for(var nt=it[1].length-Math.abs(tt.arrayBlockIndices[0])|0,lt=new Array(tt.arrayArgs.length),ut=new Array(tt.arrayArgs.length),ht=0;ht<tt.arrayArgs.length;++ht)ut[ht]=it[2*ht],lt[ht]=it[2*ht+1];var _t=[],ft=[],bt=[],xt=[],St=[];for(ht=0;ht<tt.arrayArgs.length;++ht){tt.arrayBlockIndices[ht]<0?(bt.push(0),xt.push(nt),_t.push(nt),ft.push(nt+tt.arrayBlockIndices[ht])):(bt.push(tt.arrayBlockIndices[ht]),xt.push(tt.arrayBlockIndices[ht]+nt),_t.push(0),ft.push(tt.arrayBlockIndices[ht]));for(var wt=[],Pt=0;Pt<lt[ht].length;Pt++)bt[ht]<=lt[ht][Pt]&&lt[ht][Pt]<xt[ht]&&wt.push(lt[ht][Pt]-bt[ht]);St.push(wt)}var Rt=["SS"],kt=["'use strict'"],Gt=[];for(Pt=0;Pt<nt;++Pt)Gt.push(["s",Pt,"=SS[",Pt,"]"].join(""));for(ht=0;ht<tt.arrayArgs.length;++ht){for(Rt.push("a"+ht),Rt.push("t"+ht),Rt.push("p"+ht),Pt=0;Pt<nt;++Pt)Gt.push(["t",ht,"p",Pt,"=t",ht,"[",bt[ht]+Pt,"]"].join(""));for(Pt=0;Pt<Math.abs(tt.arrayBlockIndices[ht]);++Pt)Gt.push(["t",ht,"b",Pt,"=t",ht,"[",_t[ht]+Pt,"]"].join(""))}for(ht=0;ht<tt.scalarArgs.length;++ht)Rt.push("Y"+ht);if(tt.shapeArgs.length>0&&Gt.push("shape=SS.slice(0)"),tt.indexArgs.length>0){var Dt=new Array(nt);for(ht=0;ht<nt;++ht)Dt[ht]="0";Gt.push(["index=[",Dt.join(","),"]"].join(""))}for(ht=0;ht<tt.offsetArgs.length;++ht){var It=tt.offsetArgs[ht],Nt=[];for(Pt=0;Pt<It.offset.length;++Pt)It.offset[Pt]!==0&&(It.offset[Pt]===1?Nt.push(["t",It.array,"p",Pt].join("")):Nt.push([It.offset[Pt],"*t",It.array,"p",Pt].join("")));Nt.length===0?Gt.push("q"+ht+"=0"):Gt.push(["q",ht,"=",Nt.join("+")].join(""))}var Vt=d([].concat(tt.pre.thisVars).concat(tt.body.thisVars).concat(tt.post.thisVars));for((Gt=Gt.concat(Vt)).length>0&&kt.push("var "+Gt.join(",")),ht=0;ht<tt.arrayArgs.length;++ht)kt.push("p"+ht+"|=0");tt.pre.body.length>3&&kt.push(v(tt.pre,tt,ut));var Kt=v(tt.body,tt,ut),Yt=function(rr){for(var lr=0,or=rr[0].length;lr<or;){for(var pr=1;pr<rr.length;++pr)if(rr[pr][lr]!==rr[0][lr])return lr;++lr}return lr}(St);Yt<nt?kt.push(function(rr,lr,or,pr){for(var hr=lr.length,ur=or.arrayArgs.length,cr=or.blockSize,br=or.indexArgs.length>0,fr=[],kr=0;kr<ur;++kr)fr.push(["var offset",kr,"=p",kr].join(""));for(kr=rr;kr<hr;++kr)fr.push(["for(var j"+kr+"=SS[",lr[kr],"]|0;j",kr,">0;){"].join("")),fr.push(["if(j",kr,"<",cr,"){"].join("")),fr.push(["s",lr[kr],"=j",kr].join("")),fr.push(["j",kr,"=0"].join("")),fr.push(["}else{s",lr[kr],"=",cr].join("")),fr.push(["j",kr,"-=",cr,"}"].join("")),br&&fr.push(["index[",lr[kr],"]=j",kr].join(""));for(kr=0;kr<ur;++kr){for(var gr=["offset"+kr],tr=rr;tr<hr;++tr)gr.push(["j",tr,"*t",kr,"p",lr[tr]].join(""));fr.push(["p",kr,"=(",gr.join("+"),")"].join(""))}for(fr.push(_(lr,or,pr)),kr=rr;kr<hr;++kr)fr.push("}");return fr.join(`
`)}(Yt,St[0],tt,Kt)):kt.push(_(St[0],tt,Kt)),tt.post.body.length>3&&kt.push(v(tt.post,tt,ut)),tt.debug&&console.log("-----Generated cwise routine for ",it,`:
`+kt.join(`
`)+`
----------`);var nr=[tt.funcName||"unnamed","_cwise_loop_",lt[0].join("s"),"m",Yt,b(ut)].join("");return new Function(["function ",nr,"(",Rt.join(","),"){",kt.join(`
`),"} return ",nr].join(""))()}},986:function(h,o,c){var d=c(151);h.exports=function(_){var v=["'use strict'","var CACHED={}"],b=[],tt=_.funcName+"_cwise_thunk";v.push(["return function ",tt,"(",_.shimArgs.join(","),"){"].join(""));for(var it=[],nt=[],lt=[["array",_.arrayArgs[0],".shape.slice(",Math.max(0,_.arrayBlockIndices[0]),_.arrayBlockIndices[0]<0?","+_.arrayBlockIndices[0]+")":")"].join("")],ut=[],ht=[],_t=0;_t<_.arrayArgs.length;++_t){var ft=_.arrayArgs[_t];b.push(["t",ft,"=array",ft,".dtype,","r",ft,"=array",ft,".order"].join("")),it.push("t"+ft),it.push("r"+ft),nt.push("t"+ft),nt.push("r"+ft+".join()"),lt.push("array"+ft+".data"),lt.push("array"+ft+".stride"),lt.push("array"+ft+".offset|0"),_t>0&&(ut.push("array"+_.arrayArgs[0]+".shape.length===array"+ft+".shape.length+"+(Math.abs(_.arrayBlockIndices[0])-Math.abs(_.arrayBlockIndices[_t]))),ht.push("array"+_.arrayArgs[0]+".shape[shapeIndex+"+Math.max(0,_.arrayBlockIndices[0])+"]===array"+ft+".shape[shapeIndex+"+Math.max(0,_.arrayBlockIndices[_t])+"]"))}for(_.arrayArgs.length>1&&(v.push("if (!("+ut.join(" && ")+")) throw new Error('cwise: Arrays do not all have the same dimensionality!')"),v.push("for(var shapeIndex=array"+_.arrayArgs[0]+".shape.length-"+Math.abs(_.arrayBlockIndices[0])+"; shapeIndex-->0;) {"),v.push("if (!("+ht.join(" && ")+")) throw new Error('cwise: Arrays do not all have the same shape!')"),v.push("}")),_t=0;_t<_.scalarArgs.length;++_t)lt.push("scalar"+_.scalarArgs[_t]);return b.push(["type=[",nt.join(","),"].join()"].join("")),b.push("proc=CACHED[type]"),v.push("var "+b.join(",")),v.push(["if(!proc){","CACHED[type]=proc=compile([",it.join(","),"])}","return proc(",lt.join(","),")}"].join("")),_.debug&&console.log(`-----Generated thunk:
`+v.join(`
`)+`
----------`),new Function("compile",v.join(`
`))(d.bind(void 0,_))}},981:function(h){h.exports=function(o){for(var c=new Array(o),d=0;d<o;++d)c[d]=d;return c}},872:function(h){function o(c){return!!c.constructor&&typeof c.constructor.isBuffer=="function"&&c.constructor.isBuffer(c)}h.exports=function(c){return c!=null&&(o(c)||function(d){return typeof d.readFloatLE=="function"&&typeof d.slice=="function"&&o(d.slice(0,0))}(c)||!!c._isBuffer)}},49:function(h,o,c){var d=c(101),_={body:"",args:[],thisVars:[],localVars:[]};function v(_t){if(!_t)return _;for(var ft=0;ft<_t.args.length;++ft){var bt=_t.args[ft];_t.args[ft]=ft===0?{name:bt,lvalue:!0,rvalue:!!_t.rvalue,count:_t.count||1}:{name:bt,lvalue:!1,rvalue:!0,count:1}}return _t.thisVars||(_t.thisVars=[]),_t.localVars||(_t.localVars=[]),_t}function b(_t){for(var ft=[],bt=0;bt<_t.args.length;++bt)ft.push("a"+bt);return new Function("P",["return function ",_t.funcName,"_ndarrayops(",ft.join(","),") {P(",ft.join(","),");return a0}"].join(""))(function(xt){return d({args:xt.args,pre:v(xt.pre),body:v(xt.body),post:v(xt.proc),funcName:xt.funcName})}(_t))}var tt={add:"+",sub:"-",mul:"*",div:"/",mod:"%",band:"&",bor:"|",bxor:"^",lshift:"<<",rshift:">>",rrshift:">>>"};(function(){for(var _t in tt){var ft=tt[_t];o[_t]=b({args:["array","array","array"],body:{args:["a","b","c"],body:"a=b"+ft+"c"},funcName:_t}),o[_t+"eq"]=b({args:["array","array"],body:{args:["a","b"],body:"a"+ft+"=b"},rvalue:!0,funcName:_t+"eq"}),o[_t+"s"]=b({args:["array","array","scalar"],body:{args:["a","b","s"],body:"a=b"+ft+"s"},funcName:_t+"s"}),o[_t+"seq"]=b({args:["array","scalar"],body:{args:["a","s"],body:"a"+ft+"=s"},rvalue:!0,funcName:_t+"seq"})}})();var it={not:"!",bnot:"~",neg:"-",recip:"1.0/"};(function(){for(var _t in it){var ft=it[_t];o[_t]=b({args:["array","array"],body:{args:["a","b"],body:"a="+ft+"b"},funcName:_t}),o[_t+"eq"]=b({args:["array"],body:{args:["a"],body:"a="+ft+"a"},rvalue:!0,count:2,funcName:_t+"eq"})}})();var nt={and:"&&",or:"||",eq:"===",neq:"!==",lt:"<",gt:">",leq:"<=",geq:">="};(function(){for(var _t in nt){var ft=nt[_t];o[_t]=b({args:["array","array","array"],body:{args:["a","b","c"],body:"a=b"+ft+"c"},funcName:_t}),o[_t+"s"]=b({args:["array","array","scalar"],body:{args:["a","b","s"],body:"a=b"+ft+"s"},funcName:_t+"s"}),o[_t+"eq"]=b({args:["array","array"],body:{args:["a","b"],body:"a=a"+ft+"b"},rvalue:!0,count:2,funcName:_t+"eq"}),o[_t+"seq"]=b({args:["array","scalar"],body:{args:["a","s"],body:"a=a"+ft+"s"},rvalue:!0,count:2,funcName:_t+"seq"})}})();var lt=["abs","acos","asin","atan","ceil","cos","exp","floor","log","round","sin","sqrt","tan"];(function(){for(var _t=0;_t<lt.length;++_t){var ft=lt[_t];o[ft]=b({args:["array","array"],pre:{args:[],body:"this_f=Math."+ft,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b)",thisVars:["this_f"]},funcName:ft}),o[ft+"eq"]=b({args:["array"],pre:{args:[],body:"this_f=Math."+ft,thisVars:["this_f"]},body:{args:["a"],body:"a=this_f(a)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:ft+"eq"})}})();var ut=["max","min","atan2","pow"];(function(){for(var _t=0;_t<ut.length;++_t){var ft=ut[_t];o[ft]=b({args:["array","array","array"],pre:{args:[],body:"this_f=Math."+ft,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(b,c)",thisVars:["this_f"]},funcName:ft}),o[ft+"s"]=b({args:["array","array","scalar"],pre:{args:[],body:"this_f=Math."+ft,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(b,c)",thisVars:["this_f"]},funcName:ft+"s"}),o[ft+"eq"]=b({args:["array","array"],pre:{args:[],body:"this_f=Math."+ft,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(a,b)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:ft+"eq"}),o[ft+"seq"]=b({args:["array","scalar"],pre:{args:[],body:"this_f=Math."+ft,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(a,b)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:ft+"seq"})}})();var ht=["atan2","pow"];(function(){for(var _t=0;_t<ht.length;++_t){var ft=ht[_t];o[ft+"op"]=b({args:["array","array","array"],pre:{args:[],body:"this_f=Math."+ft,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(c,b)",thisVars:["this_f"]},funcName:ft+"op"}),o[ft+"ops"]=b({args:["array","array","scalar"],pre:{args:[],body:"this_f=Math."+ft,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(c,b)",thisVars:["this_f"]},funcName:ft+"ops"}),o[ft+"opeq"]=b({args:["array","array"],pre:{args:[],body:"this_f=Math."+ft,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b,a)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:ft+"opeq"}),o[ft+"opseq"]=b({args:["array","scalar"],pre:{args:[],body:"this_f=Math."+ft,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b,a)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:ft+"opseq"})}})(),o.any=d({args:["array"],pre:_,body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:1}],body:"if(a){return true}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return false"},funcName:"any"}),o.all=d({args:["array"],pre:_,body:{args:[{name:"x",lvalue:!1,rvalue:!0,count:1}],body:"if(!x){return false}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return true"},funcName:"all"}),o.sum=d({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:1}],body:"this_s+=a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"sum"}),o.prod=d({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=1"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:1}],body:"this_s*=a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"prod"}),o.norm2squared=d({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:2}],body:"this_s+=a*a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norm2squared"}),o.norm2=d({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:2}],body:"this_s+=a*a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return Math.sqrt(this_s)"},funcName:"norm2"}),o.norminf=d({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:4}],body:"if(-a>this_s){this_s=-a}else if(a>this_s){this_s=a}",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norminf"}),o.norm1=d({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:3}],body:"this_s+=a<0?-a:a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norm1"}),o.sup=d({args:["array"],pre:{body:"this_h=-Infinity",args:[],thisVars:["this_h"],localVars:[]},body:{body:"if(_inline_1_arg0_>this_h)this_h=_inline_1_arg0_",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_h"],localVars:[]},post:{body:"return this_h",args:[],thisVars:["this_h"],localVars:[]}}),o.inf=d({args:["array"],pre:{body:"this_h=Infinity",args:[],thisVars:["this_h"],localVars:[]},body:{body:"if(_inline_1_arg0_<this_h)this_h=_inline_1_arg0_",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_h"],localVars:[]},post:{body:"return this_h",args:[],thisVars:["this_h"],localVars:[]}}),o.argmin=d({args:["index","array","shape"],pre:{body:"{this_v=Infinity;this_i=_inline_0_arg2_.slice(0)}",args:[{name:"_inline_0_arg0_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg1_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg2_",lvalue:!1,rvalue:!0,count:1}],thisVars:["this_i","this_v"],localVars:[]},body:{body:"{if(_inline_1_arg1_<this_v){this_v=_inline_1_arg1_;for(var _inline_1_k=0;_inline_1_k<_inline_1_arg0_.length;++_inline_1_k){this_i[_inline_1_k]=_inline_1_arg0_[_inline_1_k]}}}",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2},{name:"_inline_1_arg1_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_i","this_v"],localVars:["_inline_1_k"]},post:{body:"{return this_i}",args:[],thisVars:["this_i"],localVars:[]}}),o.argmax=d({args:["index","array","shape"],pre:{body:"{this_v=-Infinity;this_i=_inline_0_arg2_.slice(0)}",args:[{name:"_inline_0_arg0_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg1_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg2_",lvalue:!1,rvalue:!0,count:1}],thisVars:["this_i","this_v"],localVars:[]},body:{body:"{if(_inline_1_arg1_>this_v){this_v=_inline_1_arg1_;for(var _inline_1_k=0;_inline_1_k<_inline_1_arg0_.length;++_inline_1_k){this_i[_inline_1_k]=_inline_1_arg0_[_inline_1_k]}}}",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2},{name:"_inline_1_arg1_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_i","this_v"],localVars:["_inline_1_k"]},post:{body:"{return this_i}",args:[],thisVars:["this_i"],localVars:[]}}),o.random=b({args:["array"],pre:{args:[],body:"this_f=Math.random",thisVars:["this_f"]},body:{args:["a"],body:"a=this_f()",thisVars:["this_f"]},funcName:"random"}),o.assign=b({args:["array","array"],body:{args:["a","b"],body:"a=b"},funcName:"assign"}),o.assigns=b({args:["array","scalar"],body:{args:["a","b"],body:"a=b"},funcName:"assigns"}),o.equals=d({args:["array","array"],pre:_,body:{args:[{name:"x",lvalue:!1,rvalue:!0,count:1},{name:"y",lvalue:!1,rvalue:!0,count:1}],body:"if(x!==y){return false}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return true"},funcName:"equals"})},881:function(h,o,c){var d=c(981),_=c(872),v=typeof Float64Array<"u";function b(lt,ut){return lt[0]-ut[0]}function tt(){var lt,ut=this.stride,ht=new Array(ut.length);for(lt=0;lt<ht.length;++lt)ht[lt]=[Math.abs(ut[lt]),lt];ht.sort(b);var _t=new Array(ht.length);for(lt=0;lt<_t.length;++lt)_t[lt]=ht[lt][1];return _t}function it(lt,ut){var ht=["View",ut,"d",lt].join("");ut<0&&(ht="View_Nil"+lt);var _t=lt==="generic";if(ut===-1){var ft="function "+ht+"(a){this.data=a;};var proto="+ht+".prototype;proto.dtype='"+lt+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+ht+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+ht+"(a){return new "+ht+"(a);}";return new Function(ft)()}if(ut===0)return ft="function "+ht+"(a,d) {this.data = a;this.offset = d};var proto="+ht+".prototype;proto.dtype='"+lt+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+ht+"_copy() {return new "+ht+"(this.data,this.offset)};proto.pick=function "+ht+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+ht+"_get(){return "+(_t?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+ht+"_set(v){return "+(_t?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+ht+"(a,b,c,d){return new "+ht+"(a,d)}",new Function("TrivialArray",ft)(nt[lt][0]);ft=["'use strict'"];var bt=d(ut),xt=bt.map(function(Nt){return"i"+Nt}),St="this.offset+"+bt.map(function(Nt){return"this.stride["+Nt+"]*i"+Nt}).join("+"),wt=bt.map(function(Nt){return"b"+Nt}).join(","),Pt=bt.map(function(Nt){return"c"+Nt}).join(",");ft.push("function "+ht+"(a,"+wt+","+Pt+",d){this.data=a","this.shape=["+wt+"]","this.stride=["+Pt+"]","this.offset=d|0}","var proto="+ht+".prototype","proto.dtype='"+lt+"'","proto.dimension="+ut),ft.push("Object.defineProperty(proto,'size',{get:function "+ht+"_size(){return "+bt.map(function(Nt){return"this.shape["+Nt+"]"}).join("*"),"}})"),ut===1?ft.push("proto.order=[0]"):(ft.push("Object.defineProperty(proto,'order',{get:"),ut<4?(ft.push("function "+ht+"_order(){"),ut===2?ft.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):ut===3&&ft.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):ft.push("ORDER})")),ft.push("proto.set=function "+ht+"_set("+xt.join(",")+",v){"),_t?ft.push("return this.data.set("+St+",v)}"):ft.push("return this.data["+St+"]=v}"),ft.push("proto.get=function "+ht+"_get("+xt.join(",")+"){"),_t?ft.push("return this.data.get("+St+")}"):ft.push("return this.data["+St+"]}"),ft.push("proto.index=function "+ht+"_index(",xt.join(),"){return "+St+"}"),ft.push("proto.hi=function "+ht+"_hi("+xt.join(",")+"){return new "+ht+"(this.data,"+bt.map(function(Nt){return["(typeof i",Nt,"!=='number'||i",Nt,"<0)?this.shape[",Nt,"]:i",Nt,"|0"].join("")}).join(",")+","+bt.map(function(Nt){return"this.stride["+Nt+"]"}).join(",")+",this.offset)}");var Rt=bt.map(function(Nt){return"a"+Nt+"=this.shape["+Nt+"]"}),kt=bt.map(function(Nt){return"c"+Nt+"=this.stride["+Nt+"]"});ft.push("proto.lo=function "+ht+"_lo("+xt.join(",")+"){var b=this.offset,d=0,"+Rt.join(",")+","+kt.join(","));for(var Gt=0;Gt<ut;++Gt)ft.push("if(typeof i"+Gt+"==='number'&&i"+Gt+">=0){d=i"+Gt+"|0;b+=c"+Gt+"*d;a"+Gt+"-=d}");for(ft.push("return new "+ht+"(this.data,"+bt.map(function(Nt){return"a"+Nt}).join(",")+","+bt.map(function(Nt){return"c"+Nt}).join(",")+",b)}"),ft.push("proto.step=function "+ht+"_step("+xt.join(",")+"){var "+bt.map(function(Nt){return"a"+Nt+"=this.shape["+Nt+"]"}).join(",")+","+bt.map(function(Nt){return"b"+Nt+"=this.stride["+Nt+"]"}).join(",")+",c=this.offset,d=0,ceil=Math.ceil"),Gt=0;Gt<ut;++Gt)ft.push("if(typeof i"+Gt+"==='number'){d=i"+Gt+"|0;if(d<0){c+=b"+Gt+"*(a"+Gt+"-1);a"+Gt+"=ceil(-a"+Gt+"/d)}else{a"+Gt+"=ceil(a"+Gt+"/d)}b"+Gt+"*=d}");ft.push("return new "+ht+"(this.data,"+bt.map(function(Nt){return"a"+Nt}).join(",")+","+bt.map(function(Nt){return"b"+Nt}).join(",")+",c)}");var Dt=new Array(ut),It=new Array(ut);for(Gt=0;Gt<ut;++Gt)Dt[Gt]="a[i"+Gt+"]",It[Gt]="b[i"+Gt+"]";for(ft.push("proto.transpose=function "+ht+"_transpose("+xt+"){"+xt.map(function(Nt,Vt){return Nt+"=("+Nt+"===undefined?"+Vt+":"+Nt+"|0)"}).join(";"),"var a=this.shape,b=this.stride;return new "+ht+"(this.data,"+Dt.join(",")+","+It.join(",")+",this.offset)}"),ft.push("proto.pick=function "+ht+"_pick("+xt+"){var a=[],b=[],c=this.offset"),Gt=0;Gt<ut;++Gt)ft.push("if(typeof i"+Gt+"==='number'&&i"+Gt+">=0){c=(c+this.stride["+Gt+"]*i"+Gt+")|0}else{a.push(this.shape["+Gt+"]);b.push(this.stride["+Gt+"])}");return ft.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),ft.push("return function construct_"+ht+"(data,shape,stride,offset){return new "+ht+"(data,"+bt.map(function(Nt){return"shape["+Nt+"]"}).join(",")+","+bt.map(function(Nt){return"stride["+Nt+"]"}).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",ft.join(`
`))(nt[lt],tt)}var nt={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};h.exports=function(lt,ut,ht,_t){if(lt===void 0)return(0,nt.array[0])([]);typeof lt=="number"&&(lt=[lt]),ut===void 0&&(ut=[lt.length]);var ft=ut.length;if(ht===void 0){ht=new Array(ft);for(var bt=ft-1,xt=1;bt>=0;--bt)ht[bt]=xt,xt*=ut[bt]}if(_t===void 0)for(_t=0,bt=0;bt<ft;++bt)ht[bt]<0&&(_t-=(ut[bt]-1)*ht[bt]);for(var St=function(Pt){if(_(Pt))return"buffer";if(v)switch(Object.prototype.toString.call(Pt)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(Pt)?"array":"generic"}(lt),wt=nt[St];wt.length<=ft+1;)wt.push(it(St,wt.length-1));return(0,wt[ft+1])(lt,ut,ht,_t)}},516:function(h){h.exports=function o(c,d,_){function v(it,nt){if(!d[it]){if(!c[it]){if(b)return b(it,!0);throw new Error("Cannot find module '"+it+"'")}var lt=d[it]={exports:{}};c[it][0].call(lt.exports,function(ut){return v(c[it][1][ut]||ut)},lt,lt.exports,o,c,d,_)}return d[it].exports}for(var b=void 0,tt=0;tt<_.length;tt++)v(_[tt]);return v}({1:[function(o,c,d){(function(_,v,b,tt,it,nt,lt,ut,ht){var _t=o("crypto");function ft(kt,Gt){return function(Dt,It){var Nt;if((Nt=It.algorithm!=="passthrough"?_t.createHash(It.algorithm):new Rt).write===void 0&&(Nt.write=Nt.update,Nt.end=Nt.update),Pt(It,Nt).dispatch(Dt),Nt.update||Nt.end(""),Nt.digest)return Nt.digest(It.encoding==="buffer"?void 0:It.encoding);var Vt=Nt.read();return It.encoding!=="buffer"?Vt.toString(It.encoding):Vt}(kt,Gt=St(kt,Gt))}(d=c.exports=ft).sha1=function(kt){return ft(kt)},d.keys=function(kt){return ft(kt,{excludeValues:!0,algorithm:"sha1",encoding:"hex"})},d.MD5=function(kt){return ft(kt,{algorithm:"md5",encoding:"hex"})},d.keysMD5=function(kt){return ft(kt,{algorithm:"md5",encoding:"hex",excludeValues:!0})};var bt=_t.getHashes?_t.getHashes().slice():["sha1","md5"];bt.push("passthrough");var xt=["buffer","hex","binary","base64"];function St(kt,Gt){Gt=Gt||{};var Dt={};if(Dt.algorithm=Gt.algorithm||"sha1",Dt.encoding=Gt.encoding||"hex",Dt.excludeValues=!!Gt.excludeValues,Dt.algorithm=Dt.algorithm.toLowerCase(),Dt.encoding=Dt.encoding.toLowerCase(),Dt.ignoreUnknown=Gt.ignoreUnknown===!0,Dt.respectType=Gt.respectType!==!1,Dt.respectFunctionNames=Gt.respectFunctionNames!==!1,Dt.respectFunctionProperties=Gt.respectFunctionProperties!==!1,Dt.unorderedArrays=Gt.unorderedArrays===!0,Dt.unorderedSets=Gt.unorderedSets!==!1,Dt.unorderedObjects=Gt.unorderedObjects!==!1,Dt.replacer=Gt.replacer||void 0,Dt.excludeKeys=Gt.excludeKeys||void 0,kt===void 0)throw new Error("Object argument required.");for(var It=0;It<bt.length;++It)bt[It].toLowerCase()===Dt.algorithm.toLowerCase()&&(Dt.algorithm=bt[It]);if(bt.indexOf(Dt.algorithm)===-1)throw new Error('Algorithm "'+Dt.algorithm+'"  not supported. supported values: '+bt.join(", "));if(xt.indexOf(Dt.encoding)===-1&&Dt.algorithm!=="passthrough")throw new Error('Encoding "'+Dt.encoding+'"  not supported. supported values: '+xt.join(", "));return Dt}function wt(kt){if(typeof kt=="function")return/^function\s+\w*\s*\(\s*\)\s*{\s+\[native code\]\s+}$/i.exec(Function.prototype.toString.call(kt))!=null}function Pt(kt,Gt,Dt){function It(Nt){return Gt.update?Gt.update(Nt,"utf8"):Gt.write(Nt,"utf8")}return Dt=Dt||[],{dispatch:function(Nt){return kt.replacer&&(Nt=kt.replacer(Nt)),this["_"+(Nt===null?"null":typeof Nt)](Nt)},_object:function(Nt){var Vt,Kt=Object.prototype.toString.call(Nt),Yt=/\[object (.*)\]/i.exec(Kt);if(Yt=(Yt=Yt?Yt[1]:"unknown:["+Kt+"]").toLowerCase(),0<=(Vt=Dt.indexOf(Nt)))return this.dispatch("[CIRCULAR:"+Vt+"]");if(Dt.push(Nt),b!==void 0&&b.isBuffer&&b.isBuffer(Nt))return It("buffer:"),It(Nt);if(Yt==="object"||Yt==="function"||Yt==="asyncfunction"){var nr=Object.keys(Nt);kt.unorderedObjects&&(nr=nr.sort()),kt.respectType===!1||wt(Nt)||nr.splice(0,0,"prototype","__proto__","constructor"),kt.excludeKeys&&(nr=nr.filter(function(lr){return!kt.excludeKeys(lr)})),It("object:"+nr.length+":");var rr=this;return nr.forEach(function(lr){rr.dispatch(lr),It(":"),kt.excludeValues||rr.dispatch(Nt[lr]),It(",")})}if(!this["_"+Yt]){if(kt.ignoreUnknown)return It("["+Yt+"]");throw new Error('Unknown object type "'+Yt+'"')}this["_"+Yt](Nt)},_array:function(Nt,Vt){Vt=Vt!==void 0?Vt:kt.unorderedArrays!==!1;var Kt=this;if(It("array:"+Nt.length+":"),!Vt||Nt.length<=1)return Nt.forEach(function(rr){return Kt.dispatch(rr)});var Yt=[],nr=Nt.map(function(rr){var lr=new Rt,or=Dt.slice();return Pt(kt,lr,or).dispatch(rr),Yt=Yt.concat(or.slice(Dt.length)),lr.read().toString()});return Dt=Dt.concat(Yt),nr.sort(),this._array(nr,!1)},_date:function(Nt){return It("date:"+Nt.toJSON())},_symbol:function(Nt){return It("symbol:"+Nt.toString())},_error:function(Nt){return It("error:"+Nt.toString())},_boolean:function(Nt){return It("bool:"+Nt.toString())},_string:function(Nt){It("string:"+Nt.length+":"),It(Nt.toString())},_function:function(Nt){It("fn:"),wt(Nt)?this.dispatch("[native]"):this.dispatch(Nt.toString()),kt.respectFunctionNames!==!1&&this.dispatch("function-name:"+String(Nt.name)),kt.respectFunctionProperties&&this._object(Nt)},_number:function(Nt){return It("number:"+Nt.toString())},_xml:function(Nt){return It("xml:"+Nt.toString())},_null:function(){return It("Null")},_undefined:function(){return It("Undefined")},_regexp:function(Nt){return It("regex:"+Nt.toString())},_uint8array:function(Nt){return It("uint8array:"),this.dispatch(Array.prototype.slice.call(Nt))},_uint8clampedarray:function(Nt){return It("uint8clampedarray:"),this.dispatch(Array.prototype.slice.call(Nt))},_int8array:function(Nt){return It("uint8array:"),this.dispatch(Array.prototype.slice.call(Nt))},_uint16array:function(Nt){return It("uint16array:"),this.dispatch(Array.prototype.slice.call(Nt))},_int16array:function(Nt){return It("uint16array:"),this.dispatch(Array.prototype.slice.call(Nt))},_uint32array:function(Nt){return It("uint32array:"),this.dispatch(Array.prototype.slice.call(Nt))},_int32array:function(Nt){return It("uint32array:"),this.dispatch(Array.prototype.slice.call(Nt))},_float32array:function(Nt){return It("float32array:"),this.dispatch(Array.prototype.slice.call(Nt))},_float64array:function(Nt){return It("float64array:"),this.dispatch(Array.prototype.slice.call(Nt))},_arraybuffer:function(Nt){return It("arraybuffer:"),this.dispatch(new Uint8Array(Nt))},_url:function(Nt){return It("url:"+Nt.toString())},_map:function(Nt){It("map:");var Vt=Array.from(Nt);return this._array(Vt,kt.unorderedSets!==!1)},_set:function(Nt){It("set:");var Vt=Array.from(Nt);return this._array(Vt,kt.unorderedSets!==!1)},_file:function(Nt){return It("file:"),this.dispatch([Nt.name,Nt.size,Nt.type,Nt.lastModfied])},_blob:function(){if(kt.ignoreUnknown)return It("[blob]");throw Error(`Hashing Blob objects is currently not supported
(see https://github.com/puleos/object-hash/issues/26)
Use "options.replacer" or "options.ignoreUnknown"
`)},_domwindow:function(){return It("domwindow")},_bigint:function(Nt){return It("bigint:"+Nt.toString())},_process:function(){return It("process")},_timer:function(){return It("timer")},_pipe:function(){return It("pipe")},_tcp:function(){return It("tcp")},_udp:function(){return It("udp")},_tty:function(){return It("tty")},_statwatcher:function(){return It("statwatcher")},_securecontext:function(){return It("securecontext")},_connection:function(){return It("connection")},_zlib:function(){return It("zlib")},_context:function(){return It("context")},_nodescript:function(){return It("nodescript")},_httpparser:function(){return It("httpparser")},_dataview:function(){return It("dataview")},_signal:function(){return It("signal")},_fsevent:function(){return It("fsevent")},_tlswrap:function(){return It("tlswrap")}}}function Rt(){return{buf:"",write:function(kt){this.buf+=kt},end:function(kt){this.buf+=kt},read:function(){return this.buf}}}d.writeToStream=function(kt,Gt,Dt){return Dt===void 0&&(Dt=Gt,Gt={}),Pt(Gt=St(kt,Gt),Dt).dispatch(kt)}}).call(this,o("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},o("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/fake_7eac155c.js","/")},{buffer:3,crypto:5,lYpoI2:10}],2:[function(o,c,d){(function(_,v,b,tt,it,nt,lt,ut,ht){(function(_t){var ft=typeof Uint8Array<"u"?Uint8Array:Array,bt=43,xt=47,St=48,wt=97,Pt=65,Rt=45,kt=95;function Gt(Dt){var It=Dt.charCodeAt(0);return It===bt||It===Rt?62:It===xt||It===kt?63:It<St?-1:It<St+10?It-St+26+26:It<Pt+26?It-Pt:It<wt+26?It-wt+26:void 0}_t.toByteArray=function(Dt){var It,Nt;if(0<Dt.length%4)throw new Error("Invalid string. Length must be a multiple of 4");var Vt=Dt.length,Kt=Dt.charAt(Vt-2)==="="?2:Dt.charAt(Vt-1)==="="?1:0,Yt=new ft(3*Dt.length/4-Kt),nr=0<Kt?Dt.length-4:Dt.length,rr=0;function lr(or){Yt[rr++]=or}for(It=0;It<nr;It+=4,0)lr((16711680&(Nt=Gt(Dt.charAt(It))<<18|Gt(Dt.charAt(It+1))<<12|Gt(Dt.charAt(It+2))<<6|Gt(Dt.charAt(It+3))))>>16),lr((65280&Nt)>>8),lr(255&Nt);return Kt==2?lr(255&(Nt=Gt(Dt.charAt(It))<<2|Gt(Dt.charAt(It+1))>>4)):Kt==1&&(lr((Nt=Gt(Dt.charAt(It))<<10|Gt(Dt.charAt(It+1))<<4|Gt(Dt.charAt(It+2))>>2)>>8&255),lr(255&Nt)),Yt},_t.fromByteArray=function(Dt){var It,Nt,Vt,Kt,Yt=Dt.length%3,nr="";function rr(lr){return"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(lr)}for(It=0,Vt=Dt.length-Yt;It<Vt;It+=3)nr+=rr((Kt=Nt=(Dt[It]<<16)+(Dt[It+1]<<8)+Dt[It+2])>>18&63)+rr(Kt>>12&63)+rr(Kt>>6&63)+rr(63&Kt);switch(Yt){case 1:nr+=rr((Nt=Dt[Dt.length-1])>>2),nr+=rr(Nt<<4&63),nr+="==";break;case 2:nr+=rr((Nt=(Dt[Dt.length-2]<<8)+Dt[Dt.length-1])>>10),nr+=rr(Nt>>4&63),nr+=rr(Nt<<2&63),nr+="="}return nr}})(d===void 0?this.base64js={}:d)}).call(this,o("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},o("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/base64-js/lib/b64.js","/node_modules/gulp-browserify/node_modules/base64-js/lib")},{buffer:3,lYpoI2:10}],3:[function(o,c,d){(function(_,v,bt,tt,it,nt,lt,ut,ht){var _t=o("base64-js"),ft=o("ieee754");function bt(tr,dr,Ir){if(!(this instanceof bt))return new bt(tr,dr,Ir);var Xr,Jr,on,Pn,vn,Gn=typeof tr;if(dr==="base64"&&Gn=="string")for(tr=(Xr=tr).trim?Xr.trim():Xr.replace(/^\s+|\s+$/g,"");tr.length%4!=0;)tr+="=";if(Gn=="number")Jr=rr(tr);else if(Gn=="string")Jr=bt.byteLength(tr,dr);else{if(Gn!="object")throw new Error("First argument needs to be a number, array or string.");Jr=rr(tr.length)}if(bt._useTypedArrays?on=bt._augment(new Uint8Array(Jr)):((on=this).length=Jr,on._isBuffer=!0),bt._useTypedArrays&&typeof tr.byteLength=="number")on._set(tr);else if(lr(vn=tr)||bt.isBuffer(vn)||vn&&typeof vn=="object"&&typeof vn.length=="number")for(Pn=0;Pn<Jr;Pn++)bt.isBuffer(tr)?on[Pn]=tr.readUInt8(Pn):on[Pn]=tr[Pn];else if(Gn=="string")on.write(tr,0,dr);else if(Gn=="number"&&!bt._useTypedArrays&&!Ir)for(Pn=0;Pn<Jr;Pn++)on[Pn]=0;return on}function xt(tr,dr,Ir,Xr){Xr||(gr(typeof Ir=="boolean","missing or invalid endian"),gr(dr!=null,"missing offset"),gr(dr+1<tr.length,"Trying to read beyond buffer length"));var Jr,on=tr.length;if(!(on<=dr))return Ir?(Jr=tr[dr],dr+1<on&&(Jr|=tr[dr+1]<<8)):(Jr=tr[dr]<<8,dr+1<on&&(Jr|=tr[dr+1])),Jr}function St(tr,dr,Ir,Xr){Xr||(gr(typeof Ir=="boolean","missing or invalid endian"),gr(dr!=null,"missing offset"),gr(dr+3<tr.length,"Trying to read beyond buffer length"));var Jr,on=tr.length;if(!(on<=dr))return Ir?(dr+2<on&&(Jr=tr[dr+2]<<16),dr+1<on&&(Jr|=tr[dr+1]<<8),Jr|=tr[dr],dr+3<on&&(Jr+=tr[dr+3]<<24>>>0)):(dr+1<on&&(Jr=tr[dr+1]<<16),dr+2<on&&(Jr|=tr[dr+2]<<8),dr+3<on&&(Jr|=tr[dr+3]),Jr+=tr[dr]<<24>>>0),Jr}function wt(tr,dr,Ir,Xr){if(Xr||(gr(typeof Ir=="boolean","missing or invalid endian"),gr(dr!=null,"missing offset"),gr(dr+1<tr.length,"Trying to read beyond buffer length")),!(tr.length<=dr)){var Jr=xt(tr,dr,Ir,!0);return 32768&Jr?-1*(65535-Jr+1):Jr}}function Pt(tr,dr,Ir,Xr){if(Xr||(gr(typeof Ir=="boolean","missing or invalid endian"),gr(dr!=null,"missing offset"),gr(dr+3<tr.length,"Trying to read beyond buffer length")),!(tr.length<=dr)){var Jr=St(tr,dr,Ir,!0);return 2147483648&Jr?-1*(4294967295-Jr+1):Jr}}function Rt(tr,dr,Ir,Xr){return Xr||(gr(typeof Ir=="boolean","missing or invalid endian"),gr(dr+3<tr.length,"Trying to read beyond buffer length")),ft.read(tr,dr,Ir,23,4)}function kt(tr,dr,Ir,Xr){return Xr||(gr(typeof Ir=="boolean","missing or invalid endian"),gr(dr+7<tr.length,"Trying to read beyond buffer length")),ft.read(tr,dr,Ir,52,8)}function Gt(tr,dr,Ir,Xr,Jr){Jr||(gr(dr!=null,"missing value"),gr(typeof Xr=="boolean","missing or invalid endian"),gr(Ir!=null,"missing offset"),gr(Ir+1<tr.length,"trying to write beyond buffer length"),br(dr,65535));var on=tr.length;if(!(on<=Ir))for(var Pn=0,vn=Math.min(on-Ir,2);Pn<vn;Pn++)tr[Ir+Pn]=(dr&255<<8*(Xr?Pn:1-Pn))>>>8*(Xr?Pn:1-Pn)}function Dt(tr,dr,Ir,Xr,Jr){Jr||(gr(dr!=null,"missing value"),gr(typeof Xr=="boolean","missing or invalid endian"),gr(Ir!=null,"missing offset"),gr(Ir+3<tr.length,"trying to write beyond buffer length"),br(dr,4294967295));var on=tr.length;if(!(on<=Ir))for(var Pn=0,vn=Math.min(on-Ir,4);Pn<vn;Pn++)tr[Ir+Pn]=dr>>>8*(Xr?Pn:3-Pn)&255}function It(tr,dr,Ir,Xr,Jr){Jr||(gr(dr!=null,"missing value"),gr(typeof Xr=="boolean","missing or invalid endian"),gr(Ir!=null,"missing offset"),gr(Ir+1<tr.length,"Trying to write beyond buffer length"),fr(dr,32767,-32768)),tr.length<=Ir||Gt(tr,0<=dr?dr:65535+dr+1,Ir,Xr,Jr)}function Nt(tr,dr,Ir,Xr,Jr){Jr||(gr(dr!=null,"missing value"),gr(typeof Xr=="boolean","missing or invalid endian"),gr(Ir!=null,"missing offset"),gr(Ir+3<tr.length,"Trying to write beyond buffer length"),fr(dr,2147483647,-2147483648)),tr.length<=Ir||Dt(tr,0<=dr?dr:4294967295+dr+1,Ir,Xr,Jr)}function Vt(tr,dr,Ir,Xr,Jr){Jr||(gr(dr!=null,"missing value"),gr(typeof Xr=="boolean","missing or invalid endian"),gr(Ir!=null,"missing offset"),gr(Ir+3<tr.length,"Trying to write beyond buffer length"),kr(dr,34028234663852886e22,-34028234663852886e22)),tr.length<=Ir||ft.write(tr,dr,Ir,Xr,23,4)}function Kt(tr,dr,Ir,Xr,Jr){Jr||(gr(dr!=null,"missing value"),gr(typeof Xr=="boolean","missing or invalid endian"),gr(Ir!=null,"missing offset"),gr(Ir+7<tr.length,"Trying to write beyond buffer length"),kr(dr,17976931348623157e292,-17976931348623157e292)),tr.length<=Ir||ft.write(tr,dr,Ir,Xr,52,8)}d.Buffer=bt,d.SlowBuffer=bt,d.INSPECT_MAX_BYTES=50,bt.poolSize=8192,bt._useTypedArrays=function(){try{var tr=new ArrayBuffer(0),dr=new Uint8Array(tr);return dr.foo=function(){return 42},dr.foo()===42&&typeof dr.subarray=="function"}catch{return!1}}(),bt.isEncoding=function(tr){switch(String(tr).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"raw":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},bt.isBuffer=function(tr){return!(tr==null||!tr._isBuffer)},bt.byteLength=function(tr,dr){var Ir;switch(tr+="",dr||"utf8"){case"hex":Ir=tr.length/2;break;case"utf8":case"utf-8":Ir=pr(tr).length;break;case"ascii":case"binary":case"raw":Ir=tr.length;break;case"base64":Ir=hr(tr).length;break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":Ir=2*tr.length;break;default:throw new Error("Unknown encoding")}return Ir},bt.concat=function(tr,dr){if(gr(lr(tr),`Usage: Buffer.concat(list, [totalLength])
list should be an Array.`),tr.length===0)return new bt(0);if(tr.length===1)return tr[0];if(typeof dr!="number")for(Jr=dr=0;Jr<tr.length;Jr++)dr+=tr[Jr].length;for(var Ir=new bt(dr),Xr=0,Jr=0;Jr<tr.length;Jr++){var on=tr[Jr];on.copy(Ir,Xr),Xr+=on.length}return Ir},bt.prototype.write=function(tr,dr,Ir,Xr){var Jr;isFinite(dr)?isFinite(Ir)||(Xr=Ir,Ir=void 0):(Jr=Xr,Xr=dr,dr=Ir,Ir=Jr),dr=Number(dr)||0;var on,Pn,vn,Gn,ms,ar,vr,Cr=this.length-dr;switch((!Ir||Cr<(Ir=Number(Ir)))&&(Ir=Cr),Xr=String(Xr||"utf8").toLowerCase()){case"hex":on=function(Ur,Pr,Dr,jr){Dr=Number(Dr)||0;var en=Ur.length-Dr;(!jr||en<(jr=Number(jr)))&&(jr=en);var rn=Pr.length;gr(rn%2==0,"Invalid hex string"),rn/2<jr&&(jr=rn/2);for(var mn=0;mn<jr;mn++){var bn=parseInt(Pr.substr(2*mn,2),16);gr(!isNaN(bn),"Invalid hex string"),Ur[Dr+mn]=bn}return bt._charsWritten=2*mn,mn}(this,tr,dr,Ir);break;case"utf8":case"utf-8":ms=tr,ar=dr,vr=Ir,on=bt._charsWritten=ur(pr(ms),this,ar,vr);break;case"ascii":case"binary":on=function(Ur,Pr,Dr,jr){return bt._charsWritten=ur(function(en){for(var rn=[],mn=0;mn<en.length;mn++)rn.push(255&en.charCodeAt(mn));return rn}(Pr),Ur,Dr,jr)}(this,tr,dr,Ir);break;case"base64":Pn=tr,vn=dr,Gn=Ir,on=bt._charsWritten=ur(hr(Pn),this,vn,Gn);break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":on=function(Ur,Pr,Dr,jr){return bt._charsWritten=ur(function(en){for(var rn,mn,bn,Tn=[],xn=0;xn<en.length;xn++)mn=(rn=en.charCodeAt(xn))>>8,bn=rn%256,Tn.push(bn),Tn.push(mn);return Tn}(Pr),Ur,Dr,jr)}(this,tr,dr,Ir);break;default:throw new Error("Unknown encoding")}return on},bt.prototype.toString=function(tr,dr,Ir){var Xr,Jr,on,Pn,vn=this;if(tr=String(tr||"utf8").toLowerCase(),dr=Number(dr)||0,(Ir=Ir!==void 0?Number(Ir):Ir=vn.length)===dr)return"";switch(tr){case"hex":Xr=function(Gn,ms,ar){var vr=Gn.length;(!ms||ms<0)&&(ms=0),(!ar||ar<0||vr<ar)&&(ar=vr);for(var Cr="",Ur=ms;Ur<ar;Ur++)Cr+=or(Gn[Ur]);return Cr}(vn,dr,Ir);break;case"utf8":case"utf-8":Xr=function(Gn,ms,ar){var vr="",Cr="";ar=Math.min(Gn.length,ar);for(var Ur=ms;Ur<ar;Ur++)Gn[Ur]<=127?(vr+=cr(Cr)+String.fromCharCode(Gn[Ur]),Cr=""):Cr+="%"+Gn[Ur].toString(16);return vr+cr(Cr)}(vn,dr,Ir);break;case"ascii":case"binary":Xr=function(Gn,ms,ar){var vr="";ar=Math.min(Gn.length,ar);for(var Cr=ms;Cr<ar;Cr++)vr+=String.fromCharCode(Gn[Cr]);return vr}(vn,dr,Ir);break;case"base64":Jr=vn,Pn=Ir,Xr=(on=dr)===0&&Pn===Jr.length?_t.fromByteArray(Jr):_t.fromByteArray(Jr.slice(on,Pn));break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":Xr=function(Gn,ms,ar){for(var vr=Gn.slice(ms,ar),Cr="",Ur=0;Ur<vr.length;Ur+=2)Cr+=String.fromCharCode(vr[Ur]+256*vr[Ur+1]);return Cr}(vn,dr,Ir);break;default:throw new Error("Unknown encoding")}return Xr},bt.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},bt.prototype.copy=function(tr,dr,Ir,Xr){if(Ir=Ir||0,Xr||Xr===0||(Xr=this.length),dr=dr||0,Xr!==Ir&&tr.length!==0&&this.length!==0){gr(Ir<=Xr,"sourceEnd < sourceStart"),gr(0<=dr&&dr<tr.length,"targetStart out of bounds"),gr(0<=Ir&&Ir<this.length,"sourceStart out of bounds"),gr(0<=Xr&&Xr<=this.length,"sourceEnd out of bounds"),Xr>this.length&&(Xr=this.length),tr.length-dr<Xr-Ir&&(Xr=tr.length-dr+Ir);var Jr=Xr-Ir;if(Jr<100||!bt._useTypedArrays)for(var on=0;on<Jr;on++)tr[on+dr]=this[on+Ir];else tr._set(this.subarray(Ir,Ir+Jr),dr)}},bt.prototype.slice=function(tr,dr){var Ir=this.length;if(tr=nr(tr,Ir,0),dr=nr(dr,Ir,Ir),bt._useTypedArrays)return bt._augment(this.subarray(tr,dr));for(var Xr=dr-tr,Jr=new bt(Xr,void 0,!0),on=0;on<Xr;on++)Jr[on]=this[on+tr];return Jr},bt.prototype.get=function(tr){return console.log(".get() is deprecated. Access using array indexes instead."),this.readUInt8(tr)},bt.prototype.set=function(tr,dr){return console.log(".set() is deprecated. Access using array indexes instead."),this.writeUInt8(tr,dr)},bt.prototype.readUInt8=function(tr,dr){if(dr||(gr(tr!=null,"missing offset"),gr(tr<this.length,"Trying to read beyond buffer length")),!(tr>=this.length))return this[tr]},bt.prototype.readUInt16LE=function(tr,dr){return xt(this,tr,!0,dr)},bt.prototype.readUInt16BE=function(tr,dr){return xt(this,tr,!1,dr)},bt.prototype.readUInt32LE=function(tr,dr){return St(this,tr,!0,dr)},bt.prototype.readUInt32BE=function(tr,dr){return St(this,tr,!1,dr)},bt.prototype.readInt8=function(tr,dr){if(dr||(gr(tr!=null,"missing offset"),gr(tr<this.length,"Trying to read beyond buffer length")),!(tr>=this.length))return 128&this[tr]?-1*(255-this[tr]+1):this[tr]},bt.prototype.readInt16LE=function(tr,dr){return wt(this,tr,!0,dr)},bt.prototype.readInt16BE=function(tr,dr){return wt(this,tr,!1,dr)},bt.prototype.readInt32LE=function(tr,dr){return Pt(this,tr,!0,dr)},bt.prototype.readInt32BE=function(tr,dr){return Pt(this,tr,!1,dr)},bt.prototype.readFloatLE=function(tr,dr){return Rt(this,tr,!0,dr)},bt.prototype.readFloatBE=function(tr,dr){return Rt(this,tr,!1,dr)},bt.prototype.readDoubleLE=function(tr,dr){return kt(this,tr,!0,dr)},bt.prototype.readDoubleBE=function(tr,dr){return kt(this,tr,!1,dr)},bt.prototype.writeUInt8=function(tr,dr,Ir){Ir||(gr(tr!=null,"missing value"),gr(dr!=null,"missing offset"),gr(dr<this.length,"trying to write beyond buffer length"),br(tr,255)),dr>=this.length||(this[dr]=tr)},bt.prototype.writeUInt16LE=function(tr,dr,Ir){Gt(this,tr,dr,!0,Ir)},bt.prototype.writeUInt16BE=function(tr,dr,Ir){Gt(this,tr,dr,!1,Ir)},bt.prototype.writeUInt32LE=function(tr,dr,Ir){Dt(this,tr,dr,!0,Ir)},bt.prototype.writeUInt32BE=function(tr,dr,Ir){Dt(this,tr,dr,!1,Ir)},bt.prototype.writeInt8=function(tr,dr,Ir){Ir||(gr(tr!=null,"missing value"),gr(dr!=null,"missing offset"),gr(dr<this.length,"Trying to write beyond buffer length"),fr(tr,127,-128)),dr>=this.length||(0<=tr?this.writeUInt8(tr,dr,Ir):this.writeUInt8(255+tr+1,dr,Ir))},bt.prototype.writeInt16LE=function(tr,dr,Ir){It(this,tr,dr,!0,Ir)},bt.prototype.writeInt16BE=function(tr,dr,Ir){It(this,tr,dr,!1,Ir)},bt.prototype.writeInt32LE=function(tr,dr,Ir){Nt(this,tr,dr,!0,Ir)},bt.prototype.writeInt32BE=function(tr,dr,Ir){Nt(this,tr,dr,!1,Ir)},bt.prototype.writeFloatLE=function(tr,dr,Ir){Vt(this,tr,dr,!0,Ir)},bt.prototype.writeFloatBE=function(tr,dr,Ir){Vt(this,tr,dr,!1,Ir)},bt.prototype.writeDoubleLE=function(tr,dr,Ir){Kt(this,tr,dr,!0,Ir)},bt.prototype.writeDoubleBE=function(tr,dr,Ir){Kt(this,tr,dr,!1,Ir)},bt.prototype.fill=function(tr,dr,Ir){if(tr=tr||0,dr=dr||0,Ir=Ir||this.length,typeof tr=="string"&&(tr=tr.charCodeAt(0)),gr(typeof tr=="number"&&!isNaN(tr),"value is not a number"),gr(dr<=Ir,"end < start"),Ir!==dr&&this.length!==0){gr(0<=dr&&dr<this.length,"start out of bounds"),gr(0<=Ir&&Ir<=this.length,"end out of bounds");for(var Xr=dr;Xr<Ir;Xr++)this[Xr]=tr}},bt.prototype.inspect=function(){for(var tr=[],dr=this.length,Ir=0;Ir<dr;Ir++)if(tr[Ir]=or(this[Ir]),Ir===d.INSPECT_MAX_BYTES){tr[Ir+1]="...";break}return"<Buffer "+tr.join(" ")+">"},bt.prototype.toArrayBuffer=function(){if(typeof Uint8Array>"u")throw new Error("Buffer.toArrayBuffer not supported in this browser");if(bt._useTypedArrays)return new bt(this).buffer;for(var tr=new Uint8Array(this.length),dr=0,Ir=tr.length;dr<Ir;dr+=1)tr[dr]=this[dr];return tr.buffer};var Yt=bt.prototype;function nr(tr,dr,Ir){return typeof tr!="number"?Ir:dr<=(tr=~~tr)?dr:0<=tr||0<=(tr+=dr)?tr:0}function rr(tr){return(tr=~~Math.ceil(+tr))<0?0:tr}function lr(tr){return(Array.isArray||function(dr){return Object.prototype.toString.call(dr)==="[object Array]"})(tr)}function or(tr){return tr<16?"0"+tr.toString(16):tr.toString(16)}function pr(tr){for(var dr=[],Ir=0;Ir<tr.length;Ir++){var Xr=tr.charCodeAt(Ir);if(Xr<=127)dr.push(tr.charCodeAt(Ir));else{var Jr=Ir;55296<=Xr&&Xr<=57343&&Ir++;for(var on=encodeURIComponent(tr.slice(Jr,Ir+1)).substr(1).split("%"),Pn=0;Pn<on.length;Pn++)dr.push(parseInt(on[Pn],16))}}return dr}function hr(tr){return _t.toByteArray(tr)}function ur(tr,dr,Ir,Xr){for(var Jr=0;Jr<Xr&&!(Jr+Ir>=dr.length||Jr>=tr.length);Jr++)dr[Jr+Ir]=tr[Jr];return Jr}function cr(tr){try{return decodeURIComponent(tr)}catch{return""}}function br(tr,dr){gr(typeof tr=="number","cannot write a non-number as a number"),gr(0<=tr,"specified a negative value for writing an unsigned value"),gr(tr<=dr,"value is larger than maximum value for type"),gr(Math.floor(tr)===tr,"value has a fractional component")}function fr(tr,dr,Ir){gr(typeof tr=="number","cannot write a non-number as a number"),gr(tr<=dr,"value larger than maximum allowed value"),gr(Ir<=tr,"value smaller than minimum allowed value"),gr(Math.floor(tr)===tr,"value has a fractional component")}function kr(tr,dr,Ir){gr(typeof tr=="number","cannot write a non-number as a number"),gr(tr<=dr,"value larger than maximum allowed value"),gr(Ir<=tr,"value smaller than minimum allowed value")}function gr(tr,dr){if(!tr)throw new Error(dr||"Failed assertion")}bt._augment=function(tr){return tr._isBuffer=!0,tr._get=tr.get,tr._set=tr.set,tr.get=Yt.get,tr.set=Yt.set,tr.write=Yt.write,tr.toString=Yt.toString,tr.toLocaleString=Yt.toString,tr.toJSON=Yt.toJSON,tr.copy=Yt.copy,tr.slice=Yt.slice,tr.readUInt8=Yt.readUInt8,tr.readUInt16LE=Yt.readUInt16LE,tr.readUInt16BE=Yt.readUInt16BE,tr.readUInt32LE=Yt.readUInt32LE,tr.readUInt32BE=Yt.readUInt32BE,tr.readInt8=Yt.readInt8,tr.readInt16LE=Yt.readInt16LE,tr.readInt16BE=Yt.readInt16BE,tr.readInt32LE=Yt.readInt32LE,tr.readInt32BE=Yt.readInt32BE,tr.readFloatLE=Yt.readFloatLE,tr.readFloatBE=Yt.readFloatBE,tr.readDoubleLE=Yt.readDoubleLE,tr.readDoubleBE=Yt.readDoubleBE,tr.writeUInt8=Yt.writeUInt8,tr.writeUInt16LE=Yt.writeUInt16LE,tr.writeUInt16BE=Yt.writeUInt16BE,tr.writeUInt32LE=Yt.writeUInt32LE,tr.writeUInt32BE=Yt.writeUInt32BE,tr.writeInt8=Yt.writeInt8,tr.writeInt16LE=Yt.writeInt16LE,tr.writeInt16BE=Yt.writeInt16BE,tr.writeInt32LE=Yt.writeInt32LE,tr.writeInt32BE=Yt.writeInt32BE,tr.writeFloatLE=Yt.writeFloatLE,tr.writeFloatBE=Yt.writeFloatBE,tr.writeDoubleLE=Yt.writeDoubleLE,tr.writeDoubleBE=Yt.writeDoubleBE,tr.fill=Yt.fill,tr.inspect=Yt.inspect,tr.toArrayBuffer=Yt.toArrayBuffer,tr}}).call(this,o("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},o("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/buffer/index.js","/node_modules/gulp-browserify/node_modules/buffer")},{"base64-js":2,buffer:3,ieee754:11,lYpoI2:10}],4:[function(o,c,d){(function(_,v,b,tt,it,nt,lt,ut,ht){b=o("buffer").Buffer;var _t=new b(4);_t.fill(0),c.exports={hash:function(ft,bt,xt,St){return b.isBuffer(ft)||(ft=new b(ft)),function(wt,Pt,Rt){for(var kt=new b(Pt),Gt=Rt?kt.writeInt32BE:kt.writeInt32LE,Dt=0;Dt<wt.length;Dt++)Gt.call(kt,wt[Dt],4*Dt,!0);return kt}(bt(function(wt,Pt){var Rt;wt.length%4!=0&&(Rt=wt.length+(4-wt.length%4),wt=b.concat([wt,_t],Rt));for(var kt=[],Gt=Pt?wt.readInt32BE:wt.readInt32LE,Dt=0;Dt<wt.length;Dt+=4)kt.push(Gt.call(wt,Dt));return kt}(ft,St),8*ft.length),xt,St)}}}).call(this,o("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},o("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/helpers.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{buffer:3,lYpoI2:10}],5:[function(o,c,d){(function(_,v,b,tt,it,nt,lt,ut,ht){b=o("buffer").Buffer;var _t=o("./sha"),ft=o("./sha256"),bt=o("./rng"),xt={sha1:_t,sha256:ft,md5:o("./md5")},St=64,wt=new b(St);function Pt(kt,Gt){var Dt=xt[kt=kt||"sha1"],It=[];return Dt||Rt("algorithm:",kt,"is not yet supported"),{update:function(Nt){return b.isBuffer(Nt)||(Nt=new b(Nt)),It.push(Nt),Nt.length,this},digest:function(Nt){var Vt=b.concat(It),Kt=Gt?function(Yt,nr,rr){b.isBuffer(nr)||(nr=new b(nr)),b.isBuffer(rr)||(rr=new b(rr)),nr.length>St?nr=Yt(nr):nr.length<St&&(nr=b.concat([nr,wt],St));for(var lr=new b(St),or=new b(St),pr=0;pr<St;pr++)lr[pr]=54^nr[pr],or[pr]=92^nr[pr];var hr=Yt(b.concat([lr,rr]));return Yt(b.concat([or,hr]))}(Dt,Gt,Vt):Dt(Vt);return It=null,Nt?Kt.toString(Nt):Kt}}}function Rt(){var kt=[].slice.call(arguments).join(" ");throw new Error([kt,"we accept pull requests","http://github.com/dominictarr/crypto-browserify"].join(`
`))}wt.fill(0),d.createHash=function(kt){return Pt(kt)},d.createHmac=Pt,d.randomBytes=function(kt,Gt){if(!Gt||!Gt.call)return new b(bt(kt));try{Gt.call(this,void 0,new b(bt(kt)))}catch(Dt){Gt(Dt)}},function(kt,Gt){for(var Dt in kt)Gt(kt[Dt])}(["createCredentials","createCipher","createCipheriv","createDecipher","createDecipheriv","createSign","createVerify","createDiffieHellman","pbkdf2"],function(kt){d[kt]=function(){Rt("sorry,",kt,"is not implemented yet")}})}).call(this,o("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},o("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/index.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./md5":6,"./rng":7,"./sha":8,"./sha256":9,buffer:3,lYpoI2:10}],6:[function(o,c,d){(function(_,v,b,tt,it,nt,lt,ut,ht){var _t=o("./helpers");function ft(kt,Gt){kt[Gt>>5]|=128<<Gt%32,kt[14+(Gt+64>>>9<<4)]=Gt;for(var Dt=1732584193,It=-271733879,Nt=-1732584194,Vt=271733878,Kt=0;Kt<kt.length;Kt+=16){var Yt=Dt,nr=It,rr=Nt,lr=Vt;Dt=xt(Dt,It,Nt,Vt,kt[Kt+0],7,-680876936),Vt=xt(Vt,Dt,It,Nt,kt[Kt+1],12,-389564586),Nt=xt(Nt,Vt,Dt,It,kt[Kt+2],17,606105819),It=xt(It,Nt,Vt,Dt,kt[Kt+3],22,-1044525330),Dt=xt(Dt,It,Nt,Vt,kt[Kt+4],7,-176418897),Vt=xt(Vt,Dt,It,Nt,kt[Kt+5],12,1200080426),Nt=xt(Nt,Vt,Dt,It,kt[Kt+6],17,-1473231341),It=xt(It,Nt,Vt,Dt,kt[Kt+7],22,-45705983),Dt=xt(Dt,It,Nt,Vt,kt[Kt+8],7,1770035416),Vt=xt(Vt,Dt,It,Nt,kt[Kt+9],12,-1958414417),Nt=xt(Nt,Vt,Dt,It,kt[Kt+10],17,-42063),It=xt(It,Nt,Vt,Dt,kt[Kt+11],22,-1990404162),Dt=xt(Dt,It,Nt,Vt,kt[Kt+12],7,1804603682),Vt=xt(Vt,Dt,It,Nt,kt[Kt+13],12,-40341101),Nt=xt(Nt,Vt,Dt,It,kt[Kt+14],17,-1502002290),Dt=St(Dt,It=xt(It,Nt,Vt,Dt,kt[Kt+15],22,1236535329),Nt,Vt,kt[Kt+1],5,-165796510),Vt=St(Vt,Dt,It,Nt,kt[Kt+6],9,-1069501632),Nt=St(Nt,Vt,Dt,It,kt[Kt+11],14,643717713),It=St(It,Nt,Vt,Dt,kt[Kt+0],20,-373897302),Dt=St(Dt,It,Nt,Vt,kt[Kt+5],5,-701558691),Vt=St(Vt,Dt,It,Nt,kt[Kt+10],9,38016083),Nt=St(Nt,Vt,Dt,It,kt[Kt+15],14,-660478335),It=St(It,Nt,Vt,Dt,kt[Kt+4],20,-405537848),Dt=St(Dt,It,Nt,Vt,kt[Kt+9],5,568446438),Vt=St(Vt,Dt,It,Nt,kt[Kt+14],9,-1019803690),Nt=St(Nt,Vt,Dt,It,kt[Kt+3],14,-187363961),It=St(It,Nt,Vt,Dt,kt[Kt+8],20,1163531501),Dt=St(Dt,It,Nt,Vt,kt[Kt+13],5,-1444681467),Vt=St(Vt,Dt,It,Nt,kt[Kt+2],9,-51403784),Nt=St(Nt,Vt,Dt,It,kt[Kt+7],14,1735328473),Dt=wt(Dt,It=St(It,Nt,Vt,Dt,kt[Kt+12],20,-1926607734),Nt,Vt,kt[Kt+5],4,-378558),Vt=wt(Vt,Dt,It,Nt,kt[Kt+8],11,-2022574463),Nt=wt(Nt,Vt,Dt,It,kt[Kt+11],16,1839030562),It=wt(It,Nt,Vt,Dt,kt[Kt+14],23,-35309556),Dt=wt(Dt,It,Nt,Vt,kt[Kt+1],4,-1530992060),Vt=wt(Vt,Dt,It,Nt,kt[Kt+4],11,1272893353),Nt=wt(Nt,Vt,Dt,It,kt[Kt+7],16,-155497632),It=wt(It,Nt,Vt,Dt,kt[Kt+10],23,-1094730640),Dt=wt(Dt,It,Nt,Vt,kt[Kt+13],4,681279174),Vt=wt(Vt,Dt,It,Nt,kt[Kt+0],11,-358537222),Nt=wt(Nt,Vt,Dt,It,kt[Kt+3],16,-722521979),It=wt(It,Nt,Vt,Dt,kt[Kt+6],23,76029189),Dt=wt(Dt,It,Nt,Vt,kt[Kt+9],4,-640364487),Vt=wt(Vt,Dt,It,Nt,kt[Kt+12],11,-421815835),Nt=wt(Nt,Vt,Dt,It,kt[Kt+15],16,530742520),Dt=Pt(Dt,It=wt(It,Nt,Vt,Dt,kt[Kt+2],23,-995338651),Nt,Vt,kt[Kt+0],6,-198630844),Vt=Pt(Vt,Dt,It,Nt,kt[Kt+7],10,1126891415),Nt=Pt(Nt,Vt,Dt,It,kt[Kt+14],15,-1416354905),It=Pt(It,Nt,Vt,Dt,kt[Kt+5],21,-57434055),Dt=Pt(Dt,It,Nt,Vt,kt[Kt+12],6,1700485571),Vt=Pt(Vt,Dt,It,Nt,kt[Kt+3],10,-1894986606),Nt=Pt(Nt,Vt,Dt,It,kt[Kt+10],15,-1051523),It=Pt(It,Nt,Vt,Dt,kt[Kt+1],21,-2054922799),Dt=Pt(Dt,It,Nt,Vt,kt[Kt+8],6,1873313359),Vt=Pt(Vt,Dt,It,Nt,kt[Kt+15],10,-30611744),Nt=Pt(Nt,Vt,Dt,It,kt[Kt+6],15,-1560198380),It=Pt(It,Nt,Vt,Dt,kt[Kt+13],21,1309151649),Dt=Pt(Dt,It,Nt,Vt,kt[Kt+4],6,-145523070),Vt=Pt(Vt,Dt,It,Nt,kt[Kt+11],10,-1120210379),Nt=Pt(Nt,Vt,Dt,It,kt[Kt+2],15,718787259),It=Pt(It,Nt,Vt,Dt,kt[Kt+9],21,-343485551),Dt=Rt(Dt,Yt),It=Rt(It,nr),Nt=Rt(Nt,rr),Vt=Rt(Vt,lr)}return Array(Dt,It,Nt,Vt)}function bt(kt,Gt,Dt,It,Nt,Vt){return Rt((Kt=Rt(Rt(Gt,kt),Rt(It,Vt)))<<(Yt=Nt)|Kt>>>32-Yt,Dt);var Kt,Yt}function xt(kt,Gt,Dt,It,Nt,Vt,Kt){return bt(Gt&Dt|~Gt&It,kt,Gt,Nt,Vt,Kt)}function St(kt,Gt,Dt,It,Nt,Vt,Kt){return bt(Gt&It|Dt&~It,kt,Gt,Nt,Vt,Kt)}function wt(kt,Gt,Dt,It,Nt,Vt,Kt){return bt(Gt^Dt^It,kt,Gt,Nt,Vt,Kt)}function Pt(kt,Gt,Dt,It,Nt,Vt,Kt){return bt(Dt^(Gt|~It),kt,Gt,Nt,Vt,Kt)}function Rt(kt,Gt){var Dt=(65535&kt)+(65535&Gt);return(kt>>16)+(Gt>>16)+(Dt>>16)<<16|65535&Dt}c.exports=function(kt){return _t.hash(kt,ft,16)}}).call(this,o("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},o("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/md5.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:10}],7:[function(o,c,d){(function(_,v,b,tt,it,nt,lt,ut,ht){var _t;_t=function(ft){for(var bt,xt=new Array(ft),St=0;St<ft;St++)!(3&St)&&(bt=4294967296*Math.random()),xt[St]=bt>>>((3&St)<<3)&255;return xt},c.exports=_t}).call(this,o("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},o("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/rng.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{buffer:3,lYpoI2:10}],8:[function(o,c,d){(function(_,v,b,tt,it,nt,lt,ut,ht){var _t=o("./helpers");function ft(St,wt){St[wt>>5]|=128<<24-wt%32,St[15+(wt+64>>9<<4)]=wt;for(var Pt,Rt,kt,Gt,Dt,It=Array(80),Nt=1732584193,Vt=-271733879,Kt=-1732584194,Yt=271733878,nr=-1009589776,rr=0;rr<St.length;rr+=16){for(var lr=Nt,or=Vt,pr=Kt,hr=Yt,ur=nr,cr=0;cr<80;cr++){It[cr]=cr<16?St[rr+cr]:xt(It[cr-3]^It[cr-8]^It[cr-14]^It[cr-16],1);var br=bt(bt(xt(Nt,5),(kt=Vt,Gt=Kt,Dt=Yt,(Rt=cr)<20?kt&Gt|~kt&Dt:!(Rt<40)&&Rt<60?kt&Gt|kt&Dt|Gt&Dt:kt^Gt^Dt)),bt(bt(nr,It[cr]),(Pt=cr)<20?1518500249:Pt<40?1859775393:Pt<60?-1894007588:-899497514));nr=Yt,Yt=Kt,Kt=xt(Vt,30),Vt=Nt,Nt=br}Nt=bt(Nt,lr),Vt=bt(Vt,or),Kt=bt(Kt,pr),Yt=bt(Yt,hr),nr=bt(nr,ur)}return Array(Nt,Vt,Kt,Yt,nr)}function bt(St,wt){var Pt=(65535&St)+(65535&wt);return(St>>16)+(wt>>16)+(Pt>>16)<<16|65535&Pt}function xt(St,wt){return St<<wt|St>>>32-wt}c.exports=function(St){return _t.hash(St,ft,20,!0)}}).call(this,o("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},o("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/sha.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:10}],9:[function(o,c,d){(function(_,v,b,tt,it,nt,lt,ut,ht){function _t(St,wt){var Pt=(65535&St)+(65535&wt);return(St>>16)+(wt>>16)+(Pt>>16)<<16|65535&Pt}function ft(St,wt){return St>>>wt|St<<32-wt}function bt(St,wt){var Pt,Rt,kt,Gt,Dt,It,Nt,Vt,Kt,Yt,nr=new Array(1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298),rr=new Array(1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225),lr=new Array(64);St[wt>>5]|=128<<24-wt%32,St[15+(wt+64>>9<<4)]=wt;for(var or,pr,hr,ur,cr,br,fr,kr,gr=0;gr<St.length;gr+=16){Pt=rr[0],Rt=rr[1],kt=rr[2],Gt=rr[3],Dt=rr[4],It=rr[5],Nt=rr[6],Vt=rr[7];for(var tr=0;tr<64;tr++)lr[tr]=tr<16?St[tr+gr]:_t(_t(_t(ft(kr=lr[tr-2],17)^ft(kr,19)^kr>>>10,lr[tr-7]),ft(fr=lr[tr-15],7)^ft(fr,18)^fr>>>3),lr[tr-16]),Kt=_t(_t(_t(_t(Vt,ft(br=Dt,6)^ft(br,11)^ft(br,25)),(cr=Dt)&It^~cr&Nt),nr[tr]),lr[tr]),Yt=_t(ft(ur=Pt,2)^ft(ur,13)^ft(ur,22),(or=Pt)&(pr=Rt)^or&(hr=kt)^pr&hr),Vt=Nt,Nt=It,It=Dt,Dt=_t(Gt,Kt),Gt=kt,kt=Rt,Rt=Pt,Pt=_t(Kt,Yt);rr[0]=_t(Pt,rr[0]),rr[1]=_t(Rt,rr[1]),rr[2]=_t(kt,rr[2]),rr[3]=_t(Gt,rr[3]),rr[4]=_t(Dt,rr[4]),rr[5]=_t(It,rr[5]),rr[6]=_t(Nt,rr[6]),rr[7]=_t(Vt,rr[7])}return rr}var xt=o("./helpers");c.exports=function(St){return xt.hash(St,bt,32,!0)}}).call(this,o("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},o("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/sha256.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:10}],10:[function(o,c,d){(function(_,v,b,tt,it,nt,lt,ut,ht){function _t(){}(_=c.exports={}).nextTick=function(){var ft=typeof window<"u"&&window.setImmediate,bt=typeof window<"u"&&window.postMessage&&window.addEventListener;if(ft)return function(St){return window.setImmediate(St)};if(bt){var xt=[];return window.addEventListener("message",function(St){var wt=St.source;wt!==window&&wt!==null||St.data!=="process-tick"||(St.stopPropagation(),0<xt.length&&xt.shift()())},!0),function(St){xt.push(St),window.postMessage("process-tick","*")}}return function(St){setTimeout(St,0)}}(),_.title="browser",_.browser=!0,_.env={},_.argv=[],_.on=_t,_.addListener=_t,_.once=_t,_.off=_t,_.removeListener=_t,_.removeAllListeners=_t,_.emit=_t,_.binding=function(ft){throw new Error("process.binding is not supported")},_.cwd=function(){return"/"},_.chdir=function(ft){throw new Error("process.chdir is not supported")}}).call(this,o("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},o("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/process/browser.js","/node_modules/gulp-browserify/node_modules/process")},{buffer:3,lYpoI2:10}],11:[function(o,c,d){(function(_,v,b,tt,it,nt,lt,ut,ht){d.read=function(_t,ft,bt,xt,St){var wt,Pt,Rt=8*St-xt-1,kt=(1<<Rt)-1,Gt=kt>>1,Dt=-7,It=bt?St-1:0,Nt=bt?-1:1,Vt=_t[ft+It];for(It+=Nt,wt=Vt&(1<<-Dt)-1,Vt>>=-Dt,Dt+=Rt;0<Dt;wt=256*wt+_t[ft+It],It+=Nt,Dt-=8);for(Pt=wt&(1<<-Dt)-1,wt>>=-Dt,Dt+=xt;0<Dt;Pt=256*Pt+_t[ft+It],It+=Nt,Dt-=8);if(wt===0)wt=1-Gt;else{if(wt===kt)return Pt?NaN:1/0*(Vt?-1:1);Pt+=Math.pow(2,xt),wt-=Gt}return(Vt?-1:1)*Pt*Math.pow(2,wt-xt)},d.write=function(_t,ft,bt,xt,St,wt){var Pt,Rt,kt,Gt=8*wt-St-1,Dt=(1<<Gt)-1,It=Dt>>1,Nt=St===23?Math.pow(2,-24)-Math.pow(2,-77):0,Vt=xt?0:wt-1,Kt=xt?1:-1,Yt=ft<0||ft===0&&1/ft<0?1:0;for(ft=Math.abs(ft),isNaN(ft)||ft===1/0?(Rt=isNaN(ft)?1:0,Pt=Dt):(Pt=Math.floor(Math.log(ft)/Math.LN2),ft*(kt=Math.pow(2,-Pt))<1&&(Pt--,kt*=2),2<=(ft+=1<=Pt+It?Nt/kt:Nt*Math.pow(2,1-It))*kt&&(Pt++,kt/=2),Dt<=Pt+It?(Rt=0,Pt=Dt):1<=Pt+It?(Rt=(ft*kt-1)*Math.pow(2,St),Pt+=It):(Rt=ft*Math.pow(2,It-1)*Math.pow(2,St),Pt=0));8<=St;_t[bt+Vt]=255&Rt,Vt+=Kt,Rt/=256,St-=8);for(Pt=Pt<<St|Rt,Gt+=St;0<Gt;_t[bt+Vt]=255&Pt,Vt+=Kt,Pt/=256,Gt-=8);_t[bt+Vt-Kt]|=128*Yt}}).call(this,o("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},o("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/ieee754/index.js","/node_modules/ieee754")},{buffer:3,lYpoI2:10}]},{},[1])(1)},391:function(h){var o=function(){function c(bt){return lt(bt,ut(nt(ht(bt.length),bt),1/bt.length))}function d(bt){return nt(_t(bt),bt)}function _(bt,xt){return ut(bt,xt?1/(bt.length-1):1/bt.length)}function v(bt){var xt=function(Pt){var Rt,kt=Math.pow(2,-52),Gt=1e-64/kt,Dt=0,It=0,Nt=0,Vt=0,Kt=0,Yt=ft(Pt),nr=Yt.length,rr=Yt[0].length;if(nr<rr)throw"Need more rows than columns";var lr=new Array(rr),or=new Array(rr);for(It=0;It<rr;It++)lr[It]=or[It]=0;var pr=function Jr(on,Pn,vn){vn===void 0&&(vn=0);var Gn,ms=on[vn],ar=Array(ms);if(vn===on.length-1){for(Gn=ms-2;Gn>=0;Gn-=2)ar[Gn+1]=Pn,ar[Gn]=Pn;return Gn===-1&&(ar[0]=Pn),ar}for(Gn=ms-1;Gn>=0;Gn--)ar[Gn]=Jr(on,Pn,vn+1);return ar}([rr,rr],0);function hr(Jr,on){return(Jr=Math.abs(Jr))>(on=Math.abs(on))?Jr*Math.sqrt(1+on*on/Jr/Jr):on==0?Jr:on*Math.sqrt(1+Jr*Jr/on/on)}var ur=0,cr=0,br=0,fr=0,kr=0,gr=0,tr=0;for(It=0;It<rr;It++){for(lr[It]=cr,tr=0,Kt=It+1,Nt=It;Nt<nr;Nt++)tr+=Yt[Nt][It]*Yt[Nt][It];if(tr<=Gt)cr=0;else for(ur=Yt[It][It],cr=Math.sqrt(tr),ur>=0&&(cr=-cr),br=ur*cr-tr,Yt[It][It]=ur-cr,Nt=Kt;Nt<rr;Nt++){for(tr=0,Vt=It;Vt<nr;Vt++)tr+=Yt[Vt][It]*Yt[Vt][Nt];for(ur=tr/br,Vt=It;Vt<nr;Vt++)Yt[Vt][Nt]+=ur*Yt[Vt][It]}for(or[It]=cr,tr=0,Nt=Kt;Nt<rr;Nt++)tr+=Yt[It][Nt]*Yt[It][Nt];if(tr<=Gt)cr=0;else{for(ur=Yt[It][It+1],cr=Math.sqrt(tr),ur>=0&&(cr=-cr),br=ur*cr-tr,Yt[It][It+1]=ur-cr,Nt=Kt;Nt<rr;Nt++)lr[Nt]=Yt[It][Nt]/br;for(Nt=Kt;Nt<nr;Nt++){for(tr=0,Vt=Kt;Vt<rr;Vt++)tr+=Yt[Nt][Vt]*Yt[It][Vt];for(Vt=Kt;Vt<rr;Vt++)Yt[Nt][Vt]+=tr*lr[Vt]}}(kr=Math.abs(or[It])+Math.abs(lr[It]))>fr&&(fr=kr)}for(It=rr-1;It!=-1;It+=-1){if(cr!=0){for(br=cr*Yt[It][It+1],Nt=Kt;Nt<rr;Nt++)pr[Nt][It]=Yt[It][Nt]/br;for(Nt=Kt;Nt<rr;Nt++){for(tr=0,Vt=Kt;Vt<rr;Vt++)tr+=Yt[It][Vt]*pr[Vt][Nt];for(Vt=Kt;Vt<rr;Vt++)pr[Vt][Nt]+=tr*pr[Vt][It]}}for(Nt=Kt;Nt<rr;Nt++)pr[It][Nt]=0,pr[Nt][It]=0;pr[It][It]=1,cr=lr[It],Kt=It}for(It=rr-1;It!=-1;It+=-1){for(Kt=It+1,cr=or[It],Nt=Kt;Nt<rr;Nt++)Yt[It][Nt]=0;if(cr!=0){for(br=Yt[It][It]*cr,Nt=Kt;Nt<rr;Nt++){for(tr=0,Vt=Kt;Vt<nr;Vt++)tr+=Yt[Vt][It]*Yt[Vt][Nt];for(ur=tr/br,Vt=It;Vt<nr;Vt++)Yt[Vt][Nt]+=ur*Yt[Vt][It]}for(Nt=It;Nt<nr;Nt++)Yt[Nt][It]=Yt[Nt][It]/cr}else for(Nt=It;Nt<nr;Nt++)Yt[Nt][It]=0;Yt[It][It]+=1}for(kt*=fr,Vt=rr-1;Vt!=-1;Vt+=-1)for(var dr=0;dr<50;dr++){var Ir=!1;for(Kt=Vt;Kt!=-1;Kt+=-1){if(Math.abs(lr[Kt])<=kt){Ir=!0;break}if(Math.abs(or[Kt-1])<=kt)break}if(!Ir){Dt=0,tr=1;var Xr=Kt-1;for(It=Kt;It<Vt+1&&(ur=tr*lr[It],lr[It]=Dt*lr[It],!(Math.abs(ur)<=kt));It++)for(br=hr(ur,cr=or[It]),or[It]=br,Dt=cr/br,tr=-ur/br,Nt=0;Nt<nr;Nt++)kr=Yt[Nt][Xr],gr=Yt[Nt][It],Yt[Nt][Xr]=kr*Dt+gr*tr,Yt[Nt][It]=-kr*tr+gr*Dt}if(gr=or[Vt],Kt==Vt){if(gr<0)for(or[Vt]=-gr,Nt=0;Nt<rr;Nt++)pr[Nt][Vt]=-pr[Nt][Vt];break}if(dr>=49)throw"Error: no convergence.";for(fr=or[Kt],cr=hr(ur=(((kr=or[Vt-1])-gr)*(kr+gr)+((cr=lr[Vt-1])-(br=lr[Vt]))*(cr+br))/(2*br*kr),1),ur=ur<0?((fr-gr)*(fr+gr)+br*(kr/(ur-cr)-br))/fr:((fr-gr)*(fr+gr)+br*(kr/(ur+cr)-br))/fr,Dt=1,tr=1,It=Kt+1;It<Vt+1;It++){for(cr=lr[It],kr=or[It],br=tr*cr,cr*=Dt,gr=hr(ur,br),lr[It-1]=gr,ur=fr*(Dt=ur/gr)+cr*(tr=br/gr),cr=-fr*tr+cr*Dt,br=kr*tr,kr*=Dt,Nt=0;Nt<rr;Nt++)fr=pr[Nt][It-1],gr=pr[Nt][It],pr[Nt][It-1]=fr*Dt+gr*tr,pr[Nt][It]=-fr*tr+gr*Dt;for(gr=hr(ur,br),or[It-1]=gr,ur=(Dt=ur/gr)*cr+(tr=br/gr)*kr,fr=-tr*cr+Dt*kr,Nt=0;Nt<nr;Nt++)kr=Yt[Nt][It-1],gr=Yt[Nt][It],Yt[Nt][It-1]=kr*Dt+gr*tr,Yt[Nt][It]=-kr*tr+gr*Dt}lr[Kt]=0,lr[Vt]=ur,or[Vt]=fr}for(It=0;It<or.length;It++)or[It]<kt&&(or[It]=0);for(It=0;It<rr;It++)for(Nt=It-1;Nt>=0;Nt--)if(or[Nt]<or[It]){for(Dt=or[Nt],or[Nt]=or[It],or[It]=Dt,Vt=0;Vt<Yt.length;Vt++)Rt=Yt[Vt][It],Yt[Vt][It]=Yt[Vt][Nt],Yt[Vt][Nt]=Rt;for(Vt=0;Vt<pr.length;Vt++)Rt=pr[Vt][It],pr[Vt][It]=pr[Vt][Nt],pr[Vt][Nt]=Rt;It=Nt}return{U:Yt,S:or,V:pr}}(bt);console.log(xt);var St=xt.U,wt=xt.S.map(function(Pt,Rt){var kt={};return kt.eigenvalue=Pt,kt.vector=St.map(function(Gt,Dt){return-1*Gt[Rt]}),kt});return wt}function b(bt,...xt){var St=xt.map(function(Rt){return Rt.vector}),wt=nt(St,_t(c(bt))),Pt=ut(nt(ht(bt.length),bt),-1/bt.length);return{adjustedData:wt,formattedAdjustedData:it(wt,2),avgData:Pt,selectedVectors:St}}function tt(bt){return v(_(d(c(bt)),!1))}function it(bt,xt){var St=Math.pow(10,xt);return bt.map(function(wt,Pt){return wt.map(function(Rt){return Math.round(Rt*St)/St})})}function nt(bt,xt){if(!(bt[0]&&xt[0]&&bt.length&&xt.length))throw new Error("Both A and B should be matrices");if(xt.length!==bt[0].length)throw new Error("Columns in A should be the same as the number of rows in B");for(var St=[],wt=0;wt<bt.length;wt++){St[wt]=[];for(var Pt=0;Pt<xt[0].length;Pt++)for(var Rt=0;Rt<bt[0].length;Rt++)St[wt][Pt]=St[wt][Pt]?St[wt][Pt]+bt[wt][Rt]*xt[Rt][Pt]:bt[wt][Rt]*xt[Rt][Pt]}return St}function lt(bt,xt){if(bt.length!==xt.length||bt[0].length!==xt[0].length)throw new Error("Both A and B should have the same dimensions");for(var St=[],wt=0;wt<bt.length;wt++){St[wt]=[];for(var Pt=0;Pt<xt[0].length;Pt++)St[wt][Pt]=bt[wt][Pt]-xt[wt][Pt]}return St}function ut(bt,xt){for(var St=[],wt=0;wt<bt.length;wt++){St[wt]=[];for(var Pt=0;Pt<bt[0].length;Pt++)St[wt][Pt]=bt[wt][Pt]*xt}return St}function ht(bt){for(var xt=[],St=0;St<bt;St++){xt[St]=[];for(var wt=0;wt<bt;wt++)xt[St][wt]=1}return xt}function _t(bt){return ft(bt)[0].map(function(xt,St){return bt.map(function(wt){return wt[St]})})}function ft(bt){var xt=JSON.stringify(bt);return JSON.parse(xt)}return{computeDeviationScores:d,computeDeviationMatrix:c,computeSVD:v,computePercentageExplained:function(bt,...xt){var St=bt.map(function(Pt){return Pt.eigenvalue}).reduce(function(Pt,Rt){return Pt+Rt}),wt=xt.map(function(Pt){return Pt.eigenvalue}).reduce(function(Pt,Rt){return Pt+Rt});return wt/St},computeOriginalData:function(bt,xt,St){var wt=lt(_t(nt(_t(xt),bt)),St);return{originalData:wt,formattedOriginalData:it(wt,2)}},computeVarianceCovariance:_,computeAdjustedData:b,getEigenVectors:tt,analyseTopResult:function(bt){var xt=tt(bt).sort(function(St,wt){return wt.eigenvalue-St.eigenvalue});return console.log("Sorted Vectors",xt),b(bt,xt[0].vector)},transpose:_t,multiply:nt,clone:ft,scale:ut}}();h.exports=o},186:function(h){var o=[];function c(v){for(var b=-1,tt=0;tt<o.length;tt++)if(o[tt].identifier===v){b=tt;break}return b}function d(v,b){for(var tt={},it=[],nt=0;nt<v.length;nt++){var lt=v[nt],ut=b.base?lt[0]+b.base:lt[0],ht=tt[ut]||0,_t="".concat(ut," ").concat(ht);tt[ut]=ht+1;var ft=c(_t),bt={css:lt[1],media:lt[2],sourceMap:lt[3],supports:lt[4],layer:lt[5]};if(ft!==-1)o[ft].references++,o[ft].updater(bt);else{var xt=_(bt,b);b.byIndex=nt,o.splice(nt,0,{identifier:_t,updater:xt,references:1})}it.push(_t)}return it}function _(v,b){var tt=b.domAPI(b);return tt.update(v),function(it){if(it){if(it.css===v.css&&it.media===v.media&&it.sourceMap===v.sourceMap&&it.supports===v.supports&&it.layer===v.layer)return;tt.update(v=it)}else tt.remove()}}h.exports=function(v,b){var tt=d(v=v||[],b=b||{});return function(it){it=it||[];for(var nt=0;nt<tt.length;nt++){var lt=c(tt[nt]);o[lt].references--}for(var ut=d(it,b),ht=0;ht<tt.length;ht++){var _t=c(tt[ht]);o[_t].references===0&&(o[_t].updater(),o.splice(_t,1))}tt=ut}}},990:function(h){h.exports=function(o){var c=document.createElement("style");return o.setAttributes(c,o.attributes),o.insert(c,o.options),c}},626:function(h,o,c){h.exports=function(d){var _=c.nc;_&&d.setAttribute("nonce",_)}},155:function(h){h.exports=function(o){var c=o.insertStyleElement(o);return{update:function(d){(function(_,v,b){var tt="";b.supports&&(tt+="@supports (".concat(b.supports,") {")),b.media&&(tt+="@media ".concat(b.media," {"));var it=b.layer!==void 0;it&&(tt+="@layer".concat(b.layer.length>0?" ".concat(b.layer):""," {")),tt+=b.css,it&&(tt+="}"),b.media&&(tt+="}"),b.supports&&(tt+="}");var nt=b.sourceMap;nt&&typeof btoa<"u"&&(tt+=`
/`,tt+="*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(nt))))," *"),tt+="/"),v.styleTagTransform(tt,_,v.options)})(c,o,d)},remove:function(){(function(d){if(d.parentNode===null)return!1;d.parentNode.removeChild(d)})(c)}}}},827:function(h){h.exports=function(o,c){if(c.styleSheet)c.styleSheet.cssText=o;else{for(;c.firstChild;)c.removeChild(c.firstChild);c.appendChild(document.createTextNode(o))}}},530:function(h){h.exports=function(){var o={820:function(v,b,tt){var it=tt(537),nt=tt.n(it),lt=tt(645),ut=tt.n(lt)()(nt());ut.push([v.id,`.treejs {
  -webkit-box-sizing: border-box;
          box-sizing: border-box;
  font-size: 14px;
  margin-left: -18px;
  -webkit-user-select: none;
     -moz-user-select: none;
      -ms-user-select: none;
          user-select: none;
}
.treejs *:after,
.treejs *:before {
  -webkit-box-sizing: border-box;
          box-sizing: border-box;
}
.treejs > .treejs-node {
  padding-left: 0;
}
.treejs .treejs-nodes {
  list-style: none;
  padding-left: 18px;
  margin: 0;
  overflow: hidden;
  -webkit-transition: height 150ms ease-out, opacity 150ms ease-out;
  -o-transition: height 150ms ease-out, opacity 150ms ease-out;
  transition: height 150ms ease-out, opacity 150ms ease-out;
}
.treejs .treejs-node {
  cursor: pointer;
  overflow: hidden;
}
.treejs .treejs-node.treejs-placeholder {
  padding-left: 18px;
}
.treejs .treejs-switcher {
  display: inline-block;
  vertical-align: middle;
  width: 20px;
  height: 20px;
  cursor: pointer;
  position: relative;
  -webkit-transition: -webkit-transform 150ms ease-out;
  transition: -webkit-transform 150ms ease-out;
  -o-transition: transform 150ms ease-out;
  transition: transform 150ms ease-out;
  transition: transform 150ms ease-out, -webkit-transform 150ms ease-out;
}
.treejs .treejs-switcher:before {
  position: absolute;
  top: 8px;
  left: 6px;
  display: block;
  content: ' ';
  border: 4px solid transparent;
  border-top: 4px solid rgba(245, 245, 245, 0.7);
  -webkit-transition: border-color 150ms;
  -o-transition: border-color 150ms;
  transition: border-color 150ms;
}
.treejs .treejs-switcher:hover:before {
  border-top: 4px solid rgba(245, 245, 245, 0.96);
}
.treejs .treejs-node__close > .treejs-switcher {
  -webkit-transform: rotate(-90deg);
      -ms-transform: rotate(-90deg);
          transform: rotate(-90deg);
}
.treejs .treejs-node__close > .treejs-nodes {
  height: 0;
}
.treejs .treejs-checkbox {
  display: inline-block;
  vertical-align: middle;
  width: 20px;
  height: 20px;
  cursor: pointer;
  position: relative;
}
.treejs .treejs-checkbox:before {
  -webkit-transition: all 0.3s;
  -o-transition: all 0.3s;
  transition: all 0.3s;
  cursor: pointer;
  position: absolute;
  top: 2px;
  content: ' ';
  display: block;
  width: 16px;
  height: 16px;
  border: 1px solid #d9d9d9;
  border-radius: 2px;
}
.treejs .treejs-checkbox:hover:before {
  -webkit-box-shadow: 0 0 2px 1px #1890ff;
          box-shadow: 0 0 2px 1px #1890ff;
}
.treejs .treejs-node__checked > .treejs-checkbox:before {
  background-color: #1890ff;
  border-color: #1890ff;
}
.treejs .treejs-node__checked > .treejs-checkbox:after {
  position: absolute;
  content: ' ';
  display: block;
  top: 4px;
  left: 5px;
  width: 5px;
  height: 9px;
  border: 2px solid #fff;
  border-top: none;
  border-left: none;
  -webkit-transform: rotate(45deg);
      -ms-transform: rotate(45deg);
          transform: rotate(45deg);
}
.treejs .treejs-node__halfchecked > .treejs-checkbox:before {
  background-color: #1890ff;
  border-color: #1890ff;
}
.treejs .treejs-node__halfchecked > .treejs-checkbox:after {
  position: absolute;
  content: ' ';
  display: block;
  top: 9px;
  left: 3px;
  width: 10px;
  height: 2px;
  background-color: #fff;
}
.treejs .treejs-node__disabled {
  cursor: not-allowed;
  color: rgba(255, 255, 255, 0.25);
}
.treejs .treejs-node__disabled .treejs-checkbox {
  cursor: not-allowed;
}
.treejs .treejs-node__disabled .treejs-checkbox:before {
  cursor: not-allowed;
  border-color: #d9d9d9 !important;
  background-color: #f5f5f5 !important;
}
.treejs .treejs-node__disabled .treejs-checkbox:hover:before {
  -webkit-box-shadow: none !important;
          box-shadow: none !important;
}
.treejs .treejs-node__disabled .treejs-node__checked > .treejs-checkbox:after {
  border-color: #d9d9d9;
}
.treejs .treejs-node__disabled .treejs-node__halfchecked > .treejs-checkbox:after {
  background-color: #d9d9d9;
}
.treejs .treejs-node__disabled.treejs-node__checked > .treejs-checkbox:after {
  border-color: #d9d9d9;
}
.treejs .treejs-node__disabled.treejs-node__halfchecked > .treejs-checkbox:after {
  background-color: #d9d9d9;
}
.treejs .treejs-label {
  vertical-align: middle;
}
`,"",{version:3,sources:["webpack://./src/index.less"],names:[],mappings:"AAKA;EACE,8BAAA;UAAA,sBAAA;EACA,eAAA;EACA,kBAAA;EACA,yBAAA;KAAA,sBAAA;MAAA,qBAAA;UAAA,iBAAA;AAJF;AAAA;;EAQI,8BAAA;UAAA,sBAAA;AAJJ;AAOE;EACE,eAAA;AALJ;AAPA;EAgBI,gBAAA;EACA,kBAAA;EACA,SAAA;EACA,gBAAA;EACA,iEAAA;EAAA,4DAAA;EAAA,yDAAA;AANJ;AAdA;EAwBI,eAAA;EACA,gBAAA;AAPJ;AASI;EACE,kBAAA;AAPN;AArBA;EAiCI,qBAAA;EACA,sBAAA;EACA,WAAA;EACA,YAAA;EACA,eAAA;EACA,kBAAA;EACA,oDAAA;EAAA,4CAAA;EAAA,uCAAA;EAAA,oCAAA;EAAA,sEAAA;AATJ;AAWI;EACE,kBAAA;EACA,QAAA;EACA,SAAA;EACA,cAAA;EACA,YAAA;EACA,6BAAA;EACA,8CAAA;EACA,sCAAA;EAAA,iCAAA;EAAA,8BAAA;AATN;AAWI;EACE,+CAAA;AATN;AA3CA;EAwDI,iCAAA;MAAA,6BAAA;UAAA,yBAAA;AAVJ;AA9CA;EA2DI,SAAA;AAVJ;AAjDA;EA+DI,qBAAA;EACA,sBAAA;EACA,WAAA;EACA,YAAA;EACA,eAAA;EACA,kBAAA;AAXJ;AAaI;EACE,4BAAA;EAAA,uBAAA;EAAA,oBAAA;EACA,eAAA;EACA,kBAAA;EACA,QAAA;EACA,YAAA;EACA,cAAA;EACA,WAAA;EACA,YAAA;EACA,yBAAA;EACA,kBAAA;AAXN;AAaI;EACE,uCAAA;UAAA,+BAAA;AAXN;AAgBM;EACE,yBAAA;EACA,qBAAA;AAdR;AAgBM;EACE,kBAAA;EACA,YAAA;EACA,cAAA;EACA,QAAA;EACA,SAAA;EACA,UAAA;EACA,WAAA;EACA,sBAAA;EACA,gBAAA;EACA,iBAAA;EACA,gCAAA;MAAA,4BAAA;UAAA,wBAAA;AAdR;AAoBM;EACE,yBAAA;EACA,qBAAA;AAlBR;AAoBM;EACE,kBAAA;EACA,YAAA;EACA,cAAA;EACA,QAAA;EACA,SAAA;EACA,WAAA;EACA,WAAA;EACA,sBAAA;AAlBR;AAvGA;EA+HI,mBAAA;EACA,gCAAA;AArBJ;AA3GA;EAkIM,mBAAA;AApBN;AAqBM;EACE,mBAAA;EACA,gCAAA;EACA,oCAAA;AAnBR;AAqBM;EACE,mCAAA;UAAA,2BAAA;AAnBR;AAwBQ;EACE,qBAAA;AAtBV;AA4BQ;EACE,yBAAA;AA1BV;AAiCM;EACE,qBAAA;AA/BR;AAqCM;EACE,yBAAA;AAnCR;AAlIA;EA2KI,sBAAA;AAtCJ",sourcesContent:[`@color-disable: #d4d4d4;
@bgcolor-disable: #f5f5f5;
@greyborder: #d9d9d9;
@bluebg: #1890ff;

.treejs {
  box-sizing: border-box;
  font-size: 14px;
  margin-left: -18px;
  user-select: none;

  *:after,
  *:before {
    box-sizing: border-box;
  }

  & > .treejs-node {
    padding-left: 0;
  }

  .treejs-nodes {
    list-style: none;
    padding-left: 18px;
    margin: 0; //  for default ul...
    overflow: hidden;
    transition: height 150ms ease-out, opacity 150ms ease-out;
  }

  .treejs-node {
    cursor: pointer;
    overflow: hidden;

    &.treejs-placeholder {
      padding-left: 18px;
    }
  }

  .treejs-switcher {
    display: inline-block;
    vertical-align: middle;
    width: 20px;
    height: 20px;
    cursor: pointer;
    position: relative;
    transition: transform 150ms ease-out;

    &:before {
      position: absolute;
      top: 8px;
      left: 6px;
      display: block;
      content: ' ';
      border: 4px solid transparent;
      border-top: 4px solid rgba(245, 245, 245, 0.7);
      transition: border-color 150ms;
    }
    &:hover:before {
      border-top: 4px solid rgba(245, 245, 245, 0.96);
    }
  }
  .treejs-node__close > .treejs-switcher {
    transform: rotate(-90deg);
  }
  .treejs-node__close > .treejs-nodes {
    height: 0;
  }

  .treejs-checkbox {
    display: inline-block;
    vertical-align: middle;
    width: 20px;
    height: 20px;
    cursor: pointer;
    position: relative;

    &:before {
      transition: all 0.3s;
      cursor: pointer;
      position: absolute;
      top: 2px;
      content: ' ';
      display: block;
      width: 16px;
      height: 16px;
      border: 1px solid @greyborder;
      border-radius: 2px;
    }
    &:hover:before {
      box-shadow: 0 0 2px 1px @bluebg;
    }
  }
  .treejs-node__checked {
    & > .treejs-checkbox {
      &:before {
        background-color: @bluebg;
        border-color: @bluebg;
      }
      &:after {
        position: absolute;
        content: ' ';
        display: block;
        top: 4px;
        left: 5px;
        width: 5px;
        height: 9px;
        border: 2px solid #fff;
        border-top: none;
        border-left: none;
        transform: rotate(45deg);
      }
    }
  }
  .treejs-node__halfchecked {
    & > .treejs-checkbox {
      &:before {
        background-color: @bluebg;
        border-color: @bluebg;
      }
      &:after {
        position: absolute;
        content: ' ';
        display: block;
        top: 9px;
        left: 3px;
        width: 10px;
        height: 2px;
        background-color: #fff;
      }
    }
  }

  .treejs-node__disabled {
    cursor: not-allowed;
    color: rgba(255, 255, 255, 0.25);
    .treejs-checkbox {
      cursor: not-allowed;
      &:before {
        cursor: not-allowed;
        border-color: @greyborder !important;
        background-color: @bgcolor-disable !important;
      }
      &:hover:before {
        box-shadow: none !important;
      }
    }
    .treejs-node__checked {
      & > .treejs-checkbox {
        &:after {
          border-color: @greyborder;
        }
      }
    }
    .treejs-node__halfchecked {
      & > .treejs-checkbox {
        &:after {
          background-color: @greyborder;
        }
      }
    }
  }
  .treejs-node__disabled.treejs-node__checked {
    & > .treejs-checkbox {
      &:after {
        border-color: @greyborder;
      }
    }
  }
  .treejs-node__disabled.treejs-node__halfchecked {
    & > .treejs-checkbox {
      &:after {
        background-color: @greyborder;
      }
    }
  }

  .treejs-label {
    vertical-align: middle;
  }
}
`],sourceRoot:""}]),b.Z=ut},645:function(v){v.exports=function(b){var tt=[];return tt.toString=function(){return this.map(function(it){var nt="",lt=it[5]!==void 0;return it[4]&&(nt+="@supports (".concat(it[4],") {")),it[2]&&(nt+="@media ".concat(it[2]," {")),lt&&(nt+="@layer".concat(it[5].length>0?" ".concat(it[5]):""," {")),nt+=b(it),lt&&(nt+="}"),it[2]&&(nt+="}"),it[4]&&(nt+="}"),nt}).join("")},tt.i=function(it,nt,lt,ut,ht){typeof it=="string"&&(it=[[null,it,void 0]]);var _t={};if(lt)for(var ft=0;ft<this.length;ft++){var bt=this[ft][0];bt!=null&&(_t[bt]=!0)}for(var xt=0;xt<it.length;xt++){var St=[].concat(it[xt]);lt&&_t[St[0]]||(ht!==void 0&&(St[5]===void 0||(St[1]="@layer".concat(St[5].length>0?" ".concat(St[5]):""," {").concat(St[1],"}")),St[5]=ht),nt&&(St[2]&&(St[1]="@media ".concat(St[2]," {").concat(St[1],"}")),St[2]=nt),ut&&(St[4]?(St[1]="@supports (".concat(St[4],") {").concat(St[1],"}"),St[4]=ut):St[4]="".concat(ut)),tt.push(St))}},tt}},537:function(v){v.exports=function(b){var tt=b[1],it=b[3];if(!it)return tt;if(typeof btoa=="function"){var nt=btoa(unescape(encodeURIComponent(JSON.stringify(it)))),lt="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(nt),ut="/*# ".concat(lt," */"),ht=it.sources.map(function(_t){return"/*# sourceURL=".concat(it.sourceRoot||"").concat(_t," */")});return[tt].concat(ht).concat([ut]).join(`
`)}return[tt].join(`
`)}},379:function(v){var b=[];function tt(lt){for(var ut=-1,ht=0;ht<b.length;ht++)if(b[ht].identifier===lt){ut=ht;break}return ut}function it(lt,ut){for(var ht={},_t=[],ft=0;ft<lt.length;ft++){var bt=lt[ft],xt=ut.base?bt[0]+ut.base:bt[0],St=ht[xt]||0,wt="".concat(xt," ").concat(St);ht[xt]=St+1;var Pt=tt(wt),Rt={css:bt[1],media:bt[2],sourceMap:bt[3],supports:bt[4],layer:bt[5]};if(Pt!==-1)b[Pt].references++,b[Pt].updater(Rt);else{var kt=nt(Rt,ut);ut.byIndex=ft,b.splice(ft,0,{identifier:wt,updater:kt,references:1})}_t.push(wt)}return _t}function nt(lt,ut){var ht=ut.domAPI(ut);return ht.update(lt),function(_t){if(_t){if(_t.css===lt.css&&_t.media===lt.media&&_t.sourceMap===lt.sourceMap&&_t.supports===lt.supports&&_t.layer===lt.layer)return;ht.update(lt=_t)}else ht.remove()}}v.exports=function(lt,ut){var ht=it(lt=lt||[],ut=ut||{});return function(_t){_t=_t||[];for(var ft=0;ft<ht.length;ft++){var bt=tt(ht[ft]);b[bt].references--}for(var xt=it(_t,ut),St=0;St<ht.length;St++){var wt=tt(ht[St]);b[wt].references===0&&(b[wt].updater(),b.splice(wt,1))}ht=xt}}},216:function(v){v.exports=function(b){var tt=document.createElement("style");return b.setAttributes(tt,b.attributes),b.insert(tt,b.options),tt}},636:function(v,b,tt){v.exports=function(it){var nt=tt.nc;nt&&it.setAttribute("nonce",nt)}},795:function(v){v.exports=function(b){var tt=b.insertStyleElement(b);return{update:function(it){(function(nt,lt,ut){var ht="";ut.supports&&(ht+="@supports (".concat(ut.supports,") {")),ut.media&&(ht+="@media ".concat(ut.media," {"));var _t=ut.layer!==void 0;_t&&(ht+="@layer".concat(ut.layer.length>0?" ".concat(ut.layer):""," {")),ht+=ut.css,_t&&(ht+="}"),ut.media&&(ht+="}"),ut.supports&&(ht+="}");var ft=ut.sourceMap;ft&&typeof btoa<"u"&&(ht+=`
/`,ht+="*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(ft))))," *"),ht+="/"),lt.styleTagTransform(ht,nt,lt.options)})(tt,b,it)},remove:function(){(function(it){if(it.parentNode===null)return!1;it.parentNode.removeChild(it)})(tt)}}}},589:function(v){v.exports=function(b,tt){if(tt.styleSheet)tt.styleSheet.cssText=b;else{for(;tt.firstChild;)tt.removeChild(tt.firstChild);tt.appendChild(document.createTextNode(b))}}}},c={};function d(v){var b=c[v];if(b!==void 0)return b.exports;var tt=c[v]={id:v,exports:{}};return o[v](tt,tt.exports,d),tt.exports}d.n=function(v){var b=v&&v.__esModule?function(){return v.default}:function(){return v};return d.d(b,{a:b}),b},d.d=function(v,b){for(var tt in b)d.o(b,tt)&&!d.o(v,tt)&&Object.defineProperty(v,tt,{enumerable:!0,get:b[tt]})},d.o=function(v,b){return Object.prototype.hasOwnProperty.call(v,b)},d.nc=void 0;var _={};return function(){d.d(_,{default:function(){return lr}});var v=d(379),b=d.n(v),tt=d(795),it=d.n(tt),nt=d(636),lt=d.n(nt),ut=d(216),ht=d.n(ut),_t=d(589),ft=d.n(_t),bt=d(820),xt={};bt.Z&&bt.Z.locals&&(xt.locals=bt.Z.locals);var St,wt=0,Pt={};Pt.styleTagTransform=ft(),Pt.setAttributes=lt(),Pt.insert=function(or,pr){(pr.target||document.head).appendChild(or)},Pt.domAPI=it(),Pt.insertStyleElement=ht(),xt.use=function(or){return Pt.options=or||{},wt++||(St=b()(bt.Z,Pt)),xt},xt.unuse=function(){wt>0&&!--wt&&(St(),St=null)};var Rt=xt;function kt(or,pr){return function(hr){if(Array.isArray(hr))return hr}(or)||function(hr,ur){var cr=hr==null?null:typeof Symbol<"u"&&hr[Symbol.iterator]||hr["@@iterator"];if(cr!=null){var br,fr,kr=[],gr=!0,tr=!1;try{for(cr=cr.call(hr);!(gr=(br=cr.next()).done)&&(kr.push(br.value),!ur||kr.length!==ur);gr=!0);}catch(dr){tr=!0,fr=dr}finally{try{gr||cr.return==null||cr.return()}finally{if(tr)throw fr}}return kr}}(or,pr)||function(hr,ur){if(hr){if(typeof hr=="string")return Gt(hr,ur);var cr=Object.prototype.toString.call(hr).slice(8,-1);return cr==="Object"&&hr.constructor&&(cr=hr.constructor.name),cr==="Map"||cr==="Set"?Array.from(hr):cr==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(cr)?Gt(hr,ur):void 0}}(or,pr)||function(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function Gt(or,pr){(pr==null||pr>or.length)&&(pr=or.length);for(var hr=0,ur=new Array(pr);hr<pr;hr++)ur[hr]=or[hr];return ur}function Dt(or,pr){var hr=Object.keys(or);if(Object.getOwnPropertySymbols){var ur=Object.getOwnPropertySymbols(or);pr&&(ur=ur.filter(function(cr){return Object.getOwnPropertyDescriptor(or,cr).enumerable})),hr.push.apply(hr,ur)}return hr}function It(or){for(var pr=1;pr<arguments.length;pr++){var hr=arguments[pr]!=null?arguments[pr]:{};pr%2?Dt(Object(hr),!0).forEach(function(ur){Nt(or,ur,hr[ur])}):Object.getOwnPropertyDescriptors?Object.defineProperties(or,Object.getOwnPropertyDescriptors(hr)):Dt(Object(hr)).forEach(function(ur){Object.defineProperty(or,ur,Object.getOwnPropertyDescriptor(hr,ur))})}return or}function Nt(or,pr,hr){return pr in or?Object.defineProperty(or,pr,{value:hr,enumerable:!0,configurable:!0,writable:!0}):or[pr]=hr,or}function Vt(or,pr){for(var hr=0;hr<pr.length;hr++){var ur=pr[hr];ur.enumerable=ur.enumerable||!1,ur.configurable=!0,"value"in ur&&(ur.writable=!0),Object.defineProperty(or,ur.key,ur)}}function Kt(or){var pr={};return or.reduce(function(hr,ur){return pr[ur]||(pr[ur]=!0,hr.push(ur)),hr},[])}function Yt(or,pr){requestAnimationFrame(function(){pr.enter(),requestAnimationFrame(function(){pr.active(),setTimeout(function(){pr.leave()},or)})})}function nr(or,pr){try{var hr=or.liElementsById[pr.parent.id];hr.classList.contains("treejs-node__close")||hr.getElementsByClassName("treejs-switcher")[0].click()}catch{return}Object.prototype.hasOwnProperty.call(pr,"parent")&&nr(or,pr.parent)}function rr(or,pr){var hr=or.liElementsById[pr.id];hr.classList.contains("treejs-node__close")&&hr.getElementsByClassName("treejs-switcher")[0].click(),Object.prototype.hasOwnProperty.call(pr,"children")&&pr.children.forEach(function(ur){return rr(or,ur)})}var lr=function(){function or(cr,br){(function(fr,kr){if(!(fr instanceof kr))throw new TypeError("Cannot call a class as a function")})(this,or),Rt.use({target:typeof this.container=="string"?document.querySelector(this.container):this.container}),this.treeNodes=[],this.nodesById={},this.leafNodesById={},this.liElementsById={},this.willUpdateNodesById={},this.container=cr,this.options=Object.assign({values:[],disables:[],loaded:null,closeDepth:null},br),Object.defineProperties(this,{values:{get:function(){return this.getValues()},set:function(fr){this.setValues(Kt(fr))}},disables:{get:function(){return this.getDisables()},set:function(fr){this.setDisables(Kt(fr))}},selectedNodes:{get:function(){var fr=[],kr=this.nodesById;return Object.keys(kr).forEach(function(gr){if(Object.prototype.hasOwnProperty.call(kr,gr)&&(kr[gr].status===1||kr[gr].status===2)){var tr=It({},kr[gr]);delete tr.parent,delete tr.children,fr.push(tr)}}),fr}},disabledNodes:{get:function(){var fr=[],kr=this.nodesById;return Object.keys(kr).forEach(function(gr){if(Object.prototype.hasOwnProperty.call(kr,gr)&&kr[gr].disabled){var tr=It({},kr[gr]);delete tr.parent,fr.push(tr)}}),fr}}}),this.init(this.options.data)}var pr,hr,ur;return pr=or,ur=[{key:"onSwitcherClick",value:function(cr){var br=cr.parentNode,fr=br.lastChild,kr=fr.scrollHeight;br.classList.contains("treejs-node__close")?Yt(150,{enter:function(){fr.style.height=0,fr.style.opacity=0},active:function(){fr.style.height="".concat(kr,"px"),fr.style.opacity=1},leave:function(){fr.style.height="",fr.style.opacity="",br.classList.remove("treejs-node__close")}}):Yt(150,{enter:function(){fr.style.height="".concat(kr,"px"),fr.style.opacity=1},active:function(){fr.style.height=0,fr.style.opacity=0},leave:function(){fr.style.height="",fr.style.opacity="",br.classList.add("treejs-node__close")}})}},{key:"parseTreeData",value:function(cr){var br,fr=(br=cr,JSON.parse(JSON.stringify(br))),kr={},gr={},tr=[],dr=[];return function Ir(Xr,Jr){Xr.forEach(function(on){kr[on.id]=on,on.checked&&tr.push(on.id),on.disabled&&dr.push(on.id),Jr&&(on.parent=Jr),on.children&&on.children.length?Ir(on.children,on):gr[on.id]=on})}(fr),{treeNodes:fr,nodesById:kr,leafNodesById:gr,defaultValues:tr,defaultDisables:dr}}},{key:"createRootEle",value:function(){var cr=document.createElement("div");return cr.classList.add("treejs"),cr}},{key:"createUlEle",value:function(){var cr=document.createElement("ul");return cr.classList.add("treejs-nodes"),cr}},{key:"createLiEle",value:function(cr,br){var fr=document.createElement("li");if(fr.classList.add("treejs-node"),br&&fr.classList.add("treejs-node__close"),cr.children&&cr.children.length){var kr=document.createElement("span");kr.classList.add("treejs-switcher"),fr.appendChild(kr)}else fr.classList.add("treejs-placeholder");var gr=document.createElement("span");gr.classList.add("treejs-checkbox"),fr.appendChild(gr);var tr=document.createElement("span");tr.classList.add("treejs-label");var dr=document.createTextNode(cr.text);return tr.appendChild(dr),fr.appendChild(tr),fr.nodeId=cr.id,fr}}],(hr=[{key:"init",value:function(cr){var br=or.parseTreeData(cr),fr=br.treeNodes,kr=br.nodesById,gr=br.leafNodesById,tr=br.defaultValues,dr=br.defaultDisables;this.treeNodes=fr,this.nodesById=kr,this.leafNodesById=gr,this.render(this.treeNodes);var Ir=this.options,Xr=Ir.values,Jr=Ir.disables,on=Ir.loaded;Xr&&Xr.length?this.setValues(Xr):tr&&tr.length&&this.setValues(tr),Jr&&Jr.length?this.setDisables(Jr):dr&&dr.length&&this.setDisables(dr),typeof on=="function"&&on.call(this)}},{key:"render",value:function(cr){var br=or.createRootEle();br.appendChild(this.buildTree(cr,0)),this.bindEvent(br);var fr=typeof this.container=="string"?document.querySelector(this.container):this.container;(function(kr){for(;kr.firstChild;)kr.removeChild(kr.firstChild)})(fr),fr.appendChild(br)}},{key:"buildTree",value:function(cr,br){var fr=this,kr=or.createUlEle();return cr&&cr.length&&cr.forEach(function(gr){var tr=or.createLiEle(gr,br===fr.options.closeDepth-1);fr.liElementsById[gr.id]=tr;var dr=null;gr.children&&gr.children.length&&(dr=fr.buildTree(gr.children,br+1)),dr&&tr.appendChild(dr),kr.appendChild(tr)}),kr}},{key:"bindEvent",value:function(cr){var br=this;cr.addEventListener("click",function(fr){var kr=fr.target;kr.nodeName==="SPAN"&&kr.classList.contains("treejs-checkbox")?br.onItemClick(kr.parentNode.nodeId):kr.nodeName==="SPAN"&&kr.classList.contains("treejs-label")?br.onItemLabelClick(kr.parentNode.nodeId):kr.nodeName==="LI"&&kr.classList.contains("treejs-node")?br.onItemClick(kr.nodeId):kr.nodeName==="SPAN"&&kr.classList.contains("treejs-switcher")&&or.onSwitcherClick(kr)},!1)}},{key:"onItemClick",value:function(cr){var br=this.nodesById[cr],fr=this.options.onChange;br.disabled||(this.setValue(cr),this.updateLiElements()),fr&&fr.call(this)}},{key:"onItemLabelClick",value:function(cr){var br=this.options.onItemLabelClick;br&&br.call(this,cr)}},{key:"setValue",value:function(cr){var br=this.nodesById[cr];if(br){var fr=br.status,kr=fr===1||fr===2?0:2;br.status=kr,this.markWillUpdateNode(br),this.walkUp(br,"status"),this.walkDown(br,"status")}}},{key:"getValues",value:function(){var cr=this,br=[];return Object.keys(this.leafNodesById).forEach(function(fr){Object.prototype.hasOwnProperty.call(cr.leafNodesById,fr)&&(cr.leafNodesById[fr].status!==1&&cr.leafNodesById[fr].status!==2||br.push(fr))}),br}},{key:"setValues",value:function(cr){var br=this;this.emptyNodesCheckStatus(),cr.forEach(function(kr){br.setValue(kr)}),this.updateLiElements();var fr=this.options.onChange;fr&&fr.call(this)}},{key:"setDisable",value:function(cr){var br=this.nodesById[cr];br&&(br.disabled||(br.disabled=!0,this.markWillUpdateNode(br),this.walkUp(br,"disabled"),this.walkDown(br,"disabled")))}},{key:"getDisables",value:function(){var cr=this,br=[];return Object.keys(this.leafNodesById).forEach(function(fr){Object.prototype.hasOwnProperty.call(cr.leafNodesById,fr)&&cr.leafNodesById[fr].disabled&&br.push(fr)}),br}},{key:"setDisables",value:function(cr){var br=this;this.emptyNodesDisable(),cr.forEach(function(fr){br.setDisable(fr)}),this.updateLiElements()}},{key:"emptyNodesCheckStatus",value:function(){this.willUpdateNodesById=this.getSelectedNodesById(),Object.values(this.willUpdateNodesById).forEach(function(cr){cr.disabled||(cr.status=0)})}},{key:"emptyNodesDisable",value:function(){this.willUpdateNodesById=this.getDisabledNodesById(),Object.values(this.willUpdateNodesById).forEach(function(cr){cr.disabled=!1})}},{key:"getSelectedNodesById",value:function(){return Object.entries(this.nodesById).reduce(function(cr,br){var fr=kt(br,2),kr=fr[0],gr=fr[1];return gr.status!==1&&gr.status!==2||(cr[kr]=gr),cr},{})}},{key:"getDisabledNodesById",value:function(){return Object.entries(this.nodesById).reduce(function(cr,br){var fr=kt(br,2),kr=fr[0],gr=fr[1];return gr.disabled&&(cr[kr]=gr),cr},{})}},{key:"updateLiElements",value:function(){var cr=this;Object.values(this.willUpdateNodesById).forEach(function(br){cr.updateLiElement(br)}),this.willUpdateNodesById={}}},{key:"markWillUpdateNode",value:function(cr){this.willUpdateNodesById[cr.id]=cr}},{key:"walkUp",value:function(cr,br){var fr=cr.parent;if(fr){if(br==="status"){var kr,gr=fr.children.reduce(function(dr,Ir){return Number.isNaN(Ir.status)?dr:dr+Ir.status},0);if(kr=gr?gr===2*fr.children.length?2:1:0,fr.status===kr)return;fr.status=kr}else{var tr=fr.children.reduce(function(dr,Ir){return dr&&Ir.disabled},!0);if(fr.disabled===tr)return;fr.disabled=tr}this.markWillUpdateNode(fr),this.walkUp(fr,br)}}},{key:"walkDown",value:function(cr,br){var fr=this;cr.children&&cr.children.length&&cr.children.forEach(function(kr){br==="status"&&kr.disabled||(kr[br]=cr[br],fr.markWillUpdateNode(kr),fr.walkDown(kr,br))})}},{key:"updateLiElement",value:function(cr){var br=this.liElementsById[cr.id].classList;switch(cr.status){case 0:br.remove("treejs-node__halfchecked","treejs-node__checked");break;case 1:br.remove("treejs-node__checked"),br.add("treejs-node__halfchecked");break;case 2:br.remove("treejs-node__halfchecked"),br.add("treejs-node__checked")}switch(cr.disabled){case!0:br.contains("treejs-node__disabled")||br.add("treejs-node__disabled");break;case!1:br.contains("treejs-node__disabled")&&br.remove("treejs-node__disabled")}}},{key:"collapseAll",value:function(){var cr=this;Object.keys(this.leafNodesById).forEach(function(br){var fr=cr.leafNodesById[br];nr(cr,fr)})}},{key:"expandAll",value:function(){rr(this,this.treeNodes[0])}}])&&Vt(pr.prototype,hr),ur&&Vt(pr,ur),Object.defineProperty(pr,"prototype",{writable:!1}),or}()}(),_.default}()},282:function(h,o){(function(c){const d="tp";function _(Dt){return It=>Nt=>{if(!It&&Nt===void 0)return{succeeded:!1,value:void 0};if(It&&Nt===void 0)return{succeeded:!0,value:void 0};const Vt=Dt(Nt);return Vt!==void 0?{succeeded:!0,value:Vt}:{succeeded:!1,value:void 0}}}function v(Dt){return{custom:It=>_(It)(Dt),boolean:_(It=>typeof It=="boolean"?It:void 0)(Dt),number:_(It=>typeof It=="number"?It:void 0)(Dt),string:_(It=>typeof It=="string"?It:void 0)(Dt),function:_(It=>typeof It=="function"?It:void 0)(Dt),constant:It=>_(Nt=>Nt===It?It:void 0)(Dt),raw:_(It=>It)(Dt),object:It=>_(Nt=>{if((Vt=Nt)!==null&&typeof Vt=="object")return function(Kt,Yt){return Object.keys(Yt).reduce((nr,rr)=>{if(nr===void 0)return;const lr=(0,Yt[rr])(Kt[rr]);return lr.succeeded?Object.assign(Object.assign({},nr),{[rr]:lr.value}):void 0},{})}(Nt,It);var Vt})(Dt),array:It=>_(Nt=>{if(Array.isArray(Nt))return Vt=It,Nt.reduce((Kt,Yt)=>{if(Kt===void 0)return;const nr=Vt(Yt);return nr.succeeded&&nr.value!==void 0?[...Kt,nr.value]:void 0},[]);var Vt})(Dt)}}const b={optional:v(!0),required:v(!1)};function tt(Dt){return It=>It.toFixed(Math.max(Math.min(Dt,20),0))}function it(Dt){return[Dt[0],Dt[1],Dt[2]]}function nt(Dt){return It=>function(Nt,Vt){const Kt=tt(Vt==="float"?2:0);return`rgb(${it(Nt.getComponents("rgb",Vt)).map(Yt=>Kt(Yt)).join(", ")})`}(It,Dt)}function lt(Dt){return It=>function(Nt,Vt){const Kt=tt(2),Yt=tt(Vt==="float"?2:0);return`rgba(${Nt.getComponents("rgb",Vt).map((nr,rr)=>(rr===3?Kt:Yt)(nr)).join(", ")})`}(It,Dt)}function ut(Dt){return It=>function(Nt,Vt){const Kt=tt(Vt==="float"?2:0),Yt=["r","g","b"];return`{${it(Nt.getComponents("rgb",Vt)).map((nr,rr)=>`${Yt[rr]}: ${Kt(nr)}`).join(", ")}}`}(It,Dt)}function ht(Dt){return It=>function(Nt,Vt){const Kt=tt(2),Yt=tt(Vt==="float"?2:0),nr=["r","g","b","a"];return`{${Nt.getComponents("rgb",Vt).map((rr,lr)=>`${nr[lr]}: ${(lr===3?Kt:Yt)(rr)}`).join(", ")}}`}(It,Dt)}function _t(Dt,It,Nt,Vt){return new(Nt||(Nt=Promise))(function(Kt,Yt){function nr(or){try{lr(Vt.next(or))}catch(pr){Yt(pr)}}function rr(or){try{lr(Vt.throw(or))}catch(pr){Yt(pr)}}function lr(or){var pr;or.done?Kt(or.value):(pr=or.value,pr instanceof Nt?pr:new Nt(function(hr){hr(pr)})).then(nr,rr)}lr((Vt=Vt.apply(Dt,[])).next())})}function ft(Dt){return _t(this,void 0,void 0,function*(){const It=new Image;return It.crossOrigin="anonymous",new Promise((Nt,Vt)=>{It.src=Dt,It.onload=()=>{Nt(It)},It.onerror=Vt})})}["int","float"].reduce((Dt,It)=>[...Dt,{format:{alpha:!1,mode:"rgb",notation:"func",type:It},stringifier:nt(It)},{format:{alpha:!0,mode:"rgb",notation:"func",type:It},stringifier:lt(It)},{format:{alpha:!1,mode:"rgb",notation:"object",type:It},stringifier:ut(It)},{format:{alpha:!0,mode:"rgb",notation:"object",type:It},stringifier:ht(It)}],[]);const bt=(xt="img",(Dt,It)=>[d,"-",xt,"v",Dt?`_${Dt}`:"",It?`-${It}`:""].join(""));var xt;class St{constructor(It,Nt){this.element=It.createElement("div"),this.element.classList.add(bt()),Nt.viewProps.bindClassModifiers(this.element),this.input=It.createElement("input"),this.input.classList.add(bt("input")),this.input.setAttribute("type","file"),this.input.setAttribute("accept",Nt.extensions.join(",")),this.image_=It.createElement("img"),this.image_.classList.add(bt("image")),this.image_.classList.add(bt(`image_${Nt.imageFit}`)),this.image_.crossOrigin="anonymous",this.image_.onclick=Vt=>{Nt.clickCallback?Nt.clickCallback(Vt,this.input):this.input.click()},this.element.classList.add(bt("area_root")),this.element.appendChild(this.image_),this.element.appendChild(this.input)}changeImage(It){this.image_.src=It}changeDraggingState(It){const Nt=this.element;It?Nt==null||Nt.classList.add(bt("area_dragging")):Nt==null||Nt.classList.remove(bt("area_dragging"))}}let wt=null;class Pt{constructor(It,Nt){this.value=Nt.value,this.viewProps=Nt.viewProps,this.view=new St(It,{viewProps:this.viewProps,extensions:Nt.extensions,imageFit:Nt.imageFit,clickCallback:Nt.clickCallback}),this.onFile=this.onFile.bind(this),this.onDrop=this.onDrop.bind(this),this.onDragOver=this.onDragOver.bind(this),this.onDragLeave=this.onDragLeave.bind(this),this.view.input.addEventListener("change",this.onFile),this.view.element.addEventListener("drop",this.onDrop),this.view.element.addEventListener("dragover",this.onDragOver),this.view.element.addEventListener("dragleave",this.onDragLeave),this.viewProps.handleDispose(()=>{this.view.input.removeEventListener("change",this.onFile),this.view.input.removeEventListener("drop",this.onDrop),this.view.input.removeEventListener("dragover",this.onDragOver),this.view.input.removeEventListener("dragleave",this.onDragLeave)}),this.value.emitter.on("change",this.handleValueChange.bind(this)),this.handleValueChange()}onFile(It){const Nt=(It==null?void 0:It.target).files;if(!Nt||!Nt.length)return;const Vt=Nt[0];this.setValue(Vt)}onDrop(It){return _t(this,void 0,void 0,function*(){It.preventDefault();try{const{dataTransfer:Nt}=It,Vt=Nt==null?void 0:Nt.files[0];if(Vt)this.setValue(Vt);else{const Kt=Nt==null?void 0:Nt.getData("url");if(!Kt)throw new Error("No url");this.setValue(Kt)}}catch(Nt){console.error("Could not parse the dropped image",Nt)}finally{this.view.changeDraggingState(!1)}})}onDragOver(It){It.preventDefault(),this.view.changeDraggingState(!0)}onDragLeave(){this.view.changeDraggingState(!1)}handleImage(It){return _t(this,void 0,void 0,function*(){It instanceof HTMLImageElement?this.updateImage(It.src):typeof It!="string"&&It?yield this.setValue(It):(It!=="placeholder"&&It||(It=(yield this.handlePlaceholderImage()).src),this.updateImage(It))})}updateImage(It){this.view.changeImage(It)}setValue(It){return _t(this,void 0,void 0,function*(){if(It instanceof HTMLImageElement)this.value.setRawValue(It);else if(It instanceof File){const Nt=URL.createObjectURL(It)+"#"+It.name;It.src=Nt;const Vt=yield ft(Nt).catch(()=>{});this.value.setRawValue(Vt||It)}else It?this.value.setRawValue(yield ft(It)):this.value.setRawValue(yield this.handlePlaceholderImage())})}handleValueChange(){this.handleImage(this.value.rawValue)}handlePlaceholderImage(){return _t(this,void 0,void 0,function*(){return wt||(wt=yield function(){const It=document.createElement("canvas");It.width=320,It.height=50;const Nt=It.getContext("2d");return Nt.fillStyle="#00000004",Nt.fillRect(0,0,It.width,It.height),Nt.fillStyle="#eee",Nt.font='1.25rem "Roboto Mono", "Source Code Pro", Menlo, Courier, monospace',Nt.textAlign="center",Nt.textBaseline="middle",Nt.fillText("No image",.5*It.width,.5*It.height),new Promise(Vt=>{It.toBlob(Kt=>{const Yt=new Image;Yt.src=URL.createObjectURL(Kt),Yt.isPlaceholder=!0,Yt.onload=()=>{Vt(Yt)}})})}()),wt})}}const Rt=[".jpg",".png",".gif"],kt={id:"input-image",type:"input",css:".tp-imgv{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:rgba(0,0,0,0);border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-imgv{background-color:var(--in-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--bld-us);line-height:var(--bld-us);min-width:0;width:100%}.tp-imgv:hover{background-color:var(--in-bg-h)}.tp-imgv:focus{background-color:var(--in-bg-f)}.tp-imgv:active{background-color:var(--in-bg-a)}.tp-imgv:disabled{opacity:.5}:root{--tp-plugin-image-dragging-color: hsla(230, 100%, 66%, 1.00)}.tp-imgv{cursor:pointer;display:inline-flex;height:auto !important;max-height:calc(var(--bld-us)*3);border-radius:4px;position:relative}.tp-imgv.tp-v-disabled{opacity:.5}.tp-imgv_input{width:0;height:0;pointer-events:none;visibility:hidden}.tp-imgv_image{width:100%;height:-moz-max-content;height:max-content;max-height:calc(var(--bld-us)*3);border:0}.tp-imgv_image_contain{-o-object-fit:contain;object-fit:contain}.tp-imgv_image_cover{-o-object-fit:cover;object-fit:cover}.tp-imgv_area_root{transition:opacity .16s ease-in-out}.tp-imgv_area_dragging{border:2px dashed var(--tp-plugin-image-dragging-color);border-radius:4px;opacity:.6}",accept(Dt,It){if(!(Dt instanceof HTMLImageElement||typeof Dt=="string"))return null;const Nt=b,Vt=function(Kt,Yt){const nr=b.required.object(Yt)(Kt);return nr.succeeded?nr.value:void 0}(It,{view:Nt.required.constant("input-image"),acceptUrl:Nt.optional.boolean,clickCallback:Nt.optional.function,imageFit:Nt.optional.custom(Kt=>Kt==="contain"||Kt==="cover"?Kt:void 0),extensions:Nt.optional.array(Nt.required.string)});return Vt?{initialValue:Dt,params:Vt}:null},binding:{reader(Dt){return It=>It.src!==void 0?It.src===""?"placeholder":It.src:It},writer(Dt){return(It,Nt)=>{It.write(Nt)}}},controller(Dt){var It,Nt;return new Pt(Dt.document,{value:Dt.value,imageFit:(It=Dt.params.imageFit)!==null&&It!==void 0?It:"cover",clickCallback:Dt.params.clickCallback,viewProps:Dt.viewProps,extensions:(Nt=Dt.params.extensions)!==null&&Nt!==void 0?Nt:Rt})}},Gt=kt;c.plugin=Gt,Object.defineProperty(c,"__esModule",{value:!0})})(o)},578:function(h,o){(function(c){class d{constructor(At){this.controller_=At}get element(){return this.controller_.view.element}get disabled(){return this.controller_.viewProps.get("disabled")}set disabled(At){this.controller_.viewProps.set("disabled",At)}get hidden(){return this.controller_.viewProps.get("hidden")}set hidden(At){this.controller_.viewProps.set("hidden",At)}dispose(){this.controller_.viewProps.set("disposed",!0)}}class _{constructor(At){this.target=At}}class v extends _{constructor(At,Mt,zt,ir){super(At),this.value=Mt,this.presetKey=zt,this.last=ir==null||ir}}class b extends _{constructor(At,Mt,zt){super(At),this.value=Mt,this.presetKey=zt}}class tt extends _{constructor(At,Mt){super(At),this.expanded=Mt}}class it extends _{constructor(At,Mt){super(At),this.index=Mt}}function nt(jt){return jt==null}function lt(jt,At){if(jt.length!==At.length)return!1;for(let Mt=0;Mt<jt.length;Mt++)if(jt[Mt]!==At[Mt])return!1;return!0}function ut(jt,At){let Mt=jt;do{const zt=Object.getOwnPropertyDescriptor(Mt,At);if(zt&&(zt.set!==void 0||zt.writable===!0))return!0;Mt=Object.getPrototypeOf(Mt)}while(Mt!==null);return!1}const ht={alreadydisposed:()=>"View has been already disposed",invalidparams:jt=>`Invalid parameters for '${jt.name}'`,nomatchingcontroller:jt=>`No matching controller for '${jt.key}'`,nomatchingview:jt=>`No matching view for '${JSON.stringify(jt.params)}'`,notbindable:()=>"Value is not bindable",propertynotfound:jt=>`Property '${jt.name}' not found`,shouldneverhappen:()=>"This error should never happen"};class _t{static alreadyDisposed(){return new _t({type:"alreadydisposed"})}static notBindable(){return new _t({type:"notbindable"})}static propertyNotFound(At){return new _t({type:"propertynotfound",context:{name:At}})}static shouldNeverHappen(){return new _t({type:"shouldneverhappen"})}constructor(At){var Mt;this.message=(Mt=ht[At.type](At.context))!==null&&Mt!==void 0?Mt:"Unexpected error",this.name=this.constructor.name,this.stack=new Error(this.message).stack,this.type=At.type}}class ft{constructor(At,Mt,zt){this.obj_=At,this.key_=Mt,this.presetKey_=zt??Mt}static isBindable(At){return At!==null&&(typeof At=="object"||typeof At=="function")}get key(){return this.key_}get presetKey(){return this.presetKey_}read(){return this.obj_[this.key_]}write(At){this.obj_[this.key_]=At}writeProperty(At,Mt){const zt=this.read();if(!ft.isBindable(zt))throw _t.notBindable();if(!(At in zt))throw _t.propertyNotFound(At);zt[At]=Mt}}class bt extends d{get label(){return this.controller_.props.get("label")}set label(At){this.controller_.props.set("label",At)}get title(){var At;return(At=this.controller_.valueController.props.get("title"))!==null&&At!==void 0?At:""}set title(At){this.controller_.valueController.props.set("title",At)}on(At,Mt){const zt=Mt.bind(this);return this.controller_.valueController.emitter.on(At,()=>{zt(new _(this))}),this}}class xt{constructor(){this.observers_={}}on(At,Mt){let zt=this.observers_[At];return zt||(zt=this.observers_[At]=[]),zt.push({handler:Mt}),this}off(At,Mt){const zt=this.observers_[At];return zt&&(this.observers_[At]=zt.filter(ir=>ir.handler!==Mt)),this}emit(At,Mt){const zt=this.observers_[At];zt&&zt.forEach(ir=>{ir.handler(Mt)})}}const St="tp";function wt(jt){return(At,Mt)=>[St,"-",jt,"v",At?`_${At}`:"",Mt?`-${Mt}`:""].join("")}function Pt(jt){return jt.rawValue}function Rt(jt,At){var Mt,zt;jt.emitter.on("change",(Mt=Pt,zt=At,ir=>zt(Mt(ir)))),At(jt.rawValue)}function kt(jt,At,Mt){Rt(jt.value(At),Mt)}function Gt(jt,At){return Mt=>{(function(zt,ir,mr){mr?zt.classList.add(ir):zt.classList.remove(ir)})(jt,At,Mt)}}function Dt(jt,At){Rt(jt,Mt=>{At.textContent=Mt??""})}const It=wt("btn");class Nt{constructor(At,Mt){this.element=At.createElement("div"),this.element.classList.add(It()),Mt.viewProps.bindClassModifiers(this.element);const zt=At.createElement("button");zt.classList.add(It("b")),Mt.viewProps.bindDisabled(zt),this.element.appendChild(zt),this.buttonElement=zt;const ir=At.createElement("div");ir.classList.add(It("t")),Dt(Mt.props.value("title"),ir),this.buttonElement.appendChild(ir)}}class Vt{constructor(At,Mt){this.emitter=new xt,this.onClick_=this.onClick_.bind(this),this.props=Mt.props,this.viewProps=Mt.viewProps,this.view=new Nt(At,{props:this.props,viewProps:this.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}}class Kt{constructor(At,Mt){var zt;this.constraint_=Mt==null?void 0:Mt.constraint,this.equals_=(zt=Mt==null?void 0:Mt.equals)!==null&&zt!==void 0?zt:(ir,mr)=>ir===mr,this.emitter=new xt,this.rawValue_=At}get constraint(){return this.constraint_}get rawValue(){return this.rawValue_}set rawValue(At){this.setRawValue(At,{forceEmit:!1,last:!0})}setRawValue(At,Mt){const zt=Mt??{forceEmit:!1,last:!0},ir=this.constraint_?this.constraint_.constrain(At):At,mr=this.rawValue_;(!this.equals_(mr,ir)||zt.forceEmit)&&(this.emitter.emit("beforechange",{sender:this}),this.rawValue_=ir,this.emitter.emit("change",{options:zt,previousRawValue:mr,rawValue:ir,sender:this}))}}class Yt{constructor(At){this.emitter=new xt,this.value_=At}get rawValue(){return this.value_}set rawValue(At){this.setRawValue(At,{forceEmit:!1,last:!0})}setRawValue(At,Mt){const zt=Mt??{forceEmit:!1,last:!0},ir=this.value_;(ir!==At||zt.forceEmit)&&(this.emitter.emit("beforechange",{sender:this}),this.value_=At,this.emitter.emit("change",{options:zt,previousRawValue:ir,rawValue:this.value_,sender:this}))}}function nr(jt,At){const Mt=At==null?void 0:At.constraint,zt=At==null?void 0:At.equals;return Mt||zt?new Kt(jt,At):new Yt(jt)}class rr{constructor(At){this.emitter=new xt,this.valMap_=At;for(const Mt in this.valMap_)this.valMap_[Mt].emitter.on("change",()=>{this.emitter.emit("change",{key:Mt,sender:this})})}static createCore(At){return Object.keys(At).reduce((Mt,zt)=>Object.assign(Mt,{[zt]:nr(At[zt])}),{})}static fromObject(At){const Mt=this.createCore(At);return new rr(Mt)}get(At){return this.valMap_[At].rawValue}set(At,Mt){this.valMap_[At].rawValue=Mt}value(At){return this.valMap_[At]}}function lr(jt){return At=>Mt=>{if(!At&&Mt===void 0)return{succeeded:!1,value:void 0};if(At&&Mt===void 0)return{succeeded:!0,value:void 0};const zt=jt(Mt);return zt!==void 0?{succeeded:!0,value:zt}:{succeeded:!1,value:void 0}}}function or(jt){return{custom:At=>lr(At)(jt),boolean:lr(At=>typeof At=="boolean"?At:void 0)(jt),number:lr(At=>typeof At=="number"?At:void 0)(jt),string:lr(At=>typeof At=="string"?At:void 0)(jt),function:lr(At=>typeof At=="function"?At:void 0)(jt),constant:At=>lr(Mt=>Mt===At?At:void 0)(jt),raw:lr(At=>At)(jt),object:At=>lr(Mt=>{if((zt=Mt)!==null&&typeof zt=="object")return function(ir,mr){return Object.keys(mr).reduce((Sr,Wr)=>{if(Sr===void 0)return;const _n=(0,mr[Wr])(ir[Wr]);return _n.succeeded?Object.assign(Object.assign({},Sr),{[Wr]:_n.value}):void 0},{})}(Mt,At);var zt})(jt),array:At=>lr(Mt=>{if(Array.isArray(Mt))return zt=At,Mt.reduce((ir,mr)=>{if(ir===void 0)return;const Sr=zt(mr);return Sr.succeeded&&Sr.value!==void 0?[...ir,Sr.value]:void 0},[]);var zt})(jt)}}const pr={optional:or(!0),required:or(!1)};function hr(jt,At){const Mt=pr.required.object(At)(jt);return Mt.succeeded?Mt.value:void 0}function ur(jt){console.warn([`Missing '${jt.key}' of ${jt.target} in ${jt.place}.`,"Please rebuild plugins with the latest core package."].join(" "))}class cr{constructor(At){this.value_=At}static create(At){return[new cr(At),(Mt,zt)=>{At.setRawValue(Mt,zt)}]}get emitter(){return this.value_.emitter}get rawValue(){return this.value_.rawValue}}const br=wt("");function fr(jt,At){return Gt(jt,br(void 0,At))}class kr extends rr{constructor(At){var Mt;super(At),this.onDisabledChange_=this.onDisabledChange_.bind(this),this.onParentChange_=this.onParentChange_.bind(this),this.onParentGlobalDisabledChange_=this.onParentGlobalDisabledChange_.bind(this),[this.globalDisabled_,this.setGlobalDisabled_]=cr.create(nr(this.getGlobalDisabled_())),this.value("disabled").emitter.on("change",this.onDisabledChange_),this.value("parent").emitter.on("change",this.onParentChange_),(Mt=this.get("parent"))===null||Mt===void 0||Mt.globalDisabled.emitter.on("change",this.onParentGlobalDisabledChange_)}static create(At){var Mt,zt,ir;const mr=At??{};return new kr(rr.createCore({disabled:(Mt=mr.disabled)!==null&&Mt!==void 0&&Mt,disposed:!1,hidden:(zt=mr.hidden)!==null&&zt!==void 0&&zt,parent:(ir=mr.parent)!==null&&ir!==void 0?ir:null}))}get globalDisabled(){return this.globalDisabled_}bindClassModifiers(At){Rt(this.globalDisabled_,fr(At,"disabled")),kt(this,"hidden",fr(At,"hidden"))}bindDisabled(At){Rt(this.globalDisabled_,Mt=>{At.disabled=Mt})}bindTabIndex(At){Rt(this.globalDisabled_,Mt=>{At.tabIndex=Mt?-1:0})}handleDispose(At){this.value("disposed").emitter.on("change",Mt=>{Mt&&At()})}getGlobalDisabled_(){const At=this.get("parent");return!!At&&At.globalDisabled.rawValue||this.get("disabled")}updateGlobalDisabled_(){this.setGlobalDisabled_(this.getGlobalDisabled_())}onDisabledChange_(){this.updateGlobalDisabled_()}onParentGlobalDisabledChange_(){this.updateGlobalDisabled_()}onParentChange_(At){var Mt;const zt=At.previousRawValue;zt==null||zt.globalDisabled.emitter.off("change",this.onParentGlobalDisabledChange_),(Mt=this.get("parent"))===null||Mt===void 0||Mt.globalDisabled.emitter.on("change",this.onParentGlobalDisabledChange_),this.updateGlobalDisabled_()}}const gr=wt(""),tr={veryfirst:"vfst",first:"fst",last:"lst",verylast:"vlst"};class dr{constructor(At){this.parent_=null,this.blade=At.blade,this.view=At.view,this.viewProps=At.viewProps;const Mt=this.view.element;this.blade.value("positions").emitter.on("change",()=>{["veryfirst","first","last","verylast"].forEach(zt=>{Mt.classList.remove(gr(void 0,tr[zt]))}),this.blade.get("positions").forEach(zt=>{Mt.classList.add(gr(void 0,tr[zt]))})}),this.viewProps.handleDispose(()=>{(function(zt){zt&&zt.parentElement&&zt.parentElement.removeChild(zt)})(Mt)})}get parent(){return this.parent_}set parent(At){this.parent_=At,"parent"in this.viewProps.valMap_?this.viewProps.set("parent",this.parent_?this.parent_.viewProps:null):ur({key:"parent",target:kr.name,place:"BladeController.parent"})}}const Ir="http://www.w3.org/2000/svg";function Xr(jt){jt.offsetHeight}function Jr(jt){return jt.ontouchstart!==void 0}function on(){return globalThis.document}const Pn={check:'<path d="M2 8l4 4l8 -8"/>',dropdown:'<path d="M5 7h6l-3 3 z"/>',p2dpad:'<path d="M8 4v8"/><path d="M4 8h8"/><circle cx="12" cy="12" r="1.2"/>'};function vn(jt,At){const Mt=jt.createElementNS(Ir,"svg");return Mt.innerHTML=Pn[At],Mt}function Gn(jt,At,Mt){jt.insertBefore(At,jt.children[Mt])}function ms(jt){jt.parentElement&&jt.parentElement.removeChild(jt)}function ar(jt){for(;jt.children.length>0;)jt.removeChild(jt.children[0])}function vr(jt){return jt.relatedTarget?jt.relatedTarget:"explicitOriginalTarget"in jt?jt.explicitOriginalTarget:null}const Cr=wt("lbl");class Ur{constructor(At,Mt){this.element=At.createElement("div"),this.element.classList.add(Cr()),Mt.viewProps.bindClassModifiers(this.element);const zt=At.createElement("div");zt.classList.add(Cr("l")),kt(Mt.props,"label",mr=>{nt(mr)?this.element.classList.add(Cr(void 0,"nol")):(this.element.classList.remove(Cr(void 0,"nol")),function(Sr){for(;Sr.childNodes.length>0;)Sr.removeChild(Sr.childNodes[0])}(zt),zt.appendChild(function(Sr,Wr){const _n=Sr.createDocumentFragment();return Wr.split(`
`).map(zn=>Sr.createTextNode(zn)).forEach((zn,os)=>{os>0&&_n.appendChild(Sr.createElement("br")),_n.appendChild(zn)}),_n}(At,mr)))}),this.element.appendChild(zt),this.labelElement=zt;const ir=At.createElement("div");ir.classList.add(Cr("v")),this.element.appendChild(ir),this.valueElement=ir}}class Pr extends dr{constructor(At,Mt){const zt=Mt.valueController.viewProps;super(Object.assign(Object.assign({},Mt),{view:new Ur(At,{props:Mt.props,viewProps:zt}),viewProps:zt})),this.props=Mt.props,this.valueController=Mt.valueController,this.view.valueElement.appendChild(this.valueController.view.element)}}const Dr={id:"button",type:"blade",accept(jt){const At=pr,Mt=hr(jt,{title:At.required.string,view:At.required.constant("button"),label:At.optional.string});return Mt?{params:Mt}:null},controller(jt){return new Pr(jt.document,{blade:jt.blade,props:rr.fromObject({label:jt.params.label}),valueController:new Vt(jt.document,{props:rr.fromObject({title:jt.params.title}),viewProps:jt.viewProps})})},api(jt){return jt.controller instanceof Pr&&jt.controller.valueController instanceof Vt?new bt(jt.controller):null}};class jr extends dr{constructor(At){super(At),this.value=At.value}}function en(){return new rr({positions:nr([],{equals:lt})})}class rn extends rr{constructor(At){super(At)}static create(At){const Mt={completed:!0,expanded:At,expandedHeight:null,shouldFixHeight:!1,temporaryExpanded:null},zt=rr.createCore(Mt);return new rn(zt)}get styleExpanded(){var At;return(At=this.get("temporaryExpanded"))!==null&&At!==void 0?At:this.get("expanded")}get styleHeight(){if(!this.styleExpanded)return"0";const At=this.get("expandedHeight");return this.get("shouldFixHeight")&&!nt(At)?`${At}px`:"auto"}bindExpandedClass(At,Mt){const zt=()=>{this.styleExpanded?At.classList.add(Mt):At.classList.remove(Mt)};kt(this,"expanded",zt),kt(this,"temporaryExpanded",zt)}cleanUpTransition(){this.set("shouldFixHeight",!1),this.set("expandedHeight",null),this.set("completed",!0)}}function mn(jt,At){At.style.height=jt.styleHeight}function bn(jt,At){jt.value("expanded").emitter.on("beforechange",()=>{if(jt.set("completed",!1),nt(jt.get("expandedHeight"))){const Mt=function(zt,ir){let mr=0;return function(Sr,Wr){const _n=Sr.style.transition;Sr.style.transition="none",Wr(),Sr.style.transition=_n}(ir,()=>{zt.set("expandedHeight",null),zt.set("temporaryExpanded",!0),Xr(ir),mr=ir.clientHeight,zt.set("temporaryExpanded",null),Xr(ir)}),mr}(jt,At);Mt>0&&jt.set("expandedHeight",Mt)}jt.set("shouldFixHeight",!0),Xr(At)}),jt.emitter.on("change",()=>{mn(jt,At)}),mn(jt,At),At.addEventListener("transitionend",Mt=>{Mt.propertyName==="height"&&jt.cleanUpTransition()})}class Tn extends d{constructor(At,Mt){super(At),this.rackApi_=Mt}}class xn{constructor(At){this.emitter=new xt,this.items_=[],this.cache_=new Set,this.onSubListAdd_=this.onSubListAdd_.bind(this),this.onSubListRemove_=this.onSubListRemove_.bind(this),this.extract_=At}get items(){return this.items_}allItems(){return Array.from(this.cache_)}find(At){for(const Mt of this.allItems())if(At(Mt))return Mt;return null}includes(At){return this.cache_.has(At)}add(At,Mt){if(this.includes(At))throw _t.shouldNeverHappen();const zt=Mt!==void 0?Mt:this.items_.length;this.items_.splice(zt,0,At),this.cache_.add(At);const ir=this.extract_(At);ir&&(ir.emitter.on("add",this.onSubListAdd_),ir.emitter.on("remove",this.onSubListRemove_),ir.allItems().forEach(mr=>{this.cache_.add(mr)})),this.emitter.emit("add",{index:zt,item:At,root:this,target:this})}remove(At){const Mt=this.items_.indexOf(At);if(Mt<0)return;this.items_.splice(Mt,1),this.cache_.delete(At);const zt=this.extract_(At);zt&&(zt.emitter.off("add",this.onSubListAdd_),zt.emitter.off("remove",this.onSubListRemove_)),this.emitter.emit("remove",{index:Mt,item:At,root:this,target:this})}onSubListAdd_(At){this.cache_.add(At.item),this.emitter.emit("add",{index:At.index,item:At.item,root:this,target:At.target})}onSubListRemove_(At){this.cache_.delete(At.item),this.emitter.emit("remove",{index:At.index,item:At.item,root:this,target:At.target})}}class fn extends d{constructor(At){super(At),this.onBindingChange_=this.onBindingChange_.bind(this),this.emitter_=new xt,this.controller_.binding.emitter.on("change",this.onBindingChange_)}get label(){return this.controller_.props.get("label")}set label(At){this.controller_.props.set("label",At)}on(At,Mt){const zt=Mt.bind(this);return this.emitter_.on(At,ir=>{zt(ir.event)}),this}refresh(){this.controller_.binding.read()}onBindingChange_(At){const Mt=At.sender.target.read();this.emitter_.emit("change",{event:new v(this,Mt,this.controller_.binding.target.presetKey,At.options.last)})}}class En extends Pr{constructor(At,Mt){super(At,Mt),this.binding=Mt.binding}}class tn extends d{constructor(At){super(At),this.onBindingUpdate_=this.onBindingUpdate_.bind(this),this.emitter_=new xt,this.controller_.binding.emitter.on("update",this.onBindingUpdate_)}get label(){return this.controller_.props.get("label")}set label(At){this.controller_.props.set("label",At)}on(At,Mt){const zt=Mt.bind(this);return this.emitter_.on(At,ir=>{zt(ir.event)}),this}refresh(){this.controller_.binding.read()}onBindingUpdate_(At){const Mt=At.sender.target.read();this.emitter_.emit("update",{event:new b(this,Mt,this.controller_.binding.target.presetKey)})}}class wn extends Pr{constructor(At,Mt){super(At,Mt),this.binding=Mt.binding,this.viewProps.bindDisabled(this.binding.ticker),this.viewProps.handleDispose(()=>{this.binding.dispose()})}}function Vn(jt){return jt instanceof Qn?jt.apiSet_:jt instanceof Tn?jt.rackApi_.apiSet_:null}function Hn(jt,At){const Mt=jt.find(zt=>zt.controller_===At);if(!Mt)throw _t.shouldNeverHappen();return Mt}function Rs(jt,At,Mt){if(!ft.isBindable(jt))throw _t.notBindable();return new ft(jt,At,Mt)}class Qn extends d{constructor(At,Mt){super(At),this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this),this.onRackInputChange_=this.onRackInputChange_.bind(this),this.onRackMonitorUpdate_=this.onRackMonitorUpdate_.bind(this),this.emitter_=new xt,this.apiSet_=new xn(Vn),this.pool_=Mt;const zt=this.controller_.rack;zt.emitter.on("add",this.onRackAdd_),zt.emitter.on("remove",this.onRackRemove_),zt.emitter.on("inputchange",this.onRackInputChange_),zt.emitter.on("monitorupdate",this.onRackMonitorUpdate_),zt.children.forEach(ir=>{this.setUpApi_(ir)})}get children(){return this.controller_.rack.children.map(At=>Hn(this.apiSet_,At))}addInput(At,Mt,zt){const ir=zt??{},mr=this.controller_.view.element.ownerDocument,Sr=this.pool_.createInput(mr,Rs(At,Mt,ir.presetKey),ir),Wr=new fn(Sr);return this.add(Wr,ir.index)}addMonitor(At,Mt,zt){const ir=zt??{},mr=this.controller_.view.element.ownerDocument,Sr=this.pool_.createMonitor(mr,Rs(At,Mt),ir),Wr=new tn(Sr);return this.add(Wr,ir.index)}addFolder(At){return function(Mt,zt){return Mt.addBlade(Object.assign(Object.assign({},zt),{view:"folder"}))}(this,At)}addButton(At){return function(Mt,zt){return Mt.addBlade(Object.assign(Object.assign({},zt),{view:"button"}))}(this,At)}addSeparator(At){return function(Mt,zt){const ir=zt??{};return Mt.addBlade(Object.assign(Object.assign({},ir),{view:"separator"}))}(this,At)}addTab(At){return function(Mt,zt){return Mt.addBlade(Object.assign(Object.assign({},zt),{view:"tab"}))}(this,At)}add(At,Mt){this.controller_.rack.add(At.controller_,Mt);const zt=this.apiSet_.find(ir=>ir.controller_===At.controller_);return zt&&this.apiSet_.remove(zt),this.apiSet_.add(At),At}remove(At){this.controller_.rack.remove(At.controller_)}addBlade(At){const Mt=this.controller_.view.element.ownerDocument,zt=this.pool_.createBlade(Mt,At),ir=this.pool_.createBladeApi(zt);return this.add(ir,At.index)}on(At,Mt){const zt=Mt.bind(this);return this.emitter_.on(At,ir=>{zt(ir.event)}),this}setUpApi_(At){this.apiSet_.find(Mt=>Mt.controller_===At)||this.apiSet_.add(this.pool_.createBladeApi(At))}onRackAdd_(At){this.setUpApi_(At.bladeController)}onRackRemove_(At){if(At.isRoot){const Mt=Hn(this.apiSet_,At.bladeController);this.apiSet_.remove(Mt)}}onRackInputChange_(At){const Mt=At.bladeController;if(Mt instanceof En){const zt=Hn(this.apiSet_,Mt),ir=Mt.binding;this.emitter_.emit("change",{event:new v(zt,ir.target.read(),ir.target.presetKey,At.options.last)})}else if(Mt instanceof jr){const zt=Hn(this.apiSet_,Mt);this.emitter_.emit("change",{event:new v(zt,Mt.value.rawValue,void 0,At.options.last)})}}onRackMonitorUpdate_(At){if(!(At.bladeController instanceof wn))throw _t.shouldNeverHappen();const Mt=Hn(this.apiSet_,At.bladeController),zt=At.bladeController.binding;this.emitter_.emit("update",{event:new b(Mt,zt.target.read(),zt.target.presetKey)})}}class jn extends Tn{constructor(At,Mt){super(At,new Qn(At.rackController,Mt)),this.emitter_=new xt,this.controller_.foldable.value("expanded").emitter.on("change",zt=>{this.emitter_.emit("fold",{event:new tt(this,zt.sender.rawValue)})}),this.rackApi_.on("change",zt=>{this.emitter_.emit("change",{event:zt})}),this.rackApi_.on("update",zt=>{this.emitter_.emit("update",{event:zt})})}get expanded(){return this.controller_.foldable.get("expanded")}set expanded(At){this.controller_.foldable.set("expanded",At)}get title(){return this.controller_.props.get("title")}set title(At){this.controller_.props.set("title",At)}get children(){return this.rackApi_.children}addInput(At,Mt,zt){return this.rackApi_.addInput(At,Mt,zt)}addMonitor(At,Mt,zt){return this.rackApi_.addMonitor(At,Mt,zt)}addFolder(At){return this.rackApi_.addFolder(At)}addButton(At){return this.rackApi_.addButton(At)}addSeparator(At){return this.rackApi_.addSeparator(At)}addTab(At){return this.rackApi_.addTab(At)}add(At,Mt){return this.rackApi_.add(At,Mt)}remove(At){this.rackApi_.remove(At)}addBlade(At){return this.rackApi_.addBlade(At)}on(At,Mt){const zt=Mt.bind(this);return this.emitter_.on(At,ir=>{zt(ir.event)}),this}}class $n extends dr{constructor(At){super({blade:At.blade,view:At.view,viewProps:At.rackController.viewProps}),this.rackController=At.rackController}}class Kn{constructor(At,Mt){const zt=wt(Mt.viewName);this.element=At.createElement("div"),this.element.classList.add(zt()),Mt.viewProps.bindClassModifiers(this.element)}}function zs(jt){return jt instanceof eo?jt.rack:jt instanceof $n?jt.rackController.rack:null}function js(jt){const At=zs(jt);return At?At.bcSet_:null}class qs{constructor(At){var Mt,zt;this.onBladePositionsChange_=this.onBladePositionsChange_.bind(this),this.onSetAdd_=this.onSetAdd_.bind(this),this.onSetRemove_=this.onSetRemove_.bind(this),this.onChildDispose_=this.onChildDispose_.bind(this),this.onChildPositionsChange_=this.onChildPositionsChange_.bind(this),this.onChildInputChange_=this.onChildInputChange_.bind(this),this.onChildMonitorUpdate_=this.onChildMonitorUpdate_.bind(this),this.onChildValueChange_=this.onChildValueChange_.bind(this),this.onChildViewPropsChange_=this.onChildViewPropsChange_.bind(this),this.onDescendantLayout_=this.onDescendantLayout_.bind(this),this.onDescendantInputChange_=this.onDescendantInputChange_.bind(this),this.onDescendantMonitorUpdate_=this.onDescendantMonitorUpdate_.bind(this),this.emitter=new xt,this.blade_=(Mt=At.blade)!==null&&Mt!==void 0?Mt:null,(zt=this.blade_)===null||zt===void 0||zt.value("positions").emitter.on("change",this.onBladePositionsChange_),this.viewProps=At.viewProps,this.bcSet_=new xn(js),this.bcSet_.emitter.on("add",this.onSetAdd_),this.bcSet_.emitter.on("remove",this.onSetRemove_)}get children(){return this.bcSet_.items}add(At,Mt){var zt;(zt=At.parent)===null||zt===void 0||zt.remove(At),ut(At,"parent")?At.parent=this:(At.parent_=this,ur({key:"parent",target:"BladeController",place:"BladeRack.add"})),this.bcSet_.add(At,Mt)}remove(At){ut(At,"parent")?At.parent=null:(At.parent_=null,ur({key:"parent",target:"BladeController",place:"BladeRack.remove"})),this.bcSet_.remove(At)}find(At){return this.bcSet_.allItems().filter(Mt=>Mt instanceof At)}onSetAdd_(At){this.updatePositions_();const Mt=At.target===At.root;if(this.emitter.emit("add",{bladeController:At.item,index:At.index,isRoot:Mt,sender:this}),!Mt)return;const zt=At.item;if(zt.viewProps.emitter.on("change",this.onChildViewPropsChange_),zt.blade.value("positions").emitter.on("change",this.onChildPositionsChange_),zt.viewProps.handleDispose(this.onChildDispose_),zt instanceof En)zt.binding.emitter.on("change",this.onChildInputChange_);else if(zt instanceof wn)zt.binding.emitter.on("update",this.onChildMonitorUpdate_);else if(zt instanceof jr)zt.value.emitter.on("change",this.onChildValueChange_);else{const ir=zs(zt);if(ir){const mr=ir.emitter;mr.on("layout",this.onDescendantLayout_),mr.on("inputchange",this.onDescendantInputChange_),mr.on("monitorupdate",this.onDescendantMonitorUpdate_)}}}onSetRemove_(At){this.updatePositions_();const Mt=At.target===At.root;if(this.emitter.emit("remove",{bladeController:At.item,isRoot:Mt,sender:this}),!Mt)return;const zt=At.item;if(zt instanceof En)zt.binding.emitter.off("change",this.onChildInputChange_);else if(zt instanceof wn)zt.binding.emitter.off("update",this.onChildMonitorUpdate_);else if(zt instanceof jr)zt.value.emitter.off("change",this.onChildValueChange_);else{const ir=zs(zt);if(ir){const mr=ir.emitter;mr.off("layout",this.onDescendantLayout_),mr.off("inputchange",this.onDescendantInputChange_),mr.off("monitorupdate",this.onDescendantMonitorUpdate_)}}}updatePositions_(){const At=this.bcSet_.items.filter(ir=>!ir.viewProps.get("hidden")),Mt=At[0],zt=At[At.length-1];this.bcSet_.items.forEach(ir=>{const mr=[];ir===Mt&&(mr.push("first"),this.blade_&&!this.blade_.get("positions").includes("veryfirst")||mr.push("veryfirst")),ir===zt&&(mr.push("last"),this.blade_&&!this.blade_.get("positions").includes("verylast")||mr.push("verylast")),ir.blade.set("positions",mr)})}onChildPositionsChange_(){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildViewPropsChange_(At){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildDispose_(){this.bcSet_.items.filter(At=>At.viewProps.get("disposed")).forEach(At=>{this.bcSet_.remove(At)})}onChildInputChange_(At){const Mt=function(zt,ir){for(let mr=0;mr<zt.length;mr++){const Sr=zt[mr];if(Sr instanceof En&&Sr.binding===ir)return Sr}return null}(this.find(En),At.sender);if(!Mt)throw _t.alreadyDisposed();this.emitter.emit("inputchange",{bladeController:Mt,options:At.options,sender:this})}onChildMonitorUpdate_(At){const Mt=function(zt,ir){for(let mr=0;mr<zt.length;mr++){const Sr=zt[mr];if(Sr instanceof wn&&Sr.binding===ir)return Sr}return null}(this.find(wn),At.sender);if(!Mt)throw _t.alreadyDisposed();this.emitter.emit("monitorupdate",{bladeController:Mt,sender:this})}onChildValueChange_(At){const Mt=function(zt,ir){for(let mr=0;mr<zt.length;mr++){const Sr=zt[mr];if(Sr instanceof jr&&Sr.value===ir)return Sr}return null}(this.find(jr),At.sender);if(!Mt)throw _t.alreadyDisposed();this.emitter.emit("inputchange",{bladeController:Mt,options:At.options,sender:this})}onDescendantLayout_(At){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onDescendantInputChange_(At){this.emitter.emit("inputchange",{bladeController:At.bladeController,options:At.options,sender:this})}onDescendantMonitorUpdate_(At){this.emitter.emit("monitorupdate",{bladeController:At.bladeController,sender:this})}onBladePositionsChange_(){this.updatePositions_()}}class eo extends dr{constructor(At,Mt){super(Object.assign(Object.assign({},Mt),{view:new Kn(At,{viewName:"brk",viewProps:Mt.viewProps})})),this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this);const zt=new qs({blade:Mt.root?void 0:Mt.blade,viewProps:Mt.viewProps});zt.emitter.on("add",this.onRackAdd_),zt.emitter.on("remove",this.onRackRemove_),this.rack=zt,this.viewProps.handleDispose(()=>{for(let ir=this.rack.children.length-1;ir>=0;ir--)this.rack.children[ir].viewProps.set("disposed",!0)})}onRackAdd_(At){At.isRoot&&Gn(this.view.element,At.bladeController.view.element,At.index)}onRackRemove_(At){At.isRoot&&ms(At.bladeController.view.element)}}const To=wt("cnt");class tp{constructor(At,Mt){var zt;this.className_=wt((zt=Mt.viewName)!==null&&zt!==void 0?zt:"fld"),this.element=At.createElement("div"),this.element.classList.add(this.className_(),To()),Mt.viewProps.bindClassModifiers(this.element),this.foldable_=Mt.foldable,this.foldable_.bindExpandedClass(this.element,this.className_(void 0,"expanded")),kt(this.foldable_,"completed",Gt(this.element,this.className_(void 0,"cpl")));const ir=At.createElement("button");ir.classList.add(this.className_("b")),kt(Mt.props,"title",zn=>{nt(zn)?this.element.classList.add(this.className_(void 0,"not")):this.element.classList.remove(this.className_(void 0,"not"))}),Mt.viewProps.bindDisabled(ir),this.element.appendChild(ir),this.buttonElement=ir;const mr=At.createElement("div");mr.classList.add(this.className_("i")),this.element.appendChild(mr);const Sr=At.createElement("div");Sr.classList.add(this.className_("t")),Dt(Mt.props.value("title"),Sr),this.buttonElement.appendChild(Sr),this.titleElement=Sr;const Wr=At.createElement("div");Wr.classList.add(this.className_("m")),this.buttonElement.appendChild(Wr);const _n=Mt.containerElement;_n.classList.add(this.className_("c")),this.element.appendChild(_n),this.containerElement=_n}}class po extends $n{constructor(At,Mt){var zt;const ir=rn.create((zt=Mt.expanded)===null||zt===void 0||zt),mr=new eo(At,{blade:Mt.blade,root:Mt.root,viewProps:Mt.viewProps});super(Object.assign(Object.assign({},Mt),{rackController:mr,view:new tp(At,{containerElement:mr.view.element,foldable:ir,props:Mt.props,viewName:Mt.root?"rot":void 0,viewProps:Mt.viewProps})})),this.onTitleClick_=this.onTitleClick_.bind(this),this.props=Mt.props,this.foldable=ir,bn(this.foldable,this.view.containerElement),this.rackController.rack.emitter.on("add",()=>{this.foldable.cleanUpTransition()}),this.rackController.rack.emitter.on("remove",()=>{this.foldable.cleanUpTransition()}),this.view.buttonElement.addEventListener("click",this.onTitleClick_)}get document(){return this.view.element.ownerDocument}onTitleClick_(){this.foldable.set("expanded",!this.foldable.get("expanded"))}}const to={id:"folder",type:"blade",accept(jt){const At=pr,Mt=hr(jt,{title:At.required.string,view:At.required.constant("folder"),expanded:At.optional.boolean});return Mt?{params:Mt}:null},controller(jt){return new po(jt.document,{blade:jt.blade,expanded:jt.params.expanded,props:rr.fromObject({title:jt.params.title}),viewProps:jt.viewProps})},api(jt){return jt.controller instanceof po?new jn(jt.controller,jt.pool):null}};class ba extends jr{constructor(At,Mt){const zt=Mt.valueController.viewProps;super(Object.assign(Object.assign({},Mt),{value:Mt.valueController.value,view:new Ur(At,{props:Mt.props,viewProps:zt}),viewProps:zt})),this.props=Mt.props,this.valueController=Mt.valueController,this.view.valueElement.appendChild(this.valueController.view.element)}}class ro extends d{}const Tl=wt("spr");class Rn{constructor(At,Mt){this.element=At.createElement("div"),this.element.classList.add(Tl()),Mt.viewProps.bindClassModifiers(this.element);const zt=At.createElement("hr");zt.classList.add(Tl("r")),this.element.appendChild(zt)}}class On extends dr{constructor(At,Mt){super(Object.assign(Object.assign({},Mt),{view:new Rn(At,{viewProps:Mt.viewProps})}))}}const io={id:"separator",type:"blade",accept(jt){const At=hr(jt,{view:pr.required.constant("separator")});return At?{params:At}:null},controller(jt){return new On(jt.document,{blade:jt.blade,viewProps:jt.viewProps})},api(jt){return jt.controller instanceof On?new ro(jt.controller):null}},Es=wt("tbi");class Ml{constructor(At,Mt){this.element=At.createElement("div"),this.element.classList.add(Es()),Mt.viewProps.bindClassModifiers(this.element),kt(Mt.props,"selected",mr=>{mr?this.element.classList.add(Es(void 0,"sel")):this.element.classList.remove(Es(void 0,"sel"))});const zt=At.createElement("button");zt.classList.add(Es("b")),Mt.viewProps.bindDisabled(zt),this.element.appendChild(zt),this.buttonElement=zt;const ir=At.createElement("div");ir.classList.add(Es("t")),Dt(Mt.props.value("title"),ir),this.buttonElement.appendChild(ir),this.titleElement=ir}}class ho{constructor(At,Mt){this.emitter=new xt,this.onClick_=this.onClick_.bind(this),this.props=Mt.props,this.viewProps=Mt.viewProps,this.view=new Ml(At,{props:Mt.props,viewProps:Mt.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}}class Qs{constructor(At,Mt){this.onItemClick_=this.onItemClick_.bind(this),this.ic_=new ho(At,{props:Mt.itemProps,viewProps:kr.create()}),this.ic_.emitter.on("click",this.onItemClick_),this.cc_=new eo(At,{blade:en(),viewProps:kr.create()}),this.props=Mt.props,kt(this.props,"selected",zt=>{this.itemController.props.set("selected",zt),this.contentController.viewProps.set("hidden",!zt)})}get itemController(){return this.ic_}get contentController(){return this.cc_}onItemClick_(){this.props.set("selected",!0)}}class xs{constructor(At,Mt){this.controller_=At,this.rackApi_=Mt}get title(){var At;return(At=this.controller_.itemController.props.get("title"))!==null&&At!==void 0?At:""}set title(At){this.controller_.itemController.props.set("title",At)}get selected(){return this.controller_.props.get("selected")}set selected(At){this.controller_.props.set("selected",At)}get children(){return this.rackApi_.children}addButton(At){return this.rackApi_.addButton(At)}addFolder(At){return this.rackApi_.addFolder(At)}addSeparator(At){return this.rackApi_.addSeparator(At)}addTab(At){return this.rackApi_.addTab(At)}add(At,Mt){this.rackApi_.add(At,Mt)}remove(At){this.rackApi_.remove(At)}addInput(At,Mt,zt){return this.rackApi_.addInput(At,Mt,zt)}addMonitor(At,Mt,zt){return this.rackApi_.addMonitor(At,Mt,zt)}addBlade(At){return this.rackApi_.addBlade(At)}}class Cs extends Tn{constructor(At,Mt){super(At,new Qn(At.rackController,Mt)),this.onPageAdd_=this.onPageAdd_.bind(this),this.onPageRemove_=this.onPageRemove_.bind(this),this.onSelect_=this.onSelect_.bind(this),this.emitter_=new xt,this.pageApiMap_=new Map,this.rackApi_.on("change",zt=>{this.emitter_.emit("change",{event:zt})}),this.rackApi_.on("update",zt=>{this.emitter_.emit("update",{event:zt})}),this.controller_.tab.selectedIndex.emitter.on("change",this.onSelect_),this.controller_.pageSet.emitter.on("add",this.onPageAdd_),this.controller_.pageSet.emitter.on("remove",this.onPageRemove_),this.controller_.pageSet.items.forEach(zt=>{this.setUpPageApi_(zt)})}get pages(){return this.controller_.pageSet.items.map(At=>{const Mt=this.pageApiMap_.get(At);if(!Mt)throw _t.shouldNeverHappen();return Mt})}addPage(At){const Mt=this.controller_.view.element.ownerDocument,zt=new Qs(Mt,{itemProps:rr.fromObject({selected:!1,title:At.title}),props:rr.fromObject({selected:!1})});this.controller_.add(zt,At.index);const ir=this.pageApiMap_.get(zt);if(!ir)throw _t.shouldNeverHappen();return ir}removePage(At){this.controller_.remove(At)}on(At,Mt){const zt=Mt.bind(this);return this.emitter_.on(At,ir=>{zt(ir.event)}),this}setUpPageApi_(At){const Mt=this.rackApi_.apiSet_.find(ir=>ir.controller_===At.contentController);if(!Mt)throw _t.shouldNeverHappen();const zt=new xs(At,Mt);this.pageApiMap_.set(At,zt)}onPageAdd_(At){this.setUpPageApi_(At.item)}onPageRemove_(At){if(!this.pageApiMap_.get(At.item))throw _t.shouldNeverHappen();this.pageApiMap_.delete(At.item)}onSelect_(At){this.emitter_.emit("select",{event:new it(this,At.rawValue)})}}class No{constructor(){this.onItemSelectedChange_=this.onItemSelectedChange_.bind(this),this.empty=nr(!0),this.selectedIndex=nr(-1),this.items_=[]}add(At,Mt){const zt=Mt??this.items_.length;this.items_.splice(zt,0,At),At.emitter.on("change",this.onItemSelectedChange_),this.keepSelection_()}remove(At){const Mt=this.items_.indexOf(At);Mt<0||(this.items_.splice(Mt,1),At.emitter.off("change",this.onItemSelectedChange_),this.keepSelection_())}keepSelection_(){if(this.items_.length===0)return this.selectedIndex.rawValue=-1,void(this.empty.rawValue=!0);const At=this.items_.findIndex(Mt=>Mt.rawValue);At<0?(this.items_.forEach((Mt,zt)=>{Mt.rawValue=zt===0}),this.selectedIndex.rawValue=0):(this.items_.forEach((Mt,zt)=>{Mt.rawValue=zt===At}),this.selectedIndex.rawValue=At),this.empty.rawValue=!1}onItemSelectedChange_(At){if(At.rawValue){const Mt=this.items_.findIndex(zt=>zt===At.sender);this.items_.forEach((zt,ir)=>{zt.rawValue=ir===Mt}),this.selectedIndex.rawValue=Mt}else this.keepSelection_()}}const Mo=wt("tab");class bo{constructor(At,Mt){this.element=At.createElement("div"),this.element.classList.add(Mo(),To()),Mt.viewProps.bindClassModifiers(this.element),Rt(Mt.empty,Gt(this.element,Mo(void 0,"nop")));const zt=At.createElement("div");zt.classList.add(Mo("t")),this.element.appendChild(zt),this.itemsElement=zt;const ir=At.createElement("div");ir.classList.add(Mo("i")),this.element.appendChild(ir);const mr=Mt.contentsElement;mr.classList.add(Mo("c")),this.element.appendChild(mr),this.contentsElement=mr}}class _l extends $n{constructor(At,Mt){const zt=new eo(At,{blade:Mt.blade,viewProps:Mt.viewProps}),ir=new No;super({blade:Mt.blade,rackController:zt,view:new bo(At,{contentsElement:zt.view.element,empty:ir.empty,viewProps:Mt.viewProps})}),this.onPageAdd_=this.onPageAdd_.bind(this),this.onPageRemove_=this.onPageRemove_.bind(this),this.pageSet_=new xn(()=>null),this.pageSet_.emitter.on("add",this.onPageAdd_),this.pageSet_.emitter.on("remove",this.onPageRemove_),this.tab=ir}get pageSet(){return this.pageSet_}add(At,Mt){this.pageSet_.add(At,Mt)}remove(At){this.pageSet_.remove(this.pageSet_.items[At])}onPageAdd_(At){const Mt=At.item;Gn(this.view.itemsElement,Mt.itemController.view.element,At.index),Mt.itemController.viewProps.set("parent",this.viewProps),this.rackController.rack.add(Mt.contentController,At.index),this.tab.add(Mt.props.value("selected"))}onPageRemove_(At){const Mt=At.item;ms(Mt.itemController.view.element),Mt.itemController.viewProps.set("parent",null),this.rackController.rack.remove(Mt.contentController),this.tab.remove(Mt.props.value("selected"))}}const rp={id:"tab",type:"blade",accept(jt){const At=pr,Mt=hr(jt,{pages:At.required.array(At.required.object({title:At.required.string})),view:At.required.constant("tab")});return Mt&&Mt.pages.length!==0?{params:Mt}:null},controller(jt){const At=new _l(jt.document,{blade:jt.blade,viewProps:jt.viewProps});return jt.params.pages.forEach(Mt=>{const zt=new Qs(jt.document,{itemProps:rr.fromObject({selected:!1,title:Mt.title}),props:rr.fromObject({selected:!1})});At.add(zt)}),At},api(jt){return jt.controller instanceof _l?new Cs(jt.controller,jt.pool):null}};class Up{constructor(){this.disabled=!1,this.emitter=new xt}dispose(){}tick(){this.disabled||this.emitter.emit("tick",{sender:this})}}class jp{constructor(At,Mt){this.disabled_=!1,this.timerId_=null,this.onTick_=this.onTick_.bind(this),this.doc_=At,this.emitter=new xt,this.interval_=Mt,this.setTimer_()}get disabled(){return this.disabled_}set disabled(At){this.disabled_=At,this.disabled_?this.clearTimer_():this.setTimer_()}dispose(){this.clearTimer_()}clearTimer_(){if(this.timerId_===null)return;const At=this.doc_.defaultView;At&&At.clearInterval(this.timerId_),this.timerId_=null}setTimer_(){if(this.clearTimer_(),this.interval_<=0)return;const At=this.doc_.defaultView;At&&(this.timerId_=At.setInterval(this.onTick_,this.interval_))}onTick_(){this.disabled_||this.emitter.emit("tick",{sender:this})}}class Dm{constructor(At){this.onValueChange_=this.onValueChange_.bind(this),this.reader=At.reader,this.writer=At.writer,this.emitter=new xt,this.value=At.value,this.value.emitter.on("change",this.onValueChange_),this.target=At.target,this.read()}read(){const At=this.target.read();At!==void 0&&(this.value.rawValue=this.reader(At))}write_(At){this.writer(this.target,At)}onValueChange_(At){this.write_(At.rawValue),this.emitter.emit("change",{options:At.options,rawValue:At.rawValue,sender:this})}}function Gp(jt,At){for(;jt.length<At;)jt.push(void 0)}function Bm(jt){const At=[];return Gp(At,jt),nr(At)}function Lm(jt){const At=jt.indexOf(void 0);return At<0?jt:jt.slice(0,At)}class z_{constructor(At){this.onTick_=this.onTick_.bind(this),this.reader_=At.reader,this.target=At.target,this.emitter=new xt,this.value=At.value,this.ticker=At.ticker,this.ticker.emitter.on("tick",this.onTick_),this.read()}dispose(){this.ticker.dispose()}read(){const At=this.target.read();if(At===void 0)return;const Mt=this.value.rawValue,zt=this.reader_(At);this.value.rawValue=function(ir,mr){const Sr=[...Lm(ir),mr];return Sr.length>ir.length?Sr.splice(0,Sr.length-ir.length):Gp(Sr,ir.length),Sr}(Mt,zt),this.emitter.emit("update",{rawValue:zt,sender:this})}onTick_(At){this.read()}}class iu{constructor(At){this.constraints=At}constrain(At){return this.constraints.reduce((Mt,zt)=>zt.constrain(Mt),At)}}function Ho(jt,At){if(jt instanceof At)return jt;if(jt instanceof iu){const Mt=jt.constraints.reduce((zt,ir)=>zt||(ir instanceof At?ir:null),null);if(Mt)return Mt}return null}class Vl{constructor(At){this.values=rr.fromObject({max:At.max,min:At.min})}constrain(At){const Mt=this.values.get("max"),zt=this.values.get("min");return Math.min(Math.max(At,zt),Mt)}}class nu{constructor(At){this.values=rr.fromObject({options:At})}get options(){return this.values.get("options")}constrain(At){const Mt=this.values.get("options");return Mt.length===0||Mt.filter(zt=>zt.value===At).length>0?At:Mt[0].value}}class zp{constructor(At){this.values=rr.fromObject({max:At.max,min:At.min})}get maxValue(){return this.values.get("max")}get minValue(){return this.values.get("min")}constrain(At){const Mt=this.values.get("max"),zt=this.values.get("min");let ir=At;return nt(zt)||(ir=Math.max(ir,zt)),nt(Mt)||(ir=Math.min(ir,Mt)),ir}}class Su{constructor(At,Mt=0){this.step=At,this.origin=Mt}constrain(At){const Mt=this.origin%this.step;return Mt+Math.round((At-Mt)/this.step)*this.step}}const ip=wt("lst");class Om{constructor(At,Mt){this.onValueChange_=this.onValueChange_.bind(this),this.props_=Mt.props,this.element=At.createElement("div"),this.element.classList.add(ip()),Mt.viewProps.bindClassModifiers(this.element);const zt=At.createElement("select");zt.classList.add(ip("s")),Mt.viewProps.bindDisabled(zt),this.element.appendChild(zt),this.selectElement=zt;const ir=At.createElement("div");ir.classList.add(ip("m")),ir.appendChild(vn(At,"dropdown")),this.element.appendChild(ir),Mt.value.emitter.on("change",this.onValueChange_),this.value_=Mt.value,kt(this.props_,"options",mr=>{ar(this.selectElement),mr.forEach(Sr=>{const Wr=At.createElement("option");Wr.textContent=Sr.text,this.selectElement.appendChild(Wr)}),this.update_()})}update_(){const At=this.props_.get("options").map(Mt=>Mt.value);this.selectElement.selectedIndex=At.indexOf(this.value_.rawValue)}onValueChange_(){this.update_()}}class su{constructor(At,Mt){this.onSelectChange_=this.onSelectChange_.bind(this),this.props=Mt.props,this.value=Mt.value,this.viewProps=Mt.viewProps,this.view=new Om(At,{props:this.props,value:this.value,viewProps:this.viewProps}),this.view.selectElement.addEventListener("change",this.onSelectChange_)}onSelectChange_(At){const Mt=At.currentTarget;this.value.rawValue=this.props.get("options")[Mt.selectedIndex].value}}const Vp=wt("pop");class Nm{constructor(At,Mt){this.element=At.createElement("div"),this.element.classList.add(Vp()),Mt.viewProps.bindClassModifiers(this.element),Rt(Mt.shows,Gt(this.element,Vp(void 0,"v")))}}class Hp{constructor(At,Mt){this.shows=nr(!1),this.viewProps=Mt.viewProps,this.view=new Nm(At,{shows:this.shows,viewProps:this.viewProps})}}const Qp=wt("txt");class Fm{constructor(At,Mt){this.onChange_=this.onChange_.bind(this),this.element=At.createElement("div"),this.element.classList.add(Qp()),Mt.viewProps.bindClassModifiers(this.element),this.props_=Mt.props,this.props_.emitter.on("change",this.onChange_);const zt=At.createElement("input");zt.classList.add(Qp("i")),zt.type="text",Mt.viewProps.bindDisabled(zt),this.element.appendChild(zt),this.inputElement=zt,Mt.value.emitter.on("change",this.onChange_),this.value_=Mt.value,this.refresh()}refresh(){const At=this.props_.get("formatter");this.inputElement.value=At(this.value_.rawValue)}onChange_(){this.refresh()}}class Cu{constructor(At,Mt){this.onInputChange_=this.onInputChange_.bind(this),this.parser_=Mt.parser,this.props=Mt.props,this.value=Mt.value,this.viewProps=Mt.viewProps,this.view=new Fm(At,{props:Mt.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(At){const Mt=At.currentTarget.value,zt=this.parser_(Mt);nt(zt)||(this.value.rawValue=zt),this.view.refresh()}}function Wp(jt){return jt!=="false"&&!!jt}function np(jt){return function(At){return String(At)}(jt)}class Um{constructor(At){this.text=At}evaluate(){return Number(this.text)}toString(){return this.text}}const jm={"**":(jt,At)=>Math.pow(jt,At),"*":(jt,At)=>jt*At,"/":(jt,At)=>jt/At,"%":(jt,At)=>jt%At,"+":(jt,At)=>jt+At,"-":(jt,At)=>jt-At,"<<":(jt,At)=>jt<<At,">>":(jt,At)=>jt>>At,">>>":(jt,At)=>jt>>>At,"&":(jt,At)=>jt&At,"^":(jt,At)=>jt^At,"|":(jt,At)=>jt|At};class V_{constructor(At,Mt,zt){this.left=Mt,this.operator=At,this.right=zt}evaluate(){const At=jm[this.operator];if(!At)throw new Error(`unexpected binary operator: '${this.operator}`);return At(this.left.evaluate(),this.right.evaluate())}toString(){return["b(",this.left.toString(),this.operator,this.right.toString(),")"].join(" ")}}const Gm={"+":jt=>jt,"-":jt=>-jt,"~":jt=>~jt};class zm{constructor(At,Mt){this.operator=At,this.expression=Mt}evaluate(){const At=Gm[this.operator];if(!At)throw new Error(`unexpected unary operator: '${this.operator}`);return At(this.expression.evaluate())}toString(){return["u(",this.operator,this.expression.toString(),")"].join(" ")}}function sp(jt){return(At,Mt)=>{for(let zt=0;zt<jt.length;zt++){const ir=jt[zt](At,Mt);if(ir!=="")return ir}return""}}function Pu(jt,At){var Mt;const zt=jt.substr(At).match(/^\s+/);return(Mt=zt&&zt[0])!==null&&Mt!==void 0?Mt:""}function Tu(jt,At){var Mt;const zt=jt.substr(At).match(/^[0-9]+/);return(Mt=zt&&zt[0])!==null&&Mt!==void 0?Mt:""}function qp(jt,At){const Mt=jt.substr(At,1);if(At+=1,Mt.toLowerCase()!=="e")return"";const zt=function(ir,mr){const Sr=Tu(ir,mr);if(Sr!=="")return Sr;const Wr=ir.substr(mr,1);if(Wr!=="-"&&Wr!=="+")return"";const _n=Tu(ir,mr+=1);return _n===""?"":Wr+_n}(jt,At);return zt===""?"":Mt+zt}function Mu(jt,At){const Mt=jt.substr(At,1);if(Mt==="0")return Mt;const zt=function(ir,mr){const Sr=ir.substr(mr,1);return Sr.match(/^[1-9]$/)?Sr:""}(jt,At);return At+=zt.length,zt===""?"":zt+Tu(jt,At)}const ap=sp([function(jt,At){const Mt=Mu(jt,At);if(At+=Mt.length,Mt==="")return"";const zt=jt.substr(At,1);if(At+=zt.length,zt!==".")return"";const ir=Tu(jt,At);return Mt+zt+ir+qp(jt,At+=ir.length)},function(jt,At){const Mt=jt.substr(At,1);if(At+=Mt.length,Mt!==".")return"";const zt=Tu(jt,At);return At+=zt.length,zt===""?"":Mt+zt+qp(jt,At)},function(jt,At){const Mt=Mu(jt,At);return At+=Mt.length,Mt===""?"":Mt+qp(jt,At)}]),$p=sp([function(jt,At){const Mt=jt.substr(At,2);if(At+=Mt.length,Mt.toLowerCase()!=="0b")return"";const zt=function(ir,mr){var Sr;const Wr=ir.substr(mr).match(/^[01]+/);return(Sr=Wr&&Wr[0])!==null&&Sr!==void 0?Sr:""}(jt,At);return zt===""?"":Mt+zt},function(jt,At){const Mt=jt.substr(At,2);if(At+=Mt.length,Mt.toLowerCase()!=="0o")return"";const zt=function(ir,mr){var Sr;const Wr=ir.substr(mr).match(/^[0-7]+/);return(Sr=Wr&&Wr[0])!==null&&Sr!==void 0?Sr:""}(jt,At);return zt===""?"":Mt+zt},function(jt,At){const Mt=jt.substr(At,2);if(At+=Mt.length,Mt.toLowerCase()!=="0x")return"";const zt=function(ir,mr){var Sr;const Wr=ir.substr(mr).match(/^[0-9a-f]+/i);return(Sr=Wr&&Wr[0])!==null&&Sr!==void 0?Sr:""}(jt,At);return zt===""?"":Mt+zt}]),au=sp([$p,ap]);function ou(jt,At){var Mt;return(Mt=function(zt,ir){const mr=au(zt,ir);return ir+=mr.length,mr===""?null:{evaluable:new Um(mr),cursor:ir}}(jt,At))!==null&&Mt!==void 0?Mt:function(zt,ir){const mr=zt.substr(ir,1);if(ir+=mr.length,mr!=="(")return null;const Sr=Xp(zt,ir);if(!Sr)return null;ir=Sr.cursor,ir+=Pu(zt,ir).length;const Wr=zt.substr(ir,1);return ir+=Wr.length,Wr!==")"?null:{evaluable:Sr.evaluable,cursor:ir}}(jt,At)}function op(jt,At,Mt){Mt+=Pu(At,Mt).length;const zt=jt.filter(ir=>At.startsWith(ir,Mt))[0];return zt?(Mt+=zt.length,{cursor:Mt+=Pu(At,Mt).length,operator:zt}):null}const Vm=[["**"],["*","/","%"],["+","-"],["<<",">>>",">>"],["&"],["^"],["|"]].reduce((jt,At)=>function(Mt,zt){return(ir,mr)=>{const Sr=Mt(ir,mr);if(!Sr)return null;mr=Sr.cursor;let Wr=Sr.evaluable;for(;;){const _n=op(zt,ir,mr);if(!_n)break;mr=_n.cursor;const zn=Mt(ir,mr);if(!zn)return null;mr=zn.cursor,Wr=new V_(_n.operator,Wr,zn.evaluable)}return Wr?{cursor:mr,evaluable:Wr}:null}}(jt,At),function jt(At,Mt){const zt=ou(At,Mt);if(zt)return zt;const ir=At.substr(Mt,1);if(Mt+=ir.length,ir!=="+"&&ir!=="-"&&ir!=="~")return null;const mr=jt(At,Mt);return mr?{cursor:Mt=mr.cursor,evaluable:new zm(ir,mr.evaluable)}:null});function Xp(jt,At){return At+=Pu(jt,At).length,Vm(jt,At)}function Il(jt){var At;const Mt=function(zt){const ir=Xp(zt,0);return ir?ir.cursor+Pu(zt,ir.cursor).length!==zt.length?null:ir.evaluable:null}(jt);return(At=Mt==null?void 0:Mt.evaluate())!==null&&At!==void 0?At:null}function H_(jt){if(typeof jt=="number")return jt;if(typeof jt=="string"){const At=Il(jt);if(!nt(At))return At}return 0}function A0(jt){return String(jt)}function Ys(jt){return At=>At.toFixed(Math.max(Math.min(jt,20),0))}const Rl=Ys(0);function lp(jt){return Rl(jt)+"%"}function Hm(jt){return String(jt)}function yl(jt){return jt}function Iu({primary:jt,secondary:At,forward:Mt,backward:zt}){let ir=!1;function mr(Sr){ir||(ir=!0,Sr(),ir=!1)}jt.emitter.on("change",Sr=>{mr(()=>{At.setRawValue(Mt(jt,At),Sr.options)})}),At.emitter.on("change",Sr=>{mr(()=>{jt.setRawValue(zt(jt,At),Sr.options)}),mr(()=>{At.setRawValue(Mt(jt,At),Sr.options)})}),mr(()=>{At.setRawValue(Mt(jt,At),{forceEmit:!1,last:!0})})}function ks(jt,At){const Mt=jt*(At.altKey?.1:1)*(At.shiftKey?10:1);return At.upKey?+Mt:At.downKey?-Mt:0}function Os(jt){return{altKey:jt.altKey,downKey:jt.key==="ArrowDown",shiftKey:jt.shiftKey,upKey:jt.key==="ArrowUp"}}function Ws(jt){return{altKey:jt.altKey,downKey:jt.key==="ArrowLeft",shiftKey:jt.shiftKey,upKey:jt.key==="ArrowRight"}}function cp(jt){return function(At){return At==="ArrowUp"||At==="ArrowDown"}(jt)||jt==="ArrowLeft"||jt==="ArrowRight"}function lu(jt,At){var Mt,zt;const ir=At.ownerDocument.defaultView,mr=At.getBoundingClientRect();return{x:jt.pageX-(((Mt=ir&&ir.scrollX)!==null&&Mt!==void 0?Mt:0)+mr.left),y:jt.pageY-(((zt=ir&&ir.scrollY)!==null&&zt!==void 0?zt:0)+mr.top)}}class no{constructor(At){this.lastTouch_=null,this.onDocumentMouseMove_=this.onDocumentMouseMove_.bind(this),this.onDocumentMouseUp_=this.onDocumentMouseUp_.bind(this),this.onMouseDown_=this.onMouseDown_.bind(this),this.onTouchEnd_=this.onTouchEnd_.bind(this),this.onTouchMove_=this.onTouchMove_.bind(this),this.onTouchStart_=this.onTouchStart_.bind(this),this.elem_=At,this.emitter=new xt,At.addEventListener("touchstart",this.onTouchStart_,{passive:!1}),At.addEventListener("touchmove",this.onTouchMove_,{passive:!0}),At.addEventListener("touchend",this.onTouchEnd_),At.addEventListener("mousedown",this.onMouseDown_)}computePosition_(At){const Mt=this.elem_.getBoundingClientRect();return{bounds:{width:Mt.width,height:Mt.height},point:At?{x:At.x,y:At.y}:null}}onMouseDown_(At){var Mt;At.preventDefault(),(Mt=At.currentTarget)===null||Mt===void 0||Mt.focus();const zt=this.elem_.ownerDocument;zt.addEventListener("mousemove",this.onDocumentMouseMove_),zt.addEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("down",{altKey:At.altKey,data:this.computePosition_(lu(At,this.elem_)),sender:this,shiftKey:At.shiftKey})}onDocumentMouseMove_(At){this.emitter.emit("move",{altKey:At.altKey,data:this.computePosition_(lu(At,this.elem_)),sender:this,shiftKey:At.shiftKey})}onDocumentMouseUp_(At){const Mt=this.elem_.ownerDocument;Mt.removeEventListener("mousemove",this.onDocumentMouseMove_),Mt.removeEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("up",{altKey:At.altKey,data:this.computePosition_(lu(At,this.elem_)),sender:this,shiftKey:At.shiftKey})}onTouchStart_(At){At.preventDefault();const Mt=At.targetTouches.item(0),zt=this.elem_.getBoundingClientRect();this.emitter.emit("down",{altKey:At.altKey,data:this.computePosition_(Mt?{x:Mt.clientX-zt.left,y:Mt.clientY-zt.top}:void 0),sender:this,shiftKey:At.shiftKey}),this.lastTouch_=Mt}onTouchMove_(At){const Mt=At.targetTouches.item(0),zt=this.elem_.getBoundingClientRect();this.emitter.emit("move",{altKey:At.altKey,data:this.computePosition_(Mt?{x:Mt.clientX-zt.left,y:Mt.clientY-zt.top}:void 0),sender:this,shiftKey:At.shiftKey}),this.lastTouch_=Mt}onTouchEnd_(At){var Mt;const zt=(Mt=At.targetTouches.item(0))!==null&&Mt!==void 0?Mt:this.lastTouch_,ir=this.elem_.getBoundingClientRect();this.emitter.emit("up",{altKey:At.altKey,data:this.computePosition_(zt?{x:zt.clientX-ir.left,y:zt.clientY-ir.top}:void 0),sender:this,shiftKey:At.shiftKey})}}function Ds(jt,At,Mt,zt,ir){return zt+(jt-At)/(Mt-At)*(ir-zt)}function Ns(jt){return String(jt.toFixed(10)).split(".")[1].replace(/0+$/,"").length}function Vs(jt,At,Mt){return Math.min(Math.max(jt,At),Mt)}function Ru(jt,At){return(jt%At+At)%At}const Fo=wt("txt");class Yp{constructor(At,Mt){this.onChange_=this.onChange_.bind(this),this.props_=Mt.props,this.props_.emitter.on("change",this.onChange_),this.element=At.createElement("div"),this.element.classList.add(Fo(),Fo(void 0,"num")),Mt.arrayPosition&&this.element.classList.add(Fo(void 0,Mt.arrayPosition)),Mt.viewProps.bindClassModifiers(this.element);const zt=At.createElement("input");zt.classList.add(Fo("i")),zt.type="text",Mt.viewProps.bindDisabled(zt),this.element.appendChild(zt),this.inputElement=zt,this.onDraggingChange_=this.onDraggingChange_.bind(this),this.dragging_=Mt.dragging,this.dragging_.emitter.on("change",this.onDraggingChange_),this.element.classList.add(Fo()),this.inputElement.classList.add(Fo("i"));const ir=At.createElement("div");ir.classList.add(Fo("k")),this.element.appendChild(ir),this.knobElement=ir;const mr=At.createElementNS(Ir,"svg");mr.classList.add(Fo("g")),this.knobElement.appendChild(mr);const Sr=At.createElementNS(Ir,"path");Sr.classList.add(Fo("gb")),mr.appendChild(Sr),this.guideBodyElem_=Sr;const Wr=At.createElementNS(Ir,"path");Wr.classList.add(Fo("gh")),mr.appendChild(Wr),this.guideHeadElem_=Wr;const _n=At.createElement("div");_n.classList.add(wt("tt")()),this.knobElement.appendChild(_n),this.tooltipElem_=_n,Mt.value.emitter.on("change",this.onChange_),this.value=Mt.value,this.refresh()}onDraggingChange_(At){if(At.rawValue===null)return void this.element.classList.remove(Fo(void 0,"drg"));this.element.classList.add(Fo(void 0,"drg"));const Mt=At.rawValue/this.props_.get("draggingScale"),zt=Mt+(Mt>0?-1:Mt<0?1:0),ir=Vs(-zt,-4,4);this.guideHeadElem_.setAttributeNS(null,"d",[`M ${zt+ir},0 L${zt},4 L${zt+ir},8`,`M ${Mt},-1 L${Mt},9`].join(" ")),this.guideBodyElem_.setAttributeNS(null,"d",`M 0,4 L${Mt},4`);const mr=this.props_.get("formatter");this.tooltipElem_.textContent=mr(this.value.rawValue),this.tooltipElem_.style.left=`${Mt}px`}refresh(){const At=this.props_.get("formatter");this.inputElement.value=At(this.value.rawValue)}onChange_(){this.refresh()}}class up{constructor(At,Mt){var zt;this.originRawValue_=0,this.onInputChange_=this.onInputChange_.bind(this),this.onInputKeyDown_=this.onInputKeyDown_.bind(this),this.onInputKeyUp_=this.onInputKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.baseStep_=Mt.baseStep,this.parser_=Mt.parser,this.props=Mt.props,this.sliderProps_=(zt=Mt.sliderProps)!==null&&zt!==void 0?zt:null,this.value=Mt.value,this.viewProps=Mt.viewProps,this.dragging_=nr(null),this.view=new Yp(At,{arrayPosition:Mt.arrayPosition,dragging:this.dragging_,props:this.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_),this.view.inputElement.addEventListener("keydown",this.onInputKeyDown_),this.view.inputElement.addEventListener("keyup",this.onInputKeyUp_);const ir=new no(this.view.knobElement);ir.emitter.on("down",this.onPointerDown_),ir.emitter.on("move",this.onPointerMove_),ir.emitter.on("up",this.onPointerUp_)}constrainValue_(At){var Mt,zt;const ir=(Mt=this.sliderProps_)===null||Mt===void 0?void 0:Mt.get("minValue"),mr=(zt=this.sliderProps_)===null||zt===void 0?void 0:zt.get("maxValue");let Sr=At;return ir!==void 0&&(Sr=Math.max(Sr,ir)),mr!==void 0&&(Sr=Math.min(Sr,mr)),Sr}onInputChange_(At){const Mt=At.currentTarget.value,zt=this.parser_(Mt);nt(zt)||(this.value.rawValue=this.constrainValue_(zt)),this.view.refresh()}onInputKeyDown_(At){const Mt=ks(this.baseStep_,Os(At));Mt!==0&&this.value.setRawValue(this.constrainValue_(this.value.rawValue+Mt),{forceEmit:!1,last:!1})}onInputKeyUp_(At){ks(this.baseStep_,Os(At))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}onPointerDown_(){this.originRawValue_=this.value.rawValue,this.dragging_.rawValue=0}computeDraggingValue_(At){if(!At.point)return null;const Mt=At.point.x-At.bounds.width/2;return this.constrainValue_(this.originRawValue_+Mt*this.props.get("draggingScale"))}onPointerMove_(At){const Mt=this.computeDraggingValue_(At.data);Mt!==null&&(this.value.setRawValue(Mt,{forceEmit:!1,last:!1}),this.dragging_.rawValue=this.value.rawValue-this.originRawValue_)}onPointerUp_(At){const Mt=this.computeDraggingValue_(At.data);Mt!==null&&(this.value.setRawValue(Mt,{forceEmit:!0,last:!0}),this.dragging_.rawValue=null)}}const Qm=wt("sld");class E0{constructor(At,Mt){this.onChange_=this.onChange_.bind(this),this.props_=Mt.props,this.props_.emitter.on("change",this.onChange_),this.element=At.createElement("div"),this.element.classList.add(Qm()),Mt.viewProps.bindClassModifiers(this.element);const zt=At.createElement("div");zt.classList.add(Qm("t")),Mt.viewProps.bindTabIndex(zt),this.element.appendChild(zt),this.trackElement=zt;const ir=At.createElement("div");ir.classList.add(Qm("k")),this.trackElement.appendChild(ir),this.knobElement=ir,Mt.value.emitter.on("change",this.onChange_),this.value=Mt.value,this.update_()}update_(){const At=Vs(Ds(this.value.rawValue,this.props_.get("minValue"),this.props_.get("maxValue"),0,100),0,100);this.knobElement.style.width=`${At}%`}onChange_(){this.update_()}}class S0{constructor(At,Mt){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDownOrMove_=this.onPointerDownOrMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.baseStep_=Mt.baseStep,this.value=Mt.value,this.viewProps=Mt.viewProps,this.props=Mt.props,this.view=new E0(At,{props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new no(this.view.trackElement),this.ptHandler_.emitter.on("down",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("move",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.trackElement.addEventListener("keydown",this.onKeyDown_),this.view.trackElement.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(At,Mt){At.point&&this.value.setRawValue(Ds(Vs(At.point.x,0,At.bounds.width),0,At.bounds.width,this.props.get("minValue"),this.props.get("maxValue")),Mt)}onPointerDownOrMove_(At){this.handlePointerEvent_(At.data,{forceEmit:!1,last:!1})}onPointerUp_(At){this.handlePointerEvent_(At.data,{forceEmit:!0,last:!0})}onKeyDown_(At){const Mt=ks(this.baseStep_,Ws(At));Mt!==0&&this.value.setRawValue(this.value.rawValue+Mt,{forceEmit:!1,last:!1})}onKeyUp_(At){ks(this.baseStep_,Ws(At))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const Wm=wt("sldtxt");class C0{constructor(At,Mt){this.element=At.createElement("div"),this.element.classList.add(Wm());const zt=At.createElement("div");zt.classList.add(Wm("s")),this.sliderView_=Mt.sliderView,zt.appendChild(this.sliderView_.element),this.element.appendChild(zt);const ir=At.createElement("div");ir.classList.add(Wm("t")),this.textView_=Mt.textView,ir.appendChild(this.textView_.element),this.element.appendChild(ir)}}class qm{constructor(At,Mt){this.value=Mt.value,this.viewProps=Mt.viewProps,this.sliderC_=new S0(At,{baseStep:Mt.baseStep,props:Mt.sliderProps,value:Mt.value,viewProps:this.viewProps}),this.textC_=new up(At,{baseStep:Mt.baseStep,parser:Mt.parser,props:Mt.textProps,sliderProps:Mt.sliderProps,value:Mt.value,viewProps:Mt.viewProps}),this.view=new C0(At,{sliderView:this.sliderC_.view,textView:this.textC_.view})}get sliderController(){return this.sliderC_}get textController(){return this.textC_}}function pp(jt,At){jt.write(At)}function Kp(jt){const At=pr;return Array.isArray(jt)?At.required.array(At.required.object({text:At.required.string,value:At.required.raw}))(jt).value:typeof jt=="object"?At.required.raw(jt).value:void 0}function Q_(jt){if(jt==="inline"||jt==="popup")return jt}function Hl(jt){const At=pr;return At.required.object({max:At.optional.number,min:At.optional.number,step:At.optional.number})(jt).value}function W_(jt){if(Array.isArray(jt))return jt;const At=[];return Object.keys(jt).forEach(Mt=>{At.push({text:Mt,value:jt[Mt]})}),At}function $m(jt){return nt(jt)?null:new nu(W_(jt))}function hp(jt,At){const Mt=jt&&Ho(jt,Su);return Mt?Ns(Mt.step):Math.max(Ns(At),2)}function cu(jt){return function(Mt){const zt=Mt?Ho(Mt,Su):null;return zt?zt.step:null}(jt)??1}function uu(jt,At){var Mt;const zt=jt&&Ho(jt,Su),ir=Math.abs((Mt=zt==null?void 0:zt.step)!==null&&Mt!==void 0?Mt:At);return ir===0?.1:Math.pow(10,Math.floor(Math.log10(ir))-1)}const dp=wt("ckb");class q_{constructor(At,Mt){this.onValueChange_=this.onValueChange_.bind(this),this.element=At.createElement("div"),this.element.classList.add(dp()),Mt.viewProps.bindClassModifiers(this.element);const zt=At.createElement("label");zt.classList.add(dp("l")),this.element.appendChild(zt);const ir=At.createElement("input");ir.classList.add(dp("i")),ir.type="checkbox",zt.appendChild(ir),this.inputElement=ir,Mt.viewProps.bindDisabled(this.inputElement);const mr=At.createElement("div");mr.classList.add(dp("w")),zt.appendChild(mr);const Sr=vn(At,"check");mr.appendChild(Sr),Mt.value.emitter.on("change",this.onValueChange_),this.value=Mt.value,this.update_()}update_(){this.inputElement.checked=this.value.rawValue}onValueChange_(){this.update_()}}class $_{constructor(At,Mt){this.onInputChange_=this.onInputChange_.bind(this),this.value=Mt.value,this.viewProps=Mt.viewProps,this.view=new q_(At,{value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(At){const Mt=At.currentTarget;this.value.rawValue=Mt.checked}}const X_={id:"input-bool",type:"input",accept:(jt,At)=>{if(typeof jt!="boolean")return null;const Mt=hr(At,{options:pr.optional.custom(Kp)});return Mt?{initialValue:jt,params:Mt}:null},binding:{reader:jt=>Wp,constraint:jt=>function(At){const Mt=[],zt=$m(At.options);return zt&&Mt.push(zt),new iu(Mt)}(jt.params),writer:jt=>pp},controller:jt=>{const At=jt.document,Mt=jt.value,zt=jt.constraint,ir=zt&&Ho(zt,nu);return ir?new su(At,{props:new rr({options:ir.values.value("options")}),value:Mt,viewProps:jt.viewProps}):new $_(At,{value:Mt,viewProps:jt.viewProps})}},Ql=wt("col");class Y_{constructor(At,Mt){this.element=At.createElement("div"),this.element.classList.add(Ql()),Mt.foldable.bindExpandedClass(this.element,Ql(void 0,"expanded")),kt(Mt.foldable,"completed",Gt(this.element,Ql(void 0,"cpl")));const zt=At.createElement("div");zt.classList.add(Ql("h")),this.element.appendChild(zt);const ir=At.createElement("div");ir.classList.add(Ql("s")),zt.appendChild(ir),this.swatchElement=ir;const mr=At.createElement("div");if(mr.classList.add(Ql("t")),zt.appendChild(mr),this.textElement=mr,Mt.pickerLayout==="inline"){const Sr=At.createElement("div");Sr.classList.add(Ql("p")),this.element.appendChild(Sr),this.pickerElement=Sr}else this.pickerElement=null}}function ku(jt,At,Mt){const zt=Ru(jt,360),ir=Vs(At/100,0,1),mr=Vs(Mt/100,0,1),Sr=mr*ir,Wr=Sr*(1-Math.abs(zt/60%2-1)),_n=mr-Sr;let zn,os,Zs;return[zn,os,Zs]=zt>=0&&zt<60?[Sr,Wr,0]:zt>=60&&zt<120?[Wr,Sr,0]:zt>=120&&zt<180?[0,Sr,Wr]:zt>=180&&zt<240?[0,Wr,Sr]:zt>=240&&zt<300?[Wr,0,Sr]:[Sr,0,Wr],[255*(zn+_n),255*(os+_n),255*(Zs+_n)]}function pu(jt){return[jt[0],jt[1],jt[2]]}function K_(jt,At){return[jt[0],jt[1],jt[2],At]}const P0={hsl:{hsl:(jt,At,Mt)=>[jt,At,Mt],hsv:function(jt,At,Mt){const zt=Mt+At*(100-Math.abs(2*Mt-100))/200;return[jt,zt!==0?At*(100-Math.abs(2*Mt-100))/zt:0,Mt+At*(100-Math.abs(2*Mt-100))/200]},rgb:function(jt,At,Mt){const zt=(jt%360+360)%360,ir=Vs(At/100,0,1),mr=Vs(Mt/100,0,1),Sr=(1-Math.abs(2*mr-1))*ir,Wr=Sr*(1-Math.abs(zt/60%2-1)),_n=mr-Sr/2;let zn,os,Zs;return[zn,os,Zs]=zt>=0&&zt<60?[Sr,Wr,0]:zt>=60&&zt<120?[Wr,Sr,0]:zt>=120&&zt<180?[0,Sr,Wr]:zt>=180&&zt<240?[0,Wr,Sr]:zt>=240&&zt<300?[Wr,0,Sr]:[Sr,0,Wr],[255*(zn+_n),255*(os+_n),255*(Zs+_n)]}},hsv:{hsl:function(jt,At,Mt){const zt=100-Math.abs(Mt*(200-At)/100-100);return[jt,zt!==0?At*Mt/zt:0,Mt*(200-At)/200]},hsv:(jt,At,Mt)=>[jt,At,Mt],rgb:ku},rgb:{hsl:function(jt,At,Mt){const zt=Vs(jt/255,0,1),ir=Vs(At/255,0,1),mr=Vs(Mt/255,0,1),Sr=Math.max(zt,ir,mr),Wr=Math.min(zt,ir,mr),_n=Sr-Wr;let zn=0,os=0;const Zs=(Wr+Sr)/2;return _n!==0&&(os=_n/(1-Math.abs(Sr+Wr-1)),zn=zt===Sr?(ir-mr)/_n:ir===Sr?2+(mr-zt)/_n:4+(zt-ir)/_n,zn=zn/6+(zn<0?1:0)),[360*zn,100*os,100*Zs]},hsv:function(jt,At,Mt){const zt=Vs(jt/255,0,1),ir=Vs(At/255,0,1),mr=Vs(Mt/255,0,1),Sr=Math.max(zt,ir,mr),Wr=Sr-Math.min(zt,ir,mr);let _n;return _n=Wr===0?0:Sr===zt?((ir-mr)/Wr%6+6)%6*60:Sr===ir?60*((mr-zt)/Wr+2):60*((zt-ir)/Wr+4),[_n,100*(Sr===0?0:Wr/Sr),100*Sr]},rgb:(jt,At,Mt)=>[jt,At,Mt]}};function Jp(jt,At){return[At==="float"?1:jt==="rgb"?255:360,At==="float"?1:jt==="rgb"?255:100,At==="float"?1:jt==="rgb"?255:100]}function T0(jt,At){return jt===At?At:Ru(jt,At)}function J_(jt,At,Mt,zt){const ir=Jp(At,Mt),mr=Jp(At,zt);return jt.map((Sr,Wr)=>Sr/ir[Wr]*mr[Wr])}function Zp(jt,At){return typeof jt=="object"&&!nt(jt)&&At in jt&&typeof jt[At]=="number"}class gs{static black(At="int"){return new gs([0,0,0],"rgb",At)}static fromObject(At,Mt="int"){const zt="a"in At?[At.r,At.g,At.b,At.a]:[At.r,At.g,At.b];return new gs(zt,"rgb",Mt)}static toRgbaObject(At,Mt="int"){return At.toRgbaObject(Mt)}static isRgbColorObject(At){return Zp(At,"r")&&Zp(At,"g")&&Zp(At,"b")}static isRgbaColorObject(At){return this.isRgbColorObject(At)&&Zp(At,"a")}static isColorObject(At){return this.isRgbColorObject(At)}static equals(At,Mt){if(At.mode!==Mt.mode)return!1;const zt=At.comps_,ir=Mt.comps_;for(let mr=0;mr<zt.length;mr++)if(zt[mr]!==ir[mr])return!1;return!0}constructor(At,Mt,zt="int"){this.mode=Mt,this.type=zt,this.comps_=function(ir,mr,Sr){var Wr;const _n=Jp(mr,Sr);return[mr==="rgb"?Vs(ir[0],0,_n[0]):T0(ir[0],_n[0]),Vs(ir[1],0,_n[1]),Vs(ir[2],0,_n[2]),Vs((Wr=ir[3])!==null&&Wr!==void 0?Wr:1,0,1)]}(At,Mt,zt)}getComponents(At,Mt="int"){return K_(function(zt,ir,mr){const Sr=J_(zt,ir.mode,ir.type,"int");return J_(P0[ir.mode][mr.mode](...Sr),mr.mode,"int",mr.type)}(pu(this.comps_),{mode:this.mode,type:this.type},{mode:At??this.mode,type:Mt}),this.comps_[3])}toRgbaObject(At="int"){const Mt=this.getComponents("rgb",At);return{r:Mt[0],g:Mt[1],b:Mt[2],a:Mt[3]}}}const Wl=wt("colp");class Xm{constructor(At,Mt){this.alphaViews_=null,this.element=At.createElement("div"),this.element.classList.add(Wl()),Mt.viewProps.bindClassModifiers(this.element);const zt=At.createElement("div");zt.classList.add(Wl("hsv"));const ir=At.createElement("div");ir.classList.add(Wl("sv")),this.svPaletteView_=Mt.svPaletteView,ir.appendChild(this.svPaletteView_.element),zt.appendChild(ir);const mr=At.createElement("div");mr.classList.add(Wl("h")),this.hPaletteView_=Mt.hPaletteView,mr.appendChild(this.hPaletteView_.element),zt.appendChild(mr),this.element.appendChild(zt);const Sr=At.createElement("div");if(Sr.classList.add(Wl("rgb")),this.textView_=Mt.textView,Sr.appendChild(this.textView_.element),this.element.appendChild(Sr),Mt.alphaViews){this.alphaViews_={palette:Mt.alphaViews.palette,text:Mt.alphaViews.text};const Wr=At.createElement("div");Wr.classList.add(Wl("a"));const _n=At.createElement("div");_n.classList.add(Wl("ap")),_n.appendChild(this.alphaViews_.palette.element),Wr.appendChild(_n);const zn=At.createElement("div");zn.classList.add(Wl("at")),zn.appendChild(this.alphaViews_.text.element),Wr.appendChild(zn),this.element.appendChild(Wr)}}get allFocusableElements(){const At=[this.svPaletteView_.element,this.hPaletteView_.element,this.textView_.modeSelectElement,...this.textView_.textViews.map(Mt=>Mt.inputElement)];return this.alphaViews_&&At.push(this.alphaViews_.palette.element,this.alphaViews_.text.inputElement),At}}function _h(jt){return jt==="int"?"int":jt==="float"?"float":void 0}function Uo(jt){const At=pr;return hr(jt,{alpha:At.optional.boolean,color:At.optional.object({alpha:At.optional.boolean,type:At.optional.custom(_h)}),expanded:At.optional.boolean,picker:At.optional.custom(Q_)})}function Qo(jt){return jt?.1:1}function mo(jt){var At;return(At=jt.color)===null||At===void 0?void 0:At.type}function Fs(jt,At){const Mt=jt.match(/^(.+)%$/);return Math.min(Mt?.01*parseFloat(Mt[1])*At:parseFloat(jt),At)}const Z_={deg:jt=>jt,grad:jt=>360*jt/400,rad:jt=>360*jt/(2*Math.PI),turn:jt=>360*jt};function $l(jt){const At=jt.match(/^([0-9.]+?)(deg|grad|rad|turn)$/);if(!At)return parseFloat(jt);const Mt=parseFloat(At[1]),zt=At[2];return Z_[zt](Mt)}function hu(jt){const At=jt.match(/^rgb\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!At)return null;const Mt=[Fs(At[1],255),Fs(At[2],255),Fs(At[3],255)];return isNaN(Mt[0])||isNaN(Mt[1])||isNaN(Mt[2])?null:Mt}function xo(jt){return At=>{const Mt=hu(At);return Mt?new gs(Mt,"rgb",jt):null}}function Hs(jt){const At=jt.match(/^rgba\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!At)return null;const Mt=[Fs(At[1],255),Fs(At[2],255),Fs(At[3],255),Fs(At[4],1)];return isNaN(Mt[0])||isNaN(Mt[1])||isNaN(Mt[2])||isNaN(Mt[3])?null:Mt}function _d(jt){return At=>{const Mt=Hs(At);return Mt?new gs(Mt,"rgb",jt):null}}function Du(jt){const At=jt.match(/^hsl\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!At)return null;const Mt=[$l(At[1]),Fs(At[2],100),Fs(At[3],100)];return isNaN(Mt[0])||isNaN(Mt[1])||isNaN(Mt[2])?null:Mt}function em(jt){return At=>{const Mt=Du(At);return Mt?new gs(Mt,"hsl",jt):null}}function Ym(jt){const At=jt.match(/^hsla\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!At)return null;const Mt=[$l(At[1]),Fs(At[2],100),Fs(At[3],100),Fs(At[4],1)];return isNaN(Mt[0])||isNaN(Mt[1])||isNaN(Mt[2])||isNaN(Mt[3])?null:Mt}function mp(jt){return At=>{const Mt=Ym(At);return Mt?new gs(Mt,"hsl",jt):null}}function go(jt){const At=jt.match(/^#([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(At)return[parseInt(At[1]+At[1],16),parseInt(At[2]+At[2],16),parseInt(At[3]+At[3],16)];const Mt=jt.match(/^(?:#|0x)([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return Mt?[parseInt(Mt[1],16),parseInt(Mt[2],16),parseInt(Mt[3],16)]:null}function ns(jt){const At=jt.match(/^#?([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(At)return[parseInt(At[1]+At[1],16),parseInt(At[2]+At[2],16),parseInt(At[3]+At[3],16),Ds(parseInt(At[4]+At[4],16),0,255,0,1)];const Mt=jt.match(/^(?:#|0x)?([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return Mt?[parseInt(Mt[1],16),parseInt(Mt[2],16),parseInt(Mt[3],16),Ds(parseInt(Mt[4],16),0,255,0,1)]:null}function _f(jt){const At=jt.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!At)return null;const Mt=[parseFloat(At[1]),parseFloat(At[2]),parseFloat(At[3])];return isNaN(Mt[0])||isNaN(Mt[1])||isNaN(Mt[2])?null:Mt}function dn(jt){return At=>{const Mt=_f(At);return Mt?new gs(Mt,"rgb",jt):null}}function as(jt){const At=jt.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*a\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!At)return null;const Mt=[parseFloat(At[1]),parseFloat(At[2]),parseFloat(At[3]),parseFloat(At[4])];return isNaN(Mt[0])||isNaN(Mt[1])||isNaN(Mt[2])||isNaN(Mt[3])?null:Mt}function tm(jt){return At=>{const Mt=as(At);return Mt?new gs(Mt,"rgb",jt):null}}const ev=[{parser:go,result:{alpha:!1,mode:"rgb",notation:"hex"}},{parser:ns,result:{alpha:!0,mode:"rgb",notation:"hex"}},{parser:hu,result:{alpha:!1,mode:"rgb",notation:"func"}},{parser:Hs,result:{alpha:!0,mode:"rgb",notation:"func"}},{parser:Du,result:{alpha:!1,mode:"hsl",notation:"func"}},{parser:Ym,result:{alpha:!0,mode:"hsl",notation:"func"}},{parser:_f,result:{alpha:!1,mode:"rgb",notation:"object"}},{parser:as,result:{alpha:!0,mode:"rgb",notation:"object"}}];function Km(jt,At="int"){const Mt=function(zt){return ev.reduce((ir,{parser:mr,result:Sr})=>ir||(mr(zt)?Sr:null),null)}(jt);return Mt?Mt.notation==="hex"&&At!=="float"?Object.assign(Object.assign({},Mt),{type:"int"}):Mt.notation==="func"?Object.assign(Object.assign({},Mt),{type:At}):null:null}const du={int:[function(jt){const At=go(jt);return At?new gs(At,"rgb","int"):null},function(jt){const At=ns(jt);return At?new gs(At,"rgb","int"):null},xo("int"),_d("int"),em("int"),mp("int"),dn("int"),tm("int")],float:[xo("float"),_d("float"),em("float"),mp("float"),dn("float"),tm("float")]};function mu(jt){const At=du[jt];return Mt=>At.reduce((zt,ir)=>zt||ir(Mt),null)}function Jm(jt){const At=Vs(Math.floor(jt),0,255).toString(16);return At.length===1?`0${At}`:At}function Zm(jt,At="#"){return`${At}${pu(jt.getComponents("rgb")).map(Jm).join("")}`}function gu(jt,At="#"){const Mt=jt.getComponents("rgb");return`${At}${[Mt[0],Mt[1],Mt[2],255*Mt[3]].map(Jm).join("")}`}function _g(jt,At){const Mt=Ys(At==="float"?2:0);return`rgb(${pu(jt.getComponents("rgb",At)).map(zt=>Mt(zt)).join(", ")})`}function tv(jt){return At=>_g(At,jt)}function _u(jt,At){const Mt=Ys(2),zt=Ys(At==="float"?2:0);return`rgba(${jt.getComponents("rgb",At).map((ir,mr)=>(mr===3?Mt:zt)(ir)).join(", ")})`}function M0(jt){return At=>_u(At,jt)}function Ms(jt,At){const Mt=Ys(At==="float"?2:0),zt=["r","g","b"];return`{${pu(jt.getComponents("rgb",At)).map((ir,mr)=>`${zt[mr]}: ${Mt(ir)}`).join(", ")}}`}function Bu(jt){return At=>Ms(At,jt)}function rm(jt,At){const Mt=Ys(2),zt=Ys(At==="float"?2:0),ir=["r","g","b","a"];return`{${jt.getComponents("rgb",At).map((mr,Sr)=>`${ir[Sr]}: ${(Sr===3?Mt:zt)(mr)}`).join(", ")}}`}function Lu(jt){return At=>rm(At,jt)}const e_=[{format:{alpha:!1,mode:"rgb",notation:"hex",type:"int"},stringifier:Zm},{format:{alpha:!0,mode:"rgb",notation:"hex",type:"int"},stringifier:gu},{format:{alpha:!1,mode:"hsl",notation:"func",type:"int"},stringifier:function(jt){const At=[Ys(0),lp,lp];return`hsl(${pu(jt.getComponents("hsl")).map((Mt,zt)=>At[zt](Mt)).join(", ")})`}},{format:{alpha:!0,mode:"hsl",notation:"func",type:"int"},stringifier:function(jt){const At=[Ys(0),lp,lp,Ys(2)];return`hsla(${jt.getComponents("hsl").map((Mt,zt)=>At[zt](Mt)).join(", ")})`}},...["int","float"].reduce((jt,At)=>[...jt,{format:{alpha:!1,mode:"rgb",notation:"func",type:At},stringifier:tv(At)},{format:{alpha:!0,mode:"rgb",notation:"func",type:At},stringifier:M0(At)},{format:{alpha:!1,mode:"rgb",notation:"object",type:At},stringifier:Bu(At)},{format:{alpha:!0,mode:"rgb",notation:"object",type:At},stringifier:Lu(At)}],[])];function t_(jt){return e_.reduce((At,Mt)=>{return At||(zt=Mt.format,ir=jt,zt.alpha===ir.alpha&&zt.mode===ir.mode&&zt.notation===ir.notation&&zt.type===ir.type?Mt.stringifier:null);var zt,ir},null)}const Wo=wt("apl");class r_{constructor(At,Mt){this.onValueChange_=this.onValueChange_.bind(this),this.value=Mt.value,this.value.emitter.on("change",this.onValueChange_),this.element=At.createElement("div"),this.element.classList.add(Wo()),Mt.viewProps.bindClassModifiers(this.element),Mt.viewProps.bindTabIndex(this.element);const zt=At.createElement("div");zt.classList.add(Wo("b")),this.element.appendChild(zt);const ir=At.createElement("div");ir.classList.add(Wo("c")),zt.appendChild(ir),this.colorElem_=ir;const mr=At.createElement("div");mr.classList.add(Wo("m")),this.element.appendChild(mr),this.markerElem_=mr;const Sr=At.createElement("div");Sr.classList.add(Wo("p")),this.markerElem_.appendChild(Sr),this.previewElem_=Sr,this.update_()}update_(){const At=this.value.rawValue,Mt=At.getComponents("rgb"),zt=new gs([Mt[0],Mt[1],Mt[2],0],"rgb"),ir=new gs([Mt[0],Mt[1],Mt[2],255],"rgb"),mr=["to right",_u(zt),_u(ir)];this.colorElem_.style.background=`linear-gradient(${mr.join(",")})`,this.previewElem_.style.backgroundColor=_u(At);const Sr=Ds(Mt[3],0,1,0,100);this.markerElem_.style.left=`${Sr}%`}onValueChange_(){this.update_()}}class I0{constructor(At,Mt){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=Mt.value,this.viewProps=Mt.viewProps,this.view=new r_(At,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new no(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(At,Mt){if(!At.point)return;const zt=At.point.x/At.bounds.width,ir=this.value.rawValue,[mr,Sr,Wr]=ir.getComponents("hsv");this.value.setRawValue(new gs([mr,Sr,Wr,zt],"hsv"),Mt)}onPointerDown_(At){this.handlePointerEvent_(At.data,{forceEmit:!1,last:!1})}onPointerMove_(At){this.handlePointerEvent_(At.data,{forceEmit:!1,last:!1})}onPointerUp_(At){this.handlePointerEvent_(At.data,{forceEmit:!0,last:!0})}onKeyDown_(At){const Mt=ks(Qo(!0),Ws(At));if(Mt===0)return;const zt=this.value.rawValue,[ir,mr,Sr,Wr]=zt.getComponents("hsv");this.value.setRawValue(new gs([ir,mr,Sr,Wr+Mt],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(At){ks(Qo(!0),Ws(At))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const Us=wt("coltxt");class Is{constructor(At,Mt){this.element=At.createElement("div"),this.element.classList.add(Us()),Mt.viewProps.bindClassModifiers(this.element);const zt=At.createElement("div");zt.classList.add(Us("m")),this.modeElem_=function(Sr){const Wr=Sr.createElement("select");return Wr.appendChild([{text:"RGB",value:"rgb"},{text:"HSL",value:"hsl"},{text:"HSV",value:"hsv"}].reduce((_n,zn)=>{const os=Sr.createElement("option");return os.textContent=zn.text,os.value=zn.value,_n.appendChild(os),_n},Sr.createDocumentFragment())),Wr}(At),this.modeElem_.classList.add(Us("ms")),zt.appendChild(this.modeSelectElement),Mt.viewProps.bindDisabled(this.modeElem_);const ir=At.createElement("div");ir.classList.add(Us("mm")),ir.appendChild(vn(At,"dropdown")),zt.appendChild(ir),this.element.appendChild(zt);const mr=At.createElement("div");mr.classList.add(Us("w")),this.element.appendChild(mr),this.textsElem_=mr,this.textViews_=Mt.textViews,this.applyTextViews_(),Rt(Mt.colorMode,Sr=>{this.modeElem_.value=Sr})}get modeSelectElement(){return this.modeElem_}get textViews(){return this.textViews_}set textViews(At){this.textViews_=At,this.applyTextViews_()}applyTextViews_(){ar(this.textsElem_);const At=this.element.ownerDocument;this.textViews_.forEach(Mt=>{const zt=At.createElement("div");zt.classList.add(Us("c")),zt.appendChild(Mt.element),this.textsElem_.appendChild(zt)})}}function rv(jt,At,Mt){const zt=Jp(jt,At)[Mt];return new Vl({min:0,max:zt})}function Ao(jt,At,Mt){return new up(jt,{arrayPosition:Mt===0?"fst":Mt===2?"lst":"mid",baseStep:Qo(!1),parser:At.parser,props:rr.fromObject({draggingScale:At.colorType==="float"?.01:1,formatter:(zt=At.colorType,Ys(zt==="float"?2:0))}),value:nr(0,{constraint:rv(At.colorMode,At.colorType,Mt)}),viewProps:At.viewProps});var zt}class im{constructor(At,Mt){this.onModeSelectChange_=this.onModeSelectChange_.bind(this),this.colorType_=Mt.colorType,this.parser_=Mt.parser,this.value=Mt.value,this.viewProps=Mt.viewProps,this.colorMode=nr(this.value.rawValue.mode),this.ccs_=this.createComponentControllers_(At),this.view=new Is(At,{colorMode:this.colorMode,textViews:[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view],viewProps:this.viewProps}),this.view.modeSelectElement.addEventListener("change",this.onModeSelectChange_)}createComponentControllers_(At){const Mt={colorMode:this.colorMode.rawValue,colorType:this.colorType_,parser:this.parser_,viewProps:this.viewProps},zt=[Ao(At,Mt,0),Ao(At,Mt,1),Ao(At,Mt,2)];return zt.forEach((ir,mr)=>{Iu({primary:this.value,secondary:ir.value,forward:Sr=>Sr.rawValue.getComponents(this.colorMode.rawValue,this.colorType_)[mr],backward:(Sr,Wr)=>{const _n=this.colorMode.rawValue,zn=Sr.rawValue.getComponents(_n,this.colorType_);return zn[mr]=Wr.rawValue,new gs(K_(pu(zn),zn[3]),_n,this.colorType_)}})}),zt}onModeSelectChange_(At){const Mt=At.currentTarget;this.colorMode.rawValue=Mt.value,this.ccs_=this.createComponentControllers_(this.view.element.ownerDocument),this.view.textViews=[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view]}}const i_=wt("hpl");class n_{constructor(At,Mt){this.onValueChange_=this.onValueChange_.bind(this),this.value=Mt.value,this.value.emitter.on("change",this.onValueChange_),this.element=At.createElement("div"),this.element.classList.add(i_()),Mt.viewProps.bindClassModifiers(this.element),Mt.viewProps.bindTabIndex(this.element);const zt=At.createElement("div");zt.classList.add(i_("c")),this.element.appendChild(zt);const ir=At.createElement("div");ir.classList.add(i_("m")),this.element.appendChild(ir),this.markerElem_=ir,this.update_()}update_(){const At=this.value.rawValue,[Mt]=At.getComponents("hsv");this.markerElem_.style.backgroundColor=_g(new gs([Mt,100,100],"hsv"));const zt=Ds(Mt,0,360,0,100);this.markerElem_.style.left=`${zt}%`}onValueChange_(){this.update_()}}class R0{constructor(At,Mt){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=Mt.value,this.viewProps=Mt.viewProps,this.view=new n_(At,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new no(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(At,Mt){if(!At.point)return;const zt=Ds(Vs(At.point.x,0,At.bounds.width),0,At.bounds.width,0,360),ir=this.value.rawValue,[,mr,Sr,Wr]=ir.getComponents("hsv");this.value.setRawValue(new gs([zt,mr,Sr,Wr],"hsv"),Mt)}onPointerDown_(At){this.handlePointerEvent_(At.data,{forceEmit:!1,last:!1})}onPointerMove_(At){this.handlePointerEvent_(At.data,{forceEmit:!1,last:!1})}onPointerUp_(At){this.handlePointerEvent_(At.data,{forceEmit:!0,last:!0})}onKeyDown_(At){const Mt=ks(Qo(!1),Ws(At));if(Mt===0)return;const zt=this.value.rawValue,[ir,mr,Sr,Wr]=zt.getComponents("hsv");this.value.setRawValue(new gs([ir+Mt,mr,Sr,Wr],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(At){ks(Qo(!1),Ws(At))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const s_=wt("svp");class wo{constructor(At,Mt){this.onValueChange_=this.onValueChange_.bind(this),this.value=Mt.value,this.value.emitter.on("change",this.onValueChange_),this.element=At.createElement("div"),this.element.classList.add(s_()),Mt.viewProps.bindClassModifiers(this.element),Mt.viewProps.bindTabIndex(this.element);const zt=At.createElement("canvas");zt.height=64,zt.width=64,zt.classList.add(s_("c")),this.element.appendChild(zt),this.canvasElement=zt;const ir=At.createElement("div");ir.classList.add(s_("m")),this.element.appendChild(ir),this.markerElem_=ir,this.update_()}update_(){const At=function(zn){const os=zn.ownerDocument.defaultView;return os&&"document"in os?zn.getContext("2d",{willReadFrequently:!0}):null}(this.canvasElement);if(!At)return;const Mt=this.value.rawValue.getComponents("hsv"),zt=this.canvasElement.width,ir=this.canvasElement.height,mr=At.getImageData(0,0,zt,ir),Sr=mr.data;for(let zn=0;zn<ir;zn++)for(let os=0;os<zt;os++){const Zs=Ds(os,0,zt,0,100),vo=Ds(zn,0,ir,100,0),Eo=ku(Mt[0],Zs,vo),Ln=4*(zn*zt+os);Sr[Ln]=Eo[0],Sr[Ln+1]=Eo[1],Sr[Ln+2]=Eo[2],Sr[Ln+3]=255}At.putImageData(mr,0,0);const Wr=Ds(Mt[1],0,100,0,100);this.markerElem_.style.left=`${Wr}%`;const _n=Ds(Mt[2],0,100,100,0);this.markerElem_.style.top=`${_n}%`}onValueChange_(){this.update_()}}class Er{constructor(At,Mt){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=Mt.value,this.viewProps=Mt.viewProps,this.view=new wo(At,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new no(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(At,Mt){if(!At.point)return;const zt=Ds(At.point.x,0,At.bounds.width,0,100),ir=Ds(At.point.y,0,At.bounds.height,100,0),[mr,,,Sr]=this.value.rawValue.getComponents("hsv");this.value.setRawValue(new gs([mr,zt,ir,Sr],"hsv"),Mt)}onPointerDown_(At){this.handlePointerEvent_(At.data,{forceEmit:!1,last:!1})}onPointerMove_(At){this.handlePointerEvent_(At.data,{forceEmit:!1,last:!1})}onPointerUp_(At){this.handlePointerEvent_(At.data,{forceEmit:!0,last:!0})}onKeyDown_(At){cp(At.key)&&At.preventDefault();const[Mt,zt,ir,mr]=this.value.rawValue.getComponents("hsv"),Sr=Qo(!1),Wr=ks(Sr,Ws(At)),_n=ks(Sr,Os(At));Wr===0&&_n===0||this.value.setRawValue(new gs([Mt,zt+Wr,ir+_n,mr],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(At){const Mt=Qo(!1),zt=ks(Mt,Ws(At)),ir=ks(Mt,Os(At));zt===0&&ir===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class a_{constructor(At,Mt){this.value=Mt.value,this.viewProps=Mt.viewProps,this.hPaletteC_=new R0(At,{value:this.value,viewProps:this.viewProps}),this.svPaletteC_=new Er(At,{value:this.value,viewProps:this.viewProps}),this.alphaIcs_=Mt.supportsAlpha?{palette:new I0(At,{value:this.value,viewProps:this.viewProps}),text:new up(At,{parser:Il,baseStep:.1,props:rr.fromObject({draggingScale:.01,formatter:Ys(2)}),value:nr(0,{constraint:new Vl({min:0,max:1})}),viewProps:this.viewProps})}:null,this.alphaIcs_&&Iu({primary:this.value,secondary:this.alphaIcs_.text.value,forward:zt=>zt.rawValue.getComponents()[3],backward:(zt,ir)=>{const mr=zt.rawValue.getComponents();return mr[3]=ir.rawValue,new gs(mr,zt.rawValue.mode)}}),this.textC_=new im(At,{colorType:Mt.colorType,parser:Il,value:this.value,viewProps:this.viewProps}),this.view=new Xm(At,{alphaViews:this.alphaIcs_?{palette:this.alphaIcs_.palette.view,text:this.alphaIcs_.text.view}:null,hPaletteView:this.hPaletteC_.view,supportsAlpha:Mt.supportsAlpha,svPaletteView:this.svPaletteC_.view,textView:this.textC_.view,viewProps:this.viewProps})}get textController(){return this.textC_}}const nm=wt("colsw");class xl{constructor(At,Mt){this.onValueChange_=this.onValueChange_.bind(this),Mt.value.emitter.on("change",this.onValueChange_),this.value=Mt.value,this.element=At.createElement("div"),this.element.classList.add(nm()),Mt.viewProps.bindClassModifiers(this.element);const zt=At.createElement("div");zt.classList.add(nm("sw")),this.element.appendChild(zt),this.swatchElem_=zt;const ir=At.createElement("button");ir.classList.add(nm("b")),Mt.viewProps.bindDisabled(ir),this.element.appendChild(ir),this.buttonElement=ir,this.update_()}update_(){const At=this.value.rawValue;this.swatchElem_.style.backgroundColor=gu(At)}onValueChange_(){this.update_()}}class Dl{constructor(At,Mt){this.value=Mt.value,this.viewProps=Mt.viewProps,this.view=new xl(At,{value:this.value,viewProps:this.viewProps})}}class qo{constructor(At,Mt){this.onButtonBlur_=this.onButtonBlur_.bind(this),this.onButtonClick_=this.onButtonClick_.bind(this),this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.value=Mt.value,this.viewProps=Mt.viewProps,this.foldable_=rn.create(Mt.expanded),this.swatchC_=new Dl(At,{value:this.value,viewProps:this.viewProps});const zt=this.swatchC_.view.buttonElement;zt.addEventListener("blur",this.onButtonBlur_),zt.addEventListener("click",this.onButtonClick_),this.textC_=new Cu(At,{parser:Mt.parser,props:rr.fromObject({formatter:Mt.formatter}),value:this.value,viewProps:this.viewProps}),this.view=new Y_(At,{foldable:this.foldable_,pickerLayout:Mt.pickerLayout}),this.view.swatchElement.appendChild(this.swatchC_.view.element),this.view.textElement.appendChild(this.textC_.view.element),this.popC_=Mt.pickerLayout==="popup"?new Hp(At,{viewProps:this.viewProps}):null;const ir=new a_(At,{colorType:Mt.colorType,supportsAlpha:Mt.supportsAlpha,value:this.value,viewProps:this.viewProps});ir.view.allFocusableElements.forEach(mr=>{mr.addEventListener("blur",this.onPopupChildBlur_),mr.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=ir,this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(ir.view.element),Iu({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:mr=>mr.rawValue,backward:(mr,Sr)=>Sr.rawValue})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),bn(this.foldable_,this.view.pickerElement))}get textController(){return this.textC_}onButtonBlur_(At){if(!this.popC_)return;const Mt=this.view.element,zt=At.relatedTarget;zt&&Mt.contains(zt)||(this.popC_.shows.rawValue=!1)}onButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(At){if(!this.popC_)return;const Mt=this.popC_.view.element,zt=vr(At);zt&&Mt.contains(zt)||zt&&zt===this.swatchC_.view.buttonElement&&!Jr(Mt.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(At){this.popC_?At.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&At.key==="Escape"&&this.swatchC_.view.buttonElement.focus()}}function Ou(jt){return pu(jt.getComponents("rgb")).reduce((At,Mt)=>At<<8|255&Math.floor(Mt),0)}function Nu(jt){return jt.getComponents("rgb").reduce((At,Mt,zt)=>At<<8|255&Math.floor(zt===3?255*Mt:Mt),0)>>>0}function Fu(jt){return typeof jt!="number"?gs.black():new gs([(At=jt)>>16&255,At>>8&255,255&At],"rgb");var At}function Uu(jt){return typeof jt!="number"?gs.black():new gs([(At=jt)>>24&255,At>>16&255,At>>8&255,Ds(255&At,0,255,0,1)],"rgb");var At}function Al(jt){var At;return!(!(jt!=null&&jt.alpha)&&!(!((At=jt==null?void 0:jt.color)===null||At===void 0)&&At.alpha))}function Xl(jt){return jt?At=>gu(At,"0x"):At=>Zm(At,"0x")}const fu={id:"input-color-number",type:"input",accept:(jt,At)=>{if(typeof jt!="number"||!function(zt){return"color"in zt||"view"in zt&&zt.view==="color"}(At))return null;const Mt=Uo(At);return Mt?{initialValue:jt,params:Mt}:null},binding:{reader:jt=>Al(jt.params)?Uu:Fu,equals:gs.equals,writer:jt=>function(At){const Mt=At?Nu:Ou;return(zt,ir)=>{pp(zt,Mt(ir))}}(Al(jt.params))},controller:jt=>{const At=Al(jt.params),Mt="expanded"in jt.params?jt.params.expanded:void 0,zt="picker"in jt.params?jt.params.picker:void 0;return new qo(jt.document,{colorType:"int",expanded:Mt!=null&&Mt,formatter:Xl(At),parser:mu("int"),pickerLayout:zt??"popup",supportsAlpha:At,value:jt.value,viewProps:jt.viewProps})}};function gp(jt){return At=>function(Mt,zt){return gs.isColorObject(Mt)?gs.fromObject(Mt,zt):gs.black(zt)}(At,jt)}function sm(jt,At){return Mt=>jt?rm(Mt,At):Ms(Mt,At)}const am={id:"input-color-object",type:"input",accept:(jt,At)=>{if(!gs.isColorObject(jt))return null;const Mt=Uo(At);return Mt?{initialValue:jt,params:Mt}:null},binding:{reader:jt=>gp(mo(jt.params)),equals:gs.equals,writer:jt=>{return zt=jt.initialValue,At=gs.isRgbaColorObject(zt),Mt=mo(jt.params),(ir,mr)=>{At?function(Sr,Wr,_n){const zn=Wr.toRgbaObject(_n);Sr.writeProperty("r",zn.r),Sr.writeProperty("g",zn.g),Sr.writeProperty("b",zn.b),Sr.writeProperty("a",zn.a)}(ir,mr,Mt):function(Sr,Wr,_n){const zn=Wr.toRgbaObject(_n);Sr.writeProperty("r",zn.r),Sr.writeProperty("g",zn.g),Sr.writeProperty("b",zn.b)}(ir,mr,Mt)};var At,Mt,zt}},controller:jt=>{var At;const Mt=gs.isRgbaColorObject(jt.initialValue),zt="expanded"in jt.params?jt.params.expanded:void 0,ir="picker"in jt.params?jt.params.picker:void 0,mr=(At=mo(jt.params))!==null&&At!==void 0?At:"int";return new qo(jt.document,{colorType:mr,expanded:zt!=null&&zt,formatter:sm(Mt,mr),parser:mu(mr),pickerLayout:ir??"popup",supportsAlpha:Mt,value:jt.value,viewProps:jt.viewProps})}},vu={id:"input-color-string",type:"input",accept:(jt,At)=>{if(typeof jt!="string"||"view"in At&&At.view==="text")return null;const Mt=Km(jt,mo(At));if(!Mt||!t_(Mt))return null;const zt=Uo(At);return zt?{initialValue:jt,params:zt}:null},binding:{reader:jt=>{var At;return function(Mt){const zt=du[Mt];return ir=>typeof ir!="string"?gs.black(Mt):zt.reduce((Sr,Wr)=>Sr||Wr(ir),null)??gs.black(Mt)}((At=mo(jt.params))!==null&&At!==void 0?At:"int")},equals:gs.equals,writer:jt=>{const At=Km(jt.initialValue,mo(jt.params));if(!At)throw _t.shouldNeverHappen();const Mt=function(zt){const ir=t_(zt);return ir?(mr,Sr)=>{pp(mr,ir(Sr))}:null}(At);if(!Mt)throw _t.notBindable();return Mt}},controller:jt=>{const At=Km(jt.initialValue,mo(jt.params));if(!At)throw _t.shouldNeverHappen();const Mt=t_(At);if(!Mt)throw _t.shouldNeverHappen();const zt="expanded"in jt.params?jt.params.expanded:void 0,ir="picker"in jt.params?jt.params.picker:void 0;return new qo(jt.document,{colorType:At.type,expanded:zt!=null&&zt,formatter:Mt,parser:mu(At.type),pickerLayout:ir??"popup",supportsAlpha:At.alpha,value:jt.value,viewProps:jt.viewProps})}};class wl{constructor(At){this.components=At.components,this.asm_=At.assembly}constrain(At){const Mt=this.asm_.toComponents(At).map((zt,ir)=>{var mr,Sr;return(Sr=(mr=this.components[ir])===null||mr===void 0?void 0:mr.constrain(zt))!==null&&Sr!==void 0?Sr:zt});return this.asm_.fromComponents(Mt)}}const iv=wt("pndtxt");class _p{constructor(At,Mt){this.textViews=Mt.textViews,this.element=At.createElement("div"),this.element.classList.add(iv()),this.textViews.forEach(zt=>{const ir=At.createElement("div");ir.classList.add(iv("a")),ir.appendChild(zt.element),this.element.appendChild(ir)})}}class fp{constructor(At,Mt){this.value=Mt.value,this.viewProps=Mt.viewProps,this.acs_=Mt.axes.map((zt,ir)=>function(mr,Sr,Wr){return new up(mr,{arrayPosition:Wr===0?"fst":Wr===Sr.axes.length-1?"lst":"mid",baseStep:Sr.axes[Wr].baseStep,parser:Sr.parser,props:Sr.axes[Wr].textProps,value:nr(0,{constraint:Sr.axes[Wr].constraint}),viewProps:Sr.viewProps})}(At,Mt,ir)),this.acs_.forEach((zt,ir)=>{Iu({primary:this.value,secondary:zt.value,forward:mr=>Mt.assembly.toComponents(mr.rawValue)[ir],backward:(mr,Sr)=>{const Wr=Mt.assembly.toComponents(mr.rawValue);return Wr[ir]=Sr.rawValue,Mt.assembly.fromComponents(Wr)}})}),this.view=new _p(At,{textViews:this.acs_.map(zt=>zt.view)})}}function jo(jt,At){return"step"in jt&&!nt(jt.step)?new Su(jt.step,At):null}function El(jt){return nt(jt.max)||nt(jt.min)?nt(jt.max)&&nt(jt.min)?null:new zp({max:jt.max,min:jt.min}):new Vl({max:jt.max,min:jt.min})}const o_={id:"input-number",type:"input",accept:(jt,At)=>{if(typeof jt!="number")return null;const Mt=pr,zt=hr(At,{format:Mt.optional.function,max:Mt.optional.number,min:Mt.optional.number,options:Mt.optional.custom(Kp),step:Mt.optional.number});return zt?{initialValue:jt,params:zt}:null},binding:{reader:jt=>H_,constraint:jt=>function(At,Mt){const zt=[],ir=jo(At,Mt);ir&&zt.push(ir);const mr=El(At);mr&&zt.push(mr);const Sr=$m(At.options);return Sr&&zt.push(Sr),new iu(zt)}(jt.params,jt.initialValue),writer:jt=>pp},controller:jt=>{var At;const Mt=jt.value,zt=jt.constraint,ir=zt&&Ho(zt,nu);if(ir)return new su(jt.document,{props:new rr({options:ir.values.value("options")}),value:Mt,viewProps:jt.viewProps});const mr=(At="format"in jt.params?jt.params.format:void 0)!==null&&At!==void 0?At:Ys(hp(zt,Mt.rawValue)),Sr=zt&&Ho(zt,Vl);return Sr?new qm(jt.document,{baseStep:cu(zt),parser:Il,sliderProps:new rr({maxValue:Sr.values.value("max"),minValue:Sr.values.value("min")}),textProps:rr.fromObject({draggingScale:uu(zt,Mt.rawValue),formatter:mr}),value:Mt,viewProps:jt.viewProps}):new up(jt.document,{baseStep:cu(zt),parser:Il,props:rr.fromObject({draggingScale:uu(zt,Mt.rawValue),formatter:mr}),value:Mt,viewProps:jt.viewProps})}};class $o{constructor(At=0,Mt=0){this.x=At,this.y=Mt}getComponents(){return[this.x,this.y]}static isObject(At){if(nt(At))return!1;const Mt=At.x,zt=At.y;return typeof Mt=="number"&&typeof zt=="number"}static equals(At,Mt){return At.x===Mt.x&&At.y===Mt.y}toObject(){return{x:this.x,y:this.y}}}const Bl={toComponents:jt=>jt.getComponents(),fromComponents:jt=>new $o(...jt)},Yl=wt("p2d");class om{constructor(At,Mt){this.element=At.createElement("div"),this.element.classList.add(Yl()),Mt.viewProps.bindClassModifiers(this.element),Rt(Mt.expanded,Gt(this.element,Yl(void 0,"expanded")));const zt=At.createElement("div");zt.classList.add(Yl("h")),this.element.appendChild(zt);const ir=At.createElement("button");ir.classList.add(Yl("b")),ir.appendChild(vn(At,"p2dpad")),Mt.viewProps.bindDisabled(ir),zt.appendChild(ir),this.buttonElement=ir;const mr=At.createElement("div");if(mr.classList.add(Yl("t")),zt.appendChild(mr),this.textElement=mr,Mt.pickerLayout==="inline"){const Sr=At.createElement("div");Sr.classList.add(Yl("p")),this.element.appendChild(Sr),this.pickerElement=Sr}else this.pickerElement=null}}const Sl=wt("p2dp");class ju{constructor(At,Mt){this.onFoldableChange_=this.onFoldableChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.invertsY_=Mt.invertsY,this.maxValue_=Mt.maxValue,this.element=At.createElement("div"),this.element.classList.add(Sl()),Mt.layout==="popup"&&this.element.classList.add(Sl(void 0,"p")),Mt.viewProps.bindClassModifiers(this.element);const zt=At.createElement("div");zt.classList.add(Sl("p")),Mt.viewProps.bindTabIndex(zt),this.element.appendChild(zt),this.padElement=zt;const ir=At.createElementNS(Ir,"svg");ir.classList.add(Sl("g")),this.padElement.appendChild(ir),this.svgElem_=ir;const mr=At.createElementNS(Ir,"line");mr.classList.add(Sl("ax")),mr.setAttributeNS(null,"x1","0"),mr.setAttributeNS(null,"y1","50%"),mr.setAttributeNS(null,"x2","100%"),mr.setAttributeNS(null,"y2","50%"),this.svgElem_.appendChild(mr);const Sr=At.createElementNS(Ir,"line");Sr.classList.add(Sl("ax")),Sr.setAttributeNS(null,"x1","50%"),Sr.setAttributeNS(null,"y1","0"),Sr.setAttributeNS(null,"x2","50%"),Sr.setAttributeNS(null,"y2","100%"),this.svgElem_.appendChild(Sr);const Wr=At.createElementNS(Ir,"line");Wr.classList.add(Sl("l")),Wr.setAttributeNS(null,"x1","50%"),Wr.setAttributeNS(null,"y1","50%"),this.svgElem_.appendChild(Wr),this.lineElem_=Wr;const _n=At.createElement("div");_n.classList.add(Sl("m")),this.padElement.appendChild(_n),this.markerElem_=_n,Mt.value.emitter.on("change",this.onValueChange_),this.value=Mt.value,this.update_()}get allFocusableElements(){return[this.padElement]}update_(){const[At,Mt]=this.value.rawValue.getComponents(),zt=this.maxValue_,ir=Ds(At,-zt,+zt,0,100),mr=Ds(Mt,-zt,+zt,0,100),Sr=this.invertsY_?100-mr:mr;this.lineElem_.setAttributeNS(null,"x2",`${ir}%`),this.lineElem_.setAttributeNS(null,"y2",`${Sr}%`),this.markerElem_.style.left=`${ir}%`,this.markerElem_.style.top=`${Sr}%`}onValueChange_(){this.update_()}onFoldableChange_(){this.update_()}}function rs(jt,At,Mt){return[ks(At[0],Ws(jt)),ks(At[1],Os(jt))*(Mt?1:-1)]}class Gu{constructor(At,Mt){this.onPadKeyDown_=this.onPadKeyDown_.bind(this),this.onPadKeyUp_=this.onPadKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=Mt.value,this.viewProps=Mt.viewProps,this.baseSteps_=Mt.baseSteps,this.maxValue_=Mt.maxValue,this.invertsY_=Mt.invertsY,this.view=new ju(At,{invertsY:this.invertsY_,layout:Mt.layout,maxValue:this.maxValue_,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new no(this.view.padElement),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.padElement.addEventListener("keydown",this.onPadKeyDown_),this.view.padElement.addEventListener("keyup",this.onPadKeyUp_)}handlePointerEvent_(At,Mt){if(!At.point)return;const zt=this.maxValue_,ir=Ds(At.point.x,0,At.bounds.width,-zt,+zt),mr=Ds(this.invertsY_?At.bounds.height-At.point.y:At.point.y,0,At.bounds.height,-zt,+zt);this.value.setRawValue(new $o(ir,mr),Mt)}onPointerDown_(At){this.handlePointerEvent_(At.data,{forceEmit:!1,last:!1})}onPointerMove_(At){this.handlePointerEvent_(At.data,{forceEmit:!1,last:!1})}onPointerUp_(At){this.handlePointerEvent_(At.data,{forceEmit:!0,last:!0})}onPadKeyDown_(At){cp(At.key)&&At.preventDefault();const[Mt,zt]=rs(At,this.baseSteps_,this.invertsY_);Mt===0&&zt===0||this.value.setRawValue(new $o(this.value.rawValue.x+Mt,this.value.rawValue.y+zt),{forceEmit:!1,last:!1})}onPadKeyUp_(At){const[Mt,zt]=rs(At,this.baseSteps_,this.invertsY_);Mt===0&&zt===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class Xo{constructor(At,Mt){var zt,ir;this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.onPadButtonBlur_=this.onPadButtonBlur_.bind(this),this.onPadButtonClick_=this.onPadButtonClick_.bind(this),this.value=Mt.value,this.viewProps=Mt.viewProps,this.foldable_=rn.create(Mt.expanded),this.popC_=Mt.pickerLayout==="popup"?new Hp(At,{viewProps:this.viewProps}):null;const mr=new Gu(At,{baseSteps:[Mt.axes[0].baseStep,Mt.axes[1].baseStep],invertsY:Mt.invertsY,layout:Mt.pickerLayout,maxValue:Mt.maxValue,value:this.value,viewProps:this.viewProps});mr.view.allFocusableElements.forEach(Sr=>{Sr.addEventListener("blur",this.onPopupChildBlur_),Sr.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=mr,this.textC_=new fp(At,{assembly:Bl,axes:Mt.axes,parser:Mt.parser,value:this.value,viewProps:this.viewProps}),this.view=new om(At,{expanded:this.foldable_.value("expanded"),pickerLayout:Mt.pickerLayout,viewProps:this.viewProps}),this.view.textElement.appendChild(this.textC_.view.element),(zt=this.view.buttonElement)===null||zt===void 0||zt.addEventListener("blur",this.onPadButtonBlur_),(ir=this.view.buttonElement)===null||ir===void 0||ir.addEventListener("click",this.onPadButtonClick_),this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(this.pickerC_.view.element),Iu({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:Sr=>Sr.rawValue,backward:(Sr,Wr)=>Wr.rawValue})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),bn(this.foldable_,this.view.pickerElement))}onPadButtonBlur_(At){if(!this.popC_)return;const Mt=this.view.element,zt=At.relatedTarget;zt&&Mt.contains(zt)||(this.popC_.shows.rawValue=!1)}onPadButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(At){if(!this.popC_)return;const Mt=this.popC_.view.element,zt=vr(At);zt&&Mt.contains(zt)||zt&&zt===this.view.buttonElement&&!Jr(Mt.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(At){this.popC_?At.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&At.key==="Escape"&&this.view.buttonElement.focus()}}class zu{constructor(At=0,Mt=0,zt=0){this.x=At,this.y=Mt,this.z=zt}getComponents(){return[this.x,this.y,this.z]}static isObject(At){if(nt(At))return!1;const Mt=At.x,zt=At.y,ir=At.z;return typeof Mt=="number"&&typeof zt=="number"&&typeof ir=="number"}static equals(At,Mt){return At.x===Mt.x&&At.y===Mt.y&&At.z===Mt.z}toObject(){return{x:this.x,y:this.y,z:this.z}}}const nv={toComponents:jt=>jt.getComponents(),fromComponents:jt=>new zu(...jt)};function Kl(jt){return zu.isObject(jt)?new zu(jt.x,jt.y,jt.z):new zu}function lm(jt,At){jt.writeProperty("x",At.x),jt.writeProperty("y",At.y),jt.writeProperty("z",At.z)}function _o(jt,At){return{baseStep:cu(At),constraint:At,textProps:rr.fromObject({draggingScale:uu(At,jt),formatter:Ys(hp(At,jt))})}}const sv={id:"input-point3d",type:"input",accept:(jt,At)=>{if(!zu.isObject(jt))return null;const Mt=pr,zt=hr(At,{x:Mt.optional.custom(Hl),y:Mt.optional.custom(Hl),z:Mt.optional.custom(Hl)});return zt?{initialValue:jt,params:zt}:null},binding:{reader:jt=>Kl,constraint:jt=>{return At=jt.params,Mt=jt.initialValue,new wl({assembly:nv,components:[Yo("x"in At?At.x:void 0,Mt.x),Yo("y"in At?At.y:void 0,Mt.y),Yo("z"in At?At.z:void 0,Mt.z)]});var At,Mt},equals:zu.equals,writer:jt=>lm},controller:jt=>{const At=jt.value,Mt=jt.constraint;if(!(Mt instanceof wl))throw _t.shouldNeverHappen();return new fp(jt.document,{assembly:nv,axes:[_o(At.rawValue.x,Mt.components[0]),_o(At.rawValue.y,Mt.components[1]),_o(At.rawValue.z,Mt.components[2])],parser:Il,value:At,viewProps:jt.viewProps})}};class yu{constructor(At=0,Mt=0,zt=0,ir=0){this.x=At,this.y=Mt,this.z=zt,this.w=ir}getComponents(){return[this.x,this.y,this.z,this.w]}static isObject(At){if(nt(At))return!1;const Mt=At.x,zt=At.y,ir=At.z,mr=At.w;return typeof Mt=="number"&&typeof zt=="number"&&typeof ir=="number"&&typeof mr=="number"}static equals(At,Mt){return At.x===Mt.x&&At.y===Mt.y&&At.z===Mt.z&&At.w===Mt.w}toObject(){return{x:this.x,y:this.y,z:this.z,w:this.w}}}const Vu={toComponents:jt=>jt.getComponents(),fromComponents:jt=>new yu(...jt)};function cm(jt){return yu.isObject(jt)?new yu(jt.x,jt.y,jt.z,jt.w):new yu}function k0(jt,At){jt.writeProperty("x",At.x),jt.writeProperty("y",At.y),jt.writeProperty("z",At.z),jt.writeProperty("w",At.w)}const av={id:"input-point4d",type:"input",accept:(jt,At)=>{if(!yu.isObject(jt))return null;const Mt=pr,zt=hr(At,{x:Mt.optional.custom(Hl),y:Mt.optional.custom(Hl),z:Mt.optional.custom(Hl),w:Mt.optional.custom(Hl)});return zt?{initialValue:jt,params:zt}:null},binding:{reader:jt=>cm,constraint:jt=>{return At=jt.params,Mt=jt.initialValue,new wl({assembly:Vu,components:[Yo("x"in At?At.x:void 0,Mt.x),Yo("y"in At?At.y:void 0,Mt.y),Yo("z"in At?At.z:void 0,Mt.z),Yo("w"in At?At.w:void 0,Mt.w)]});var At,Mt},equals:yu.equals,writer:jt=>k0},controller:jt=>{const At=jt.value,Mt=jt.constraint;if(!(Mt instanceof wl))throw _t.shouldNeverHappen();return new fp(jt.document,{assembly:Vu,axes:At.rawValue.getComponents().map((zt,ir)=>{return mr=zt,{baseStep:cu(Sr=Mt.components[ir]),constraint:Sr,textProps:rr.fromObject({draggingScale:uu(Sr,mr),formatter:Ys(hp(Sr,mr))})};var mr,Sr}),parser:Il,value:At,viewProps:jt.viewProps})}},Hu={id:"input-string",type:"input",accept:(jt,At)=>{if(typeof jt!="string")return null;const Mt=hr(At,{options:pr.optional.custom(Kp)});return Mt?{initialValue:jt,params:Mt}:null},binding:{reader:jt=>Hm,constraint:jt=>function(At){const Mt=[],zt=$m(At.options);return zt&&Mt.push(zt),new iu(Mt)}(jt.params),writer:jt=>pp},controller:jt=>{const At=jt.document,Mt=jt.value,zt=jt.constraint,ir=zt&&Ho(zt,nu);return ir?new su(At,{props:new rr({options:ir.values.value("options")}),value:Mt,viewProps:jt.viewProps}):new Cu(At,{parser:mr=>mr,props:rr.fromObject({formatter:yl}),value:Mt,viewProps:jt.viewProps})}},Io={defaultInterval:200,defaultLineCount:3},vp=wt("mll");class yp{constructor(At,Mt){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=Mt.formatter,this.element=At.createElement("div"),this.element.classList.add(vp()),Mt.viewProps.bindClassModifiers(this.element);const zt=At.createElement("textarea");zt.classList.add(vp("i")),zt.style.height=`calc(var(--bld-us) * ${Mt.lineCount})`,zt.readOnly=!0,Mt.viewProps.bindDisabled(zt),this.element.appendChild(zt),this.textareaElem_=zt,Mt.value.emitter.on("change",this.onValueUpdate_),this.value=Mt.value,this.update_()}update_(){const At=this.textareaElem_,Mt=At.scrollTop===At.scrollHeight-At.clientHeight,zt=[];this.value.rawValue.forEach(ir=>{ir!==void 0&&zt.push(this.formatter_(ir))}),At.textContent=zt.join(`
`),Mt&&(At.scrollTop=At.scrollHeight)}onValueUpdate_(){this.update_()}}class l_{constructor(At,Mt){this.value=Mt.value,this.viewProps=Mt.viewProps,this.view=new yp(At,{formatter:Mt.formatter,lineCount:Mt.lineCount,value:this.value,viewProps:this.viewProps})}}const ov=wt("sgl");class lv{constructor(At,Mt){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=Mt.formatter,this.element=At.createElement("div"),this.element.classList.add(ov()),Mt.viewProps.bindClassModifiers(this.element);const zt=At.createElement("input");zt.classList.add(ov("i")),zt.readOnly=!0,zt.type="text",Mt.viewProps.bindDisabled(zt),this.element.appendChild(zt),this.inputElement=zt,Mt.value.emitter.on("change",this.onValueUpdate_),this.value=Mt.value,this.update_()}update_(){const At=this.value.rawValue,Mt=At[At.length-1];this.inputElement.value=Mt!==void 0?this.formatter_(Mt):""}onValueUpdate_(){this.update_()}}class um{constructor(At,Mt){this.value=Mt.value,this.viewProps=Mt.viewProps,this.view=new lv(At,{formatter:Mt.formatter,value:this.value,viewProps:this.viewProps})}}const cv={id:"monitor-bool",type:"monitor",accept:(jt,At)=>{if(typeof jt!="boolean")return null;const Mt=hr(At,{lineCount:pr.optional.number});return Mt?{initialValue:jt,params:Mt}:null},binding:{reader:jt=>Wp},controller:jt=>{var At;return jt.value.rawValue.length===1?new um(jt.document,{formatter:np,value:jt.value,viewProps:jt.viewProps}):new l_(jt.document,{formatter:np,lineCount:(At=jt.params.lineCount)!==null&&At!==void 0?At:Io.defaultLineCount,value:jt.value,viewProps:jt.viewProps})}},Jl=wt("grl");class D0{constructor(At,Mt){this.onCursorChange_=this.onCursorChange_.bind(this),this.onValueUpdate_=this.onValueUpdate_.bind(this),this.element=At.createElement("div"),this.element.classList.add(Jl()),Mt.viewProps.bindClassModifiers(this.element),this.formatter_=Mt.formatter,this.props_=Mt.props,this.cursor_=Mt.cursor,this.cursor_.emitter.on("change",this.onCursorChange_);const zt=At.createElementNS(Ir,"svg");zt.classList.add(Jl("g")),zt.style.height=`calc(var(--bld-us) * ${Mt.lineCount})`,this.element.appendChild(zt),this.svgElem_=zt;const ir=At.createElementNS(Ir,"polyline");this.svgElem_.appendChild(ir),this.lineElem_=ir;const mr=At.createElement("div");mr.classList.add(Jl("t"),wt("tt")()),this.element.appendChild(mr),this.tooltipElem_=mr,Mt.value.emitter.on("change",this.onValueUpdate_),this.value=Mt.value,this.update_()}get graphElement(){return this.svgElem_}update_(){const At=this.svgElem_.getBoundingClientRect(),Mt=this.value.rawValue.length-1,zt=this.props_.get("minValue"),ir=this.props_.get("maxValue"),mr=[];this.value.rawValue.forEach((os,Zs)=>{if(os===void 0)return;const vo=Ds(Zs,0,Mt,0,At.width),Eo=Ds(os,zt,ir,At.height,0);mr.push([vo,Eo].join(","))}),this.lineElem_.setAttributeNS(null,"points",mr.join(" "));const Sr=this.tooltipElem_,Wr=this.value.rawValue[this.cursor_.rawValue];if(Wr===void 0)return void Sr.classList.remove(Jl("t","a"));const _n=Ds(this.cursor_.rawValue,0,Mt,0,At.width),zn=Ds(Wr,zt,ir,At.height,0);Sr.style.left=`${_n}px`,Sr.style.top=`${zn}px`,Sr.textContent=`${this.formatter_(Wr)}`,Sr.classList.contains(Jl("t","a"))||(Sr.classList.add(Jl("t","a"),Jl("t","in")),Xr(Sr),Sr.classList.remove(Jl("t","in")))}onValueUpdate_(){this.update_()}onCursorChange_(){this.update_()}}class Ss{constructor(At,Mt){if(this.onGraphMouseMove_=this.onGraphMouseMove_.bind(this),this.onGraphMouseLeave_=this.onGraphMouseLeave_.bind(this),this.onGraphPointerDown_=this.onGraphPointerDown_.bind(this),this.onGraphPointerMove_=this.onGraphPointerMove_.bind(this),this.onGraphPointerUp_=this.onGraphPointerUp_.bind(this),this.props_=Mt.props,this.value=Mt.value,this.viewProps=Mt.viewProps,this.cursor_=nr(-1),this.view=new D0(At,{cursor:this.cursor_,formatter:Mt.formatter,lineCount:Mt.lineCount,props:this.props_,value:this.value,viewProps:this.viewProps}),Jr(At)){const zt=new no(this.view.element);zt.emitter.on("down",this.onGraphPointerDown_),zt.emitter.on("move",this.onGraphPointerMove_),zt.emitter.on("up",this.onGraphPointerUp_)}else this.view.element.addEventListener("mousemove",this.onGraphMouseMove_),this.view.element.addEventListener("mouseleave",this.onGraphMouseLeave_)}onGraphMouseLeave_(){this.cursor_.rawValue=-1}onGraphMouseMove_(At){const Mt=this.view.element.getBoundingClientRect();this.cursor_.rawValue=Math.floor(Ds(At.offsetX,0,Mt.width,0,this.value.rawValue.length))}onGraphPointerDown_(At){this.onGraphPointerMove_(At)}onGraphPointerMove_(At){At.data.point?this.cursor_.rawValue=Math.floor(Ds(At.data.point.x,0,At.data.bounds.width,0,this.value.rawValue.length)):this.cursor_.rawValue=-1}onGraphPointerUp_(){this.cursor_.rawValue=-1}}function Ro(jt){return"format"in jt&&!nt(jt.format)?jt.format:Ys(2)}function Cl(jt){return"view"in jt&&jt.view==="graph"}const c_={id:"monitor-number",type:"monitor",accept:(jt,At)=>{if(typeof jt!="number")return null;const Mt=pr,zt=hr(At,{format:Mt.optional.function,lineCount:Mt.optional.number,max:Mt.optional.number,min:Mt.optional.number,view:Mt.optional.string});return zt?{initialValue:jt,params:zt}:null},binding:{defaultBufferSize:jt=>Cl(jt)?64:1,reader:jt=>H_},controller:jt=>Cl(jt.params)?function(At){var Mt,zt,ir;return new Ss(At.document,{formatter:Ro(At.params),lineCount:(Mt=At.params.lineCount)!==null&&Mt!==void 0?Mt:Io.defaultLineCount,props:rr.fromObject({maxValue:(zt="max"in At.params?At.params.max:null)!==null&&zt!==void 0?zt:100,minValue:(ir="min"in At.params?At.params.min:null)!==null&&ir!==void 0?ir:0}),value:At.value,viewProps:At.viewProps})}(jt):function(At){var Mt;return At.value.rawValue.length===1?new um(At.document,{formatter:Ro(At.params),value:At.value,viewProps:At.viewProps}):new l_(At.document,{formatter:Ro(At.params),lineCount:(Mt=At.params.lineCount)!==null&&Mt!==void 0?Mt:Io.defaultLineCount,value:At.value,viewProps:At.viewProps})}(jt)},Ll={id:"monitor-string",type:"monitor",accept:(jt,At)=>{if(typeof jt!="string")return null;const Mt=pr,zt=hr(At,{lineCount:Mt.optional.number,multiline:Mt.optional.boolean});return zt?{initialValue:jt,params:zt}:null},binding:{reader:jt=>Hm},controller:jt=>{var At;const Mt=jt.value;return Mt.rawValue.length>1||"multiline"in jt.params&&jt.params.multiline?new l_(jt.document,{formatter:yl,lineCount:(At=jt.params.lineCount)!==null&&At!==void 0?At:Io.defaultLineCount,value:Mt,viewProps:jt.viewProps}):new um(jt.document,{formatter:yl,value:Mt,viewProps:jt.viewProps})}};function Qu(jt,At){return At===0?new Up:new jp(jt,At??Io.defaultInterval)}class Wu{constructor(){this.pluginsMap_={blades:[],inputs:[],monitors:[]}}getAll(){return[...this.pluginsMap_.blades,...this.pluginsMap_.inputs,...this.pluginsMap_.monitors]}register(At){At.type==="blade"?this.pluginsMap_.blades.unshift(At):At.type==="input"?this.pluginsMap_.inputs.unshift(At):At.type==="monitor"&&this.pluginsMap_.monitors.unshift(At)}createInput(At,Mt,zt){if(nt(Mt.read()))throw new _t({context:{key:Mt.key},type:"nomatchingcontroller"});const ir=this.pluginsMap_.inputs.reduce((mr,Sr)=>mr??function(Wr,_n){var zn;const os=Wr.accept(_n.target.read(),_n.params);if(nt(os))return null;const Zs=pr,vo={target:_n.target,initialValue:os.initialValue,params:os.params},Eo=Wr.binding.reader(vo),Ln=Wr.binding.constraint?Wr.binding.constraint(vo):void 0,m_=nr(Eo(os.initialValue),{constraint:Ln,equals:Wr.binding.equals}),mm=new Dm({reader:Eo,target:_n.target,value:m_,writer:Wr.binding.writer(vo)}),So=Zs.optional.boolean(_n.params.disabled).value,qu=Zs.optional.boolean(_n.params.hidden).value,Nl=Wr.controller({constraint:Ln,document:_n.document,initialValue:os.initialValue,params:os.params,value:mm.value,viewProps:kr.create({disabled:So,hidden:qu})});return new En(_n.document,{binding:mm,blade:en(),props:rr.fromObject({label:"label"in _n.params?(zn=Zs.optional.string(_n.params.label).value)!==null&&zn!==void 0?zn:null:_n.target.key}),valueController:Nl})}(Sr,{document:At,target:Mt,params:zt}),null);if(ir)return ir;throw new _t({context:{key:Mt.key},type:"nomatchingcontroller"})}createMonitor(At,Mt,zt){const ir=this.pluginsMap_.monitors.reduce((mr,Sr)=>mr??function(Wr,_n){var zn,os,Zs;const vo=pr,Eo=Wr.accept(_n.target.read(),_n.params);if(nt(Eo))return null;const Ln={target:_n.target,initialValue:Eo.initialValue,params:Eo.params},m_=Wr.binding.reader(Ln),mm=(os=(zn=vo.optional.number(_n.params.bufferSize).value)!==null&&zn!==void 0?zn:Wr.binding.defaultBufferSize&&Wr.binding.defaultBufferSize(Eo.params))!==null&&os!==void 0?os:1,So=vo.optional.number(_n.params.interval).value,qu=new z_({reader:m_,target:_n.target,ticker:Qu(_n.document,So),value:Bm(mm)}),Nl=vo.optional.boolean(_n.params.disabled).value,ko=vo.optional.boolean(_n.params.hidden).value,bp=Wr.controller({document:_n.document,params:Eo.params,value:qu.value,viewProps:kr.create({disabled:Nl,hidden:ko})});return new wn(_n.document,{binding:qu,blade:en(),props:rr.fromObject({label:"label"in _n.params?(Zs=vo.optional.string(_n.params.label).value)!==null&&Zs!==void 0?Zs:null:_n.target.key}),valueController:bp})}(Sr,{document:At,params:zt,target:Mt}),null);if(ir)return ir;throw new _t({context:{key:Mt.key},type:"nomatchingcontroller"})}createBlade(At,Mt){const zt=this.pluginsMap_.blades.reduce((ir,mr)=>ir??function(Sr,Wr){const _n=Sr.accept(Wr.params);if(!_n)return null;const zn=pr.optional.boolean(Wr.params.disabled).value,os=pr.optional.boolean(Wr.params.hidden).value;return Sr.controller({blade:en(),document:Wr.document,params:Object.assign(Object.assign({},_n.params),{disabled:zn,hidden:os}),viewProps:kr.create({disabled:zn,hidden:os})})}(mr,{document:At,params:Mt}),null);if(!zt)throw new _t({type:"nomatchingview",context:{params:Mt}});return zt}createBladeApi(At){if(At instanceof En)return new fn(At);if(At instanceof wn)return new tn(At);if(At instanceof eo)return new Qn(At,this);const Mt=this.pluginsMap_.blades.reduce((zt,ir)=>zt??ir.api({controller:At,pool:this}),null);if(!Mt)throw _t.shouldNeverHappen();return Mt}}function uv(jt){return $o.isObject(jt)?new $o(jt.x,jt.y):new $o}function u_(jt,At){jt.writeProperty("x",At.x),jt.writeProperty("y",At.y)}function Yo(jt,At){if(!jt)return;const Mt=[],zt=jo(jt,At);zt&&Mt.push(zt);const ir=El(jt);return ir&&Mt.push(ir),new iu(Mt)}function pm(jt,At){const[Mt,zt]=jt?function(mr){const Sr=Ho(mr,Vl);if(Sr)return[Sr.values.get("min"),Sr.values.get("max")];const Wr=Ho(mr,zp);return Wr?[Wr.minValue,Wr.maxValue]:[void 0,void 0]}(jt):[];if(!nt(Mt)||!nt(zt))return Math.max(Math.abs(Mt??0),Math.abs(zt??0));const ir=cu(jt);return Math.max(10*Math.abs(ir),10*Math.abs(At))}function hm(jt,At){const Mt=At instanceof wl?At.components[0]:void 0,zt=At instanceof wl?At.components[1]:void 0,ir=pm(Mt,jt.x),mr=pm(zt,jt.y);return Math.max(ir,mr)}function fo(jt,At){return{baseStep:cu(At),constraint:At,textProps:rr.fromObject({draggingScale:uu(At,jt),formatter:Ys(hp(At,jt))})}}function B0(jt){if(!("y"in jt))return!1;const At=jt.y;return!!At&&"inverted"in At&&!!At.inverted}const so={id:"input-point2d",type:"input",accept:(jt,At)=>{if(!$o.isObject(jt))return null;const Mt=pr,zt=hr(At,{expanded:Mt.optional.boolean,picker:Mt.optional.custom(Q_),x:Mt.optional.custom(Hl),y:Mt.optional.object({inverted:Mt.optional.boolean,max:Mt.optional.number,min:Mt.optional.number,step:Mt.optional.number})});return zt?{initialValue:jt,params:zt}:null},binding:{reader:jt=>uv,constraint:jt=>{return At=jt.params,Mt=jt.initialValue,new wl({assembly:Bl,components:[Yo("x"in At?At.x:void 0,Mt.x),Yo("y"in At?At.y:void 0,Mt.y)]});var At,Mt},equals:$o.equals,writer:jt=>u_},controller:jt=>{const At=jt.document,Mt=jt.value,zt=jt.constraint;if(!(zt instanceof wl))throw _t.shouldNeverHappen();const ir="expanded"in jt.params?jt.params.expanded:void 0,mr="picker"in jt.params?jt.params.picker:void 0;return new Xo(At,{axes:[fo(Mt.rawValue.x,zt.components[0]),fo(Mt.rawValue.y,zt.components[1])],expanded:ir!=null&&ir,invertsY:B0(jt.params),maxValue:hm(Mt.rawValue,zt),parser:Il,pickerLayout:mr??"popup",value:Mt,viewProps:jt.viewProps})}};class p_ extends d{constructor(At){super(At),this.emitter_=new xt,this.controller_.valueController.value.emitter.on("change",Mt=>{this.emitter_.emit("change",{event:new v(this,Mt.rawValue)})})}get label(){return this.controller_.props.get("label")}set label(At){this.controller_.props.set("label",At)}get options(){return this.controller_.valueController.props.get("options")}set options(At){this.controller_.valueController.props.set("options",At)}get value(){return this.controller_.valueController.value.rawValue}set value(At){this.controller_.valueController.value.rawValue=At}on(At,Mt){const zt=Mt.bind(this);return this.emitter_.on(At,ir=>{zt(ir.event)}),this}}class h_ extends d{constructor(At){super(At),this.emitter_=new xt,this.controller_.valueController.value.emitter.on("change",Mt=>{this.emitter_.emit("change",{event:new v(this,Mt.rawValue)})})}get label(){return this.controller_.props.get("label")}set label(At){this.controller_.props.set("label",At)}get maxValue(){return this.controller_.valueController.sliderController.props.get("maxValue")}set maxValue(At){this.controller_.valueController.sliderController.props.set("maxValue",At)}get minValue(){return this.controller_.valueController.sliderController.props.get("minValue")}set minValue(At){this.controller_.valueController.sliderController.props.set("minValue",At)}get value(){return this.controller_.valueController.value.rawValue}set value(At){this.controller_.valueController.value.rawValue=At}on(At,Mt){const zt=Mt.bind(this);return this.emitter_.on(At,ir=>{zt(ir.event)}),this}}class Ol extends d{constructor(At){super(At),this.emitter_=new xt,this.controller_.valueController.value.emitter.on("change",Mt=>{this.emitter_.emit("change",{event:new v(this,Mt.rawValue)})})}get label(){return this.controller_.props.get("label")}set label(At){this.controller_.props.set("label",At)}get formatter(){return this.controller_.valueController.props.get("formatter")}set formatter(At){this.controller_.valueController.props.set("formatter",At)}get value(){return this.controller_.valueController.value.rawValue}set value(At){this.controller_.valueController.value.rawValue=At}on(At,Mt){const zt=Mt.bind(this);return this.emitter_.on(At,ir=>{zt(ir.event)}),this}}const dm={id:"list",type:"blade",accept(jt){const At=pr,Mt=hr(jt,{options:At.required.custom(Kp),value:At.required.raw,view:At.required.constant("list"),label:At.optional.string});return Mt?{params:Mt}:null},controller(jt){const At=new nu(W_(jt.params.options)),Mt=nr(jt.params.value,{constraint:At}),zt=new su(jt.document,{props:new rr({options:At.values.value("options")}),value:Mt,viewProps:jt.viewProps});return new ba(jt.document,{blade:jt.blade,props:rr.fromObject({label:jt.params.label}),valueController:zt})},api(jt){return jt.controller instanceof ba&&jt.controller.valueController instanceof su?new p_(jt.controller):null}};class d_ extends jn{constructor(At,Mt){super(At,Mt)}get element(){return this.controller_.view.element}importPreset(At){(function(Mt,zt){Mt.forEach(ir=>{const mr=zt[ir.target.presetKey];mr!==void 0&&ir.writer(ir.target,ir.reader(mr))})})(this.controller_.rackController.rack.find(En).map(Mt=>Mt.binding),At),this.refresh()}exportPreset(){return this.controller_.rackController.rack.find(En).map(At=>At.binding.target).reduce((At,Mt)=>Object.assign(At,{[Mt.presetKey]:Mt.read()}),{})}refresh(){this.controller_.rackController.rack.find(En).forEach(At=>{At.binding.read()}),this.controller_.rackController.rack.find(wn).forEach(At=>{At.binding.read()})}}class Un extends po{constructor(At,Mt){super(At,{expanded:Mt.expanded,blade:Mt.blade,props:Mt.props,root:!0,viewProps:Mt.viewProps})}}const ao={id:"slider",type:"blade",accept(jt){const At=pr,Mt=hr(jt,{max:At.required.number,min:At.required.number,view:At.required.constant("slider"),format:At.optional.function,label:At.optional.string,value:At.optional.number});return Mt?{params:Mt}:null},controller(jt){var At,Mt;const zt=(At=jt.params.value)!==null&&At!==void 0?At:0,ir=new Vl({max:jt.params.max,min:jt.params.min}),mr=new qm(jt.document,{baseStep:1,parser:Il,sliderProps:new rr({maxValue:ir.values.value("max"),minValue:ir.values.value("min")}),textProps:rr.fromObject({draggingScale:uu(void 0,zt),formatter:(Mt=jt.params.format)!==null&&Mt!==void 0?Mt:A0}),value:nr(zt,{constraint:ir}),viewProps:jt.viewProps});return new ba(jt.document,{blade:jt.blade,props:rr.fromObject({label:jt.params.label}),valueController:mr})},api(jt){return jt.controller instanceof ba&&jt.controller.valueController instanceof qm?new h_(jt.controller):null}},Zl={id:"text",type:"blade",accept(jt){const At=pr,Mt=hr(jt,{parse:At.required.function,value:At.required.raw,view:At.required.constant("text"),format:At.optional.function,label:At.optional.string});return Mt?{params:Mt}:null},controller(jt){var At;const Mt=new Cu(jt.document,{parser:jt.params.parse,props:rr.fromObject({formatter:(At=jt.params.format)!==null&&At!==void 0?At:zt=>String(zt)}),value:nr(jt.params.value),viewProps:jt.viewProps});return new ba(jt.document,{blade:jt.blade,props:rr.fromObject({label:jt.params.label}),valueController:Mt})},api(jt){return jt.controller instanceof ba&&jt.controller.valueController instanceof Cu?new Ol(jt.controller):null}};function Pl(jt,At,Mt){if(jt.querySelector(`style[data-tp-style=${At}]`))return;const zt=jt.createElement("style");zt.dataset.tpStyle=At,zt.textContent=Mt,jt.head.appendChild(zt)}const L0=new class{constructor(jt){const[At,Mt]=jt.split("-"),zt=At.split(".");this.major=parseInt(zt[0],10),this.minor=parseInt(zt[1],10),this.patch=parseInt(zt[2],10),this.prerelease=Mt??null}toString(){const jt=[this.major,this.minor,this.patch].join(".");return this.prerelease!==null?[jt,this.prerelease].join("-"):jt}}("3.1.10");c.BladeApi=d,c.ButtonApi=bt,c.FolderApi=jn,c.InputBindingApi=fn,c.ListApi=p_,c.MonitorBindingApi=tn,c.Pane=class extends d_{constructor(jt){var At,Mt;const zt=jt??{},ir=(At=zt.document)!==null&&At!==void 0?At:on(),mr=function(){const Sr=new Wu;return[so,sv,av,Hu,o_,vu,am,fu,X_,cv,Ll,c_,Dr,to,io,rp].forEach(Wr=>{Sr.register(Wr)}),Sr}();super(new Un(ir,{expanded:zt.expanded,blade:en(),props:rr.fromObject({title:zt.title}),viewProps:kr.create()}),mr),this.pool_=mr,this.containerElem_=(Mt=zt.container)!==null&&Mt!==void 0?Mt:function(Sr){const Wr=Sr.createElement("div");return Wr.classList.add(wt("dfw")()),Sr.body&&Sr.body.appendChild(Wr),Wr}(ir),this.containerElem_.appendChild(this.element),this.doc_=ir,this.usesDefaultWrapper_=!zt.container,this.setUpDefaultPlugins_()}get document(){if(!this.doc_)throw _t.alreadyDisposed();return this.doc_}dispose(){const jt=this.containerElem_;if(!jt)throw _t.alreadyDisposed();if(this.usesDefaultWrapper_){const At=jt.parentElement;At&&At.removeChild(jt)}this.containerElem_=null,this.doc_=null,super.dispose()}registerPlugin(jt){("plugin"in jt?[jt.plugin]:"plugins"in jt?jt.plugins:[]).forEach(At=>{this.pool_.register(At),this.embedPluginStyle_(At)})}embedPluginStyle_(jt){jt.css&&Pl(this.document,`plugin-${jt.id}`,jt.css)}setUpDefaultPlugins_(){Pl(this.document,"default",'.tp-tbiv_b,.tp-coltxtv_ms,.tp-ckbv_i,.tp-rotv_b,.tp-fldv_b,.tp-mllv_i,.tp-sglv_i,.tp-grlv_g,.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw,.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:rgba(0,0,0,0);border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{background-color:var(--btn-bg);border-radius:var(--elm-br);color:var(--btn-fg);cursor:pointer;display:block;font-weight:bold;height:var(--bld-us);line-height:var(--bld-us);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.tp-p2dv_b:hover,.tp-btnv_b:hover,.tp-lstv_s:hover{background-color:var(--btn-bg-h)}.tp-p2dv_b:focus,.tp-btnv_b:focus,.tp-lstv_s:focus{background-color:var(--btn-bg-f)}.tp-p2dv_b:active,.tp-btnv_b:active,.tp-lstv_s:active{background-color:var(--btn-bg-a)}.tp-p2dv_b:disabled,.tp-btnv_b:disabled,.tp-lstv_s:disabled{opacity:.5}.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw{background-color:var(--in-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--bld-us);line-height:var(--bld-us);min-width:0;width:100%}.tp-txtv_i:hover,.tp-p2dpv_p:hover,.tp-colswv_sw:hover{background-color:var(--in-bg-h)}.tp-txtv_i:focus,.tp-p2dpv_p:focus,.tp-colswv_sw:focus{background-color:var(--in-bg-f)}.tp-txtv_i:active,.tp-p2dpv_p:active,.tp-colswv_sw:active{background-color:var(--in-bg-a)}.tp-txtv_i:disabled,.tp-p2dpv_p:disabled,.tp-colswv_sw:disabled{opacity:.5}.tp-mllv_i,.tp-sglv_i,.tp-grlv_g{background-color:var(--mo-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--mo-fg);height:var(--bld-us);scrollbar-color:currentColor rgba(0,0,0,0);scrollbar-width:thin;width:100%}.tp-mllv_i::-webkit-scrollbar,.tp-sglv_i::-webkit-scrollbar,.tp-grlv_g::-webkit-scrollbar{height:8px;width:8px}.tp-mllv_i::-webkit-scrollbar-corner,.tp-sglv_i::-webkit-scrollbar-corner,.tp-grlv_g::-webkit-scrollbar-corner{background-color:rgba(0,0,0,0)}.tp-mllv_i::-webkit-scrollbar-thumb,.tp-sglv_i::-webkit-scrollbar-thumb,.tp-grlv_g::-webkit-scrollbar-thumb{background-clip:padding-box;background-color:currentColor;border:rgba(0,0,0,0) solid 2px;border-radius:4px}.tp-rotv{--font-family: var(--tp-font-family, Roboto Mono, Source Code Pro, Menlo, Courier, monospace);--bs-br: var(--tp-base-border-radius, 6px);--cnt-h-p: var(--tp-container-horizontal-padding, 4px);--cnt-v-p: var(--tp-container-vertical-padding, 4px);--elm-br: var(--tp-element-border-radius, 2px);--bld-s: var(--tp-blade-spacing, 4px);--bld-us: var(--tp-blade-unit-size, 20px);--bs-bg: var(--tp-base-background-color, hsl(230, 7%, 17%));--bs-sh: var(--tp-base-shadow-color, rgba(0, 0, 0, 0.2));--btn-bg: var(--tp-button-background-color, hsl(230, 7%, 70%));--btn-bg-a: var(--tp-button-background-color-active, #d6d7db);--btn-bg-f: var(--tp-button-background-color-focus, #c8cad0);--btn-bg-h: var(--tp-button-background-color-hover, #bbbcc4);--btn-fg: var(--tp-button-foreground-color, hsl(230, 7%, 17%));--cnt-bg: var(--tp-container-background-color, rgba(187, 188, 196, 0.1));--cnt-bg-a: var(--tp-container-background-color-active, rgba(187, 188, 196, 0.25));--cnt-bg-f: var(--tp-container-background-color-focus, rgba(187, 188, 196, 0.2));--cnt-bg-h: var(--tp-container-background-color-hover, rgba(187, 188, 196, 0.15));--cnt-fg: var(--tp-container-foreground-color, hsl(230, 7%, 75%));--in-bg: var(--tp-input-background-color, rgba(187, 188, 196, 0.1));--in-bg-a: var(--tp-input-background-color-active, rgba(187, 188, 196, 0.25));--in-bg-f: var(--tp-input-background-color-focus, rgba(187, 188, 196, 0.2));--in-bg-h: var(--tp-input-background-color-hover, rgba(187, 188, 196, 0.15));--in-fg: var(--tp-input-foreground-color, hsl(230, 7%, 75%));--lbl-fg: var(--tp-label-foreground-color, rgba(187, 188, 196, 0.7));--mo-bg: var(--tp-monitor-background-color, rgba(0, 0, 0, 0.2));--mo-fg: var(--tp-monitor-foreground-color, rgba(187, 188, 196, 0.7));--grv-fg: var(--tp-groove-foreground-color, rgba(187, 188, 196, 0.1))}.tp-rotv_c>.tp-cntv.tp-v-lst,.tp-tabv_c .tp-brkv>.tp-cntv.tp-v-lst,.tp-fldv_c>.tp-cntv.tp-v-lst{margin-bottom:calc(-1*var(--cnt-v-p))}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-tabv_c .tp-brkv>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_c{border-bottom-left-radius:0}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-tabv_c .tp-brkv>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_b{border-bottom-left-radius:0}.tp-rotv_c>*:not(.tp-v-fst),.tp-tabv_c .tp-brkv>*:not(.tp-v-fst),.tp-fldv_c>*:not(.tp-v-fst){margin-top:var(--bld-s)}.tp-rotv_c>.tp-sprv:not(.tp-v-fst),.tp-tabv_c .tp-brkv>.tp-sprv:not(.tp-v-fst),.tp-fldv_c>.tp-sprv:not(.tp-v-fst),.tp-rotv_c>.tp-cntv:not(.tp-v-fst),.tp-tabv_c .tp-brkv>.tp-cntv:not(.tp-v-fst),.tp-fldv_c>.tp-cntv:not(.tp-v-fst){margin-top:var(--cnt-v-p)}.tp-rotv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-tabv_c .tp-brkv>.tp-sprv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-rotv_c>.tp-cntv+*:not(.tp-v-hidden),.tp-tabv_c .tp-brkv>.tp-cntv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-cntv+*:not(.tp-v-hidden){margin-top:var(--cnt-v-p)}.tp-rotv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-tabv_c .tp-brkv>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-fldv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-rotv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-tabv_c .tp-brkv>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-fldv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv{margin-top:0}.tp-tabv_c .tp-brkv>.tp-cntv,.tp-fldv_c>.tp-cntv{margin-left:4px}.tp-tabv_c .tp-brkv>.tp-fldv>.tp-fldv_b,.tp-fldv_c>.tp-fldv>.tp-fldv_b{border-top-left-radius:var(--elm-br);border-bottom-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv>.tp-fldv.tp-fldv-expanded>.tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-fldv-expanded>.tp-fldv_b{border-bottom-left-radius:0}.tp-tabv_c .tp-brkv .tp-fldv>.tp-fldv_c,.tp-fldv_c .tp-fldv>.tp-fldv_c{border-bottom-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv>.tp-cntv+.tp-fldv>.tp-fldv_b,.tp-fldv_c>.tp-cntv+.tp-fldv>.tp-fldv_b{border-top-left-radius:0}.tp-tabv_c .tp-brkv>.tp-cntv+.tp-tabv>.tp-tabv_t,.tp-fldv_c>.tp-cntv+.tp-tabv>.tp-tabv_t{border-top-left-radius:0}.tp-tabv_c .tp-brkv>.tp-tabv>.tp-tabv_t,.tp-fldv_c>.tp-tabv>.tp-tabv_t{border-top-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv .tp-tabv>.tp-tabv_c,.tp-fldv_c .tp-tabv>.tp-tabv_c{border-bottom-left-radius:var(--elm-br)}.tp-rotv_b,.tp-fldv_b{background-color:var(--cnt-bg);color:var(--cnt-fg);cursor:pointer;display:block;height:calc(var(--bld-us) + 4px);line-height:calc(var(--bld-us) + 4px);overflow:hidden;padding-left:var(--cnt-h-p);padding-right:calc(4px + var(--bld-us) + var(--cnt-h-p));position:relative;text-align:left;text-overflow:ellipsis;white-space:nowrap;width:100%;transition:border-radius .2s ease-in-out .2s}.tp-rotv_b:hover,.tp-fldv_b:hover{background-color:var(--cnt-bg-h)}.tp-rotv_b:focus,.tp-fldv_b:focus{background-color:var(--cnt-bg-f)}.tp-rotv_b:active,.tp-fldv_b:active{background-color:var(--cnt-bg-a)}.tp-rotv_b:disabled,.tp-fldv_b:disabled{opacity:.5}.tp-rotv_m,.tp-fldv_m{background:linear-gradient(to left, var(--cnt-fg), var(--cnt-fg) 2px, transparent 2px, transparent 4px, var(--cnt-fg) 4px);border-radius:2px;bottom:0;content:"";display:block;height:6px;right:calc(var(--cnt-h-p) + (var(--bld-us) + 4px - 6px)/2 - 2px);margin:auto;opacity:.5;position:absolute;top:0;transform:rotate(90deg);transition:transform .2s ease-in-out;width:6px}.tp-rotv.tp-rotv-expanded .tp-rotv_m,.tp-fldv.tp-fldv-expanded>.tp-fldv_b>.tp-fldv_m{transform:none}.tp-rotv_c,.tp-fldv_c{box-sizing:border-box;height:0;opacity:0;overflow:hidden;padding-bottom:0;padding-top:0;position:relative;transition:height .2s ease-in-out,opacity .2s linear,padding .2s ease-in-out}.tp-rotv.tp-rotv-cpl:not(.tp-rotv-expanded) .tp-rotv_c,.tp-fldv.tp-fldv-cpl:not(.tp-fldv-expanded)>.tp-fldv_c{display:none}.tp-rotv.tp-rotv-expanded .tp-rotv_c,.tp-fldv.tp-fldv-expanded>.tp-fldv_c{opacity:1;padding-bottom:var(--cnt-v-p);padding-top:var(--cnt-v-p);transform:none;overflow:visible;transition:height .2s ease-in-out,opacity .2s linear .2s,padding .2s ease-in-out}.tp-lstv,.tp-coltxtv_m{position:relative}.tp-lstv_s{padding:0 20px 0 4px;width:100%}.tp-lstv_m,.tp-coltxtv_mm{bottom:0;margin:auto;pointer-events:none;position:absolute;right:2px;top:0}.tp-lstv_m svg,.tp-coltxtv_mm svg{bottom:0;height:16px;margin:auto;position:absolute;right:0;top:0;width:16px}.tp-lstv_m svg path,.tp-coltxtv_mm svg path{fill:currentColor}.tp-pndtxtv,.tp-coltxtv_w{display:flex}.tp-pndtxtv_a,.tp-coltxtv_c{width:100%}.tp-pndtxtv_a+.tp-pndtxtv_a,.tp-coltxtv_c+.tp-pndtxtv_a,.tp-pndtxtv_a+.tp-coltxtv_c,.tp-coltxtv_c+.tp-coltxtv_c{margin-left:2px}.tp-btnv_b{width:100%}.tp-btnv_t{text-align:center}.tp-ckbv_l{display:block;position:relative}.tp-ckbv_i{left:0;opacity:0;position:absolute;top:0}.tp-ckbv_w{background-color:var(--in-bg);border-radius:var(--elm-br);cursor:pointer;display:block;height:var(--bld-us);position:relative;width:var(--bld-us)}.tp-ckbv_w svg{bottom:0;display:block;height:16px;left:0;margin:auto;opacity:0;position:absolute;right:0;top:0;width:16px}.tp-ckbv_w svg path{fill:none;stroke:var(--in-fg);stroke-width:2}.tp-ckbv_i:hover+.tp-ckbv_w{background-color:var(--in-bg-h)}.tp-ckbv_i:focus+.tp-ckbv_w{background-color:var(--in-bg-f)}.tp-ckbv_i:active+.tp-ckbv_w{background-color:var(--in-bg-a)}.tp-ckbv_i:checked+.tp-ckbv_w svg{opacity:1}.tp-ckbv.tp-v-disabled .tp-ckbv_w{opacity:.5}.tp-colv{position:relative}.tp-colv_h{display:flex}.tp-colv_s{flex-grow:0;flex-shrink:0;width:var(--bld-us)}.tp-colv_t{flex:1;margin-left:4px}.tp-colv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-colv.tp-colv-expanded.tp-colv-cpl .tp-colv_p{overflow:visible}.tp-colv.tp-colv-expanded .tp-colv_p{margin-top:var(--bld-s);opacity:1}.tp-colv .tp-popv{left:calc(-1*var(--cnt-h-p));right:calc(-1*var(--cnt-h-p));top:var(--bld-us)}.tp-colpv_h,.tp-colpv_ap{margin-left:6px;margin-right:6px}.tp-colpv_h{margin-top:var(--bld-s)}.tp-colpv_rgb{display:flex;margin-top:var(--bld-s);width:100%}.tp-colpv_a{display:flex;margin-top:var(--cnt-v-p);padding-top:calc(var(--cnt-v-p) + 2px);position:relative}.tp-colpv_a::before{background-color:var(--grv-fg);content:"";height:2px;left:calc(-1*var(--cnt-h-p));position:absolute;right:calc(-1*var(--cnt-h-p));top:0}.tp-colpv.tp-v-disabled .tp-colpv_a::before{opacity:.5}.tp-colpv_ap{align-items:center;display:flex;flex:3}.tp-colpv_at{flex:1;margin-left:4px}.tp-svpv{border-radius:var(--elm-br);outline:none;overflow:hidden;position:relative}.tp-svpv.tp-v-disabled{opacity:.5}.tp-svpv_c{cursor:crosshair;display:block;height:calc(var(--bld-us)*4);width:100%}.tp-svpv_m{border-radius:100%;border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;filter:drop-shadow(0 0 1px rgba(0, 0, 0, 0.3));height:12px;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;width:12px}.tp-svpv:focus .tp-svpv_m{border-color:#fff}.tp-hplv{cursor:pointer;height:var(--bld-us);outline:none;position:relative}.tp-hplv.tp-v-disabled{opacity:.5}.tp-hplv_c{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAABCAYAAABubagXAAAAQ0lEQVQoU2P8z8Dwn0GCgQEDi2OK/RBgYHjBgIpfovFh8j8YBIgzFGQxuqEgPhaDOT5gOhPkdCxOZeBg+IDFZZiGAgCaSSMYtcRHLgAAAABJRU5ErkJggg==);background-position:left top;background-repeat:no-repeat;background-size:100% 100%;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;position:absolute;top:50%;width:100%}.tp-hplv_m{border-radius:var(--elm-br);border:rgba(255,255,255,.75) solid 2px;box-shadow:0 0 2px rgba(0,0,0,.1);box-sizing:border-box;height:12px;left:50%;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;top:50%;width:12px}.tp-hplv:focus .tp-hplv_m{border-color:#fff}.tp-aplv{cursor:pointer;height:var(--bld-us);outline:none;position:relative;width:100%}.tp-aplv.tp-v-disabled{opacity:.5}.tp-aplv_b{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:4px 4px;background-position:0 0,2px 2px;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;overflow:hidden;position:absolute;top:50%;width:100%}.tp-aplv_c{bottom:0;left:0;position:absolute;right:0;top:0}.tp-aplv_m{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:12px 12px;background-position:0 0,6px 6px;border-radius:var(--elm-br);box-shadow:0 0 2px rgba(0,0,0,.1);height:12px;left:50%;margin-left:-6px;margin-top:-6px;overflow:hidden;pointer-events:none;position:absolute;top:50%;width:12px}.tp-aplv_p{border-radius:var(--elm-br);border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;bottom:0;left:0;position:absolute;right:0;top:0}.tp-aplv:focus .tp-aplv_p{border-color:#fff}.tp-colswv{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:10px 10px;background-position:0 0,5px 5px;border-radius:var(--elm-br);overflow:hidden}.tp-colswv.tp-v-disabled{opacity:.5}.tp-colswv_sw{border-radius:0}.tp-colswv_b{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:rgba(0,0,0,0);border-width:0;cursor:pointer;display:block;height:var(--bld-us);left:0;margin:0;outline:none;padding:0;position:absolute;top:0;width:var(--bld-us)}.tp-colswv_b:focus::after{border:rgba(255,255,255,.75) solid 2px;border-radius:var(--elm-br);bottom:0;content:"";display:block;left:0;position:absolute;right:0;top:0}.tp-coltxtv{display:flex;width:100%}.tp-coltxtv_m{margin-right:4px}.tp-coltxtv_ms{border-radius:var(--elm-br);color:var(--lbl-fg);cursor:pointer;height:var(--bld-us);line-height:var(--bld-us);padding:0 18px 0 4px}.tp-coltxtv_ms:hover{background-color:var(--in-bg-h)}.tp-coltxtv_ms:focus{background-color:var(--in-bg-f)}.tp-coltxtv_ms:active{background-color:var(--in-bg-a)}.tp-coltxtv_mm{color:var(--lbl-fg)}.tp-coltxtv.tp-v-disabled .tp-coltxtv_mm{opacity:.5}.tp-coltxtv_w{flex:1}.tp-dfwv{position:absolute;top:8px;right:8px;width:256px}.tp-fldv{position:relative}.tp-fldv.tp-fldv-not .tp-fldv_b{display:none}.tp-fldv_t{padding-left:4px}.tp-fldv_b:disabled .tp-fldv_m{display:none}.tp-fldv_c{padding-left:4px}.tp-fldv_i{bottom:0;color:var(--cnt-bg);left:0;overflow:hidden;position:absolute;top:calc(var(--bld-us) + 4px);width:var(--bs-br)}.tp-fldv_i::before{background-color:currentColor;bottom:0;content:"";left:0;position:absolute;top:0;width:4px}.tp-fldv_b:hover+.tp-fldv_i{color:var(--cnt-bg-h)}.tp-fldv_b:focus+.tp-fldv_i{color:var(--cnt-bg-f)}.tp-fldv_b:active+.tp-fldv_i{color:var(--cnt-bg-a)}.tp-fldv.tp-v-disabled>.tp-fldv_i{opacity:.5}.tp-grlv{position:relative}.tp-grlv_g{display:block;height:calc(var(--bld-us)*3)}.tp-grlv_g polyline{fill:none;stroke:var(--mo-fg);stroke-linejoin:round}.tp-grlv_t{margin-top:-4px;transition:left .05s,top .05s;visibility:hidden}.tp-grlv_t.tp-grlv_t-a{visibility:visible}.tp-grlv_t.tp-grlv_t-in{transition:none}.tp-grlv.tp-v-disabled .tp-grlv_g{opacity:.5}.tp-grlv .tp-ttv{background-color:var(--mo-fg)}.tp-grlv .tp-ttv::before{border-top-color:var(--mo-fg)}.tp-lblv{align-items:center;display:flex;line-height:1.3;padding-left:var(--cnt-h-p);padding-right:var(--cnt-h-p)}.tp-lblv.tp-lblv-nol{display:block}.tp-lblv_l{color:var(--lbl-fg);flex:1;-webkit-hyphens:auto;hyphens:auto;overflow:hidden;padding-left:4px;padding-right:16px}.tp-lblv.tp-v-disabled .tp-lblv_l{opacity:.5}.tp-lblv.tp-lblv-nol .tp-lblv_l{display:none}.tp-lblv_v{align-self:flex-start;flex-grow:0;flex-shrink:0;width:160px}.tp-lblv.tp-lblv-nol .tp-lblv_v{width:100%}.tp-lstv_s{padding:0 20px 0 4px;width:100%}.tp-lstv_m{color:var(--btn-fg)}.tp-sglv_i{padding:0 4px}.tp-sglv.tp-v-disabled .tp-sglv_i{opacity:.5}.tp-mllv_i{display:block;height:calc(var(--bld-us)*3);line-height:var(--bld-us);padding:0 4px;resize:none;white-space:pre}.tp-mllv.tp-v-disabled .tp-mllv_i{opacity:.5}.tp-p2dv{position:relative}.tp-p2dv_h{display:flex}.tp-p2dv_b{height:var(--bld-us);margin-right:4px;position:relative;width:var(--bld-us)}.tp-p2dv_b svg{display:block;height:16px;left:50%;margin-left:-8px;margin-top:-8px;position:absolute;top:50%;width:16px}.tp-p2dv_b svg path{stroke:currentColor;stroke-width:2}.tp-p2dv_b svg circle{fill:currentColor}.tp-p2dv_t{flex:1}.tp-p2dv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-p2dv.tp-p2dv-expanded .tp-p2dv_p{margin-top:var(--bld-s);opacity:1}.tp-p2dv .tp-popv{left:calc(-1*var(--cnt-h-p));right:calc(-1*var(--cnt-h-p));top:var(--bld-us)}.tp-p2dpv{padding-left:calc(var(--bld-us) + 4px)}.tp-p2dpv_p{cursor:crosshair;height:0;overflow:hidden;padding-bottom:100%;position:relative}.tp-p2dpv.tp-v-disabled .tp-p2dpv_p{opacity:.5}.tp-p2dpv_g{display:block;height:100%;left:0;pointer-events:none;position:absolute;top:0;width:100%}.tp-p2dpv_ax{opacity:.1;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_l{opacity:.5;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_m{border:var(--in-fg) solid 1px;border-radius:50%;box-sizing:border-box;height:4px;margin-left:-2px;margin-top:-2px;position:absolute;width:4px}.tp-p2dpv_p:focus .tp-p2dpv_m{background-color:var(--in-fg);border-width:0}.tp-popv{background-color:var(--bs-bg);border-radius:6px;box-shadow:0 2px 4px var(--bs-sh);display:none;max-width:168px;padding:var(--cnt-v-p) var(--cnt-h-p);position:absolute;visibility:hidden;z-index:1000}.tp-popv.tp-popv-v{display:block;visibility:visible}.tp-sprv_r{background-color:var(--grv-fg);border-width:0;display:block;height:2px;margin:0;width:100%}.tp-sprv.tp-v-disabled .tp-sprv_r{opacity:.5}.tp-sldv.tp-v-disabled{opacity:.5}.tp-sldv_t{box-sizing:border-box;cursor:pointer;height:var(--bld-us);margin:0 6px;outline:none;position:relative}.tp-sldv_t::before{background-color:var(--in-bg);border-radius:1px;bottom:0;content:"";display:block;height:2px;left:0;margin:auto;position:absolute;right:0;top:0}.tp-sldv_k{height:100%;left:0;position:absolute;top:0}.tp-sldv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:"";display:block;height:2px;left:0;margin-bottom:auto;margin-top:auto;position:absolute;right:0;top:0}.tp-sldv_k::after{background-color:var(--btn-bg);border-radius:var(--elm-br);bottom:0;content:"";display:block;height:12px;margin-bottom:auto;margin-top:auto;position:absolute;right:-6px;top:0;width:12px}.tp-sldv_t:hover .tp-sldv_k::after{background-color:var(--btn-bg-h)}.tp-sldv_t:focus .tp-sldv_k::after{background-color:var(--btn-bg-f)}.tp-sldv_t:active .tp-sldv_k::after{background-color:var(--btn-bg-a)}.tp-sldtxtv{display:flex}.tp-sldtxtv_s{flex:2}.tp-sldtxtv_t{flex:1;margin-left:4px}.tp-tabv{position:relative}.tp-tabv_t{align-items:flex-end;color:var(--cnt-bg);display:flex;overflow:hidden;position:relative}.tp-tabv_t:hover{color:var(--cnt-bg-h)}.tp-tabv_t:has(*:focus){color:var(--cnt-bg-f)}.tp-tabv_t:has(*:active){color:var(--cnt-bg-a)}.tp-tabv_t::before{background-color:currentColor;bottom:0;content:"";height:2px;left:0;pointer-events:none;position:absolute;right:0}.tp-tabv.tp-v-disabled .tp-tabv_t::before{opacity:.5}.tp-tabv.tp-tabv-nop .tp-tabv_t{height:calc(var(--bld-us) + 4px);position:relative}.tp-tabv.tp-tabv-nop .tp-tabv_t::before{background-color:var(--cnt-bg);bottom:0;content:"";height:2px;left:0;position:absolute;right:0}.tp-tabv_c{padding-bottom:var(--cnt-v-p);padding-left:4px;padding-top:var(--cnt-v-p)}.tp-tabv_i{bottom:0;color:var(--cnt-bg);left:0;overflow:hidden;position:absolute;top:calc(var(--bld-us) + 4px);width:var(--bs-br)}.tp-tabv_i::before{background-color:currentColor;bottom:0;content:"";left:0;position:absolute;top:0;width:4px}.tp-tabv_t:hover+.tp-tabv_i{color:var(--cnt-bg-h)}.tp-tabv_t:has(*:focus)+.tp-tabv_i{color:var(--cnt-bg-f)}.tp-tabv_t:has(*:active)+.tp-tabv_i{color:var(--cnt-bg-a)}.tp-tabv.tp-v-disabled>.tp-tabv_i{opacity:.5}.tp-tbiv{flex:1;min-width:0;position:relative}.tp-tbiv+.tp-tbiv{margin-left:2px}.tp-tbiv+.tp-tbiv.tp-v-disabled::before{opacity:.5}.tp-tbiv_b{display:block;padding-left:calc(var(--cnt-h-p) + 4px);padding-right:calc(var(--cnt-h-p) + 4px);position:relative;width:100%}.tp-tbiv_b:disabled{opacity:.5}.tp-tbiv_b::before{background-color:var(--cnt-bg);bottom:2px;content:"";left:0;pointer-events:none;position:absolute;right:0;top:0}.tp-tbiv_b:hover::before{background-color:var(--cnt-bg-h)}.tp-tbiv_b:focus::before{background-color:var(--cnt-bg-f)}.tp-tbiv_b:active::before{background-color:var(--cnt-bg-a)}.tp-tbiv_t{color:var(--cnt-fg);height:calc(var(--bld-us) + 4px);line-height:calc(var(--bld-us) + 4px);opacity:.5;overflow:hidden;text-overflow:ellipsis}.tp-tbiv.tp-tbiv-sel .tp-tbiv_t{opacity:1}.tp-txtv{position:relative}.tp-txtv_i{padding:0 4px}.tp-txtv.tp-txtv-fst .tp-txtv_i{border-bottom-right-radius:0;border-top-right-radius:0}.tp-txtv.tp-txtv-mid .tp-txtv_i{border-radius:0}.tp-txtv.tp-txtv-lst .tp-txtv_i{border-bottom-left-radius:0;border-top-left-radius:0}.tp-txtv.tp-txtv-num .tp-txtv_i{text-align:right}.tp-txtv.tp-txtv-drg .tp-txtv_i{opacity:.3}.tp-txtv_k{cursor:pointer;height:100%;left:-3px;position:absolute;top:0;width:12px}.tp-txtv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:"";height:calc(var(--bld-us) - 4px);left:50%;margin-bottom:auto;margin-left:-1px;margin-top:auto;opacity:.1;position:absolute;top:0;transition:border-radius .1s,height .1s,transform .1s,width .1s;width:2px}.tp-txtv_k:hover::before,.tp-txtv.tp-txtv-drg .tp-txtv_k::before{opacity:1}.tp-txtv.tp-txtv-drg .tp-txtv_k::before{border-radius:50%;height:4px;transform:translateX(-1px);width:4px}.tp-txtv_g{bottom:0;display:block;height:8px;left:50%;margin:auto;overflow:visible;pointer-events:none;position:absolute;top:0;visibility:hidden;width:100%}.tp-txtv.tp-txtv-drg .tp-txtv_g{visibility:visible}.tp-txtv_gb{fill:none;stroke:var(--in-fg);stroke-dasharray:1}.tp-txtv_gh{fill:none;stroke:var(--in-fg)}.tp-txtv .tp-ttv{margin-left:6px;visibility:hidden}.tp-txtv.tp-txtv-drg .tp-ttv{visibility:visible}.tp-ttv{background-color:var(--in-fg);border-radius:var(--elm-br);color:var(--bs-bg);padding:2px 4px;pointer-events:none;position:absolute;transform:translate(-50%, -100%)}.tp-ttv::before{border-color:var(--in-fg) rgba(0,0,0,0) rgba(0,0,0,0) rgba(0,0,0,0);border-style:solid;border-width:2px;box-sizing:border-box;content:"";font-size:.9em;height:4px;left:50%;margin-left:-2px;position:absolute;top:100%;width:4px}.tp-rotv{background-color:var(--bs-bg);border-radius:var(--bs-br);box-shadow:0 2px 4px var(--bs-sh);font-family:var(--font-family);font-size:11px;font-weight:500;line-height:1;text-align:left}.tp-rotv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br);border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br);padding-left:calc(4px + var(--bld-us) + var(--cnt-h-p));text-align:center}.tp-rotv.tp-rotv-expanded .tp-rotv_b{border-bottom-left-radius:0;border-bottom-right-radius:0}.tp-rotv.tp-rotv-not .tp-rotv_b{display:none}.tp-rotv_b:disabled .tp-rotv_m{display:none}.tp-rotv_c>.tp-fldv.tp-v-lst>.tp-fldv_c{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst>.tp-fldv_i{border-bottom-left-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c .tp-fldv.tp-v-vlst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-right-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst{margin-top:calc(-1*var(--cnt-v-p))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst>.tp-fldv_b{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv_c>.tp-tabv.tp-v-lst>.tp-tabv_c{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-tabv.tp-v-lst>.tp-tabv_i{border-bottom-left-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst{margin-top:calc(-1*var(--cnt-v-p))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst>.tp-tabv_t{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv.tp-v-disabled,.tp-rotv .tp-v-disabled{pointer-events:none}.tp-rotv.tp-v-hidden,.tp-rotv .tp-v-hidden{display:none}'),this.pool_.getAll().forEach(jt=>{this.embedPluginStyle_(jt)}),this.registerPlugin({plugins:[ao,dm,rp,Zl]})}},c.SeparatorApi=ro,c.SliderApi=h_,c.TabApi=Cs,c.TabPageApi=xs,c.TextApi=Ol,c.TpChangeEvent=v,c.VERSION=L0,Object.defineProperty(c,"__esModule",{value:!0})})(o)},161:function(h){h.exports=function(o,c,d){return o.length===0?o:c?(d||o.sort(c),function(_,v){for(var b=1,tt=_.length,it=_[0],nt=_[0],lt=1;lt<tt;++lt)if(nt=it,v(it=_[lt],nt)){if(lt===b){b++;continue}_[b++]=it}return _.length=b,_}(o,c)):(d||o.sort(),function(_){for(var v=1,b=_.length,tt=_[0],it=_[0],nt=1;nt<b;++nt,it=tt)if(it=tt,(tt=_[nt])!==it){if(nt===v){v++;continue}_[v++]=tt}return _.length=v,_}(o))}},957:function(__unused_webpack_module,__webpackgi_exports__,__webpackgi_require__){__webpackgi_require__.d(__webpackgi_exports__,{Z:function(){return DRACOLoader2}});var three_examples_jsm_loaders_DRACOLoader__WEBPACK_IMPORTED_MODULE_0__=__webpackgi_require__(149),three__WEBPACK_IMPORTED_MODULE_1__=__webpackgi_require__(848);class DRACOLoader2 extends three_examples_jsm_loaders_DRACOLoader__WEBPACK_IMPORTED_MODULE_0__.Z{constructor(h){super(h),this.encoderPending=null,this.encoderConfig={type:"js"},this.isDRACOLoader2=!0,this.setDecoderPath(DRACOLoader2.LIB_CDN_PATH),this.setDecoderConfig({type:"js"})}transform(h,o){return h?new three__WEBPACK_IMPORTED_MODULE_1__.eaF(h,new three__WEBPACK_IMPORTED_MODULE_1__._4j):void 0}preload(h=!0,o=!1){return h&&super.preload(),o&&this.initEncoder(),this}async initEncoder(){if(this.encoderPending)return this.encoderPending;const useJS=typeof WebAssembly!="object"||this.encoderConfig.type==="js",librariesPending=[],libLoader=this._loadLibrary.bind(this);return useJS?librariesPending.push(libLoader("draco_encoder.js","text")):(librariesPending.push(libLoader("draco_wasm_wrapper.js","text")),librariesPending.push(libLoader("draco_encoder.wasm","arraybuffer"))),this.encoderPending=Promise.all(librariesPending).then(libraries=>{var _a;const jsContent=libraries[0];return useJS||(this.encoderConfig.wasmBinary=libraries[1]),(_a=eval(jsContent+`
DracoEncoderModule;`))===null||_a===void 0?void 0:_a()}),this.encoderPending}async initDecoder(){var _a;await this._initDecoder();const jsContent=await fetch(this.workerSourceURL).then(async h=>h.text()).then(h=>{const o=h.indexOf("/* worker */");if(o<1)throw new Error("unable to load decoder module");return h.substring(0,o-1)});return(_a=eval(jsContent+`
DracoDecoderModule;`))===null||_a===void 0?void 0:_a()}async _loadLibrary(h,o){return DRACOLoader2.LibraryValueMap[h]?DRACOLoader2.LibraryValueMap[h]:DRACOLoader2.LibraryValueMap[h]=await super._loadLibrary(h,o)}static SetDecoderJsString(h){this.LibraryValueMap["draco_decoder.js"]=h}}DRACOLoader2.LIB_CDN_PATH="https://cdn.jsdelivr.net/gh/google/draco@1.4.1/javascript/",DRACOLoader2.LibraryValueMap={}},848:function(h,o,c){c.d(o,{$EB:function(){return xt},$Kf:function(){return Y0},$NF:function(){return O_},$O9:function(){return Vn},$_I:function(){return Kn},$ei:function(){return Yt},$p8:function(){return RA},A$4:function(){return os},AKb:function(){return AE},ALV:function(){return R0},AT1:function(){return s_},Am1:function(){return OE},B69:function(){return Ss},B6O:function(){return $x},BH$:function(){return J0},BKk:function(){return Fl},BND:function(){return gS},BRH:function(){return TE},BXX:function(){return jp},B_h:function(){return nu},BdL:function(){return j0},CMB:function(){return Ml},CR7:function(){return Q_},CSG:function(){return V0},CV9:function(){return oy},CVz:function(){return z_},CWW:function(){return sp},Cfg:function(){return Hn},CmU:function(){return LA},CwR:function(){return zE},D$Q:function(){return uA},DAe:function(){return Xp},DAr:function(){return no},DXC:function(){return _c},Df:function(){return dA},E0M:function(){return fS},EAD:function(){return Bv},EQC:function(){return $p},EZo:function(){return Rt},EdD:function(){return Gt},F1T:function(){return Gy},F1l:function(){return oS},FCc:function(){return Vx},FFZ:function(){return Y_},FNr:function(){return _A},FV:function(){return Pr},FXf:function(){return Nt},FZo:function(){return BA},Fn:function(){return np},Fpm:function(){return sS},FvD:function(){return Uv},Fvt:function(){return fA},G3T:function(){return Pu},GBG:function(){return AA},GJx:function(){return xn},GOR:function(){return pE},GTy:function(){return St},GWd:function(){return io},GYF:function(){return Pm},GZZ:function(){return sy},G_z:function(){return gA},Gu$:function(){return R_},Gwm:function(){return Jr},GxU:function(){return Mt},H23:function(){return Um},HLH:function(){return Qm},HO_:function(){return zm},HPb:function(){return qm},HXV:function(){return Bm},HgN:function(){return e_},HiM:function(){return MA},Hit:function(){return D_},Ho_:function(){return Im},Hrb:function(){return zn},Hrq:function(){return J_},I46:function(){return Dx},I9Y:function(){return dn},IE4:function(){return _l},IUQ:function(){return Is},IWo:function(){return mS},Ipv:function(){return Ul},Iw4:function(){return XE},IzY:function(){return vS},JeP:function(){return yx},Jnc:function(){return it},K52:function(){return on},KDk:function(){return Ho},KLL:function(){return Ns},KPJ:function(){return fy},KRh:function(){return Gn},Ke9:function(){return Vm},Kef:function(){return V_},Ktl:function(){return K_},Kwu:function(){return kt},Kzg:function(){return LE},Kzv:function(){return Es},Ld9:function(){return yS},LiQ:function(){return or},LlO:function(){return jy},LoY:function(){return _s},LuO:function(){return JE},MBL:function(){return km},MOq:function(){return Zp},MSw:function(){return r0},MW4:function(){return vo},Mjd:function(){return Cr},N1A:function(){return Yu},N2s:function(){return WA},N5j:function(){return Hm},NRn:function(){return xl},NTi:function(){return Pt},NZq:function(){return zs},Nt7:function(){return cr},Nv2:function(){return oE},Nwf:function(){return Ps},Nz6:function(){return rp},O0B:function(){return rv},O3Y:function(){return n0},O49:function(){return H_},O9p:function(){return Vu},ONl:function(){return Qx},OUM:function(){return js},Oax:function(){return Eo},Om:function(){return Tn},OuU:function(){return hr},P5j:function(){return qE},PFK:function(){return hS},PJ3:function(){return ap},PPD:function(){return xv},PTz:function(){return wo},Pdi:function(){return bA},Pem:function(){return lE},Pf$:function(){return UE},Pq0:function(){return Er},Q1f:function(){return Un},QCA:function(){return Zv},QP0:function(){return ut},Qev:function(){return mo},Qrf:function(){return ip},R1W:function(){return cS},RJ4:function(){return Il},ROr:function(){return E0},RQf:function(){return to},RcT:function(){return Hl},RiT:function(){return B_},Riy:function(){return iu},Rkk:function(){return lp},RlV:function(){return ju},RoJ:function(){return W0},Ru$:function(){return S0},RyA:function(){return _t},S$4:function(){return Wp},S20:function(){return jv},S2Q:function(){return Rl},S3G:function(){return bx},SUR:function(){return OA},ScU:function(){return PE},T6I:function(){return _y},TDQ:function(){return Zx},THS:function(){return mr},TMh:function(){return $m},Tap:function(){return ME},TdN:function(){return Uo},TiK:function(){return q_},TkQ:function(){return Mo},U3G:function(){return Xr},UJ6:function(){return Gl},UPV:function(){return s0},UTZ:function(){return jr},Ua6:function(){return _h},Ufg:function(){return I_},UpK:function(){return Px},UtB:function(){return iS},UtX:function(){return Ay},V3x:function(){return Rn},V58:function(){return m_},V5c:function(){return cp},V9B:function(){return Zl},VCu:function(){return vx},VT0:function(){return xs},VVr:function(){return Yp},Vb5:function(){return tt},VnP:function(){return Kx},Vnu:function(){return pu},VxR:function(){return Ds},W9U:function(){return jm},WBB:function(){return e0},WNZ:function(){return b},WTh:function(){return dS},Wdf:function(){return Xm},Wew:function(){return ro},Wk7:function(){return ht},Wyr:function(){return Wl},XG_:function(){return Gm},XIg:function(){return wt},XJ7:function(){return aA},XTe:function(){return DE},XrR:function(){return ms},Y9S:function(){return tu},YHV:function(){return tS},YJl:function(){return xm},YOZ:function(){return Mp},YRT:function(){return CE},Yhb:function(){return xA},Yuy:function(){return tp},Z0B:function(){return ny},Z58:function(){return xx},ZLX:function(){return Nx},ZM4:function(){return _S},ZQM:function(){return Cs},Zcv:function(){return Xu},Zpd:function(){return i0},Zr2:function(){return Ws},ZyN:function(){return IA},_4j:function(){return hy},_QJ:function(){return Vp},_xc:function(){return aS},a$r:function(){return Rs},a5J:function(){return su},aEY:function(){return fr},aHM:function(){return zo},aMy:function(){return Tu},aVO:function(){return H0},agE:function(){return ku},amv:function(){return cu},b4q:function(){return g_},bC7:function(){return Qp},bCz:function(){return Dt},bI3:function(){return yl},bTm:function(){return lt},baL:function(){return Wr},bdM:function(){return __},bkx:function(){return po},brA:function(){return dr},bw0:function(){return Pn},c5h:function(){return uE},c90:function(){return bo},cHt:function(){return To},cRK:function(){return Pv},cZY:function(){return nS},caT:function(){return vn},cj9:function(){return _f},czI:function(){return zp},dAo:function(){return ay},dYF:function(){return n_},dcC:function(){return Qs},dhZ:function(){return op},dth:function(){return EA},dwI:function(){return as},dzP:function(){return KE},eB$:function(){return Mv},eHc:function(){return gr},eHs:function(){return Sp},eaF:function(){return lo},eoi:function(){return $_},er$:function(){return Os},ezk:function(){return gy},f4X:function(){return lr},fBL:function(){return eo},fCn:function(){return kn},fJr:function(){return Wm},fP5:function(){return HA},fTw:function(){return uS},fc6:function(){return _n},g7M:function(){return Dr},gJ2:function(){return Tl},gO9:function(){return It},gPd:function(){return Us},gWB:function(){return Ql},ghU:function(){return fn},h2z:function(){return ou},hB5:function(){return ft},hIf:function(){return Jp},hZF:function(){return Ip},h_9:function(){return wA},hdd:function(){return ur},hfX:function(){return _x},hgQ:function(){return kr},hjs:function(){return rS},hsX:function(){return bt},hxR:function(){return tn},hy7:function(){return en},hzE:function(){return pS},i7d:function(){return yv},i7u:function(){return Qo},iNn:function(){return $u},iOZ:function(){return cE},iUH:function(){return $n},ibB:function(){return qx},ie2:function(){return pr},imn:function(){return so},ix0:function(){return ba},iyt:function(){return jo},j6:function(){return a0},jGm:function(){return Jx},jR7:function(){return Up},jUj:function(){return Tv},jf0:function(){return ks},jsO:function(){return Kp},jut:function(){return o0},jzd:function(){return X_},k6Q:function(){return Dm},k6q:function(){return Qn},kBv:function(){return _},kEx:function(){return SE},kG0:function(){return up},kLi:function(){return Wo},kO0:function(){return dp},kRr:function(){return jn},kTW:function(){return En},kTp:function(){return Gp},kYr:function(){return pp},keZ:function(){return NE},klZ:function(){return W_},kn4:function(){return rs},kqe:function(){return Fo},kxk:function(){return Sx},kyO:function(){return vr},l2R:function(){return bu},lGu:function(){return tr},lGw:function(){return k_},lMl:function(){return fo},lPF:function(){return Jm},lc7:function(){return qp},ljd:function(){return Mu},lyL:function(){return Hp},mrM:function(){return Lo},nCl:function(){return PA},nEu:function(){return Wv},nNL:function(){return Ur},nST:function(){return Vt},nWS:function(){return Ao},nZQ:function(){return fx},nc$:function(){return Sy},nzx:function(){return C_},o6l:function(){return zy},oVO:function(){return C0},oh6:function(){return ZE},ojh:function(){return nr},ojs:function(){return Cu},pBf:function(){return Lm},pFK:function(){return Ku},pHI:function(){return wn},pPE:function(){return qA},paN:function(){return No},ppV:function(){return Ms},psI:function(){return Om},q2:function(){return cA},qBx:function(){return mA},qFE:function(){return Qv},qIQ:function(){return lu},qU7:function(){return Vv},qUd:function(){return wv},qa3:function(){return Vl},qad:function(){return rr},qtW:function(){return Ln},r6x:function(){return xy},rFo:function(){return im},rKP:function(){return t0},rOG:function(){return gs},rQf:function(){return au},rSH:function(){return Su},rYR:function(){return A0},s0K:function(){return Yx},sKt:function(){return hp},sPf:function(){return d},tBo:function(){return eS},tJf:function(){return qs},tXL:function(){return hA},tcD:function(){return Hv},tgE:function(){return Ys},tz3:function(){return L_},uB5:function(){return Nm},uSd:function(){return pA},uV5:function(){return bn},uWO:function(){return Tm},uXQ:function(){return P0},ubm:function(){return yo},uov:function(){return T0},ure:function(){return kA},veJ:function(){return Ju},vim:function(){return uu},vmz:function(){return Zs},vxI:function(){return hs},vyJ:function(){return Iu},wAk:function(){return S_},wfO:function(){return mn},wn6:function(){return br},wqq:function(){return Ru},wrO:function(){return On},wtR:function(){return v},wvS:function(){return Sr},xFO:function(){return rn},xJ6:function(){return eu},xOk:function(){return DA},xSv:function(){return Ir},xZx:function(){return GE},xfg:function(){return ly},y3Z:function(){return Fm},y9J:function(){return i_},y_p:function(){return ar},ypk:function(){return Cp},ywQ:function(){return nt},z5:function(){return Vs},zD7:function(){return GA},zdS:function(){return ho},zgK:function(){return cm},zkh:function(){return Go},znC:function(){return Kt}});const d="157",_={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},v={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},b=0,tt=1,it=2,nt=3,lt=0,ut=1,ht=2,_t=3,ft=0,bt=1,xt=2,St=2,wt=0,Pt=1,Rt=2,kt=3,Gt=4,Dt=5,It=100,Nt=101,Vt=102,Kt=103,Yt=104,nr=200,rr=201,lr=202,or=203,pr=204,hr=205,ur=206,cr=207,br=208,fr=209,kr=210,gr=0,tr=1,dr=2,Ir=3,Xr=4,Jr=5,on=6,Pn=7,vn=0,Gn=1,ms=2,ar=0,vr=1,Cr=2,Ur=3,Pr=4,Dr=5,jr=300,en=301,rn=302,mn=303,bn=304,Tn=306,xn=1e3,fn=1001,En=1002,tn=1003,wn=1004,Vn=1004,Hn=1005,Rs=1005,Qn=1006,jn=1007,$n=1007,Kn=1008,zs=1008,js=1009,qs=1010,eo=1011,To=1012,tp=1013,po=1014,to=1015,ba=1016,ro=1017,Tl=1018,Rn=1020,On=1021,io=1023,Es=1024,Ml=1025,ho=1026,Qs=1027,xs=1028,Cs=1029,No=1030,Mo=1031,bo=1033,_l=33776,rp=33777,Up=33778,jp=33779,Dm=35840,Gp=35841,Bm=35842,Lm=35843,z_=36196,iu=37492,Ho=37496,Vl=37808,nu=37809,zp=37810,Su=37811,ip=37812,Om=37813,su=37814,Vp=37815,Nm=37816,Hp=37817,Qp=37818,Fm=37819,Cu=37820,Wp=37821,np=36492,Um=36494,jm=36495,V_=36283,Gm=36284,zm=36285,sp=36286,Pu=2200,Tu=2201,qp=2202,Mu=2300,ap=2301,$p=2302,au=2400,ou=2401,op=2402,Vm=2500,Xp=2501,Il=0,H_=1,A0=2,Ys=3e3,Rl=3001,lp=3200,Hm=3201,yl=0,Iu=1,ks="",Os="srgb",Ws="srgb-linear",cp="display-p3",lu="display-p3-linear",no="rgbm-16",Ds="linear",Ns="srgb",Vs="rec709",Ru="p3",Fo=0,Yp=7680,up=7681,Qm=7682,E0=7683,S0=34055,Wm=34056,C0=5386,qm=512,pp=513,Kp=514,Q_=515,Hl=516,W_=517,$m=518,hp=519,cu=512,uu=513,dp=514,q_=515,$_=516,X_=517,Ql=518,Y_=519,ku=35044,pu=35048,K_=35040,P0=35045,Jp=35049,T0=35041,J_=35046,Zp=35050,gs=35042,Wl="100",Xm="300 es",_h=1035,Uo=2e3,Qo=2001;class mo{addEventListener(_e,at){this._listeners===void 0&&(this._listeners={});const pt=this._listeners;pt[_e]===void 0&&(pt[_e]=[]),pt[_e].indexOf(at)===-1&&pt[_e].push(at)}hasEventListener(_e,at){if(this._listeners===void 0)return!1;const pt=this._listeners;return pt[_e]!==void 0&&pt[_e].indexOf(at)!==-1}removeEventListener(_e,at){if(this._listeners===void 0)return;const pt=this._listeners[_e];if(pt!==void 0){const mt=pt.indexOf(at);mt!==-1&&pt.splice(mt,1)}}dispatchEvent(_e){if(this._listeners===void 0)return;const at=this._listeners[_e.type];if(at!==void 0){_e.target=this;const pt=at.slice(0);for(let mt=0,vt=pt.length;mt<vt;mt++)pt[mt].call(this,_e);_e.target=null}}}const Fs=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let Z_=1234567;const $l=Math.PI/180,hu=180/Math.PI;function xo(){const Et=4294967295*Math.random()|0,_e=4294967295*Math.random()|0,at=4294967295*Math.random()|0,pt=4294967295*Math.random()|0;return(Fs[255&Et]+Fs[Et>>8&255]+Fs[Et>>16&255]+Fs[Et>>24&255]+"-"+Fs[255&_e]+Fs[_e>>8&255]+"-"+Fs[_e>>16&15|64]+Fs[_e>>24&255]+"-"+Fs[63&at|128]+Fs[at>>8&255]+"-"+Fs[at>>16&255]+Fs[at>>24&255]+Fs[255&pt]+Fs[pt>>8&255]+Fs[pt>>16&255]+Fs[pt>>24&255]).toLowerCase()}function Hs(Et,_e,at){return Math.max(_e,Math.min(at,Et))}function _d(Et,_e){return(Et%_e+_e)%_e}function Du(Et,_e,at){return(1-at)*Et+at*_e}function em(Et){return!(Et&Et-1)&&Et!==0}function Ym(Et){return Math.pow(2,Math.ceil(Math.log(Et)/Math.LN2))}function mp(Et){return Math.pow(2,Math.floor(Math.log(Et)/Math.LN2))}function go(Et,_e){switch(_e.constructor){case Float32Array:return Et;case Uint32Array:return Et/4294967295;case Uint16Array:return Et/65535;case Uint8Array:return Et/255;case Int32Array:return Math.max(Et/2147483647,-1);case Int16Array:return Math.max(Et/32767,-1);case Int8Array:return Math.max(Et/127,-1);default:throw new Error("Invalid component type.")}}function ns(Et,_e){switch(_e.constructor){case Float32Array:return Et;case Uint32Array:return Math.round(4294967295*Et);case Uint16Array:return Math.round(65535*Et);case Uint8Array:return Math.round(255*Et);case Int32Array:return Math.round(2147483647*Et);case Int16Array:return Math.round(32767*Et);case Int8Array:return Math.round(127*Et);default:throw new Error("Invalid component type.")}}const _f={DEG2RAD:$l,RAD2DEG:hu,generateUUID:xo,clamp:Hs,euclideanModulo:_d,mapLinear:function(Et,_e,at,pt,mt){return pt+(Et-_e)*(mt-pt)/(at-_e)},inverseLerp:function(Et,_e,at){return Et!==_e?(at-Et)/(_e-Et):0},lerp:Du,damp:function(Et,_e,at,pt){return Du(Et,_e,1-Math.exp(-at*pt))},pingpong:function(Et,_e=1){return _e-Math.abs(_d(Et,2*_e)-_e)},smoothstep:function(Et,_e,at){return Et<=_e?0:Et>=at?1:(Et=(Et-_e)/(at-_e))*Et*(3-2*Et)},smootherstep:function(Et,_e,at){return Et<=_e?0:Et>=at?1:(Et=(Et-_e)/(at-_e))*Et*Et*(Et*(6*Et-15)+10)},randInt:function(Et,_e){return Et+Math.floor(Math.random()*(_e-Et+1))},randFloat:function(Et,_e){return Et+Math.random()*(_e-Et)},randFloatSpread:function(Et){return Et*(.5-Math.random())},seededRandom:function(Et){Et!==void 0&&(Z_=Et);let _e=Z_+=1831565813;return _e=Math.imul(_e^_e>>>15,1|_e),_e^=_e+Math.imul(_e^_e>>>7,61|_e),((_e^_e>>>14)>>>0)/4294967296},degToRad:function(Et){return Et*$l},radToDeg:function(Et){return Et*hu},isPowerOfTwo:em,ceilPowerOfTwo:Ym,floorPowerOfTwo:mp,setQuaternionFromProperEuler:function(Et,_e,at,pt,mt){const vt=Math.cos,Ct=Math.sin,Tt=vt(at/2),Bt=Ct(at/2),Lt=vt((_e+pt)/2),Ut=Ct((_e+pt)/2),Qt=vt((_e-pt)/2),Ht=Ct((_e-pt)/2),Wt=vt((pt-_e)/2),qt=Ct((pt-_e)/2);switch(mt){case"XYX":Et.set(Tt*Ut,Bt*Qt,Bt*Ht,Tt*Lt);break;case"YZY":Et.set(Bt*Ht,Tt*Ut,Bt*Qt,Tt*Lt);break;case"ZXZ":Et.set(Bt*Qt,Bt*Ht,Tt*Ut,Tt*Lt);break;case"XZX":Et.set(Tt*Ut,Bt*qt,Bt*Wt,Tt*Lt);break;case"YXY":Et.set(Bt*Wt,Tt*Ut,Bt*qt,Tt*Lt);break;case"ZYZ":Et.set(Bt*qt,Bt*Wt,Tt*Ut,Tt*Lt);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+mt)}},normalize:ns,denormalize:go};class dn{constructor(_e=0,at=0){dn.prototype.isVector2=!0,this.x=_e,this.y=at}get width(){return this.x}set width(_e){this.x=_e}get height(){return this.y}set height(_e){this.y=_e}set(_e,at){return this.x=_e,this.y=at,this}setScalar(_e){return this.x=_e,this.y=_e,this}setX(_e){return this.x=_e,this}setY(_e){return this.y=_e,this}setComponent(_e,at){switch(_e){case 0:this.x=at;break;case 1:this.y=at;break;default:throw new Error("index is out of range: "+_e)}return this}getComponent(_e){switch(_e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+_e)}}clone(){return new this.constructor(this.x,this.y)}copy(_e){return this.x=_e.x,this.y=_e.y,this}add(_e){return this.x+=_e.x,this.y+=_e.y,this}addScalar(_e){return this.x+=_e,this.y+=_e,this}addVectors(_e,at){return this.x=_e.x+at.x,this.y=_e.y+at.y,this}addScaledVector(_e,at){return this.x+=_e.x*at,this.y+=_e.y*at,this}sub(_e){return this.x-=_e.x,this.y-=_e.y,this}subScalar(_e){return this.x-=_e,this.y-=_e,this}subVectors(_e,at){return this.x=_e.x-at.x,this.y=_e.y-at.y,this}multiply(_e){return this.x*=_e.x,this.y*=_e.y,this}multiplyScalar(_e){return this.x*=_e,this.y*=_e,this}divide(_e){return this.x/=_e.x,this.y/=_e.y,this}divideScalar(_e){return this.multiplyScalar(1/_e)}applyMatrix3(_e){const at=this.x,pt=this.y,mt=_e.elements;return this.x=mt[0]*at+mt[3]*pt+mt[6],this.y=mt[1]*at+mt[4]*pt+mt[7],this}min(_e){return this.x=Math.min(this.x,_e.x),this.y=Math.min(this.y,_e.y),this}max(_e){return this.x=Math.max(this.x,_e.x),this.y=Math.max(this.y,_e.y),this}clamp(_e,at){return this.x=Math.max(_e.x,Math.min(at.x,this.x)),this.y=Math.max(_e.y,Math.min(at.y,this.y)),this}clampScalar(_e,at){return this.x=Math.max(_e,Math.min(at,this.x)),this.y=Math.max(_e,Math.min(at,this.y)),this}clampLength(_e,at){const pt=this.length();return this.divideScalar(pt||1).multiplyScalar(Math.max(_e,Math.min(at,pt)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(_e){return this.x*_e.x+this.y*_e.y}cross(_e){return this.x*_e.y-this.y*_e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(_e){const at=Math.sqrt(this.lengthSq()*_e.lengthSq());if(at===0)return Math.PI/2;const pt=this.dot(_e)/at;return Math.acos(Hs(pt,-1,1))}distanceTo(_e){return Math.sqrt(this.distanceToSquared(_e))}distanceToSquared(_e){const at=this.x-_e.x,pt=this.y-_e.y;return at*at+pt*pt}manhattanDistanceTo(_e){return Math.abs(this.x-_e.x)+Math.abs(this.y-_e.y)}setLength(_e){return this.normalize().multiplyScalar(_e)}lerp(_e,at){return this.x+=(_e.x-this.x)*at,this.y+=(_e.y-this.y)*at,this}lerpVectors(_e,at,pt){return this.x=_e.x+(at.x-_e.x)*pt,this.y=_e.y+(at.y-_e.y)*pt,this}equals(_e){return _e.x===this.x&&_e.y===this.y}fromArray(_e,at=0){return this.x=_e[at],this.y=_e[at+1],this}toArray(_e=[],at=0){return _e[at]=this.x,_e[at+1]=this.y,_e}fromBufferAttribute(_e,at){return this.x=_e.getX(at),this.y=_e.getY(at),this}rotateAround(_e,at){const pt=Math.cos(at),mt=Math.sin(at),vt=this.x-_e.x,Ct=this.y-_e.y;return this.x=vt*pt-Ct*mt+_e.x,this.y=vt*mt+Ct*pt+_e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class as{constructor(_e,at,pt,mt,vt,Ct,Tt,Bt,Lt){as.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],_e!==void 0&&this.set(_e,at,pt,mt,vt,Ct,Tt,Bt,Lt)}set(_e,at,pt,mt,vt,Ct,Tt,Bt,Lt){const Ut=this.elements;return Ut[0]=_e,Ut[1]=mt,Ut[2]=Tt,Ut[3]=at,Ut[4]=vt,Ut[5]=Bt,Ut[6]=pt,Ut[7]=Ct,Ut[8]=Lt,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(_e){const at=this.elements,pt=_e.elements;return at[0]=pt[0],at[1]=pt[1],at[2]=pt[2],at[3]=pt[3],at[4]=pt[4],at[5]=pt[5],at[6]=pt[6],at[7]=pt[7],at[8]=pt[8],this}extractBasis(_e,at,pt){return _e.setFromMatrix3Column(this,0),at.setFromMatrix3Column(this,1),pt.setFromMatrix3Column(this,2),this}setFromMatrix4(_e){const at=_e.elements;return this.set(at[0],at[4],at[8],at[1],at[5],at[9],at[2],at[6],at[10]),this}multiply(_e){return this.multiplyMatrices(this,_e)}premultiply(_e){return this.multiplyMatrices(_e,this)}multiplyMatrices(_e,at){const pt=_e.elements,mt=at.elements,vt=this.elements,Ct=pt[0],Tt=pt[3],Bt=pt[6],Lt=pt[1],Ut=pt[4],Qt=pt[7],Ht=pt[2],Wt=pt[5],qt=pt[8],Jt=mt[0],Xt=mt[3],sr=mt[6],Zt=mt[1],er=mt[4],xr=mt[7],Ar=mt[2],yr=mt[5],Tr=mt[8];return vt[0]=Ct*Jt+Tt*Zt+Bt*Ar,vt[3]=Ct*Xt+Tt*er+Bt*yr,vt[6]=Ct*sr+Tt*xr+Bt*Tr,vt[1]=Lt*Jt+Ut*Zt+Qt*Ar,vt[4]=Lt*Xt+Ut*er+Qt*yr,vt[7]=Lt*sr+Ut*xr+Qt*Tr,vt[2]=Ht*Jt+Wt*Zt+qt*Ar,vt[5]=Ht*Xt+Wt*er+qt*yr,vt[8]=Ht*sr+Wt*xr+qt*Tr,this}multiplyScalar(_e){const at=this.elements;return at[0]*=_e,at[3]*=_e,at[6]*=_e,at[1]*=_e,at[4]*=_e,at[7]*=_e,at[2]*=_e,at[5]*=_e,at[8]*=_e,this}determinant(){const _e=this.elements,at=_e[0],pt=_e[1],mt=_e[2],vt=_e[3],Ct=_e[4],Tt=_e[5],Bt=_e[6],Lt=_e[7],Ut=_e[8];return at*Ct*Ut-at*Tt*Lt-pt*vt*Ut+pt*Tt*Bt+mt*vt*Lt-mt*Ct*Bt}invert(){const _e=this.elements,at=_e[0],pt=_e[1],mt=_e[2],vt=_e[3],Ct=_e[4],Tt=_e[5],Bt=_e[6],Lt=_e[7],Ut=_e[8],Qt=Ut*Ct-Tt*Lt,Ht=Tt*Bt-Ut*vt,Wt=Lt*vt-Ct*Bt,qt=at*Qt+pt*Ht+mt*Wt;if(qt===0)return this.set(0,0,0,0,0,0,0,0,0);const Jt=1/qt;return _e[0]=Qt*Jt,_e[1]=(mt*Lt-Ut*pt)*Jt,_e[2]=(Tt*pt-mt*Ct)*Jt,_e[3]=Ht*Jt,_e[4]=(Ut*at-mt*Bt)*Jt,_e[5]=(mt*vt-Tt*at)*Jt,_e[6]=Wt*Jt,_e[7]=(pt*Bt-Lt*at)*Jt,_e[8]=(Ct*at-pt*vt)*Jt,this}transpose(){let _e;const at=this.elements;return _e=at[1],at[1]=at[3],at[3]=_e,_e=at[2],at[2]=at[6],at[6]=_e,_e=at[5],at[5]=at[7],at[7]=_e,this}getNormalMatrix(_e){return this.setFromMatrix4(_e).invert().transpose()}transposeIntoArray(_e){const at=this.elements;return _e[0]=at[0],_e[1]=at[3],_e[2]=at[6],_e[3]=at[1],_e[4]=at[4],_e[5]=at[7],_e[6]=at[2],_e[7]=at[5],_e[8]=at[8],this}setUvTransform(_e,at,pt,mt,vt,Ct,Tt){const Bt=Math.cos(vt),Lt=Math.sin(vt);return this.set(pt*Bt,pt*Lt,-pt*(Bt*Ct+Lt*Tt)+Ct+_e,-mt*Lt,mt*Bt,-mt*(-Lt*Ct+Bt*Tt)+Tt+at,0,0,1),this}scale(_e,at){return this.premultiply(tm.makeScale(_e,at)),this}rotate(_e){return this.premultiply(tm.makeRotation(-_e)),this}translate(_e,at){return this.premultiply(tm.makeTranslation(_e,at)),this}makeTranslation(_e,at){return _e.isVector2?this.set(1,0,_e.x,0,1,_e.y,0,0,1):this.set(1,0,_e,0,1,at,0,0,1),this}makeRotation(_e){const at=Math.cos(_e),pt=Math.sin(_e);return this.set(at,-pt,0,pt,at,0,0,0,1),this}makeScale(_e,at){return this.set(_e,0,0,0,at,0,0,0,1),this}equals(_e){const at=this.elements,pt=_e.elements;for(let mt=0;mt<9;mt++)if(at[mt]!==pt[mt])return!1;return!0}fromArray(_e,at=0){for(let pt=0;pt<9;pt++)this.elements[pt]=_e[pt+at];return this}toArray(_e=[],at=0){const pt=this.elements;return _e[at]=pt[0],_e[at+1]=pt[1],_e[at+2]=pt[2],_e[at+3]=pt[3],_e[at+4]=pt[4],_e[at+5]=pt[5],_e[at+6]=pt[6],_e[at+7]=pt[7],_e[at+8]=pt[8],_e}clone(){return new this.constructor().fromArray(this.elements)}}const tm=new as;function ev(Et){for(let _e=Et.length-1;_e>=0;--_e)if(Et[_e]>=65535)return!0;return!1}const Km={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function du(Et,_e){return new Km[Et](_e)}function mu(Et){return document.createElementNS("http://www.w3.org/1999/xhtml",Et)}function Jm(){const Et=mu("canvas");return Et.style.display="block",Et}const Zm={};function gu(Et){Et in Zm||(Zm[Et]=!0,console.warn(Et))}const _g=new as().set(.8224621,.177538,0,.0331941,.9668058,0,.0170827,.0723974,.9105199),tv=new as().set(1.2249401,-.2249404,0,-.0420569,1.0420571,0,-.0196376,-.0786361,1.0982735),_u={[Ws]:{transfer:Ds,primaries:Vs,toReference:Et=>Et,fromReference:Et=>Et},[Os]:{transfer:Ns,primaries:Vs,toReference:Et=>Et.convertSRGBToLinear(),fromReference:Et=>Et.convertLinearToSRGB()},[lu]:{transfer:Ds,primaries:Ru,toReference:Et=>Et.applyMatrix3(tv),fromReference:Et=>Et.applyMatrix3(_g)},[cp]:{transfer:Ns,primaries:Ru,toReference:Et=>Et.convertSRGBToLinear().applyMatrix3(tv),fromReference:Et=>Et.applyMatrix3(_g).convertLinearToSRGB()}},M0=new Set([Ws,lu]),Ms={enabled:!0,_workingColorSpace:Ws,get legacyMode(){return console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),!this.enabled},set legacyMode(Et){console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),this.enabled=!Et},get workingColorSpace(){return this._workingColorSpace},set workingColorSpace(Et){if(!M0.has(Et))throw new Error(`Unsupported working color space, "${Et}".`);this._workingColorSpace=Et},convert:function(Et,_e,at){if(this.enabled===!1||_e===at||!_e||!at)return Et;const pt=_u[_e].toReference;return(0,_u[at].fromReference)(pt(Et))},fromWorkingColorSpace:function(Et,_e){return this.convert(Et,this._workingColorSpace,_e)},toWorkingColorSpace:function(Et,_e){return this.convert(Et,_e,this._workingColorSpace)},getPrimaries:function(Et){return _u[Et].primaries},getTransfer:function(Et){return Et===ks||Et===no?Ds:_u[Et].transfer}};function Bu(Et){return Et<.04045?.0773993808*Et:Math.pow(.9478672986*Et+.0521327014,2.4)}function rm(Et){return Et<.0031308?12.92*Et:1.055*Math.pow(Et,.41666)-.055}let Lu;class e_{static getDataURL(_e,at=!1){if(/^data:/i.test(_e.src)||typeof HTMLCanvasElement>"u")return _e.src;let pt;if(_e instanceof HTMLCanvasElement)pt=_e;else{Lu===void 0&&(Lu=mu("canvas")),Lu.width=_e.width,Lu.height=_e.height;const mt=Lu.getContext("2d");_e instanceof ImageData?mt.putImageData(_e,0,0):mt.drawImage(_e,0,0,_e.width,_e.height),pt=Lu}return!at&&(pt.width>2048||pt.height>2048)?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",_e),pt.toDataURL("image/jpeg",.6)):pt.toDataURL("image/png")}static sRGBToLinear(_e){if(typeof HTMLImageElement<"u"&&_e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&_e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&_e instanceof ImageBitmap){const at=mu("canvas");at.width=_e.width,at.height=_e.height;const pt=at.getContext("2d");pt.drawImage(_e,0,0,_e.width,_e.height);const mt=pt.getImageData(0,0,_e.width,_e.height),vt=mt.data;for(let Ct=0;Ct<vt.length;Ct++)vt[Ct]=255*Bu(vt[Ct]/255);return pt.putImageData(mt,0,0),at}if(_e.data){const at=_e.data.slice(0);for(let pt=0;pt<at.length;pt++)at instanceof Uint8Array||at instanceof Uint8ClampedArray?at[pt]=Math.floor(255*Bu(at[pt]/255)):at[pt]=Bu(at[pt]);return{data:at,width:_e.width,height:_e.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),_e}}let t_=0;class Wo{constructor(_e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:t_++}),this.uuid=xo(),this.data=_e,this.version=0}set needsUpdate(_e){_e===!0&&this.version++}toJSON(_e){const at=_e===void 0||typeof _e=="string";if(!at&&_e.images[this.uuid]!==void 0)return _e.images[this.uuid];const pt={uuid:this.uuid,url:""},mt=this.data;if(mt!==null){let vt;if(Array.isArray(mt)){vt=[];for(let Ct=0,Tt=mt.length;Ct<Tt;Ct++)mt[Ct].isDataTexture?vt.push(r_(mt[Ct].image)):vt.push(r_(mt[Ct]))}else vt=r_(mt);pt.url=vt}return at||(_e.images[this.uuid]=pt),pt}}function r_(Et){if(typeof HTMLImageElement<"u"&&Et instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&Et instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&Et instanceof ImageBitmap)return e_.getDataURL(Et);if(Et.data){let _e=[];try{_e=Array.from(Et.data)}catch(at){at.message.includes("Invalid array length")?console.warn("Serializing large texture, might not be saved in JSON structure."):console.error(at),_e=Et.data}return{data:_e,width:Et.width,height:Et.height,type:Et.data.constructor.name}}return Et.url!==void 0?Et.url:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let I0=0;class Us extends mo{constructor(_e=Us.DEFAULT_IMAGE,at=Us.DEFAULT_MAPPING,pt=fn,mt=fn,vt=Qn,Ct=Kn,Tt=io,Bt=js,Lt=Us.DEFAULT_ANISOTROPY,Ut=ks){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:I0++}),this.uuid=xo(),this.name="",this.source=new Wo(_e),this.mipmaps=[],this.mapping=at,this.channel=0,this.wrapS=pt,this.wrapT=mt,this.magFilter=vt,this.minFilter=Ct,this.anisotropy=Lt,this.format=Tt,this.internalFormat=null,this.type=Bt,this.offset=new dn(0,0),this.repeat=new dn(1,1),this.center=new dn(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new as,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,typeof Ut=="string"?this.colorSpace=Ut:(gu("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=Ut===Rl?Os:ks),this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1,_e instanceof ImageData&&(this.needsUpdate=!0)}get image(){return this.source.data}set image(_e=null){this.source.data=_e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(_e){return this.name=_e.name,this.source=_e.source,this.mipmaps=_e.mipmaps.slice(0),this.mapping=_e.mapping,this.channel=_e.channel,this.wrapS=_e.wrapS,this.wrapT=_e.wrapT,this.magFilter=_e.magFilter,this.minFilter=_e.minFilter,this.anisotropy=_e.anisotropy,this.format=_e.format,this.internalFormat=_e.internalFormat,this.type=_e.type,this.offset.copy(_e.offset),this.repeat.copy(_e.repeat),this.center.copy(_e.center),this.rotation=_e.rotation,this.matrixAutoUpdate=_e.matrixAutoUpdate,this.matrix.copy(_e.matrix),this.generateMipmaps=_e.generateMipmaps,this.premultiplyAlpha=_e.premultiplyAlpha,this.flipY=_e.flipY,this.unpackAlignment=_e.unpackAlignment,this.colorSpace=_e.colorSpace,this.userData=JSON.parse(JSON.stringify(_e.userData)),this.needsUpdate=!0,this}toJSON(_e){const at=_e===void 0||typeof _e=="string";if(!at&&_e.textures&&_e.textures[this.uuid]!==void 0)return _e.textures[this.uuid];const pt={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(_e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,encoding:this.colorSpace===Os?Rl:Ys,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(pt.userData=this.userData),!at&&_e.textures&&(_e.textures[this.uuid]=pt),pt}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(_e){if(this.mapping!==jr)return _e;if(_e.applyMatrix3(this.matrix),_e.x<0||_e.x>1)switch(this.wrapS){case xn:_e.x=_e.x-Math.floor(_e.x);break;case fn:_e.x=_e.x<0?0:1;break;case En:Math.abs(Math.floor(_e.x)%2)===1?_e.x=Math.ceil(_e.x)-_e.x:_e.x=_e.x-Math.floor(_e.x)}if(_e.y<0||_e.y>1)switch(this.wrapT){case xn:_e.y=_e.y-Math.floor(_e.y);break;case fn:_e.y=_e.y<0?0:1;break;case En:Math.abs(Math.floor(_e.y)%2)===1?_e.y=Math.ceil(_e.y)-_e.y:_e.y=_e.y-Math.floor(_e.y)}return this.flipY&&(_e.y=1-_e.y),_e}set needsUpdate(_e){_e===!0&&(this.version++,this.source.needsUpdate=!0,this.dispatchEvent({type:"update"}))}get encoding(){return gu("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace===Os?Rl:Ys}set encoding(_e){gu("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=_e===Rl?Os:ks}}Us.DEFAULT_IMAGE=null,Us.DEFAULT_MAPPING=jr,Us.DEFAULT_ANISOTROPY=1;class Is{constructor(_e=0,at=0,pt=0,mt=1){Is.prototype.isVector4=!0,this.x=_e,this.y=at,this.z=pt,this.w=mt}get width(){return this.z}set width(_e){this.z=_e}get height(){return this.w}set height(_e){this.w=_e}set(_e,at,pt,mt){return this.x=_e,this.y=at,this.z=pt,this.w=mt,this}setScalar(_e){return this.x=_e,this.y=_e,this.z=_e,this.w=_e,this}setX(_e){return this.x=_e,this}setY(_e){return this.y=_e,this}setZ(_e){return this.z=_e,this}setW(_e){return this.w=_e,this}setComponent(_e,at){switch(_e){case 0:this.x=at;break;case 1:this.y=at;break;case 2:this.z=at;break;case 3:this.w=at;break;default:throw new Error("index is out of range: "+_e)}return this}getComponent(_e){switch(_e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+_e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(_e){return this.x=_e.x,this.y=_e.y,this.z=_e.z,this.w=_e.w!==void 0?_e.w:1,this}add(_e){return this.x+=_e.x,this.y+=_e.y,this.z+=_e.z,this.w+=_e.w,this}addScalar(_e){return this.x+=_e,this.y+=_e,this.z+=_e,this.w+=_e,this}addVectors(_e,at){return this.x=_e.x+at.x,this.y=_e.y+at.y,this.z=_e.z+at.z,this.w=_e.w+at.w,this}addScaledVector(_e,at){return this.x+=_e.x*at,this.y+=_e.y*at,this.z+=_e.z*at,this.w+=_e.w*at,this}sub(_e){return this.x-=_e.x,this.y-=_e.y,this.z-=_e.z,this.w-=_e.w,this}subScalar(_e){return this.x-=_e,this.y-=_e,this.z-=_e,this.w-=_e,this}subVectors(_e,at){return this.x=_e.x-at.x,this.y=_e.y-at.y,this.z=_e.z-at.z,this.w=_e.w-at.w,this}multiply(_e){return this.x*=_e.x,this.y*=_e.y,this.z*=_e.z,this.w*=_e.w,this}multiplyScalar(_e){return this.x*=_e,this.y*=_e,this.z*=_e,this.w*=_e,this}applyMatrix4(_e){const at=this.x,pt=this.y,mt=this.z,vt=this.w,Ct=_e.elements;return this.x=Ct[0]*at+Ct[4]*pt+Ct[8]*mt+Ct[12]*vt,this.y=Ct[1]*at+Ct[5]*pt+Ct[9]*mt+Ct[13]*vt,this.z=Ct[2]*at+Ct[6]*pt+Ct[10]*mt+Ct[14]*vt,this.w=Ct[3]*at+Ct[7]*pt+Ct[11]*mt+Ct[15]*vt,this}divideScalar(_e){return this.multiplyScalar(1/_e)}setAxisAngleFromQuaternion(_e){this.w=2*Math.acos(_e.w);const at=Math.sqrt(1-_e.w*_e.w);return at<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=_e.x/at,this.y=_e.y/at,this.z=_e.z/at),this}setAxisAngleFromRotationMatrix(_e){let at,pt,mt,vt;const Ct=_e.elements,Tt=Ct[0],Bt=Ct[4],Lt=Ct[8],Ut=Ct[1],Qt=Ct[5],Ht=Ct[9],Wt=Ct[2],qt=Ct[6],Jt=Ct[10];if(Math.abs(Bt-Ut)<.01&&Math.abs(Lt-Wt)<.01&&Math.abs(Ht-qt)<.01){if(Math.abs(Bt+Ut)<.1&&Math.abs(Lt+Wt)<.1&&Math.abs(Ht+qt)<.1&&Math.abs(Tt+Qt+Jt-3)<.1)return this.set(1,0,0,0),this;at=Math.PI;const sr=(Tt+1)/2,Zt=(Qt+1)/2,er=(Jt+1)/2,xr=(Bt+Ut)/4,Ar=(Lt+Wt)/4,yr=(Ht+qt)/4;return sr>Zt&&sr>er?sr<.01?(pt=0,mt=.707106781,vt=.707106781):(pt=Math.sqrt(sr),mt=xr/pt,vt=Ar/pt):Zt>er?Zt<.01?(pt=.707106781,mt=0,vt=.707106781):(mt=Math.sqrt(Zt),pt=xr/mt,vt=yr/mt):er<.01?(pt=.707106781,mt=.707106781,vt=0):(vt=Math.sqrt(er),pt=Ar/vt,mt=yr/vt),this.set(pt,mt,vt,at),this}let Xt=Math.sqrt((qt-Ht)*(qt-Ht)+(Lt-Wt)*(Lt-Wt)+(Ut-Bt)*(Ut-Bt));return Math.abs(Xt)<.001&&(Xt=1),this.x=(qt-Ht)/Xt,this.y=(Lt-Wt)/Xt,this.z=(Ut-Bt)/Xt,this.w=Math.acos((Tt+Qt+Jt-1)/2),this}min(_e){return this.x=Math.min(this.x,_e.x),this.y=Math.min(this.y,_e.y),this.z=Math.min(this.z,_e.z),this.w=Math.min(this.w,_e.w),this}max(_e){return this.x=Math.max(this.x,_e.x),this.y=Math.max(this.y,_e.y),this.z=Math.max(this.z,_e.z),this.w=Math.max(this.w,_e.w),this}clamp(_e,at){return this.x=Math.max(_e.x,Math.min(at.x,this.x)),this.y=Math.max(_e.y,Math.min(at.y,this.y)),this.z=Math.max(_e.z,Math.min(at.z,this.z)),this.w=Math.max(_e.w,Math.min(at.w,this.w)),this}clampScalar(_e,at){return this.x=Math.max(_e,Math.min(at,this.x)),this.y=Math.max(_e,Math.min(at,this.y)),this.z=Math.max(_e,Math.min(at,this.z)),this.w=Math.max(_e,Math.min(at,this.w)),this}clampLength(_e,at){const pt=this.length();return this.divideScalar(pt||1).multiplyScalar(Math.max(_e,Math.min(at,pt)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(_e){return this.x*_e.x+this.y*_e.y+this.z*_e.z+this.w*_e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(_e){return this.normalize().multiplyScalar(_e)}lerp(_e,at){return this.x+=(_e.x-this.x)*at,this.y+=(_e.y-this.y)*at,this.z+=(_e.z-this.z)*at,this.w+=(_e.w-this.w)*at,this}lerpVectors(_e,at,pt){return this.x=_e.x+(at.x-_e.x)*pt,this.y=_e.y+(at.y-_e.y)*pt,this.z=_e.z+(at.z-_e.z)*pt,this.w=_e.w+(at.w-_e.w)*pt,this}equals(_e){return _e.x===this.x&&_e.y===this.y&&_e.z===this.z&&_e.w===this.w}fromArray(_e,at=0){return this.x=_e[at],this.y=_e[at+1],this.z=_e[at+2],this.w=_e[at+3],this}toArray(_e=[],at=0){return _e[at]=this.x,_e[at+1]=this.y,_e[at+2]=this.z,_e[at+3]=this.w,_e}fromBufferAttribute(_e,at){return this.x=_e.getX(at),this.y=_e.getY(at),this.z=_e.getZ(at),this.w=_e.getW(at),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class rv extends mo{constructor(_e=1,at=1,pt={}){super(),this.isRenderTarget=!0,this.width=_e,this.height=at,this.depth=1,this.scissor=new Is(0,0,_e,at),this.scissorTest=!1,this.viewport=new Is(0,0,_e,at);const mt={width:_e,height:at,depth:1};pt.encoding!==void 0&&(gu("THREE.WebGLRenderTarget: option.encoding has been replaced by option.colorSpace."),pt.colorSpace=pt.encoding===Rl?Os:ks),pt=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:Qn,depthBuffer:!0,stencilBuffer:!1,depthTexture:null,samples:0},pt),this.texture=new Us(mt,pt.mapping,pt.wrapS,pt.wrapT,pt.magFilter,pt.minFilter,pt.format,pt.type,pt.anisotropy,pt.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=pt.generateMipmaps,this.texture.internalFormat=pt.internalFormat,this.depthBuffer=pt.depthBuffer,this.stencilBuffer=pt.stencilBuffer,this.depthTexture=pt.depthTexture,this.samples=pt.samples}setSize(_e,at,pt=1){this.width===_e&&this.height===at&&this.depth===pt||(this.width=_e,this.height=at,this.depth=pt,this.texture.image.width=_e,this.texture.image.height=at,this.texture.image.depth=pt,this.dispose()),this.viewport.set(0,0,_e,at),this.scissor.set(0,0,_e,at)}clone(){return new this.constructor().copy(this)}copy(_e){this.width=_e.width,this.height=_e.height,this.depth=_e.depth,this.scissor.copy(_e.scissor),this.scissorTest=_e.scissorTest,this.viewport.copy(_e.viewport),this.texture=_e.texture.clone(),this.texture.isRenderTargetTexture=!0;const at=Object.assign({},_e.texture.image);return this.texture.source=new Wo(at),this.depthBuffer=_e.depthBuffer,this.stencilBuffer=_e.stencilBuffer,_e.depthTexture&&(this.depthTexture=_e.depthTexture.clone()),this.samples=_e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class Ao extends rv{constructor(_e=1,at=1,pt={}){super(_e,at,pt),this.isWebGLRenderTarget=!0}}class im extends Us{constructor(_e=null,at=1,pt=1,mt=1){super(null),this.isDataArrayTexture=!0,this.image={data:_e,width:at,height:pt,depth:mt},this.magFilter=tn,this.minFilter=tn,this.wrapR=fn,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class i_ extends Ao{constructor(_e=1,at=1,pt=1){super(_e,at),this.isWebGLArrayRenderTarget=!0,this.depth=pt,this.texture=new im(null,_e,at,pt),this.texture.isRenderTargetTexture=!0}}class n_ extends Us{constructor(_e=null,at=1,pt=1,mt=1){super(null),this.isData3DTexture=!0,this.image={data:_e,width:at,height:pt,depth:mt},this.magFilter=tn,this.minFilter=tn,this.wrapR=fn,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class R0 extends Ao{constructor(_e=1,at=1,pt=1){super(_e,at),this.isWebGL3DRenderTarget=!0,this.depth=pt,this.texture=new n_(null,_e,at,pt),this.texture.isRenderTargetTexture=!0}}class s_ extends Ao{constructor(_e=1,at=1,pt=1,mt={}){super(_e,at,mt),this.isWebGLMultipleRenderTargets=!0;const vt=this.texture;this.texture=[];for(let Ct=0;Ct<pt;Ct++)this.texture[Ct]=vt.clone(),this.texture[Ct].isRenderTargetTexture=!0}setSize(_e,at,pt=1){if(this.width!==_e||this.height!==at||this.depth!==pt){this.width=_e,this.height=at,this.depth=pt;for(let mt=0,vt=this.texture.length;mt<vt;mt++)this.texture[mt].image.width=_e,this.texture[mt].image.height=at,this.texture[mt].image.depth=pt;this.dispose()}this.viewport.set(0,0,_e,at),this.scissor.set(0,0,_e,at)}copy(_e){this.dispose(),this.width=_e.width,this.height=_e.height,this.depth=_e.depth,this.scissor.copy(_e.scissor),this.scissorTest=_e.scissorTest,this.viewport.copy(_e.viewport),this.depthBuffer=_e.depthBuffer,this.stencilBuffer=_e.stencilBuffer,_e.depthTexture!==null&&(this.depthTexture=_e.depthTexture.clone()),this.texture.length=0;for(let at=0,pt=_e.texture.length;at<pt;at++)this.texture[at]=_e.texture[at].clone(),this.texture[at].isRenderTargetTexture=!0;return this}}class wo{constructor(_e=0,at=0,pt=0,mt=1){this.isQuaternion=!0,this._x=_e,this._y=at,this._z=pt,this._w=mt}static slerpFlat(_e,at,pt,mt,vt,Ct,Tt){let Bt=pt[mt+0],Lt=pt[mt+1],Ut=pt[mt+2],Qt=pt[mt+3];const Ht=vt[Ct+0],Wt=vt[Ct+1],qt=vt[Ct+2],Jt=vt[Ct+3];if(Tt===0)return _e[at+0]=Bt,_e[at+1]=Lt,_e[at+2]=Ut,void(_e[at+3]=Qt);if(Tt===1)return _e[at+0]=Ht,_e[at+1]=Wt,_e[at+2]=qt,void(_e[at+3]=Jt);if(Qt!==Jt||Bt!==Ht||Lt!==Wt||Ut!==qt){let Xt=1-Tt;const sr=Bt*Ht+Lt*Wt+Ut*qt+Qt*Jt,Zt=sr>=0?1:-1,er=1-sr*sr;if(er>Number.EPSILON){const Ar=Math.sqrt(er),yr=Math.atan2(Ar,sr*Zt);Xt=Math.sin(Xt*yr)/Ar,Tt=Math.sin(Tt*yr)/Ar}const xr=Tt*Zt;if(Bt=Bt*Xt+Ht*xr,Lt=Lt*Xt+Wt*xr,Ut=Ut*Xt+qt*xr,Qt=Qt*Xt+Jt*xr,Xt===1-Tt){const Ar=1/Math.sqrt(Bt*Bt+Lt*Lt+Ut*Ut+Qt*Qt);Bt*=Ar,Lt*=Ar,Ut*=Ar,Qt*=Ar}}_e[at]=Bt,_e[at+1]=Lt,_e[at+2]=Ut,_e[at+3]=Qt}static multiplyQuaternionsFlat(_e,at,pt,mt,vt,Ct){const Tt=pt[mt],Bt=pt[mt+1],Lt=pt[mt+2],Ut=pt[mt+3],Qt=vt[Ct],Ht=vt[Ct+1],Wt=vt[Ct+2],qt=vt[Ct+3];return _e[at]=Tt*qt+Ut*Qt+Bt*Wt-Lt*Ht,_e[at+1]=Bt*qt+Ut*Ht+Lt*Qt-Tt*Wt,_e[at+2]=Lt*qt+Ut*Wt+Tt*Ht-Bt*Qt,_e[at+3]=Ut*qt-Tt*Qt-Bt*Ht-Lt*Wt,_e}get x(){return this._x}set x(_e){this._x=_e,this._onChangeCallback()}get y(){return this._y}set y(_e){this._y=_e,this._onChangeCallback()}get z(){return this._z}set z(_e){this._z=_e,this._onChangeCallback()}get w(){return this._w}set w(_e){this._w=_e,this._onChangeCallback()}set(_e,at,pt,mt){return this._x=_e,this._y=at,this._z=pt,this._w=mt,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(_e){return this._x=_e.x,this._y=_e.y,this._z=_e.z,this._w=_e.w,this._onChangeCallback(),this}setFromEuler(_e,at){const pt=_e._x,mt=_e._y,vt=_e._z,Ct=_e._order,Tt=Math.cos,Bt=Math.sin,Lt=Tt(pt/2),Ut=Tt(mt/2),Qt=Tt(vt/2),Ht=Bt(pt/2),Wt=Bt(mt/2),qt=Bt(vt/2);switch(Ct){case"XYZ":this._x=Ht*Ut*Qt+Lt*Wt*qt,this._y=Lt*Wt*Qt-Ht*Ut*qt,this._z=Lt*Ut*qt+Ht*Wt*Qt,this._w=Lt*Ut*Qt-Ht*Wt*qt;break;case"YXZ":this._x=Ht*Ut*Qt+Lt*Wt*qt,this._y=Lt*Wt*Qt-Ht*Ut*qt,this._z=Lt*Ut*qt-Ht*Wt*Qt,this._w=Lt*Ut*Qt+Ht*Wt*qt;break;case"ZXY":this._x=Ht*Ut*Qt-Lt*Wt*qt,this._y=Lt*Wt*Qt+Ht*Ut*qt,this._z=Lt*Ut*qt+Ht*Wt*Qt,this._w=Lt*Ut*Qt-Ht*Wt*qt;break;case"ZYX":this._x=Ht*Ut*Qt-Lt*Wt*qt,this._y=Lt*Wt*Qt+Ht*Ut*qt,this._z=Lt*Ut*qt-Ht*Wt*Qt,this._w=Lt*Ut*Qt+Ht*Wt*qt;break;case"YZX":this._x=Ht*Ut*Qt+Lt*Wt*qt,this._y=Lt*Wt*Qt+Ht*Ut*qt,this._z=Lt*Ut*qt-Ht*Wt*Qt,this._w=Lt*Ut*Qt-Ht*Wt*qt;break;case"XZY":this._x=Ht*Ut*Qt-Lt*Wt*qt,this._y=Lt*Wt*Qt-Ht*Ut*qt,this._z=Lt*Ut*qt+Ht*Wt*Qt,this._w=Lt*Ut*Qt+Ht*Wt*qt;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+Ct)}return at!==!1&&this._onChangeCallback(),this}setFromAxisAngle(_e,at){const pt=at/2,mt=Math.sin(pt);return this._x=_e.x*mt,this._y=_e.y*mt,this._z=_e.z*mt,this._w=Math.cos(pt),this._onChangeCallback(),this}setFromRotationMatrix(_e){const at=_e.elements,pt=at[0],mt=at[4],vt=at[8],Ct=at[1],Tt=at[5],Bt=at[9],Lt=at[2],Ut=at[6],Qt=at[10],Ht=pt+Tt+Qt;if(Ht>0){const Wt=.5/Math.sqrt(Ht+1);this._w=.25/Wt,this._x=(Ut-Bt)*Wt,this._y=(vt-Lt)*Wt,this._z=(Ct-mt)*Wt}else if(pt>Tt&&pt>Qt){const Wt=2*Math.sqrt(1+pt-Tt-Qt);this._w=(Ut-Bt)/Wt,this._x=.25*Wt,this._y=(mt+Ct)/Wt,this._z=(vt+Lt)/Wt}else if(Tt>Qt){const Wt=2*Math.sqrt(1+Tt-pt-Qt);this._w=(vt-Lt)/Wt,this._x=(mt+Ct)/Wt,this._y=.25*Wt,this._z=(Bt+Ut)/Wt}else{const Wt=2*Math.sqrt(1+Qt-pt-Tt);this._w=(Ct-mt)/Wt,this._x=(vt+Lt)/Wt,this._y=(Bt+Ut)/Wt,this._z=.25*Wt}return this._onChangeCallback(),this}setFromUnitVectors(_e,at){let pt=_e.dot(at)+1;return pt<Number.EPSILON?(pt=0,Math.abs(_e.x)>Math.abs(_e.z)?(this._x=-_e.y,this._y=_e.x,this._z=0,this._w=pt):(this._x=0,this._y=-_e.z,this._z=_e.y,this._w=pt)):(this._x=_e.y*at.z-_e.z*at.y,this._y=_e.z*at.x-_e.x*at.z,this._z=_e.x*at.y-_e.y*at.x,this._w=pt),this.normalize()}angleTo(_e){return 2*Math.acos(Math.abs(Hs(this.dot(_e),-1,1)))}rotateTowards(_e,at){const pt=this.angleTo(_e);if(pt===0)return this;const mt=Math.min(1,at/pt);return this.slerp(_e,mt),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(_e){return this._x*_e._x+this._y*_e._y+this._z*_e._z+this._w*_e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let _e=this.length();return _e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(_e=1/_e,this._x=this._x*_e,this._y=this._y*_e,this._z=this._z*_e,this._w=this._w*_e),this._onChangeCallback(),this}multiply(_e){return this.multiplyQuaternions(this,_e)}premultiply(_e){return this.multiplyQuaternions(_e,this)}multiplyQuaternions(_e,at){const pt=_e._x,mt=_e._y,vt=_e._z,Ct=_e._w,Tt=at._x,Bt=at._y,Lt=at._z,Ut=at._w;return this._x=pt*Ut+Ct*Tt+mt*Lt-vt*Bt,this._y=mt*Ut+Ct*Bt+vt*Tt-pt*Lt,this._z=vt*Ut+Ct*Lt+pt*Bt-mt*Tt,this._w=Ct*Ut-pt*Tt-mt*Bt-vt*Lt,this._onChangeCallback(),this}slerp(_e,at){if(at===0)return this;if(at===1)return this.copy(_e);const pt=this._x,mt=this._y,vt=this._z,Ct=this._w;let Tt=Ct*_e._w+pt*_e._x+mt*_e._y+vt*_e._z;if(Tt<0?(this._w=-_e._w,this._x=-_e._x,this._y=-_e._y,this._z=-_e._z,Tt=-Tt):this.copy(_e),Tt>=1)return this._w=Ct,this._x=pt,this._y=mt,this._z=vt,this;const Bt=1-Tt*Tt;if(Bt<=Number.EPSILON){const Wt=1-at;return this._w=Wt*Ct+at*this._w,this._x=Wt*pt+at*this._x,this._y=Wt*mt+at*this._y,this._z=Wt*vt+at*this._z,this.normalize(),this._onChangeCallback(),this}const Lt=Math.sqrt(Bt),Ut=Math.atan2(Lt,Tt),Qt=Math.sin((1-at)*Ut)/Lt,Ht=Math.sin(at*Ut)/Lt;return this._w=Ct*Qt+this._w*Ht,this._x=pt*Qt+this._x*Ht,this._y=mt*Qt+this._y*Ht,this._z=vt*Qt+this._z*Ht,this._onChangeCallback(),this}slerpQuaternions(_e,at,pt){return this.copy(_e).slerp(at,pt)}random(){const _e=Math.random(),at=Math.sqrt(1-_e),pt=Math.sqrt(_e),mt=2*Math.PI*Math.random(),vt=2*Math.PI*Math.random();return this.set(at*Math.cos(mt),pt*Math.sin(vt),pt*Math.cos(vt),at*Math.sin(mt))}equals(_e){return _e._x===this._x&&_e._y===this._y&&_e._z===this._z&&_e._w===this._w}fromArray(_e,at=0){return this._x=_e[at],this._y=_e[at+1],this._z=_e[at+2],this._w=_e[at+3],this._onChangeCallback(),this}toArray(_e=[],at=0){return _e[at]=this._x,_e[at+1]=this._y,_e[at+2]=this._z,_e[at+3]=this._w,_e}fromBufferAttribute(_e,at){return this._x=_e.getX(at),this._y=_e.getY(at),this._z=_e.getZ(at),this._w=_e.getW(at),this}toJSON(){return this.toArray()}_onChange(_e){return this._onChangeCallback=_e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class Er{constructor(_e=0,at=0,pt=0){Er.prototype.isVector3=!0,this.x=_e,this.y=at,this.z=pt}set(_e,at,pt){return pt===void 0&&(pt=this.z),this.x=_e,this.y=at,this.z=pt,this}setScalar(_e){return this.x=_e,this.y=_e,this.z=_e,this}setX(_e){return this.x=_e,this}setY(_e){return this.y=_e,this}setZ(_e){return this.z=_e,this}setComponent(_e,at){switch(_e){case 0:this.x=at;break;case 1:this.y=at;break;case 2:this.z=at;break;default:throw new Error("index is out of range: "+_e)}return this}getComponent(_e){switch(_e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+_e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(_e){return this.x=_e.x,this.y=_e.y,this.z=_e.z,this}add(_e){return this.x+=_e.x,this.y+=_e.y,this.z+=_e.z,this}addScalar(_e){return this.x+=_e,this.y+=_e,this.z+=_e,this}addVectors(_e,at){return this.x=_e.x+at.x,this.y=_e.y+at.y,this.z=_e.z+at.z,this}addScaledVector(_e,at){return this.x+=_e.x*at,this.y+=_e.y*at,this.z+=_e.z*at,this}sub(_e){return this.x-=_e.x,this.y-=_e.y,this.z-=_e.z,this}subScalar(_e){return this.x-=_e,this.y-=_e,this.z-=_e,this}subVectors(_e,at){return this.x=_e.x-at.x,this.y=_e.y-at.y,this.z=_e.z-at.z,this}multiply(_e){return this.x*=_e.x,this.y*=_e.y,this.z*=_e.z,this}multiplyScalar(_e){return this.x*=_e,this.y*=_e,this.z*=_e,this}multiplyVectors(_e,at){return this.x=_e.x*at.x,this.y=_e.y*at.y,this.z=_e.z*at.z,this}applyEuler(_e){return this.applyQuaternion(nm.setFromEuler(_e))}applyAxisAngle(_e,at){return this.applyQuaternion(nm.setFromAxisAngle(_e,at))}applyMatrix3(_e){const at=this.x,pt=this.y,mt=this.z,vt=_e.elements;return this.x=vt[0]*at+vt[3]*pt+vt[6]*mt,this.y=vt[1]*at+vt[4]*pt+vt[7]*mt,this.z=vt[2]*at+vt[5]*pt+vt[8]*mt,this}applyNormalMatrix(_e){return this.applyMatrix3(_e).normalize()}applyMatrix4(_e){const at=this.x,pt=this.y,mt=this.z,vt=_e.elements,Ct=1/(vt[3]*at+vt[7]*pt+vt[11]*mt+vt[15]);return this.x=(vt[0]*at+vt[4]*pt+vt[8]*mt+vt[12])*Ct,this.y=(vt[1]*at+vt[5]*pt+vt[9]*mt+vt[13])*Ct,this.z=(vt[2]*at+vt[6]*pt+vt[10]*mt+vt[14])*Ct,this}applyQuaternion(_e){const at=this.x,pt=this.y,mt=this.z,vt=_e.x,Ct=_e.y,Tt=_e.z,Bt=_e.w,Lt=Bt*at+Ct*mt-Tt*pt,Ut=Bt*pt+Tt*at-vt*mt,Qt=Bt*mt+vt*pt-Ct*at,Ht=-vt*at-Ct*pt-Tt*mt;return this.x=Lt*Bt+Ht*-vt+Ut*-Tt-Qt*-Ct,this.y=Ut*Bt+Ht*-Ct+Qt*-vt-Lt*-Tt,this.z=Qt*Bt+Ht*-Tt+Lt*-Ct-Ut*-vt,this}project(_e){return this.applyMatrix4(_e.matrixWorldInverse).applyMatrix4(_e.projectionMatrix)}unproject(_e){return this.applyMatrix4(_e.projectionMatrixInverse).applyMatrix4(_e.matrixWorld)}transformDirection(_e){const at=this.x,pt=this.y,mt=this.z,vt=_e.elements;return this.x=vt[0]*at+vt[4]*pt+vt[8]*mt,this.y=vt[1]*at+vt[5]*pt+vt[9]*mt,this.z=vt[2]*at+vt[6]*pt+vt[10]*mt,this.normalize()}divide(_e){return this.x/=_e.x,this.y/=_e.y,this.z/=_e.z,this}divideScalar(_e){return this.multiplyScalar(1/_e)}min(_e){return this.x=Math.min(this.x,_e.x),this.y=Math.min(this.y,_e.y),this.z=Math.min(this.z,_e.z),this}max(_e){return this.x=Math.max(this.x,_e.x),this.y=Math.max(this.y,_e.y),this.z=Math.max(this.z,_e.z),this}clamp(_e,at){return this.x=Math.max(_e.x,Math.min(at.x,this.x)),this.y=Math.max(_e.y,Math.min(at.y,this.y)),this.z=Math.max(_e.z,Math.min(at.z,this.z)),this}clampScalar(_e,at){return this.x=Math.max(_e,Math.min(at,this.x)),this.y=Math.max(_e,Math.min(at,this.y)),this.z=Math.max(_e,Math.min(at,this.z)),this}clampLength(_e,at){const pt=this.length();return this.divideScalar(pt||1).multiplyScalar(Math.max(_e,Math.min(at,pt)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(_e){return this.x*_e.x+this.y*_e.y+this.z*_e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(_e){return this.normalize().multiplyScalar(_e)}lerp(_e,at){return this.x+=(_e.x-this.x)*at,this.y+=(_e.y-this.y)*at,this.z+=(_e.z-this.z)*at,this}lerpVectors(_e,at,pt){return this.x=_e.x+(at.x-_e.x)*pt,this.y=_e.y+(at.y-_e.y)*pt,this.z=_e.z+(at.z-_e.z)*pt,this}cross(_e){return this.crossVectors(this,_e)}crossVectors(_e,at){const pt=_e.x,mt=_e.y,vt=_e.z,Ct=at.x,Tt=at.y,Bt=at.z;return this.x=mt*Bt-vt*Tt,this.y=vt*Ct-pt*Bt,this.z=pt*Tt-mt*Ct,this}projectOnVector(_e){const at=_e.lengthSq();if(at===0)return this.set(0,0,0);const pt=_e.dot(this)/at;return this.copy(_e).multiplyScalar(pt)}projectOnPlane(_e){return a_.copy(this).projectOnVector(_e),this.sub(a_)}reflect(_e){return this.sub(a_.copy(_e).multiplyScalar(2*this.dot(_e)))}angleTo(_e){const at=Math.sqrt(this.lengthSq()*_e.lengthSq());if(at===0)return Math.PI/2;const pt=this.dot(_e)/at;return Math.acos(Hs(pt,-1,1))}distanceTo(_e){return Math.sqrt(this.distanceToSquared(_e))}distanceToSquared(_e){const at=this.x-_e.x,pt=this.y-_e.y,mt=this.z-_e.z;return at*at+pt*pt+mt*mt}manhattanDistanceTo(_e){return Math.abs(this.x-_e.x)+Math.abs(this.y-_e.y)+Math.abs(this.z-_e.z)}setFromSpherical(_e){return this.setFromSphericalCoords(_e.radius,_e.phi,_e.theta)}setFromSphericalCoords(_e,at,pt){const mt=Math.sin(at)*_e;return this.x=mt*Math.sin(pt),this.y=Math.cos(at)*_e,this.z=mt*Math.cos(pt),this}setFromCylindrical(_e){return this.setFromCylindricalCoords(_e.radius,_e.theta,_e.y)}setFromCylindricalCoords(_e,at,pt){return this.x=_e*Math.sin(at),this.y=pt,this.z=_e*Math.cos(at),this}setFromMatrixPosition(_e){const at=_e.elements;return this.x=at[12],this.y=at[13],this.z=at[14],this}setFromMatrixScale(_e){const at=this.setFromMatrixColumn(_e,0).length(),pt=this.setFromMatrixColumn(_e,1).length(),mt=this.setFromMatrixColumn(_e,2).length();return this.x=at,this.y=pt,this.z=mt,this}setFromMatrixColumn(_e,at){return this.fromArray(_e.elements,4*at)}setFromMatrix3Column(_e,at){return this.fromArray(_e.elements,3*at)}setFromEuler(_e){return this.x=_e._x,this.y=_e._y,this.z=_e._z,this}setFromColor(_e){return this.x=_e.r,this.y=_e.g,this.z=_e.b,this}equals(_e){return _e.x===this.x&&_e.y===this.y&&_e.z===this.z}fromArray(_e,at=0){return this.x=_e[at],this.y=_e[at+1],this.z=_e[at+2],this}toArray(_e=[],at=0){return _e[at]=this.x,_e[at+1]=this.y,_e[at+2]=this.z,_e}fromBufferAttribute(_e,at){return this.x=_e.getX(at),this.y=_e.getY(at),this.z=_e.getZ(at),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const _e=2*(Math.random()-.5),at=Math.random()*Math.PI*2,pt=Math.sqrt(1-_e**2);return this.x=pt*Math.cos(at),this.y=pt*Math.sin(at),this.z=_e,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const a_=new Er,nm=new wo;class xl{constructor(_e=new Er(1/0,1/0,1/0),at=new Er(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=_e,this.max=at}set(_e,at){return this.min.copy(_e),this.max.copy(at),this}setFromArray(_e){this.makeEmpty();for(let at=0,pt=_e.length;at<pt;at+=3)this.expandByPoint(qo.fromArray(_e,at));return this}setFromBufferAttribute(_e){this.makeEmpty();for(let at=0,pt=_e.count;at<pt;at++)this.expandByPoint(qo.fromBufferAttribute(_e,at));return this}setFromPoints(_e){this.makeEmpty();for(let at=0,pt=_e.length;at<pt;at++)this.expandByPoint(_e[at]);return this}setFromCenterAndSize(_e,at){const pt=qo.copy(at).multiplyScalar(.5);return this.min.copy(_e).sub(pt),this.max.copy(_e).add(pt),this}setFromObject(_e,at=!1){return this.makeEmpty(),this.expandByObject(_e,at)}clone(){return new this.constructor().copy(this)}copy(_e){return this.min.copy(_e.min),this.max.copy(_e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(_e){return this.isEmpty()?_e.set(0,0,0):_e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(_e){return this.isEmpty()?_e.set(0,0,0):_e.subVectors(this.max,this.min)}expandByPoint(_e){return this.min.min(_e),this.max.max(_e),this}expandByVector(_e){return this.min.sub(_e),this.max.add(_e),this}expandByScalar(_e){return this.min.addScalar(-_e),this.max.addScalar(_e),this}expandByObject(_e,at=!1){if(_e.updateWorldMatrix(!1,!1),_e.boundingBox!==void 0)_e.boundingBox===null&&_e.computeBoundingBox(),Ou.copy(_e.boundingBox),Ou.applyMatrix4(_e.matrixWorld),this.union(Ou);else{const mt=_e.geometry;if(mt!==void 0)if(at&&mt.attributes!==void 0&&mt.attributes.position!==void 0){const vt=mt.attributes.position;for(let Ct=0,Tt=vt.count;Ct<Tt;Ct++)qo.fromBufferAttribute(vt,Ct).applyMatrix4(_e.matrixWorld),this.expandByPoint(qo)}else mt.boundingBox===null&&mt.computeBoundingBox(),Ou.copy(mt.boundingBox),Ou.applyMatrix4(_e.matrixWorld),this.union(Ou)}const pt=_e.children;for(let mt=0,vt=pt.length;mt<vt;mt++)this.expandByObject(pt[mt],at);return this}containsPoint(_e){return!(_e.x<this.min.x||_e.x>this.max.x||_e.y<this.min.y||_e.y>this.max.y||_e.z<this.min.z||_e.z>this.max.z)}containsBox(_e){return this.min.x<=_e.min.x&&_e.max.x<=this.max.x&&this.min.y<=_e.min.y&&_e.max.y<=this.max.y&&this.min.z<=_e.min.z&&_e.max.z<=this.max.z}getParameter(_e,at){return at.set((_e.x-this.min.x)/(this.max.x-this.min.x),(_e.y-this.min.y)/(this.max.y-this.min.y),(_e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(_e){return!(_e.max.x<this.min.x||_e.min.x>this.max.x||_e.max.y<this.min.y||_e.min.y>this.max.y||_e.max.z<this.min.z||_e.min.z>this.max.z)}intersectsSphere(_e){return this.clampPoint(_e.center,qo),qo.distanceToSquared(_e.center)<=_e.radius*_e.radius}intersectsPlane(_e){let at,pt;return _e.normal.x>0?(at=_e.normal.x*this.min.x,pt=_e.normal.x*this.max.x):(at=_e.normal.x*this.max.x,pt=_e.normal.x*this.min.x),_e.normal.y>0?(at+=_e.normal.y*this.min.y,pt+=_e.normal.y*this.max.y):(at+=_e.normal.y*this.max.y,pt+=_e.normal.y*this.min.y),_e.normal.z>0?(at+=_e.normal.z*this.min.z,pt+=_e.normal.z*this.max.z):(at+=_e.normal.z*this.max.z,pt+=_e.normal.z*this.min.z),at<=-_e.constant&&pt>=-_e.constant}intersectsTriangle(_e){if(this.isEmpty())return!1;this.getCenter(gp),sm.subVectors(this.max,gp),Nu.subVectors(_e.a,gp),Fu.subVectors(_e.b,gp),Uu.subVectors(_e.c,gp),Al.subVectors(Fu,Nu),Xl.subVectors(Uu,Fu),fu.subVectors(Nu,Uu);let at=[0,-Al.z,Al.y,0,-Xl.z,Xl.y,0,-fu.z,fu.y,Al.z,0,-Al.x,Xl.z,0,-Xl.x,fu.z,0,-fu.x,-Al.y,Al.x,0,-Xl.y,Xl.x,0,-fu.y,fu.x,0];return!!wl(at,Nu,Fu,Uu,sm)&&(at=[1,0,0,0,1,0,0,0,1],!!wl(at,Nu,Fu,Uu,sm)&&(am.crossVectors(Al,Xl),at=[am.x,am.y,am.z],wl(at,Nu,Fu,Uu,sm)))}clampPoint(_e,at){return at.copy(_e).clamp(this.min,this.max)}distanceToPoint(_e){return this.clampPoint(_e,qo).distanceTo(_e)}getBoundingSphere(_e){return this.isEmpty()?_e.makeEmpty():(this.getCenter(_e.center),_e.radius=.5*this.getSize(qo).length()),_e}intersect(_e){return this.min.max(_e.min),this.max.min(_e.max),this.isEmpty()&&this.makeEmpty(),this}union(_e){return this.min.min(_e.min),this.max.max(_e.max),this}applyMatrix4(_e){return this.isEmpty()||(Dl[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(_e),Dl[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(_e),Dl[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(_e),Dl[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(_e),Dl[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(_e),Dl[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(_e),Dl[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(_e),Dl[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(_e),this.setFromPoints(Dl)),this}translate(_e){return this.min.add(_e),this.max.add(_e),this}equals(_e){return _e.min.equals(this.min)&&_e.max.equals(this.max)}}const Dl=[new Er,new Er,new Er,new Er,new Er,new Er,new Er,new Er],qo=new Er,Ou=new xl,Nu=new Er,Fu=new Er,Uu=new Er,Al=new Er,Xl=new Er,fu=new Er,gp=new Er,sm=new Er,am=new Er,vu=new Er;function wl(Et,_e,at,pt,mt){for(let vt=0,Ct=Et.length-3;vt<=Ct;vt+=3){vu.fromArray(Et,vt);const Tt=mt.x*Math.abs(vu.x)+mt.y*Math.abs(vu.y)+mt.z*Math.abs(vu.z),Bt=_e.dot(vu),Lt=at.dot(vu),Ut=pt.dot(vu);if(Math.max(-Math.max(Bt,Lt,Ut),Math.min(Bt,Lt,Ut))>Tt)return!1}return!0}const iv=new xl,_p=new Er,fp=new Er;class jo{constructor(_e=new Er,at=-1){this.center=_e,this.radius=at}set(_e,at){return this.center.copy(_e),this.radius=at,this}setFromPoints(_e,at){const pt=this.center;at!==void 0?pt.copy(at):iv.setFromPoints(_e).getCenter(pt);let mt=0;for(let vt=0,Ct=_e.length;vt<Ct;vt++)mt=Math.max(mt,pt.distanceToSquared(_e[vt]));return this.radius=Math.sqrt(mt),this}copy(_e){return this.center.copy(_e.center),this.radius=_e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(_e){return _e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(_e){return _e.distanceTo(this.center)-this.radius}intersectsSphere(_e){const at=this.radius+_e.radius;return _e.center.distanceToSquared(this.center)<=at*at}intersectsBox(_e){return _e.intersectsSphere(this)}intersectsPlane(_e){return Math.abs(_e.distanceToPoint(this.center))<=this.radius}clampPoint(_e,at){const pt=this.center.distanceToSquared(_e);return at.copy(_e),pt>this.radius*this.radius&&(at.sub(this.center).normalize(),at.multiplyScalar(this.radius).add(this.center)),at}getBoundingBox(_e){return this.isEmpty()?(_e.makeEmpty(),_e):(_e.set(this.center,this.center),_e.expandByScalar(this.radius),_e)}applyMatrix4(_e){return this.center.applyMatrix4(_e),this.radius=this.radius*_e.getMaxScaleOnAxis(),this}translate(_e){return this.center.add(_e),this}expandByPoint(_e){if(this.isEmpty())return this.center.copy(_e),this.radius=0,this;_p.subVectors(_e,this.center);const at=_p.lengthSq();if(at>this.radius*this.radius){const pt=Math.sqrt(at),mt=.5*(pt-this.radius);this.center.addScaledVector(_p,mt/pt),this.radius+=mt}return this}union(_e){return _e.isEmpty()?this:this.isEmpty()?(this.copy(_e),this):(this.center.equals(_e.center)===!0?this.radius=Math.max(this.radius,_e.radius):(fp.subVectors(_e.center,this.center).setLength(_e.radius),this.expandByPoint(_p.copy(_e.center).add(fp)),this.expandByPoint(_p.copy(_e.center).sub(fp))),this)}equals(_e){return _e.center.equals(this.center)&&_e.radius===this.radius}clone(){return new this.constructor().copy(this)}}const El=new Er,o_=new Er,$o=new Er,Bl=new Er,Yl=new Er,om=new Er,Sl=new Er;class ju{constructor(_e=new Er,at=new Er(0,0,-1)){this.origin=_e,this.direction=at}set(_e,at){return this.origin.copy(_e),this.direction.copy(at),this}copy(_e){return this.origin.copy(_e.origin),this.direction.copy(_e.direction),this}at(_e,at){return at.copy(this.origin).addScaledVector(this.direction,_e)}lookAt(_e){return this.direction.copy(_e).sub(this.origin).normalize(),this}recast(_e){return this.origin.copy(this.at(_e,El)),this}closestPointToPoint(_e,at){at.subVectors(_e,this.origin);const pt=at.dot(this.direction);return pt<0?at.copy(this.origin):at.copy(this.origin).addScaledVector(this.direction,pt)}distanceToPoint(_e){return Math.sqrt(this.distanceSqToPoint(_e))}distanceSqToPoint(_e){const at=El.subVectors(_e,this.origin).dot(this.direction);return at<0?this.origin.distanceToSquared(_e):(El.copy(this.origin).addScaledVector(this.direction,at),El.distanceToSquared(_e))}distanceSqToSegment(_e,at,pt,mt){o_.copy(_e).add(at).multiplyScalar(.5),$o.copy(at).sub(_e).normalize(),Bl.copy(this.origin).sub(o_);const vt=.5*_e.distanceTo(at),Ct=-this.direction.dot($o),Tt=Bl.dot(this.direction),Bt=-Bl.dot($o),Lt=Bl.lengthSq(),Ut=Math.abs(1-Ct*Ct);let Qt,Ht,Wt,qt;if(Ut>0)if(Qt=Ct*Bt-Tt,Ht=Ct*Tt-Bt,qt=vt*Ut,Qt>=0)if(Ht>=-qt)if(Ht<=qt){const Jt=1/Ut;Qt*=Jt,Ht*=Jt,Wt=Qt*(Qt+Ct*Ht+2*Tt)+Ht*(Ct*Qt+Ht+2*Bt)+Lt}else Ht=vt,Qt=Math.max(0,-(Ct*Ht+Tt)),Wt=-Qt*Qt+Ht*(Ht+2*Bt)+Lt;else Ht=-vt,Qt=Math.max(0,-(Ct*Ht+Tt)),Wt=-Qt*Qt+Ht*(Ht+2*Bt)+Lt;else Ht<=-qt?(Qt=Math.max(0,-(-Ct*vt+Tt)),Ht=Qt>0?-vt:Math.min(Math.max(-vt,-Bt),vt),Wt=-Qt*Qt+Ht*(Ht+2*Bt)+Lt):Ht<=qt?(Qt=0,Ht=Math.min(Math.max(-vt,-Bt),vt),Wt=Ht*(Ht+2*Bt)+Lt):(Qt=Math.max(0,-(Ct*vt+Tt)),Ht=Qt>0?vt:Math.min(Math.max(-vt,-Bt),vt),Wt=-Qt*Qt+Ht*(Ht+2*Bt)+Lt);else Ht=Ct>0?-vt:vt,Qt=Math.max(0,-(Ct*Ht+Tt)),Wt=-Qt*Qt+Ht*(Ht+2*Bt)+Lt;return pt&&pt.copy(this.origin).addScaledVector(this.direction,Qt),mt&&mt.copy(o_).addScaledVector($o,Ht),Wt}intersectSphere(_e,at){El.subVectors(_e.center,this.origin);const pt=El.dot(this.direction),mt=El.dot(El)-pt*pt,vt=_e.radius*_e.radius;if(mt>vt)return null;const Ct=Math.sqrt(vt-mt),Tt=pt-Ct,Bt=pt+Ct;return Bt<0?null:Tt<0?this.at(Bt,at):this.at(Tt,at)}intersectsSphere(_e){return this.distanceSqToPoint(_e.center)<=_e.radius*_e.radius}distanceToPlane(_e){const at=_e.normal.dot(this.direction);if(at===0)return _e.distanceToPoint(this.origin)===0?0:null;const pt=-(this.origin.dot(_e.normal)+_e.constant)/at;return pt>=0?pt:null}intersectPlane(_e,at){const pt=this.distanceToPlane(_e);return pt===null?null:this.at(pt,at)}intersectsPlane(_e){const at=_e.distanceToPoint(this.origin);return at===0||_e.normal.dot(this.direction)*at<0}intersectBox(_e,at){let pt,mt,vt,Ct,Tt,Bt;const Lt=1/this.direction.x,Ut=1/this.direction.y,Qt=1/this.direction.z,Ht=this.origin;return Lt>=0?(pt=(_e.min.x-Ht.x)*Lt,mt=(_e.max.x-Ht.x)*Lt):(pt=(_e.max.x-Ht.x)*Lt,mt=(_e.min.x-Ht.x)*Lt),Ut>=0?(vt=(_e.min.y-Ht.y)*Ut,Ct=(_e.max.y-Ht.y)*Ut):(vt=(_e.max.y-Ht.y)*Ut,Ct=(_e.min.y-Ht.y)*Ut),pt>Ct||vt>mt?null:((vt>pt||isNaN(pt))&&(pt=vt),(Ct<mt||isNaN(mt))&&(mt=Ct),Qt>=0?(Tt=(_e.min.z-Ht.z)*Qt,Bt=(_e.max.z-Ht.z)*Qt):(Tt=(_e.max.z-Ht.z)*Qt,Bt=(_e.min.z-Ht.z)*Qt),pt>Bt||Tt>mt?null:((Tt>pt||pt!=pt)&&(pt=Tt),(Bt<mt||mt!=mt)&&(mt=Bt),mt<0?null:this.at(pt>=0?pt:mt,at)))}intersectsBox(_e){return this.intersectBox(_e,El)!==null}intersectTriangle(_e,at,pt,mt,vt){Yl.subVectors(at,_e),om.subVectors(pt,_e),Sl.crossVectors(Yl,om);let Ct,Tt=this.direction.dot(Sl);if(Tt>0){if(mt)return null;Ct=1}else{if(!(Tt<0))return null;Ct=-1,Tt=-Tt}Bl.subVectors(this.origin,_e);const Bt=Ct*this.direction.dot(om.crossVectors(Bl,om));if(Bt<0)return null;const Lt=Ct*this.direction.dot(Yl.cross(Bl));if(Lt<0||Bt+Lt>Tt)return null;const Ut=-Ct*Bl.dot(Sl);return Ut<0?null:this.at(Ut/Tt,vt)}applyMatrix4(_e){return this.origin.applyMatrix4(_e),this.direction.transformDirection(_e),this}equals(_e){return _e.origin.equals(this.origin)&&_e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class rs{constructor(_e,at,pt,mt,vt,Ct,Tt,Bt,Lt,Ut,Qt,Ht,Wt,qt,Jt,Xt){rs.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],_e!==void 0&&this.set(_e,at,pt,mt,vt,Ct,Tt,Bt,Lt,Ut,Qt,Ht,Wt,qt,Jt,Xt)}set(_e,at,pt,mt,vt,Ct,Tt,Bt,Lt,Ut,Qt,Ht,Wt,qt,Jt,Xt){const sr=this.elements;return sr[0]=_e,sr[4]=at,sr[8]=pt,sr[12]=mt,sr[1]=vt,sr[5]=Ct,sr[9]=Tt,sr[13]=Bt,sr[2]=Lt,sr[6]=Ut,sr[10]=Qt,sr[14]=Ht,sr[3]=Wt,sr[7]=qt,sr[11]=Jt,sr[15]=Xt,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new rs().fromArray(this.elements)}copy(_e){const at=this.elements,pt=_e.elements;return at[0]=pt[0],at[1]=pt[1],at[2]=pt[2],at[3]=pt[3],at[4]=pt[4],at[5]=pt[5],at[6]=pt[6],at[7]=pt[7],at[8]=pt[8],at[9]=pt[9],at[10]=pt[10],at[11]=pt[11],at[12]=pt[12],at[13]=pt[13],at[14]=pt[14],at[15]=pt[15],this}copyPosition(_e){const at=this.elements,pt=_e.elements;return at[12]=pt[12],at[13]=pt[13],at[14]=pt[14],this}setFromMatrix3(_e){const at=_e.elements;return this.set(at[0],at[3],at[6],0,at[1],at[4],at[7],0,at[2],at[5],at[8],0,0,0,0,1),this}extractBasis(_e,at,pt){return _e.setFromMatrixColumn(this,0),at.setFromMatrixColumn(this,1),pt.setFromMatrixColumn(this,2),this}makeBasis(_e,at,pt){return this.set(_e.x,at.x,pt.x,0,_e.y,at.y,pt.y,0,_e.z,at.z,pt.z,0,0,0,0,1),this}extractRotation(_e){const at=this.elements,pt=_e.elements,mt=1/Gu.setFromMatrixColumn(_e,0).length(),vt=1/Gu.setFromMatrixColumn(_e,1).length(),Ct=1/Gu.setFromMatrixColumn(_e,2).length();return at[0]=pt[0]*mt,at[1]=pt[1]*mt,at[2]=pt[2]*mt,at[3]=0,at[4]=pt[4]*vt,at[5]=pt[5]*vt,at[6]=pt[6]*vt,at[7]=0,at[8]=pt[8]*Ct,at[9]=pt[9]*Ct,at[10]=pt[10]*Ct,at[11]=0,at[12]=0,at[13]=0,at[14]=0,at[15]=1,this}makeRotationFromEuler(_e){const at=this.elements,pt=_e.x,mt=_e.y,vt=_e.z,Ct=Math.cos(pt),Tt=Math.sin(pt),Bt=Math.cos(mt),Lt=Math.sin(mt),Ut=Math.cos(vt),Qt=Math.sin(vt);if(_e.order==="XYZ"){const Ht=Ct*Ut,Wt=Ct*Qt,qt=Tt*Ut,Jt=Tt*Qt;at[0]=Bt*Ut,at[4]=-Bt*Qt,at[8]=Lt,at[1]=Wt+qt*Lt,at[5]=Ht-Jt*Lt,at[9]=-Tt*Bt,at[2]=Jt-Ht*Lt,at[6]=qt+Wt*Lt,at[10]=Ct*Bt}else if(_e.order==="YXZ"){const Ht=Bt*Ut,Wt=Bt*Qt,qt=Lt*Ut,Jt=Lt*Qt;at[0]=Ht+Jt*Tt,at[4]=qt*Tt-Wt,at[8]=Ct*Lt,at[1]=Ct*Qt,at[5]=Ct*Ut,at[9]=-Tt,at[2]=Wt*Tt-qt,at[6]=Jt+Ht*Tt,at[10]=Ct*Bt}else if(_e.order==="ZXY"){const Ht=Bt*Ut,Wt=Bt*Qt,qt=Lt*Ut,Jt=Lt*Qt;at[0]=Ht-Jt*Tt,at[4]=-Ct*Qt,at[8]=qt+Wt*Tt,at[1]=Wt+qt*Tt,at[5]=Ct*Ut,at[9]=Jt-Ht*Tt,at[2]=-Ct*Lt,at[6]=Tt,at[10]=Ct*Bt}else if(_e.order==="ZYX"){const Ht=Ct*Ut,Wt=Ct*Qt,qt=Tt*Ut,Jt=Tt*Qt;at[0]=Bt*Ut,at[4]=qt*Lt-Wt,at[8]=Ht*Lt+Jt,at[1]=Bt*Qt,at[5]=Jt*Lt+Ht,at[9]=Wt*Lt-qt,at[2]=-Lt,at[6]=Tt*Bt,at[10]=Ct*Bt}else if(_e.order==="YZX"){const Ht=Ct*Bt,Wt=Ct*Lt,qt=Tt*Bt,Jt=Tt*Lt;at[0]=Bt*Ut,at[4]=Jt-Ht*Qt,at[8]=qt*Qt+Wt,at[1]=Qt,at[5]=Ct*Ut,at[9]=-Tt*Ut,at[2]=-Lt*Ut,at[6]=Wt*Qt+qt,at[10]=Ht-Jt*Qt}else if(_e.order==="XZY"){const Ht=Ct*Bt,Wt=Ct*Lt,qt=Tt*Bt,Jt=Tt*Lt;at[0]=Bt*Ut,at[4]=-Qt,at[8]=Lt*Ut,at[1]=Ht*Qt+Jt,at[5]=Ct*Ut,at[9]=Wt*Qt-qt,at[2]=qt*Qt-Wt,at[6]=Tt*Ut,at[10]=Jt*Qt+Ht}return at[3]=0,at[7]=0,at[11]=0,at[12]=0,at[13]=0,at[14]=0,at[15]=1,this}makeRotationFromQuaternion(_e){return this.compose(zu,_e,nv)}lookAt(_e,at,pt){const mt=this.elements;return _o.subVectors(_e,at),_o.lengthSq()===0&&(_o.z=1),_o.normalize(),Kl.crossVectors(pt,_o),Kl.lengthSq()===0&&(Math.abs(pt.z)===1?_o.x+=1e-4:_o.z+=1e-4,_o.normalize(),Kl.crossVectors(pt,_o)),Kl.normalize(),lm.crossVectors(_o,Kl),mt[0]=Kl.x,mt[4]=lm.x,mt[8]=_o.x,mt[1]=Kl.y,mt[5]=lm.y,mt[9]=_o.y,mt[2]=Kl.z,mt[6]=lm.z,mt[10]=_o.z,this}multiply(_e){return this.multiplyMatrices(this,_e)}premultiply(_e){return this.multiplyMatrices(_e,this)}multiplyMatrices(_e,at){const pt=_e.elements,mt=at.elements,vt=this.elements,Ct=pt[0],Tt=pt[4],Bt=pt[8],Lt=pt[12],Ut=pt[1],Qt=pt[5],Ht=pt[9],Wt=pt[13],qt=pt[2],Jt=pt[6],Xt=pt[10],sr=pt[14],Zt=pt[3],er=pt[7],xr=pt[11],Ar=pt[15],yr=mt[0],Tr=mt[4],Hr=mt[8],Nr=mt[12],zr=mt[1],Gr=mt[5],Vr=mt[9],gn=mt[13],pn=mt[2],Mn=mt[6],Dn=mt[10],cn=mt[14],$r=mt[3],Kr=mt[7],sn=mt[11],nn=mt[15];return vt[0]=Ct*yr+Tt*zr+Bt*pn+Lt*$r,vt[4]=Ct*Tr+Tt*Gr+Bt*Mn+Lt*Kr,vt[8]=Ct*Hr+Tt*Vr+Bt*Dn+Lt*sn,vt[12]=Ct*Nr+Tt*gn+Bt*cn+Lt*nn,vt[1]=Ut*yr+Qt*zr+Ht*pn+Wt*$r,vt[5]=Ut*Tr+Qt*Gr+Ht*Mn+Wt*Kr,vt[9]=Ut*Hr+Qt*Vr+Ht*Dn+Wt*sn,vt[13]=Ut*Nr+Qt*gn+Ht*cn+Wt*nn,vt[2]=qt*yr+Jt*zr+Xt*pn+sr*$r,vt[6]=qt*Tr+Jt*Gr+Xt*Mn+sr*Kr,vt[10]=qt*Hr+Jt*Vr+Xt*Dn+sr*sn,vt[14]=qt*Nr+Jt*gn+Xt*cn+sr*nn,vt[3]=Zt*yr+er*zr+xr*pn+Ar*$r,vt[7]=Zt*Tr+er*Gr+xr*Mn+Ar*Kr,vt[11]=Zt*Hr+er*Vr+xr*Dn+Ar*sn,vt[15]=Zt*Nr+er*gn+xr*cn+Ar*nn,this}multiplyScalar(_e){const at=this.elements;return at[0]*=_e,at[4]*=_e,at[8]*=_e,at[12]*=_e,at[1]*=_e,at[5]*=_e,at[9]*=_e,at[13]*=_e,at[2]*=_e,at[6]*=_e,at[10]*=_e,at[14]*=_e,at[3]*=_e,at[7]*=_e,at[11]*=_e,at[15]*=_e,this}determinant(){const _e=this.elements,at=_e[0],pt=_e[4],mt=_e[8],vt=_e[12],Ct=_e[1],Tt=_e[5],Bt=_e[9],Lt=_e[13],Ut=_e[2],Qt=_e[6],Ht=_e[10],Wt=_e[14];return _e[3]*(+vt*Bt*Qt-mt*Lt*Qt-vt*Tt*Ht+pt*Lt*Ht+mt*Tt*Wt-pt*Bt*Wt)+_e[7]*(+at*Bt*Wt-at*Lt*Ht+vt*Ct*Ht-mt*Ct*Wt+mt*Lt*Ut-vt*Bt*Ut)+_e[11]*(+at*Lt*Qt-at*Tt*Wt-vt*Ct*Qt+pt*Ct*Wt+vt*Tt*Ut-pt*Lt*Ut)+_e[15]*(-mt*Tt*Ut-at*Bt*Qt+at*Tt*Ht+mt*Ct*Qt-pt*Ct*Ht+pt*Bt*Ut)}transpose(){const _e=this.elements;let at;return at=_e[1],_e[1]=_e[4],_e[4]=at,at=_e[2],_e[2]=_e[8],_e[8]=at,at=_e[6],_e[6]=_e[9],_e[9]=at,at=_e[3],_e[3]=_e[12],_e[12]=at,at=_e[7],_e[7]=_e[13],_e[13]=at,at=_e[11],_e[11]=_e[14],_e[14]=at,this}setPosition(_e,at,pt){const mt=this.elements;return _e.isVector3?(mt[12]=_e.x,mt[13]=_e.y,mt[14]=_e.z):(mt[12]=_e,mt[13]=at,mt[14]=pt),this}invert(){const _e=this.elements,at=_e[0],pt=_e[1],mt=_e[2],vt=_e[3],Ct=_e[4],Tt=_e[5],Bt=_e[6],Lt=_e[7],Ut=_e[8],Qt=_e[9],Ht=_e[10],Wt=_e[11],qt=_e[12],Jt=_e[13],Xt=_e[14],sr=_e[15],Zt=Qt*Xt*Lt-Jt*Ht*Lt+Jt*Bt*Wt-Tt*Xt*Wt-Qt*Bt*sr+Tt*Ht*sr,er=qt*Ht*Lt-Ut*Xt*Lt-qt*Bt*Wt+Ct*Xt*Wt+Ut*Bt*sr-Ct*Ht*sr,xr=Ut*Jt*Lt-qt*Qt*Lt+qt*Tt*Wt-Ct*Jt*Wt-Ut*Tt*sr+Ct*Qt*sr,Ar=qt*Qt*Bt-Ut*Jt*Bt-qt*Tt*Ht+Ct*Jt*Ht+Ut*Tt*Xt-Ct*Qt*Xt,yr=at*Zt+pt*er+mt*xr+vt*Ar;if(yr===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const Tr=1/yr;return _e[0]=Zt*Tr,_e[1]=(Jt*Ht*vt-Qt*Xt*vt-Jt*mt*Wt+pt*Xt*Wt+Qt*mt*sr-pt*Ht*sr)*Tr,_e[2]=(Tt*Xt*vt-Jt*Bt*vt+Jt*mt*Lt-pt*Xt*Lt-Tt*mt*sr+pt*Bt*sr)*Tr,_e[3]=(Qt*Bt*vt-Tt*Ht*vt-Qt*mt*Lt+pt*Ht*Lt+Tt*mt*Wt-pt*Bt*Wt)*Tr,_e[4]=er*Tr,_e[5]=(Ut*Xt*vt-qt*Ht*vt+qt*mt*Wt-at*Xt*Wt-Ut*mt*sr+at*Ht*sr)*Tr,_e[6]=(qt*Bt*vt-Ct*Xt*vt-qt*mt*Lt+at*Xt*Lt+Ct*mt*sr-at*Bt*sr)*Tr,_e[7]=(Ct*Ht*vt-Ut*Bt*vt+Ut*mt*Lt-at*Ht*Lt-Ct*mt*Wt+at*Bt*Wt)*Tr,_e[8]=xr*Tr,_e[9]=(qt*Qt*vt-Ut*Jt*vt-qt*pt*Wt+at*Jt*Wt+Ut*pt*sr-at*Qt*sr)*Tr,_e[10]=(Ct*Jt*vt-qt*Tt*vt+qt*pt*Lt-at*Jt*Lt-Ct*pt*sr+at*Tt*sr)*Tr,_e[11]=(Ut*Tt*vt-Ct*Qt*vt-Ut*pt*Lt+at*Qt*Lt+Ct*pt*Wt-at*Tt*Wt)*Tr,_e[12]=Ar*Tr,_e[13]=(Ut*Jt*mt-qt*Qt*mt+qt*pt*Ht-at*Jt*Ht-Ut*pt*Xt+at*Qt*Xt)*Tr,_e[14]=(qt*Tt*mt-Ct*Jt*mt-qt*pt*Bt+at*Jt*Bt+Ct*pt*Xt-at*Tt*Xt)*Tr,_e[15]=(Ct*Qt*mt-Ut*Tt*mt+Ut*pt*Bt-at*Qt*Bt-Ct*pt*Ht+at*Tt*Ht)*Tr,this}scale(_e){const at=this.elements,pt=_e.x,mt=_e.y,vt=_e.z;return at[0]*=pt,at[4]*=mt,at[8]*=vt,at[1]*=pt,at[5]*=mt,at[9]*=vt,at[2]*=pt,at[6]*=mt,at[10]*=vt,at[3]*=pt,at[7]*=mt,at[11]*=vt,this}getMaxScaleOnAxis(){const _e=this.elements,at=_e[0]*_e[0]+_e[1]*_e[1]+_e[2]*_e[2],pt=_e[4]*_e[4]+_e[5]*_e[5]+_e[6]*_e[6],mt=_e[8]*_e[8]+_e[9]*_e[9]+_e[10]*_e[10];return Math.sqrt(Math.max(at,pt,mt))}makeTranslation(_e,at,pt){return _e.isVector3?this.set(1,0,0,_e.x,0,1,0,_e.y,0,0,1,_e.z,0,0,0,1):this.set(1,0,0,_e,0,1,0,at,0,0,1,pt,0,0,0,1),this}makeRotationX(_e){const at=Math.cos(_e),pt=Math.sin(_e);return this.set(1,0,0,0,0,at,-pt,0,0,pt,at,0,0,0,0,1),this}makeRotationY(_e){const at=Math.cos(_e),pt=Math.sin(_e);return this.set(at,0,pt,0,0,1,0,0,-pt,0,at,0,0,0,0,1),this}makeRotationZ(_e){const at=Math.cos(_e),pt=Math.sin(_e);return this.set(at,-pt,0,0,pt,at,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(_e,at){const pt=Math.cos(at),mt=Math.sin(at),vt=1-pt,Ct=_e.x,Tt=_e.y,Bt=_e.z,Lt=vt*Ct,Ut=vt*Tt;return this.set(Lt*Ct+pt,Lt*Tt-mt*Bt,Lt*Bt+mt*Tt,0,Lt*Tt+mt*Bt,Ut*Tt+pt,Ut*Bt-mt*Ct,0,Lt*Bt-mt*Tt,Ut*Bt+mt*Ct,vt*Bt*Bt+pt,0,0,0,0,1),this}makeScale(_e,at,pt){return this.set(_e,0,0,0,0,at,0,0,0,0,pt,0,0,0,0,1),this}makeShear(_e,at,pt,mt,vt,Ct){return this.set(1,pt,vt,0,_e,1,Ct,0,at,mt,1,0,0,0,0,1),this}compose(_e,at,pt){const mt=this.elements,vt=at._x,Ct=at._y,Tt=at._z,Bt=at._w,Lt=vt+vt,Ut=Ct+Ct,Qt=Tt+Tt,Ht=vt*Lt,Wt=vt*Ut,qt=vt*Qt,Jt=Ct*Ut,Xt=Ct*Qt,sr=Tt*Qt,Zt=Bt*Lt,er=Bt*Ut,xr=Bt*Qt,Ar=pt.x,yr=pt.y,Tr=pt.z;return mt[0]=(1-(Jt+sr))*Ar,mt[1]=(Wt+xr)*Ar,mt[2]=(qt-er)*Ar,mt[3]=0,mt[4]=(Wt-xr)*yr,mt[5]=(1-(Ht+sr))*yr,mt[6]=(Xt+Zt)*yr,mt[7]=0,mt[8]=(qt+er)*Tr,mt[9]=(Xt-Zt)*Tr,mt[10]=(1-(Ht+Jt))*Tr,mt[11]=0,mt[12]=_e.x,mt[13]=_e.y,mt[14]=_e.z,mt[15]=1,this}decompose(_e,at,pt){const mt=this.elements;let vt=Gu.set(mt[0],mt[1],mt[2]).length();const Ct=Gu.set(mt[4],mt[5],mt[6]).length(),Tt=Gu.set(mt[8],mt[9],mt[10]).length();this.determinant()<0&&(vt=-vt),_e.x=mt[12],_e.y=mt[13],_e.z=mt[14],Xo.copy(this);const Bt=1/vt,Lt=1/Ct,Ut=1/Tt;return Xo.elements[0]*=Bt,Xo.elements[1]*=Bt,Xo.elements[2]*=Bt,Xo.elements[4]*=Lt,Xo.elements[5]*=Lt,Xo.elements[6]*=Lt,Xo.elements[8]*=Ut,Xo.elements[9]*=Ut,Xo.elements[10]*=Ut,at.setFromRotationMatrix(Xo),pt.x=vt,pt.y=Ct,pt.z=Tt,this}makePerspective(_e,at,pt,mt,vt,Ct,Tt=Uo){const Bt=this.elements,Lt=2*vt/(at-_e),Ut=2*vt/(pt-mt),Qt=(at+_e)/(at-_e),Ht=(pt+mt)/(pt-mt);let Wt,qt;if(Tt===Uo)Wt=-(Ct+vt)/(Ct-vt),qt=-2*Ct*vt/(Ct-vt);else{if(Tt!==Qo)throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+Tt);Wt=-Ct/(Ct-vt),qt=-Ct*vt/(Ct-vt)}return Bt[0]=Lt,Bt[4]=0,Bt[8]=Qt,Bt[12]=0,Bt[1]=0,Bt[5]=Ut,Bt[9]=Ht,Bt[13]=0,Bt[2]=0,Bt[6]=0,Bt[10]=Wt,Bt[14]=qt,Bt[3]=0,Bt[7]=0,Bt[11]=-1,Bt[15]=0,this}makeOrthographic(_e,at,pt,mt,vt,Ct,Tt=Uo){const Bt=this.elements,Lt=1/(at-_e),Ut=1/(pt-mt),Qt=1/(Ct-vt),Ht=(at+_e)*Lt,Wt=(pt+mt)*Ut;let qt,Jt;if(Tt===Uo)qt=(Ct+vt)*Qt,Jt=-2*Qt;else{if(Tt!==Qo)throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+Tt);qt=vt*Qt,Jt=-1*Qt}return Bt[0]=2*Lt,Bt[4]=0,Bt[8]=0,Bt[12]=-Ht,Bt[1]=0,Bt[5]=2*Ut,Bt[9]=0,Bt[13]=-Wt,Bt[2]=0,Bt[6]=0,Bt[10]=Jt,Bt[14]=-qt,Bt[3]=0,Bt[7]=0,Bt[11]=0,Bt[15]=1,this}equals(_e){const at=this.elements,pt=_e.elements;for(let mt=0;mt<16;mt++)if(at[mt]!==pt[mt])return!1;return!0}fromArray(_e,at=0){for(let pt=0;pt<16;pt++)this.elements[pt]=_e[pt+at];return this}toArray(_e=[],at=0){const pt=this.elements;return _e[at]=pt[0],_e[at+1]=pt[1],_e[at+2]=pt[2],_e[at+3]=pt[3],_e[at+4]=pt[4],_e[at+5]=pt[5],_e[at+6]=pt[6],_e[at+7]=pt[7],_e[at+8]=pt[8],_e[at+9]=pt[9],_e[at+10]=pt[10],_e[at+11]=pt[11],_e[at+12]=pt[12],_e[at+13]=pt[13],_e[at+14]=pt[14],_e[at+15]=pt[15],_e}}const Gu=new Er,Xo=new rs,zu=new Er(0,0,0),nv=new Er(1,1,1),Kl=new Er,lm=new Er,_o=new Er,sv=new rs,yu=new wo;class Vu{constructor(_e=0,at=0,pt=0,mt=Vu.DEFAULT_ORDER){this.isEuler=!0,this._x=_e,this._y=at,this._z=pt,this._order=mt}get x(){return this._x}set x(_e){this._x=_e,this._onChangeCallback()}get y(){return this._y}set y(_e){this._y=_e,this._onChangeCallback()}get z(){return this._z}set z(_e){this._z=_e,this._onChangeCallback()}get order(){return this._order}set order(_e){this._order=_e,this._onChangeCallback()}set(_e,at,pt,mt=this._order){return this._x=_e,this._y=at,this._z=pt,this._order=mt,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(_e){return this._x=_e._x,this._y=_e._y,this._z=_e._z,this._order=_e._order,this._onChangeCallback(),this}setFromRotationMatrix(_e,at=this._order,pt=!0){const mt=_e.elements,vt=mt[0],Ct=mt[4],Tt=mt[8],Bt=mt[1],Lt=mt[5],Ut=mt[9],Qt=mt[2],Ht=mt[6],Wt=mt[10];switch(at){case"XYZ":this._y=Math.asin(Hs(Tt,-1,1)),Math.abs(Tt)<.9999999?(this._x=Math.atan2(-Ut,Wt),this._z=Math.atan2(-Ct,vt)):(this._x=Math.atan2(Ht,Lt),this._z=0);break;case"YXZ":this._x=Math.asin(-Hs(Ut,-1,1)),Math.abs(Ut)<.9999999?(this._y=Math.atan2(Tt,Wt),this._z=Math.atan2(Bt,Lt)):(this._y=Math.atan2(-Qt,vt),this._z=0);break;case"ZXY":this._x=Math.asin(Hs(Ht,-1,1)),Math.abs(Ht)<.9999999?(this._y=Math.atan2(-Qt,Wt),this._z=Math.atan2(-Ct,Lt)):(this._y=0,this._z=Math.atan2(Bt,vt));break;case"ZYX":this._y=Math.asin(-Hs(Qt,-1,1)),Math.abs(Qt)<.9999999?(this._x=Math.atan2(Ht,Wt),this._z=Math.atan2(Bt,vt)):(this._x=0,this._z=Math.atan2(-Ct,Lt));break;case"YZX":this._z=Math.asin(Hs(Bt,-1,1)),Math.abs(Bt)<.9999999?(this._x=Math.atan2(-Ut,Lt),this._y=Math.atan2(-Qt,vt)):(this._x=0,this._y=Math.atan2(Tt,Wt));break;case"XZY":this._z=Math.asin(-Hs(Ct,-1,1)),Math.abs(Ct)<.9999999?(this._x=Math.atan2(Ht,Lt),this._y=Math.atan2(Tt,vt)):(this._x=Math.atan2(-Ut,Wt),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+at)}return this._order=at,pt===!0&&this._onChangeCallback(),this}setFromQuaternion(_e,at,pt){return sv.makeRotationFromQuaternion(_e),this.setFromRotationMatrix(sv,at,pt)}setFromVector3(_e,at=this._order){return this.set(_e.x,_e.y,_e.z,at)}reorder(_e){return yu.setFromEuler(this),this.setFromQuaternion(yu,_e)}equals(_e){return _e._x===this._x&&_e._y===this._y&&_e._z===this._z&&_e._order===this._order}fromArray(_e){return this._x=_e[0],this._y=_e[1],this._z=_e[2],_e[3]!==void 0&&(this._order=_e[3]),this._onChangeCallback(),this}toArray(_e=[],at=0){return _e[at]=this._x,_e[at+1]=this._y,_e[at+2]=this._z,_e[at+3]=this._order,_e}_onChange(_e){return this._onChangeCallback=_e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}Vu.DEFAULT_ORDER="XYZ";class cm{constructor(){this.mask=1}set(_e){this.mask=1<<_e>>>0}enable(_e){this.mask|=1<<_e}enableAll(){this.mask=-1}toggle(_e){this.mask^=1<<_e}disable(_e){this.mask&=~(1<<_e)}disableAll(){this.mask=0}test(_e){return!!(this.mask&_e.mask)}isEnabled(_e){return!!(this.mask&1<<_e)}}let k0=0;const av=new Er,Hu=new wo,Io=new rs,vp=new Er,yp=new Er,l_=new Er,ov=new wo,lv=new Er(1,0,0),um=new Er(0,1,0),cv=new Er(0,0,1),Jl={type:"added"},D0={type:"removed"};class Ss extends mo{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:k0++}),this.uuid=xo(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Ss.DEFAULT_UP.clone();const _e=new Er,at=new Vu,pt=new wo,mt=new Er(1,1,1);at._onChange(function(){pt.setFromEuler(at,!1)}),pt._onChange(function(){at.setFromQuaternion(pt,void 0,!1)}),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:_e},rotation:{configurable:!0,enumerable:!0,value:at},quaternion:{configurable:!0,enumerable:!0,value:pt},scale:{configurable:!0,enumerable:!0,value:mt},modelViewMatrix:{value:new rs},normalMatrix:{value:new as}}),this.matrix=new rs,this.matrixWorld=new rs,this.matrixAutoUpdate=Ss.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.matrixWorldAutoUpdate=Ss.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.layers=new cm,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(_e,at,pt,mt,vt,Ct){this.dispatchEvent({type:"beforeRender",renderer:_e,scene:at,camera:pt,geometry:mt,material:vt,group:Ct})}onAfterRender(_e,at,pt,mt,vt,Ct){this.dispatchEvent({type:"afterRender",renderer:_e,scene:at,camera:pt,geometry:mt,material:vt,group:Ct})}applyMatrix4(_e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(_e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(_e){return this.quaternion.premultiply(_e),this}setRotationFromAxisAngle(_e,at){this.quaternion.setFromAxisAngle(_e,at)}setRotationFromEuler(_e){this.quaternion.setFromEuler(_e,!0)}setRotationFromMatrix(_e){this.quaternion.setFromRotationMatrix(_e)}setRotationFromQuaternion(_e){this.quaternion.copy(_e)}rotateOnAxis(_e,at){return Hu.setFromAxisAngle(_e,at),this.quaternion.multiply(Hu),this}rotateOnWorldAxis(_e,at){return Hu.setFromAxisAngle(_e,at),this.quaternion.premultiply(Hu),this}rotateX(_e){return this.rotateOnAxis(lv,_e)}rotateY(_e){return this.rotateOnAxis(um,_e)}rotateZ(_e){return this.rotateOnAxis(cv,_e)}translateOnAxis(_e,at){return av.copy(_e).applyQuaternion(this.quaternion),this.position.add(av.multiplyScalar(at)),this}translateX(_e){return this.translateOnAxis(lv,_e)}translateY(_e){return this.translateOnAxis(um,_e)}translateZ(_e){return this.translateOnAxis(cv,_e)}localToWorld(_e){return this.updateWorldMatrix(!0,!1),_e.applyMatrix4(this.matrixWorld)}worldToLocal(_e){return this.updateWorldMatrix(!0,!1),_e.applyMatrix4(Io.copy(this.matrixWorld).invert())}lookAt(_e,at,pt){_e.isVector3?vp.copy(_e):vp.set(_e,at,pt);const mt=this.parent;this.updateWorldMatrix(!0,!1),yp.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Io.lookAt(yp,vp,this.up):Io.lookAt(vp,yp,this.up),this.quaternion.setFromRotationMatrix(Io),mt&&(Io.extractRotation(mt.matrixWorld),Hu.setFromRotationMatrix(Io),this.quaternion.premultiply(Hu.invert()))}add(_e){if(arguments.length>1){for(let at=0;at<arguments.length;at++)this.add(arguments[at]);return this}return _e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",_e),this):(_e&&_e.isObject3D?(_e.parent!==null&&_e.parent.remove(_e),_e.parent=this,this.children.push(_e),_e.dispatchEvent(Jl)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",_e),this)}remove(_e){if(arguments.length>1){for(let pt=0;pt<arguments.length;pt++)this.remove(arguments[pt]);return this}const at=this.children.indexOf(_e);return at!==-1&&(_e.parent=null,this.children.splice(at,1),_e.dispatchEvent(D0)),this}removeFromParent(){const _e=this.parent;return _e!==null&&_e.remove(this),this}clear(){return this.remove(...this.children)}attach(_e){return this.updateWorldMatrix(!0,!1),Io.copy(this.matrixWorld).invert(),_e.parent!==null&&(_e.parent.updateWorldMatrix(!0,!1),Io.multiply(_e.parent.matrixWorld)),_e.applyMatrix4(Io),this.add(_e),_e.updateWorldMatrix(!1,!0),this}getObjectById(_e){return this.getObjectByProperty("id",_e)}getObjectByName(_e){return this.getObjectByProperty("name",_e)}getObjectByProperty(_e,at){if(this[_e]===at)return this;for(let pt=0,mt=this.children.length;pt<mt;pt++){const vt=this.children[pt].getObjectByProperty(_e,at);if(vt!==void 0)return vt}}getObjectsByProperty(_e,at){let pt=[];this[_e]===at&&pt.push(this);for(let mt=0,vt=this.children.length;mt<vt;mt++){const Ct=this.children[mt].getObjectsByProperty(_e,at);Ct.length>0&&(pt=pt.concat(Ct))}return pt}getWorldPosition(_e){return this.updateWorldMatrix(!0,!1),_e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(_e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(yp,_e,l_),_e}getWorldScale(_e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(yp,ov,_e),_e}getWorldDirection(_e){this.updateWorldMatrix(!0,!1);const at=this.matrixWorld.elements;return _e.set(at[8],at[9],at[10]).normalize()}raycast(){}traverse(_e){_e(this);const at=this.children;for(let pt=0,mt=at.length;pt<mt;pt++)at[pt].traverse(_e)}traverseVisible(_e){if(this.visible===!1)return;_e(this);const at=this.children;for(let pt=0,mt=at.length;pt<mt;pt++)at[pt].traverseVisible(_e)}traverseAncestors(_e){const at=this.parent;at!==null&&(_e(at),at.traverseAncestors(_e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(_e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||_e)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,_e=!0);const at=this.children;for(let pt=0,mt=at.length;pt<mt;pt++){const vt=at[pt];vt.matrixWorldAutoUpdate!==!0&&_e!==!0||vt.updateMatrixWorld(_e)}}updateWorldMatrix(_e,at){const pt=this.parent;if(_e===!0&&pt!==null&&pt.matrixWorldAutoUpdate===!0&&pt.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),at===!0){const mt=this.children;for(let vt=0,Ct=mt.length;vt<Ct;vt++){const Tt=mt[vt];Tt.matrixWorldAutoUpdate===!0&&Tt.updateWorldMatrix(!1,!0)}}}toJSON(_e){const at=_e===void 0||typeof _e=="string",pt={};at&&(_e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{},extras:{}},pt.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const mt={};function vt(Tt,Bt){return Tt[Bt.uuid]===void 0&&(Tt[Bt.uuid]=Bt.toJSON(_e)),Bt.uuid}if(mt.uuid=this.uuid,mt.type=this.type,this.name!==""&&(mt.name=this.name),this.castShadow===!0&&(mt.castShadow=!0),this.receiveShadow===!0&&(mt.receiveShadow=!0),this.visible===!1&&(mt.visible=!1),this.frustumCulled===!1&&(mt.frustumCulled=!1),this.renderOrder!==0&&(mt.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(mt.userData=this.userData),mt.layers=this.layers.mask,mt.matrix=this.matrix.toArray(),mt.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(mt.matrixAutoUpdate=!1),this.isInstancedMesh&&(mt.type="InstancedMesh",mt.count=this.count,mt.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(mt.instanceColor=this.instanceColor.toJSON())),this.isScene)this.background&&(this.background.isColor?mt.background=this.background.toJSON():this.background.isTexture&&(mt.background=this.background.toJSON(_e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(mt.environment=this.environment.toJSON(_e).uuid);else if(this.isMesh||this.isLine||this.isPoints){mt.geometry=vt(_e.geometries,this.geometry);const Tt=this.geometry.parameters;if(Tt!==void 0&&Tt.shapes!==void 0){const Bt=Tt.shapes;if(Array.isArray(Bt))for(let Lt=0,Ut=Bt.length;Lt<Ut;Lt++){const Qt=Bt[Lt];vt(_e.shapes,Qt)}else vt(_e.shapes,Bt)}}if(this.isSkinnedMesh&&(mt.bindMode=this.bindMode,mt.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(vt(_e.skeletons,this.skeleton),mt.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const Tt=[];for(let Bt=0,Lt=this.material.length;Bt<Lt;Bt++)Tt.push(vt(_e.materials,this.material[Bt]));mt.material=Tt}else mt.material=vt(_e.materials,this.material);if(this.children.length>0){mt.children=[];for(let Tt=0;Tt<this.children.length;Tt++)mt.children.push(this.children[Tt].toJSON(_e).object)}if(this.animations.length>0){mt.animations=[];for(let Tt=0;Tt<this.animations.length;Tt++){const Bt=this.animations[Tt];mt.animations.push(vt(_e.animations,Bt))}}if(at){const Tt=Ct(_e.geometries),Bt=Ct(_e.materials),Lt=Ct(_e.textures),Ut=Ct(_e.images),Qt=Ct(_e.shapes),Ht=Ct(_e.skeletons),Wt=Ct(_e.animations),qt=Ct(_e.nodes);Tt.length>0&&(pt.geometries=Tt),Bt.length>0&&(pt.materials=Bt),Lt.length>0&&(pt.textures=Lt),Ut.length>0&&(pt.images=Ut),Qt.length>0&&(pt.shapes=Qt),Ht.length>0&&(pt.skeletons=Ht),Wt.length>0&&(pt.animations=Wt),qt.length>0&&(pt.nodes=qt)}return pt.object=mt,pt;function Ct(Tt){const Bt=[];for(const Lt in Tt){const Ut=Tt[Lt];delete Ut.metadata,Bt.push(Ut)}return Bt}}clone(_e){return new this.constructor().copy(this,_e)}copy(_e,at=!0){this.name=_e.name,this.up.copy(_e.up),this.position.copy(_e.position),this.rotation.order=_e.rotation.order,this.quaternion.copy(_e.quaternion),this.scale.copy(_e.scale),this.matrix.copy(_e.matrix),this.matrixWorld.copy(_e.matrixWorld),this.matrixAutoUpdate=_e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=_e.matrixWorldNeedsUpdate,this.matrixWorldAutoUpdate=_e.matrixWorldAutoUpdate,this.layers.mask=_e.layers.mask,this.visible=_e.visible,this.castShadow=_e.castShadow,this.receiveShadow=_e.receiveShadow,this.frustumCulled=_e.frustumCulled,this.renderOrder=_e.renderOrder,this.animations=_e.animations.slice(),this.userData={};for(const[pt,mt]of Object.entries(_e.userData))this.userData[pt]=!mt||mt&&(mt.isTexture||mt.isObject3D)?mt:JSON.parse(JSON.stringify(mt));if(at===!0)for(let pt=0;pt<_e.children.length;pt++){const mt=_e.children[pt];this.add(mt.clone())}return this}}Ss.DEFAULT_UP=new Er(0,1,0),Ss.DEFAULT_MATRIX_AUTO_UPDATE=!0,Ss.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const Ro=new Er,Cl=new Er,c_=new Er,Ll=new Er,Qu=new Er,Wu=new Er,uv=new Er,u_=new Er,Yo=new Er,pm=new Er;let hm=!1;class fo{constructor(_e=new Er,at=new Er,pt=new Er){this.a=_e,this.b=at,this.c=pt}static getNormal(_e,at,pt,mt){mt.subVectors(pt,at),Ro.subVectors(_e,at),mt.cross(Ro);const vt=mt.lengthSq();return vt>0?mt.multiplyScalar(1/Math.sqrt(vt)):mt.set(0,0,0)}static getBarycoord(_e,at,pt,mt,vt){Ro.subVectors(mt,at),Cl.subVectors(pt,at),c_.subVectors(_e,at);const Ct=Ro.dot(Ro),Tt=Ro.dot(Cl),Bt=Ro.dot(c_),Lt=Cl.dot(Cl),Ut=Cl.dot(c_),Qt=Ct*Lt-Tt*Tt;if(Qt===0)return vt.set(-2,-1,-1);const Ht=1/Qt,Wt=(Lt*Bt-Tt*Ut)*Ht,qt=(Ct*Ut-Tt*Bt)*Ht;return vt.set(1-Wt-qt,qt,Wt)}static containsPoint(_e,at,pt,mt){return this.getBarycoord(_e,at,pt,mt,Ll),Ll.x>=0&&Ll.y>=0&&Ll.x+Ll.y<=1}static getUV(_e,at,pt,mt,vt,Ct,Tt,Bt){return hm===!1&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),hm=!0),this.getInterpolation(_e,at,pt,mt,vt,Ct,Tt,Bt)}static getInterpolation(_e,at,pt,mt,vt,Ct,Tt,Bt){return this.getBarycoord(_e,at,pt,mt,Ll),Bt.setScalar(0),Bt.addScaledVector(vt,Ll.x),Bt.addScaledVector(Ct,Ll.y),Bt.addScaledVector(Tt,Ll.z),Bt}static isFrontFacing(_e,at,pt,mt){return Ro.subVectors(pt,at),Cl.subVectors(_e,at),Ro.cross(Cl).dot(mt)<0}set(_e,at,pt){return this.a.copy(_e),this.b.copy(at),this.c.copy(pt),this}setFromPointsAndIndices(_e,at,pt,mt){return this.a.copy(_e[at]),this.b.copy(_e[pt]),this.c.copy(_e[mt]),this}setFromAttributeAndIndices(_e,at,pt,mt){return this.a.fromBufferAttribute(_e,at),this.b.fromBufferAttribute(_e,pt),this.c.fromBufferAttribute(_e,mt),this}clone(){return new this.constructor().copy(this)}copy(_e){return this.a.copy(_e.a),this.b.copy(_e.b),this.c.copy(_e.c),this}getArea(){return Ro.subVectors(this.c,this.b),Cl.subVectors(this.a,this.b),.5*Ro.cross(Cl).length()}getMidpoint(_e){return _e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(_e){return fo.getNormal(this.a,this.b,this.c,_e)}getPlane(_e){return _e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(_e,at){return fo.getBarycoord(_e,this.a,this.b,this.c,at)}getUV(_e,at,pt,mt,vt){return hm===!1&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),hm=!0),fo.getInterpolation(_e,this.a,this.b,this.c,at,pt,mt,vt)}getInterpolation(_e,at,pt,mt,vt){return fo.getInterpolation(_e,this.a,this.b,this.c,at,pt,mt,vt)}containsPoint(_e){return fo.containsPoint(_e,this.a,this.b,this.c)}isFrontFacing(_e){return fo.isFrontFacing(this.a,this.b,this.c,_e)}intersectsBox(_e){return _e.intersectsTriangle(this)}closestPointToPoint(_e,at){const pt=this.a,mt=this.b,vt=this.c;let Ct,Tt;Qu.subVectors(mt,pt),Wu.subVectors(vt,pt),u_.subVectors(_e,pt);const Bt=Qu.dot(u_),Lt=Wu.dot(u_);if(Bt<=0&&Lt<=0)return at.copy(pt);Yo.subVectors(_e,mt);const Ut=Qu.dot(Yo),Qt=Wu.dot(Yo);if(Ut>=0&&Qt<=Ut)return at.copy(mt);const Ht=Bt*Qt-Ut*Lt;if(Ht<=0&&Bt>=0&&Ut<=0)return Ct=Bt/(Bt-Ut),at.copy(pt).addScaledVector(Qu,Ct);pm.subVectors(_e,vt);const Wt=Qu.dot(pm),qt=Wu.dot(pm);if(qt>=0&&Wt<=qt)return at.copy(vt);const Jt=Wt*Lt-Bt*qt;if(Jt<=0&&Lt>=0&&qt<=0)return Tt=Lt/(Lt-qt),at.copy(pt).addScaledVector(Wu,Tt);const Xt=Ut*qt-Wt*Qt;if(Xt<=0&&Qt-Ut>=0&&Wt-qt>=0)return uv.subVectors(vt,mt),Tt=(Qt-Ut)/(Qt-Ut+(Wt-qt)),at.copy(mt).addScaledVector(uv,Tt);const sr=1/(Xt+Jt+Ht);return Ct=Jt*sr,Tt=Ht*sr,at.copy(pt).addScaledVector(Qu,Ct).addScaledVector(Wu,Tt)}equals(_e){return _e.a.equals(this.a)&&_e.b.equals(this.b)&&_e.c.equals(this.c)}}let B0=0;class so extends mo{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:B0++}),this.uuid=xo(),this.name="",this.type="Material",this.blending=Pt,this.side=ft,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=pr,this.blendDst=hr,this.blendEquation=It,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=Ir,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=hp,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Yp,this.stencilZFail=Yp,this.stencilZPass=Yp,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(_e){this._alphaTest>0!=_e>0&&this.version++,this._alphaTest=_e}onBuild(){}onBeforeRender(){}onAfterRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(_e){if(_e!==void 0)for(const at in _e){const pt=_e[at];if(pt===void 0){console.warn(`THREE.Material: parameter '${at}' has value of undefined.`);continue}const mt=this[at];mt!==void 0&&(mt&&mt.isColor?mt.set(pt):mt&&mt.isVector3&&pt&&pt.isVector3?mt.copy(pt):Array.isArray(pt)&&mt&&typeof mt.fromArray=="function"?mt.fromArray(pt):this[at]=pt)}}toJSON(_e){const at=_e===void 0||typeof _e=="string";at&&(_e={textures:{},images:{}});const pt={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};function mt(vt){const Ct=[];for(const Tt in vt){const Bt=vt[Tt];delete Bt.metadata,Ct.push(Bt)}return Ct}if(pt.uuid=this.uuid,pt.type=this.type,this.name!==""&&(pt.name=this.name),this.color&&this.color.isColor&&(pt.color=this.color.getHex()),this.roughness!==void 0&&(pt.roughness=this.roughness),this.metalness!==void 0&&(pt.metalness=this.metalness),this.sheen!==void 0&&(pt.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(pt.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(pt.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(pt.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(pt.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(pt.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(pt.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(pt.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(pt.shininess=this.shininess),this.clearcoat!==void 0&&(pt.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(pt.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(pt.clearcoatMap=this.clearcoatMap.toJSON(_e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(pt.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(_e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(pt.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(_e).uuid,pt.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.iridescence!==void 0&&(pt.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(pt.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(pt.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(pt.iridescenceMap=this.iridescenceMap.toJSON(_e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(pt.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(_e).uuid),this.anisotropy!==void 0&&(pt.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(pt.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(pt.anisotropyMap=this.anisotropyMap.toJSON(_e).uuid),this.map&&this.map.isTexture&&(pt.map=this.map.toJSON(_e).uuid),this.matcap&&this.matcap.isTexture&&(pt.matcap=this.matcap.toJSON(_e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(pt.alphaMap=this.alphaMap.toJSON(_e).uuid),this.lightMap&&this.lightMap.isTexture&&(pt.lightMap=this.lightMap.toJSON(_e).uuid,pt.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(pt.aoMap=this.aoMap.toJSON(_e).uuid,pt.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(pt.bumpMap=this.bumpMap.toJSON(_e).uuid,pt.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(pt.normalMap=this.normalMap.toJSON(_e).uuid,pt.normalMapType=this.normalMapType,pt.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(pt.displacementMap=this.displacementMap.toJSON(_e).uuid,pt.displacementScale=this.displacementScale,pt.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(pt.roughnessMap=this.roughnessMap.toJSON(_e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(pt.metalnessMap=this.metalnessMap.toJSON(_e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(pt.emissiveMap=this.emissiveMap.toJSON(_e).uuid),this.specularMap&&this.specularMap.isTexture&&(pt.specularMap=this.specularMap.toJSON(_e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(pt.specularIntensityMap=this.specularIntensityMap.toJSON(_e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(pt.specularColorMap=this.specularColorMap.toJSON(_e).uuid),this.envMap&&this.envMap.isTexture&&(pt.envMap=this.envMap.toJSON(_e).uuid,this.combine!==void 0&&(pt.combine=this.combine)),this.envMapIntensity!==void 0&&(pt.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(pt.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(pt.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(pt.gradientMap=this.gradientMap.toJSON(_e).uuid),this.transmission!==void 0&&(pt.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(pt.transmissionMap=this.transmissionMap.toJSON(_e).uuid),this.thickness!==void 0&&(pt.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(pt.thicknessMap=this.thicknessMap.toJSON(_e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(pt.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(pt.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(pt.size=this.size),this.shadowSide!==null&&(pt.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(pt.sizeAttenuation=this.sizeAttenuation),this.blending!==Pt&&(pt.blending=this.blending),this.side!==ft&&(pt.side=this.side),this.vertexColors===!0&&(pt.vertexColors=!0),this.opacity<1&&(pt.opacity=this.opacity),this.transparent===!0&&(pt.transparent=!0),pt.depthFunc=this.depthFunc,pt.depthTest=this.depthTest,pt.depthWrite=this.depthWrite,pt.colorWrite=this.colorWrite,pt.stencilWrite=this.stencilWrite,pt.stencilWriteMask=this.stencilWriteMask,pt.stencilFunc=this.stencilFunc,pt.stencilRef=this.stencilRef,pt.stencilFuncMask=this.stencilFuncMask,pt.stencilFail=this.stencilFail,pt.stencilZFail=this.stencilZFail,pt.stencilZPass=this.stencilZPass,this.rotation!==void 0&&this.rotation!==0&&(pt.rotation=this.rotation),this.polygonOffset===!0&&(pt.polygonOffset=!0),this.polygonOffsetFactor!==0&&(pt.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(pt.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(pt.linewidth=this.linewidth),this.dashSize!==void 0&&(pt.dashSize=this.dashSize),this.gapSize!==void 0&&(pt.gapSize=this.gapSize),this.scale!==void 0&&(pt.scale=this.scale),this.dithering===!0&&(pt.dithering=!0),this.alphaTest>0&&(pt.alphaTest=this.alphaTest),this.alphaHash===!0&&(pt.alphaHash=!0),this.alphaToCoverage===!0&&(pt.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(pt.premultipliedAlpha=!0),this.forceSinglePass===!0&&(pt.forceSinglePass=!0),this.wireframe===!0&&(pt.wireframe=!0),this.wireframeLinewidth>1&&(pt.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(pt.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(pt.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(pt.flatShading=!0),this.visible===!1&&(pt.visible=!1),this.toneMapped===!1&&(pt.toneMapped=!1),this.fog===!1&&(pt.fog=!1),Object.keys(this.userData).length>0&&(pt.userData=this.userData),at){const vt=mt(_e.textures),Ct=mt(_e.images);vt.length>0&&(pt.textures=vt),Ct.length>0&&(pt.images=Ct)}return pt}clone(){return new this.constructor().copy(this)}copy(_e){this.name=_e.name,this.blending=_e.blending,this.side=_e.side,this.vertexColors=_e.vertexColors,this.opacity=_e.opacity,this.transparent=_e.transparent,this.blendSrc=_e.blendSrc,this.blendDst=_e.blendDst,this.blendEquation=_e.blendEquation,this.blendSrcAlpha=_e.blendSrcAlpha,this.blendDstAlpha=_e.blendDstAlpha,this.blendEquationAlpha=_e.blendEquationAlpha,this.depthFunc=_e.depthFunc,this.depthTest=_e.depthTest,this.depthWrite=_e.depthWrite,this.stencilWriteMask=_e.stencilWriteMask,this.stencilFunc=_e.stencilFunc,this.stencilRef=_e.stencilRef,this.stencilFuncMask=_e.stencilFuncMask,this.stencilFail=_e.stencilFail,this.stencilZFail=_e.stencilZFail,this.stencilZPass=_e.stencilZPass,this.stencilWrite=_e.stencilWrite;const at=_e.clippingPlanes;let pt=null;if(at!==null){const mt=at.length;pt=new Array(mt);for(let vt=0;vt!==mt;++vt)pt[vt]=at[vt].clone()}return this.clippingPlanes=pt,this.clipIntersection=_e.clipIntersection,this.clipShadows=_e.clipShadows,this.shadowSide=_e.shadowSide,this.colorWrite=_e.colorWrite,this.precision=_e.precision,this.polygonOffset=_e.polygonOffset,this.polygonOffsetFactor=_e.polygonOffsetFactor,this.polygonOffsetUnits=_e.polygonOffsetUnits,this.dithering=_e.dithering,this.alphaTest=_e.alphaTest,this.alphaHash=_e.alphaHash,this.alphaToCoverage=_e.alphaToCoverage,this.premultipliedAlpha=_e.premultipliedAlpha,this.forceSinglePass=_e.forceSinglePass,this.visible=_e.visible,this.toneMapped=_e.toneMapped,this.userData=p_({},_e.userData),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(_e){_e===!0&&this.version++}}function p_(Et,_e){if(!_e)return Et;for(const at of Object.keys(_e)){if(at.startsWith("__")||typeof Et[at]=="function"||typeof _e[at]=="function")continue;const pt=_e[at],mt=!pt||pt.isTexture||pt.isObject3D||pt.isMaterial;mt||typeof _e[at].clone!="function"?mt||typeof _e[at]!="object"&&!Array.isArray(_e[at])?Et[at]=_e[at]:Et[at]=p_(Array.isArray(_e[at])?[]:{},_e[at]):Et[at]=_e[at].clone()}return Et}const h_={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Ol={h:0,s:0,l:0},dm={h:0,s:0,l:0};function d_(Et,_e,at){return at<0&&(at+=1),at>1&&(at-=1),at<1/6?Et+6*(_e-Et)*at:at<.5?_e:at<2/3?Et+6*(_e-Et)*(2/3-at):Et}class Un{constructor(_e,at,pt){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(_e,at,pt)}set(_e,at,pt){if(at===void 0&&pt===void 0){const mt=_e;mt&&mt.isColor?this.copy(mt):typeof mt=="number"?this.setHex(mt):typeof mt=="string"&&this.setStyle(mt)}else this.setRGB(_e,at,pt);return this}setScalar(_e){return this.r=_e,this.g=_e,this.b=_e,this}setHex(_e,at=Os){return _e=Math.floor(_e),this.r=(_e>>16&255)/255,this.g=(_e>>8&255)/255,this.b=(255&_e)/255,Ms.toWorkingColorSpace(this,at),this}setRGB(_e,at,pt,mt=Ms.workingColorSpace){return this.r=_e,this.g=at,this.b=pt,Ms.toWorkingColorSpace(this,mt),this}setHSL(_e,at,pt,mt=Ms.workingColorSpace){if(_e=_d(_e,1),at=Hs(at,0,1),pt=Hs(pt,0,1),at===0)this.r=this.g=this.b=pt;else{const vt=pt<=.5?pt*(1+at):pt+at-pt*at,Ct=2*pt-vt;this.r=d_(Ct,vt,_e+1/3),this.g=d_(Ct,vt,_e),this.b=d_(Ct,vt,_e-1/3)}return Ms.toWorkingColorSpace(this,mt),this}setStyle(_e,at=Os){function pt(vt){vt!==void 0&&parseFloat(vt)<1&&console.warn("THREE.Color: Alpha component of "+_e+" will be ignored.")}let mt;if(mt=/^(\w+)\(([^\)]*)\)/.exec(_e)){let vt;const Ct=mt[1],Tt=mt[2];switch(Ct){case"rgb":case"rgba":if(vt=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(Tt))return pt(vt[4]),this.setRGB(Math.min(255,parseInt(vt[1],10))/255,Math.min(255,parseInt(vt[2],10))/255,Math.min(255,parseInt(vt[3],10))/255,at);if(vt=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(Tt))return pt(vt[4]),this.setRGB(Math.min(100,parseInt(vt[1],10))/100,Math.min(100,parseInt(vt[2],10))/100,Math.min(100,parseInt(vt[3],10))/100,at);break;case"hsl":case"hsla":if(vt=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(Tt))return pt(vt[4]),this.setHSL(parseFloat(vt[1])/360,parseFloat(vt[2])/100,parseFloat(vt[3])/100,at);break;default:console.warn("THREE.Color: Unknown color model "+_e)}}else if(mt=/^\#([A-Fa-f\d]+)$/.exec(_e)){const vt=mt[1],Ct=vt.length;if(Ct===3)return this.setRGB(parseInt(vt.charAt(0),16)/15,parseInt(vt.charAt(1),16)/15,parseInt(vt.charAt(2),16)/15,at);if(Ct===6)return this.setHex(parseInt(vt,16),at);console.warn("THREE.Color: Invalid hex color "+_e)}else if(_e&&_e.length>0)return this.setColorName(_e,at);return this}setColorName(_e,at=Os){const pt=h_[_e.toLowerCase()];return pt!==void 0?this.setHex(pt,at):console.warn("THREE.Color: Unknown color "+_e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(_e){return this.r=_e.r,this.g=_e.g,this.b=_e.b,this}copySRGBToLinear(_e){return this.r=Bu(_e.r),this.g=Bu(_e.g),this.b=Bu(_e.b),this}copyLinearToSRGB(_e){return this.r=rm(_e.r),this.g=rm(_e.g),this.b=rm(_e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(_e=Os){return Ms.fromWorkingColorSpace(ao.copy(this),_e),65536*Math.round(Hs(255*ao.r,0,255))+256*Math.round(Hs(255*ao.g,0,255))+Math.round(Hs(255*ao.b,0,255))}getHexString(_e=Os){return("000000"+this.getHex(_e).toString(16)).slice(-6)}getHSL(_e,at=Ms.workingColorSpace){Ms.fromWorkingColorSpace(ao.copy(this),at);const pt=ao.r,mt=ao.g,vt=ao.b,Ct=Math.max(pt,mt,vt),Tt=Math.min(pt,mt,vt);let Bt,Lt;const Ut=(Tt+Ct)/2;if(Tt===Ct)Bt=0,Lt=0;else{const Qt=Ct-Tt;switch(Lt=Ut<=.5?Qt/(Ct+Tt):Qt/(2-Ct-Tt),Ct){case pt:Bt=(mt-vt)/Qt+(mt<vt?6:0);break;case mt:Bt=(vt-pt)/Qt+2;break;case vt:Bt=(pt-mt)/Qt+4}Bt/=6}return _e.h=Bt,_e.s=Lt,_e.l=Ut,_e}getRGB(_e,at=Ms.workingColorSpace){return Ms.fromWorkingColorSpace(ao.copy(this),at),_e.r=ao.r,_e.g=ao.g,_e.b=ao.b,_e}getStyle(_e=Os){Ms.fromWorkingColorSpace(ao.copy(this),_e);const at=ao.r,pt=ao.g,mt=ao.b;return _e!==Os?`color(${_e} ${at.toFixed(3)} ${pt.toFixed(3)} ${mt.toFixed(3)})`:`rgb(${Math.round(255*at)},${Math.round(255*pt)},${Math.round(255*mt)})`}offsetHSL(_e,at,pt){return this.getHSL(Ol),this.setHSL(Ol.h+_e,Ol.s+at,Ol.l+pt)}add(_e){return this.r+=_e.r,this.g+=_e.g,this.b+=_e.b,this}addColors(_e,at){return this.r=_e.r+at.r,this.g=_e.g+at.g,this.b=_e.b+at.b,this}addScalar(_e){return this.r+=_e,this.g+=_e,this.b+=_e,this}sub(_e){return this.r=Math.max(0,this.r-_e.r),this.g=Math.max(0,this.g-_e.g),this.b=Math.max(0,this.b-_e.b),this}multiply(_e){return this.r*=_e.r,this.g*=_e.g,this.b*=_e.b,this}multiplyScalar(_e){return this.r*=_e,this.g*=_e,this.b*=_e,this}lerp(_e,at){return this.r+=(_e.r-this.r)*at,this.g+=(_e.g-this.g)*at,this.b+=(_e.b-this.b)*at,this}lerpColors(_e,at,pt){return this.r=_e.r+(at.r-_e.r)*pt,this.g=_e.g+(at.g-_e.g)*pt,this.b=_e.b+(at.b-_e.b)*pt,this}lerpHSL(_e,at){this.getHSL(Ol),_e.getHSL(dm);const pt=Du(Ol.h,dm.h,at),mt=Du(Ol.s,dm.s,at),vt=Du(Ol.l,dm.l,at);return this.setHSL(pt,mt,vt),this}setFromVector3(_e){return this.r=_e.x,this.g=_e.y,this.b=_e.z,this}applyMatrix3(_e){const at=this.r,pt=this.g,mt=this.b,vt=_e.elements;return this.r=vt[0]*at+vt[3]*pt+vt[6]*mt,this.g=vt[1]*at+vt[4]*pt+vt[7]*mt,this.b=vt[2]*at+vt[5]*pt+vt[8]*mt,this}equals(_e){return _e.r===this.r&&_e.g===this.g&&_e.b===this.b}fromArray(_e,at=0){return this.r=_e[at],this.g=_e[at+1],this.b=_e[at+2],this}toArray(_e=[],at=0){return _e[at]=this.r,_e[at+1]=this.g,_e[at+2]=this.b,_e}fromBufferAttribute(_e,at){return this.r=_e.getX(at),this.g=_e.getY(at),this.b=_e.getZ(at),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const ao=new Un;Un.NAMES=h_;class Zl extends so{constructor(_e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new Un(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=vn,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(_e)}copy(_e){return super.copy(_e),this.color.copy(_e.color),this.map=_e.map,this.lightMap=_e.lightMap,this.lightMapIntensity=_e.lightMapIntensity,this.aoMap=_e.aoMap,this.aoMapIntensity=_e.aoMapIntensity,this.specularMap=_e.specularMap,this.alphaMap=_e.alphaMap,this.envMap=_e.envMap,this.combine=_e.combine,this.reflectivity=_e.reflectivity,this.refractionRatio=_e.refractionRatio,this.wireframe=_e.wireframe,this.wireframeLinewidth=_e.wireframeLinewidth,this.wireframeLinecap=_e.wireframeLinecap,this.wireframeLinejoin=_e.wireframeLinejoin,this.fog=_e.fog,this}}const Pl=L0();function L0(){const Et=new ArrayBuffer(4),_e=new Float32Array(Et),at=new Uint32Array(Et),pt=new Uint32Array(512),mt=new Uint32Array(512);for(let Bt=0;Bt<256;++Bt){const Lt=Bt-127;Lt<-27?(pt[Bt]=0,pt[256|Bt]=32768,mt[Bt]=24,mt[256|Bt]=24):Lt<-14?(pt[Bt]=1024>>-Lt-14,pt[256|Bt]=1024>>-Lt-14|32768,mt[Bt]=-Lt-1,mt[256|Bt]=-Lt-1):Lt<=15?(pt[Bt]=Lt+15<<10,pt[256|Bt]=Lt+15<<10|32768,mt[Bt]=13,mt[256|Bt]=13):Lt<128?(pt[Bt]=31744,pt[256|Bt]=64512,mt[Bt]=24,mt[256|Bt]=24):(pt[Bt]=31744,pt[256|Bt]=64512,mt[Bt]=13,mt[256|Bt]=13)}const vt=new Uint32Array(2048),Ct=new Uint32Array(64),Tt=new Uint32Array(64);for(let Bt=1;Bt<1024;++Bt){let Lt=Bt<<13,Ut=0;for(;!(8388608&Lt);)Lt<<=1,Ut-=8388608;Lt&=-8388609,Ut+=947912704,vt[Bt]=Lt|Ut}for(let Bt=1024;Bt<2048;++Bt)vt[Bt]=939524096+(Bt-1024<<13);for(let Bt=1;Bt<31;++Bt)Ct[Bt]=Bt<<23;Ct[31]=1199570944,Ct[32]=2147483648;for(let Bt=33;Bt<63;++Bt)Ct[Bt]=2147483648+(Bt-32<<23);Ct[63]=3347054592;for(let Bt=1;Bt<64;++Bt)Bt!==32&&(Tt[Bt]=1024);return{floatView:_e,uint32View:at,baseTable:pt,shiftTable:mt,mantissaTable:vt,exponentTable:Ct,offsetTable:Tt}}function jt(Et){Math.abs(Et)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),Et=Hs(Et,-65504,65504),Pl.floatView[0]=Et;const _e=Pl.uint32View[0],at=_e>>23&511;return Pl.baseTable[at]+((8388607&_e)>>Pl.shiftTable[at])}function At(Et){const _e=Et>>10;return Pl.uint32View[0]=Pl.mantissaTable[Pl.offsetTable[_e]+(1023&Et)]+Pl.exponentTable[_e],Pl.floatView[0]}const Mt={toHalfFloat:jt,fromHalfFloat:At},zt=new Er,ir=new dn;class mr{constructor(_e,at,pt=!1){if(Array.isArray(_e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=_e,this.itemSize=at,this.count=_e!==void 0?_e.length/at:0,this.normalized=pt,this.usage=ku,this.updateRange={offset:0,count:-1},this.gpuType=to,this.version=0}onUploadCallback(){}set needsUpdate(_e){_e===!0&&this.version++}setUsage(_e){return this.usage=_e,this}copy(_e){return this.name=_e.name,this.array=new _e.array.constructor(_e.array),this.itemSize=_e.itemSize,this.count=_e.count,this.normalized=_e.normalized,this.usage=_e.usage,this.gpuType=_e.gpuType,this}copyAt(_e,at,pt){_e*=this.itemSize,pt*=at.itemSize;for(let mt=0,vt=this.itemSize;mt<vt;mt++)this.array[_e+mt]=at.array[pt+mt];return this}copyArray(_e){return this.array.set(_e),this}applyMatrix3(_e){if(this.itemSize===2)for(let at=0,pt=this.count;at<pt;at++)ir.fromBufferAttribute(this,at),ir.applyMatrix3(_e),this.setXY(at,ir.x,ir.y);else if(this.itemSize===3)for(let at=0,pt=this.count;at<pt;at++)zt.fromBufferAttribute(this,at),zt.applyMatrix3(_e),this.setXYZ(at,zt.x,zt.y,zt.z);return this}applyMatrix4(_e){for(let at=0,pt=this.count;at<pt;at++)zt.fromBufferAttribute(this,at),zt.applyMatrix4(_e),this.setXYZ(at,zt.x,zt.y,zt.z);return this}applyNormalMatrix(_e){for(let at=0,pt=this.count;at<pt;at++)zt.fromBufferAttribute(this,at),zt.applyNormalMatrix(_e),this.setXYZ(at,zt.x,zt.y,zt.z);return this}transformDirection(_e){for(let at=0,pt=this.count;at<pt;at++)zt.fromBufferAttribute(this,at),zt.transformDirection(_e),this.setXYZ(at,zt.x,zt.y,zt.z);return this}set(_e,at=0){return this.array.set(_e,at),this}getComponent(_e,at){let pt=this.array[_e*this.itemSize+at];return this.normalized&&(pt=go(pt,this.array)),pt}setComponent(_e,at,pt){return this.normalized&&(pt=ns(pt,this.array)),this.array[_e*this.itemSize+at]=pt,this}getX(_e){let at=this.array[_e*this.itemSize];return this.normalized&&(at=go(at,this.array)),at}setX(_e,at){return this.normalized&&(at=ns(at,this.array)),this.array[_e*this.itemSize]=at,this}getY(_e){let at=this.array[_e*this.itemSize+1];return this.normalized&&(at=go(at,this.array)),at}setY(_e,at){return this.normalized&&(at=ns(at,this.array)),this.array[_e*this.itemSize+1]=at,this}getZ(_e){let at=this.array[_e*this.itemSize+2];return this.normalized&&(at=go(at,this.array)),at}setZ(_e,at){return this.normalized&&(at=ns(at,this.array)),this.array[_e*this.itemSize+2]=at,this}getW(_e){let at=this.array[_e*this.itemSize+3];return this.normalized&&(at=go(at,this.array)),at}setW(_e,at){return this.normalized&&(at=ns(at,this.array)),this.array[_e*this.itemSize+3]=at,this}setXY(_e,at,pt){return _e*=this.itemSize,this.normalized&&(at=ns(at,this.array),pt=ns(pt,this.array)),this.array[_e+0]=at,this.array[_e+1]=pt,this}setXYZ(_e,at,pt,mt){return _e*=this.itemSize,this.normalized&&(at=ns(at,this.array),pt=ns(pt,this.array),mt=ns(mt,this.array)),this.array[_e+0]=at,this.array[_e+1]=pt,this.array[_e+2]=mt,this}setXYZW(_e,at,pt,mt,vt){return _e*=this.itemSize,this.normalized&&(at=ns(at,this.array),pt=ns(pt,this.array),mt=ns(mt,this.array),vt=ns(vt,this.array)),this.array[_e+0]=at,this.array[_e+1]=pt,this.array[_e+2]=mt,this.array[_e+3]=vt,this}onUpload(_e){return this.onUploadCallback=_e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const _e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(_e.name=this.name),this.usage!==ku&&(_e.usage=this.usage),this.updateRange.offset===0&&this.updateRange.count===-1||(_e.updateRange=this.updateRange),_e}}class Sr extends mr{constructor(_e,at,pt){super(new Int8Array(_e),at,pt)}}class Wr extends mr{constructor(_e,at,pt){super(new Uint8Array(_e),at,pt)}}class _n extends mr{constructor(_e,at,pt){super(new Uint8ClampedArray(_e),at,pt)}}class zn extends mr{constructor(_e,at,pt){super(new Int16Array(_e),at,pt)}}class os extends mr{constructor(_e,at,pt){super(new Uint16Array(_e),at,pt)}}class Zs extends mr{constructor(_e,at,pt){super(new Int32Array(_e),at,pt)}}class vo extends mr{constructor(_e,at,pt){super(new Uint32Array(_e),at,pt)}}class Eo extends mr{constructor(_e,at,pt){super(new Uint16Array(_e),at,pt),this.isFloat16BufferAttribute=!0}getX(_e){let at=At(this.array[_e*this.itemSize]);return this.normalized&&(at=go(at,this.array)),at}setX(_e,at){return this.normalized&&(at=ns(at,this.array)),this.array[_e*this.itemSize]=jt(at),this}getY(_e){let at=At(this.array[_e*this.itemSize+1]);return this.normalized&&(at=go(at,this.array)),at}setY(_e,at){return this.normalized&&(at=ns(at,this.array)),this.array[_e*this.itemSize+1]=jt(at),this}getZ(_e){let at=At(this.array[_e*this.itemSize+2]);return this.normalized&&(at=go(at,this.array)),at}setZ(_e,at){return this.normalized&&(at=ns(at,this.array)),this.array[_e*this.itemSize+2]=jt(at),this}getW(_e){let at=At(this.array[_e*this.itemSize+3]);return this.normalized&&(at=go(at,this.array)),at}setW(_e,at){return this.normalized&&(at=ns(at,this.array)),this.array[_e*this.itemSize+3]=jt(at),this}setXY(_e,at,pt){return _e*=this.itemSize,this.normalized&&(at=ns(at,this.array),pt=ns(pt,this.array)),this.array[_e+0]=jt(at),this.array[_e+1]=jt(pt),this}setXYZ(_e,at,pt,mt){return _e*=this.itemSize,this.normalized&&(at=ns(at,this.array),pt=ns(pt,this.array),mt=ns(mt,this.array)),this.array[_e+0]=jt(at),this.array[_e+1]=jt(pt),this.array[_e+2]=jt(mt),this}setXYZW(_e,at,pt,mt,vt){return _e*=this.itemSize,this.normalized&&(at=ns(at,this.array),pt=ns(pt,this.array),mt=ns(mt,this.array),vt=ns(vt,this.array)),this.array[_e+0]=jt(at),this.array[_e+1]=jt(pt),this.array[_e+2]=jt(mt),this.array[_e+3]=jt(vt),this}}class Ln extends mr{constructor(_e,at,pt){super(new Float32Array(_e),at,pt)}}class m_ extends mr{constructor(_e,at,pt){super(new Float64Array(_e),at,pt)}}let mm=0;const So=new rs,qu=new Ss,Nl=new Er,ko=new xl,bp=new xl,oo=new Er;class _s extends mo{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:mm++}),this.uuid=xo(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(_e){return Array.isArray(_e)?this.index=new(ev(_e)?vo:os)(_e,1):this.index=_e,this}getAttribute(_e){return this.attributes[_e]}setAttribute(_e,at){return this.attributes[_e]=at,this}deleteAttribute(_e){return delete this.attributes[_e],this}hasAttribute(_e){return this.attributes[_e]!==void 0}addGroup(_e,at,pt=0){this.groups.push({start:_e,count:at,materialIndex:pt})}clearGroups(){this.groups=[]}setDrawRange(_e,at){this.drawRange.start=_e,this.drawRange.count=at}applyMatrix4(_e){const at=this.attributes.position;at!==void 0&&(at.applyMatrix4(_e),at.needsUpdate=!0);const pt=this.attributes.normal;if(pt!==void 0){const vt=new as().getNormalMatrix(_e);pt.applyNormalMatrix(vt),pt.needsUpdate=!0}const mt=this.attributes.tangent;return mt!==void 0&&(mt.transformDirection(_e),mt.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(_e){return So.makeRotationFromQuaternion(_e),this.applyMatrix4(So),this}rotateX(_e){return So.makeRotationX(_e),this.applyMatrix4(So),this}rotateY(_e){return So.makeRotationY(_e),this.applyMatrix4(So),this}rotateZ(_e){return So.makeRotationZ(_e),this.applyMatrix4(So),this}translate(_e,at,pt){return So.makeTranslation(_e,at,pt),this.applyMatrix4(So),this}scale(_e,at,pt){return So.makeScale(_e,at,pt),this.applyMatrix4(So),this}lookAt(_e){return qu.lookAt(_e),qu.updateMatrix(),this.applyMatrix4(qu.matrix),this}center(_e=void 0){return this.computeBoundingBox(),this.boundingBox.getCenter(Nl).negate(),this.translate(Nl.x,Nl.y,Nl.z),_e&&_e.copy(Nl),this}setFromPoints(_e){const at=[];for(let pt=0,mt=_e.length;pt<mt;pt++){const vt=_e[pt];at.push(vt.x,vt.y,vt.z||0)}return this.setAttribute("position",new Ln(at,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new xl);const _e=this.attributes.position,at=this.morphAttributes.position;if(_e&&_e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new Er(-1/0,-1/0,-1/0),new Er(1/0,1/0,1/0));if(_e!==void 0){if(this.boundingBox.setFromBufferAttribute(_e),at)for(let pt=0,mt=at.length;pt<mt;pt++){const vt=at[pt];ko.setFromBufferAttribute(vt),this.morphTargetsRelative?(oo.addVectors(this.boundingBox.min,ko.min),this.boundingBox.expandByPoint(oo),oo.addVectors(this.boundingBox.max,ko.max),this.boundingBox.expandByPoint(oo)):(this.boundingBox.expandByPoint(ko.min),this.boundingBox.expandByPoint(ko.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new jo);const _e=this.attributes.position,at=this.morphAttributes.position;if(_e&&_e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new Er,1/0);if(_e){const pt=this.boundingSphere.center;if(ko.setFromBufferAttribute(_e),at)for(let vt=0,Ct=at.length;vt<Ct;vt++){const Tt=at[vt];bp.setFromBufferAttribute(Tt),this.morphTargetsRelative?(oo.addVectors(ko.min,bp.min),ko.expandByPoint(oo),oo.addVectors(ko.max,bp.max),ko.expandByPoint(oo)):(ko.expandByPoint(bp.min),ko.expandByPoint(bp.max))}ko.getCenter(pt);let mt=0;for(let vt=0,Ct=_e.count;vt<Ct;vt++)oo.fromBufferAttribute(_e,vt),mt=Math.max(mt,pt.distanceToSquared(oo));if(at)for(let vt=0,Ct=at.length;vt<Ct;vt++){const Tt=at[vt],Bt=this.morphTargetsRelative;for(let Lt=0,Ut=Tt.count;Lt<Ut;Lt++)oo.fromBufferAttribute(Tt,Lt),Bt&&(Nl.fromBufferAttribute(_e,Lt),oo.add(Nl)),mt=Math.max(mt,pt.distanceToSquared(oo))}this.boundingSphere.radius=Math.sqrt(mt),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const _e=this.index,at=this.attributes;if(_e===null||at.position===void 0||at.normal===void 0||at.uv===void 0)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const pt=_e.array,mt=at.position.array,vt=at.normal.array,Ct=at.uv.array,Tt=mt.length/3;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new mr(new Float32Array(4*Tt),4));const Bt=this.getAttribute("tangent").array,Lt=[],Ut=[];for(let zr=0;zr<Tt;zr++)Lt[zr]=new Er,Ut[zr]=new Er;const Qt=new Er,Ht=new Er,Wt=new Er,qt=new dn,Jt=new dn,Xt=new dn,sr=new Er,Zt=new Er;function er(zr,Gr,Vr){Qt.fromArray(mt,3*zr),Ht.fromArray(mt,3*Gr),Wt.fromArray(mt,3*Vr),qt.fromArray(Ct,2*zr),Jt.fromArray(Ct,2*Gr),Xt.fromArray(Ct,2*Vr),Ht.sub(Qt),Wt.sub(Qt),Jt.sub(qt),Xt.sub(qt);const gn=1/(Jt.x*Xt.y-Xt.x*Jt.y);isFinite(gn)&&(sr.copy(Ht).multiplyScalar(Xt.y).addScaledVector(Wt,-Jt.y).multiplyScalar(gn),Zt.copy(Wt).multiplyScalar(Jt.x).addScaledVector(Ht,-Xt.x).multiplyScalar(gn),Lt[zr].add(sr),Lt[Gr].add(sr),Lt[Vr].add(sr),Ut[zr].add(Zt),Ut[Gr].add(Zt),Ut[Vr].add(Zt))}let xr=this.groups;xr.length===0&&(xr=[{start:0,count:pt.length}]);for(let zr=0,Gr=xr.length;zr<Gr;++zr){const Vr=xr[zr],gn=Vr.start;for(let pn=gn,Mn=gn+Vr.count;pn<Mn;pn+=3)er(pt[pn+0],pt[pn+1],pt[pn+2])}const Ar=new Er,yr=new Er,Tr=new Er,Hr=new Er;function Nr(zr){Tr.fromArray(vt,3*zr),Hr.copy(Tr);const Gr=Lt[zr];Ar.copy(Gr),Ar.sub(Tr.multiplyScalar(Tr.dot(Gr))).normalize(),yr.crossVectors(Hr,Gr);const Vr=yr.dot(Ut[zr])<0?-1:1;Bt[4*zr]=Ar.x,Bt[4*zr+1]=Ar.y,Bt[4*zr+2]=Ar.z,Bt[4*zr+3]=Vr}for(let zr=0,Gr=xr.length;zr<Gr;++zr){const Vr=xr[zr],gn=Vr.start;for(let pn=gn,Mn=gn+Vr.count;pn<Mn;pn+=3)Nr(pt[pn+0]),Nr(pt[pn+1]),Nr(pt[pn+2])}}computeVertexNormals(){const _e=this.index,at=this.getAttribute("position");if(at!==void 0){let pt=this.getAttribute("normal");if(pt===void 0)pt=new mr(new Float32Array(3*at.count),3),this.setAttribute("normal",pt);else for(let Ht=0,Wt=pt.count;Ht<Wt;Ht++)pt.setXYZ(Ht,0,0,0);const mt=new Er,vt=new Er,Ct=new Er,Tt=new Er,Bt=new Er,Lt=new Er,Ut=new Er,Qt=new Er;if(_e)for(let Ht=0,Wt=_e.count;Ht<Wt;Ht+=3){const qt=_e.getX(Ht+0),Jt=_e.getX(Ht+1),Xt=_e.getX(Ht+2);mt.fromBufferAttribute(at,qt),vt.fromBufferAttribute(at,Jt),Ct.fromBufferAttribute(at,Xt),Ut.subVectors(Ct,vt),Qt.subVectors(mt,vt),Ut.cross(Qt),Tt.fromBufferAttribute(pt,qt),Bt.fromBufferAttribute(pt,Jt),Lt.fromBufferAttribute(pt,Xt),Tt.add(Ut),Bt.add(Ut),Lt.add(Ut),pt.setXYZ(qt,Tt.x,Tt.y,Tt.z),pt.setXYZ(Jt,Bt.x,Bt.y,Bt.z),pt.setXYZ(Xt,Lt.x,Lt.y,Lt.z)}else for(let Ht=0,Wt=at.count;Ht<Wt;Ht+=3)mt.fromBufferAttribute(at,Ht+0),vt.fromBufferAttribute(at,Ht+1),Ct.fromBufferAttribute(at,Ht+2),Ut.subVectors(Ct,vt),Qt.subVectors(mt,vt),Ut.cross(Qt),pt.setXYZ(Ht+0,Ut.x,Ut.y,Ut.z),pt.setXYZ(Ht+1,Ut.x,Ut.y,Ut.z),pt.setXYZ(Ht+2,Ut.x,Ut.y,Ut.z);this.normalizeNormals(),pt.needsUpdate=!0}}normalizeNormals(){const _e=this.attributes.normal;for(let at=0,pt=_e.count;at<pt;at++)oo.fromBufferAttribute(_e,at),oo.normalize(),_e.setXYZ(at,oo.x,oo.y,oo.z)}toNonIndexed(){function _e(Tt,Bt){const Lt=Tt.array,Ut=Tt.itemSize,Qt=Tt.normalized,Ht=new Lt.constructor(Bt.length*Ut);let Wt=0,qt=0;for(let Jt=0,Xt=Bt.length;Jt<Xt;Jt++){Wt=Tt.isInterleavedBufferAttribute?Bt[Jt]*Tt.data.stride+Tt.offset:Bt[Jt]*Ut;for(let sr=0;sr<Ut;sr++)Ht[qt++]=Lt[Wt++]}return new mr(Ht,Ut,Qt)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const at=new _s,pt=this.index.array,mt=this.attributes;for(const Tt in mt){const Bt=_e(mt[Tt],pt);at.setAttribute(Tt,Bt)}const vt=this.morphAttributes;for(const Tt in vt){const Bt=[],Lt=vt[Tt];for(let Ut=0,Qt=Lt.length;Ut<Qt;Ut++){const Ht=_e(Lt[Ut],pt);Bt.push(Ht)}at.morphAttributes[Tt]=Bt}at.morphTargetsRelative=this.morphTargetsRelative;const Ct=this.groups;for(let Tt=0,Bt=Ct.length;Tt<Bt;Tt++){const Lt=Ct[Tt];at.addGroup(Lt.start,Lt.count,Lt.materialIndex)}return at}toJSON(){const _e={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(_e.uuid=this.uuid,_e.type=this.type,this.name!==""&&(_e.name=this.name),Object.keys(this.userData).length>0&&(_e.userData=this.userData),this.parameters!==void 0){const Bt=this.parameters;for(const Lt in Bt)Bt[Lt]!==void 0&&(_e[Lt]=Bt[Lt]);return _e}_e.data={attributes:{}};const at=this.index;at!==null&&(_e.data.index={type:at.array.constructor.name,array:Array.prototype.slice.call(at.array)});const pt=this.attributes;for(const Bt in pt){const Lt=pt[Bt];_e.data.attributes[Bt]=Lt.toJSON(_e.data)}const mt={};let vt=!1;for(const Bt in this.morphAttributes){const Lt=this.morphAttributes[Bt],Ut=[];for(let Qt=0,Ht=Lt.length;Qt<Ht;Qt++){const Wt=Lt[Qt];Ut.push(Wt.toJSON(_e.data))}Ut.length>0&&(mt[Bt]=Ut,vt=!0)}vt&&(_e.data.morphAttributes=mt,_e.data.morphTargetsRelative=this.morphTargetsRelative);const Ct=this.groups;Ct.length>0&&(_e.data.groups=JSON.parse(JSON.stringify(Ct)));const Tt=this.boundingSphere;return Tt!==null&&(_e.data.boundingSphere={center:Tt.center.toArray(),radius:Tt.radius}),_e}clone(){return new this.constructor().copy(this)}copy(_e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const at={};this.name=_e.name;const pt=_e.index;pt!==null&&this.setIndex(pt.clone(at));const mt=_e.attributes;for(const Lt in mt){const Ut=mt[Lt];this.setAttribute(Lt,Ut.clone(at))}const vt=_e.morphAttributes;for(const Lt in vt){const Ut=[],Qt=vt[Lt];for(let Ht=0,Wt=Qt.length;Ht<Wt;Ht++)Ut.push(Qt[Ht].clone(at));this.morphAttributes[Lt]=Ut}this.morphTargetsRelative=_e.morphTargetsRelative;const Ct=_e.groups;for(let Lt=0,Ut=Ct.length;Lt<Ut;Lt++){const Qt=Ct[Lt];this.addGroup(Qt.start,Qt.count,Qt.materialIndex)}const Tt=_e.boundingBox;Tt!==null&&(this.boundingBox=Tt.clone());const Bt=_e.boundingSphere;return Bt!==null&&(this.boundingSphere=Bt.clone()),this.drawRange.start=_e.drawRange.start,this.drawRange.count=_e.drawRange.count,this.userData=_e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const Dy=new rs,xp=new ju,pv=new jo,Ly=new Er,gm=new Er,_m=new Er,fm=new Er,O0=new Er,hv=new Er,dv=new dn,mv=new dn,gv=new dn,Oy=new Er,Ny=new Er,Fy=new Er,_v=new Er,fv=new Er;class lo extends Ss{constructor(_e=new _s,at=new Zl){super(),this.isMesh=!0,this.type="Mesh",this.geometry=_e,this.material=at,this.updateMorphTargets()}copy(_e,at){return super.copy(_e,at),_e.isMesh?(_e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=_e.morphTargetInfluences.slice()),_e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},_e.morphTargetDictionary)),this.material=Array.isArray(_e.material)?_e.material.slice():_e.material,this.geometry=_e.geometry,this):this}updateMorphTargets(){const _e=this.geometry.morphAttributes,at=Object.keys(_e);if(at.length>0){const pt=_e[at[0]];if(pt!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let mt=0,vt=pt.length;mt<vt;mt++){const Ct=pt[mt].name||String(mt);this.morphTargetInfluences.push(0),this.morphTargetDictionary[Ct]=mt}}}}getVertexPosition(_e,at){const pt=this.geometry,mt=pt.attributes.position,vt=pt.morphAttributes.position,Ct=pt.morphTargetsRelative;at.fromBufferAttribute(mt,_e);const Tt=this.morphTargetInfluences;if(vt&&Tt){hv.set(0,0,0);for(let Bt=0,Lt=vt.length;Bt<Lt;Bt++){const Ut=Tt[Bt],Qt=vt[Bt];Ut!==0&&(O0.fromBufferAttribute(Qt,_e),Ct?hv.addScaledVector(O0,Ut):hv.addScaledVector(O0.sub(at),Ut))}at.add(hv)}return at}raycast(_e,at){const pt=this.geometry,mt=this.material,vt=this.matrixWorld;if(mt!==void 0){if(pt.boundingSphere===null&&pt.computeBoundingSphere(),pv.copy(pt.boundingSphere),pv.applyMatrix4(vt),xp.copy(_e.ray).recast(_e.near),pv.containsPoint(xp.origin)===!1&&(xp.intersectSphere(pv,Ly)===null||xp.origin.distanceToSquared(Ly)>(_e.far-_e.near)**2))return;Dy.copy(vt).invert(),xp.copy(_e.ray).applyMatrix4(Dy),pt.boundingBox!==null&&xp.intersectsBox(pt.boundingBox)===!1||this._computeIntersections(_e,at,xp)}}_computeIntersections(_e,at,pt){let mt;const vt=this.geometry,Ct=this.material,Tt=vt.index,Bt=vt.attributes.position,Lt=vt.attributes.uv,Ut=vt.attributes.uv1,Qt=vt.attributes.normal,Ht=vt.groups,Wt=vt.drawRange;if(Tt!==null)if(Array.isArray(Ct))for(let qt=0,Jt=Ht.length;qt<Jt;qt++){const Xt=Ht[qt],sr=Ct[Xt.materialIndex];for(let Zt=Math.max(Xt.start,Wt.start),er=Math.min(Tt.count,Math.min(Xt.start+Xt.count,Wt.start+Wt.count));Zt<er;Zt+=3)mt=vv(this,sr,_e,pt,Lt,Ut,Qt,Tt.getX(Zt),Tt.getX(Zt+1),Tt.getX(Zt+2)),mt&&(mt.faceIndex=Math.floor(Zt/3),mt.face.materialIndex=Xt.materialIndex,at.push(mt))}else for(let qt=Math.max(0,Wt.start),Jt=Math.min(Tt.count,Wt.start+Wt.count);qt<Jt;qt+=3)mt=vv(this,Ct,_e,pt,Lt,Ut,Qt,Tt.getX(qt),Tt.getX(qt+1),Tt.getX(qt+2)),mt&&(mt.faceIndex=Math.floor(qt/3),at.push(mt));else if(Bt!==void 0)if(Array.isArray(Ct))for(let qt=0,Jt=Ht.length;qt<Jt;qt++){const Xt=Ht[qt],sr=Ct[Xt.materialIndex];for(let Zt=Math.max(Xt.start,Wt.start),er=Math.min(Bt.count,Math.min(Xt.start+Xt.count,Wt.start+Wt.count));Zt<er;Zt+=3)mt=vv(this,sr,_e,pt,Lt,Ut,Qt,Zt,Zt+1,Zt+2),mt&&(mt.faceIndex=Math.floor(Zt/3),mt.face.materialIndex=Xt.materialIndex,at.push(mt))}else for(let qt=Math.max(0,Wt.start),Jt=Math.min(Bt.count,Wt.start+Wt.count);qt<Jt;qt+=3)mt=vv(this,Ct,_e,pt,Lt,Ut,Qt,qt,qt+1,qt+2),mt&&(mt.faceIndex=Math.floor(qt/3),at.push(mt))}}function vv(Et,_e,at,pt,mt,vt,Ct,Tt,Bt,Lt){Et.getVertexPosition(Tt,gm),Et.getVertexPosition(Bt,_m),Et.getVertexPosition(Lt,fm);const Ut=function(Qt,Ht,Wt,qt,Jt,Xt,sr,Zt){let er;if(er=Ht.side===bt?qt.intersectTriangle(sr,Xt,Jt,!0,Zt):qt.intersectTriangle(Jt,Xt,sr,Ht.side===ft,Zt),er===null)return null;fv.copy(Zt),fv.applyMatrix4(Qt.matrixWorld);const xr=Wt.ray.origin.distanceTo(fv);return xr<Wt.near||xr>Wt.far?null:{distance:xr,point:fv.clone(),object:Qt}}(Et,_e,at,pt,gm,_m,fm,_v);if(Ut){mt&&(dv.fromBufferAttribute(mt,Tt),mv.fromBufferAttribute(mt,Bt),gv.fromBufferAttribute(mt,Lt),Ut.uv=fo.getInterpolation(_v,gm,_m,fm,dv,mv,gv,new dn)),vt&&(dv.fromBufferAttribute(vt,Tt),mv.fromBufferAttribute(vt,Bt),gv.fromBufferAttribute(vt,Lt),Ut.uv1=fo.getInterpolation(_v,gm,_m,fm,dv,mv,gv,new dn),Ut.uv2=Ut.uv1),Ct&&(Oy.fromBufferAttribute(Ct,Tt),Ny.fromBufferAttribute(Ct,Bt),Fy.fromBufferAttribute(Ct,Lt),Ut.normal=fo.getInterpolation(_v,gm,_m,fm,Oy,Ny,Fy,new Er),Ut.normal.dot(pt.direction)>0&&Ut.normal.multiplyScalar(-1));const Qt={a:Tt,b:Bt,c:Lt,normal:new Er,materialIndex:0};fo.getNormal(gm,_m,fm,Qt.normal),Ut.face=Qt}return Ut}class $u extends _s{constructor(_e=1,at=1,pt=1,mt=1,vt=1,Ct=1){super(),this.type="BoxGeometry",this.parameters={width:_e,height:at,depth:pt,widthSegments:mt,heightSegments:vt,depthSegments:Ct};const Tt=this;mt=Math.floor(mt),vt=Math.floor(vt),Ct=Math.floor(Ct);const Bt=[],Lt=[],Ut=[],Qt=[];let Ht=0,Wt=0;function qt(Jt,Xt,sr,Zt,er,xr,Ar,yr,Tr,Hr,Nr){const zr=xr/Tr,Gr=Ar/Hr,Vr=xr/2,gn=Ar/2,pn=yr/2,Mn=Tr+1,Dn=Hr+1;let cn=0,$r=0;const Kr=new Er;for(let sn=0;sn<Dn;sn++){const nn=sn*Gr-gn;for(let Nn=0;Nn<Mn;Nn++){const ts=Nn*zr-Vr;Kr[Jt]=ts*Zt,Kr[Xt]=nn*er,Kr[sr]=pn,Lt.push(Kr.x,Kr.y,Kr.z),Kr[Jt]=0,Kr[Xt]=0,Kr[sr]=yr>0?1:-1,Ut.push(Kr.x,Kr.y,Kr.z),Qt.push(Nn/Tr),Qt.push(1-sn/Hr),cn+=1}}for(let sn=0;sn<Hr;sn++)for(let nn=0;nn<Tr;nn++){const Nn=Ht+nn+Mn*sn,ts=Ht+nn+Mn*(sn+1),Xn=Ht+(nn+1)+Mn*(sn+1),Fn=Ht+(nn+1)+Mn*sn;Bt.push(Nn,ts,Fn),Bt.push(ts,Xn,Fn),$r+=6}Tt.addGroup(Wt,$r,Nr),Wt+=$r,Ht+=cn}qt("z","y","x",-1,-1,pt,at,_e,Ct,vt,0),qt("z","y","x",1,-1,pt,at,-_e,Ct,vt,1),qt("x","z","y",1,1,_e,pt,at,mt,Ct,2),qt("x","z","y",1,-1,_e,pt,-at,mt,Ct,3),qt("x","y","z",1,-1,_e,at,pt,mt,vt,4),qt("x","y","z",-1,-1,_e,at,-pt,mt,vt,5),this.setIndex(Bt),this.setAttribute("position",new Ln(Lt,3)),this.setAttribute("normal",new Ln(Ut,3)),this.setAttribute("uv",new Ln(Qt,2))}copy(_e){return super.copy(_e),this.parameters=Object.assign({},_e.parameters),this}static fromJSON(_e){return new $u(_e.width,_e.height,_e.depth,_e.widthSegments,_e.heightSegments,_e.depthSegments)}}function Ap(Et){const _e={};for(const at in Et){_e[at]={};for(const pt in Et[at]){const mt=Et[at][pt];mt&&(mt.isColor||mt.isMatrix3||mt.isMatrix4||mt.isVector2||mt.isVector3||mt.isVector4||mt.isTexture||mt.isQuaternion)?mt.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),_e[at][pt]=null):_e[at][pt]=mt.clone():Array.isArray(mt)?_e[at][pt]=mt.slice():_e[at][pt]=mt}}return _e}function Do(Et){const _e={};for(let at=0;at<Et.length;at++){const pt=Ap(Et[at]);for(const mt in pt)_e[mt]=pt[mt]}return _e}function Uy(Et){return Et.getRenderTarget()===null?Et.outputColorSpace:Ms.workingColorSpace}const jy={clone:Ap,merge:Do};class Fl extends so{constructor(_e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,this.fragmentShader=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,_e!==void 0&&this.setValues(_e)}copy(_e){return super.copy(_e),this.fragmentShader=_e.fragmentShader,this.vertexShader=_e.vertexShader,this.uniforms=Ap(_e.uniforms),this.uniformsGroups=function(at){const pt=[];for(let mt=0;mt<at.length;mt++)pt.push(at[mt].clone());return pt}(_e.uniformsGroups),this.defines=Object.assign({},_e.defines),this.wireframe=_e.wireframe,this.wireframeLinewidth=_e.wireframeLinewidth,this.fog=_e.fog,this.lights=_e.lights,this.clipping=_e.clipping,this.extensions=Object.assign({},_e.extensions),this.glslVersion=_e.glslVersion,this}toJSON(_e){const at=super.toJSON(_e);at.glslVersion=this.glslVersion,at.uniforms={};for(const mt in this.uniforms){const vt=this.uniforms[mt].value;vt&&vt.isTexture?at.uniforms[mt]={type:"t",value:vt.toJSON(_e).uuid}:vt&&vt.isColor?at.uniforms[mt]={type:"c",value:vt.getHex()}:vt&&vt.isVector2?at.uniforms[mt]={type:"v2",value:vt.toArray()}:vt&&vt.isVector3?at.uniforms[mt]={type:"v3",value:vt.toArray()}:vt&&vt.isVector4?at.uniforms[mt]={type:"v4",value:vt.toArray()}:vt&&vt.isMatrix3?at.uniforms[mt]={type:"m3",value:vt.toArray()}:vt&&vt.isMatrix4?at.uniforms[mt]={type:"m4",value:vt.toArray()}:at.uniforms[mt]={value:vt}}Object.keys(this.defines).length>0&&(at.defines=this.defines),at.vertexShader=this.vertexShader,at.fragmentShader=this.fragmentShader,at.lights=this.lights,at.clipping=this.clipping;const pt={};for(const mt in this.extensions)this.extensions[mt]===!0&&(pt[mt]=!0);return Object.keys(pt).length>0&&(at.extensions=pt),at}}class yv extends Ss{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new rs,this.projectionMatrix=new rs,this.projectionMatrixInverse=new rs,this.coordinateSystem=Uo}copy(_e,at){return super.copy(_e,at),this.matrixWorldInverse.copy(_e.matrixWorldInverse),this.projectionMatrix.copy(_e.projectionMatrix),this.projectionMatrixInverse.copy(_e.projectionMatrixInverse),this.coordinateSystem=_e.coordinateSystem,this}getWorldDirection(_e){return super.getWorldDirection(_e).negate()}updateMatrixWorld(_e){super.updateMatrixWorld(_e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(_e,at){super.updateWorldMatrix(_e,at),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}class yo extends yv{constructor(_e=50,at=1,pt=.1,mt=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=_e,this.zoom=1,this.near=pt,this.far=mt,this.focus=10,this.aspect=at,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(_e,at){return super.copy(_e,at),this.fov=_e.fov,this.zoom=_e.zoom,this.near=_e.near,this.far=_e.far,this.focus=_e.focus,this.aspect=_e.aspect,this.view=_e.view===null?null:Object.assign({},_e.view),this.filmGauge=_e.filmGauge,this.filmOffset=_e.filmOffset,this}setFocalLength(_e){const at=.5*this.getFilmHeight()/_e;this.fov=2*hu*Math.atan(at),this.updateProjectionMatrix()}getFocalLength(){const _e=Math.tan(.5*$l*this.fov);return .5*this.getFilmHeight()/_e}getEffectiveFOV(){return 2*hu*Math.atan(Math.tan(.5*$l*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(_e,at,pt,mt,vt,Ct){this.aspect=_e/at,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=_e,this.view.fullHeight=at,this.view.offsetX=pt,this.view.offsetY=mt,this.view.width=vt,this.view.height=Ct,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const _e=this.near;let at=_e*Math.tan(.5*$l*this.fov)/this.zoom,pt=2*at,mt=this.aspect*pt,vt=-.5*mt;const Ct=this.view;if(this.view!==null&&this.view.enabled){const Bt=Ct.fullWidth,Lt=Ct.fullHeight;vt+=Ct.offsetX*mt/Bt,at-=Ct.offsetY*pt/Lt,mt*=Ct.width/Bt,pt*=Ct.height/Lt}const Tt=this.filmOffset;Tt!==0&&(vt+=_e*Tt/this.getFilmWidth()),this.projectionMatrix.makePerspective(vt,vt+mt,at,at-pt,_e,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(_e){const at=super.toJSON(_e);return at.object.fov=this.fov,at.object.zoom=this.zoom,at.object.near=this.near,at.object.far=this.far,at.object.focus=this.focus,at.object.aspect=this.aspect,this.view!==null&&(at.object.view=Object.assign({},this.view)),at.object.filmGauge=this.filmGauge,at.object.filmOffset=this.filmOffset,at}}const vm=-90;class Gy extends Ss{constructor(_e,at,pt){super(),this.type="CubeCamera",this.renderTarget=pt,this.coordinateSystem=null,this.activeMipmapLevel=0;const mt=new yo(vm,1,_e,at);mt.layers=this.layers,this.add(mt);const vt=new yo(vm,1,_e,at);vt.layers=this.layers,this.add(vt);const Ct=new yo(vm,1,_e,at);Ct.layers=this.layers,this.add(Ct);const Tt=new yo(vm,1,_e,at);Tt.layers=this.layers,this.add(Tt);const Bt=new yo(vm,1,_e,at);Bt.layers=this.layers,this.add(Bt);const Lt=new yo(vm,1,_e,at);Lt.layers=this.layers,this.add(Lt)}updateCoordinateSystem(){const _e=this.coordinateSystem,at=this.children.concat(),[pt,mt,vt,Ct,Tt,Bt]=at;for(const Lt of at)this.remove(Lt);if(_e===Uo)pt.up.set(0,1,0),pt.lookAt(1,0,0),mt.up.set(0,1,0),mt.lookAt(-1,0,0),vt.up.set(0,0,-1),vt.lookAt(0,1,0),Ct.up.set(0,0,1),Ct.lookAt(0,-1,0),Tt.up.set(0,1,0),Tt.lookAt(0,0,1),Bt.up.set(0,1,0),Bt.lookAt(0,0,-1);else{if(_e!==Qo)throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+_e);pt.up.set(0,-1,0),pt.lookAt(-1,0,0),mt.up.set(0,-1,0),mt.lookAt(1,0,0),vt.up.set(0,0,1),vt.lookAt(0,1,0),Ct.up.set(0,0,-1),Ct.lookAt(0,-1,0),Tt.up.set(0,-1,0),Tt.lookAt(0,0,1),Bt.up.set(0,-1,0),Bt.lookAt(0,0,-1)}for(const Lt of at)this.add(Lt),Lt.updateMatrixWorld()}update(_e,at){this.parent===null&&this.updateMatrixWorld();const{renderTarget:pt,activeMipmapLevel:mt}=this;this.coordinateSystem!==_e.coordinateSystem&&(this.coordinateSystem=_e.coordinateSystem,this.updateCoordinateSystem());const[vt,Ct,Tt,Bt,Lt,Ut]=this.children,Qt=_e.getRenderTarget(),Ht=_e.getActiveCubeFace(),Wt=_e.getActiveMipmapLevel(),qt=_e.xr.enabled;_e.xr.enabled=!1;const Jt=pt.texture.generateMipmaps;pt.texture.generateMipmaps=!1,_e.setRenderTarget(pt,0,mt),_e.render(at,vt),_e.setRenderTarget(pt,1,mt),_e.render(at,Ct),_e.setRenderTarget(pt,2,mt),_e.render(at,Tt),_e.setRenderTarget(pt,3,mt),_e.render(at,Bt),_e.setRenderTarget(pt,4,mt),_e.render(at,Lt),pt.texture.generateMipmaps=Jt,_e.setRenderTarget(pt,5,mt),_e.render(at,Ut),_e.setRenderTarget(Qt,Ht,Wt),_e.xr.enabled=qt,pt.texture.needsPMREMUpdate=!0}}class g_ extends Us{constructor(_e,at,pt,mt,vt,Ct,Tt,Bt,Lt,Ut){super(_e=_e!==void 0?_e:[],at=at!==void 0?at:en,pt,mt,vt,Ct,Tt,Bt,Lt,Ut),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(_e){this.image=_e}}class zy extends Ao{constructor(_e=1,at={}){super(_e,_e,at),this.isWebGLCubeRenderTarget=!0;const pt={width:_e,height:_e,depth:1},mt=[pt,pt,pt,pt,pt,pt];at.encoding!==void 0&&(gu("THREE.WebGLCubeRenderTarget: option.encoding has been replaced by option.colorSpace."),at.colorSpace=at.encoding===Rl?Os:ks),this.texture=new g_(mt,at.mapping,at.wrapS,at.wrapT,at.magFilter,at.minFilter,at.format,at.type,at.anisotropy,at.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=at.generateMipmaps!==void 0&&at.generateMipmaps,this.texture.minFilter=at.minFilter!==void 0?at.minFilter:Qn}fromEquirectangularTexture(_e,at){this.texture.type=at.type,this.texture.colorSpace=at.colorSpace,this.texture.generateMipmaps=at.generateMipmaps,this.texture.minFilter=at.minFilter,this.texture.magFilter=at.magFilter;const pt={tEquirect:{value:null}},mt=`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,vt=`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`,Ct=new $u(5,5,5),Tt=new Fl({name:"CubemapFromEquirect",uniforms:Ap(pt),vertexShader:mt,fragmentShader:vt,side:bt,blending:wt});Tt.uniforms.tEquirect.value=at;const Bt=new lo(Ct,Tt),Lt=at.minFilter;return at.minFilter===Kn&&(at.minFilter=Qn),new Gy(1,10,this).update(_e,Bt),at.minFilter=Lt,Bt.geometry.dispose(),Bt.material.dispose(),this}clear(_e,at,pt,mt){const vt=_e.getRenderTarget();for(let Ct=0;Ct<6;Ct++)_e.setRenderTarget(this,Ct),_e.clear(at,pt,mt);_e.setRenderTarget(vt)}}const N0=new Er,Aw=new Er,ww=new as;class Xu{constructor(_e=new Er(1,0,0),at=0){this.isPlane=!0,this.normal=_e,this.constant=at}set(_e,at){return this.normal.copy(_e),this.constant=at,this}setComponents(_e,at,pt,mt){return this.normal.set(_e,at,pt),this.constant=mt,this}setFromNormalAndCoplanarPoint(_e,at){return this.normal.copy(_e),this.constant=-at.dot(this.normal),this}setFromCoplanarPoints(_e,at,pt){const mt=N0.subVectors(pt,at).cross(Aw.subVectors(_e,at)).normalize();return this.setFromNormalAndCoplanarPoint(mt,_e),this}copy(_e){return this.normal.copy(_e.normal),this.constant=_e.constant,this}normalize(){const _e=1/this.normal.length();return this.normal.multiplyScalar(_e),this.constant*=_e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(_e){return this.normal.dot(_e)+this.constant}distanceToSphere(_e){return this.distanceToPoint(_e.center)-_e.radius}projectPoint(_e,at){return at.copy(_e).addScaledVector(this.normal,-this.distanceToPoint(_e))}intersectLine(_e,at){const pt=_e.delta(N0),mt=this.normal.dot(pt);if(mt===0)return this.distanceToPoint(_e.start)===0?at.copy(_e.start):null;const vt=-(_e.start.dot(this.normal)+this.constant)/mt;return vt<0||vt>1?null:at.copy(_e.start).addScaledVector(pt,vt)}intersectsLine(_e){const at=this.distanceToPoint(_e.start),pt=this.distanceToPoint(_e.end);return at<0&&pt>0||pt<0&&at>0}intersectsBox(_e){return _e.intersectsPlane(this)}intersectsSphere(_e){return _e.intersectsPlane(this)}coplanarPoint(_e){return _e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(_e,at){const pt=at||ww.getNormalMatrix(_e),mt=this.coplanarPoint(N0).applyMatrix4(_e),vt=this.normal.applyMatrix3(pt).normalize();return this.constant=-mt.dot(vt),this}translate(_e){return this.constant-=_e.dot(this.normal),this}equals(_e){return _e.normal.equals(this.normal)&&_e.constant===this.constant}clone(){return new this.constructor().copy(this)}}const wp=new jo,bv=new Er;class xv{constructor(_e=new Xu,at=new Xu,pt=new Xu,mt=new Xu,vt=new Xu,Ct=new Xu){this.planes=[_e,at,pt,mt,vt,Ct]}set(_e,at,pt,mt,vt,Ct){const Tt=this.planes;return Tt[0].copy(_e),Tt[1].copy(at),Tt[2].copy(pt),Tt[3].copy(mt),Tt[4].copy(vt),Tt[5].copy(Ct),this}copy(_e){const at=this.planes;for(let pt=0;pt<6;pt++)at[pt].copy(_e.planes[pt]);return this}setFromProjectionMatrix(_e,at=Uo){const pt=this.planes,mt=_e.elements,vt=mt[0],Ct=mt[1],Tt=mt[2],Bt=mt[3],Lt=mt[4],Ut=mt[5],Qt=mt[6],Ht=mt[7],Wt=mt[8],qt=mt[9],Jt=mt[10],Xt=mt[11],sr=mt[12],Zt=mt[13],er=mt[14],xr=mt[15];if(pt[0].setComponents(Bt-vt,Ht-Lt,Xt-Wt,xr-sr).normalize(),pt[1].setComponents(Bt+vt,Ht+Lt,Xt+Wt,xr+sr).normalize(),pt[2].setComponents(Bt+Ct,Ht+Ut,Xt+qt,xr+Zt).normalize(),pt[3].setComponents(Bt-Ct,Ht-Ut,Xt-qt,xr-Zt).normalize(),pt[4].setComponents(Bt-Tt,Ht-Qt,Xt-Jt,xr-er).normalize(),at===Uo)pt[5].setComponents(Bt+Tt,Ht+Qt,Xt+Jt,xr+er).normalize();else{if(at!==Qo)throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+at);pt[5].setComponents(Tt,Qt,Jt,er).normalize()}return this}intersectsObject(_e){if(_e.boundingSphere!==void 0)_e.boundingSphere===null&&_e.computeBoundingSphere(),wp.copy(_e.boundingSphere).applyMatrix4(_e.matrixWorld);else{const at=_e.geometry;at.boundingSphere===null&&at.computeBoundingSphere(),wp.copy(at.boundingSphere).applyMatrix4(_e.matrixWorld)}return this.intersectsSphere(wp)}intersectsSprite(_e){return wp.center.set(0,0,0),wp.radius=.7071067811865476,wp.applyMatrix4(_e.matrixWorld),this.intersectsSphere(wp)}intersectsSphere(_e){const at=this.planes,pt=_e.center,mt=-_e.radius;for(let vt=0;vt<6;vt++)if(at[vt].distanceToPoint(pt)<mt)return!1;return!0}intersectsBox(_e){const at=this.planes;for(let pt=0;pt<6;pt++){const mt=at[pt];if(bv.x=mt.normal.x>0?_e.max.x:_e.min.x,bv.y=mt.normal.y>0?_e.max.y:_e.min.y,bv.z=mt.normal.z>0?_e.max.z:_e.min.z,mt.distanceToPoint(bv)<0)return!1}return!0}containsPoint(_e){const at=this.planes;for(let pt=0;pt<6;pt++)if(at[pt].distanceToPoint(_e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}function Vy(){let Et=null,_e=!1,at=null,pt=null;function mt(vt,Ct){at(vt,Ct),pt=Et.requestAnimationFrame(mt)}return{start:function(){_e!==!0&&at!==null&&(pt=Et.requestAnimationFrame(mt),_e=!0)},stop:function(){Et.cancelAnimationFrame(pt),_e=!1},setAnimationLoop:function(vt){at=vt},setContext:function(vt){Et=vt}}}function Ew(Et,_e){const at=_e.isWebGL2,pt=new WeakMap;return{get:function(mt){return mt.isInterleavedBufferAttribute&&(mt=mt.data),pt.get(mt)},remove:function(mt){mt.isInterleavedBufferAttribute&&(mt=mt.data);const vt=pt.get(mt);vt&&(Et.deleteBuffer(vt.buffer),pt.delete(mt))},update:function(mt,vt){if(mt.isGLBufferAttribute){const Tt=pt.get(mt);return void((!Tt||Tt.version<mt.version)&&pt.set(mt,{buffer:mt.buffer,type:mt.type,bytesPerElement:mt.elementSize,version:mt.version}))}mt.isInterleavedBufferAttribute&&(mt=mt.data);const Ct=pt.get(mt);Ct===void 0?pt.set(mt,function(Tt,Bt){const Lt=Tt.array,Ut=Tt.usage,Qt=Et.createBuffer();let Ht;if(Et.bindBuffer(Bt,Qt),Et.bufferData(Bt,Lt,Ut),Tt.onUploadCallback(),Lt instanceof Float32Array)Ht=Et.FLOAT;else if(Lt instanceof Uint16Array)if(Tt.isFloat16BufferAttribute){if(!at)throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");Ht=Et.HALF_FLOAT}else Ht=Et.UNSIGNED_SHORT;else if(Lt instanceof Int16Array)Ht=Et.SHORT;else if(Lt instanceof Uint32Array)Ht=Et.UNSIGNED_INT;else if(Lt instanceof Int32Array)Ht=Et.INT;else if(Lt instanceof Int8Array)Ht=Et.BYTE;else if(Lt instanceof Uint8Array)Ht=Et.UNSIGNED_BYTE;else{if(!(Lt instanceof Uint8ClampedArray))throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+Lt);Ht=Et.UNSIGNED_BYTE}return{buffer:Qt,type:Ht,bytesPerElement:Lt.BYTES_PER_ELEMENT,version:Tt.version}}(mt,vt)):Ct.version<mt.version&&(function(Tt,Bt,Lt){const Ut=Bt.array,Qt=Bt.updateRange;Et.bindBuffer(Lt,Tt),Qt.count===-1?Et.bufferSubData(Lt,0,Ut):(at?Et.bufferSubData(Lt,Qt.offset*Ut.BYTES_PER_ELEMENT,Ut,Qt.offset,Qt.count):Et.bufferSubData(Lt,Qt.offset*Ut.BYTES_PER_ELEMENT,Ut.subarray(Qt.offset,Qt.offset+Qt.count)),Qt.count=-1),Bt.onUploadCallback()}(Ct.buffer,mt,vt),Ct.version=mt.version)}}}class __ extends _s{constructor(_e=1,at=1,pt=1,mt=1){super(),this.type="PlaneGeometry",this.parameters={width:_e,height:at,widthSegments:pt,heightSegments:mt};const vt=_e/2,Ct=at/2,Tt=Math.floor(pt),Bt=Math.floor(mt),Lt=Tt+1,Ut=Bt+1,Qt=_e/Tt,Ht=at/Bt,Wt=[],qt=[],Jt=[],Xt=[];for(let sr=0;sr<Ut;sr++){const Zt=sr*Ht-Ct;for(let er=0;er<Lt;er++){const xr=er*Qt-vt;qt.push(xr,-Zt,0),Jt.push(0,0,1),Xt.push(er/Tt),Xt.push(1-sr/Bt)}}for(let sr=0;sr<Bt;sr++)for(let Zt=0;Zt<Tt;Zt++){const er=Zt+Lt*sr,xr=Zt+Lt*(sr+1),Ar=Zt+1+Lt*(sr+1),yr=Zt+1+Lt*sr;Wt.push(er,xr,yr),Wt.push(xr,Ar,yr)}this.setIndex(Wt),this.setAttribute("position",new Ln(qt,3)),this.setAttribute("normal",new Ln(Jt,3)),this.setAttribute("uv",new Ln(Xt,2))}copy(_e){return super.copy(_e),this.parameters=Object.assign({},_e.parameters),this}static fromJSON(_e){return new __(_e.width,_e.height,_e.widthSegments,_e.heightSegments)}}const hs={alphahash_fragment:`#ifdef USE_ALPHAHASH
	if ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;
#endif`,alphahash_pars_fragment:`#ifdef USE_ALPHAHASH
	const float ALPHA_HASH_SCALE = 0.05;
	float hash2D( vec2 value ) {
		return fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );
	}
	float hash3D( vec3 value ) {
		return hash2D( vec2( hash2D( value.xy ), value.z ) );
	}
	float getAlphaHashThreshold( vec3 position ) {
		float maxDeriv = max(
			length( dFdx( position.xyz ) ),
			length( dFdy( position.xyz ) )
		);
		float pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );
		vec2 pixScales = vec2(
			exp2( floor( log2( pixScale ) ) ),
			exp2( ceil( log2( pixScale ) ) )
		);
		vec2 alpha = vec2(
			hash3D( floor( pixScales.x * position.xyz ) ),
			hash3D( floor( pixScales.y * position.xyz ) )
		);
		float lerpFactor = fract( log2( pixScale ) );
		float x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;
		float a = min( lerpFactor, 1.0 - lerpFactor );
		vec3 cases = vec3(
			x * x / ( 2.0 * a * ( 1.0 - a ) ),
			( x - 0.5 * a ) / ( 1.0 - a ),
			1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )
		);
		float threshold = ( x < ( 1.0 - a ) )
			? ( ( x < a ) ? cases.x : cases.y )
			: cases.z;
		return clamp( threshold , 1.0e-6, 1.0 );
	}
#endif`,alphamap_fragment:`#ifdef USE_ALPHAMAP
	#if defined(INVERSE_ALPHAMAP) && INVERSE_ALPHAMAP >= 1
	diffuseColor.a *= 1.0-texture2D( alphaMap, vAlphaMapUv ).g;
	#else
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
	#endif
#endif`,alphamap_pars_fragment:`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,alphatest_fragment:`#ifdef USE_ALPHATEST
	if ( diffuseColor.a < alphaTest ) discard;
#endif`,alphatest_pars_fragment:`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,aomap_fragment:`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometryNormal, geometryViewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,aomap_pars_fragment:`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,begin_vertex:`vec3 transformed = vec3( position );
#ifdef USE_ALPHAHASH
	vPosition = vec3( position );
#endif`,beginnormal_vertex:`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,bsdfs:`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,iridescence_fragment:`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,bumpmap_pars_fragment:`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = dFdx( surf_pos.xyz );
		vec3 vSigmaY = dFdy( surf_pos.xyz );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,clipping_planes_fragment:`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#pragma unroll_loop_start
	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
		plane = clippingPlanes[ i ];
		if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
	}
	#pragma unroll_loop_end
	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
		bool clipped = true;
		#pragma unroll_loop_start
		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
		}
		#pragma unroll_loop_end
		if ( clipped ) discard;
	#endif
#endif`,clipping_planes_pars_fragment:`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,clipping_planes_pars_vertex:`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,clipping_planes_vertex:`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,color_fragment:`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,color_pars_fragment:`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,color_pars_vertex:`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,color_vertex:`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,common:`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
#ifdef USE_ALPHAHASH
	varying vec3 vPosition;
#endif
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float luminance( const in vec3 rgb ) {
	const vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );
	return dot( weights, rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,cube_uv_reflection_fragment:`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_v0 0.339
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_v1 0.276
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_v4 0.046
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_v5 0.016
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_v6 0.0038
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,defaultnormal_vertex:`vec3 transformedNormal = objectNormal;
#ifdef USE_INSTANCING
	mat3 m = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );
	transformedNormal = m * transformedNormal;
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,displacementmap_pars_vertex:`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,displacementmap_vertex:`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,emissivemap_fragment:`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,emissivemap_pars_fragment:`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,colorspace_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",colorspace_pars_fragment:`
const mat3 LINEAR_SRGB_TO_LINEAR_DISPLAY_P3 = mat3(
	vec3( 0.8224621, 0.177538, 0.0 ),
	vec3( 0.0331941, 0.9668058, 0.0 ),
	vec3( 0.0170827, 0.0723974, 0.9105199 )
);
const mat3 LINEAR_DISPLAY_P3_TO_LINEAR_SRGB = mat3(
	vec3( 1.2249401, - 0.2249404, 0.0 ),
	vec3( - 0.0420569, 1.0420571, 0.0 ),
	vec3( - 0.0196376, - 0.0786361, 1.0982735 )
);
vec4 LinearSRGBToLinearDisplayP3( in vec4 value ) {
	return vec4( value.rgb * LINEAR_SRGB_TO_LINEAR_DISPLAY_P3, value.a );
}
vec4 LinearDisplayP3ToLinearSRGB( in vec4 value ) {
	return vec4( value.rgb * LINEAR_DISPLAY_P3_TO_LINEAR_SRGB, value.a );
}
vec4 LinearTransferOETF( in vec4 value ) {
	return value;
}
vec4 sRGBTransferOETF( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}
vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 LinearTosRGB( in vec4 value ) {
	return sRGBTransferOETF( value );
}
vec4 sRGBToLinear( in vec4 value ) {
	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
}
vec4 RGBM16ToLinear( in vec4 value ) {
	return vec4( value.rgb * value.a * 16.0, 1.0 );
}
vec4 LinearToRGBM16( in vec4 value ) {
	float maxRGB = max( value.r, max( value.g, value.b ) );
	float M = clamp( maxRGB / 16.0, 0.0, 1.0 );
	M = ceil( M * 255.0 ) / 255.0;
	return vec4( value.rgb / ( M * 16.0 ), M );
}`,envmap_fragment:`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	reflectVec = transformDirection(reflectVec, rotationMatrix(vec3(0,1,0), envMapRotation));
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,envmap_common_pars_fragment:`#ifdef USE_ENVMAP
	mat4 rotationMatrix(vec3 axis, float angle) {
		axis = normalize(axis);
		float s = sin(angle);
		float c = cos(angle);
		float oc = 1.0 - c;
		return mat4(oc * axis.x * axis.x + c,           oc * axis.x * axis.y - axis.z * s,  oc * axis.z * axis.x + axis.y * s,  0.0,
					oc * axis.x * axis.y + axis.z * s,  oc * axis.y * axis.y + c,           oc * axis.y * axis.z - axis.x * s,  0.0,
					oc * axis.z * axis.x - axis.y * s,  oc * axis.y * axis.z + axis.x * s,  oc * axis.z * axis.z + c,           0.0,
					0.0,                                0.0,                                0.0,                                1.0);
	}
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform float envMapRotation;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
#endif`,envmap_pars_fragment:`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,envmap_pars_vertex:`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,envmap_physical_pars_fragment:`#ifdef USE_ENVMAP
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
		#if defined( FIX_ENV_DIRECTION )
			vec3 worldNormal = normal;
		#else
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#endif
			worldNormal = transformDirection(worldNormal, rotationMatrix(vec3(0,1,0), envMapRotation));
			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			#if !defined( FIX_ENV_DIRECTION )
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			#endif
			reflectVec = transformDirection(reflectVec, rotationMatrix(vec3(0,1,0), envMapRotation));
			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	#ifdef USE_ANISOTROPY
		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {
			#ifdef ENVMAP_TYPE_CUBE_UV
				vec3 bentNormal = cross( bitangent, viewDir );
				bentNormal = normalize( cross( bentNormal, bitangent ) );
				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );
				return getIBLRadiance( viewDir, bentNormal, roughness );
			#else
				return vec3( 0.0 );
			#endif
		}
	#endif
#endif`,envmap_vertex:`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,fog_vertex:`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,fog_pars_vertex:`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,fog_fragment:`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,fog_pars_fragment:`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,gradientmap_pars_fragment:`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,lightmap_fragment:`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
	vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
	reflectedLight.indirectDiffuse += lightMapIrradiance;
#endif`,lightmap_pars_fragment:`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,lights_lambert_fragment:`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,lights_lambert_pars_fragment:`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,lights_pars_begin:`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
#if defined( USE_LIGHT_PROBES )
	uniform vec3 lightProbe[ 9 ];
#endif
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	#if defined ( LEGACY_LIGHTS )
		if ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
			return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );
		}
		return 1.0;
	#else
		float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
		if ( cutoffDistance > 0.0 ) {
			distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
		}
		return distanceFalloff;
	#endif
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,lights_toon_fragment:`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,lights_toon_pars_fragment:`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,lights_phong_fragment:`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,lights_phong_pars_fragment:`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,lights_physical_fragment:`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif
#ifdef USE_ANISOTROPY
	#ifdef USE_ANISOTROPYMAP
		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );
		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;
		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;
	#else
		vec2 anisotropyV = anisotropyVector;
	#endif
	material.anisotropy = length( anisotropyV );
	anisotropyV /= material.anisotropy;
	material.anisotropy = saturate( material.anisotropy );
	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );
	material.anisotropyT = tbn[ 0 ] * anisotropyV.x - tbn[ 1 ] * anisotropyV.y;
	material.anisotropyB = tbn[ 1 ] * anisotropyV.x + tbn[ 0 ] * anisotropyV.y;
#endif`,lights_physical_pars_fragment:`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
	#ifdef USE_ANISOTROPY
		float anisotropy;
		float alphaT;
		vec3 anisotropyT;
		vec3 anisotropyB;
	#endif
};
vec3 clearcoatSpecular = vec3( 0.0 );
vec3 sheenSpecular = vec3( 0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#if defined( USE_ANISOTROPY ) || defined( USE_ANISOTROPY_BRDF )
	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {
		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );
		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );
		float v = 0.5 / ( gv + gl );
		return saturate(v);
	}
	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {
		float a2 = alphaT * alphaB;
		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );
		highp float v2 = dot( v, v );
		float w2 = a2 / v2;
		return RECIPROCAL_PI * a2 * pow2 ( w2 );
	}
#endif
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColor;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	#ifdef USE_ANISOTROPY
		float dotTL = dot( material.anisotropyT, lightDir );
		float dotTV = dot( material.anisotropyT, viewDir );
		float dotTH = dot( material.anisotropyT, halfDir );
		float dotBL = dot( material.anisotropyB, lightDir );
		float dotBV = dot( material.anisotropyB, viewDir );
		float dotBH = dot( material.anisotropyB, halfDir );
		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );
		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );
	#else
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
	#endif
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometryNormal;
		vec3 viewDir = geometryViewDir;
		vec3 position = geometryPosition;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecular += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,lights_fragment_begin:`
vec3 geometryPosition = - vViewPosition;
vec3 geometryNormal = normal;
vec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
vec3 geometryClearcoatNormal;
#ifdef USE_CLEARCOAT
	geometryClearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometryViewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometryPosition, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometryPosition, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	#if defined( USE_LIGHT_PROBES )
		irradiance += getLightProbeIrradiance( lightProbe, geometryNormal );
	#endif
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,lights_fragment_maps:`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometryNormal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	#ifdef USE_ANISOTROPY
		radiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );
	#else
		radiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );
	#endif
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,lights_fragment_end:`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif`,logdepthbuf_fragment:`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,logdepthbuf_pars_fragment:`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,logdepthbuf_pars_vertex:`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,logdepthbuf_vertex:`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,map_fragment:`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vMapUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );
	
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,map_pars_fragment:`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,map_particle_fragment:`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,map_particle_pars_fragment:`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,metalnessmap_fragment:`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,metalnessmap_pars_fragment:`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,morphcolor_vertex:`#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,morphnormal_vertex:`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
		objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
		objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
		objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
	#endif
#endif`,morphtarget_pars_vertex:`#ifdef USE_MORPHTARGETS
	uniform float morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
		uniform sampler2DArray morphTargetsTexture;
		uniform ivec2 morphTargetsTextureSize;
		vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
			int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
			int y = texelIndex / morphTargetsTextureSize.x;
			int x = texelIndex - y * morphTargetsTextureSize.x;
			ivec3 morphUV = ivec3( x, y, morphTargetIndex );
			return texelFetch( morphTargetsTexture, morphUV, 0 );
		}
	#else
		#ifndef USE_MORPHNORMALS
			uniform float morphTargetInfluences[ 8 ];
		#else
			uniform float morphTargetInfluences[ 4 ];
		#endif
	#endif
#endif`,morphtarget_vertex:`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		transformed += morphTarget0 * morphTargetInfluences[ 0 ];
		transformed += morphTarget1 * morphTargetInfluences[ 1 ];
		transformed += morphTarget2 * morphTargetInfluences[ 2 ];
		transformed += morphTarget3 * morphTargetInfluences[ 3 ];
		#ifndef USE_MORPHNORMALS
			transformed += morphTarget4 * morphTargetInfluences[ 4 ];
			transformed += morphTarget5 * morphTargetInfluences[ 5 ];
			transformed += morphTarget6 * morphTargetInfluences[ 6 ];
			transformed += morphTarget7 * morphTargetInfluences[ 7 ];
		#endif
	#endif
#endif`,normal_fragment_begin:`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal,
		#if defined( USE_NORMALMAP )
			vNormalMapUv
		#elif defined( USE_CLEARCOAT_NORMALMAP )
			vClearcoatNormalMapUv
		#else
			vUv
		#endif
		);
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 nonPerturbedNormal = normal;`,normal_fragment_maps:`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,normal_pars_fragment:`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,normal_pars_vertex:`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,normal_vertex:`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,normalmap_pars_fragment:`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,clearcoat_normal_fragment_begin:`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = nonPerturbedNormal;
#endif`,clearcoat_normal_fragment_maps:`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,clearcoat_pars_fragment:`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,iridescence_pars_fragment:`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,opaque_fragment:`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha;
diffuseColor.a = min(max(diffuseColor.a, 0.), 1.);
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,packing:`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec2 packDepthToRG( in highp float v ) {
	return packDepthToRGBA( v ).yx;
}
float unpackRGToDepth( const in highp vec2 v ) {
	return unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,premultiplied_alpha_fragment:`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,project_vertex:`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,dithering_fragment:`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,dithering_pars_fragment:`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,roughnessmap_fragment:`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,roughnessmap_pars_fragment:`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,shadowmap_pars_fragment:`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,shadowmap_pars_vertex:`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,shadowmap_vertex:`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,shadowmask_pars_fragment:`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,skinbase_vertex:`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,skinning_pars_vertex:`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	uniform int boneTextureSize;
	mat4 getBoneMatrix( const in float i ) {
		float j = i * 4.0;
		float x = mod( j, float( boneTextureSize ) );
		float y = floor( j / float( boneTextureSize ) );
		float dx = 1.0 / float( boneTextureSize );
		float dy = 1.0 / float( boneTextureSize );
		y = dy * ( y + 0.5 );
		vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );
		vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );
		vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );
		vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );
		mat4 bone = mat4( v1, v2, v3, v4 );
		return bone;
	}
#endif`,skinning_vertex:`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,skinnormal_vertex:`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,specularmap_fragment:`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,specularmap_pars_fragment:`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,tonemapping_fragment:`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,tonemapping_pars_fragment:`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return saturate( toneMappingExposure * color );
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,transmission_fragment:`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmitted = getIBLVolumeRefraction(
		n, v, roughnessFactor, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );
#endif`,transmission_pars_fragment:`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	#ifndef WebGL2Context
	#define textureLod texture2DLodEXT
	#define textureSize(s, lod) vec2(1024./pow(2.,float(lod)),1024./pow(2.,float(lod)))
	#define isinf(x) (x > 1e20 || x < -1e20)
	#endif
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		if(roughness == 0.0) return transmissionSamplerMapTexelToLinear( texture2D( transmissionSamplerMap, fragCoord.xy ) );
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return transmissionSamplerMapTexelToLinear( textureBicubic( transmissionSamplerMap, fragCoord.xy, lod ) );
	}
	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) || attenuationDistance == 0.0) {
			return vec3( 1.0 );
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
		vec3 refractedRayExit = position + transmissionRay;
		vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
		vec2 refractionCoords = ndcPos.xy / ndcPos.w;
		refractionCoords += 1.0;
		refractionCoords /= 2.0;
		vec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
		vec3 transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );
		vec3 attenuatedColor = transmittance * transmittedLight.rgb;
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;
		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );
	}
#endif`,uv_pars_fragment:`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,uv_pars_vertex:`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,uv_vertex:`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ANISOTROPYMAP
	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,worldpos_vertex:`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`,background_vert:`#ifdef HAS_TEXTURE
varying vec2 vUv;
uniform mat3 uvTransform;
uniform bool flipX;
uniform bool flipY;
#endif
void main() {
#ifdef HAS_TEXTURE
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
    vUv = flipX ? vec2( 1.0 - vUv.x, vUv.y ) : vUv;
    vUv = flipY ? vec2( vUv.x, 1.0 - vUv.y ) : vUv;
#endif
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,background_frag:`#ifdef HAS_TEXTURE
uniform sampler2D t2D;
varying vec2 vUv;
#endif
uniform float backgroundIntensity;
uniform vec3 backgroundColor;
void main() {
#ifdef HAS_TEXTURE
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
#else
	vec4 texColor = vec4( 1.0 );
#endif
	texColor.rgb *= backgroundColor * backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,backgroundCube_vert:`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,backgroundCube_frag:`#include <envmap_common_pars_fragment>
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
void main() {
	vec3 vReflect = vWorldDirection;
	vReflect = transformDirection(vReflect, rotationMatrix(vec3(0,1,0), envMapRotation));
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, vec3( flipEnvMap * vReflect.x, vReflect.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, vReflect, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	texColor.rgb *= envMapIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,cube_vert:`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,cube_frag:`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,depth_vert:`#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,depth_frag:`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,distanceRGBA_vert:`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,distanceRGBA_frag:`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,equirect_vert:`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,equirect_frag:`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,linedashed_vert:`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,linedashed_frag:`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,meshbasic_vert:`#include <common>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,meshbasic_frag:`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshlambert_vert:`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshlambert_frag:`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshmatcap_vert:`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,meshmatcap_frag:`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshnormal_vert:`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,meshnormal_frag:`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,meshphong_vert:`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshphong_frag:`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshphysical_vert:`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,meshphysical_frag:`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
#ifdef USE_ANISOTROPY
	uniform vec2 anisotropyVector;
	#ifdef USE_ANISOTROPYMAP
		uniform sampler2D anisotropyMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;
	#endif
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshtoon_vert:`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshtoon_frag:`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,points_vert:`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,points_frag:`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,shadow_vert:`#include <common>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,shadow_frag:`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,sprite_vert:`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,sprite_frag:`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`},kn={common:{diffuse:{value:new Un(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new as},alphaMap:{value:null},alphaMapTransform:{value:new as},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new as}},envmap:{envMap:{value:null},envMapRotation:{value:0},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new as}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new as}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new as},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new as},normalScale:{value:new dn(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new as},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new as}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new as}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new as}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Un(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Un(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new as},alphaTest:{value:0},uvTransform:{value:new as}},sprite:{diffuse:{value:new Un(16777215)},opacity:{value:1},center:{value:new dn(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new as},alphaMap:{value:null},alphaMapTransform:{value:new as},alphaTest:{value:0}}},Go={basic:{uniforms:Do([kn.common,kn.specularmap,kn.envmap,kn.aomap,kn.lightmap,kn.fog]),vertexShader:hs.meshbasic_vert,fragmentShader:hs.meshbasic_frag},lambert:{uniforms:Do([kn.common,kn.specularmap,kn.envmap,kn.aomap,kn.lightmap,kn.emissivemap,kn.bumpmap,kn.normalmap,kn.displacementmap,kn.fog,kn.lights,{emissive:{value:new Un(0)}}]),vertexShader:hs.meshlambert_vert,fragmentShader:hs.meshlambert_frag},phong:{uniforms:Do([kn.common,kn.specularmap,kn.envmap,kn.aomap,kn.lightmap,kn.emissivemap,kn.bumpmap,kn.normalmap,kn.displacementmap,kn.fog,kn.lights,{emissive:{value:new Un(0)},specular:{value:new Un(1118481)},shininess:{value:30}}]),vertexShader:hs.meshphong_vert,fragmentShader:hs.meshphong_frag},standard:{uniforms:Do([kn.common,kn.envmap,kn.aomap,kn.lightmap,kn.emissivemap,kn.bumpmap,kn.normalmap,kn.displacementmap,kn.roughnessmap,kn.metalnessmap,kn.fog,kn.lights,{emissive:{value:new Un(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:hs.meshphysical_vert,fragmentShader:hs.meshphysical_frag},toon:{uniforms:Do([kn.common,kn.aomap,kn.lightmap,kn.emissivemap,kn.bumpmap,kn.normalmap,kn.displacementmap,kn.gradientmap,kn.fog,kn.lights,{emissive:{value:new Un(0)}}]),vertexShader:hs.meshtoon_vert,fragmentShader:hs.meshtoon_frag},matcap:{uniforms:Do([kn.common,kn.bumpmap,kn.normalmap,kn.displacementmap,kn.fog,{matcap:{value:null}}]),vertexShader:hs.meshmatcap_vert,fragmentShader:hs.meshmatcap_frag},points:{uniforms:Do([kn.points,kn.fog]),vertexShader:hs.points_vert,fragmentShader:hs.points_frag},dashed:{uniforms:Do([kn.common,kn.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:hs.linedashed_vert,fragmentShader:hs.linedashed_frag},depth:{uniforms:Do([kn.common,kn.displacementmap]),vertexShader:hs.depth_vert,fragmentShader:hs.depth_frag},normal:{uniforms:Do([kn.common,kn.bumpmap,kn.normalmap,kn.displacementmap,{opacity:{value:1}}]),vertexShader:hs.meshnormal_vert,fragmentShader:hs.meshnormal_frag},sprite:{uniforms:Do([kn.sprite,kn.fog]),vertexShader:hs.sprite_vert,fragmentShader:hs.sprite_frag},background:{uniforms:{uvTransform:{value:new as},t2D:{value:null},backgroundIntensity:{value:1},backgroundColor:{value:new Un(16777215)},flipX:{value:!1},flipY:{value:!1}},vertexShader:hs.background_vert,fragmentShader:hs.background_frag},backgroundCube:{uniforms:{envMap:{value:null},envMapRotation:{value:0},envMapIntensity:{value:1},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1}},vertexShader:hs.backgroundCube_vert,fragmentShader:hs.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:hs.cube_vert,fragmentShader:hs.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:hs.equirect_vert,fragmentShader:hs.equirect_frag},distanceRGBA:{uniforms:Do([kn.common,kn.displacementmap,{referencePosition:{value:new Er},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:hs.distanceRGBA_vert,fragmentShader:hs.distanceRGBA_frag},shadow:{uniforms:Do([kn.lights,kn.fog,{color:{value:new Un(0)},opacity:{value:1}}]),vertexShader:hs.shadow_vert,fragmentShader:hs.shadow_frag}};Go.physical={uniforms:Do([Go.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new as},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new as},clearcoatNormalScale:{value:new dn(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new as},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new as},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new as},sheen:{value:0},sheenColor:{value:new Un(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new as},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new as},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new as},transmissionSamplerSize:{value:new dn},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new as},attenuationDistance:{value:0},attenuationColor:{value:new Un(0)},specularColor:{value:new Un(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new as},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new as},anisotropyVector:{value:new dn},anisotropyMap:{value:null},anisotropyMapTransform:{value:new as}}]),vertexShader:hs.meshphysical_vert,fragmentShader:hs.meshphysical_frag};const Av={r:0,b:0,g:0};function Sw(Et,_e,at,pt,mt,vt,Ct){const Tt=new Un(0);let Bt,Lt,Ut=vt===!0?0:1,Qt=null,Ht=0,Wt=null;function qt(Jt,Xt){Jt.getRGB(Av,Uy(Et)),pt.buffers.color.setClear(Av.r,Av.g,Av.b,Xt,Ct)}return{getClearColor:function(){return Tt},setClearColor:function(Jt,Xt=1){Tt.set(Jt),Ut=Xt,qt(Tt,Ut)},getClearAlpha:function(){return Ut},setClearAlpha:function(Jt){Ut=Jt,qt(Tt,Ut)},getPlaneMesh:function(){return Bt},getBoxMesh:function(){return Lt},getBoxMesh2:function(){return Lt===void 0&&(Lt=new lo(new $u(1,1,1),new Fl({name:"BackgroundCubeMaterial",uniforms:Ap(Go.backgroundCube.uniforms),vertexShader:Go.backgroundCube.vertexShader,fragmentShader:Go.backgroundCube.fragmentShader,side:bt,depthTest:!1,depthWrite:!1,fog:!1})),Lt.geometry.deleteAttribute("normal"),Lt.geometry.deleteAttribute("uv"),Lt.onBeforeRender=function(Jt,Xt,sr){this.matrixWorld.copyPosition(sr.matrixWorld)},Object.defineProperty(Lt.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),mt.update(Lt)),Lt},render:function(Jt,Xt){let sr=!1,Zt=Xt.isScene===!0?Xt.background:null;const er=Xt.isScene&&Xt.backgroundColor!==void 0?Xt.backgroundColor:null;Zt==="environment"&&(Zt=Xt.environment),Zt&&Zt.isTexture&&(Zt=(Xt.backgroundBlurriness>0?at:_e).get(Zt)),Zt===null?qt(Tt,Ut):Zt&&Zt.isColor&&(qt(Zt,1),sr=!0);const xr=Et.xr.getEnvironmentBlendMode();if(xr==="additive"?pt.buffers.color.setClear(0,0,0,1,Ct):xr==="alpha-blend"&&pt.buffers.color.setClear(0,0,0,0,Ct),(Et.autoClear||sr)&&Et.clear(Et.autoClearColor,Et.autoClearDepth,Et.autoClearStencil),Zt&&(Zt.isCubeTexture||Zt.mapping===Tn))Lt===void 0&&(Lt=new lo(new $u(1,1,1),new Fl({name:"BackgroundCubeMaterial",uniforms:Ap(Go.backgroundCube.uniforms),vertexShader:Go.backgroundCube.vertexShader,fragmentShader:Go.backgroundCube.fragmentShader,side:bt,depthTest:!1,depthWrite:!1,fog:!1})),Lt.geometry.deleteAttribute("normal"),Lt.geometry.deleteAttribute("uv"),Lt.onBeforeRender=function(Ar,yr,Tr){this.matrixWorld.copyPosition(Tr.matrixWorld)},Object.defineProperty(Lt.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),mt.update(Lt)),Lt.material.uniforms.envMap.value=Zt,Lt.material.uniforms.envMapRotation.value=Zt&&Zt.rotation||0,Lt.material.uniforms.envMapIntensity.value=Zt===Xt.environment&&Xt.envMapIntensity||.05,Lt.material.uniforms.flipEnvMap.value=Zt.isCubeTexture&&Zt.isRenderTargetTexture===!1?-1:1,Lt.material.uniforms.backgroundBlurriness.value=Xt.backgroundBlurriness,Lt.material.uniforms.backgroundIntensity.value=Xt.backgroundIntensity,Lt.material.toneMapped=Ms.getTransfer(Zt.colorSpace)!==Ns,Qt===Zt&&Ht===Zt.version&&Wt===Et.toneMapping||(Lt.material.needsUpdate=!0,Qt=Zt,Ht=Zt.version,Wt=Et.toneMapping),Lt.layers.enableAll(),Jt.unshift(Lt,Lt.geometry,Lt.material,0,0,null);else if(Zt&&Zt.isTexture||!Zt&&er){Bt===void 0&&(Bt=new lo(new __(2,2),new Fl({name:"BackgroundMaterial",uniforms:Ap(Go.background.uniforms),vertexShader:Go.background.vertexShader,fragmentShader:Go.background.fragmentShader,side:ft,depthTest:!1,depthWrite:!1,fog:!1})),Bt.geometry.deleteAttribute("normal"),Object.defineProperty(Bt.material,"map",{get:function(){return this.uniforms.t2D.value}}),mt.update(Bt)),Bt.material.uniforms.backgroundColor.value.set(er||16777215),Bt.material.uniforms.t2D.value=Zt,Bt.material.uniforms.backgroundIntensity.value=Xt.backgroundIntensity,Zt?(Bt.material.toneMapped=Ms.getTransfer(Zt.colorSpace)!==Ns,Bt.material.uniforms.flipX.value=Zt.userData.flipX||!1,Bt.material.uniforms.flipY.value=Zt.userData.flipY||!1,Zt.matrixAutoUpdate===!0&&Zt.updateMatrix(),Bt.material.uniforms.uvTransform.value.copy(Zt.matrix),Bt.material.defines.HAS_TEXTURE="1"):Bt.material.defines.HAS_TEXTURE&&delete Bt.material.defines.HAS_TEXTURE;const Ar=Zt?Zt.version:-1;Qt===Zt&&Ht===Ar&&Wt===Et.toneMapping||(Bt.material.needsUpdate=!0,Qt=Zt,Ht=Ar,Wt=Et.toneMapping),Bt.layers.enableAll(),Jt.unshift(Bt,Bt.geometry,Bt.material,0,0,null)}}}}function Cw(Et,_e,at,pt){const mt=Et.getParameter(Et.MAX_VERTEX_ATTRIBS),vt=pt.isWebGL2?null:_e.get("OES_vertex_array_object"),Ct=pt.isWebGL2||vt!==null,Tt={},Bt=Wt(null);let Lt=Bt,Ut=!1;function Qt(Ar){return pt.isWebGL2?Et.bindVertexArray(Ar):vt.bindVertexArrayOES(Ar)}function Ht(Ar){return pt.isWebGL2?Et.deleteVertexArray(Ar):vt.deleteVertexArrayOES(Ar)}function Wt(Ar){const yr=[],Tr=[],Hr=[];for(let Nr=0;Nr<mt;Nr++)yr[Nr]=0,Tr[Nr]=0,Hr[Nr]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:yr,enabledAttributes:Tr,attributeDivisors:Hr,object:Ar,attributes:{},index:null}}function qt(){const Ar=Lt.newAttributes;for(let yr=0,Tr=Ar.length;yr<Tr;yr++)Ar[yr]=0}function Jt(Ar){Xt(Ar,0)}function Xt(Ar,yr){const Tr=Lt.newAttributes,Hr=Lt.enabledAttributes,Nr=Lt.attributeDivisors;Tr[Ar]=1,Hr[Ar]===0&&(Et.enableVertexAttribArray(Ar),Hr[Ar]=1),Nr[Ar]!==yr&&((pt.isWebGL2?Et:_e.get("ANGLE_instanced_arrays"))[pt.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](Ar,yr),Nr[Ar]=yr)}function sr(){const Ar=Lt.newAttributes,yr=Lt.enabledAttributes;for(let Tr=0,Hr=yr.length;Tr<Hr;Tr++)yr[Tr]!==Ar[Tr]&&(Et.disableVertexAttribArray(Tr),yr[Tr]=0)}function Zt(Ar,yr,Tr,Hr,Nr,zr,Gr){Gr===!0?Et.vertexAttribIPointer(Ar,yr,Tr,Nr,zr):Et.vertexAttribPointer(Ar,yr,Tr,Hr,Nr,zr)}function er(){xr(),Ut=!0,Lt!==Bt&&(Lt=Bt,Qt(Lt.object))}function xr(){Bt.geometry=null,Bt.program=null,Bt.wireframe=!1}return{setup:function(Ar,yr,Tr,Hr,Nr){let zr=!1;if(Ct){const Gr=function(Vr,gn,pn){const Mn=pn.wireframe===!0;let Dn=Tt[Vr.id];Dn===void 0&&(Dn={},Tt[Vr.id]=Dn);let cn=Dn[gn.id];cn===void 0&&(cn={},Dn[gn.id]=cn);let $r=cn[Mn];return $r===void 0&&($r=Wt(pt.isWebGL2?Et.createVertexArray():vt.createVertexArrayOES()),cn[Mn]=$r),$r}(Hr,Tr,yr);Lt!==Gr&&(Lt=Gr,Qt(Lt.object)),zr=function(Vr,gn,pn,Mn){const Dn=Lt.attributes,cn=gn.attributes;let $r=0;const Kr=pn.getAttributes();for(const sn in Kr)if(Kr[sn].location>=0){const nn=Dn[sn];let Nn=cn[sn];if(Nn===void 0&&(sn==="instanceMatrix"&&Vr.instanceMatrix&&(Nn=Vr.instanceMatrix),sn==="instanceColor"&&Vr.instanceColor&&(Nn=Vr.instanceColor)),nn===void 0||nn.attribute!==Nn||Nn&&nn.data!==Nn.data)return!0;$r++}return Lt.attributesNum!==$r||Lt.index!==Mn}(Ar,Hr,Tr,Nr),zr&&function(Vr,gn,pn,Mn){const Dn={},cn=gn.attributes;let $r=0;const Kr=pn.getAttributes();for(const sn in Kr)if(Kr[sn].location>=0){let nn=cn[sn];nn===void 0&&(sn==="instanceMatrix"&&Vr.instanceMatrix&&(nn=Vr.instanceMatrix),sn==="instanceColor"&&Vr.instanceColor&&(nn=Vr.instanceColor));const Nn={};Nn.attribute=nn,nn&&nn.data&&(Nn.data=nn.data),Dn[sn]=Nn,$r++}Lt.attributes=Dn,Lt.attributesNum=$r,Lt.index=Mn}(Ar,Hr,Tr,Nr)}else{const Gr=yr.wireframe===!0;Lt.geometry===Hr.id&&Lt.program===Tr.id&&Lt.wireframe===Gr||(Lt.geometry=Hr.id,Lt.program=Tr.id,Lt.wireframe=Gr,zr=!0)}Nr!==null&&at.update(Nr,Et.ELEMENT_ARRAY_BUFFER),(zr||Ut)&&(Ut=!1,function(Gr,Vr,gn,pn){if(pt.isWebGL2===!1&&(Gr.isInstancedMesh||pn.isInstancedBufferGeometry)&&_e.get("ANGLE_instanced_arrays")===null)return;qt();const Mn=pn.attributes,Dn=gn.getAttributes(),cn=Vr.defaultAttributeValues;for(const $r in Dn){const Kr=Dn[$r];if(Kr.location>=0){let sn=Mn[$r];if(sn===void 0&&($r==="instanceMatrix"&&Gr.instanceMatrix&&(sn=Gr.instanceMatrix),$r==="instanceColor"&&Gr.instanceColor&&(sn=Gr.instanceColor)),sn!==void 0){const nn=sn.normalized,Nn=sn.itemSize,ts=at.get(sn);if(ts===void 0)continue;const Xn=ts.buffer,Fn=ts.type,ls=ts.bytesPerElement,Br=pt.isWebGL2===!0&&(Fn===Et.INT||Fn===Et.UNSIGNED_INT||sn.gpuType===tp);if(sn.isInterleavedBufferAttribute){const wr=sn.data,Fr=wr.stride,Qr=sn.offset;if(wr.isInstancedInterleavedBuffer){for(let Rr=0;Rr<Kr.locationSize;Rr++)Xt(Kr.location+Rr,wr.meshPerAttribute);Gr.isInstancedMesh!==!0&&pn._maxInstanceCount===void 0&&(pn._maxInstanceCount=wr.meshPerAttribute*wr.count)}else for(let Rr=0;Rr<Kr.locationSize;Rr++)Jt(Kr.location+Rr);Et.bindBuffer(Et.ARRAY_BUFFER,Xn);for(let Rr=0;Rr<Kr.locationSize;Rr++)Zt(Kr.location+Rr,Nn/Kr.locationSize,Fn,nn,Fr*ls,(Qr+Nn/Kr.locationSize*Rr)*ls,Br)}else{if(sn.isInstancedBufferAttribute){for(let wr=0;wr<Kr.locationSize;wr++)Xt(Kr.location+wr,sn.meshPerAttribute);Gr.isInstancedMesh!==!0&&pn._maxInstanceCount===void 0&&(pn._maxInstanceCount=sn.meshPerAttribute*sn.count)}else for(let wr=0;wr<Kr.locationSize;wr++)Jt(Kr.location+wr);Et.bindBuffer(Et.ARRAY_BUFFER,Xn);for(let wr=0;wr<Kr.locationSize;wr++)Zt(Kr.location+wr,Nn/Kr.locationSize,Fn,nn,Nn*ls,Nn/Kr.locationSize*wr*ls,Br)}}else if(cn!==void 0){const nn=cn[$r];if(nn!==void 0)switch(nn.length){case 2:Et.vertexAttrib2fv(Kr.location,nn);break;case 3:Et.vertexAttrib3fv(Kr.location,nn);break;case 4:Et.vertexAttrib4fv(Kr.location,nn);break;default:Et.vertexAttrib1fv(Kr.location,nn)}}}}sr()}(Ar,yr,Tr,Hr),Nr!==null&&Et.bindBuffer(Et.ELEMENT_ARRAY_BUFFER,at.get(Nr).buffer))},reset:er,resetDefaultState:xr,dispose:function(){er();for(const Ar in Tt){const yr=Tt[Ar];for(const Tr in yr){const Hr=yr[Tr];for(const Nr in Hr)Ht(Hr[Nr].object),delete Hr[Nr];delete yr[Tr]}delete Tt[Ar]}},releaseStatesOfGeometry:function(Ar){if(Tt[Ar.id]===void 0)return;const yr=Tt[Ar.id];for(const Tr in yr){const Hr=yr[Tr];for(const Nr in Hr)Ht(Hr[Nr].object),delete Hr[Nr];delete yr[Tr]}delete Tt[Ar.id]},releaseStatesOfProgram:function(Ar){for(const yr in Tt){const Tr=Tt[yr];if(Tr[Ar.id]===void 0)continue;const Hr=Tr[Ar.id];for(const Nr in Hr)Ht(Hr[Nr].object),delete Hr[Nr];delete Tr[Ar.id]}},initAttributes:qt,enableAttribute:Jt,disableUnusedAttributes:sr}}function Pw(Et,_e,at,pt){const mt=pt.isWebGL2;let vt;this.setMode=function(Ct){vt=Ct},this.render=function(Ct,Tt){Et.drawArrays(vt,Ct,Tt),at.update(Tt,vt,1)},this.renderInstances=function(Ct,Tt,Bt){if(Bt===0)return;let Lt,Ut;if(mt)Lt=Et,Ut="drawArraysInstanced";else if(Lt=_e.get("ANGLE_instanced_arrays"),Ut="drawArraysInstancedANGLE",Lt===null)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");Lt[Ut](vt,Ct,Tt,Bt),at.update(Tt,vt,Bt)}}function Tw(Et,_e,at){let pt;function mt(xr){if(xr==="highp"){if(Et.getShaderPrecisionFormat(Et.VERTEX_SHADER,Et.HIGH_FLOAT).precision>0&&Et.getShaderPrecisionFormat(Et.FRAGMENT_SHADER,Et.HIGH_FLOAT).precision>0)return"highp";xr="mediump"}return xr==="mediump"&&Et.getShaderPrecisionFormat(Et.VERTEX_SHADER,Et.MEDIUM_FLOAT).precision>0&&Et.getShaderPrecisionFormat(Et.FRAGMENT_SHADER,Et.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}const vt=typeof WebGL2RenderingContext<"u"&&Et.constructor.name==="WebGL2RenderingContext";let Ct=at.precision!==void 0?at.precision:"highp";const Tt=mt(Ct);Tt!==Ct&&(console.warn("THREE.WebGLRenderer:",Ct,"not supported, using",Tt,"instead."),Ct=Tt);const Bt=vt||_e.has("WEBGL_draw_buffers"),Lt=at.logarithmicDepthBuffer===!0,Ut=Et.getParameter(Et.MAX_TEXTURE_IMAGE_UNITS),Qt=Et.getParameter(Et.MAX_VERTEX_TEXTURE_IMAGE_UNITS),Ht=Et.getParameter(Et.MAX_TEXTURE_SIZE),Wt=Et.getParameter(Et.MAX_CUBE_MAP_TEXTURE_SIZE),qt=Et.getParameter(Et.MAX_VERTEX_ATTRIBS),Jt=Et.getParameter(Et.MAX_VERTEX_UNIFORM_VECTORS),Xt=Et.getParameter(Et.MAX_VARYING_VECTORS),sr=Et.getParameter(Et.MAX_FRAGMENT_UNIFORM_VECTORS),Zt=Qt>0,er=vt||_e.has("OES_texture_float");return{isWebGL2:vt,drawBuffers:Bt,getMaxAnisotropy:function(){if(pt!==void 0)return pt;if(_e.has("EXT_texture_filter_anisotropic")===!0){const xr=_e.get("EXT_texture_filter_anisotropic");pt=Et.getParameter(xr.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else pt=0;return pt},getMaxPrecision:mt,precision:Ct,logarithmicDepthBuffer:Lt,maxTextures:Ut,maxVertexTextures:Qt,maxTextureSize:Ht,maxCubemapSize:Wt,maxAttributes:qt,maxVertexUniforms:Jt,maxVaryings:Xt,maxFragmentUniforms:sr,vertexTextures:Zt,floatFragmentTextures:er,floatVertexTextures:Zt&&er,maxSamples:vt?Et.getParameter(Et.MAX_SAMPLES):0}}function Mw(Et){const _e=this;let at=null,pt=0,mt=!1,vt=!1;const Ct=new Xu,Tt=new as,Bt={value:null,needsUpdate:!1};function Lt(Ut,Qt,Ht,Wt){const qt=Ut!==null?Ut.length:0;let Jt=null;if(qt!==0){if(Jt=Bt.value,Wt!==!0||Jt===null){const Xt=Ht+4*qt,sr=Qt.matrixWorldInverse;Tt.getNormalMatrix(sr),(Jt===null||Jt.length<Xt)&&(Jt=new Float32Array(Xt));for(let Zt=0,er=Ht;Zt!==qt;++Zt,er+=4)Ct.copy(Ut[Zt]).applyMatrix4(sr,Tt),Ct.normal.toArray(Jt,er),Jt[er+3]=Ct.constant}Bt.value=Jt,Bt.needsUpdate=!0}return _e.numPlanes=qt,_e.numIntersection=0,Jt}this.uniform=Bt,this.numPlanes=0,this.numIntersection=0,this.init=function(Ut,Qt){const Ht=Ut.length!==0||Qt||pt!==0||mt;return mt=Qt,pt=Ut.length,Ht},this.beginShadows=function(){vt=!0,Lt(null)},this.endShadows=function(){vt=!1},this.setGlobalState=function(Ut,Qt){at=Lt(Ut,Qt,0)},this.setState=function(Ut,Qt,Ht){const Wt=Ut.clippingPlanes,qt=Ut.clipIntersection,Jt=Ut.clipShadows,Xt=Et.get(Ut);if(!mt||Wt===null||Wt.length===0||vt&&!Jt)vt?Lt(null):(Bt.value!==at&&(Bt.value=at,Bt.needsUpdate=pt>0),_e.numPlanes=pt,_e.numIntersection=0);else{const sr=vt?0:pt,Zt=4*sr;let er=Xt.clippingState||null;Bt.value=er,er=Lt(Wt,Qt,Zt,Ht);for(let xr=0;xr!==Zt;++xr)er[xr]=at[xr];Xt.clippingState=er,this.numIntersection=qt?this.numPlanes:0,this.numPlanes+=sr}}}function Iw(Et){let _e=new WeakMap;function at(mt,vt){return vt===mn?mt.mapping=en:vt===bn&&(mt.mapping=rn),mt}function pt(mt){const vt=mt.target;vt.removeEventListener("dispose",pt);const Ct=_e.get(vt);Ct!==void 0&&(_e.delete(vt),Ct.dispose())}return{get:function(mt){if(mt&&mt.isTexture&&mt.isRenderTargetTexture===!1){const vt=mt.mapping;if(vt===mn||vt===bn){if(_e.has(mt)){const Ct=_e.get(mt).texture;return Ct.rotation=mt.rotation,at(Ct,mt.mapping)}{const Ct=mt.image;if(Ct&&Ct.height>0){const Tt=new zy(Ct.height/2);return Tt.fromEquirectangularTexture(Et,mt),Tt.texture.rotation=mt.rotation,_e.set(mt,Tt),mt.addEventListener("dispose",pt),at(Tt.texture,mt.mapping)}return null}}}return mt},dispose:function(){_e=new WeakMap}}}class wv extends yv{constructor(_e=-1,at=1,pt=1,mt=-1,vt=.1,Ct=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=_e,this.right=at,this.top=pt,this.bottom=mt,this.near=vt,this.far=Ct,this.updateProjectionMatrix()}copy(_e,at){return super.copy(_e,at),this.left=_e.left,this.right=_e.right,this.top=_e.top,this.bottom=_e.bottom,this.near=_e.near,this.far=_e.far,this.zoom=_e.zoom,this.view=_e.view===null?null:Object.assign({},_e.view),this}setViewOffset(_e,at,pt,mt,vt,Ct){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=_e,this.view.fullHeight=at,this.view.offsetX=pt,this.view.offsetY=mt,this.view.width=vt,this.view.height=Ct,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const _e=(this.right-this.left)/(2*this.zoom),at=(this.top-this.bottom)/(2*this.zoom),pt=(this.right+this.left)/2,mt=(this.top+this.bottom)/2;let vt=pt-_e,Ct=pt+_e,Tt=mt+at,Bt=mt-at;if(this.view!==null&&this.view.enabled){const Lt=(this.right-this.left)/this.view.fullWidth/this.zoom,Ut=(this.top-this.bottom)/this.view.fullHeight/this.zoom;vt+=Lt*this.view.offsetX,Ct=vt+Lt*this.view.width,Tt-=Ut*this.view.offsetY,Bt=Tt-Ut*this.view.height}this.projectionMatrix.makeOrthographic(vt,Ct,Tt,Bt,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(_e){const at=super.toJSON(_e);return at.object.zoom=this.zoom,at.object.left=this.left,at.object.right=this.right,at.object.top=this.top,at.object.bottom=this.bottom,at.object.near=this.near,at.object.far=this.far,this.view!==null&&(at.object.view=Object.assign({},this.view)),at}}const Hy=[.125,.215,.35,.446,.526,.582],F0=new wv,Qy=new Un;let U0=null;const Ep=(1+Math.sqrt(5))/2,ym=1/Ep,Wy=[new Er(1,1,1),new Er(-1,1,1),new Er(1,1,-1),new Er(-1,1,-1),new Er(0,Ep,ym),new Er(0,Ep,-ym),new Er(ym,0,Ep),new Er(-ym,0,Ep),new Er(Ep,ym,0),new Er(-Ep,ym,0)];class j0{constructor(_e){this._renderer=_e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(_e,at=0,pt=.1,mt=100){U0=this._renderer.getRenderTarget(),this._setSize(256);const vt=this._allocateTargets();return vt.depthBuffer=!0,this._sceneToCubeUV(_e,pt,mt,vt),at>0&&this._blur(vt,0,0,at),this._applyPMREM(vt),this._cleanup(vt),vt}fromEquirectangular(_e,at=null){return this._fromTexture(_e,at)}fromCubemap(_e,at=null){return this._fromTexture(_e,at)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=Xy(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=$y(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(_e){this._lodMax=Math.floor(Math.log2(_e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let _e=0;_e<this._lodPlanes.length;_e++)this._lodPlanes[_e].dispose()}_cleanup(_e){this._renderer.setRenderTarget(U0),_e.scissorTest=!1,Ev(_e,0,0,_e.width,_e.height)}_fromTexture(_e,at){_e.mapping===en||_e.mapping===rn?this._setSize(_e.image.length===0?16:_e.image[0].width||_e.image[0].image.width):this._setSize(_e.image.width/4),U0=this._renderer.getRenderTarget();const pt=at||this._allocateTargets();return this._textureToCubeUV(_e,pt),this._applyPMREM(pt),this._cleanup(pt),pt}_allocateTargets(){const _e=3*Math.max(this._cubeSize,112),at=4*this._cubeSize,pt={magFilter:Qn,minFilter:Qn,generateMipmaps:!1,type:ba,format:io,colorSpace:Ws,depthBuffer:!1},mt=qy(_e,at,pt);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==_e||this._pingPongRenderTarget.height!==at){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=qy(_e,at,pt);const{_lodMax:vt}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=function(Ct){const Tt=[],Bt=[],Lt=[];let Ut=Ct;const Qt=Ct-4+1+Hy.length;for(let Ht=0;Ht<Qt;Ht++){const Wt=Math.pow(2,Ut);Bt.push(Wt);let qt=1/Wt;Ht>Ct-4?qt=Hy[Ht-Ct+4-1]:Ht===0&&(qt=0),Lt.push(qt);const Jt=1/(Wt-2),Xt=-Jt,sr=1+Jt,Zt=[Xt,Xt,sr,Xt,sr,sr,Xt,Xt,sr,sr,Xt,sr],er=6,xr=6,Ar=3,yr=2,Tr=1,Hr=new Float32Array(Ar*xr*er),Nr=new Float32Array(yr*xr*er),zr=new Float32Array(Tr*xr*er);for(let Vr=0;Vr<er;Vr++){const gn=Vr%3*2/3-1,pn=Vr>2?0:-1,Mn=[gn,pn,0,gn+2/3,pn,0,gn+2/3,pn+1,0,gn,pn,0,gn+2/3,pn+1,0,gn,pn+1,0];Hr.set(Mn,Ar*xr*Vr),Nr.set(Zt,yr*xr*Vr);const Dn=[Vr,Vr,Vr,Vr,Vr,Vr];zr.set(Dn,Tr*xr*Vr)}const Gr=new _s;Gr.setAttribute("position",new mr(Hr,Ar)),Gr.setAttribute("uv",new mr(Nr,yr)),Gr.setAttribute("faceIndex",new mr(zr,Tr)),Tt.push(Gr),Ut>4&&Ut--}return{lodPlanes:Tt,sizeLods:Bt,sigmas:Lt}}(vt)),this._blurMaterial=function(Ct,Tt,Bt){const Lt=new Float32Array(20),Ut=new Er(0,1,0);return new Fl({name:"SphericalGaussianBlur",defines:{n:20,CUBEUV_TEXEL_WIDTH:1/Tt,CUBEUV_TEXEL_HEIGHT:1/Bt,CUBEUV_MAX_MIP:`${Ct}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:Lt},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:Ut}},vertexShader:`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`,fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:wt,depthTest:!1,depthWrite:!1})}(vt,_e,at)}return mt}_compileMaterial(_e){const at=new lo(this._lodPlanes[0],_e);this._renderer.compile(at,F0)}_sceneToCubeUV(_e,at,pt,mt){const vt=new yo(90,1,at,pt),Ct=[1,-1,1,1,1,1],Tt=[1,1,1,-1,-1,-1],Bt=this._renderer,Lt=Bt.autoClear,Ut=Bt.toneMapping;Bt.getClearColor(Qy),Bt.toneMapping=ar,Bt.autoClear=!1;const Qt=new Zl({name:"PMREM.Background",side:bt,depthWrite:!1,depthTest:!1}),Ht=new lo(new $u,Qt);let Wt=!1;const qt=_e.background;qt?qt.isColor&&(Qt.color.copy(qt),_e.background=null,Wt=!0):(Qt.color.copy(Qy),Wt=!0);for(let Jt=0;Jt<6;Jt++){const Xt=Jt%3;Xt===0?(vt.up.set(0,Ct[Jt],0),vt.lookAt(Tt[Jt],0,0)):Xt===1?(vt.up.set(0,0,Ct[Jt]),vt.lookAt(0,Tt[Jt],0)):(vt.up.set(0,Ct[Jt],0),vt.lookAt(0,0,Tt[Jt]));const sr=this._cubeSize;Ev(mt,Xt*sr,Jt>2?sr:0,sr,sr),Bt.setRenderTarget(mt),Wt&&Bt.render(Ht,vt),Bt.render(_e,vt)}Ht.geometry.dispose(),Ht.material.dispose(),Bt.toneMapping=Ut,Bt.autoClear=Lt,_e.background=qt}_textureToCubeUV(_e,at){const pt=this._renderer,mt=_e.mapping===en||_e.mapping===rn;mt?(this._cubemapMaterial===null&&(this._cubemapMaterial=Xy()),this._cubemapMaterial.uniforms.flipEnvMap.value=_e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=$y());const vt=mt?this._cubemapMaterial:this._equirectMaterial,Ct=new lo(this._lodPlanes[0],vt);vt.uniforms.envMap.value=_e;const Tt=this._cubeSize;Ev(at,0,0,3*Tt,2*Tt),pt.setRenderTarget(at),pt.render(Ct,F0)}_applyPMREM(_e){const at=this._renderer,pt=at.autoClear;at.autoClear=!1;for(let mt=1;mt<this._lodPlanes.length;mt++){const vt=Math.sqrt(this._sigmas[mt]*this._sigmas[mt]-this._sigmas[mt-1]*this._sigmas[mt-1]),Ct=Wy[(mt-1)%Wy.length];this._blur(_e,mt-1,mt,vt,Ct)}at.autoClear=pt}_blur(_e,at,pt,mt,vt){const Ct=this._pingPongRenderTarget;this._halfBlur(_e,Ct,at,pt,mt,"latitudinal",vt),this._halfBlur(Ct,_e,pt,pt,mt,"longitudinal",vt)}_halfBlur(_e,at,pt,mt,vt,Ct,Tt){const Bt=this._renderer,Lt=this._blurMaterial;Ct!=="latitudinal"&&Ct!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const Ut=new lo(this._lodPlanes[mt],Lt),Qt=Lt.uniforms,Ht=this._sizeLods[pt]-1,Wt=isFinite(vt)?Math.PI/(2*Ht):2*Math.PI/39,qt=vt/Wt,Jt=isFinite(vt)?1+Math.floor(3*qt):20;Jt>20&&console.warn(`sigmaRadians, ${vt}, is too large and will clip, as it requested ${Jt} samples when the maximum is set to 20`);const Xt=[];let sr=0;for(let xr=0;xr<20;++xr){const Ar=xr/qt,yr=Math.exp(-Ar*Ar/2);Xt.push(yr),xr===0?sr+=yr:xr<Jt&&(sr+=2*yr)}for(let xr=0;xr<Xt.length;xr++)Xt[xr]=Xt[xr]/sr;Qt.envMap.value=_e.texture,Qt.samples.value=Jt,Qt.weights.value=Xt,Qt.latitudinal.value=Ct==="latitudinal",Tt&&(Qt.poleAxis.value=Tt);const{_lodMax:Zt}=this;Qt.dTheta.value=Wt,Qt.mipInt.value=Zt-pt;const er=this._sizeLods[mt];Ev(at,3*er*(mt>Zt-4?mt-Zt+4:0),4*(this._cubeSize-er),3*er,2*er),Bt.setRenderTarget(at),Bt.render(Ut,F0)}}function qy(Et,_e,at){const pt=new Ao(Et,_e,at);return pt.texture.mapping=Tn,pt.texture.name="PMREM.cubeUv",pt.scissorTest=!0,pt}function Ev(Et,_e,at,pt,mt){Et.viewport.set(_e,at,pt,mt),Et.scissor.set(_e,at,pt,mt)}function $y(){return new Fl({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`,fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:wt,depthTest:!1,depthWrite:!1})}function Xy(){return new Fl({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`,fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:wt,depthTest:!1,depthWrite:!1})}function Rw(Et){let _e=new WeakMap,at=null;function pt(mt){const vt=mt.target;vt.removeEventListener("dispose",pt);const Ct=_e.get(vt);Ct!==void 0&&(_e.delete(vt),Ct.dispose())}return{get:function(mt){if(mt&&mt.isTexture){const vt=mt.mapping,Ct=vt===mn||vt===bn,Tt=vt===en||vt===rn;if(Ct||Tt){if(mt.isRenderTargetTexture&&mt.needsPMREMUpdate===!0){mt.needsPMREMUpdate=!1;let Bt=_e.get(mt);return at===null&&(at=new j0(Et)),Bt=Ct?at.fromEquirectangular(mt,Bt):at.fromCubemap(mt,Bt),_e.set(mt,Bt),Bt.texture}if(_e.has(mt))return _e.get(mt).texture;{const Bt=mt.image;if(Ct&&Bt&&Bt.height>0||Tt&&Bt&&function(Lt){let Ut=0;for(let Qt=0;Qt<6;Qt++)Lt[Qt]!==void 0&&Ut++;return Ut===6}(Bt)){at===null&&(at=new j0(Et));const Lt=Ct?at.fromEquirectangular(mt):at.fromCubemap(mt);return _e.set(mt,Lt),mt.addEventListener("dispose",pt),Lt.texture}return null}}}return mt},dispose:function(){_e=new WeakMap,at!==null&&(at.dispose(),at=null)}}}function kw(Et){const _e={};function at(pt){if(_e[pt]!==void 0)return _e[pt];let mt;switch(pt){case"WEBGL_depth_texture":mt=Et.getExtension("WEBGL_depth_texture")||Et.getExtension("MOZ_WEBGL_depth_texture")||Et.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":mt=Et.getExtension("EXT_texture_filter_anisotropic")||Et.getExtension("MOZ_EXT_texture_filter_anisotropic")||Et.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":mt=Et.getExtension("WEBGL_compressed_texture_s3tc")||Et.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||Et.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":mt=Et.getExtension("WEBGL_compressed_texture_pvrtc")||Et.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:mt=Et.getExtension(pt)}return _e[pt]=mt,mt}return{has:function(pt){return at(pt)!==null},init:function(pt){pt.isWebGL2?at("EXT_color_buffer_float"):(at("WEBGL_depth_texture"),at("OES_texture_float"),at("OES_texture_half_float"),at("OES_texture_half_float_linear"),at("OES_standard_derivatives"),at("OES_element_index_uint"),at("OES_vertex_array_object"),at("ANGLE_instanced_arrays")),at("OES_texture_float_linear"),at("EXT_color_buffer_half_float"),at("WEBGL_multisampled_render_to_texture")},get:function(pt){const mt=at(pt);return mt===null&&console.warn("THREE.WebGLRenderer: "+pt+" extension not supported."),mt}}}function Dw(Et,_e,at,pt){const mt={},vt=new WeakMap;function Ct(Bt){const Lt=Bt.target;Lt.index!==null&&_e.remove(Lt.index);for(const Qt in Lt.attributes)_e.remove(Lt.attributes[Qt]);for(const Qt in Lt.morphAttributes){const Ht=Lt.morphAttributes[Qt];for(let Wt=0,qt=Ht.length;Wt<qt;Wt++)_e.remove(Ht[Wt])}Lt.removeEventListener("dispose",Ct),delete mt[Lt.id];const Ut=vt.get(Lt);Ut&&(_e.remove(Ut),vt.delete(Lt)),pt.releaseStatesOfGeometry(Lt),Lt.isInstancedBufferGeometry===!0&&delete Lt._maxInstanceCount,at.memory.geometries--}function Tt(Bt){const Lt=[],Ut=Bt.index,Qt=Bt.attributes.position;let Ht=0;if(Ut!==null){const Jt=Ut.array;Ht=Ut.version;for(let Xt=0,sr=Jt.length;Xt<sr;Xt+=3){const Zt=Jt[Xt+0],er=Jt[Xt+1],xr=Jt[Xt+2];Lt.push(Zt,er,er,xr,xr,Zt)}}else{if(Qt===void 0)return;{const Jt=Qt.array;Ht=Qt.version;for(let Xt=0,sr=Jt.length/3-1;Xt<sr;Xt+=3){const Zt=Xt+0,er=Xt+1,xr=Xt+2;Lt.push(Zt,er,er,xr,xr,Zt)}}}const Wt=new(ev(Lt)?vo:os)(Lt,1);Wt.version=Ht;const qt=vt.get(Bt);qt&&_e.remove(qt),vt.set(Bt,Wt)}return{get:function(Bt,Lt){return mt[Lt.id]===!0||(Lt.addEventListener("dispose",Ct),mt[Lt.id]=!0,at.memory.geometries++),Lt},update:function(Bt){const Lt=Bt.attributes;for(const Qt in Lt)_e.update(Lt[Qt],Et.ARRAY_BUFFER);const Ut=Bt.morphAttributes;for(const Qt in Ut){const Ht=Ut[Qt];for(let Wt=0,qt=Ht.length;Wt<qt;Wt++)_e.update(Ht[Wt],Et.ARRAY_BUFFER)}},getWireframeAttribute:function(Bt){const Lt=vt.get(Bt);if(Lt){const Ut=Bt.index;Ut!==null&&Lt.version<Ut.version&&Tt(Bt)}else Tt(Bt);return vt.get(Bt)}}}function Bw(Et,_e,at,pt){const mt=pt.isWebGL2;let vt,Ct,Tt;this.setMode=function(Bt){vt=Bt},this.setIndex=function(Bt){Ct=Bt.type,Tt=Bt.bytesPerElement},this.render=function(Bt,Lt){Et.drawElements(vt,Lt,Ct,Bt*Tt),at.update(Lt,vt,1)},this.renderInstances=function(Bt,Lt,Ut){if(Ut===0)return;let Qt,Ht;if(mt)Qt=Et,Ht="drawElementsInstanced";else if(Qt=_e.get("ANGLE_instanced_arrays"),Ht="drawElementsInstancedANGLE",Qt===null)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");Qt[Ht](vt,Lt,Ct,Bt*Tt,Ut),at.update(Lt,vt,Ut)}}function Lw(Et){const _e={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:_e,programs:null,autoReset:!0,reset:function(){_e.calls=0,_e.triangles=0,_e.points=0,_e.lines=0},update:function(at,pt,mt){switch(_e.calls++,pt){case Et.TRIANGLES:_e.triangles+=mt*(at/3);break;case Et.LINES:_e.lines+=mt*(at/2);break;case Et.LINE_STRIP:_e.lines+=mt*(at-1);break;case Et.LINE_LOOP:_e.lines+=mt*at;break;case Et.POINTS:_e.points+=mt*at;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",pt)}}}}function Ow(Et,_e){return Et[0]-_e[0]}function Nw(Et,_e){return Math.abs(_e[1])-Math.abs(Et[1])}function Fw(Et,_e,at){const pt={},mt=new Float32Array(8),vt=new WeakMap,Ct=new Is,Tt=[];for(let Bt=0;Bt<8;Bt++)Tt[Bt]=[Bt,0];return{update:function(Bt,Lt,Ut){const Qt=Bt.morphTargetInfluences;if(_e.isWebGL2===!0){const Ht=Lt.morphAttributes.position||Lt.morphAttributes.normal||Lt.morphAttributes.color,Wt=Ht!==void 0?Ht.length:0;let qt=vt.get(Lt);if(qt===void 0||qt.count!==Wt){let sr=function(){Vr.dispose(),vt.delete(Lt),Lt.removeEventListener("dispose",sr)};qt!==void 0&&qt.texture.dispose();const Zt=Lt.morphAttributes.position!==void 0,er=Lt.morphAttributes.normal!==void 0,xr=Lt.morphAttributes.color!==void 0,Ar=Lt.morphAttributes.position||[],yr=Lt.morphAttributes.normal||[],Tr=Lt.morphAttributes.color||[];let Hr=0;Zt===!0&&(Hr=1),er===!0&&(Hr=2),xr===!0&&(Hr=3);let Nr=Lt.attributes.position.count*Hr,zr=1;Nr>_e.maxTextureSize&&(zr=Math.ceil(Nr/_e.maxTextureSize),Nr=_e.maxTextureSize);const Gr=new Float32Array(Nr*zr*4*Wt),Vr=new im(Gr,Nr,zr,Wt);Vr.type=to,Vr.needsUpdate=!0;const gn=4*Hr;for(let pn=0;pn<Wt;pn++){const Mn=Ar[pn],Dn=yr[pn],cn=Tr[pn],$r=Nr*zr*4*pn;for(let Kr=0;Kr<Mn.count;Kr++){const sn=Kr*gn;Zt===!0&&(Ct.fromBufferAttribute(Mn,Kr),Gr[$r+sn+0]=Ct.x,Gr[$r+sn+1]=Ct.y,Gr[$r+sn+2]=Ct.z,Gr[$r+sn+3]=0),er===!0&&(Ct.fromBufferAttribute(Dn,Kr),Gr[$r+sn+4]=Ct.x,Gr[$r+sn+5]=Ct.y,Gr[$r+sn+6]=Ct.z,Gr[$r+sn+7]=0),xr===!0&&(Ct.fromBufferAttribute(cn,Kr),Gr[$r+sn+8]=Ct.x,Gr[$r+sn+9]=Ct.y,Gr[$r+sn+10]=Ct.z,Gr[$r+sn+11]=cn.itemSize===4?Ct.w:1)}}qt={count:Wt,texture:Vr,size:new dn(Nr,zr)},vt.set(Lt,qt),Lt.addEventListener("dispose",sr)}let Jt=0;for(let sr=0;sr<Qt.length;sr++)Jt+=Qt[sr];const Xt=Lt.morphTargetsRelative?1:1-Jt;Ut.getUniforms().setValue(Et,"morphTargetBaseInfluence",Xt),Ut.getUniforms().setValue(Et,"morphTargetInfluences",Qt),Ut.getUniforms().setValue(Et,"morphTargetsTexture",qt.texture,at),Ut.getUniforms().setValue(Et,"morphTargetsTextureSize",qt.size)}else{const Ht=Qt===void 0?0:Qt.length;let Wt=pt[Lt.id];if(Wt===void 0||Wt.length!==Ht){Wt=[];for(let Zt=0;Zt<Ht;Zt++)Wt[Zt]=[Zt,0];pt[Lt.id]=Wt}for(let Zt=0;Zt<Ht;Zt++){const er=Wt[Zt];er[0]=Zt,er[1]=Qt[Zt]}Wt.sort(Nw);for(let Zt=0;Zt<8;Zt++)Zt<Ht&&Wt[Zt][1]?(Tt[Zt][0]=Wt[Zt][0],Tt[Zt][1]=Wt[Zt][1]):(Tt[Zt][0]=Number.MAX_SAFE_INTEGER,Tt[Zt][1]=0);Tt.sort(Ow);const qt=Lt.morphAttributes.position,Jt=Lt.morphAttributes.normal;let Xt=0;for(let Zt=0;Zt<8;Zt++){const er=Tt[Zt],xr=er[0],Ar=er[1];xr!==Number.MAX_SAFE_INTEGER&&Ar?(qt&&Lt.getAttribute("morphTarget"+Zt)!==qt[xr]&&Lt.setAttribute("morphTarget"+Zt,qt[xr]),Jt&&Lt.getAttribute("morphNormal"+Zt)!==Jt[xr]&&Lt.setAttribute("morphNormal"+Zt,Jt[xr]),mt[Zt]=Ar,Xt+=Ar):(qt&&Lt.hasAttribute("morphTarget"+Zt)===!0&&Lt.deleteAttribute("morphTarget"+Zt),Jt&&Lt.hasAttribute("morphNormal"+Zt)===!0&&Lt.deleteAttribute("morphNormal"+Zt),mt[Zt]=0)}const sr=Lt.morphTargetsRelative?1:1-Xt;Ut.getUniforms().setValue(Et,"morphTargetBaseInfluence",sr),Ut.getUniforms().setValue(Et,"morphTargetInfluences",mt)}}}}function Uw(Et,_e,at,pt){let mt=new WeakMap;function vt(Ct){const Tt=Ct.target;Tt.removeEventListener("dispose",vt),at.remove(Tt.instanceMatrix),Tt.instanceColor!==null&&at.remove(Tt.instanceColor)}return{update:function(Ct){const Tt=pt.render.frame,Bt=Ct.geometry,Lt=_e.get(Ct,Bt);if(mt.get(Lt)!==Tt&&(_e.update(Lt),mt.set(Lt,Tt)),Ct.isInstancedMesh&&(Ct.hasEventListener("dispose",vt)===!1&&Ct.addEventListener("dispose",vt),mt.get(Ct)!==Tt&&(at.update(Ct.instanceMatrix,Et.ARRAY_BUFFER),Ct.instanceColor!==null&&at.update(Ct.instanceColor,Et.ARRAY_BUFFER),mt.set(Ct,Tt))),Ct.isSkinnedMesh){const Ut=Ct.skeleton;mt.get(Ut)!==Tt&&(Ut.update(),mt.set(Ut,Tt))}return Lt},dispose:function(){mt=new WeakMap}}}const Yy=new Us,Ky=new im,Jy=new n_,Zy=new g_,ex=[],tx=[],rx=new Float32Array(16),ix=new Float32Array(9),nx=new Float32Array(4);function bm(Et,_e,at){const pt=Et[0];if(pt<=0||pt>0)return Et;const mt=_e*at;let vt=ex[mt];if(vt===void 0&&(vt=new Float32Array(mt),ex[mt]=vt),_e!==0){pt.toArray(vt,0);for(let Ct=1,Tt=0;Ct!==_e;++Ct)Tt+=at,Et[Ct].toArray(vt,Tt)}return vt}function xa(Et,_e){if(Et.length!==_e.length)return!1;for(let at=0,pt=Et.length;at<pt;at++)if(Et[at]!==_e[at])return!1;return!0}function $a(Et,_e){for(let at=0,pt=_e.length;at<pt;at++)Et[at]=_e[at]}function Sv(Et,_e){let at=tx[_e];at===void 0&&(at=new Int32Array(_e),tx[_e]=at);for(let pt=0;pt!==_e;++pt)at[pt]=Et.allocateTextureUnit();return at}function jw(Et,_e){const at=this.cache;at[0]!==_e&&(Et.uniform1f(this.addr,_e),at[0]=_e)}function Gw(Et,_e){const at=this.cache;if(_e.x!==void 0)at[0]===_e.x&&at[1]===_e.y||(Et.uniform2f(this.addr,_e.x,_e.y),at[0]=_e.x,at[1]=_e.y);else{if(xa(at,_e))return;Et.uniform2fv(this.addr,_e),$a(at,_e)}}function zw(Et,_e){const at=this.cache;if(_e.x!==void 0)at[0]===_e.x&&at[1]===_e.y&&at[2]===_e.z||(Et.uniform3f(this.addr,_e.x,_e.y,_e.z),at[0]=_e.x,at[1]=_e.y,at[2]=_e.z);else if(_e.r!==void 0)at[0]===_e.r&&at[1]===_e.g&&at[2]===_e.b||(Et.uniform3f(this.addr,_e.r,_e.g,_e.b),at[0]=_e.r,at[1]=_e.g,at[2]=_e.b);else{if(xa(at,_e))return;Et.uniform3fv(this.addr,_e),$a(at,_e)}}function Vw(Et,_e){const at=this.cache;if(_e.x!==void 0)at[0]===_e.x&&at[1]===_e.y&&at[2]===_e.z&&at[3]===_e.w||(Et.uniform4f(this.addr,_e.x,_e.y,_e.z,_e.w),at[0]=_e.x,at[1]=_e.y,at[2]=_e.z,at[3]=_e.w);else{if(xa(at,_e))return;Et.uniform4fv(this.addr,_e),$a(at,_e)}}function Hw(Et,_e){const at=this.cache,pt=_e.elements;if(pt===void 0){if(xa(at,_e))return;Et.uniformMatrix2fv(this.addr,!1,_e),$a(at,_e)}else{if(xa(at,pt))return;nx.set(pt),Et.uniformMatrix2fv(this.addr,!1,nx),$a(at,pt)}}function Qw(Et,_e){const at=this.cache,pt=_e.elements;if(pt===void 0){if(xa(at,_e))return;Et.uniformMatrix3fv(this.addr,!1,_e),$a(at,_e)}else{if(xa(at,pt))return;ix.set(pt),Et.uniformMatrix3fv(this.addr,!1,ix),$a(at,pt)}}function Ww(Et,_e){const at=this.cache,pt=_e.elements;if(pt===void 0){if(xa(at,_e))return;Et.uniformMatrix4fv(this.addr,!1,_e),$a(at,_e)}else{if(xa(at,pt))return;rx.set(pt),Et.uniformMatrix4fv(this.addr,!1,rx),$a(at,pt)}}function qw(Et,_e){const at=this.cache;at[0]!==_e&&(Et.uniform1i(this.addr,_e),at[0]=_e)}function $w(Et,_e){const at=this.cache;if(_e.x!==void 0)at[0]===_e.x&&at[1]===_e.y||(Et.uniform2i(this.addr,_e.x,_e.y),at[0]=_e.x,at[1]=_e.y);else{if(xa(at,_e))return;Et.uniform2iv(this.addr,_e),$a(at,_e)}}function Xw(Et,_e){const at=this.cache;if(_e.x!==void 0)at[0]===_e.x&&at[1]===_e.y&&at[2]===_e.z||(Et.uniform3i(this.addr,_e.x,_e.y,_e.z),at[0]=_e.x,at[1]=_e.y,at[2]=_e.z);else{if(xa(at,_e))return;Et.uniform3iv(this.addr,_e),$a(at,_e)}}function Yw(Et,_e){const at=this.cache;if(_e.x!==void 0)at[0]===_e.x&&at[1]===_e.y&&at[2]===_e.z&&at[3]===_e.w||(Et.uniform4i(this.addr,_e.x,_e.y,_e.z,_e.w),at[0]=_e.x,at[1]=_e.y,at[2]=_e.z,at[3]=_e.w);else{if(xa(at,_e))return;Et.uniform4iv(this.addr,_e),$a(at,_e)}}function Kw(Et,_e){const at=this.cache;at[0]!==_e&&(Et.uniform1ui(this.addr,_e),at[0]=_e)}function Jw(Et,_e){const at=this.cache;if(_e.x!==void 0)at[0]===_e.x&&at[1]===_e.y||(Et.uniform2ui(this.addr,_e.x,_e.y),at[0]=_e.x,at[1]=_e.y);else{if(xa(at,_e))return;Et.uniform2uiv(this.addr,_e),$a(at,_e)}}function Zw(Et,_e){const at=this.cache;if(_e.x!==void 0)at[0]===_e.x&&at[1]===_e.y&&at[2]===_e.z||(Et.uniform3ui(this.addr,_e.x,_e.y,_e.z),at[0]=_e.x,at[1]=_e.y,at[2]=_e.z);else{if(xa(at,_e))return;Et.uniform3uiv(this.addr,_e),$a(at,_e)}}function e1(Et,_e){const at=this.cache;if(_e.x!==void 0)at[0]===_e.x&&at[1]===_e.y&&at[2]===_e.z&&at[3]===_e.w||(Et.uniform4ui(this.addr,_e.x,_e.y,_e.z,_e.w),at[0]=_e.x,at[1]=_e.y,at[2]=_e.z,at[3]=_e.w);else{if(xa(at,_e))return;Et.uniform4uiv(this.addr,_e),$a(at,_e)}}function t1(Et,_e,at){const pt=this.cache,mt=at.allocateTextureUnit();pt[0]!==mt&&(Et.uniform1i(this.addr,mt),pt[0]=mt),at.setTexture2D(_e||Yy,mt)}function r1(Et,_e,at){const pt=this.cache,mt=at.allocateTextureUnit();pt[0]!==mt&&(Et.uniform1i(this.addr,mt),pt[0]=mt),at.setTexture3D(_e||Jy,mt)}function i1(Et,_e,at){const pt=this.cache,mt=at.allocateTextureUnit();pt[0]!==mt&&(Et.uniform1i(this.addr,mt),pt[0]=mt),at.setTextureCube(_e||Zy,mt)}function n1(Et,_e,at){const pt=this.cache,mt=at.allocateTextureUnit();pt[0]!==mt&&(Et.uniform1i(this.addr,mt),pt[0]=mt),at.setTexture2DArray(_e||Ky,mt)}function s1(Et,_e){Et.uniform1fv(this.addr,_e)}function a1(Et,_e){const at=bm(_e,this.size,2);Et.uniform2fv(this.addr,at)}function o1(Et,_e){const at=bm(_e,this.size,3);Et.uniform3fv(this.addr,at)}function l1(Et,_e){const at=bm(_e,this.size,4);Et.uniform4fv(this.addr,at)}function c1(Et,_e){const at=bm(_e,this.size,4);Et.uniformMatrix2fv(this.addr,!1,at)}function u1(Et,_e){const at=bm(_e,this.size,9);Et.uniformMatrix3fv(this.addr,!1,at)}function p1(Et,_e){const at=bm(_e,this.size,16);Et.uniformMatrix4fv(this.addr,!1,at)}function h1(Et,_e){Et.uniform1iv(this.addr,_e)}function d1(Et,_e){Et.uniform2iv(this.addr,_e)}function m1(Et,_e){Et.uniform3iv(this.addr,_e)}function g1(Et,_e){Et.uniform4iv(this.addr,_e)}function _1(Et,_e){Et.uniform1uiv(this.addr,_e)}function f1(Et,_e){Et.uniform2uiv(this.addr,_e)}function y1(Et,_e){Et.uniform3uiv(this.addr,_e)}function b1(Et,_e){Et.uniform4uiv(this.addr,_e)}function x1(Et,_e,at){const pt=this.cache,mt=_e.length,vt=Sv(at,mt);xa(pt,vt)||(Et.uniform1iv(this.addr,vt),$a(pt,vt));for(let Ct=0;Ct!==mt;++Ct)at.setTexture2D(_e[Ct]||Yy,vt[Ct])}function A1(Et,_e,at){const pt=this.cache,mt=_e.length,vt=Sv(at,mt);xa(pt,vt)||(Et.uniform1iv(this.addr,vt),$a(pt,vt));for(let Ct=0;Ct!==mt;++Ct)at.setTexture3D(_e[Ct]||Jy,vt[Ct])}function w1(Et,_e,at){const pt=this.cache,mt=_e.length,vt=Sv(at,mt);xa(pt,vt)||(Et.uniform1iv(this.addr,vt),$a(pt,vt));for(let Ct=0;Ct!==mt;++Ct)at.setTextureCube(_e[Ct]||Zy,vt[Ct])}function E1(Et,_e,at){const pt=this.cache,mt=_e.length,vt=Sv(at,mt);xa(pt,vt)||(Et.uniform1iv(this.addr,vt),$a(pt,vt));for(let Ct=0;Ct!==mt;++Ct)at.setTexture2DArray(_e[Ct]||Ky,vt[Ct])}class S1{constructor(_e,at,pt){this.id=_e,this.addr=pt,this.cache=[],this.setValue=function(mt){switch(mt){case 5126:return jw;case 35664:return Gw;case 35665:return zw;case 35666:return Vw;case 35674:return Hw;case 35675:return Qw;case 35676:return Ww;case 5124:case 35670:return qw;case 35667:case 35671:return $w;case 35668:case 35672:return Xw;case 35669:case 35673:return Yw;case 5125:return Kw;case 36294:return Jw;case 36295:return Zw;case 36296:return e1;case 35678:case 36198:case 36298:case 36306:case 35682:return t1;case 35679:case 36299:case 36307:return r1;case 35680:case 36300:case 36308:case 36293:return i1;case 36289:case 36303:case 36311:case 36292:return n1}}(at.type)}}class C1{constructor(_e,at,pt){this.id=_e,this.addr=pt,this.cache=[],this.size=at.size,this.setValue=function(mt){switch(mt){case 5126:return s1;case 35664:return a1;case 35665:return o1;case 35666:return l1;case 35674:return c1;case 35675:return u1;case 35676:return p1;case 5124:case 35670:return h1;case 35667:case 35671:return d1;case 35668:case 35672:return m1;case 35669:case 35673:return g1;case 5125:return _1;case 36294:return f1;case 36295:return y1;case 36296:return b1;case 35678:case 36198:case 36298:case 36306:case 35682:return x1;case 35679:case 36299:case 36307:return A1;case 35680:case 36300:case 36308:case 36293:return w1;case 36289:case 36303:case 36311:case 36292:return E1}}(at.type)}}class P1{constructor(_e){this.id=_e,this.seq=[],this.map={}}setValue(_e,at,pt){const mt=this.seq;for(let vt=0,Ct=mt.length;vt!==Ct;++vt){const Tt=mt[vt];Tt.setValue(_e,at[Tt.id],pt)}}}const G0=/(\w+)(\])?(\[|\.)?/g;function sx(Et,_e){Et.seq.push(_e),Et.map[_e.id]=_e}function T1(Et,_e,at){const pt=Et.name,mt=pt.length;for(G0.lastIndex=0;;){const vt=G0.exec(pt),Ct=G0.lastIndex;let Tt=vt[1];const Bt=vt[2]==="]",Lt=vt[3];if(Bt&&(Tt|=0),Lt===void 0||Lt==="["&&Ct+2===mt){sx(at,Lt===void 0?new S1(Tt,Et,_e):new C1(Tt,Et,_e));break}{let Ut=at.map[Tt];Ut===void 0&&(Ut=new P1(Tt),sx(at,Ut)),at=Ut}}}class Cv{constructor(_e,at){this.seq=[],this.map={};const pt=_e.getProgramParameter(at,_e.ACTIVE_UNIFORMS);for(let mt=0;mt<pt;++mt){const vt=_e.getActiveUniform(at,mt);T1(vt,_e.getUniformLocation(at,vt.name),this)}}setValue(_e,at,pt,mt){const vt=this.map[at];vt!==void 0&&vt.setValue(_e,pt,mt)}setOptional(_e,at,pt){const mt=at[pt];mt!==void 0&&this.setValue(_e,pt,mt)}static upload(_e,at,pt,mt){for(let vt=0,Ct=at.length;vt!==Ct;++vt){const Tt=at[vt],Bt=pt[Tt.id];Bt.needsUpdate!==!1&&Tt.setValue(_e,Bt.value,mt)}}static seqWithValue(_e,at){const pt=[];for(let mt=0,vt=_e.length;mt!==vt;++mt){const Ct=_e[mt];Ct.id in at&&pt.push(Ct)}return pt}}function ax(Et,_e,at){const pt=Et.createShader(_e);return Et.shaderSource(pt,at),Et.compileShader(pt),pt}let M1=0;function ox(Et,_e,at){const pt=Et.getShaderParameter(_e,Et.COMPILE_STATUS),mt=Et.getShaderInfoLog(_e).trim();if(pt&&mt==="")return"";const vt=/ERROR: 0:(\d+)/.exec(mt);if(vt){const Ct=parseInt(vt[1]);return at.toUpperCase()+`

`+mt+`

`+function(Tt,Bt){const Lt=Tt.split(`
`),Ut=[],Qt=Math.max(Bt-6,0),Ht=Math.min(Bt+6,Lt.length);for(let Wt=Qt;Wt<Ht;Wt++){const qt=Wt+1;Ut.push(`${qt===Bt?">":" "} ${qt}: ${Lt[Wt]}`)}return Ut.join(`
`)}(Et.getShaderSource(_e),Ct)}return mt}function I1(Et,_e){let at;switch(_e){case Ws:at="";break;case Os:at="sRGBToLinear";break;case no:at="RGBM16ToLinear";break;default:console.warn("THREE.WebGLProgram: Unsupported color space:",_e),at=""}return`vec4 ${Et}( vec4 value ) { return ${at} ( value ); }`}function R1(Et,_e){const at=function(pt){const mt=Ms.getPrimaries(Ms.workingColorSpace),vt=pt===ks||pt===no?null:Ms.getPrimaries(pt);let Ct;switch(mt!==vt&&vt?mt===Ru&&vt===Vs?Ct="LinearDisplayP3ToLinearSRGB":mt===Vs&&vt===Ru&&(Ct="LinearSRGBToLinearDisplayP3"):Ct="",pt){case ks:return["",""];case Ws:case lu:return[Ct,"LinearTransferOETF"];case Os:case cp:return[Ct,"sRGBTransferOETF"];case no:return["","LinearToRGBM16"];default:return console.warn("THREE.WebGLProgram: Unsupported color space:",pt),[Ct,"LinearTransferOETF"]}}(_e);return`vec4 ${Et}( vec4 value ) { return ${at[0]}( ${at[1]}( value ) ); }`}function k1(Et,_e){let at;switch(_e){case vr:at="Linear";break;case Cr:at="Reinhard";break;case Ur:at="OptimizedCineon";break;case Pr:at="ACESFilmic";break;case Dr:at="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",_e),at="Linear"}return"vec3 "+Et+"( vec3 color ) { return "+at+"ToneMapping( color ); }"}function f_(Et){return Et!==""}function lx(Et,_e){const at=_e.numSpotLightShadows+_e.numSpotLightMaps-_e.numSpotLightShadowsWithMaps;return Et.replace(/NUM_DIR_LIGHTS/g,_e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,_e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,_e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,at).replace(/NUM_RECT_AREA_LIGHTS/g,_e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,_e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,_e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,_e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,_e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,_e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,_e.numPointLightShadows)}function cx(Et,_e){return Et.replace(/NUM_CLIPPING_PLANES/g,_e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,_e.numClippingPlanes-_e.numClipIntersection)}const D1=/^[ \t]*#include +<([\w\d./]+)>/gm;function z0(Et){return Et.replace(D1,L1)}const B1=new Map([["encodings_fragment","colorspace_fragment"],["encodings_pars_fragment","colorspace_pars_fragment"],["output_fragment","opaque_fragment"]]);function L1(Et,_e){let at=hs[_e];if(at===void 0){const pt=B1.get(_e);if(pt===void 0)throw new Error("Can not resolve #include <"+_e+">");at=hs[pt],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',_e,pt)}return z0(at)}const O1=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function ux(Et){return Et.replace(O1,N1)}function N1(Et,_e,at,pt){let mt="";for(let vt=parseInt(_e);vt<parseInt(at);vt++)mt+=pt.replace(/\[\s*i\s*\]/g,"[ "+vt+" ]").replace(/UNROLLED_LOOP_INDEX/g,vt);return mt}function hx(Et){let _e="precision "+Et.precision+` float;
precision `+Et.precision+" int;";return Et.precision==="highp"?_e+=`
#define HIGH_PRECISION`:Et.precision==="mediump"?_e+=`
#define MEDIUM_PRECISION`:Et.precision==="lowp"&&(_e+=`
#define LOW_PRECISION`),_e}function F1(Et,_e,at,pt){const mt=Et.getContext(),vt=at.defines;let Ct=at.vertexShader,Tt=at.fragmentShader;const Bt=function(Nr){let zr="SHADOWMAP_TYPE_BASIC";return Nr.shadowMapType===ut?zr="SHADOWMAP_TYPE_PCF":Nr.shadowMapType===ht?zr="SHADOWMAP_TYPE_PCF_SOFT":Nr.shadowMapType===_t&&(zr="SHADOWMAP_TYPE_VSM"),zr}(at),Lt=function(Nr){let zr="ENVMAP_TYPE_CUBE";if(Nr.envMap)switch(Nr.envMapMode){case en:case rn:zr="ENVMAP_TYPE_CUBE";break;case Tn:zr="ENVMAP_TYPE_CUBE_UV"}return zr}(at),Ut=function(Nr){let zr="ENVMAP_MODE_REFLECTION";return Nr.envMap&&Nr.envMapMode===rn&&(zr="ENVMAP_MODE_REFRACTION"),zr}(at),Qt=function(Nr){let zr="ENVMAP_BLENDING_NONE";if(Nr.envMap)switch(Nr.combine){case vn:zr="ENVMAP_BLENDING_MULTIPLY";break;case Gn:zr="ENVMAP_BLENDING_MIX";break;case ms:zr="ENVMAP_BLENDING_ADD"}return zr}(at),Ht=function(Nr){const zr=Nr.envMapCubeUVHeight;if(zr===null)return null;const Gr=Math.log2(zr)-2,Vr=1/zr;return{texelWidth:1/(3*Math.max(Math.pow(2,Gr),112)),texelHeight:Vr,maxMip:Gr}}(at),Wt=at.isWebGL2?"":function(Nr){return[Nr.extensionDerivatives||Nr.envMapCubeUVHeight||Nr.bumpMap||Nr.normalMapTangentSpace||Nr.clearcoatNormalMap||Nr.flatShading||Nr.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(Nr.extensionFragDepth||Nr.logarithmicDepthBuffer)&&Nr.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",Nr.extensionDrawBuffers&&Nr.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(Nr.extensionShaderTextureLOD||Nr.envMap||Nr.transmission)&&Nr.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(f_).join(`
`)}(at),qt=function(Nr){const zr=[];for(const Gr in Nr){const Vr=Nr[Gr];Vr!==!1&&zr.push("#define "+Gr+" "+Vr)}return zr.join(`
`)}(vt),Jt=mt.createProgram();let Xt,sr,Zt=at.glslVersion?"#version "+at.glslVersion+`
`:"";at.isRawShaderMaterial?(Xt=["#define SHADER_TYPE "+at.shaderType,"#define SHADER_NAME "+at.shaderName,qt].filter(f_).join(`
`),Xt.length>0&&(Xt+=`
`),sr=[Wt,"#define SHADER_TYPE "+at.shaderType,"#define SHADER_NAME "+at.shaderName,qt].filter(f_).join(`
`),sr.length>0&&(sr+=`
`)):(Xt=[hx(at),"#define SHADER_TYPE "+at.shaderType,"#define SHADER_NAME "+at.shaderName,qt,at.instancing?"#define USE_INSTANCING":"",at.instancingColor?"#define USE_INSTANCING_COLOR":"",at.useFog&&at.fog?"#define USE_FOG":"",at.useFog&&at.fogExp2?"#define FOG_EXP2":"",at.map?"#define USE_MAP":"",at.envMap?"#define USE_ENVMAP":"",at.envMap?"#define "+Ut:"",at.lightMap?"#define USE_LIGHTMAP":"",at.aoMap?"#define USE_AOMAP":"",at.bumpMap?"#define USE_BUMPMAP":"",at.normalMap?"#define USE_NORMALMAP":"",at.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",at.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",at.displacementMap?"#define USE_DISPLACEMENTMAP":"",at.emissiveMap?"#define USE_EMISSIVEMAP":"",at.anisotropy?"#define USE_ANISOTROPY":"",at.anisotropyMap?"#define USE_ANISOTROPYMAP":"",at.clearcoatMap?"#define USE_CLEARCOATMAP":"",at.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",at.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",at.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",at.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",at.specularMap?"#define USE_SPECULARMAP":"",at.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",at.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",at.roughnessMap?"#define USE_ROUGHNESSMAP":"",at.metalnessMap?"#define USE_METALNESSMAP":"",at.alphaMap?"#define USE_ALPHAMAP":"",at.alphaHash?"#define USE_ALPHAHASH":"",at.transmission?"#define USE_TRANSMISSION":"",at.transmissionMap?"#define USE_TRANSMISSIONMAP":"",at.thicknessMap?"#define USE_THICKNESSMAP":"",at.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",at.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",at.mapUv?"#define MAP_UV "+at.mapUv:"",at.alphaMapUv?"#define ALPHAMAP_UV "+at.alphaMapUv:"",at.lightMapUv?"#define LIGHTMAP_UV "+at.lightMapUv:"",at.aoMapUv?"#define AOMAP_UV "+at.aoMapUv:"",at.emissiveMapUv?"#define EMISSIVEMAP_UV "+at.emissiveMapUv:"",at.bumpMapUv?"#define BUMPMAP_UV "+at.bumpMapUv:"",at.normalMapUv?"#define NORMALMAP_UV "+at.normalMapUv:"",at.displacementMapUv?"#define DISPLACEMENTMAP_UV "+at.displacementMapUv:"",at.metalnessMapUv?"#define METALNESSMAP_UV "+at.metalnessMapUv:"",at.roughnessMapUv?"#define ROUGHNESSMAP_UV "+at.roughnessMapUv:"",at.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+at.anisotropyMapUv:"",at.clearcoatMapUv?"#define CLEARCOATMAP_UV "+at.clearcoatMapUv:"",at.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+at.clearcoatNormalMapUv:"",at.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+at.clearcoatRoughnessMapUv:"",at.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+at.iridescenceMapUv:"",at.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+at.iridescenceThicknessMapUv:"",at.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+at.sheenColorMapUv:"",at.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+at.sheenRoughnessMapUv:"",at.specularMapUv?"#define SPECULARMAP_UV "+at.specularMapUv:"",at.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+at.specularColorMapUv:"",at.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+at.specularIntensityMapUv:"",at.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+at.transmissionMapUv:"",at.thicknessMapUv?"#define THICKNESSMAP_UV "+at.thicknessMapUv:"",at.vertexTangents&&at.flatShading===!1?"#define USE_TANGENT":"",at.vertexColors?"#define USE_COLOR":"",at.vertexAlphas?"#define USE_COLOR_ALPHA":"",at.vertexUv1s?"#define USE_UV1":"",at.vertexUv2s?"#define USE_UV2":"",at.vertexUv3s?"#define USE_UV3":"",at.pointsUvs?"#define USE_POINTS_UV":"",at.flatShading?"#define FLAT_SHADED":"",at.skinning?"#define USE_SKINNING":"",at.morphTargets?"#define USE_MORPHTARGETS":"",at.morphNormals&&at.flatShading===!1?"#define USE_MORPHNORMALS":"",at.morphColors&&at.isWebGL2?"#define USE_MORPHCOLORS":"",at.morphTargetsCount>0&&at.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",at.morphTargetsCount>0&&at.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+at.morphTextureStride:"",at.morphTargetsCount>0&&at.isWebGL2?"#define MORPHTARGETS_COUNT "+at.morphTargetsCount:"",at.doubleSided?"#define DOUBLE_SIDED":"",at.flipSided?"#define FLIP_SIDED":"",at.shadowMapEnabled?"#define USE_SHADOWMAP":"",at.shadowMapEnabled?"#define "+Bt:"",at.sizeAttenuation?"#define USE_SIZEATTENUATION":"",at.numLightProbes>0?"#define USE_LIGHT_PROBES":"",at.useLegacyLights?"#define LEGACY_LIGHTS":"",at.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",at.logarithmicDepthBuffer&&at.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(f_).join(`
`),sr=[Wt,hx(at),"#define SHADER_TYPE "+at.shaderType,"#define SHADER_NAME "+at.shaderName,qt,at.instancing?"#define USE_INSTANCING":"",at.instancingColor?"#define USE_INSTANCING_COLOR":"",at.useFog&&at.fog?"#define USE_FOG":"",at.useFog&&at.fogExp2?"#define FOG_EXP2":"",at.map?"#define USE_MAP":"",at.matcap?"#define USE_MATCAP":"",at.envMap?"#define USE_ENVMAP":"",at.envMap?"#define "+Lt:"",at.envMap?"#define "+Ut:"",at.envMap?"#define "+Qt:"",Ht?"#define CUBEUV_TEXEL_WIDTH "+Ht.texelWidth:"",Ht?"#define CUBEUV_TEXEL_HEIGHT "+Ht.texelHeight:"",Ht?"#define CUBEUV_MAX_MIP "+Ht.maxMip+".0":"",at.lightMap?"#define USE_LIGHTMAP":"",at.aoMap?"#define USE_AOMAP":"",at.bumpMap?"#define USE_BUMPMAP":"",at.normalMap?"#define USE_NORMALMAP":"",at.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",at.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",at.emissiveMap?"#define USE_EMISSIVEMAP":"",at.anisotropy?"#define USE_ANISOTROPY":"",at.anisotropyMap?"#define USE_ANISOTROPYMAP":"",at.clearcoat?"#define USE_CLEARCOAT":"",at.clearcoatMap?"#define USE_CLEARCOATMAP":"",at.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",at.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",at.iridescence?"#define USE_IRIDESCENCE":"",at.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",at.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",at.specularMap?"#define USE_SPECULARMAP":"",at.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",at.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",at.roughnessMap?"#define USE_ROUGHNESSMAP":"",at.metalnessMap?"#define USE_METALNESSMAP":"",at.alphaMap?"#define USE_ALPHAMAP":"",at.alphaTest?"#define USE_ALPHATEST":"",at.alphaHash?"#define USE_ALPHAHASH":"",at.sheen?"#define USE_SHEEN":"",at.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",at.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",at.transmission?"#define USE_TRANSMISSION":"",at.transmissionMap?"#define USE_TRANSMISSIONMAP":"",at.thicknessMap?"#define USE_THICKNESSMAP":"",at.vertexTangents&&at.flatShading===!1?"#define USE_TANGENT":"",at.vertexColors||at.instancingColor?"#define USE_COLOR":"",at.vertexAlphas?"#define USE_COLOR_ALPHA":"",at.vertexUv1s?"#define USE_UV1":"",at.vertexUv2s?"#define USE_UV2":"",at.vertexUv3s?"#define USE_UV3":"",at.pointsUvs?"#define USE_POINTS_UV":"",at.gradientMap?"#define USE_GRADIENTMAP":"",at.flatShading?"#define FLAT_SHADED":"",at.doubleSided?"#define DOUBLE_SIDED":"",at.flipSided?"#define FLIP_SIDED":"",at.shadowMapEnabled?"#define USE_SHADOWMAP":"",at.shadowMapEnabled?"#define "+Bt:"",at.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",at.numLightProbes>0?"#define USE_LIGHT_PROBES":"",at.useLegacyLights?"#define LEGACY_LIGHTS":"",at.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",at.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",at.logarithmicDepthBuffer&&at.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",at.toneMapping!==ar?"#define TONE_MAPPING":"",at.toneMapping!==ar?hs.tonemapping_pars_fragment:"",at.toneMapping!==ar?k1("toneMapping",at.toneMapping):"",at.dithering?"#define DITHERING":"",at.opaque?"#define OPAQUE":"",hs.colorspace_pars_fragment,R1("linearToOutputTexel",at.outputColorSpace),at.transmissionSamplerMapEncoding?I1("transmissionSamplerMapTexelToLinear",at.transmissionSamplerMapEncoding):"",at.useDepthPacking?"#define DEPTH_PACKING "+at.depthPacking:"",`
`].filter(f_).join(`
`)),Ct=z0(Ct),Ct=lx(Ct,at),Ct=cx(Ct,at),Tt=z0(Tt),Tt=lx(Tt,at),Tt=cx(Tt,at),Ct=ux(Ct),Tt=ux(Tt),at.isWebGL2&&at.isRawShaderMaterial!==!0&&(Zt=`#version 300 es
`,Xt=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+Xt,sr=["#define varying in",at.glslVersion===Xm?"":"layout(location = 0) out highp vec4 pc_fragColor;",at.glslVersion===Xm?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad","#define WebGL2Context 1"].join(`
`)+`
`+sr);const er=Zt+Xt+Ct,xr=Zt+sr+Tt,Ar=ax(mt,mt.VERTEX_SHADER,er),yr=ax(mt,mt.FRAGMENT_SHADER,xr);if(mt.attachShader(Jt,Ar),mt.attachShader(Jt,yr),at.index0AttributeName!==void 0?mt.bindAttribLocation(Jt,0,at.index0AttributeName):at.morphTargets===!0&&mt.bindAttribLocation(Jt,0,"position"),mt.linkProgram(Jt),Et.debug.checkShaderErrors){const Nr=mt.getProgramInfoLog(Jt).trim(),zr=mt.getShaderInfoLog(Ar).trim(),Gr=mt.getShaderInfoLog(yr).trim();let Vr=!0,gn=!0;if(mt.getProgramParameter(Jt,mt.LINK_STATUS)===!1)if(Vr=!1,typeof Et.debug.onShaderError=="function")Et.debug.onShaderError(mt,Jt,Ar,yr);else{const pn=ox(mt,Ar,"vertex"),Mn=ox(mt,yr,"fragment");console.error("THREE.WebGLProgram: Shader Error "+mt.getError()+" - VALIDATE_STATUS "+mt.getProgramParameter(Jt,mt.VALIDATE_STATUS)+`

Program Info Log: `+Nr+`
`+pn+`
`+Mn)}else Nr!==""?console.warn("THREE.WebGLProgram: Program Info Log:",Nr):zr!==""&&Gr!==""||(gn=!1);gn&&(this.diagnostics={runnable:Vr,programLog:Nr,vertexShader:{log:zr,prefix:Xt},fragmentShader:{log:Gr,prefix:sr}})}let Tr,Hr;return mt.deleteShader(Ar),mt.deleteShader(yr),this.getUniforms=function(){return Tr===void 0&&(Tr=new Cv(mt,Jt)),Tr},this.getAttributes=function(){return Hr===void 0&&(Hr=function(Nr,zr){const Gr={},Vr=Nr.getProgramParameter(zr,Nr.ACTIVE_ATTRIBUTES);for(let gn=0;gn<Vr;gn++){const pn=Nr.getActiveAttrib(zr,gn),Mn=pn.name;let Dn=1;pn.type===Nr.FLOAT_MAT2&&(Dn=2),pn.type===Nr.FLOAT_MAT3&&(Dn=3),pn.type===Nr.FLOAT_MAT4&&(Dn=4),Gr[Mn]={type:pn.type,location:Nr.getAttribLocation(zr,Mn),locationSize:Dn}}return Gr}(mt,Jt)),Hr},this.destroy=function(){pt.releaseStatesOfProgram(this),mt.deleteProgram(Jt),this.program=void 0},this.type=at.shaderType,this.name=at.shaderName,this.id=M1++,this.cacheKey=_e,this.usedTimes=1,this.program=Jt,this.vertexShader=Ar,this.fragmentShader=yr,this}let U1=0;class j1{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(_e){const at=_e.vertexShader,pt=_e.fragmentShader,mt=this._getShaderStage(at),vt=this._getShaderStage(pt),Ct=this._getShaderCacheForMaterial(_e);return Ct.has(mt)===!1&&(Ct.add(mt),mt.usedTimes++),Ct.has(vt)===!1&&(Ct.add(vt),vt.usedTimes++),this}remove(_e){const at=this.materialCache.get(_e);for(const pt of at)pt.usedTimes--,pt.usedTimes===0&&this.shaderCache.delete(pt.code);return this.materialCache.delete(_e),this}getVertexShaderID(_e){return this._getShaderStage(_e.vertexShader).id}getFragmentShaderID(_e){return this._getShaderStage(_e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(_e){const at=this.materialCache;let pt=at.get(_e);return pt===void 0&&(pt=new Set,at.set(_e,pt)),pt}_getShaderStage(_e){const at=this.shaderCache;let pt=at.get(_e);return pt===void 0&&(pt=new G1(_e),at.set(_e,pt)),pt}}class G1{constructor(_e){this.id=U1++,this.code=_e,this.usedTimes=0}}function z1(Et,_e,at,pt,mt,vt,Ct){const Tt=new cm,Bt=new j1,Lt=[],Ut=mt.isWebGL2,Qt=mt.logarithmicDepthBuffer,Ht=mt.vertexTextures;let Wt=mt.precision;const qt={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function Jt(Xt){return Xt===0?"uv":`uv${Xt}`}return{getParameters:function(Xt,sr,Zt,er,xr){const Ar=er.fog,yr=xr.geometry,Tr=Xt.isMeshStandardMaterial?er.environment:null,Hr=(Xt.isMeshStandardMaterial?at:_e).get(Xt.envMap||Tr),Nr=Hr&&Hr.mapping===Tn?Hr.image.height:null,zr=qt[Xt.type];Xt.precision!==null&&(Wt=mt.getMaxPrecision(Xt.precision),Wt!==Xt.precision&&console.warn("THREE.WebGLProgram.getParameters:",Xt.precision,"not supported, using",Wt,"instead."));const Gr=yr.morphAttributes.position||yr.morphAttributes.normal||yr.morphAttributes.color,Vr=Gr!==void 0?Gr.length:0;let gn,pn,Mn,Dn,cn=0;if(yr.morphAttributes.position!==void 0&&(cn=1),yr.morphAttributes.normal!==void 0&&(cn=2),yr.morphAttributes.color!==void 0&&(cn=3),zr){const F_=Go[zr];gn=F_.vertexShader,pn=F_.fragmentShader}else gn=Xt.vertexShader,pn=Xt.fragmentShader,Bt.update(Xt),Mn=Bt.getVertexShaderID(Xt),Dn=Bt.getFragmentShaderID(Xt);const $r=Et.getRenderTarget(),Kr=Et.userData&&Et.userData.transmissionRenderTarget,sn=$r?Array.isArray($r.texture)?$r.texture[0]:$r.texture:null,nn=xr.isInstancedMesh===!0,Nn=!!Xt.map,ts=!!Xt.matcap,Xn=!!Hr,Fn=!!Xt.aoMap,ls=!!Xt.lightMap,Br=!!Xt.bumpMap,wr=!!Xt.normalMap,Fr=!!Xt.displacementMap,Qr=!!Xt.emissiveMap,Rr=!!Xt.metalnessMap,_r=!!Xt.roughnessMap,Lr=Xt.anisotropy>0,Or=Xt.clearcoat>0,qr=Xt.iridescence>0,Yr=Xt.sheen>0,An=Xt.transmission>0,hn=Lr&&!!Xt.anisotropyMap,ds=Or&&!!Xt.clearcoatMap,Zn=Or&&!!Xt.clearcoatNormalMap,Cn=Or&&!!Xt.clearcoatRoughnessMap,Jn=qr&&!!Xt.iridescenceMap,Wn=qr&&!!Xt.iridescenceThicknessMap,cs=Yr&&!!Xt.sheenColorMap,fs=Yr&&!!Xt.sheenRoughnessMap,Bs=!!Xt.specularMap,Ts=!!Xt.specularColorMap,qn=!!Xt.specularIntensityMap,As=An&&!!Xt.transmissionMap,Ko=An&&!!Xt.thicknessMap,us=!!Xt.gradientMap,Gs=!!Xt.alphaMap,ws=Xt.alphaTest>0,Au=!!Xt.alphaHash,wu=!!Xt.extensions,Zr=!!yr.attributes.uv1,g0=!!yr.attributes.uv2,_0=!!yr.attributes.uv3;let Co=ar;return Xt.toneMapped&&($r!==null&&$r.isXRRenderTarget!==!0||(Co=Et.toneMapping)),{isWebGL2:Ut,shaderID:zr,shaderType:Xt.type,shaderName:Xt.name,vertexShader:gn,fragmentShader:pn,defines:Xt.defines,customVertexShaderID:Mn,customFragmentShaderID:Dn,isRawShaderMaterial:Xt.isRawShaderMaterial===!0,glslVersion:Xt.glslVersion,precision:Wt,instancing:nn,instancingColor:nn&&xr.instanceColor!==null,supportsVertexTextures:Ht,outputColorSpace:$r===null?Et.outputColorSpace:$r.isXRRenderTarget===!0||sn.colorSpace&&sn.colorSpace!==Os?sn.colorSpace:Ws,map:Nn,matcap:ts,envMap:Xn,envMapMode:Xn&&Hr.mapping,envMapCubeUVHeight:Nr,aoMap:Fn,lightMap:ls,bumpMap:Br,normalMap:wr,displacementMap:Ht&&Fr,emissiveMap:Qr,normalMapObjectSpace:wr&&Xt.normalMapType===Iu,normalMapTangentSpace:wr&&Xt.normalMapType===yl,metalnessMap:Rr,roughnessMap:_r,anisotropy:Lr,anisotropyMap:hn,clearcoat:Or,clearcoatMap:ds,clearcoatNormalMap:Zn,clearcoatRoughnessMap:Cn,iridescence:qr,iridescenceMap:Jn,iridescenceThicknessMap:Wn,sheen:Yr,sheenColorMap:cs,sheenRoughnessMap:fs,specularMap:Bs,specularColorMap:Ts,specularIntensityMap:qn,transmission:An,transmissionMap:As,thicknessMap:Ko,transmissionSamplerMapEncoding:Kr&&Kr.texture.colorSpace||Ws,gradientMap:us,opaque:Xt.transparent===!1&&Xt.blending===Pt&&!(Xt.transmission>0),alphaMap:Gs,alphaTest:ws,alphaHash:Au,combine:Xt.combine,mapUv:Nn&&Jt(Xt.map.channel),aoMapUv:Fn&&Jt(Xt.aoMap.channel),lightMapUv:ls&&Jt(Xt.lightMap.channel),bumpMapUv:Br&&Jt(Xt.bumpMap.channel),normalMapUv:wr&&Jt(Xt.normalMap.channel),displacementMapUv:Fr&&Jt(Xt.displacementMap.channel),emissiveMapUv:Qr&&Jt(Xt.emissiveMap.channel),metalnessMapUv:Rr&&Jt(Xt.metalnessMap.channel),roughnessMapUv:_r&&Jt(Xt.roughnessMap.channel),anisotropyMapUv:hn&&Jt(Xt.anisotropyMap.channel),clearcoatMapUv:ds&&Jt(Xt.clearcoatMap.channel),clearcoatNormalMapUv:Zn&&Jt(Xt.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:Cn&&Jt(Xt.clearcoatRoughnessMap.channel),iridescenceMapUv:Jn&&Jt(Xt.iridescenceMap.channel),iridescenceThicknessMapUv:Wn&&Jt(Xt.iridescenceThicknessMap.channel),sheenColorMapUv:cs&&Jt(Xt.sheenColorMap.channel),sheenRoughnessMapUv:fs&&Jt(Xt.sheenRoughnessMap.channel),specularMapUv:Bs&&Jt(Xt.specularMap.channel),specularColorMapUv:Ts&&Jt(Xt.specularColorMap.channel),specularIntensityMapUv:qn&&Jt(Xt.specularIntensityMap.channel),transmissionMapUv:As&&Jt(Xt.transmissionMap.channel),thicknessMapUv:Ko&&Jt(Xt.thicknessMap.channel),alphaMapUv:Gs&&Jt(Xt.alphaMap.channel),vertexTangents:!!yr.attributes.tangent&&(wr||Lr||yr.userData.__forceUseTangent),vertexColors:Xt.vertexColors,vertexAlphas:Xt.vertexColors===!0&&!!yr.attributes.color&&yr.attributes.color.itemSize===4,vertexUv1s:Zr,vertexUv2s:g0,vertexUv3s:_0,pointsUvs:xr.isPoints===!0&&!!yr.attributes.uv&&(Nn||Gs),fog:!!Ar,useFog:Xt.fog===!0,fogExp2:Ar&&Ar.isFogExp2,flatShading:Xt.flatShading===!0,sizeAttenuation:Xt.sizeAttenuation===!0,logarithmicDepthBuffer:Qt,skinning:xr.isSkinnedMesh===!0,morphTargets:yr.morphAttributes.position!==void 0,morphNormals:yr.morphAttributes.normal!==void 0,morphColors:yr.morphAttributes.color!==void 0,morphTargetsCount:Vr,morphTextureStride:cn,numDirLights:sr.directional.length,numPointLights:sr.point.length,numSpotLights:sr.spot.length,numSpotLightMaps:sr.spotLightMap.length,numRectAreaLights:sr.rectArea.length,numHemiLights:sr.hemi.length,numDirLightShadows:sr.directionalShadowMap.length,numPointLightShadows:sr.pointShadowMap.length,numSpotLightShadows:sr.spotShadowMap.length,numSpotLightShadowsWithMaps:sr.numSpotLightShadowsWithMaps,numLightProbes:sr.numLightProbes,numClippingPlanes:Ct.numPlanes,numClipIntersection:Ct.numIntersection,dithering:Xt.dithering,shadowMapEnabled:Et.shadowMap.enabled&&Zt.length>0,shadowMapType:Et.shadowMap.type,toneMapping:Co,useLegacyLights:Et._useLegacyLights,decodeVideoTexture:Nn&&Xt.map.isVideoTexture===!0&&Ms.getTransfer(Xt.map.colorSpace)===Ns,premultipliedAlpha:Xt.premultipliedAlpha,doubleSided:Xt.side===xt,flipSided:Xt.side===bt,useDepthPacking:Xt.depthPacking>=0,depthPacking:Xt.depthPacking||0,index0AttributeName:Xt.index0AttributeName,extensionDerivatives:wu&&Xt.extensions.derivatives===!0,extensionFragDepth:wu&&Xt.extensions.fragDepth===!0,extensionDrawBuffers:wu&&Xt.extensions.drawBuffers===!0,extensionShaderTextureLOD:wu&&Xt.extensions.shaderTextureLOD===!0,rendererExtensionFragDepth:Ut||pt.has("EXT_frag_depth"),rendererExtensionDrawBuffers:Ut||pt.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:Ut||pt.has("EXT_shader_texture_lod"),customProgramCacheKey:Xt.customProgramCacheKey()}},getProgramCacheKey:function(Xt){const sr=[];if(Xt.shaderID?sr.push(Xt.shaderID):(sr.push(Xt.customVertexShaderID),sr.push(Xt.customFragmentShaderID)),Xt.defines!==void 0)for(const Zt in Xt.defines)sr.push(Zt),sr.push(Xt.defines[Zt]);return Xt.isRawShaderMaterial===!1&&(function(Zt,er){Zt.push(er.precision),Zt.push(er.outputColorSpace),Zt.push(er.envMapMode),Zt.push(er.envMapCubeUVHeight),Zt.push(er.mapUv),Zt.push(er.alphaMapUv),Zt.push(er.lightMapUv),Zt.push(er.aoMapUv),Zt.push(er.bumpMapUv),Zt.push(er.normalMapUv),Zt.push(er.displacementMapUv),Zt.push(er.emissiveMapUv),Zt.push(er.metalnessMapUv),Zt.push(er.roughnessMapUv),Zt.push(er.anisotropyMapUv),Zt.push(er.clearcoatMapUv),Zt.push(er.clearcoatNormalMapUv),Zt.push(er.clearcoatRoughnessMapUv),Zt.push(er.iridescenceMapUv),Zt.push(er.iridescenceThicknessMapUv),Zt.push(er.sheenColorMapUv),Zt.push(er.sheenRoughnessMapUv),Zt.push(er.specularMapUv),Zt.push(er.specularColorMapUv),Zt.push(er.specularIntensityMapUv),Zt.push(er.transmissionMapUv),Zt.push(er.thicknessMapUv),Zt.push(er.combine),Zt.push(er.fogExp2),Zt.push(er.sizeAttenuation),Zt.push(er.morphTargetsCount),Zt.push(er.morphAttributeCount),Zt.push(er.numDirLights),Zt.push(er.numPointLights),Zt.push(er.numSpotLights),Zt.push(er.numSpotLightMaps),Zt.push(er.numHemiLights),Zt.push(er.numRectAreaLights),Zt.push(er.numDirLightShadows),Zt.push(er.numPointLightShadows),Zt.push(er.numSpotLightShadows),Zt.push(er.numSpotLightShadowsWithMaps),Zt.push(er.numLightProbes),Zt.push(er.shadowMapType),Zt.push(er.toneMapping),Zt.push(er.numClippingPlanes),Zt.push(er.numClipIntersection),Zt.push(er.depthPacking)}(sr,Xt),function(Zt,er){Tt.disableAll(),er.isWebGL2&&Tt.enable(0),er.supportsVertexTextures&&Tt.enable(1),er.instancing&&Tt.enable(2),er.instancingColor&&Tt.enable(3),er.matcap&&Tt.enable(4),er.envMap&&Tt.enable(5),er.normalMapObjectSpace&&Tt.enable(6),er.normalMapTangentSpace&&Tt.enable(7),er.clearcoat&&Tt.enable(8),er.iridescence&&Tt.enable(9),er.alphaTest&&Tt.enable(10),er.vertexColors&&Tt.enable(11),er.vertexAlphas&&Tt.enable(12),er.vertexUv1s&&Tt.enable(13),er.vertexUv2s&&Tt.enable(14),er.vertexUv3s&&Tt.enable(15),er.vertexTangents&&Tt.enable(16),er.anisotropy&&Tt.enable(17),Zt.push(Tt.mask),Tt.disableAll(),er.fog&&Tt.enable(0),er.useFog&&Tt.enable(1),er.flatShading&&Tt.enable(2),er.logarithmicDepthBuffer&&Tt.enable(3),er.skinning&&Tt.enable(4),er.morphTargets&&Tt.enable(5),er.morphNormals&&Tt.enable(6),er.morphColors&&Tt.enable(7),er.premultipliedAlpha&&Tt.enable(8),er.shadowMapEnabled&&Tt.enable(9),er.useLegacyLights&&Tt.enable(10),er.doubleSided&&Tt.enable(11),er.flipSided&&Tt.enable(12),er.useDepthPacking&&Tt.enable(13),er.dithering&&Tt.enable(14),er.transmission&&Tt.enable(15),er.sheen&&Tt.enable(16),er.opaque&&Tt.enable(17),er.pointsUvs&&Tt.enable(18),er.decodeVideoTexture&&Tt.enable(19),Zt.push(Tt.mask)}(sr,Xt),sr.push(Et.outputColorSpace)),sr.push(Xt.customProgramCacheKey),sr.join()},getUniforms:function(Xt){const sr=qt[Xt.type];let Zt;if(sr){const er=Go[sr];Zt=jy.clone(er.uniforms)}else Zt=Xt.uniforms;return Zt},acquireProgram:function(Xt,sr){let Zt;for(let er=0,xr=Lt.length;er<xr;er++){const Ar=Lt[er];if(Ar.cacheKey===sr){Zt=Ar,++Zt.usedTimes;break}}return Zt===void 0&&(Zt=new F1(Et,sr,Xt,vt),Lt.push(Zt)),Zt},releaseProgram:function(Xt){if(--Xt.usedTimes==0){const sr=Lt.indexOf(Xt);Lt[sr]=Lt[Lt.length-1],Lt.pop(),Xt.destroy()}},releaseShaderCache:function(Xt){Bt.remove(Xt)},programs:Lt,dispose:function(){Bt.dispose()}}}function V1(){let Et=new WeakMap;return{get:function(_e){let at=Et.get(_e);return at===void 0&&(at={},Et.set(_e,at)),at},remove:function(_e){Et.delete(_e)},update:function(_e,at,pt){Et.get(_e)[at]=pt},dispose:function(){Et=new WeakMap}}}function H1(Et,_e){return Et.groupOrder!==_e.groupOrder?Et.groupOrder-_e.groupOrder:Et.renderOrder!==_e.renderOrder?Et.renderOrder-_e.renderOrder:Et.material.id!==_e.material.id?Et.material.id-_e.material.id:Et.z!==_e.z?Et.z-_e.z:Et.id-_e.id}function dx(Et,_e){return Et.groupOrder!==_e.groupOrder?Et.groupOrder-_e.groupOrder:Et.renderOrder!==_e.renderOrder?Et.renderOrder-_e.renderOrder:Et.z!==_e.z?_e.z-Et.z:Et.id-_e.id}function mx(){const Et=[];let _e=0;const at=[],pt=[],mt=[];function vt(Ct,Tt,Bt,Lt,Ut,Qt){let Ht=Et[_e];return Ht===void 0?(Ht={id:Ct.id,object:Ct,geometry:Tt,material:Bt,groupOrder:Lt,renderOrder:Ct.renderOrder,z:Ut,group:Qt},Et[_e]=Ht):(Ht.id=Ct.id,Ht.object=Ct,Ht.geometry=Tt,Ht.material=Bt,Ht.groupOrder=Lt,Ht.renderOrder=Ct.renderOrder,Ht.z=Ut,Ht.group=Qt),_e++,Ht}return{opaque:at,transmissive:pt,transparent:mt,init:function(){_e=0,at.length=0,pt.length=0,mt.length=0},push:function(Ct,Tt,Bt,Lt,Ut,Qt){const Ht=vt(Ct,Tt,Bt,Lt,Ut,Qt);Bt.transmission>0?pt.push(Ht):Bt.transparent===!0?mt.push(Ht):at.push(Ht)},unshift:function(Ct,Tt,Bt,Lt,Ut,Qt){const Ht=vt(Ct,Tt,Bt,Lt,Ut,Qt);Bt.transmission>0?pt.unshift(Ht):Bt.transparent===!0?mt.unshift(Ht):at.unshift(Ht)},finish:function(){for(let Ct=_e,Tt=Et.length;Ct<Tt;Ct++){const Bt=Et[Ct];if(Bt.id===null)break;Bt.id=null,Bt.object=null,Bt.geometry=null,Bt.material=null,Bt.group=null}},sort:function(Ct,Tt){at.length>1&&at.sort(Ct||H1),pt.length>1&&pt.sort(Tt||dx),mt.length>1&&mt.sort(Tt||dx)}}}function Q1(){let Et=new WeakMap;return{get:function(_e,at){const pt=Et.get(_e);let mt;return pt===void 0?(mt=new mx,Et.set(_e,[mt])):at>=pt.length?(mt=new mx,pt.push(mt)):mt=pt[at],mt},dispose:function(){Et=new WeakMap}}}function W1(){const Et={};return{get:function(_e){if(Et[_e.id]!==void 0)return Et[_e.id];let at;switch(_e.type){case"DirectionalLight":at={direction:new Er,color:new Un};break;case"SpotLight":at={position:new Er,direction:new Er,color:new Un,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":at={position:new Er,color:new Un,distance:0,decay:0};break;case"HemisphereLight":at={direction:new Er,skyColor:new Un,groundColor:new Un};break;case"RectAreaLight":at={color:new Un,position:new Er,halfWidth:new Er,halfHeight:new Er}}return Et[_e.id]=at,at}}}let q1=0;function $1(Et,_e){return(_e.castShadow?2:0)-(Et.castShadow?2:0)+(_e.map?1:0)-(Et.map?1:0)}function X1(Et,_e){const at=new W1,pt=function(){const Bt={};return{get:function(Lt){if(Bt[Lt.id]!==void 0)return Bt[Lt.id];let Ut;switch(Lt.type){case"DirectionalLight":case"SpotLight":Ut={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new dn};break;case"PointLight":Ut={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new dn,shadowCameraNear:1,shadowCameraFar:1e3}}return Bt[Lt.id]=Ut,Ut}}}(),mt={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let Bt=0;Bt<9;Bt++)mt.probe.push(new Er);const vt=new Er,Ct=new rs,Tt=new rs;return{setup:function(Bt,Lt){let Ut=0,Qt=0,Ht=0;for(let zr=0;zr<9;zr++)mt.probe[zr].set(0,0,0);let Wt=0,qt=0,Jt=0,Xt=0,sr=0,Zt=0,er=0,xr=0,Ar=0,yr=0,Tr=0;Bt.sort($1);const Hr=Lt===!0?Math.PI:1;for(let zr=0,Gr=Bt.length;zr<Gr;zr++){const Vr=Bt[zr],gn=Vr.color,pn=Vr.intensity,Mn=Vr.distance,Dn=Vr.shadow&&Vr.shadow.map?Vr.shadow.map.texture:null;if(Vr.isAmbientLight)Ut+=gn.r*pn*Hr,Qt+=gn.g*pn*Hr,Ht+=gn.b*pn*Hr;else if(Vr.isLightProbe){for(let cn=0;cn<9;cn++)mt.probe[cn].addScaledVector(Vr.sh.coefficients[cn],pn);Tr++}else if(Vr.isDirectionalLight){const cn=at.get(Vr);if(cn.color.copy(Vr.color).multiplyScalar(Vr.intensity*Hr),Vr.castShadow){const $r=Vr.shadow,Kr=pt.get(Vr);Kr.shadowBias=$r.bias,Kr.shadowNormalBias=$r.normalBias,Kr.shadowRadius=$r.radius,Kr.shadowMapSize=$r.mapSize,mt.directionalShadow[Wt]=Kr,mt.directionalShadowMap[Wt]=Dn,mt.directionalShadowMatrix[Wt]=Vr.shadow.matrix,Zt++}mt.directional[Wt]=cn,Wt++}else if(Vr.isSpotLight){const cn=at.get(Vr);cn.position.setFromMatrixPosition(Vr.matrixWorld),cn.color.copy(gn).multiplyScalar(pn*Hr),cn.distance=Mn,cn.coneCos=Math.cos(Vr.angle),cn.penumbraCos=Math.cos(Vr.angle*(1-Vr.penumbra)),cn.decay=Vr.decay,mt.spot[Jt]=cn;const $r=Vr.shadow;if(Vr.map&&(mt.spotLightMap[Ar]=Vr.map,Ar++,$r.updateMatrices(Vr),Vr.castShadow&&yr++),mt.spotLightMatrix[Jt]=$r.matrix,Vr.castShadow){const Kr=pt.get(Vr);Kr.shadowBias=$r.bias,Kr.shadowNormalBias=$r.normalBias,Kr.shadowRadius=$r.radius,Kr.shadowMapSize=$r.mapSize,mt.spotShadow[Jt]=Kr,mt.spotShadowMap[Jt]=Dn,xr++}Jt++}else if(Vr.isRectAreaLight){const cn=at.get(Vr);cn.color.copy(gn).multiplyScalar(pn),cn.halfWidth.set(.5*Vr.width,0,0),cn.halfHeight.set(0,.5*Vr.height,0),mt.rectArea[Xt]=cn,Xt++}else if(Vr.isPointLight){const cn=at.get(Vr);if(cn.color.copy(Vr.color).multiplyScalar(Vr.intensity*Hr),cn.distance=Vr.distance,cn.decay=Vr.decay,Vr.castShadow){const $r=Vr.shadow,Kr=pt.get(Vr);Kr.shadowBias=$r.bias,Kr.shadowNormalBias=$r.normalBias,Kr.shadowRadius=$r.radius,Kr.shadowMapSize=$r.mapSize,Kr.shadowCameraNear=$r.camera.near,Kr.shadowCameraFar=$r.camera.far,mt.pointShadow[qt]=Kr,mt.pointShadowMap[qt]=Dn,mt.pointShadowMatrix[qt]=Vr.shadow.matrix,er++}mt.point[qt]=cn,qt++}else if(Vr.isHemisphereLight){const cn=at.get(Vr);cn.skyColor.copy(Vr.color).multiplyScalar(pn*Hr),cn.groundColor.copy(Vr.groundColor).multiplyScalar(pn*Hr),mt.hemi[sr]=cn,sr++}}Xt>0&&(_e.isWebGL2||Et.has("OES_texture_float_linear")===!0?(mt.rectAreaLTC1=kn.LTC_FLOAT_1,mt.rectAreaLTC2=kn.LTC_FLOAT_2):Et.has("OES_texture_half_float_linear")===!0?(mt.rectAreaLTC1=kn.LTC_HALF_1,mt.rectAreaLTC2=kn.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),mt.ambient[0]=Ut,mt.ambient[1]=Qt,mt.ambient[2]=Ht;const Nr=mt.hash;Nr.directionalLength===Wt&&Nr.pointLength===qt&&Nr.spotLength===Jt&&Nr.rectAreaLength===Xt&&Nr.hemiLength===sr&&Nr.numDirectionalShadows===Zt&&Nr.numPointShadows===er&&Nr.numSpotShadows===xr&&Nr.numSpotMaps===Ar&&Nr.numLightProbes===Tr||(mt.directional.length=Wt,mt.spot.length=Jt,mt.rectArea.length=Xt,mt.point.length=qt,mt.hemi.length=sr,mt.directionalShadow.length=Zt,mt.directionalShadowMap.length=Zt,mt.pointShadow.length=er,mt.pointShadowMap.length=er,mt.spotShadow.length=xr,mt.spotShadowMap.length=xr,mt.directionalShadowMatrix.length=Zt,mt.pointShadowMatrix.length=er,mt.spotLightMatrix.length=xr+Ar-yr,mt.spotLightMap.length=Ar,mt.numSpotLightShadowsWithMaps=yr,mt.numLightProbes=Tr,Nr.directionalLength=Wt,Nr.pointLength=qt,Nr.spotLength=Jt,Nr.rectAreaLength=Xt,Nr.hemiLength=sr,Nr.numDirectionalShadows=Zt,Nr.numPointShadows=er,Nr.numSpotShadows=xr,Nr.numSpotMaps=Ar,Nr.numLightProbes=Tr,mt.version=q1++)},setupView:function(Bt,Lt){let Ut=0,Qt=0,Ht=0,Wt=0,qt=0;const Jt=Lt.matrixWorldInverse;for(let Xt=0,sr=Bt.length;Xt<sr;Xt++){const Zt=Bt[Xt];if(Zt.isDirectionalLight){const er=mt.directional[Ut];er.direction.setFromMatrixPosition(Zt.matrixWorld),vt.setFromMatrixPosition(Zt.target.matrixWorld),er.direction.sub(vt),er.direction.transformDirection(Jt),Ut++}else if(Zt.isSpotLight){const er=mt.spot[Ht];er.position.setFromMatrixPosition(Zt.matrixWorld),er.position.applyMatrix4(Jt),er.direction.setFromMatrixPosition(Zt.matrixWorld),vt.setFromMatrixPosition(Zt.target.matrixWorld),er.direction.sub(vt),er.direction.transformDirection(Jt),Ht++}else if(Zt.isRectAreaLight){const er=mt.rectArea[Wt];er.position.setFromMatrixPosition(Zt.matrixWorld),er.position.applyMatrix4(Jt),Tt.identity(),Ct.copy(Zt.matrixWorld),Ct.premultiply(Jt),Tt.extractRotation(Ct),er.halfWidth.set(.5*Zt.width,0,0),er.halfHeight.set(0,.5*Zt.height,0),er.halfWidth.applyMatrix4(Tt),er.halfHeight.applyMatrix4(Tt),Wt++}else if(Zt.isPointLight){const er=mt.point[Qt];er.position.setFromMatrixPosition(Zt.matrixWorld),er.position.applyMatrix4(Jt),Qt++}else if(Zt.isHemisphereLight){const er=mt.hemi[qt];er.direction.setFromMatrixPosition(Zt.matrixWorld),er.direction.transformDirection(Jt),qt++}}},state:mt}}function gx(Et,_e){const at=new X1(Et,_e),pt=[],mt=[];return{init:function(){pt.length=0,mt.length=0},state:{lightsArray:pt,shadowsArray:mt,lights:at},setupLights:function(vt){at.setup(pt,vt)},setupLightsView:function(vt){at.setupView(pt,vt)},pushLight:function(vt){pt.push(vt)},pushShadow:function(vt){mt.push(vt)}}}function Y1(Et,_e){let at=new WeakMap;return{get:function(pt,mt=0){const vt=at.get(pt);let Ct;return vt===void 0?(Ct=new gx(Et,_e),at.set(pt,[Ct])):mt>=vt.length?(Ct=new gx(Et,_e),vt.push(Ct)):Ct=vt[mt],Ct},dispose:function(){at=new WeakMap}}}class V0 extends so{constructor(_e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=lp,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(_e)}copy(_e){return super.copy(_e),this.depthPacking=_e.depthPacking,this.map=_e.map,this.alphaMap=_e.alphaMap,this.displacementMap=_e.displacementMap,this.displacementScale=_e.displacementScale,this.displacementBias=_e.displacementBias,this.wireframe=_e.wireframe,this.wireframeLinewidth=_e.wireframeLinewidth,this}}class H0 extends so{constructor(_e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(_e)}copy(_e){return super.copy(_e),this.map=_e.map,this.alphaMap=_e.alphaMap,this.displacementMap=_e.displacementMap,this.displacementScale=_e.displacementScale,this.displacementBias=_e.displacementBias,this}}function K1(Et,_e,at){let pt=new xv;const mt=new dn,vt=new dn,Ct=new Is,Tt=new V0({depthPacking:Hm}),Bt=new H0,Lt={},Ut=at.maxTextureSize,Qt={[ft]:bt,[bt]:ft,[xt]:xt},Ht=new Fl({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new dn},radius:{value:4}},vertexShader:`void main() {
	gl_Position = vec4( position, 1.0 );
}`,fragmentShader:`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`}),Wt=Ht.clone();Wt.defines.HORIZONTAL_PASS=1;const qt=new _s;qt.setAttribute("position",new mr(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const Jt=new lo(qt,Ht),Xt=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=ut;let sr=this.type;function Zt(Ar,yr){const Tr=_e.update(Jt);Ht.defines.VSM_SAMPLES!==Ar.blurSamples&&(Ht.defines.VSM_SAMPLES=Ar.blurSamples,Wt.defines.VSM_SAMPLES=Ar.blurSamples,Ht.needsUpdate=!0,Wt.needsUpdate=!0),Ar.mapPass===null&&(Ar.mapPass=new Ao(mt.x,mt.y)),Ht.uniforms.shadow_pass.value=Ar.map.texture,Ht.uniforms.resolution.value=Ar.mapSize,Ht.uniforms.radius.value=Ar.radius,Et.setRenderTarget(Ar.mapPass),Et.clear(),Et.renderBufferDirect(yr,null,Tr,Ht,Jt,null),Wt.uniforms.shadow_pass.value=Ar.mapPass.texture,Wt.uniforms.resolution.value=Ar.mapSize,Wt.uniforms.radius.value=Ar.radius,Et.setRenderTarget(Ar.map),Et.clear(),Et.renderBufferDirect(yr,null,Tr,Wt,Jt,null)}function er(Ar,yr,Tr,Hr){let Nr=null;const zr=Tr.isPointLight===!0?Ar.customDistanceMaterial:Ar.customDepthMaterial;if(zr!==void 0)Nr=zr;else if(Nr=Tr.isPointLight===!0?Bt:Tt,Et.localClippingEnabled&&yr.clipShadows===!0&&Array.isArray(yr.clippingPlanes)&&yr.clippingPlanes.length!==0||yr.displacementMap&&yr.displacementScale!==0||yr.alphaMap&&yr.alphaTest>0||yr.map&&yr.alphaTest>0){const Gr=Nr.uuid,Vr=yr.uuid;let gn=Lt[Gr];gn===void 0&&(gn={},Lt[Gr]=gn);let pn=gn[Vr];pn===void 0&&(pn=Nr.clone(),gn[Vr]=pn),Nr=pn}return Nr.visible=yr.visible,Nr.wireframe=yr.wireframe,Nr.side=Hr===_t?yr.shadowSide!==null?yr.shadowSide:yr.side:yr.shadowSide!==null?yr.shadowSide:Qt[yr.side],Nr.alphaMap=yr.alphaMap,Nr.alphaTest=yr.alphaTest,Nr.map=yr.map,Nr.clipShadows=yr.clipShadows,Nr.clippingPlanes=yr.clippingPlanes,Nr.clipIntersection=yr.clipIntersection,Nr.displacementMap=yr.displacementMap,Nr.displacementScale=yr.displacementScale,Nr.displacementBias=yr.displacementBias,Nr.wireframeLinewidth=yr.wireframeLinewidth,Nr.linewidth=yr.linewidth,Tr.isPointLight===!0&&Nr.isMeshDistanceMaterial===!0&&(Et.properties.get(Nr).light=Tr),Nr}function xr(Ar,yr,Tr,Hr,Nr){if(Ar.visible===!1)return;if(Ar.layers.test(yr.layers)&&(Ar.isMesh||Ar.isLine||Ar.isPoints)&&(Ar.castShadow||Ar.receiveShadow&&Nr===_t)&&(!Ar.frustumCulled||pt.intersectsObject(Ar))){Ar.modelViewMatrix.multiplyMatrices(Tr.matrixWorldInverse,Ar.matrixWorld);const Gr=_e.update(Ar),Vr=Ar.material;if(Array.isArray(Vr)){const gn=Gr.groups;for(let pn=0,Mn=gn.length;pn<Mn;pn++){const Dn=gn[pn],cn=Vr[Dn.materialIndex];if(cn&&cn.visible){const $r=er(Ar,cn,Hr,Nr);Et.renderBufferDirect(Tr,null,Gr,$r,Ar,Dn)}}}else if(Vr.visible){const gn=er(Ar,Vr,Hr,Nr);Et.renderBufferDirect(Tr,null,Gr,gn,Ar,null)}}const zr=Ar.children;for(let Gr=0,Vr=zr.length;Gr<Vr;Gr++)xr(zr[Gr],yr,Tr,Hr,Nr)}this.render=function(Ar,yr,Tr){if(Xt.enabled===!1||Xt.autoUpdate===!1&&Xt.needsUpdate===!1||Ar.length===0)return;const Hr=Et.getRenderTarget(),Nr=Et.getActiveCubeFace(),zr=Et.getActiveMipmapLevel(),Gr=Et.state;Gr.setBlending(wt),Gr.buffers.color.setClear(1,1,1,1),Gr.buffers.depth.setTest(!0),Gr.setScissorTest(!1);const Vr=sr!==_t&&this.type===_t,gn=sr===_t&&this.type!==_t;for(let pn=0,Mn=Ar.length;pn<Mn;pn++){const Dn=Ar[pn],cn=Dn.shadow;if(cn===void 0){console.warn("THREE.WebGLShadowMap:",Dn,"has no shadow.");continue}if(cn.autoUpdate===!1&&cn.needsUpdate===!1)continue;mt.copy(cn.mapSize);const $r=cn.getFrameExtents();if(mt.multiply($r),vt.copy(cn.mapSize),(mt.x>Ut||mt.y>Ut)&&(mt.x>Ut&&(vt.x=Math.floor(Ut/$r.x),mt.x=vt.x*$r.x,cn.mapSize.x=vt.x),mt.y>Ut&&(vt.y=Math.floor(Ut/$r.y),mt.y=vt.y*$r.y,cn.mapSize.y=vt.y)),cn.map===null||Vr===!0||gn===!0){const sn=this.type!==_t?{minFilter:tn,magFilter:tn}:{};cn.map!==null&&cn.map.dispose(),cn.map=new Ao(mt.x,mt.y,sn),cn.map.texture.name=Dn.name+".shadowMap",cn.camera.updateProjectionMatrix()}Et.setRenderTarget(cn.map),Et.clear();const Kr=cn.getViewportCount();for(let sn=0;sn<Kr;sn++){const nn=cn.getViewport(sn);Ct.set(vt.x*nn.x,vt.y*nn.y,vt.x*nn.z,vt.y*nn.w),Gr.viewport(Ct),cn.updateMatrices(Dn,sn),pt=cn.getFrustum(),xr(yr,Tr,cn.camera,Dn,this.type)}cn.isPointLightShadow!==!0&&this.type===_t&&Zt(cn,Tr),cn.needsUpdate=!1}sr=this.type,Xt.needsUpdate=!1,Et.setRenderTarget(Hr,Nr,zr)}}function J1(Et,_e,at){const pt=at.isWebGL2,mt=new function(){let _r=!1;const Lr=new Is;let Or=null;const qr=new Is(0,0,0,0);return{setMask:function(Yr){Or===Yr||_r||(Et.colorMask(Yr,Yr,Yr,Yr),Or=Yr)},setLocked:function(Yr){_r=Yr},setClear:function(Yr,An,hn,ds,Zn){Zn===!0&&(Yr*=ds,An*=ds,hn*=ds),Lr.set(Yr,An,hn,ds),qr.equals(Lr)===!1&&(Et.clearColor(Yr,An,hn,ds),qr.copy(Lr))},reset:function(){_r=!1,Or=null,qr.set(-1,0,0,0)}}},vt=new function(){let _r=!1,Lr=null,Or=null,qr=null;return{setTest:function(Yr){Yr?Xn(Et.DEPTH_TEST):Fn(Et.DEPTH_TEST)},setMask:function(Yr){Lr===Yr||_r||(Et.depthMask(Yr),Lr=Yr)},setFunc:function(Yr){if(Or!==Yr){switch(Yr){case gr:Et.depthFunc(Et.NEVER);break;case tr:Et.depthFunc(Et.ALWAYS);break;case dr:Et.depthFunc(Et.LESS);break;case Ir:Et.depthFunc(Et.LEQUAL);break;case Xr:Et.depthFunc(Et.EQUAL);break;case Jr:Et.depthFunc(Et.GEQUAL);break;case on:Et.depthFunc(Et.GREATER);break;case Pn:Et.depthFunc(Et.NOTEQUAL);break;default:Et.depthFunc(Et.LEQUAL)}Or=Yr}},setLocked:function(Yr){_r=Yr},setClear:function(Yr){qr!==Yr&&(Et.clearDepth(Yr),qr=Yr)},reset:function(){_r=!1,Lr=null,Or=null,qr=null}}},Ct=new function(){let _r=!1,Lr=null,Or=null,qr=null,Yr=null,An=null,hn=null,ds=null,Zn=null;return{setTest:function(Cn){_r||(Cn?Xn(Et.STENCIL_TEST):Fn(Et.STENCIL_TEST))},setMask:function(Cn){Lr===Cn||_r||(Et.stencilMask(Cn),Lr=Cn)},setFunc:function(Cn,Jn,Wn){Or===Cn&&qr===Jn&&Yr===Wn||(Et.stencilFunc(Cn,Jn,Wn),Or=Cn,qr=Jn,Yr=Wn)},setOp:function(Cn,Jn,Wn){An===Cn&&hn===Jn&&ds===Wn||(Et.stencilOp(Cn,Jn,Wn),An=Cn,hn=Jn,ds=Wn)},setLocked:function(Cn){_r=Cn},setClear:function(Cn){Zn!==Cn&&(Et.clearStencil(Cn),Zn=Cn)},reset:function(){_r=!1,Lr=null,Or=null,qr=null,Yr=null,An=null,hn=null,ds=null,Zn=null}}},Tt=new WeakMap,Bt=new WeakMap;let Lt={},Ut={},Qt=new WeakMap,Ht=[],Wt=null,qt=!1,Jt=null,Xt=null,sr=null,Zt=null,er=null,xr=null,Ar=null,yr=!1,Tr=null,Hr=null,Nr=null,zr=null,Gr=null;const Vr=Et.getParameter(Et.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let gn=!1,pn=0;const Mn=Et.getParameter(Et.VERSION);Mn.indexOf("WebGL")!==-1?(pn=parseFloat(/^WebGL (\d)/.exec(Mn)[1]),gn=pn>=1):Mn.indexOf("OpenGL ES")!==-1&&(pn=parseFloat(/^OpenGL ES (\d)/.exec(Mn)[1]),gn=pn>=2);let Dn=null,cn={};const $r=Et.getParameter(Et.SCISSOR_BOX),Kr=Et.getParameter(Et.VIEWPORT),sn=new Is().fromArray($r),nn=new Is().fromArray(Kr);function Nn(_r,Lr,Or,qr){const Yr=new Uint8Array(4),An=Et.createTexture();Et.bindTexture(_r,An),Et.texParameteri(_r,Et.TEXTURE_MIN_FILTER,Et.NEAREST),Et.texParameteri(_r,Et.TEXTURE_MAG_FILTER,Et.NEAREST);for(let hn=0;hn<Or;hn++)!pt||_r!==Et.TEXTURE_3D&&_r!==Et.TEXTURE_2D_ARRAY?Et.texImage2D(Lr+hn,0,Et.RGBA,1,1,0,Et.RGBA,Et.UNSIGNED_BYTE,Yr):Et.texImage3D(Lr,0,Et.RGBA,1,1,qr,0,Et.RGBA,Et.UNSIGNED_BYTE,Yr);return An}const ts={};function Xn(_r){Lt[_r]!==!0&&(Et.enable(_r),Lt[_r]=!0)}function Fn(_r){Lt[_r]!==!1&&(Et.disable(_r),Lt[_r]=!1)}ts[Et.TEXTURE_2D]=Nn(Et.TEXTURE_2D,Et.TEXTURE_2D,1),ts[Et.TEXTURE_CUBE_MAP]=Nn(Et.TEXTURE_CUBE_MAP,Et.TEXTURE_CUBE_MAP_POSITIVE_X,6),pt&&(ts[Et.TEXTURE_2D_ARRAY]=Nn(Et.TEXTURE_2D_ARRAY,Et.TEXTURE_2D_ARRAY,1,1),ts[Et.TEXTURE_3D]=Nn(Et.TEXTURE_3D,Et.TEXTURE_3D,1,1)),mt.setClear(0,0,0,1),vt.setClear(1),Ct.setClear(0),Xn(Et.DEPTH_TEST),vt.setFunc(Ir),Fr(!1),Qr(tt),Xn(Et.CULL_FACE),wr(wt);const ls={[It]:Et.FUNC_ADD,[Nt]:Et.FUNC_SUBTRACT,[Vt]:Et.FUNC_REVERSE_SUBTRACT};if(pt)ls[Kt]=Et.MIN,ls[Yt]=Et.MAX;else{const _r=_e.get("EXT_blend_minmax");_r!==null&&(ls[Kt]=_r.MIN_EXT,ls[Yt]=_r.MAX_EXT)}const Br={[nr]:Et.ZERO,[rr]:Et.ONE,[lr]:Et.SRC_COLOR,[pr]:Et.SRC_ALPHA,[kr]:Et.SRC_ALPHA_SATURATE,[br]:Et.DST_COLOR,[ur]:Et.DST_ALPHA,[or]:Et.ONE_MINUS_SRC_COLOR,[hr]:Et.ONE_MINUS_SRC_ALPHA,[fr]:Et.ONE_MINUS_DST_COLOR,[cr]:Et.ONE_MINUS_DST_ALPHA};function wr(_r,Lr,Or,qr,Yr,An,hn,ds){if(_r!==wt){if(qt===!1&&(Xn(Et.BLEND),qt=!0),_r===Dt)Yr=Yr||Lr,An=An||Or,hn=hn||qr,Lr===Xt&&Yr===er||(Et.blendEquationSeparate(ls[Lr],ls[Yr]),Xt=Lr,er=Yr),Or===sr&&qr===Zt&&An===xr&&hn===Ar||(Et.blendFuncSeparate(Br[Or],Br[qr],Br[An],Br[hn]),sr=Or,Zt=qr,xr=An,Ar=hn),Jt=_r,yr=!1;else if(_r!==Jt||ds!==yr){if(Xt===It&&er===It||(Et.blendEquation(Et.FUNC_ADD),Xt=It,er=It),ds)switch(_r){case Pt:Et.blendFuncSeparate(Et.ONE,Et.ONE_MINUS_SRC_ALPHA,Et.ONE,Et.ONE_MINUS_SRC_ALPHA);break;case Rt:Et.blendFunc(Et.ONE,Et.ONE);break;case kt:Et.blendFuncSeparate(Et.ZERO,Et.ONE_MINUS_SRC_COLOR,Et.ZERO,Et.ONE);break;case Gt:Et.blendFuncSeparate(Et.ZERO,Et.SRC_COLOR,Et.ZERO,Et.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",_r)}else switch(_r){case Pt:Et.blendFuncSeparate(Et.SRC_ALPHA,Et.ONE_MINUS_SRC_ALPHA,Et.ONE,Et.ONE_MINUS_SRC_ALPHA);break;case Rt:Et.blendFunc(Et.SRC_ALPHA,Et.ONE);break;case kt:Et.blendFuncSeparate(Et.ZERO,Et.ONE_MINUS_SRC_COLOR,Et.ZERO,Et.ONE);break;case Gt:Et.blendFunc(Et.ZERO,Et.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",_r)}sr=null,Zt=null,xr=null,Ar=null,Jt=_r,yr=ds}}else qt===!0&&(Fn(Et.BLEND),qt=!1)}function Fr(_r){Tr!==_r&&(_r?Et.frontFace(Et.CW):Et.frontFace(Et.CCW),Tr=_r)}function Qr(_r){_r!==b?(Xn(Et.CULL_FACE),_r!==Hr&&(_r===tt?Et.cullFace(Et.BACK):_r===it?Et.cullFace(Et.FRONT):Et.cullFace(Et.FRONT_AND_BACK))):Fn(Et.CULL_FACE),Hr=_r}function Rr(_r,Lr,Or){_r?(Xn(Et.POLYGON_OFFSET_FILL),zr===Lr&&Gr===Or||(Et.polygonOffset(Lr,Or),zr=Lr,Gr=Or)):Fn(Et.POLYGON_OFFSET_FILL)}return{buffers:{color:mt,depth:vt,stencil:Ct},enable:Xn,disable:Fn,bindFramebuffer:function(_r,Lr){return Ut[_r]!==Lr&&(Et.bindFramebuffer(_r,Lr),Ut[_r]=Lr,pt&&(_r===Et.DRAW_FRAMEBUFFER&&(Ut[Et.FRAMEBUFFER]=Lr),_r===Et.FRAMEBUFFER&&(Ut[Et.DRAW_FRAMEBUFFER]=Lr)),!0)},drawBuffers:function(_r,Lr){let Or=Ht,qr=!1;if(_r)if(Or=Qt.get(Lr),Or===void 0&&(Or=[],Qt.set(Lr,Or)),_r.isWebGLMultipleRenderTargets){const Yr=_r.texture;if(Or.length!==Yr.length||Or[0]!==Et.COLOR_ATTACHMENT0){for(let An=0,hn=Yr.length;An<hn;An++)Or[An]=Et.COLOR_ATTACHMENT0+An;Or.length=Yr.length,qr=!0}}else Or[0]!==Et.COLOR_ATTACHMENT0&&(Or[0]=Et.COLOR_ATTACHMENT0,qr=!0);else Or[0]!==Et.BACK&&(Or[0]=Et.BACK,qr=!0);qr&&(at.isWebGL2?Et.drawBuffers(Or):_e.get("WEBGL_draw_buffers").drawBuffersWEBGL(Or))},useProgram:function(_r){return Wt!==_r&&(Et.useProgram(_r),Wt=_r,!0)},setBlending:wr,setMaterial:function(_r,Lr){_r.side===xt?Fn(Et.CULL_FACE):Xn(Et.CULL_FACE);let Or=_r.side===bt;Lr&&(Or=!Or),Fr(Or),_r.blending===Pt&&_r.transparent===!1?wr(wt):wr(_r.blending,_r.blendEquation,_r.blendSrc,_r.blendDst,_r.blendEquationAlpha,_r.blendSrcAlpha,_r.blendDstAlpha,_r.premultipliedAlpha),vt.setFunc(_r.depthFunc),vt.setTest(_r.depthTest),vt.setMask(_r.depthWrite),mt.setMask(_r.colorWrite);const qr=_r.stencilWrite;Ct.setTest(qr),qr&&(Ct.setMask(_r.stencilWriteMask),Ct.setFunc(_r.stencilFunc,_r.stencilRef,_r.stencilFuncMask),Ct.setOp(_r.stencilFail,_r.stencilZFail,_r.stencilZPass)),Rr(_r.polygonOffset,_r.polygonOffsetFactor,_r.polygonOffsetUnits),_r.alphaToCoverage===!0?Xn(Et.SAMPLE_ALPHA_TO_COVERAGE):Fn(Et.SAMPLE_ALPHA_TO_COVERAGE)},setFlipSided:Fr,setCullFace:Qr,setLineWidth:function(_r){_r!==Nr&&(gn&&Et.lineWidth(_r),Nr=_r)},setPolygonOffset:Rr,setScissorTest:function(_r){_r?Xn(Et.SCISSOR_TEST):Fn(Et.SCISSOR_TEST)},activeTexture:function(_r){_r===void 0&&(_r=Et.TEXTURE0+Vr-1),Dn!==_r&&(Et.activeTexture(_r),Dn=_r)},bindTexture:function(_r,Lr,Or){Or===void 0&&(Or=Dn===null?Et.TEXTURE0+Vr-1:Dn);let qr=cn[Or];qr===void 0&&(qr={type:void 0,texture:void 0},cn[Or]=qr),qr.type===_r&&qr.texture===Lr||(Dn!==Or&&(Et.activeTexture(Or),Dn=Or),Et.bindTexture(_r,Lr||ts[_r]),qr.type=_r,qr.texture=Lr)},unbindTexture:function(){const _r=cn[Dn];_r!==void 0&&_r.type!==void 0&&(Et.bindTexture(_r.type,null),_r.type=void 0,_r.texture=void 0)},compressedTexImage2D:function(){try{Et.compressedTexImage2D.apply(Et,arguments)}catch(_r){console.error("THREE.WebGLState:",_r)}},compressedTexImage3D:function(){try{Et.compressedTexImage3D.apply(Et,arguments)}catch(_r){console.error("THREE.WebGLState:",_r)}},texImage2D:function(){try{Et.texImage2D.apply(Et,arguments)}catch(_r){console.error("THREE.WebGLState:",_r)}},texImage3D:function(){try{Et.texImage3D.apply(Et,arguments)}catch(_r){console.error("THREE.WebGLState:",_r)}},updateUBOMapping:function(_r,Lr){let Or=Bt.get(Lr);Or===void 0&&(Or=new WeakMap,Bt.set(Lr,Or));let qr=Or.get(_r);qr===void 0&&(qr=Et.getUniformBlockIndex(Lr,_r.name),Or.set(_r,qr))},uniformBlockBinding:function(_r,Lr){const Or=Bt.get(Lr).get(_r);Tt.get(Lr)!==Or&&(Et.uniformBlockBinding(Lr,Or,_r.__bindingPointIndex),Tt.set(Lr,Or))},texStorage2D:function(){try{Et.texStorage2D.apply(Et,arguments)}catch(_r){console.error("THREE.WebGLState:",_r)}},texStorage3D:function(){try{Et.texStorage3D.apply(Et,arguments)}catch(_r){console.error("THREE.WebGLState:",_r)}},texSubImage2D:function(){try{Et.texSubImage2D.apply(Et,arguments)}catch(_r){console.error("THREE.WebGLState:",_r)}},texSubImage3D:function(){try{Et.texSubImage3D.apply(Et,arguments)}catch(_r){console.error("THREE.WebGLState:",_r)}},compressedTexSubImage2D:function(){try{Et.compressedTexSubImage2D.apply(Et,arguments)}catch(_r){console.error("THREE.WebGLState:",_r)}},compressedTexSubImage3D:function(){try{Et.compressedTexSubImage3D.apply(Et,arguments)}catch(_r){console.error("THREE.WebGLState:",_r)}},scissor:function(_r){sn.equals(_r)===!1&&(Et.scissor(_r.x,_r.y,_r.z,_r.w),sn.copy(_r))},viewport:function(_r){nn.equals(_r)===!1&&(Et.viewport(_r.x,_r.y,_r.z,_r.w),nn.copy(_r))},reset:function(){Et.disable(Et.BLEND),Et.disable(Et.CULL_FACE),Et.disable(Et.DEPTH_TEST),Et.disable(Et.POLYGON_OFFSET_FILL),Et.disable(Et.SCISSOR_TEST),Et.disable(Et.STENCIL_TEST),Et.disable(Et.SAMPLE_ALPHA_TO_COVERAGE),Et.blendEquation(Et.FUNC_ADD),Et.blendFunc(Et.ONE,Et.ZERO),Et.blendFuncSeparate(Et.ONE,Et.ZERO,Et.ONE,Et.ZERO),Et.colorMask(!0,!0,!0,!0),Et.clearColor(0,0,0,0),Et.depthMask(!0),Et.depthFunc(Et.LESS),Et.clearDepth(1),Et.stencilMask(4294967295),Et.stencilFunc(Et.ALWAYS,0,4294967295),Et.stencilOp(Et.KEEP,Et.KEEP,Et.KEEP),Et.clearStencil(0),Et.cullFace(Et.BACK),Et.frontFace(Et.CCW),Et.polygonOffset(0,0),Et.activeTexture(Et.TEXTURE0),Et.bindFramebuffer(Et.FRAMEBUFFER,null),pt===!0&&(Et.bindFramebuffer(Et.DRAW_FRAMEBUFFER,null),Et.bindFramebuffer(Et.READ_FRAMEBUFFER,null)),Et.useProgram(null),Et.lineWidth(1),Et.scissor(0,0,Et.canvas.width,Et.canvas.height),Et.viewport(0,0,Et.canvas.width,Et.canvas.height),Lt={},Dn=null,cn={},Ut={},Qt=new WeakMap,Ht=[],Wt=null,qt=!1,Jt=null,Xt=null,sr=null,Zt=null,er=null,xr=null,Ar=null,yr=!1,Tr=null,Hr=null,Nr=null,zr=null,Gr=null,sn.set(0,0,Et.canvas.width,Et.canvas.height),nn.set(0,0,Et.canvas.width,Et.canvas.height),mt.reset(),vt.reset(),Ct.reset()}}}function Z1(Et,_e,at,pt,mt,vt,Ct){const Tt=mt.isWebGL2,Bt=mt.maxTextures,Lt=mt.maxCubemapSize,Ut=mt.maxTextureSize,Qt=mt.maxSamples,Ht=_e.has("WEBGL_multisampled_render_to_texture")?_e.get("WEBGL_multisampled_render_to_texture"):null,Wt=typeof navigator<"u"&&/OculusBrowser/g.test(navigator.userAgent),qt=new WeakMap;let Jt;const Xt=new WeakMap;let sr=!1;try{sr=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function Zt(Br,wr){return sr?new OffscreenCanvas(Br,wr):mu("canvas")}function er(Br,wr,Fr,Qr){let Rr=1;if((Br.width>Qr||Br.height>Qr)&&(Rr=Qr/Math.max(Br.width,Br.height)),Rr<1||wr===!0){if(typeof HTMLImageElement<"u"&&Br instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&Br instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&Br instanceof ImageBitmap){const _r=wr?mp:Math.floor,Lr=_r(Rr*Br.width),Or=_r(Rr*Br.height);Jt===void 0&&(Jt=Zt(Lr,Or));const qr=Fr?Zt(Lr,Or):Jt;return qr.width=Lr,qr.height=Or,qr.getContext("2d").drawImage(Br,0,0,Lr,Or),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+Br.width+"x"+Br.height+") to ("+Lr+"x"+Or+")."),qr}return"data"in Br&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+Br.width+"x"+Br.height+")."),Br}return Br}function xr(Br){return em(Br.width)&&em(Br.height)}function Ar(Br,wr){return Br.generateMipmaps&&wr&&Br.minFilter!==tn&&Br.minFilter!==Qn}function yr(Br){Et.generateMipmap(Br)}function Tr(Br,wr,Fr,Qr,Rr=!1){if(Tt===!1)return wr;if(Br!==null){if(Et[Br]!==void 0)return Et[Br];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+Br+"'")}let _r=wr;if(wr===Et.RED&&(Fr===Et.FLOAT&&(_r=Et.R32F),Fr===Et.HALF_FLOAT&&(_r=Et.R16F),Fr===Et.UNSIGNED_BYTE&&(_r=Et.R8)),wr===Et.RED_INTEGER&&(Fr===Et.UNSIGNED_BYTE&&(_r=Et.R8UI),Fr===Et.UNSIGNED_SHORT&&(_r=Et.R16UI),Fr===Et.UNSIGNED_INT&&(_r=Et.R32UI),Fr===Et.BYTE&&(_r=Et.R8I),Fr===Et.SHORT&&(_r=Et.R16I),Fr===Et.INT&&(_r=Et.R32I)),wr===Et.RG&&(Fr===Et.FLOAT&&(_r=Et.RG32F),Fr===Et.HALF_FLOAT&&(_r=Et.RG16F),Fr===Et.UNSIGNED_BYTE&&(_r=Et.RG8)),wr===Et.RGBA){const Lr=Rr?Ds:Ms.getTransfer(Qr);Fr===Et.FLOAT&&(_r=Et.RGBA32F),Fr===Et.HALF_FLOAT&&(_r=Et.RGBA16F),Fr===Et.UNSIGNED_BYTE&&(_r=Lr===Ns?Et.SRGB8_ALPHA8:Et.RGBA8),Fr===Et.UNSIGNED_SHORT_4_4_4_4&&(_r=Et.RGBA4),Fr===Et.UNSIGNED_SHORT_5_5_5_1&&(_r=Et.RGB5_A1)}return _r!==Et.R16F&&_r!==Et.R32F&&_r!==Et.RG16F&&_r!==Et.RG32F&&_r!==Et.RGBA16F&&_r!==Et.RGBA32F||_e.get("EXT_color_buffer_float"),_r}function Hr(Br,wr,Fr){return Ar(Br,Fr)===!0||Br.isFramebufferTexture&&Br.minFilter!==tn&&Br.minFilter!==Qn?Math.log2(Math.max(wr.width,wr.height))+1:Br.mipmaps!==void 0&&Br.mipmaps.length>0?Br.mipmaps.length:Br.isCompressedTexture&&Array.isArray(Br.image)?wr.mipmaps.length:1}function Nr(Br){return Br===tn||Br===wn||Br===Hn?Et.NEAREST:Et.LINEAR}function zr(Br){const wr=Br.target;wr.removeEventListener("dispose",zr),function(Fr){const Qr=pt.get(Fr);if(Qr.__webglInit===void 0)return;const Rr=Fr.source,_r=Xt.get(Rr);if(_r){const Lr=_r[Qr.__cacheKey];Lr.usedTimes--,Lr.usedTimes===0&&Vr(Fr),Object.keys(_r).length===0&&Xt.delete(Rr)}pt.remove(Fr)}(wr),wr.isVideoTexture&&qt.delete(wr)}function Gr(Br){const wr=Br.target;wr.removeEventListener("dispose",Gr),function(Fr){const Qr=Fr.texture,Rr=pt.get(Fr),_r=pt.get(Qr);if(_r.__webglTexture!==void 0&&(Et.deleteTexture(_r.__webglTexture),Ct.memory.textures--),Fr.depthTexture&&Fr.depthTexture.dispose(),Fr.isWebGLCubeRenderTarget)for(let Lr=0;Lr<6;Lr++){if(Array.isArray(Rr.__webglFramebuffer[Lr]))for(let Or=0;Or<Rr.__webglFramebuffer[Lr].length;Or++)Et.deleteFramebuffer(Rr.__webglFramebuffer[Lr][Or]);else Et.deleteFramebuffer(Rr.__webglFramebuffer[Lr]);Rr.__webglDepthbuffer&&Et.deleteRenderbuffer(Rr.__webglDepthbuffer[Lr])}else{if(Array.isArray(Rr.__webglFramebuffer))for(let Lr=0;Lr<Rr.__webglFramebuffer.length;Lr++)Et.deleteFramebuffer(Rr.__webglFramebuffer[Lr]);else Et.deleteFramebuffer(Rr.__webglFramebuffer);if(Rr.__webglDepthbuffer&&Et.deleteRenderbuffer(Rr.__webglDepthbuffer),Rr.__webglMultisampledFramebuffer&&Et.deleteFramebuffer(Rr.__webglMultisampledFramebuffer),Rr.__webglColorRenderbuffer)for(let Lr=0;Lr<Rr.__webglColorRenderbuffer.length;Lr++)Rr.__webglColorRenderbuffer[Lr]&&Et.deleteRenderbuffer(Rr.__webglColorRenderbuffer[Lr]);Rr.__webglDepthRenderbuffer&&Et.deleteRenderbuffer(Rr.__webglDepthRenderbuffer)}if(Fr.isWebGLMultipleRenderTargets)for(let Lr=0,Or=Qr.length;Lr<Or;Lr++){const qr=pt.get(Qr[Lr]);qr.__webglTexture&&(Et.deleteTexture(qr.__webglTexture),Ct.memory.textures--),pt.remove(Qr[Lr])}pt.remove(Qr),pt.remove(Fr)}(wr)}function Vr(Br){const wr=pt.get(Br);Et.deleteTexture(wr.__webglTexture);const Fr=Br.source;delete Xt.get(Fr)[wr.__cacheKey],Ct.memory.textures--}let gn=0;function pn(Br,wr){const Fr=pt.get(Br);if(Br.isVideoTexture&&function(Qr){const Rr=Ct.render.frame;qt.get(Qr)!==Rr&&(qt.set(Qr,Rr),Qr.update())}(Br),Br.isRenderTargetTexture===!1&&Br.version>0&&Fr.__version!==Br.version){const Qr=Br.image;if(Qr===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else{if(Qr.complete!==!1)return void sn(Fr,Br,wr);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}at.bindTexture(Et.TEXTURE_2D,Fr.__webglTexture,Et.TEXTURE0+wr)}const Mn={[xn]:Et.REPEAT,[fn]:Et.CLAMP_TO_EDGE,[En]:Et.MIRRORED_REPEAT},Dn={[tn]:Et.NEAREST,[wn]:Et.NEAREST_MIPMAP_NEAREST,[Hn]:Et.NEAREST_MIPMAP_LINEAR,[Qn]:Et.LINEAR,[jn]:Et.LINEAR_MIPMAP_NEAREST,[Kn]:Et.LINEAR_MIPMAP_LINEAR},cn={[cu]:Et.NEVER,[Y_]:Et.ALWAYS,[uu]:Et.LESS,[q_]:Et.LEQUAL,[dp]:Et.EQUAL,[Ql]:Et.GEQUAL,[$_]:Et.GREATER,[X_]:Et.NOTEQUAL};function $r(Br,wr,Fr){if(Fr?(Et.texParameteri(Br,Et.TEXTURE_WRAP_S,Mn[wr.wrapS]),Et.texParameteri(Br,Et.TEXTURE_WRAP_T,Mn[wr.wrapT]),Br!==Et.TEXTURE_3D&&Br!==Et.TEXTURE_2D_ARRAY||Et.texParameteri(Br,Et.TEXTURE_WRAP_R,Mn[wr.wrapR]),Et.texParameteri(Br,Et.TEXTURE_MAG_FILTER,Dn[wr.magFilter]),Et.texParameteri(Br,Et.TEXTURE_MIN_FILTER,Dn[wr.minFilter])):(Et.texParameteri(Br,Et.TEXTURE_WRAP_S,Et.CLAMP_TO_EDGE),Et.texParameteri(Br,Et.TEXTURE_WRAP_T,Et.CLAMP_TO_EDGE),Br!==Et.TEXTURE_3D&&Br!==Et.TEXTURE_2D_ARRAY||Et.texParameteri(Br,Et.TEXTURE_WRAP_R,Et.CLAMP_TO_EDGE),wr.wrapS===fn&&wr.wrapT===fn||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),Et.texParameteri(Br,Et.TEXTURE_MAG_FILTER,Nr(wr.magFilter)),Et.texParameteri(Br,Et.TEXTURE_MIN_FILTER,Nr(wr.minFilter)),wr.minFilter!==tn&&wr.minFilter!==Qn&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),wr.compareFunction&&(Et.texParameteri(Br,Et.TEXTURE_COMPARE_MODE,Et.COMPARE_REF_TO_TEXTURE),Et.texParameteri(Br,Et.TEXTURE_COMPARE_FUNC,cn[wr.compareFunction])),_e.has("EXT_texture_filter_anisotropic")===!0){const Qr=_e.get("EXT_texture_filter_anisotropic");if(wr.magFilter===tn||wr.minFilter!==Hn&&wr.minFilter!==Kn||wr.type===to&&_e.has("OES_texture_float_linear")===!1||Tt===!1&&wr.type===ba&&_e.has("OES_texture_half_float_linear")===!1)return;(wr.anisotropy>1||pt.get(wr).__currentAnisotropy)&&(Et.texParameterf(Br,Qr.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(wr.anisotropy,mt.getMaxAnisotropy())),pt.get(wr).__currentAnisotropy=wr.anisotropy)}}function Kr(Br,wr){let Fr=!1;Br.__webglInit===void 0&&(Br.__webglInit=!0,wr.addEventListener("dispose",zr));const Qr=wr.source;let Rr=Xt.get(Qr);Rr===void 0&&(Rr={},Xt.set(Qr,Rr));const _r=function(Lr){const Or=[];return Or.push(Lr.wrapS),Or.push(Lr.wrapT),Or.push(Lr.wrapR||0),Or.push(Lr.magFilter),Or.push(Lr.minFilter),Or.push(Lr.anisotropy),Or.push(Lr.internalFormat),Or.push(Lr.format),Or.push(Lr.type),Or.push(Lr.generateMipmaps),Or.push(Lr.premultiplyAlpha),Or.push(Lr.flipY),Or.push(Lr.unpackAlignment),Or.push(Lr.colorSpace),Or.join()}(wr);if(_r!==Br.__cacheKey){Rr[_r]===void 0&&(Rr[_r]={texture:Et.createTexture(),usedTimes:0},Ct.memory.textures++,Fr=!0),Rr[_r].usedTimes++;const Lr=Rr[Br.__cacheKey];Lr!==void 0&&(Rr[Br.__cacheKey].usedTimes--,Lr.usedTimes===0&&Vr(wr)),Br.__cacheKey=_r,Br.__webglTexture=Rr[_r].texture}return Fr}function sn(Br,wr,Fr){let Qr=Et.TEXTURE_2D;(wr.isDataArrayTexture||wr.isCompressedArrayTexture)&&(Qr=Et.TEXTURE_2D_ARRAY),wr.isData3DTexture&&(Qr=Et.TEXTURE_3D);const Rr=Kr(Br,wr),_r=wr.source;at.bindTexture(Qr,Br.__webglTexture,Et.TEXTURE0+Fr);const Lr=pt.get(_r);if(_r.version!==Lr.__version||Rr===!0){at.activeTexture(Et.TEXTURE0+Fr);const Or=Ms.getPrimaries(Ms.workingColorSpace),qr=wr.colorSpace===ks||wr.colorSpace===no?null:Ms.getPrimaries(wr.colorSpace),Yr=wr.colorSpace===ks||wr.colorSpace===no||Or===qr?Et.NONE:Et.BROWSER_DEFAULT_WEBGL;Et.pixelStorei(Et.UNPACK_FLIP_Y_WEBGL,wr.flipY),Et.pixelStorei(Et.UNPACK_PREMULTIPLY_ALPHA_WEBGL,wr.premultiplyAlpha),Et.pixelStorei(Et.UNPACK_ALIGNMENT,wr.unpackAlignment),Et.pixelStorei(Et.UNPACK_COLORSPACE_CONVERSION_WEBGL,Yr);const An=function(qn){return!Tt&&(qn.wrapS!==fn||qn.wrapT!==fn||qn.minFilter!==tn&&qn.minFilter!==Qn)}(wr)&&xr(wr.image)===!1;let hn=er(wr.image,An,!1,Ut);hn=ls(wr,hn);const ds=xr(hn)||Tt,Zn=vt.convert(wr.format,wr.colorSpace);let Cn,Jn=vt.convert(wr.type),Wn=Tr(wr.internalFormat,Zn,Jn,wr.colorSpace,wr.isVideoTexture);$r(Qr,wr,ds);const cs=wr.mipmaps,fs=Tt&&wr.isVideoTexture!==!0,Bs=Lr.__version===void 0||Rr===!0,Ts=Hr(wr,hn,ds);if(wr.isDepthTexture)Wn=Et.DEPTH_COMPONENT,Tt?Wn=wr.type===to?Et.DEPTH_COMPONENT32F:wr.type===po?Et.DEPTH_COMPONENT24:wr.type===Rn?Et.DEPTH24_STENCIL8:Et.DEPTH_COMPONENT16:wr.type===to&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),wr.format===ho&&Wn===Et.DEPTH_COMPONENT&&wr.type!==To&&wr.type!==po&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),wr.type=po,Jn=vt.convert(wr.type)),wr.format===Qs&&Wn===Et.DEPTH_COMPONENT&&(Wn=Et.DEPTH_STENCIL,wr.type!==Rn&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),wr.type=Rn,Jn=vt.convert(wr.type))),Bs&&(fs?at.texStorage2D(Et.TEXTURE_2D,1,Wn,hn.width,hn.height):at.texImage2D(Et.TEXTURE_2D,0,Wn,hn.width,hn.height,0,Zn,Jn,null));else if(wr.isDataTexture)if(cs.length>0&&ds){fs&&Bs&&at.texStorage2D(Et.TEXTURE_2D,Ts,Wn,cs[0].width,cs[0].height);for(let qn=0,As=cs.length;qn<As;qn++)Cn=cs[qn],fs?at.texSubImage2D(Et.TEXTURE_2D,qn,0,0,Cn.width,Cn.height,Zn,Jn,Cn.data):at.texImage2D(Et.TEXTURE_2D,qn,Wn,Cn.width,Cn.height,0,Zn,Jn,Cn.data);wr.generateMipmaps=!1}else fs?(Bs&&at.texStorage2D(Et.TEXTURE_2D,Ts,Wn,hn.width,hn.height),at.texSubImage2D(Et.TEXTURE_2D,0,0,0,hn.width,hn.height,Zn,Jn,hn.data)):at.texImage2D(Et.TEXTURE_2D,0,Wn,hn.width,hn.height,0,Zn,Jn,hn.data);else if(wr.isCompressedTexture)if(wr.isCompressedArrayTexture){fs&&Bs&&at.texStorage3D(Et.TEXTURE_2D_ARRAY,Ts,Wn,cs[0].width,cs[0].height,hn.depth);for(let qn=0,As=cs.length;qn<As;qn++)Cn=cs[qn],wr.format!==io?Zn!==null?fs?at.compressedTexSubImage3D(Et.TEXTURE_2D_ARRAY,qn,0,0,0,Cn.width,Cn.height,hn.depth,Zn,Cn.data,0,0):at.compressedTexImage3D(Et.TEXTURE_2D_ARRAY,qn,Wn,Cn.width,Cn.height,hn.depth,0,Cn.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):fs?at.texSubImage3D(Et.TEXTURE_2D_ARRAY,qn,0,0,0,Cn.width,Cn.height,hn.depth,Zn,Jn,Cn.data):at.texImage3D(Et.TEXTURE_2D_ARRAY,qn,Wn,Cn.width,Cn.height,hn.depth,0,Zn,Jn,Cn.data)}else{fs&&Bs&&at.texStorage2D(Et.TEXTURE_2D,Ts,Wn,cs[0].width,cs[0].height);for(let qn=0,As=cs.length;qn<As;qn++)Cn=cs[qn],wr.format!==io?Zn!==null?fs?at.compressedTexSubImage2D(Et.TEXTURE_2D,qn,0,0,Cn.width,Cn.height,Zn,Cn.data):at.compressedTexImage2D(Et.TEXTURE_2D,qn,Wn,Cn.width,Cn.height,0,Cn.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):fs?at.texSubImage2D(Et.TEXTURE_2D,qn,0,0,Cn.width,Cn.height,Zn,Jn,Cn.data):at.texImage2D(Et.TEXTURE_2D,qn,Wn,Cn.width,Cn.height,0,Zn,Jn,Cn.data)}else if(wr.isDataArrayTexture)fs?(Bs&&at.texStorage3D(Et.TEXTURE_2D_ARRAY,Ts,Wn,hn.width,hn.height,hn.depth),at.texSubImage3D(Et.TEXTURE_2D_ARRAY,0,0,0,0,hn.width,hn.height,hn.depth,Zn,Jn,hn.data)):at.texImage3D(Et.TEXTURE_2D_ARRAY,0,Wn,hn.width,hn.height,hn.depth,0,Zn,Jn,hn.data);else if(wr.isData3DTexture)fs?(Bs&&at.texStorage3D(Et.TEXTURE_3D,Ts,Wn,hn.width,hn.height,hn.depth),at.texSubImage3D(Et.TEXTURE_3D,0,0,0,0,hn.width,hn.height,hn.depth,Zn,Jn,hn.data)):at.texImage3D(Et.TEXTURE_3D,0,Wn,hn.width,hn.height,hn.depth,0,Zn,Jn,hn.data);else if(wr.isFramebufferTexture){if(Bs)if(fs)at.texStorage2D(Et.TEXTURE_2D,Ts,Wn,hn.width,hn.height);else{let qn=hn.width,As=hn.height;for(let Ko=0;Ko<Ts;Ko++)at.texImage2D(Et.TEXTURE_2D,Ko,Wn,qn,As,0,Zn,Jn,null),qn>>=1,As>>=1}}else if(cs.length>0&&ds){fs&&Bs&&at.texStorage2D(Et.TEXTURE_2D,Ts,Wn,cs[0].width,cs[0].height);for(let qn=0,As=cs.length;qn<As;qn++)Cn=cs[qn],fs?at.texSubImage2D(Et.TEXTURE_2D,qn,0,0,Zn,Jn,Cn):at.texImage2D(Et.TEXTURE_2D,qn,Wn,Zn,Jn,Cn);wr.generateMipmaps=!1}else fs?(Bs&&at.texStorage2D(Et.TEXTURE_2D,Ts,Wn,hn.width,hn.height),at.texSubImage2D(Et.TEXTURE_2D,0,0,0,Zn,Jn,hn)):at.texImage2D(Et.TEXTURE_2D,0,Wn,Zn,Jn,hn);Ar(wr,ds)&&yr(Qr),Lr.__version=_r.version,wr.onUpdate&&wr.onUpdate(wr)}Br.__version=wr.version}function nn(Br,wr,Fr,Qr,Rr,_r){const Lr=vt.convert(Fr.format,Fr.colorSpace),Or=vt.convert(Fr.type),qr=Tr(Fr.internalFormat,Lr,Or,Fr.colorSpace);if(!pt.get(wr).__hasExternalTextures){const Yr=Math.max(1,wr.width>>_r),An=Math.max(1,wr.height>>_r);Rr===Et.TEXTURE_3D||Rr===Et.TEXTURE_2D_ARRAY?at.texImage3D(Rr,_r,qr,Yr,An,wr.depth,0,Lr,Or,null):at.texImage2D(Rr,_r,qr,Yr,An,0,Lr,Or,null)}at.bindFramebuffer(Et.FRAMEBUFFER,Br),Fn(wr)?Ht.framebufferTexture2DMultisampleEXT(Et.FRAMEBUFFER,Qr,Rr,pt.get(Fr).__webglTexture,0,Xn(wr)):(Rr===Et.TEXTURE_2D||Rr>=Et.TEXTURE_CUBE_MAP_POSITIVE_X&&Rr<=Et.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&Et.framebufferTexture2D(Et.FRAMEBUFFER,Qr,Rr,pt.get(Fr).__webglTexture,_r),at.bindFramebuffer(Et.FRAMEBUFFER,null)}function Nn(Br,wr,Fr){if(Et.bindRenderbuffer(Et.RENDERBUFFER,Br),wr.depthBuffer&&!wr.stencilBuffer){let Qr=Tt===!0?Et.DEPTH_COMPONENT24:Et.DEPTH_COMPONENT16;if(Fr||Fn(wr)){const Rr=wr.depthTexture;Rr&&Rr.isDepthTexture&&(Rr.type===to?Qr=Et.DEPTH_COMPONENT32F:Rr.type===po&&(Qr=Et.DEPTH_COMPONENT24));const _r=Xn(wr);Fn(wr)?Ht.renderbufferStorageMultisampleEXT(Et.RENDERBUFFER,_r,Qr,wr.width,wr.height):Et.renderbufferStorageMultisample(Et.RENDERBUFFER,_r,Qr,wr.width,wr.height)}else Et.renderbufferStorage(Et.RENDERBUFFER,Qr,wr.width,wr.height);Et.framebufferRenderbuffer(Et.FRAMEBUFFER,Et.DEPTH_ATTACHMENT,Et.RENDERBUFFER,Br)}else if(wr.depthBuffer&&wr.stencilBuffer){const Qr=Xn(wr);Fr&&Fn(wr)===!1?Et.renderbufferStorageMultisample(Et.RENDERBUFFER,Qr,Et.DEPTH24_STENCIL8,wr.width,wr.height):Fn(wr)?Ht.renderbufferStorageMultisampleEXT(Et.RENDERBUFFER,Qr,Et.DEPTH24_STENCIL8,wr.width,wr.height):Et.renderbufferStorage(Et.RENDERBUFFER,Et.DEPTH_STENCIL,wr.width,wr.height),Et.framebufferRenderbuffer(Et.FRAMEBUFFER,Et.DEPTH_STENCIL_ATTACHMENT,Et.RENDERBUFFER,Br)}else{const Qr=wr.isWebGLMultipleRenderTargets===!0?wr.texture:[wr.texture];for(let Rr=0;Rr<Qr.length;Rr++){const _r=Qr[Rr],Lr=vt.convert(_r.format,_r.colorSpace),Or=vt.convert(_r.type),qr=Tr(_r.internalFormat,Lr,Or,_r.colorSpace),Yr=Xn(wr);Fr&&Fn(wr)===!1?Et.renderbufferStorageMultisample(Et.RENDERBUFFER,Yr,qr,wr.width,wr.height):Fn(wr)?Ht.renderbufferStorageMultisampleEXT(Et.RENDERBUFFER,Yr,qr,wr.width,wr.height):Et.renderbufferStorage(Et.RENDERBUFFER,qr,wr.width,wr.height)}}Et.bindRenderbuffer(Et.RENDERBUFFER,null)}function ts(Br){const wr=pt.get(Br),Fr=Br.isWebGLCubeRenderTarget===!0;if(Br.depthTexture&&!wr.__autoAllocateDepthBuffer){if(Fr)throw new Error("target.depthTexture not supported in Cube render targets");(function(Qr,Rr){if(Rr&&Rr.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(at.bindFramebuffer(Et.FRAMEBUFFER,Qr),!Rr.depthTexture||!Rr.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");pt.get(Rr.depthTexture).__webglTexture&&Rr.depthTexture.image.width===Rr.width&&Rr.depthTexture.image.height===Rr.height||(Rr.depthTexture.image.width=Rr.width,Rr.depthTexture.image.height=Rr.height,Rr.depthTexture.needsUpdate=!0),pn(Rr.depthTexture,0);const _r=pt.get(Rr.depthTexture).__webglTexture,Lr=Xn(Rr);if(Rr.depthTexture.format===ho)Fn(Rr)?Ht.framebufferTexture2DMultisampleEXT(Et.FRAMEBUFFER,Et.DEPTH_ATTACHMENT,Et.TEXTURE_2D,_r,0,Lr):Et.framebufferTexture2D(Et.FRAMEBUFFER,Et.DEPTH_ATTACHMENT,Et.TEXTURE_2D,_r,0);else{if(Rr.depthTexture.format!==Qs)throw new Error("Unknown depthTexture format");Fn(Rr)?Ht.framebufferTexture2DMultisampleEXT(Et.FRAMEBUFFER,Et.DEPTH_STENCIL_ATTACHMENT,Et.TEXTURE_2D,_r,0,Lr):Et.framebufferTexture2D(Et.FRAMEBUFFER,Et.DEPTH_STENCIL_ATTACHMENT,Et.TEXTURE_2D,_r,0)}})(wr.__webglFramebuffer,Br)}else if(Fr){wr.__webglDepthbuffer=[];for(let Qr=0;Qr<6;Qr++)at.bindFramebuffer(Et.FRAMEBUFFER,wr.__webglFramebuffer[Qr]),wr.__webglDepthbuffer[Qr]=Et.createRenderbuffer(),Nn(wr.__webglDepthbuffer[Qr],Br,!1)}else at.bindFramebuffer(Et.FRAMEBUFFER,wr.__webglFramebuffer),wr.__webglDepthbuffer=Et.createRenderbuffer(),Nn(wr.__webglDepthbuffer,Br,!1);at.bindFramebuffer(Et.FRAMEBUFFER,null)}function Xn(Br){return Math.min(Qt,Br.samples)}function Fn(Br){const wr=pt.get(Br);return Tt&&Br.samples>0&&_e.has("WEBGL_multisampled_render_to_texture")===!0&&wr.__useRenderToTexture!==!1}function ls(Br,wr){const Fr=Br.colorSpace,Qr=Br.format,Rr=Br.type;return Br.isCompressedTexture===!0||Br.isVideoTexture===!0||Br.format===_h||Fr!==Ws&&Fr!==ks&&(Ms.getTransfer(Fr)===Ns?Tt===!1?_e.has("EXT_sRGB")===!0&&Qr===io?(Br.format=_h,Br.minFilter=Qn,Br.generateMipmaps=!1):wr=e_.sRGBToLinear(wr):Qr===io&&Rr===js||console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):Fr===no||console.error("THREE.WebGLTextures: Unsupported texture color space:",Fr)),wr}this.allocateTextureUnit=function(){const Br=gn;return Br>=Bt&&console.warn("THREE.WebGLTextures: Trying to use "+Br+" texture units while this GPU supports only "+Bt),gn+=1,Br},this.resetTextureUnits=function(){gn=0},this.setTexture2D=pn,this.setTexture2DArray=function(Br,wr){const Fr=pt.get(Br);Br.version>0&&Fr.__version!==Br.version?sn(Fr,Br,wr):at.bindTexture(Et.TEXTURE_2D_ARRAY,Fr.__webglTexture,Et.TEXTURE0+wr)},this.setTexture3D=function(Br,wr){const Fr=pt.get(Br);Br.version>0&&Fr.__version!==Br.version?sn(Fr,Br,wr):at.bindTexture(Et.TEXTURE_3D,Fr.__webglTexture,Et.TEXTURE0+wr)},this.setTextureCube=function(Br,wr){const Fr=pt.get(Br);Br.version>0&&Fr.__version!==Br.version?function(Qr,Rr,_r){if(Rr.image.length!==6)return;const Lr=Kr(Qr,Rr),Or=Rr.source;at.bindTexture(Et.TEXTURE_CUBE_MAP,Qr.__webglTexture,Et.TEXTURE0+_r);const qr=pt.get(Or);if(Or.version!==qr.__version||Lr===!0){at.activeTexture(Et.TEXTURE0+_r);const Yr=Ms.getPrimaries(Ms.workingColorSpace),An=Rr.colorSpace===ks||Rr.colorSpace===no?null:Ms.getPrimaries(Rr.colorSpace),hn=Rr.colorSpace===ks||Rr.colorSpace===no||Yr===An?Et.NONE:Et.BROWSER_DEFAULT_WEBGL;Et.pixelStorei(Et.UNPACK_FLIP_Y_WEBGL,Rr.flipY),Et.pixelStorei(Et.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Rr.premultiplyAlpha),Et.pixelStorei(Et.UNPACK_ALIGNMENT,Rr.unpackAlignment),Et.pixelStorei(Et.UNPACK_COLORSPACE_CONVERSION_WEBGL,hn);const ds=Rr.isCompressedTexture||Rr.image[0].isCompressedTexture,Zn=Rr.image[0]&&Rr.image[0].isDataTexture,Cn=[];for(let us=0;us<6;us++)Cn[us]=ds||Zn?Zn?Rr.image[us].image:Rr.image[us]:er(Rr.image[us],!1,!0,Lt),Cn[us]=ls(Rr,Cn[us]);const Jn=Cn[0],Wn=xr(Jn)||Tt,cs=vt.convert(Rr.format,Rr.colorSpace),fs=vt.convert(Rr.type),Bs=Tr(Rr.internalFormat,cs,fs,Rr.colorSpace),Ts=Tt&&Rr.isVideoTexture!==!0,qn=qr.__version===void 0||Lr===!0;let As,Ko=Hr(Rr,Jn,Wn);if($r(Et.TEXTURE_CUBE_MAP,Rr,Wn),ds){Ts&&qn&&at.texStorage2D(Et.TEXTURE_CUBE_MAP,Ko,Bs,Jn.width,Jn.height);for(let us=0;us<6;us++){As=Cn[us].mipmaps;for(let Gs=0;Gs<As.length;Gs++){const ws=As[Gs];Rr.format!==io?cs!==null?Ts?at.compressedTexSubImage2D(Et.TEXTURE_CUBE_MAP_POSITIVE_X+us,Gs,0,0,ws.width,ws.height,cs,ws.data):at.compressedTexImage2D(Et.TEXTURE_CUBE_MAP_POSITIVE_X+us,Gs,Bs,ws.width,ws.height,0,ws.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):Ts?at.texSubImage2D(Et.TEXTURE_CUBE_MAP_POSITIVE_X+us,Gs,0,0,ws.width,ws.height,cs,fs,ws.data):at.texImage2D(Et.TEXTURE_CUBE_MAP_POSITIVE_X+us,Gs,Bs,ws.width,ws.height,0,cs,fs,ws.data)}}}else{As=Rr.mipmaps,Ts&&qn&&(As.length>0&&Ko++,at.texStorage2D(Et.TEXTURE_CUBE_MAP,Ko,Bs,Cn[0].width,Cn[0].height));for(let us=0;us<6;us++)if(Zn){Ts?at.texSubImage2D(Et.TEXTURE_CUBE_MAP_POSITIVE_X+us,0,0,0,Cn[us].width,Cn[us].height,cs,fs,Cn[us].data):at.texImage2D(Et.TEXTURE_CUBE_MAP_POSITIVE_X+us,0,Bs,Cn[us].width,Cn[us].height,0,cs,fs,Cn[us].data);for(let Gs=0;Gs<As.length;Gs++){const ws=As[Gs].image[us].image;Ts?at.texSubImage2D(Et.TEXTURE_CUBE_MAP_POSITIVE_X+us,Gs+1,0,0,ws.width,ws.height,cs,fs,ws.data):at.texImage2D(Et.TEXTURE_CUBE_MAP_POSITIVE_X+us,Gs+1,Bs,ws.width,ws.height,0,cs,fs,ws.data)}}else{Ts?at.texSubImage2D(Et.TEXTURE_CUBE_MAP_POSITIVE_X+us,0,0,0,cs,fs,Cn[us]):at.texImage2D(Et.TEXTURE_CUBE_MAP_POSITIVE_X+us,0,Bs,cs,fs,Cn[us]);for(let Gs=0;Gs<As.length;Gs++){const ws=As[Gs];Ts?at.texSubImage2D(Et.TEXTURE_CUBE_MAP_POSITIVE_X+us,Gs+1,0,0,cs,fs,ws.image[us]):at.texImage2D(Et.TEXTURE_CUBE_MAP_POSITIVE_X+us,Gs+1,Bs,cs,fs,ws.image[us])}}}Ar(Rr,Wn)&&yr(Et.TEXTURE_CUBE_MAP),qr.__version=Or.version,Rr.onUpdate&&Rr.onUpdate(Rr)}Qr.__version=Rr.version}(Fr,Br,wr):at.bindTexture(Et.TEXTURE_CUBE_MAP,Fr.__webglTexture,Et.TEXTURE0+wr)},this.rebindTextures=function(Br,wr,Fr){const Qr=pt.get(Br);wr!==void 0&&nn(Qr.__webglFramebuffer,Br,Br.texture,Et.COLOR_ATTACHMENT0,Et.TEXTURE_2D,0),Fr!==void 0&&ts(Br)},this.setupRenderTarget=function(Br){const wr=Br.texture,Fr=pt.get(Br),Qr=pt.get(wr);Br.addEventListener("dispose",Gr),Br.isWebGLMultipleRenderTargets!==!0&&(Qr.__webglTexture===void 0&&(Qr.__webglTexture=Et.createTexture()),Qr.__version=wr.version,Ct.memory.textures++);const Rr=Br.isWebGLCubeRenderTarget===!0,_r=Br.isWebGLMultipleRenderTargets===!0,Lr=xr(Br)||Tt;if(Rr){Fr.__webglFramebuffer=[];for(let Or=0;Or<6;Or++)if(Tt&&wr.mipmaps&&wr.mipmaps.length>0){Fr.__webglFramebuffer[Or]=[];for(let qr=0;qr<wr.mipmaps.length;qr++)Fr.__webglFramebuffer[Or][qr]=Et.createFramebuffer()}else Fr.__webglFramebuffer[Or]=Et.createFramebuffer()}else{if(Tt&&wr.mipmaps&&wr.mipmaps.length>0){Fr.__webglFramebuffer=[];for(let Or=0;Or<wr.mipmaps.length;Or++)Fr.__webglFramebuffer[Or]=Et.createFramebuffer()}else Fr.__webglFramebuffer=Et.createFramebuffer();if(_r)if(mt.drawBuffers){const Or=Br.texture;for(let qr=0,Yr=Or.length;qr<Yr;qr++){const An=pt.get(Or[qr]);An.__webglTexture===void 0&&(An.__webglTexture=Et.createTexture(),Ct.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(Tt&&Br.samples>0&&Fn(Br)===!1){const Or=_r?wr:[wr];Fr.__webglMultisampledFramebuffer=Et.createFramebuffer(),Fr.__webglColorRenderbuffer=[],at.bindFramebuffer(Et.FRAMEBUFFER,Fr.__webglMultisampledFramebuffer);for(let qr=0;qr<Or.length;qr++){const Yr=Or[qr];Fr.__webglColorRenderbuffer[qr]=Et.createRenderbuffer(),Et.bindRenderbuffer(Et.RENDERBUFFER,Fr.__webglColorRenderbuffer[qr]);const An=vt.convert(Yr.format,Yr.colorSpace),hn=vt.convert(Yr.type),ds=Tr(Yr.internalFormat,An,hn,Yr.colorSpace,Br.isXRRenderTarget===!0),Zn=Xn(Br);Et.renderbufferStorageMultisample(Et.RENDERBUFFER,Zn,ds,Br.width,Br.height),Et.framebufferRenderbuffer(Et.FRAMEBUFFER,Et.COLOR_ATTACHMENT0+qr,Et.RENDERBUFFER,Fr.__webglColorRenderbuffer[qr])}Et.bindRenderbuffer(Et.RENDERBUFFER,null),Br.depthBuffer&&(Fr.__webglDepthRenderbuffer=Et.createRenderbuffer(),Nn(Fr.__webglDepthRenderbuffer,Br,!0)),at.bindFramebuffer(Et.FRAMEBUFFER,null)}}if(Rr){at.bindTexture(Et.TEXTURE_CUBE_MAP,Qr.__webglTexture),$r(Et.TEXTURE_CUBE_MAP,wr,Lr);for(let Or=0;Or<6;Or++)if(Tt&&wr.mipmaps&&wr.mipmaps.length>0)for(let qr=0;qr<wr.mipmaps.length;qr++)nn(Fr.__webglFramebuffer[Or][qr],Br,wr,Et.COLOR_ATTACHMENT0,Et.TEXTURE_CUBE_MAP_POSITIVE_X+Or,qr);else nn(Fr.__webglFramebuffer[Or],Br,wr,Et.COLOR_ATTACHMENT0,Et.TEXTURE_CUBE_MAP_POSITIVE_X+Or,0);Ar(wr,Lr)&&yr(Et.TEXTURE_CUBE_MAP),at.unbindTexture()}else if(_r){const Or=Br.texture;for(let qr=0,Yr=Or.length;qr<Yr;qr++){const An=Or[qr],hn=pt.get(An);at.bindTexture(Et.TEXTURE_2D,hn.__webglTexture),$r(Et.TEXTURE_2D,An,Lr),nn(Fr.__webglFramebuffer,Br,An,Et.COLOR_ATTACHMENT0+qr,Et.TEXTURE_2D,0),Ar(An,Lr)&&yr(Et.TEXTURE_2D)}at.unbindTexture()}else{let Or=Et.TEXTURE_2D;if((Br.isWebGL3DRenderTarget||Br.isWebGLArrayRenderTarget)&&(Tt?Or=Br.isWebGL3DRenderTarget?Et.TEXTURE_3D:Et.TEXTURE_2D_ARRAY:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),at.bindTexture(Or,Qr.__webglTexture),$r(Or,wr,Lr),Tt&&wr.mipmaps&&wr.mipmaps.length>0)for(let qr=0;qr<wr.mipmaps.length;qr++)nn(Fr.__webglFramebuffer[qr],Br,wr,Et.COLOR_ATTACHMENT0,Or,qr);else nn(Fr.__webglFramebuffer,Br,wr,Et.COLOR_ATTACHMENT0,Or,0);Ar(wr,Lr)&&yr(Or),at.unbindTexture()}Br.depthBuffer&&ts(Br)},this.updateRenderTargetMipmap=function(Br){const wr=xr(Br)||Tt,Fr=Br.isWebGLMultipleRenderTargets===!0?Br.texture:[Br.texture],Qr=Br.isWebGLCubeRenderTarget?Et.TEXTURE_CUBE_MAP:Et.TEXTURE_2D;for(let Rr=0,_r=Fr.length;Rr<_r;Rr++){const Lr=Fr[Rr],Or=pt.get(Lr),qr=Or.__webglTexture;Or.__version!==Lr.version&&(at.bindTexture(Qr,qr),$r(Qr,Lr,wr),at.unbindTexture(),Or.__version=Lr.version),Ar(Lr,wr)&&(at.bindTexture(Qr,qr),yr(Qr),at.unbindTexture())}},this.updateMultisampleRenderTarget=function(Br){if(Tt&&Br.samples>0&&Fn(Br)===!1){const wr=Br.isWebGLMultipleRenderTargets?Br.texture:[Br.texture],Fr=Br.width,Qr=Br.height;let Rr=Et.COLOR_BUFFER_BIT;const _r=[],Lr=Br.stencilBuffer?Et.DEPTH_STENCIL_ATTACHMENT:Et.DEPTH_ATTACHMENT,Or=pt.get(Br),qr=Br.isWebGLMultipleRenderTargets===!0;if(qr)for(let Yr=0;Yr<wr.length;Yr++)at.bindFramebuffer(Et.FRAMEBUFFER,Or.__webglMultisampledFramebuffer),Et.framebufferRenderbuffer(Et.FRAMEBUFFER,Et.COLOR_ATTACHMENT0+Yr,Et.RENDERBUFFER,null),at.bindFramebuffer(Et.FRAMEBUFFER,Or.__webglFramebuffer),Et.framebufferTexture2D(Et.DRAW_FRAMEBUFFER,Et.COLOR_ATTACHMENT0+Yr,Et.TEXTURE_2D,null,0);at.bindFramebuffer(Et.READ_FRAMEBUFFER,Or.__webglMultisampledFramebuffer),at.bindFramebuffer(Et.DRAW_FRAMEBUFFER,Or.__webglFramebuffer);for(let Yr=0;Yr<wr.length;Yr++){_r.push(Et.COLOR_ATTACHMENT0+Yr),Br.depthBuffer&&_r.push(Lr);const An=Or.__ignoreDepthValues!==void 0&&Or.__ignoreDepthValues;if(An===!1&&(Br.depthBuffer&&(Rr|=Et.DEPTH_BUFFER_BIT),Br.stencilBuffer&&(Rr|=Et.STENCIL_BUFFER_BIT)),qr&&Et.framebufferRenderbuffer(Et.READ_FRAMEBUFFER,Et.COLOR_ATTACHMENT0,Et.RENDERBUFFER,Or.__webglColorRenderbuffer[Yr]),An===!0&&(Et.invalidateFramebuffer(Et.READ_FRAMEBUFFER,[Lr]),Et.invalidateFramebuffer(Et.DRAW_FRAMEBUFFER,[Lr])),qr){const hn=pt.get(wr[Yr]).__webglTexture;Et.framebufferTexture2D(Et.DRAW_FRAMEBUFFER,Et.COLOR_ATTACHMENT0,Et.TEXTURE_2D,hn,0)}Et.blitFramebuffer(0,0,Fr,Qr,0,0,Fr,Qr,Rr,Et.NEAREST),Wt&&Et.invalidateFramebuffer(Et.READ_FRAMEBUFFER,_r)}if(at.bindFramebuffer(Et.READ_FRAMEBUFFER,null),at.bindFramebuffer(Et.DRAW_FRAMEBUFFER,null),qr)for(let Yr=0;Yr<wr.length;Yr++){at.bindFramebuffer(Et.FRAMEBUFFER,Or.__webglMultisampledFramebuffer),Et.framebufferRenderbuffer(Et.FRAMEBUFFER,Et.COLOR_ATTACHMENT0+Yr,Et.RENDERBUFFER,Or.__webglColorRenderbuffer[Yr]);const An=pt.get(wr[Yr]).__webglTexture;at.bindFramebuffer(Et.FRAMEBUFFER,Or.__webglFramebuffer),Et.framebufferTexture2D(Et.DRAW_FRAMEBUFFER,Et.COLOR_ATTACHMENT0+Yr,Et.TEXTURE_2D,An,0)}at.bindFramebuffer(Et.DRAW_FRAMEBUFFER,Or.__webglMultisampledFramebuffer)}},this.setupDepthRenderbuffer=ts,this.setupFrameBufferTexture=nn,this.useMultisampledRTT=Fn}function _x(Et,_e,at){const pt=at.isWebGL2;return{convert:function(mt,vt=ks){let Ct;const Tt=Ms.getTransfer(vt);if(mt===js)return Et.UNSIGNED_BYTE;if(mt===ro)return Et.UNSIGNED_SHORT_4_4_4_4;if(mt===Tl)return Et.UNSIGNED_SHORT_5_5_5_1;if(mt===qs)return Et.BYTE;if(mt===eo)return Et.SHORT;if(mt===To)return Et.UNSIGNED_SHORT;if(mt===tp)return Et.INT;if(mt===po)return Et.UNSIGNED_INT;if(mt===to)return Et.FLOAT;if(mt===ba)return pt?Et.HALF_FLOAT:(Ct=_e.get("OES_texture_half_float"),Ct!==null?Ct.HALF_FLOAT_OES:null);if(mt===On)return Et.ALPHA;if(mt===io)return Et.RGBA;if(mt===Es)return Et.LUMINANCE;if(mt===Ml)return Et.LUMINANCE_ALPHA;if(mt===ho)return Et.DEPTH_COMPONENT;if(mt===Qs)return Et.DEPTH_STENCIL;if(mt===_h)return Ct=_e.get("EXT_sRGB"),Ct!==null?Ct.SRGB_ALPHA_EXT:null;if(mt===xs)return Et.RED;if(mt===Cs)return Et.RED_INTEGER;if(mt===No)return Et.RG;if(mt===Mo)return Et.RG_INTEGER;if(mt===bo)return Et.RGBA_INTEGER;if(mt===_l||mt===rp||mt===Up||mt===jp)if(Tt===Ns){if(Ct=_e.get("WEBGL_compressed_texture_s3tc_srgb"),Ct===null)return null;if(mt===_l)return Ct.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(mt===rp)return Ct.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(mt===Up)return Ct.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(mt===jp)return Ct.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(Ct=_e.get("WEBGL_compressed_texture_s3tc"),Ct===null)return null;if(mt===_l)return Ct.COMPRESSED_RGB_S3TC_DXT1_EXT;if(mt===rp)return Ct.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(mt===Up)return Ct.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(mt===jp)return Ct.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(mt===Dm||mt===Gp||mt===Bm||mt===Lm){if(Ct=_e.get("WEBGL_compressed_texture_pvrtc"),Ct===null)return null;if(mt===Dm)return Ct.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(mt===Gp)return Ct.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(mt===Bm)return Ct.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(mt===Lm)return Ct.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(mt===z_)return Ct=_e.get("WEBGL_compressed_texture_etc1"),Ct!==null?Ct.COMPRESSED_RGB_ETC1_WEBGL:null;if(mt===iu||mt===Ho){if(Ct=_e.get("WEBGL_compressed_texture_etc"),Ct===null)return null;if(mt===iu)return Tt===Ns?Ct.COMPRESSED_SRGB8_ETC2:Ct.COMPRESSED_RGB8_ETC2;if(mt===Ho)return Tt===Ns?Ct.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:Ct.COMPRESSED_RGBA8_ETC2_EAC}if(mt===Vl||mt===nu||mt===zp||mt===Su||mt===ip||mt===Om||mt===su||mt===Vp||mt===Nm||mt===Hp||mt===Qp||mt===Fm||mt===Cu||mt===Wp){if(Ct=_e.get("WEBGL_compressed_texture_astc"),Ct===null)return null;if(mt===Vl)return Tt===Ns?Ct.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:Ct.COMPRESSED_RGBA_ASTC_4x4_KHR;if(mt===nu)return Tt===Ns?Ct.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:Ct.COMPRESSED_RGBA_ASTC_5x4_KHR;if(mt===zp)return Tt===Ns?Ct.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:Ct.COMPRESSED_RGBA_ASTC_5x5_KHR;if(mt===Su)return Tt===Ns?Ct.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:Ct.COMPRESSED_RGBA_ASTC_6x5_KHR;if(mt===ip)return Tt===Ns?Ct.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:Ct.COMPRESSED_RGBA_ASTC_6x6_KHR;if(mt===Om)return Tt===Ns?Ct.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:Ct.COMPRESSED_RGBA_ASTC_8x5_KHR;if(mt===su)return Tt===Ns?Ct.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:Ct.COMPRESSED_RGBA_ASTC_8x6_KHR;if(mt===Vp)return Tt===Ns?Ct.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:Ct.COMPRESSED_RGBA_ASTC_8x8_KHR;if(mt===Nm)return Tt===Ns?Ct.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:Ct.COMPRESSED_RGBA_ASTC_10x5_KHR;if(mt===Hp)return Tt===Ns?Ct.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:Ct.COMPRESSED_RGBA_ASTC_10x6_KHR;if(mt===Qp)return Tt===Ns?Ct.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:Ct.COMPRESSED_RGBA_ASTC_10x8_KHR;if(mt===Fm)return Tt===Ns?Ct.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:Ct.COMPRESSED_RGBA_ASTC_10x10_KHR;if(mt===Cu)return Tt===Ns?Ct.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:Ct.COMPRESSED_RGBA_ASTC_12x10_KHR;if(mt===Wp)return Tt===Ns?Ct.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:Ct.COMPRESSED_RGBA_ASTC_12x12_KHR}if(mt===np||mt===Um||mt===jm){if(Ct=_e.get("EXT_texture_compression_bptc"),Ct===null)return null;if(mt===np)return Tt===Ns?Ct.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:Ct.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(mt===Um)return Ct.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(mt===jm)return Ct.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}if(mt===V_||mt===Gm||mt===zm||mt===sp){if(Ct=_e.get("EXT_texture_compression_rgtc"),Ct===null)return null;if(mt===np)return Ct.COMPRESSED_RED_RGTC1_EXT;if(mt===Gm)return Ct.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(mt===zm)return Ct.COMPRESSED_RED_GREEN_RGTC2_EXT;if(mt===sp)return Ct.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}return mt===Rn?pt?Et.UNSIGNED_INT_24_8:(Ct=_e.get("WEBGL_depth_texture"),Ct!==null?Ct.UNSIGNED_INT_24_8_WEBGL:null):Et[mt]!==void 0?Et[mt]:null}}}class fx extends yo{constructor(_e=[]){super(),this.isArrayCamera=!0,this.cameras=_e}}class xm extends Ss{constructor(){super(),this.isGroup=!0,this.type="Group"}}const eE={type:"move"};class Q0{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new xm,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new xm,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new Er,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new Er),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new xm,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new Er,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new Er),this._grip}dispatchEvent(_e){return this._targetRay!==null&&this._targetRay.dispatchEvent(_e),this._grip!==null&&this._grip.dispatchEvent(_e),this._hand!==null&&this._hand.dispatchEvent(_e),this}connect(_e){if(_e&&_e.hand){const at=this._hand;if(at)for(const pt of _e.hand.values())this._getHandJoint(at,pt)}return this.dispatchEvent({type:"connected",data:_e}),this}disconnect(_e){return this.dispatchEvent({type:"disconnected",data:_e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(_e,at,pt){let mt=null,vt=null,Ct=null;const Tt=this._targetRay,Bt=this._grip,Lt=this._hand;if(_e&&at.session.visibilityState!=="visible-blurred"){if(Lt&&_e.hand){Ct=!0;for(const Jt of _e.hand.values()){const Xt=at.getJointPose(Jt,pt),sr=this._getHandJoint(Lt,Jt);Xt!==null&&(sr.matrix.fromArray(Xt.transform.matrix),sr.matrix.decompose(sr.position,sr.rotation,sr.scale),sr.matrixWorldNeedsUpdate=!0,sr.jointRadius=Xt.radius),sr.visible=Xt!==null}const Ut=Lt.joints["index-finger-tip"],Qt=Lt.joints["thumb-tip"],Ht=Ut.position.distanceTo(Qt.position),Wt=.02,qt=.005;Lt.inputState.pinching&&Ht>Wt+qt?(Lt.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:_e.handedness,target:this})):!Lt.inputState.pinching&&Ht<=Wt-qt&&(Lt.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:_e.handedness,target:this}))}else Bt!==null&&_e.gripSpace&&(vt=at.getPose(_e.gripSpace,pt),vt!==null&&(Bt.matrix.fromArray(vt.transform.matrix),Bt.matrix.decompose(Bt.position,Bt.rotation,Bt.scale),Bt.matrixWorldNeedsUpdate=!0,vt.linearVelocity?(Bt.hasLinearVelocity=!0,Bt.linearVelocity.copy(vt.linearVelocity)):Bt.hasLinearVelocity=!1,vt.angularVelocity?(Bt.hasAngularVelocity=!0,Bt.angularVelocity.copy(vt.angularVelocity)):Bt.hasAngularVelocity=!1));Tt!==null&&(mt=at.getPose(_e.targetRaySpace,pt),mt===null&&vt!==null&&(mt=vt),mt!==null&&(Tt.matrix.fromArray(mt.transform.matrix),Tt.matrix.decompose(Tt.position,Tt.rotation,Tt.scale),Tt.matrixWorldNeedsUpdate=!0,mt.linearVelocity?(Tt.hasLinearVelocity=!0,Tt.linearVelocity.copy(mt.linearVelocity)):Tt.hasLinearVelocity=!1,mt.angularVelocity?(Tt.hasAngularVelocity=!0,Tt.angularVelocity.copy(mt.angularVelocity)):Tt.hasAngularVelocity=!1,this.dispatchEvent(eE)))}return Tt!==null&&(Tt.visible=mt!==null),Bt!==null&&(Bt.visible=vt!==null),Lt!==null&&(Lt.visible=Ct!==null),this}_getHandJoint(_e,at){if(_e.joints[at.jointName]===void 0){const pt=new xm;pt.matrixAutoUpdate=!1,pt.visible=!1,_e.joints[at.jointName]=pt,_e.add(pt)}return _e.joints[at.jointName]}}class vx extends Us{constructor(_e,at,pt,mt,vt,Ct,Tt,Bt,Lt,Ut){if((Ut=Ut!==void 0?Ut:ho)!==ho&&Ut!==Qs)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");pt===void 0&&Ut===ho&&(pt=po),pt===void 0&&Ut===Qs&&(pt=Rn),super(null,mt,vt,Ct,Tt,Bt,Ut,pt,Lt),this.isDepthTexture=!0,this.image={width:_e,height:at},this.magFilter=Tt!==void 0?Tt:tn,this.minFilter=Bt!==void 0?Bt:tn,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(_e){return super.copy(_e),this.compareFunction=_e.compareFunction,this}toJSON(_e){const at=super.toJSON(_e);return this.compareFunction!==null&&(at.compareFunction=this.compareFunction),at}}class tE extends mo{constructor(_e,at){super();const pt=this;let mt=null,vt=1,Ct=null,Tt="local-floor",Bt=1,Lt=null,Ut=null,Qt=null,Ht=null,Wt=null,qt=null;const Jt=at.getContextAttributes();let Xt=null,sr=null;const Zt=[],er=[],xr=new yo;xr.layers.enable(1),xr.viewport=new Is;const Ar=new yo;Ar.layers.enable(2),Ar.viewport=new Is;const yr=[xr,Ar],Tr=new fx;Tr.layers.enable(1),Tr.layers.enable(2);let Hr=null,Nr=null;function zr($r){const Kr=er.indexOf($r.inputSource);if(Kr===-1)return;const sn=Zt[Kr];sn!==void 0&&(sn.update($r.inputSource,$r.frame,Lt||Ct),sn.dispatchEvent({type:$r.type,data:$r.inputSource}))}function Gr(){mt.removeEventListener("select",zr),mt.removeEventListener("selectstart",zr),mt.removeEventListener("selectend",zr),mt.removeEventListener("squeeze",zr),mt.removeEventListener("squeezestart",zr),mt.removeEventListener("squeezeend",zr),mt.removeEventListener("end",Gr),mt.removeEventListener("inputsourceschange",Vr);for(let $r=0;$r<Zt.length;$r++){const Kr=er[$r];Kr!==null&&(er[$r]=null,Zt[$r].disconnect(Kr))}Hr=null,Nr=null,_e.setRenderTarget(Xt),Wt=null,Ht=null,Qt=null,mt=null,sr=null,cn.stop(),pt.isPresenting=!1,pt.dispatchEvent({type:"sessionend"})}function Vr($r){for(let Kr=0;Kr<$r.removed.length;Kr++){const sn=$r.removed[Kr],nn=er.indexOf(sn);nn>=0&&(er[nn]=null,Zt[nn].disconnect(sn))}for(let Kr=0;Kr<$r.added.length;Kr++){const sn=$r.added[Kr];let nn=er.indexOf(sn);if(nn===-1){for(let ts=0;ts<Zt.length;ts++){if(ts>=er.length){er.push(sn),nn=ts;break}if(er[ts]===null){er[ts]=sn,nn=ts;break}}if(nn===-1)break}const Nn=Zt[nn];Nn&&Nn.connect(sn)}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function($r){let Kr=Zt[$r];return Kr===void 0&&(Kr=new Q0,Zt[$r]=Kr),Kr.getTargetRaySpace()},this.getControllerGrip=function($r){let Kr=Zt[$r];return Kr===void 0&&(Kr=new Q0,Zt[$r]=Kr),Kr.getGripSpace()},this.getHand=function($r){let Kr=Zt[$r];return Kr===void 0&&(Kr=new Q0,Zt[$r]=Kr),Kr.getHandSpace()},this.setFramebufferScaleFactor=function($r){vt=$r,pt.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function($r){Tt=$r,pt.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return Lt||Ct},this.setReferenceSpace=function($r){Lt=$r},this.getBaseLayer=function(){return Ht!==null?Ht:Wt},this.getBinding=function(){return Qt},this.getFrame=function(){return qt},this.getSession=function(){return mt},this.setSession=async function($r){if(mt=$r,mt!==null){if(Xt=_e.getRenderTarget(),mt.addEventListener("select",zr),mt.addEventListener("selectstart",zr),mt.addEventListener("selectend",zr),mt.addEventListener("squeeze",zr),mt.addEventListener("squeezestart",zr),mt.addEventListener("squeezeend",zr),mt.addEventListener("end",Gr),mt.addEventListener("inputsourceschange",Vr),Jt.xrCompatible!==!0&&await at.makeXRCompatible(),mt.renderState.layers===void 0||_e.capabilities.isWebGL2===!1){const Kr={antialias:mt.renderState.layers!==void 0||Jt.antialias,alpha:!0,depth:Jt.depth,stencil:Jt.stencil,framebufferScaleFactor:vt};Wt=new XRWebGLLayer(mt,at,Kr),mt.updateRenderState({baseLayer:Wt}),sr=new Ao(Wt.framebufferWidth,Wt.framebufferHeight,{format:io,type:js,colorSpace:_e.outputColorSpace,stencilBuffer:Jt.stencil})}else{let Kr=null,sn=null,nn=null;Jt.depth&&(nn=Jt.stencil?at.DEPTH24_STENCIL8:at.DEPTH_COMPONENT24,Kr=Jt.stencil?Qs:ho,sn=Jt.stencil?Rn:po);const Nn={colorFormat:at.RGBA8,depthFormat:nn,scaleFactor:vt};Qt=new XRWebGLBinding(mt,at),Ht=Qt.createProjectionLayer(Nn),mt.updateRenderState({layers:[Ht]}),sr=new Ao(Ht.textureWidth,Ht.textureHeight,{format:io,type:js,depthTexture:new vx(Ht.textureWidth,Ht.textureHeight,sn,void 0,void 0,void 0,void 0,void 0,void 0,Kr),stencilBuffer:Jt.stencil,colorSpace:_e.outputColorSpace,samples:Jt.antialias?4:0}),_e.properties.get(sr).__ignoreDepthValues=Ht.ignoreDepthValues}sr.isXRRenderTarget=!0,this.setFoveation(Bt),Lt=null,Ct=await mt.requestReferenceSpace(Tt),cn.setContext(mt),cn.start(),pt.isPresenting=!0,pt.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(mt!==null)return mt.environmentBlendMode};const gn=new Er,pn=new Er;function Mn($r,Kr){Kr===null?$r.matrixWorld.copy($r.matrix):$r.matrixWorld.multiplyMatrices(Kr.matrixWorld,$r.matrix),$r.matrixWorldInverse.copy($r.matrixWorld).invert()}this.updateCamera=function($r){if(mt===null)return;Tr.near=Ar.near=xr.near=$r.near,Tr.far=Ar.far=xr.far=$r.far,Hr===Tr.near&&Nr===Tr.far||(mt.updateRenderState({depthNear:Tr.near,depthFar:Tr.far}),Hr=Tr.near,Nr=Tr.far);const Kr=$r.parent,sn=Tr.cameras;Mn(Tr,Kr);for(let nn=0;nn<sn.length;nn++)Mn(sn[nn],Kr);sn.length===2?function(nn,Nn,ts){gn.setFromMatrixPosition(Nn.matrixWorld),pn.setFromMatrixPosition(ts.matrixWorld);const Xn=gn.distanceTo(pn),Fn=Nn.projectionMatrix.elements,ls=ts.projectionMatrix.elements,Br=Fn[14]/(Fn[10]-1),wr=Fn[14]/(Fn[10]+1),Fr=(Fn[9]+1)/Fn[5],Qr=(Fn[9]-1)/Fn[5],Rr=(Fn[8]-1)/Fn[0],_r=(ls[8]+1)/ls[0],Lr=Br*Rr,Or=Br*_r,qr=Xn/(-Rr+_r),Yr=qr*-Rr;Nn.matrixWorld.decompose(nn.position,nn.quaternion,nn.scale),nn.translateX(Yr),nn.translateZ(qr),nn.matrixWorld.compose(nn.position,nn.quaternion,nn.scale),nn.matrixWorldInverse.copy(nn.matrixWorld).invert();const An=Br+qr,hn=wr+qr,ds=Lr-Yr,Zn=Or+(Xn-Yr),Cn=Fr*wr/hn*An,Jn=Qr*wr/hn*An;nn.projectionMatrix.makePerspective(ds,Zn,Cn,Jn,An,hn),nn.projectionMatrixInverse.copy(nn.projectionMatrix).invert()}(Tr,xr,Ar):Tr.projectionMatrix.copy(xr.projectionMatrix),function(nn,Nn,ts){ts===null?nn.matrix.copy(Nn.matrixWorld):(nn.matrix.copy(ts.matrixWorld),nn.matrix.invert(),nn.matrix.multiply(Nn.matrixWorld)),nn.matrix.decompose(nn.position,nn.quaternion,nn.scale),nn.updateMatrixWorld(!0),nn.projectionMatrix.copy(Nn.projectionMatrix),nn.projectionMatrixInverse.copy(Nn.projectionMatrixInverse),nn.isPerspectiveCamera&&(nn.fov=2*hu*Math.atan(1/nn.projectionMatrix.elements[5]),nn.zoom=1)}($r,Tr,Kr)},this.getCamera=function(){return Tr},this.getFoveation=function(){if(Ht!==null||Wt!==null)return Bt},this.setFoveation=function($r){Bt=$r,Ht!==null&&(Ht.fixedFoveation=$r),Wt!==null&&Wt.fixedFoveation!==void 0&&(Wt.fixedFoveation=$r)};let Dn=null;this.onPreAnimationFrameCallback=null;const cn=new Vy;cn.setAnimationLoop(function($r,Kr){if(pt.onPreAnimationFrameCallback&&pt.onPreAnimationFrameCallback($r,Kr),Ut=Kr.getViewerPose(Lt||Ct),qt=Kr,Ut!==null){const sn=Ut.views;Wt!==null&&(_e.setRenderTargetFramebuffer(sr,Wt.framebuffer),_e.setRenderTarget(sr));let nn=!1;sn.length!==Tr.cameras.length&&(Tr.cameras.length=0,nn=!0);for(let Nn=0;Nn<sn.length;Nn++){const ts=sn[Nn];let Xn=null;if(Wt!==null)Xn=Wt.getViewport(ts);else{const ls=Qt.getViewSubImage(Ht,ts);Xn=ls.viewport,Nn===0&&(_e.setRenderTargetTextures(sr,ls.colorTexture,Ht.ignoreDepthValues?void 0:ls.depthStencilTexture),_e.setRenderTarget(sr))}let Fn=yr[Nn];Fn===void 0&&(Fn=new yo,Fn.layers.enable(Nn),Fn.viewport=new Is,yr[Nn]=Fn),Fn.matrix.fromArray(ts.transform.matrix),Fn.matrix.decompose(Fn.position,Fn.quaternion,Fn.scale),Fn.projectionMatrix.fromArray(ts.projectionMatrix),Fn.projectionMatrixInverse.copy(Fn.projectionMatrix).invert(),Fn.viewport.set(Xn.x,Xn.y,Xn.width,Xn.height),Nn===0&&(Tr.matrix.copy(Fn.matrix),Tr.matrix.decompose(Tr.position,Tr.quaternion,Tr.scale)),nn===!0&&Tr.cameras.push(Fn)}}for(let sn=0;sn<Zt.length;sn++){const nn=er[sn],Nn=Zt[sn];nn!==null&&Nn!==void 0&&Nn.update(nn,Kr,Lt||Ct)}Dn&&Dn($r,Kr),Kr.detectedPlanes&&pt.dispatchEvent({type:"planesdetected",data:Kr}),qt=null}),this.setAnimationLoop=function($r){Dn=$r},this.dispose=function(){}}}function rE(Et,_e){function at(mt,vt){mt.matrixAutoUpdate===!0&&mt.updateMatrix(),vt.value.copy(mt.matrix)}function pt(mt,vt){mt.opacity.value=vt.opacity,vt.color&&mt.diffuse.value.copy(vt.color),vt.emissive&&mt.emissive.value.copy(vt.emissive).multiplyScalar(vt.emissiveIntensity),vt.map&&(mt.map.value=vt.map,at(vt.map,mt.mapTransform)),vt.alphaMap&&(mt.alphaMap.value=vt.alphaMap,at(vt.alphaMap,mt.alphaMapTransform)),vt.bumpMap&&(mt.bumpMap.value=vt.bumpMap,at(vt.bumpMap,mt.bumpMapTransform),mt.bumpScale.value=vt.bumpScale,vt.side===bt&&(mt.bumpScale.value*=-1)),vt.normalMap&&(mt.normalMap.value=vt.normalMap,at(vt.normalMap,mt.normalMapTransform),mt.normalScale.value.copy(vt.normalScale),vt.side===bt&&mt.normalScale.value.negate()),vt.displacementMap&&(mt.displacementMap.value=vt.displacementMap,at(vt.displacementMap,mt.displacementMapTransform),mt.displacementScale.value=vt.displacementScale,mt.displacementBias.value=vt.displacementBias),vt.emissiveMap&&(mt.emissiveMap.value=vt.emissiveMap,at(vt.emissiveMap,mt.emissiveMapTransform)),vt.specularMap&&(mt.specularMap.value=vt.specularMap,at(vt.specularMap,mt.specularMapTransform)),vt.alphaTest>0&&(mt.alphaTest.value=vt.alphaTest);const Ct=_e.get(vt).envMap;if(Ct){mt.envMap.value=Ct;const Tt=vt.envMap||_e.get(vt).environment||Ct;mt.envMapRotation.value=Tt?Tt.rotation:0,mt.flipEnvMap.value=Ct.isCubeTexture&&Ct.isRenderTargetTexture===!1?-1:1,mt.reflectivity.value=vt.reflectivity,mt.ior.value=vt.ior,mt.refractionRatio.value=vt.refractionRatio}if(vt.lightMap){mt.lightMap.value=vt.lightMap;const Tt=Et._useLegacyLights===!0?Math.PI:1;mt.lightMapIntensity.value=vt.lightMapIntensity*Tt,at(vt.lightMap,mt.lightMapTransform)}vt.aoMap&&(mt.aoMap.value=vt.aoMap,mt.aoMapIntensity.value=vt.aoMapIntensity,at(vt.aoMap,mt.aoMapTransform))}return{refreshTransformUniform:at,refreshFogUniforms:function(mt,vt){vt.color.getRGB(mt.fogColor.value,Uy(Et)),vt.isFog?(mt.fogNear.value=vt.near,mt.fogFar.value=vt.far):vt.isFogExp2&&(mt.fogDensity.value=vt.density)},refreshMaterialUniforms:function(mt,vt,Ct,Tt,Bt){vt.isMeshBasicMaterial||vt.isMeshLambertMaterial?pt(mt,vt):vt.isMeshToonMaterial?(pt(mt,vt),function(Lt,Ut){Ut.gradientMap&&(Lt.gradientMap.value=Ut.gradientMap)}(mt,vt)):vt.isMeshPhongMaterial?(pt(mt,vt),function(Lt,Ut){Lt.specular.value.copy(Ut.specular),Lt.shininess.value=Math.max(Ut.shininess,1e-4)}(mt,vt)):vt.isMeshStandardMaterial?(pt(mt,vt),function(Lt,Ut){Lt.metalness.value=Ut.metalness,Ut.metalnessMap&&(Lt.metalnessMap.value=Ut.metalnessMap,at(Ut.metalnessMap,Lt.metalnessMapTransform)),Lt.roughness.value=Ut.roughness,Ut.roughnessMap&&(Lt.roughnessMap.value=Ut.roughnessMap,at(Ut.roughnessMap,Lt.roughnessMapTransform)),_e.get(Ut).envMap&&(Lt.envMapIntensity.value=Ut.envMapIntensity)}(mt,vt),vt.isMeshPhysicalMaterial&&function(Lt,Ut,Qt){Lt.ior.value=Ut.ior,Ut.sheen>0&&(Lt.sheenColor.value.copy(Ut.sheenColor).multiplyScalar(Ut.sheen),Lt.sheenRoughness.value=Ut.sheenRoughness,Ut.sheenColorMap&&(Lt.sheenColorMap.value=Ut.sheenColorMap,at(Ut.sheenColorMap,Lt.sheenColorMapTransform)),Ut.sheenRoughnessMap&&(Lt.sheenRoughnessMap.value=Ut.sheenRoughnessMap,at(Ut.sheenRoughnessMap,Lt.sheenRoughnessMapTransform))),Ut.clearcoat>0&&(Lt.clearcoat.value=Ut.clearcoat,Lt.clearcoatRoughness.value=Ut.clearcoatRoughness,Ut.clearcoatMap&&(Lt.clearcoatMap.value=Ut.clearcoatMap,at(Ut.clearcoatMap,Lt.clearcoatMapTransform)),Ut.clearcoatRoughnessMap&&(Lt.clearcoatRoughnessMap.value=Ut.clearcoatRoughnessMap,at(Ut.clearcoatRoughnessMap,Lt.clearcoatRoughnessMapTransform)),Ut.clearcoatNormalMap&&(Lt.clearcoatNormalMap.value=Ut.clearcoatNormalMap,at(Ut.clearcoatNormalMap,Lt.clearcoatNormalMapTransform),Lt.clearcoatNormalScale.value.copy(Ut.clearcoatNormalScale),Ut.side===bt&&Lt.clearcoatNormalScale.value.negate())),Ut.iridescence>0&&(Lt.iridescence.value=Ut.iridescence,Lt.iridescenceIOR.value=Ut.iridescenceIOR,Lt.iridescenceThicknessMinimum.value=Ut.iridescenceThicknessRange[0],Lt.iridescenceThicknessMaximum.value=Ut.iridescenceThicknessRange[1],Ut.iridescenceMap&&(Lt.iridescenceMap.value=Ut.iridescenceMap,at(Ut.iridescenceMap,Lt.iridescenceMapTransform)),Ut.iridescenceThicknessMap&&(Lt.iridescenceThicknessMap.value=Ut.iridescenceThicknessMap,at(Ut.iridescenceThicknessMap,Lt.iridescenceThicknessMapTransform))),Ut.transmission>0&&(Lt.transmission.value=Ut.transmission,Lt.transmissionSamplerMap.value=Qt.texture,Lt.transmissionSamplerSize.value.set(Qt.width,Qt.height),Ut.transmissionMap&&(Lt.transmissionMap.value=Ut.transmissionMap,at(Ut.transmissionMap,Lt.transmissionMapTransform)),Lt.thickness.value=Ut.thickness,Ut.thicknessMap&&(Lt.thicknessMap.value=Ut.thicknessMap,at(Ut.thicknessMap,Lt.thicknessMapTransform)),Lt.attenuationDistance.value=Ut.attenuationDistance,Lt.attenuationColor.value.copy(Ut.attenuationColor)),Ut.anisotropy>0&&(Lt.anisotropyVector.value.set(Ut.anisotropy*Math.cos(Ut.anisotropyRotation),Ut.anisotropy*Math.sin(Ut.anisotropyRotation)),Ut.anisotropyMap&&(Lt.anisotropyMap.value=Ut.anisotropyMap,at(Ut.anisotropyMap,Lt.anisotropyMapTransform))),Lt.specularIntensity.value=Ut.specularIntensity,Lt.specularColor.value.copy(Ut.specularColor),Ut.specularColorMap&&(Lt.specularColorMap.value=Ut.specularColorMap,at(Ut.specularColorMap,Lt.specularColorMapTransform)),Ut.specularIntensityMap&&(Lt.specularIntensityMap.value=Ut.specularIntensityMap,at(Ut.specularIntensityMap,Lt.specularIntensityMapTransform))}(mt,vt,Bt)):vt.isMeshMatcapMaterial?(pt(mt,vt),function(Lt,Ut){Ut.matcap&&(Lt.matcap.value=Ut.matcap)}(mt,vt)):vt.isMeshDepthMaterial?pt(mt,vt):vt.isMeshDistanceMaterial?(pt(mt,vt),function(Lt,Ut){const Qt=_e.get(Ut).light;Lt.referencePosition.value.setFromMatrixPosition(Qt.matrixWorld),Lt.nearDistance.value=Qt.shadow.camera.near,Lt.farDistance.value=Qt.shadow.camera.far}(mt,vt)):vt.isMeshNormalMaterial?pt(mt,vt):vt.isLineBasicMaterial?(function(Lt,Ut){Lt.diffuse.value.copy(Ut.color),Lt.opacity.value=Ut.opacity,Ut.map&&(Lt.map.value=Ut.map,at(Ut.map,Lt.mapTransform))}(mt,vt),vt.isLineDashedMaterial&&function(Lt,Ut){Lt.dashSize.value=Ut.dashSize,Lt.totalSize.value=Ut.dashSize+Ut.gapSize,Lt.scale.value=Ut.scale}(mt,vt)):vt.isPointsMaterial?function(Lt,Ut,Qt,Ht){Lt.diffuse.value.copy(Ut.color),Lt.opacity.value=Ut.opacity,Lt.size.value=Ut.size*Qt,Lt.scale.value=.5*Ht,Ut.map&&(Lt.map.value=Ut.map,at(Ut.map,Lt.uvTransform)),Ut.alphaMap&&(Lt.alphaMap.value=Ut.alphaMap,at(Ut.alphaMap,Lt.alphaMapTransform)),Ut.alphaTest>0&&(Lt.alphaTest.value=Ut.alphaTest)}(mt,vt,Ct,Tt):vt.isSpriteMaterial?function(Lt,Ut){Lt.diffuse.value.copy(Ut.color),Lt.opacity.value=Ut.opacity,Lt.rotation.value=Ut.rotation,Ut.map&&(Lt.map.value=Ut.map,at(Ut.map,Lt.mapTransform)),Ut.alphaMap&&(Lt.alphaMap.value=Ut.alphaMap,at(Ut.alphaMap,Lt.alphaMapTransform)),Ut.alphaTest>0&&(Lt.alphaTest.value=Ut.alphaTest)}(mt,vt):vt.isShadowMaterial?(mt.color.value.copy(vt.color),mt.opacity.value=vt.opacity):vt.isShaderMaterial&&(vt.transmission!==void 0&&(mt.transmission&&(mt.transmission.value=vt.transmission),mt.transmissionSamplerMap&&Bt&&(mt.transmissionSamplerMap.value=Bt?Bt.texture:null),mt.transmissionSamplerSize&&Bt&&mt.transmissionSamplerSize.value.set(Bt.width,Bt.height)),vt.uniformsNeedUpdate=!1)}}}function iE(Et,_e,at,pt){let mt={},vt={},Ct=[];const Tt=at.isWebGL2?Et.getParameter(Et.MAX_UNIFORM_BUFFER_BINDINGS):0;function Bt(Qt,Ht,Wt){const qt=Qt.value;if(Wt[Ht]===void 0){if(typeof qt=="number")Wt[Ht]=qt;else{const Jt=Array.isArray(qt)?qt:[qt],Xt=[];for(let sr=0;sr<Jt.length;sr++)Xt.push(Jt[sr].clone());Wt[Ht]=Xt}return!0}if(typeof qt=="number"){if(Wt[Ht]!==qt)return Wt[Ht]=qt,!0}else{const Jt=Array.isArray(Wt[Ht])?Wt[Ht]:[Wt[Ht]],Xt=Array.isArray(qt)?qt:[qt];for(let sr=0;sr<Jt.length;sr++){const Zt=Jt[sr];if(Zt.equals(Xt[sr])===!1)return Zt.copy(Xt[sr]),!0}}return!1}function Lt(Qt){const Ht={boundary:0,storage:0};return typeof Qt=="number"?(Ht.boundary=4,Ht.storage=4):Qt.isVector2?(Ht.boundary=8,Ht.storage=8):Qt.isVector3||Qt.isColor?(Ht.boundary=16,Ht.storage=12):Qt.isVector4?(Ht.boundary=16,Ht.storage=16):Qt.isMatrix3?(Ht.boundary=48,Ht.storage=48):Qt.isMatrix4?(Ht.boundary=64,Ht.storage=64):Qt.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",Qt),Ht}function Ut(Qt){const Ht=Qt.target;Ht.removeEventListener("dispose",Ut);const Wt=Ct.indexOf(Ht.__bindingPointIndex);Ct.splice(Wt,1),Et.deleteBuffer(mt[Ht.id]),delete mt[Ht.id],delete vt[Ht.id]}return{bind:function(Qt,Ht){const Wt=Ht.program;pt.uniformBlockBinding(Qt,Wt)},update:function(Qt,Ht){let Wt=mt[Qt.id];Wt===void 0&&(function(Xt){const sr=Xt.uniforms;let Zt=0,er=0;for(let xr=0,Ar=sr.length;xr<Ar;xr++){const yr=sr[xr],Tr={boundary:0,storage:0},Hr=Array.isArray(yr.value)?yr.value:[yr.value];for(let Nr=0,zr=Hr.length;Nr<zr;Nr++){const Gr=Lt(Hr[Nr]);Tr.boundary+=Gr.boundary,Tr.storage+=Gr.storage}yr.__data=new Float32Array(Tr.storage/Float32Array.BYTES_PER_ELEMENT),yr.__offset=Zt,xr>0&&(er=Zt%16,er!==0&&16-er-Tr.boundary<0&&(Zt+=16-er,yr.__offset=Zt)),Zt+=Tr.storage}er=Zt%16,er>0&&(Zt+=16-er),Xt.__size=Zt,Xt.__cache={}}(Qt),Wt=function(Xt){const sr=function(){for(let Ar=0;Ar<Tt;Ar++)if(Ct.indexOf(Ar)===-1)return Ct.push(Ar),Ar;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}();Xt.__bindingPointIndex=sr;const Zt=Et.createBuffer(),er=Xt.__size,xr=Xt.usage;return Et.bindBuffer(Et.UNIFORM_BUFFER,Zt),Et.bufferData(Et.UNIFORM_BUFFER,er,xr),Et.bindBuffer(Et.UNIFORM_BUFFER,null),Et.bindBufferBase(Et.UNIFORM_BUFFER,sr,Zt),Zt}(Qt),mt[Qt.id]=Wt,Qt.addEventListener("dispose",Ut));const qt=Ht.program;pt.updateUBOMapping(Qt,qt);const Jt=_e.render.frame;vt[Qt.id]!==Jt&&(function(Xt){const sr=mt[Xt.id],Zt=Xt.uniforms,er=Xt.__cache;Et.bindBuffer(Et.UNIFORM_BUFFER,sr);for(let xr=0,Ar=Zt.length;xr<Ar;xr++){const yr=Zt[xr];if(Bt(yr,xr,er)===!0){const Tr=yr.__offset,Hr=Array.isArray(yr.value)?yr.value:[yr.value];let Nr=0;for(let zr=0;zr<Hr.length;zr++){const Gr=Hr[zr],Vr=Lt(Gr);typeof Gr=="number"?(yr.__data[0]=Gr,Et.bufferSubData(Et.UNIFORM_BUFFER,Tr+Nr,yr.__data)):Gr.isMatrix3?(yr.__data[0]=Gr.elements[0],yr.__data[1]=Gr.elements[1],yr.__data[2]=Gr.elements[2],yr.__data[3]=Gr.elements[0],yr.__data[4]=Gr.elements[3],yr.__data[5]=Gr.elements[4],yr.__data[6]=Gr.elements[5],yr.__data[7]=Gr.elements[0],yr.__data[8]=Gr.elements[6],yr.__data[9]=Gr.elements[7],yr.__data[10]=Gr.elements[8],yr.__data[11]=Gr.elements[0]):(Gr.toArray(yr.__data,Nr),Nr+=Vr.storage/Float32Array.BYTES_PER_ELEMENT)}Et.bufferSubData(Et.UNIFORM_BUFFER,Tr,yr.__data)}}Et.bindBuffer(Et.UNIFORM_BUFFER,null)}(Qt),vt[Qt.id]=Jt)},dispose:function(){for(const Qt in mt)Et.deleteBuffer(mt[Qt]);Ct=[],mt={},vt={}}}}class yx{constructor(_e={}){const{canvas:at=Jm(),context:pt=null,depth:mt=!0,stencil:vt=!0,alpha:Ct=!1,antialias:Tt=!1,premultipliedAlpha:Bt=!0,preserveDrawingBuffer:Lt=!1,powerPreference:Ut="default",failIfMajorPerformanceCaveat:Qt=!1}=_e;let Ht;this.isWebGLRenderer=!0,Ht=pt!==null?pt.getContextAttributes().alpha:Ct;const Wt=new Uint32Array(4),qt=new Int32Array(4);let Jt=null,Xt=null;const sr=[],Zt=[];this.domElement=at,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this._outputColorSpace=Os,this._useLegacyLights=!1,this.toneMapping=ar,this.toneMappingExposure=1,this.userData={},this.onContextLost=()=>{},this.onContextRestore=()=>{},this.onContextCreationError=()=>{};const er=this;let xr=!1,Ar=0,yr=0,Tr=null,Hr=-1,Nr=null;const zr=new Is,Gr=new Is;let Vr=null;const gn=new Un(0);let pn=0,Mn=at.width,Dn=at.height,cn=1,$r=null,Kr=null;const sn=new Is(0,0,Mn,Dn),nn=new Is(0,0,Mn,Dn);let Nn=!1;const ts=new xv;let Xn=!1,Fn=!1,ls=null;const Br=new rs,wr=new dn,Fr=new Er,Qr={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function Rr(){return Tr===null?cn:1}let _r,Lr,Or,qr,Yr,An,hn,ds,Zn,Cn,Jn,Wn,cs,fs,Bs,Ts,qn,As,Ko,us,Gs,ws,Au,wu,Zr=pt;function g0(Mr,_i){for(let an=0;an<Mr.length;an++){const un=Mr[an],yn=at.getContext(un,_i);if(yn!==null)return yn}return null}try{const Mr={alpha:!0,depth:mt,stencil:vt,antialias:Tt,premultipliedAlpha:Bt,preserveDrawingBuffer:Lt,powerPreference:Ut,failIfMajorPerformanceCaveat:Qt};if("setAttribute"in at&&at.setAttribute("data-engine",`three.js r${d}`),at.addEventListener("webglcontextlost",F_,!1),at.addEventListener("webglcontextrestored",nw,!1),at.addEventListener("webglcontextcreationerror",sw,!1),Zr===null){const _i=["webgl2","webgl","experimental-webgl"];if(er.isWebGL1Renderer===!0&&_i.shift(),Zr=g0(_i,Mr),Zr===null)throw g0(_i)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}typeof WebGLRenderingContext<"u"&&Zr instanceof WebGLRenderingContext&&console.warn("THREE.WebGLRenderer: WebGL 1 support was deprecated in r153 and will be removed in r163."),Zr.getShaderPrecisionFormat===void 0&&(Zr.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(Mr){throw console.error("THREE.WebGLRenderer: "+Mr.message),Mr}function _0(){_r=new kw(Zr),Lr=new Tw(Zr,_r,_e),_r.init(Lr),ws=new _x(Zr,_r,Lr),Or=new J1(Zr,_r,Lr),qr=new Lw(Zr),Yr=new V1,An=new Z1(Zr,_r,Or,Yr,Lr,ws,qr),hn=new Iw(er),ds=new Rw(er),Zn=new Ew(Zr,Lr),Au=new Cw(Zr,_r,Zn,Lr),Cn=new Dw(Zr,Zn,qr,Au),Jn=new Uw(Zr,Cn,Zn,qr),Ko=new Fw(Zr,Lr,An),Ts=new Mw(Yr),Wn=new z1(er,hn,ds,_r,Lr,Au,Ts),cs=new rE(er,Yr),fs=new Q1,Bs=new Y1(_r,Lr),As=new Sw(er,hn,ds,Or,Jn,Ht,Bt),qn=new K1(er,Jn,Lr),wu=new iE(Zr,qr,Lr,Or),us=new Pw(Zr,_r,qr,Lr),Gs=new Bw(Zr,_r,qr,Lr),qr.programs=Wn.programs,er.capabilities=Lr,er.extensions=_r,er.properties=Yr,er.renderLists=fs,er.shadowMap=qn,er.state=Or,er.info=qr,er.background=As,er.cubemaps=hn,er.cubeuvmaps=ds,er.materials=cs}_0();const Co=new tE(er,Zr);function F_(Mr){Mr.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),xr=!0,er.onContextLost(Mr)}function nw(){console.log("THREE.WebGLRenderer: Context Restored."),xr=!1;const Mr=er.info?er.info.autoReset:void 0,_i=qn.enabled,an=qn.autoUpdate,un=qn.needsUpdate,yn=qn.type;_0(),er.info&&Mr!==void 0&&(er.info.autoReset=Mr),qn.enabled=_i,qn.autoUpdate=an,qn.needsUpdate=un,qn.type=yn,er.onContextRestore&&er.onContextRestore()}function sw(Mr){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",Mr.statusMessage),er.onContextCreationError(Mr)}function aw(Mr){const _i=Mr.target;_i.removeEventListener("dispose",aw),function(an){(function(un){const yn=Yr.get(un).programs;yn!==void 0&&(yn.forEach(function(Bn){Wn.releaseProgram(Bn)}),un.isShaderMaterial&&Wn.releaseShaderCache(un))})(an),Yr.remove(an)}(_i)}this.xr=Co,this.getContext=function(){return Zr},this.getContextAttributes=function(){return Zr.getContextAttributes()},this.forceContextLoss=function(){const Mr=_r.get("WEBGL_lose_context");Mr&&Mr.loseContext()},this.forceContextRestore=function(){const Mr=_r.get("WEBGL_lose_context");Mr&&Mr.restoreContext()},this.getPixelRatio=function(){return cn},this.setPixelRatio=function(Mr){Mr!==void 0&&(cn=Mr,this.setSize(Mn,Dn,!1))},this.getSize=function(Mr){return Mr.set(Mn,Dn)},this.setSize=function(Mr,_i,an=!0){Co.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(Mn=Mr,Dn=_i,at.width=Math.floor(Mr*cn),at.height=Math.floor(_i*cn),an===!0&&(at.style.width=Mr+"px",at.style.height=_i+"px"),this.setViewport(0,0,Mr,_i))},this.getDrawingBufferSize=function(Mr){return Mr.set(Mn*cn,Dn*cn).floor()},this.setDrawingBufferSize=function(Mr,_i,an){Mn=Mr,Dn=_i,cn=an,at.width=Math.floor(Mr*an),at.height=Math.floor(_i*an),this.setViewport(0,0,Mr,_i)},this.getCurrentViewport=function(Mr){return Mr.copy(zr)},this.getViewport=function(Mr){return Mr.copy(sn)},this.setViewport=function(Mr,_i,an,un){Mr.isVector4?sn.set(Mr.x,Mr.y,Mr.z,Mr.w):sn.set(Mr,_i,an,un),Or.viewport(zr.copy(sn).multiplyScalar(cn).floor())},this.getScissor=function(Mr){return Mr.copy(nn)},this.setScissor=function(Mr,_i,an,un){Mr.isVector4?nn.set(Mr.x,Mr.y,Mr.z,Mr.w):nn.set(Mr,_i,an,un),Or.scissor(Gr.copy(nn).multiplyScalar(cn).floor())},this.getScissorTest=function(){return Nn},this.setScissorTest=function(Mr){Or.setScissorTest(Nn=Mr)},this.setOpaqueSort=function(Mr){$r=Mr},this.setTransparentSort=function(Mr){Kr=Mr},this.getClearColor=function(Mr){return Mr.copy(As.getClearColor())},this.setClearColor=function(){As.setClearColor.apply(As,arguments)},this.getClearAlpha=function(){return As.getClearAlpha()},this.setClearAlpha=function(){As.setClearAlpha.apply(As,arguments)},this.clear=function(Mr=!0,_i=!0,an=!0){let un=0;if(Mr){let yn=!1;if(Tr!==null){const Bn=Tr.texture.format;yn=Bn===bo||Bn===Mo||Bn===Cs}if(yn){const Bn=Tr.texture.type,bs=Bn===js||Bn===po||Bn===To||Bn===Rn||Bn===ro||Bn===Tl,Yn=As.getClearColor(),ps=As.getClearAlpha(),vs=Yn.r,ys=Yn.g,ss=Yn.b;bs?(Wt[0]=vs,Wt[1]=ys,Wt[2]=ss,Wt[3]=ps,Zr.clearBufferuiv(Zr.COLOR,0,Wt)):(qt[0]=vs,qt[1]=ys,qt[2]=ss,qt[3]=ps,Zr.clearBufferiv(Zr.COLOR,0,qt))}else un|=Zr.COLOR_BUFFER_BIT}_i&&(un|=Zr.DEPTH_BUFFER_BIT),an&&(un|=Zr.STENCIL_BUFFER_BIT),Zr.clear(un)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){at.removeEventListener("webglcontextlost",F_,!1),at.removeEventListener("webglcontextrestored",nw,!1),at.removeEventListener("webglcontextcreationerror",sw,!1),fs.dispose(),Bs.dispose(),Yr.dispose(),hn.dispose(),ds.dispose(),Jn.dispose(),Au.dispose(),wu.dispose(),Wn.dispose(),Co.dispose(),Co.removeEventListener("sessionstart",ow),Co.removeEventListener("sessionend",lw),ls&&(ls.dispose(),ls=null),Op.stop()},this.renderBufferDirect=function(Mr,_i,an,un,yn,Bn){_i===null&&(_i=Qr);const bs=yn.isMesh&&yn.matrixWorld.determinant()<0,Yn=function(Js,Zo,Vo,is,Xs){Zo.isScene!==!0&&(Zo=Qr),An.resetTextureUnits();const U_=Zo.fog,bS=is.userData&&is.userData.envMapSlotKey&&Zo.textureSlots&&Zo.textureSlots[is.userData.envMapSlotKey]?Zo.textureSlots[is.userData.envMapSlotKey]:is.isMeshStandardMaterial?Zo.environment:null,xS=Tr===null?er.outputColorSpace:Tr.isXRRenderTarget===!0||Tr.texture.colorSpace&&Tr.texture.colorSpace!==Os?Tr.texture.colorSpace:Ws,b0=(is.isMeshStandardMaterial?ds:hn).get(is.envMap||bS),AS=is.vertexColors===!0&&!!Vo.attributes.color&&Vo.attributes.color.itemSize===4,wS=!!Vo.attributes.tangent&&(!!is.normalMap||is.anisotropy>0||Vo.userData.__forceUseTangent),ES=!!Vo.morphAttributes.position,SS=!!Vo.morphAttributes.normal,CS=!!Vo.morphAttributes.color;let dw=ar;is.toneMapped&&(Tr!==null&&Tr.isXRRenderTarget!==!0||(dw=er.toneMapping));const mw=Vo.morphAttributes.position||Vo.morphAttributes.normal||Vo.morphAttributes.color,PS=mw!==void 0?mw.length:0,Ls=Yr.get(is),TS=Xt.state.lights;if(Xn===!0&&(Fn===!0||Js!==Nr)){const Oo=Js===Nr&&is.id===Hr;Ts.setState(is,Js,Oo)}let Eu=!1;is.version===Ls.__version?Ls.needsLights&&Ls.lightsStateVersion!==TS.state.version||Ls.outputColorSpace!==xS||Xs.isInstancedMesh&&Ls.instancing===!1?Eu=!0:Xs.isInstancedMesh||Ls.instancing!==!0?Xs.isSkinnedMesh&&Ls.skinning===!1?Eu=!0:Xs.isSkinnedMesh||Ls.skinning!==!0?Xs.isInstancedMesh&&Ls.instancingColor===!0&&Xs.instanceColor===null||Xs.isInstancedMesh&&Ls.instancingColor===!1&&Xs.instanceColor!==null||Ls.envMap!==b0||is.fog===!0&&Ls.fog!==U_?Eu=!0:Ls.numClippingPlanes===void 0||Ls.numClippingPlanes===Ts.numPlanes&&Ls.numIntersection===Ts.numIntersection?(Ls.vertexAlphas!==AS||Ls.vertexTangents!==wS||Ls.morphTargets!==ES||Ls.morphNormals!==SS||Ls.morphColors!==CS||Ls.toneMapping!==dw||Lr.isWebGL2===!0&&Ls.morphTargetsCount!==PS)&&(Eu=!0):Eu=!0:Eu=!0:Eu=!0:(Eu=!0,Ls.__version=is.version);let Np=Ls.currentProgram;Eu===!0&&(Np=y0(is,Zo,Xs));let gw=!1,j_=!1,Iy=!1;const Po=Np.getUniforms(),Fp=Ls.uniforms;if(Or.useProgram(Np.program)&&(gw=!0,j_=!0,Iy=!0),is.id!==Hr&&(Hr=is.id,j_=!0),gw||Nr!==Js){Po.setValue(Zr,"projectionMatrix",Js.projectionMatrix),Po.setValue(Zr,"viewMatrix",Js.matrixWorldInverse);const Oo=Po.map.cameraPosition;Oo!==void 0&&Oo.setValue(Zr,Fr.setFromMatrixPosition(Js.matrixWorld)),Lr.logarithmicDepthBuffer&&Po.setValue(Zr,"logDepthBufFC",2/(Math.log(Js.far+1)/Math.LN2)),(is.isMeshPhongMaterial||is.isMeshToonMaterial||is.isMeshLambertMaterial||is.isMeshBasicMaterial||is.isMeshStandardMaterial||is.isShaderMaterial)&&Po.setValue(Zr,"isOrthographic",Js.isOrthographicCamera===!0),Nr!==Js&&(Nr=Js,j_=!0,Iy=!0)}if(Xs.isSkinnedMesh){Po.setOptional(Zr,Xs,"bindMatrix"),Po.setOptional(Zr,Xs,"bindMatrixInverse");const Oo=Xs.skeleton;Oo&&(Lr.floatVertexTextures?(Oo.boneTexture===null&&Oo.computeBoneTexture(),Po.setValue(Zr,"boneTexture",Oo.boneTexture,An),Po.setValue(Zr,"boneTextureSize",Oo.boneTextureSize)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}const Ry=Vo.morphAttributes;var ru,zl;(Ry.position!==void 0||Ry.normal!==void 0||Ry.color!==void 0&&Lr.isWebGL2===!0)&&Ko.update(Xs,Vo,Np),(j_||Ls.receiveShadow!==Xs.receiveShadow)&&(Ls.receiveShadow=Xs.receiveShadow,Po.setValue(Zr,"receiveShadow",Xs.receiveShadow)),is.isMeshGouraudMaterial&&is.envMap!==null&&(Fp.envMap.value=b0,Fp.flipEnvMap.value=b0.isCubeTexture&&b0.isRenderTargetTexture===!1?-1:1),j_&&(Po.setValue(Zr,"toneMappingExposure",er.toneMappingExposure),Ls.needsLights&&(zl=Iy,(ru=Fp).ambientLightColor.needsUpdate=zl,ru.lightProbe.needsUpdate=zl,ru.directionalLights.needsUpdate=zl,ru.directionalLightShadows.needsUpdate=zl,ru.pointLights.needsUpdate=zl,ru.pointLightShadows.needsUpdate=zl,ru.spotLights.needsUpdate=zl,ru.spotLightShadows.needsUpdate=zl,ru.rectAreaLights.needsUpdate=zl,ru.hemisphereLights.needsUpdate=zl),U_&&is.fog===!0&&cs.refreshFogUniforms(Fp,U_),cs.refreshMaterialUniforms(Fp,is,cn,Dn,er.userData.transmissionRenderTarget||ls),Cv.upload(Zr,Ls.uniformsList,Fp,An)),is.isShaderMaterial&&is.uniformsNeedUpdate===!0&&(Cv.upload(Zr,Ls.uniformsList,Fp,An),is.uniformsNeedUpdate=!1),is.isSpriteMaterial&&Po.setValue(Zr,"center",Xs.center),Po.setValue(Zr,"modelViewMatrix",Xs.modelViewMatrix),Po.setValue(Zr,"normalMatrix",Xs.normalMatrix),Po.setValue(Zr,"modelMatrix",Xs.matrixWorld);const _w=is.extraUniformsToUpload;if(_w&&Object.entries(_w).forEach(([Oo,G_])=>Po.setValue(Zr,Oo,G_.value,An)),is.isShaderMaterial||is.isRawShaderMaterial){const Oo=is.uniformsGroups;for(let G_=0,MS=Oo.length;G_<MS;G_++)if(Lr.isWebGL2){const fw=Oo[G_];wu.update(fw,Np),wu.bind(fw,Np)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return Np}(Mr,_i,an,un,yn);Or.setMaterial(un,bs);let ps=an.index,vs=1;if(un.wireframe===!0){if(ps=Cn.getWireframeAttribute(an),ps===void 0)return;vs=2}const ys=an.drawRange,ss=an.attributes.position;let co=ys.start*vs,Jo=(ys.start+ys.count)*vs;Bn!==null&&(co=Math.max(co,Bn.start*vs),Jo=Math.min(Jo,(Bn.start+Bn.count)*vs)),ps!==null?(co=Math.max(co,0),Jo=Math.min(Jo,ps.count)):ss!=null&&(co=Math.max(co,0),Jo=Math.min(Jo,ss.count));const uo=Jo-co;if(uo<0||uo===1/0)return;let ep;Au.setup(yn,un,Yn,an,ps);let ga=us;if(ps!==null&&(ep=Zn.get(ps),ga=Gs,ga.setIndex(ep)),yn.isMesh)un.wireframe===!0?(Or.setLineWidth(un.wireframeLinewidth*Rr()),ga.setMode(Zr.LINES)):ga.setMode(Zr.TRIANGLES);else if(yn.isLine){let Js=un.linewidth;Js===void 0&&(Js=1),Or.setLineWidth(Js*Rr()),yn.isLineSegments?ga.setMode(Zr.LINES):yn.isLineLoop?ga.setMode(Zr.LINE_LOOP):ga.setMode(Zr.LINE_STRIP)}else yn.isPoints?ga.setMode(Zr.POINTS):yn.isSprite&&ga.setMode(Zr.TRIANGLES);if(yn.isInstancedMesh)ga.renderInstances(co,uo,yn.count);else if(an.isInstancedBufferGeometry){const Js=an._maxInstanceCount!==void 0?an._maxInstanceCount:1/0,Zo=Math.min(an.instanceCount,Js);ga.renderInstances(co,uo,Zo)}else ga.render(co,uo)},this.compile=function(Mr,_i){function an(un,yn,Bn){un.transparent===!0&&un.side===xt&&un.forceSinglePass===!1?(un.side=bt,un.needsUpdate=!0,y0(un,yn,Bn),un.side=ft,un.needsUpdate=!0,y0(un,yn,Bn),un.side=xt):y0(un,yn,Bn)}Xt=Bs.get(Mr),Xt.init(),Zt.push(Xt),Mr.traverseVisible(function(un){un.isLight&&un.layers.test(_i.layers)&&(Xt.pushLight(un),un.castShadow&&Xt.pushShadow(un))}),Xt.setupLights(er._useLegacyLights),Mr.traverse(function(un){const yn=un.material;if(yn)if(Array.isArray(yn))for(let Bn=0;Bn<yn.length;Bn++)an(yn[Bn],Mr,un);else an(yn,Mr,un)}),Zt.pop(),Xt=null};let My=null;function ow(){Op.stop()}function lw(){Op.start()}const Op=new Vy;function cw(Mr,_i,an,un){if(Mr.visible===!1)return;if(Mr.layers.test(_i.layers)){if(Mr.isGroup)an=Mr.renderOrder;else if(Mr.isLOD)Mr.autoUpdate===!0&&Mr.update(_i);else if(Mr.isLight)Xt.pushLight(Mr),Mr.castShadow&&Xt.pushShadow(Mr);else if(Mr.isSprite){if(!Mr.frustumCulled||ts.intersectsSprite(Mr)){un&&Fr.setFromMatrixPosition(Mr.matrixWorld).applyMatrix4(Br);const Bn=Jn.update(Mr),bs=Mr.material;bs.visible&&Jt.push(Mr,Bn,bs,an,Fr.z,null)}}else if((Mr.isMesh||Mr.isLine||Mr.isPoints)&&(!Mr.frustumCulled||ts.intersectsObject(Mr))){const Bn=Jn.update(Mr),bs=Mr.material;if(un&&(Mr.boundingSphere!==void 0?(Mr.boundingSphere===null&&Mr.computeBoundingSphere(),Fr.copy(Mr.boundingSphere.center)):(Bn.boundingSphere===null&&Bn.computeBoundingSphere(),Fr.copy(Bn.boundingSphere.center)),Fr.applyMatrix4(Mr.matrixWorld).applyMatrix4(Br)),Array.isArray(bs)){const Yn=Bn.groups;for(let ps=0,vs=Yn.length;ps<vs;ps++){const ys=Yn[ps],ss=bs[ys.materialIndex];ss&&ss.visible&&Jt.push(Mr,Bn,ss,an,Fr.z,ys)}}else bs.visible&&Jt.push(Mr,Bn,bs,an,Fr.z,null)}}const yn=Mr.children;for(let Bn=0,bs=yn.length;Bn<bs;Bn++)cw(yn[Bn],_i,an,un)}function uw(Mr,_i,an,un){const yn=Mr.opaque,Bn=Mr.transmissive,bs=Mr.transparent;if(Xt.setupLightsView(an),Xn===!0&&Ts.setGlobalState(er.clippingPlanes,an),er.userData.transmissionRender===void 0&&er.userData.renderTransmissionPass!==!1&&Bn.length>0&&function(Yn,ps,vs,ys){console.warn("three.js internal render transmission pass should not be called");const ss=Lr.isWebGL2;ls===null&&(ls=new Ao(1,1,{generateMipmaps:!0,type:_r.has("EXT_color_buffer_half_float")?ba:js,minFilter:Kn,samples:ss?4:0})),er.getDrawingBufferSize(wr),ss?ls.setSize(wr.x,wr.y):ls.setSize(mp(wr.x),mp(wr.y));const co=er.getRenderTarget();er.setRenderTarget(ls),er.getClearColor(gn),pn=er.getClearAlpha(),pn<1&&er.setClearColor(16777215,.5),er.clear();const Jo=er.toneMapping;er.toneMapping=ar,f0(Yn,vs,ys),An.updateMultisampleRenderTarget(ls),An.updateRenderTargetMipmap(ls);let uo=!1;for(let ep=0,ga=ps.length;ep<ga;ep++){const Js=ps[ep],Zo=Js.object,Vo=Js.geometry,is=Js.material,Xs=Js.group;if(is.side===xt&&Zo.layers.test(ys.layers)){const U_=is.side;is.side=bt,is.needsUpdate=!0,pw(Zo,vs,ys,Vo,is,Xs),is.side=U_,is.needsUpdate=!0,uo=!0}}uo===!0&&(An.updateMultisampleRenderTarget(ls),An.updateRenderTargetMipmap(ls)),er.setRenderTarget(co),er.setClearColor(gn,pn),er.toneMapping=Jo}([...yn,...bs],Bn,_i,an),un&&Or.viewport(zr.copy(un)),er.userData.opaqueRender!==!1&&yn.length>0&&f0(yn,_i,an),er.userData.transparentRender!==!1&&bs.length>0&&f0(bs,_i,an),er.userData.transmissionRender!==!1&&Bn.length>0){ls||(ls=new Ao(1,1));const Yn=(er.userData.transmissionRenderTarget||ls).texture,ps=Lr.isWebGL2,vs=Yn.generateMipmaps,ys=Yn.minFilter;ps&&er.userData.blurTransmissionTarget&&er.userData.transmissionRenderTarget&&(Yn.generateMipmaps=!0,Yn.minFilter=Kn,Yn.needsUpdate=!0,An.updateMultisampleRenderTarget(er.userData.transmissionRenderTarget),An.updateRenderTargetMipmap(er.userData.transmissionRenderTarget)),f0(Bn,_i,an),ps&&er.userData.blurTransmissionTarget&&er.userData.transmissionRenderTarget&&(Yn.generateMipmaps=vs,Yn.minFilter=ys,Yn.needsUpdate=!0,An.updateMultisampleRenderTarget(er.userData.transmissionRenderTarget),An.updateRenderTargetMipmap(er.userData.transmissionRenderTarget))}Or.buffers.depth.setTest(!0),Or.buffers.depth.setMask(!0),Or.buffers.color.setMask(!0),Or.setPolygonOffset(!1)}function f0(Mr,_i,an){const un={...er.userData};er.userData.opaqueRender=void 0,er.userData.transparentRender=void 0,er.userData.transmissionRender=void 0,er.userData.backgroundRender=void 0;const yn=_i.isScene===!0?_i.overrideMaterial:null;for(let Bn=0,bs=Mr.length;Bn<bs;Bn++){const Yn=Mr[Bn],ps=Yn.object,vs=Yn.geometry,ys=yn===null?Yn.material:yn,ss=Yn.group;ps.layers.test(an.layers)&&pw(ps,_i,an,vs,ys,ss)}Object.assign(er.userData,un)}function pw(Mr,_i,an,un,yn,Bn){Mr.onBeforeRender(er,_i,an,un,yn,Bn),Mr.modelViewMatrix.multiplyMatrices(an.matrixWorldInverse,Mr.matrixWorld),Mr.normalMatrix.getNormalMatrix(Mr.modelViewMatrix),yn.onBeforeRender(er,_i,an,un,Mr,Bn),yn.transparent===!0&&yn.side===xt&&yn.forceSinglePass===!1?(yn.side=bt,yn.needsUpdate=!0,er.renderBufferDirect(an,_i,un,yn,Mr,Bn),yn.side=ft,yn.needsUpdate=!0,er.renderBufferDirect(an,_i,un,yn,Mr,Bn),yn.side=xt):er.renderBufferDirect(an,_i,un,yn,Mr,Bn),Mr.onAfterRender(er,_i,an,un,yn,Bn),yn.onAfterRender(er,_i,an,un,Mr,Bn)}function y0(Mr,_i,an){_i.isScene!==!0&&(_i=Qr);const un=Yr.get(Mr),yn=Xt.state.lights,Bn=Xt.state.shadowsArray,bs=yn.state.version,Yn=Wn.getParameters(Mr,yn.state,Bn,_i,an),ps=Wn.getProgramCacheKey(Yn);let vs=un.programs;un.environment=Mr.userData&&Mr.userData.envMapSlotKey&&_i.textureSlots&&_i.textureSlots[Mr.userData.envMapSlotKey]?_i.textureSlots[Mr.userData.envMapSlotKey]:Mr.isMeshStandardMaterial?_i.environment:null,un.fog=_i.fog,un.envMap=(Mr.isMeshStandardMaterial?ds:hn).get(Mr.envMap||un.environment),vs===void 0&&(Mr.addEventListener("dispose",aw),vs=new Map,un.programs=vs);let ys=vs.get(ps);if(ys!==void 0){if(un.currentProgram===ys&&un.lightsStateVersion===bs)return hw(Mr,Yn),ys}else Yn.uniforms=Wn.getUniforms(Mr),Mr.onBuild(an,Yn,er),Mr.onBeforeCompile(Yn,er),ys=Wn.acquireProgram(Yn,ps),vs.set(ps,ys),un.uniforms=Yn.uniforms;const ss=un.uniforms;(Mr.isShaderMaterial||Mr.isRawShaderMaterial)&&Mr.clipping!==!0||(ss.clippingPlanes=Ts.uniform),hw(Mr,Yn),un.needsLights=function(uo){return uo.isMeshLambertMaterial||uo.isMeshToonMaterial||uo.isMeshPhongMaterial||uo.isMeshStandardMaterial||uo.isShadowMaterial||uo.isShaderMaterial&&uo.lights===!0}(Mr),un.lightsStateVersion=bs,un.needsLights&&(ss.ambientLightColor.value=yn.state.ambient,ss.lightProbe.value=yn.state.probe,ss.directionalLights.value=yn.state.directional,ss.directionalLightShadows.value=yn.state.directionalShadow,ss.spotLights.value=yn.state.spot,ss.spotLightShadows.value=yn.state.spotShadow,ss.rectAreaLights.value=yn.state.rectArea,ss.ltc_1.value=yn.state.rectAreaLTC1,ss.ltc_2.value=yn.state.rectAreaLTC2,ss.pointLights.value=yn.state.point,ss.pointLightShadows.value=yn.state.pointShadow,ss.hemisphereLights.value=yn.state.hemi,ss.directionalShadowMap.value=yn.state.directionalShadowMap,ss.directionalShadowMatrix.value=yn.state.directionalShadowMatrix,ss.spotShadowMap.value=yn.state.spotShadowMap,ss.spotLightMatrix.value=yn.state.spotLightMatrix,ss.spotLightMap.value=yn.state.spotLightMap,ss.pointShadowMap.value=yn.state.pointShadowMap,ss.pointShadowMatrix.value=yn.state.pointShadowMatrix);const co=ys.getUniforms(),Jo=Cv.seqWithValue(co.seq,ss);return un.currentProgram=ys,un.uniformsList=Jo,ys}function hw(Mr,_i){const an=Yr.get(Mr);an.outputColorSpace=_i.outputColorSpace,an.instancing=_i.instancing,an.instancingColor=_i.instancingColor,an.skinning=_i.skinning,an.morphTargets=_i.morphTargets,an.morphNormals=_i.morphNormals,an.morphColors=_i.morphColors,an.morphTargetsCount=_i.morphTargetsCount,an.numClippingPlanes=_i.numClippingPlanes,an.numIntersection=_i.numClipIntersection,an.vertexAlphas=_i.vertexAlphas,an.vertexTangents=_i.vertexTangents,an.toneMapping=_i.toneMapping}Op.setAnimationLoop(function(Mr){My&&My(Mr)}),typeof self<"u"&&Op.setContext(self),this.setAnimationLoop=function(Mr){My=Mr,Co.setAnimationLoop(Mr),Mr===null?Op.stop():Op.start()},Co.addEventListener("sessionstart",ow),Co.addEventListener("sessionend",lw),this.render=function(Mr,_i){if(_i===void 0||_i.isCamera===!0){if(xr!==!0){if(Mr.matrixWorldAutoUpdate===!0&&Mr.updateMatrixWorld(),_i.parent===null&&_i.matrixWorldAutoUpdate===!0&&_i.updateMatrixWorld(),Co.enabled===!0&&Co.isPresenting===!0&&(Co.cameraAutoUpdate===!0&&Co.updateCamera(_i),_i=Co.getCamera()),Mr.isScene===!0&&Mr.onBeforeRender(er,Mr,_i,Tr),Xt=Bs.get(Mr,Zt.length),Xt.init(),Zt.push(Xt),Br.multiplyMatrices(_i.projectionMatrix,_i.matrixWorldInverse),ts.setFromProjectionMatrix(Br),Fn=this.localClippingEnabled,Xn=Ts.init(this.clippingPlanes,Fn),Jt=fs.get(Mr,sr.length),Jt.init(),sr.push(Jt),cw(Mr,_i,0,er.sortObjects),Jt.finish(),er.sortObjects===!0&&Jt.sort($r,Kr),this.info.render.frame++,er.userData.shadowMapRender!==!1){Xn===!0&&Ts.beginShadows();const an=Xt.state.shadowsArray;an.length>0&&qn.render(an,Mr,_i),Xn===!0&&Ts.endShadows()}if(this.info.autoReset===!0&&this.info.reset(),er.userData.backgroundRender!==!1&&As.render(Jt,Mr),er.userData.sceneRender!==!1)if(Xt.setupLights(er._useLegacyLights),_i.isArrayCamera){const an=_i.cameras;for(let un=0,yn=an.length;un<yn;un++){const Bn=an[un];uw(Jt,Mr,Bn,Bn.viewport)}}else uw(Jt,Mr,_i);Tr!==null&&(An.updateMultisampleRenderTarget(Tr),An.updateRenderTargetMipmap(Tr)),Mr.isScene===!0&&Mr.onAfterRender(er,Mr,_i),Au.resetDefaultState(),Hr=-1,Nr=null,Zt.pop(),Xt=Zt.length>0?Zt[Zt.length-1]:null,sr.pop(),Jt=sr.length>0?sr[sr.length-1]:null}}else console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.getActiveCubeFace=function(){return Ar},this.getActiveMipmapLevel=function(){return yr},this.getRenderTarget=function(){return Tr},this.setRenderTargetTextures=function(Mr,_i,an){Yr.get(Mr.texture).__webglTexture=_i,Yr.get(Mr.depthTexture).__webglTexture=an;const un=Yr.get(Mr);un.__hasExternalTextures=!0,un.__hasExternalTextures&&(un.__autoAllocateDepthBuffer=an===void 0,un.__autoAllocateDepthBuffer||_r.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),un.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(Mr,_i){const an=Yr.get(Mr);an.__webglFramebuffer=_i,an.__useDefaultFramebuffer=_i===void 0},this.setRenderTarget=function(Mr,_i=0,an=0){Tr=Mr,Ar=_i,yr=an;let un=!0,yn=null,Bn=!1,bs=!1;if(Mr){const Yn=Yr.get(Mr);Yn.__useDefaultFramebuffer!==void 0?(Or.bindFramebuffer(Zr.FRAMEBUFFER,null),un=!1):Yn.__webglFramebuffer===void 0?An.setupRenderTarget(Mr):Yn.__hasExternalTextures&&An.rebindTextures(Mr,Yr.get(Mr.texture).__webglTexture,Yr.get(Mr.depthTexture).__webglTexture);const ps=Mr.texture;(ps.isData3DTexture||ps.isDataArrayTexture||ps.isCompressedArrayTexture)&&(bs=!0);const vs=Yr.get(Mr).__webglFramebuffer;Mr.isWebGLCubeRenderTarget?(yn=Array.isArray(vs[_i])?vs[_i][an]:vs[_i],Bn=!0):yn=Lr.isWebGL2&&Mr.samples>0&&An.useMultisampledRTT(Mr)===!1?Yr.get(Mr).__webglMultisampledFramebuffer:Array.isArray(vs)?vs[an]:vs,zr.copy(Mr.viewport),Gr.copy(Mr.scissor),Vr=Mr.scissorTest}else zr.copy(sn).multiplyScalar(cn).floor(),Gr.copy(nn).multiplyScalar(cn).floor(),Vr=Nn;if(Or.bindFramebuffer(Zr.FRAMEBUFFER,yn)&&Lr.drawBuffers&&un&&Or.drawBuffers(Mr,yn),Or.viewport(zr),Or.scissor(Gr),Or.setScissorTest(Vr),Bn){const Yn=Yr.get(Mr.texture);Zr.framebufferTexture2D(Zr.FRAMEBUFFER,Zr.COLOR_ATTACHMENT0,Zr.TEXTURE_CUBE_MAP_POSITIVE_X+_i,Yn.__webglTexture,an)}else if(bs){const Yn=Yr.get(Mr.texture),ps=_i||0;Zr.framebufferTextureLayer(Zr.FRAMEBUFFER,Zr.COLOR_ATTACHMENT0,Yn.__webglTexture,an||0,ps)}Hr=-1},this.readRenderTargetPixels=function(Mr,_i,an,un,yn,Bn,bs,Yn){if(!Mr||!Mr.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let ps=Yr.get(Mr).__webglFramebuffer;if(Mr.isWebGLCubeRenderTarget&&bs!==void 0&&(ps=ps[bs]),ps){Or.bindFramebuffer(Zr.FRAMEBUFFER,ps);try{const vs=Array.isArray(Mr.texture)?Mr.texture[Yn||0]:Mr.texture,ys=vs.format,ss=vs.type;if(ys!==io&&ws.convert(ys)!==Zr.getParameter(Zr.IMPLEMENTATION_COLOR_READ_FORMAT))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");const co=ss===ba&&(_r.has("EXT_color_buffer_half_float")||Lr.isWebGL2&&_r.has("EXT_color_buffer_float"));if(!(ss===js||ws.convert(ss)===Zr.getParameter(Zr.IMPLEMENTATION_COLOR_READ_TYPE)||ss===to&&(Lr.isWebGL2||_r.has("OES_texture_float")||_r.has("WEBGL_color_buffer_float"))||co))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");_i>=0&&_i<=Mr.width-un&&an>=0&&an<=Mr.height-yn&&(Mr.isWebGLMultipleRenderTargets&&Zr.readBuffer(Zr.COLOR_ATTACHMENT0+Yn),Zr.readPixels(_i,an,un,yn,ws.convert(ys),ws.convert(ss),Bn))}finally{const vs=Tr?Yr.get(Tr).__webglFramebuffer:null;Or.bindFramebuffer(Zr.FRAMEBUFFER,vs)}}},this.copyFramebufferToTexture=function(Mr,_i,an=0){const un=Math.pow(2,-an),yn=Math.floor(_i.image.width*un),Bn=Math.floor(_i.image.height*un);An.setTexture2D(_i,0),Zr.copyTexSubImage2D(Zr.TEXTURE_2D,an,0,0,Mr.x,Mr.y,yn,Bn),Or.unbindTexture()},this.copyTextureToTexture=function(Mr,_i,an,un=0){const yn=_i.image.width,Bn=_i.image.height,bs=ws.convert(an.format),Yn=ws.convert(an.type);An.setTexture2D(an,0),Zr.pixelStorei(Zr.UNPACK_FLIP_Y_WEBGL,an.flipY),Zr.pixelStorei(Zr.UNPACK_PREMULTIPLY_ALPHA_WEBGL,an.premultiplyAlpha),Zr.pixelStorei(Zr.UNPACK_ALIGNMENT,an.unpackAlignment),_i.isDataTexture?Zr.texSubImage2D(Zr.TEXTURE_2D,un,Mr.x,Mr.y,yn,Bn,bs,Yn,_i.image.data):_i.isCompressedTexture?Zr.compressedTexSubImage2D(Zr.TEXTURE_2D,un,Mr.x,Mr.y,_i.mipmaps[0].width,_i.mipmaps[0].height,bs,_i.mipmaps[0].data):Zr.texSubImage2D(Zr.TEXTURE_2D,un,Mr.x,Mr.y,bs,Yn,_i.image),un===0&&an.generateMipmaps&&Zr.generateMipmap(Zr.TEXTURE_2D),Or.unbindTexture()},this.copyTextureToTexture3D=function(Mr,_i,an,un,yn=0){if(er.isWebGL1Renderer)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");const Bn=Mr.max.x-Mr.min.x+1,bs=Mr.max.y-Mr.min.y+1,Yn=Mr.max.z-Mr.min.z+1,ps=ws.convert(un.format),vs=ws.convert(un.type);let ys;if(un.isData3DTexture)An.setTexture3D(un,0),ys=Zr.TEXTURE_3D;else{if(!un.isDataArrayTexture)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");An.setTexture2DArray(un,0),ys=Zr.TEXTURE_2D_ARRAY}Zr.pixelStorei(Zr.UNPACK_FLIP_Y_WEBGL,un.flipY),Zr.pixelStorei(Zr.UNPACK_PREMULTIPLY_ALPHA_WEBGL,un.premultiplyAlpha),Zr.pixelStorei(Zr.UNPACK_ALIGNMENT,un.unpackAlignment);const ss=Zr.getParameter(Zr.UNPACK_ROW_LENGTH),co=Zr.getParameter(Zr.UNPACK_IMAGE_HEIGHT),Jo=Zr.getParameter(Zr.UNPACK_SKIP_PIXELS),uo=Zr.getParameter(Zr.UNPACK_SKIP_ROWS),ep=Zr.getParameter(Zr.UNPACK_SKIP_IMAGES),ga=an.isCompressedTexture?an.mipmaps[0]:an.image;Zr.pixelStorei(Zr.UNPACK_ROW_LENGTH,ga.width),Zr.pixelStorei(Zr.UNPACK_IMAGE_HEIGHT,ga.height),Zr.pixelStorei(Zr.UNPACK_SKIP_PIXELS,Mr.min.x),Zr.pixelStorei(Zr.UNPACK_SKIP_ROWS,Mr.min.y),Zr.pixelStorei(Zr.UNPACK_SKIP_IMAGES,Mr.min.z),an.isDataTexture||an.isData3DTexture?Zr.texSubImage3D(ys,yn,_i.x,_i.y,_i.z,Bn,bs,Yn,ps,vs,ga.data):an.isCompressedArrayTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),Zr.compressedTexSubImage3D(ys,yn,_i.x,_i.y,_i.z,Bn,bs,Yn,ps,ga.data)):Zr.texSubImage3D(ys,yn,_i.x,_i.y,_i.z,Bn,bs,Yn,ps,vs,ga),Zr.pixelStorei(Zr.UNPACK_ROW_LENGTH,ss),Zr.pixelStorei(Zr.UNPACK_IMAGE_HEIGHT,co),Zr.pixelStorei(Zr.UNPACK_SKIP_PIXELS,Jo),Zr.pixelStorei(Zr.UNPACK_SKIP_ROWS,uo),Zr.pixelStorei(Zr.UNPACK_SKIP_IMAGES,ep),yn===0&&un.generateMipmaps&&Zr.generateMipmap(ys),Or.unbindTexture()},this.initTexture=function(Mr){Mr.isCubeTexture?An.setTextureCube(Mr,0):Mr.isData3DTexture?An.setTexture3D(Mr,0):Mr.isDataArrayTexture||Mr.isCompressedArrayTexture?An.setTexture2DArray(Mr,0):An.setTexture2D(Mr,0),Or.unbindTexture()},this.resetState=function(){Ar=0,yr=0,Tr=null,Or.reset(),Au.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return Uo}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(_e){this._outputColorSpace=_e;const at=this.getContext();at.drawingBufferColorSpace=_e===cp?"display-p3":"srgb",at.unpackColorSpace=Ms.workingColorSpace===lu?"display-p3":"srgb"}get physicallyCorrectLights(){return console.warn("THREE.WebGLRenderer: The property .physicallyCorrectLights has been removed. Set renderer.useLegacyLights instead."),!this.useLegacyLights}set physicallyCorrectLights(_e){console.warn("THREE.WebGLRenderer: The property .physicallyCorrectLights has been removed. Set renderer.useLegacyLights instead."),this.useLegacyLights=!_e}get outputEncoding(){return console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace===Os?Rl:Ys}set outputEncoding(_e){console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace=_e===Rl?Os:Ws}get useLegacyLights(){return console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733."),this._useLegacyLights}set useLegacyLights(_e){console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733."),this._useLegacyLights=_e}}class bx extends yx{}bx.prototype.isWebGL1Renderer=!0;class Pv{constructor(_e,at=25e-5){this.isFogExp2=!0,this.name="",this.color=new Un(_e),this.density=at}clone(){return new Pv(this.color,this.density)}toJSON(){return{type:"FogExp2",name:this.name,color:this.color.getHex(),density:this.density}}}class Tv{constructor(_e,at=1,pt=1e3){this.isFog=!0,this.name="",this.color=new Un(_e),this.near=at,this.far=pt}clone(){return new Tv(this.color,this.near,this.far)}toJSON(){return{type:"Fog",name:this.name,color:this.color.getHex(),near:this.near,far:this.far}}}class xx extends Ss{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(_e,at){return super.copy(_e,at),_e.background!==null&&(this.background=_e.background.clone()),_e.environment!==null&&(this.environment=_e.environment.clone()),_e.fog!==null&&(this.fog=_e.fog.clone()),this.backgroundBlurriness=_e.backgroundBlurriness,this.backgroundIntensity=_e.backgroundIntensity,_e.overrideMaterial!==null&&(this.overrideMaterial=_e.overrideMaterial.clone()),this.matrixAutoUpdate=_e.matrixAutoUpdate,this}toJSON(_e){const at=super.toJSON(_e);return this.fog!==null&&(at.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(at.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(at.object.backgroundIntensity=this.backgroundIntensity),at}}class Mv{constructor(_e,at){this.isInterleavedBuffer=!0,this.array=_e,this.stride=at,this.count=_e!==void 0?_e.length/at:0,this.usage=ku,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=xo()}onUploadCallback(){}set needsUpdate(_e){_e===!0&&this.version++}setUsage(_e){return this.usage=_e,this}copy(_e){return this.array=new _e.array.constructor(_e.array),this.count=_e.count,this.stride=_e.stride,this.usage=_e.usage,this}copyAt(_e,at,pt){_e*=this.stride,pt*=at.stride;for(let mt=0,vt=this.stride;mt<vt;mt++)this.array[_e+mt]=at.array[pt+mt];return this}set(_e,at=0){return this.array.set(_e,at),this}clone(_e){_e.arrayBuffers===void 0&&(_e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=xo()),_e.arrayBuffers[this.array.buffer._uuid]===void 0&&(_e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const at=new this.array.constructor(_e.arrayBuffers[this.array.buffer._uuid]),pt=new this.constructor(at,this.stride);return pt.setUsage(this.usage),pt}onUpload(_e){return this.onUploadCallback=_e,this}toJSON(_e){return _e.arrayBuffers===void 0&&(_e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=xo()),_e.arrayBuffers[this.array.buffer._uuid]===void 0&&(_e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const Bo=new Er;class Sp{constructor(_e,at,pt,mt=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=_e,this.itemSize=at,this.offset=pt,this.normalized=mt}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(_e){this.data.needsUpdate=_e}applyMatrix4(_e){for(let at=0,pt=this.data.count;at<pt;at++)Bo.fromBufferAttribute(this,at),Bo.applyMatrix4(_e),this.setXYZ(at,Bo.x,Bo.y,Bo.z);return this}applyNormalMatrix(_e){for(let at=0,pt=this.count;at<pt;at++)Bo.fromBufferAttribute(this,at),Bo.applyNormalMatrix(_e),this.setXYZ(at,Bo.x,Bo.y,Bo.z);return this}transformDirection(_e){for(let at=0,pt=this.count;at<pt;at++)Bo.fromBufferAttribute(this,at),Bo.transformDirection(_e),this.setXYZ(at,Bo.x,Bo.y,Bo.z);return this}setX(_e,at){return this.normalized&&(at=ns(at,this.array)),this.data.array[_e*this.data.stride+this.offset]=at,this}setY(_e,at){return this.normalized&&(at=ns(at,this.array)),this.data.array[_e*this.data.stride+this.offset+1]=at,this}setZ(_e,at){return this.normalized&&(at=ns(at,this.array)),this.data.array[_e*this.data.stride+this.offset+2]=at,this}setW(_e,at){return this.normalized&&(at=ns(at,this.array)),this.data.array[_e*this.data.stride+this.offset+3]=at,this}getX(_e){let at=this.data.array[_e*this.data.stride+this.offset];return this.normalized&&(at=go(at,this.array)),at}getY(_e){let at=this.data.array[_e*this.data.stride+this.offset+1];return this.normalized&&(at=go(at,this.array)),at}getZ(_e){let at=this.data.array[_e*this.data.stride+this.offset+2];return this.normalized&&(at=go(at,this.array)),at}getW(_e){let at=this.data.array[_e*this.data.stride+this.offset+3];return this.normalized&&(at=go(at,this.array)),at}setXY(_e,at,pt){return _e=_e*this.data.stride+this.offset,this.normalized&&(at=ns(at,this.array),pt=ns(pt,this.array)),this.data.array[_e+0]=at,this.data.array[_e+1]=pt,this}setXYZ(_e,at,pt,mt){return _e=_e*this.data.stride+this.offset,this.normalized&&(at=ns(at,this.array),pt=ns(pt,this.array),mt=ns(mt,this.array)),this.data.array[_e+0]=at,this.data.array[_e+1]=pt,this.data.array[_e+2]=mt,this}setXYZW(_e,at,pt,mt,vt){return _e=_e*this.data.stride+this.offset,this.normalized&&(at=ns(at,this.array),pt=ns(pt,this.array),mt=ns(mt,this.array),vt=ns(vt,this.array)),this.data.array[_e+0]=at,this.data.array[_e+1]=pt,this.data.array[_e+2]=mt,this.data.array[_e+3]=vt,this}clone(_e){if(_e===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const at=[];for(let pt=0;pt<this.count;pt++){const mt=pt*this.data.stride+this.offset;for(let vt=0;vt<this.itemSize;vt++)at.push(this.data.array[mt+vt])}return new mr(new this.array.constructor(at),this.itemSize,this.normalized)}return _e.interleavedBuffers===void 0&&(_e.interleavedBuffers={}),_e.interleavedBuffers[this.data.uuid]===void 0&&(_e.interleavedBuffers[this.data.uuid]=this.data.clone(_e)),new Sp(_e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(_e){if(_e===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const at=[];for(let pt=0;pt<this.count;pt++){const mt=pt*this.data.stride+this.offset;for(let vt=0;vt<this.itemSize;vt++)at.push(this.data.array[mt+vt])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:at,normalized:this.normalized}}return _e.interleavedBuffers===void 0&&(_e.interleavedBuffers={}),_e.interleavedBuffers[this.data.uuid]===void 0&&(_e.interleavedBuffers[this.data.uuid]=this.data.toJSON(_e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class W0 extends so{constructor(_e){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new Un(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(_e)}copy(_e){return super.copy(_e),this.color.copy(_e.color),this.map=_e.map,this.alphaMap=_e.alphaMap,this.rotation=_e.rotation,this.sizeAttenuation=_e.sizeAttenuation,this.fog=_e.fog,this}}let Am;const v_=new Er,wm=new Er,Em=new Er,Sm=new dn,y_=new dn,Ax=new rs,Iv=new Er,b_=new Er,Rv=new Er,wx=new dn,q0=new dn,Ex=new dn;class Sx extends Ss{constructor(_e=new W0){if(super(),this.isSprite=!0,this.type="Sprite",Am===void 0){Am=new _s;const at=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),pt=new Mv(at,5);Am.setIndex([0,1,2,0,2,3]),Am.setAttribute("position",new Sp(pt,3,0,!1)),Am.setAttribute("uv",new Sp(pt,2,3,!1))}this.geometry=Am,this.material=_e,this.center=new dn(.5,.5)}raycast(_e,at){_e.camera===null&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),wm.setFromMatrixScale(this.matrixWorld),Ax.copy(_e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(_e.camera.matrixWorldInverse,this.matrixWorld),Em.setFromMatrixPosition(this.modelViewMatrix),_e.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&wm.multiplyScalar(-Em.z);const pt=this.material.rotation;let mt,vt;pt!==0&&(vt=Math.cos(pt),mt=Math.sin(pt));const Ct=this.center;kv(Iv.set(-.5,-.5,0),Em,Ct,wm,mt,vt),kv(b_.set(.5,-.5,0),Em,Ct,wm,mt,vt),kv(Rv.set(.5,.5,0),Em,Ct,wm,mt,vt),wx.set(0,0),q0.set(1,0),Ex.set(1,1);let Tt=_e.ray.intersectTriangle(Iv,b_,Rv,!1,v_);if(Tt===null&&(kv(b_.set(-.5,.5,0),Em,Ct,wm,mt,vt),q0.set(0,1),Tt=_e.ray.intersectTriangle(Iv,Rv,b_,!1,v_),Tt===null))return;const Bt=_e.ray.origin.distanceTo(v_);Bt<_e.near||Bt>_e.far||at.push({distance:Bt,point:v_.clone(),uv:fo.getInterpolation(v_,Iv,b_,Rv,wx,q0,Ex,new dn),face:null,object:this})}copy(_e,at){return super.copy(_e,at),_e.center!==void 0&&this.center.copy(_e.center),this.material=_e.material,this}}function kv(Et,_e,at,pt,mt,vt){Sm.subVectors(Et,at).addScalar(.5).multiply(pt),mt!==void 0?(y_.x=vt*Sm.x-mt*Sm.y,y_.y=mt*Sm.x+vt*Sm.y):y_.copy(Sm),Et.copy(_e),Et.x+=y_.x,Et.y+=y_.y,Et.applyMatrix4(Ax)}const Dv=new Er,Cx=new Er;class Px extends Ss{constructor(){super(),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(_e){super.copy(_e,!1);const at=_e.levels;for(let pt=0,mt=at.length;pt<mt;pt++){const vt=at[pt];this.addLevel(vt.object.clone(),vt.distance,vt.hysteresis)}return this.autoUpdate=_e.autoUpdate,this}addLevel(_e,at=0,pt=0){at=Math.abs(at);const mt=this.levels;let vt;for(vt=0;vt<mt.length&&!(at<mt[vt].distance);vt++);return mt.splice(vt,0,{distance:at,hysteresis:pt,object:_e}),this.add(_e),this}getCurrentLevel(){return this._currentLevel}getObjectForDistance(_e){const at=this.levels;if(at.length>0){let pt,mt;for(pt=1,mt=at.length;pt<mt;pt++){let vt=at[pt].distance;if(at[pt].object.visible&&(vt-=vt*at[pt].hysteresis),_e<vt)break}return at[pt-1].object}return null}raycast(_e,at){if(this.levels.length>0){Dv.setFromMatrixPosition(this.matrixWorld);const pt=_e.ray.origin.distanceTo(Dv);this.getObjectForDistance(pt).raycast(_e,at)}}update(_e){const at=this.levels;if(at.length>1){Dv.setFromMatrixPosition(_e.matrixWorld),Cx.setFromMatrixPosition(this.matrixWorld);const pt=Dv.distanceTo(Cx)/_e.zoom;let mt,vt;for(at[0].object.visible=!0,mt=1,vt=at.length;mt<vt;mt++){let Ct=at[mt].distance;if(at[mt].object.visible&&(Ct-=Ct*at[mt].hysteresis),!(pt>=Ct))break;at[mt-1].object.visible=!1,at[mt].object.visible=!0}for(this._currentLevel=mt-1;mt<vt;mt++)at[mt].object.visible=!1}}toJSON(_e){const at=super.toJSON(_e);this.autoUpdate===!1&&(at.object.autoUpdate=!1),at.object.levels=[];const pt=this.levels;for(let mt=0,vt=pt.length;mt<vt;mt++){const Ct=pt[mt];at.object.levels.push({object:Ct.object.uuid,distance:Ct.distance,hysteresis:Ct.hysteresis})}return at}}const Tx=new Er,Mx=new Is,Ix=new Is,nE=new Er,Rx=new rs,Cm=new Er,$0=new jo,kx=new rs,X0=new ju;class Dx extends lo{constructor(_e,at){super(_e,at),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new rs,this.bindMatrixInverse=new rs,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const _e=this.geometry;this.boundingBox===null&&(this.boundingBox=new xl),this.boundingBox.makeEmpty();const at=_e.getAttribute("position");for(let pt=0;pt<at.count;pt++)Cm.fromBufferAttribute(at,pt),this.applyBoneTransform(pt,Cm),this.boundingBox.expandByPoint(Cm)}computeBoundingSphere(){const _e=this.geometry;this.boundingSphere===null&&(this.boundingSphere=new jo),this.boundingSphere.makeEmpty();const at=_e.getAttribute("position");for(let pt=0;pt<at.count;pt++)Cm.fromBufferAttribute(at,pt),this.applyBoneTransform(pt,Cm),this.boundingSphere.expandByPoint(Cm)}copy(_e,at){return super.copy(_e,at),this.bindMode=_e.bindMode,this.bindMatrix.copy(_e.bindMatrix),this.bindMatrixInverse.copy(_e.bindMatrixInverse),this.skeleton=_e.skeleton,_e.boundingBox!==null&&(this.boundingBox=_e.boundingBox.clone()),_e.boundingSphere!==null&&(this.boundingSphere=_e.boundingSphere.clone()),this}raycast(_e,at){const pt=this.material,mt=this.matrixWorld;pt!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),$0.copy(this.boundingSphere),$0.applyMatrix4(mt),_e.ray.intersectsSphere($0)!==!1&&(kx.copy(mt).invert(),X0.copy(_e.ray).applyMatrix4(kx),this.boundingBox!==null&&X0.intersectsBox(this.boundingBox)===!1||this._computeIntersections(_e,at,X0)))}getVertexPosition(_e,at){return super.getVertexPosition(_e,at),this.applyBoneTransform(_e,at),at}bind(_e,at){this.skeleton=_e,at===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),at=this.matrixWorld),this.bindMatrix.copy(at),this.bindMatrixInverse.copy(at).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const _e=new Is,at=this.geometry.attributes.skinWeight;for(let pt=0,mt=at.count;pt<mt;pt++){_e.fromBufferAttribute(at,pt);const vt=1/_e.manhattanLength();vt!==1/0?_e.multiplyScalar(vt):_e.set(1,0,0,0),at.setXYZW(pt,_e.x,_e.y,_e.z,_e.w)}}updateMatrixWorld(_e){super.updateMatrixWorld(_e),this.bindMode==="attached"?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode==="detached"?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(_e,at){const pt=this.skeleton,mt=this.geometry;Mx.fromBufferAttribute(mt.attributes.skinIndex,_e),Ix.fromBufferAttribute(mt.attributes.skinWeight,_e),Tx.copy(at).applyMatrix4(this.bindMatrix),at.set(0,0,0);for(let vt=0;vt<4;vt++){const Ct=Ix.getComponent(vt);if(Ct!==0){const Tt=Mx.getComponent(vt);Rx.multiplyMatrices(pt.bones[Tt].matrixWorld,pt.boneInverses[Tt]),at.addScaledVector(nE.copy(Tx).applyMatrix4(Rx),Ct)}}return at.applyMatrix4(this.bindMatrixInverse)}boneTransform(_e,at){return console.warn("THREE.SkinnedMesh: .boneTransform() was renamed to .applyBoneTransform() in r151."),this.applyBoneTransform(_e,at)}}class Y0 extends Ss{constructor(){super(),this.isBone=!0,this.type="Bone"}}class Pm extends Us{constructor(_e=null,at=1,pt=1,mt,vt,Ct,Tt,Bt,Lt=tn,Ut=tn,Qt,Ht){super(null,Ct,Tt,Bt,Lt,Ut,mt,vt,Qt,Ht),this.isDataTexture=!0,this.image={data:_e,width:at,height:pt},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const Bx=new rs,sE=new rs;class Bv{constructor(_e=[],at=[]){this.uuid=xo(),this.bones=_e.slice(0),this.boneInverses=at,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.init()}init(){const _e=this.bones,at=this.boneInverses;if(this.boneMatrices=new Float32Array(16*_e.length),at.length===0)this.calculateInverses();else if(_e.length!==at.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let pt=0,mt=this.bones.length;pt<mt;pt++)this.boneInverses.push(new rs)}}calculateInverses(){this.boneInverses.length=0;for(let _e=0,at=this.bones.length;_e<at;_e++){const pt=new rs;this.bones[_e]&&pt.copy(this.bones[_e].matrixWorld).invert(),this.boneInverses.push(pt)}}pose(){for(let _e=0,at=this.bones.length;_e<at;_e++){const pt=this.bones[_e];pt&&pt.matrixWorld.copy(this.boneInverses[_e]).invert()}for(let _e=0,at=this.bones.length;_e<at;_e++){const pt=this.bones[_e];pt&&(pt.parent&&pt.parent.isBone?(pt.matrix.copy(pt.parent.matrixWorld).invert(),pt.matrix.multiply(pt.matrixWorld)):pt.matrix.copy(pt.matrixWorld),pt.matrix.decompose(pt.position,pt.quaternion,pt.scale))}}update(){const _e=this.bones,at=this.boneInverses,pt=this.boneMatrices,mt=this.boneTexture;for(let vt=0,Ct=_e.length;vt<Ct;vt++){const Tt=_e[vt]?_e[vt].matrixWorld:sE;Bx.multiplyMatrices(Tt,at[vt]),Bx.toArray(pt,16*vt)}mt!==null&&(mt.needsUpdate=!0)}clone(){return new Bv(this.bones,this.boneInverses)}computeBoneTexture(){let _e=Math.sqrt(4*this.bones.length);_e=Ym(_e),_e=Math.max(_e,4);const at=new Float32Array(_e*_e*4);at.set(this.boneMatrices);const pt=new Pm(at,_e,_e,io,to);return pt.needsUpdate=!0,this.boneMatrices=at,this.boneTexture=pt,this.boneTextureSize=_e,this}getBoneByName(_e){for(let at=0,pt=this.bones.length;at<pt;at++){const mt=this.bones[at];if(mt.name===_e)return mt}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(_e,at){this.uuid=_e.uuid;for(let pt=0,mt=_e.bones.length;pt<mt;pt++){const vt=_e.bones[pt];let Ct=at[vt];Ct===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",vt),Ct=new Y0),this.bones.push(Ct),this.boneInverses.push(new rs().fromArray(_e.boneInverses[pt]))}return this.init(),this}toJSON(){const _e={metadata:{version:4.6,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};_e.uuid=this.uuid;const at=this.bones,pt=this.boneInverses;for(let mt=0,vt=at.length;mt<vt;mt++){const Ct=at[mt];_e.bones.push(Ct.uuid);const Tt=pt[mt];_e.boneInverses.push(Tt.toArray())}return _e}}class Tm extends mr{constructor(_e,at,pt,mt=1){super(_e,at,pt),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=mt}copy(_e){return super.copy(_e),this.meshPerAttribute=_e.meshPerAttribute,this}toJSON(){const _e=super.toJSON();return _e.meshPerAttribute=this.meshPerAttribute,_e.isInstancedBufferAttribute=!0,_e}}const Mm=new rs,Lx=new rs,Lv=[],Ox=new xl,aE=new rs,x_=new lo,A_=new jo;class Nx extends lo{constructor(_e,at,pt){super(_e,at),this.isInstancedMesh=!0,this.instanceMatrix=new Tm(new Float32Array(16*pt),16),this.instanceColor=null,this.sourceTrs=null,this.count=pt,this.boundingBox=null,this.boundingSphere=null;for(let mt=0;mt<pt;mt++)this.setMatrixAt(mt,aE)}computeBoundingBox(){const _e=this.geometry,at=this.count;this.boundingBox===null&&(this.boundingBox=new xl),_e.boundingBox===null&&_e.computeBoundingBox(),this.boundingBox.makeEmpty();for(let pt=0;pt<at;pt++)this.getMatrixAt(pt,Mm),Ox.copy(_e.boundingBox).applyMatrix4(Mm),this.boundingBox.union(Ox)}computeBoundingSphere(){const _e=this.geometry,at=this.count;this.boundingSphere===null&&(this.boundingSphere=new jo),_e.boundingSphere===null&&_e.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let pt=0;pt<at;pt++)this.getMatrixAt(pt,Mm),A_.copy(_e.boundingSphere).applyMatrix4(Mm),this.boundingSphere.union(A_)}copy(_e,at){return super.copy(_e,at),_e.isInstancedMesh?(this.instanceMatrix.copy(_e.instanceMatrix),_e.instanceColor!==null&&(this.instanceColor=_e.instanceColor.clone()),this.count=_e.count,_e.boundingBox!==null&&(this.boundingBox=_e.boundingBox.clone()),_e.boundingSphere!==null&&(this.boundingSphere=_e.boundingSphere.clone()),this):this}getColorAt(_e,at){at.fromArray(this.instanceColor.array,3*_e)}getMatrixAt(_e,at){at.fromArray(this.instanceMatrix.array,16*_e)}raycast(_e,at){const pt=this.matrixWorld,mt=this.count;if(x_.geometry=this.geometry,x_.material=this.material,x_.material!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),A_.copy(this.boundingSphere),A_.applyMatrix4(pt),_e.ray.intersectsSphere(A_)!==!1))for(let vt=0;vt<mt;vt++){this.getMatrixAt(vt,Mm),Lx.multiplyMatrices(pt,Mm),x_.matrixWorld=Lx,x_.raycast(_e,Lv);for(let Ct=0,Tt=Lv.length;Ct<Tt;Ct++){const Bt=Lv[Ct];Bt.instanceId=vt,Bt.object=this,at.push(Bt)}Lv.length=0}}setColorAt(_e,at){this.instanceColor===null&&(this.instanceColor=new Tm(new Float32Array(3*this.instanceMatrix.count),3)),at.toArray(this.instanceColor.array,3*_e)}setMatrixAt(_e,at){at.toArray(this.instanceMatrix.array,16*_e)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}class Lo extends so{constructor(_e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new Un(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(_e)}copy(_e){return super.copy(_e),this.color.copy(_e.color),this.map=_e.map,this.linewidth=_e.linewidth,this.linecap=_e.linecap,this.linejoin=_e.linejoin,this.fog=_e.fog,this}}const Fx=new Er,Ux=new Er,jx=new rs,K0=new ju,Ov=new jo;class Yu extends Ss{constructor(_e=new _s,at=new Lo){super(),this.isLine=!0,this.type="Line",this.geometry=_e,this.material=at,this.updateMorphTargets()}copy(_e,at){return super.copy(_e,at),this.material=Array.isArray(_e.material)?_e.material.slice():_e.material,this.geometry=_e.geometry,this}computeLineDistances(){const _e=this.geometry;if(_e.index===null){const at=_e.attributes.position,pt=[0];for(let mt=1,vt=at.count;mt<vt;mt++)Fx.fromBufferAttribute(at,mt-1),Ux.fromBufferAttribute(at,mt),pt[mt]=pt[mt-1],pt[mt]+=Fx.distanceTo(Ux);_e.setAttribute("lineDistance",new Ln(pt,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(_e,at){const pt=this.geometry,mt=this.matrixWorld,vt=_e.params.Line.threshold,Ct=pt.drawRange;if(pt.boundingSphere===null&&pt.computeBoundingSphere(),Ov.copy(pt.boundingSphere),Ov.applyMatrix4(mt),Ov.radius+=vt,_e.ray.intersectsSphere(Ov)===!1)return;jx.copy(mt).invert(),K0.copy(_e.ray).applyMatrix4(jx);const Tt=vt/((this.scale.x+this.scale.y+this.scale.z)/3),Bt=Tt*Tt,Lt=new Er,Ut=new Er,Qt=new Er,Ht=new Er,Wt=this.isLineSegments?2:1,qt=pt.index,Jt=pt.attributes.position;if(qt!==null)for(let Xt=Math.max(0,Ct.start),sr=Math.min(qt.count,Ct.start+Ct.count)-1;Xt<sr;Xt+=Wt){const Zt=qt.getX(Xt),er=qt.getX(Xt+1);if(Lt.fromBufferAttribute(Jt,Zt),Ut.fromBufferAttribute(Jt,er),K0.distanceSqToSegment(Lt,Ut,Ht,Qt)>Bt)continue;Ht.applyMatrix4(this.matrixWorld);const xr=_e.ray.origin.distanceTo(Ht);xr<_e.near||xr>_e.far||at.push({distance:xr,point:Qt.clone().applyMatrix4(this.matrixWorld),index:Xt,face:null,faceIndex:null,object:this})}else for(let Xt=Math.max(0,Ct.start),sr=Math.min(Jt.count,Ct.start+Ct.count)-1;Xt<sr;Xt+=Wt){if(Lt.fromBufferAttribute(Jt,Xt),Ut.fromBufferAttribute(Jt,Xt+1),K0.distanceSqToSegment(Lt,Ut,Ht,Qt)>Bt)continue;Ht.applyMatrix4(this.matrixWorld);const Zt=_e.ray.origin.distanceTo(Ht);Zt<_e.near||Zt>_e.far||at.push({distance:Zt,point:Qt.clone().applyMatrix4(this.matrixWorld),index:Xt,face:null,faceIndex:null,object:this})}}updateMorphTargets(){const _e=this.geometry.morphAttributes,at=Object.keys(_e);if(at.length>0){const pt=_e[at[0]];if(pt!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let mt=0,vt=pt.length;mt<vt;mt++){const Ct=pt[mt].name||String(mt);this.morphTargetInfluences.push(0),this.morphTargetDictionary[Ct]=mt}}}}}const Gx=new Er,zx=new Er;class _c extends Yu{constructor(_e,at){super(_e,at),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const _e=this.geometry;if(_e.index===null){const at=_e.attributes.position,pt=[];for(let mt=0,vt=at.count;mt<vt;mt+=2)Gx.fromBufferAttribute(at,mt),zx.fromBufferAttribute(at,mt+1),pt[mt]=mt===0?0:pt[mt-1],pt[mt+1]=pt[mt]+Gx.distanceTo(zx);_e.setAttribute("lineDistance",new Ln(pt,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class Vx extends Yu{constructor(_e,at){super(_e,at),this.isLineLoop=!0,this.type="LineLoop"}}class J0 extends so{constructor(_e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new Un(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(_e)}copy(_e){return super.copy(_e),this.color.copy(_e.color),this.map=_e.map,this.alphaMap=_e.alphaMap,this.size=_e.size,this.sizeAttenuation=_e.sizeAttenuation,this.fog=_e.fog,this}}const Hx=new rs,Z0=new ju,Nv=new jo,Fv=new Er;class Qx extends Ss{constructor(_e=new _s,at=new J0){super(),this.isPoints=!0,this.type="Points",this.geometry=_e,this.material=at,this.updateMorphTargets()}copy(_e,at){return super.copy(_e,at),this.material=Array.isArray(_e.material)?_e.material.slice():_e.material,this.geometry=_e.geometry,this}raycast(_e,at){const pt=this.geometry,mt=this.matrixWorld,vt=_e.params.Points.threshold,Ct=pt.drawRange;if(pt.boundingSphere===null&&pt.computeBoundingSphere(),Nv.copy(pt.boundingSphere),Nv.applyMatrix4(mt),Nv.radius+=vt,_e.ray.intersectsSphere(Nv)===!1)return;Hx.copy(mt).invert(),Z0.copy(_e.ray).applyMatrix4(Hx);const Tt=vt/((this.scale.x+this.scale.y+this.scale.z)/3),Bt=Tt*Tt,Lt=pt.index,Ut=pt.attributes.position;if(Lt!==null)for(let Qt=Math.max(0,Ct.start),Ht=Math.min(Lt.count,Ct.start+Ct.count);Qt<Ht;Qt++){const Wt=Lt.getX(Qt);Fv.fromBufferAttribute(Ut,Wt),Wx(Fv,Wt,Bt,mt,_e,at,this)}else for(let Qt=Math.max(0,Ct.start),Ht=Math.min(Ut.count,Ct.start+Ct.count);Qt<Ht;Qt++)Fv.fromBufferAttribute(Ut,Qt),Wx(Fv,Qt,Bt,mt,_e,at,this)}updateMorphTargets(){const _e=this.geometry.morphAttributes,at=Object.keys(_e);if(at.length>0){const pt=_e[at[0]];if(pt!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let mt=0,vt=pt.length;mt<vt;mt++){const Ct=pt[mt].name||String(mt);this.morphTargetInfluences.push(0),this.morphTargetDictionary[Ct]=mt}}}}}function Wx(Et,_e,at,pt,mt,vt,Ct){const Tt=Z0.distanceSqToPoint(Et);if(Tt<at){const Bt=new Er;Z0.closestPointToPoint(Et,Bt),Bt.applyMatrix4(pt);const Lt=mt.ray.origin.distanceTo(Bt);if(Lt<mt.near||Lt>mt.far)return;vt.push({distance:Lt,distanceToRay:Math.sqrt(Tt),point:Bt,index:_e,face:null,object:Ct})}}class oE extends Us{constructor(_e,at,pt,mt,vt,Ct,Tt,Bt,Lt){super(_e,at,pt,mt,vt,Ct,Tt,Bt,Lt),this.isVideoTexture=!0,this.minFilter=Ct!==void 0?Ct:Qn,this.magFilter=vt!==void 0?vt:Qn,this.generateMipmaps=!1;const Ut=this;"requestVideoFrameCallback"in _e&&_e.requestVideoFrameCallback(function Qt(){Ut.needsUpdate=!0,_e.requestVideoFrameCallback(Qt)})}clone(){return new this.constructor(this.image).copy(this)}update(){const _e=this.image;!("requestVideoFrameCallback"in _e)&&_e.readyState>=_e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}class lE extends Us{constructor(_e,at){super({width:_e,height:at}),this.isFramebufferTexture=!0,this.magFilter=tn,this.minFilter=tn,this.generateMipmaps=!1,this.needsUpdate=!0}}class Uv extends Us{constructor(_e,at,pt,mt,vt,Ct,Tt,Bt,Lt,Ut,Qt,Ht){super(null,Ct,Tt,Bt,Lt,Ut,mt,vt,Qt,Ht),this.isCompressedTexture=!0,this.image={width:at,height:pt},this.mipmaps=_e,this.flipY=!1,this.generateMipmaps=!1}}class cE extends Uv{constructor(_e,at,pt,mt,vt,Ct){super(_e,at,pt,vt,Ct),this.isCompressedArrayTexture=!0,this.image.depth=mt,this.wrapR=fn}}class uE extends Uv{constructor(_e,at,pt){super(void 0,_e[0].width,_e[0].height,at,pt,en),this.isCompressedCubeTexture=!0,this.isCubeTexture=!0,this.image=_e}}class pE extends Us{constructor(_e,at,pt,mt,vt,Ct,Tt,Bt,Lt){super(_e,at,pt,mt,vt,Ct,Tt,Bt,Lt),this.isCanvasTexture=!0,this.needsUpdate=!0}}class Ul{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(_e,at){const pt=this.getUtoTmapping(_e);return this.getPoint(pt,at)}getPoints(_e=5){const at=[];for(let pt=0;pt<=_e;pt++)at.push(this.getPoint(pt/_e));return at}getSpacedPoints(_e=5){const at=[];for(let pt=0;pt<=_e;pt++)at.push(this.getPointAt(pt/_e));return at}getLength(){const _e=this.getLengths();return _e[_e.length-1]}getLengths(_e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===_e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const at=[];let pt,mt=this.getPoint(0),vt=0;at.push(0);for(let Ct=1;Ct<=_e;Ct++)pt=this.getPoint(Ct/_e),vt+=pt.distanceTo(mt),at.push(vt),mt=pt;return this.cacheArcLengths=at,at}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(_e,at){const pt=this.getLengths();let mt=0;const vt=pt.length;let Ct;Ct=at||_e*pt[vt-1];let Tt,Bt=0,Lt=vt-1;for(;Bt<=Lt;)if(mt=Math.floor(Bt+(Lt-Bt)/2),Tt=pt[mt]-Ct,Tt<0)Bt=mt+1;else{if(!(Tt>0)){Lt=mt;break}Lt=mt-1}if(mt=Lt,pt[mt]===Ct)return mt/(vt-1);const Ut=pt[mt];return(mt+(Ct-Ut)/(pt[mt+1]-Ut))/(vt-1)}getTangent(_e,at){let pt=_e-1e-4,mt=_e+1e-4;pt<0&&(pt=0),mt>1&&(mt=1);const vt=this.getPoint(pt),Ct=this.getPoint(mt),Tt=at||(vt.isVector2?new dn:new Er);return Tt.copy(Ct).sub(vt).normalize(),Tt}getTangentAt(_e,at){const pt=this.getUtoTmapping(_e);return this.getTangent(pt,at)}computeFrenetFrames(_e,at){const pt=new Er,mt=[],vt=[],Ct=[],Tt=new Er,Bt=new rs;for(let Wt=0;Wt<=_e;Wt++){const qt=Wt/_e;mt[Wt]=this.getTangentAt(qt,new Er)}vt[0]=new Er,Ct[0]=new Er;let Lt=Number.MAX_VALUE;const Ut=Math.abs(mt[0].x),Qt=Math.abs(mt[0].y),Ht=Math.abs(mt[0].z);Ut<=Lt&&(Lt=Ut,pt.set(1,0,0)),Qt<=Lt&&(Lt=Qt,pt.set(0,1,0)),Ht<=Lt&&pt.set(0,0,1),Tt.crossVectors(mt[0],pt).normalize(),vt[0].crossVectors(mt[0],Tt),Ct[0].crossVectors(mt[0],vt[0]);for(let Wt=1;Wt<=_e;Wt++){if(vt[Wt]=vt[Wt-1].clone(),Ct[Wt]=Ct[Wt-1].clone(),Tt.crossVectors(mt[Wt-1],mt[Wt]),Tt.length()>Number.EPSILON){Tt.normalize();const qt=Math.acos(Hs(mt[Wt-1].dot(mt[Wt]),-1,1));vt[Wt].applyMatrix4(Bt.makeRotationAxis(Tt,qt))}Ct[Wt].crossVectors(mt[Wt],vt[Wt])}if(at===!0){let Wt=Math.acos(Hs(vt[0].dot(vt[_e]),-1,1));Wt/=_e,mt[0].dot(Tt.crossVectors(vt[0],vt[_e]))>0&&(Wt=-Wt);for(let qt=1;qt<=_e;qt++)vt[qt].applyMatrix4(Bt.makeRotationAxis(mt[qt],Wt*qt)),Ct[qt].crossVectors(mt[qt],vt[qt])}return{tangents:mt,normals:vt,binormals:Ct}}clone(){return new this.constructor().copy(this)}copy(_e){return this.arcLengthDivisions=_e.arcLengthDivisions,this}toJSON(){const _e={metadata:{version:4.6,type:"Curve",generator:"Curve.toJSON"}};return _e.arcLengthDivisions=this.arcLengthDivisions,_e.type=this.type,_e}fromJSON(_e){return this.arcLengthDivisions=_e.arcLengthDivisions,this}}class jv extends Ul{constructor(_e=0,at=0,pt=1,mt=1,vt=0,Ct=2*Math.PI,Tt=!1,Bt=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=_e,this.aY=at,this.xRadius=pt,this.yRadius=mt,this.aStartAngle=vt,this.aEndAngle=Ct,this.aClockwise=Tt,this.aRotation=Bt}getPoint(_e,at){const pt=at||new dn,mt=2*Math.PI;let vt=this.aEndAngle-this.aStartAngle;const Ct=Math.abs(vt)<Number.EPSILON;for(;vt<0;)vt+=mt;for(;vt>mt;)vt-=mt;vt<Number.EPSILON&&(vt=Ct?0:mt),this.aClockwise!==!0||Ct||(vt===mt?vt=-mt:vt-=mt);const Tt=this.aStartAngle+_e*vt;let Bt=this.aX+this.xRadius*Math.cos(Tt),Lt=this.aY+this.yRadius*Math.sin(Tt);if(this.aRotation!==0){const Ut=Math.cos(this.aRotation),Qt=Math.sin(this.aRotation),Ht=Bt-this.aX,Wt=Lt-this.aY;Bt=Ht*Ut-Wt*Qt+this.aX,Lt=Ht*Qt+Wt*Ut+this.aY}return pt.set(Bt,Lt)}copy(_e){return super.copy(_e),this.aX=_e.aX,this.aY=_e.aY,this.xRadius=_e.xRadius,this.yRadius=_e.yRadius,this.aStartAngle=_e.aStartAngle,this.aEndAngle=_e.aEndAngle,this.aClockwise=_e.aClockwise,this.aRotation=_e.aRotation,this}toJSON(){const _e=super.toJSON();return _e.aX=this.aX,_e.aY=this.aY,_e.xRadius=this.xRadius,_e.yRadius=this.yRadius,_e.aStartAngle=this.aStartAngle,_e.aEndAngle=this.aEndAngle,_e.aClockwise=this.aClockwise,_e.aRotation=this.aRotation,_e}fromJSON(_e){return super.fromJSON(_e),this.aX=_e.aX,this.aY=_e.aY,this.xRadius=_e.xRadius,this.yRadius=_e.yRadius,this.aStartAngle=_e.aStartAngle,this.aEndAngle=_e.aEndAngle,this.aClockwise=_e.aClockwise,this.aRotation=_e.aRotation,this}}class qx extends jv{constructor(_e,at,pt,mt,vt,Ct){super(_e,at,pt,pt,mt,vt,Ct),this.isArcCurve=!0,this.type="ArcCurve"}}function ey(){let Et=0,_e=0,at=0,pt=0;function mt(vt,Ct,Tt,Bt){Et=vt,_e=Tt,at=-3*vt+3*Ct-2*Tt-Bt,pt=2*vt-2*Ct+Tt+Bt}return{initCatmullRom:function(vt,Ct,Tt,Bt,Lt){mt(Ct,Tt,Lt*(Tt-vt),Lt*(Bt-Ct))},initNonuniformCatmullRom:function(vt,Ct,Tt,Bt,Lt,Ut,Qt){let Ht=(Ct-vt)/Lt-(Tt-vt)/(Lt+Ut)+(Tt-Ct)/Ut,Wt=(Tt-Ct)/Ut-(Bt-Ct)/(Ut+Qt)+(Bt-Tt)/Qt;Ht*=Ut,Wt*=Ut,mt(Ct,Tt,Ht,Wt)},calc:function(vt){const Ct=vt*vt;return Et+_e*vt+at*Ct+pt*(Ct*vt)}}}const Gv=new Er,ty=new ey,ry=new ey,iy=new ey;class $x extends Ul{constructor(_e=[],at=!1,pt="centripetal",mt=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=_e,this.closed=at,this.curveType=pt,this.tension=mt}getPoint(_e,at=new Er){const pt=at,mt=this.points,vt=mt.length,Ct=(vt-(this.closed?0:1))*_e;let Tt,Bt,Lt=Math.floor(Ct),Ut=Ct-Lt;this.closed?Lt+=Lt>0?0:(Math.floor(Math.abs(Lt)/vt)+1)*vt:Ut===0&&Lt===vt-1&&(Lt=vt-2,Ut=1),this.closed||Lt>0?Tt=mt[(Lt-1)%vt]:(Gv.subVectors(mt[0],mt[1]).add(mt[0]),Tt=Gv);const Qt=mt[Lt%vt],Ht=mt[(Lt+1)%vt];if(this.closed||Lt+2<vt?Bt=mt[(Lt+2)%vt]:(Gv.subVectors(mt[vt-1],mt[vt-2]).add(mt[vt-1]),Bt=Gv),this.curveType==="centripetal"||this.curveType==="chordal"){const Wt=this.curveType==="chordal"?.5:.25;let qt=Math.pow(Tt.distanceToSquared(Qt),Wt),Jt=Math.pow(Qt.distanceToSquared(Ht),Wt),Xt=Math.pow(Ht.distanceToSquared(Bt),Wt);Jt<1e-4&&(Jt=1),qt<1e-4&&(qt=Jt),Xt<1e-4&&(Xt=Jt),ty.initNonuniformCatmullRom(Tt.x,Qt.x,Ht.x,Bt.x,qt,Jt,Xt),ry.initNonuniformCatmullRom(Tt.y,Qt.y,Ht.y,Bt.y,qt,Jt,Xt),iy.initNonuniformCatmullRom(Tt.z,Qt.z,Ht.z,Bt.z,qt,Jt,Xt)}else this.curveType==="catmullrom"&&(ty.initCatmullRom(Tt.x,Qt.x,Ht.x,Bt.x,this.tension),ry.initCatmullRom(Tt.y,Qt.y,Ht.y,Bt.y,this.tension),iy.initCatmullRom(Tt.z,Qt.z,Ht.z,Bt.z,this.tension));return pt.set(ty.calc(Ut),ry.calc(Ut),iy.calc(Ut)),pt}copy(_e){super.copy(_e),this.points=[];for(let at=0,pt=_e.points.length;at<pt;at++){const mt=_e.points[at];this.points.push(mt.clone())}return this.closed=_e.closed,this.curveType=_e.curveType,this.tension=_e.tension,this}toJSON(){const _e=super.toJSON();_e.points=[];for(let at=0,pt=this.points.length;at<pt;at++){const mt=this.points[at];_e.points.push(mt.toArray())}return _e.closed=this.closed,_e.curveType=this.curveType,_e.tension=this.tension,_e}fromJSON(_e){super.fromJSON(_e),this.points=[];for(let at=0,pt=_e.points.length;at<pt;at++){const mt=_e.points[at];this.points.push(new Er().fromArray(mt))}return this.closed=_e.closed,this.curveType=_e.curveType,this.tension=_e.tension,this}}function Xx(Et,_e,at,pt,mt){const vt=.5*(pt-_e),Ct=.5*(mt-at),Tt=Et*Et;return(2*at-2*pt+vt+Ct)*(Et*Tt)+(-3*at+3*pt-2*vt-Ct)*Tt+vt*Et+at}function w_(Et,_e,at,pt){return function(mt,vt){const Ct=1-mt;return Ct*Ct*vt}(Et,_e)+function(mt,vt){return 2*(1-mt)*mt*vt}(Et,at)+function(mt,vt){return mt*mt*vt}(Et,pt)}function E_(Et,_e,at,pt,mt){return function(vt,Ct){const Tt=1-vt;return Tt*Tt*Tt*Ct}(Et,_e)+function(vt,Ct){const Tt=1-vt;return 3*Tt*Tt*vt*Ct}(Et,at)+function(vt,Ct){return 3*(1-vt)*vt*vt*Ct}(Et,pt)+function(vt,Ct){return vt*vt*vt*Ct}(Et,mt)}class ny extends Ul{constructor(_e=new dn,at=new dn,pt=new dn,mt=new dn){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=_e,this.v1=at,this.v2=pt,this.v3=mt}getPoint(_e,at=new dn){const pt=at,mt=this.v0,vt=this.v1,Ct=this.v2,Tt=this.v3;return pt.set(E_(_e,mt.x,vt.x,Ct.x,Tt.x),E_(_e,mt.y,vt.y,Ct.y,Tt.y)),pt}copy(_e){return super.copy(_e),this.v0.copy(_e.v0),this.v1.copy(_e.v1),this.v2.copy(_e.v2),this.v3.copy(_e.v3),this}toJSON(){const _e=super.toJSON();return _e.v0=this.v0.toArray(),_e.v1=this.v1.toArray(),_e.v2=this.v2.toArray(),_e.v3=this.v3.toArray(),_e}fromJSON(_e){return super.fromJSON(_e),this.v0.fromArray(_e.v0),this.v1.fromArray(_e.v1),this.v2.fromArray(_e.v2),this.v3.fromArray(_e.v3),this}}class Yx extends Ul{constructor(_e=new Er,at=new Er,pt=new Er,mt=new Er){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=_e,this.v1=at,this.v2=pt,this.v3=mt}getPoint(_e,at=new Er){const pt=at,mt=this.v0,vt=this.v1,Ct=this.v2,Tt=this.v3;return pt.set(E_(_e,mt.x,vt.x,Ct.x,Tt.x),E_(_e,mt.y,vt.y,Ct.y,Tt.y),E_(_e,mt.z,vt.z,Ct.z,Tt.z)),pt}copy(_e){return super.copy(_e),this.v0.copy(_e.v0),this.v1.copy(_e.v1),this.v2.copy(_e.v2),this.v3.copy(_e.v3),this}toJSON(){const _e=super.toJSON();return _e.v0=this.v0.toArray(),_e.v1=this.v1.toArray(),_e.v2=this.v2.toArray(),_e.v3=this.v3.toArray(),_e}fromJSON(_e){return super.fromJSON(_e),this.v0.fromArray(_e.v0),this.v1.fromArray(_e.v1),this.v2.fromArray(_e.v2),this.v3.fromArray(_e.v3),this}}class sy extends Ul{constructor(_e=new dn,at=new dn){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=_e,this.v2=at}getPoint(_e,at=new dn){const pt=at;return _e===1?pt.copy(this.v2):(pt.copy(this.v2).sub(this.v1),pt.multiplyScalar(_e).add(this.v1)),pt}getPointAt(_e,at){return this.getPoint(_e,at)}getTangent(_e,at=new dn){return at.subVectors(this.v2,this.v1).normalize()}getTangentAt(_e,at){return this.getTangent(_e,at)}copy(_e){return super.copy(_e),this.v1.copy(_e.v1),this.v2.copy(_e.v2),this}toJSON(){const _e=super.toJSON();return _e.v1=this.v1.toArray(),_e.v2=this.v2.toArray(),_e}fromJSON(_e){return super.fromJSON(_e),this.v1.fromArray(_e.v1),this.v2.fromArray(_e.v2),this}}class Kx extends Ul{constructor(_e=new Er,at=new Er){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=_e,this.v2=at}getPoint(_e,at=new Er){const pt=at;return _e===1?pt.copy(this.v2):(pt.copy(this.v2).sub(this.v1),pt.multiplyScalar(_e).add(this.v1)),pt}getPointAt(_e,at){return this.getPoint(_e,at)}getTangent(_e,at=new Er){return at.subVectors(this.v2,this.v1).normalize()}getTangentAt(_e,at){return this.getTangent(_e,at)}copy(_e){return super.copy(_e),this.v1.copy(_e.v1),this.v2.copy(_e.v2),this}toJSON(){const _e=super.toJSON();return _e.v1=this.v1.toArray(),_e.v2=this.v2.toArray(),_e}fromJSON(_e){return super.fromJSON(_e),this.v1.fromArray(_e.v1),this.v2.fromArray(_e.v2),this}}class ay extends Ul{constructor(_e=new dn,at=new dn,pt=new dn){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=_e,this.v1=at,this.v2=pt}getPoint(_e,at=new dn){const pt=at,mt=this.v0,vt=this.v1,Ct=this.v2;return pt.set(w_(_e,mt.x,vt.x,Ct.x),w_(_e,mt.y,vt.y,Ct.y)),pt}copy(_e){return super.copy(_e),this.v0.copy(_e.v0),this.v1.copy(_e.v1),this.v2.copy(_e.v2),this}toJSON(){const _e=super.toJSON();return _e.v0=this.v0.toArray(),_e.v1=this.v1.toArray(),_e.v2=this.v2.toArray(),_e}fromJSON(_e){return super.fromJSON(_e),this.v0.fromArray(_e.v0),this.v1.fromArray(_e.v1),this.v2.fromArray(_e.v2),this}}class oy extends Ul{constructor(_e=new Er,at=new Er,pt=new Er){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=_e,this.v1=at,this.v2=pt}getPoint(_e,at=new Er){const pt=at,mt=this.v0,vt=this.v1,Ct=this.v2;return pt.set(w_(_e,mt.x,vt.x,Ct.x),w_(_e,mt.y,vt.y,Ct.y),w_(_e,mt.z,vt.z,Ct.z)),pt}copy(_e){return super.copy(_e),this.v0.copy(_e.v0),this.v1.copy(_e.v1),this.v2.copy(_e.v2),this}toJSON(){const _e=super.toJSON();return _e.v0=this.v0.toArray(),_e.v1=this.v1.toArray(),_e.v2=this.v2.toArray(),_e}fromJSON(_e){return super.fromJSON(_e),this.v0.fromArray(_e.v0),this.v1.fromArray(_e.v1),this.v2.fromArray(_e.v2),this}}class ly extends Ul{constructor(_e=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=_e}getPoint(_e,at=new dn){const pt=at,mt=this.points,vt=(mt.length-1)*_e,Ct=Math.floor(vt),Tt=vt-Ct,Bt=mt[Ct===0?Ct:Ct-1],Lt=mt[Ct],Ut=mt[Ct>mt.length-2?mt.length-1:Ct+1],Qt=mt[Ct>mt.length-3?mt.length-1:Ct+2];return pt.set(Xx(Tt,Bt.x,Lt.x,Ut.x,Qt.x),Xx(Tt,Bt.y,Lt.y,Ut.y,Qt.y)),pt}copy(_e){super.copy(_e),this.points=[];for(let at=0,pt=_e.points.length;at<pt;at++){const mt=_e.points[at];this.points.push(mt.clone())}return this}toJSON(){const _e=super.toJSON();_e.points=[];for(let at=0,pt=this.points.length;at<pt;at++){const mt=this.points[at];_e.points.push(mt.toArray())}return _e}fromJSON(_e){super.fromJSON(_e),this.points=[];for(let at=0,pt=_e.points.length;at<pt;at++){const mt=_e.points[at];this.points.push(new dn().fromArray(mt))}return this}}var zv=Object.freeze({__proto__:null,ArcCurve:qx,CatmullRomCurve3:$x,CubicBezierCurve:ny,CubicBezierCurve3:Yx,EllipseCurve:jv,LineCurve:sy,LineCurve3:Kx,QuadraticBezierCurve:ay,QuadraticBezierCurve3:oy,SplineCurve:ly});class Jx extends Ul{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(_e){this.curves.push(_e)}closePath(){const _e=this.curves[0].getPoint(0),at=this.curves[this.curves.length-1].getPoint(1);if(!_e.equals(at)){const pt=_e.isVector2===!0?"LineCurve":"LineCurve3";this.curves.push(new zv[pt](at,_e))}return this}getPoint(_e,at){const pt=_e*this.getLength(),mt=this.getCurveLengths();let vt=0;for(;vt<mt.length;){if(mt[vt]>=pt){const Ct=mt[vt]-pt,Tt=this.curves[vt],Bt=Tt.getLength(),Lt=Bt===0?0:1-Ct/Bt;return Tt.getPointAt(Lt,at)}vt++}return null}getLength(){const _e=this.getCurveLengths();return _e[_e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const _e=[];let at=0;for(let pt=0,mt=this.curves.length;pt<mt;pt++)at+=this.curves[pt].getLength(),_e.push(at);return this.cacheLengths=_e,_e}getSpacedPoints(_e=40){const at=[];for(let pt=0;pt<=_e;pt++)at.push(this.getPoint(pt/_e));return this.autoClose&&at.push(at[0]),at}getPoints(_e=12){const at=[];let pt;for(let mt=0,vt=this.curves;mt<vt.length;mt++){const Ct=vt[mt],Tt=Ct.isEllipseCurve?2*_e:Ct.isLineCurve||Ct.isLineCurve3?1:Ct.isSplineCurve?_e*Ct.points.length:_e,Bt=Ct.getPoints(Tt);for(let Lt=0;Lt<Bt.length;Lt++){const Ut=Bt[Lt];pt&&pt.equals(Ut)||(at.push(Ut),pt=Ut)}}return this.autoClose&&at.length>1&&!at[at.length-1].equals(at[0])&&at.push(at[0]),at}copy(_e){super.copy(_e),this.curves=[];for(let at=0,pt=_e.curves.length;at<pt;at++){const mt=_e.curves[at];this.curves.push(mt.clone())}return this.autoClose=_e.autoClose,this}toJSON(){const _e=super.toJSON();_e.autoClose=this.autoClose,_e.curves=[];for(let at=0,pt=this.curves.length;at<pt;at++){const mt=this.curves[at];_e.curves.push(mt.toJSON())}return _e}fromJSON(_e){super.fromJSON(_e),this.autoClose=_e.autoClose,this.curves=[];for(let at=0,pt=_e.curves.length;at<pt;at++){const mt=_e.curves[at];this.curves.push(new zv[mt.type]().fromJSON(mt))}return this}}class S_ extends Jx{constructor(_e){super(),this.type="Path",this.currentPoint=new dn,_e&&this.setFromPoints(_e)}setFromPoints(_e){this.moveTo(_e[0].x,_e[0].y);for(let at=1,pt=_e.length;at<pt;at++)this.lineTo(_e[at].x,_e[at].y);return this}moveTo(_e,at){return this.currentPoint.set(_e,at),this}lineTo(_e,at){const pt=new sy(this.currentPoint.clone(),new dn(_e,at));return this.curves.push(pt),this.currentPoint.set(_e,at),this}quadraticCurveTo(_e,at,pt,mt){const vt=new ay(this.currentPoint.clone(),new dn(_e,at),new dn(pt,mt));return this.curves.push(vt),this.currentPoint.set(pt,mt),this}bezierCurveTo(_e,at,pt,mt,vt,Ct){const Tt=new ny(this.currentPoint.clone(),new dn(_e,at),new dn(pt,mt),new dn(vt,Ct));return this.curves.push(Tt),this.currentPoint.set(vt,Ct),this}splineThru(_e){const at=[this.currentPoint.clone()].concat(_e),pt=new ly(at);return this.curves.push(pt),this.currentPoint.copy(_e[_e.length-1]),this}arc(_e,at,pt,mt,vt,Ct){const Tt=this.currentPoint.x,Bt=this.currentPoint.y;return this.absarc(_e+Tt,at+Bt,pt,mt,vt,Ct),this}absarc(_e,at,pt,mt,vt,Ct){return this.absellipse(_e,at,pt,pt,mt,vt,Ct),this}ellipse(_e,at,pt,mt,vt,Ct,Tt,Bt){const Lt=this.currentPoint.x,Ut=this.currentPoint.y;return this.absellipse(_e+Lt,at+Ut,pt,mt,vt,Ct,Tt,Bt),this}absellipse(_e,at,pt,mt,vt,Ct,Tt,Bt){const Lt=new jv(_e,at,pt,mt,vt,Ct,Tt,Bt);if(this.curves.length>0){const Qt=Lt.getPoint(0);Qt.equals(this.currentPoint)||this.lineTo(Qt.x,Qt.y)}this.curves.push(Lt);const Ut=Lt.getPoint(1);return this.currentPoint.copy(Ut),this}copy(_e){return super.copy(_e),this.currentPoint.copy(_e.currentPoint),this}toJSON(){const _e=super.toJSON();return _e.currentPoint=this.currentPoint.toArray(),_e}fromJSON(_e){return super.fromJSON(_e),this.currentPoint.fromArray(_e.currentPoint),this}}class C_ extends _s{constructor(_e=[new dn(0,-.5),new dn(.5,0),new dn(0,.5)],at=12,pt=0,mt=2*Math.PI){super(),this.type="LatheGeometry",this.parameters={points:_e,segments:at,phiStart:pt,phiLength:mt},at=Math.floor(at),mt=Hs(mt,0,2*Math.PI);const vt=[],Ct=[],Tt=[],Bt=[],Lt=[],Ut=1/at,Qt=new Er,Ht=new dn,Wt=new Er,qt=new Er,Jt=new Er;let Xt=0,sr=0;for(let Zt=0;Zt<=_e.length-1;Zt++)switch(Zt){case 0:Xt=_e[Zt+1].x-_e[Zt].x,sr=_e[Zt+1].y-_e[Zt].y,Wt.x=1*sr,Wt.y=-Xt,Wt.z=0*sr,Jt.copy(Wt),Wt.normalize(),Bt.push(Wt.x,Wt.y,Wt.z);break;case _e.length-1:Bt.push(Jt.x,Jt.y,Jt.z);break;default:Xt=_e[Zt+1].x-_e[Zt].x,sr=_e[Zt+1].y-_e[Zt].y,Wt.x=1*sr,Wt.y=-Xt,Wt.z=0*sr,qt.copy(Wt),Wt.x+=Jt.x,Wt.y+=Jt.y,Wt.z+=Jt.z,Wt.normalize(),Bt.push(Wt.x,Wt.y,Wt.z),Jt.copy(qt)}for(let Zt=0;Zt<=at;Zt++){const er=pt+Zt*Ut*mt,xr=Math.sin(er),Ar=Math.cos(er);for(let yr=0;yr<=_e.length-1;yr++){Qt.x=_e[yr].x*xr,Qt.y=_e[yr].y,Qt.z=_e[yr].x*Ar,Ct.push(Qt.x,Qt.y,Qt.z),Ht.x=Zt/at,Ht.y=yr/(_e.length-1),Tt.push(Ht.x,Ht.y);const Tr=Bt[3*yr+0]*xr,Hr=Bt[3*yr+1],Nr=Bt[3*yr+0]*Ar;Lt.push(Tr,Hr,Nr)}}for(let Zt=0;Zt<at;Zt++)for(let er=0;er<_e.length-1;er++){const xr=er+Zt*_e.length,Ar=xr,yr=xr+_e.length,Tr=xr+_e.length+1,Hr=xr+1;vt.push(Ar,yr,Hr),vt.push(Tr,Hr,yr)}this.setIndex(vt),this.setAttribute("position",new Ln(Ct,3)),this.setAttribute("uv",new Ln(Tt,2)),this.setAttribute("normal",new Ln(Lt,3))}copy(_e){return super.copy(_e),this.parameters=Object.assign({},_e.parameters),this}static fromJSON(_e){return new C_(_e.points,_e.segments,_e.phiStart,_e.phiLength)}}class Vv extends C_{constructor(_e=1,at=1,pt=4,mt=8){const vt=new S_;vt.absarc(0,-at/2,_e,1.5*Math.PI,0),vt.absarc(0,at/2,_e,0,.5*Math.PI),super(vt.getPoints(pt),mt),this.type="CapsuleGeometry",this.parameters={radius:_e,length:at,capSegments:pt,radialSegments:mt}}static fromJSON(_e){return new Vv(_e.radius,_e.length,_e.capSegments,_e.radialSegments)}}class Hv extends _s{constructor(_e=1,at=32,pt=0,mt=2*Math.PI){super(),this.type="CircleGeometry",this.parameters={radius:_e,segments:at,thetaStart:pt,thetaLength:mt},at=Math.max(3,at);const vt=[],Ct=[],Tt=[],Bt=[],Lt=new Er,Ut=new dn;Ct.push(0,0,0),Tt.push(0,0,1),Bt.push(.5,.5);for(let Qt=0,Ht=3;Qt<=at;Qt++,Ht+=3){const Wt=pt+Qt/at*mt;Lt.x=_e*Math.cos(Wt),Lt.y=_e*Math.sin(Wt),Ct.push(Lt.x,Lt.y,Lt.z),Tt.push(0,0,1),Ut.x=(Ct[Ht]/_e+1)/2,Ut.y=(Ct[Ht+1]/_e+1)/2,Bt.push(Ut.x,Ut.y)}for(let Qt=1;Qt<=at;Qt++)vt.push(Qt,Qt+1,0);this.setIndex(vt),this.setAttribute("position",new Ln(Ct,3)),this.setAttribute("normal",new Ln(Tt,3)),this.setAttribute("uv",new Ln(Bt,2))}copy(_e){return super.copy(_e),this.parameters=Object.assign({},_e.parameters),this}static fromJSON(_e){return new Hv(_e.radius,_e.segments,_e.thetaStart,_e.thetaLength)}}class Im extends _s{constructor(_e=1,at=1,pt=1,mt=32,vt=1,Ct=!1,Tt=0,Bt=2*Math.PI){super(),this.type="CylinderGeometry",this.parameters={radiusTop:_e,radiusBottom:at,height:pt,radialSegments:mt,heightSegments:vt,openEnded:Ct,thetaStart:Tt,thetaLength:Bt};const Lt=this;mt=Math.floor(mt),vt=Math.floor(vt);const Ut=[],Qt=[],Ht=[],Wt=[];let qt=0;const Jt=[],Xt=pt/2;let sr=0;function Zt(er){const xr=qt,Ar=new dn,yr=new Er;let Tr=0;const Hr=er===!0?_e:at,Nr=er===!0?1:-1;for(let Gr=1;Gr<=mt;Gr++)Qt.push(0,Xt*Nr,0),Ht.push(0,Nr,0),Wt.push(.5,.5),qt++;const zr=qt;for(let Gr=0;Gr<=mt;Gr++){const Vr=Gr/mt*Bt+Tt,gn=Math.cos(Vr),pn=Math.sin(Vr);yr.x=Hr*pn,yr.y=Xt*Nr,yr.z=Hr*gn,Qt.push(yr.x,yr.y,yr.z),Ht.push(0,Nr,0),Ar.x=.5*gn+.5,Ar.y=.5*pn*Nr+.5,Wt.push(Ar.x,Ar.y),qt++}for(let Gr=0;Gr<mt;Gr++){const Vr=xr+Gr,gn=zr+Gr;er===!0?Ut.push(gn,gn+1,Vr):Ut.push(gn+1,gn,Vr),Tr+=3}Lt.addGroup(sr,Tr,er===!0?1:2),sr+=Tr}(function(){const er=new Er,xr=new Er;let Ar=0;const yr=(at-_e)/pt;for(let Tr=0;Tr<=vt;Tr++){const Hr=[],Nr=Tr/vt,zr=Nr*(at-_e)+_e;for(let Gr=0;Gr<=mt;Gr++){const Vr=Gr/mt,gn=Vr*Bt+Tt,pn=Math.sin(gn),Mn=Math.cos(gn);xr.x=zr*pn,xr.y=-Nr*pt+Xt,xr.z=zr*Mn,Qt.push(xr.x,xr.y,xr.z),er.set(pn,yr,Mn).normalize(),Ht.push(er.x,er.y,er.z),Wt.push(Vr,1-Nr),Hr.push(qt++)}Jt.push(Hr)}for(let Tr=0;Tr<mt;Tr++)for(let Hr=0;Hr<vt;Hr++){const Nr=Jt[Hr][Tr],zr=Jt[Hr+1][Tr],Gr=Jt[Hr+1][Tr+1],Vr=Jt[Hr][Tr+1];Ut.push(Nr,zr,Vr),Ut.push(zr,Gr,Vr),Ar+=6}Lt.addGroup(sr,Ar,0),sr+=Ar})(),Ct===!1&&(_e>0&&Zt(!0),at>0&&Zt(!1)),this.setIndex(Ut),this.setAttribute("position",new Ln(Qt,3)),this.setAttribute("normal",new Ln(Ht,3)),this.setAttribute("uv",new Ln(Wt,2))}copy(_e){return super.copy(_e),this.parameters=Object.assign({},_e.parameters),this}static fromJSON(_e){return new Im(_e.radiusTop,_e.radiusBottom,_e.height,_e.radialSegments,_e.heightSegments,_e.openEnded,_e.thetaStart,_e.thetaLength)}}class Qv extends Im{constructor(_e=1,at=1,pt=32,mt=1,vt=!1,Ct=0,Tt=2*Math.PI){super(0,_e,at,pt,mt,vt,Ct,Tt),this.type="ConeGeometry",this.parameters={radius:_e,height:at,radialSegments:pt,heightSegments:mt,openEnded:vt,thetaStart:Ct,thetaLength:Tt}}static fromJSON(_e){return new Qv(_e.radius,_e.height,_e.radialSegments,_e.heightSegments,_e.openEnded,_e.thetaStart,_e.thetaLength)}}class Ku extends _s{constructor(_e=[],at=[],pt=1,mt=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:_e,indices:at,radius:pt,detail:mt};const vt=[],Ct=[];function Tt(Ht,Wt,qt,Jt){const Xt=Jt+1,sr=[];for(let Zt=0;Zt<=Xt;Zt++){sr[Zt]=[];const er=Ht.clone().lerp(qt,Zt/Xt),xr=Wt.clone().lerp(qt,Zt/Xt),Ar=Xt-Zt;for(let yr=0;yr<=Ar;yr++)sr[Zt][yr]=yr===0&&Zt===Xt?er:er.clone().lerp(xr,yr/Ar)}for(let Zt=0;Zt<Xt;Zt++)for(let er=0;er<2*(Xt-Zt)-1;er++){const xr=Math.floor(er/2);er%2==0?(Bt(sr[Zt][xr+1]),Bt(sr[Zt+1][xr]),Bt(sr[Zt][xr])):(Bt(sr[Zt][xr+1]),Bt(sr[Zt+1][xr+1]),Bt(sr[Zt+1][xr]))}}function Bt(Ht){vt.push(Ht.x,Ht.y,Ht.z)}function Lt(Ht,Wt){const qt=3*Ht;Wt.x=_e[qt+0],Wt.y=_e[qt+1],Wt.z=_e[qt+2]}function Ut(Ht,Wt,qt,Jt){Jt<0&&Ht.x===1&&(Ct[Wt]=Ht.x-1),qt.x===0&&qt.z===0&&(Ct[Wt]=Jt/2/Math.PI+.5)}function Qt(Ht){return Math.atan2(Ht.z,-Ht.x)}(function(Ht){const Wt=new Er,qt=new Er,Jt=new Er;for(let Xt=0;Xt<at.length;Xt+=3)Lt(at[Xt+0],Wt),Lt(at[Xt+1],qt),Lt(at[Xt+2],Jt),Tt(Wt,qt,Jt,Ht)})(mt),function(Ht){const Wt=new Er;for(let qt=0;qt<vt.length;qt+=3)Wt.x=vt[qt+0],Wt.y=vt[qt+1],Wt.z=vt[qt+2],Wt.normalize().multiplyScalar(Ht),vt[qt+0]=Wt.x,vt[qt+1]=Wt.y,vt[qt+2]=Wt.z}(pt),function(){const Ht=new Er;for(let qt=0;qt<vt.length;qt+=3){Ht.x=vt[qt+0],Ht.y=vt[qt+1],Ht.z=vt[qt+2];const Jt=Qt(Ht)/2/Math.PI+.5,Xt=(Wt=Ht,Math.atan2(-Wt.y,Math.sqrt(Wt.x*Wt.x+Wt.z*Wt.z))/Math.PI+.5);Ct.push(Jt,1-Xt)}var Wt;(function(){const qt=new Er,Jt=new Er,Xt=new Er,sr=new Er,Zt=new dn,er=new dn,xr=new dn;for(let Ar=0,yr=0;Ar<vt.length;Ar+=9,yr+=6){qt.set(vt[Ar+0],vt[Ar+1],vt[Ar+2]),Jt.set(vt[Ar+3],vt[Ar+4],vt[Ar+5]),Xt.set(vt[Ar+6],vt[Ar+7],vt[Ar+8]),Zt.set(Ct[yr+0],Ct[yr+1]),er.set(Ct[yr+2],Ct[yr+3]),xr.set(Ct[yr+4],Ct[yr+5]),sr.copy(qt).add(Jt).add(Xt).divideScalar(3);const Tr=Qt(sr);Ut(Zt,yr+0,qt,Tr),Ut(er,yr+2,Jt,Tr),Ut(xr,yr+4,Xt,Tr)}})(),function(){for(let qt=0;qt<Ct.length;qt+=6){const Jt=Ct[qt+0],Xt=Ct[qt+2],sr=Ct[qt+4],Zt=Math.max(Jt,Xt,sr),er=Math.min(Jt,Xt,sr);Zt>.9&&er<.1&&(Jt<.2&&(Ct[qt+0]+=1),Xt<.2&&(Ct[qt+2]+=1),sr<.2&&(Ct[qt+4]+=1))}}()}(),this.setAttribute("position",new Ln(vt,3)),this.setAttribute("normal",new Ln(vt.slice(),3)),this.setAttribute("uv",new Ln(Ct,2)),mt===0?this.computeVertexNormals():this.normalizeNormals()}copy(_e){return super.copy(_e),this.parameters=Object.assign({},_e.parameters),this}static fromJSON(_e){return new Ku(_e.vertices,_e.indices,_e.radius,_e.details)}}class Wv extends Ku{constructor(_e=1,at=0){const pt=(1+Math.sqrt(5))/2,mt=1/pt;super([-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-mt,-pt,0,-mt,pt,0,mt,-pt,0,mt,pt,-mt,-pt,0,-mt,pt,0,mt,-pt,0,mt,pt,0,-pt,0,-mt,pt,0,-mt,-pt,0,mt,pt,0,mt],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],_e,at),this.type="DodecahedronGeometry",this.parameters={radius:_e,detail:at}}static fromJSON(_e){return new Wv(_e.radius,_e.detail)}}const qv=new Er,$v=new Er,cy=new Er,Xv=new fo;class Zx extends _s{constructor(_e=null,at=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:_e,thresholdAngle:at},_e!==null){const pt=Math.pow(10,4),mt=Math.cos($l*at),vt=_e.getIndex(),Ct=_e.getAttribute("position"),Tt=vt?vt.count:Ct.count,Bt=[0,0,0],Lt=["a","b","c"],Ut=new Array(3),Qt={},Ht=[];for(let Wt=0;Wt<Tt;Wt+=3){vt?(Bt[0]=vt.getX(Wt),Bt[1]=vt.getX(Wt+1),Bt[2]=vt.getX(Wt+2)):(Bt[0]=Wt,Bt[1]=Wt+1,Bt[2]=Wt+2);const{a:qt,b:Jt,c:Xt}=Xv;if(qt.fromBufferAttribute(Ct,Bt[0]),Jt.fromBufferAttribute(Ct,Bt[1]),Xt.fromBufferAttribute(Ct,Bt[2]),Xv.getNormal(cy),Ut[0]=`${Math.round(qt.x*pt)},${Math.round(qt.y*pt)},${Math.round(qt.z*pt)}`,Ut[1]=`${Math.round(Jt.x*pt)},${Math.round(Jt.y*pt)},${Math.round(Jt.z*pt)}`,Ut[2]=`${Math.round(Xt.x*pt)},${Math.round(Xt.y*pt)},${Math.round(Xt.z*pt)}`,Ut[0]!==Ut[1]&&Ut[1]!==Ut[2]&&Ut[2]!==Ut[0])for(let sr=0;sr<3;sr++){const Zt=(sr+1)%3,er=Ut[sr],xr=Ut[Zt],Ar=Xv[Lt[sr]],yr=Xv[Lt[Zt]],Tr=`${er}_${xr}`,Hr=`${xr}_${er}`;Hr in Qt&&Qt[Hr]?(cy.dot(Qt[Hr].normal)<=mt&&(Ht.push(Ar.x,Ar.y,Ar.z),Ht.push(yr.x,yr.y,yr.z)),Qt[Hr]=null):Tr in Qt||(Qt[Tr]={index0:Bt[sr],index1:Bt[Zt],normal:cy.clone()})}}for(const Wt in Qt)if(Qt[Wt]){const{index0:qt,index1:Jt}=Qt[Wt];qv.fromBufferAttribute(Ct,qt),$v.fromBufferAttribute(Ct,Jt),Ht.push(qv.x,qv.y,qv.z),Ht.push($v.x,$v.y,$v.z)}this.setAttribute("position",new Ln(Ht,3))}}copy(_e){return super.copy(_e),this.parameters=Object.assign({},_e.parameters),this}}class Cp extends S_{constructor(_e){super(_e),this.uuid=xo(),this.type="Shape",this.holes=[]}getPointsHoles(_e){const at=[];for(let pt=0,mt=this.holes.length;pt<mt;pt++)at[pt]=this.holes[pt].getPoints(_e);return at}extractPoints(_e){return{shape:this.getPoints(_e),holes:this.getPointsHoles(_e)}}copy(_e){super.copy(_e),this.holes=[];for(let at=0,pt=_e.holes.length;at<pt;at++){const mt=_e.holes[at];this.holes.push(mt.clone())}return this}toJSON(){const _e=super.toJSON();_e.uuid=this.uuid,_e.holes=[];for(let at=0,pt=this.holes.length;at<pt;at++){const mt=this.holes[at];_e.holes.push(mt.toJSON())}return _e}fromJSON(_e){super.fromJSON(_e),this.uuid=_e.uuid,this.holes=[];for(let at=0,pt=_e.holes.length;at<pt;at++){const mt=_e.holes[at];this.holes.push(new S_().fromJSON(mt))}return this}}function eA(Et,_e,at,pt,mt){let vt,Ct;if(mt===function(Tt,Bt,Lt,Ut){let Qt=0;for(let Ht=Bt,Wt=Lt-Ut;Ht<Lt;Ht+=Ut)Qt+=(Tt[Wt]-Tt[Ht])*(Tt[Ht+1]+Tt[Wt+1]),Wt=Ht;return Qt}(Et,_e,at,pt)>0)for(vt=_e;vt<at;vt+=pt)Ct=iA(vt,Et[vt],Et[vt+1],Ct);else for(vt=at-pt;vt>=_e;vt-=pt)Ct=iA(vt,Et[vt],Et[vt+1],Ct);return Ct&&Yv(Ct,Ct.next)&&(M_(Ct),Ct=Ct.next),Ct}function Pp(Et,_e){if(!Et)return Et;_e||(_e=Et);let at,pt=Et;do if(at=!1,pt.steiner||!Yv(pt,pt.next)&&$s(pt.prev,pt,pt.next)!==0)pt=pt.next;else{if(M_(pt),pt=_e=pt.prev,pt===pt.next)break;at=!0}while(at||pt!==_e);return _e}function P_(Et,_e,at,pt,mt,vt,Ct){if(!Et)return;!Ct&&vt&&function(Ut,Qt,Ht,Wt){let qt=Ut;do qt.z===0&&(qt.z=uy(qt.x,qt.y,Qt,Ht,Wt)),qt.prevZ=qt.prev,qt.nextZ=qt.next,qt=qt.next;while(qt!==Ut);qt.prevZ.nextZ=null,qt.prevZ=null,function(Jt){let Xt,sr,Zt,er,xr,Ar,yr,Tr,Hr=1;do{for(sr=Jt,Jt=null,xr=null,Ar=0;sr;){for(Ar++,Zt=sr,yr=0,Xt=0;Xt<Hr&&(yr++,Zt=Zt.nextZ,Zt);Xt++);for(Tr=Hr;yr>0||Tr>0&&Zt;)yr!==0&&(Tr===0||!Zt||sr.z<=Zt.z)?(er=sr,sr=sr.nextZ,yr--):(er=Zt,Zt=Zt.nextZ,Tr--),xr?xr.nextZ=er:Jt=er,er.prevZ=xr,xr=er;sr=Zt}xr.nextZ=null,Hr*=2}while(Ar>1)}(qt)}(Et,pt,mt,vt);let Tt,Bt,Lt=Et;for(;Et.prev!==Et.next;)if(Tt=Et.prev,Bt=Et.next,vt?dE(Et,pt,mt,vt):hE(Et))_e.push(Tt.i/at|0),_e.push(Et.i/at|0),_e.push(Bt.i/at|0),M_(Et),Et=Bt.next,Lt=Bt.next;else if((Et=Bt)===Lt){Ct?Ct===1?P_(Et=mE(Pp(Et),_e,at),_e,at,pt,mt,vt,2):Ct===2&&gE(Et,_e,at,pt,mt,vt):P_(Pp(Et),_e,at,pt,mt,vt,1);break}}function hE(Et){const _e=Et.prev,at=Et,pt=Et.next;if($s(_e,at,pt)>=0)return!1;const mt=_e.x,vt=at.x,Ct=pt.x,Tt=_e.y,Bt=at.y,Lt=pt.y,Ut=mt<vt?mt<Ct?mt:Ct:vt<Ct?vt:Ct,Qt=Tt<Bt?Tt<Lt?Tt:Lt:Bt<Lt?Bt:Lt,Ht=mt>vt?mt>Ct?mt:Ct:vt>Ct?vt:Ct,Wt=Tt>Bt?Tt>Lt?Tt:Lt:Bt>Lt?Bt:Lt;let qt=pt.next;for(;qt!==_e;){if(qt.x>=Ut&&qt.x<=Ht&&qt.y>=Qt&&qt.y<=Wt&&Rm(mt,Tt,vt,Bt,Ct,Lt,qt.x,qt.y)&&$s(qt.prev,qt,qt.next)>=0)return!1;qt=qt.next}return!0}function dE(Et,_e,at,pt){const mt=Et.prev,vt=Et,Ct=Et.next;if($s(mt,vt,Ct)>=0)return!1;const Tt=mt.x,Bt=vt.x,Lt=Ct.x,Ut=mt.y,Qt=vt.y,Ht=Ct.y,Wt=Tt<Bt?Tt<Lt?Tt:Lt:Bt<Lt?Bt:Lt,qt=Ut<Qt?Ut<Ht?Ut:Ht:Qt<Ht?Qt:Ht,Jt=Tt>Bt?Tt>Lt?Tt:Lt:Bt>Lt?Bt:Lt,Xt=Ut>Qt?Ut>Ht?Ut:Ht:Qt>Ht?Qt:Ht,sr=uy(Wt,qt,_e,at,pt),Zt=uy(Jt,Xt,_e,at,pt);let er=Et.prevZ,xr=Et.nextZ;for(;er&&er.z>=sr&&xr&&xr.z<=Zt;){if(er.x>=Wt&&er.x<=Jt&&er.y>=qt&&er.y<=Xt&&er!==mt&&er!==Ct&&Rm(Tt,Ut,Bt,Qt,Lt,Ht,er.x,er.y)&&$s(er.prev,er,er.next)>=0||(er=er.prevZ,xr.x>=Wt&&xr.x<=Jt&&xr.y>=qt&&xr.y<=Xt&&xr!==mt&&xr!==Ct&&Rm(Tt,Ut,Bt,Qt,Lt,Ht,xr.x,xr.y)&&$s(xr.prev,xr,xr.next)>=0))return!1;xr=xr.nextZ}for(;er&&er.z>=sr;){if(er.x>=Wt&&er.x<=Jt&&er.y>=qt&&er.y<=Xt&&er!==mt&&er!==Ct&&Rm(Tt,Ut,Bt,Qt,Lt,Ht,er.x,er.y)&&$s(er.prev,er,er.next)>=0)return!1;er=er.prevZ}for(;xr&&xr.z<=Zt;){if(xr.x>=Wt&&xr.x<=Jt&&xr.y>=qt&&xr.y<=Xt&&xr!==mt&&xr!==Ct&&Rm(Tt,Ut,Bt,Qt,Lt,Ht,xr.x,xr.y)&&$s(xr.prev,xr,xr.next)>=0)return!1;xr=xr.nextZ}return!0}function mE(Et,_e,at){let pt=Et;do{const mt=pt.prev,vt=pt.next.next;!Yv(mt,vt)&&tA(mt,pt,pt.next,vt)&&T_(mt,vt)&&T_(vt,mt)&&(_e.push(mt.i/at|0),_e.push(pt.i/at|0),_e.push(vt.i/at|0),M_(pt),M_(pt.next),pt=Et=vt),pt=pt.next}while(pt!==Et);return Pp(pt)}function gE(Et,_e,at,pt,mt,vt){let Ct=Et;do{let Tt=Ct.next.next;for(;Tt!==Ct.prev;){if(Ct.i!==Tt.i&&bE(Ct,Tt)){let Bt=rA(Ct,Tt);return Ct=Pp(Ct,Ct.next),Bt=Pp(Bt,Bt.next),P_(Ct,_e,at,pt,mt,vt,0),void P_(Bt,_e,at,pt,mt,vt,0)}Tt=Tt.next}Ct=Ct.next}while(Ct!==Et)}function _E(Et,_e){return Et.x-_e.x}function fE(Et,_e){const at=function(mt,vt){let Ct,Tt=vt,Bt=-1/0;const Lt=mt.x,Ut=mt.y;do{if(Ut<=Tt.y&&Ut>=Tt.next.y&&Tt.next.y!==Tt.y){const Xt=Tt.x+(Ut-Tt.y)*(Tt.next.x-Tt.x)/(Tt.next.y-Tt.y);if(Xt<=Lt&&Xt>Bt&&(Bt=Xt,Ct=Tt.x<Tt.next.x?Tt:Tt.next,Xt===Lt))return Ct}Tt=Tt.next}while(Tt!==vt);if(!Ct)return null;const Qt=Ct,Ht=Ct.x,Wt=Ct.y;let qt,Jt=1/0;Tt=Ct;do Lt>=Tt.x&&Tt.x>=Ht&&Lt!==Tt.x&&Rm(Ut<Wt?Lt:Bt,Ut,Ht,Wt,Ut<Wt?Bt:Lt,Ut,Tt.x,Tt.y)&&(qt=Math.abs(Ut-Tt.y)/(Lt-Tt.x),T_(Tt,mt)&&(qt<Jt||qt===Jt&&(Tt.x>Ct.x||Tt.x===Ct.x&&vE(Ct,Tt)))&&(Ct=Tt,Jt=qt)),Tt=Tt.next;while(Tt!==Qt);return Ct}(Et,_e);if(!at)return _e;const pt=rA(at,Et);return Pp(pt,pt.next),Pp(at,at.next)}function vE(Et,_e){return $s(Et.prev,Et,_e.prev)<0&&$s(_e.next,Et,Et.next)<0}function uy(Et,_e,at,pt,mt){return(Et=1431655765&((Et=858993459&((Et=252645135&((Et=16711935&((Et=(Et-at)*mt|0)|Et<<8))|Et<<4))|Et<<2))|Et<<1))|(_e=1431655765&((_e=858993459&((_e=252645135&((_e=16711935&((_e=(_e-pt)*mt|0)|_e<<8))|_e<<4))|_e<<2))|_e<<1))<<1}function yE(Et){let _e=Et,at=Et;do(_e.x<at.x||_e.x===at.x&&_e.y<at.y)&&(at=_e),_e=_e.next;while(_e!==Et);return at}function Rm(Et,_e,at,pt,mt,vt,Ct,Tt){return(mt-Ct)*(_e-Tt)>=(Et-Ct)*(vt-Tt)&&(Et-Ct)*(pt-Tt)>=(at-Ct)*(_e-Tt)&&(at-Ct)*(vt-Tt)>=(mt-Ct)*(pt-Tt)}function bE(Et,_e){return Et.next.i!==_e.i&&Et.prev.i!==_e.i&&!function(at,pt){let mt=at;do{if(mt.i!==at.i&&mt.next.i!==at.i&&mt.i!==pt.i&&mt.next.i!==pt.i&&tA(mt,mt.next,at,pt))return!0;mt=mt.next}while(mt!==at);return!1}(Et,_e)&&(T_(Et,_e)&&T_(_e,Et)&&function(at,pt){let mt=at,vt=!1;const Ct=(at.x+pt.x)/2,Tt=(at.y+pt.y)/2;do mt.y>Tt!=mt.next.y>Tt&&mt.next.y!==mt.y&&Ct<(mt.next.x-mt.x)*(Tt-mt.y)/(mt.next.y-mt.y)+mt.x&&(vt=!vt),mt=mt.next;while(mt!==at);return vt}(Et,_e)&&($s(Et.prev,Et,_e.prev)||$s(Et,_e.prev,_e))||Yv(Et,_e)&&$s(Et.prev,Et,Et.next)>0&&$s(_e.prev,_e,_e.next)>0)}function $s(Et,_e,at){return(_e.y-Et.y)*(at.x-_e.x)-(_e.x-Et.x)*(at.y-_e.y)}function Yv(Et,_e){return Et.x===_e.x&&Et.y===_e.y}function tA(Et,_e,at,pt){const mt=Jv($s(Et,_e,at)),vt=Jv($s(Et,_e,pt)),Ct=Jv($s(at,pt,Et)),Tt=Jv($s(at,pt,_e));return mt!==vt&&Ct!==Tt||!(mt!==0||!Kv(Et,at,_e))||!(vt!==0||!Kv(Et,pt,_e))||!(Ct!==0||!Kv(at,Et,pt))||!(Tt!==0||!Kv(at,_e,pt))}function Kv(Et,_e,at){return _e.x<=Math.max(Et.x,at.x)&&_e.x>=Math.min(Et.x,at.x)&&_e.y<=Math.max(Et.y,at.y)&&_e.y>=Math.min(Et.y,at.y)}function Jv(Et){return Et>0?1:Et<0?-1:0}function T_(Et,_e){return $s(Et.prev,Et,Et.next)<0?$s(Et,_e,Et.next)>=0&&$s(Et,Et.prev,_e)>=0:$s(Et,_e,Et.prev)<0||$s(Et,Et.next,_e)<0}function rA(Et,_e){const at=new py(Et.i,Et.x,Et.y),pt=new py(_e.i,_e.x,_e.y),mt=Et.next,vt=_e.prev;return Et.next=_e,_e.prev=Et,at.next=mt,mt.prev=at,pt.next=at,at.prev=pt,vt.next=pt,pt.prev=vt,pt}function iA(Et,_e,at,pt){const mt=new py(Et,_e,at);return pt?(mt.next=pt.next,mt.prev=pt,pt.next.prev=mt,pt.next=mt):(mt.prev=mt,mt.next=mt),mt}function M_(Et){Et.next.prev=Et.prev,Et.prev.next=Et.next,Et.prevZ&&(Et.prevZ.nextZ=Et.nextZ),Et.nextZ&&(Et.nextZ.prevZ=Et.prevZ)}function py(Et,_e,at){this.i=Et,this.x=_e,this.y=at,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}class eu{static area(_e){const at=_e.length;let pt=0;for(let mt=at-1,vt=0;vt<at;mt=vt++)pt+=_e[mt].x*_e[vt].y-_e[vt].x*_e[mt].y;return .5*pt}static isClockWise(_e){return eu.area(_e)<0}static triangulateShape(_e,at){const pt=[],mt=[],vt=[];nA(_e),sA(pt,_e);let Ct=_e.length;at.forEach(nA);for(let Bt=0;Bt<at.length;Bt++)mt.push(Ct),Ct+=at[Bt].length,sA(pt,at[Bt]);const Tt=function(Bt,Lt,Ut=2){const Qt=Lt&&Lt.length,Ht=Qt?Lt[0]*Ut:Bt.length;let Wt=eA(Bt,0,Ht,Ut,!0);const qt=[];if(!Wt||Wt.next===Wt.prev)return qt;let Jt,Xt,sr,Zt,er,xr,Ar;if(Qt&&(Wt=function(yr,Tr,Hr,Nr){const zr=[];let Gr,Vr,gn,pn,Mn;for(Gr=0,Vr=Tr.length;Gr<Vr;Gr++)gn=Tr[Gr]*Nr,pn=Gr<Vr-1?Tr[Gr+1]*Nr:yr.length,Mn=eA(yr,gn,pn,Nr,!1),Mn===Mn.next&&(Mn.steiner=!0),zr.push(yE(Mn));for(zr.sort(_E),Gr=0;Gr<zr.length;Gr++)Hr=fE(zr[Gr],Hr);return Hr}(Bt,Lt,Wt,Ut)),Bt.length>80*Ut){Jt=sr=Bt[0],Xt=Zt=Bt[1];for(let yr=Ut;yr<Ht;yr+=Ut)er=Bt[yr],xr=Bt[yr+1],er<Jt&&(Jt=er),xr<Xt&&(Xt=xr),er>sr&&(sr=er),xr>Zt&&(Zt=xr);Ar=Math.max(sr-Jt,Zt-Xt),Ar=Ar!==0?32767/Ar:0}return P_(Wt,qt,Ut,Jt,Xt,Ar,0),qt}(pt,mt);for(let Bt=0;Bt<Tt.length;Bt+=3)vt.push(Tt.slice(Bt,Bt+3));return vt}}function nA(Et){const _e=Et.length;_e>2&&Et[_e-1].equals(Et[0])&&Et.pop()}function sA(Et,_e){for(let at=0;at<_e.length;at++)Et.push(_e[at].x),Et.push(_e[at].y)}class Zv extends _s{constructor(_e=new Cp([new dn(.5,.5),new dn(-.5,.5),new dn(-.5,-.5),new dn(.5,-.5)]),at={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:_e,options:at},_e=Array.isArray(_e)?_e:[_e];const pt=this,mt=[],vt=[];for(let Tt=0,Bt=_e.length;Tt<Bt;Tt++)Ct(_e[Tt]);function Ct(Tt){const Bt=[],Lt=at.curveSegments!==void 0?at.curveSegments:12,Ut=at.steps!==void 0?at.steps:1,Qt=at.depth!==void 0?at.depth:1;let Ht=at.bevelEnabled===void 0||at.bevelEnabled,Wt=at.bevelThickness!==void 0?at.bevelThickness:.2,qt=at.bevelSize!==void 0?at.bevelSize:Wt-.1,Jt=at.bevelOffset!==void 0?at.bevelOffset:0,Xt=at.bevelSegments!==void 0?at.bevelSegments:3;const sr=at.extrudePath,Zt=at.UVGenerator!==void 0?at.UVGenerator:xE;let er,xr,Ar,yr,Tr,Hr=!1;sr&&(er=sr.getSpacedPoints(Ut),Hr=!0,Ht=!1,xr=sr.computeFrenetFrames(Ut,!1),Ar=new Er,yr=new Er,Tr=new Er),Ht||(Xt=0,Wt=0,qt=0,Jt=0);const Nr=Tt.extractPoints(Lt);let zr=Nr.shape;const Gr=Nr.holes;if(!eu.isClockWise(zr)){zr=zr.reverse();for(let Fr=0,Qr=Gr.length;Fr<Qr;Fr++){const Rr=Gr[Fr];eu.isClockWise(Rr)&&(Gr[Fr]=Rr.reverse())}}const Vr=eu.triangulateShape(zr,Gr),gn=zr;for(let Fr=0,Qr=Gr.length;Fr<Qr;Fr++){const Rr=Gr[Fr];zr=zr.concat(Rr)}function pn(Fr,Qr,Rr){return Qr||console.error("THREE.ExtrudeGeometry: vec does not exist"),Fr.clone().addScaledVector(Qr,Rr)}const Mn=zr.length,Dn=Vr.length;function cn(Fr,Qr,Rr){let _r,Lr,Or;const qr=Fr.x-Qr.x,Yr=Fr.y-Qr.y,An=Rr.x-Fr.x,hn=Rr.y-Fr.y,ds=qr*qr+Yr*Yr,Zn=qr*hn-Yr*An;if(Math.abs(Zn)>Number.EPSILON){const Cn=Math.sqrt(ds),Jn=Math.sqrt(An*An+hn*hn),Wn=Qr.x-Yr/Cn,cs=Qr.y+qr/Cn,fs=((Rr.x-hn/Jn-Wn)*hn-(Rr.y+An/Jn-cs)*An)/(qr*hn-Yr*An);_r=Wn+qr*fs-Fr.x,Lr=cs+Yr*fs-Fr.y;const Bs=_r*_r+Lr*Lr;if(Bs<=2)return new dn(_r,Lr);Or=Math.sqrt(Bs/2)}else{let Cn=!1;qr>Number.EPSILON?An>Number.EPSILON&&(Cn=!0):qr<-Number.EPSILON?An<-Number.EPSILON&&(Cn=!0):Math.sign(Yr)===Math.sign(hn)&&(Cn=!0),Cn?(_r=-Yr,Lr=qr,Or=Math.sqrt(ds)):(_r=qr,Lr=Yr,Or=Math.sqrt(ds/2))}return new dn(_r/Or,Lr/Or)}const $r=[];for(let Fr=0,Qr=gn.length,Rr=Qr-1,_r=Fr+1;Fr<Qr;Fr++,Rr++,_r++)Rr===Qr&&(Rr=0),_r===Qr&&(_r=0),$r[Fr]=cn(gn[Fr],gn[Rr],gn[_r]);const Kr=[];let sn,nn=$r.concat();for(let Fr=0,Qr=Gr.length;Fr<Qr;Fr++){const Rr=Gr[Fr];sn=[];for(let _r=0,Lr=Rr.length,Or=Lr-1,qr=_r+1;_r<Lr;_r++,Or++,qr++)Or===Lr&&(Or=0),qr===Lr&&(qr=0),sn[_r]=cn(Rr[_r],Rr[Or],Rr[qr]);Kr.push(sn),nn=nn.concat(sn)}for(let Fr=0;Fr<Xt;Fr++){const Qr=Fr/Xt,Rr=Wt*Math.cos(Qr*Math.PI/2),_r=qt*Math.sin(Qr*Math.PI/2)+Jt;for(let Lr=0,Or=gn.length;Lr<Or;Lr++){const qr=pn(gn[Lr],$r[Lr],_r);Xn(qr.x,qr.y,-Rr)}for(let Lr=0,Or=Gr.length;Lr<Or;Lr++){const qr=Gr[Lr];sn=Kr[Lr];for(let Yr=0,An=qr.length;Yr<An;Yr++){const hn=pn(qr[Yr],sn[Yr],_r);Xn(hn.x,hn.y,-Rr)}}}const Nn=qt+Jt;for(let Fr=0;Fr<Mn;Fr++){const Qr=Ht?pn(zr[Fr],nn[Fr],Nn):zr[Fr];Hr?(yr.copy(xr.normals[0]).multiplyScalar(Qr.x),Ar.copy(xr.binormals[0]).multiplyScalar(Qr.y),Tr.copy(er[0]).add(yr).add(Ar),Xn(Tr.x,Tr.y,Tr.z)):Xn(Qr.x,Qr.y,0)}for(let Fr=1;Fr<=Ut;Fr++)for(let Qr=0;Qr<Mn;Qr++){const Rr=Ht?pn(zr[Qr],nn[Qr],Nn):zr[Qr];Hr?(yr.copy(xr.normals[Fr]).multiplyScalar(Rr.x),Ar.copy(xr.binormals[Fr]).multiplyScalar(Rr.y),Tr.copy(er[Fr]).add(yr).add(Ar),Xn(Tr.x,Tr.y,Tr.z)):Xn(Rr.x,Rr.y,Qt/Ut*Fr)}for(let Fr=Xt-1;Fr>=0;Fr--){const Qr=Fr/Xt,Rr=Wt*Math.cos(Qr*Math.PI/2),_r=qt*Math.sin(Qr*Math.PI/2)+Jt;for(let Lr=0,Or=gn.length;Lr<Or;Lr++){const qr=pn(gn[Lr],$r[Lr],_r);Xn(qr.x,qr.y,Qt+Rr)}for(let Lr=0,Or=Gr.length;Lr<Or;Lr++){const qr=Gr[Lr];sn=Kr[Lr];for(let Yr=0,An=qr.length;Yr<An;Yr++){const hn=pn(qr[Yr],sn[Yr],_r);Hr?Xn(hn.x,hn.y+er[Ut-1].y,er[Ut-1].x+Rr):Xn(hn.x,hn.y,Qt+Rr)}}}function ts(Fr,Qr){let Rr=Fr.length;for(;--Rr>=0;){const _r=Rr;let Lr=Rr-1;Lr<0&&(Lr=Fr.length-1);for(let Or=0,qr=Ut+2*Xt;Or<qr;Or++){const Yr=Mn*Or,An=Mn*(Or+1);ls(Qr+_r+Yr,Qr+Lr+Yr,Qr+Lr+An,Qr+_r+An)}}}function Xn(Fr,Qr,Rr){Bt.push(Fr),Bt.push(Qr),Bt.push(Rr)}function Fn(Fr,Qr,Rr){Br(Fr),Br(Qr),Br(Rr);const _r=mt.length/3,Lr=Zt.generateTopUV(pt,mt,_r-3,_r-2,_r-1);wr(Lr[0]),wr(Lr[1]),wr(Lr[2])}function ls(Fr,Qr,Rr,_r){Br(Fr),Br(Qr),Br(_r),Br(Qr),Br(Rr),Br(_r);const Lr=mt.length/3,Or=Zt.generateSideWallUV(pt,mt,Lr-6,Lr-3,Lr-2,Lr-1);wr(Or[0]),wr(Or[1]),wr(Or[3]),wr(Or[1]),wr(Or[2]),wr(Or[3])}function Br(Fr){mt.push(Bt[3*Fr+0]),mt.push(Bt[3*Fr+1]),mt.push(Bt[3*Fr+2])}function wr(Fr){vt.push(Fr.x),vt.push(Fr.y)}(function(){const Fr=mt.length/3;if(Ht){let Qr=0,Rr=Mn*Qr;for(let _r=0;_r<Dn;_r++){const Lr=Vr[_r];Fn(Lr[2]+Rr,Lr[1]+Rr,Lr[0]+Rr)}Qr=Ut+2*Xt,Rr=Mn*Qr;for(let _r=0;_r<Dn;_r++){const Lr=Vr[_r];Fn(Lr[0]+Rr,Lr[1]+Rr,Lr[2]+Rr)}}else{for(let Qr=0;Qr<Dn;Qr++){const Rr=Vr[Qr];Fn(Rr[2],Rr[1],Rr[0])}for(let Qr=0;Qr<Dn;Qr++){const Rr=Vr[Qr];Fn(Rr[0]+Mn*Ut,Rr[1]+Mn*Ut,Rr[2]+Mn*Ut)}}pt.addGroup(Fr,mt.length/3-Fr,0)})(),function(){const Fr=mt.length/3;let Qr=0;ts(gn,Qr),Qr+=gn.length;for(let Rr=0,_r=Gr.length;Rr<_r;Rr++){const Lr=Gr[Rr];ts(Lr,Qr),Qr+=Lr.length}pt.addGroup(Fr,mt.length/3-Fr,1)}()}this.setAttribute("position",new Ln(mt,3)),this.setAttribute("uv",new Ln(vt,2)),this.computeVertexNormals()}copy(_e){return super.copy(_e),this.parameters=Object.assign({},_e.parameters),this}toJSON(){const _e=super.toJSON();return function(at,pt,mt){if(mt.shapes=[],Array.isArray(at))for(let vt=0,Ct=at.length;vt<Ct;vt++){const Tt=at[vt];mt.shapes.push(Tt.uuid)}else mt.shapes.push(at.uuid);return mt.options=Object.assign({},pt),pt.extrudePath!==void 0&&(mt.options.extrudePath=pt.extrudePath.toJSON()),mt}(this.parameters.shapes,this.parameters.options,_e)}static fromJSON(_e,at){const pt=[];for(let vt=0,Ct=_e.shapes.length;vt<Ct;vt++){const Tt=at[_e.shapes[vt]];pt.push(Tt)}const mt=_e.options.extrudePath;return mt!==void 0&&(_e.options.extrudePath=new zv[mt.type]().fromJSON(mt)),new Zv(pt,_e.options)}}const xE={generateTopUV:function(Et,_e,at,pt,mt){const vt=_e[3*at],Ct=_e[3*at+1],Tt=_e[3*pt],Bt=_e[3*pt+1],Lt=_e[3*mt],Ut=_e[3*mt+1];return[new dn(vt,Ct),new dn(Tt,Bt),new dn(Lt,Ut)]},generateSideWallUV:function(Et,_e,at,pt,mt,vt){const Ct=_e[3*at],Tt=_e[3*at+1],Bt=_e[3*at+2],Lt=_e[3*pt],Ut=_e[3*pt+1],Qt=_e[3*pt+2],Ht=_e[3*mt],Wt=_e[3*mt+1],qt=_e[3*mt+2],Jt=_e[3*vt],Xt=_e[3*vt+1],sr=_e[3*vt+2];return Math.abs(Tt-Ut)<Math.abs(Ct-Lt)?[new dn(Ct,1-Bt),new dn(Lt,1-Qt),new dn(Ht,1-qt),new dn(Jt,1-sr)]:[new dn(Tt,1-Bt),new dn(Ut,1-Qt),new dn(Wt,1-qt),new dn(Xt,1-sr)]}};class e0 extends Ku{constructor(_e=1,at=0){const pt=(1+Math.sqrt(5))/2;super([-1,pt,0,1,pt,0,-1,-pt,0,1,-pt,0,0,-1,pt,0,1,pt,0,-1,-pt,0,1,-pt,pt,0,-1,pt,0,1,-pt,0,-1,-pt,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],_e,at),this.type="IcosahedronGeometry",this.parameters={radius:_e,detail:at}}static fromJSON(_e){return new e0(_e.radius,_e.detail)}}class I_ extends Ku{constructor(_e=1,at=0){super([1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],_e,at),this.type="OctahedronGeometry",this.parameters={radius:_e,detail:at}}static fromJSON(_e){return new I_(_e.radius,_e.detail)}}class t0 extends _s{constructor(_e=.5,at=1,pt=32,mt=1,vt=0,Ct=2*Math.PI){super(),this.type="RingGeometry",this.parameters={innerRadius:_e,outerRadius:at,thetaSegments:pt,phiSegments:mt,thetaStart:vt,thetaLength:Ct},pt=Math.max(3,pt);const Tt=[],Bt=[],Lt=[],Ut=[];let Qt=_e;const Ht=(at-_e)/(mt=Math.max(1,mt)),Wt=new Er,qt=new dn;for(let Jt=0;Jt<=mt;Jt++){for(let Xt=0;Xt<=pt;Xt++){const sr=vt+Xt/pt*Ct;Wt.x=Qt*Math.cos(sr),Wt.y=Qt*Math.sin(sr),Bt.push(Wt.x,Wt.y,Wt.z),Lt.push(0,0,1),qt.x=(Wt.x/at+1)/2,qt.y=(Wt.y/at+1)/2,Ut.push(qt.x,qt.y)}Qt+=Ht}for(let Jt=0;Jt<mt;Jt++){const Xt=Jt*(pt+1);for(let sr=0;sr<pt;sr++){const Zt=sr+Xt,er=Zt,xr=Zt+pt+1,Ar=Zt+pt+2,yr=Zt+1;Tt.push(er,xr,yr),Tt.push(xr,Ar,yr)}}this.setIndex(Tt),this.setAttribute("position",new Ln(Bt,3)),this.setAttribute("normal",new Ln(Lt,3)),this.setAttribute("uv",new Ln(Ut,2))}copy(_e){return super.copy(_e),this.parameters=Object.assign({},_e.parameters),this}static fromJSON(_e){return new t0(_e.innerRadius,_e.outerRadius,_e.thetaSegments,_e.phiSegments,_e.thetaStart,_e.thetaLength)}}class r0 extends _s{constructor(_e=new Cp([new dn(0,.5),new dn(-.5,-.5),new dn(.5,-.5)]),at=12){super(),this.type="ShapeGeometry",this.parameters={shapes:_e,curveSegments:at};const pt=[],mt=[],vt=[],Ct=[];let Tt=0,Bt=0;if(Array.isArray(_e)===!1)Lt(_e);else for(let Ut=0;Ut<_e.length;Ut++)Lt(_e[Ut]),this.addGroup(Tt,Bt,Ut),Tt+=Bt,Bt=0;function Lt(Ut){const Qt=mt.length/3,Ht=Ut.extractPoints(at);let Wt=Ht.shape;const qt=Ht.holes;eu.isClockWise(Wt)===!1&&(Wt=Wt.reverse());for(let Xt=0,sr=qt.length;Xt<sr;Xt++){const Zt=qt[Xt];eu.isClockWise(Zt)===!0&&(qt[Xt]=Zt.reverse())}const Jt=eu.triangulateShape(Wt,qt);for(let Xt=0,sr=qt.length;Xt<sr;Xt++){const Zt=qt[Xt];Wt=Wt.concat(Zt)}for(let Xt=0,sr=Wt.length;Xt<sr;Xt++){const Zt=Wt[Xt];mt.push(Zt.x,Zt.y,0),vt.push(0,0,1),Ct.push(Zt.x,Zt.y)}for(let Xt=0,sr=Jt.length;Xt<sr;Xt++){const Zt=Jt[Xt],er=Zt[0]+Qt,xr=Zt[1]+Qt,Ar=Zt[2]+Qt;pt.push(er,xr,Ar),Bt+=3}}this.setIndex(pt),this.setAttribute("position",new Ln(mt,3)),this.setAttribute("normal",new Ln(vt,3)),this.setAttribute("uv",new Ln(Ct,2))}copy(_e){return super.copy(_e),this.parameters=Object.assign({},_e.parameters),this}toJSON(){const _e=super.toJSON();return function(at,pt){if(pt.shapes=[],Array.isArray(at))for(let mt=0,vt=at.length;mt<vt;mt++){const Ct=at[mt];pt.shapes.push(Ct.uuid)}else pt.shapes.push(at.uuid);return pt}(this.parameters.shapes,_e)}static fromJSON(_e,at){const pt=[];for(let mt=0,vt=_e.shapes.length;mt<vt;mt++){const Ct=at[_e.shapes[mt]];pt.push(Ct)}return new r0(pt,_e.curveSegments)}}class R_ extends _s{constructor(_e=1,at=32,pt=16,mt=0,vt=2*Math.PI,Ct=0,Tt=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:_e,widthSegments:at,heightSegments:pt,phiStart:mt,phiLength:vt,thetaStart:Ct,thetaLength:Tt},at=Math.max(3,Math.floor(at)),pt=Math.max(2,Math.floor(pt));const Bt=Math.min(Ct+Tt,Math.PI);let Lt=0;const Ut=[],Qt=new Er,Ht=new Er,Wt=[],qt=[],Jt=[],Xt=[];for(let sr=0;sr<=pt;sr++){const Zt=[],er=sr/pt;let xr=0;sr===0&&Ct===0?xr=.5/at:sr===pt&&Bt===Math.PI&&(xr=-.5/at);for(let Ar=0;Ar<=at;Ar++){const yr=Ar/at;Qt.x=-_e*Math.cos(mt+yr*vt)*Math.sin(Ct+er*Tt),Qt.y=_e*Math.cos(Ct+er*Tt),Qt.z=_e*Math.sin(mt+yr*vt)*Math.sin(Ct+er*Tt),qt.push(Qt.x,Qt.y,Qt.z),Ht.copy(Qt).normalize(),Jt.push(Ht.x,Ht.y,Ht.z),Xt.push(yr+xr,1-er),Zt.push(Lt++)}Ut.push(Zt)}for(let sr=0;sr<pt;sr++)for(let Zt=0;Zt<at;Zt++){const er=Ut[sr][Zt+1],xr=Ut[sr][Zt],Ar=Ut[sr+1][Zt],yr=Ut[sr+1][Zt+1];(sr!==0||Ct>0)&&Wt.push(er,xr,yr),(sr!==pt-1||Bt<Math.PI)&&Wt.push(xr,Ar,yr)}this.setIndex(Wt),this.setAttribute("position",new Ln(qt,3)),this.setAttribute("normal",new Ln(Jt,3)),this.setAttribute("uv",new Ln(Xt,2))}copy(_e){return super.copy(_e),this.parameters=Object.assign({},_e.parameters),this}static fromJSON(_e){return new R_(_e.radius,_e.widthSegments,_e.heightSegments,_e.phiStart,_e.phiLength,_e.thetaStart,_e.thetaLength)}}class i0 extends Ku{constructor(_e=1,at=0){super([1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],_e,at),this.type="TetrahedronGeometry",this.parameters={radius:_e,detail:at}}static fromJSON(_e){return new i0(_e.radius,_e.detail)}}class n0 extends _s{constructor(_e=1,at=.4,pt=12,mt=48,vt=2*Math.PI){super(),this.type="TorusGeometry",this.parameters={radius:_e,tube:at,radialSegments:pt,tubularSegments:mt,arc:vt},pt=Math.floor(pt),mt=Math.floor(mt);const Ct=[],Tt=[],Bt=[],Lt=[],Ut=new Er,Qt=new Er,Ht=new Er;for(let Wt=0;Wt<=pt;Wt++)for(let qt=0;qt<=mt;qt++){const Jt=qt/mt*vt,Xt=Wt/pt*Math.PI*2;Qt.x=(_e+at*Math.cos(Xt))*Math.cos(Jt),Qt.y=(_e+at*Math.cos(Xt))*Math.sin(Jt),Qt.z=at*Math.sin(Xt),Tt.push(Qt.x,Qt.y,Qt.z),Ut.x=_e*Math.cos(Jt),Ut.y=_e*Math.sin(Jt),Ht.subVectors(Qt,Ut).normalize(),Bt.push(Ht.x,Ht.y,Ht.z),Lt.push(qt/mt),Lt.push(Wt/pt)}for(let Wt=1;Wt<=pt;Wt++)for(let qt=1;qt<=mt;qt++){const Jt=(mt+1)*Wt+qt-1,Xt=(mt+1)*(Wt-1)+qt-1,sr=(mt+1)*(Wt-1)+qt,Zt=(mt+1)*Wt+qt;Ct.push(Jt,Xt,Zt),Ct.push(Xt,sr,Zt)}this.setIndex(Ct),this.setAttribute("position",new Ln(Tt,3)),this.setAttribute("normal",new Ln(Bt,3)),this.setAttribute("uv",new Ln(Lt,2))}copy(_e){return super.copy(_e),this.parameters=Object.assign({},_e.parameters),this}static fromJSON(_e){return new n0(_e.radius,_e.tube,_e.radialSegments,_e.tubularSegments,_e.arc)}}class s0 extends _s{constructor(_e=1,at=.4,pt=64,mt=8,vt=2,Ct=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:_e,tube:at,tubularSegments:pt,radialSegments:mt,p:vt,q:Ct},pt=Math.floor(pt),mt=Math.floor(mt);const Tt=[],Bt=[],Lt=[],Ut=[],Qt=new Er,Ht=new Er,Wt=new Er,qt=new Er,Jt=new Er,Xt=new Er,sr=new Er;for(let er=0;er<=pt;++er){const xr=er/pt*vt*Math.PI*2;Zt(xr,vt,Ct,_e,Wt),Zt(xr+.01,vt,Ct,_e,qt),Xt.subVectors(qt,Wt),sr.addVectors(qt,Wt),Jt.crossVectors(Xt,sr),sr.crossVectors(Jt,Xt),Jt.normalize(),sr.normalize();for(let Ar=0;Ar<=mt;++Ar){const yr=Ar/mt*Math.PI*2,Tr=-at*Math.cos(yr),Hr=at*Math.sin(yr);Qt.x=Wt.x+(Tr*sr.x+Hr*Jt.x),Qt.y=Wt.y+(Tr*sr.y+Hr*Jt.y),Qt.z=Wt.z+(Tr*sr.z+Hr*Jt.z),Bt.push(Qt.x,Qt.y,Qt.z),Ht.subVectors(Qt,Wt).normalize(),Lt.push(Ht.x,Ht.y,Ht.z),Ut.push(er/pt),Ut.push(Ar/mt)}}for(let er=1;er<=pt;er++)for(let xr=1;xr<=mt;xr++){const Ar=(mt+1)*(er-1)+(xr-1),yr=(mt+1)*er+(xr-1),Tr=(mt+1)*er+xr,Hr=(mt+1)*(er-1)+xr;Tt.push(Ar,yr,Hr),Tt.push(yr,Tr,Hr)}function Zt(er,xr,Ar,yr,Tr){const Hr=Math.cos(er),Nr=Math.sin(er),zr=Ar/xr*er,Gr=Math.cos(zr);Tr.x=yr*(2+Gr)*.5*Hr,Tr.y=yr*(2+Gr)*Nr*.5,Tr.z=yr*Math.sin(zr)*.5}this.setIndex(Tt),this.setAttribute("position",new Ln(Bt,3)),this.setAttribute("normal",new Ln(Lt,3)),this.setAttribute("uv",new Ln(Ut,2))}copy(_e){return super.copy(_e),this.parameters=Object.assign({},_e.parameters),this}static fromJSON(_e){return new s0(_e.radius,_e.tube,_e.tubularSegments,_e.radialSegments,_e.p,_e.q)}}class a0 extends _s{constructor(_e=new oy(new Er(-1,-1,0),new Er(-1,1,0),new Er(1,1,0)),at=64,pt=1,mt=8,vt=!1){super(),this.type="TubeGeometry",this.parameters={path:_e,tubularSegments:at,radius:pt,radialSegments:mt,closed:vt};const Ct=_e.computeFrenetFrames(at,vt);this.tangents=Ct.tangents,this.normals=Ct.normals,this.binormals=Ct.binormals;const Tt=new Er,Bt=new Er,Lt=new dn;let Ut=new Er;const Qt=[],Ht=[],Wt=[],qt=[];function Jt(Xt){Ut=_e.getPointAt(Xt/at,Ut);const sr=Ct.normals[Xt],Zt=Ct.binormals[Xt];for(let er=0;er<=mt;er++){const xr=er/mt*Math.PI*2,Ar=Math.sin(xr),yr=-Math.cos(xr);Bt.x=yr*sr.x+Ar*Zt.x,Bt.y=yr*sr.y+Ar*Zt.y,Bt.z=yr*sr.z+Ar*Zt.z,Bt.normalize(),Ht.push(Bt.x,Bt.y,Bt.z),Tt.x=Ut.x+pt*Bt.x,Tt.y=Ut.y+pt*Bt.y,Tt.z=Ut.z+pt*Bt.z,Qt.push(Tt.x,Tt.y,Tt.z)}}(function(){for(let Xt=0;Xt<at;Xt++)Jt(Xt);Jt(vt===!1?at:0),function(){for(let Xt=0;Xt<=at;Xt++)for(let sr=0;sr<=mt;sr++)Lt.x=Xt/at,Lt.y=sr/mt,Wt.push(Lt.x,Lt.y)}(),function(){for(let Xt=1;Xt<=at;Xt++)for(let sr=1;sr<=mt;sr++){const Zt=(mt+1)*(Xt-1)+(sr-1),er=(mt+1)*Xt+(sr-1),xr=(mt+1)*Xt+sr,Ar=(mt+1)*(Xt-1)+sr;qt.push(Zt,er,Ar),qt.push(er,xr,Ar)}}()})(),this.setIndex(qt),this.setAttribute("position",new Ln(Qt,3)),this.setAttribute("normal",new Ln(Ht,3)),this.setAttribute("uv",new Ln(Wt,2))}copy(_e){return super.copy(_e),this.parameters=Object.assign({},_e.parameters),this}toJSON(){const _e=super.toJSON();return _e.path=this.parameters.path.toJSON(),_e}static fromJSON(_e){return new a0(new zv[_e.path.type]().fromJSON(_e.path),_e.tubularSegments,_e.radius,_e.radialSegments,_e.closed)}}class aA extends _s{constructor(_e=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:_e},_e!==null){const at=[],pt=new Set,mt=new Er,vt=new Er;if(_e.index!==null){const Ct=_e.attributes.position,Tt=_e.index;let Bt=_e.groups;Bt.length===0&&(Bt=[{start:0,count:Tt.count,materialIndex:0}]);for(let Lt=0,Ut=Bt.length;Lt<Ut;++Lt){const Qt=Bt[Lt],Ht=Qt.start;for(let Wt=Ht,qt=Ht+Qt.count;Wt<qt;Wt+=3)for(let Jt=0;Jt<3;Jt++){const Xt=Tt.getX(Wt+Jt),sr=Tt.getX(Wt+(Jt+1)%3);mt.fromBufferAttribute(Ct,Xt),vt.fromBufferAttribute(Ct,sr),oA(mt,vt,pt)===!0&&(at.push(mt.x,mt.y,mt.z),at.push(vt.x,vt.y,vt.z))}}}else{const Ct=_e.attributes.position;for(let Tt=0,Bt=Ct.count/3;Tt<Bt;Tt++)for(let Lt=0;Lt<3;Lt++){const Ut=3*Tt+Lt,Qt=3*Tt+(Lt+1)%3;mt.fromBufferAttribute(Ct,Ut),vt.fromBufferAttribute(Ct,Qt),oA(mt,vt,pt)===!0&&(at.push(mt.x,mt.y,mt.z),at.push(vt.x,vt.y,vt.z))}}this.setAttribute("position",new Ln(at,3))}}copy(_e){return super.copy(_e),this.parameters=Object.assign({},_e.parameters),this}}function oA(Et,_e,at){const pt=`${Et.x},${Et.y},${Et.z}-${_e.x},${_e.y},${_e.z}`,mt=`${_e.x},${_e.y},${_e.z}-${Et.x},${Et.y},${Et.z}`;return at.has(pt)!==!0&&at.has(mt)!==!0&&(at.add(pt),at.add(mt),!0)}var lA=Object.freeze({__proto__:null,BoxGeometry:$u,CapsuleGeometry:Vv,CircleGeometry:Hv,ConeGeometry:Qv,CylinderGeometry:Im,DodecahedronGeometry:Wv,EdgesGeometry:Zx,ExtrudeGeometry:Zv,IcosahedronGeometry:e0,LatheGeometry:C_,OctahedronGeometry:I_,PlaneGeometry:__,PolyhedronGeometry:Ku,RingGeometry:t0,ShapeGeometry:r0,SphereGeometry:R_,TetrahedronGeometry:i0,TorusGeometry:n0,TorusKnotGeometry:s0,TubeGeometry:a0,WireframeGeometry:aA});class cA extends so{constructor(_e){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new Un(0),this.transparent=!0,this.fog=!0,this.setValues(_e)}copy(_e){return super.copy(_e),this.color.copy(_e.color),this.fog=_e.fog,this}}class uA extends Fl{constructor(_e){super(_e),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}class hy extends so{constructor(_e){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Un(16777215),this.roughness=.5,this.metalness=.1,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Un(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=yl,this.normalScale=new dn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=.05,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(_e)}copy(_e){return super.copy(_e),this.defines={STANDARD:""},this.color.copy(_e.color),this.roughness=_e.roughness,this.metalness=_e.metalness,this.map=_e.map,this.lightMap=_e.lightMap,this.lightMapIntensity=_e.lightMapIntensity,this.aoMap=_e.aoMap,this.aoMapIntensity=_e.aoMapIntensity,this.emissive.copy(_e.emissive),this.emissiveMap=_e.emissiveMap,this.emissiveIntensity=_e.emissiveIntensity,this.bumpMap=_e.bumpMap,this.bumpScale=_e.bumpScale,this.normalMap=_e.normalMap,this.normalMapType=_e.normalMapType,this.normalScale.copy(_e.normalScale),this.displacementMap=_e.displacementMap,this.displacementScale=_e.displacementScale,this.displacementBias=_e.displacementBias,this.roughnessMap=_e.roughnessMap,this.metalnessMap=_e.metalnessMap,this.alphaMap=_e.alphaMap,this.envMap=_e.envMap,this.envMapIntensity=_e.envMapIntensity,this.wireframe=_e.wireframe,this.wireframeLinewidth=_e.wireframeLinewidth,this.wireframeLinecap=_e.wireframeLinecap,this.wireframeLinejoin=_e.wireframeLinejoin,this.flatShading=_e.flatShading,this.fog=_e.fog,this}}class pA extends hy{constructor(_e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new dn(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return Hs(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(at){this.ior=(1+.4*at)/(1-.4*at)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new Un(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new Un(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new Un(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(_e)}get anisotropy(){return this._anisotropy}set anisotropy(_e){this._anisotropy>0!=_e>0&&this.version++,this._anisotropy=_e}get clearcoat(){return this._clearcoat}set clearcoat(_e){this._clearcoat>0!=_e>0&&this.version++,this._clearcoat=_e}get iridescence(){return this._iridescence}set iridescence(_e){this._iridescence>0!=_e>0&&this.version++,this._iridescence=_e}get sheen(){return this._sheen}set sheen(_e){this._sheen>0!=_e>0&&this.version++,this._sheen=_e}get transmission(){return this._transmission}set transmission(_e){this._transmission>0!=_e>0&&this.version++,this._transmission=_e}copy(_e){return super.copy(_e),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=_e.anisotropy,this.anisotropyRotation=_e.anisotropyRotation,this.anisotropyMap=_e.anisotropyMap,this.clearcoat=_e.clearcoat,this.clearcoatMap=_e.clearcoatMap,this.clearcoatRoughness=_e.clearcoatRoughness,this.clearcoatRoughnessMap=_e.clearcoatRoughnessMap,this.clearcoatNormalMap=_e.clearcoatNormalMap,this.clearcoatNormalScale.copy(_e.clearcoatNormalScale),this.ior=_e.ior,this.iridescence=_e.iridescence,this.iridescenceMap=_e.iridescenceMap,this.iridescenceIOR=_e.iridescenceIOR,this.iridescenceThicknessRange=[..._e.iridescenceThicknessRange],this.iridescenceThicknessMap=_e.iridescenceThicknessMap,this.sheen=_e.sheen,this.sheenColor.copy(_e.sheenColor),this.sheenColorMap=_e.sheenColorMap,this.sheenRoughness=_e.sheenRoughness,this.sheenRoughnessMap=_e.sheenRoughnessMap,this.transmission=_e.transmission,this.transmissionMap=_e.transmissionMap,this.thickness=_e.thickness,this.thicknessMap=_e.thicknessMap,this.attenuationDistance=_e.attenuationDistance,this.attenuationColor.copy(_e.attenuationColor),this.specularIntensity=_e.specularIntensity,this.specularIntensityMap=_e.specularIntensityMap,this.specularColor.copy(_e.specularColor),this.specularColorMap=_e.specularColorMap,this}}class hA extends so{constructor(_e){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new Un(16777215),this.specular=new Un(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Un(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=yl,this.normalScale=new dn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=vn,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(_e)}copy(_e){return super.copy(_e),this.color.copy(_e.color),this.specular.copy(_e.specular),this.shininess=_e.shininess,this.map=_e.map,this.lightMap=_e.lightMap,this.lightMapIntensity=_e.lightMapIntensity,this.aoMap=_e.aoMap,this.aoMapIntensity=_e.aoMapIntensity,this.emissive.copy(_e.emissive),this.emissiveMap=_e.emissiveMap,this.emissiveIntensity=_e.emissiveIntensity,this.bumpMap=_e.bumpMap,this.bumpScale=_e.bumpScale,this.normalMap=_e.normalMap,this.normalMapType=_e.normalMapType,this.normalScale.copy(_e.normalScale),this.displacementMap=_e.displacementMap,this.displacementScale=_e.displacementScale,this.displacementBias=_e.displacementBias,this.specularMap=_e.specularMap,this.alphaMap=_e.alphaMap,this.envMap=_e.envMap,this.combine=_e.combine,this.reflectivity=_e.reflectivity,this.refractionRatio=_e.refractionRatio,this.wireframe=_e.wireframe,this.wireframeLinewidth=_e.wireframeLinewidth,this.wireframeLinecap=_e.wireframeLinecap,this.wireframeLinejoin=_e.wireframeLinejoin,this.flatShading=_e.flatShading,this.fog=_e.fog,this}}class dA extends so{constructor(_e){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new Un(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Un(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=yl,this.normalScale=new dn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(_e)}copy(_e){return super.copy(_e),this.color.copy(_e.color),this.map=_e.map,this.gradientMap=_e.gradientMap,this.lightMap=_e.lightMap,this.lightMapIntensity=_e.lightMapIntensity,this.aoMap=_e.aoMap,this.aoMapIntensity=_e.aoMapIntensity,this.emissive.copy(_e.emissive),this.emissiveMap=_e.emissiveMap,this.emissiveIntensity=_e.emissiveIntensity,this.bumpMap=_e.bumpMap,this.bumpScale=_e.bumpScale,this.normalMap=_e.normalMap,this.normalMapType=_e.normalMapType,this.normalScale.copy(_e.normalScale),this.displacementMap=_e.displacementMap,this.displacementScale=_e.displacementScale,this.displacementBias=_e.displacementBias,this.alphaMap=_e.alphaMap,this.wireframe=_e.wireframe,this.wireframeLinewidth=_e.wireframeLinewidth,this.wireframeLinecap=_e.wireframeLinecap,this.wireframeLinejoin=_e.wireframeLinejoin,this.fog=_e.fog,this}}class mA extends so{constructor(_e){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=yl,this.normalScale=new dn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(_e)}copy(_e){return super.copy(_e),this.bumpMap=_e.bumpMap,this.bumpScale=_e.bumpScale,this.normalMap=_e.normalMap,this.normalMapType=_e.normalMapType,this.normalScale.copy(_e.normalScale),this.displacementMap=_e.displacementMap,this.displacementScale=_e.displacementScale,this.displacementBias=_e.displacementBias,this.wireframe=_e.wireframe,this.wireframeLinewidth=_e.wireframeLinewidth,this.flatShading=_e.flatShading,this}}class gA extends so{constructor(_e){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new Un(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Un(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=yl,this.normalScale=new dn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=vn,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(_e)}copy(_e){return super.copy(_e),this.color.copy(_e.color),this.map=_e.map,this.lightMap=_e.lightMap,this.lightMapIntensity=_e.lightMapIntensity,this.aoMap=_e.aoMap,this.aoMapIntensity=_e.aoMapIntensity,this.emissive.copy(_e.emissive),this.emissiveMap=_e.emissiveMap,this.emissiveIntensity=_e.emissiveIntensity,this.bumpMap=_e.bumpMap,this.bumpScale=_e.bumpScale,this.normalMap=_e.normalMap,this.normalMapType=_e.normalMapType,this.normalScale.copy(_e.normalScale),this.displacementMap=_e.displacementMap,this.displacementScale=_e.displacementScale,this.displacementBias=_e.displacementBias,this.specularMap=_e.specularMap,this.alphaMap=_e.alphaMap,this.envMap=_e.envMap,this.combine=_e.combine,this.reflectivity=_e.reflectivity,this.refractionRatio=_e.refractionRatio,this.wireframe=_e.wireframe,this.wireframeLinewidth=_e.wireframeLinewidth,this.wireframeLinecap=_e.wireframeLinecap,this.wireframeLinejoin=_e.wireframeLinejoin,this.flatShading=_e.flatShading,this.fog=_e.fog,this}}class _A extends so{constructor(_e){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new Un(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=yl,this.normalScale=new dn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(_e)}copy(_e){return super.copy(_e),this.defines={MATCAP:""},this.color.copy(_e.color),this.matcap=_e.matcap,this.map=_e.map,this.bumpMap=_e.bumpMap,this.bumpScale=_e.bumpScale,this.normalMap=_e.normalMap,this.normalMapType=_e.normalMapType,this.normalScale.copy(_e.normalScale),this.displacementMap=_e.displacementMap,this.displacementScale=_e.displacementScale,this.displacementBias=_e.displacementBias,this.alphaMap=_e.alphaMap,this.flatShading=_e.flatShading,this.fog=_e.fog,this}}class fA extends Lo{constructor(_e){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(_e)}copy(_e){return super.copy(_e),this.scale=_e.scale,this.dashSize=_e.dashSize,this.gapSize=_e.gapSize,this}}function Tp(Et,_e,at){return!Et||!at&&Et.constructor===_e?Et:typeof _e.BYTES_PER_ELEMENT=="number"?new _e(Et):Array.prototype.slice.call(Et)}function vA(Et){return ArrayBuffer.isView(Et)&&!(Et instanceof DataView)}function yA(Et){const _e=Et.length,at=new Array(_e);for(let pt=0;pt!==_e;++pt)at[pt]=pt;return at.sort(function(pt,mt){return Et[pt]-Et[mt]}),at}function dy(Et,_e,at){const pt=Et.length,mt=new Et.constructor(pt);for(let vt=0,Ct=0;Ct!==pt;++vt){const Tt=at[vt]*_e;for(let Bt=0;Bt!==_e;++Bt)mt[Ct++]=Et[Tt+Bt]}return mt}function my(Et,_e,at,pt){let mt=1,vt=Et[0];for(;vt!==void 0&&vt[pt]===void 0;)vt=Et[mt++];if(vt===void 0)return;let Ct=vt[pt];if(Ct!==void 0)if(Array.isArray(Ct))do Ct=vt[pt],Ct!==void 0&&(_e.push(vt.time),at.push.apply(at,Ct)),vt=Et[mt++];while(vt!==void 0);else if(Ct.toArray!==void 0)do Ct=vt[pt],Ct!==void 0&&(_e.push(vt.time),Ct.toArray(at,at.length)),vt=Et[mt++];while(vt!==void 0);else do Ct=vt[pt],Ct!==void 0&&(_e.push(vt.time),at.push(Ct)),vt=Et[mt++];while(vt!==void 0)}const AE={convertArray:Tp,isTypedArray:vA,getKeyframeOrder:yA,sortedArray:dy,flattenJSON:my,subclip:function(Et,_e,at,pt,mt=30){const vt=Et.clone();vt.name=_e;const Ct=[];for(let Bt=0;Bt<vt.tracks.length;++Bt){const Lt=vt.tracks[Bt],Ut=Lt.getValueSize(),Qt=[],Ht=[];for(let Wt=0;Wt<Lt.times.length;++Wt){const qt=Lt.times[Wt]*mt;if(!(qt<at||qt>=pt)){Qt.push(Lt.times[Wt]);for(let Jt=0;Jt<Ut;++Jt)Ht.push(Lt.values[Wt*Ut+Jt])}}Qt.length!==0&&(Lt.times=Tp(Qt,Lt.times.constructor),Lt.values=Tp(Ht,Lt.values.constructor),Ct.push(Lt))}vt.tracks=Ct;let Tt=1/0;for(let Bt=0;Bt<vt.tracks.length;++Bt)Tt>vt.tracks[Bt].times[0]&&(Tt=vt.tracks[Bt].times[0]);for(let Bt=0;Bt<vt.tracks.length;++Bt)vt.tracks[Bt].shift(-1*Tt);return vt.resetDuration(),vt},makeClipAdditive:function(Et,_e=0,at=Et,pt=30){pt<=0&&(pt=30);const mt=at.tracks.length,vt=_e/pt;for(let Ct=0;Ct<mt;++Ct){const Tt=at.tracks[Ct],Bt=Tt.ValueTypeName;if(Bt==="bool"||Bt==="string")continue;const Lt=Et.tracks.find(function(sr){return sr.name===Tt.name&&sr.ValueTypeName===Bt});if(Lt===void 0)continue;let Ut=0;const Qt=Tt.getValueSize();Tt.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(Ut=Qt/3);let Ht=0;const Wt=Lt.getValueSize();Lt.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(Ht=Wt/3);const qt=Tt.times.length-1;let Jt;if(vt<=Tt.times[0]){const sr=Ut,Zt=Qt-Ut;Jt=Tt.values.slice(sr,Zt)}else if(vt>=Tt.times[qt]){const sr=qt*Qt+Ut,Zt=sr+Qt-Ut;Jt=Tt.values.slice(sr,Zt)}else{const sr=Tt.createInterpolant(),Zt=Ut,er=Qt-Ut;sr.evaluate(vt),Jt=sr.resultBuffer.slice(Zt,er)}Bt==="quaternion"&&new wo().fromArray(Jt).normalize().conjugate().toArray(Jt);const Xt=Lt.times.length;for(let sr=0;sr<Xt;++sr){const Zt=sr*Wt+Ht;if(Bt==="quaternion")wo.multiplyQuaternionsFlat(Lt.values,Zt,Jt,0,Lt.values,Zt);else{const er=Wt-2*Ht;for(let xr=0;xr<er;++xr)Lt.values[Zt+xr]-=Jt[xr]}}}return Et.blendMode=Xp,Et}};class k_{constructor(_e,at,pt,mt){this.parameterPositions=_e,this._cachedIndex=0,this.resultBuffer=mt!==void 0?mt:new at.constructor(pt),this.sampleValues=at,this.valueSize=pt,this.settings=null,this.DefaultSettings_={}}evaluate(_e){const at=this.parameterPositions;let pt=this._cachedIndex,mt=at[pt],vt=at[pt-1];e:{t:{let Ct;r:{i:if(!(_e<mt)){for(let Tt=pt+2;;){if(mt===void 0){if(_e<vt)break i;return pt=at.length,this._cachedIndex=pt,this.copySampleValue_(pt-1)}if(pt===Tt)break;if(vt=mt,mt=at[++pt],_e<mt)break t}Ct=at.length;break r}if(_e>=vt)break e;{const Tt=at[1];_e<Tt&&(pt=2,vt=Tt);for(let Bt=pt-2;;){if(vt===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(pt===Bt)break;if(mt=vt,vt=at[--pt-1],_e>=vt)break t}Ct=pt,pt=0}}for(;pt<Ct;){const Tt=pt+Ct>>>1;_e<at[Tt]?Ct=Tt:pt=Tt+1}if(mt=at[pt],vt=at[pt-1],vt===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(mt===void 0)return pt=at.length,this._cachedIndex=pt,this.copySampleValue_(pt-1)}this._cachedIndex=pt,this.intervalChanged_(pt,vt,mt)}return this.interpolate_(pt,vt,_e,mt)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(_e){const at=this.resultBuffer,pt=this.sampleValues,mt=this.valueSize,vt=_e*mt;for(let Ct=0;Ct!==mt;++Ct)at[Ct]=pt[vt+Ct];return at}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class bA extends k_{constructor(_e,at,pt,mt){super(_e,at,pt,mt),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:au,endingEnd:au}}intervalChanged_(_e,at,pt){const mt=this.parameterPositions;let vt=_e-2,Ct=_e+1,Tt=mt[vt],Bt=mt[Ct];if(Tt===void 0)switch(this.getSettings_().endingStart){case ou:vt=_e,Tt=2*at-pt;break;case op:vt=mt.length-2,Tt=at+mt[vt]-mt[vt+1];break;default:vt=_e,Tt=pt}if(Bt===void 0)switch(this.getSettings_().endingEnd){case ou:Ct=_e,Bt=2*pt-at;break;case op:Ct=1,Bt=pt+mt[1]-mt[0];break;default:Ct=_e-1,Bt=at}const Lt=.5*(pt-at),Ut=this.valueSize;this._weightPrev=Lt/(at-Tt),this._weightNext=Lt/(Bt-pt),this._offsetPrev=vt*Ut,this._offsetNext=Ct*Ut}interpolate_(_e,at,pt,mt){const vt=this.resultBuffer,Ct=this.sampleValues,Tt=this.valueSize,Bt=_e*Tt,Lt=Bt-Tt,Ut=this._offsetPrev,Qt=this._offsetNext,Ht=this._weightPrev,Wt=this._weightNext,qt=(pt-at)/(mt-at),Jt=qt*qt,Xt=Jt*qt,sr=-Ht*Xt+2*Ht*Jt-Ht*qt,Zt=(1+Ht)*Xt+(-1.5-2*Ht)*Jt+(-.5+Ht)*qt+1,er=(-1-Wt)*Xt+(1.5+Wt)*Jt+.5*qt,xr=Wt*Xt-Wt*Jt;for(let Ar=0;Ar!==Tt;++Ar)vt[Ar]=sr*Ct[Ut+Ar]+Zt*Ct[Lt+Ar]+er*Ct[Bt+Ar]+xr*Ct[Qt+Ar];return vt}}class gy extends k_{constructor(_e,at,pt,mt){super(_e,at,pt,mt)}interpolate_(_e,at,pt,mt){const vt=this.resultBuffer,Ct=this.sampleValues,Tt=this.valueSize,Bt=_e*Tt,Lt=Bt-Tt,Ut=(pt-at)/(mt-at),Qt=1-Ut;for(let Ht=0;Ht!==Tt;++Ht)vt[Ht]=Ct[Lt+Ht]*Qt+Ct[Bt+Ht]*Ut;return vt}}class xA extends k_{constructor(_e,at,pt,mt){super(_e,at,pt,mt)}interpolate_(_e){return this.copySampleValue_(_e-1)}}class Gl{constructor(_e,at,pt,mt){if(_e===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(at===void 0||at.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+_e);this.name=_e,this.times=Tp(at,this.TimeBufferType),this.values=Tp(pt,this.ValueBufferType),this.setInterpolation(mt||this.DefaultInterpolation)}static toJSON(_e){const at=_e.constructor;let pt;if(at.toJSON!==this.toJSON)pt=at.toJSON(_e);else{pt={name:_e.name,times:Tp(_e.times,Array),values:Tp(_e.values,Array)};const mt=_e.getInterpolation();mt!==_e.DefaultInterpolation&&(pt.interpolation=mt)}return pt.type=_e.ValueTypeName,pt}InterpolantFactoryMethodDiscrete(_e){return new xA(this.times,this.values,this.getValueSize(),_e)}InterpolantFactoryMethodLinear(_e){return new gy(this.times,this.values,this.getValueSize(),_e)}InterpolantFactoryMethodSmooth(_e){return new bA(this.times,this.values,this.getValueSize(),_e)}setInterpolation(_e){let at;switch(_e){case Mu:at=this.InterpolantFactoryMethodDiscrete;break;case ap:at=this.InterpolantFactoryMethodLinear;break;case $p:at=this.InterpolantFactoryMethodSmooth}if(at===void 0){const pt="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0){if(_e===this.DefaultInterpolation)throw new Error(pt);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",pt),this}return this.createInterpolant=at,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Mu;case this.InterpolantFactoryMethodLinear:return ap;case this.InterpolantFactoryMethodSmooth:return $p}}getValueSize(){return this.values.length/this.times.length}shift(_e){if(_e!==0){const at=this.times;for(let pt=0,mt=at.length;pt!==mt;++pt)at[pt]+=_e}return this}scale(_e){if(_e!==1){const at=this.times;for(let pt=0,mt=at.length;pt!==mt;++pt)at[pt]*=_e}return this}trim(_e,at){const pt=this.times,mt=pt.length;let vt=0,Ct=mt-1;for(;vt!==mt&&pt[vt]<_e;)++vt;for(;Ct!==-1&&pt[Ct]>at;)--Ct;if(++Ct,vt!==0||Ct!==mt){vt>=Ct&&(Ct=Math.max(Ct,1),vt=Ct-1);const Tt=this.getValueSize();this.times=pt.slice(vt,Ct),this.values=this.values.slice(vt*Tt,Ct*Tt)}return this}validate(){let _e=!0;const at=this.getValueSize();at-Math.floor(at)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),_e=!1);const pt=this.times,mt=this.values,vt=pt.length;vt===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),_e=!1);let Ct=null;for(let Tt=0;Tt!==vt;Tt++){const Bt=pt[Tt];if(typeof Bt=="number"&&isNaN(Bt)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,Tt,Bt),_e=!1;break}if(Ct!==null&&Ct>Bt){console.error("THREE.KeyframeTrack: Out of order keys.",this,Tt,Bt,Ct),_e=!1;break}Ct=Bt}if(mt!==void 0&&vA(mt))for(let Tt=0,Bt=mt.length;Tt!==Bt;++Tt){const Lt=mt[Tt];if(isNaN(Lt)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,Tt,Lt),_e=!1;break}}return _e}optimize(){const _e=this.times.slice(),at=this.values.slice(),pt=this.getValueSize(),mt=this.getInterpolation()===$p,vt=_e.length-1;let Ct=1;for(let Tt=1;Tt<vt;++Tt){let Bt=!1;const Lt=_e[Tt];if(Lt!==_e[Tt+1]&&(Tt!==1||Lt!==_e[0]))if(mt)Bt=!0;else{const Ut=Tt*pt,Qt=Ut-pt,Ht=Ut+pt;for(let Wt=0;Wt!==pt;++Wt){const qt=at[Ut+Wt];if(qt!==at[Qt+Wt]||qt!==at[Ht+Wt]){Bt=!0;break}}}if(Bt){if(Tt!==Ct){_e[Ct]=_e[Tt];const Ut=Tt*pt,Qt=Ct*pt;for(let Ht=0;Ht!==pt;++Ht)at[Qt+Ht]=at[Ut+Ht]}++Ct}}if(vt>0){_e[Ct]=_e[vt];for(let Tt=vt*pt,Bt=Ct*pt,Lt=0;Lt!==pt;++Lt)at[Bt+Lt]=at[Tt+Lt];++Ct}return Ct!==_e.length?(this.times=_e.slice(0,Ct),this.values=at.slice(0,Ct*pt)):(this.times=_e,this.values=at),this}clone(){const _e=this.times.slice(),at=this.values.slice(),pt=new this.constructor(this.name,_e,at);return pt.createInterpolant=this.createInterpolant,pt}}Gl.prototype.TimeBufferType=Float32Array,Gl.prototype.ValueBufferType=Float32Array,Gl.prototype.DefaultInterpolation=ap;class Mp extends Gl{}Mp.prototype.ValueTypeName="bool",Mp.prototype.ValueBufferType=Array,Mp.prototype.DefaultInterpolation=Mu,Mp.prototype.InterpolantFactoryMethodLinear=void 0,Mp.prototype.InterpolantFactoryMethodSmooth=void 0;class _y extends Gl{}_y.prototype.ValueTypeName="color";class D_ extends Gl{}D_.prototype.ValueTypeName="number";class AA extends k_{constructor(_e,at,pt,mt){super(_e,at,pt,mt)}interpolate_(_e,at,pt,mt){const vt=this.resultBuffer,Ct=this.sampleValues,Tt=this.valueSize,Bt=(pt-at)/(mt-at);let Lt=_e*Tt;for(let Ut=Lt+Tt;Lt!==Ut;Lt+=4)wo.slerpFlat(vt,0,Ct,Lt-Tt,Ct,Lt,Bt);return vt}}class km extends Gl{InterpolantFactoryMethodLinear(_e){return new AA(this.times,this.values,this.getValueSize(),_e)}}km.prototype.ValueTypeName="quaternion",km.prototype.DefaultInterpolation=ap,km.prototype.InterpolantFactoryMethodSmooth=void 0;class Ip extends Gl{}Ip.prototype.ValueTypeName="string",Ip.prototype.ValueBufferType=Array,Ip.prototype.DefaultInterpolation=Mu,Ip.prototype.InterpolantFactoryMethodLinear=void 0,Ip.prototype.InterpolantFactoryMethodSmooth=void 0;class B_ extends Gl{}B_.prototype.ValueTypeName="vector";class L_{constructor(_e,at=-1,pt,mt=Vm){this.name=_e,this.tracks=pt,this.duration=at,this.blendMode=mt,this.uuid=xo(),this.duration<0&&this.resetDuration()}static parse(_e){const at=[],pt=_e.tracks,mt=1/(_e.fps||1);for(let Ct=0,Tt=pt.length;Ct!==Tt;++Ct)at.push(wE(pt[Ct]).scale(mt));const vt=new this(_e.name,_e.duration,at,_e.blendMode);return vt.uuid=_e.uuid,vt}static toJSON(_e){const at=[],pt=_e.tracks,mt={name:_e.name,duration:_e.duration,tracks:at,uuid:_e.uuid,blendMode:_e.blendMode};for(let vt=0,Ct=pt.length;vt!==Ct;++vt)at.push(Gl.toJSON(pt[vt]));return mt}static CreateFromMorphTargetSequence(_e,at,pt,mt){const vt=at.length,Ct=[];for(let Tt=0;Tt<vt;Tt++){let Bt=[],Lt=[];Bt.push((Tt+vt-1)%vt,Tt,(Tt+1)%vt),Lt.push(0,1,0);const Ut=yA(Bt);Bt=dy(Bt,1,Ut),Lt=dy(Lt,1,Ut),mt||Bt[0]!==0||(Bt.push(vt),Lt.push(Lt[0])),Ct.push(new D_(".morphTargetInfluences["+at[Tt].name+"]",Bt,Lt).scale(1/pt))}return new this(_e,-1,Ct)}static findByName(_e,at){let pt=_e;if(!Array.isArray(_e)){const mt=_e;pt=mt.geometry&&mt.geometry.animations||mt.animations}for(let mt=0;mt<pt.length;mt++)if(pt[mt].name===at)return pt[mt];return null}static CreateClipsFromMorphTargetSequences(_e,at,pt){const mt={},vt=/^([\w-]*?)([\d]+)$/;for(let Tt=0,Bt=_e.length;Tt<Bt;Tt++){const Lt=_e[Tt],Ut=Lt.name.match(vt);if(Ut&&Ut.length>1){const Qt=Ut[1];let Ht=mt[Qt];Ht||(mt[Qt]=Ht=[]),Ht.push(Lt)}}const Ct=[];for(const Tt in mt)Ct.push(this.CreateFromMorphTargetSequence(Tt,mt[Tt],at,pt));return Ct}static parseAnimation(_e,at){if(!_e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const pt=function(Ut,Qt,Ht,Wt,qt){if(Ht.length!==0){const Jt=[],Xt=[];my(Ht,Jt,Xt,Wt),Jt.length!==0&&qt.push(new Ut(Qt,Jt,Xt))}},mt=[],vt=_e.name||"default",Ct=_e.fps||30,Tt=_e.blendMode;let Bt=_e.length||-1;const Lt=_e.hierarchy||[];for(let Ut=0;Ut<Lt.length;Ut++){const Qt=Lt[Ut].keys;if(Qt&&Qt.length!==0)if(Qt[0].morphTargets){const Ht={};let Wt;for(Wt=0;Wt<Qt.length;Wt++)if(Qt[Wt].morphTargets)for(let qt=0;qt<Qt[Wt].morphTargets.length;qt++)Ht[Qt[Wt].morphTargets[qt]]=-1;for(const qt in Ht){const Jt=[],Xt=[];for(let sr=0;sr!==Qt[Wt].morphTargets.length;++sr){const Zt=Qt[Wt];Jt.push(Zt.time),Xt.push(Zt.morphTarget===qt?1:0)}mt.push(new D_(".morphTargetInfluence["+qt+"]",Jt,Xt))}Bt=Ht.length*Ct}else{const Ht=".bones["+at[Ut].name+"]";pt(B_,Ht+".position",Qt,"pos",mt),pt(km,Ht+".quaternion",Qt,"rot",mt),pt(B_,Ht+".scale",Qt,"scl",mt)}}return mt.length===0?null:new this(vt,Bt,mt,Tt)}resetDuration(){let _e=0;for(let at=0,pt=this.tracks.length;at!==pt;++at){const mt=this.tracks[at];_e=Math.max(_e,mt.times[mt.times.length-1])}return this.duration=_e,this}trim(){for(let _e=0;_e<this.tracks.length;_e++)this.tracks[_e].trim(0,this.duration);return this}validate(){let _e=!0;for(let at=0;at<this.tracks.length;at++)_e=_e&&this.tracks[at].validate();return _e}optimize(){for(let _e=0;_e<this.tracks.length;_e++)this.tracks[_e].optimize();return this}clone(){const _e=[];for(let at=0;at<this.tracks.length;at++)_e.push(this.tracks[at].clone());return new this.constructor(this.name,this.duration,_e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function wE(Et){if(Et.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const _e=function(at){switch(at.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return D_;case"vector":case"vector2":case"vector3":case"vector4":return B_;case"color":return _y;case"quaternion":return km;case"bool":case"boolean":return Mp;case"string":return Ip}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+at)}(Et.type);if(Et.times===void 0){const at=[],pt=[];my(Et.keys,at,pt,"value"),Et.times=at,Et.values=pt}return _e.parse!==void 0?_e.parse(Et):new _e(Et.name,Et.times,Et.values,Et.interpolation)}const bu={enabled:!1,files:{},add:function(Et,_e){this.enabled!==!1&&(this.files[Et]=_e)},get:function(Et,_e){return this.enabled===!1?_e?Promise.resolve():void 0:_e?Promise.resolve(this.files[Et]):this.files[Et]},remove:function(Et){delete this.files[Et]},clear:function(){this.files={}}};class fy{constructor(_e,at,pt){const mt=this;let vt,Ct=!1,Tt=0,Bt=0;const Lt=[];this.onStart=void 0,this.onLoad=_e,this.onProgress=at,this.onError=pt,this.itemStart=function(Ut){Bt++,Ct===!1&&mt.onStart!==void 0&&mt.onStart(Ut,Tt,Bt),Ct=!0},this.itemEnd=function(Ut){Tt++,mt.onProgress!==void 0&&mt.onProgress(Ut,Tt,Bt),Tt===Bt&&(Ct=!1,mt.onLoad!==void 0&&mt.onLoad())},this.itemError=function(Ut){mt.onError!==void 0&&mt.onError(Ut)},this.resolveURL=function(Ut){return vt?vt(Ut):Ut},this.setURLModifier=function(Ut){return vt=Ut,this},this.addHandler=function(Ut,Qt){return Lt.push(Ut,Qt),this},this.removeHandler=function(Ut){const Qt=Lt.indexOf(Ut);return Qt!==-1&&Lt.splice(Qt,2),this},this.getHandler=function(Ut){for(let Qt=0,Ht=Lt.length;Qt<Ht;Qt+=2){const Wt=Lt[Qt],qt=Lt[Qt+1];if(Wt.global&&(Wt.lastIndex=0),Wt.test(Ut))return qt}return null}}}const wA=new fy;class zo{constructor(_e){this.manager=_e!==void 0?_e:wA,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(_e,at){const pt=this;return new Promise(function(mt,vt){pt.load(_e,mt,at,vt)})}parse(){}setCrossOrigin(_e){return this.crossOrigin=_e,this}setWithCredentials(_e){return this.withCredentials=_e,this}setPath(_e){return this.path=_e,this}setResourcePath(_e){return this.resourcePath=_e,this}setRequestHeader(_e){return this.requestHeader=_e,this}}zo.DEFAULT_MATERIAL_NAME="__DEFAULT";const xu={};class EE extends Error{constructor(_e,at){super(_e),this.response=at}}class tu extends zo{constructor(_e){super(_e),this.responseType="text",this.useCache=!0}load(_e,at,pt,mt){_e===void 0&&(_e=""),this.path!==void 0&&(_e=this.path+_e),_e=this.manager.resolveURL(_e),(this.useCache?bu.get(_e,this.responseType,this.mimeType):Promise.resolve(void 0)).then(vt=>{if(vt!==void 0)return this.manager.itemStart(_e),setTimeout(()=>{at&&at(vt),this.manager.itemEnd(_e)},0),vt;if(xu[_e]!==void 0)return void xu[_e].push({onLoad:at,onProgress:pt,onError:mt});xu[_e]=[],xu[_e].push({onLoad:at,onProgress:pt,onError:mt});const Ct=new Request(_e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),Tt=this.mimeType,Bt=this.responseType;fetch(Ct).then(Lt=>{if(Lt.status===200||Lt.status===0){if(Lt.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||Lt.body===void 0||Lt.body.getReader===void 0)return Lt;const Ut=xu[_e],Qt=Lt.body.getReader(),Ht=Lt.headers.get("Content-Length")||Lt.headers.get("X-File-Size"),Wt=Ht?parseInt(Ht):0,qt=Wt!==0;let Jt=0;const Xt=new ReadableStream({start(sr){(function Zt(){Qt.read().then(({done:er,value:xr})=>{if(er)sr.close();else{Jt+=xr.byteLength;const Ar=new ProgressEvent("progress",{lengthComputable:qt,loaded:Jt,total:Wt});for(let yr=0,Tr=Ut.length;yr<Tr;yr++){const Hr=Ut[yr];Hr.onProgress&&Hr.onProgress(Ar)}sr.enqueue(xr),Zt()}})})()}});return new Response(Xt)}throw new EE(`fetch for "${Lt.url}" responded with ${Lt.status}: ${Lt.statusText}`,Lt)}).then(Lt=>{switch(Bt){case"arraybuffer":return Lt.arrayBuffer();case"blob":return Lt.blob();case"document":return Lt.text().then(Ut=>new DOMParser().parseFromString(Ut,Tt));case"json":return Lt.json();default:if(Tt===void 0)return Lt.text();{const Ut=/charset="?([^;"\s]*)"?/i.exec(Tt),Qt=Ut&&Ut[1]?Ut[1].toLowerCase():void 0,Ht=new TextDecoder(Qt);return Lt.arrayBuffer().then(Wt=>Ht.decode(Wt))}}}).then(Lt=>{this.useCache&&bu.add(_e,Lt,this.responseType);const Ut=xu[_e];delete xu[_e];for(let Qt=0,Ht=Ut.length;Qt<Ht;Qt++){const Wt=Ut[Qt];Wt.onLoad&&Wt.onLoad(Lt)}}).catch(Lt=>{const Ut=xu[_e];if(Ut===void 0)throw this.manager.itemError(_e),Lt;delete xu[_e];for(let Qt=0,Ht=Ut.length;Qt<Ht;Qt++){const Wt=Ut[Qt];Wt.onError&&Wt.onError(Lt)}this.manager.itemError(_e)}).finally(()=>{this.useCache&&this.manager.itemEnd(_e)}),this.useCache&&this.manager.itemStart(_e)})}setResponseType(_e){return this.responseType=_e,this}setMimeType(_e){return this.mimeType=_e,this}}class SE extends zo{constructor(_e){super(_e)}load(_e,at,pt,mt){const vt=this,Ct=new tu(this.manager);Ct.setPath(this.path),Ct.setRequestHeader(this.requestHeader),Ct.setWithCredentials(this.withCredentials),Ct.load(_e,function(Tt){try{at(vt.parse(JSON.parse(Tt)))}catch(Bt){mt?mt(Bt):console.error(Bt),vt.manager.itemError(_e)}},pt,mt)}parse(_e){const at=[];for(let pt=0;pt<_e.length;pt++){const mt=L_.parse(_e[pt]);at.push(mt)}return at}}class CE extends zo{constructor(_e){super(_e)}load(_e,at,pt,mt){const vt=this,Ct=[],Tt=new Uv,Bt=new tu(this.manager);Bt.setPath(this.path),Bt.setResponseType("arraybuffer"),Bt.setRequestHeader(this.requestHeader),Bt.setWithCredentials(vt.withCredentials);let Lt=0;function Ut(Qt){Bt.load(_e[Qt],function(Ht){const Wt=vt.parse(Ht,!0);Ct[Qt]={width:Wt.width,height:Wt.height,format:Wt.format,mipmaps:Wt.mipmaps},Lt+=1,Lt===6&&(Wt.mipmapCount===1&&(Tt.minFilter=Qn),Tt.image=Ct,Tt.format=Wt.format,Tt.needsUpdate=!0,at&&at(Tt))},pt,mt)}if(Array.isArray(_e))for(let Qt=0,Ht=_e.length;Qt<Ht;++Qt)Ut(Qt);else Bt.load(_e,function(Qt){const Ht=vt.parse(Qt,!0);if(Ht.isCubemap){const Wt=Ht.mipmaps.length/Ht.mipmapCount;for(let qt=0;qt<Wt;qt++){Ct[qt]={mipmaps:[]};for(let Jt=0;Jt<Ht.mipmapCount;Jt++)Ct[qt].mipmaps.push(Ht.mipmaps[qt*Ht.mipmapCount+Jt]),Ct[qt].format=Ht.format,Ct[qt].width=Ht.width,Ct[qt].height=Ht.height}Tt.image=Ct}else Tt.image.width=Ht.width,Tt.image.height=Ht.height,Tt.mipmaps=Ht.mipmaps;Ht.mipmapCount===1&&(Tt.minFilter=Qn),Tt.format=Ht.format,Tt.needsUpdate=!0,at&&at(Tt)},pt,mt);return Tt}}class O_ extends zo{constructor(_e){super(_e)}load(_e,at,pt,mt){const vt=_e;this.path!==void 0&&(_e=this.path+_e),_e=this.manager.resolveURL(_e);const Ct=this,Tt=bu.get(_e);if(Tt!==void 0)return Ct.manager.itemStart(_e),setTimeout(function(){at&&at(Tt),Ct.manager.itemEnd(_e)},0),Tt;const Bt=mu("img");function Lt(){Qt(),bu.add(_e,this),at&&at(this),Ct.manager.itemEnd(_e)}function Ut(Ht){Qt(),mt&&mt(Ht),Ct.manager.itemError(_e),Ct.manager.itemEnd(_e)}function Qt(){Bt.removeEventListener("load",Lt,!1),Bt.removeEventListener("error",Ut,!1)}return Bt.addEventListener("load",Lt,!1),Bt.addEventListener("error",Ut,!1),_e.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(Bt.crossOrigin=this.crossOrigin),Ct.manager.itemStart(_e),bu.get(_e,"blob").then(Ht=>{if(Ht!==void 0&&!Ht.type.startsWith("text/plain"))return Ht.type||(_e.endsWith(".svg")||_e.startsWith("data:image/svg"))&&(Ht=new Blob([Ht],{type:"image/svg+xml"})),void(Bt.src=URL.createObjectURL(Ht));const Wt=new tu(this.manager);Wt.useCache=!1,Wt.setPath(this.path),Wt.setCrossOrigin(this.crossOrigin),Wt.setResponseType("blob"),Wt.load(vt,function(qt){qt.type||(_e.endsWith(".svg")||_e.startsWith("data:image/svg"))&&(qt=new Blob([qt],{type:"image/svg+xml"})),bu.add(_e,qt,"blob"),Bt.src=URL.createObjectURL(qt)},pt,qt=>{Qt(),mt&&mt(qt)})}),Bt}}class PE extends zo{constructor(_e){super(_e)}load(_e,at,pt,mt){const vt=new g_;vt.colorSpace=Os;const Ct=new O_(this.manager);Ct.setCrossOrigin(this.crossOrigin),Ct.setPath(this.path);let Tt=0;function Bt(Lt){Ct.load(_e[Lt],function(Ut){vt.images[Lt]=Ut,Tt++,Tt===6&&(vt.needsUpdate=!0,at&&at(vt))},void 0,mt)}for(let Lt=0;Lt<_e.length;++Lt)Bt(Lt);return vt}}class TE extends zo{constructor(_e){super(_e)}load(_e,at,pt,mt){const vt=this,Ct=new Pm,Tt=new tu(this.manager);return Tt.setResponseType("arraybuffer"),Tt.setRequestHeader(this.requestHeader),Tt.setPath(this.path),Tt.setWithCredentials(vt.withCredentials),Tt.load(_e,function(Bt){let Lt;try{Lt=vt.parse(Bt)}catch(Ut){if(mt===void 0)return void console.error(Ut);mt(Ut)}Lt.image!==void 0?Ct.image=Lt.image:Lt.data!==void 0&&(Ct.image.width=Lt.width,Ct.image.height=Lt.height,Ct.image.data=Lt.data,Ct.image.complete=!0),Ct.wrapS=Lt.wrapS!==void 0?Lt.wrapS:fn,Ct.wrapT=Lt.wrapT!==void 0?Lt.wrapT:fn,Ct.magFilter=Lt.magFilter!==void 0?Lt.magFilter:Qn,Ct.minFilter=Lt.minFilter!==void 0?Lt.minFilter:Qn,Ct.anisotropy=Lt.anisotropy!==void 0?Lt.anisotropy:1,Lt.colorSpace!==void 0?Ct.colorSpace=Lt.colorSpace:Lt.encoding!==void 0&&(Ct.encoding=Lt.encoding),Lt.flipY!==void 0&&(Ct.flipY=Lt.flipY),Lt.format!==void 0&&(Ct.format=Lt.format),Lt.type!==void 0&&(Ct.type=Lt.type),Lt.mipmaps!==void 0&&(Ct.mipmaps=Lt.mipmaps,Ct.minFilter=Kn),Lt.mipmapCount===1&&(Ct.minFilter=Qn),Lt.generateMipmaps!==void 0&&(Ct.generateMipmaps=Lt.generateMipmaps),Ct.needsUpdate=!0,at&&at(Ct,Lt)},pt,mt),Ct}}class ME extends zo{constructor(_e){super(_e)}load(_e,at,pt,mt){const vt=new Us,Ct=new O_(this.manager);return Ct.setCrossOrigin(this.crossOrigin),Ct.setPath(this.path),Ct.load(_e,function(Tt){vt.image=Tt,vt.needsUpdate=!0,at!==void 0&&at(vt)},pt,mt),vt}}class Ju extends Ss{constructor(_e,at=1){super(),this.isLight=!0,this.type="Light",this.color=new Un(_e),this.intensity=at}dispose(){}copy(_e,at){return super.copy(_e,at),this.color.copy(_e.color),this.intensity=_e.intensity,this}toJSON(_e){const at=super.toJSON(_e);return at.object.color=this.color.getHex(),at.object.intensity=this.intensity,this.groundColor!==void 0&&(at.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(at.object.distance=this.distance),this.angle!==void 0&&(at.object.angle=this.angle),this.decay!==void 0&&(at.object.decay=this.decay),this.penumbra!==void 0&&(at.object.penumbra=this.penumbra),this.shadow!==void 0&&(at.object.shadow=this.shadow.toJSON()),at}}class EA extends Ju{constructor(_e,at,pt){super(_e,pt),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(Ss.DEFAULT_UP),this.updateMatrix(),this.groundColor=new Un(at)}copy(_e,at){return super.copy(_e,at),this.groundColor.copy(_e.groundColor),this}}const vy=new rs,SA=new Er,CA=new Er;class yy{constructor(_e){this.camera=_e,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new dn(512,512),this.map=null,this.mapPass=null,this.matrix=new rs,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new xv,this._frameExtents=new dn(1,1),this._viewportCount=1,this._viewports=[new Is(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(_e){const at=this.camera,pt=this.matrix;SA.setFromMatrixPosition(_e.matrixWorld),at.position.copy(SA),CA.setFromMatrixPosition(_e.target.matrixWorld),at.lookAt(CA),at.updateMatrixWorld(),vy.multiplyMatrices(at.projectionMatrix,at.matrixWorldInverse),this._frustum.setFromProjectionMatrix(vy),pt.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),pt.multiply(vy)}getViewport(_e){return this._viewports[_e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(_e){return this.camera=_e.camera.clone(),this.bias=_e.bias,this.normalBias=_e.normalBias,this.radius=_e.radius,this.mapSize.copy(_e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const _e={};return this.bias!==0&&(_e.bias=this.bias),this.normalBias!==0&&(_e.normalBias=this.normalBias),this.radius!==1&&(_e.radius=this.radius),this.mapSize.x===512&&this.mapSize.y===512||(_e.mapSize=this.mapSize.toArray()),_e.camera=this.camera.toJSON(!1).object,delete _e.camera.matrix,_e}}class IE extends yy{constructor(){super(new yo(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(_e){const at=this.camera,pt=2*hu*_e.angle*this.focus,mt=this.mapSize.width/this.mapSize.height,vt=_e.distance||at.far;pt===at.fov&&mt===at.aspect&&vt===at.far||(at.fov=pt,at.aspect=mt,at.far=vt,at.updateProjectionMatrix()),super.updateMatrices(_e)}copy(_e){return super.copy(_e),this.focus=_e.focus,this}}class PA extends Ju{constructor(_e,at,pt=0,mt=Math.PI/3,vt=0,Ct=2){super(_e,at),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(Ss.DEFAULT_UP),this.updateMatrix(),this.target=new Ss,this.distance=pt,this.angle=mt,this.penumbra=vt,this.decay=Ct,this.map=null,this.shadow=new IE}get power(){return this.intensity*Math.PI}set power(_e){this.intensity=_e/Math.PI}dispose(){this.shadow.dispose()}copy(_e,at){return super.copy(_e,at),this.distance=_e.distance,this.angle=_e.angle,this.penumbra=_e.penumbra,this.decay=_e.decay,this.target=_e.target.clone(),this.shadow=_e.shadow.clone(),this}}const TA=new rs,N_=new Er,by=new Er;class RE extends yy{constructor(){super(new yo(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new dn(4,2),this._viewportCount=6,this._viewports=[new Is(2,1,1,1),new Is(0,1,1,1),new Is(3,1,1,1),new Is(1,1,1,1),new Is(3,0,1,1),new Is(1,0,1,1)],this._cubeDirections=[new Er(1,0,0),new Er(-1,0,0),new Er(0,0,1),new Er(0,0,-1),new Er(0,1,0),new Er(0,-1,0)],this._cubeUps=[new Er(0,1,0),new Er(0,1,0),new Er(0,1,0),new Er(0,1,0),new Er(0,0,1),new Er(0,0,-1)]}updateMatrices(_e,at=0){const pt=this.camera,mt=this.matrix,vt=_e.distance||pt.far;vt!==pt.far&&(pt.far=vt,pt.updateProjectionMatrix()),N_.setFromMatrixPosition(_e.matrixWorld),pt.position.copy(N_),by.copy(pt.position),by.add(this._cubeDirections[at]),pt.up.copy(this._cubeUps[at]),pt.lookAt(by),pt.updateMatrixWorld(),mt.makeTranslation(-N_.x,-N_.y,-N_.z),TA.multiplyMatrices(pt.projectionMatrix,pt.matrixWorldInverse),this._frustum.setFromProjectionMatrix(TA)}}class MA extends Ju{constructor(_e,at,pt=0,mt=2){super(_e,at),this.isPointLight=!0,this.type="PointLight",this.distance=pt,this.decay=mt,this.shadow=new RE}get power(){return 4*this.intensity*Math.PI}set power(_e){this.intensity=_e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(_e,at){return super.copy(_e,at),this.distance=_e.distance,this.decay=_e.decay,this.shadow=_e.shadow.clone(),this}}class kE extends yy{constructor(){super(new wv(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class IA extends Ju{constructor(_e,at){super(_e,at),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Ss.DEFAULT_UP),this.updateMatrix(),this.target=new Ss,this.shadow=new kE}dispose(){this.shadow.dispose()}copy(_e){return super.copy(_e),this.target=_e.target.clone(),this.shadow=_e.shadow.clone(),this}}class RA extends Ju{constructor(_e,at){super(_e,at),this.isAmbientLight=!0,this.type="AmbientLight"}}class kA extends Ju{constructor(_e,at,pt=10,mt=10){super(_e,at),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=pt,this.height=mt}get power(){return this.intensity*this.width*this.height*Math.PI}set power(_e){this.intensity=_e/(this.width*this.height*Math.PI)}copy(_e){return super.copy(_e),this.width=_e.width,this.height=_e.height,this}toJSON(_e){const at=super.toJSON(_e);return at.object.width=this.width,at.object.height=this.height,at}}class DA{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let _e=0;_e<9;_e++)this.coefficients.push(new Er)}set(_e){for(let at=0;at<9;at++)this.coefficients[at].copy(_e[at]);return this}zero(){for(let _e=0;_e<9;_e++)this.coefficients[_e].set(0,0,0);return this}getAt(_e,at){const pt=_e.x,mt=_e.y,vt=_e.z,Ct=this.coefficients;return at.copy(Ct[0]).multiplyScalar(.282095),at.addScaledVector(Ct[1],.488603*mt),at.addScaledVector(Ct[2],.488603*vt),at.addScaledVector(Ct[3],.488603*pt),at.addScaledVector(Ct[4],pt*mt*1.092548),at.addScaledVector(Ct[5],mt*vt*1.092548),at.addScaledVector(Ct[6],.315392*(3*vt*vt-1)),at.addScaledVector(Ct[7],pt*vt*1.092548),at.addScaledVector(Ct[8],.546274*(pt*pt-mt*mt)),at}getIrradianceAt(_e,at){const pt=_e.x,mt=_e.y,vt=_e.z,Ct=this.coefficients;return at.copy(Ct[0]).multiplyScalar(.886227),at.addScaledVector(Ct[1],1.023328*mt),at.addScaledVector(Ct[2],1.023328*vt),at.addScaledVector(Ct[3],1.023328*pt),at.addScaledVector(Ct[4],.858086*pt*mt),at.addScaledVector(Ct[5],.858086*mt*vt),at.addScaledVector(Ct[6],.743125*vt*vt-.247708),at.addScaledVector(Ct[7],.858086*pt*vt),at.addScaledVector(Ct[8],.429043*(pt*pt-mt*mt)),at}add(_e){for(let at=0;at<9;at++)this.coefficients[at].add(_e.coefficients[at]);return this}addScaledSH(_e,at){for(let pt=0;pt<9;pt++)this.coefficients[pt].addScaledVector(_e.coefficients[pt],at);return this}scale(_e){for(let at=0;at<9;at++)this.coefficients[at].multiplyScalar(_e);return this}lerp(_e,at){for(let pt=0;pt<9;pt++)this.coefficients[pt].lerp(_e.coefficients[pt],at);return this}equals(_e){for(let at=0;at<9;at++)if(!this.coefficients[at].equals(_e.coefficients[at]))return!1;return!0}copy(_e){return this.set(_e.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(_e,at=0){const pt=this.coefficients;for(let mt=0;mt<9;mt++)pt[mt].fromArray(_e,at+3*mt);return this}toArray(_e=[],at=0){const pt=this.coefficients;for(let mt=0;mt<9;mt++)pt[mt].toArray(_e,at+3*mt);return _e}static getBasisAt(_e,at){const pt=_e.x,mt=_e.y,vt=_e.z;at[0]=.282095,at[1]=.488603*mt,at[2]=.488603*vt,at[3]=.488603*pt,at[4]=1.092548*pt*mt,at[5]=1.092548*mt*vt,at[6]=.315392*(3*vt*vt-1),at[7]=1.092548*pt*vt,at[8]=.546274*(pt*pt-mt*mt)}}class BA extends Ju{constructor(_e=new DA,at=1){super(void 0,at),this.isLightProbe=!0,this.sh=_e}copy(_e){return super.copy(_e),this.sh.copy(_e.sh),this}fromJSON(_e){return this.intensity=_e.intensity,this.sh.fromArray(_e.sh),this}toJSON(_e){const at=super.toJSON(_e);return at.object.sh=this.sh.toArray(),at}}class o0 extends zo{constructor(_e){super(_e),this.textures={}}load(_e,at,pt,mt){const vt=this,Ct=new tu(vt.manager);Ct.setPath(vt.path),Ct.setRequestHeader(vt.requestHeader),Ct.setWithCredentials(vt.withCredentials),Ct.load(_e,function(Tt){try{at(vt.parse(JSON.parse(Tt)))}catch(Bt){mt?mt(Bt):console.error(Bt),vt.manager.itemError(_e)}},pt,mt)}parse(_e){const at=this.textures;function pt(Ct){return at[Ct]===void 0&&console.warn("THREE.MaterialLoader: Undefined texture",Ct),at[Ct]}const mt=_e.metadata&&_e.metadata.version<=4.5?Ws:void 0,vt=o0.createMaterialFromType(_e.type);if(_e.uuid!==void 0&&(vt.uuid=_e.uuid),_e.name!==void 0&&(vt.name=_e.name),_e.color!==void 0&&vt.color!==void 0&&vt.color.setHex(_e.color,mt),_e.roughness!==void 0&&(vt.roughness=_e.roughness),_e.metalness!==void 0&&(vt.metalness=_e.metalness),_e.sheen!==void 0&&(vt.sheen=_e.sheen),_e.sheenColor!==void 0&&(vt.sheenColor=new Un().setHex(_e.sheenColor,mt)),_e.sheenRoughness!==void 0&&(vt.sheenRoughness=_e.sheenRoughness),_e.emissive!==void 0&&vt.emissive!==void 0&&vt.emissive.setHex(_e.emissive,mt),_e.specular!==void 0&&vt.specular!==void 0&&vt.specular.setHex(_e.specular,mt),_e.specularIntensity!==void 0&&(vt.specularIntensity=_e.specularIntensity),_e.specularColor!==void 0&&vt.specularColor!==void 0&&vt.specularColor.setHex(_e.specularColor,mt),_e.shininess!==void 0&&(vt.shininess=_e.shininess),_e.clearcoat!==void 0&&(vt.clearcoat=_e.clearcoat),_e.clearcoatRoughness!==void 0&&(vt.clearcoatRoughness=_e.clearcoatRoughness),_e.iridescence!==void 0&&(vt.iridescence=_e.iridescence),_e.iridescenceIOR!==void 0&&(vt.iridescenceIOR=_e.iridescenceIOR),_e.iridescenceThicknessRange!==void 0&&(vt.iridescenceThicknessRange=_e.iridescenceThicknessRange),_e.transmission!==void 0&&(vt.transmission=_e.transmission),_e.thickness!==void 0&&(vt.thickness=_e.thickness),_e.attenuationDistance!==void 0&&(vt.attenuationDistance=_e.attenuationDistance),_e.attenuationColor!==void 0&&vt.attenuationColor!==void 0&&vt.attenuationColor.setHex(_e.attenuationColor,mt),_e.anisotropy!==void 0&&(vt.anisotropy=_e.anisotropy),_e.anisotropyRotation!==void 0&&(vt.anisotropyRotation=_e.anisotropyRotation),_e.fog!==void 0&&(vt.fog=_e.fog),_e.flatShading!==void 0&&(vt.flatShading=_e.flatShading),_e.blending!==void 0&&(vt.blending=_e.blending),_e.combine!==void 0&&(vt.combine=_e.combine),_e.side!==void 0&&(vt.side=_e.side),_e.shadowSide!==void 0&&(vt.shadowSide=_e.shadowSide),_e.opacity!==void 0&&(vt.opacity=_e.opacity),_e.transparent!==void 0&&(vt.transparent=_e.transparent),_e.alphaTest!==void 0&&(vt.alphaTest=_e.alphaTest),_e.alphaHash!==void 0&&(vt.alphaHash=_e.alphaHash),_e.depthTest!==void 0&&(vt.depthTest=_e.depthTest),_e.depthWrite!==void 0&&(vt.depthWrite=_e.depthWrite),_e.colorWrite!==void 0&&(vt.colorWrite=_e.colorWrite),_e.stencilWrite!==void 0&&(vt.stencilWrite=_e.stencilWrite),_e.stencilWriteMask!==void 0&&(vt.stencilWriteMask=_e.stencilWriteMask),_e.stencilFunc!==void 0&&(vt.stencilFunc=_e.stencilFunc),_e.stencilRef!==void 0&&(vt.stencilRef=_e.stencilRef),_e.stencilFuncMask!==void 0&&(vt.stencilFuncMask=_e.stencilFuncMask),_e.stencilFail!==void 0&&(vt.stencilFail=_e.stencilFail),_e.stencilZFail!==void 0&&(vt.stencilZFail=_e.stencilZFail),_e.stencilZPass!==void 0&&(vt.stencilZPass=_e.stencilZPass),_e.wireframe!==void 0&&(vt.wireframe=_e.wireframe),_e.wireframeLinewidth!==void 0&&(vt.wireframeLinewidth=_e.wireframeLinewidth),_e.wireframeLinecap!==void 0&&(vt.wireframeLinecap=_e.wireframeLinecap),_e.wireframeLinejoin!==void 0&&(vt.wireframeLinejoin=_e.wireframeLinejoin),_e.rotation!==void 0&&(vt.rotation=_e.rotation),_e.linewidth!==void 0&&(vt.linewidth=_e.linewidth),_e.dashSize!==void 0&&(vt.dashSize=_e.dashSize),_e.gapSize!==void 0&&(vt.gapSize=_e.gapSize),_e.scale!==void 0&&(vt.scale=_e.scale),_e.polygonOffset!==void 0&&(vt.polygonOffset=_e.polygonOffset),_e.polygonOffsetFactor!==void 0&&(vt.polygonOffsetFactor=_e.polygonOffsetFactor),_e.polygonOffsetUnits!==void 0&&(vt.polygonOffsetUnits=_e.polygonOffsetUnits),_e.dithering!==void 0&&(vt.dithering=_e.dithering),_e.alphaToCoverage!==void 0&&(vt.alphaToCoverage=_e.alphaToCoverage),_e.premultipliedAlpha!==void 0&&(vt.premultipliedAlpha=_e.premultipliedAlpha),_e.forceSinglePass!==void 0&&(vt.forceSinglePass=_e.forceSinglePass),_e.visible!==void 0&&(vt.visible=_e.visible),_e.toneMapped!==void 0&&(vt.toneMapped=_e.toneMapped),_e.userData!==void 0&&(vt.userData=_e.userData),_e.vertexColors!==void 0&&(typeof _e.vertexColors=="number"?vt.vertexColors=_e.vertexColors>0:vt.vertexColors=_e.vertexColors),_e.uniforms!==void 0)for(const Ct in _e.uniforms){const Tt=_e.uniforms[Ct];switch(vt.uniforms[Ct]={},Tt.type){case"t":vt.uniforms[Ct].value=pt(Tt.value);break;case"c":vt.uniforms[Ct].value=new Un().setHex(Tt.value,mt);break;case"v2":vt.uniforms[Ct].value=new dn().fromArray(Tt.value);break;case"v3":vt.uniforms[Ct].value=new Er().fromArray(Tt.value);break;case"v4":vt.uniforms[Ct].value=new Is().fromArray(Tt.value);break;case"m3":vt.uniforms[Ct].value=new as().fromArray(Tt.value);break;case"m4":vt.uniforms[Ct].value=new rs().fromArray(Tt.value);break;default:vt.uniforms[Ct].value=Tt.value}}if(_e.defines!==void 0&&(vt.defines=_e.defines),_e.vertexShader!==void 0&&(vt.vertexShader=_e.vertexShader),_e.fragmentShader!==void 0&&(vt.fragmentShader=_e.fragmentShader),_e.glslVersion!==void 0&&(vt.glslVersion=_e.glslVersion),_e.extensions!==void 0)for(const Ct in _e.extensions)vt.extensions[Ct]=_e.extensions[Ct];if(_e.lights!==void 0&&(vt.lights=_e.lights),_e.clipping!==void 0&&(vt.clipping=_e.clipping),_e.size!==void 0&&(vt.size=_e.size),_e.sizeAttenuation!==void 0&&(vt.sizeAttenuation=_e.sizeAttenuation),_e.map!==void 0&&(vt.map=pt(_e.map)),_e.matcap!==void 0&&(vt.matcap=pt(_e.matcap)),_e.alphaMap!==void 0&&(vt.alphaMap=pt(_e.alphaMap)),_e.bumpMap!==void 0&&(vt.bumpMap=pt(_e.bumpMap)),_e.bumpScale!==void 0&&(vt.bumpScale=_e.bumpScale),_e.normalMap!==void 0&&(vt.normalMap=pt(_e.normalMap)),_e.normalMapType!==void 0&&(vt.normalMapType=_e.normalMapType),_e.normalScale!==void 0){let Ct=_e.normalScale;Array.isArray(Ct)===!1&&(Ct=[Ct,Ct]),vt.normalScale=new dn().fromArray(Ct)}return _e.displacementMap!==void 0&&(vt.displacementMap=pt(_e.displacementMap)),_e.displacementScale!==void 0&&(vt.displacementScale=_e.displacementScale),_e.displacementBias!==void 0&&(vt.displacementBias=_e.displacementBias),_e.roughnessMap!==void 0&&(vt.roughnessMap=pt(_e.roughnessMap)),_e.metalnessMap!==void 0&&(vt.metalnessMap=pt(_e.metalnessMap)),_e.emissiveMap!==void 0&&(vt.emissiveMap=pt(_e.emissiveMap)),_e.emissiveIntensity!==void 0&&(vt.emissiveIntensity=_e.emissiveIntensity),_e.specularMap!==void 0&&(vt.specularMap=pt(_e.specularMap)),_e.specularIntensityMap!==void 0&&(vt.specularIntensityMap=pt(_e.specularIntensityMap)),_e.specularColorMap!==void 0&&(vt.specularColorMap=pt(_e.specularColorMap)),_e.envMap!==void 0&&(vt.envMap=pt(_e.envMap)),_e.envMapIntensity!==void 0&&(vt.envMapIntensity=_e.envMapIntensity),_e.reflectivity!==void 0&&(vt.reflectivity=_e.reflectivity),_e.refractionRatio!==void 0&&(vt.refractionRatio=_e.refractionRatio),_e.lightMap!==void 0&&(vt.lightMap=pt(_e.lightMap)),_e.lightMapIntensity!==void 0&&(vt.lightMapIntensity=_e.lightMapIntensity),_e.aoMap!==void 0&&(vt.aoMap=pt(_e.aoMap)),_e.aoMapIntensity!==void 0&&(vt.aoMapIntensity=_e.aoMapIntensity),_e.gradientMap!==void 0&&(vt.gradientMap=pt(_e.gradientMap)),_e.clearcoatMap!==void 0&&(vt.clearcoatMap=pt(_e.clearcoatMap)),_e.clearcoatRoughnessMap!==void 0&&(vt.clearcoatRoughnessMap=pt(_e.clearcoatRoughnessMap)),_e.clearcoatNormalMap!==void 0&&(vt.clearcoatNormalMap=pt(_e.clearcoatNormalMap)),_e.clearcoatNormalScale!==void 0&&(vt.clearcoatNormalScale=new dn().fromArray(_e.clearcoatNormalScale)),_e.iridescenceMap!==void 0&&(vt.iridescenceMap=pt(_e.iridescenceMap)),_e.iridescenceThicknessMap!==void 0&&(vt.iridescenceThicknessMap=pt(_e.iridescenceThicknessMap)),_e.transmissionMap!==void 0&&(vt.transmissionMap=pt(_e.transmissionMap)),_e.thicknessMap!==void 0&&(vt.thicknessMap=pt(_e.thicknessMap)),_e.anisotropyMap!==void 0&&(vt.anisotropyMap=pt(_e.anisotropyMap)),_e.sheenColorMap!==void 0&&(vt.sheenColorMap=pt(_e.sheenColorMap)),_e.sheenRoughnessMap!==void 0&&(vt.sheenRoughnessMap=pt(_e.sheenRoughnessMap)),vt}setTextures(_e){return this.textures=_e,this}static createMaterialFromType(_e){return new{ShadowMaterial:cA,SpriteMaterial:W0,RawShaderMaterial:uA,ShaderMaterial:Fl,PointsMaterial:J0,MeshPhysicalMaterial:pA,MeshStandardMaterial:hy,MeshPhongMaterial:hA,MeshToonMaterial:dA,MeshNormalMaterial:mA,MeshLambertMaterial:gA,MeshDepthMaterial:V0,MeshDistanceMaterial:H0,MeshBasicMaterial:Zl,MeshMatcapMaterial:_A,LineDashedMaterial:fA,LineBasicMaterial:Lo,Material:so}[_e]}}class xy{static decodeText(_e){if(typeof TextDecoder<"u")return new TextDecoder().decode(_e);let at="";for(let pt=0,mt=_e.length;pt<mt;pt++)at+=String.fromCharCode(_e[pt]);try{return decodeURIComponent(escape(at))}catch{return at}}static extractUrlBase(_e){const at=_e.lastIndexOf("/");return at===-1?"./":_e.slice(0,at+1)}static resolveURL(_e,at){return typeof _e!="string"||_e===""?"":(/^https?:\/\//i.test(at)&&/^\//.test(_e)&&(at=at.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(_e)||/^data:.*,.*$/i.test(_e)||/^blob:.*$/i.test(_e)?_e:at+_e)}}class LA extends _s{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(_e){return super.copy(_e),this.instanceCount=_e.instanceCount,this}toJSON(){const _e=super.toJSON();return _e.instanceCount=this.instanceCount,_e.isInstancedBufferGeometry=!0,_e}}class OA extends zo{constructor(_e){super(_e)}load(_e,at,pt,mt){const vt=this,Ct=new tu(vt.manager);Ct.setPath(vt.path),Ct.setRequestHeader(vt.requestHeader),Ct.setWithCredentials(vt.withCredentials),Ct.load(_e,function(Tt){try{at(vt.parse(JSON.parse(Tt)))}catch(Bt){mt?mt(Bt):console.error(Bt),vt.manager.itemError(_e)}},pt,mt)}parse(_e){const at={},pt={};function mt(Qt,Ht){if(at[Ht]!==void 0)return at[Ht];const Wt=Qt.interleavedBuffers[Ht],qt=function(sr,Zt){if(pt[Zt]!==void 0)return pt[Zt];const er=sr.arrayBuffers[Zt],xr=new Uint32Array(er).buffer;return pt[Zt]=xr,xr}(Qt,Wt.buffer),Jt=du(Wt.type,qt),Xt=new Mv(Jt,Wt.stride);return Xt.uuid=Wt.uuid,at[Ht]=Xt,Xt}const vt=_e.isInstancedBufferGeometry?new LA:new _s,Ct=_e.data.index;if(Ct!==void 0){const Qt=du(Ct.type,Ct.array);vt.setIndex(new mr(Qt,1))}const Tt=_e.data.attributes;for(const Qt in Tt){const Ht=Tt[Qt];let Wt;if(Ht.isInterleavedBufferAttribute){const qt=mt(_e.data,Ht.data);Wt=new Sp(qt,Ht.itemSize,Ht.offset,Ht.normalized)}else{const qt=du(Ht.type,Ht.array);Wt=new(Ht.isInstancedBufferAttribute?Tm:mr)(qt,Ht.itemSize,Ht.normalized)}Ht.name!==void 0&&(Wt.name=Ht.name),Ht.usage!==void 0&&Wt.setUsage(Ht.usage),Ht.updateRange!==void 0&&(Wt.updateRange.offset=Ht.updateRange.offset,Wt.updateRange.count=Ht.updateRange.count),vt.setAttribute(Qt,Wt)}const Bt=_e.data.morphAttributes;if(Bt)for(const Qt in Bt){const Ht=Bt[Qt],Wt=[];for(let qt=0,Jt=Ht.length;qt<Jt;qt++){const Xt=Ht[qt];let sr;if(Xt.isInterleavedBufferAttribute){const Zt=mt(_e.data,Xt.data);sr=new Sp(Zt,Xt.itemSize,Xt.offset,Xt.normalized)}else{const Zt=du(Xt.type,Xt.array);sr=new mr(Zt,Xt.itemSize,Xt.normalized)}Xt.name!==void 0&&(sr.name=Xt.name),Wt.push(sr)}vt.morphAttributes[Qt]=Wt}_e.data.morphTargetsRelative&&(vt.morphTargetsRelative=!0);const Lt=_e.data.groups||_e.data.drawcalls||_e.data.offsets;if(Lt!==void 0)for(let Qt=0,Ht=Lt.length;Qt!==Ht;++Qt){const Wt=Lt[Qt];vt.addGroup(Wt.start,Wt.count,Wt.materialIndex)}const Ut=_e.data.boundingSphere;if(Ut!==void 0){const Qt=new Er;Ut.center!==void 0&&Qt.fromArray(Ut.center),vt.boundingSphere=new jo(Qt,Ut.radius)}return _e.name&&(vt.name=_e.name),_e.userData&&(vt.userData=_e.userData),vt}}class DE extends zo{constructor(_e){super(_e)}load(_e,at,pt,mt){const vt=this,Ct=this.path===""?xy.extractUrlBase(_e):this.path;this.resourcePath=this.resourcePath||Ct;const Tt=new tu(this.manager);Tt.setPath(this.path),Tt.setRequestHeader(this.requestHeader),Tt.setWithCredentials(this.withCredentials),Tt.load(_e,function(Bt){let Lt=null;try{Lt=JSON.parse(Bt)}catch(Qt){return mt!==void 0&&mt(Qt),void console.error("THREE:ObjectLoader: Can't parse "+_e+".",Qt.message)}const Ut=Lt.metadata;if(Ut===void 0||Ut.type===void 0||Ut.type.toLowerCase()==="geometry")return mt!==void 0&&mt(new Error("THREE.ObjectLoader: Can't load "+_e)),void console.error("THREE.ObjectLoader: Can't load "+_e);vt.parse(Lt,at)},pt,mt)}async loadAsync(_e,at){const pt=this.path===""?xy.extractUrlBase(_e):this.path;this.resourcePath=this.resourcePath||pt;const mt=new tu(this.manager);mt.setPath(this.path),mt.setRequestHeader(this.requestHeader),mt.setWithCredentials(this.withCredentials);const vt=await mt.loadAsync(_e,at),Ct=JSON.parse(vt),Tt=Ct.metadata;if(Tt===void 0||Tt.type===void 0||Tt.type.toLowerCase()==="geometry")throw new Error("THREE.ObjectLoader: Can't load "+_e);return await this.parseAsync(Ct)}parse(_e,at){const pt=this.parseAnimations(_e.animations),mt=this.parseShapes(_e.shapes),vt=this.parseGeometries(_e.geometries,mt),Ct=this.parseImages(_e.images,function(){at!==void 0&&at(Lt)}),Tt=this.parseTextures(_e.textures,Ct),Bt=this.parseMaterials(_e.materials,Tt),Lt=this.parseObject(_e.object,vt,Bt,Tt,pt),Ut=this.parseSkeletons(_e.skeletons,Lt);if(this.bindSkeletons(Lt,Ut),at!==void 0){let Qt=!1;for(const Ht in Ct)if(Ct[Ht].data instanceof HTMLImageElement){Qt=!0;break}Qt===!1&&at(Lt)}return Lt}async parseAsync(_e){const at=this.parseAnimations(_e.animations),pt=this.parseShapes(_e.shapes),mt=this.parseGeometries(_e.geometries,pt),vt=await this.parseImagesAsync(_e.images),Ct=this.parseTextures(_e.textures,vt),Tt=this.parseMaterials(_e.materials,Ct),Bt=this.parseObject(_e.object,mt,Tt,Ct,at),Lt=this.parseSkeletons(_e.skeletons,Bt);return this.bindSkeletons(Bt,Lt),Bt}parseShapes(_e){const at={};if(_e!==void 0)for(let pt=0,mt=_e.length;pt<mt;pt++){const vt=new Cp().fromJSON(_e[pt]);at[vt.uuid]=vt}return at}parseSkeletons(_e,at){const pt={},mt={};if(at.traverse(function(vt){vt.isBone&&(mt[vt.uuid]=vt)}),_e!==void 0)for(let vt=0,Ct=_e.length;vt<Ct;vt++){const Tt=new Bv().fromJSON(_e[vt],mt);pt[Tt.uuid]=Tt}return pt}parseGeometries(_e,at){const pt={};if(_e!==void 0){const mt=new OA;for(let vt=0,Ct=_e.length;vt<Ct;vt++){let Tt;const Bt=_e[vt];switch(Bt.type){case"BufferGeometry":case"InstancedBufferGeometry":Tt=mt.parse(Bt);break;default:Bt.type in lA?Tt=lA[Bt.type].fromJSON(Bt,at):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${Bt.type}"`)}Tt.uuid=Bt.uuid,Bt.name!==void 0&&(Tt.name=Bt.name),Bt.userData!==void 0&&(Tt.userData=Bt.userData),pt[Bt.uuid]=Tt}}return pt}parseMaterials(_e,at){const pt={},mt={};if(_e!==void 0){const vt=new o0;vt.setTextures(at);for(let Ct=0,Tt=_e.length;Ct<Tt;Ct++){const Bt=_e[Ct];pt[Bt.uuid]===void 0&&(pt[Bt.uuid]=vt.parse(Bt)),mt[Bt.uuid]=pt[Bt.uuid]}}return mt}parseAnimations(_e){const at={};if(_e!==void 0)for(let pt=0;pt<_e.length;pt++){const mt=_e[pt],vt=L_.parse(mt);at[vt.uuid]=vt}return at}parseImages(_e,at){const pt=this,mt={};let vt;function Ct(Tt){if(typeof Tt=="string"){const Bt=Tt;return function(Lt){return pt.manager.itemStart(Lt),vt.load(Lt,function(){pt.manager.itemEnd(Lt)},void 0,function(){pt.manager.itemError(Lt),pt.manager.itemEnd(Lt)})}(/^(\/\/)|([a-z]+:(\/\/)?)/i.test(Bt)?Bt:pt.resourcePath+Bt)}return Tt.data?{data:du(Tt.type,Tt.data),width:Tt.width,height:Tt.height,complete:!0}:null}if(_e!==void 0&&_e.length>0){const Tt=new fy(at);vt=new O_(Tt),vt.setCrossOrigin(this.crossOrigin);for(let Bt=0,Lt=_e.length;Bt<Lt;Bt++){const Ut=_e[Bt],Qt=Ut.url;if(Array.isArray(Qt)){const Ht=[];for(let Wt=0,qt=Qt.length;Wt<qt;Wt++){const Jt=Ct(Qt[Wt]);Jt!==null&&(Jt instanceof HTMLImageElement?Ht.push(Jt):Ht.push(new Pm(Jt.data,Jt.width,Jt.height)))}mt[Ut.uuid]=new Wo(Ht)}else{const Ht=Ct(Ut.url);mt[Ut.uuid]=new Wo(Ht)}}}return mt}async parseImagesAsync(_e){const at=this,pt={};let mt;async function vt(Ct){if(typeof Ct=="string"){const Tt=Ct,Bt=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(Tt)?Tt:at.resourcePath+Tt;return await mt.loadAsync(Bt)}return Ct.data?{data:du(Ct.type,Ct.data),width:Ct.width,height:Ct.height,complete:!0}:null}if(_e!==void 0&&_e.length>0){mt=new O_(this.manager),mt.setCrossOrigin(this.crossOrigin);for(let Ct=0,Tt=_e.length;Ct<Tt;Ct++){const Bt=_e[Ct],Lt=Bt.url;if(Array.isArray(Lt)){const Ut=[];for(let Qt=0,Ht=Lt.length;Qt<Ht;Qt++){const Wt=Lt[Qt],qt=await vt(Wt);qt!==null&&(qt instanceof HTMLImageElement?Ut.push(qt):Ut.push(new Pm(qt.data,qt.width,qt.height)))}pt[Bt.uuid]=new Wo(Ut)}else{const Ut=await vt(Bt.url);pt[Bt.uuid]=new Wo(Ut)}}}return pt}parseTextures(_e,at){function pt(vt,Ct){return typeof vt=="number"?vt:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",vt),Ct[vt])}const mt={};if(_e!==void 0)for(let vt=0,Ct=_e.length;vt<Ct;vt++){const Tt=_e[vt];Tt.image===void 0&&console.warn('THREE.ObjectLoader: No "image" specified for',Tt.uuid),at[Tt.image]===void 0&&console.warn("THREE.ObjectLoader: Undefined image",Tt.image);const Bt=at[Tt.image],Lt=Bt?Bt.data:void 0;let Ut;Array.isArray(Lt)?(Ut=new g_,Lt.length===6&&(Ut.needsUpdate=!0)):(Ut=Lt&&Lt.data?new Pm:new Us,Lt&&Lt.complete&&(Ut.needsUpdate=!0)),Ut.source=Bt,Ut.uuid=Tt.uuid,Tt.name!==void 0&&(Ut.name=Tt.name),Tt.mapping!==void 0&&(Ut.mapping=pt(Tt.mapping,BE)),Tt.channel!==void 0&&(Ut.channel=Tt.channel),Tt.offset!==void 0&&Ut.offset.fromArray(Tt.offset),Tt.repeat!==void 0&&Ut.repeat.fromArray(Tt.repeat),Tt.center!==void 0&&Ut.center.fromArray(Tt.center),Tt.rotation!==void 0&&(Ut.rotation=Tt.rotation),Tt.wrap!==void 0&&(Ut.wrapS=pt(Tt.wrap[0],NA),Ut.wrapT=pt(Tt.wrap[1],NA)),Tt.format!==void 0&&(Ut.format=Tt.format),Tt.internalFormat!==void 0&&(Ut.internalFormat=Tt.internalFormat),Tt.type!==void 0&&(Ut.type=Tt.type),Tt.colorSpace!==void 0?Ut.colorSpace=Tt.colorSpace:Tt.encoding!==void 0&&(Ut.encoding=Tt.encoding),Tt.minFilter!==void 0&&(Ut.minFilter=pt(Tt.minFilter,FA)),Tt.magFilter!==void 0&&(Ut.magFilter=pt(Tt.magFilter,FA)),Tt.anisotropy!==void 0&&(Ut.anisotropy=Tt.anisotropy),Tt.flipY!==void 0&&(Ut.flipY=Tt.flipY),Tt.generateMipmaps!==void 0&&(Ut.generateMipmaps=Tt.generateMipmaps),Tt.premultiplyAlpha!==void 0&&(Ut.premultiplyAlpha=Tt.premultiplyAlpha),Tt.unpackAlignment!==void 0&&(Ut.unpackAlignment=Tt.unpackAlignment),Tt.compareFunction!==void 0&&(Ut.compareFunction=Tt.compareFunction),Tt.userData!==void 0&&(Ut.userData=Tt.userData),mt[Tt.uuid]=Ut}return mt}parseObject(_e,at,pt,mt,vt){let Ct;const Tt=_e.metadata&&_e.metadata.version<=4.5?Ws:void 0;function Bt(Wt){return at[Wt]===void 0&&console.warn("THREE.ObjectLoader: Undefined geometry",Wt),at[Wt]}function Lt(Wt){if(Wt!==void 0){if(Array.isArray(Wt)){const qt=[];for(let Jt=0,Xt=Wt.length;Jt<Xt;Jt++){const sr=Wt[Jt];pt[sr]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",sr),qt.push(pt[sr])}return qt}return pt[Wt]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",Wt),pt[Wt]}}function Ut(Wt){return mt[Wt]===void 0&&console.warn("THREE.ObjectLoader: Undefined texture",Wt),mt[Wt]}let Qt,Ht;switch(_e.type){case"Scene":Ct=new xx,_e.background!==void 0&&(Number.isInteger(_e.background)?Ct.background=new Un().setHex(_e.background,Tt):Ct.background=Ut(_e.background)),_e.environment!==void 0&&(Ct.environment=Ut(_e.environment)),_e.fog!==void 0&&(_e.fog.type==="Fog"?Ct.fog=new Tv(_e.fog.color,_e.fog.near,_e.fog.far):_e.fog.type==="FogExp2"&&(Ct.fog=new Pv(_e.fog.color,_e.fog.density)),_e.fog.name!==""&&(Ct.fog.name=_e.fog.name)),_e.backgroundBlurriness!==void 0&&(Ct.backgroundBlurriness=_e.backgroundBlurriness),_e.backgroundIntensity!==void 0&&(Ct.backgroundIntensity=_e.backgroundIntensity);break;case"PerspectiveCamera":Ct=new yo(_e.fov,_e.aspect,_e.near,_e.far),_e.focus!==void 0&&(Ct.focus=_e.focus),_e.zoom!==void 0&&(Ct.zoom=_e.zoom),_e.filmGauge!==void 0&&(Ct.filmGauge=_e.filmGauge),_e.filmOffset!==void 0&&(Ct.filmOffset=_e.filmOffset),_e.view!==void 0&&(Ct.view=Object.assign({},_e.view));break;case"OrthographicCamera":Ct=new wv(_e.left,_e.right,_e.top,_e.bottom,_e.near,_e.far),_e.zoom!==void 0&&(Ct.zoom=_e.zoom),_e.view!==void 0&&(Ct.view=Object.assign({},_e.view));break;case"AmbientLight":Ct=new RA(_e.color,_e.intensity);break;case"DirectionalLight":Ct=new IA(_e.color,_e.intensity);break;case"PointLight":Ct=new MA(_e.color,_e.intensity,_e.distance,_e.decay);break;case"RectAreaLight":Ct=new kA(_e.color,_e.intensity,_e.width,_e.height);break;case"SpotLight":Ct=new PA(_e.color,_e.intensity,_e.distance,_e.angle,_e.penumbra,_e.decay);break;case"HemisphereLight":Ct=new EA(_e.color,_e.groundColor,_e.intensity);break;case"LightProbe":Ct=new BA().fromJSON(_e);break;case"SkinnedMesh":Qt=Bt(_e.geometry),Ht=Lt(_e.material),Ct=new Dx(Qt,Ht),_e.bindMode!==void 0&&(Ct.bindMode=_e.bindMode),_e.bindMatrix!==void 0&&Ct.bindMatrix.fromArray(_e.bindMatrix),_e.skeleton!==void 0&&(Ct.skeleton=_e.skeleton);break;case"Mesh":Qt=Bt(_e.geometry),Ht=Lt(_e.material),Ct=new lo(Qt,Ht);break;case"InstancedMesh":Qt=Bt(_e.geometry),Ht=Lt(_e.material);const Wt=_e.count,qt=_e.instanceMatrix,Jt=_e.instanceColor;Ct=new Nx(Qt,Ht,Wt),Ct.instanceMatrix=new Tm(new Float32Array(qt.array),16),Jt!==void 0&&(Ct.instanceColor=new Tm(new Float32Array(Jt.array),Jt.itemSize));break;case"LOD":Ct=new Px;break;case"Line":Ct=new Yu(Bt(_e.geometry),Lt(_e.material));break;case"LineLoop":Ct=new Vx(Bt(_e.geometry),Lt(_e.material));break;case"LineSegments":Ct=new _c(Bt(_e.geometry),Lt(_e.material));break;case"PointCloud":case"Points":Ct=new Qx(Bt(_e.geometry),Lt(_e.material));break;case"Sprite":Ct=new Sx(Lt(_e.material));break;case"Group":Ct=new xm;break;case"Bone":Ct=new Y0;break;default:Ct=new Ss}if(Ct.uuid=_e.uuid,_e.name!==void 0&&(Ct.name=_e.name),_e.matrix!==void 0?(Ct.matrix.fromArray(_e.matrix),_e.matrixAutoUpdate!==void 0&&(Ct.matrixAutoUpdate=_e.matrixAutoUpdate),Ct.matrixAutoUpdate&&Ct.matrix.decompose(Ct.position,Ct.quaternion,Ct.scale)):(_e.position!==void 0&&Ct.position.fromArray(_e.position),_e.rotation!==void 0&&Ct.rotation.fromArray(_e.rotation),_e.quaternion!==void 0&&Ct.quaternion.fromArray(_e.quaternion),_e.scale!==void 0&&Ct.scale.fromArray(_e.scale)),_e.up!==void 0&&Ct.up.fromArray(_e.up),_e.castShadow!==void 0&&(Ct.castShadow=_e.castShadow),_e.receiveShadow!==void 0&&(Ct.receiveShadow=_e.receiveShadow),_e.shadow&&(_e.shadow.bias!==void 0&&(Ct.shadow.bias=_e.shadow.bias),_e.shadow.normalBias!==void 0&&(Ct.shadow.normalBias=_e.shadow.normalBias),_e.shadow.radius!==void 0&&(Ct.shadow.radius=_e.shadow.radius),_e.shadow.mapSize!==void 0&&Ct.shadow.mapSize.fromArray(_e.shadow.mapSize),_e.shadow.camera!==void 0&&(Ct.shadow.camera=this.parseObject(_e.shadow.camera))),_e.visible!==void 0&&(Ct.visible=_e.visible),_e.frustumCulled!==void 0&&(Ct.frustumCulled=_e.frustumCulled),_e.renderOrder!==void 0&&(Ct.renderOrder=_e.renderOrder),_e.userData!==void 0&&(Ct.userData=_e.userData),_e.layers!==void 0&&(Ct.layers.mask=_e.layers),_e.children!==void 0){const Wt=_e.children;for(let qt=0;qt<Wt.length;qt++)Ct.add(this.parseObject(Wt[qt],at,pt,mt,vt))}if(_e.animations!==void 0){const Wt=_e.animations;for(let qt=0;qt<Wt.length;qt++){const Jt=Wt[qt];Ct.animations.push(vt[Jt])}}if(_e.type==="LOD"){_e.autoUpdate!==void 0&&(Ct.autoUpdate=_e.autoUpdate);const Wt=_e.levels;for(let qt=0;qt<Wt.length;qt++){const Jt=Wt[qt],Xt=Ct.getObjectByProperty("uuid",Jt.object);Xt!==void 0&&Ct.addLevel(Xt,Jt.distance,Jt.hysteresis)}}return Ct}bindSkeletons(_e,at){Object.keys(at).length!==0&&_e.traverse(function(pt){if(pt.isSkinnedMesh===!0&&pt.skeleton!==void 0){const mt=at[pt.skeleton];mt===void 0?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",pt.skeleton):pt.bind(mt,pt.bindMatrix)}})}}const BE={UVMapping:jr,CubeReflectionMapping:en,CubeRefractionMapping:rn,EquirectangularReflectionMapping:mn,EquirectangularRefractionMapping:bn,CubeUVReflectionMapping:Tn},NA={RepeatWrapping:xn,ClampToEdgeWrapping:fn,MirroredRepeatWrapping:En},FA={NearestFilter:tn,NearestMipmapNearestFilter:wn,NearestMipmapLinearFilter:Hn,LinearFilter:Qn,LinearMipmapNearestFilter:jn,LinearMipmapLinearFilter:Kn};class LE extends zo{constructor(_e){super(_e),this.isImageBitmapLoader=!0,typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(_e){return this.options=_e,this}load(_e,at,pt,mt){_e===void 0&&(_e=""),this.path!==void 0&&(_e=this.path+_e),_e=this.manager.resolveURL(_e);const vt=this;bu.get(_e,"blob").then(Ct=>{if(Ct!==void 0)return vt.manager.itemStart(_e),void createImageBitmap(Ct,Object.assign(vt.options,{colorSpaceConversion:"none"})).then(function(Bt){at&&at(Bt),vt.manager.itemEnd(_e)}).catch(function(Bt){mt&&mt(Bt),vt.manager.itemError(_e),vt.manager.itemEnd(_e)});const Tt={};Tt.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",Tt.headers=this.requestHeader,fetch(_e,Tt).then(function(Bt){return Bt.blob()}).then(function(Bt){return bu.add(_e,Bt,"blob"),createImageBitmap(Bt,Object.assign(vt.options,{colorSpaceConversion:"none"}))}).then(function(Bt){at&&at(Bt),vt.manager.itemEnd(_e)}).catch(function(Bt){mt&&mt(Bt),vt.manager.itemError(_e),vt.manager.itemEnd(_e)}),vt.manager.itemStart(_e)})}}let l0;class Ay{static getContext(){return l0===void 0&&(l0=new(window.AudioContext||window.webkitAudioContext)),l0}static setContext(_e){l0=_e}}class OE extends zo{constructor(_e){super(_e)}load(_e,at,pt,mt){const vt=this,Ct=new tu(this.manager);function Tt(Bt){mt?mt(Bt):console.error(Bt),vt.manager.itemError(_e)}Ct.setResponseType("arraybuffer"),Ct.setPath(this.path),Ct.setRequestHeader(this.requestHeader),Ct.setWithCredentials(this.withCredentials),Ct.load(_e,function(Bt){try{const Lt=Bt.slice(0);Ay.getContext().decodeAudioData(Lt,function(Ut){at(Ut)},Tt)}catch(Lt){Tt(Lt)}},pt,mt)}}const UA=new rs,jA=new rs,Rp=new rs;class NE{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new yo,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new yo,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(_e){const at=this._cache;if(at.focus!==_e.focus||at.fov!==_e.fov||at.aspect!==_e.aspect*this.aspect||at.near!==_e.near||at.far!==_e.far||at.zoom!==_e.zoom||at.eyeSep!==this.eyeSep){at.focus=_e.focus,at.fov=_e.fov,at.aspect=_e.aspect*this.aspect,at.near=_e.near,at.far=_e.far,at.zoom=_e.zoom,at.eyeSep=this.eyeSep,Rp.copy(_e.projectionMatrix);const pt=at.eyeSep/2,mt=pt*at.near/at.focus,vt=at.near*Math.tan($l*at.fov*.5)/at.zoom;let Ct,Tt;jA.elements[12]=-pt,UA.elements[12]=pt,Ct=-vt*at.aspect+mt,Tt=vt*at.aspect+mt,Rp.elements[0]=2*at.near/(Tt-Ct),Rp.elements[8]=(Tt+Ct)/(Tt-Ct),this.cameraL.projectionMatrix.copy(Rp),Ct=-vt*at.aspect-mt,Tt=vt*at.aspect-mt,Rp.elements[0]=2*at.near/(Tt-Ct),Rp.elements[8]=(Tt+Ct)/(Tt-Ct),this.cameraR.projectionMatrix.copy(Rp)}this.cameraL.matrixWorld.copy(_e.matrixWorld).multiply(jA),this.cameraR.matrixWorld.copy(_e.matrixWorld).multiply(UA)}}class GA{constructor(_e=!0){this.autoStart=_e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=zA(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let _e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const at=zA();_e=(at-this.oldTime)/1e3,this.oldTime=at,this.elapsedTime+=_e}return _e}}function zA(){return(typeof performance>"u"?Date:performance).now()}const kp=new Er,VA=new wo,FE=new Er,Dp=new Er;class UE extends Ss{constructor(){super(),this.type="AudioListener",this.context=Ay.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new GA}getInput(){return this.gain}removeFilter(){return this.filter!==null&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(_e){return this.filter!==null?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=_e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(_e){return this.gain.gain.setTargetAtTime(_e,this.context.currentTime,.01),this}updateMatrixWorld(_e){super.updateMatrixWorld(_e);const at=this.context.listener,pt=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(kp,VA,FE),Dp.set(0,0,-1).applyQuaternion(VA),at.positionX){const mt=this.context.currentTime+this.timeDelta;at.positionX.linearRampToValueAtTime(kp.x,mt),at.positionY.linearRampToValueAtTime(kp.y,mt),at.positionZ.linearRampToValueAtTime(kp.z,mt),at.forwardX.linearRampToValueAtTime(Dp.x,mt),at.forwardY.linearRampToValueAtTime(Dp.y,mt),at.forwardZ.linearRampToValueAtTime(Dp.z,mt),at.upX.linearRampToValueAtTime(pt.x,mt),at.upY.linearRampToValueAtTime(pt.y,mt),at.upZ.linearRampToValueAtTime(pt.z,mt)}else at.setPosition(kp.x,kp.y,kp.z),at.setOrientation(Dp.x,Dp.y,Dp.z,pt.x,pt.y,pt.z)}}class HA extends Ss{constructor(_e){super(),this.type="Audio",this.listener=_e,this.context=_e.context,this.gain=this.context.createGain(),this.gain.connect(_e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(_e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=_e,this.connect(),this}setMediaElementSource(_e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(_e),this.connect(),this}setMediaStreamSource(_e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(_e),this.connect(),this}setBuffer(_e){return this.buffer=_e,this.sourceType="buffer",this.autoplay&&this.play(),this}play(_e=0){if(this.isPlaying===!0)return void console.warn("THREE.Audio: Audio is already playing.");if(this.hasPlaybackControl===!1)return void console.warn("THREE.Audio: this Audio has no playback control.");this._startedAt=this.context.currentTime+_e;const at=this.context.createBufferSource();return at.buffer=this.buffer,at.loop=this.loop,at.loopStart=this.loopStart,at.loopEnd=this.loopEnd,at.onended=this.onEnded.bind(this),at.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=at,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(this.hasPlaybackControl!==!1)return this.isPlaying===!0&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,this.loop===!0&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")}stop(){if(this.hasPlaybackControl!==!1)return this._progress=0,this.source!==null&&(this.source.stop(),this.source.onended=null),this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let _e=1,at=this.filters.length;_e<at;_e++)this.filters[_e-1].connect(this.filters[_e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this._connected!==!1){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let _e=1,at=this.filters.length;_e<at;_e++)this.filters[_e-1].disconnect(this.filters[_e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}}getFilters(){return this.filters}setFilters(_e){return _e||(_e=[]),this._connected===!0?(this.disconnect(),this.filters=_e.slice(),this.connect()):this.filters=_e.slice(),this}setDetune(_e){if(this.detune=_e,this.source.detune!==void 0)return this.isPlaying===!0&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(_e){return this.setFilters(_e?[_e]:[])}setPlaybackRate(_e){if(this.hasPlaybackControl!==!1)return this.playbackRate=_e,this.isPlaying===!0&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return this.hasPlaybackControl===!1?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(_e){if(this.hasPlaybackControl!==!1)return this.loop=_e,this.isPlaying===!0&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")}setLoopStart(_e){return this.loopStart=_e,this}setLoopEnd(_e){return this.loopEnd=_e,this}getVolume(){return this.gain.gain.value}setVolume(_e){return this.gain.gain.setTargetAtTime(_e,this.context.currentTime,.01),this}}const Bp=new Er,QA=new wo,jE=new Er,Lp=new Er;class GE extends HA{constructor(_e){super(_e),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}connect(){super.connect(),this.panner.connect(this.gain)}disconnect(){super.disconnect(),this.panner.disconnect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(_e){return this.panner.refDistance=_e,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(_e){return this.panner.rolloffFactor=_e,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(_e){return this.panner.distanceModel=_e,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(_e){return this.panner.maxDistance=_e,this}setDirectionalCone(_e,at,pt){return this.panner.coneInnerAngle=_e,this.panner.coneOuterAngle=at,this.panner.coneOuterGain=pt,this}updateMatrixWorld(_e){if(super.updateMatrixWorld(_e),this.hasPlaybackControl===!0&&this.isPlaying===!1)return;this.matrixWorld.decompose(Bp,QA,jE),Lp.set(0,0,1).applyQuaternion(QA);const at=this.panner;if(at.positionX){const pt=this.context.currentTime+this.listener.timeDelta;at.positionX.linearRampToValueAtTime(Bp.x,pt),at.positionY.linearRampToValueAtTime(Bp.y,pt),at.positionZ.linearRampToValueAtTime(Bp.z,pt),at.orientationX.linearRampToValueAtTime(Lp.x,pt),at.orientationY.linearRampToValueAtTime(Lp.y,pt),at.orientationZ.linearRampToValueAtTime(Lp.z,pt)}else at.setPosition(Bp.x,Bp.y,Bp.z),at.setOrientation(Lp.x,Lp.y,Lp.z)}}class zE{constructor(_e,at=2048){this.analyser=_e.context.createAnalyser(),this.analyser.fftSize=at,this.data=new Uint8Array(this.analyser.frequencyBinCount),_e.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let _e=0;const at=this.getFrequencyData();for(let pt=0;pt<at.length;pt++)_e+=at[pt];return _e/at.length}}class WA{constructor(_e,at,pt){let mt,vt,Ct;switch(this.binding=_e,this.valueSize=pt,at){case"quaternion":mt=this._slerp,vt=this._slerpAdditive,Ct=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*pt),this._workIndex=5;break;case"string":case"bool":mt=this._select,vt=this._select,Ct=this._setAdditiveIdentityOther,this.buffer=new Array(5*pt);break;default:mt=this._lerp,vt=this._lerpAdditive,Ct=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*pt)}this._mixBufferRegion=mt,this._mixBufferRegionAdditive=vt,this._setIdentity=Ct,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(_e,at){const pt=this.buffer,mt=this.valueSize,vt=_e*mt+mt;let Ct=this.cumulativeWeight;if(Ct===0){for(let Tt=0;Tt!==mt;++Tt)pt[vt+Tt]=pt[Tt];Ct=at}else{Ct+=at;const Tt=at/Ct;this._mixBufferRegion(pt,vt,0,Tt,mt)}this.cumulativeWeight=Ct}accumulateAdditive(_e){const at=this.buffer,pt=this.valueSize,mt=pt*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(at,mt,0,_e,pt),this.cumulativeWeightAdditive+=_e}apply(_e){const at=this.valueSize,pt=this.buffer,mt=_e*at+at,vt=this.cumulativeWeight,Ct=this.cumulativeWeightAdditive,Tt=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,vt<1){const Bt=at*this._origIndex;this._mixBufferRegion(pt,mt,Bt,1-vt,at)}Ct>0&&this._mixBufferRegionAdditive(pt,mt,this._addIndex*at,1,at);for(let Bt=at,Lt=at+at;Bt!==Lt;++Bt)if(pt[Bt]!==pt[Bt+at]){Tt.setValue(pt,mt);break}}saveOriginalState(){const _e=this.binding,at=this.buffer,pt=this.valueSize,mt=pt*this._origIndex;_e.getValue(at,mt);for(let vt=pt,Ct=mt;vt!==Ct;++vt)at[vt]=at[mt+vt%pt];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const _e=3*this.valueSize;this.binding.setValue(this.buffer,_e)}_setAdditiveIdentityNumeric(){const _e=this._addIndex*this.valueSize,at=_e+this.valueSize;for(let pt=_e;pt<at;pt++)this.buffer[pt]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const _e=this._origIndex*this.valueSize,at=this._addIndex*this.valueSize;for(let pt=0;pt<this.valueSize;pt++)this.buffer[at+pt]=this.buffer[_e+pt]}_select(_e,at,pt,mt,vt){if(mt>=.5)for(let Ct=0;Ct!==vt;++Ct)_e[at+Ct]=_e[pt+Ct]}_slerp(_e,at,pt,mt){wo.slerpFlat(_e,at,_e,at,_e,pt,mt)}_slerpAdditive(_e,at,pt,mt,vt){const Ct=this._workIndex*vt;wo.multiplyQuaternionsFlat(_e,Ct,_e,at,_e,pt),wo.slerpFlat(_e,at,_e,at,_e,Ct,mt)}_lerp(_e,at,pt,mt,vt){const Ct=1-mt;for(let Tt=0;Tt!==vt;++Tt){const Bt=at+Tt;_e[Bt]=_e[Bt]*Ct+_e[pt+Tt]*mt}}_lerpAdditive(_e,at,pt,mt,vt){for(let Ct=0;Ct!==vt;++Ct){const Tt=at+Ct;_e[Tt]=_e[Tt]+_e[pt+Ct]*mt}}}const wy="\\[\\]\\.:\\/",VE=new RegExp("["+wy+"]","g"),Ey="[^"+wy+"]",HE="[^"+wy.replace("\\.","")+"]",QE=new RegExp("^"+/((?:WC+[\/:])*)/.source.replace("WC",Ey)+/(WCOD+)?/.source.replace("WCOD",HE)+/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",Ey)+/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",Ey)+"$"),WE=["material","materials","bones","map"];class Ps{constructor(_e,at,pt){this.path=at,this.parsedPath=pt||Ps.parseTrackName(at),this.node=Ps.findNode(_e,this.parsedPath.nodeName),this.rootNode=_e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(_e,at,pt){return _e&&_e.isAnimationObjectGroup?new Ps.Composite(_e,at,pt):new Ps(_e,at,pt)}static sanitizeNodeName(_e){return _e.replace(/\s/g,"_").replace(VE,"")}static parseTrackName(_e){const at=QE.exec(_e);if(at===null)throw new Error("PropertyBinding: Cannot parse trackName: "+_e);const pt={nodeName:at[2],objectName:at[3],objectIndex:at[4],propertyName:at[5],propertyIndex:at[6]},mt=pt.nodeName&&pt.nodeName.lastIndexOf(".");if(mt!==void 0&&mt!==-1){const vt=pt.nodeName.substring(mt+1);WE.indexOf(vt)!==-1&&(pt.nodeName=pt.nodeName.substring(0,mt),pt.objectName=vt)}if(pt.propertyName===null||pt.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+_e);return pt}static findNode(_e,at){if(at===void 0||at===""||at==="."||at===-1||at===_e.name||at===_e.uuid)return _e;if(_e.skeleton){const pt=_e.skeleton.getBoneByName(at);if(pt!==void 0)return pt}if(_e.children){const pt=function(vt){for(let Ct=0;Ct<vt.length;Ct++){const Tt=vt[Ct];if(Tt.name===at||Tt.uuid===at)return Tt;const Bt=pt(Tt.children);if(Bt)return Bt}return null},mt=pt(_e.children);if(mt)return mt}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(_e,at){_e[at]=this.targetObject[this.propertyName]}_getValue_array(_e,at){const pt=this.resolvedProperty;for(let mt=0,vt=pt.length;mt!==vt;++mt)_e[at++]=pt[mt]}_getValue_arrayElement(_e,at){_e[at]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(_e,at){this.resolvedProperty.toArray(_e,at)}_setValue_direct(_e,at){this.targetObject[this.propertyName]=_e[at]}_setValue_direct_setNeedsUpdate(_e,at){this.targetObject[this.propertyName]=_e[at],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(_e,at){this.targetObject[this.propertyName]=_e[at],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(_e,at){const pt=this.resolvedProperty;for(let mt=0,vt=pt.length;mt!==vt;++mt)pt[mt]=_e[at++]}_setValue_array_setNeedsUpdate(_e,at){const pt=this.resolvedProperty;for(let mt=0,vt=pt.length;mt!==vt;++mt)pt[mt]=_e[at++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(_e,at){const pt=this.resolvedProperty;for(let mt=0,vt=pt.length;mt!==vt;++mt)pt[mt]=_e[at++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(_e,at){this.resolvedProperty[this.propertyIndex]=_e[at]}_setValue_arrayElement_setNeedsUpdate(_e,at){this.resolvedProperty[this.propertyIndex]=_e[at],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(_e,at){this.resolvedProperty[this.propertyIndex]=_e[at],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(_e,at){this.resolvedProperty.fromArray(_e,at)}_setValue_fromArray_setNeedsUpdate(_e,at){this.resolvedProperty.fromArray(_e,at),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(_e,at){this.resolvedProperty.fromArray(_e,at),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(_e,at){this.bind(),this.getValue(_e,at)}_setValue_unbound(_e,at){this.bind(),this.setValue(_e,at)}bind(){let _e=this.node;const at=this.parsedPath,pt=at.objectName,mt=at.propertyName;let vt=at.propertyIndex;if(_e||(_e=Ps.findNode(this.rootNode,at.nodeName),this.node=_e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!_e)return void console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");if(pt){let Lt=at.objectIndex;switch(pt){case"materials":if(!_e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!_e.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);_e=_e.material.materials;break;case"bones":if(!_e.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);_e=_e.skeleton.bones;for(let Ut=0;Ut<_e.length;Ut++)if(_e[Ut].name===Lt){Lt=Ut;break}break;case"map":if("map"in _e){_e=_e.map;break}if(!_e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!_e.material.map)return void console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);_e=_e.material.map;break;default:if(_e[pt]===void 0)return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);_e=_e[pt]}if(Lt!==void 0){if(_e[Lt]===void 0)return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,_e);_e=_e[Lt]}}const Ct=_e[mt];if(Ct===void 0){const Lt=at.nodeName;return void console.error("THREE.PropertyBinding: Trying to update property for track: "+Lt+"."+mt+" but it wasn't found.",_e)}let Tt=this.Versioning.None;this.targetObject=_e,_e.needsUpdate!==void 0?Tt=this.Versioning.NeedsUpdate:_e.matrixWorldNeedsUpdate!==void 0&&(Tt=this.Versioning.MatrixWorldNeedsUpdate);let Bt=this.BindingType.Direct;if(vt!==void 0){if(mt==="morphTargetInfluences"){if(!_e.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!_e.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);_e.morphTargetDictionary[vt]!==void 0&&(vt=_e.morphTargetDictionary[vt])}Bt=this.BindingType.ArrayElement,this.resolvedProperty=Ct,this.propertyIndex=vt}else Ct.fromArray!==void 0&&Ct.toArray!==void 0?(Bt=this.BindingType.HasFromToArray,this.resolvedProperty=Ct):Array.isArray(Ct)?(Bt=this.BindingType.EntireArray,this.resolvedProperty=Ct):this.propertyName=mt;this.getValue=this.GetterByBindingType[Bt],this.setValue=this.SetterByBindingTypeAndVersioning[Bt][Tt]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}Ps.Composite=class{constructor(Et,_e,at){const pt=at||Ps.parseTrackName(_e);this._targetGroup=Et,this._bindings=Et.subscribe_(_e,pt)}getValue(Et,_e){this.bind();const at=this._targetGroup.nCachedObjects_,pt=this._bindings[at];pt!==void 0&&pt.getValue(Et,_e)}setValue(Et,_e){const at=this._bindings;for(let pt=this._targetGroup.nCachedObjects_,mt=at.length;pt!==mt;++pt)at[pt].setValue(Et,_e)}bind(){const Et=this._bindings;for(let _e=this._targetGroup.nCachedObjects_,at=Et.length;_e!==at;++_e)Et[_e].bind()}unbind(){const Et=this._bindings;for(let _e=this._targetGroup.nCachedObjects_,at=Et.length;_e!==at;++_e)Et[_e].unbind()}},Ps.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Ps.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},Ps.prototype.GetterByBindingType=[Ps.prototype._getValue_direct,Ps.prototype._getValue_array,Ps.prototype._getValue_arrayElement,Ps.prototype._getValue_toArray],Ps.prototype.SetterByBindingTypeAndVersioning=[[Ps.prototype._setValue_direct,Ps.prototype._setValue_direct_setNeedsUpdate,Ps.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Ps.prototype._setValue_array,Ps.prototype._setValue_array_setNeedsUpdate,Ps.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Ps.prototype._setValue_arrayElement,Ps.prototype._setValue_arrayElement_setNeedsUpdate,Ps.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Ps.prototype._setValue_fromArray,Ps.prototype._setValue_fromArray_setNeedsUpdate,Ps.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class qE{constructor(){this.isAnimationObjectGroup=!0,this.uuid=xo(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const _e={};this._indicesByUUID=_e;for(let pt=0,mt=arguments.length;pt!==mt;++pt)_e[arguments[pt].uuid]=pt;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const at=this;this.stats={objects:{get total(){return at._objects.length},get inUse(){return this.total-at.nCachedObjects_}},get bindingsPerObject(){return at._bindings.length}}}add(){const _e=this._objects,at=this._indicesByUUID,pt=this._paths,mt=this._parsedPaths,vt=this._bindings,Ct=vt.length;let Tt,Bt=_e.length,Lt=this.nCachedObjects_;for(let Ut=0,Qt=arguments.length;Ut!==Qt;++Ut){const Ht=arguments[Ut],Wt=Ht.uuid;let qt=at[Wt];if(qt===void 0){qt=Bt++,at[Wt]=qt,_e.push(Ht);for(let Jt=0,Xt=Ct;Jt!==Xt;++Jt)vt[Jt].push(new Ps(Ht,pt[Jt],mt[Jt]))}else if(qt<Lt){Tt=_e[qt];const Jt=--Lt,Xt=_e[Jt];at[Xt.uuid]=qt,_e[qt]=Xt,at[Wt]=Jt,_e[Jt]=Ht;for(let sr=0,Zt=Ct;sr!==Zt;++sr){const er=vt[sr],xr=er[Jt];let Ar=er[qt];er[qt]=xr,Ar===void 0&&(Ar=new Ps(Ht,pt[sr],mt[sr])),er[Jt]=Ar}}else _e[qt]!==Tt&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=Lt}remove(){const _e=this._objects,at=this._indicesByUUID,pt=this._bindings,mt=pt.length;let vt=this.nCachedObjects_;for(let Ct=0,Tt=arguments.length;Ct!==Tt;++Ct){const Bt=arguments[Ct],Lt=Bt.uuid,Ut=at[Lt];if(Ut!==void 0&&Ut>=vt){const Qt=vt++,Ht=_e[Qt];at[Ht.uuid]=Ut,_e[Ut]=Ht,at[Lt]=Qt,_e[Qt]=Bt;for(let Wt=0,qt=mt;Wt!==qt;++Wt){const Jt=pt[Wt],Xt=Jt[Qt],sr=Jt[Ut];Jt[Ut]=Xt,Jt[Qt]=sr}}}this.nCachedObjects_=vt}uncache(){const _e=this._objects,at=this._indicesByUUID,pt=this._bindings,mt=pt.length;let vt=this.nCachedObjects_,Ct=_e.length;for(let Tt=0,Bt=arguments.length;Tt!==Bt;++Tt){const Lt=arguments[Tt].uuid,Ut=at[Lt];if(Ut!==void 0)if(delete at[Lt],Ut<vt){const Qt=--vt,Ht=_e[Qt],Wt=--Ct,qt=_e[Wt];at[Ht.uuid]=Ut,_e[Ut]=Ht,at[qt.uuid]=Qt,_e[Qt]=qt,_e.pop();for(let Jt=0,Xt=mt;Jt!==Xt;++Jt){const sr=pt[Jt],Zt=sr[Qt],er=sr[Wt];sr[Ut]=Zt,sr[Qt]=er,sr.pop()}}else{const Qt=--Ct,Ht=_e[Qt];Qt>0&&(at[Ht.uuid]=Ut),_e[Ut]=Ht,_e.pop();for(let Wt=0,qt=mt;Wt!==qt;++Wt){const Jt=pt[Wt];Jt[Ut]=Jt[Qt],Jt.pop()}}}this.nCachedObjects_=vt}subscribe_(_e,at){const pt=this._bindingsIndicesByPath;let mt=pt[_e];const vt=this._bindings;if(mt!==void 0)return vt[mt];const Ct=this._paths,Tt=this._parsedPaths,Bt=this._objects,Lt=Bt.length,Ut=this.nCachedObjects_,Qt=new Array(Lt);mt=vt.length,pt[_e]=mt,Ct.push(_e),Tt.push(at),vt.push(Qt);for(let Ht=Ut,Wt=Bt.length;Ht!==Wt;++Ht){const qt=Bt[Ht];Qt[Ht]=new Ps(qt,_e,at)}return Qt}unsubscribe_(_e){const at=this._bindingsIndicesByPath,pt=at[_e];if(pt!==void 0){const mt=this._paths,vt=this._parsedPaths,Ct=this._bindings,Tt=Ct.length-1,Bt=Ct[Tt];at[_e[Tt]]=pt,Ct[pt]=Bt,Ct.pop(),vt[pt]=vt[Tt],vt.pop(),mt[pt]=mt[Tt],mt.pop()}}}class qA{constructor(_e,at,pt=null,mt=at.blendMode){this._mixer=_e,this._clip=at,this._localRoot=pt,this.blendMode=mt;const vt=at.tracks,Ct=vt.length,Tt=new Array(Ct),Bt={endingStart:au,endingEnd:au};for(let Lt=0;Lt!==Ct;++Lt){const Ut=vt[Lt].createInterpolant(null);Tt[Lt]=Ut,Ut.settings=Bt}this._interpolantSettings=Bt,this._interpolants=Tt,this._propertyBindings=new Array(Ct),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=Tu,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(_e){return this._startTime=_e,this}setLoop(_e,at){return this.loop=_e,this.repetitions=at,this}setEffectiveWeight(_e){return this.weight=_e,this._effectiveWeight=this.enabled?_e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(_e){return this._scheduleFading(_e,0,1)}fadeOut(_e){return this._scheduleFading(_e,1,0)}crossFadeFrom(_e,at,pt){if(_e.fadeOut(at),this.fadeIn(at),pt){const mt=this._clip.duration,vt=_e._clip.duration,Ct=vt/mt,Tt=mt/vt;_e.warp(1,Ct,at),this.warp(Tt,1,at)}return this}crossFadeTo(_e,at,pt){return _e.crossFadeFrom(this,at,pt)}stopFading(){const _e=this._weightInterpolant;return _e!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(_e)),this}setEffectiveTimeScale(_e){return this.timeScale=_e,this._effectiveTimeScale=this.paused?0:_e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(_e){return this.timeScale=this._clip.duration/_e,this.stopWarping()}syncWith(_e){return this.time=_e.time,this.timeScale=_e.timeScale,this.stopWarping()}halt(_e){return this.warp(this._effectiveTimeScale,0,_e)}warp(_e,at,pt){const mt=this._mixer,vt=mt.time,Ct=this.timeScale;let Tt=this._timeScaleInterpolant;Tt===null&&(Tt=mt._lendControlInterpolant(),this._timeScaleInterpolant=Tt);const Bt=Tt.parameterPositions,Lt=Tt.sampleValues;return Bt[0]=vt,Bt[1]=vt+pt,Lt[0]=_e/Ct,Lt[1]=at/Ct,this}stopWarping(){const _e=this._timeScaleInterpolant;return _e!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(_e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(_e,at,pt,mt){if(!this.enabled)return void this._updateWeight(_e);const vt=this._startTime;if(vt!==null){const Bt=(_e-vt)*pt;Bt<0||pt===0?at=0:(this._startTime=null,at=pt*Bt)}at*=this._updateTimeScale(_e);const Ct=this._updateTime(at),Tt=this._updateWeight(_e);if(Tt>0){const Bt=this._interpolants,Lt=this._propertyBindings;if(this.blendMode===Xp)for(let Ut=0,Qt=Bt.length;Ut!==Qt;++Ut)Bt[Ut].evaluate(Ct),Lt[Ut].accumulateAdditive(Tt);else for(let Ut=0,Qt=Bt.length;Ut!==Qt;++Ut)Bt[Ut].evaluate(Ct),Lt[Ut].accumulate(mt,Tt)}}_updateWeight(_e){let at=0;if(this.enabled){at=this.weight;const pt=this._weightInterpolant;if(pt!==null){const mt=pt.evaluate(_e)[0];at*=mt,_e>pt.parameterPositions[1]&&(this.stopFading(),mt===0&&(this.enabled=!1))}}return this._effectiveWeight=at,at}_updateTimeScale(_e){let at=0;if(!this.paused){at=this.timeScale;const pt=this._timeScaleInterpolant;pt!==null&&(at*=pt.evaluate(_e)[0],_e>pt.parameterPositions[1]&&(this.stopWarping(),at===0?this.paused=!0:this.timeScale=at))}return this._effectiveTimeScale=at,at}_updateTime(_e){const at=this._clip.duration,pt=this.loop;let mt=this.time+_e,vt=this._loopCount;const Ct=pt===qp;if(_e===0)return vt===-1||!Ct||1&~vt?mt:at-mt;if(pt===Pu){vt===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(mt>=at)mt=at;else{if(!(mt<0)){this.time=mt;break e}mt=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=mt,this._mixer.dispatchEvent({type:"finished",action:this,direction:_e<0?-1:1})}}else{if(vt===-1&&(_e>=0?(vt=0,this._setEndings(!0,this.repetitions===0,Ct)):this._setEndings(this.repetitions===0,!0,Ct)),mt>=at||mt<0){const Tt=Math.floor(mt/at);mt-=at*Tt,vt+=Math.abs(Tt);const Bt=this.repetitions-vt;if(Bt<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,mt=_e>0?at:0,this.time=mt,this._mixer.dispatchEvent({type:"finished",action:this,direction:_e>0?1:-1});else{if(Bt===1){const Lt=_e<0;this._setEndings(Lt,!Lt,Ct)}else this._setEndings(!1,!1,Ct);this._loopCount=vt,this.time=mt,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:Tt})}}else this.time=mt;if(Ct&&!(1&~vt))return at-mt}return mt}_setEndings(_e,at,pt){const mt=this._interpolantSettings;pt?(mt.endingStart=ou,mt.endingEnd=ou):(mt.endingStart=_e?this.zeroSlopeAtStart?ou:au:op,mt.endingEnd=at?this.zeroSlopeAtEnd?ou:au:op)}_scheduleFading(_e,at,pt){const mt=this._mixer,vt=mt.time;let Ct=this._weightInterpolant;Ct===null&&(Ct=mt._lendControlInterpolant(),this._weightInterpolant=Ct);const Tt=Ct.parameterPositions,Bt=Ct.sampleValues;return Tt[0]=vt,Bt[0]=at,Tt[1]=vt+_e,Bt[1]=pt,this}}const $E=new Float32Array(1);class XE extends mo{constructor(_e){super(),this._root=_e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(_e,at){const pt=_e._localRoot||this._root,mt=_e._clip.tracks,vt=mt.length,Ct=_e._propertyBindings,Tt=_e._interpolants,Bt=pt.uuid,Lt=this._bindingsByRootAndName;let Ut=Lt[Bt];Ut===void 0&&(Ut={},Lt[Bt]=Ut);for(let Qt=0;Qt!==vt;++Qt){const Ht=mt[Qt],Wt=Ht.name;let qt=Ut[Wt];if(qt!==void 0)++qt.referenceCount,Ct[Qt]=qt;else{if(qt=Ct[Qt],qt!==void 0){qt._cacheIndex===null&&(++qt.referenceCount,this._addInactiveBinding(qt,Bt,Wt));continue}const Jt=at&&at._propertyBindings[Qt].binding.parsedPath;qt=new WA(Ps.create(pt,Wt,Jt),Ht.ValueTypeName,Ht.getValueSize()),++qt.referenceCount,this._addInactiveBinding(qt,Bt,Wt),Ct[Qt]=qt}Tt[Qt].resultBuffer=qt.buffer}}_activateAction(_e){if(!this._isActiveAction(_e)){if(_e._cacheIndex===null){const pt=(_e._localRoot||this._root).uuid,mt=_e._clip.uuid,vt=this._actionsByClip[mt];this._bindAction(_e,vt&&vt.knownActions[0]),this._addInactiveAction(_e,mt,pt)}const at=_e._propertyBindings;for(let pt=0,mt=at.length;pt!==mt;++pt){const vt=at[pt];vt.useCount++==0&&(this._lendBinding(vt),vt.saveOriginalState())}this._lendAction(_e)}}_deactivateAction(_e){if(this._isActiveAction(_e)){const at=_e._propertyBindings;for(let pt=0,mt=at.length;pt!==mt;++pt){const vt=at[pt];--vt.useCount==0&&(vt.restoreOriginalState(),this._takeBackBinding(vt))}this._takeBackAction(_e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const _e=this;this.stats={actions:{get total(){return _e._actions.length},get inUse(){return _e._nActiveActions}},bindings:{get total(){return _e._bindings.length},get inUse(){return _e._nActiveBindings}},controlInterpolants:{get total(){return _e._controlInterpolants.length},get inUse(){return _e._nActiveControlInterpolants}}}}_isActiveAction(_e){const at=_e._cacheIndex;return at!==null&&at<this._nActiveActions}_addInactiveAction(_e,at,pt){const mt=this._actions,vt=this._actionsByClip;let Ct=vt[at];if(Ct===void 0)Ct={knownActions:[_e],actionByRoot:{}},_e._byClipCacheIndex=0,vt[at]=Ct;else{const Tt=Ct.knownActions;_e._byClipCacheIndex=Tt.length,Tt.push(_e)}_e._cacheIndex=mt.length,mt.push(_e),Ct.actionByRoot[pt]=_e}_removeInactiveAction(_e){const at=this._actions,pt=at[at.length-1],mt=_e._cacheIndex;pt._cacheIndex=mt,at[mt]=pt,at.pop(),_e._cacheIndex=null;const vt=_e._clip.uuid,Ct=this._actionsByClip,Tt=Ct[vt],Bt=Tt.knownActions,Lt=Bt[Bt.length-1],Ut=_e._byClipCacheIndex;Lt._byClipCacheIndex=Ut,Bt[Ut]=Lt,Bt.pop(),_e._byClipCacheIndex=null,delete Tt.actionByRoot[(_e._localRoot||this._root).uuid],Bt.length===0&&delete Ct[vt],this._removeInactiveBindingsForAction(_e)}_removeInactiveBindingsForAction(_e){const at=_e._propertyBindings;for(let pt=0,mt=at.length;pt!==mt;++pt){const vt=at[pt];--vt.referenceCount==0&&this._removeInactiveBinding(vt)}}_lendAction(_e){const at=this._actions,pt=_e._cacheIndex,mt=this._nActiveActions++,vt=at[mt];_e._cacheIndex=mt,at[mt]=_e,vt._cacheIndex=pt,at[pt]=vt}_takeBackAction(_e){const at=this._actions,pt=_e._cacheIndex,mt=--this._nActiveActions,vt=at[mt];_e._cacheIndex=mt,at[mt]=_e,vt._cacheIndex=pt,at[pt]=vt}_addInactiveBinding(_e,at,pt){const mt=this._bindingsByRootAndName,vt=this._bindings;let Ct=mt[at];Ct===void 0&&(Ct={},mt[at]=Ct),Ct[pt]=_e,_e._cacheIndex=vt.length,vt.push(_e)}_removeInactiveBinding(_e){const at=this._bindings,pt=_e.binding,mt=pt.rootNode.uuid,vt=pt.path,Ct=this._bindingsByRootAndName,Tt=Ct[mt],Bt=at[at.length-1],Lt=_e._cacheIndex;Bt._cacheIndex=Lt,at[Lt]=Bt,at.pop(),delete Tt[vt],Object.keys(Tt).length===0&&delete Ct[mt]}_lendBinding(_e){const at=this._bindings,pt=_e._cacheIndex,mt=this._nActiveBindings++,vt=at[mt];_e._cacheIndex=mt,at[mt]=_e,vt._cacheIndex=pt,at[pt]=vt}_takeBackBinding(_e){const at=this._bindings,pt=_e._cacheIndex,mt=--this._nActiveBindings,vt=at[mt];_e._cacheIndex=mt,at[mt]=_e,vt._cacheIndex=pt,at[pt]=vt}_lendControlInterpolant(){const _e=this._controlInterpolants,at=this._nActiveControlInterpolants++;let pt=_e[at];return pt===void 0&&(pt=new gy(new Float32Array(2),new Float32Array(2),1,$E),pt.__cacheIndex=at,_e[at]=pt),pt}_takeBackControlInterpolant(_e){const at=this._controlInterpolants,pt=_e.__cacheIndex,mt=--this._nActiveControlInterpolants,vt=at[mt];_e.__cacheIndex=mt,at[mt]=_e,vt.__cacheIndex=pt,at[pt]=vt}clipAction(_e,at,pt){const mt=at||this._root,vt=mt.uuid;let Ct=typeof _e=="string"?L_.findByName(mt,_e):_e;const Tt=Ct!==null?Ct.uuid:_e,Bt=this._actionsByClip[Tt];let Lt=null;if(pt===void 0&&(pt=Ct!==null?Ct.blendMode:Vm),Bt!==void 0){const Qt=Bt.actionByRoot[vt];if(Qt!==void 0&&Qt.blendMode===pt)return Qt;Lt=Bt.knownActions[0],Ct===null&&(Ct=Lt._clip)}if(Ct===null)return null;const Ut=new qA(this,Ct,at,pt);return this._bindAction(Ut,Lt),this._addInactiveAction(Ut,Tt,vt),Ut}existingAction(_e,at){const pt=at||this._root,mt=pt.uuid,vt=typeof _e=="string"?L_.findByName(pt,_e):_e,Ct=vt?vt.uuid:_e,Tt=this._actionsByClip[Ct];return Tt!==void 0&&Tt.actionByRoot[mt]||null}stopAllAction(){const _e=this._actions;for(let at=this._nActiveActions-1;at>=0;--at)_e[at].stop();return this}update(_e){_e*=this.timeScale;const at=this._actions,pt=this._nActiveActions,mt=this.time+=_e,vt=Math.sign(_e),Ct=this._accuIndex^=1;for(let Lt=0;Lt!==pt;++Lt)at[Lt]._update(mt,_e,vt,Ct);const Tt=this._bindings,Bt=this._nActiveBindings;for(let Lt=0;Lt!==Bt;++Lt)Tt[Lt].apply(Ct);return this}setTime(_e){this.time=0;for(let at=0;at<this._actions.length;at++)this._actions[at].time=0;return this.update(_e)}getRoot(){return this._root}uncacheClip(_e){const at=this._actions,pt=_e.uuid,mt=this._actionsByClip,vt=mt[pt];if(vt!==void 0){const Ct=vt.knownActions;for(let Tt=0,Bt=Ct.length;Tt!==Bt;++Tt){const Lt=Ct[Tt];this._deactivateAction(Lt);const Ut=Lt._cacheIndex,Qt=at[at.length-1];Lt._cacheIndex=null,Lt._byClipCacheIndex=null,Qt._cacheIndex=Ut,at[Ut]=Qt,at.pop(),this._removeInactiveBindingsForAction(Lt)}delete mt[pt]}}uncacheRoot(_e){const at=_e.uuid,pt=this._actionsByClip;for(const vt in pt){const Ct=pt[vt].actionByRoot[at];Ct!==void 0&&(this._deactivateAction(Ct),this._removeInactiveAction(Ct))}const mt=this._bindingsByRootAndName[at];if(mt!==void 0)for(const vt in mt){const Ct=mt[vt];Ct.restoreOriginalState(),this._removeInactiveBinding(Ct)}}uncacheAction(_e,at){const pt=this.existingAction(_e,at);pt!==null&&(this._deactivateAction(pt),this._removeInactiveAction(pt))}}class Sy{constructor(_e){this.value=_e}clone(){return new Sy(this.value.clone===void 0?this.value:this.value.clone())}}let YE=0;class KE extends mo{constructor(){super(),this.isUniformsGroup=!0,Object.defineProperty(this,"id",{value:YE++}),this.name="",this.usage=ku,this.uniforms=[]}add(_e){return this.uniforms.push(_e),this}remove(_e){const at=this.uniforms.indexOf(_e);return at!==-1&&this.uniforms.splice(at,1),this}setName(_e){return this.name=_e,this}setUsage(_e){return this.usage=_e,this}dispose(){return this.dispatchEvent({type:"dispose"}),this}copy(_e){this.name=_e.name,this.usage=_e.usage;const at=_e.uniforms;this.uniforms.length=0;for(let pt=0,mt=at.length;pt<mt;pt++)this.uniforms.push(at[pt].clone());return this}clone(){return new this.constructor().copy(this)}}class JE extends Mv{constructor(_e,at,pt=1){super(_e,at),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=pt}copy(_e){return super.copy(_e),this.meshPerAttribute=_e.meshPerAttribute,this}clone(_e){const at=super.clone(_e);return at.meshPerAttribute=this.meshPerAttribute,at}toJSON(_e){const at=super.toJSON(_e);return at.isInstancedInterleavedBuffer=!0,at.meshPerAttribute=this.meshPerAttribute,at}}class ZE{constructor(_e,at,pt,mt,vt){this.isGLBufferAttribute=!0,this.name="",this.buffer=_e,this.type=at,this.itemSize=pt,this.elementSize=mt,this.count=vt,this.version=0}set needsUpdate(_e){_e===!0&&this.version++}setBuffer(_e){return this.buffer=_e,this}setType(_e,at){return this.type=_e,this.elementSize=at,this}setItemSize(_e){return this.itemSize=_e,this}setCount(_e){return this.count=_e,this}}class eS{constructor(_e,at,pt=0,mt=1/0){this.ray=new ju(_e,at),this.near=pt,this.far=mt,this.camera=null,this.layers=new cm,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(_e,at){this.ray.set(_e,at)}setFromCamera(_e,at){at.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(at.matrixWorld),this.ray.direction.set(_e.x,_e.y,.5).unproject(at).sub(this.ray.origin).normalize(),this.camera=at):at.isOrthographicCamera?(this.ray.origin.set(_e.x,_e.y,(at.near+at.far)/(at.near-at.far)).unproject(at),this.ray.direction.set(0,0,-1).transformDirection(at.matrixWorld),this.camera=at):console.error("THREE.Raycaster: Unsupported camera type: "+at.type)}intersectObject(_e,at=!0,pt=[]){return Cy(_e,this,pt,at),pt.sort($A),pt}intersectObjects(_e,at=!0,pt=[]){for(let mt=0,vt=_e.length;mt<vt;mt++)Cy(_e[mt],this,pt,at);return pt.sort($A),pt}}function $A(Et,_e){return Et.distance-_e.distance}function Cy(Et,_e,at,pt){if(Et.layers.test(_e.layers)&&Et.raycast(_e,at),pt===!0){const mt=Et.children;for(let vt=0,Ct=mt.length;vt<Ct;vt++)Cy(mt[vt],_e,at,!0)}}class tS{constructor(_e=1,at=0,pt=0){return this.radius=_e,this.phi=at,this.theta=pt,this}set(_e,at,pt){return this.radius=_e,this.phi=at,this.theta=pt,this}copy(_e){return this.radius=_e.radius,this.phi=_e.phi,this.theta=_e.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(_e){return this.setFromCartesianCoords(_e.x,_e.y,_e.z)}setFromCartesianCoords(_e,at,pt){return this.radius=Math.sqrt(_e*_e+at*at+pt*pt),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(_e,pt),this.phi=Math.acos(Hs(at/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}class rS{constructor(_e=1,at=0,pt=0){return this.radius=_e,this.theta=at,this.y=pt,this}set(_e,at,pt){return this.radius=_e,this.theta=at,this.y=pt,this}copy(_e){return this.radius=_e.radius,this.theta=_e.theta,this.y=_e.y,this}setFromVector3(_e){return this.setFromCartesianCoords(_e.x,_e.y,_e.z)}setFromCartesianCoords(_e,at,pt){return this.radius=Math.sqrt(_e*_e+pt*pt),this.theta=Math.atan2(_e,pt),this.y=at,this}clone(){return new this.constructor().copy(this)}}const XA=new dn;class iS{constructor(_e=new dn(1/0,1/0),at=new dn(-1/0,-1/0)){this.isBox2=!0,this.min=_e,this.max=at}set(_e,at){return this.min.copy(_e),this.max.copy(at),this}setFromPoints(_e){this.makeEmpty();for(let at=0,pt=_e.length;at<pt;at++)this.expandByPoint(_e[at]);return this}setFromCenterAndSize(_e,at){const pt=XA.copy(at).multiplyScalar(.5);return this.min.copy(_e).sub(pt),this.max.copy(_e).add(pt),this}clone(){return new this.constructor().copy(this)}copy(_e){return this.min.copy(_e.min),this.max.copy(_e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(_e){return this.isEmpty()?_e.set(0,0):_e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(_e){return this.isEmpty()?_e.set(0,0):_e.subVectors(this.max,this.min)}expandByPoint(_e){return this.min.min(_e),this.max.max(_e),this}expandByVector(_e){return this.min.sub(_e),this.max.add(_e),this}expandByScalar(_e){return this.min.addScalar(-_e),this.max.addScalar(_e),this}containsPoint(_e){return!(_e.x<this.min.x||_e.x>this.max.x||_e.y<this.min.y||_e.y>this.max.y)}containsBox(_e){return this.min.x<=_e.min.x&&_e.max.x<=this.max.x&&this.min.y<=_e.min.y&&_e.max.y<=this.max.y}getParameter(_e,at){return at.set((_e.x-this.min.x)/(this.max.x-this.min.x),(_e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(_e){return!(_e.max.x<this.min.x||_e.min.x>this.max.x||_e.max.y<this.min.y||_e.min.y>this.max.y)}clampPoint(_e,at){return at.copy(_e).clamp(this.min,this.max)}distanceToPoint(_e){return this.clampPoint(_e,XA).distanceTo(_e)}intersect(_e){return this.min.max(_e.min),this.max.min(_e.max),this.isEmpty()&&this.makeEmpty(),this}union(_e){return this.min.min(_e.min),this.max.max(_e.max),this}translate(_e){return this.min.add(_e),this.max.add(_e),this}equals(_e){return _e.min.equals(this.min)&&_e.max.equals(this.max)}}const YA=new Er,c0=new Er;class nS{constructor(_e=new Er,at=new Er){this.start=_e,this.end=at}set(_e,at){return this.start.copy(_e),this.end.copy(at),this}copy(_e){return this.start.copy(_e.start),this.end.copy(_e.end),this}getCenter(_e){return _e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(_e){return _e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(_e,at){return this.delta(at).multiplyScalar(_e).add(this.start)}closestPointToPointParameter(_e,at){YA.subVectors(_e,this.start),c0.subVectors(this.end,this.start);const pt=c0.dot(c0);let mt=c0.dot(YA)/pt;return at&&(mt=Hs(mt,0,1)),mt}closestPointToPoint(_e,at,pt){const mt=this.closestPointToPointParameter(_e,at);return this.delta(pt).multiplyScalar(mt).add(this.start)}applyMatrix4(_e){return this.start.applyMatrix4(_e),this.end.applyMatrix4(_e),this}equals(_e){return _e.start.equals(this.start)&&_e.end.equals(this.end)}clone(){return new this.constructor().copy(this)}}const KA=new Er;class sS extends Ss{constructor(_e,at){super(),this.light=_e,this.matrix=_e.matrixWorld,this.matrixAutoUpdate=!1,this.color=at,this.type="SpotLightHelper";const pt=new _s,mt=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let Ct=0,Tt=1,Bt=32;Ct<Bt;Ct++,Tt++){const Lt=Ct/Bt*Math.PI*2,Ut=Tt/Bt*Math.PI*2;mt.push(Math.cos(Lt),Math.sin(Lt),1,Math.cos(Ut),Math.sin(Ut),1)}pt.setAttribute("position",new Ln(mt,3));const vt=new Lo({fog:!1,toneMapped:!1});this.cone=new _c(pt,vt),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1);const _e=this.light.distance?this.light.distance:1e3,at=_e*Math.tan(this.light.angle);this.cone.scale.set(at,at,_e),KA.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(KA),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const Zu=new Er,u0=new rs,Py=new rs;class aS extends _c{constructor(_e){const at=JA(_e),pt=new _s,mt=[],vt=[],Ct=new Un(0,0,1),Tt=new Un(0,1,0);for(let Bt=0;Bt<at.length;Bt++){const Lt=at[Bt];Lt.parent&&Lt.parent.isBone&&(mt.push(0,0,0),mt.push(0,0,0),vt.push(Ct.r,Ct.g,Ct.b),vt.push(Tt.r,Tt.g,Tt.b))}pt.setAttribute("position",new Ln(mt,3)),pt.setAttribute("color",new Ln(vt,3)),super(pt,new Lo({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0})),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=_e,this.bones=at,this.matrix=_e.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(_e){const at=this.bones,pt=this.geometry,mt=pt.getAttribute("position");Py.copy(this.root.matrixWorld).invert();for(let vt=0,Ct=0;vt<at.length;vt++){const Tt=at[vt];Tt.parent&&Tt.parent.isBone&&(u0.multiplyMatrices(Py,Tt.matrixWorld),Zu.setFromMatrixPosition(u0),mt.setXYZ(Ct,Zu.x,Zu.y,Zu.z),u0.multiplyMatrices(Py,Tt.parent.matrixWorld),Zu.setFromMatrixPosition(u0),mt.setXYZ(Ct+1,Zu.x,Zu.y,Zu.z),Ct+=2)}pt.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(_e)}dispose(){this.geometry.dispose(),this.material.dispose()}}function JA(Et){const _e=[];Et.isBone===!0&&_e.push(Et);for(let at=0;at<Et.children.length;at++)_e.push.apply(_e,JA(Et.children[at]));return _e}class oS extends lo{constructor(_e,at,pt){super(new R_(at,4,2),new Zl({wireframe:!0,fog:!1,toneMapped:!1})),this.light=_e,this.color=pt,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const lS=new Er,ZA=new Un,ew=new Un;class cS extends Ss{constructor(_e,at,pt){super(),this.light=_e,this.matrix=_e.matrixWorld,this.matrixAutoUpdate=!1,this.color=pt,this.type="HemisphereLightHelper";const mt=new I_(at);mt.rotateY(.5*Math.PI),this.material=new Zl({wireframe:!0,fog:!1,toneMapped:!1}),this.color===void 0&&(this.material.vertexColors=!0);const vt=mt.getAttribute("position"),Ct=new Float32Array(3*vt.count);mt.setAttribute("color",new mr(Ct,3)),this.add(new lo(mt,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const _e=this.children[0];if(this.color!==void 0)this.material.color.set(this.color);else{const at=_e.geometry.getAttribute("color");ZA.copy(this.light.color),ew.copy(this.light.groundColor);for(let pt=0,mt=at.count;pt<mt;pt++){const vt=pt<mt/2?ZA:ew;at.setXYZ(pt,vt.r,vt.g,vt.b)}at.needsUpdate=!0}this.light.updateWorldMatrix(!0,!1),_e.lookAt(lS.setFromMatrixPosition(this.light.matrixWorld).negate())}}class uS extends _c{constructor(_e=10,at=10,pt=4473924,mt=8947848){pt=new Un(pt),mt=new Un(mt);const vt=at/2,Ct=_e/at,Tt=_e/2,Bt=[],Lt=[];for(let Qt=0,Ht=0,Wt=-Tt;Qt<=at;Qt++,Wt+=Ct){Bt.push(-Tt,0,Wt,Tt,0,Wt),Bt.push(Wt,0,-Tt,Wt,0,Tt);const qt=Qt===vt?pt:mt;qt.toArray(Lt,Ht),Ht+=3,qt.toArray(Lt,Ht),Ht+=3,qt.toArray(Lt,Ht),Ht+=3,qt.toArray(Lt,Ht),Ht+=3}const Ut=new _s;Ut.setAttribute("position",new Ln(Bt,3)),Ut.setAttribute("color",new Ln(Lt,3)),super(Ut,new Lo({vertexColors:!0,toneMapped:!1})),this.type="GridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}class pS extends _c{constructor(_e=10,at=16,pt=8,mt=64,vt=4473924,Ct=8947848){vt=new Un(vt),Ct=new Un(Ct);const Tt=[],Bt=[];if(at>1)for(let Ut=0;Ut<at;Ut++){const Qt=Ut/at*(2*Math.PI),Ht=Math.sin(Qt)*_e,Wt=Math.cos(Qt)*_e;Tt.push(0,0,0),Tt.push(Ht,0,Wt);const qt=1&Ut?vt:Ct;Bt.push(qt.r,qt.g,qt.b),Bt.push(qt.r,qt.g,qt.b)}for(let Ut=0;Ut<pt;Ut++){const Qt=1&Ut?vt:Ct,Ht=_e-_e/pt*Ut;for(let Wt=0;Wt<mt;Wt++){let qt=Wt/mt*(2*Math.PI),Jt=Math.sin(qt)*Ht,Xt=Math.cos(qt)*Ht;Tt.push(Jt,0,Xt),Bt.push(Qt.r,Qt.g,Qt.b),qt=(Wt+1)/mt*(2*Math.PI),Jt=Math.sin(qt)*Ht,Xt=Math.cos(qt)*Ht,Tt.push(Jt,0,Xt),Bt.push(Qt.r,Qt.g,Qt.b)}}const Lt=new _s;Lt.setAttribute("position",new Ln(Tt,3)),Lt.setAttribute("color",new Ln(Bt,3)),super(Lt,new Lo({vertexColors:!0,toneMapped:!1})),this.type="PolarGridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}const tw=new Er,p0=new Er,rw=new Er;class hS extends Ss{constructor(_e,at,pt){super(),this.light=_e,this.matrix=_e.matrixWorld,this.matrixAutoUpdate=!1,this.color=pt,this.type="DirectionalLightHelper",at===void 0&&(at=1);let mt=new _s;mt.setAttribute("position",new Ln([-at,at,0,at,at,0,at,-at,0,-at,-at,0,-at,at,0],3));const vt=new Lo({fog:!1,toneMapped:!1});this.lightPlane=new Yu(mt,vt),this.add(this.lightPlane),mt=new _s,mt.setAttribute("position",new Ln([0,0,0,0,0,1],3)),this.targetLine=new Yu(mt,vt),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),tw.setFromMatrixPosition(this.light.matrixWorld),p0.setFromMatrixPosition(this.light.target.matrixWorld),rw.subVectors(p0,tw),this.lightPlane.lookAt(p0),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(p0),this.targetLine.scale.z=rw.length()}}const h0=new Er,Ks=new yv;class dS extends _c{constructor(_e){const at=new _s,pt=new Lo({color:16777215,vertexColors:!0,toneMapped:!1}),mt=[],vt=[],Ct={};function Tt(qt,Jt){Bt(qt),Bt(Jt)}function Bt(qt){mt.push(0,0,0),vt.push(0,0,0),Ct[qt]===void 0&&(Ct[qt]=[]),Ct[qt].push(mt.length/3-1)}Tt("n1","n2"),Tt("n2","n4"),Tt("n4","n3"),Tt("n3","n1"),Tt("f1","f2"),Tt("f2","f4"),Tt("f4","f3"),Tt("f3","f1"),Tt("n1","f1"),Tt("n2","f2"),Tt("n3","f3"),Tt("n4","f4"),Tt("p","n1"),Tt("p","n2"),Tt("p","n3"),Tt("p","n4"),Tt("u1","u2"),Tt("u2","u3"),Tt("u3","u1"),Tt("c","t"),Tt("p","c"),Tt("cn1","cn2"),Tt("cn3","cn4"),Tt("cf1","cf2"),Tt("cf3","cf4"),at.setAttribute("position",new Ln(mt,3)),at.setAttribute("color",new Ln(vt,3)),super(at,pt),this.type="CameraHelper",this.camera=_e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=_e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=Ct,this.update();const Lt=new Un(16755200),Ut=new Un(16711680),Qt=new Un(43775),Ht=new Un(16777215),Wt=new Un(3355443);this.setColors(Lt,Ut,Qt,Ht,Wt)}setColors(_e,at,pt,mt,vt){const Ct=this.geometry.getAttribute("color");Ct.setXYZ(0,_e.r,_e.g,_e.b),Ct.setXYZ(1,_e.r,_e.g,_e.b),Ct.setXYZ(2,_e.r,_e.g,_e.b),Ct.setXYZ(3,_e.r,_e.g,_e.b),Ct.setXYZ(4,_e.r,_e.g,_e.b),Ct.setXYZ(5,_e.r,_e.g,_e.b),Ct.setXYZ(6,_e.r,_e.g,_e.b),Ct.setXYZ(7,_e.r,_e.g,_e.b),Ct.setXYZ(8,_e.r,_e.g,_e.b),Ct.setXYZ(9,_e.r,_e.g,_e.b),Ct.setXYZ(10,_e.r,_e.g,_e.b),Ct.setXYZ(11,_e.r,_e.g,_e.b),Ct.setXYZ(12,_e.r,_e.g,_e.b),Ct.setXYZ(13,_e.r,_e.g,_e.b),Ct.setXYZ(14,_e.r,_e.g,_e.b),Ct.setXYZ(15,_e.r,_e.g,_e.b),Ct.setXYZ(16,_e.r,_e.g,_e.b),Ct.setXYZ(17,_e.r,_e.g,_e.b),Ct.setXYZ(18,_e.r,_e.g,_e.b),Ct.setXYZ(19,_e.r,_e.g,_e.b),Ct.setXYZ(20,_e.r,_e.g,_e.b),Ct.setXYZ(21,_e.r,_e.g,_e.b),Ct.setXYZ(22,_e.r,_e.g,_e.b),Ct.setXYZ(23,_e.r,_e.g,_e.b),Ct.setXYZ(24,at.r,at.g,at.b),Ct.setXYZ(25,at.r,at.g,at.b),Ct.setXYZ(26,at.r,at.g,at.b),Ct.setXYZ(27,at.r,at.g,at.b),Ct.setXYZ(28,at.r,at.g,at.b),Ct.setXYZ(29,at.r,at.g,at.b),Ct.setXYZ(30,at.r,at.g,at.b),Ct.setXYZ(31,at.r,at.g,at.b),Ct.setXYZ(32,pt.r,pt.g,pt.b),Ct.setXYZ(33,pt.r,pt.g,pt.b),Ct.setXYZ(34,pt.r,pt.g,pt.b),Ct.setXYZ(35,pt.r,pt.g,pt.b),Ct.setXYZ(36,pt.r,pt.g,pt.b),Ct.setXYZ(37,pt.r,pt.g,pt.b),Ct.setXYZ(38,mt.r,mt.g,mt.b),Ct.setXYZ(39,mt.r,mt.g,mt.b),Ct.setXYZ(40,vt.r,vt.g,vt.b),Ct.setXYZ(41,vt.r,vt.g,vt.b),Ct.setXYZ(42,vt.r,vt.g,vt.b),Ct.setXYZ(43,vt.r,vt.g,vt.b),Ct.setXYZ(44,vt.r,vt.g,vt.b),Ct.setXYZ(45,vt.r,vt.g,vt.b),Ct.setXYZ(46,vt.r,vt.g,vt.b),Ct.setXYZ(47,vt.r,vt.g,vt.b),Ct.setXYZ(48,vt.r,vt.g,vt.b),Ct.setXYZ(49,vt.r,vt.g,vt.b),Ct.needsUpdate=!0}update(){const _e=this.geometry,at=this.pointMap;Ks.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),na("c",at,_e,Ks,0,0,-1),na("t",at,_e,Ks,0,0,1),na("n1",at,_e,Ks,-1,-1,-1),na("n2",at,_e,Ks,1,-1,-1),na("n3",at,_e,Ks,-1,1,-1),na("n4",at,_e,Ks,1,1,-1),na("f1",at,_e,Ks,-1,-1,1),na("f2",at,_e,Ks,1,-1,1),na("f3",at,_e,Ks,-1,1,1),na("f4",at,_e,Ks,1,1,1),na("u1",at,_e,Ks,.7,1.1,-1),na("u2",at,_e,Ks,-.7,1.1,-1),na("u3",at,_e,Ks,0,2,-1),na("cf1",at,_e,Ks,-1,0,1),na("cf2",at,_e,Ks,1,0,1),na("cf3",at,_e,Ks,0,-1,1),na("cf4",at,_e,Ks,0,1,1),na("cn1",at,_e,Ks,-1,0,-1),na("cn2",at,_e,Ks,1,0,-1),na("cn3",at,_e,Ks,0,-1,-1),na("cn4",at,_e,Ks,0,1,-1),_e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function na(Et,_e,at,pt,mt,vt,Ct){h0.set(mt,vt,Ct).unproject(pt);const Tt=_e[Et];if(Tt!==void 0){const Bt=at.getAttribute("position");for(let Lt=0,Ut=Tt.length;Lt<Ut;Lt++)Bt.setXYZ(Tt[Lt],h0.x,h0.y,h0.z)}}const d0=new xl;class mS extends _c{constructor(_e,at=16776960){const pt=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),mt=new Float32Array(24),vt=new _s;vt.setIndex(new mr(pt,1)),vt.setAttribute("position",new mr(mt,3)),super(vt,new Lo({color:at,toneMapped:!1})),this.object=_e,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(_e){if(_e!==void 0&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),this.object!==void 0&&d0.setFromObject(this.object),d0.isEmpty())return;const at=d0.min,pt=d0.max,mt=this.geometry.attributes.position,vt=mt.array;vt[0]=pt.x,vt[1]=pt.y,vt[2]=pt.z,vt[3]=at.x,vt[4]=pt.y,vt[5]=pt.z,vt[6]=at.x,vt[7]=at.y,vt[8]=pt.z,vt[9]=pt.x,vt[10]=at.y,vt[11]=pt.z,vt[12]=pt.x,vt[13]=pt.y,vt[14]=at.z,vt[15]=at.x,vt[16]=pt.y,vt[17]=at.z,vt[18]=at.x,vt[19]=at.y,vt[20]=at.z,vt[21]=pt.x,vt[22]=at.y,vt[23]=at.z,mt.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(_e){return this.object=_e,this.update(),this}copy(_e,at){return super.copy(_e,at),this.object=_e.object,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class gS extends _c{constructor(_e,at=16776960){const pt=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),mt=new _s;mt.setIndex(new mr(pt,1)),mt.setAttribute("position",new Ln([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),super(mt,new Lo({color:at,toneMapped:!1})),this.box=_e,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(_e){const at=this.box;at.isEmpty()||(at.getCenter(this.position),at.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(_e))}dispose(){this.geometry.dispose(),this.material.dispose()}}class _S extends Yu{constructor(_e,at=1,pt=16776960){const mt=pt,vt=new _s;vt.setAttribute("position",new Ln([1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],3)),vt.computeBoundingSphere(),super(vt,new Lo({color:mt,toneMapped:!1})),this.type="PlaneHelper",this.plane=_e,this.size=at;const Ct=new _s;Ct.setAttribute("position",new Ln([1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],3)),Ct.computeBoundingSphere(),this.add(new lo(Ct,new Zl({color:mt,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(_e){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),super.updateMatrixWorld(_e)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}}const iw=new Er;let m0,Ty;class fS extends Ss{constructor(_e=new Er(0,0,1),at=new Er(0,0,0),pt=1,mt=16776960,vt=.2*pt,Ct=.2*vt){super(),this.type="ArrowHelper",m0===void 0&&(m0=new _s,m0.setAttribute("position",new Ln([0,0,0,0,1,0],3)),Ty=new Im(0,.5,1,5,1),Ty.translate(0,-.5,0)),this.position.copy(at),this.line=new Yu(m0,new Lo({color:mt,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new lo(Ty,new Zl({color:mt,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(_e),this.setLength(pt,vt,Ct)}setDirection(_e){if(_e.y>.99999)this.quaternion.set(0,0,0,1);else if(_e.y<-.99999)this.quaternion.set(1,0,0,0);else{iw.set(_e.z,0,-_e.x).normalize();const at=Math.acos(_e.y);this.quaternion.setFromAxisAngle(iw,at)}}setLength(_e,at=.2*_e,pt=.2*at){this.line.scale.set(1,Math.max(1e-4,_e-at),1),this.line.updateMatrix(),this.cone.scale.set(pt,at,pt),this.cone.position.y=_e,this.cone.updateMatrix()}setColor(_e){this.line.material.color.set(_e),this.cone.material.color.set(_e)}copy(_e){return super.copy(_e,!1),this.line.copy(_e.line),this.cone.copy(_e.cone),this}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),this.cone.geometry.dispose(),this.cone.material.dispose()}}class vS extends _c{constructor(_e=1){const at=[0,0,0,_e,0,0,0,0,0,0,_e,0,0,0,0,0,0,_e],pt=new _s;pt.setAttribute("position",new Ln(at,3)),pt.setAttribute("color",new Ln([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3)),super(pt,new Lo({vertexColors:!0,toneMapped:!1})),this.type="AxesHelper"}setColors(_e,at,pt){const mt=new Un,vt=this.geometry.attributes.color.array;return mt.set(_e),mt.toArray(vt,0),mt.toArray(vt,3),mt.set(at),mt.toArray(vt,6),mt.toArray(vt,9),mt.set(pt),mt.toArray(vt,12),mt.toArray(vt,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class yS{constructor(){this.type="ShapePath",this.color=new Un,this.subPaths=[],this.currentPath=null}moveTo(_e,at){return this.currentPath=new S_,this.subPaths.push(this.currentPath),this.currentPath.moveTo(_e,at),this}lineTo(_e,at){return this.currentPath.lineTo(_e,at),this}quadraticCurveTo(_e,at,pt,mt){return this.currentPath.quadraticCurveTo(_e,at,pt,mt),this}bezierCurveTo(_e,at,pt,mt,vt,Ct){return this.currentPath.bezierCurveTo(_e,at,pt,mt,vt,Ct),this}splineThru(_e){return this.currentPath.splineThru(_e),this}toShapes(_e){function at(Xt,sr){const Zt=sr.length;let er=!1;for(let xr=Zt-1,Ar=0;Ar<Zt;xr=Ar++){let yr=sr[xr],Tr=sr[Ar],Hr=Tr.x-yr.x,Nr=Tr.y-yr.y;if(Math.abs(Nr)>Number.EPSILON){if(Nr<0&&(yr=sr[Ar],Hr=-Hr,Tr=sr[xr],Nr=-Nr),Xt.y<yr.y||Xt.y>Tr.y)continue;if(Xt.y===yr.y){if(Xt.x===yr.x)return!0}else{const zr=Nr*(Xt.x-yr.x)-Hr*(Xt.y-yr.y);if(zr===0)return!0;if(zr<0)continue;er=!er}}else{if(Xt.y!==yr.y)continue;if(Tr.x<=Xt.x&&Xt.x<=yr.x||yr.x<=Xt.x&&Xt.x<=Tr.x)return!0}}return er}const pt=eu.isClockWise,mt=this.subPaths;if(mt.length===0)return[];let vt,Ct,Tt;const Bt=[];if(mt.length===1)return Ct=mt[0],Tt=new Cp,Tt.curves=Ct.curves,Bt.push(Tt),Bt;let Lt=!pt(mt[0].getPoints());Lt=_e?!Lt:Lt;const Ut=[],Qt=[];let Ht,Wt,qt=[],Jt=0;Qt[Jt]=void 0,qt[Jt]=[];for(let Xt=0,sr=mt.length;Xt<sr;Xt++)Ct=mt[Xt],Ht=Ct.getPoints(),vt=pt(Ht),vt=_e?!vt:vt,vt?(!Lt&&Qt[Jt]&&Jt++,Qt[Jt]={s:new Cp,p:Ht},Qt[Jt].s.curves=Ct.curves,Lt&&Jt++,qt[Jt]=[]):qt[Jt].push({h:Ct,p:Ht[0]});if(!Qt[0])return function(Xt){const sr=[];for(let Zt=0,er=Xt.length;Zt<er;Zt++){const xr=Xt[Zt],Ar=new Cp;Ar.curves=xr.curves,sr.push(Ar)}return sr}(mt);if(Qt.length>1){let Xt=!1,sr=0;for(let Zt=0,er=Qt.length;Zt<er;Zt++)Ut[Zt]=[];for(let Zt=0,er=Qt.length;Zt<er;Zt++){const xr=qt[Zt];for(let Ar=0;Ar<xr.length;Ar++){const yr=xr[Ar];let Tr=!0;for(let Hr=0;Hr<Qt.length;Hr++)at(yr.p,Qt[Hr].p)&&(Zt!==Hr&&sr++,Tr?(Tr=!1,Ut[Hr].push(yr)):Xt=!0);Tr&&Ut[Zt].push(yr)}}sr>0&&Xt===!1&&(qt=Ut)}for(let Xt=0,sr=Qt.length;Xt<sr;Xt++){Tt=Qt[Xt].s,Bt.push(Tt),Wt=qt[Xt];for(let Zt=0,er=Wt.length;Zt<er;Zt++)Tt.holes.push(Wt[Zt].h)}return Bt}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:d}})),typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=d)},149:function(h,o,c){c.d(o,{Z:function(){return v}});var d=c(848);const _=new WeakMap;class v extends d.aHM{constructor(it){super(it),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(it){return this.decoderPath=it,this}setDecoderConfig(it){return this.decoderConfig=it,this}setWorkerLimit(it){return this.workerLimit=it,this}load(it,nt,lt,ut){const ht=new d.Y9S(this.manager);ht.setPath(this.path),ht.setResponseType("arraybuffer"),ht.setRequestHeader(this.requestHeader),ht.setWithCredentials(this.withCredentials),ht.load(it,_t=>{this.parse(_t,nt,ut)},lt,ut)}parse(it,nt,lt){this.decodeDracoFile(it,nt,null,null,d.er$).catch(lt)}decodeDracoFile(it,nt,lt,ut,ht=d.Zr2){const _t={attributeIDs:lt||this.defaultAttributeIDs,attributeTypes:ut||this.defaultAttributeTypes,useUniqueIDs:!!lt,vertexColorSpace:ht};return this.decodeGeometry(it,_t).then(nt)}decodeGeometry(it,nt){const lt=JSON.stringify(nt);if(_.has(it)){const bt=_.get(it);if(bt.key===lt)return bt.promise;if(it.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let ut;const ht=this.workerNextTaskID++,_t=it.byteLength,ft=this._getWorker(ht,_t).then(bt=>(ut=bt,new Promise((xt,St)=>{ut._callbacks[ht]={resolve:xt,reject:St},ut.postMessage({type:"decode",id:ht,taskConfig:nt,buffer:it},[it])}))).then(bt=>this._createGeometry(bt.geometry));return ft.catch(()=>!0).then(()=>{ut&&ht&&this._releaseTask(ut,ht)}),_.set(it,{key:lt,promise:ft}),ft}_createGeometry(it){const nt=new d.LoY;it.index&&nt.setIndex(new d.THS(it.index.array,1));for(let lt=0;lt<it.attributes.length;lt++){const ut=it.attributes[lt],ht=ut.name,_t=ut.array,ft=ut.itemSize,bt=new d.THS(_t,ft);ht==="color"&&(this._assignVertexColorSpace(bt,ut.vertexColorSpace),bt.normalized=_t instanceof Float32Array==0),nt.setAttribute(ht,bt)}return nt}_assignVertexColorSpace(it,nt){if(nt!==d.er$)return;const lt=new d.Q1f;for(let ut=0,ht=it.count;ut<ht;ut++)lt.fromBufferAttribute(it,ut).convertSRGBToLinear(),it.setXYZ(ut,lt.r,lt.g,lt.b)}_loadLibrary(it,nt){const lt=new d.Y9S(this.manager);return lt.setPath(this.decoderPath),lt.setResponseType(nt),lt.setWithCredentials(this.withCredentials),new Promise((ut,ht)=>{lt.load(it,ut,void 0,ht)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const it=typeof WebAssembly!="object"||this.decoderConfig.type==="js",nt=[];return it?nt.push(this._loadLibrary("draco_decoder.js","text")):(nt.push(this._loadLibrary("draco_wasm_wrapper.js","text")),nt.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(nt).then(lt=>{const ut=lt[0];it||(this.decoderConfig.wasmBinary=lt[1]);const ht=b,_t=["/* draco decoder */",ut,"","/* worker */",ht.substring(ht.indexOf("{")+1,ht.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([_t]))}),this.decoderPending}_getWorker(it,nt){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const ut=new Worker(this.workerSourceURL);ut._callbacks={},ut._taskCosts={},ut._taskLoad=0,ut.postMessage({type:"init",decoderConfig:this.decoderConfig}),ut.onmessage=function(ht){const _t=ht.data;switch(_t.type){case"decode":ut._callbacks[_t.id].resolve(_t);break;case"error":ut._callbacks[_t.id].reject(_t);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+_t.type+'"')}},this.workerPool.push(ut)}else this.workerPool.sort(function(ut,ht){return ut._taskLoad>ht._taskLoad?-1:1});const lt=this.workerPool[this.workerPool.length-1];return lt._taskCosts[it]=nt,lt._taskLoad+=nt,lt})}_releaseTask(it,nt){it._taskLoad-=it._taskCosts[nt],delete it._callbacks[nt],delete it._taskCosts[nt]}debug(){console.log("Task load: ",this.workerPool.map(it=>it._taskLoad))}dispose(){for(let it=0;it<this.workerPool.length;++it)this.workerPool[it].terminate();return this.workerPool.length=0,this.workerSourceURL!==""&&URL.revokeObjectURL(this.workerSourceURL),this}}const b=`
function DRACOWorker() {

	let decoderConfig;
	let decoderPending;

	onmessage = function ( e ) {

		const message = e.data;

		switch ( message.type ) {

			case 'init':
				decoderConfig = message.decoderConfig;
				decoderPending = new Promise( function ( resolve/*, reject*/ ) {

					decoderConfig.onModuleLoaded = function ( draco ) {

						// Module is Promise-like. Wrap before resolving to avoid loop.
						resolve( { draco: draco } );

					};

					DracoDecoderModule( decoderConfig ); // eslint-disable-line no-undef

				} );
				break;

			case 'decode':
				const buffer = message.buffer;
				const taskConfig = message.taskConfig;
				decoderPending.then( ( module ) => {

					const draco = module.draco;
					const decoder = new draco.Decoder();

					try {

						const geometry = decodeGeometry( draco, decoder, new Int8Array( buffer ), taskConfig );

						const buffers = geometry.attributes.map( ( attr ) => attr.array.buffer );

						if ( geometry.index ) buffers.push( geometry.index.array.buffer );

						self.postMessage( { type: 'decode', id: message.id, geometry }, buffers );

					} catch ( error ) {

						console.error( error );

						self.postMessage( { type: 'error', id: message.id, error: error.message } );

					} finally {

						draco.destroy( decoder );

					}

				} );
				break;

		}

	};

	function decodeGeometry( draco, decoder, array, taskConfig ) {

		const attributeIDs = taskConfig.attributeIDs;
		const attributeTypes = taskConfig.attributeTypes;

		let dracoGeometry;
		let decodingStatus;

		const geometryType = decoder.GetEncodedGeometryType( array );

		if ( geometryType === draco.TRIANGULAR_MESH ) {

			dracoGeometry = new draco.Mesh();
			decodingStatus = decoder.DecodeArrayToMesh( array, array.byteLength, dracoGeometry );

		} else if ( geometryType === draco.POINT_CLOUD ) {

			dracoGeometry = new draco.PointCloud();
			decodingStatus = decoder.DecodeArrayToPointCloud( array, array.byteLength, dracoGeometry );

		} else {

			throw new Error( 'THREE.DRACOLoader: Unexpected geometry type.' );

		}

		if ( ! decodingStatus.ok() || dracoGeometry.ptr === 0 ) {

			throw new Error( 'THREE.DRACOLoader: Decoding failed: ' + decodingStatus.error_msg() );

		}

		const geometry = { index: null, attributes: [] };

		// Gather all vertex attributes.
		for ( const attributeName in attributeIDs ) {

			const attributeType = self[ attributeTypes[ attributeName ] ];

			let attribute;
			let attributeID;

			// A Draco file may be created with default vertex attributes, whose attribute IDs
			// are mapped 1:1 from their semantic name (POSITION, NORMAL, ...). Alternatively,
			// a Draco file may contain a custom set of attributes, identified by known unique
			// IDs. glTF files always do the latter, and .drc files typically do the former.
			if ( taskConfig.useUniqueIDs ) {

				attributeID = attributeIDs[ attributeName ];
				attribute = decoder.GetAttributeByUniqueId( dracoGeometry, attributeID );

			} else {

				attributeID = decoder.GetAttributeId( dracoGeometry, draco[ attributeIDs[ attributeName ] ] );

				if ( attributeID === - 1 ) continue;

				attribute = decoder.GetAttribute( dracoGeometry, attributeID );

			}

			const attributeResult = decodeAttribute( draco, decoder, dracoGeometry, attributeName, attributeType, attribute );

			if ( attributeName === 'color' ) {

				attributeResult.vertexColorSpace = taskConfig.vertexColorSpace;

			}

			geometry.attributes.push( attributeResult );

		}

		// Add index.
		if ( geometryType === draco.TRIANGULAR_MESH ) {

			geometry.index = decodeIndex( draco, decoder, dracoGeometry );

		}

		draco.destroy( dracoGeometry );

		return geometry;

	}

	function decodeIndex( draco, decoder, dracoGeometry ) {

		const numFaces = dracoGeometry.num_faces();
		const numIndices = numFaces * 3;
		const byteLength = numIndices * 4;

		const ptr = draco._malloc( byteLength );
		decoder.GetTrianglesUInt32Array( dracoGeometry, byteLength, ptr );
		const index = new Uint32Array( draco.HEAPF32.buffer, ptr, numIndices ).slice();
		draco._free( ptr );

		return { array: index, itemSize: 1 };

	}

	function decodeAttribute( draco, decoder, dracoGeometry, attributeName, attributeType, attribute ) {

		const numComponents = attribute.num_components();
		const numPoints = dracoGeometry.num_points();
		const numValues = numPoints * numComponents;
		const byteLength = numValues * attributeType.BYTES_PER_ELEMENT;
		const dataType = getDracoDataType( draco, attributeType );

		const ptr = draco._malloc( byteLength );
		decoder.GetAttributeDataArrayForAllPoints( dracoGeometry, attribute, dataType, byteLength, ptr );
		const array = new attributeType( draco.HEAPF32.buffer, ptr, numValues ).slice();
		draco._free( ptr );

		return {
			name: attributeName,
			array: array,
			itemSize: numComponents
		};

	}

	function getDracoDataType( draco, attributeType ) {

		switch ( attributeType ) {

			case Float32Array: return draco.DT_FLOAT32;
			case Int8Array: return draco.DT_INT8;
			case Int16Array: return draco.DT_INT16;
			case Int32Array: return draco.DT_INT32;
			case Uint8Array: return draco.DT_UINT8;
			case Uint16Array: return draco.DT_UINT16;
			case Uint32Array: return draco.DT_UINT32;

		}

	}

}
`}},__webpackgi_module_cache__={},leafPrototypes,getProto,inProgress,dataWebpackPrefix;function __webpackgi_require__(h){var o=__webpackgi_module_cache__[h];if(o!==void 0)return o.exports;var c=__webpackgi_module_cache__[h]={id:h,exports:{}};return __webpackgi_modules__[h].call(c.exports,c,c.exports,__webpackgi_require__),c.exports}__webpackgi_require__.m=__webpackgi_modules__,__webpackgi_require__.n=function(h){var o=h&&h.__esModule?function(){return h.default}:function(){return h};return __webpackgi_require__.d(o,{a:o}),o},getProto=Object.getPrototypeOf?function(h){return Object.getPrototypeOf(h)}:function(h){return h.__proto__},__webpackgi_require__.t=function(h,o){if(1&o&&(h=this(h)),8&o||typeof h=="object"&&h&&(4&o&&h.__esModule||16&o&&typeof h.then=="function"))return h;var c=Object.create(null);__webpackgi_require__.r(c);var d={};leafPrototypes=leafPrototypes||[null,getProto({}),getProto([]),getProto(getProto)];for(var _=2&o&&h;typeof _=="object"&&!~leafPrototypes.indexOf(_);_=getProto(_))Object.getOwnPropertyNames(_).forEach(function(v){d[v]=function(){return h[v]}});return d.default=function(){return h},__webpackgi_require__.d(c,d),c},__webpackgi_require__.d=function(h,o){for(var c in o)__webpackgi_require__.o(o,c)&&!__webpackgi_require__.o(h,c)&&Object.defineProperty(h,c,{enumerable:!0,get:o[c]})},__webpackgi_require__.f={},__webpackgi_require__.e=function(h){return Promise.all(Object.keys(__webpackgi_require__.f).reduce(function(o,c){return __webpackgi_require__.f[c](h,o),o},[]))},__webpackgi_require__.u=function(h){return h+".mjs"},__webpackgi_require__.o=function(h,o){return Object.prototype.hasOwnProperty.call(h,o)},inProgress={},dataWebpackPrefix="webgi:",__webpackgi_require__.l=function(h,o,c,d){if(inProgress[h])inProgress[h].push(o);else{var _,v;if(c!==void 0)for(var b=document.getElementsByTagName("script"),tt=0;tt<b.length;tt++){var it=b[tt];if(it.getAttribute("src")==h||it.getAttribute("data-webpack")==dataWebpackPrefix+c){_=it;break}}_||(v=!0,(_=document.createElement("script")).type="module",_.charset="utf-8",_.timeout=120,__webpackgi_require__.nc&&_.setAttribute("nonce",__webpackgi_require__.nc),_.setAttribute("data-webpack",dataWebpackPrefix+c),_.src=h),inProgress[h]=[o];var nt=function(ut,ht){_.onerror=_.onload=null,clearTimeout(lt);var _t=inProgress[h];if(delete inProgress[h],_.parentNode&&_.parentNode.removeChild(_),_t&&_t.forEach(function(ft){return ft(ht)}),ut)return ut(ht)},lt=setTimeout(nt.bind(null,void 0,{type:"timeout",target:_}),12e4);_.onerror=nt.bind(null,_.onerror),_.onload=nt.bind(null,_.onload),v&&document.head.appendChild(_)}},__webpackgi_require__.r=function(h){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(h,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(h,"__esModule",{value:!0})},function(){var h;if(typeof import.meta.url=="string"&&(h=import.meta.url),!h)throw new Error("Automatic publicPath is not supported in this browser");h=h.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),__webpackgi_require__.p=h+"../../"}(),function(){var h={573:0};__webpackgi_require__.f.j=function(d,_){var v=__webpackgi_require__.o(h,d)?h[d]:void 0;if(v!==0)if(v)_.push(v[2]);else{var b=new Promise(function(nt,lt){v=h[d]=[nt,lt]});_.push(v[2]=b);var tt=__webpackgi_require__.p+__webpackgi_require__.u(d),it=new Error;__webpackgi_require__.l(tt,function(nt){if(__webpackgi_require__.o(h,d)&&((v=h[d])!==0&&(h[d]=void 0),v)){var lt=nt&&(nt.type==="load"?"missing":nt.type),ut=nt&&nt.target&&nt.target.src;it.message="Loading chunk "+d+` failed.
(`+lt+": "+ut+")",it.name="ChunkLoadError",it.type=lt,it.request=ut,v[1](it)}},"chunk-"+d,d)}};var o=function(d,_){var v,b,tt=_[0],it=_[1],nt=_[2],lt=0;if(tt.some(function(ut){return h[ut]!==0})){for(v in it)__webpackgi_require__.o(it,v)&&(__webpackgi_require__.m[v]=it[v]);nt&&nt(__webpackgi_require__)}for(d&&d(_);lt<tt.length;lt++)b=tt[lt],__webpackgi_require__.o(h,b)&&h[b]&&h[b][0](),h[b]=0},c=self.webpackChunkwebgi=self.webpackChunkwebgi||[];c.forEach(o.bind(null,0)),c.push=o.bind(null,c.push.bind(c))}(),__webpackgi_require__.nc=void 0;var __webpackgi_exports__={},ViewerState;__webpackgi_require__.d(__webpackgi_exports__,{CZu:function(){return AAssetManagerProcessStatePlugin},FV:function(){return three_module.FV},oK2:function(){return ACameraControlsPlugin},SLH:function(){return ACanvasRecorder},yo9:function(){return ALL_WEBGI_EXTENSIONS},YJd:function(){return AMaterialManager},qnC:function(){return ARPlacementBox},TtJ:function(){return ARPlugin},rUH:function(){return ARTouchInputHelper},oAs:function(){return AShaderMaterial2},$fV:function(){return AViewerPlugin},upe:function(){return AWSClientPlugin},yPJ:function(){return AddBlendPass},gO9:function(){return three_module.gO9},XrR:function(){return three_module.XrR},DAe:function(){return three_module.DAe},EZo:function(){return three_module.EZo},wrO:function(){return three_module.wrO},FFZ:function(){return three_module.FFZ},lGu:function(){return three_module.lGu},sKt:function(){return three_module.sKt},$p8:function(){return three_module.$p8},nJr:function(){return AmbientLight2},pPE:function(){return three_module.pPE},tz3:function(){return three_module.tz3},kEx:function(){return three_module.kEx},Iw4:function(){return three_module.Iw4},P5j:function(){return three_module.P5j},AKb:function(){return three_module.AKb},GXy:function(){return AnisotropyPlugin},ibB:function(){return three_module.ibB},nZQ:function(){return three_module.nZQ},E0M:function(){return three_module.E0M},GLG:function(){return AssetExporter},$VP:function(){return AssetExporterPlugin},NeI:function(){return AssetImporter},rzc:function(){return AssetManagerBasicPopupPlugin},Kiu:function(){return AssetManagerLoadingBarPlugin},XDT:function(){return AssetManagerPlugin},XiN:function(){return AsyncGzip},_I9:function(){return AsyncDecompress},ShE:function(){return AsyncDeflate},OXP:function(){return AsyncGunzip},JZ8:function(){return AsyncGzip},gS4:function(){return AsyncInflate},eFx:function(){return AsyncUnzipInflate},peq:function(){return AsyncUnzlib},hw0:function(){return AsyncZipDeflate},_DG:function(){return AsyncZlib},fP5:function(){return three_module.fP5},CwR:function(){return three_module.CwR},UtX:function(){return three_module.UtX},Pf$:function(){return three_module.Pf$},Am1:function(){return three_module.Am1},IzY:function(){return three_module.IzY},hsX:function(){return three_module.hsX},XFr:function(){return BackgroundPresetGroup},Eh1:function(){return BaseGroundPlugin},RJS:function(){return BaseRenderer},Rkk:function(){return three_module.Rkk},bTm:function(){return three_module.bTm},Otl:function(){return BeringRingAnimation},pOj:function(){return BlobLoader},jg0:function(){return BloomPlugin},$Kf:function(){return three_module.$Kf},YOZ:function(){return three_module.YOZ},UtB:function(){return three_module.UtB},NRn:function(){return three_module.NRn},DYt:function(){return Box3B},BND:function(){return three_module.BND},iNn:function(){return three_module.iNn},IWo:function(){return three_module.IWo},SYd:function(){return BoxSelectionWidget},THS:function(){return three_module.THS},LoY:function(){return three_module.LoY},SUR:function(){return three_module.SUR},tJf:function(){return three_module.tJf},Y3u:function(){return CSGPluginBSP},poD:function(){return CSGPluginBVH},gaG:function(){return CSGPluginBase},z0x:function(){return CSS3DRendererPlugin},l2R:function(){return three_module.l2R},i7d:function(){return three_module.i7d},mL7:function(){return CameraController},WTh:function(){return three_module.WTh},l5h:function(){return CameraUiPlugin},hzv:function(){return CameraView},f_U:function(){return CameraViewControlPlugin},sxt:function(){return CameraViewPlugin},af0:function(){return CannonPhysicsPlugin},Phj:function(){return CanvasMediaRecorder},p5D:function(){return CanvasRecorder},CS6:function(){return CanvasRecorderPlugin},aKT:function(){return CanvasSnipper},RzO:function(){return CanvasSnipperPlugin},GOR:function(){return three_module.GOR},qU7:function(){return three_module.qU7},B6O:function(){return three_module.B6O},z1d:function(){return ChromaticAberrationPlugin},nNL:function(){return three_module.nNL},tcD:function(){return three_module.tcD},ghU:function(){return three_module.ghU},Dk8:function(){return ClearcoatTintPlugin},zD7:function(){return three_module.zD7},Q1f:function(){return three_module.Q1f},T6I:function(){return three_module.T6I},ppV:function(){return three_module.ppV},FvD:function(){return CombinedPostPlugin},n3b:function(){return Gzip},iOZ:function(){return three_module.iOZ},c5h:function(){return three_module.c5h},YSM:function(){return three_module.FvD},YRT:function(){return three_module.YRT},qFE:function(){return three_module.qFE},fCM:function(){return ContactShadowGroundPlugin},afc:function(){return CoreEditorApp},hLJ:function(){return CoreViewerApp},F1T:function(){return three_module.F1T},SXA:function(){return CubeNormalsCaptureHelper},hy7:function(){return three_module.hy7},xFO:function(){return three_module.xFO},b4q:function(){return three_module.b4q},ScU:function(){return three_module.ScU},Om:function(){return three_module.Om},Z0B:function(){return three_module.Z0B},s0K:function(){return three_module.s0K},Pdi:function(){return three_module.Pdi},Vb5:function(){return three_module.Vb5},Jnc:function(){return three_module.Jnc},ywQ:function(){return three_module.ywQ},WNZ:function(){return three_module.WNZ},Ipv:function(){return three_module.Ipv},jGm:function(){return three_module.jGm},Ogy:function(){return CustomAnimationHelper},xLk:function(){return CustomAnimationHelperPlugin},bCz:function(){return three_module.bCz},bGG:function(){return CustomBumpMapPlugin},g7M:function(){return three_module.g7M},Ho_:function(){return three_module.Ho_},hjs:function(){return three_module.hjs},Zn9:function(){return DRACOLoader2.Z},AHf:function(){return k$1},dYF:function(){return three_module.dYF},rFo:function(){return three_module.rFo},GYF:function(){return three_module.GYF},BRH:function(){return three_module.BRH},psi:function(){return DataUrlLoader},GxU:function(){return three_module.GxU},n2t:function(){return DebugPlugin},yuL:function(){return DecodeUTF8},YMq:function(){return Decompress},ROr:function(){return three_module.ROr},fJr:function(){return three_module.fJr},h_9:function(){return three_module.h_9},Gyi:function(){return Deflate},zdS:function(){return three_module.zdS},WCV:function(){return DepthOfFieldPass},_Vf:function(){return DepthOfFieldPlugin},dcC:function(){return three_module.dcC},VCu:function(){return three_module.VCu},n1S:function(){return DeviceOrientationControls2},sOF:function(){return DeviceOrientationControlsPlugin},aFP:function(){return DiamondMaterial},GMU:function(){return DiamondPlugin},ZyN:function(){return three_module.ZyN},rFg:function(){return DirectionalLight2},PFK:function(){return three_module.PFK},Yhb:function(){return three_module.Yhb},V5c:function(){return three_module.V5c},nEu:function(){return three_module.nEu},$EB:function(){return three_module.$EB},mRE:function(){return Dropzone},hSt:function(){return DropzonePlugin},hdd:function(){return three_module.hdd},wn6:function(){return three_module.wn6},MOq:function(){return three_module.MOq},Vnu:function(){return three_module.Vnu},hIf:function(){return three_module.hIf},d5G:function(){return EXRExporter2},vr8:function(){return EXRLoadPlugin},JCs:function(){return EasingFunctions},TDQ:function(){return three_module.TDQ},WYq:function(){return EffectComposer2},S20:function(){return three_module.S20},LWT:function(){return EllipseCurve3D},MJ1:function(){return EncodeUTF8},KDW:function(){return EncoderMethod},SQT:function(){return EnvironmentPresetGroup},kO0:function(){return three_module.kO0},U3G:function(){return three_module.U3G},jsO:function(){return three_module.jsO},wfO:function(){return three_module.wfO},uV5:function(){return three_module.uV5},O9p:function(){return three_module.O9p},Qev:function(){return three_module.Qev},j8I:function(){return ExtrasUiPlugin},QCA:function(){return three_module.QCA},ol2:function(){return FBXLoadPlugin},y74:function(){return FFMPEGRecorder},lT0:function(){return FSShadowMaterial},Y9S:function(){return three_module.Y9S},ryq:function(){return FileTransferPlugin},xcV:function(){return FilmicGrainPlugin},OMG:function(){return FirstPersonControls2},Vkg:function(){return FirstPersonControlsPlugin},Oax:function(){return three_module.Oax},qtW:function(){return three_module.qtW},V58:function(){return three_module.V58},RQf:function(){return three_module.RQf},jUj:function(){return three_module.jUj},cRK:function(){return three_module.cRK},ziY:function(){return FragmentClippingExtensionPlugin},kzd:function(){return FragmentClippingMode},VNy:function(){return FrameFadePlugin},Pem:function(){return three_module.Pem},hB5:function(){return three_module.hB5},PPD:function(){return three_module.PPD},BH6:function(){return FullScreenPlugin},HSI:function(){return GBufferPlugin},oh6:function(){return three_module.oh6},Wyr:function(){return three_module.Wyr},Wdf:function(){return three_module.Wdf},P3V:function(){return GLTFAnimationPlugin},s0N:function(){return GLTFDracoExportPlugin},_Js:function(){return GLTFDracoExporter},xQA:function(){return GLTFExporter2},Yeh:function(){return GLTFExporterMaterialsVariantsExtensionExport},N30:function(){return GLTFKHRMaterialVariantsPlugin},P44:function(){return GLTFLoader2},MdZ:function(){return GLTFMaterialsVariantsExtensionImport},Cc9:function(){return GLTFMeshGpuInstancingExporter},HjZ:function(){return GLTFMeshOptPlugin},UX5:function(){return GLTFSpecGlossinessConverterPlugin},fGP:function(){return GLTFWriter2},T03:function(){return GammaCorrectionExtension},fPK:function(){return GammaCorrectionPlugin},XpU:function(){return GemEnvironmentPresetGroup},hUz:function(){return GenericBlendTexturePass},pbu:function(){return GenericFilterPlugin},jhn:function(){return GeometryGeneratorPlugin},eoi:function(){return three_module.eoi},K52:function(){return three_module.K52},gWB:function(){return three_module.gWB},Gwm:function(){return three_module.Gwm},TMh:function(){return three_module.TMh},RcT:function(){return three_module.RcT},fTw:function(){return three_module.fTw},Hx_:function(){return GroundPlugin},YJl:function(){return three_module.YJl},asK:function(){return Gunzip},_qo:function(){return GyroInputDevice},Ne:function(){return Gzip},Guc:function(){return HDRiGroundPlugin},ix0:function(){return three_module.ix0},dth:function(){return three_module.dth},R1W:function(){return three_module.R1W},tcR:function(){return HierarchyUiPlugin},WBB:function(){return three_module.WBB},Kzg:function(){return three_module.Kzg},$NF:function(){return three_module.$NF},NuM:function(){return ImageSequenceRecorder},HgN:function(){return three_module.HgN},l9C:function(){return Importer},HLH:function(){return three_module.HLH},Ru$:function(){return three_module.Ru$},ELl:function(){return Inflate},uWO:function(){return three_module.uWO},CmU:function(){return three_module.CmU},LuO:function(){return three_module.LuO},ZLX:function(){return three_module.ZLX},Hrb:function(){return three_module.Hrb},vmz:function(){return three_module.vmz},wvS:function(){return three_module.wvS},Yuy:function(){return three_module.Yuy},K5h:function(){return InteractionPromptPlugin},eB$:function(){return three_module.eB$},eHs:function(){return three_module.eHs},lGw:function(){return three_module.lGw},ljd:function(){return three_module.ljd},PJ3:function(){return three_module.PJ3},EQC:function(){return three_module.EQC},oVO:function(){return three_module.oVO},Yj4:function(){return KHR_TEXTURE_BASISU},ZPL:function(){return KTX2LoadPlugin},$16:function(){return KTXLoadPlugin},VVr:function(){return three_module.VVr},UJ6:function(){return three_module.UJ6},UpK:function(){return three_module.UpK},ZYb:function(){return LUTPlugin},nzx:function(){return three_module.nzx},DLJ:function(){return LayeredMaterialPlugin},zgK:function(){return three_module.zgK},vim:function(){return three_module.vim},brA:function(){return three_module.brA},TiK:function(){return three_module.TiK},xSv:function(){return three_module.xSv},CR7:function(){return three_module.CR7},kYr:function(){return three_module.kYr},veJ:function(){return three_module.veJ},FZo:function(){return three_module.FZo},Dvx:function(){return LightsUiPlugin},N1A:function(){return three_module.N1A},XkL:function(){return Line2},cZY:function(){return three_module.cZY},mrM:function(){return three_module.mrM},GZZ:function(){return three_module.GZZ},VnP:function(){return three_module.VnP},Fvt:function(){return three_module.Fvt},vK6:function(){return LineGeometry},FCc:function(){return three_module.FCc},GV4:function(){return LineMaterial},DXC:function(){return three_module.DXC},bFd:function(){return LineSegments2},n31:function(){return LineSegmentsGeometry},qIQ:function(){return three_module.qIQ},tgE:function(){return three_module.tgE},k6q:function(){return three_module.k6q},ezk:function(){return three_module.ezk},NZq:function(){return three_module.NZq},iUH:function(){return three_module.iUH},$_I:function(){return three_module.$_I},kRr:function(){return three_module.kRr},Zr2:function(){return three_module.Zr2},kyO:function(){return three_module.kyO},VxR:function(){return three_module.VxR},aHM:function(){return three_module.aHM},r6x:function(){return three_module.r6x},KPJ:function(){return three_module.KPJ},O0Q:function(){return LoadingScreenPlugin},G3T:function(){return three_module.G3T},lc7:function(){return three_module.lc7},aMy:function(){return three_module.aMy},CMB:function(){return three_module.CMB},Kzv:function(){return three_module.Kzv},kBv:function(){return three_module.kBv},T6P:function(){return MTLLoader2},imn:function(){return three_module.imn},Bhh:function(){return MaterialConfiguratorBasePlugin},q$N:function(){return MaterialConfiguratorPlugin},pzC:function(){return MaterialExtender},xbg:function(){return MaterialLibPresetGroupPresetGroup},LTv:function(){return MaterialLibraryBasePlugin},usO:function(){return MaterialLibraryPlugin},jut:function(){return three_module.jut},Jxy:function(){return MaterialManager},Kmw:function(){return MaterialPresetPlugin$1},jR8:function(){return MaterialPreviewGenerator},cj9:function(){return three_module.cj9},dwI:function(){return three_module.dwI},kn4:function(){return three_module.kn4},$ei:function(){return three_module.$ei},eaF:function(){return three_module.eaF},V9B:function(){return three_module.V9B},NLY:function(){return MeshBasicMaterial2},CSG:function(){return three_module.CSG},aVO:function(){return three_module.aVO},G_z:function(){return three_module.G_z},FNr:function(){return three_module.FNr},qBx:function(){return three_module.qBx},onB:function(){return MeshOptSimplifyModifierPlugin},tXL:function(){return three_module.tXL},uSd:function(){return three_module.uSd},_4j:function(){return three_module._4j},gCR:function(){return MeshStandardMaterial2},Df:function(){return three_module.Df},znC:function(){return three_module.znC},kTW:function(){return three_module.kTW},KRh:function(){return three_module.KRh},$iG:function(){return ModelStagePlugin},eti:function(){return ModelStagePresetGroup},Um5:function(){return MouseInputDevice},tF0:function(){return MultiFilterPlugin},EdD:function(){return three_module.EdD},caT:function(){return three_module.caT},hxR:function(){return three_module.hxR},a$r:function(){return three_module.a$r},$O9:function(){return three_module.$O9},Cfg:function(){return three_module.Cfg},pHI:function(){return three_module.pHI},amv:function(){return three_module.amv},eHc:function(){return three_module.eHc},HPb:function(){return three_module.HPb},XIg:function(){return three_module.XIg},jf0:function(){return three_module.jf0},y_p:function(){return three_module.y_p},dFv:function(){return NoiseBumpMaterialPlugin},Ke9:function(){return three_module.Ke9},NTi:function(){return three_module.NTi},nqf:function(){return NormalBufferPlugin},hws:function(){return NormalCaptureMaterial},jzd:function(){return three_module.jzd},bw0:function(){return three_module.bw0},klZ:function(){return three_module.klZ},Hit:function(){return three_module.Hit},DJz:function(){return OBJLoader2},UwE:function(){return ObjMtlLoadPlugin},B69:function(){return three_module.B69},QA8:function(){return Object3DModel},$xz:function(){return Object3DWidgetsPlugin},XTe:function(){return three_module.XTe},zjB:function(){return ObjectLoader2},sHL:function(){return ObjectPicker},Upe:function(){return ObjectProcessorMap},nEH:function(){return ObjectRotationPlugin},vyJ:function(){return three_module.vyJ},Ufg:function(){return three_module.Ufg},qad:function(){return three_module.qad},Nt7:function(){return three_module.Nt7},aEY:function(){return three_module.aEY},OuU:function(){return three_module.OuU},LiQ:function(){return three_module.LiQ},xYO:function(){return OrbitControls2},c07:function(){return OrbitControls3},qUd:function(){return three_module.qUd},I_i:function(){return OutlinePlugin},wqq:function(){return three_module.wqq},QP0:function(){return three_module.QP0},Wk7:function(){return three_module.Wk7},BdL:function(){return three_module.BdL},Q7O:function(){return PMREMGeneratorPlugin},uxM:function(){return ParallaxCameraControllerPlugin},N9C:function(){return ParallaxMappingPlugin},wAk:function(){return three_module.wAk},ubm:function(){return three_module.ubm},PG6:function(){return PickingPlugin},Zcv:function(){return three_module.Zcv},bdM:function(){return three_module.bdM},ZM4:function(){return three_module.ZM4},_EQ:function(){return PluginPresetGroup},HiM:function(){return three_module.HiM},RXx:function(){return PointLight2},F1l:function(){return three_module.F1l},W_W:function(){return Z$1},FnS:function(){return PointerLockControls2},oPt:function(){return PointerLockControlsPlugin},ONl:function(){return three_module.ONl},BH$:function(){return three_module.BH$},hzE:function(){return three_module.hzE},pFK:function(){return three_module.pFK},j9d:function(){return PopmotionPlugin},DeC:function(){return PosePlugin},xZx:function(){return three_module.xZx},ZaL:function(){return PresetGroup},UwN:function(){return PresetLibraryPlugin},hzf:function(){return ProgressivePlugin},Nwf:function(){return three_module.Nwf},N2s:function(){return three_module.N2s},dAo:function(){return three_module.dAo},CV9:function(){return three_module.CV9},PTz:function(){return three_module.PTz},MBL:function(){return three_module.MBL},GBG:function(){return three_module.GBG},HO_:function(){return three_module.HO_},Kef:function(){return three_module.Kef},sPf:function(){return three_module.sPf},N5j:function(){return three_module.N5j},GWd:function(){return three_module.GWd},c90:function(){return three_module.c90},y3Z:function(){return three_module.y3Z},uB5:function(){return three_module.uB5},lyL:function(){return three_module.lyL},bC7:function(){return three_module.bC7},ojs:function(){return three_module.ojs},S$4:function(){return three_module.S$4},qa3:function(){return three_module.qa3},B_h:function(){return three_module.B_h},czI:function(){return three_module.czI},rSH:function(){return three_module.rSH},Qrf:function(){return three_module.Qrf},psI:function(){return three_module.psI},a5J:function(){return three_module.a5J},_QJ:function(){return three_module._QJ},Fn:function(){return three_module.Fn},KDk:function(){return three_module.KDk},pBf:function(){return three_module.pBf},HXV:function(){return three_module.HXV},Nz6:function(){return three_module.Nz6},jR7:function(){return three_module.jR7},BXX:function(){return three_module.BXX},DAr:function(){return three_module.DAr},uC4:function(){return RGBM16ColorSpace_},H23:function(){return three_module.H23},W9U:function(){return three_module.W9U},CVz:function(){return three_module.CVz},Riy:function(){return three_module.Riy},kTp:function(){return three_module.kTp},k6Q:function(){return three_module.k6Q},IE4:function(){return three_module.IE4},paN:function(){return three_module.paN},TkQ:function(){return three_module.TkQ},qa1:function(){return RainbowDiamondPlugin},EZL:function(){return RandomizedDirectionalLight},fMJ:function(){return RandomizedDirectionalLightPlugin},D$Q:function(){return three_module.D$Q},RlV:function(){return three_module.RlV},tBo:function(){return three_module.tBo},z5:function(){return three_module.z5},ure:function(){return three_module.ure},VT0:function(){return three_module.VT0},ZQM:function(){return three_module.ZQM},TyI:function(){return Reflector2},Mjd:function(){return three_module.Mjd},O0B:function(){return three_module.O0B},FZz:function(){return RendererUiPlugin},GJx:function(){return three_module.GJx},kG0:function(){return three_module.kG0},nST:function(){return three_module.nST},AUf:function(){return Rhino3dmLoadPlugin},oXQ:function(){return Rhino3dmLoader2},rKP:function(){return three_module.rKP},vMJ:function(){return RootScene},CWW:function(){return three_module.CWW},XG_:function(){return three_module.XG_},er$:function(){return three_module.er$},KLL:function(){return three_module.KLL},ye:function(){return SSAOPlugin},czS:function(){return SSBevelPass},UG9:function(){return SSBevelPlugin},aJo:function(){return SSContactShadows},uC9:function(){return SSGIPlugin},k9M:function(){return SSRPlugin},fRH:function(){return STLLoadPlugin},Z58:function(){return three_module.Z58},_I4:function(){return SceneCamerasUiPlugin},Sr:function(){return SceneLoopPlugin},zx2:function(){return ScrollableCameraViewPlugin},r1V:function(){return ScrollableCameraViewPreviewPlugin},tI0:function(){return SelectionWidget},vxI:function(){return three_module.vxI},zkh:function(){return three_module.zkh},BKk:function(){return three_module.BKk},rNP:function(){return ShaderMaterial2},DkA:function(){return ShaderMaterialEncodingSupport},rpH:function(){return ShaderPass2},Q4F:function(){return ShadowMapBaker},q2:function(){return three_module.q2},ypk:function(){return three_module.ypk},MSw:function(){return three_module.MSw},Ld9:function(){return three_module.Ld9},YOp:function(){return ShapeTubeExtrudePlugin},xJ6:function(){return three_module.xJ6},fBL:function(){return three_module.fBL},XTN:function(){return SimpleAssetList},ZXl:function(){return SimpleBackgroundEnvUiPlugin},O9e:function(){return SimpleDataSource},ILd:function(){return I$2},SQN:function(){return SimpleJSONExporter},GDD:function(){return SimpleJSONLoader},HVh:function(){return SimpleTextExporter},X46:function(){return SimpleTextPlugin},hdr:function(){return SimpleViewerUi},CSJ:function(){return SimplifyModifierPlugin},EAD:function(){return three_module.EAD},_xc:function(){return three_module._xc},I46:function(){return three_module.I46},CSm:function(){return SnowFallPlugin},kLi:function(){return three_module.kLi},iyt:function(){return three_module.iyt},Gu$:function(){return three_module.Gu$},s6s:function(){return SphereSelectionWidget},YHV:function(){return three_module.YHV},xOk:function(){return three_module.xOk},xfg:function(){return three_module.xfg},nCl:function(){return three_module.nCl},Hs2:function(){return SpotLight2},Fpm:function(){return three_module.Fpm},kxk:function(){return three_module.kxk},RoJ:function(){return three_module.RoJ},ie2:function(){return three_module.ie2},hgQ:function(){return three_module.hgQ},f4X:function(){return three_module.f4X},Hrq:function(){return three_module.Hrq},agE:function(){return three_module.agE},uXQ:function(){return three_module.uXQ},keZ:function(){return three_module.keZ},rOG:function(){return three_module.rOG},Ktl:function(){return three_module.Ktl},uov:function(){return three_module.uov},hZF:function(){return three_module.hZF},FXf:function(){return three_module.FXf},Kwu:function(){return three_module.Kwu},hv1:function(){return SwitchNodeBasePlugin},AqU:function(){return SwitchNodePlugin},wtR:function(){return three_module.wtR},cGs:function(){return R$2},bI3:function(){return three_module.bI3},afA:function(){return TemporalAAPlugin},Zpd:function(){return three_module.Zpd},gO_:function(){return TextSVGOptions},gPd:function(){return three_module.gPd},Tap:function(){return three_module.Tap},k4W:function(){return ThinFilmLayerPlugin},ndu:function(){return ThreeMaterialLoader},el_:function(){return TonemapPlugin},O3Y:function(){return three_module.O3Y},UPV:function(){return three_module.UPV},iu6:function(){return TrackballControlsPlugin},Ijk:function(){return TransformAnimationPlugin},ZU6:function(){return TransformControls},XXP:function(){return TransformControls2},RQH:function(){return TransformControlsGizmo},tUF:function(){return TransformControlsPlane},Tww:function(){return TransfrSharePlugin},lMl:function(){return three_module.lMl},rYR:function(){return three_module.rYR},O49:function(){return three_module.O49},RJ4:function(){return three_module.RJ4},CXS:function(){return TriplanarUVMappingPlugin},j6:function(){return three_module.j6},G8g:function(){return TubeShapeGeometry},SOP:function(){return TweakpaneUiPlugin},e2_:function(){return TweakpaneWrapper},GTy:function(){return three_module.GTy},cOZ:function(){return UChartOptions},XxD:function(){return UPackOptions},UTZ:function(){return three_module.UTZ},A$4:function(){return three_module.A$4},MW4:function(){return three_module.MW4},baL:function(){return three_module.baL},fc6:function(){return three_module.fc6},t7h:function(){return Uncharted2Tonemapping},nc$:function(){return three_module.nc$},dzP:function(){return three_module.dzP},fCn:function(){return three_module.fCn},LlO:function(){return three_module.LlO},OUM:function(){return three_module.OUM},V3x:function(){return three_module.V3x},bkx:function(){return three_module.bkx},Wew:function(){return three_module.Wew},gJ2:function(){return three_module.gJ2},cHt:function(){return three_module.cHt},HJp:function(){return Unzip},mMi:function(){return UnzipInflate},XLH:function(){return UnzipPassThrough},TWi:function(){return Unzlib},DcJ:function(){return VJSONPresetGroup},Kmx:function(){return VRPluginBasic},RyA:function(){return three_module.RyA},NPD:function(){return VariationConfiguratorEditorUiPlugin},Gpr:function(){return VariationConfiguratorGridUiPlugin},mKI:function(){return VariationConfiguratorPlugin},I9Y:function(){return three_module.I9Y},Pq0:function(){return three_module.Pq0},IUQ:function(){return three_module.IUQ},RiT:function(){return three_module.RiT},Xkr:function(){return VelocityBufferPlugin},Nv2:function(){return three_module.Nv2},EW5:function(){return ViewerApp},oJ0:function(){return ViewerState},Q1b:function(){return VignettePlugin},jK_:function(){return VirtualCamerasPlugin},gTm:function(){return WaveGroundPlugin},S3G:function(){return three_module.S3G},ALV:function(){return three_module.ALV},y9J:function(){return three_module.y9J},TdN:function(){return three_module.TdN},o6l:function(){return three_module.o6l},AT1:function(){return three_module.AT1},nWS:function(){return three_module.nWS},JeP:function(){return three_module.JeP},hfX:function(){return three_module.hfX},i7u:function(){return three_module.i7u},b5D:function(){return WebGiViewerElement},Z1R:function(){return WindowiseDialogPlugin},pWZ:function(){return Wireframe},XJ7:function(){return three_module.XJ7},r3D:function(){return WireframeGeometry2},dhZ:function(){return three_module.dhZ},$Tl:function(){return XAtlasPlugin},rQf:function(){return three_module.rQf},ojh:function(){return three_module.ojh},h2z:function(){return three_module.h2z},kqe:function(){return three_module.kqe},qQr:function(){return Zip},D8L:function(){return ZipDeflate},p9O:function(){return ZipLoader},uZB:function(){return ZipPassThrough},KK:function(){return Zlib},Ua6:function(){return three_module.Ua6},TYE:function(){return et},rQr:function(){return addBasePlugins},$00:function(){return addBloomData},ued:function(){return addDracoLoader},p$A:function(){return addEditorPlugins},m2A:function(){return addGLTFExporter},MqB:function(){return addGLTFLoader},Dv6:function(){return addLUTData},f9i:function(){return addRGBELoader},qHA:function(){return addSSBevel},sQz:function(){return Pe$1},G52:function(){return Te$1},EP1:function(){return afterMain},v5N:function(){return afterRead},SET:function(){return afterWrite},g7h:function(){return angle},i0Z:function(){return animate},GcL:function(){return animateAsync},z67:function(){return animateObject},im4:function(){return animateSet},$bx:function(){return animateTarget$1},btx:function(){return anticipate$1},M7c:function(){return applyOffset},ZMO:function(){return modifiers_applyStyles},YiG:function(){return ie$1},UE8:function(){return modifiers_arrow},uHr:function(){return attract},YYK:function(){return attractExpo},qZL:function(){return auto$1},XMb:function(){return autoCenterObject3D},utC:function(){return autoGPUInstanceMeshes},uO_:function(){return autoScaleObject3D},dgX:function(){return backIn$1},ZZ5:function(){return backInOut$1},Szj:function(){return backOut$1},Ms4:function(){return re$1},OMj:function(){return basePlacements},D7g:function(){return basicMaterialPropList},LG_:function(){return beforeMain},cis:function(){return beforeRead},pAB:function(){return beforeWrite},y80:function(){return q$2},sQg:function(){return bottom},ipZ:function(){return bounceIn},wmn:function(){return bounceInOut},Tel:function(){return bounceOut},Q5:function(){return buildCSGMeshBSP},b1j:function(){return buildCSGMeshBVH},wzf:function(){return cLinearToRGBM},Cq_:function(){return cRGBMToLinear},poN:function(){return circIn$1},tnX:function(){return circInOut$1},yT:function(){return circOut$1},qE8:function(){return clamp$1},WYS:function(){return clippingParents},Cp1:function(){return be$1},mz1:function(){return combineDofShader},Bc:function(){return gzip},oSR:function(){return gzipSync},KJu:function(){return computeAverageGeometryNormal},G1I:function(){return computeEigenVectors},dXm:function(){return computeGeometryCenter},lRj:function(){return computeGeometrySize},WL9:function(){return computeMikkTSpaceTangents},OkM:function(){return computeMorphedAttributes},kRU:function(){return computeOffsetMatrix},Xpo:function(){return computeScreenSpaceBoundingBox},KCp:function(){return modifiers_computeStyles},a17:function(){return copyMaterialUserData},prl:function(){return copyObject3DUserData},ij0:function(){return xe$1},MjE:function(){return copyTextureUserData},bhJ:function(){return createAnticipate},nMR:function(){return createAttractor},p4x:function(){return createBackIn},lPF:function(){return three_module.lPF},SwP:function(){return ee$1},U2C:function(){return createExpoIn},FOd:function(){return createGenericExtensionClass},WOM:function(){return createIFrameCSS3DObject},mFw:function(){return T$2},n4h:function(){return popper_createPopper},eRo:function(){return createPopper},LsR:function(){return popper_lite_createPopper},tJ:function(){return createRenderTargetKey},bES:function(){return te$1},rU:function(){return P$2},omb:function(){return csgOperations},AHW:function(){return $},AKs:function(){return cubicBezier$1},VxZ:function(){return dataTextureFromColor},GRd:function(){return dataTextureFromVec4},TVt:function(){return decay},mFv:function(){return decompress},RqU:function(){return decompressSync},UKN:function(){return Se$1},mmZ:function(){return deepCloneAttribute},Ikv:function(){return defaultPresets},Kcl:function(){return deflate},pdh:function(){return deflateSync},tRv:function(){return degreesToRadians},nNY:function(){return deinterleaveAttribute},LK7:function(){return deinterleaveGeometry},$q:function(){return deserializeObject},vem:function(){return deserializers},__B:function(){return detectOverflow},BF2:function(){return diamondMaterialPropList},IoC:function(){return distance$1},WNF:function(){return N$2},PE3:function(){return me$1},a6C:function(){return easeIn$1},am_:function(){return easeInOut$1},vTE:function(){return easeOut$1},VAT:function(){return Ze$1},_N2:function(){return end},oib:function(){return envMapBackground},NtM:function(){return F$1},ru_:function(){return estimateBytesUsed},GcD:function(){return eventListeners},pJG:function(){return extractAnimationKey},vxL:function(){return flattenUiConfig},UUz:function(){return modifiers_flip},mlk:function(){return fontFormatExtensionMap},SVi:function(){return generateUiConfig},QXJ:function(){return generateUiFolder},D01:function(){return Me$1},$7C:function(){return le$1},cdn:function(){return Ue$1},vGk:function(){return Re$1},GPz:function(){return Ee$1},NxN:function(){return H$2},o7j:function(){return getTexelDecoding},yqR:function(){return getTexelDecodingFunction},U_j:function(){return getTextureDataType},mB_:function(){return se$1},d6c:function(){return rt},zhG:function(){return glbEncryptionPreparser},HJb:function(){return fe$1},e5R:function(){return gltfExporterMaterialsVariantsExtensionExport},kdR:function(){return gunzip},D85:function(){return gunzipSync},ZIX:function(){return gzip},u3y:function(){return gzipSync},jDu:function(){return modifiers_hide},qyt:function(){return de$1},Dtr:function(){return Qe$1},WKP:function(){return je$1},fJV:function(){return z$2},tC7:function(){return iGeometryIgnoredUserData},Uan:function(){return iMaterialIgnoredUserData},Uct:function(){return iModelIgnoredUserData},K_U:function(){return iTextureIgnoredUserData},BFA:function(){return Ne$1},BHX:function(){return We$1},Pee:function(){return V$2},$If:function(){return He$1},RFY:function(){return Ce$1},Buv:function(){return inertia$1},UDz:function(){return inflate},HMP:function(){return inflateSync},Zg4:function(){return interleaveAttributes},GWP:function(){return interpolate$1},r58:function(){return isAnimatableType},fTC:function(){return isPoint},YWz:function(){return isPoint3D},eAs:function(){return W$2},i7C:function(){return keyframes$1},jFo:function(){return khrMaterialsVariantsGLTF},kbd:function(){return left},nU8:function(){return lerpAngle},NFx:function(){return lerpAngle2},sns:function(){return linear},S2G:function(){return he$1},iW4:function(){return main$1},Se$:function(){return Je$1},Sop:function(){return Ge$1},HNH:function(){return makeFilter},jGz:function(){return makeSamplerUi},ll7:function(){return makeSetterFor},SrG:function(){return Xe$1},UGD:function(){return matDefine},KVf:function(){return mergeAttributes},gDN:function(){return mergeBufferAttributes},h0o:function(){return mergeBufferGeometries},pPQ:function(){return mergeGeometries},hLo:function(){return mergeGroups},ecu:function(){return mergeVertices},mhB:function(){return mirrorEasing$1},jhA:function(){return mix$1},iou:function(){return mixColor$1},JL8:function(){return mixComplex$1},G8Z:function(){return we$1},GMB:function(){return modifierPhases},tB5:function(){return g},GnX:function(){return v$3},cYW:function(){return modifiers_offset},k9K:function(){return x$1},CTC:function(){return ze$1},JW6:function(){return Ae$1},p7C:function(){return ae$1},OId:function(){return patchShaderEncodingSupport},CN_:function(){return ot},uaX:function(){return physicalMaterialPropList},FsL:function(){return pipe$1},gtD:function(){return pivotToBBoxCenter},wbL:function(){return pivotToPoint},DDu:function(){return enums_placements},O$W:function(){return pointFromVector},xfb:function(){return popper},UD3:function(){return popperGenerator},ZoD:function(){return modifiers_popperOffsets},hQ_:function(){return pe$1},V7C:function(){return modifiers_preventOverflow},Sow:function(){return processViewer},qB0:function(){return progress$1},nv6:function(){return radiansToDegrees},LF4:function(){return enums_read},TAg:function(){return Fe$1},irg:function(){return reference},Ei4:function(){return ct},Grb:function(){return removeDuplicateGeometries},yhl:function(){return f$1},Gmo:function(){return reverseEasing$1},pGT:function(){return right},Gsh:function(){return rotateDuplicatedMesh},S2Q:function(){return three_module.S2Q},pUp:function(){return S$2},sU3:function(){return serializable},lKg:function(){return serialize},gwL:function(){return serializeObject},EBS:function(){return serializeTextureInExtras},YCG:function(){return serializers},gC:function(){return setMeshGeometry},R5k:function(){return setMeshMaterial},zB$:function(){return setThreeRendererMode},dGw:function(){return st},tNl:function(){return setupCoreWebGiViewer},AAd:function(){return setupIModel},YFt:function(){return setupModesStyles},IRk:function(){return setupModesUi},ZVX:function(){return setupObject3dModel},cTN:function(){return setupSandboxWebGiEditor},PlU:function(){return shaderReplaceString},Mi5:function(){return sign2},nuN:function(){return slerp},Jp2:function(){return smooth},oDA:function(){return smoothFrame},n$K:function(){return snap},w4b:function(){return snapObject},JVv:function(){return sphericalFromObject},ozl:function(){return spring$1},asH:function(){return standardMaterialPropList},niF:function(){return start},CiD:function(){return steps_steps},heq:function(){return strFromU8},_uk:function(){return strToU8},xrZ:function(){return supportsRequestStreams},aUi:function(){return L$2},Tmf:function(){return J$1},AYr:function(){return B$2},SVO:function(){return texImageToCanvas},mBH:function(){return textureDataToImageData},z73:function(){return textureToCanvas},cyN:function(){return textureToDataUrl},wRz:function(){return X$2},pbX:function(){return toCreasedNormals},nIf:function(){return toDecimal},RY5:function(){return toIndexedGeometry},SnO:function(){return oe$1},_cJ:function(){return toTrianglesDrawMode},Mny:function(){return enums_top},X0G:function(){return uiButton},mBY:function(){return uiColor},rpQ:function(){return uiConfig},exO:function(){return uiDropdown},rsv:function(){return uiFolder},gpt:function(){return uiImage},hEL:function(){return uiInput},LIx:function(){return uiMonitor},Z5F:function(){return uiPanel},Eiw:function(){return uiSlider},Jx6:function(){return uiToggle},q00:function(){return uiVector},PiW:function(){return uniform},$15:function(){return unzip},AOo:function(){return unzipSync},VTi:function(){return unzlib},a8Y:function(){return unzlibSync},QMY:function(){return ge$1},d5o:function(){return vLinearToRGBM},Fxe:function(){return vRGBMToLinear},Nan:function(){return valueToUiType},Ols:function(){return variationPlacements},Ovn:function(){return velocityPerFrame},fjO:function(){return velocityPerSecond$1},pZl:function(){return Be$1},R9T:function(){return viewport},LV7:function(){return wrap},M98:function(){return write},_h9:function(){return $e$1},yU6:function(){return zip},LaF:function(){return zipSync},w58:function(){return zlib},$ax:function(){return zlibSync}}),function(h){h[h.Error=-2]="Error",h[h.Destroyed=-1]="Destroyed",h[h.None=0]="None",h[h.Running=1]="Running",h[h.Paused=2]="Paused"}(ViewerState||(ViewerState={}));let I$2=class{constructor(){this._eventListeners={},this.dispatchEvent=this.dispatchEvent.bind(this),this.addEventListener=this.addEventListener.bind(this),this.removeEventListener=this.removeEventListener.bind(this),this.hasEventListener=this.hasEventListener.bind(this)}addEventListener(h,o){const c=this._eventListeners;c[h]===void 0&&(c[h]=[]),c[h].includes(o)||c[h].push(o)}hasEventListener(h,o){const c=this._eventListeners;return c[h]!==void 0&&c[h].includes(o)}removeEventListener(h,o){const c=this._eventListeners[h];if(c!==void 0){const d=c.indexOf(o);d!==-1&&c.splice(d,1)}}dispatchEvent(h){const o=this._eventListeners[h.type];if(o!==void 0){h.target=this;const c=o.slice(0);for(let d=0,_=c.length;d<_;d++)c[d].call(this,h)}}};async function X$2(h){return new Promise(o=>setTimeout(o,Math.max(0,h)))}function g(){return(typeof performance>"u"?Date:performance).now()}let Z$1=class extends I$2{constructor(){super(...arguments),this._onPointerDown=h=>{if(h.button!==0||!this._element)return;this._pointerUp=void 0;const o=h.clientX/this._element.clientWidth*2-1,c=-h.clientY/this._element.clientHeight*2+1,d=g();this._pointerDown={x:o,y:c,time:d},this._pointer=this._pointerDown,this.dispatchEvent({type:"dragStart",pointer:this._pointerDown})},this._onPointerMove=h=>{if(!this._pointerDown||!this._pointer||!this._element)return;const o=h.clientX/this._element.clientWidth*2-1,c=-h.clientY/this._element.clientHeight*2+1,d=g();this.dispatchEvent({type:"drag",pointer:this._pointer,drag:{x:o-this._pointerDown.x,y:c-this._pointerDown.y,time:d-this._pointerDown.time},delta:{x:o-this._pointer.x,y:c-this._pointer.y,time:d-this._pointer.time}}),this._pointer={x:o,y:c,time:g()},h.buttons%2==0&&this._onPointerUp(h)},this._onPointerUp=h=>{if(h.button!==0||!this._pointerDown||!this._element)return;const o=h.clientX/this._element.clientWidth*2-1,c=-h.clientY/this._element.clientHeight*2+1,d=g();this._pointerUp={x:o,y:c,time:d},this.dispatchEvent({type:"dragEnd",pointer:this._pointerUp,drag:{x:this._pointerUp.x-this._pointerDown.x,y:this._pointerUp.y-this._pointerDown.y,time:this._pointerUp.time-this._pointerDown.time}}),this._pointerDown=void 0,this._pointer=void 0}}get element(){return this._element}set element(h){this._element!==h&&(this._element&&this._removeElement(),this._element=h,this._element&&this._addElement())}_removeElement(){var h,o,c,d,_;(h=this._element)==null||h.removeEventListener("pointerdown",this._onPointerDown),(o=this._element)==null||o.removeEventListener("pointermove",this._onPointerMove),(c=this._element)==null||c.removeEventListener("pointerup",this._onPointerUp),(d=this._element)==null||d.removeEventListener("pointercancel",this._onPointerUp),(_=this._element)==null||_.removeEventListener("pointerout",this._onPointerUp)}_addElement(){var h,o,c,d,_;(h=this._element)==null||h.addEventListener("pointerdown",this._onPointerDown),(o=this._element)==null||o.addEventListener("pointermove",this._onPointerMove),(c=this._element)==null||c.addEventListener("pointerup",this._onPointerUp),(d=this._element)==null||d.addEventListener("pointercancel",this._onPointerUp),(_=this._element)==null||_.addEventListener("pointerout",this._onPointerUp)}dispose(){this.element=void 0}},Q$2=class{constructor(h){this.options={limit:500,debug:!1,bindHotKeys:!1},this.enabled=!0,this.presets={},this._keyDown=o=>{if(!this.enabled)return;const c=o.ctrlKey||o.metaKey;o.code==="KeyZ"&&c&&!o.shiftKey?this.undo():(o.code==="KeyZ"&&c&&o.shiftKey||o.code==="KeyY"&&o.ctrlKey)&&this.redo()},Object.assign(this.options,h),this.limit=h.limit,this.options=h,this.reset(),h.bindHotKeys&&this.bindHotKeys(),this.log(`Initialized with stack limit of ${this.limit} commands`)}bindHotKeys(){return this.log("Bound 'undo' and 'redo' actions to 'Ctrl/Cmd+Z', 'Ctrl+Y' & 'Ctrl/Cmd+Shift+Z' hot keys"),(this.options.hotKeyRoot??document).addEventListener("keydown",this._keyDown),this}dispose(){return(this.options.hotKeyRoot??document).removeEventListener("keydown",this._keyDown),this.reset()}record(h){return this.enabled?(this._record(h),this):this}replaceLast(h){const o=this.peek();if(o)return this.log("replace",o,"with",h),this.stack[this.sp]=h,this}execute(h){if(!this.enabled)return;let o=this._rc(h),c=o.redo;return this.record.apply(this,o),this.log("Executing function..."),c.apply(h),this}_rc(h){if(h.type){const o=this.presets[h.type];if(typeof o=="function")return o(h);throw console.error(h,o,this.presets),new Error("Preset command not found")}return h}_record(h){this.enabled&&(this.log("Recording command",h),this._rebase(),this.stack.push(h),this.sp++,this._keepLimit())}_rebase(){this.canRedo()&&(this.stack.length=this.sp+1)}_keepLimit(){if(this.stack.length<=this.limit)return;let h=this.stack.length-this.limit;this.log("Stack size reached its limit: ${this.limit} commands. Cutting off most old commands..."),h===1?this.stack.shift():this.stack.splice(0,h),this.sp-=h}undo(){if(!this.canUndo())return this;let h=this.stack[this.sp];return this.log("undo"),this.sp--,this._rc(h).undo(),this}canUndo(){return this.sp>=0&&this.enabled}peek(){return this.canUndo()?this.stack[this.sp]:null}redo(){if(!this.canRedo())return this;let h=this.stack[this.sp+1];return this.log("redo"),this.sp++,this._rc(h).redo(),this}canRedo(){return this.sp<this.stack.length-1&&this.enabled}peekForward(){return this.canRedo()?this.stack[this.sp+1]:null}setLimit(h){let o=this.stack.length-this.sp-1;if(h<1||typeof h!="number")throw new TypeError(`JSUndoManager.setLimit(): unexpected argument limit=${h}. Should be a positive number`);return h<o?console.warn(`JSUndoManager.setLimit(): cannot set stack limit (${h}) less than the number of 'redoable' commands (${o})`):(this.limit=Math.floor(h),this._keepLimit()),this}reset(){return this.log("reset"),this.stack=[],this.sp=-1,this}isEmpty(){return!this.stack.length}isFull(){return this.stack.length===this.limit}getSize(){return this.stack.length}log(h,...o){this.options.debug&&console.log(`Command Manager: ${h}`,...o)}};const p$3=class ky{constructor(o=ky.DECAY_MILLISECONDS){this.velocity=0,this.naturalFrequency=0,this.setDecayTime(o)}setDecayTime(o){this.naturalFrequency=1/Math.max(ky.MIN_DECAY_MILLISECONDS,o)}update(o,c,d,_){const v=2e-4*this.naturalFrequency;if(o==null||_===0||o===c&&this.velocity===0)return c;if(d<0)return o;const b=o-c,tt=this.velocity+this.naturalFrequency*b,it=b+d*tt,nt=Math.exp(-this.naturalFrequency*d),lt=(tt-this.naturalFrequency*it)*nt,ut=-this.naturalFrequency*(lt+tt*nt);return Math.abs(lt)<v*Math.abs(_)&&ut*b>=0?(this.velocity=0,c):(this.velocity=lt,c+it*nt)}};p$3.SETTLING_TIME=1e4,p$3.MIN_DECAY_MILLISECONDS=.001,p$3.DECAY_MILLISECONDS=50;let k$1=p$3;function j(){const h=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");return h.style.display="block",h}function ee$1({innerHTML:h="",id:o,classList:c,addToBody:d=!0,elementTag:_="div"}){const v=document.createElement(_);return o&&(v.id=o),v.innerHTML=h,c&&v.classList.add(...c),d&&document.body.appendChild(v),v}async function T$2(h){return new Promise((o,c)=>{const d=new Image;d.onload=()=>o(d),d.onerror=c,d.crossOrigin="anonymous",d.decoding="sync",d.src=h})}function P$2(h,o=document.head){const c=document.createElement("style");return c.type="text/css",c.innerText=h,o==null||o.appendChild(c),c}async function te$1(h,o=document.head){return new Promise((c,d)=>{const _=document.createElement("script");_.setAttribute("src",h),_.addEventListener("load",()=>c(_)),_.addEventListener("error",d),o.appendChild(_)})}function ie$1(h){if(!window)return console.warn("window is required"),"";let o="";const c=new Uint8Array(h),d=c.byteLength;for(let _=0;_<d;_++)o+=String.fromCharCode(c[_]);return window.btoa(o)}function re$1(h){if(!window)return console.warn("window is required"),new Uint8Array(0);const o=window.atob(h),c=o.length,d=new Uint8Array(c);for(let _=0;_<c;_++)d[_]=o.charCodeAt(_);return d.buffer}const R$2={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function se$1(h,o){return new R$2[h](o)}function oe$1(h){return h.replace(/\w\S*/g,function(o){return o.charAt(0).toUpperCase()+o.substr(1).toLowerCase()})}function ae$1(h){if(!h||h===""||h.match(/__MACOSX\/.*\._/))return"";const o=(h=h.replace(/\?.*$/,"")).split(/[\\/]/).pop()??"",c=o.lastIndexOf(".");return o===""||c<1?"":o.slice(c+1)}function le$1(h){return h.substring(h.lastIndexOf("/")+1)}function F$1(h){return h.replace(/([.*+?^=!:${}()|[\]/\\])/g,"\\$1")}function f$1(h,o,c){return h.replace(new RegExp(F$1(o),"g"),c)}function he$1(h){return h.sort(),h[0].split("").map((o,c)=>h[h.length-1][c]===o?o:"\0").join("").split("\0").at(0)||""}const fe$1=(h,...o)=>String.raw({raw:h},...o),$=(h,...o)=>String.raw({raw:h},...o),de$1=(h,...o)=>String.raw({raw:h},...o),B$2=(h,...o)=>{let c=String.raw({raw:h},...o);return c=f$1(c,"%","%25"),c=f$1(c,"> <","><"),c=f$1(c,"; }",";}"),c=f$1(c,"<","%3c"),c=f$1(c,">","%3e"),c=f$1(c,'"',"'"),c=f$1(c,"#","%23"),c=f$1(c,"{","%7b"),c=f$1(c,"}","%7d"),c=f$1(c,"|","%7c"),c=f$1(c,"^","%5e"),c=f$1(c,"`","%60"),c=f$1(c,"@","%40"),c=f$1(c,"&","&amp;"),c=f$1(c,`
`,"%0A"),"data:image/svg+xml;charset=UTF-8,"+c};function pe$1(h=document.head){return P$2($`
      ::-webkit-scrollbar
      {
        width: 8px;  /* for vertical scrollbars */
        height: 8px; /* for horizontal scrollbars */
      }
      ::-webkit-scrollbar-track
      {
        background: rgba(64, 64, 64, 0.4);
        border-radius: 6px;
      }
      ::-webkit-scrollbar-thumb
      {
        background: rgba(128, 128, 128, 0.2);
        border-radius: 6px;
      }
      ::-webkit-scrollbar-corner {background: rgba(0,0,0,0.5);}
    `,h)}function N$2(h,o){const c=window.URL.createObjectURL(h),d=document.createElement("a");d.style.display="none",d.href=c,d.download=o,document.body.appendChild(d),d.click(),setTimeout(()=>{document.body.removeChild(d),window.URL.revokeObjectURL(c)},1e3)}async function q$2(h){return new Promise((o,c)=>{const d=new FileReader;d.onload=_=>o(d.result),d.onerror=_=>c(d.error),d.onabort=_=>c(new Error("Read aborted")),d.readAsDataURL(h)})}function me$1(h,o){return N$2(h,o??h.name)}async function ge$1(h=!1,o=!1,c){const d=document.createElement("input");d.type="file",d.multiple=h,d.accept=c||"*",d.webkitdirectory=o,d.style.display="none",document.body.appendChild(d),d.click();const _=await new Promise(v=>{d.onchange=b=>{v(Array.from(d.files||[]))}});return document.body.removeChild(d),_}function we$1(){let h=!1;return function(o){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(o)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(o.substr(0,4)))&&(h=!0)}(navigator.userAgent||navigator.vendor||window.opera),h}function ve$1(h){return h<.0031308?12.92*h:1.055*Math.pow(h,.41666)-.055}function be$1(h,o=1,c=1){const d=document.createElement("canvas");d.width=o,d.height=c;const _=d.getContext("2d");_.fillStyle="#"+h,_.fillRect(0,0,o,c);const v=d.toDataURL();return d.remove(),v}function H$2(h,o){let c;do c=Object.getOwnPropertyDescriptor(h,o);while(!c&&(h=Object.getPrototypeOf(h)));return c}function W$2(h,o,c=!0,d=!1){const _=H$2(h,o);return!(_==null||!_.set)||c&&(_==null?void 0:_.writable)!==!1&&(_==null?void 0:_.get)===void 0||d&&!_}function S$2(h,o,c,d=!0,_=!1){return!(!h||!W$2(h,o,d,_)||(h[o]=c,0))}function Ee$1(h,...o){return typeof h=="function"&&(h=h(...o)),h}function xe$1(h,o,c){for(const d of c){const _=h[d];_!==void 0&&S$2(o,d,_,!0)}return o}function Ce$1(h,o){for(const c of o)if(!h.includes(c))return!1;return!0}function Se$1(h,o,c=!1){for(typeof h=="string"&&(h=h.split("."));h.length>0;){if(!o)return o;const d=h.splice(0,1)[0];if(!(d.length<1))if(Array.isArray(o))o=o[parseInt(d)];else{if(typeof o!="object"||!(d in o)){if(c)throw new Error("invalid access, check "+d+" in "+o);return}o=o[d]}}return o}function Ue$1(h,o){return Object.keys(h).find(c=>h[c]===o)}function v$3(h,o){return Object.hasOwn?Object.hasOwn(h,o):h.hasOwnProperty(o)}const m$2=class x0{static callFunction(o,c,d=[]){if(!c)return o(...d);if(o.name&&c[o.name]===o)return o.call(c,...d);x0.methodMap.has(c)||x0.methodMap.set(c,new WeakMap);const _=x0.methodMap.get(c);if(!_.has(o)){let v=c;for(;v;){const b=Object.values(Object.getOwnPropertyDescriptors(v));for(let tt of b)if(tt.value===o)return _.set(o,!0),o.call(c,...d);v=Object.getPrototypeOf(v)}_.set(o,!1)}return _.get(o)?o.call(c,...d):o(...d)}};m$2.methodMap=new WeakMap;let E$2=m$2;function x$1(h,o="param"){if(!h)throw new Error("onChange: fnKey is undefined, make sure the function exists or provide a string");return(c,d,_)=>{const v={get(){return this[`_oc_${d}`]},set(b){var tt;const it=this[`_oc_${d}`];if(it===b)return;this[`_oc_${d}`]=b;const nt=o==="param"?[d,b,it,this]:o==="object"?[{key:d,value:b,oldValue:it,target:this}]:[];typeof h=="string"?(tt=this[h])==null||tt.call(this,...nt):typeof h=="function"&&E$2.callFunction(h,this,nt)}};if(_)return v$3(_,"value")&&delete _.value,v$3(_,"writable")&&delete _.writable,v$3(_,"initializer")&&delete _.initializer,Object.assign(_,v);Object.defineProperty(c,d,v)}}function ze$1(h,o="void"){if(!h)throw new Error("onChange: fnKey is undefined, make sure the function exists or provide a string");return x$1(h,o)}function Ae$1(h,o="object"){if(!h)throw new Error("onChange: fnKey is undefined, make sure the function exists or provide a string");return x$1(h,o)}async function Te$1(h,o,c){const d=typeof o=="string"?new TextEncoder().encode(o):o,_=await crypto.subtle.digest("SHA-256",d),v=crypto.getRandomValues(new Uint8Array(12)),b=Array.from(v).map(xt=>String.fromCharCode(xt)).join(""),tt={name:"AES-GCM",iv:v},it=await crypto.subtle.importKey("raw",_,tt,!1,["encrypt"]),nt=typeof h=="string"?new TextEncoder().encode(h):h,lt=await crypto.subtle.encrypt(tt,it,nt),ut=new Uint8Array(lt),ht=Array.from(ut),_t=ht.map(xt=>String.fromCharCode(xt)).join(""),ft=c?typeof c=="string"?c:new TextDecoder().decode(c):"",bt=c?typeof c=="string"?new TextEncoder().encode(c):Array.from(c):[];return typeof h=="string"?ft+b+_t:new Uint8Array([...bt,...v,...ht])}async function Pe$1(h,o){const c=typeof o=="string"?new TextEncoder().encode(o):o,d=await crypto.subtle.digest("SHA-256",c),_=h.slice(0,12),v={name:"AES-GCM",iv:typeof _=="string"?new Uint8Array(Array.from(_).map(nt=>nt.charCodeAt(0))):_},b=await crypto.subtle.importKey("raw",d,v,!1,["decrypt"]),tt=h.slice(12),it=typeof tt=="string"?new Uint8Array(Array.from(tt).map(nt=>nt.charCodeAt(0))):tt;try{const nt=await crypto.subtle.decrypt(v,b,it);return typeof h=="string"?new TextDecoder().decode(nt):new Uint8Array(nt)}catch{throw new Error("Decrypt failed")}}async function Me$1(){return"showOpenFilePicker"in window?window.showOpenFilePicker().then(h=>h[0]):window.chooseFileSystemEntries()}function Re$1(){if("showSaveFilePicker"in window){const h={types:[{description:"Text file",accept:{"text/plain":[".txt"]}}]};return window.showSaveFilePicker(h)}return window.chooseFileSystemEntries({type:"save-file",accepts:[{description:"Text file",extensions:["txt"],mimeTypes:["text/plain"]}]})}function Fe$1(h){return h.text?h.text():K$2(h)}function K$2(h){return new Promise(o=>{const c=new FileReader;c.addEventListener("loadend",d=>{const _=(d.srcElement||d.target).result;o(_)}),c.readAsText(h)})}async function $e$1(h,o){if(h.createWriter){const d=await h.createWriter();return await d.write(0,o),void await d.close()}const c=await h.createWritable();await c.write(o),await c.close()}async function Be$1(h,o){const c={};return o&&(c.writable=!0,c.mode="readwrite"),await h.queryPermission(c)==="granted"||await h.requestPermission(c)==="granted"}function U$2(h,o=8192,c=!1){var d;if(!h.width||!h.height)throw new Error("Invalid bitmap");const _=document.createElement("canvas");_.width=Math.min(o,h.width),_.height=Math.floor(1+_.width*h.height/h.width);const v=h instanceof ImageBitmap,b=v&&c&&Math.abs(_.width-h.width)<.5?_.getContext("bitmaprenderer"):void 0;return b?b.transferFromImageBitmap(h):(d=_.getContext("2d"))==null||d.drawImage(h,0,0,_.width,_.height),v&&c&&h.close(),_}function Ne$1(h,o=8192,c=!1,d="image/png"){if(!h.width||!h.height)return"";const _=U$2(h,o,!1),v=_.toDataURL(d);return _.remove(),c&&h instanceof ImageBitmap&&h.close(),v}async function He$1(h){return new Promise((o,c)=>{const d=new Image;d.addEventListener("load",()=>{const _=document.createElement("canvas");_.width=d.width,_.height=d.height;const v=_.getContext("2d");if(!v)return void c(new Error("Could not get 2d context"));v.drawImage(d,0,0,_.width,_.height);const b=v.getImageData(0,0,_.width,_.height);o(b),_.remove(),d.remove()},!1),d.addEventListener("error",_=>{d.remove(),c(_)},!1),d.src=h})}function V$2(h,{backgroundColor:o="",scale:c=1,width:d=512,height:_=512}){const v=document.createElement("canvas"),b=v.getContext("2d"),tt=c,it=d,nt=_;return v.width=it*tt,v.height=nt*tt,v.style.width=`${it}`,v.style.height=`${nt}`,(o==null?void 0:o.length)>0&&(b.fillStyle=o,b.fillRect(0,0,v.width,v.height)),b.drawImage(h,0,0,v.width,v.height),v}function We$1(h){const o=document.createElement("canvas");return o.width=h.width,o.height=h.height,o.getContext("2d").putImageData(h,0,0),o}function Ke$1(h){const o=document.createElement("canvas");o.width=h.width,o.height=h.height;const c=o.getContext("2d");if(!c)throw new Error("Unable to get 2d context");return c.translate(0,h.height),c.scale(1,-1),c.drawImage(h,0,0),o}const Je$1=h=>`data:image/svg+xml,%3Csvg width='16' height='16' viewBox='0 0 16 16' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Crect width='16' height='16' fill='%23${h}'/%3E%3C/svg%3E%0A`,Ge$1=h=>`data:image/svg+xml,%3Csvg width='16' height='16' viewBox='0 0 16 16' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Ccircle cx='8' cy='8' r='7' fill='%23${h}'/%3E%3C/svg%3E%0A`,Xe$1=h=>`data:image/svg+xml,%3Csvg viewBox='0 0 80 14' xmlns='http://www.w3.org/2000/svg'%3E%3Ctext style='font: 8px "Roboto Mono", "Source Code Pro", Menlo, Courier, monospace; fill: white;' x='9' y='9'%3E${h}%3C/text%3E%3C/svg%3E%0A`,L$2=async(h,o)=>V$2(await T$2(h),o),J$1=async(h,o)=>await L$2(h,o).then(c=>c.toDataURL("image/png")),G$2=async h=>q$2(await(await fetch(h)).blob());async function Ze$1(h,o=G$2){const c=h.match(/(((ftp|https?):\/\/)[\-\w@:%_\+.~#?,&\/\/=]+)/g);if(c)for(const d of c){const _=await o(d);h=h.replace(d,_)}return h}function z$2(h,o,{width:c,height:d},_=!0){const v=`
<svg viewBox="0 0 ${c} ${d}" xmlns="http://www.w3.org/2000/svg">
    <style>
    ${o}
    </style>
    <foreignObject x="0" y="0" width="100%" height="100%">
        <div xmlns="http://www.w3.org/1999/xhtml" style="height: 100%; width: 100%; position: absolute: top:0; left:0">
            ${h}
        </div>
    </foreignObject>
</svg>
    `;return _?B$2(v):v}async function Qe$1(h,o,c){const d=z$2(h,o,c);return await L$2(d,c)}async function je$1(h,o,c){const d=z$2(h,o,c);return await J$1(d,c)}function et(h,o){return Math.abs(h)>Math.abs(o)?h:o}function rt(h,o=null){return new URL(window.location.href).searchParams.get(h)??o}function st(h,o,c=!1){const d=new URLSearchParams(location.search);o==null?d.has(h)&&d.delete(h):d.set(h,o),c?window.location.search=d.toString():window.history.replaceState({},"","?"+d.toString())}function ot(h,o="/"){return h.join(o)}function ct(h,o){const c=(o?`var Module = { locateFile: function(s) { return "${o}"; } }; 
`:"")+`importScripts( "${h}" );`;return URL.createObjectURL(new Blob([c],{type:"text/javascript"}))}var three_module=__webpackgi_require__(848);const CopyShader={name:"CopyShader",uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform float opacity;

		uniform sampler2D tDiffuse;

		varying vec2 vUv;

		void main() {

			vec4 texel = texture2D( tDiffuse, vUv );
			gl_FragColor = opacity * texel;


		}`};class Pass{constructor(){this.isPass=!0,this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}setSize(){}render(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}dispose(){}}const _camera=new three_module.qUd(-1,1,1,-1,0,1),_geometry=new three_module.LoY;_geometry.setAttribute("position",new three_module.qtW([-1,3,0,-1,-1,0,3,-1,0],3)),_geometry.setAttribute("uv",new three_module.qtW([0,2,0,0,2,0],2));class FullScreenQuad{constructor(o){this._mesh=new three_module.eaF(_geometry,o)}dispose(){this._mesh.geometry.dispose()}render(o){o.render(this._mesh,_camera)}get material(){return this._mesh.material}set material(o){this._mesh.material=o}}class ShaderPass extends Pass{constructor(o,c){super(),this.textureID=c!==void 0?c:"tDiffuse",o instanceof three_module.BKk?(this.uniforms=o.uniforms,this.material=o):o&&(this.uniforms=three_module.LlO.clone(o.uniforms),this.material=new three_module.BKk({name:o.name!==void 0?o.name:"unspecified",defines:Object.assign({},o.defines),uniforms:this.uniforms,vertexShader:o.vertexShader,fragmentShader:o.fragmentShader})),this.fsQuad=new FullScreenQuad(this.material),this.useExistingRenderTarget=!1}render(o,c,d){this.uniforms[this.textureID]&&d&&(this.uniforms[this.textureID].value=d.texture),this.fsQuad.material=this.material,this.renderToScreen?(o.setRenderTarget(null),this.fsQuad.render(o)):(this.useExistingRenderTarget||o.setRenderTarget(c||null),this.clear&&o.clear(o.autoClearColor,o.autoClearDepth,o.autoClearStencil),this.fsQuad.render(o))}dispose(){this.material.dispose(),this.fsQuad.dispose()}}class MaskPass extends Pass{constructor(o,c){super(),this.scene=o,this.camera=c,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(o,c,d){const _=o.getContext(),v=o.state;let b,tt;v.buffers.color.setMask(!1),v.buffers.depth.setMask(!1),v.buffers.color.setLocked(!0),v.buffers.depth.setLocked(!0),this.inverse?(b=0,tt=1):(b=1,tt=0),v.buffers.stencil.setTest(!0),v.buffers.stencil.setOp(_.REPLACE,_.REPLACE,_.REPLACE),v.buffers.stencil.setFunc(_.ALWAYS,b,4294967295),v.buffers.stencil.setClear(tt),v.buffers.stencil.setLocked(!0),o.setRenderTarget(d),this.clear&&o.clear(),o.render(this.scene,this.camera),o.setRenderTarget(c),this.clear&&o.clear(),o.render(this.scene,this.camera),v.buffers.color.setLocked(!1),v.buffers.depth.setLocked(!1),v.buffers.color.setMask(!0),v.buffers.depth.setMask(!0),v.buffers.stencil.setLocked(!1),v.buffers.stencil.setFunc(_.EQUAL,1,4294967295),v.buffers.stencil.setOp(_.KEEP,_.KEEP,_.KEEP),v.buffers.stencil.setLocked(!0)}}class ClearMaskPass extends Pass{constructor(){super(),this.needsSwap=!1}render(o){o.state.buffers.stencil.setLocked(!1),o.state.buffers.stencil.setTest(!1)}}class EffectComposer{constructor(o,c){if(this.renderer=o,this._pixelRatio=o.getPixelRatio(),c===void 0){const d=o.getSize(new three_module.I9Y);this._width=d.width,this._height=d.height,(c=new three_module.nWS(this._width*this._pixelRatio,this._height*this._pixelRatio,{type:three_module.ix0})).texture.name="EffectComposer.rt1"}else this._width=c.width,this._height=c.height;this.renderTarget1=c,this.renderTarget2=c.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],this.copyPass=new ShaderPass(CopyShader),this.copyPass.material.blending=three_module.XIg,this.clock=new three_module.zD7}swapBuffers(){const o=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=o}addPass(o){this.passes.push(o),o.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(o,c){this.passes.splice(c,0,o),o.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(o){const c=this.passes.indexOf(o);c!==-1&&this.passes.splice(c,1)}isLastEnabledPass(o){for(let c=o+1;c<this.passes.length;c++)if(this.passes[c].enabled)return!1;return!0}render(o){o===void 0&&(o=this.clock.getDelta());const c=this.renderer.getRenderTarget();let d=!1;for(let _=0,v=this.passes.length;_<v;_++){const b=this.passes[_];if(b.enabled!==!1){if(b.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(_),b.render(this.renderer,this.writeBuffer,this.readBuffer,o,d),b.needsSwap){if(d){const tt=this.renderer.getContext(),it=this.renderer.state.buffers.stencil;it.setFunc(tt.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,o),it.setFunc(tt.EQUAL,1,4294967295)}this.swapBuffers()}MaskPass!==void 0&&(b instanceof MaskPass?d=!0:b instanceof ClearMaskPass&&(d=!1))}}this.renderer.setRenderTarget(c)}reset(o){if(o===void 0){const c=this.renderer.getSize(new three_module.I9Y);this._pixelRatio=this.renderer.getPixelRatio(),this._width=c.width,this._height=c.height,(o=this.renderTarget1.clone()).setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=o,this.renderTarget2=o.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(o,c){this._width=o,this._height=c;const d=this._width*this._pixelRatio,_=this._height*this._pixelRatio;this.renderTarget1.setSize(d,_),this.renderTarget2.setSize(d,_);for(let v=0;v<this.passes.length;v++)this.passes[v].setSize(d,_)}setPixelRatio(o){this._pixelRatio=o,this.setSize(this._width,this._height)}dispose(){this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.copyPass.dispose()}}class EffectComposer2 extends EffectComposer{constructor(o,c){super(o,c)}setPixelRatio(o,c=!0){const d=this.setSize;c||(this.setSize=()=>{}),super.setPixelRatio(o),c||(this.setSize=d)}}class Box3B extends three_module.NRn{expandByObject(o,c=!1,d=!1,_){var v;if(((v=o.userData)===null||v===void 0?void 0:v.bboxVisible)===!1)return this;if(!o.visible&&d)return this;if(_&&_(o))return this;if(o.updateWorldMatrix(!1,!1),o.boundingBox!==void 0)o.boundingBox===null&&o.computeBoundingBox(),_box.copy(o.boundingBox),_box.applyMatrix4(o.matrixWorld),this.union(_box);else{const tt=o.geometry;if(tt!==void 0)if(c&&tt.attributes!=null&&tt.attributes.position!==void 0){const it=tt.attributes.position;for(let nt=0,lt=it.count;nt<lt;nt++)_vector.fromBufferAttribute(it,nt).applyMatrix4(o.matrixWorld),this.expandByPoint(_vector)}else tt.boundingBox===null&&tt.computeBoundingBox(),_box.copy(tt.boundingBox),_box.applyMatrix4(o.matrixWorld),this.union(_box)}const b=o.children;for(let tt=0,it=b.length;tt<it;tt++)this.expandByObject(b[tt],c,d,_);return this}expandByObjects(o,c=!1,d=!1,_){for(let v=0,b=o.length;v<b;v++)this.expandByObject(o[v],c,d,_);return this}getPoints(){return[new three_module.Pq0(this.min.x,this.min.y,this.min.z),new three_module.Pq0(this.min.x,this.min.y,this.max.z),new three_module.Pq0(this.min.x,this.max.y,this.min.z),new three_module.Pq0(this.min.x,this.max.y,this.max.z),new three_module.Pq0(this.max.x,this.min.y,this.min.z),new three_module.Pq0(this.max.x,this.min.y,this.max.z),new three_module.Pq0(this.max.x,this.max.y,this.min.z),new three_module.Pq0(this.max.x,this.max.y,this.max.z)]}getScreenSpaceBounds(o){const c=this.getPoints(),d=new three_module.UtB;for(const _ of c){const v=_.project(o);d.min.min(v),d.max.max(v)}return d}}const _box=new Box3B,_vector=new three_module.Pq0;function computeMikkTSpaceTangents(h,o,c=!0){if(!o||!o.isReady)throw new Error("BufferGeometryUtils: Initialized MikkTSpace library required.");if(!h.hasAttribute("position")||!h.hasAttribute("normal")||!h.hasAttribute("uv"))throw new Error('BufferGeometryUtils: Tangents require "position", "normal", and "uv" attributes.');function d(b){if(b.normalized||b.isInterleavedBufferAttribute){const tt=new Float32Array(b.count*b.itemSize);for(let it=0,nt=0;it<b.count;it++)tt[nt++]=b.getX(it),tt[nt++]=b.getY(it),b.itemSize>2&&(tt[nt++]=b.getZ(it));return tt}return b.array instanceof Float32Array?b.array:new Float32Array(b.array)}const _=h.index?h.toNonIndexed():h,v=o.generateTangents(d(_.attributes.position),d(_.attributes.normal),d(_.attributes.uv));if(c)for(let b=3;b<v.length;b+=4)v[b]*=-1;return _.setAttribute("tangent",new three_module.THS(v,4)),h!==_&&h.copy(_),h}function mergeGeometries(h,o=!1){const c=h[0].index!==null,d=new Set(Object.keys(h[0].attributes)),_=new Set(Object.keys(h[0].morphAttributes)),v={},b={},tt=h[0].morphTargetsRelative,it=new three_module.LoY;let nt=0;for(let lt=0;lt<h.length;++lt){const ut=h[lt];let ht=0;if(c!==(ut.index!==null))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+lt+". All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them."),null;for(const _t in ut.attributes){if(!d.has(_t))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+lt+'. All geometries must have compatible attributes; make sure "'+_t+'" attribute exists among all geometries, or in none of them.'),null;v[_t]===void 0&&(v[_t]=[]),v[_t].push(ut.attributes[_t]),ht++}if(ht!==d.size)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+lt+". Make sure all geometries have the same number of attributes."),null;if(tt!==ut.morphTargetsRelative)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+lt+". .morphTargetsRelative must be consistent throughout all geometries."),null;for(const _t in ut.morphAttributes){if(!_.has(_t))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+lt+".  .morphAttributes must be consistent throughout all geometries."),null;b[_t]===void 0&&(b[_t]=[]),b[_t].push(ut.morphAttributes[_t])}if(o){let _t;if(c)_t=ut.index.count;else{if(ut.attributes.position===void 0)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+lt+". The geometry must have either an index or a position attribute"),null;_t=ut.attributes.position.count}it.addGroup(nt,_t,lt),nt+=_t}}if(c){let lt=0;const ut=[];for(let ht=0;ht<h.length;++ht){const _t=h[ht].index;for(let ft=0;ft<_t.count;++ft)ut.push(_t.getX(ft)+lt);lt+=h[ht].attributes.position.count}it.setIndex(ut)}for(const lt in v){const ut=mergeAttributes(v[lt]);if(!ut)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed while trying to merge the "+lt+" attribute."),null;it.setAttribute(lt,ut)}for(const lt in b){const ut=b[lt][0].length;if(ut===0)break;it.morphAttributes=it.morphAttributes||{},it.morphAttributes[lt]=[];for(let ht=0;ht<ut;++ht){const _t=[];for(let bt=0;bt<b[lt].length;++bt)_t.push(b[lt][bt][ht]);const ft=mergeAttributes(_t);if(!ft)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed while trying to merge the "+lt+" morphAttribute."),null;it.morphAttributes[lt].push(ft)}}return it}function mergeAttributes(h){let o,c,d,_=-1,v=0;for(let nt=0;nt<h.length;++nt){const lt=h[nt];if(lt.isInterleavedBufferAttribute)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. InterleavedBufferAttributes are not supported."),null;if(o===void 0&&(o=lt.array.constructor),o!==lt.array.constructor)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.array must be of consistent array types across matching attributes."),null;if(c===void 0&&(c=lt.itemSize),c!==lt.itemSize)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.itemSize must be consistent across matching attributes."),null;if(d===void 0&&(d=lt.normalized),d!==lt.normalized)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.normalized must be consistent across matching attributes."),null;if(_===-1&&(_=lt.gpuType),_!==lt.gpuType)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.gpuType must be consistent across matching attributes."),null;v+=lt.array.length}const b=new o(v);let tt=0;for(let nt=0;nt<h.length;++nt)b.set(h[nt].array,tt),tt+=h[nt].array.length;const it=new three_module.THS(b,c,d);return _!==void 0&&(it.gpuType=_),it}function deepCloneAttribute(h){return h.isInstancedInterleavedBufferAttribute||h.isInterleavedBufferAttribute?deinterleaveAttribute(h):h.isInstancedBufferAttribute?new three_module.uWO().copy(h):new three_module.THS().copy(h)}function interleaveAttributes(h){let o,c=0,d=0;for(let nt=0,lt=h.length;nt<lt;++nt){const ut=h[nt];if(o===void 0&&(o=ut.array.constructor),o!==ut.array.constructor)return console.error("AttributeBuffers of different types cannot be interleaved"),null;c+=ut.array.length,d+=ut.itemSize}const _=new three_module.eB$(new o(c),d);let v=0;const b=[],tt=["getX","getY","getZ","getW"],it=["setX","setY","setZ","setW"];for(let nt=0,lt=h.length;nt<lt;nt++){const ut=h[nt],ht=ut.itemSize,_t=ut.count,ft=new three_module.eHs(_,ht,v,ut.normalized);b.push(ft),v+=ht;for(let bt=0;bt<_t;bt++)for(let xt=0;xt<ht;xt++)ft[it[xt]](bt,ut[tt[xt]](bt))}return b}function deinterleaveAttribute(h){const o=h.data.array.constructor,c=h.count,d=h.itemSize,_=h.normalized,v=new o(c*d);let b;b=h.isInstancedInterleavedBufferAttribute?new three_module.uWO(v,d,_,h.meshPerAttribute):new three_module.THS(v,d,_);for(let tt=0;tt<c;tt++)b.setX(tt,h.getX(tt)),d>=2&&b.setY(tt,h.getY(tt)),d>=3&&b.setZ(tt,h.getZ(tt)),d>=4&&b.setW(tt,h.getW(tt));return b}function deinterleaveGeometry(h){const o=h.attributes,c=h.morphTargets,d=new Map;for(const _ in o){const v=o[_];v.isInterleavedBufferAttribute&&(d.has(v)||d.set(v,deinterleaveAttribute(v)),o[_]=d.get(v))}for(const _ in c){const v=c[_];v.isInterleavedBufferAttribute&&(d.has(v)||d.set(v,deinterleaveAttribute(v)),c[_]=d.get(v))}}function estimateBytesUsed(h){let o=0;for(const d in h.attributes){const _=h.getAttribute(d);o+=_.count*_.itemSize*_.array.BYTES_PER_ELEMENT}const c=h.getIndex();return o+=c?c.count*c.itemSize*c.array.BYTES_PER_ELEMENT:0,o}function mergeVertices(h,o=1e-4){const c=o>0;o=Math.max(o,Number.EPSILON);const d={},_=h.getIndex(),v=h.getAttribute("position"),b=_?_.count:v.count;let tt=0;const it=Object.keys(h.attributes),nt={},lt={},ut=[],ht=["getX","getY","getZ","getW"],_t=["setX","setY","setZ","setW"];for(let Pt=0,Rt=it.length;Pt<Rt;Pt++){const kt=it[Pt],Gt=h.attributes[kt];nt[kt]=new three_module.THS(new Gt.array.constructor(Gt.count*Gt.itemSize),Gt.itemSize,Gt.normalized);const Dt=h.morphAttributes[kt];Dt&&(lt[kt]=new three_module.THS(new Dt.array.constructor(Dt.count*Dt.itemSize),Dt.itemSize,Dt.normalized))}const ft=.5*o,bt=Math.log10(1/o),xt=Math.pow(10,bt),St=ft*xt;for(let Pt=0;Pt<b;Pt++){const Rt=_?_.getX(Pt):Pt;let kt="";for(let Gt=0,Dt=it.length;Gt<Dt&&c;Gt++){const It=it[Gt],Nt=h.getAttribute(It),Vt=Nt.itemSize;for(let Kt=0;Kt<Vt;Kt++)kt+=~~(Nt[ht[Kt]](Rt)*xt+St)+","}if(c&&kt in d)ut.push(d[kt]);else{for(let Gt=0,Dt=it.length;Gt<Dt;Gt++){const It=it[Gt],Nt=h.getAttribute(It),Vt=h.morphAttributes[It],Kt=Nt.itemSize,Yt=nt[It],nr=lt[It];for(let rr=0;rr<Kt;rr++){const lr=ht[rr],or=_t[rr];if(Yt[or](tt,Nt[lr](Rt)),Vt)for(let pr=0,hr=Vt.length;pr<hr;pr++)nr[pr][or](tt,Vt[pr][lr](Rt))}}c&&(d[kt]=tt),ut.push(tt),tt++}}const wt=h.clone();for(const Pt in h.attributes){const Rt=nt[Pt];if(wt.setAttribute(Pt,new three_module.THS(Rt.array.slice(0,tt*Rt.itemSize),Rt.itemSize,Rt.normalized)),Pt in lt)for(let kt=0;kt<lt[Pt].length;kt++){const Gt=lt[Pt][kt];wt.morphAttributes[Pt][kt]=new three_module.THS(Gt.array.slice(0,tt*Gt.itemSize),Gt.itemSize,Gt.normalized)}}return wt.setIndex(ut),wt}function toTrianglesDrawMode(h,o){if(o===three_module.RJ4)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),h;if(o===three_module.rYR||o===three_module.O49){let c=h.getIndex();if(c===null){const b=[],tt=h.getAttribute("position");if(tt===void 0)return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),h;for(let it=0;it<tt.count;it++)b.push(it);h.setIndex(b),c=h.getIndex()}const d=c.count-2,_=[];if(o===three_module.rYR)for(let b=1;b<=d;b++)_.push(c.getX(0)),_.push(c.getX(b)),_.push(c.getX(b+1));else for(let b=0;b<d;b++)b%2==0?(_.push(c.getX(b)),_.push(c.getX(b+1)),_.push(c.getX(b+2))):(_.push(c.getX(b+2)),_.push(c.getX(b+1)),_.push(c.getX(b)));_.length/3!==d&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const v=h.clone();return v.setIndex(_),v.clearGroups(),v}return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",o),h}function computeMorphedAttributes(h){const o=new three_module.Pq0,c=new three_module.Pq0,d=new three_module.Pq0,_=new three_module.Pq0,v=new three_module.Pq0,b=new three_module.Pq0,tt=new three_module.Pq0,it=new three_module.Pq0,nt=new three_module.Pq0;function lt(pr,hr,ur,cr,br,fr,kr,gr){o.fromBufferAttribute(hr,br),c.fromBufferAttribute(hr,fr),d.fromBufferAttribute(hr,kr);const tr=pr.morphTargetInfluences;if(ur&&tr){tt.set(0,0,0),it.set(0,0,0),nt.set(0,0,0);for(let dr=0,Ir=ur.length;dr<Ir;dr++){const Xr=tr[dr],Jr=ur[dr];Xr!==0&&(_.fromBufferAttribute(Jr,br),v.fromBufferAttribute(Jr,fr),b.fromBufferAttribute(Jr,kr),cr?(tt.addScaledVector(_,Xr),it.addScaledVector(v,Xr),nt.addScaledVector(b,Xr)):(tt.addScaledVector(_.sub(o),Xr),it.addScaledVector(v.sub(c),Xr),nt.addScaledVector(b.sub(d),Xr)))}o.add(tt),c.add(it),d.add(nt)}pr.isSkinnedMesh&&(pr.applyBoneTransform(br,o),pr.applyBoneTransform(fr,c),pr.applyBoneTransform(kr,d)),gr[3*br+0]=o.x,gr[3*br+1]=o.y,gr[3*br+2]=o.z,gr[3*fr+0]=c.x,gr[3*fr+1]=c.y,gr[3*fr+2]=c.z,gr[3*kr+0]=d.x,gr[3*kr+1]=d.y,gr[3*kr+2]=d.z}const ut=h.geometry,ht=h.material;let _t,ft,bt;const xt=ut.index,St=ut.attributes.position,wt=ut.morphAttributes.position,Pt=ut.morphTargetsRelative,Rt=ut.attributes.normal,kt=ut.morphAttributes.position,Gt=ut.groups,Dt=ut.drawRange;let It,Nt,Vt,Kt,Yt,nr,rr;const lr=new Float32Array(St.count*St.itemSize),or=new Float32Array(Rt.count*Rt.itemSize);if(xt!==null)if(Array.isArray(ht))for(It=0,Vt=Gt.length;It<Vt;It++)for(Yt=Gt[It],nr=Math.max(Yt.start,Dt.start),rr=Math.min(Yt.start+Yt.count,Dt.start+Dt.count),Nt=nr,Kt=rr;Nt<Kt;Nt+=3)_t=xt.getX(Nt),ft=xt.getX(Nt+1),bt=xt.getX(Nt+2),lt(h,St,wt,Pt,_t,ft,bt,lr),lt(h,Rt,kt,Pt,_t,ft,bt,or);else for(nr=Math.max(0,Dt.start),rr=Math.min(xt.count,Dt.start+Dt.count),It=nr,Vt=rr;It<Vt;It+=3)_t=xt.getX(It),ft=xt.getX(It+1),bt=xt.getX(It+2),lt(h,St,wt,Pt,_t,ft,bt,lr),lt(h,Rt,kt,Pt,_t,ft,bt,or);else if(Array.isArray(ht))for(It=0,Vt=Gt.length;It<Vt;It++)for(Yt=Gt[It],nr=Math.max(Yt.start,Dt.start),rr=Math.min(Yt.start+Yt.count,Dt.start+Dt.count),Nt=nr,Kt=rr;Nt<Kt;Nt+=3)_t=Nt,ft=Nt+1,bt=Nt+2,lt(h,St,wt,Pt,_t,ft,bt,lr),lt(h,Rt,kt,Pt,_t,ft,bt,or);else for(nr=Math.max(0,Dt.start),rr=Math.min(St.count,Dt.start+Dt.count),It=nr,Vt=rr;It<Vt;It+=3)_t=It,ft=It+1,bt=It+2,lt(h,St,wt,Pt,_t,ft,bt,lr),lt(h,Rt,kt,Pt,_t,ft,bt,or);return{positionAttribute:St,normalAttribute:Rt,morphedPositionAttribute:new three_module.qtW(lr,3),morphedNormalAttribute:new three_module.qtW(or,3)}}function mergeGroups(h){if(h.groups.length===0)return console.warn("THREE.BufferGeometryUtils.mergeGroups(): No groups are defined. Nothing to merge."),h;let o=h.groups;if(o=o.sort((b,tt)=>b.materialIndex!==tt.materialIndex?b.materialIndex-tt.materialIndex:b.start-tt.start),h.getIndex()===null){const b=h.getAttribute("position"),tt=[];for(let it=0;it<b.count;it+=3)tt.push(it,it+1,it+2);h.setIndex(tt)}const c=h.getIndex(),d=[];for(let b=0;b<o.length;b++){const tt=o[b],it=tt.start,nt=it+tt.count;for(let lt=it;lt<nt;lt++)d.push(c.getX(lt))}h.dispose(),h.setIndex(d);let _=0;for(let b=0;b<o.length;b++){const tt=o[b];tt.start=_,_+=tt.count}let v=o[0];h.groups=[v];for(let b=1;b<o.length;b++){const tt=o[b];v.materialIndex===tt.materialIndex?v.count+=tt.count:(v=tt,h.groups.push(v))}return h}function toCreasedNormals(h,o=Math.PI/3){const c=Math.cos(o),d=100*(1+1e-10),_=[new three_module.Pq0,new three_module.Pq0,new three_module.Pq0],v=new three_module.Pq0,b=new three_module.Pq0,tt=new three_module.Pq0,it=new three_module.Pq0;function nt(bt){return`${~~(bt.x*d)},${~~(bt.y*d)},${~~(bt.z*d)}`}const lt=h.index?h.toNonIndexed():h,ut=lt.attributes.position,ht={};for(let bt=0,xt=ut.count/3;bt<xt;bt++){const St=3*bt,wt=_[0].fromBufferAttribute(ut,St+0),Pt=_[1].fromBufferAttribute(ut,St+1),Rt=_[2].fromBufferAttribute(ut,St+2);v.subVectors(Rt,Pt),b.subVectors(wt,Pt);const kt=new three_module.Pq0().crossVectors(v,b).normalize();for(let Gt=0;Gt<3;Gt++){const Dt=nt(_[Gt]);Dt in ht||(ht[Dt]=[]),ht[Dt].push(kt)}}const _t=new Float32Array(3*ut.count),ft=new three_module.THS(_t,3,!1);for(let bt=0,xt=ut.count/3;bt<xt;bt++){const St=3*bt,wt=_[0].fromBufferAttribute(ut,St+0),Pt=_[1].fromBufferAttribute(ut,St+1),Rt=_[2].fromBufferAttribute(ut,St+2);v.subVectors(Rt,Pt),b.subVectors(wt,Pt),tt.crossVectors(v,b).normalize();for(let kt=0;kt<3;kt++){const Gt=ht[nt(_[kt])];it.set(0,0,0);for(let Dt=0,It=Gt.length;Dt<It;Dt++){const Nt=Gt[Dt];tt.dot(Nt)>c&&it.add(Nt)}it.normalize(),ft.setXYZ(St+kt,it.x,it.y,it.z)}}return lt.setAttribute("normal",ft),lt}function mergeBufferGeometries(h,o=!1){return console.warn("THREE.BufferGeometryUtils: mergeBufferGeometries() has been renamed to mergeGeometries()."),mergeGeometries(h,o)}function mergeBufferAttributes(h){return console.warn("THREE.BufferGeometryUtils: mergeBufferAttributes() has been renamed to mergeAttributes()."),mergeAttributes(h)}function computeScreenSpaceBoundingBox(h,o){let c,d;if(Array.isArray(h))for(const v of h){const b=computeScreenSpaceBoundingBox(v,o);c===void 0||d===void 0?(c=b.min.clone(),d=b.max.clone()):(c.min(b.min),d.max(b.max))}const _=h;if(_.geometry!==void 0){const v=_.geometry.vertices;if(v===void 0&&_.geometry.attributes!==void 0&&"position"in _.geometry.attributes){const b=new three_module.Pq0,tt=_.geometry.attributes.position;for(let it=0;it<tt.count*tt.itemSize;it+=tt.itemSize){b.set(tt.array[it],tt.array[it+1],tt.array[3]);const nt=b.applyMatrix4(h.matrixWorld).project(o),lt=new three_module.I9Y(nt.x,nt.y);c===void 0||d===void 0?(c=lt.clone(),d=lt.clone()):(c.min(lt),d.max(lt))}}else for(const b of v){const tt=b.clone().applyMatrix4(h.matrixWorld).project(o),it=new three_module.I9Y(tt.x,tt.y);c===void 0||d===void 0?(c=it.clone(),d=it.clone()):(c.min(it),d.max(it))}}if(h.children!==void 0)for(const v of h.children){const b=computeScreenSpaceBoundingBox(v,o);c===void 0||d===void 0?(c=b.min.clone(),d=b.max.clone()):(c.min(b.min),d.max(b.max))}return new three_module.UtB(c,d)}const RGBM16ColorSpace_="rgbm-16";function getTexelDecodingFunction(h,o){let c;switch(o){case three_module.jf0:case three_module.Zr2:case three_module.er$:c="";break;case three_module.DAr:c="RGBM16ToLinear";break;default:console.warn("THREE.WebGLProgram: Unsupported color space:",o),c=""}return`#define ${h}( value ) ${c} ( value )`}function getTexelDecoding(h,o){return getTexelDecodingFunction(h+"TexelToLinear",o??three_module.Zr2)+`
`}function uniform({uniforms:h,propKey:o,thisTarget:c=!1}={}){const d=!!h,_=!!o,v=c;return(b,tt)=>{const it=nt=>{const lt=v?nt:d?h:nt.uniforms||nt._uniforms;let ut=_?o:tt;v&&(ut="_"+ut);let ht=lt[ut];return ht||(ht={value:null},lt[ut]=ht),ht};Object.defineProperty(b,tt,{get(){return it(this).value},set(nt){it(this).value=nt,S$2(this,"uniformsNeedUpdate",!0,!0)}})}}function matDefine(h,o,c=!1,d){const _=!!o,v=!!h;return(b,tt)=>{const it=nt=>({t:_?o:nt.defines||nt._defines,p:v?h:tt});Object.defineProperty(b,tt,{get(){const{t:nt,p:lt}=it(c?this:this.material);return nt[lt]},set(nt){const{t:lt,p:ut}=it(c?this:this.material);if(S$2(lt,ut,nt,!0),typeof d=="function"){const ht=[ut,nt];if(d.name){const _t=this[d.name];_t===d?d.call(this,...ht):_t.name===`bound ${d.name}`?_t(...ht):d(...ht)}else d(...ht)}else S$2(c?this:this.material,"needsUpdate",!0,!0)}})}}function dataTextureFromColor(h){const o=new three_module.GYF(new Uint8Array([Math.floor(255*h.r),Math.floor(255*h.g),Math.floor(255*h.b),255]),1,1,three_module.GWd,three_module.OUM);return o.needsUpdate=!0,o.colorSpace=three_module.jf0,o}function dataTextureFromVec4(h){const o=new three_module.GYF(new Uint8Array([Math.floor(255*h.x),Math.floor(255*h.y),Math.floor(255*h.z),Math.floor(255*h.w)]),1,1,three_module.GWd,three_module.OUM);return o.needsUpdate=!0,o}function setThreeRendererMode(h,o,c){const d=h.userData,{backgroundRender:_,transparentRender:v,shadowMapRender:b,mainRenderPass:tt,opaqueRender:it,transmissionRender:nt,sceneRender:lt,screenSpaceRendering:ut}=d;o.backgroundRender!==void 0&&(d.backgroundRender=o.backgroundRender),o.transparentRender!==void 0&&(d.transparentRender=o.transparentRender),o.shadowMapRender!==void 0&&(d.shadowMapRender=o.shadowMapRender),o.mainRenderPass!==void 0&&(d.mainRenderPass=o.mainRenderPass),o.opaqueRender!==void 0&&(d.opaqueRender=o.opaqueRender),o.sceneRender!==void 0&&(d.sceneRender=o.sceneRender),o.transmissionRender!==void 0&&(d.transmissionRender=o.transmissionRender),o.screenSpaceRendering!==void 0&&(d.screenSpaceRendering=o.screenSpaceRendering),c(),d.backgroundRender=_,d.transparentRender=v,d.shadowMapRender=b,d.mainRenderPass=tt,d.opaqueRender=it,d.sceneRender=lt,d.transmissionRender=nt,d.screenSpaceRendering=ut}function autoCenterObject3D(h,o=!1){if(o){if(!h.userData.autoCentered||!h.userData._lastCenter)return h;h.position.add(h.userData._lastCenter),delete h.userData.autoCentered,delete h.userData.isCentered,delete h.userData._lastCenter}else{const c=new Box3B().expandByObject(h,!0,!0).getCenter(new three_module.Pq0);h.userData._lastCenter=c,h.position.sub(c),h.userData.autoCentered=!0,h.userData.isCentered=!0}return h.dispatchEvent({type:"objectUpdate",undo:o}),h}function pivotToBBoxCenter(h){return pivotToPoint(h,new Box3B().expandByObject(h,!0,!0).getCenter(new three_module.Pq0))}function pivotToPoint(h,o){var c;const d=new three_module.Pq0().copy(o),_=new three_module.Pq0().copy(d),v=new three_module.kn4().copy(h.matrixWorld).invert(),b=(c=h.parent)===null||c===void 0?void 0:c.matrixWorld,tt=new three_module.kn4;b!==void 0&&tt.copy(b).invert(),d.applyMatrix4(tt);const it=h.position.clone();return h.position.copy(d),_.applyMatrix4(v).negate(),h.geometry&&h.geometry.translate(_.x,_.y,_.z),h.children.forEach(nt=>{nt.position.add(_)}),h.dispatchEvent({type:"objectUpdate"}),()=>{h.position.copy(it),h.geometry&&h.geometry.translate(-_.x,-_.y,-_.z),h.children.forEach(nt=>{nt.position.sub(_)}),h.dispatchEvent({type:"objectUpdate",undo:!0})}}function autoScaleObject3D(h,o,c,d=!1){let _=1;if(d){if(!h.userData.autoScaled||!h.userData._lastScaleRadius)return h;const v=h.userData.autoScaleRadius||o||1;if(_=h.userData._lastScaleRadius/v,!isFinite(_))return h;h.userData.autoScaled=!0,h.userData.autoScaleRadius=o,delete h.userData._lastScaleRadius}else{const v=.5*new Box3B().expandByObject(h,!0,!0).getSize(new three_module.Pq0).length();if(o===void 0&&(o=h.userData.autoScaleRadius||1),_=o/v,!isFinite(_))return h;h.userData.autoScaled=!0,h.userData.autoScaleRadius=o,h.userData._lastScaleRadius=v}return h.userData.pseudoCentered?h.children.forEach(v=>{v.scale.multiplyScalar(_)}):h.scale.multiplyScalar(_),(c||h.userData.isCentered)&&h.position.multiplyScalar(_),h.traverse(v=>{var b,tt;v.isLight&&!((tt=(b=v.shadow)===null||b===void 0?void 0:b.camera)===null||tt===void 0)&&tt.right&&(v.shadow.camera.right*=_,v.shadow.camera.left*=_,v.shadow.camera.top*=_,v.shadow.camera.bottom*=_),v.isCamera&&v.right&&(v.right*=_,v.left*=_,v.top*=_,v.bottom*=_)}),h.dispatchEvent({type:"objectUpdate",undo:d}),h}function toIndexedGeometry(h,o=-1){return mergeVertices(h,o)}function makeSamplerUi(h,o,c,d,_){return _=_??(()=>h.setDirty&&h.setDirty()),{type:"folder",label:c??o+" Sampler",hidden:()=>!h[o]||d&&d(),children:[()=>({type:"vec2",label:"Repeat",bounds:[-100,100],stepSize:.001,property:[h[o],"repeat"],onChange:_}),()=>({type:"vec2",label:"Offset",bounds:[-2,2],stepSize:.001,property:[h[o],"offset"],onChange:_}),()=>({type:"vec2",label:"Center",bounds:[-2,2],stepSize:.001,property:[h[o],"center"],onChange:_}),()=>({type:"input",label:"Rotation",stepSize:.001,bounds:[-Math.PI,Math.PI],property:[h[o],"rotation"],onChange:_}),()=>({type:"dropdown",label:"Color Space",property:[h[o],"colorSpace"],children:[["Linear",three_module.Zr2],["sRGB",three_module.er$]].map(v=>({label:v[0],value:v[1]})),onChange:[()=>{const v=h[o];v&&(v.needsUpdate=!0)},_]}),()=>({type:"checkbox",label:"Flip Y",getValue:()=>{var v,b;return(b=(v=h[o])===null||v===void 0?void 0:v.flipY)!==null&&b!==void 0&&b},setValue:v=>{const b=h[o];if(b&&b.flipY!==v)if(b.image&&ImageBitmap&&b.image instanceof ImageBitmap){const tt=b,it=b.source.data;createImageBitmap(it,{imageOrientation:"flipY"}).then(nt=>{it.close&&it.close(),tt.flipY=v,tt.source.data=nt,tt.source.needsUpdate=!0,tt.needsUpdate=!0,_&&_()})}else b.flipY=v,b.needsUpdate=!0,_&&_()}}),()=>({type:"dropdown",label:"Wrap S",property:[h[o],"wrapS"],children:[["ClampToEdge",three_module.ghU],["MirroredRepeat",three_module.kTW],["Repeat",three_module.GJx]].map(v=>({label:v[0],value:v[1]})),onChange:[()=>{h[o]&&(h[o].needsUpdate=!0)},_]}),()=>({type:"dropdown",label:"Wrap T",property:[h[o],"wrapT"],children:[["ClampToEdge",three_module.ghU],["MirroredRepeat",three_module.kTW],["Repeat",three_module.GJx]].map(v=>({label:v[0],value:v[1]})),onChange:[()=>{h[o]&&(h[o].needsUpdate=!0)},_]}),()=>({type:"input",label:"Anisotropy",bounds:[1,6],stepSize:1,property:[h[o],"anisotropy"],onChange:[()=>{h[o]&&(h[o].needsUpdate=!0),h.needsUpdate=!0},_]}),()=>({type:"dropdown",label:"Min Filter",property:[h[o],"minFilter"],children:[["Linear",three_module.k6q],["Nearest",three_module.hxR],["NearestMipmapNearest",three_module.pHI],["NearestMipmapLinear",three_module.a$r],["LinearMipmapNearest",three_module.kRr],["LinearMipmapLinear",three_module.$_I]].map(v=>({label:v[0],value:v[1]})),onChange:[()=>{h[o]&&(h[o].needsUpdate=!0)},_]}),()=>({type:"dropdown",label:"Mag Filter",property:[h[o],"magFilter"],children:[["Linear",three_module.k6q],["Nearest",three_module.hxR]].map(v=>({label:v[0],value:v[1]})),onChange:[()=>{h[o]&&(h[o].needsUpdate=!0)},_]})]}}const iMaterialIgnoredUserData=["appliedMeshes","imageLoadAwaiter","inverseModelMatrix","uvTransform","uuid","iMaterial"];function copyMaterialUserData(h,o,c=!0){if(!o)return h;for(const d of Object.keys(o)){if(c&&iMaterialIgnoredUserData.includes(d)||d.startsWith("__"))continue;const _=o[d];if(typeof h[d]=="function"||typeof _=="function")continue;const v=!_||_.isTexture||_.isObject3D||_.isMaterial;v||typeof _.clone!="function"?v||typeof _!="object"&&!Array.isArray(_)?h[d]=_:h[d]=copyMaterialUserData(Array.isArray(_)?[]:{},_,!1):h[d]=_.clone()}return h}const iTextureIgnoredUserData=["appliedMaterials","uuid"];function copyTextureUserData(h,o){if(o)for(const c of Object.keys(o))iTextureIgnoredUserData.includes(c)||c.startsWith("__")||typeof h[c]!="function"&&typeof o[c]!="function"&&(h[c]=o[c]);return h}function textureDataToImageData(h,o,c){var d;const _=(d=c==null?void 0:c.data)!==null&&d!==void 0?d:new Uint8ClampedArray(h.height*h.width*4),v=h.data instanceof Float32Array,b=h.data instanceof Uint16Array;for(let tt=0;tt<_.length;tt++)_[tt]=v?255*h.data[tt]:b?255*three_module.GxU.fromHalfFloat(h.data[tt]):h.data[tt],o===three_module.Zr2&&(_[tt]=255*ve$1(_[tt]/255));return c??new ImageData(_,h.width,h.height)}function textureToCanvas(h,o,c=!1){let d;return d=h.isDataTexture?textureDataToImageData(h.image,h.colorSpace):h.image,texImageToCanvas(d,o,c)}function texImageToCanvas(h,o,c=!1){const d=document.createElement("canvas");d.width=Math.min(o,h.width),d.height=Math.floor(1+d.width*h.height/h.width);const _=d.getContext("2d");if(!_)return console.error("textureToDataUrl: could not get canvas context"),d;c===!0&&(_.translate(0,d.height),_.scale(1,-1));let v=!1;if(h.data!==void 0){const b=h;if(h.width!==d.width||h.height!==d.height){const tt=document.createElement("canvas");tt.width=h.width,tt.height=h.height;const it=tt.getContext("2d");it?(it.putImageData(b,0,0),_.drawImage(tt,0,0,d.width,d.height)):(console.error("textureToDataUrl: could not get temp canvas context"),_.putImageData(b,0,0))}else _.putImageData(b,0,0),c&&(v=!0)}else _.drawImage(h,0,0,d.width,d.height);return v?Ke$1(d):d}function textureToDataUrl(h,o,c,d,_){return textureToCanvas(h,o,c).toDataURL(d,_)}String.prototype.replaceAll||(String.prototype.replaceAll=function(h,o){return Object.prototype.toString.call(h).toLowerCase()==="[object regexp]"?this.replace(h,o):this.replace(new RegExp(h,"g"),o)});const typeMap=new Map;function serialize(h){return(o,c)=>{const d=o.constructor;if(d===Object)throw new Error("All properties in an object are serialized by default");typeMap.has(d)||typeMap.set(d,[]),typeMap.get(d).push([h||c,c])}}const serializers={obj:(h,o)=>Object.fromEntries(Object.entries(h).map(([c,d])=>[c,serializeObject(d,!1,o)])),vec4:h=>({x:h.x,y:h.y,z:h.z,w:h.w,isVector4:!0}),vec3:h=>({x:h.x,y:h.y,z:h.z,isVector3:!0}),vec2:h=>({x:h.x,y:h.y,isVector2:!0}),color:h=>({r:h.r,g:h.g,b:h.b,isColor:!0}),quat:h=>({x:h.x,y:h.y,z:h.z,w:h.w,isQuaternion:!0}),texture:(h,o)=>{var c;if(!(h!=null&&h.isTexture))throw new Error("Expected a texture");if(o!=null&&o.textures[h.uuid])return{uuid:h.uuid,resource:"textures"};if(h.isRenderTargetTexture&&!(!((c=h.userData)===null||c===void 0)&&c.serializableRenderTarget))return;const d=h.source.data,_=!h.isRenderTargetTexture&&h.userData.rootPath;_&&h.source.data&&(h.userData.__embedUrlImagePreviews?h.source.data=textureToCanvas(h,16,h.flipY):h.source.data=null);const v=h.userData;h.userData={};const b={images:{}};let tt={};try{tt=h.toJSON(o||b),!o&&tt.image&&(tt.image=_&&!h.userData.__embedUrlImagePreviews?void 0:b.images[tt.image]),tt.userData=serializeObject(copyTextureUserData({},v),!1,o)}catch(it){console.error(it)}return h.userData=v,_&&(o&&!h.userData.__embedUrlImagePreviews&&delete o.images[h.source.uuid],h.source.data=d),o!=null&&o.textures&&!tt.resource&&(o.textures[tt.uuid]||(o.textures[tt.uuid]=tt),tt={uuid:tt.uuid,resource:"textures"}),tt},material:(h,o)=>{var c;if(!(h!=null&&h.isMaterial))throw new Error("Expected a material");if(!((c=o==null?void 0:o.materials)===null||c===void 0)&&c[h.uuid])return{uuid:h.uuid,resource:"materials"};h.userData.rootPath&&console.error("TODO: handle material with root path with material inheritance/hierarchy");const d=o??{textures:{},images:{}},_={},v={};for(const[tt,it]of Object.entries(h))if(it!=null&&it.isTexture&&!tt.startsWith("__")){const nt=serializers.texture(it,d);_[tt]=nt,v[tt]=it,h[tt]=nt?{isTexture:!0,toJSON:()=>nt}:null}let b=h.toJSON(o||d);for(const[tt,it]of Object.entries(v))h[tt]=it,delete v[tt];if(o){for(const[tt,it]of Object.entries(_))it&&(b[tt]=it);o!=null&&o.materials&&(o.materials[b.uuid]||(o.materials[b.uuid]=b),b={uuid:b.uuid,resource:"materials"})}else{for(const[tt,it]of Object.entries(_))it&&(b[tt]=it.uuid);b.textures=Object.values(d.textures),b.images=Object.values(d.images)}return b}},copier=h=>(o,c)=>{var d,_;return(_=(d=c==null?void 0:c.copy)===null||d===void 0?void 0:d.call(c,o))!==null&&_!==void 0?_:new h().copy(o)},deserializers={obj:(h,o,c)=>Object.assign(o,Object.fromEntries(Object.entries(h).map(([d,_])=>[d,deserializeObject(_,o==null?void 0:o[d],!1,c)]))),vec4:copier(three_module.IUQ),vec3:copier(three_module.Pq0),vec2:copier(three_module.I9Y),color:copier(three_module.Q1f),quat:copier(three_module.PTz)};function serializeObject(h,o,c){var d,_;if(typeof h=="function")return;if(Array.isArray(h))return h.map(tt=>serializeObject(tt,!1,c));if(typeof h!="object"){if(typeof h=="number"){if(h===1/0)return"Infinity";if(h===-1/0)return"-Infinity";if(isNaN(h))return"NaN"}return h}if(!h)return h;let v=(d=h.constructor)!==null&&d!==void 0?d:Object;if(v===Object)return serializers.obj(h,c);if(h.isVector2)return serializers.vec2(h);if(h.isVector3)return serializers.vec3(h);if(h.isVector4)return serializers.vec4(h);if(h.isColor)return serializers.color(h);if(h.isQuaternion)return serializers.quat(h);if(h.isTexture)return serializers.texture(h,c);if(h.isMaterial)return serializers.material(h,c);if(!o&&typeof h.toJSON=="function"){const tt=h.toJSON(c);return h.serializableClassId&&tt&&(tt.serializableClassId=h.serializableClassId),tt}const b={};for(;v&&v!==Object;)(_=typeMap.get(v))===null||_===void 0||_.forEach(([tt,it])=>{const nt=h[it];b[tt]=serializeObject(nt,!1,c)}),v=Object.getPrototypeOf(v);return h.serializableClassId&&(b.serializableClassId=h.serializableClassId),b}function deserializeObject(h,o,c,d={}){var _,v,b;let tt=o;if(h===void 0)return tt;if(typeof o=="number"){if(h==="Infinity")return 1/0;if(h==="-Infinity")return-1/0;if(h==="NaN")return NaN;if(typeof h=="number"||!h)return h}if(Array.isArray(h)){const lt=h.length;Array.isArray(tt)||(tt=[]);for(let ut=0;ut<lt;ut++){const ht=h[ut],_t=tt.length>ut?deserializeObject(ht,tt[ut],!1,d):deserializeObject(ht,void 0,!1,d);tt.length<=ut?tt.push(_t):tt[ut]=_t}return tt}let it=!1;if(h&&h.resource&&typeof h.resource=="string"&&(h=(_=d[h.resource])===null||_===void 0?void 0:_[h.uuid],it=!0),!tt&&h&&!it)if(h.serializableClassId){const lt=serializableClasses.get(h.serializableClassId);lt&&(tt=lt.DataInConstructor?new lt(h):new lt)}else typeof h!="object"||h.constructor&&h.constructor!==Object||(tt={});if(typeof tt=="function")return console.error("cannot deserialize over function",tt,h),tt;if(h&&typeof h=="object"&&!it){if(h.isVector2)return deserializers.vec2(h,tt);if(h.isVector3)return deserializers.vec3(h,tt);if(h.isVector4)return deserializers.vec4(h,tt);if(h.isColor)return deserializers.color(h,tt);if(h.isQuaternion)return deserializers.quat(h,tt)}if(h==null||tt==null||typeof tt!="object"||tt.isTexture)return it&&(h?h.__useCount=h.__useCount?h.__useCount+1:1:console.warn("probable error deserialize: resource not found.")),h;let nt=(v=tt.constructor)!==null&&v!==void 0?v:Object;if(nt===Object)return deserializers.obj(h,tt,d);if(!c&&typeof tt.fromJSON=="function")return tt.isMaterial&&(Object.entries(h).forEach(([lt,ut])=>{var ht;if(!ut||!ut.resource||typeof ut.resource!="string")return;const _t=(ht=d[ut.resource])===null||ht===void 0?void 0:ht[ut.uuid];h[lt]=_t||null}),h.userData&&(h.userData=deserializeObject(h.userData,void 0,!1,d))),tt.fromJSON(h,d),tt;for(;nt&&nt!==Object;)(b=typeMap.get(nt))===null||b===void 0||b.forEach(([lt,ut])=>{const ht=tt[ut],_t=deserializeObject(h[lt],ht,!1,d);_t!==ht&&S$2(tt,ut,_t,!0)}),nt=Object.getPrototypeOf(nt);return tt}const serializableClasses=new Map;function serializable(h){return o=>(o=class extends o{constructor(){super(...arguments),this.serializableClassId=h}},serializableClasses.set(h,o),o)}function serializeTextureInExtras(h,o,c,d){var _,v,b;if(o!=null&&o.extras[h.uuid])return{uuid:h.uuid,resource:"extras"};let tt="";if(!((_=h.source)===null||_===void 0)&&_._sourceImgBuffer||h.userData.__sourceBuffer){const nt=new Uint8Array(((v=h.source)===null||v===void 0?void 0:v._sourceImgBuffer)||h.userData.__sourceBuffer),lt=d||h.userData.mimeType||"";tt={data:Array.from(nt),type:nt.constructor.name,path:((b=h.userData.__sourceBlob)===null||b===void 0?void 0:b.name)||h.userData.rootPath||"file."+lt.split("/")[1]},lt&&(tt.mimeType=lt)}else h.userData.rootPath?tt=h.userData.rootPath:console.error("Unable to serialize LUT texture, not loaded through asset manager.");const it={uuid:h.uuid,url:tt,userData:copyTextureUserData({},h.userData),type:h.type,name:c||h.name};return o!=null&&o.extras?(o.extras[h.uuid]=it,{uuid:h.uuid,resource:"extras"}):it}var __decorate=function(h,o,c,d){var _,v=arguments.length,b=v<3?o:d===null?d=Object.getOwnPropertyDescriptor(o,c):d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(h,o,c,d);else for(var tt=h.length-1;tt>=0;tt--)(_=h[tt])&&(b=(v<3?_(b):v>3?_(o,c,b):_(o,c))||b);return v>3&&b&&Object.defineProperty(o,c,b),b};let BaseRenderer=class extends I$2{get composer(){return this._composer}get passes(){return this._passes}get isWebGL2(){return this._isWebGL2}get composerTarget(){return this._composerTarget}get renderSize(){return this._renderSize}get displayCanvasScaling(){return this._displayCanvasScaling}set displayCanvasScaling(h){h!==this._displayCanvasScaling&&(this._displayCanvasScaling=h,this.setSize(void 0,void 0,!0))}get frameCount(){return this._frameCount}get totalFrameCount(){return this._totalFrameCount}set pipeline(h){this._pipeline=h,this._passesNeedsUpdate=!0}get pipeline(){return this._pipeline}refreshPipeline(){var h,o,c;const d=this._passes,_=[],v={};for(const b of d){if(b.enabled===!1)continue;const tt={after:(h=b.after)!==null&&h!==void 0?h:[],before:(o=b.before)!==null&&o!==void 0?o:[],dependencies:new Set((c=b.required)!==null&&c!==void 0?c:[])};v[b.passId]=tt}for(const[b,tt]of Object.entries(v)){const it=new Set([...tt.after,...tt.before]);tt.dependencies.forEach(nt=>it.has(nt)&&it.delete(nt)),it.forEach(nt=>{const lt=v[nt];if(lt){if(lt.dependencies.has(b))throw console.error("cyclic",b,nt),"Cyclic dependency";tt.dependencies.add(nt)}})}for(;;){let b=!1;const tt=[...Object.entries(v)];for(const[it,nt]of tt)if(!_.includes(it)&&Ce$1(_,nt.dependencies.values())){const lt=Math.max(-1,...nt.after.map(ht=>_.indexOf(ht))),ut=Math.min(_.length,...nt.before.map(ht=>{const _t=_.indexOf(ht);return _t<0?_.length:_t}));if(lt>=ut)throw console.error(nt,d,_,lt,ut),"Not possible";_.splice(nt.after.length>0?lt+1:ut,0,it),b=!0,delete v[it]}if(Object.keys(v).length<1)break;if(!b)throw console.error(tt,v,_),"Not possible 2"}return this.pipeline=_,this.pipeline}get context(){return this._context}get rendererObject(){return this._renderer}_animationLoop(h,o){const c=h-this._lastTime;this._lastTime=h,this.frameWaitTime-=c,this.frameWaitTime>0||(this.frameWaitTime=0,this.dispatchEvent({type:"animationLoop",deltaTime:c,time:h,renderer:this,xrFrame:o}))}get clock(){return this._composer.clock}registerPass(h,o=!0){var c;if(o)for(const d of[...this._passes])h.passId===d.passId&&this.unregisterPass(d);this._passes.push(h),(c=h.onRegister)===null||c===void 0||c.call(h,this),this._passesNeedsUpdate=!0,this._updated()}unregisterPass(h){var o;const c=this._passes.indexOf(h);c>=0&&((o=h.onUnregister)===null||o===void 0||o.call(h,this),this._passes.splice(c,1),this._passesNeedsUpdate=!0,this._updated())}constructor({animationLoop:h,canvas:o,alpha:c=!0,targetOptions:d,maxHDRIntensity:_}){super(),this._isWebGL2=!1,this._trackedTargets=[],this.dirty=!0,this._lastTime=0,this.frameWaitTime=0,this._passes=[],this._pipeline=[],this._passesNeedsUpdate=!0,this._displayCanvasScaling=1,this._renderSize=new three_module.I9Y(512,512),this._frameCount=0,this.defaultRenderToScreen=!0,this._tempTargets={},this.maxTempPerKey=5,this._totalFrameCount=0,this.stableNoise=!1,this._animationLoop=this._animationLoop.bind(this),this._processNewTarget=this._processNewTarget.bind(this),this._processNewTempTarget=this._processNewTempTarget.bind(this),this.trackTarget=this.trackTarget.bind(this),this.disposeTarget=this.disposeTarget.bind(this),this.createTarget=this.createTarget.bind(this),this.createTargetCustom=this.createTargetCustom.bind(this),this.maxHDRIntensity=_||120,this._renderer=new three_module.JeP({canvas:o,antialias:!1,alpha:c,premultipliedAlpha:!0,preserveDrawingBuffer:!0,powerPreference:"high-performance"}),this._renderer.baseRenderer=this,this._renderer.setAnimationLoop(this._animationLoop),this._context=this._renderer.getContext(),this._isWebGL2=this._renderer.capabilities.isWebGL2,this._isWebGL2||console.error("WebGi BaseRenderer: WebGL1 is not supported anymore. Some features may not work"),this._renderer.onContextLost=v=>{this.dispatchEvent({type:"contextLost",event:v})},this._renderer.onContextRestore=()=>{this.dispatchEvent({type:"contextRestored"})},this._renderSize=new three_module.I9Y(o.clientWidth,o.clientHeight),this._renderer.setSize(this._renderSize.width,this._renderSize.height,!1),this._renderer.setPixelRatio(this._displayCanvasScaling),this._renderer.toneMapping=three_module.y_p,this._renderer.toneMappingExposure=.1,this._renderer.outputColorSpace=three_module.jf0,this._renderer.shadowMap.enabled=!0,this._renderer.shadowMap.type=three_module.QP0,this._renderer.shadowMap.autoUpdate=!1,this.resetShadows(),this._composerTarget=this.createTarget(d,!1),this._composerTarget.texture.name="EffectComposer.rt1",this._composer=new EffectComposer2(this._renderer,this._composerTarget),h&&this.addEventListener("animationLoop",h)}setSize(h,o,c=!1){!c&&(h?Math.abs(h-this._renderSize.width):0)+(o?Math.abs(o-this._renderSize.height):0)<.1||(h&&(this._renderSize.width=h),o&&(this._renderSize.height=o),this.rendererObject.xr.enabled&&this.rendererObject.xr.isPresenting||(this._renderer.setSize(this._renderSize.width,this._renderSize.height,!1),this._renderer.setPixelRatio(this._displayCanvasScaling)),this._composer.setPixelRatio(this._displayCanvasScaling,!1),this._composer.setSize(this._renderSize.width,this._renderSize.height),this._trackedTargets.forEach(d=>{const _=d,v=_.sizeMultiplier;if(v){const b=this._renderSize.clone().multiplyScalar(this._displayCanvasScaling*v);_.setSize(Math.floor(b.width),Math.floor(b.height))}}),this.dispatchEvent({type:"resize"}),this._updated(),this.reset())}blit(h,o,{viewport:c,material:d,shader:_,pass:v,clear:b=!0}={}){const tt=this._composer.copyPass,{renderToScreen:it,material:nt,uniforms:lt,clear:ut}=tt;d&&(tt.material=d);const ht=this._renderer.getViewport(new three_module.IUQ),_t=this._renderer.autoClear,ft=this._renderer.getRenderTarget();c&&this._renderer.setViewport(new three_module.IUQ().fromArray(c)),this._renderer.autoClear=!1,tt.uniforms=tt.material.uniforms,tt.renderToScreen=!1,tt.clear=b,setThreeRendererMode(this._renderer,{sceneRender:!0,opaqueRender:!0,shadowMapRender:!1,backgroundRender:!1,transparentRender:!0,transmissionRender:!1},()=>{tt.render(this._renderer,o??null,{texture:h},0,!1)}),tt.renderToScreen=it,tt.clear=ut,tt.material=nt,tt.uniforms=lt,this._renderer.autoClear=_t,c&&this._renderer.setViewport(ht),this._renderer.setRenderTarget(ft)}clearColor({r:h,g:o,b:c,a:d,target:_,depth:v=!0,stencil:b=!0}){var tt;const it=this._renderer.getClearColor(new three_module.Q1f),nt=this._renderer.getClearAlpha();this._renderer.setClearColor(new three_module.Q1f(h??it.r,o??it.g,c??it.b),d??nt);const lt=this._renderer.getRenderTarget(),ut=this._renderer.getActiveCubeFace(),ht=this._renderer.getActiveMipmapLevel();_&&typeof _.clear=="function"?_.clear(this._renderer,!0,v,b):(this._renderer.setRenderTarget((tt=_)!==null&&tt!==void 0?tt:null),this._renderer.clear(!0,v,b)),this._renderer.setRenderTarget(lt,ut,ht),this._renderer.setClearColor(it,nt)}renderModel(h,o){this._renderer.render(h.modelObject,o.cameraObject)}renderScene(h){const o=h.activeCamera;o&&this.renderModel(h,o)}_updated(){this.dispatchEvent({type:"update"})}render(h){var o;this._passesNeedsUpdate&&this.refreshPasses();for(const c of this._passes)c.passObject.enabled&&((o=c.update)===null||o===void 0||o.call(c));h=h??this.defaultRenderToScreen,this._composer.renderToScreen=h,this._composer.render(),this._composer.renderToScreen=!0,h&&(this._frameCount+=1,this._totalFrameCount+=1),this.dirty=!1}updateDirty(){this.dirty=this.dirty||this._passes.findIndex(h=>h.dirty)>=0}reset(){this._frameCount=0,this.dirty=!0}resetShadows(){this._renderer.shadowMap.needsUpdate=!0}refreshPasses(){if(!this._passesNeedsUpdate)return;this._passesNeedsUpdate=!1;const h=[];for(const o of this._pipeline){const c=this._passes.find(d=>d.passId===o);c?h.push(c.passObject):console.warn("WebGi BaseRenderer: Unable to find pass: ",o)}[...this._composer.passes].forEach(o=>this._composer.removePass(o)),h.forEach(o=>this._composer.addPass(o)),this._updated()}dispose(){this._trackedTargets.forEach(h=>h.dispose()),this._trackedTargets=[],this._renderer.dispose()}trackTarget(h){this._trackedTargets.push(h)}removeTrackedTarget(h){const o=this._trackedTargets.indexOf(h);o>=0&&this._trackedTargets.splice(o,1)}createTarget({sizeMultiplier:h,samples:o=0,colorSpace:c=three_module.jf0,type:d=three_module.OUM,format:_=three_module.GWd,depthBuffer:v=!0,depthTexture:b=!1,depthTextureType:tt=three_module.bkx,depthTextureFormat:it=three_module.zdS,size:nt,textureCount:lt=1,...ut}={},ht=!0){this.isWebGL2||(o=0),h!==void 0&&nt!==void 0&&console.error("Both sizeMultiplier and size are defined. sizeMultiplier will be ignored."),(nt=nt||this._renderSize.clone().multiplyScalar(this._displayCanvasScaling*(h=h||1))).width=Math.floor(nt.width),nt.height=Math.floor(nt.height);const _t=b?new three_module.VCu(nt.width,nt.height,tt):null;_t&&(_t.format=it);const ft=this.createTargetCustom(lt>1?{width:nt.width,height:nt.height,count:lt}:nt,{samples:o,colorSpace:c,type:d,format:_,depthBuffer:v,depthTexture:_t},lt>1?three_module.AT1:three_module.nWS);return this._processNewTarget(ft,h,ht),this._setTargetOptions(ft,ut),ft}_processNewTarget(h,o,c){return o!==void 0&&(h.sizeMultiplier=o),c&&this.trackTarget(h),h}disposeTarget(h){if(h){if(h.isTemporary)return this.releaseTempTarget(h);this.removeTrackedTarget(h),h.dispose()}}createTargetCustom({width:h,height:o,count:c},d={},_){var v;const b=this._processNewTarget,tt=this.renderTargetToDataUrl.bind(this);this.renderTargetToBuffer.bind(this);let it=[h,o];if(c&&c>1&&it.push(c),(_==null?void 0:_.prototype)===three_module.o6l.prototype){if(h!==o)throw"Width and height of cube render target must be equal";it=[h]}d={format:three_module.GWd,minFilter:three_module.k6q,magFilter:three_module.k6q,generateMipmaps:!1,type:three_module.OUM,colorSpace:three_module.jf0,...d};const nt=[this,...it,d];return new class extends((v=_)!==null&&v!==void 0?v:three_module.nWS){constructor(lt,...ut){super(...ut),this.renderer=lt,this.assetType="renderTarget",this.name="RenderTarget",Array.isArray(this.texture)?this.texture.forEach(ht=>{ht.__target=this,ht.userData||(ht.userData={}),ht.colorSpace=d.colorSpace,ht.toJSON=()=>(console.warn("WebGi RenderTarget: Multiple render target texture.toJSON not supported yet."),{})}):(this.texture.userData||(this.texture.userData={}),this.texture.__toJSON=this.texture.toJSON,this.texture.__target=this,this.texture.toJSON=function(ht){console.warn("WebGi RenderTarget: Render target texture.toJSON might be buggy."),this.source.data.url=tt(this.__target,"image/png",90);const _t=this.__toJSON.call(this,ht);return delete this.source.data.url,_t.isRenderTargetTexture=!0,_t})}setSize(lt,ut,ht){super.setSize(Math.floor(lt),Math.floor(ut),ht)}clone(lt=!0){if(this.isTemporary)throw"Cloning temporary render targets not supported";if(Array.isArray(this.texture))throw"Cloning multiple render targets not supported";const ut=super.clone();return ut.texture.isRenderTargetTexture=!0,b(ut,this.sizeMultiplier||1,lt)}}(...nt)}getTempTarget(h={}){var o;const c=createRenderTargetKey(h);let d;return!((o=this._tempTargets[c])===null||o===void 0)&&o.length&&(d=this._tempTargets[c].pop()),d?this._setTargetOptions(d,h):(d=this.createTarget(h),this._processNewTempTarget(d,c)),d}_processNewTempTarget(h,o){return h.isTemporary=!0,h.targetKey=o,this._tempTargets[o]===void 0&&(this._tempTargets[o]=[]),h}releaseTempTarget(h){const o=h.targetKey;if(!o||!h.isTemporary)throw"Not a temp target";this._tempTargets[o].length>this.maxTempPerKey?(this.removeTrackedTarget(h),h.dispose()):this._tempTargets[o].push(h)}updateShaderProperties(h){return this.stableNoise?h.uniforms.frameCount?h.uniforms.frameCount.value=this._totalFrameCount:console.warn("WebGi BaseRenderer: no uniform: frameCount"):h.uniforms.frameCount?h.uniforms.frameCount.value=this.frameCount:console.warn("WebGi BaseRenderer:  no uniform: frameCount"),h.uniforms.frameCount2&&(h.uniforms.frameCount2.value=this.frameCount),this}_setTargetOptions(h,o){var c,d,_;h.texture.minFilter=(c=o.minFilter)!==null&&c!==void 0?c:three_module.k6q,h.texture.magFilter=(d=o.magFilter)!==null&&d!==void 0?d:three_module.k6q,h.texture.generateMipmaps=(_=o.generateMipmaps)!==null&&_!==void 0&&_,h.texture.generateMipmaps&&h.texture.minFilter===three_module.k6q&&(h.texture.minFilter=three_module.NZq),h.texture.generateMipmaps||h.texture.minFilter!==three_module.NZq||(h.texture.minFilter=three_module.k6q)}renderTargetToDataUrl(h,o="image/png",c=90,d=0){const _=document.createElement("canvas");_.width=h.width,_.height=h.height;const v=_.getContext("2d");if(!v)throw new Error("Unable to get 2d context");const b=Array.isArray(h.texture)?h.texture[d]:h.texture,tt=v.createImageData(h.width,h.height,{colorSpace:["display-p3","srgb"].includes(b.colorSpace)?b.colorSpace:void 0});if(b.type===three_module.ix0){const nt=new Uint16Array(h.width*h.height*4);this._renderer.readRenderTargetPixels(h,0,0,h.width,h.height,nt,void 0,d),textureDataToImageData({data:nt,width:h.width,height:h.height},b.colorSpace,tt)}else if(b.type===three_module.RQf){const nt=new Float32Array(h.width*h.height*4);this._renderer.readRenderTargetPixels(h,0,0,h.width,h.height,nt,void 0,d),textureDataToImageData({data:nt,width:h.width,height:h.height},b.colorSpace,tt)}else this._renderer.readRenderTargetPixels(h,0,0,h.width,h.height,tt.data,void 0,d);v.putImageData(tt,0,0);const it=_.toDataURL(o,c);return _.remove(),it}renderTargetToBuffer(h,o=0){const c=(Array.isArray(h.texture)?h.texture[o]:h.texture).type===three_module.ix0?new Uint16Array(h.width*h.height*4):new Uint8Array(h.width*h.height*4);return this._renderer.readRenderTargetPixels(h,0,0,h.width,h.height,c,void 0,o),c}get useLegacyLights(){return this.rendererObject.useLegacyLights}set useLegacyLights(h){this.rendererObject.useLegacyLights=h,this._updated(),this.resetShadows()}get useTotalFrameCount(){return console.warn("WebGi BaseRenderer: useTotalFrameCount is deprecated, use stableNoise instead"),this.stableNoise}set useTotalFrameCount(h){console.warn("WebGi BaseRenderer: useTotalFrameCount is deprecated, use stableNoise instead"),this.stableNoise=h}get renderScale(){return this.displayCanvasScaling}set renderScale(h){this.displayCanvasScaling=h}};function createRenderTargetKey(h={}){var o,c;return[h.sizeMultiplier,h.samples,h.colorSpace,h.type,h.format,h.depthBuffer,h.depthTexture,(o=h.size)===null||o===void 0?void 0:o.width,(c=h.size)===null||c===void 0?void 0:c.height].join(";")}function autoGPUInstanceMeshes(h){var o,c,d,_,v,b,tt,it;if(!h.isMaterial&&!h.isBufferGeometry)return;const nt=Array.from(h.userData.__appliedMeshes).filter(_t=>!_t.isInstancedMesh&&!!_t.parent&&_t.children.length===0&&!Array.isArray(_t.material));if(nt.length<2)return;const lt=_t=>{var ft;return _t.parent.uuid+"_"+_t.geometry.uuid+"_"+((ft=_t.material)===null||ft===void 0?void 0:ft.uuid)},ut=new Map;for(const _t of nt){const ft=lt(_t);ut.has(ft)||ut.set(ft,[]),ut.get(ft).push(_t),_t.updateMatrix()}const ht=ut.keys();for(const _t of ht){const ft=ut.get(_t),bt=ft[0];if(!bt||ft.length<2)continue;const xt=new three_module.ZLX(bt.geometry,bt.material,ft.length),St=bt.userData;bt.userData={},xt.copy(bt),copyObject3DUserData(xt.userData,St);const wt=bt.parent;xt.position.set(0,0,0),xt.rotation.set(0,0,0),xt.scale.set(1,1,1),xt.updateMatrix();const Pt=new Float32Array(3*xt.count),Rt=new Float32Array(4*xt.count),kt=new Float32Array(3*xt.count);for(let Gt=0;Gt<ft.length;Gt++){const Dt=ft[Gt],It=Dt.matrix;It.determinant()<0&&(It.elements[0]*=-1,It.elements[1]*=-1,It.elements[2]*=-1),xt.setMatrixAt(Gt,It),Dt.position.toArray(Pt,3*Gt),Dt.quaternion.toArray(Rt,4*Gt),Dt.scale.toArray(kt,3*Gt),Dt.removeFromParent(),(d=(c=(o=Dt.material)===null||o===void 0?void 0:o.userData)===null||c===void 0?void 0:c.__appliedMeshes)===null||d===void 0||d.delete(Dt),(b=(v=(_=Dt.geometry)===null||_===void 0?void 0:_.userData)===null||v===void 0?void 0:v.__appliedMeshes)===null||b===void 0||b.delete(Dt)}(it=(tt=xt.material.userData)===null||tt===void 0?void 0:tt.__appliedMeshes)===null||it===void 0||it.add(xt),xt.geometry.userData.__appliedMeshes.add(xt),xt.sourceTrs={TRANSLATION:new three_module.THS(Pt,3),ROTATION:new three_module.THS(Rt,4),SCALE:new three_module.THS(kt,3)},xt.instanceMatrix.needsUpdate=!0,wt.add(xt),wt.setDirty(),console.log("autoGPUInstanceMeshes",_t,ft.length,bt,xt)}}__decorate([serialize()],BaseRenderer.prototype,"stableNoise",void 0),__decorate([serialize()],BaseRenderer.prototype,"useLegacyLights",null),BaseRenderer=__decorate([serializable("RenderManager")],BaseRenderer);class GLTFMeshGpuInstancingExporter{constructor(o){this.writer=o,this.name="EXT_mesh_gpu_instancing"}writeNode(o,c){if(!o.isInstancedMesh)return;const d=this.writer,_=o;let v=_.sourceTrs;if(!v){const b=new Float32Array(3*_.count),tt=new Float32Array(4*_.count),it=new Float32Array(3*_.count),nt=new three_module.kn4,lt=new three_module.Pq0,ut=new three_module.PTz,ht=new three_module.Pq0;for(let _t=0;_t<_.count;_t++)_.getMatrixAt(_t,nt),nt.decompose(lt,ut,ht),lt.toArray(b,3*_t),ut.toArray(tt,4*_t),ht.toArray(it,3*_t);v={TRANSLATION:new three_module.THS(b,3),ROTATION:new three_module.THS(tt,4),SCALE:new three_module.THS(it,3)}}v={TRANSLATION:d.processAccessor(v.TRANSLATION),ROTATION:d.processAccessor(v.ROTATION),SCALE:d.processAccessor(v.SCALE)},_.instanceColor&&(v._COLOR_0=d.processAccessor(_.instanceColor)),d.extensionsUsed[this.name]=!0,d.extensionsRequired[this.name]=!0,c.extensions=c.extensions||{},c.extensions[this.name]={attributes:v}}}function makeObject3DUiConfig(h,o){if(h.uiConfig)return h.uiConfig;const c={type:"folder",label:()=>h.name||"unnamed",expanded:!0,limitedUi:!0,children:[{type:"checkbox",label:"Visible",property:[h,"visible"],limitedUi:!0},{type:"button",label:"Pick/Focus",value:()=>{h.dispatchEvent({type:"select",ui:!0,value:h,focusCamera:!0})}},{type:"button",label:"Pick Parent",hidden:()=>!h.parent,value:()=>{const _=h.parent;_&&_.dispatchEvent({type:"select",ui:!0,value:_})}},{type:"input",label:"Name",property:[h,"name"],onChange:_=>{var v;_.last&&((v=h.setDirty)===null||v===void 0||v.call(h,{sceneUpdate:!0,refreshUi:!0}))}},{type:"checkbox",label:"Casts Shadow",hidden:()=>!h.isMesh,property:[h,"castShadow"]},{type:"checkbox",label:"Receive Shadow",hidden:()=>!h.isMesh,property:[h,"receiveShadow"]},{type:"checkbox",label:"Frustum culled",property:[h,"frustumCulled"]},{type:"vec3",label:"Position",property:[h,"position"],limitedUi:!0},{type:"vec3",label:"Rotation",property:[h,"rotation"],limitedUi:!0},{type:"vec3",label:"Scale",property:[h,"scale"]},{type:"input",label:"Render Order",property:[h,"renderOrder"]},{type:"button",label:"Auto Scale",prompt:["Auto Scale Radius: Object will be scaled to the given radius",h.userData.autoScaleRadius||"2",!0],value:_=>{if(!_)return;const v=parseFloat(_);return Math.abs(v)>0?(autoScaleObject3D(h,v),()=>autoScaleObject3D(h,v,void 0,!0)):void 0}},{type:"button",label:"Auto Center",value:()=>{if(confirm("Auto Center: Object will be centered, are you sure you want to proceed?"))return autoCenterObject3D(h),()=>autoCenterObject3D(h,!0)}},{type:"button",label:"Pivot to Node Center",value:()=>{if(confirm("Pivot to Center: Adjust the pivot to bounding box center. The object will rotate around the new pivot, are you sure you want to proceed?"))return pivotToBBoxCenter(h)}},{type:"folder",label:"Rotate model",children:["X +","X -","Y +","Y -","Z +","Z -"].map(_=>({type:"button",label:"Rotate "+_+"90",value:()=>{var v;h.rotateOnAxis(new three_module.Pq0(_.includes("X")?1:0,_.includes("Y")?1:0,_.includes("Z")?1:0),Math.PI/2*(_.includes("-")?-1:1)),(v=h.setDirty)===null||v===void 0||v.call(h,{sceneUpdate:!0,refreshUi:!1})}}))},h.userData.license!==void 0?{type:"input",label:"License/Credits",property:[h.userData,"license"],limitedUi:!0}:{}]},d=h;if(d!=null&&d.isMesh&&o!==!1){const _=[()=>{const v=Object.entries(d.morphTargetDictionary||{});return v.length?{label:"Morph Targets",type:"folder",children:v.map(([b,tt])=>({type:"slider",label:b,bounds:[0,1],stepSize:1e-4,property:[d.morphTargetInfluences,tt],onChange:it=>{var nt;(nt=h.setDirty)===null||nt===void 0||nt.call(h,{sceneUpdate:it.last,frameFade:!1,refreshUi:!1})}}))}:void 0},()=>{var v;return(v=d.geometry)===null||v===void 0?void 0:v.uiConfig},()=>{var v;return Array.isArray(d.material)?d.material.length<1?void 0:{label:"Materials",type:"folder",children:d.material.map(b=>b==null?void 0:b.uiConfig).filter(b=>b)}:(v=d.material)===null||v===void 0?void 0:v.uiConfig}];c.children.push(..._)}if(h!=null&&h.isCamera){const _=[{type:"button",label:"Set View",value:()=>{var v;h.dispatchEvent({type:"setView",ui:!0,camera:h}),(v=c.uiRefresh)===null||v===void 0||v.call(c,"postFrame",!0)}},{type:"button",label:"Activate main",hidden:()=>{var v;return(v=h.userData.iCamera)===null||v===void 0?void 0:v.isActiveCamera},value:()=>{var v;h.dispatchEvent({type:"activateMain",ui:!0,camera:h}),(v=c.uiRefresh)===null||v===void 0||v.call(c,"postFrame",!0)}},{type:"button",label:"Deactivate main",hidden:()=>{var v;return!(!((v=h.userData.iCamera)===null||v===void 0)&&v.isActiveCamera)},value:()=>{var v;h.dispatchEvent({type:"activateMain",ui:!0,camera:void 0}),(v=c.uiRefresh)===null||v===void 0||v.call(c,"postFrame",!0)}},{type:"checkbox",label:"Auto LookAt Target",getValue:()=>{var v;return(v=h.userData.autoLookAtTarget)!==null&&v!==void 0&&v},setValue:v=>{var b;h.userData.autoLookAtTarget=v,(b=c.uiRefresh)===null||b===void 0||b.call(c,"postFrame",!0)}}];c.children.push(..._)}return h.uiConfig=c,c}function makeGeometryUiConfig(h){return{label:"Geometry",type:"folder",children:[{type:"input",property:[h,"uuid"],disabled:!0},{type:"input",property:[h,"name"]},{type:"button",label:"Center Geometry",value:()=>{h.center()}},{type:"button",label:"Center Geometry (keep position)",value:()=>{const o=new three_module.Pq0;h.center(o),o.negate();const c=h.userData.__appliedMeshes;for(const d of c)d.updateMatrix(),d.position.copy(o).applyMatrix4(d.matrix),d.setDirty&&d.setDirty()}},{type:"button",label:"Compute vertex normals",value:()=>{h.computeVertexNormals()}},{type:"button",label:"Compute vertex tangents",value:()=>{h.computeTangents()}},{type:"button",label:"Normalize normals",value:()=>{h.normalizeNormals()}},{type:"button",label:"Convert to indexed",hidden:()=>!!h.index,value:()=>{var o;if(h.attributes.index)return;const c=parseFloat((o=prompt("Tolerance","-1"))!==null&&o!==void 0?o:"-1");toIndexedGeometry(h,c)}},{type:"button",label:"Convert to non-indexed",hidden:()=>!h.index,value:()=>{h.attributes.index&&h.toNonIndexed()}},{type:"button",label:"Create uv1 from uv",value:()=>{h.hasAttribute("uv1")&&!confirm("uv1 already exists, replace with uv data?")||h.setAttribute("uv1",h.getAttribute("uv"))}},{type:"button",label:"Remove vertex color attribute",hidden:()=>!h.hasAttribute("color"),value:()=>{h.hasAttribute("color")?confirm("Remove color attribute?")&&h.deleteAttribute("color"):prompt("No color attribute found")}},{type:"button",label:"Auto GPU Instances",hidden:()=>!h.userData.__appliedMeshes||h.userData.__appliedMeshes.size<2,value:()=>{autoGPUInstanceMeshes(h)}},{type:"input",label:"Mesh count",get value(){var o,c,d;return(d=(c=(o=h.userData)===null||o===void 0?void 0:o.__appliedMeshes)===null||c===void 0?void 0:c.size)!==null&&d!==void 0?d:0},set value(o){},disabled:!0}]}}function setupIModel(h,o,c){var d;if(!h)return void console.warn("WebGi: setupIModel: object is undefined");if(h.__disposed&&(console.warn("WebGi: re-init/re-add disposed object, things might not work as intended",h),delete h.__disposed),h.userData||(h.userData={}),h.userData.__iModelSetup&&h.modelObject)return h;h.userData.__iModelSetup=!0;let _=[];_.push(()=>{[...h.children].forEach(ut=>{var ht;(ht=ut==null?void 0:ut.dispose)===null||ht===void 0||ht.call(ut),h.add(ut)}),h.parent&&h.removeFromParent()}),h.isLight&&!h.assetType?(h.assetType="light",h.lightObject=h):h.isCamera?(h.assetType="camera",h.cameraObject=h):h.assetType||(h.assetType="model"),h.modelObject||(h.modelObject=h),h.setDirty||(h.setDirty=(ut={})=>{h.dispatchEvent({...ut,type:"objectUpdate",object:h})},h.userData.setDirty&&console.warn("WebGi: userData.setDirty already defined",h.userData.setDirty,h),h.userData.setDirty=ut=>{var ht;console.warn("WebGi: userData.setDirty is deprecated, use setDirty directly"),(ht=h.setDirty)===null||ht===void 0||ht.call(h,ut)}),h.addEventListener("added",ut=>{var ht,_t,ft;const bt=(_t=(ht=h.parent)===null||ht===void 0?void 0:ht.userData.parentRoot)!==null&&_t!==void 0?_t:h.parent;bt!==h.userData.parentRoot&&h.traverse(xt=>{xt.userData.parentRoot=bt}),(ft=h.setDirty)===null||ft===void 0||ft.call(h,{change:"addedToParent"})}),h.addEventListener("removed",()=>{var ut;(ut=h.setDirty)===null||ut===void 0||ut.call(h,{change:"removedFromParent"}),h.userData.parentRoot!==void 0&&h.traverse(ht=>{ht.userData.parentRoot=void 0})}),_.push(()=>{});const v=h.dispose;h.dispose=()=>{h.dispatchEvent({type:"dispose"}),v==null||v.call(h)},h.userData.dispose&&console.warn("WebGi: userData.dispose already defined"),h.userData.dispose=()=>{var ut;console.warn("WebGi: userData.dispose is deprecated, use dispose directly"),(ut=h.dispose)===null||ut===void 0||ut.call(h)};const b=h;!b.isMesh&&!b.isLine||b.userData.__meshSetup||(b.userData.__meshSetup=!0,b.setMaterial||(b.setMaterial=ut=>setMeshMaterial(b,ut)),b.setGeometry||(b.setGeometry=(ut,ht=!1)=>setMeshGeometry(b,ut,ht),b.setGeometry(b.geometry,!0)),h.userData.setMaterial&&console.warn("WebGi: userData.setMaterial already defined"),h.userData.setMaterial=ut=>{var ht;console.warn("WebGi: userData.setMaterial is deprecated, use setMaterial directly"),(ht=h.setMaterial)===null||ht===void 0||ht.call(h,ut)},h.userData.setGeometry&&console.warn("WebGi: userData.setGeometry already defined"),h.userData.setGeometry=(ut,...ht)=>{var _t;console.warn("WebGi: userData.setGeometry is deprecated, use setGeometry directly"),(_t=h.setGeometry)===null||_t===void 0||_t.call(h,ut,...ht)},h.userData.__keepShadowDef||(h.castShadow=!0,h.receiveShadow=!0,h.userData.__keepShadowDef=!0),_.push(()=>{var ut,ht,_t,ft;const bt=((ut=b.setMaterial)===null||ut===void 0?void 0:ut.call(b,void 0))||[],xt=(ht=b.setGeometry)===null||ht===void 0?void 0:ht.call(b,void 0);for(const St of bt)St&&St.userData&&St.userData.disposeOnIdle!==!1&&St.dispose();xt&&xt.userData&&xt.userData.disposeOnIdle!==!1&&xt.dispose(),(_t=b.setMaterial)===null||_t===void 0||_t.call(b,bt),(ft=b.setGeometry)===null||ft===void 0||ft.call(b,xt)})),h.uiConfig||h.assetType!=="model"&&h.assetType!=="camera"||(makeObject3DUiConfig(h),_.push(()=>{})),h.addEventListener("objectUpdate",({last:ut,refreshUi:ht})=>{var _t,ft;return ut!==!1&&ht!==!1&&((ft=(_t=h.uiConfig)===null||_t===void 0?void 0:_t.uiRefresh)===null||ft===void 0?void 0:ft.call(_t,"postFrame",!0,1))}),h.userData.__autoParentDispatchEvents?console.warn("WebGi: object.userData.__autoParentDispatchEvents already set"):(h.userData.__autoParentDispatchEvents=h.userData.__autoParentDispatchEvents||["objectUpdate","materialUpdate","select","materialChanged","textureUpdate"],h.isCamera&&h.userData.__autoParentDispatchEvents.push("activateMain","setView")),o&&(h.userData.parentRoot=o);const tt=h.dispatchEvent;h.dispatchEvent=ut=>{var ht;!((ht=h.userData.__autoParentDispatchEvents)===null||ht===void 0)&&ht.includes(ut.type)&&(ut.parentDispatch=!0),ut.parentDispatch&&(_t=>{var ft;const bt=(ft=h.userData.parentRoot)!==null&&ft!==void 0?ft:h.parent;bt!=null&&bt.modelObject&&bt.dispatchEvent(_t)})(ut),tt.call(h,ut)};const it=h.clone;h.clone=(...ut)=>{const ht=h.userData;h.userData={};let _t=it.call(h,...ut);h.userData=ht,copyObject3DUserData(_t.userData,ht);const ft=h.userData.parentRoot;return ft&&ft.assetType!=="model"&&console.warn("WebGi: Cloning an object with a parent that is not an IModel is not supported"),_t=setupIModel(_t,ft,c),_t.userData.cloneParent=h.uuid,_t};const nt=h.copy;h.copy=(ut,...ht)=>{const _t=ut.userData;ut.userData={};const ft=nt.call(h,ut,...ht);return ut.userData=_t,copyObject3DUserData(h.userData,ut),ft};const lt=h.add;return h.add=(...ut)=>(ut.forEach(ht=>setupIModel(ht,h.userData.parentRoot||h,c)),lt.call(h,...ut)),(h=(d=c==null?void 0:c(h))!==null&&d!==void 0?d:h).addEventListener("dispose",()=>{_.forEach(ut=>ut()),_=[]}),[...h.children].forEach(ut=>setupIModel(ut,h,c)),h}function setMeshMaterial(h,o){var c,d,_,v,b;const tt=(Array.isArray(o)?o:[o]).map(ht=>ht==null?void 0:ht.materialObject).filter(ht=>ht);if(h.material==tt||tt.length===1&&h.material===tt[0])return[];h.userData.__materialUpdater||(h.userData.__materialUpdater=()=>{h.dispatchEvent({type:"materialUpdate"})}),h.userData.__textureUpdater||(h.userData.__textureUpdater=()=>{h.dispatchEvent({type:"textureUpdate"})});let it=[];const nt=[],lt=Array.isArray(h.material)?[...h.material]:[h.material];for(const ht of lt)ht&&it.push(ht);const ut=[];for(const ht of tt)ht.userData.__appliedMeshes||(ht.userData.__appliedMeshes=new Set),ut.push(ht),ht&&(it.includes(ht)?it=it.filter(_t=>_t!==ht):nt.push(ht));h.material=ut.length!==1?ut:(c=ut[0])!==null&&c!==void 0?c:void 0;for(const ht of it)ht.removeEventListener("materialUpdate",h.userData.__materialUpdater),ht.removeEventListener("textureUpdate",h.userData.__textureUpdater),(_=(d=ht.userData)===null||d===void 0?void 0:d.__appliedMeshes)===null||_===void 0||_.delete(h),ht.dispatchEvent({type:"removeFromMesh",mesh:h,object:h});for(const ht of nt)ht.addEventListener("materialUpdate",h.userData.__materialUpdater),ht.addEventListener("textureUpdate",h.userData.__textureUpdater),ht.userData.__appliedMeshes.add(h),ht.dispatchEvent({type:"addToMesh",mesh:h,object:h});return h.dispatchEvent({type:"materialChanged",material:o??void 0,mesh:h}),(b=(v=h.uiConfig)===null||v===void 0?void 0:v.uiRefresh)===null||b===void 0||b.call(v,"postFrame",!0),lt}function setMeshGeometry(h,o,c=!1){var d,_,v,b,tt,it,nt;h.userData.__objectUpdater||(h.userData.__objectUpdater=ht=>{h.dispatchEvent({...ht,type:"objectUpdate"})});let lt=h.geometry;const ut=lt;return(lt!==o||c)&&(lt&&(lt.removeEventListener("geometryUpdate",h.userData.__objectUpdater),(_=(d=lt.userData)===null||d===void 0?void 0:d.__appliedMeshes)===null||_===void 0||_.delete(h)),lt=o,lt&&!lt.userData.__appliedMeshes&&(lt.userData.__appliedMeshes=new Set),h.geometry=(v=lt)!==null&&v!==void 0?v:void 0,lt&&(h.updateMorphTargets(),lt.addEventListener("geometryUpdate",h.userData.__objectUpdater),(tt=(b=lt.userData)===null||b===void 0?void 0:b.__appliedMeshes)===null||tt===void 0||tt.add(h))),o&&!o.uiConfig&&(o.uiConfig=makeGeometryUiConfig(h.geometry)),h.dispatchEvent({type:"geometryChanged",geometry:o??void 0}),(nt=(it=h.uiConfig)===null||it===void 0?void 0:it.uiRefresh)===null||nt===void 0||nt.call(it,"postFrame",!0),ut===lt?void 0:ut||void 0}const iGeometryIgnoredUserData=["appliedMeshes"],iModelIgnoredUserData=["parentRoot","iCamera","iModel"];function copyObject3DUserData(h,o){if(o)for(const c of Object.keys(o))iModelIgnoredUserData.includes(c)||c.startsWith("__")||typeof h[c]!="function"&&typeof o[c]!="function"&&(h[c]=o[c]);return h}var getRandomValues,rnds8=new Uint8Array(16);function rng(){if(!getRandomValues&&!(getRandomValues=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return getRandomValues(rnds8)}var regex=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function validate(h){return typeof h=="string"&&regex.test(h)}for(var esm_browser_validate=validate,byteToHex=[],i=0;i<256;++i)byteToHex.push((i+256).toString(16).substr(1));function stringify(h){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,c=(byteToHex[h[o+0]]+byteToHex[h[o+1]]+byteToHex[h[o+2]]+byteToHex[h[o+3]]+"-"+byteToHex[h[o+4]]+byteToHex[h[o+5]]+"-"+byteToHex[h[o+6]]+byteToHex[h[o+7]]+"-"+byteToHex[h[o+8]]+byteToHex[h[o+9]]+"-"+byteToHex[h[o+10]]+byteToHex[h[o+11]]+byteToHex[h[o+12]]+byteToHex[h[o+13]]+byteToHex[h[o+14]]+byteToHex[h[o+15]]).toLowerCase();if(!esm_browser_validate(c))throw TypeError("Stringified UUID is invalid");return c}var esm_browser_stringify=stringify;function v4(h,o,c){var d=(h=h||{}).random||(h.rng||rng)();if(d[6]=15&d[6]|64,d[8]=63&d[8]|128,o){c=c||0;for(var _=0;_<16;++_)o[c+_]=d[_];return o}return esm_browser_stringify(d)}var esm_browser_v4=v4;const uiConfigDecorators_typeMap=new Map;function uiConfig(h,o){return(c,d)=>{const _=c.constructor;if(_===Object)throw new Error("All properties in an object are serialized by default");uiConfigDecorators_typeMap.has(_)||uiConfigDecorators_typeMap.set(_,[]);const v=uiConfigDecorators_typeMap.get(_);if(!(v.findIndex(b=>b.propKey===d)<0))throw new Error(`Property ${d} already has a uiConfig decorator`);v.push({params:o||{},propKey:d,uiType:h})}}function uiToggle(h,o){return uiConfig("checkbox",{label:h,params:o})}function uiMonitor(h,o){return uiConfig("monitor",{label:h,params:o})}function uiSlider(h,o,c,d){return uiConfig("slider",{label:h,bounds:o,stepSize:c,params:d})}function uiVector(h,o,c,d){return uiConfig("vec",{label:h,bounds:o,stepSize:c,params:d})}function uiDropdown(h,o,c){return uiConfig("dropdown",{label:h,children:o,params:c})}function uiButton(h,o){return uiConfig("button",{label:h,params:o})}function uiInput(h,o){return uiConfig("input",{label:h,params:o})}function uiColor(h,o){return uiConfig("color",{label:h,params:o})}function uiImage(h,o){return uiConfig("image",{label:h,params:o})}function generateUiConfig(h){let o=h==null?void 0:h.constructor;if(!h||!o)return[];const c=[],d=[];for(;o&&o!==Object;)d.push(o),o=Object.getPrototypeOf(o);if(!d.length||Array.isArray(h)){const _=typeof h=="object"?Object.keys(h):Array.isArray(h)?h.map((v,b)=>b):[];for(const v of _){const b=h[v];if(b==null)continue;const tt=b==null?void 0:b.uiConfig;if(tt)c.push(tt);else{const it=valueToUiType(b);it==="folder"?c.push(generateUiFolder(v+"",b,void 0,"folder",!0)):it&&c.push({type:it,label:v+"",property:[h,v]})}}}return d.reverse().forEach(_=>{var v;(v=uiConfigDecorators_typeMap.get(_))===null||v===void 0||v.forEach(({params:b,propKey:tt,uiType:it})=>{let nt;if(!it){const lt=h[tt];nt=lt==null?void 0:lt.uiConfig,nt?c.push(nt):lt!=null&&((it=valueToUiType(lt))==="folder"?nt=generateUiFolder(tt+"",lt,void 0,"folder",!0):it&&(nt={type:it,label:tt+"",property:[h,tt]}))}if(nt||(nt={property:[h,tt],type:it||"input"}),b){const lt=typeof b.params=="function"?b.params(h):b.params||{};delete b.params,Object.assign(nt,{...b,...lt})}c.push(nt)})}),c}function generateUiFolder(h,o,c={},d="folder",_=!1){return{type:d,label:h,children:_?[()=>generateUiConfig(Ee$1(o))]:generateUiConfig(Ee$1(o)),uuid:esm_browser_v4(),...c}}function uiFolder(h,o,c="folder"){return d=>class extends d{constructor(){super(...arguments),this.uiConfig=generateUiFolder(h,this,o||{},c)}}}function uiPanel(h,o){return uiFolder(h,o,"panel")}function valueToUiType(h){return h==null?null:Array.isArray(h)?"folder":typeof h=="boolean"?"checkbox":typeof h=="number"?"number":typeof h=="string"?"input":typeof h=="function"?"button":typeof h.x=="number"?"vec":typeof h.r=="number"?"color":h.isTexture?"image":typeof h=="object"?"folder":null}const _changeEvent={type:"change"},_startEvent={type:"start"},_endEvent={type:"end"},_ray=new three_module.RlV,_plane=new three_module.Zcv,TILT_LIMIT=Math.cos(70*three_module.cj9.DEG2RAD);class OrbitControls extends three_module.Qev{constructor(o,c){super(),this.object=o,this.domElement=c,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new three_module.Pq0,this.minDistance=1e-5,this.maxDistance=1/0,this.autoPushTarget=!0,this.autoPullTarget=!0,this.clampMax=new three_module.Pq0(1/0,1/0,1/0),this.clampMin=new three_module.Pq0(-1/0,-1/0,-1/0),this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.maxZoomSpeed=1,this.maxZoomSpeed=1,this.dollyZoom=!1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.throttleUpdate=0,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:three_module.kBv.ROTATE,MIDDLE:three_module.kBv.DOLLY,RIGHT:three_module.kBv.PAN},this.touches={ONE:three_module.wtR.ROTATE,TWO:three_module.wtR.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return tt.phi},this.getAzimuthalAngle=function(){return tt.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(ar){ar.addEventListener("keydown",Pn),this._domElementKeyEvents=ar},this.stopListenToKeyEvents=function(){this._domElementKeyEvents.removeEventListener("keydown",Pn),this._domElementKeyEvents=null},this.saveState=function(){d.target0.copy(d.target),d.position0.copy(d.object.position),d.zoom0=d.object.zoom},this.reset=function(){d.target.copy(d.target0),d.object.position.copy(d.position0),d.object.zoom=d.zoom0,d.object.updateProjectionMatrix(),d.dispatchEvent(_changeEvent),d.update(),v=_.NONE},this.update=function(){const ar=new three_module.Pq0,vr=new three_module.PTz().setFromUnitVectors(o.up,new three_module.Pq0(0,1,0)),Cr=vr.clone().invert(),Ur=new three_module.Pq0,Pr=new three_module.PTz,Dr=new three_module.Pq0,jr=2*Math.PI;return function(en=null){if(this.throttleUpdate&&this.throttleUpdate>=1&&Date.now()-0<1e3/this.throttleUpdate)return;const rn=d.object.position;ar.copy(rn).sub(d.target),ar.applyQuaternion(vr),tt.setFromVector3(ar),d.autoRotate&&v===_.NONE&&Vt(function(En){return En!==null?2*Math.PI/60*d.autoRotateSpeed*En:2*Math.PI/60/60*d.autoRotateSpeed}(en)),d.enableDamping?(tt.theta+=it.theta*d.dampingFactor,tt.phi+=it.phi*d.dampingFactor):(tt.theta+=it.theta,tt.phi+=it.phi);let mn=d.minAzimuthAngle,bn=d.maxAzimuthAngle;isFinite(mn)&&isFinite(bn)&&(mn<-Math.PI?mn+=jr:mn>Math.PI&&(mn-=jr),bn<-Math.PI?bn+=jr:bn>Math.PI&&(bn-=jr),tt.theta=mn<=bn?Math.max(mn,Math.min(bn,tt.theta)):tt.theta>(mn+bn)/2?Math.max(mn,tt.theta):Math.min(bn,tt.theta)),tt.phi=Math.max(d.minPolarAngle,Math.min(d.maxPolarAngle,tt.phi)),tt.makeSafe(),d.enableDamping===!0?d.target.addScaledVector(lt,d.dampingFactor):d.target.add(lt);let Tn=0;d.zoomToCursor&&Gt||d.object.isOrthographicCamera||(Math.abs(it.radius)>0&&(d.dollyZoom&&(d.object.zoom=Math.max(Math.max(d.minZoom,.1),Math.min(Math.min(d.maxZoom,20),d.object.zoom*(1+it.radius*(d.enableDamping?d.dampingFactor:1)))),d.object.updateProjectionMatrix(),(d.object.zoom>=Math.min(d.maxZoom,20)||d.object.zoom<=Math.max(d.minZoom,.1))&&(it.radius=0)),tt.radius*=1+it.radius*(d.enableDamping?d.dampingFactor:1)),Math.abs(nt-1)>1e-5&&(d.dollyZoom&&(d.object.zoom=Math.max(Math.max(d.minZoom,.1),Math.min(Math.min(d.maxZoom,20),d.object.zoom*nt)),d.object.updateProjectionMatrix(),(d.object.zoom>=Math.min(d.maxZoom,20)||d.object.zoom<=Math.max(d.minZoom,.1))&&(nt=1)),tt.radius*=nt),d.autoPushTarget&&tt.radius<d.minDistance&&(Tn=d.minDistance-tt.radius),d.autoPullTarget&&tt.radius>d.maxDistance&&(Tn=d.maxDistance-tt.radius)),tt.radius=hr(tt.radius),ar.setFromSpherical(tt),ar.applyQuaternion(Cr),rn.copy(d.target).add(ar),d.target.add(ar.normalize().multiplyScalar(-Tn)),rn.clamp(d.clampMin,d.clampMax),d.target.clamp(d.clampMin,d.clampMax),d.object.lookAt(d.target);let xn=!1;d.enableDamping===!0&&Math.abs(it.theta)+Math.abs(it.phi)+Math.abs(it.radius)+lt.length()>.001?(it.theta*=1-d.dampingFactor,it.phi*=1-d.dampingFactor,it.radius*=1-d.dampingFactor,lt.multiplyScalar(1-d.dampingFactor),xn=!0):(it.set(0,0,0),lt.set(0,0,0));let fn=!1;if(d.zoomToCursor&&Gt){let En=null;if(d.object.isPerspectiveCamera){const tn=tt.radius;En=tt.radius*nt,En=hr(En);const wn=tn-En;d.object.position.addScaledVector(Rt,wn),d.object.updateMatrixWorld()}else if(d.object.isOrthographicCamera){const tn=new three_module.Pq0(kt.x,kt.y,0);tn.unproject(d.object),d.object.zoom=Math.max(d.minZoom,Math.min(d.maxZoom,d.object.zoom/nt)),d.object.updateProjectionMatrix(),fn=!0;const wn=new three_module.Pq0(kt.x,kt.y,0);wn.unproject(d.object),d.object.position.sub(wn).add(tn),d.object.updateMatrixWorld(),En=tt.radius}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),d.zoomToCursor=!1;En!==null&&(this.screenSpacePanning?d.target.set(0,0,-1).transformDirection(d.object.matrix).multiplyScalar(En).add(d.object.position):(_ray.origin.copy(d.object.position),_ray.direction.set(0,0,-1).transformDirection(d.object.matrix),Math.abs(d.object.up.dot(_ray.direction))<TILT_LIMIT?o.lookAt(d.target):(_plane.setFromNormalAndCoplanarPoint(d.object.up,d.target),_ray.intersectPlane(_plane,d.target))))}else d.object.isOrthographicCamera&&(d.object.zoom=Math.max(d.minZoom,Math.min(d.maxZoom,d.object.zoom/nt)),d.object.updateProjectionMatrix(),fn=!0);return nt=1,Gt=!1,!!(fn||xn||Ur.distanceToSquared(d.object.position)>b||8*(1-Pr.dot(d.object.quaternion))>b||Dr.distanceToSquared(d.target)>0)&&(d.dispatchEvent(_changeEvent),Ur.copy(d.object.position),Pr.copy(d.object.quaternion),Dr.copy(d.target),fn=!1,!0)}}(),this.stopDamping=function(){it.set(0,0,0),lt.set(0,0,0)},this.dispose=function(){d.domElement.removeEventListener("contextmenu",vn),d.domElement.removeEventListener("pointerdown",Ir),d.domElement.removeEventListener("pointercancel",Jr),d.domElement.removeEventListener("wheel",on),d.domElement.removeEventListener("pointermove",Xr),d.domElement.removeEventListener("pointerup",Jr),d._domElementKeyEvents!==null&&(d._domElementKeyEvents.removeEventListener("keydown",Pn),d._domElementKeyEvents=null)};const d=this,_={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let v=_.NONE;const b=1e-6,tt=new three_module.YHV,it=new three_module.YHV(0,0,0);let nt=1;const lt=new three_module.Pq0,ut=new three_module.I9Y,ht=new three_module.I9Y,_t=new three_module.I9Y,ft=new three_module.I9Y,bt=new three_module.I9Y,xt=new three_module.I9Y,St=new three_module.I9Y,wt=new three_module.I9Y,Pt=new three_module.I9Y,Rt=new three_module.Pq0,kt=new three_module.I9Y;let Gt=!1;const Dt=[],It={};function Nt(){return!d.enableDamping||d.zoomToCursor||d.object.isOrthographicCamera?Math.pow(.95,d.zoomSpeed):1}function Vt(ar){it.theta-=ar}function Kt(ar){it.phi-=ar}this.rotateUp=Kt,this.rotateLeft=Vt;const Yt=function(){const ar=new three_module.Pq0;return function(vr,Cr){ar.setFromMatrixColumn(Cr,0),ar.multiplyScalar(-vr),lt.add(ar)}}(),nr=function(){const ar=new three_module.Pq0;return function(vr,Cr){d.screenSpacePanning===!0?ar.setFromMatrixColumn(Cr,1):(ar.setFromMatrixColumn(Cr,0),ar.crossVectors(d.object.up,ar)),ar.multiplyScalar(vr),lt.add(ar)}}(),rr=function(){const ar=new three_module.Pq0;return function(vr,Cr){const Ur=d.domElement;if(d.object.isPerspectiveCamera){const Pr=d.object.position;ar.copy(Pr).sub(d.target);let Dr=ar.length();Dr*=Math.tan(d.object.fov/2*Math.PI/180),Yt(2*vr*Dr/Ur.clientHeight,d.object.matrix),nr(2*Cr*Dr/Ur.clientHeight,d.object.matrix)}else d.object.isOrthographicCamera?(Yt(vr*(d.object.right-d.object.left)/d.object.zoom/Ur.clientWidth,d.object.matrix),nr(Cr*(d.object.top-d.object.bottom)/d.object.zoom/Ur.clientHeight,d.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),d.enablePan=!1)}}();function lr(ar,vr=0){d.object.isPerspectiveCamera||d.object.isOrthographicCamera?(nt/=ar,it.radius=Math.max(-d.maxZoomSpeed,Math.min(d.maxZoomSpeed,it.radius-vr))):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),d.enableZoom=!1)}function or(ar,vr=0){d.object.isPerspectiveCamera||d.object.isOrthographicCamera?(nt*=ar,it.radius=Math.max(-d.maxZoomSpeed,Math.min(d.maxZoomSpeed,it.radius+vr))):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),d.enableZoom=!1)}function pr(ar){if(!d.zoomToCursor)return;Gt=!0;const vr=d.domElement.getBoundingClientRect(),Cr=ar.clientX-vr.left,Ur=ar.clientY-vr.top,Pr=vr.width,Dr=vr.height;kt.x=Cr/Pr*2-1,kt.y=-Ur/Dr*2+1,Rt.set(kt.x,kt.y,1).unproject(d.object).sub(d.object.position).normalize()}function hr(ar){return Math.max(d.minDistance,Math.min(d.maxDistance,ar))}function ur(ar){ut.set(ar.clientX,ar.clientY)}function cr(ar){ft.set(ar.clientX,ar.clientY)}function br(){if(Dt.length===1)ut.set(Dt[0].pageX,Dt[0].pageY);else{const ar=.5*(Dt[0].pageX+Dt[1].pageX),vr=.5*(Dt[0].pageY+Dt[1].pageY);ut.set(ar,vr)}}function fr(){if(Dt.length===1)ft.set(Dt[0].pageX,Dt[0].pageY);else{const ar=.5*(Dt[0].pageX+Dt[1].pageX),vr=.5*(Dt[0].pageY+Dt[1].pageY);ft.set(ar,vr)}}function kr(){const ar=Dt[0].pageX-Dt[1].pageX,vr=Dt[0].pageY-Dt[1].pageY,Cr=Math.sqrt(ar*ar+vr*vr);St.set(0,Cr)}function gr(ar){if(Dt.length==1)ht.set(ar.pageX,ar.pageY);else{const Cr=ms(ar),Ur=.5*(ar.pageX+Cr.x),Pr=.5*(ar.pageY+Cr.y);ht.set(Ur,Pr)}_t.subVectors(ht,ut).multiplyScalar(d.rotateSpeed);const vr=d.domElement;Vt(2*Math.PI*_t.x/vr.clientHeight),Kt(2*Math.PI*_t.y/vr.clientHeight),ut.copy(ht)}function tr(ar){if(Dt.length===1)bt.set(ar.pageX,ar.pageY);else{const vr=ms(ar),Cr=.5*(ar.pageX+vr.x),Ur=.5*(ar.pageY+vr.y);bt.set(Cr,Ur)}xt.subVectors(bt,ft).multiplyScalar(d.panSpeed),rr(xt.x,xt.y),ft.copy(bt)}function dr(ar){const vr=ms(ar),Cr=ar.pageX-vr.x,Ur=ar.pageY-vr.y,Pr=Math.sqrt(Cr*Cr+Ur*Ur);wt.set(0,Pr),Pt.set(0,Math.pow(wt.y/St.y,6*d.zoomSpeed)),lr(Pt.y),St.copy(wt)}function Ir(ar){d.enabled!==!1&&(Dt.length===0&&(d.domElement.setPointerCapture(ar.pointerId),d.domElement.addEventListener("pointermove",Xr),d.domElement.addEventListener("pointerup",Jr)),function(vr){Dt.push(vr)}(ar),ar.pointerType==="touch"?function(vr){switch(Gn(vr),Dt.length){case 1:switch(d.touches.ONE){case three_module.wtR.ROTATE:if(d.enableRotate===!1)return;br(),v=_.TOUCH_ROTATE;break;case three_module.wtR.PAN:if(d.enablePan===!1)return;fr(),v=_.TOUCH_PAN;break;default:v=_.NONE}break;case 2:switch(d.touches.TWO){case three_module.wtR.DOLLY_PAN:if(d.enableZoom===!1&&d.enablePan===!1)return;d.enableZoom&&kr(),d.enablePan&&fr(),v=_.TOUCH_DOLLY_PAN;break;case three_module.wtR.DOLLY_ROTATE:if(d.enableZoom===!1&&d.enableRotate===!1)return;d.enableZoom&&kr(),d.enableRotate&&br(),v=_.TOUCH_DOLLY_ROTATE;break;default:v=_.NONE}break;default:v=_.NONE}v!==_.NONE&&d.dispatchEvent(_startEvent)}(ar):function(vr){let Cr;switch(vr.button){case 0:Cr=d.mouseButtons.LEFT;break;case 1:Cr=d.mouseButtons.MIDDLE;break;case 2:Cr=d.mouseButtons.RIGHT;break;default:Cr=-1}switch(Cr){case three_module.kBv.DOLLY:if(d.enableZoom===!1)return;(function(Ur){pr(Ur),St.set(Ur.clientX,Ur.clientY)})(vr),v=_.DOLLY;break;case three_module.kBv.ROTATE:if(vr.ctrlKey||vr.metaKey||vr.shiftKey){if(d.enablePan===!1)return;cr(vr),v=_.PAN}else{if(d.enableRotate===!1)return;ur(vr),v=_.ROTATE}break;case three_module.kBv.PAN:if(vr.ctrlKey||vr.metaKey||vr.shiftKey){if(d.enableRotate===!1)return;ur(vr),v=_.ROTATE}else{if(d.enablePan===!1)return;cr(vr),v=_.PAN}break;default:v=_.NONE}v!==_.NONE&&d.dispatchEvent(_startEvent)}(ar))}function Xr(ar){d.enabled!==!1&&(ar.pointerType==="touch"?function(vr){switch(Gn(vr),v){case _.TOUCH_ROTATE:if(d.enableRotate===!1)return;gr(vr),d.update();break;case _.TOUCH_PAN:if(d.enablePan===!1)return;tr(vr),d.update();break;case _.TOUCH_DOLLY_PAN:if(d.enableZoom===!1&&d.enablePan===!1)return;(function(Cr){d.enableZoom&&dr(Cr),d.enablePan&&tr(Cr)})(vr),d.update();break;case _.TOUCH_DOLLY_ROTATE:if(d.enableZoom===!1&&d.enableRotate===!1)return;(function(Cr){d.enableZoom&&dr(Cr),d.enableRotate&&gr(Cr)})(vr),d.update();break;default:v=_.NONE}}(ar):ar.buttons?function(vr){switch(v){case _.ROTATE:if(d.enableRotate===!1)return;(function(Cr){ht.set(Cr.clientX,Cr.clientY),_t.subVectors(ht,ut).multiplyScalar(d.rotateSpeed);const Ur=d.domElement;Vt(2*Math.PI*_t.x/Ur.clientHeight),Kt(2*Math.PI*_t.y/Ur.clientHeight),ut.copy(ht),d.update()})(vr);break;case _.DOLLY:if(d.enableZoom===!1)return;(function(Cr){wt.set(Cr.clientX,Cr.clientY),Pt.subVectors(wt,St),Pt.y>0?lr(Nt()):Pt.y<0&&or(Nt()),St.copy(wt),d.update()})(vr);break;case _.PAN:if(d.enablePan===!1)return;(function(Cr){bt.set(Cr.clientX,Cr.clientY),xt.subVectors(bt,ft).multiplyScalar(d.panSpeed),rr(xt.x,xt.y),ft.copy(bt),d.update()})(vr)}}(ar):Jr(ar))}function Jr(ar){(function(vr){delete It[vr.pointerId];for(let Cr=0;Cr<Dt.length;Cr++)if(Dt[Cr].pointerId==vr.pointerId)return void Dt.splice(Cr,1)})(ar),Dt.length===0&&(d.domElement.releasePointerCapture(ar.pointerId),d.domElement.removeEventListener("pointermove",Xr),d.domElement.removeEventListener("pointerup",Jr)),d.dispatchEvent(_endEvent),v=_.NONE}function on(ar){d.enabled!==!1&&d.enableZoom!==!1&&v===_.NONE&&(ar.preventDefault(),d.dispatchEvent(_startEvent),function(vr){pr(vr);let Cr=0;switch(vr.deltaMode){case 2:Cr+=1*vr.deltaY;break;case 1:Cr+=.4*vr.deltaY;break;default:Cr+=.01*vr.deltaY}vr.deltaY<0?d.zoomToCursor||d.object.isOrthographicCamera?or(Nt()):or(1,Cr*d.zoomSpeed):vr.deltaY>0&&(d.zoomToCursor||d.object.isOrthographicCamera?lr(Nt()):lr(1,-Cr*d.zoomSpeed)),d.update()}(ar),d.dispatchEvent(_endEvent))}function Pn(ar){d.enabled!==!1&&d.enablePan!==!1&&function(vr){let Cr=!1;switch(vr.code){case d.keys.UP:vr.ctrlKey||vr.metaKey||vr.shiftKey?Kt(2*Math.PI*d.rotateSpeed/d.domElement.clientHeight):rr(0,d.keyPanSpeed),Cr=!0;break;case d.keys.BOTTOM:vr.ctrlKey||vr.metaKey||vr.shiftKey?Kt(-2*Math.PI*d.rotateSpeed/d.domElement.clientHeight):rr(0,-d.keyPanSpeed),Cr=!0;break;case d.keys.LEFT:vr.ctrlKey||vr.metaKey||vr.shiftKey?Vt(2*Math.PI*d.rotateSpeed/d.domElement.clientHeight):rr(d.keyPanSpeed,0),Cr=!0;break;case d.keys.RIGHT:vr.ctrlKey||vr.metaKey||vr.shiftKey?Vt(-2*Math.PI*d.rotateSpeed/d.domElement.clientHeight):rr(-d.keyPanSpeed,0),Cr=!0}Cr&&(vr.preventDefault(),d.update())}(ar)}function vn(ar){d.enabled!==!1&&ar.preventDefault()}function Gn(ar){let vr=It[ar.pointerId];vr===void 0&&(vr=new three_module.I9Y,It[ar.pointerId]=vr),vr.set(ar.pageX,ar.pageY)}function ms(ar){const vr=ar.pointerId===Dt[0].pointerId?Dt[1]:Dt[0];return It[vr.pointerId]}this.zoomIn=function(ar){lr(1,ar*d.zoomSpeed)},this.zoomOut=function(ar){or(1,ar*d.zoomSpeed)},d.domElement.addEventListener("contextmenu",vn),d.domElement.addEventListener("pointerdown",Ir),d.domElement.addEventListener("pointercancel",Jr),d.domElement.addEventListener("wheel",on,{passive:!1}),this.update()}}var OrbitControls3_decorate=function(h,o,c,d){var _,v=arguments.length,b=v<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(h,o,c,d);else for(var tt=h.length-1;tt>=0;tt--)(_=h[tt])&&(b=(v<3?_(b):v>3?_(o,c,b):_(o,c))||b);return v>3&&b&&Object.defineProperty(o,c,b),b};let OrbitControls3=class extends OrbitControls{constructor(){super(...arguments),this.type="OrbitControls",this.enabled=!0,this.dollyZoom=!1,this.zoomToCursor=!1,this.enableDamping=!0,this.dampingFactor=.08,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableZoom=!0,this.zoomSpeed=.15,this.maxZoomSpeed=.2,this.enableRotate=!0,this.rotateSpeed=2,this.enablePan=!0,this.panSpeed=1,this._autoPushTarget=!1,this.autoPushTarget2=!1,this.autoPullTarget=!1,this.minDistance=.35,this.maxDistance=1e3,this.minZoom=.01,this.maxZoom=1e3,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1e6,this.maxAzimuthAngle=1e6,this.clampMin=new three_module.Pq0(-1e6,-1e6,-1e6),this.clampMax=new three_module.Pq0(1e6,1e6,1e6),this.screenSpacePanning=!0,this.keyPanSpeed=7,this.throttleUpdate=60}get autoPushTarget(){return this._autoPushTarget||this.autoPushTarget2}set autoPushTarget(h){this._autoPushTarget=h}zoomIn(h){super.zoomIn(h)}zoomOut(h){super.zoomOut(h)}dispatchEvent(h){super.dispatchEvent(h)}};OrbitControls3_decorate([serialize()],OrbitControls3.prototype,"type",void 0),OrbitControls3_decorate([uiToggle()],OrbitControls3.prototype,"enabled",void 0),OrbitControls3_decorate([uiToggle(),serialize()],OrbitControls3.prototype,"dollyZoom",void 0),OrbitControls3_decorate([uiToggle(),serialize()],OrbitControls3.prototype,"zoomToCursor",void 0),OrbitControls3_decorate([uiToggle(),serialize()],OrbitControls3.prototype,"enableDamping",void 0),OrbitControls3_decorate([uiInput(),serialize()],OrbitControls3.prototype,"dampingFactor",void 0),OrbitControls3_decorate([uiToggle(),serialize()],OrbitControls3.prototype,"autoRotate",void 0),OrbitControls3_decorate([uiInput(),serialize()],OrbitControls3.prototype,"autoRotateSpeed",void 0),OrbitControls3_decorate([uiToggle(),serialize()],OrbitControls3.prototype,"enableZoom",void 0),OrbitControls3_decorate([uiInput(),serialize()],OrbitControls3.prototype,"zoomSpeed",void 0),OrbitControls3_decorate([uiInput(),serialize()],OrbitControls3.prototype,"maxZoomSpeed",void 0),OrbitControls3_decorate([uiToggle(),serialize()],OrbitControls3.prototype,"enableRotate",void 0),OrbitControls3_decorate([uiInput(),serialize()],OrbitControls3.prototype,"rotateSpeed",void 0),OrbitControls3_decorate([uiToggle(),serialize()],OrbitControls3.prototype,"enablePan",void 0),OrbitControls3_decorate([uiInput(),serialize()],OrbitControls3.prototype,"panSpeed",void 0),OrbitControls3_decorate([uiInput(),serialize("autoPushTarget")],OrbitControls3.prototype,"_autoPushTarget",void 0),OrbitControls3_decorate([uiInput(),serialize()],OrbitControls3.prototype,"autoPullTarget",void 0),OrbitControls3_decorate([uiInput(),serialize()],OrbitControls3.prototype,"minDistance",void 0),OrbitControls3_decorate([uiInput(),serialize()],OrbitControls3.prototype,"maxDistance",void 0),OrbitControls3_decorate([uiInput(),serialize()],OrbitControls3.prototype,"minZoom",void 0),OrbitControls3_decorate([uiInput(),serialize()],OrbitControls3.prototype,"maxZoom",void 0),OrbitControls3_decorate([uiInput(),serialize()],OrbitControls3.prototype,"minPolarAngle",void 0),OrbitControls3_decorate([uiInput(),serialize()],OrbitControls3.prototype,"maxPolarAngle",void 0),OrbitControls3_decorate([uiInput(),serialize()],OrbitControls3.prototype,"minAzimuthAngle",void 0),OrbitControls3_decorate([uiInput(),serialize()],OrbitControls3.prototype,"maxAzimuthAngle",void 0),OrbitControls3_decorate([uiVector(),serialize()],OrbitControls3.prototype,"clampMin",void 0),OrbitControls3_decorate([uiVector(),serialize()],OrbitControls3.prototype,"clampMax",void 0),OrbitControls3_decorate([serialize()],OrbitControls3.prototype,"screenSpacePanning",void 0),OrbitControls3_decorate([serialize()],OrbitControls3.prototype,"keyPanSpeed",void 0),OrbitControls3=OrbitControls3_decorate([uiPanel("Orbit Controls")],OrbitControls3);var CameraController_decorate=function(h,o,c,d){var _,v=arguments.length,b=v<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(h,o,c,d);else for(var tt=h.length-1;tt>=0;tt--)(_=h[tt])&&(b=(v<3?_(b):v>3?_(o,c,b):_(o,c))||b);return v>3&&b&&Object.defineProperty(o,c,b),b};class CameraController extends three_module.Qev{get controls(){return this._controls}getControls(){return this._controls}get userData(){return this._camera.modelObject.userData}set userData(o){this._camera.modelObject.userData=o}get isActiveCamera(){return this._isActiveCamera}get target(){return this._target}set target(o){const c=this._target.sub(o).length()>0;this._target.copy(o),c&&this.targetUpdated()}get position(){return this._position}set position(o){const c=this._position.sub(o).length()>0;this._position.copy(o),c&&this.positionUpdated()}get name(){return this._camera.name}set name(o){this._camera.name=o}getCameraOptions(){return{...this._options,position:this._position.toArray(),target:this._target.toArray()}}setCameraOptions(o,c=!0){var d,_;const v={...o};!((d=v.position)===null||d===void 0)&&d.isVector3&&(v.position=[v.position.x,v.position.y,v.position.z]),!((_=v.target)===null||_===void 0)&&_.isVector3&&(v.target=[v.target.x,v.target.y,v.target.z]),Object.keys(v).forEach(b=>b!=="frustumSize"&&v[b]===void 0&&delete v[b]),Object.assign(this._options,v),this._refreshCameraOptions(!1),this.refreshCameraControls(!1),c&&this.setDirty({optionsUpdate:!0})}_refreshCameraOptions(o=!0){let c=this._camera.modelObject;if(this._options.type!==c.type){const _=this._options.type==="PerspectiveCamera"?new three_module.ubm:new three_module.qUd;_.name=this._camera.name,_.near=this._camera.modelObject.near,_.far=this._camera.modelObject.far,_.zoom=this._camera.modelObject.zoom,_.scale.copy(this._camera.modelObject.scale);const v=this._isActiveCamera;v&&this.deactivateMain(),this._camera=this._setCameraObject(_),c=this._camera.modelObject,v&&this.activateMain(),this._camera.modelObject.updateProjectionMatrix()}let d=this._options.aspect;if(d==="auto"&&(d=this._container.clientWidth/this._container.clientHeight,isFinite(d)||(d=1)),this._options.position&&(this.position.set(...this._options.position),delete this._options.position),this._options.target&&(this.target.set(...this._options.target),delete this._options.target),this.positionUpdated(!1),this._options.type==="PerspectiveCamera"&&(c.fov=this._options.fov,c.focus=this._options.focus,c.aspect=d),this._options.type==="OrthographicCamera"){const _=this._options.frustumSize;_!==void 0?(c.top=_/2,c.bottom=-_/2,c.left=d*_/2,c.right=-d*_/2):(c.top=this._options.top,c.bottom=this._options.bottom,c.left=this._options.left,c.right=this._options.right)}c.zoom=this._options.zoom,this._nearFarChanged(),o&&this.setDirty()}_setCameraObject(o){return this._camera&&this._camera.removeEventListener("objectUpdate",this._cameraObjectUpdate),this._camera=setupIModel(o),this._camera.addEventListener("objectUpdate",this._cameraObjectUpdate),this._camera}get interactionsEnabled(){return this._interactionsDisabledBy.size===0&&this._isActiveCamera&&this._options.controlsEnabled&&this._options.controlsMode!==""}set interactionsEnabled(o){this.setInteractions(o,"_default")}setInteractions(o,c){const d=this._interactionsDisabledBy.size;o?this._interactionsDisabledBy.delete(c):this._interactionsDisabledBy.add(c),d!==this._interactionsDisabledBy.size&&this.refreshCameraControls(!0)}_nearFarChanged(){this._camera&&(this._camera.modelObject.near=this.near,this._camera.modelObject.far=this.far,this._camera.modelObject.updateProjectionMatrix())}constructor(o,c,d){super(),this._controlsMode="",this._isActiveCamera=!1,this._cameraObjectUpdate=b=>{this.setDirty(b)},this._interactionsDisabledBy=new Set,this.autoLookAtTarget=!1,this.near=.01,this.far=50,this._options={type:"PerspectiveCamera",aspect:"auto",focus:10,fov:25,zoom:1,frustumSize:1,top:1,bottom:-1,left:-1,right:1,controlsMode:"orbit",controlsEnabled:!0},this._position=new three_module.Pq0(0,0,10),this._target=new three_module.Pq0(0,0,0),this._controlsCtors=new Map([["orbit",(b,tt)=>{const it=new OrbitControls3(b,tt.ownerDocument?tt:tt.documentElement);return it.screenSpacePanning=!0,it}]]),this._positionWorld=new three_module.Pq0,this._camUi=[{type:"vec3",label:"Position",property:[this,"position"],onChange:()=>this.positionUpdated(!0)},{type:"vec3",label:"Target",property:[this,"target"],onChange:()=>this.targetUpdated(!0)},{type:"slider",bounds:[1,180],label:"Field Of View",hidden:()=>!this._camera.modelObject.isPerspectiveCamera,property:[this._options,"fov"],onChange:()=>this.refreshCameraOptions(),limitedUi:!0},{type:"checkbox",label:"Auto Near far",getValue:()=>{var b;return(b=this._camera.userData.autoNearFar)===null||b===void 0||b},setValue:b=>this._camera.userData.autoNearFar=b,onChange:()=>this.setDirty()},{type:"checkbox",label:"Dolly FoV",getValue:()=>{var b;return(b=this._camera.userData.dollyFov)!==null&&b!==void 0&&b},setValue:b=>this._camera.userData.dollyFov=b,onChange:()=>this.setDirty()},{type:"input",label:()=>{var b;return(b=this._camera.userData.autoNearFar)===null||b===void 0||b?"Min Near":"Near"},getValue:()=>{var b;return(b=this._camera.userData.minNearPlane)!==null&&b!==void 0?b:.5},setValue:b=>this._camera.userData.minNearPlane=b,onChange:()=>this.setDirty()},{type:"input",label:()=>{var b;return(b=this._camera.userData.autoNearFar)===null||b===void 0||b?"Max Far":"Far"},getValue:()=>{var b;return(b=this._camera.userData.maxFarPlane)!==null&&b!==void 0?b:1e3},setValue:b=>this._camera.userData.maxFarPlane=b,onChange:()=>this.setDirty()},()=>({type:"dropdown",label:"Controls Mode",property:[this._options,"controlsMode"],children:["","orbit",...this._controlsCtors.keys()].map(b=>({label:b===""?"none":b,value:b})),onChange:()=>{this.refreshCameraOptions()}})],this.uiConfig={type:"folder",label:"Camera",limitedUi:!0,children:[...this._camUi,()=>{var b;return!((b=this._controls)===null||b===void 0)&&b.zoomIn?{type:"button",label:"Zoom in",value:()=>{var tt;(tt=this._controls)===null||tt===void 0||tt.zoomIn(1)}}:{}},()=>{var b;return!((b=this._controls)===null||b===void 0)&&b.zoomOut?{type:"button",label:"Zoom out",value:()=>{var tt;(tt=this._controls)===null||tt===void 0||tt.zoomOut(1)}}:{}},()=>{var b;return(b=this._controls)===null||b===void 0?void 0:b.uiConfig}]},this.assetType="model",this.uuid=three_module.cj9.generateUUID(),this.setDirty=this.setDirty.bind(this),this.targetUpdated=this.targetUpdated.bind(this),this._refreshCameraOptions=this._refreshCameraOptions.bind(this),this._container=d??document.body;const _={...c};this._camera=this._setCameraObject(o??(_.type==="OrthographicCamera"?new three_module.qUd(-1,1,1,-1):new three_module.ubm)),this._camera.modelObject.userData.iCamera=this;const v=o;o&&(v.isPerspectiveCamera?(_.fov=v.fov,_.focus=v.focus,_.aspect=v.aspect<=0||v.userData.autoAspect?"auto":v.aspect,_.zoom=v.zoom):v.isOrthographicCamera&&(_.left=v.left,_.right=v.right,_.top=v.top,_.bottom=v.bottom,_.zoom=v.zoom),this.near=v.near,this.far=v.far,this._position.copy(o.position),this.refreshTarget()),this.positionUpdated(!1),this.setCameraOptions(_)}refreshAspect(o=!0){this._options.aspect==="auto"&&this._refreshCameraOptions(o)}refreshTarget(o=4){var c;!((c=this._controls)===null||c===void 0)&&c.enabled&&this._controls.target?this._target.copy(this._controls.target):this.cameraObject.getWorldDirection(this._target).multiplyScalar(o).add(this.cameraObject.getWorldPosition(new three_module.Pq0))}setControlsCtor(o,c,d=!1){d||!this._controlsCtors.has(o)?this._controlsCtors.set(o,c):console.error(o+" already exists.")}removeControlsCtor(o){this._controlsCtors.delete(o)}_initCameraControls(){var o,c,d;const _=this._options.controlsMode;this._controls=(c=(o=this._controlsCtors.get(_))===null||o===void 0?void 0:o(this._camera.modelObject,this._container))!==null&&c!==void 0?c:void 0,this._controls||_===""||console.error("Unable to create controls with mode "+_+". Are you missing a plugin?"),(d=this._controls)===null||d===void 0||d.addEventListener("change",this.setDirty),this._controlsMode=this._controls?_:""}_disposeCameraControls(){var o,c;this._controlsMode,(o=this._controls)===null||o===void 0||o.removeEventListener("change",this.setDirty),(c=this._controls)===null||c===void 0||c.dispose(),this._controlsMode="",this._controls=void 0}refreshCameraControls(o=!0){var c,d;if(this._options.controlsEnabled){const _=this._options.controlsMode;this._controls?this._controlsMode===_&&this._camera.modelObject===this._controls.object||(this._disposeCameraControls(),this._initCameraControls()):this._initCameraControls(),this._controlsMode=_}if(this._controls){const _=this.interactionsEnabled;this._controls.enabled=_,_&&this._camera.modelObject.up.copy(three_module.B69.DEFAULT_UP)}o&&this.setDirty(),(d=(c=this.uiConfig).uiRefresh)===null||d===void 0||d.call(c,"postFrame",!0)}setDirty(o){var c,d;this._position.copy(this._camera.modelObject.position),this._controls&&this._controls.enabled&&this._controls.target&&this._target.copy(this._controls.target),this._camera.modelObject.fov!==void 0&&(this._options.fov=this._camera.modelObject.fov),this._camera.modelObject.focus!==void 0&&(this._options.focus=this._camera.modelObject.focus),this._camera.modelObject.zoom!==void 0&&(this._options.zoom=this._camera.modelObject.zoom),(d=(c=this.cameraObject).updateProjectionMatrix)===null||d===void 0||d.call(c),this.cameraObject.getWorldPosition(this._positionWorld),this.dispatchEvent({...o,type:"update"}),(o==null?void 0:o.last)!==!1&&this._camUi.forEach(_=>{var v;return(v=_==null?void 0:_.uiRefresh)===null||v===void 0?void 0:v.call(_,"postFrame",!1,1)})}activateMain(o=!0){var c,d;this._isActiveCamera||(this._isActiveCamera=!0,this._camera.modelObject.userData.__lastScale=this._camera.modelObject.scale.clone(),this._camera.modelObject.scale.divide(this._camera.modelObject.getWorldScale(new three_module.Pq0)),o&&(this.refreshCameraControls(!1),this._refreshCameraOptions(!0)),(d=(c=this._camera).setDirty)===null||d===void 0||d.call(c,{change:"activateMain"}))}deactivateMain(o=!0){this._isActiveCamera&&(this._isActiveCamera=!1,this._camera.modelObject.userData.__lastScale&&(this._camera.modelObject.scale.copy(this._camera.modelObject.userData.__lastScale),delete this._camera.modelObject.userData.__lastScale),o&&this.refreshCameraControls(!0))}get cameraObject(){return this._camera.modelObject}get modelObject(){return this._camera.modelObject}dispose(){this._disposeCameraControls()}getFittingDistance(o){const c=o.getSize(new three_module.Pq0);let d=this.cameraObject,_=1;if(d.isPerspectiveCamera&&c.length()>1e-4){const v=isFinite(d.aspect)?d.aspect:1,b=Math.max(1,d.fov)*(Math.PI/180),tt=2*Math.atan(Math.tan(b/2)*v),it=c.z/2+Math.abs(c.x/2/Math.tan(tt/2)),nt=c.z/2+Math.abs(c.y/2/Math.tan(b/2));_=Math.max(it,nt)}return _}targetUpdated(o=!0){var c,d;const _=this.target;(d=(c=this._controls)===null||c===void 0?void 0:c.target)===null||d===void 0||d.set(_.x,_.y,_.z),this._controls&&this._controls.enabled&&this._controls.target?o&&this.setDirty():this._camera&&(this._camera.userData.autoLookAtTarget!==void 0&&(this.autoLookAtTarget=this._camera.userData.autoLookAtTarget),this.autoLookAtTarget&&this._camera.modelObject.lookAt(_),o&&this.setDirty())}positionUpdated(o=!0){const c=this.position;this._camera.modelObject.position.set(c.x,c.y,c.z),this.targetUpdated(o)}positionTargetUpdated(o=!0){this.positionUpdated(o)}copyFromCamera(o,c=4){o.getWorldPosition(this._position),o.getWorldDirection(this._target).multiplyScalar(c).add(this._position),this.positionUpdated(!1),this.setCameraOptions({fov:o.fov,focus:o.focus,zoom:o.zoom,type:o.type},!0)}updateShaderProperties(o){var c,d,_,v;return(d=(c=o.uniforms.cameraPositionWorld)===null||c===void 0?void 0:c.value)===null||d===void 0||d.copy(this._positionWorld),(v=(_=o.uniforms.cameraNearFar)===null||_===void 0?void 0:_.value)===null||v===void 0||v.set(this._camera.modelObject.near,this._camera.modelObject.far),o.uniforms.projection&&(o.uniforms.projection.value=this._camera.modelObject.projectionMatrix),o.defines.PERSPECTIVE_CAMERA=this._camera.modelObject.type==="PerspectiveCamera"?"1":"0",o.defines.ORTHOGRAPHIC_CAMERA=this._camera.modelObject.type==="OrthographicCamera"?"1":"0",this}toJSON(o){const c={};return copyObject3DUserData(c,this.userData),Object.assign({userData:c},serializeObject(this,!0,o))}fromJSON(o,c){return o.userData&&(copyObject3DUserData(this.userData,o.userData),delete(o={...o}).userData),o.camOptions&&(this.setCameraOptions(o.camOptions,!1),this.refreshCameraOptions(!1)),deserializeObject(o,this,!0,c),this.positionUpdated(!1),this.refreshCameraOptions(!1),this.setDirty({change:"deserialize"}),this}refreshCameraOptions(o=!0){this.setCameraOptions(this._options,o)}get visible(){return!0}set visible(o){console.error("Cannot set visible on camera",o)}}CameraController_decorate([serialize("camControls")],CameraController.prototype,"_controls",void 0),CameraController_decorate([x$1(CameraController.prototype._nearFarChanged)],CameraController.prototype,"near",void 0),CameraController_decorate([x$1(CameraController.prototype._nearFarChanged)],CameraController.prototype,"far",void 0),CameraController_decorate([serialize("camOptions")],CameraController.prototype,"_options",void 0),CameraController_decorate([serialize("position")],CameraController.prototype,"_position",void 0),CameraController_decorate([serialize("target")],CameraController.prototype,"_target",void 0);var RootScene_decorate=function(h,o,c,d){var _,v=arguments.length,b=v<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(h,o,c,d);else for(var tt=h.length-1;tt>=0;tt--)(_=h[tt])&&(b=(v<3?_(b):v>3?_(o,c,b):_(o,c))||b);return v>3&&b&&Object.defineProperty(o,c,b),b};class RootScene extends three_module.Z58{get activeCamera(){return this._activeCamera>=0?this._cameras[this._activeCamera]:this._dummyCam}set activeCamera(o){const c=this.activeCamera;if(o||(o=this.defaultCamera),c!==o){if(c&&(c.deactivateMain(),c.removeEventListener("update",this._activeCameraUpdate)),o){o.activateMain(),o.addEventListener("update",this._activeCameraUpdate);let d=this._cameras.indexOf(o);d<0&&(this._cameras.push(o),d=this._cameras.length-1),this._activeCamera=d}else this._activeCamera=-1;this.dispatchEvent({type:"activeCameraChange",lastCamera:c,camera:o}),this.setDirty()}}get renderCamera(){var o;return(o=this._renderCamera)!==null&&o!==void 0?o:this.activeCamera}set renderCamera(o){const c=this._renderCamera;this._renderCamera=o,this.dispatchEvent({type:"renderCameraChange",lastCamera:c,camera:o})}get modelObject(){return this}constructor(o){super(),this.isRootScene=!0,this.assetType="model",this._sceneBounds=new Box3B,this._modelBounds=new Box3B,this._sceneBoundingRadius=0,this._cameras=[],this._activeCamera=-1,this.envMapIntensity=.05,this.fixedEnvMapDirection=!1,this.backgroundIntensity=1,this._dummyCam=new CameraController(new three_module.ubm,{controlsMode:"",controlsEnabled:!1}),this.deleteImportedViewerConfigOnLoad=!0,this.autoDisposeSceneMaps=!0,this.environment=null,this.textureSlots={},this.background=null,this.backgroundColor=null,this.setDirty=this.setDirty.bind(this),this.updateScene=this.updateScene.bind(this),this.refreshActiveCameraNearFar=this.refreshActiveCameraNearFar.bind(this),this._activeCameraUpdate=this._activeCameraUpdate.bind(this),this._optionsUpdate=this._optionsUpdate.bind(this),this._onSceneMaterialUpdate=this._onSceneMaterialUpdate.bind(this),this._onSceneUpdate=this._onSceneUpdate.bind(this),this.addEventListener("materialUpdate",this._onSceneMaterialUpdate),this.addEventListener("materialChanged",this._onSceneMaterialUpdate),this.addEventListener("objectUpdate",this._onSceneUpdate),this.defaultCamera=o,this.modelRoot=setupIModel(new three_module.YJl,void 0),this.modelRoot.userData.rootSceneModelRoot=!0,this.modelRoot.name="Scene",this.modelRoot.addEventListener("update",this.setDirty),this.addSceneObject(this.modelRoot,{addToRoot:!0,autoScale:!1}),this.addSceneObject(this.defaultCamera,{addToRoot:!0}),this.activeCamera=this.defaultCamera,this.boxHelper=new three_module.BND(this.getBounds())}addModel(o,c={}){return o.assetType!=="model"&&console.error("Invalid asset type for ",o,", adding anyway"),this.addSceneObject(o,c)}addWidget(o,c={}){o.assetType!=="widget"&&console.warn("Invalid asset type for ",o,", adding anyway"),this.add(o.modelObject)}_addModel(o,c={}){return this._addObject3D(o==null?void 0:o.modelObject,c)}addSceneObject(o,c){var d;if(!o)return o;const _=o.assetType;let v=!1;switch(_){case"model":v=o.modelObject.isCamera,v&&(c={...c,autoScale:!1}),this._addModel(o,c);break;case"material":break;case"texture":this.dispatchEvent({type:"textureAdded",texture:o});break;case"light":this._addLight(o,c);break;default:console.warn("WebGi RootScene: Unknown asset imported",o,_)}return this.dispatchEvent({type:"addSceneObject",object:o,options:c}),this.deleteImportedViewerConfigOnLoad&&(o.__importedViewerConfig||!((d=o.modelObject)===null||d===void 0)&&d.__importedViewerConfig)&&X$2(2e3).then(()=>{delete o.__importedViewerConfig,o.modelObject&&delete o.modelObject.__importedViewerConfig}),o}_addObject3D(o,{autoScale:c=!0,autoScaleRadius:d=2,addToRoot:_=!1}={}){const v=o;v?(c&&!v.userData.autoScaled&&autoScaleObject3D(v,v.userData.autoScaleRadius||d),v.traverse(b=>{b.isMesh&&!b.userData.__keepShadowDef&&(b.castShadow=!0,b.receiveShadow=!0,b.userData.__keepShadowDef=!0)}),_?this.modelObject.add(v):this.modelRoot.add(v),this.setDirty()):console.error("Invalid Model, cannot add.")}removeSceneModels(){this.modelRoot.clear(),this.modelRoot.children=[],this.setDirty({sceneUpdate:!0})}disposeSceneModels(){[...this.modelRoot.children].forEach(o=>{var c,d;((c=o.dispose)!==null&&c!==void 0?c:(d=o.modelObject)===null||d===void 0?void 0:d.removeFromParent)()}),this.setDirty({sceneUpdate:!0})}_onEnvironmentChange(){var o;((o=this.environment)===null||o===void 0?void 0:o.mapping)===three_module.UTZ&&(this.environment.mapping=three_module.wfO,this.environment.needsUpdate=!0),this.dispatchEvent({type:"environmentChanged",environment:this.environment}),this._onSceneUpdate({geometryChanged:!1})}_onBackgroundChange(){this.dispatchEvent({type:"backgroundChanged",background:this.background,backgroundColor:this.backgroundColor}),this._onSceneUpdate({geometryChanged:!1})}add(...o){return super.add(...o.map(c=>setupIModel(c))),this._onSceneUpdate(),this}setEnvironment(o){const c=this.environment;if(c===o)return;if(this.autoDisposeSceneMaps&&(c==null||c.dispose()),!o)return void(this.environment=null);if(!o.isTexture)return void console.error("Unknown Environment type",o);o.assetType!=="texture"&&console.warn("Environment asset not processed",o);const d=o.textureObject||o;this.environment=d}getEnvironment(){return this.environment}setBackground(o){let c;const d=this.background;if(d!==o){if(this.autoDisposeSceneMaps&&d instanceof three_module.gPd&&d.dispose(),!o||o.assetType==="texture"||o.isTexture||o.isColor||o==="environment")c=((o==null?void 0:o.assetType)==="texture"||o.isTexture)&&o.textureObject||o;else{if(typeof o!="string"&&typeof o!="number")return void console.error("Unknown Background type",o);c=new three_module.Q1f(o)}this.background=c}}setBackgroundColor(o){this.backgroundColor=o?new three_module.Q1f(o):null}getBackground(){return this.background}setDirty(o){return o!=null&&o.sceneUpdate||o!=null&&o.refreshScene?this._onSceneUpdate(o):this.dispatchEvent({type:"update"}),this}updateScene(o){return this._onSceneUpdate(o)}_activeCameraUpdate(o){o.optionsUpdate&&this._optionsUpdate(o),this.setDirty(),this.refreshActiveCameraNearFar(),this.dispatchEvent({...o,type:"activeCameraUpdate"})}_optionsUpdate(o){if(!this.activeCamera.userData.dollyFov)return;const c=new Box3B().expandByObject(this.modelRoot.modelObject,!1,!0),d=this.activeCamera.cameraObject,_=1.5*this.activeCamera.getFittingDistance(c),v=this.activeCamera.target,b=new three_module.Pq0().subVectors(v,d.position).normalize();this.activeCamera.position=b.multiplyScalar(-_).add(v)}_onSceneUpdate(o={}){var c,d,_,v;return o.sceneUpdate===!1&&o.refreshScene===!1||!((c=o.object)===null||c===void 0)&&c.isCamera?this.setDirty(o):(this.refreshActiveCameraNearFar(),this._sceneBounds=this.getBounds(!1,!0),(v=(_=(d=this.boxHelper)===null||d===void 0?void 0:d.box)===null||_===void 0?void 0:_.copy)===null||v===void 0||v.call(_,this._sceneBounds),this._modelBounds=this.getModelBounds(!1,!0),this._sceneBoundingRadius=this._modelBounds.getSize(new three_module.Pq0).length()/2,this.dispatchEvent({...o,type:"sceneUpdate",hierarchyChanged:["addedToParent","removedFromParent"].includes(o.change||"")}),this)}_onSceneMaterialUpdate(o){this.dispatchEvent({...o,type:"sceneMaterialUpdate"})}dispose(){var o;this.disposeSceneModels(),this.clear(),(o=this.environment)===null||o===void 0||o.dispose()}findObjectsByName(o,c){const d=[];return(c??this.modelObject).traverse(_=>{_.name===o&&d.push(_)}),d}addLight(o,c={}){this.addSceneObject(o,c)}_addLight(o,{addToRoot:c=!1}={}){var d;const _=o.lightObject;_&&((d=_.children)===null||d===void 0||d.length,c?this.add(_):this.modelRoot.add(_))}getBounds(o=!1,c=!0,d=!0,_){return new Box3B().expandByObject(this.modelObject,o,c,v=>{var b;return!(!d||v.assetType!=="widget")||(b=_==null?void 0:_(v))!==null&&b!==void 0&&b})}getModelBounds(o=!1,c=!0,d=!0,_){return this.modelRoot==null?new Box3B:new Box3B().expandByObject(this.modelRoot,o,c,v=>{var b;return!(!d||v.assetType!=="widget")||(b=_==null?void 0:_(v))!==null&&b!==void 0&&b})}refreshActiveCameraNearFar(){var o,c,d,_;const v=this.activeCamera;if(!v)return;if(v.cameraObject.userData.autoNearFar===!1)return v.near=(o=v.cameraObject.userData.minNearPlane)!==null&&o!==void 0?o:.5,void(v.far=(c=v.cameraObject.userData.maxFarPlane)!==null&&c!==void 0?c:1e3);const b=this.getBounds(!1),tt=v.cameraObject.getWorldPosition(new three_module.Pq0).sub(b.getCenter(new three_module.Pq0)),it=1.5*b.getSize(new three_module.Pq0).length()/2,nt=Math.max(.1,-tt.clone().normalize().dot(v.cameraObject.getWorldDirection(new three_module.Pq0))),lt=tt.length(),ut=Math.max(Math.max((d=v.cameraObject.userData.minNearPlane)!==null&&d!==void 0?d:.5,.001),nt*(lt-it)),ht=Math.min(Math.max(ut+it,nt*(lt+it)),(_=v.cameraObject.userData.maxFarPlane)!==null&&_!==void 0?_:1e3);v.near=ut,v.far=ht}updateShaderProperties(o){return o.uniforms.sceneBoundingRadius?o.uniforms.sceneBoundingRadius.value=this._sceneBoundingRadius:console.warn("BaseRenderer: no uniform: frameCount"),this}toJSON(o){return serializeObject(this,!0,o)}fromJSON(o,c){const d=o.environment;return d!==void 0&&(this.setEnvironment(deserializeObject(d,this.getEnvironment(),!1,c)),delete o.environment),deserializeObject(o,this,!0,c),o.environment=d,this}get minNearDistance(){var o;return console.error("minNearDistance is deprecated. Use camera.userData.minNearPlane instead"),(o=this.activeCamera.userData.minNearPlane)!==null&&o!==void 0?o:.5}set minNearDistance(o){console.error("minNearDistance is deprecated. Use camera.userData.minNearPlane instead"),this.activeCamera&&(this.activeCamera.userData.minNearPlane=o)}}RootScene_decorate([serialize()],RootScene.prototype,"defaultCamera",void 0),RootScene_decorate([ze$1(RootScene.prototype.setDirty),serialize()],RootScene.prototype,"envMapIntensity",void 0),RootScene_decorate([ze$1(RootScene.prototype.setDirty),serialize()],RootScene.prototype,"fixedEnvMapDirection",void 0),RootScene_decorate([ze$1(RootScene.prototype.setDirty),serialize()],RootScene.prototype,"backgroundIntensity",void 0),RootScene_decorate([serialize(),x$1(RootScene.prototype._onEnvironmentChange.name)],RootScene.prototype,"environment",void 0),RootScene_decorate([serialize()],RootScene.prototype,"textureSlots",void 0),RootScene_decorate([serialize(),x$1(RootScene.prototype._onBackgroundChange)],RootScene.prototype,"background",void 0),RootScene_decorate([serialize(),x$1(RootScene.prototype._onBackgroundChange)],RootScene.prototype,"backgroundColor",void 0);function shaderReplaceString(h,o,c,{replaceAll:d=!1,prepend:_=!1,append:v=!1}={}){if(!h.includes(o))return console.error(`${o} not found in shader`),h;let b=c;return _?b=c+o:v&&(b=o+c),d?h.replaceAll(o,b):h.replace(o,b)}class MaterialExtender{static ApplyMaterialExtensions(o,c,d,_){for(const v of d)this.ApplyMaterialExtension(o,c,v,_)}static ApplyMaterialExtension(o,c,d,_){var v,b;let tt=(v=Ee$1(d.parsFragmentSnippet,_,o))!==null&&v!==void 0?v:"";tt.length&&(c.fragmentShader=shaderReplaceString(c.fragmentShader,this.VoidMain,`
`+tt+`
`,{prepend:!0})),tt=(b=Ee$1(d.parsVertexSnippet,_,o))!==null&&b!==void 0?b:"",tt.length&&(c.vertexShader=shaderReplaceString(c.vertexShader,this.VoidMain,`
`+tt+`
`,{prepend:!0})),d.extraUniforms&&(c.uniforms=Object.assign(c.uniforms,d.extraUniforms)),d.extraDefines&&updateMaterialDefines(d.extraDefines,o),d.shaderExtender&&d.shaderExtender(c,o,_),o.lastShader=c}static CacheKeyForExtensions(o,c){let d="";for(const _ of c)d+=this.CacheKeyForExtension(o,_);return d}static CacheKeyForExtension(o,c){let d="";return c.customCacheKey&&(d+=c.customCacheKey),c.computeCacheKey&&(d+=c.computeCacheKey(o)),c.extraDefines&&Object.values(c.extraDefines).forEach(_=>d+=_),d}static RegisterExtensions(o,c){const d=[];if(c)for(const _ of c)_.isCompatible&&_.isCompatible(o)&&(d.push(_),_.uuid||(_.uuid=esm_browser_v4()),_.__setDirty||(_.__setDirty=()=>{_.updateVersion||(_.updateVersion=0),_.updateVersion++}),_.setDirty||(_.setDirty=_.__setDirty));o.materialExtensions=d,o.__ext_beforeRenderListen||(o.__ext_beforeRenderListen=!0,o.addEventListener("beforeRender",_=>materialBeforeRender(o,_))),o.__ext_afterRenderListen||(o.__ext_afterRenderListen=!0,o.addEventListener("afterRender",_=>materialAfterRender(o,_))),o.__ext_addToMeshListen||(o.__ext_addToMeshListen=!0,o.addEventListener("addToMesh",_=>{var v,b;if(o.materialExtensions)for(const tt of o.materialExtensions)(v=tt.onAddToMesh)===null||v===void 0||v.call(tt,(b=_.mesh)!==null&&b!==void 0?b:_.object,o)})),o.__ext_removeFromMeshListen||(o.__ext_removeFromMeshListen=!0,o.addEventListener("removeFromMesh",_=>{var v,b;if(o.materialExtensions)for(const tt of o.materialExtensions)(v=tt.onRemoveFromMesh)===null||v===void 0||v.call(tt,(b=_.mesh)!==null&&b!==void 0?b:_.object,o)})),o.__ext_materialUpdateListen||(o.__ext_materialUpdateListen=!0,o.addEventListener("materialUpdate",_=>{var v;if(o.materialExtensions)for(const b of o.materialExtensions)(v=b.onMaterialUpdate)===null||v===void 0||v.call(b,o)}));for(const _ of d)_.onRegister&&_.onRegister(o);return d}}function updateMaterialDefines(h,o){let c=!1;o.materialObject&&o.materialObject.defines===void 0&&(o.materialObject.defines={});const d=Object.entries(h);for(const[_,v]of d)v===void 0?o.materialObject.defines[_]!==void 0&&(delete o.materialObject.defines[_],c=!0):o.materialObject.defines[_]!==v&&(o.materialObject.defines[_]=v,c=!0);c&&(o.materialObject.needsUpdate=!0)}function materialBeforeRender(h,{object:o,renderer:c}){var d;if(h.materialExtensions)for(const _ of h.materialExtensions){if((d=_.onObjectRender)===null||d===void 0||d.call(_,o,h,c),h.lastShader){const v=Ee$1(_.updaters)||[];for(const b of v)b&&b.updateShaderProperties(h.lastShader)}_.updateVersion!==h.materialObject.userData["_"+_.uuid+"_version"]&&(h.materialObject.userData["_"+_.uuid+"_version"]=_.updateVersion,h.materialObject.needsUpdate=!0)}}function materialAfterRender(h,{object:o,renderer:c}){var d;if(h.materialExtensions)for(const _ of h.materialExtensions)(d=_.onAfterRender)===null||d===void 0||d.call(_,o,h,c)}MaterialExtender.VoidMain="void main()";var ShaderPass2_decorate=function(h,o,c,d){var _,v=arguments.length,b=v<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(h,o,c,d);else for(var tt=h.length-1;tt>=0;tt--)(_=h[tt])&&(b=(v<3?_(b):v>3?_(o,c,b):_(o,c))||b);return v>3&&b&&Object.defineProperty(o,c,b),b};class AShaderMaterial2 extends three_module.BKk{constructor(o,c=!1){var d;super(o),this.typeSlug="shaderMat",this.assetType="material",this.materialObject=this,this.materialExtensions=[],this.isRawShaderMaterial=!1,this.extraUniformsToUpload={},c&&(this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"),this.materialExtensions=MaterialExtender.RegisterExtensions(this,(d=o==null?void 0:o.customMaterialExtensions)!==null&&d!==void 0?d:[])}registerMaterialExtensions(o){this.materialExtensions=[...this.materialExtensions,...MaterialExtender.RegisterExtensions(this,o)]}unregisterMaterialExtensions(o){}onBeforeCompile(o,c){MaterialExtender.ApplyMaterialExtensions(this,o,this.materialExtensions,c),this.dispatchEvent({type:"beforeCompile",shader:o,renderer:c}),o.fragmentShader=o.fragmentShader.replaceAll("#glMarker","// "),super.onBeforeCompile(o,c)}customProgramCacheKey(){return super.customProgramCacheKey()+MaterialExtender.CacheKeyForExtensions(this,this.materialExtensions)}onBeforeRender(o,c,d,_,v){super.onBeforeRender(o,c,d,_,v),this.dispatchEvent({type:"beforeRender",renderer:o,scene:c,camera:d,geometry:_,object:v})}onAfterRender(o,c,d,_,v){super.onAfterRender(o,c,d,_,v),this.dispatchEvent({type:"afterRender",renderer:o,scene:c,camera:d,geometry:_,object:v})}setDirty(o){this.needsUpdate=!0,this.dispatchEvent({...o,type:"materialUpdate"})}}class ShaderMaterial2 extends AShaderMaterial2{constructor(){super(...arguments),this.typeSlug="shaderMat"}toJSON(o){throw new Error("Method not supported for this material.")}fromJSON(o,c){throw new Error("Method not supported for this material.")}copyProps(o){throw new Error("Method not supported for this material.")}}class ShaderMaterialEncodingSupport extends ShaderMaterial2{constructor(o,c){super(o),this.typeSlug="shaderMat",this.textures=[],this.setTextureIds(c)}setTextureIds(o){this.textures.map(c=>c.id).join(";")!==o.join(";")&&(this.textures=o.map(c=>({id:c,colorSpace:three_module.jf0})),this.setDirty())}_setUniformTexSize(o,c){var d,_,v,b;if(!c||!o)return;const tt=(_=(d=c.image)===null||d===void 0?void 0:d.width)!==null&&_!==void 0?_:512,it=(b=(v=c.image)===null||v===void 0?void 0:v.height)!==null&&b!==void 0?b:512,nt=o.value;nt.isVector2||console.warn("uniform is not a Vector2"),nt&&Math.abs(nt.x-tt)+Math.abs(nt.y-it)>.1&&(nt.x=tt,nt.y=it,this.uniformsNeedUpdate=!0)}onBeforeRender(o,c,d,_,v){var b,tt;this._setUniformTexSize(this.uniforms.screenSize,(b=o.getRenderTarget())===null||b===void 0?void 0:b.texture);for(const it of this.textures){const nt=it.id,lt=(tt=this.uniforms[nt])===null||tt===void 0?void 0:tt.value;lt&&(this._setUniformTexSize(this.uniforms[nt+"Size"],lt),lt.colorSpace!==it.colorSpace&&(it.colorSpace=lt.colorSpace,this.needsUpdate=!0))}super.onBeforeRender(o,c,d,_,v)}onBeforeCompile(o,c){o.fragmentShader=this.textures.map(d=>{var _,v;return`uniform sampler2D ${d.id}; 
`+getTexelDecoding((_=d.id)!==null&&_!==void 0?_:"input",(v=d.colorSpace)!==null&&v!==void 0?v:three_module.jf0)}).join(`
`)+o.fragmentShader,super.onBeforeCompile(o,c)}customProgramCacheKey(){return super.customProgramCacheKey()+this.textures.map(o=>o.id+o.colorSpace).join(";")}}function patchShaderEncodingSupport(h,...o){const c=h.fragmentShader;return new ShaderMaterialEncodingSupport({defines:Object.assign({},h.defines),uniforms:h.uniforms,vertexShader:h.vertexShader,fragmentShader:c},o)}class ShaderPass2 extends ShaderPass{constructor(o,...c){super(o.isMaterial?o:patchShaderEncodingSupport(o,...c),c.length<1?ShaderPass2.DEFAULT_TEX_ID:c[0]),this.onDirty=[],this.isShaderPass2=!0,this.enabled=!0,this.setDirty=this.setDirty.bind(this)}dispose(){var o,c,d,_;(c=(o=this.material)===null||o===void 0?void 0:o.dispose)===null||c===void 0||c.call(o),(_=(d=this.fsQuad)===null||d===void 0?void 0:d.dispose)===null||_===void 0||_.call(d),this.onDirty=[]}setDirty(){this.onDirty.forEach(o=>o())}updateShaderProperties(o){o&&(Array.isArray(o)||(o=[o]),o.forEach(c=>c==null?void 0:c.updateShaderProperties(this.material)))}render(o,c,d,_,v){this.enabled&&super.render(o,c||null,d,_,v)}}ShaderPass2.DEFAULT_TEX_ID="tDiffuse",ShaderPass2_decorate([uiToggle("Enabled"),serialize()],ShaderPass2.prototype,"enabled",void 0);class RenderPass extends Pass{constructor(o,c,d=null,_=null,v=null){super(),this.scene=o,this.camera=c,this.overrideMaterial=d,this.clearColor=_,this.clearAlpha=v,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1,this._oldClearColor=new three_module.Q1f}render(o,c,d,_,v,b){if(!this.scene||!this.camera)return;const tt=o.autoClear;let it,nt;if(o.autoClear=!1,this.overrideMaterial!==null&&(nt=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor!==null&&(o.getClearColor(this._oldClearColor),o.setClearColor(this.clearColor)),this.clearAlpha!==null&&(it=o.getClearAlpha(),o.setClearAlpha(this.clearAlpha)),this.clearDepth==1&&o.clearDepth(),o.setRenderTarget(this.renderToScreen?null:d),b){const lt=o.getContext();lt.framebufferRenderbuffer(lt.FRAMEBUFFER,lt.DEPTH_ATTACHMENT,lt.RENDERBUFFER,b)}if(this.clear===!0&&o.clear(o.autoClearColor,o.autoClearDepth,o.autoClearStencil),o.render(this.scene,this.camera),b){const lt=o.getContext();lt.framebufferRenderbuffer(lt.FRAMEBUFFER,lt.DEPTH_ATTACHMENT,lt.RENDERBUFFER,null)}this.clearColor!==null&&o.setClearColor(this._oldClearColor),this.clearAlpha!==null&&o.setClearAlpha(it),this.overrideMaterial!==null&&(this.scene.overrideMaterial=nt),o.autoClear=tt}}class GenericBlendTexturePass extends ShaderPass2{constructor(o,c="c = a + b;",d="",_,v=120){super({vertexShader:CopyShader.vertexShader,fragmentShader:fe$1`
                varying vec2 vUv;
                
                ${d}
                
                void blend(in vec4 a, in vec4 b, inout vec4 c){
                
                ${c}
                
                }
                void main() {
                    vec4 texel = vec4(0);
                    blend(tDiffuseTexelToLinear ( texture2D( tDiffuse, vUv ) ), tDiffuse2TexelToLinear ( texture2D( tDiffuse2, vUv ) ), texel);
                    texel = clamp(texel, vec4(0), vec4(MAX_INTENSITY));
                    gl_FragColor = texel;
                    #include <colorspace_fragment>
                }
            `,uniforms:{tDiffuse:{value:null},tDiffuse2:{value:_},...o},defines:{MAX_INTENSITY:v}},"tDiffuse","tDiffuse2"),this.clear=!1,this.needsSwap=!0}}var depthNormalVert=`#define DEPTH_NORMAL 
#if IS_GLSL3 > 0
out vec3 vViewPosition;
#else
varying vec3 vViewPosition;
#endif
#ifdef USE_ALPHAMAP
#define USE_UV 
#endif
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main(){
#include <uv_vertex>
#include <beginnormal_vertex>
#include <morphnormal_vertex>
#include <skinbase_vertex>
#include <skinnormal_vertex>
#include <defaultnormal_vertex>
#include <normal_vertex>
#include <begin_vertex>
#include <morphtarget_vertex>
#include <skinning_vertex>
#include <displacementmap_vertex>
#include <project_vertex>
#include <logdepthbuf_vertex>
#include <clipping_planes_vertex>
vViewPosition=-mvPosition.xyz;}`,depthNormalFrag=`#define DEPTH_NORMAL 
#if IS_GLSL3 > 0
in vec3 vViewPosition;
#else
varying vec3 vViewPosition;
#endif
#ifdef USE_ALPHAMAP
#define USE_UV 
#include <packing>
#endif
#if IS_GLSL3 > 0
#ifndef gl_FragColor 
layout(location=0)out vec4 A;layout(location=1)out vec4 B;
#endif
#endif
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
uniform vec2 cameraNearFar;uniform vec4 flags;vec2 pack16(float value){float f=clamp(value,0.,1.)*255.;float digitLow=fract(f);float digitHigh=floor(f)/255.;return vec2(digitHigh,digitLow);}vec2 packNormal(vec3 n){float p=sqrt(n.z*8.+8.);return vec2(n.xy/p+0.5);}float linstep(float edge0,float edge1,float value){return clamp((value-edge0)/(edge1-edge0),0.,1.);}float getSSCurvature(in vec3 normal){vec3 n=normalize(normal);vec3 dx=dFdx(n);vec3 dy=dFdy(n);vec3 xneg=n-dx;vec3 xpos=n+dx;vec3 yneg=n-dy;vec3 ypos=n+dy;float curvature=(cross(xneg,xpos).y-cross(yneg,ypos).x);return curvature;}void main(){
#glMarker mainStart
#include <clipping_planes_fragment>
vec4 diffuseColor=vec4(1.);
#include <map_fragment>
#ifdef USE_ALPHAMAP
float alphaMapValue=
#ifdef ALPHA_I_RGBA_PACKING
1.-unpackRGBAToDepth(texture2D(alphaMap,vAlphaMapUv));
#else
texture2D(alphaMap,vAlphaMapUv).g;
#endif
#if defined(INVERSE_ALPHAMAP) && INVERSE_ALPHAMAP >= 1
diffuseColor.a*=1.-alphaMapValue;
#else
diffuseColor.a*=alphaMapValue;
#endif
#endif
#include <alphatest_fragment>
#include <logdepthbuf_fragment>
#include <normal_fragment_begin>
#include <normal_fragment_maps>
#ifdef FORCED_LINEAR_DEPTH
float linearZ=float(FORCED_LINEAR_DEPTH);
#else
float linearZ=linstep(-cameraNearFar.x,-cameraNearFar.y,-vViewPosition.z);
#endif
vec2 packedZ=pack16(pow(max(0.,linearZ),0.5));vec2 packedNormal=packNormal(normal);
#if IS_GLSL3 > 0
#ifndef gl_FragColor 
A=vec4(packedZ.x,packedZ.y,packedNormal.x,packedNormal.y);B=flags;B.x=getSSCurvature(normal)*0.5+0.5;
#else
gl_FragColor=vec4(packedZ.x,packedZ.y,packedNormal.x,packedNormal.y);
#endif
#else
gl_FragColor=vec4(packedZ.x,packedZ.y,packedNormal.x,packedNormal.y);
#endif
}`;class DepthNormalMaterial extends ShaderMaterial2{constructor(o=!0){super({vertexShader:depthNormalVert,fragmentShader:depthNormalFrag,uniforms:three_module.LlO.merge([three_module.fCn.common,three_module.fCn.bumpmap,three_module.fCn.normalmap,three_module.fCn.displacementmap,{cameraNearFar:{value:new three_module.I9Y(.1,1e3)},flags:{value:new three_module.IUQ(255,255,255,255)}}]),defines:{IS_GLSL3:o?"1":"0"},glslVersion:o?three_module.Wdf:three_module.Wyr}),this.normalMapType=three_module.bI3,this.flatShading=!1,this._updaters=[]}onBeforeRender(o,c,d,_,v){var b,tt,it,nt,lt,ut,ht,_t,ft,bt,xt,St,wt;super.onBeforeRender(o,c,d,_,v);let Pt=v.material;Array.isArray(Pt)&&(Pt=Pt[0]),this.uniforms.map.value=(b=Pt==null?void 0:Pt.map)!==null&&b!==void 0?b:null,this.uniforms.map.value&&o.materials.refreshTransformUniform(this.uniforms.map.value,this.uniforms.mapTransform),this.uniforms.alphaMap.value=(tt=Pt==null?void 0:Pt.alphaMap)!==null&&tt!==void 0?tt:null,this.uniforms.alphaMap.value&&o.materials.refreshTransformUniform(this.uniforms.alphaMap.value,this.uniforms.alphaMapTransform),this.alphaTest=!Pt||!Pt.alphaTest||Pt.alphaTest<1e-7?.001:Pt.alphaTest,this.uniforms.alphaTest.value=this.alphaTest,this.uniforms.displacementMap.value=(it=Pt==null?void 0:Pt.displacementMap)!==null&&it!==void 0?it:null,this.uniforms.displacementMap.value&&o.materials.refreshTransformUniform(this.uniforms.displacementMap.value,this.uniforms.displacementMapTransform),this.uniforms.displacementScale.value=(nt=Pt==null?void 0:Pt.displacementScale)!==null&&nt!==void 0?nt:1,this.uniforms.displacementBias.value=(lt=Pt==null?void 0:Pt.displacementBias)!==null&&lt!==void 0?lt:0,this.uniforms.bumpMap.value=(ut=Pt==null?void 0:Pt.bumpMap)!==null&&ut!==void 0?ut:null,this.uniforms.bumpMap.value&&o.materials.refreshTransformUniform(this.uniforms.bumpMap.value,this.uniforms.bumpMapTransform),this.uniforms.bumpScale.value=(ht=Pt==null?void 0:Pt.bumpScale)!==null&&ht!==void 0?ht:1,this.uniforms.normalMap.value=(_t=Pt==null?void 0:Pt.normalMap)!==null&&_t!==void 0?_t:null,this.uniforms.normalMap.value&&o.materials.refreshTransformUniform(this.uniforms.normalMap.value,this.uniforms.normalMapTransform),this.uniforms.normalScale.value&&this.uniforms.normalScale.value.copy((ft=Pt==null?void 0:Pt.normalScale)!==null&&ft!==void 0?ft:new three_module.I9Y(1,1)),this.normalMapType=(bt=Pt==null?void 0:Pt.normalMapType)!==null&&bt!==void 0?bt:three_module.bI3,this.flatShading=(xt=Pt==null?void 0:Pt.flatShading)!==null&&xt!==void 0&&xt,this.uniforms.flags.value.set(255,255,255,255),this.uniforms.flags.value.z=(Pt!=null&&Pt.userData.matId?Pt==null?void 0:Pt.userData.matId:0)/255,this._updaters.forEach(kt=>{kt(v,this.uniforms.flags.value)}),this.uniforms.flags.value.y/=255,this.uniforms.flags.value.w/=255,this.uniformsNeedUpdate=!0;let Rt=this.uniforms.alphaMap.value?1:void 0;Rt!==this.defines.USE_ALPHAMAP&&(Rt===void 0?(delete this.defines.USE_ALPHAMAP,delete this.defines.ALPHAMAP_UV):(this.defines.USE_ALPHAMAP=Rt,this.defines.ALPHAMAP_UV="uv"),this.needsUpdate=!0),Rt=this.uniforms.map.value?1:void 0,Rt!==this.defines.USE_MAP&&(Rt===void 0?(delete this.defines.USE_MAP,delete this.defines.MAP_UV):(this.defines.USE_MAP=Rt,this.defines.MAP_UV="uv"),this.needsUpdate=!0),Rt=this.uniforms.bumpMap.value?1:void 0,Rt!==this.defines.USE_BUMPMAP&&(Rt===void 0?(delete this.defines.USE_BUMPMAP,delete this.defines.BUMPMAP_UV):(this.defines.USE_BUMPMAP=Rt,this.defines.BUMPMAP_UV="uv"),this.needsUpdate=!0),Rt=this.uniforms.normalMap.value?1:void 0,Rt!==this.defines.USE_NORMALMAP&&(Rt===void 0?(delete this.defines.USE_NORMALMAP,delete this.defines.NORMALMAP_UV):(this.defines.USE_NORMALMAP=Rt,this.defines.NORMALMAP_UV="uv"),this.needsUpdate=!0),Rt=this.uniforms.displacementMap.value?1:void 0,Rt!==this.defines.USE_DISPLACEMENTMAP&&(Rt===void 0?(delete this.defines.USE_DISPLACEMENTMAP,delete this.defines.DISPLACEMENTMAP_UV):(this.defines.USE_DISPLACEMENTMAP=Rt,this.defines.DISPLACEMENTMAP_UV="uv"),this.needsUpdate=!0),Rt=Pt.userData.ALPHA_I_RGBA_PACKING?1:void 0,Rt!==this.defines.ALPHA_I_RGBA_PACKING&&(Rt===void 0?delete this.defines.ALPHA_I_RGBA_PACKING:this.defines.ALPHA_I_RGBA_PACKING=Rt,this.needsUpdate=!0),Rt=(St=Pt.userData.forcedLinearDepth)!==null&&St!==void 0?St:void 0,Rt!==this.defines.FORCED_LINEAR_DEPTH&&(Rt===void 0?delete this.defines.FORCED_LINEAR_DEPTH:this.defines.FORCED_LINEAR_DEPTH=Rt,this.needsUpdate=!0),this.side=(wt=Pt.side)!==null&&wt!==void 0?wt:three_module.$EB}addGBufferUpdater(o){this._updaters.push(o)}removeGBufferUpdater(o){const c=this._updaters.indexOf(o);c!==-1&&this._updaters.splice(c,1)}}var unpackGbuffer=`#ifndef UNPACK_GBUFFER_SNIPPET
#define UNPACK_GBUFFER_SNIPPET 
uniform sampler2D tNormalDepth;float unpack16(vec2 value){return value.x+value.y/255.;}vec3 unpackNormal(vec2 enc){vec2 fenc=enc*4.-2.;float f=dot(fenc,fenc);float g=sqrt(1.-f/4.);return vec3(fenc*g,1.-f/2.);}float unpackDepth(vec2 uncodedDepth){float x=unpack16(uncodedDepth.xy);return x*x;}float getDepth(vec2 uv){vec4 uncodedDepth=texture2D(tNormalDepth,uv);return unpackDepth(uncodedDepth.xy);}void getDepthNormal(const in vec2 uv,out float depth,out vec3 normal){vec4 uncodedDepth=texture2D(tNormalDepth,uv);depth=unpackDepth(uncodedDepth.xy);normal=unpackNormal(uncodedDepth.zw);}vec3 getViewNormal(const in vec2 uv){return unpackNormal(texture2D(tNormalDepth,uv).zw);}
#if defined(GBUFFER_HAS_FLAGS) && GBUFFER_HAS_FLAGS == 1
uniform sampler2D tGBufferFlags;
#endif
ivec4 getGBufferFlags(const in vec2 uv){
#if defined(GBUFFER_HAS_FLAGS) && GBUFFER_HAS_FLAGS == 1
return ivec4(texture2D(tGBufferFlags,uv)*255.);
#else
return ivec4(1);
#endif
}
#endif
`;class AViewerPlugin extends I$2{constructor(){super(...arguments),this._dirty=!1}get dirty(){return this.enabled&&this._dirty}set dirty(o){this._dirty=o}get viewer(){return this._viewer}async onAdded(o){this._viewer=o}async onDispose(o){}async onRemove(o){this._viewer!==o&&console.error("Wrong viewer"),this._viewer=void 0}toJSON(o){const c=serializeObject(this,!0,o);return c.type=this.constructor.PluginType,this.dispatchEvent({type:"serialize",data:c}),c}fromJSON(o,c){return o.type!==this.constructor.PluginType?null:(deserializeObject(o,this,!0,c),this.dispatchEvent({type:"deserialize",data:o,meta:c}),this)}_storeKey(o){return(o??"webgi")+"_"+(this.constructor.PluginType||this.constructor.name)}exportState(){var o,c,d,_;return(d=(c=(o=this._viewer)===null||o===void 0?void 0:o.getPluginByType("AssetManager"))===null||c===void 0?void 0:c.exportPluginPreset(this))!==null&&d!==void 0?d:(_=this.toJSON)===null||_===void 0?void 0:_.call(this)}async importState(o){var c,d;const _=(c=this._viewer)===null||c===void 0?void 0:c.getPluginByType("AssetManager");_?await _.importPluginPreset(o,this):(d=this.fromJSON)===null||d===void 0||d.call(this,o)}storeState(o,c,d){(c=c||(window?window.localStorage:void 0))?(d===void 0&&(d=this.exportState()),d&&c.setItem(this._storeKey(o),JSON.stringify(d))):console.warn("Unable to store state")}async loadState(o,c){if(!(c=c||(window?window.localStorage:void 0)))return void console.warn("Unable to load state");const d=c.getItem(this._storeKey(o));d&&await this.importState(JSON.parse(d))}}function makeFilter(h,o,c){return{...o,get dirty(){return o.dirty||!1},set dirty(d){S$2(o,"dirty",d,!0)},update(){var d,_,v;this.passObject.enabled&&((_=(d=this.passObject).updateShaderProperties)===null||_===void 0||_.call(d,Ee$1(c)),(v=o.update)===null||v===void 0||v.call(this))},onRegister(d){var _,v,b;this.passObject.materialExtension&&((v=(_=h.getPluginByType("AssetManager"))===null||_===void 0?void 0:_.materials)===null||v===void 0||v.registerMaterialExtension(this.passObject.materialExtension)),(b=o.onRegister)===null||b===void 0||b.call(this,d)},onUnregister(d){var _,v,b;this.passObject.materialExtension&&((v=(_=h.getPluginByType("AssetManager"))===null||_===void 0?void 0:_.materials)===null||v===void 0||v.unregisterMaterialExtension(this.passObject.materialExtension)),(b=o.onUnregister)===null||b===void 0||b.call(this,d)},dispose(){var d,_,v;(_=(d=this.passObject).dispose)===null||_===void 0||_.call(d),(v=o.dispose)===null||v===void 0||v.call(this)}}}var GenericFilterPlugin_decorate=function(h,o,c,d){var _,v=arguments.length,b=v<3?o:d===null?d=Object.getOwnPropertyDescriptor(o,c):d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(h,o,c,d);else for(var tt=h.length-1;tt>=0;tt--)(_=h[tt])&&(b=(v<3?_(b):v>3?_(o,c,b):_(o,c))||b);return v>3&&b&&Object.defineProperty(o,c,b),b};class GenericFilterPlugin extends AViewerPlugin{_update(o){var c;return((c=this._pass)===null||c===void 0?void 0:c.enabled)&&this.enabled||!1}get enabled(){var o,c,d;return(d=(c=(o=this._pass)===null||o===void 0?void 0:o.passObject)===null||c===void 0?void 0:c.enabled)!==null&&d!==void 0?d:this._enabledTemp}set enabled(o){var c;!((c=this._pass)===null||c===void 0)&&c.passObject&&(this._pass.passObject.enabled=o),this._enabledTemp=o}constructor(){super(),this._enabledTemp=!0}async onAdded(o){await super.onAdded(o);const c={enabled:!0,passId:this.passId,passObject:this.passCtor(o),after:this._afterFilters,before:this._beforeFilters,required:this._requiredFilters,set dirty(d){d&&o.setDirty()},get dirty(){return!1},update:()=>this._update(o)};this._pass=makeFilter(o,c),c.passObject.onDirty!==void 0&&c.passObject.onDirty.push(()=>c.dirty=!0),o.renderer.registerPass(this._pass),this.enabled=this._enabledTemp}async onRemove(o){var c,d;this._pass&&o.renderer.unregisterPass(this._pass),(d=(c=this._pass)===null||c===void 0?void 0:c.dispose)===null||d===void 0||d.call(c),this._pass=void 0,await super.onRemove(o)}get pass(){return this._pass}toJSON(o){var c;const d=super.toJSON(o);if(!d.type)return d;const _=this.pass;return _&&(d.pass=serializeObject((c=_==null?void 0:_.passObject)!==null&&c!==void 0?c:_,!1,o)),d}fromJSON(o,c){var d;if(!super.fromJSON(o,c))return null;if(o.pass){const _=this.pass;_&&deserializeObject(o.pass,(d=_==null?void 0:_.passObject)!==null&&d!==void 0?d:_,!1,c)}return this}}GenericFilterPlugin_decorate([serialize()],GenericFilterPlugin.prototype,"enabled",null);class GBufferRenderPass extends RenderPass{constructor(o,c,d=new three_module.Q1f(1,1,1),_=1){super(void 0,void 0,c,d,_),this.target=o,this._transparentMats=new Set,this._transmissiveMats=new Set}render(o,c,d,_,v){var b;const tt=o.getRenderTarget(),it=o.getActiveCubeFace(),nt=o.getActiveMipmapLevel();(b=this.scene)===null||b===void 0||b.traverse(({material:lt})=>{lt&&((lt.transparent&&lt.userData.renderToDepth||!lt.transparent&&lt.transmission===0&&lt.userData.renderToDepth===!1)&&(this._transparentMats.add(lt),lt.transparent=!lt.transparent),Math.abs(lt.transmission||0)>0&&lt.userData.renderToDepth&&(this._transmissiveMats.add([lt,lt.transmission]),lt.transmission=0))}),setThreeRendererMode(o,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!0,transparentRender:!1,transmissionRender:!1,mainRenderPass:!1},()=>super.render(o,c,this.target,_,v)),this._transparentMats.forEach(lt=>lt.transparent=!lt.transparent),this._transparentMats.clear(),this._transmissiveMats.forEach(([lt,ut])=>lt.transmission=ut),this._transmissiveMats.clear(),o.setRenderTarget(tt,it,nt)}}class GBufferPlugin extends GenericFilterPlugin{get material(){return this._material}passCtor(o){var c,d,_;const v=((c=this._viewer)===null||c===void 0?void 0:c.renderer.isWebGL2)&&this.renderFlagsBuffer,b=o.renderer.createTarget({depthBuffer:!0,samples:((d=this._viewer)===null||d===void 0?void 0:d.useGBufferDepth)&&((_=this._viewer)===null||_===void 0?void 0:_.renderer.composerTarget.samples)||0,type:three_module.OUM,textureCount:v?2:1,depthTexture:this.renderDepthTexture,depthTextureType:this.depthTextureType});return Array.isArray(b.texture)?(b.texture[0].name="gbufferDepthNormal",b.texture[1].name="gbufferFlags",this._gbufferTextures=b.texture):(b.texture.name="gbufferDepthNormal",this._gbufferTextures.push(b.texture)),this._gbufferTarget=b,this._material=new DepthNormalMaterial(v),this._material.userData.isGBufferMaterial=!0,new GBufferRenderPass(b,this._material)}_update(o){if(!super._update(o))return!1;const c=this.pass.passObject;return c.scene=o.scene.modelObject,o.scene.renderCamera.updateShaderProperties(c.overrideMaterial),c.camera=o.scene.renderCamera.cameraObject,!0}constructor(o=!0,c=!1,d=three_module.bkx){super(),this.renderFlagsBuffer=o,this.renderDepthTexture=c,this.depthTextureType=d,this.passId="gbuffer",this._beforeFilters=["render"],this._afterFilters=[],this._requiredFilters=["render"],this._gbufferTextures=[]}getDepthNormal(){return this._gbufferTextures.length>0?this._gbufferTextures[0]:void 0}getFlagsTexture(){return this._gbufferTextures.length>1?this._gbufferTextures[1]:void 0}async onDispose(o){}async onRemove(o){return this._gbufferTarget&&(o.renderer.disposeTarget(this._gbufferTarget),this._gbufferTarget=void 0),super.onRemove(o)}getTarget(){return this._gbufferTarget}getDepthTexture(){var o;return(o=this._gbufferTarget)===null||o===void 0?void 0:o.depthTexture}getUnpackSnippet(){return unpackGbuffer}updateShaderProperties(o){var c,d,_;if(o.uniforms.tNormalDepth?o.uniforms.tNormalDepth.value=(c=this.getDepthNormal())!==null&&c!==void 0?c:void 0:(d=this._viewer)===null||d===void 0||d.console.warn("BaseRenderer: no uniform: tNormalDepth"),o.uniforms.tGBufferFlags){o.uniforms.tGBufferFlags.value=(_=this.getFlagsTexture())!==null&&_!==void 0?_:void 0;const v=o.uniforms.tGBufferFlags.value?1:0;v!==o.defines.GBUFFER_HAS_FLAGS&&(o.defines.GBUFFER_HAS_FLAGS=v,o.needsUpdate=!0)}return this}registerGBufferUpdater(o){this._material&&this._material.addGBufferUpdater(o)}}GBufferPlugin.PluginType="GBuffer";class RenderPass2 extends RenderPass{get transparentTarget(){return this._transparentTarget||(this._transparentTarget=this._viewer.renderer.getTempTarget({sizeMultiplier:1,samples:this._viewer.renderer.composerTarget.samples||0,colorSpace:three_module.jf0,type:this._viewer.renderer.rendererObject.extensions.has("EXT_color_buffer_half_float")?three_module.ix0:three_module.OUM,format:three_module.GWd,minFilter:three_module.k6q,magFilter:three_module.k6q,depthBuffer:!1})),this._transparentTarget}_releaseTransparentTarget(){this._transparentTarget&&this._viewer.renderer.releaseTempTarget(this._transparentTarget),this._transparentTarget=void 0}constructor(o,c=!0){super(),this.blurTransmissionTarget=!0,this.preserveTransparentTarget=!1,this._viewer=o,this._doTransmissionFix=c,this.clear=!0,this.clearColor=new three_module.Q1f(0,0,0),this.clearAlpha=0,this.clearDepth=!1,this._blendPass=new GenericBlendTexturePass({},"c = vec4(a.rgb * (1. - b.a) + b.rgb * b.a, 1.);",void 0,void 0,o.renderer.maxHDRIntensity)}render(o,c,d,_,v){var b;let tt=!1;if(o.userData.mainRenderPass=!0,!this._doTransmissionFix)return super.render(o,c,d,_,v),this.needsSwap=tt,void(o.userData.mainRenderPass=void 0);const it=o.userData;it||console.error("threejs is not patched?");const nt=this._viewer.useGBufferDepth;let lt;if(nt){const ht=(b=this._viewer.getPlugin(GBufferPlugin))===null||b===void 0?void 0:b.getTarget();if(ht){const _t=o.properties.get(ht);lt=_t.__webglDepthRenderbuffer||_t.__webglDepthbuffer}else console.warn("No Gbuffer present for depth prepass.")}let ut=(ht=!1)=>{super.render(o,void 0,d,_,v,lt)};if(this._viewer.useRgbm){if(this._viewer.useRgbm){if(tt=!1,o.info&&!o.info.autoReset)throw"renderer.info.autoReset must be true";{const ht=o.autoClearDepth;o.autoClearDepth=!nt,setThreeRendererMode(o,{shadowMapRender:!0,backgroundRender:!0,opaqueRender:!0,transparentRender:!1,transmissionRender:!1},ut),o.autoClearDepth=ht}if(!nt){const ht=o.properties.get(d);lt=ht.__webglDepthRenderbuffer||ht.__webglDepthbuffer}ut=()=>{super.render(o,void 0,this.transparentTarget,_,v,lt)};{const ht=this.clear,_t=o.autoClearDepth;o.autoClearDepth=!1,this.clear=!0,setThreeRendererMode(o,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!1,transparentRender:!0,transmissionRender:!1},ut),this.clear=ht,o.autoClearDepth=_t}(!o.info||o.info.render.calls>0)&&(this._blendPass.uniforms.tDiffuse2.value=this.transparentTarget.texture,this._blendPass.render(o,c,d,_,v),tt=!0);{const ht=this.clear;this.clear=!1,it.transmissionRenderTarget=tt?c:d,it.blurTransmissionTarget=this.blurTransmissionTarget&&it.transmissionRenderTarget.samples===0,setThreeRendererMode(o,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!1,transparentRender:!1,transmissionRender:!0},ut),it.blurTransmissionTarget=void 0,it.transmissionRenderTarget=void 0,this.clear=ht}(!o.info||o.info.render.calls>0)&&(this._blendPass.uniforms.tDiffuse2.value=this.transparentTarget.texture,this._blendPass.render(o,c,d,_,v),tt=!0)}}else{{const ht=this.clear,_t=o.autoClearDepth;o.autoClearDepth=!nt,this.clear=!0,setThreeRendererMode(o,{shadowMapRender:!0,backgroundRender:!0,opaqueRender:!0,transparentRender:!0,transmissionRender:!1},ut),this.clear=ht,o.autoClearDepth=_t}{this._viewer.renderer.blit(d.texture,c,{clear:!0});const ht=this.clear;this.clear=!1,it.transmissionRenderTarget=c,it.blurTransmissionTarget=this.blurTransmissionTarget,setThreeRendererMode(o,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!1,transparentRender:!1,transmissionRender:!0},ut),it.blurTransmissionTarget=void 0,it.transmissionRenderTarget=void 0,this.clear=ht}tt=!1}this.preserveTransparentTarget||this._releaseTransparentTarget(),this.needsSwap=tt,o.userData.mainRenderPass=void 0}dispose(){this._releaseTransparentTarget(),super.dispose()}}function vRGBMToLinear(h,o){return h.multiplyScalar(h.w*o),h.w=1,h}function cRGBMToLinear(h,o){return vRGBMToLinear(h,o),new three_module.Q1f(h.x,h.y,h.z)}function vLinearToRGBM(h,o){const c=Math.max(h.x,Math.max(h.y,h.z));let d=Math.max(Math.min(c/o,1),0);return d=Math.ceil(255*d)/255,h.divideScalar(d*o),h.w=d,h}function cLinearToRGBM(h,o){return vLinearToRGBM(new three_module.IUQ(h.r,h.g,h.b,1),o)}const threeMaterialPropList={name:"",blending:three_module.NTi,side:three_module.hB5,vertexColors:!1,opacity:1,transparent:!1,blendSrc:three_module.ie2,blendDst:three_module.OuU,blendEquation:three_module.gO9,blendSrcAlpha:null,blendDstAlpha:null,blendEquationAlpha:null,depthFunc:three_module.xSv,depthTest:!0,depthWrite:!0,stencilWriteMask:255,stencilFunc:three_module.sKt,stencilRef:0,stencilFuncMask:255,stencilFail:three_module.VVr,stencilZFail:three_module.VVr,stencilZPass:three_module.VVr,stencilWrite:!1,clippingPlanes:null,clipIntersection:!1,clipShadows:!1,shadowSide:null,colorWrite:!0,precision:null,polygonOffset:!1,polygonOffsetFactor:0,polygonOffsetUnits:0,dithering:!1,alphaToCoverage:!1,premultipliedAlpha:!1,forceSinglePass:!1,visible:!0,toneMapped:!0,userData:{},alphaTest:0,alphaHash:!1},standardMaterialPropList={...threeMaterialPropList,color:"#ffffff",roughness:1,metalness:0,map:null,lightMap:null,lightMapIntensity:1,aoMap:null,aoMapIntensity:1,emissive:"#000000",emissiveIntensity:1,emissiveMap:null,bumpMap:null,bumpScale:1,normalMap:null,normalMapType:three_module.bI3,normalScale:new three_module.I9Y(1,1),displacementMap:null,displacementScale:1,displacementBias:0,roughnessMap:null,metalnessMap:null,alphaMap:null,envMap:null,envMapIntensity:1,wireframe:!1,wireframeLinewidth:1,wireframeLinecap:"round",wireframeLinejoin:"round",flatShading:!1,fog:!0},physicalMaterialPropList={...standardMaterialPropList,clearcoat:0,clearcoatMap:null,clearcoatRoughness:0,clearcoatRoughnessMap:null,clearcoatNormalScale:new three_module.I9Y(1,1),clearcoatNormalMap:null,reflectivity:.5,iridescence:0,iridescenceMap:null,iridescenceIOR:1.3,iridescenceThicknessRange:[100,400],iridescenceThicknessMap:null,sheen:0,sheenColor:new three_module.Q1f(0),sheenColorMap:null,sheenRoughness:1,sheenRoughnessMap:null,transmission:0,transmissionMap:null,thickness:0,thicknessMap:null,attenuationDistance:1/0,attenuationColor:new three_module.Q1f(1,1,1),specularIntensity:1,specularIntensityMap:null,specularColor:new three_module.Q1f(1,1,1),specularColorMap:null};class MeshStandardMaterial2 extends three_module.uSd{constructor(o){var c;super(o),this.typeSlug=MeshStandardMaterial2.TypeSlug,this.assetType="material",this.materialObject=this,this.isMeshStandardMaterial2=!0,this.extraUniformsToUpload={},this.setDirty=this.setDirty.bind(this),this.userData.setDirty=d=>{console.warn("userData.setDirty is deprecated. Use setDirty instead."),this.setDirty(d)},this.fog=!1,this.attenuationDistance=0,this.materialExtensions=MaterialExtender.RegisterExtensions(this,(c=o==null?void 0:o.customMaterialExtensions)!==null&&c!==void 0?c:[])}setDirty(o){var c,d;this.needsUpdate=!0,this.dispatchEvent({...o,type:"materialUpdate"}),(o==null?void 0:o.last)!==!1&&((d=(c=this._uiConfig)===null||c===void 0?void 0:c.uiRefresh)===null||d===void 0||d.call(c,"postFrame",!0,1))}registerMaterialExtensions(o){this.materialExtensions=[...this.materialExtensions,...MaterialExtender.RegisterExtensions(this,o)]}unregisterMaterialExtensions(o){}get uiConfig(){return this._uiConfigChildren||(this._uiConfigChildren=[{type:"input",property:[this,"name"]},{type:"checkbox",property:[this,"wireframe"]},{type:"checkbox",property:[this,"vertexColors"]},{type:"color",property:[this,"color"],limitedUi:!0},{type:"image",property:[this,"map"]},makeSamplerUi(this,"map"),{type:"folder",label:"Rough/Metal",limitedUi:!0,children:[{type:"slider",bounds:[0,1],property:[this,"roughness"],limitedUi:!0},{type:"slider",bounds:[0,1],property:[this,"metalness"],limitedUi:!0},{type:"image",property:[this,"roughnessMap"]},makeSamplerUi(this,"roughnessMap"),{type:"image",property:[this,"metalnessMap"]},makeSamplerUi(this,"metalnessMap")]},{type:"folder",label:"Bump/Normal",limitedUi:!0,children:[{type:"slider",bounds:[-.1,.2],stepSize:.001,property:[this,"bumpScale"],hidden:()=>!this.bumpMap},{type:"image",property:[this,"bumpMap"]},makeSamplerUi(this,"bumpMap"),{type:"image",property:[this,"normalMap"]},{type:"vec2",property:[this,"normalScale"],hidden:()=>!this.normalMap},{type:"dropdown",hidden:()=>!this.normalMap,property:[this,"normalMapType"],children:[["TangentSpace",three_module.bI3],["ObjectSpace",three_module.vyJ]].map(o=>({label:o[0],value:o[1]}))},makeSamplerUi(this,"normalMap"),{type:"input",property:[this,"displacementScale"],hidden:()=>!this.displacementMap},{type:"image",property:[this,"displacementMap"]},makeSamplerUi(this,"displacementMap")]},{type:"folder",label:"Sheen",children:[{type:"slider",bounds:[0,1],property:[this,"sheen"]},{type:"color",hidden:()=>this.sheen<.001,property:[this,"sheenColor"]},{type:"image",property:[this,"sheenColorMap"]},makeSamplerUi(this,"sheenColorMap"),{type:"slider",bounds:[0,1],property:[this,"sheenRoughness"]},{type:"image",property:[this,"sheenRoughnessMap"]},makeSamplerUi(this,"sheenRoughnessMap")]},{type:"folder",label:"Clearcoat",children:[{type:"slider",bounds:[0,1],property:[this,"clearcoat"]},{type:"slider",bounds:[0,1],hidden:()=>this.clearcoat<.001,property:[this,"clearcoatRoughness"]},{type:"image",property:[this,"clearcoatMap"]},makeSamplerUi(this,"clearcoatMap"),{type:"slider",bounds:[0,1],property:[this,"clearcoatRoughness"]},{type:"image",property:[this,"clearcoatRoughnessMap"]},makeSamplerUi(this,"clearcoatRoughnessMap"),{type:"image",property:[this,"clearcoatNormalMap"]},{type:"vec2",property:[this,"clearcoatNormalScale"],hidden:()=>!this.clearcoatNormalMap},makeSamplerUi(this,"clearcoatNormalMap")]},{type:"folder",label:"Emission",children:[{type:"color",property:[this,"emissive"]},{type:"slider",bounds:[0,10],property:[this,"emissiveIntensity"]},{type:"image",property:[this,"emissiveMap"]},makeSamplerUi(this,"emissiveMap")]},{type:"folder",label:"Refraction",children:[{type:"slider",bounds:[0,4],property:[this,"ior"]},{type:"slider",bounds:[0,1],property:[this,"transmission"],limitedUi:!0},{type:"slider",bounds:[0,1],stepSize:.001,property:[this,"thickness"]},{type:"image",property:[this,"transmissionMap"]},makeSamplerUi(this,"transmissionMap"),{type:"image",property:[this,"thicknessMap"]},makeSamplerUi(this,"thicknessMap"),{type:"input",property:[this,"attenuationDistance"]},{type:"color",property:[this,"attenuationColor"]}]},{type:"folder",label:"Blending",children:[{type:"slider",bounds:[0,1],property:[this,"opacity"]},{type:"checkbox",property:[this,"transparent"],onChange:this.setDirty},{type:"dropdown",property:[this,"depthFunc"],children:[["Never",three_module.eHc],["Always",three_module.lGu],["Less",three_module.brA],["LessEqual",three_module.xSv],["Equal",three_module.U3G],["GreaterEqual",three_module.Gwm],["Greater",three_module.K52],["NotEqual",three_module.bw0]].map(o=>({label:o[0],value:o[1]}))},{type:"checkbox",property:[this,"depthTest"],onChange:this.setDirty},{type:"checkbox",property:[this,"depthWrite"],onChange:this.setDirty},{type:"checkbox",property:[this,"colorWrite"],onChange:this.setDirty},{type:"slider",bounds:[0,1],stepSize:.001,property:[this,"alphaTest"]},{type:"checkbox",property:[this,"alphaHash"]},{type:"checkbox",property:[this,"dithering"]},{type:"dropdown",label:"Blending",property:[this,"blending"],children:[["None",three_module.XIg],["Normal",three_module.NTi],["Additive",three_module.EZo],["Subtractive",three_module.Kwu],["Multiply",three_module.EdD]].map(o=>({label:o[0],value:o[1]}))},{type:"image",property:[this,"alphaMap"]},makeSamplerUi(this,"alphaMap"),{type:"checkbox",label:"Render to Depth",getValue:()=>this.userData.renderToDepth===!0,setValue:o=>{this.userData.renderToDepth=o||void 0,this.setDirty()}},{type:"checkbox",label:"Inverse AlphaMap",hidden:()=>!this.transparent,getValue:()=>this.userData.inverseAlphaMap===!0,setValue:o=>{this.userData.inverseAlphaMap=o||void 0,this.setDirty()}},{type:"checkbox",label:"Polygon Offset",property:[this,"polygonOffset"]},{type:"slider",label:"Polygon Offset Factor",bounds:[-10,10],property:[this,"polygonOffsetFactor"]},{type:"slider",label:"Polygon Offset Units",bounds:[-10,10],property:[this,"polygonOffsetUnits"]}]},{type:"folder",label:"AO/Lightmap",children:[{type:"slider",bounds:[0,2],property:[this,"aoMapIntensity"]},{type:"image",property:[this,"aoMap"]},makeSamplerUi(this,"aoMap"),{type:"slider",bounds:[0,2],property:[this,"lightMapIntensity"]},{type:"image",property:[this,"lightMap"]},makeSamplerUi(this,"lightMap")]},{type:"folder",label:"Iridescence",children:[{type:"slider",bounds:[0,3],label:"Intensity",property:[this,"iridescence"]},{type:"slider",bounds:[0,3],label:"IOR",property:[this,"iridescenceIOR"]},{type:"slider",bounds:[0,500],label:"Thickness0",property:[this.iridescenceThicknessRange,"0"],onChange:this.setDirty},{type:"slider",bounds:[0,500],label:"Thickness1",property:[this.iridescenceThicknessRange,"1"],onChange:this.setDirty},{type:"image",property:[this,"iridescenceMap"]},makeSamplerUi(this,"iridescenceMap"),{type:"image",property:[this,"iridescenceThicknessMap"]},makeSamplerUi(this,"iridescenceThicknessMap")]},{type:"folder",label:"Environment",children:[{type:"checkbox",label:"Override Environment",getValue:()=>this.userData.separateEnvMapIntensity===!0,setValue:o=>{this.userData.separateEnvMapIntensity=o,o||delete this.userData.separateEnvMapIntensity},onChange:this.setDirty},{type:"slider",bounds:[0,10],hidden:()=>!this.userData.separateEnvMapIntensity,label:"Environment Intensity",property:[this,"envMapIntensity"]},{type:"dropdown",hidden:()=>!this.userData.separateEnvMapIntensity&&!this.userData.envMapSlotKey,label:"Environment Map",children:["","environment1","environment2"].map(o=>({label:o||"default",value:o})),getValue:()=>this.userData.envMapSlotKey||"",setValue:o=>{this.userData.envMapSlotKey=o,o||delete this.userData.envMapSlotKey,this.setDirty()}}]},{type:"dropdown",label:"Side",property:[this,"side"],children:[["Front",three_module.hB5],["Back",three_module.hsX],["Double",three_module.$EB]].map(o=>({label:o[0],value:o[1]}))},{type:"checkbox",property:[this,"flatShading"]},{type:"input",label:"Mesh count",getValue:()=>{var o,c,d;return(d=(c=(o=this.userData)===null||o===void 0?void 0:o.__appliedMeshes)===null||c===void 0?void 0:c.size)!==null&&d!==void 0?d:0},setValue:o=>{},disabled:!0},{type:"button",label:`Download ${this.typeSlug}`,value:()=>{N$2(new Blob([JSON.stringify(serializeObject(this,!1),null,2)],{type:"application/json"}),`physical-material.${this.typeSlug}`)}}]),this._uiConfig||(this._uiConfig={type:"folder",label:"Physical Material",expanded:!0,children:this._uiConfigChildren,uuid:"MSM2_"+this.uuid,limitedUi:!0}),this._uiConfig.children=[...this._uiConfigChildren,...this.materialExtensions.map(o=>{var c;return(c=o.getUiConfig)===null||c===void 0?void 0:c.call(o,this)})].filter(o=>o),this._uiConfig}onBeforeCompile(o,c){const d=[["vec3 totalDiffuse = ","afterModulation"],["#include <aomap_fragment>","beforeModulation"],["#include <lights_physical_fragment>","beforeAccumulation"],["#include <clipping_planes_fragment>","mainStart"]],_=[["#include <uv_vertex>","mainStart"]];for(const v of _)o.vertexShader=shaderReplaceString(o.vertexShader,v[0],"#glMarker "+v[1]+`
`+v[0]);for(const v of d)o.fragmentShader=shaderReplaceString(o.fragmentShader,v[0],"#glMarker "+v[1]+`
`+v[0]);MaterialExtender.ApplyMaterialExtensions(this,o,this.materialExtensions,c),o.fragmentShader=o.fragmentShader.replaceAll("#glMarker","// "),o.vertexShader=o.vertexShader.replaceAll("#glMarker","// "),o.defines.INVERSE_ALPHAMAP=this.userData.inverseAlphaMap?1:0,super.onBeforeCompile(o,c)}customProgramCacheKey(){return super.customProgramCacheKey()+MaterialExtender.CacheKeyForExtensions(this,this.materialExtensions)+this.userData.inverseAlphaMap}onBeforeRender(o,c,d,_,v){super.onBeforeRender(o,c,d,_,v),this.envMapIntensity===void 0||this.userData.separateEnvMapIntensity||c.envMapIntensity===void 0||(this.userData.__envIntensity=this.envMapIntensity,this.envMapIntensity=c.envMapIntensity),this.envMap!==void 0&&c.fixedEnvMapDirection!==void 0&&(c.fixedEnvMapDirection?this.defines.FIX_ENV_DIRECTION||(this.defines.FIX_ENV_DIRECTION="1",this.needsUpdate=!0):this.defines.FIX_ENV_DIRECTION!==void 0&&(delete this.defines.FIX_ENV_DIRECTION,this.needsUpdate=!0)),this.dispatchEvent({type:"beforeRender",renderer:o,scene:c,camera:d,geometry:_,object:v});const b=this.userData.inverseAlphaMap?1:0;b!==this.defines.INVERSE_ALPHAMAP&&(this.defines.INVERSE_ALPHAMAP=b,this.needsUpdate=!0)}onAfterRender(o,c,d,_,v){super.onAfterRender(o,c,d,_,v),this.userData.__envIntensity!==void 0&&(this.envMapIntensity=this.userData.__envIntensity,delete this.userData.__envIntensity),this.dispatchEvent({type:"afterRender",renderer:o,scene:c,camera:d,geometry:_,object:v})}copyProps(o,c=!1,d=!0){if(!c&&!["MeshStandardMaterial",MeshStandardMaterial2.TYPE,"MeshPhysicalMaterial"].includes(o.type))return console.error("Material type is not supported:",o.type),this;const _={};xe$1(o,_,Array.from(Object.keys(physicalMaterialPropList)));const v=_.userData;delete _.userData;for(const b of Object.keys(_))_[b]===void 0&&delete _[b];if(this.setValues(_),d)for(const b of iMaterialIgnoredUserData)this.userData[b]!==void 0&&this.userData[b];return v&&copyMaterialUserData(this.userData,v),isFinite(this.attenuationDistance)||(this.attenuationDistance=0),this.setDirty(),this}toJSON(o){var c,d;const _=this.userData;this.userData={};const v=super.toJSON(o);this.userData=_,v.userData={},copyMaterialUserData(v.userData,_),v.userData.uuid=this.userData.uuid;const b=o||{textures:Object.fromEntries(((c=v.textures)===null||c===void 0?void 0:c.map(tt=>[tt.uuid,tt]))||[]),images:Object.fromEntries(((d=v.images)===null||d===void 0?void 0:d.map(tt=>[tt.uuid,tt]))||[])};v.userData=serializeObject(v.userData,!1,b),o||(Object.keys(b.textures).length>0&&(v.textures=Object.values(b.textures)),Object.keys(b.images).length>0&&(v.images=Object.values(b.images))),v.type=MeshStandardMaterial2.TYPE;for(const tt of Object.keys(v))v[tt]===void 0&&delete v[tt];return v}fromJSON(o,c,d=!1){return this.copyProps(o,d)}clone(){return super.clone()}}MeshStandardMaterial2.TypeSlug="pmat",MeshStandardMaterial2.TYPE="MeshStandardMaterial2";const basicMaterialPropList={...threeMaterialPropList,color:"#ffffff",map:null,lightMap:null,lightMapIntensity:1,aoMap:null,aoMapIntensity:1,specularMap:null,alphaMap:null,envMap:null,combine:three_module.caT,reflectivity:1,refractionRatio:.98,wireframe:!1,wireframeLinewidth:1,wireframeLinecap:"round",wireframeLinejoin:"round",skinning:!1,fog:!0};class MeshBasicMaterial2 extends three_module.V9B{constructor(o){var c;super(o),this.typeSlug=MeshBasicMaterial2.TypeSlug,this.assetType="material",this.materialObject=this,this.isMeshBasicMaterial2=!0,this.extraUniformsToUpload={},!this.defines&&(this.defines={}),this.fog=!1,this.setDirty=this.setDirty.bind(this),this.userData.setDirty=d=>{console.warn("WebGi: userData.setDirty is deprecated. Use setDirty instead."),this.setDirty(d)},this.materialExtensions=MaterialExtender.RegisterExtensions(this,(c=o==null?void 0:o.customMaterialExtensions)!==null&&c!==void 0?c:[])}setDirty(o){var c,d;this.needsUpdate=!0,this.dispatchEvent({...o,type:"materialUpdate"}),(o==null?void 0:o.last)!==!1&&((d=(c=this._uiConfig)===null||c===void 0?void 0:c.uiRefresh)===null||d===void 0||d.call(c,"postFrame",!0,1))}registerMaterialExtensions(o){this.materialExtensions=[...this.materialExtensions,...MaterialExtender.RegisterExtensions(this,o)]}unregisterMaterialExtensions(o){}get uiConfig(){return this._uiConfigChildren||(this._uiConfigChildren=[{type:"input",property:[this,"name"]},{type:"checkbox",property:[this,"wireframe"]},{type:"color",property:[this,"color"],limitedUi:!0},{type:"image",property:[this,"map"]},makeSamplerUi(this,"map"),{type:"folder",label:"Blending",children:[{type:"slider",bounds:[0,1],property:[this,"opacity"]},{type:"checkbox",property:[this,"transparent"],onChange:this.setDirty},{type:"checkbox",property:[this,"depthWrite"],onChange:this.setDirty},{type:"checkbox",property:[this,"colorWrite"],onChange:this.setDirty},{type:"slider",bounds:[0,1],property:[this,"alphaTest"]},{type:"checkbox",property:[this,"alphaHash"]},{type:"checkbox",property:[this,"dithering"]},{type:"dropdown",label:"Blending",property:[this,"blending"],children:[["None",three_module.XIg],["Normal",three_module.NTi],["Additive",three_module.EZo],["Subtractive",three_module.Kwu],["Multiply",three_module.EdD]].map(o=>({label:o[0],value:o[1]}))},{type:"image",property:[this,"alphaMap"]},makeSamplerUi(this,"alphaMap"),{type:"checkbox",label:"Render to Depth",getValue:()=>this.userData.renderToDepth===!0,setValue:o=>{this.userData.renderToDepth=o||void 0,this.setDirty()}}]},{type:"folder",label:"AO/Lightmap",children:[{type:"slider",bounds:[0,2],property:[this,"aoMapIntensity"]},{type:"image",property:[this,"aoMap"]},makeSamplerUi(this,"aoMap"),{type:"slider",bounds:[0,2],property:[this,"lightMapIntensity"]},{type:"image",property:[this,"lightMap"]},makeSamplerUi(this,"lightMap")]},{type:"dropdown",label:"Side",property:[this,"side"],children:[["Front",three_module.hB5],["Back",three_module.hsX],["Double",three_module.$EB]].map(o=>({label:o[0],value:o[1]}))},{type:"input",label:"Mesh count",getValue:()=>{var o,c,d;return(d=(c=(o=this.userData)===null||o===void 0?void 0:o.__appliedMeshes)===null||c===void 0?void 0:c.size)!==null&&d!==void 0?d:0},setValue:o=>{},disabled:!0},{type:"button",label:`Download ${this.typeSlug}`,value:()=>{N$2(new Blob([JSON.stringify(serializeObject(this,!1),null,2)],{type:"application/json"}),`unlit-material.${this.typeSlug}`)}}]),this._uiConfig||(this._uiConfig={type:"folder",label:"Unlit Material",expanded:!0,children:this._uiConfigChildren,uuid:"MBM2_"+this.uuid,limitedUi:!0}),this._uiConfig.children=[...this._uiConfigChildren,...this.materialExtensions.map(o=>{var c;return(c=o.getUiConfig)===null||c===void 0?void 0:c.call(o,this)})].filter(o=>o),this._uiConfig}onBeforeCompile(o,c){const d=[["vec3 outgoingLight = ","afterModulation"],["#include <aomap_fragment>","beforeModulation"],["ReflectedLight reflectedLight = ","beforeAccumulation"],["#include <clipping_planes_fragment>","mainStart"]],_=[["#include <uv_vertex>","mainStart"]];for(const v of _)o.vertexShader=shaderReplaceString(o.vertexShader,v[0],"#glMarker "+v[1]+`
`+v[0]);for(const v of d)o.fragmentShader=shaderReplaceString(o.fragmentShader,v[0],"#glMarker "+v[1]+`
`+v[0]);MaterialExtender.ApplyMaterialExtensions(this,o,this.materialExtensions,c),this.dispatchEvent({type:"beforeCompile",shader:o,renderer:c}),o.fragmentShader=o.fragmentShader.replaceAll("#glMarker","// "),o.vertexShader=o.vertexShader.replaceAll("#glMarker","// "),super.onBeforeCompile(o,c)}customProgramCacheKey(){return super.customProgramCacheKey()+MaterialExtender.CacheKeyForExtensions(this,this.materialExtensions)+this.userData.inverseAlphaMap}onBeforeRender(o,c,d,_,v){super.onBeforeRender(o,c,d,_,v),this.dispatchEvent({type:"beforeRender",renderer:o,scene:c,camera:d,geometry:_,object:v})}onAfterRender(o,c,d,_,v){super.onAfterRender(o,c,d,_,v),this.dispatchEvent({type:"afterRender",renderer:o,scene:c,camera:d,geometry:_,object:v})}copyProps(o,c=!1){if(!c&&!["MeshBasicMaterial",MeshBasicMaterial2.TYPE].includes(o.type))return console.error("Material type is not supported:",o.type),this;const d={};xe$1(o,d,Array.from(Object.keys(basicMaterialPropList)));const _=d.userData;delete d.userData;for(const v of Object.keys(d))d[v]===void 0&&delete d[v];return this.setValues(d),_&&copyMaterialUserData(this.userData,_),this.setDirty(),this}toJSON(o){var c,d;const _=this.userData;this.userData={};const v=super.toJSON(o);this.userData=_,v.userData={},copyMaterialUserData(v.userData,_),v.userData.uuid=this.userData.uuid;const b=o||{textures:Object.fromEntries(((c=v.textures)===null||c===void 0?void 0:c.map(tt=>[tt.uuid,tt]))||[]),images:Object.fromEntries(((d=v.images)===null||d===void 0?void 0:d.map(tt=>[tt.uuid,tt]))||[])};v.userData=serializeObject(v.userData,!1,b),o||(Object.keys(b.textures).length>0&&(v.textures=Object.values(b.textures)),Object.keys(b.images).length>0&&(v.images=Object.values(b.images))),v.type=MeshBasicMaterial2.TYPE;for(const tt of Object.keys(v))v[tt]===void 0&&delete v[tt];return v}fromJSON(o,c,d=!1){return this.copyProps(o,d)}clone(){return super.clone()}}MeshBasicMaterial2.TypeSlug="bmat",MeshBasicMaterial2.TYPE="MeshBasicMaterial2";const standardMaterialTemplate={materialType:MeshStandardMaterial2.TYPE,name:"standard",color:"#ffffff"},basicMaterialTemplate={materialType:MeshBasicMaterial2.TYPE,name:"basic",color:"#ffffff"},typeTemplateNameMap={[MeshStandardMaterial2.TYPE]:standardMaterialTemplate.name,MeshStandardMaterial:standardMaterialTemplate.name,MeshPhysicalMaterial:standardMaterialTemplate.name,[MeshBasicMaterial2.TYPE]:basicMaterialTemplate.name,MeshBasicMaterial:basicMaterialTemplate.name};class AMaterialManager extends I$2{constructor(){super(),this._templates=[standardMaterialTemplate,basicMaterialTemplate],this._materials=[],this._disposeMaterial=o=>{const c=o.target;if(!c||c.assetType!=="material")return;this._refreshTextureRefs();const d=this._getMapsForMaterial(c),_=[];d.forEach(v=>{const b=v.userData.__appliedMaterials;b==null||b.delete(c),b&&v.userData.disposeOnIdle!==!1&&b.size===0&&_.push(v)}),_.forEach(v=>{v.dispose()})},this._materialExtensions=[],this.processModel=this.processModel.bind(this),this.processMaterial=this.processMaterial.bind(this)}findOrCreate(o,c){let d=this.findMaterial(o);return d||(d=this.generateFromTemplate(o,c)),d}generateFromTemplate(o,c){const d=this.findTemplate(o);if(d)return this._generateFromTemplate(d,c??{})}generateFromTemplateType(o,c){const d=this._templates.find(_=>_.materialType===o);if(d)return this._generateFromTemplate(d,c??{})}findTemplate(o){return this._templates.find(c=>c.name===o)}_refreshTextureRefs(o){(o||this.getAllMaterials()).forEach(c=>{this._getMapsForMaterial(c).forEach(d=>{let _=d.userData.__appliedMaterials;_||(d.userData.__appliedMaterials=_=new Set),d.addEventListener("update",()=>c.dispatchEvent({type:"textureUpdate",texture:d})),_.add(c)})})}_getMapsForMaterial(o){var c;const d=new Set;for(const _ of Object.values(o))_&&_.isTexture&&d.add(_);for(const _ of Object.values((c=o.userData)!==null&&c!==void 0?c:{}))_&&_.isTexture&&d.add(_);return d}registerMaterial(o){if(this._materials.includes(o))return;const c=this.findMaterial(o.uuid);c?console.warn("WebGi MaterialManager: Material UUID already exists",o,c):(o.addEventListener("dispose",this._disposeMaterial),this._materials.push(o),this._refreshTextureRefs([o]))}registerMaterialObject(o){const c=o.materialObject?o:Object.assign(o,{assetType:"material",materialObject:o});return this.registerMaterial(c),c}unregisterMaterial(o){this._materials=this._materials.filter(c=>c.uuid!==o.uuid),o.removeEventListener("dispose",this._disposeMaterial)}registerMaterialTemplate(o){o.templateUUID||(o.templateUUID=esm_browser_v4());const c=this._templates.find(d=>d.templateUUID===o.templateUUID);c?console.warn("WebGi Material Manager: MaterialTemplate already exists",o,c):this._templates.push(o)}unregisterMaterialTemplate(o){this._templates=this._templates.filter(c=>c.templateUUID!==o.templateUUID)}dispose(o=!0){const c=this._materials;this._materials=[];for(const d of c)o||!d.userData.runtimeMaterial?d.dispose():this._materials.push(d)}findMaterial(o){return o?this._materials.find(c=>c.uuid===o):void 0}findMaterialsByName(o,c=!1){return this._materials.filter(d=>typeof o!="string"||c?d.name.match(typeof o=="string"?"^"+o+"$":o)!==null:d.name===o)}getMaterialsOfType(o){return o?this._materials.filter(c=>c.typeSlug===o):[]}getAllMaterials(){return[...this._materials]}processModel(o,c){return S$2(o,"modelObject",this._processModel(o,c)),o}_processMaterial(o,c){var d,_;if(!o)return;if(!((d=o.materialObject)===null||d===void 0)&&d.isMaterial)return o;let v=o.mmMaterial;if(!v){const b=((_=o.userData)===null||_===void 0?void 0:_.uuid)||o.uuid;if(v=this.findMaterial(b),v)v.copyProps(o);else{const tt=c.useSourceMaterial===!1||!o.isMaterial,it=c.materialTemplate||(tt?"standard":typeTemplateNameMap[o.type]||"standard");v=this.generateFromTemplate(it,tt?{}:o)}o.mmMaterial=v}return v}processMaterial(o,c){return o.materialObject||(o=this._processMaterial(o,{...c,register:!1})),c.register!==!1&&this.registerMaterial(o),o}registerMaterialExtension(o){this._materialExtensions.includes(o)||this._materialExtensions.push(o)}unregisterMaterialExtension(o){const c=this._materialExtensions.indexOf(o);c>=0&&this._materialExtensions.splice(c,1)}exportMaterial(o,c,d=!0,_=!1){const v=serializeObject(o,!1),b=JSON.stringify(v,null,d?0:2),tt=(c||o.name||"physical_material")+"."+o.typeSlug,it=new File([b],tt,{type:"application/json"});return _&&me$1(it),it}applyMaterial(o,c,d=!0){let _=this.findMaterialsByName(c,d);(!_||_.length<1)&&(_=[this.findMaterial(c)]);let v=!1;for(const b of _)b&&(b.userData.__isVariation||b!==o&&this.copyMaterialProps(b,o)&&(v=!0));return v}copyMaterialProps(o,c){var d;let _=!1;const v=Object.getPrototypeOf(c).constructor.TYPE;if(Object.getPrototypeOf(o).constructor.TYPE===v){const b=o.name;o.copyProps(c),o.name=b,_=!0}else{const b=o["__"+v]||this.generateFromTemplateType(v);if(b){const tt=o.name;b.copyProps(c),b.name=tt;const it=o.userData.__appliedMeshes;for(const nt of[...it??[]])(d=nt==null?void 0:nt.setMaterial)===null||d===void 0||d.call(nt,b),nt&&(_=!0);o["__"+v]=b}}return _}}class MaterialManager extends AMaterialManager{_generateFromTemplate(o,c){var d,_,v,b,tt,it;let nt;const lt={...o};lt.customMaterialExtensions=[...(d=lt.customMaterialExtensions)!==null&&d!==void 0?d:[],...this._materialExtensions];const ut=(c==null?void 0:c.metadata)&&(c==null?void 0:c.metadata.version)<=4.5;ut&&(three_module.ppV.enabled=!1);let ht={};switch(o.materialType){case"MeshStandardMaterial2":case"standard":c&&xe$1(c,lt,Array.from(Object.keys(physicalMaterialPropList))),(c==null?void 0:c.type)==="MeshBasicMaterial"&&(lt.roughness=.5,lt.metalness=.1,!((_=lt.userData)===null||_===void 0)&&_.uuid&&delete lt.userData.uuid),ht=(v=lt.userData)===null||v===void 0?void 0:v.uuid,ht&&delete lt.userData.uuid,nt=new MeshStandardMaterial2({customMaterialExtensions:lt.customMaterialExtensions}).fromJSON(lt,void 0,!0),ht&&(nt.uuid=ht),nt.userData.uuid=nt.uuid,nt.setDirty(),c!=null&&c.isMaterial&&c.userData!==void 0&&(c.userData.iMaterial=nt);break;case"MeshBasicMaterial2":case"basic":case"unlit":c&&xe$1(c,lt,Array.from(Object.keys(basicMaterialPropList))),ht=(b=lt.userData)===null||b===void 0?void 0:b.uuid,ht&&delete lt.userData.uuid,nt=new MeshBasicMaterial2({customMaterialExtensions:lt.customMaterialExtensions}).fromJSON(lt,void 0,!0),ht&&(nt.uuid=ht,lt.userData.uuid=ht),nt.userData.uuid=nt.uuid,nt.setDirty();break;case"shadow":throw"TODO: Not implemented shadow material";default:ht=null,c&&c.userData&&(ht=c.userData,delete c.userData),nt=((tt=o.generator)===null||tt===void 0?void 0:tt.call(o,lt,c))||void 0,c&&ht&&(c.userData=ht),ht&&nt&&(copyMaterialUserData(nt.userData,ht),ht!=null&&ht.uuid&&(nt.uuid=ht.uuid),ht=null),nt&&(nt.userData.uuid=nt.uuid)}if(nt){c.runtimeMaterial&&(nt.userData.runtimeMaterial=!0);const _t=nt;if(nt.clone=()=>{_t.userData.cloneId||(_t.userData.cloneId="0"),_t.userData.cloneCount||(_t.userData.cloneCount=0),_t.userData.cloneCount+=1;const ft=this.generateFromTemplate(o.name);return ft&&(ft.copyProps(_t),ft.userData.cloneId=ft.userData.cloneId+"_"+_t.userData.cloneCount,ft.userData.cloneCount=0,ft.name=ft.name+"_"+ft.userData.cloneId,ft.userData.uuid=ft.uuid),ft==null?void 0:ft.materialObject},c){let ft=this.findMaterial(c==null?void 0:c.uuid);ft&&this.unregisterMaterial(ft),ft=this.findMaterial((it=c==null?void 0:c.materialObject)===null||it===void 0?void 0:it.uuid),ft&&this.unregisterMaterial(ft)}}return ut&&(three_module.ppV.enabled=!0),nt?this.registerMaterialObject(nt):void 0}_processModel(o,c){if(!o.modelObject)return console.error("MaterialManager: No modelObject found for ",o),o;let d=o.material;if(!d&&o.geometry&&(this._defaultMaterial||(this._defaultMaterial=this.generateFromTemplate("standard")),d=this._defaultMaterial,o.material=d),d){let _=!0;Array.isArray(d)||(d=[d],_=!1);const v=[];for(const b of d){const tt=this._processMaterial(b,c);v.push(tt==null?void 0:tt.materialObject)}o.setMaterial&&(o.modelObject.material=null,o.setMaterial(_?v:v[0]))}if(c.recursive!==!1)for(let _=0;_<o.modelObject.children.length;_++)o.modelObject.children[_]=this._processModel(o.modelObject.children[_],c);return o}}class Importer{ctor(o){const c=this.cls&&new this.cls(o.loadingManager);return typeof this.onCtor=="function"?this.onCtor(c,o):c}constructor(o,c,d,_){this.cls=o,this.ext=c,this.root=d,this.onCtor=_}}class Object3DModel{get visible(){return this._modelObject.visible}set visible(o){this._modelObject.visible=o}get uuid(){return this._modelObject.uuid}get modelObject(){return this._modelObject}get name(){return this._modelObject.name}set name(o){this._modelObject.name=o}constructor(o,{pseudoCenter:c=!1,autoCenter:d=!1,autoScale:_=!1,autoScaleRadius:v=2,license:b=""}={}){if(this.assetType="model",this._modelObject=setupIModel(new three_module.B69),this.setDirty=this.setDirty.bind(this),this.updateBounds=this.updateBounds.bind(this),o||(o=this._modelObject),!c||o.userData.pseudoCentered||o.userData.isCentered)!d||o.userData.autoCentered||o.userData.isCentered||o.userData.pseudoCentered?c||d||(o.userData.isCentered=!0):autoCenterObject3D(o),this._modelObject=o;else{d&&console.error("cannot use pseudoCenter and autoCenter at the same time");const tt=new Box3B().expandByObject(o,!0,!0).getCenter(new three_module.Pq0);this._modelObject.position.copy(tt).negate(),this._modelObject.updateMatrix(),this._modelObject.add(o),this._modelObject.name=o.name+"-centered",this._modelObject.userData.pseudoCentered=!0,this._modelObject.userData.isCentered=!0,o.userData.iModel=this}_&&!this._modelObject.userData.autoScaled?autoScaleObject3D(this._modelObject,o.userData.autoScaleRadius||v):this._modelObject.userData.autoScaled=!0,this._modelObject.addEventListener("dispose",()=>{this.__disposed=!0}),this._modelObject.userData.iModel=this,this.license=b}get license(){return this._modelObject.userData.license}set license(o){this._modelObject.userData.license=o}addEventListener(o,c){this._modelObject.addEventListener(o,c)}dispatchEvent(o){this._modelObject.dispatchEvent(o)}hasEventListener(o,c){return this._modelObject.hasEventListener(o,c)}removeEventListener(o,c){this._modelObject.removeEventListener(o,c)}traverse(o){this._modelObject.traverse(o)}dispose(){const o=this._modelObject.dispose;o&&typeof o=="function"?o():(console.warn("WebGi Object3DModel: no dispose in modelObject"),this._modelObject.removeFromParent())}setDirty(o){var c,d,_,v;(d=(c=this._modelObject)===null||c===void 0?void 0:c.setDirty)===null||d===void 0||d.call(c,o),(v=(_=this._uiConfig)===null||_===void 0?void 0:_.uiRefresh)===null||v===void 0||v.call(_,"postFrame",!0)}setMaterial(o){var c,d;return this._modelObject.isMesh?((d=(c=this._modelObject).setMaterial)===null||d===void 0?void 0:d.call(c,o))||[]:(console.error("setMaterial only works on meshes"),[])}get material(){return this._modelObject.material}get geometry(){return this._modelObject.geometry}setGeometry(o,c=!1){var d,_;if(this._modelObject.isMesh)return(_=(d=this._modelObject).setGeometry)===null||_===void 0?void 0:_.call(d,o,c);console.error("setGeometry only works on meshes")}get userData(){return this._modelObject.userData}set userData(o){this._modelObject.userData=o}updateBounds(){console.warn("WebGi Object3DModel: updateBounds: NOT IMPLEMENTED, don't use"),this.setDirty()}get uiConfig(){return this._uiConfig||(this._uiConfig=makeObject3DUiConfig(this._modelObject,!1)),this._uiConfig}clone(){return new Object3DModel(this._modelObject.clone(),{pseudoCenter:!1,autoScale:!1,autoCenter:!1,license:this.license})}}function setupObject3dModel(h,o){return[h.modelObject,...h.modelObject.children].forEach(c=>{setupIModel(c,c!==h.modelObject?h:void 0,o)}),h}class ObjectProcessorMap{constructor(){this._processors=new Map}add(o,c){var d;this._processors.has(o)||this._processors.set(o,[]),(d=this._processors.get(o))===null||d===void 0||d.push(c)}remove(o,c){const d=this._processors.get(o),_=(d==null?void 0:d.indexOf(c))||(d==null?void 0:d.findIndex(v=>v.process&&v.process===c.process||v.processAsync&&v.processAsync===c.processAsync));!d||!_||_<0||d.splice(_,1)}get(o){var c;return(c=this._processors.get(o))!==null&&c!==void 0?c:[]}async process(o,c,d){var _,v,b,tt;const it=this.get(o),nt=c.assetType;for(const lt of it)lt.forAssetType===nt&&(c=(v=(_=lt.process)===null||_===void 0?void 0:_.call(lt,c,d))!==null&&v!==void 0?v:c,c=(tt=await((b=lt.processAsync)===null||b===void 0?void 0:b.call(lt,c,d)))!==null&&tt!==void 0?tt:c);return c}dispose(){this._processors.clear()}}class SimpleJSONLoader extends three_module.Y9S{load(o,c,d,_){return super.load(o,v=>{try{if(typeof v!="string")throw new Error("Invalid JSON");c==null||c(JSON.parse(v))}catch(b){_==null||_(b)}},d,_)}}class RGBELoader extends three_module.BRH{constructor(o){super(o),this.type=three_module.ix0}parse(o){const c=function(ft,bt){switch(ft){case 1:throw new Error("THREE.RGBELoader: Read Error: "+(bt||""));case 2:throw new Error("THREE.RGBELoader: Write Error: "+(bt||""));case 3:throw new Error("THREE.RGBELoader: Bad File Format: "+(bt||""));default:throw new Error("THREE.RGBELoader: Memory Error: "+(bt||""))}},d=function(ft,bt,xt){bt=bt||1024;let St=ft.pos,wt=-1,Pt=0,Rt="",kt=String.fromCharCode.apply(null,new Uint16Array(ft.subarray(St,St+128)));for(;0>(wt=kt.indexOf(`
`))&&Pt<bt&&St<ft.byteLength;)Rt+=kt,Pt+=kt.length,St+=128,kt+=String.fromCharCode.apply(null,new Uint16Array(ft.subarray(St,St+128)));return-1<wt&&(ft.pos+=Pt+wt+1,Rt+kt.slice(0,wt))},_=function(ft,bt,xt,St){const wt=ft[bt+3],Pt=Math.pow(2,wt-128)/255;xt[St+0]=ft[bt+0]*Pt,xt[St+1]=ft[bt+1]*Pt,xt[St+2]=ft[bt+2]*Pt,xt[St+3]=1},v=function(ft,bt,xt,St){const wt=ft[bt+3],Pt=Math.pow(2,wt-128)/255;xt[St+0]=three_module.GxU.toHalfFloat(Math.min(ft[bt+0]*Pt,65504)),xt[St+1]=three_module.GxU.toHalfFloat(Math.min(ft[bt+1]*Pt,65504)),xt[St+2]=three_module.GxU.toHalfFloat(Math.min(ft[bt+2]*Pt,65504)),xt[St+3]=three_module.GxU.toHalfFloat(1)},b=new Uint8Array(o);b.pos=0;const tt=function(ft){const bt=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,xt=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,St=/^\s*FORMAT=(\S+)\s*$/,wt=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,Pt={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let Rt,kt;for((ft.pos>=ft.byteLength||!(Rt=d(ft)))&&c(1,"no header found"),(kt=Rt.match(/^#\?(\S+)/))||c(3,"bad initial token"),Pt.valid|=1,Pt.programtype=kt[1],Pt.string+=Rt+`
`;Rt=d(ft),Rt!==!1;)if(Pt.string+=Rt+`
`,Rt.charAt(0)!=="#"){if((kt=Rt.match(bt))&&(Pt.gamma=parseFloat(kt[1])),(kt=Rt.match(xt))&&(Pt.exposure=parseFloat(kt[1])),(kt=Rt.match(St))&&(Pt.valid|=2,Pt.format=kt[1]),(kt=Rt.match(wt))&&(Pt.valid|=4,Pt.height=parseInt(kt[1],10),Pt.width=parseInt(kt[2],10)),2&Pt.valid&&4&Pt.valid)break}else Pt.comments+=Rt+`
`;return 2&Pt.valid||c(3,"missing format specifier"),4&Pt.valid||c(3,"missing image size specifier"),Pt}(b),it=tt.width,nt=tt.height,lt=function(ft,bt,xt){const St=bt;if(St<8||St>32767||ft[0]!==2||ft[1]!==2||128&ft[2])return new Uint8Array(ft);St!==(ft[2]<<8|ft[3])&&c(3,"wrong scanline width");const wt=new Uint8Array(4*bt*xt);wt.length||c(4,"unable to allocate buffer space");let Pt=0,Rt=0;const kt=4*St,Gt=new Uint8Array(4),Dt=new Uint8Array(kt);let It=xt;for(;It>0&&Rt<ft.byteLength;){Rt+4>ft.byteLength&&c(1),Gt[0]=ft[Rt++],Gt[1]=ft[Rt++],Gt[2]=ft[Rt++],Gt[3]=ft[Rt++],Gt[0]==2&&Gt[1]==2&&(Gt[2]<<8|Gt[3])==St||c(3,"bad rgbe scanline format");let Nt,Vt=0;for(;Vt<kt&&Rt<ft.byteLength;){Nt=ft[Rt++];const Yt=Nt>128;if(Yt&&(Nt-=128),(Nt===0||Vt+Nt>kt)&&c(3,"bad scanline data"),Yt){const nr=ft[Rt++];for(let rr=0;rr<Nt;rr++)Dt[Vt++]=nr}else Dt.set(ft.subarray(Rt,Rt+Nt),Vt),Vt+=Nt,Rt+=Nt}const Kt=St;for(let Yt=0;Yt<Kt;Yt++){let nr=0;wt[Pt]=Dt[Yt+nr],nr+=St,wt[Pt+1]=Dt[Yt+nr],nr+=St,wt[Pt+2]=Dt[Yt+nr],nr+=St,wt[Pt+3]=Dt[Yt+nr],Pt+=4}It--}return wt}(b.subarray(b.pos),it,nt);let ut,ht,_t;switch(this.type){case three_module.RQf:_t=lt.length/4;const ft=new Float32Array(4*_t);for(let xt=0;xt<_t;xt++)_(lt,4*xt,ft,4*xt);ut=ft,ht=three_module.RQf;break;case three_module.ix0:_t=lt.length/4;const bt=new Uint16Array(4*_t);for(let xt=0;xt<_t;xt++)v(lt,4*xt,bt,4*xt);ut=bt,ht=three_module.ix0;break;default:throw new Error("THREE.RGBELoader: Unsupported type: "+this.type)}return{width:it,height:nt,data:ut,header:tt.string,gamma:tt.gamma,exposure:tt.exposure,type:ht}}setDataType(o){return this.type=o,this}load(o,c,d,_){return super.load(o,function(v,b){switch(v.type){case three_module.RQf:case three_module.ix0:v.colorSpace=three_module.Zr2,v.minFilter=three_module.k6q,v.magFilter=three_module.k6q,v.generateMipmaps=!1,v.flipY=!0}c&&c(v,b)},d,_)}}function addRGBELoader(h){return new Importer(class extends RGBELoader{constructor(o){super(o),this.setDataType(getTextureDataType(h.renderer.rendererObject))}},["hdr"],!1)}class GLTFLoader extends three_module.aHM{constructor(o){super(o),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(c){return new GLTFMaterialsClearcoatExtension(c)}),this.register(function(c){return new GLTFTextureBasisUExtension(c)}),this.register(function(c){return new GLTFTextureWebPExtension(c)}),this.register(function(c){return new GLTFTextureAVIFExtension(c)}),this.register(function(c){return new GLTFMaterialsSheenExtension(c)}),this.register(function(c){return new GLTFMaterialsTransmissionExtension(c)}),this.register(function(c){return new GLTFMaterialsVolumeExtension(c)}),this.register(function(c){return new GLTFMaterialsIorExtension(c)}),this.register(function(c){return new GLTFMaterialsEmissiveStrengthExtension(c)}),this.register(function(c){return new GLTFMaterialsSpecularExtension(c)}),this.register(function(c){return new GLTFMaterialsIridescenceExtension(c)}),this.register(function(c){return new GLTFMaterialsAnisotropyExtension(c)}),this.register(function(c){return new GLTFLightsExtension(c)}),this.register(function(c){return new GLTFMeshoptCompression(c)}),this.register(function(c){return new GLTFMeshGpuInstancing(c)})}load(o,c,d,_){const v=this;let b;b=this.resourcePath!==""?this.resourcePath:this.path!==""?this.path:three_module.r6x.extractUrlBase(o),this.manager.itemStart(o);const tt=function(nt){_?_(nt):console.error(nt),v.manager.itemError(o),v.manager.itemEnd(o)},it=new three_module.Y9S(this.manager);it.setPath(this.path),it.setResponseType("arraybuffer"),it.setRequestHeader(this.requestHeader),it.setWithCredentials(this.withCredentials),it.load(o,function(nt){try{v.parse(nt,b,function(lt){c(lt),v.manager.itemEnd(o)},tt,o)}catch(lt){tt(lt)}},d,tt)}setDRACOLoader(o){return this.dracoLoader=o,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(o){return this.ktx2Loader=o,this}setMeshoptDecoder(o){return this.meshoptDecoder=o,this}register(o){return this.pluginCallbacks.indexOf(o)===-1&&this.pluginCallbacks.push(o),this}unregister(o){return this.pluginCallbacks.indexOf(o)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(o),1),this}parse(o,c,d,_,v){let b;const tt={},it={},nt=new TextDecoder;if(typeof o=="string")b=JSON.parse(o);else if(o instanceof ArrayBuffer)if(nt.decode(new Uint8Array(o,0,4))===BINARY_EXTENSION_HEADER_MAGIC){try{tt[EXTENSIONS.KHR_BINARY_GLTF]=new GLTFBinaryExtension(o)}catch(ut){return void(_&&_(ut))}b=JSON.parse(tt[EXTENSIONS.KHR_BINARY_GLTF].content)}else b=JSON.parse(nt.decode(o));else b=o;if(b.asset===void 0||b.asset.version[0]<2)return void(_&&_(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported.")));const lt=new GLTFParser(b,{path:c||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});lt.fileLoader.setRequestHeader(this.requestHeader);for(let ut=0;ut<this.pluginCallbacks.length;ut++){const ht=this.pluginCallbacks[ut](lt);it[ht.name]=ht,tt[ht.name]=!0}if(b.extensionsUsed)for(let ut=0;ut<b.extensionsUsed.length;++ut){const ht=b.extensionsUsed[ut],_t=b.extensionsRequired||[];switch(ht){case EXTENSIONS.KHR_MATERIALS_UNLIT:tt[ht]=new GLTFMaterialsUnlitExtension;break;case EXTENSIONS.KHR_DRACO_MESH_COMPRESSION:tt[ht]=new GLTFDracoMeshCompressionExtension(b,this.dracoLoader);break;case EXTENSIONS.KHR_TEXTURE_TRANSFORM:tt[ht]=new GLTFTextureTransformExtension;break;case EXTENSIONS.KHR_MESH_QUANTIZATION:tt[ht]=new GLTFMeshQuantizationExtension;break;default:_t.indexOf(ht)>=0&&it[ht]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+ht+'".')}}lt.setExtensions(tt),lt.setPlugins(it),lt.parse(d,_)}parseAsync(o,c){const d=this;return new Promise(function(_,v){d.parse(o,c,_,v)})}}function GLTFRegistry(){let h={};return{get:function(o){return h[o]},add:function(o,c){h[o]=c},remove:function(o){delete h[o]},removeAll:function(){h={}}}}GLTFLoader.ObjectConstructors={DirectionalLight:three_module.ZyN,PointLight:three_module.HiM,SpotLight:three_module.nCl,MeshStandardMaterial:three_module._4j,MeshBasicMaterial:three_module.V9B,MeshPhysicalMaterial:three_module.uSd,LineBasicMaterial:three_module.mrM,PointsMaterial:three_module.BH$,PerspectiveCamera:three_module.ubm,OrthographicCamera:three_module.qUd};const EXTENSIONS={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class GLTFLightsExtension{constructor(o){this.parser=o,this.name=EXTENSIONS.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const o=this.parser,c=this.parser.json.nodes||[];for(let d=0,_=c.length;d<_;d++){const v=c[d];v.extensions&&v.extensions[this.name]&&v.extensions[this.name].light!==void 0&&o._addNodeRef(this.cache,v.extensions[this.name].light)}}_loadLight(o){const c=this.parser,d="light:"+o;let _=c.cache.get(d);if(_)return _;const v=c.json,b=((v.extensions&&v.extensions[this.name]||{}).lights||[])[o];let tt;const it=new three_module.Q1f(16777215);b.color!==void 0&&it.setRGB(b.color[0],b.color[1],b.color[2],three_module.Zr2);const nt=b.range!==void 0?b.range:0;switch(b.type){case"directional":tt=new GLTFLoader.ObjectConstructors.DirectionalLight(it),tt.target.position.set(0,0,-1),tt.add(tt.target);break;case"point":tt=new GLTFLoader.ObjectConstructors.PointLight(it),tt.distance=nt;break;case"spot":tt=new GLTFLoader.ObjectConstructors.SpotLight(it),tt.distance=nt,b.spot=b.spot||{},b.spot.innerConeAngle=b.spot.innerConeAngle!==void 0?b.spot.innerConeAngle:0,b.spot.outerConeAngle=b.spot.outerConeAngle!==void 0?b.spot.outerConeAngle:Math.PI/4,tt.angle=b.spot.outerConeAngle,tt.penumbra=1-b.spot.innerConeAngle/b.spot.outerConeAngle,tt.target.position.set(0,0,-1),tt.add(tt.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+b.type)}return tt.position.set(0,0,0),tt.decay=2,assignExtrasToUserData(tt,b),b.intensity!==void 0&&(tt.intensity=b.intensity),tt.name=c.createUniqueName(b.name||"light_"+o),_=Promise.resolve(tt),c.cache.add(d,_),_}getDependency(o,c){if(o==="light")return this._loadLight(c)}createNodeAttachment(o){const c=this,d=this.parser,_=d.json.nodes[o],v=(_.extensions&&_.extensions[this.name]||{}).light;return v===void 0?null:this._loadLight(v).then(function(b){return d._getNodeRef(c.cache,v,b)})}}class GLTFMaterialsUnlitExtension{constructor(){this.name=EXTENSIONS.KHR_MATERIALS_UNLIT}getMaterialType(){return GLTFLoader.ObjectConstructors.MeshBasicMaterial}extendParams(o,c,d){const _=[];o.color=new three_module.Q1f(1,1,1),o.opacity=1;const v=c.pbrMetallicRoughness;if(v){if(Array.isArray(v.baseColorFactor)){const b=v.baseColorFactor;o.color.setRGB(b[0],b[1],b[2],three_module.Zr2),o.opacity=b[3]}v.baseColorTexture!==void 0&&_.push(d.assignTexture(o,"map",v.baseColorTexture,three_module.er$))}return Promise.all(_)}}class GLTFMaterialsEmissiveStrengthExtension{constructor(o){this.parser=o,this.name=EXTENSIONS.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(o,c){const d=this.parser.json.materials[o];if(!d.extensions||!d.extensions[this.name])return Promise.resolve();const _=d.extensions[this.name].emissiveStrength;return _!==void 0&&(c.emissiveIntensity=_),Promise.resolve()}}class GLTFMaterialsClearcoatExtension{constructor(o){this.parser=o,this.name=EXTENSIONS.KHR_MATERIALS_CLEARCOAT}getMaterialType(o){const c=this.parser.json.materials[o];return c.extensions&&c.extensions[this.name]?GLTFLoader.ObjectConstructors.MeshPhysicalMaterial:null}extendMaterialParams(o,c){const d=this.parser,_=d.json.materials[o];if(!_.extensions||!_.extensions[this.name])return Promise.resolve();const v=[],b=_.extensions[this.name];if(b.clearcoatFactor!==void 0&&(c.clearcoat=b.clearcoatFactor),b.clearcoatTexture!==void 0&&v.push(d.assignTexture(c,"clearcoatMap",b.clearcoatTexture)),b.clearcoatRoughnessFactor!==void 0&&(c.clearcoatRoughness=b.clearcoatRoughnessFactor),b.clearcoatRoughnessTexture!==void 0&&v.push(d.assignTexture(c,"clearcoatRoughnessMap",b.clearcoatRoughnessTexture)),b.clearcoatNormalTexture!==void 0&&(v.push(d.assignTexture(c,"clearcoatNormalMap",b.clearcoatNormalTexture)),b.clearcoatNormalTexture.scale!==void 0)){const tt=b.clearcoatNormalTexture.scale;c.clearcoatNormalScale=new three_module.I9Y(tt,tt)}return Promise.all(v)}}class GLTFMaterialsIridescenceExtension{constructor(o){this.parser=o,this.name=EXTENSIONS.KHR_MATERIALS_IRIDESCENCE}getMaterialType(o){const c=this.parser.json.materials[o];return c.extensions&&c.extensions[this.name]?GLTFLoader.ObjectConstructors.MeshPhysicalMaterial:null}extendMaterialParams(o,c){const d=this.parser,_=d.json.materials[o];if(!_.extensions||!_.extensions[this.name])return Promise.resolve();const v=[],b=_.extensions[this.name];return b.iridescenceFactor!==void 0&&(c.iridescence=b.iridescenceFactor),b.iridescenceTexture!==void 0&&v.push(d.assignTexture(c,"iridescenceMap",b.iridescenceTexture)),b.iridescenceIor!==void 0&&(c.iridescenceIOR=b.iridescenceIor),c.iridescenceThicknessRange===void 0&&(c.iridescenceThicknessRange=[100,400]),b.iridescenceThicknessMinimum!==void 0&&(c.iridescenceThicknessRange[0]=b.iridescenceThicknessMinimum),b.iridescenceThicknessMaximum!==void 0&&(c.iridescenceThicknessRange[1]=b.iridescenceThicknessMaximum),b.iridescenceThicknessTexture!==void 0&&v.push(d.assignTexture(c,"iridescenceThicknessMap",b.iridescenceThicknessTexture)),Promise.all(v)}}class GLTFMaterialsSheenExtension{constructor(o){this.parser=o,this.name=EXTENSIONS.KHR_MATERIALS_SHEEN}getMaterialType(o){const c=this.parser.json.materials[o];return c.extensions&&c.extensions[this.name]?GLTFLoader.ObjectConstructors.MeshPhysicalMaterial:null}extendMaterialParams(o,c){const d=this.parser,_=d.json.materials[o];if(!_.extensions||!_.extensions[this.name])return Promise.resolve();const v=[];c.sheenColor=new three_module.Q1f(0,0,0),c.sheenRoughness=0,c.sheen=1;const b=_.extensions[this.name];if(b.sheenColorFactor!==void 0){const tt=b.sheenColorFactor;c.sheenColor.setRGB(tt[0],tt[1],tt[2],three_module.Zr2)}return b.sheenRoughnessFactor!==void 0&&(c.sheenRoughness=b.sheenRoughnessFactor),b.sheenColorTexture!==void 0&&v.push(d.assignTexture(c,"sheenColorMap",b.sheenColorTexture,three_module.er$)),b.sheenRoughnessTexture!==void 0&&v.push(d.assignTexture(c,"sheenRoughnessMap",b.sheenRoughnessTexture)),_.extras&&_.extras.sheenFactor!==void 0&&(c.sheen=_.extras.sheenFactor,delete _.extras.sheenFactor),Promise.all(v)}}class GLTFMaterialsTransmissionExtension{constructor(o){this.parser=o,this.name=EXTENSIONS.KHR_MATERIALS_TRANSMISSION}getMaterialType(o){const c=this.parser.json.materials[o];return c.extensions&&c.extensions[this.name]?GLTFLoader.ObjectConstructors.MeshPhysicalMaterial:null}extendMaterialParams(o,c){const d=this.parser,_=d.json.materials[o];if(!_.extensions||!_.extensions[this.name])return Promise.resolve();const v=[],b=_.extensions[this.name];return b.transmissionFactor!==void 0&&(c.transmission=b.transmissionFactor),b.transmissionTexture!==void 0&&v.push(d.assignTexture(c,"transmissionMap",b.transmissionTexture)),Promise.all(v)}}class GLTFMaterialsVolumeExtension{constructor(o){this.parser=o,this.name=EXTENSIONS.KHR_MATERIALS_VOLUME}getMaterialType(o){const c=this.parser.json.materials[o];return c.extensions&&c.extensions[this.name]?GLTFLoader.ObjectConstructors.MeshPhysicalMaterial:null}extendMaterialParams(o,c){const d=this.parser,_=d.json.materials[o];if(!_.extensions||!_.extensions[this.name])return Promise.resolve();const v=[],b=_.extensions[this.name];c.thickness=b.thicknessFactor!==void 0?b.thicknessFactor:0,b.thicknessTexture!==void 0&&v.push(d.assignTexture(c,"thicknessMap",b.thicknessTexture)),c.attenuationDistance=b.attenuationDistance||1/0;const tt=b.attenuationColor||[1,1,1];return c.attenuationColor=new three_module.Q1f().setRGB(tt[0],tt[1],tt[2],three_module.Zr2),Promise.all(v)}}class GLTFMaterialsIorExtension{constructor(o){this.parser=o,this.name=EXTENSIONS.KHR_MATERIALS_IOR}getMaterialType(o){const c=this.parser.json.materials[o];return c.extensions&&c.extensions[this.name]?GLTFLoader.ObjectConstructors.MeshPhysicalMaterial:null}extendMaterialParams(o,c){const d=this.parser.json.materials[o];if(!d.extensions||!d.extensions[this.name])return Promise.resolve();const _=d.extensions[this.name];return c.ior=_.ior!==void 0?_.ior:1.5,Promise.resolve()}}class GLTFMaterialsSpecularExtension{constructor(o){this.parser=o,this.name=EXTENSIONS.KHR_MATERIALS_SPECULAR}getMaterialType(o){const c=this.parser.json.materials[o];return c.extensions&&c.extensions[this.name]?GLTFLoader.ObjectConstructors.MeshPhysicalMaterial:null}extendMaterialParams(o,c){const d=this.parser,_=d.json.materials[o];if(!_.extensions||!_.extensions[this.name])return Promise.resolve();const v=[],b=_.extensions[this.name];c.specularIntensity=b.specularFactor!==void 0?b.specularFactor:1,b.specularTexture!==void 0&&v.push(d.assignTexture(c,"specularIntensityMap",b.specularTexture));const tt=b.specularColorFactor||[1,1,1];return c.specularColor=new three_module.Q1f().setRGB(tt[0],tt[1],tt[2],three_module.Zr2),b.specularColorTexture!==void 0&&v.push(d.assignTexture(c,"specularColorMap",b.specularColorTexture,three_module.er$)),Promise.all(v)}}class GLTFMaterialsAnisotropyExtension{constructor(o){this.parser=o,this.name=EXTENSIONS.KHR_MATERIALS_ANISOTROPY}getMaterialType(o){const c=this.parser.json.materials[o];return c.extensions&&c.extensions[this.name]?three_module.uSd:null}extendMaterialParams(o,c){const d=this.parser,_=d.json.materials[o];if(!_.extensions||!_.extensions[this.name])return Promise.resolve();const v=[],b=_.extensions[this.name];return b.anisotropyStrength!==void 0&&(c.anisotropy=b.anisotropyStrength),b.anisotropyRotation!==void 0&&(c.anisotropyRotation=b.anisotropyRotation),b.anisotropyTexture!==void 0&&v.push(d.assignTexture(c,"anisotropyMap",b.anisotropyTexture)),Promise.all(v)}}class GLTFTextureBasisUExtension{constructor(o){this.parser=o,this.name=EXTENSIONS.KHR_TEXTURE_BASISU}loadTexture(o){const c=this.parser,d=c.json,_=d.textures[o];if(!_.extensions||!_.extensions[this.name])return null;const v=_.extensions[this.name],b=c.options.ktx2Loader;if(!b){if(d.extensionsRequired&&d.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return c.loadTextureImage(o,v.source,b)}}class GLTFTextureWebPExtension{constructor(o){this.parser=o,this.name=EXTENSIONS.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(o){const c=this.name,d=this.parser,_=d.json,v=_.textures[o];if(!v.extensions||!v.extensions[c])return null;const b=v.extensions[c],tt=_.images[b.source];let it=d.textureLoader;if(tt.uri){const nt=d.options.manager.getHandler(tt.uri);nt!==null&&(it=nt)}return this.detectSupport().then(function(nt){if(nt)return d.loadTextureImage(o,b.source,it);if(_.extensionsRequired&&_.extensionsRequired.indexOf(c)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return d.loadTexture(o)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(o){const c=new Image;c.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",c.onload=c.onerror=function(){o(c.height===1)}})),this.isSupported}}class GLTFTextureAVIFExtension{constructor(o){this.parser=o,this.name=EXTENSIONS.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(o){const c=this.name,d=this.parser,_=d.json,v=_.textures[o];if(!v.extensions||!v.extensions[c])return null;const b=v.extensions[c],tt=_.images[b.source];let it=d.textureLoader;if(tt.uri){const nt=d.options.manager.getHandler(tt.uri);nt!==null&&(it=nt)}return this.detectSupport().then(function(nt){if(nt)return d.loadTextureImage(o,b.source,it);if(_.extensionsRequired&&_.extensionsRequired.indexOf(c)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return d.loadTexture(o)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(o){const c=new Image;c.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",c.onload=c.onerror=function(){o(c.height===1)}})),this.isSupported}}class GLTFMeshoptCompression{constructor(o){this.name=EXTENSIONS.EXT_MESHOPT_COMPRESSION,this.parser=o}loadBufferView(o){const c=this.parser.json,d=c.bufferViews[o];if(d.extensions&&d.extensions[this.name]){const _=d.extensions[this.name],v=this.parser.getDependency("buffer",_.buffer),b=this.parser.options.meshoptDecoder;if(!b||!b.supported){if(c.extensionsRequired&&c.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return v.then(function(tt){const it=_.byteOffset||0,nt=_.byteLength||0,lt=_.count,ut=_.byteStride,ht=new Uint8Array(tt,it,nt);return b.decodeGltfBufferAsync?b.decodeGltfBufferAsync(lt,ut,ht,_.mode,_.filter).then(function(_t){return _t.buffer}):b.ready.then(function(){const _t=new ArrayBuffer(lt*ut);return b.decodeGltfBuffer(new Uint8Array(_t),lt,ut,ht,_.mode,_.filter),_t})})}return null}}class GLTFMeshGpuInstancing{constructor(o){this.name=EXTENSIONS.EXT_MESH_GPU_INSTANCING,this.parser=o}createNodeMesh(o){const c=this.parser.json,d=c.nodes[o];if(!d.extensions||!d.extensions[this.name]||d.mesh===void 0)return null;const _=c.meshes[d.mesh];for(const it of _.primitives)if(it.mode!==WEBGL_CONSTANTS.TRIANGLES&&it.mode!==WEBGL_CONSTANTS.TRIANGLE_STRIP&&it.mode!==WEBGL_CONSTANTS.TRIANGLE_FAN&&it.mode!==void 0)return null;const v=d.extensions[this.name].attributes,b=[],tt={};for(const it in v)b.push(this.parser.getDependency("accessor",v[it]).then(nt=>(tt[it]=nt,tt[it])));return b.length<1?null:(b.push(this.parser.createNodeMesh(o)),Promise.all(b).then(it=>{const nt=it.pop(),lt=nt.isGroup?nt.children:[nt],ut=it[0].count,ht=[];for(const _t of lt){const ft=new three_module.kn4,bt=new three_module.Pq0,xt=new three_module.PTz,St=new three_module.Pq0(1,1,1),wt=new three_module.ZLX(_t.geometry,_t.material,ut);for(let Pt=0;Pt<ut;Pt++)tt.TRANSLATION&&bt.fromBufferAttribute(tt.TRANSLATION,Pt),tt.ROTATION&&xt.fromBufferAttribute(tt.ROTATION,Pt),tt.SCALE&&St.fromBufferAttribute(tt.SCALE,Pt),wt.setMatrixAt(Pt,ft.compose(bt,xt,St));wt.sourceTrs=tt;for(const Pt in tt)Pt!=="TRANSLATION"&&Pt!=="ROTATION"&&Pt!=="SCALE"&&_t.geometry.setAttribute(Pt,tt[Pt]);three_module.B69.prototype.copy.call(wt,_t),this.parser.assignFinalMaterial(wt),ht.push(wt)}return nt.isGroup?(nt.clear(),nt.add(...ht),nt):ht[0]}))}}const BINARY_EXTENSION_HEADER_MAGIC="glTF",BINARY_EXTENSION_HEADER_LENGTH=12,BINARY_EXTENSION_CHUNK_TYPES={JSON:1313821514,BIN:5130562};class GLTFBinaryExtension{constructor(o){this.name=EXTENSIONS.KHR_BINARY_GLTF,this.content=null,this.body=null;const c=new DataView(o,0,BINARY_EXTENSION_HEADER_LENGTH),d=new TextDecoder;if(this.header={magic:d.decode(new Uint8Array(o.slice(0,4))),version:c.getUint32(4,!0),length:c.getUint32(8,!0)},this.header.magic!==BINARY_EXTENSION_HEADER_MAGIC)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const _=this.header.length-BINARY_EXTENSION_HEADER_LENGTH,v=new DataView(o,BINARY_EXTENSION_HEADER_LENGTH);let b=0;for(;b<_;){const tt=v.getUint32(b,!0);b+=4;const it=v.getUint32(b,!0);if(b+=4,it===BINARY_EXTENSION_CHUNK_TYPES.JSON){const nt=new Uint8Array(o,BINARY_EXTENSION_HEADER_LENGTH+b,tt);this.content=d.decode(nt)}else if(it===BINARY_EXTENSION_CHUNK_TYPES.BIN){const nt=BINARY_EXTENSION_HEADER_LENGTH+b;this.body=o.slice(nt,nt+tt)}b+=tt}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class GLTFDracoMeshCompressionExtension{constructor(o,c){if(!c)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=EXTENSIONS.KHR_DRACO_MESH_COMPRESSION,this.json=o,this.dracoLoader=c,this.dracoLoader.preload()}decodePrimitive(o,c){const d=this.json,_=this.dracoLoader,v=o.extensions[this.name].bufferView,b=o.extensions[this.name].attributes,tt={},it={},nt={};for(const lt in b){const ut=ATTRIBUTES[lt]||lt.toLowerCase();tt[ut]=b[lt]}for(const lt in o.attributes){const ut=ATTRIBUTES[lt]||lt.toLowerCase();if(b[lt]!==void 0){const ht=d.accessors[o.attributes[lt]],_t=WEBGL_COMPONENT_TYPES[ht.componentType];nt[ut]=_t.name,it[ut]=ht.normalized===!0}}return c.getDependency("bufferView",v).then(function(lt){return new Promise(function(ut){_.decodeDracoFile(lt,function(ht){for(const _t in ht.attributes){const ft=ht.attributes[_t],bt=it[_t];bt!==void 0&&(ft.normalized=bt)}ut(ht)},tt,nt)})})}}class GLTFTextureTransformExtension{constructor(){this.name=EXTENSIONS.KHR_TEXTURE_TRANSFORM}extendTexture(o,c){return(c.texCoord!==void 0&&c.texCoord!==o.channel||c.offset!==void 0||c.rotation!==void 0||c.scale!==void 0)&&(o.__hasGLTFUuid||(o=o.clone()),c.texCoord!==void 0&&(o.channel=c.texCoord),c.offset!==void 0&&o.offset.fromArray(c.offset),c.rotation!==void 0&&(o.rotation=c.rotation),c.scale!==void 0&&o.repeat.fromArray(c.scale),o.needsUpdate=!0),o}}class GLTFMeshQuantizationExtension{constructor(){this.name=EXTENSIONS.KHR_MESH_QUANTIZATION}}class GLTFCubicSplineInterpolant extends three_module.lGw{constructor(o,c,d,_){super(o,c,d,_)}copySampleValue_(o){const c=this.resultBuffer,d=this.sampleValues,_=this.valueSize,v=o*_*3+_;for(let b=0;b!==_;b++)c[b]=d[v+b];return c}interpolate_(o,c,d,_){const v=this.resultBuffer,b=this.sampleValues,tt=this.valueSize,it=2*tt,nt=3*tt,lt=_-c,ut=(d-c)/lt,ht=ut*ut,_t=ht*ut,ft=o*nt,bt=ft-nt,xt=-2*_t+3*ht,St=_t-ht,wt=1-xt,Pt=St-ht+ut;for(let Rt=0;Rt!==tt;Rt++){const kt=b[bt+Rt+tt],Gt=b[bt+Rt+it]*lt,Dt=b[ft+Rt+tt],It=b[ft+Rt]*lt;v[Rt]=wt*kt+Pt*Gt+xt*Dt+St*It}return v}}const _q=new three_module.PTz;class GLTFCubicSplineQuaternionInterpolant extends GLTFCubicSplineInterpolant{interpolate_(o,c,d,_){const v=super.interpolate_(o,c,d,_);return _q.fromArray(v).normalize().toArray(v),v}}const WEBGL_CONSTANTS={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},WEBGL_COMPONENT_TYPES={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},WEBGL_FILTERS={9728:three_module.hxR,9729:three_module.k6q,9984:three_module.pHI,9985:three_module.kRr,9986:three_module.Cfg,9987:three_module.$_I},WEBGL_WRAPPINGS={33071:three_module.ghU,33648:three_module.kTW,10497:three_module.GJx},WEBGL_TYPE_SIZES={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},ATTRIBUTES={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},PATH_PROPERTIES={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},INTERPOLATION={CUBICSPLINE:void 0,LINEAR:three_module.PJ3,STEP:three_module.ljd},ALPHA_MODES={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function createDefaultMaterial(h){return h.DefaultMaterial===void 0&&(h.DefaultMaterial=new GLTFLoader.ObjectConstructors.MeshStandardMaterial({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:three_module.hB5})),h.DefaultMaterial}function addUnknownExtensionsToUserData(h,o,c){for(const d in c.extensions)h[d]===void 0&&(o.userData.gltfExtensions=o.userData.gltfExtensions||{},o.userData.gltfExtensions[d]=c.extensions[d])}function assignExtrasToUserData(h,o){o.extras!==void 0&&(typeof o.extras=="object"?Object.assign(h.userData,o.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+o.extras))}function addMorphTargets(h,o,c){let d=!1,_=!1,v=!1;for(let nt=0,lt=o.length;nt<lt;nt++){const ut=o[nt];if(ut.POSITION!==void 0&&(d=!0),ut.NORMAL!==void 0&&(_=!0),ut.COLOR_0!==void 0&&(v=!0),d&&_&&v)break}if(!d&&!_&&!v)return Promise.resolve(h);const b=[],tt=[],it=[];for(let nt=0,lt=o.length;nt<lt;nt++){const ut=o[nt];if(d){const ht=ut.POSITION!==void 0?c.getDependency("accessor",ut.POSITION):h.attributes.position;b.push(ht)}if(_){const ht=ut.NORMAL!==void 0?c.getDependency("accessor",ut.NORMAL):h.attributes.normal;tt.push(ht)}if(v){const ht=ut.COLOR_0!==void 0?c.getDependency("accessor",ut.COLOR_0):h.attributes.color;it.push(ht)}}return Promise.all([Promise.all(b),Promise.all(tt),Promise.all(it)]).then(function(nt){const lt=nt[0],ut=nt[1],ht=nt[2];return d&&(h.morphAttributes.position=lt),_&&(h.morphAttributes.normal=ut),v&&(h.morphAttributes.color=ht),h.morphTargetsRelative=!0,h})}function updateMorphTargets(h,o){if(h.updateMorphTargets(),o.weights!==void 0)for(let c=0,d=o.weights.length;c<d;c++)h.morphTargetInfluences[c]=o.weights[c];if(o.extras&&Array.isArray(o.extras.targetNames)){const c=o.extras.targetNames;if(h.morphTargetInfluences.length===c.length){h.morphTargetDictionary={};for(let d=0,_=c.length;d<_;d++)h.morphTargetDictionary[c[d]]=d}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function createPrimitiveKey(h){let o;const c=h.extensions&&h.extensions[EXTENSIONS.KHR_DRACO_MESH_COMPRESSION];if(o=c?"draco:"+c.bufferView+":"+c.indices+":"+createAttributesKey(c.attributes):h.indices+":"+createAttributesKey(h.attributes)+":"+h.mode,h.targets!==void 0)for(let d=0,_=h.targets.length;d<_;d++)o+=":"+createAttributesKey(h.targets[d]);return o}function createAttributesKey(h){let o="";const c=Object.keys(h).sort();for(let d=0,_=c.length;d<_;d++)o+=c[d]+":"+h[c[d]]+";";return o}function getNormalizedComponentScale(h){switch(h){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function getImageURIMimeType(h){return h.search(/\.jpe?g($|\?)/i)>0||h.search(/^data\:image\/jpeg/)===0?"image/jpeg":h.search(/\.webp($|\?)/i)>0||h.search(/^data\:image\/webp/)===0?"image/webp":"image/png"}const _identityMatrix=new three_module.kn4;class GLTFParser{constructor(o={},c={}){this.json=o,this.extensions={},this.plugins={},this.options=c,this.cache=new GLTFRegistry,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let d=!1,_=!1,v=-1;typeof navigator<"u"&&(d=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!0,_=navigator.userAgent.indexOf("Firefox")>-1,v=_?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),typeof createImageBitmap>"u"||d||_&&v<98?this.textureLoader=new three_module.Tap(this.options.manager):this.textureLoader=new three_module.Kzg(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new three_module.Y9S(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(o){this.extensions=o}setPlugins(o){this.plugins=o}parse(o,c){const d=this,_=this.json,v=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(b){return b._markDefs&&b._markDefs()}),Promise.all(this._invokeAll(function(b){return b.beforeRoot&&b.beforeRoot()})).then(function(){return Promise.all([d.getDependencies("scene"),d.getDependencies("animation"),d.getDependencies("camera")])}).then(function(b){const tt={scene:b[0][_.scene||0],scenes:b[0],animations:b[1],cameras:b[2],asset:_.asset,parser:d,userData:{}};return addUnknownExtensionsToUserData(v,tt,_),assignExtrasToUserData(tt,_),Promise.all(d._invokeAll(function(it){return it.afterRoot&&it.afterRoot(tt)})).then(function(){o(tt)})}).catch(c)}_markDefs(){const o=this.json.nodes||[],c=this.json.skins||[],d=this.json.meshes||[];for(let _=0,v=c.length;_<v;_++){const b=c[_].joints;for(let tt=0,it=b.length;tt<it;tt++)o[b[tt]].isBone=!0}for(let _=0,v=o.length;_<v;_++){const b=o[_];b.mesh!==void 0&&(this._addNodeRef(this.meshCache,b.mesh),b.skin!==void 0&&(d[b.mesh].isSkinnedMesh=!0)),b.camera!==void 0&&this._addNodeRef(this.cameraCache,b.camera)}}_addNodeRef(o,c){c!==void 0&&(o.refs[c]===void 0&&(o.refs[c]=o.uses[c]=0),o.refs[c]++)}_getNodeRef(o,c,d){if(o.refs[c]<=1)return d;const _=d.clone(),v=(b,tt)=>{const it=this.associations.get(b);it!=null&&this.associations.set(tt,it);for(const[nt,lt]of b.children.entries())v(lt,tt.children[nt])};return v(d,_),_.name+="_instance_"+o.uses[c]++,_}_invokeOne(o){const c=Object.values(this.plugins);c.push(this);for(let d=0;d<c.length;d++){const _=o(c[d]);if(_)return _}return null}_invokeAll(o){const c=Object.values(this.plugins);c.unshift(this);const d=[];for(let _=0;_<c.length;_++){const v=o(c[_]);v&&d.push(v)}return d}getDependency(o,c){const d=o+":"+c;let _=this.cache.get(d);if(!_){switch(o){case"scene":_=this.loadScene(c);break;case"node":_=this._invokeOne(function(v){return v.loadNode&&v.loadNode(c)});break;case"mesh":_=this._invokeOne(function(v){return v.loadMesh&&v.loadMesh(c)});break;case"accessor":_=this.loadAccessor(c);break;case"bufferView":_=this._invokeOne(function(v){return v.loadBufferView&&v.loadBufferView(c)});break;case"buffer":_=this.loadBuffer(c);break;case"material":_=this._invokeOne(function(v){return v.loadMaterial&&v.loadMaterial(c)});break;case"texture":_=this._invokeOne(function(v){return v.loadTexture&&v.loadTexture(c)});break;case"skin":_=this.loadSkin(c);break;case"animation":_=this._invokeOne(function(v){return v.loadAnimation&&v.loadAnimation(c)});break;case"camera":_=this.loadCamera(c);break;default:if(_=this._invokeOne(function(v){return v!=this&&v.getDependency&&v.getDependency(o,c)}),!_)throw new Error("Unknown type: "+o)}this.cache.add(d,_)}return _}getDependencies(o){let c=this.cache.get(o);if(!c){const d=this,_=this.json[o+(o==="mesh"?"es":"s")]||[];c=Promise.all(_.map(function(v,b){return d.getDependency(o,b)})),this.cache.add(o,c)}return c}loadBuffer(o){const c=this.json.buffers[o],d=this.fileLoader;if(c.type&&c.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+c.type+" buffer type is not supported.");if(c.uri===void 0&&o===0)return Promise.resolve(this.extensions[EXTENSIONS.KHR_BINARY_GLTF].body);const _=this.options;return new Promise(function(v,b){d.load(three_module.r6x.resolveURL(c.uri,_.path),v,void 0,function(){b(new Error('THREE.GLTFLoader: Failed to load buffer "'+c.uri+'".'))})})}loadBufferView(o){const c=this.json.bufferViews[o];return this.getDependency("buffer",c.buffer).then(function(d){const _=c.byteLength||0,v=c.byteOffset||0;return d.slice(v,v+_)})}loadAccessor(o){const c=this,d=this.json,_=this.json.accessors[o];if(_.bufferView===void 0&&_.sparse===void 0){const b=WEBGL_TYPE_SIZES[_.type],tt=WEBGL_COMPONENT_TYPES[_.componentType],it=_.normalized===!0,nt=new tt(_.count*b);return Promise.resolve(new three_module.THS(nt,b,it))}const v=[];return _.bufferView!==void 0?v.push(this.getDependency("bufferView",_.bufferView)):v.push(null),_.sparse!==void 0&&(v.push(this.getDependency("bufferView",_.sparse.indices.bufferView)),v.push(this.getDependency("bufferView",_.sparse.values.bufferView))),Promise.all(v).then(function(b){const tt=b[0],it=WEBGL_TYPE_SIZES[_.type],nt=WEBGL_COMPONENT_TYPES[_.componentType],lt=nt.BYTES_PER_ELEMENT,ut=lt*it,ht=_.byteOffset||0,_t=_.bufferView!==void 0?d.bufferViews[_.bufferView].byteStride:void 0,ft=_.normalized===!0;let bt,xt;if(_t&&_t!==ut){const St=Math.floor(ht/_t),wt="InterleavedBuffer:"+_.bufferView+":"+_.componentType+":"+St+":"+_.count;let Pt=c.cache.get(wt);Pt||(bt=new nt(tt,St*_t,_.count*_t/lt),Pt=new three_module.eB$(bt,_t/lt),c.cache.add(wt,Pt)),xt=new three_module.eHs(Pt,it,ht%_t/lt,ft)}else bt=tt===null?new nt(_.count*it):new nt(tt,ht,_.count*it),xt=new three_module.THS(bt,it,ft);if(_.sparse!==void 0){const St=WEBGL_TYPE_SIZES.SCALAR,wt=WEBGL_COMPONENT_TYPES[_.sparse.indices.componentType],Pt=_.sparse.indices.byteOffset||0,Rt=_.sparse.values.byteOffset||0,kt=new wt(b[1],Pt,_.sparse.count*St),Gt=new nt(b[2],Rt,_.sparse.count*it);tt!==null&&(xt=new three_module.THS(xt.array.slice(),xt.itemSize,xt.normalized));for(let Dt=0,It=kt.length;Dt<It;Dt++){const Nt=kt[Dt];if(xt.setX(Nt,Gt[Dt*it]),it>=2&&xt.setY(Nt,Gt[Dt*it+1]),it>=3&&xt.setZ(Nt,Gt[Dt*it+2]),it>=4&&xt.setW(Nt,Gt[Dt*it+3]),it>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return xt})}loadTexture(o){const c=this.json,d=this.options;if(o<0||o>=c.textures.length)return console.warn("THREE.GLTFLoader: Invalid texture index:",o),null;const _=c.textures[o].source;if(_<0||_>=c.images.length)return console.warn("THREE.GLTFLoader: Invalid source index:",_),null;const v=c.images[_];let b=this.textureLoader;if(v.uri){const tt=d.manager.getHandler(v.uri);tt!==null&&(b=tt)}return this.loadTextureImage(o,_,b)}loadTextureImage(o,c,d){const _=this,v=this.json,b=v.textures[o],tt=v.images[c],it=(tt.uri||tt.bufferView)+":"+b.sampler;if(this.textureCache[it])return this.textureCache[it];const nt=this.loadImageSource(c,d).then(function(lt){lt.name=b.name||tt.name||"",lt.name===""&&typeof tt.uri=="string"&&tt.uri.startsWith("data:image/")===!1&&(lt.name=tt.uri);const ut=(v.samplers||{})[b.sampler]||{};return lt.magFilter=WEBGL_FILTERS[ut.magFilter]||three_module.k6q,lt.minFilter=WEBGL_FILTERS[ut.minFilter]||three_module.$_I,lt.wrapS=WEBGL_WRAPPINGS[ut.wrapS]||three_module.GJx,lt.wrapT=WEBGL_WRAPPINGS[ut.wrapT]||three_module.GJx,ut.extras&&ut.extras.uuid!==void 0&&(lt.uuid=ut.extras.uuid,lt.__hasGLTFUuid=!0),_.associations.set(lt,{textures:o}),lt}).catch(function(){return null});return this.textureCache[it]=nt,nt}loadImageSource(o,c,d=!1,_=!1){const v=this,b=this.json,tt=this.options;if(!_&&this.sourceCache[o]!==void 0)return this.sourceCache[o].then(ft=>ft.clone());const it=b.images[o],nt=self.URL||self.webkitURL;it.uri===void 0&&it.extras&&it.extras.uri&&(it.uri=it.extras.uri);let lt=it.uri||"",ut=!1,ht=null;if(it.bufferView===void 0||d&&lt){if(it.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+o+" is missing URI and bufferView")}else lt=v.getDependency("bufferView",it.bufferView).then(function(ft){ut=!0;const bt=new Blob([ft],{type:it.mimeType});return lt=nt.createObjectURL(bt),ht=bt,lt});const _t=Promise.resolve(lt).then(function(ft){return new Promise(function(bt,xt){let St=bt;c.isImageBitmapLoader===!0&&(St=function(wt){const Pt=new three_module.gPd(wt);Pt.needsUpdate=!0,bt(Pt)}),c.load(three_module.r6x.resolveURL(ft,tt.path),St,void 0,function(wt){c.isImageBitmapLoader===!0?(c=new three_module.Tap(v.options.manager),St=bt,c.setCrossOrigin(v.options.crossOrigin),c.setRequestHeader(v.options.requestHeader),c.load(three_module.r6x.resolveURL(ft,tt.path),St,void 0,xt)):xt(wt)})})}).then(function(ft){if(ut===!0&&nt.revokeObjectURL(lt),ft.userData.mimeType=it.mimeType||getImageURIMimeType(it.uri),ft.flipY=!1,it.extras){if(it.extras.flipY!==void 0){if(c.isImageBitmapLoader===!0&&typeof createImageBitmap!==void 0){let bt=ft;const xt=it.extras.flipY&&!bt.flipY;createImageBitmap(bt.source.data,{imageOrientation:xt?"flipY":"none"}).then(function(St){bt._newTex&&(bt=bt._newTex),bt.source.data.close&&bt.source.data.close(),bt.source.data=St,bt.source.needsUpdate=!0,bt.needsUpdate=!0})}ft.flipY=it.extras.flipY,ft.needsUpdate=!0,delete it.extras.flipY}it.extras.uuid!==void 0&&(ft.source.uuid=it.extras.uuid),it.extras.t_uuid!==void 0&&(ft.uuid=it.extras.t_uuid,ft.__hasGLTFUuid=!0)}return it.uri&&typeof it.uri=="string"&&ut===!1&&!it.uri.startsWith("/")&&(ft.userData.rootPath=three_module.r6x.resolveURL(it.uri,tt.path)),ht&&(ft.userData.__sourceBlob=ht),!d&&it.uri&&it.uri!==lt&&v.loadImageSource(o,c,!0,!0).then(function(bt){ft.source.data&&ft.source.data.close&&ft.source.data.close(),ft.dispose(),ft.source=bt.source,ft.source.needsUpdate=!0,ft.needsUpdate=!0,ft.uuid=bt.uuid,bt.__hasGLTFUuid&&(ft.__hasGLTFUuid=!0),ft.flipY=bt.flipY,ft.userData=bt.userData,ft.setDirty&&ft.setDirty(),bt._newTex=ft}),ft}).catch(function(ft){throw console.error("THREE.GLTFLoader: Couldn't load texture",lt),ft});return this.sourceCache[o]=_t,_t}assignTexture(o,c,d,_){const v=this;return this.getDependency("texture",d.index).then(function(b){if(!b)return null;if(d.texCoord!==void 0&&d.texCoord>0&&((b=b.clone()).channel=d.texCoord),v.extensions[EXTENSIONS.KHR_TEXTURE_TRANSFORM]){const tt=d.extensions!==void 0?d.extensions[EXTENSIONS.KHR_TEXTURE_TRANSFORM]:void 0;if(tt){const it=v.associations.get(b);b=v.extensions[EXTENSIONS.KHR_TEXTURE_TRANSFORM].extendTexture(b,tt),v.associations.set(b,it)}}return _!==void 0&&(b.colorSpace=_),o[c]=b,b})}assignFinalMaterial(o){const c=o.geometry;let d=o.material;const _=c.attributes.tangent===void 0,v=c.attributes.color!==void 0,b=c.attributes.normal===void 0;if(o.isPoints){const it="PointsMaterial:"+d.uuid;let nt=this.cache.get(it);nt||(nt=new GLTFLoader.ObjectConstructors.PointsMaterial,three_module.imn.prototype.copy.call(nt,d),nt.color.copy(d.color),nt.map=d.map,nt.sizeAttenuation=!1,this.cache.add(it,nt)),d=nt}else if(o.isLine){const it="LineBasicMaterial:"+d.uuid;let nt=this.cache.get(it);nt||(nt=new GLTFLoader.ObjectConstructors.LineBasicMaterial,three_module.imn.prototype.copy.call(nt,d),nt.color.copy(d.color),nt.map=d.map,this.cache.add(it,nt)),d=nt}const tt=!(!d.userData||!d.userData.gltfExtensions||!d.userData.gltfExtensions.WEBGI_material_extras);if((_||v||b)&&!tt){let it="ClonedMaterial:"+d.uuid+":";_&&(it+="derivative-tangents:"),v&&(it+="vertex-colors:"),b&&(it+="flat-shading:");let nt=this.cache.get(it);nt||(nt=d.clone(),v&&(nt.vertexColors=!0),b&&(nt.flatShading=!0),_&&(nt.normalScale&&(nt.normalScale.y*=-1),nt.clearcoatNormalScale&&(nt.clearcoatNormalScale.y*=-1)),this.cache.add(it,nt),this.associations.set(nt,this.associations.get(d))),d=nt}o.material=d}getMaterialType(){return GLTFLoader.ObjectConstructors.MeshStandardMaterial}loadMaterial(o){const c=this,d=this.json,_=this.extensions,v=d.materials[o];let b;const tt={},it=[];if((v.extensions||{})[EXTENSIONS.KHR_MATERIALS_UNLIT]){const lt=_[EXTENSIONS.KHR_MATERIALS_UNLIT];b=lt.getMaterialType(),it.push(lt.extendParams(tt,v,c))}else{const lt=v.pbrMetallicRoughness||{};if(tt.color=new three_module.Q1f(1,1,1),tt.opacity=1,Array.isArray(lt.baseColorFactor)){const ut=lt.baseColorFactor;tt.color.setRGB(ut[0],ut[1],ut[2],three_module.Zr2),tt.opacity=ut[3]}lt.baseColorTexture!==void 0&&it.push(c.assignTexture(tt,"map",lt.baseColorTexture,three_module.er$)),tt.metalness=lt.metallicFactor!==void 0?lt.metallicFactor:.1,tt.roughness=lt.roughnessFactor!==void 0?lt.roughnessFactor:.5,lt.metallicRoughnessTexture!==void 0&&(it.push(c.assignTexture(tt,"metalnessMap",lt.metallicRoughnessTexture)),it.push(c.assignTexture(tt,"roughnessMap",lt.metallicRoughnessTexture))),b=this._invokeOne(function(ut){return ut.getMaterialType&&ut.getMaterialType(o)}),it.push(Promise.all(this._invokeAll(function(ut){return ut.extendMaterialParams&&ut.extendMaterialParams(o,tt)})))}v.doubleSided===!0&&(tt.side=three_module.$EB);const nt=v.alphaMode||ALPHA_MODES.OPAQUE;if(nt===ALPHA_MODES.BLEND?(tt.transparent=!0,tt.depthWrite=!1):(tt.transparent=!1,nt===ALPHA_MODES.MASK&&(tt.alphaTest=v.alphaCutoff!==void 0?v.alphaCutoff:.5)),v.normalTexture!==void 0&&b!==GLTFLoader.ObjectConstructors.MeshBasicMaterial&&(it.push(c.assignTexture(tt,"normalMap",v.normalTexture)),tt.normalScale=new three_module.I9Y(1,1),v.normalTexture.scale!==void 0)){const lt=v.normalTexture.scale;tt.normalScale.set(lt,lt)}if(v.occlusionTexture!==void 0&&b!==GLTFLoader.ObjectConstructors.MeshBasicMaterial&&(it.push(c.assignTexture(tt,"aoMap",v.occlusionTexture)),v.occlusionTexture.strength!==void 0&&(tt.aoMapIntensity=v.occlusionTexture.strength)),v.emissiveFactor!==void 0&&b!==GLTFLoader.ObjectConstructors.MeshBasicMaterial){const lt=v.emissiveFactor;tt.emissive=new three_module.Q1f().setRGB(lt[0],lt[1],lt[2],three_module.Zr2)}return v.emissiveTexture!==void 0&&b!==GLTFLoader.ObjectConstructors.MeshBasicMaterial&&it.push(c.assignTexture(tt,"emissiveMap",v.emissiveTexture,three_module.er$)),Promise.all(it).then(function(){const lt=new b(tt);return v.extras&&v.extras.uuid&&(lt.uuid=v.extras.uuid),v.name&&(lt.name=v.name),assignExtrasToUserData(lt,v),c.associations.set(lt,{materials:o}),v.extensions&&addUnknownExtensionsToUserData(_,lt,v),lt})}createUniqueName(o){const c=three_module.Nwf.sanitizeNodeName(o||"");return c in this.nodeNamesUsed?c+"_"+ ++this.nodeNamesUsed[c]:(this.nodeNamesUsed[c]=0,c)}loadGeometries(o){const c=this,d=this.extensions,_=this.primitiveCache;function v(tt){return d[EXTENSIONS.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(tt,c).then(function(it){return addPrimitiveAttributes(it,tt,c)})}const b=[];for(let tt=0,it=o.length;tt<it;tt++){const nt=o[tt],lt=createPrimitiveKey(nt),ut=_[lt];if(ut)b.push(ut.promise);else{let ht;ht=nt.extensions&&nt.extensions[EXTENSIONS.KHR_DRACO_MESH_COMPRESSION]?v(nt):addPrimitiveAttributes(new three_module.LoY,nt,c),_[lt]={primitive:nt,promise:ht},b.push(ht)}}return Promise.all(b)}loadMesh(o){const c=this,d=this.json,_=this.extensions,v=d.meshes[o],b=v.primitives,tt=[];for(let it=0,nt=b.length;it<nt;it++){const lt=b[it].material===void 0?createDefaultMaterial(this.cache):this.getDependency("material",b[it].material);tt.push(lt)}return tt.push(c.loadGeometries(b)),Promise.all(tt).then(function(it){const nt=it.slice(0,it.length-1),lt=it[it.length-1],ut=[];for(let _t=0,ft=lt.length;_t<ft;_t++){const bt=lt[_t],xt=b[_t];let St;const wt=nt[_t];if(xt.mode===WEBGL_CONSTANTS.TRIANGLES||xt.mode===WEBGL_CONSTANTS.TRIANGLE_STRIP||xt.mode===WEBGL_CONSTANTS.TRIANGLE_FAN||xt.mode===void 0)St=v.isSkinnedMesh===!0?new three_module.I46(bt,wt):new three_module.eaF(bt,wt),St.isSkinnedMesh===!0&&St.normalizeSkinWeights(),xt.mode===WEBGL_CONSTANTS.TRIANGLE_STRIP?St.geometry=toTrianglesDrawMode(St.geometry,three_module.O49):xt.mode===WEBGL_CONSTANTS.TRIANGLE_FAN&&(St.geometry=toTrianglesDrawMode(St.geometry,three_module.rYR));else if(xt.mode===WEBGL_CONSTANTS.LINES)St=new three_module.DXC(bt,wt);else if(xt.mode===WEBGL_CONSTANTS.LINE_STRIP)St=new three_module.N1A(bt,wt);else if(xt.mode===WEBGL_CONSTANTS.LINE_LOOP)St=new three_module.FCc(bt,wt);else{if(xt.mode!==WEBGL_CONSTANTS.POINTS)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+xt.mode);St=new three_module.ONl(bt,wt)}Object.keys(St.geometry.morphAttributes).length>0&&updateMorphTargets(St,v),St.name=c.createUniqueName(v.name||"mesh_"+o),St.geometry&&v.extras&&v.extras.isGeometryUserData?(assignExtrasToUserData(St.geometry,v),xt.extensions&&addUnknownExtensionsToUserData(_,St.geometry,xt)):(assignExtrasToUserData(St,v),xt.extensions&&addUnknownExtensionsToUserData(_,St,xt)),c.assignFinalMaterial(St),ut.push(St)}v.extensions&&ut.forEach(_t=>addUnknownExtensionsToUserData(_,_t,v));for(let _t=0,ft=ut.length;_t<ft;_t++)c.associations.set(ut[_t],{meshes:o,primitives:_t});if(ut.length===1)return v.extensions&&addUnknownExtensionsToUserData(_,ut[0],v),ut[0];const ht=new three_module.YJl;v.extensions&&addUnknownExtensionsToUserData(_,ht,v),c.associations.set(ht,{meshes:o});for(let _t=0,ft=ut.length;_t<ft;_t++)ht.add(ut[_t]);return ht})}loadCamera(o){let c;const d=this.json.cameras[o],_=d[d.type];if(_)return d.type==="perspective"?c=new GLTFLoader.ObjectConstructors.PerspectiveCamera(three_module.cj9.radToDeg(_.yfov),_.aspectRatio||1,_.znear||1,_.zfar||2e6):d.type==="orthographic"&&(c=new GLTFLoader.ObjectConstructors.OrthographicCamera(-_.xmag,_.xmag,_.ymag,-_.ymag,_.znear,_.zfar)),d.name&&(c.name=this.createUniqueName(d.name)),assignExtrasToUserData(c,d),Promise.resolve(c);console.warn("THREE.GLTFLoader: Missing camera parameters.")}loadSkin(o){const c=this.json.skins[o],d=[];for(let _=0,v=c.joints.length;_<v;_++)d.push(this._loadNodeShallow(c.joints[_]));return c.inverseBindMatrices!==void 0?d.push(this.getDependency("accessor",c.inverseBindMatrices)):d.push(null),Promise.all(d).then(function(_){const v=_.pop(),b=_,tt=[],it=[];for(let nt=0,lt=b.length;nt<lt;nt++){const ut=b[nt];if(ut){tt.push(ut);const ht=new three_module.kn4;v!==null&&ht.fromArray(v.array,16*nt),it.push(ht)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',c.joints[nt])}return new three_module.EAD(tt,it)})}loadAnimation(o){const c=this.json,d=this,_=c.animations[o],v=_.name?_.name:"animation_"+o,b=[],tt=[],it=[],nt=[],lt=[];for(let ut=0,ht=_.channels.length;ut<ht;ut++){const _t=_.channels[ut],ft=_.samplers[_t.sampler],bt=_t.target,xt=bt.node,St=_.parameters!==void 0?_.parameters[ft.input]:ft.input,wt=_.parameters!==void 0?_.parameters[ft.output]:ft.output;bt.node!==void 0&&(b.push(this.getDependency("node",xt)),tt.push(this.getDependency("accessor",St)),it.push(this.getDependency("accessor",wt)),nt.push(ft),lt.push(bt))}return Promise.all([Promise.all(b),Promise.all(tt),Promise.all(it),Promise.all(nt),Promise.all(lt)]).then(function(ut){const ht=ut[0],_t=ut[1],ft=ut[2],bt=ut[3],xt=ut[4],St=[];for(let wt=0,Pt=ht.length;wt<Pt;wt++){const Rt=ht[wt],kt=_t[wt],Gt=ft[wt],Dt=bt[wt],It=xt[wt];if(Rt===void 0)continue;Rt.updateMatrix&&Rt.updateMatrix();const Nt=d._createAnimationTracks(Rt,kt,Gt,Dt,It);if(Nt)for(let Vt=0;Vt<Nt.length;Vt++)St.push(Nt[Vt])}return new three_module.tz3(v,void 0,St)})}createNodeMesh(o){const c=this.json,d=this,_=c.nodes[o];return _.mesh===void 0?null:d.getDependency("mesh",_.mesh).then(function(v){const b=d._getNodeRef(d.meshCache,_.mesh,v);return _.weights!==void 0&&b.traverse(function(tt){if(tt.isMesh)for(let it=0,nt=_.weights.length;it<nt;it++)tt.morphTargetInfluences[it]=_.weights[it]}),b})}loadNode(o){const c=this,d=this.json.nodes[o],_=c._loadNodeShallow(o),v=[],b=d.children||[];for(let it=0,nt=b.length;it<nt;it++)v.push(c.getDependency("node",b[it]));const tt=d.skin===void 0?Promise.resolve(null):c.getDependency("skin",d.skin);return Promise.all([_,Promise.all(v),tt]).then(function(it){const nt=it[0],lt=it[1],ut=it[2];ut!==null&&nt.traverse(function(ht){ht.isSkinnedMesh&&ht.bind(ut,_identityMatrix)});for(let ht=0,_t=lt.length;ht<_t;ht++)nt.add(lt[ht]);return nt})}_loadNodeShallow(o){const c=this.json,d=this.extensions,_=this;if(this.nodeCache[o]!==void 0)return this.nodeCache[o];const v=c.nodes[o],b=v.name?_.createUniqueName(v.name):"",tt=[],it=_._invokeOne(function(nt){return nt.createNodeMesh&&nt.createNodeMesh(o)});return it&&tt.push(it),v.camera!==void 0&&tt.push(_.getDependency("camera",v.camera).then(function(nt){return _._getNodeRef(_.cameraCache,v.camera,nt)})),_._invokeAll(function(nt){return nt.createNodeAttachment&&nt.createNodeAttachment(o)}).forEach(function(nt){tt.push(nt)}),this.nodeCache[o]=Promise.all(tt).then(function(nt){let lt;if(lt=v.isBone===!0?new three_module.$Kf:nt.length>1?new three_module.YJl:nt.length===1?nt[0]:new three_module.B69,lt!==nt[0])for(let ut=0,ht=nt.length;ut<ht;ut++)lt.add(nt[ut]);if(v.name&&(lt.userData.name=v.name,lt.name=b),assignExtrasToUserData(lt,v),v.extensions&&addUnknownExtensionsToUserData(d,lt,v),v.matrix!==void 0){const ut=new three_module.kn4;ut.fromArray(v.matrix),lt.applyMatrix4(ut)}else v.translation!==void 0&&lt.position.fromArray(v.translation),v.rotation!==void 0&&lt.quaternion.fromArray(v.rotation),v.scale!==void 0&&lt.scale.fromArray(v.scale);return _.associations.has(lt)||_.associations.set(lt,{}),_.associations.get(lt).nodes=o,lt}),this.nodeCache[o]}loadScene(o){const c=this.extensions,d=this.json.scenes[o],_=this,v=new three_module.YJl;d.name&&(v.name=_.createUniqueName(d.name)),assignExtrasToUserData(v,d),d.extensions&&addUnknownExtensionsToUserData(c,v,d);const b=d.nodes||[],tt=[];for(let it=0,nt=b.length;it<nt;it++)tt.push(_.getDependency("node",b[it]));return Promise.all(tt).then(function(it){for(let nt=0,lt=it.length;nt<lt;nt++)v.add(it[nt]);return _.associations=(nt=>{const lt=new Map;for(const[ut,ht]of _.associations)(ut instanceof three_module.imn||ut instanceof three_module.gPd)&&lt.set(ut,ht);return nt.traverse(ut=>{const ht=_.associations.get(ut);ht!=null&&lt.set(ut,ht)}),lt})(v),v})}_createAnimationTracks(o,c,d,_,v){const b=[],tt=o.name?o.name:o.uuid,it=[];let nt;switch(PATH_PROPERTIES[v.path]===PATH_PROPERTIES.weights?o.traverse(function(ht){ht.morphTargetInfluences&&it.push(ht.name?ht.name:ht.uuid)}):it.push(tt),PATH_PROPERTIES[v.path]){case PATH_PROPERTIES.weights:nt=three_module.Hit;break;case PATH_PROPERTIES.rotation:nt=three_module.MBL;break;case PATH_PROPERTIES.position:case PATH_PROPERTIES.scale:nt=three_module.RiT;break;default:nt=d.itemSize===1?three_module.Hit:three_module.RiT}const lt=_.interpolation!==void 0?INTERPOLATION[_.interpolation]:three_module.PJ3,ut=this._getArrayFromAccessor(d);for(let ht=0,_t=it.length;ht<_t;ht++){const ft=new nt(it[ht]+"."+PATH_PROPERTIES[v.path],c.array,ut,lt);_.interpolation==="CUBICSPLINE"&&this._createCubicSplineTrackInterpolant(ft),b.push(ft)}return b}_getArrayFromAccessor(o){let c=o.array;if(o.normalized){const d=getNormalizedComponentScale(c.constructor),_=new Float32Array(c.length);for(let v=0,b=c.length;v<b;v++)_[v]=c[v]*d;c=_}return c}_createCubicSplineTrackInterpolant(o){o.createInterpolant=function(c){return new(this instanceof three_module.MBL?GLTFCubicSplineQuaternionInterpolant:GLTFCubicSplineInterpolant)(this.times,this.values,this.getValueSize()/3,c)},o.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function computeBounds(h,o,c){const d=o.attributes,_=new three_module.NRn;if(d.POSITION===void 0)return;{const tt=c.json.accessors[d.POSITION],it=tt.min,nt=tt.max;if(it===void 0||nt===void 0)return void console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");if(_.set(new three_module.Pq0(it[0],it[1],it[2]),new three_module.Pq0(nt[0],nt[1],nt[2])),tt.normalized){const lt=getNormalizedComponentScale(WEBGL_COMPONENT_TYPES[tt.componentType]);_.min.multiplyScalar(lt),_.max.multiplyScalar(lt)}}const v=o.targets;if(v!==void 0){const tt=new three_module.Pq0,it=new three_module.Pq0;for(let nt=0,lt=v.length;nt<lt;nt++){const ut=v[nt];if(ut.POSITION!==void 0){const ht=c.json.accessors[ut.POSITION],_t=ht.min,ft=ht.max;if(_t!==void 0&&ft!==void 0){if(it.setX(Math.max(Math.abs(_t[0]),Math.abs(ft[0]))),it.setY(Math.max(Math.abs(_t[1]),Math.abs(ft[1]))),it.setZ(Math.max(Math.abs(_t[2]),Math.abs(ft[2]))),ht.normalized){const bt=getNormalizedComponentScale(WEBGL_COMPONENT_TYPES[ht.componentType]);it.multiplyScalar(bt)}tt.max(it)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}_.expandByVector(tt)}h.boundingBox=_;const b=new three_module.iyt;_.getCenter(b.center),b.radius=_.min.distanceTo(_.max)/2,h.boundingSphere=b}function addPrimitiveAttributes(h,o,c){const d=o.attributes,_=[];function v(b,tt){return c.getDependency("accessor",b).then(function(it){h.setAttribute(tt,it)})}for(const b in d){const tt=ATTRIBUTES[b]||b.toLowerCase();tt in h.attributes||_.push(v(d[b],tt))}if(o.indices!==void 0&&!h.index){const b=c.getDependency("accessor",o.indices).then(function(tt){h.setIndex(tt)});_.push(b)}return three_module.ppV.workingColorSpace!==three_module.Zr2&&"COLOR_0"in d&&console.warn(`THREE.GLTFLoader: Converting vertex colors from "srgb-linear" to "${three_module.ppV.workingColorSpace}" not supported.`),assignExtrasToUserData(h,o),computeBounds(h,o,c),Promise.all(_).then(function(){return o.targets!==void 0?addMorphTargets(h,o.targets,c):h})}class GLTFLoader2 extends GLTFLoader{constructor(o){super(o),this.isGLTFLoader2=!0,this.preparsers=[],this.preparsers.push(glbEncryptionPreparser)}async preparse(o,c){for(const d of this.preparsers)o=await d.process(o,c);return o}parse(o,c,d,_,v){this.preparse.call(this,o,v||c).then(b=>{const tt=three_module.gPd.DEFAULT_IMAGE;return three_module.gPd.DEFAULT_IMAGE||(three_module.gPd.DEFAULT_IMAGE=AssetImporter.WHITE_IMAGE_DATA),b?super.parse(b,c,it=>{three_module.gPd.DEFAULT_IMAGE=tt,d&&d(it)},_):_&&_(new ErrorEvent("no data"))}).catch(b=>{console.error(b),_&&_(b??new ErrorEvent("unknown error"))})}transform(o,c){const d=o?o.scene||(o.scenes&&o.scenes.length>0?o.scenes[0]:void 0):void 0;return d&&o.animations.length>0&&(d.animations=o.animations),d==null||d.traverse(_=>{_.userData.gltfUUID&&(_.uuid=_.userData.gltfUUID,delete _.userData.gltfUUID)}),d}register(o){return super.register(o)}}const glbEncryptionPreparser={key:(h,o,c)=>h.key||window&&window.prompt&&window.prompt("GLTFEncryption: Please enter the password/key for the model: "+c)||"",async process(h,o){var c;if(typeof h=="string"||!new TextDecoder().decode(new Uint8Array(h,0,100)).includes("WebGiGLBWrapper"))return h;const d=new GLTFBinaryExtension(h),_=JSON.parse(d.content||"{}");let v=d.body||h;const b=(c=_.asset)===null||c===void 0?void 0:c.encryption;if(!b)return v;const tt=b.type,it=b.version;if(tt==="aesgcm"&&it===1){const nt=await Ee$1(this.key,b,_,o)||"";try{v=(await Pe$1(new Uint8Array(v),nt)).buffer}catch{throw new ErrorEvent("decryption error")}}return v}};class RGBEPNGLoader extends three_module.Y9S{constructor(o){super(o),this.type=three_module.ix0}async loadAsync(o,c){const d=await this.parseAsync(o,c,!1),_=new three_module.GYF(d.data,d.width,d.height,three_module.GWd,this.type);return _.needsUpdate=!0,_.flipY=!0,_.colorSpace=three_module.er$,_.minFilter=three_module.k6q,_.magFilter=three_module.k6q,_.source.data.complete=!0,_}async parseAsync(o,c,d=!1){let _=!1;if(!o.startsWith("data:")&&!o.startsWith("blob:")){this.responseType="blob";const tt=await super.loadAsync(o,c);o=URL.createObjectURL(tt),_=!0}const v=await He$1(o);_&&URL.revokeObjectURL(o);let b=Uint8Array;return this.type===three_module.ix0?b=Uint16Array:this.type===three_module.RQf&&(b=Uint32Array),{data:rgbeToHalfFloat(v.data,4,b,d),width:v.width,height:v.height}}setDataType(o){return this.type=o,this}}function rgbeToHalfFloat(h,o=3,c=Uint16Array,d=!1){let _;const v=h.byteLength>>2,b=new c(v*o);for(let tt=0;tt<v;tt++)_=Math.pow(2,h[4*tt+3]-136),d?(b[tt*o]=Math.min(h[4*tt]*_,65504),b[tt*o+1]=Math.min(h[4*tt+1]*_,65504),b[tt*o+2]=Math.min(h[4*tt+2]*_,65504)):(b[tt*o]=three_module.GxU.toHalfFloat(Math.min(h[4*tt]*_,65504)),b[tt*o+1]=three_module.GxU.toHalfFloat(Math.min(h[4*tt+1]*_,65504)),b[tt*o+2]=three_module.GxU.toHalfFloat(Math.min(h[4*tt+2]*_,65504))),o===4&&(b[tt*o+3]=three_module.GxU.toHalfFloat(1));return b}class ObjectLoader2 extends three_module.XTe{constructor(o){super(o),this._imageLoader=new three_module.$NF(o)}static async LoadRootPathTextures(o,c,d,_=!0){var v;const b=[];for(const tt of Array.isArray(o)?o:Object.values(o??{})){const it=(v=tt==null?void 0:tt.userData)===null||v===void 0?void 0:v.rootPath,nt=_&&tt.image&&c[tt.image];if(!it)continue;const lt=d.importPath(it,{processImported:!1}).then(ut=>{const ht=ut==null?void 0:ut[0],_t=ht==null?void 0:ht.source;if(!ht||!_t)return null;const ft=new three_module.kLi(_t.data);return tt.image&&(ft.uuid=tt.image),tt.image=ft.uuid,nt||(c[ft.uuid]=ft),ht.dispose(),ft}).catch(ut=>(console.error(ut),delete tt.userData.rootPath,null));nt?tt.rootPathPromise=lt:b.push(lt)}await Promise.allSettled(b)}parseTextures2(o,c,d){var _,v;for(const it of o){const nt=(_=it==null?void 0:it.userData)===null||_===void 0?void 0:_.rootPath;if(nt&&(!it.image||!c[it.image])){const lt=new three_module.kLi(this._imageLoader.load(nt,d));if(!lt)continue;it.image&&(lt.uuid=it.image),c[lt.uuid]=lt,it.image=lt.uuid}it.userData=deserializeObject(it.userData,void 0,!1,{images:c})}const b=super.parseTextures(o,c),tt={...b};for(const it of o)(v=it.rootPathPromise)===null||v===void 0||v.then(nt=>{if(!nt)return;const lt=tt[it.uuid];lt.dispose(),lt.source=nt,lt.source.needsUpdate=!0,lt.needsUpdate=!0});return b}parseMaterials2(o,c,d){const _={};return o.forEach(v=>{if(!v)return;const b={...v},tt=Object.keys(b);for(const nt of tt)if(nt==="map"||nt.endsWith("Map")){const lt=b[nt];typeof lt=="string"&&(c[lt]?b[nt]=c[lt]:(console.warn(`Texture ${lt} not found`),delete b[nt]))}b.userData&&(b.userData=deserializeObject(b.userData,void 0,!1,{textures:c}),b.userData.cloneId&&b.userData.uuid!==v.uuid&&(b.userData.uuid=v.uuid));const it=d.generateFromTemplateType(b.type,b);it&&(_[v.uuid]=it)}),_}}const viewerGLTFExtension="WEBGI_viewer",webgiLightExtrasExtension="WEBGI_light_extras",webgiObject3DExtrasExtension="WEBGI_object3d_extras",webgiMaterialExtrasExtension="WEBGI_material_extras",GLTFMaterialsBumpMapExtensionName="WEBGI_materials_bumpmap",GLTFMaterialsDisplacementMapExtensionName="WEBGI_materials_displacementmap",GLTFMaterialsAlphaMapExtensionName="WEBGI_materials_alphamap",GLTFMaterialsLightMapExtensionName="WEBGI_materials_lightmap",supportedEmbeddedFiles=["hdr","exr","webp","avif","ktx","hdrpng","svg","cube"];function addGLTFLoader(h){return new Importer(GLTFLoader2,["gltf","glb","data:model/gltf"],!0,(o,c)=>{if(!o)return o;const d=o,_=new ObjectLoader2(c.loadingManager);return d.register(gltfMaterialExtrasParser(_,h)),d.register(gltfObject3DExtrasParser()),d.register(gltfLightExtrasParser(_)),d.register(v=>new GLTFMaterialsBumpMapExtension(v)),d.register(v=>new GLTFMaterialsDisplacementMapExtension(v)),d.register(v=>new GLTFMaterialsLightMapExtension(v)),d.register(v=>new GLTFMaterialsAlphaMapExtension(v)),d.register(v=>{var b,tt,it,nt,lt,ut,ht,_t,ft;const bt=v.getDependency;v.getDependency=async(kt,Gt)=>{const Dt=await bt.call(v,kt,Gt);if(Dt&&Dt.userData){const It=Dt.userData.gltfExtensions;delete Dt.userData.gltfExtensions,Dt.userData=deserializeObject(Dt.userData,{},!1,{}),Dt.userData.gltfExtensions=It}return Dt};const xt=esm_browser_v4()+".drc",St=esm_browser_v4()+".ktx2",wt=(it=(tt=(b=v.json)===null||b===void 0?void 0:b.extensionsRequired)===null||tt===void 0?void 0:tt.includes)===null||it===void 0?void 0:it.call(tt,"KHR_draco_mesh_compression");if(wt){const kt=c.registerFile(xt);kt&&d.setDRACOLoader(kt)}!((ut=(lt=(nt=v.json)===null||nt===void 0?void 0:nt.extensionsUsed)===null||lt===void 0?void 0:lt.includes)===null||ut===void 0)&&ut.call(lt,"EXT_meshopt_compression")&&(window.MeshoptDecoder?(d.setMeshoptDecoder(window.MeshoptDecoder),v.options.meshoptDecoder=window.MeshoptDecoder):console.error("Add GLTFMeshOptPlugin to viewer to enable EXT_meshopt_compression decode"));const Pt=c.registerFile(St),Rt=supportedEmbeddedFiles.map(kt=>esm_browser_v4()+"."+kt);return Rt.forEach(kt=>c.registerFile(kt)),!((ft=(_t=(ht=v.json)===null||ht===void 0?void 0:ht.extensionsUsed)===null||_t===void 0?void 0:_t.includes)===null||ft===void 0)&&ft.call(_t,"KHR_texture_basisu")&&Pt&&(d.setKTX2Loader(Pt),v.options.ktx2Loader=Pt),{name:"GLTF2_HELPER_PLUGIN",afterRoot:async kt=>{wt&&c.unregisterFile(xt),Pt&&c.unregisterFile(St),Rt.forEach(Dt=>c.unregisterFile(Dt));const Gt=await importViewer(v,h,_);kt.scene&&(kt.scene.__importedViewerConfig=Gt)}}}),d})}const gltfObject3DExtrasParser=h=>o=>({name:"__"+webgiObject3DExtrasExtension,afterRoot:async c=>{(c.scenes||(c.scene?[c.scene]:[])).forEach(d=>{d.traverse(_=>{var v,b;if(!_||!_.isObject3D)return;const tt=(b=(v=_.userData)===null||v===void 0?void 0:v.gltfExtensions)===null||b===void 0?void 0:b[webgiObject3DExtrasExtension];if(!tt)return void(_.isLight&&!_.isAmbientLight&&(_.castShadow=!0));const it=tt.castShadow!==void 0||tt.receiveShadow!==void 0;tt.castShadow!==void 0&&(_.castShadow=tt.castShadow),tt.receiveShadow!==void 0&&(_.receiveShadow=tt.receiveShadow),tt.visible!==void 0&&(_.visible=tt.visible),tt.frustumCulled!==void 0&&(_.frustumCulled=tt.frustumCulled),tt.renderOrder!==void 0&&(_.renderOrder=tt.renderOrder),tt.layers!==void 0&&(_.layers.mask=tt.layers),it&&(_.userData.__keepShadowDef=!0),delete _.userData.gltfExtensions[webgiObject3DExtrasExtension]})})}}),gltfMaterialExtrasParser=(h,o)=>c=>({name:"__"+webgiMaterialExtrasExtension,afterRoot:async d=>{var _,v,b;const tt=d.scenes||(d.scene?[d.scene]:[]);for(const it of tt){const nt=(v=(_=it.userData)===null||_===void 0?void 0:_.gltfExtensions)===null||v===void 0?void 0:v[webgiMaterialExtrasExtension],lt=nt&&await((b=o.getPlugin(AssetManagerPlugin))===null||b===void 0?void 0:b.importConfigResources(nt.resources||{}))||{};it.traverse(ut=>{var ht,_t;const ft=ut==null?void 0:ut.material;if(!(ft!=null&&ft.isMaterial))return;const bt=(_t=(ht=ft.userData)===null||ht===void 0?void 0:ht.gltfExtensions)===null||_t===void 0?void 0:_t[webgiMaterialExtrasExtension];bt&&(bt.emissiveIntensity!==void 0&&(ft.emissiveIntensity=bt.emissiveIntensity),bt.fog!==void 0&&(ft.fog=bt.fog),bt.flatShading!==void 0&&(ft.flatShading=bt.flatShading),bt.blending!==void 0&&(ft.blending=bt.blending),bt.side!==void 0&&(ft.side=bt.side),bt.shadowSide!==void 0&&(ft.shadowSide=bt.shadowSide),bt.depthFunc!==void 0&&(ft.depthFunc=bt.depthFunc),bt.depthTest!==void 0&&(ft.depthTest=bt.depthTest),bt.depthWrite!==void 0&&(ft.depthWrite=bt.depthWrite),bt.colorWrite!==void 0&&(ft.colorWrite=bt.colorWrite),bt.vertexColors!==void 0&&(ft.vertexColors=bt.vertexColors),bt.alphaTest!==void 0&&(ft.alphaTest=bt.alphaTest),bt.alphaHash!==void 0&&(ft.alphaHash=bt.alphaHash),bt.envMapIntensity!==void 0&&(ft.envMapIntensity=bt.envMapIntensity),bt.wireframe!==void 0&&(ft.wireframe=bt.wireframe),bt.wireframeLinewidth!==void 0&&(ft.wireframeLinewidth=bt.wireframeLinewidth),bt.wireframeLinecap!==void 0&&(ft.wireframeLinecap=bt.wireframeLinecap),bt.wireframeLinejoin!==void 0&&(ft.wireframeLinejoin=bt.wireframeLinejoin),bt.rotation!==void 0&&(ft.rotation=bt.rotation),bt.polygonOffset!==void 0&&(ft.polygonOffset=bt.polygonOffset),bt.polygonOffsetFactor!==void 0&&(ft.polygonOffsetFactor=bt.polygonOffsetFactor),bt.polygonOffsetUnits!==void 0&&(ft.polygonOffsetUnits=bt.polygonOffsetUnits),bt.dithering!==void 0&&(ft.dithering=bt.dithering),bt.alphaToCoverage!==void 0&&(ft.alphaToCoverage=bt.alphaToCoverage),bt.premultipliedAlpha!==void 0&&(ft.premultipliedAlpha=bt.premultipliedAlpha),bt.toneMapped!==void 0&&(ft.toneMapped=bt.toneMapped),bt.normalScale!==void 0&&ft.normalScale!==void 0&&(Array.isArray(bt.normalScale)?ft.normalScale.fromArray(bt.normalScale):typeof bt.normalScale=="number"?ft.normalScale.set(bt.normalScale,bt.normalScale):o.console.warn("normalScale is not an array or number",bt.normalScale)),bt.reflectivity!==void 0&&(ft.reflectivity=bt.reflectivity),Object.entries(bt).forEach(([xt,St])=>{xt.startsWith("_")||St&&St.resource&&typeof St.resource=="string"&&(ft[xt]=deserializeObject(St,ft[xt],!1,lt))}),delete ft.userData.gltfExtensions[webgiMaterialExtrasExtension])}),nt&&delete it.userData.gltfExtensions[webgiMaterialExtrasExtension]}}}),gltfLightExtrasParser=h=>o=>({name:"__"+webgiLightExtrasExtension,afterRoot:async c=>{(c.scenes||(c.scene?[c.scene]:[])).forEach(d=>{d.traverse(_=>{var v,b;if(!_.isLight)return;const tt=(b=(v=_.userData)===null||v===void 0?void 0:v.gltfExtensions)===null||b===void 0?void 0:b[webgiLightExtrasExtension];tt&&(!_.shadow&&tt.shadow&&console.error("Light has no shadow, cannot import",_,tt),tt.shadow&&_.shadow&&(tt.shadow.bias!==void 0&&(_.shadow.bias=tt.shadow.bias),tt.shadow.normalBias!==void 0&&(_.shadow.normalBias=tt.shadow.normalBias),tt.shadow.radius!==void 0&&(_.shadow.radius=tt.shadow.radius),tt.shadow.mapSize!==void 0&&_.shadow.mapSize.fromArray(tt.shadow.mapSize),tt.shadow.camera!==void 0&&(_.shadow.camera=h.parseObject(tt.shadow.camera))),delete _.userData.gltfExtensions[webgiLightExtrasExtension])})})}});async function importViewer(h,o,c,d){var _,v,b;if(!d){const ut=h.json.scenes||[];if(ut.length!==1){for(const ht of ut)await importViewer(h,o,c,ht);return}d=ut[0]}const tt=(_=d.extensions)===null||_===void 0?void 0:_[viewerGLTFExtension];if(!tt)return;const it=[];Object.values(tt.resources).forEach(ut=>{Object.values(ut).forEach(ht=>{ht.url&&(ht.url.type==="Uint16Array"&&ht.url.data&&it.push(ht.url),ht.url.type==="Uint8Array"&&ht.url.data&&it.push(ht.url))})});for(const ut of it){const ht=ut.data.image,_t=h.json.images[ht],ft=await h.getDependency("bufferView",_t.bufferView);if(_t.mimeType.startsWith("image/")&&ut.type==="Uint16Array"&&ut.encoding==="rgbe"){const bt=new Blob([ft]);let xt=URL.createObjectURL(bt);(ut.encodingVersion||1)<2&&(xt="data:image/png;base64,"+btoa(await bt.text())),ut.data=(await new RGBEPNGLoader().parseAsync(xt,void 0,!0)).data,URL.revokeObjectURL(xt),delete ut.encoding,delete ut.encodingVersion}else ut.data=ft}const nt={textures:{},materials:{}},lt=tt.resources;if(lt.textures&&h.json.textures)for(const[ut,ht]of[...Object.entries(lt.textures)]){if(ht.uuid||!ut)continue;delete lt.textures[ut];const _t=h.json.textures.findIndex(ft=>{var bt,xt,St,wt,Pt,Rt,kt;return((bt=ft.extras)===null||bt===void 0?void 0:bt.uuid)===ut||((wt=(St=(xt=h.json.samplers)===null||xt===void 0?void 0:xt[ft.sampler])===null||St===void 0?void 0:St.extras)===null||wt===void 0?void 0:wt.uuid)===ut||((kt=(Rt=(Pt=h.json.images)===null||Pt===void 0?void 0:Pt[ft.source])===null||Rt===void 0?void 0:Rt.extras)===null||kt===void 0?void 0:kt.t_uuid)===ut});_t>=0&&(nt.textures[ut]=await h.getDependency("texture",_t))}if(lt.materials&&h.json.materials)for(const[ut,ht]of[...Object.entries(lt.materials)]){if(ht.uuid||!ut)continue;delete lt.materials[ut];const _t=h.json.materials.findIndex(ft=>{var bt;return((bt=ft.extras)===null||bt===void 0?void 0:bt.uuid)===ut});_t>=0&&(nt.materials[ut]=await h.getDependency("material",_t),nt.materials[ut]=(b=(v=o.getPlugin(AssetManagerPlugin))===null||v===void 0?void 0:v.materials)===null||b===void 0?void 0:b.processMaterial(nt.materials[ut],{}))}return tt.resources=await o.getPlugin(AssetManagerPlugin).importConfigResources(lt||{},c,nt),tt}class GLTFMaterialsBumpMapExtension{constructor(o){this.parser=o,this.name=GLTFMaterialsBumpMapExtensionName}async extendMaterialParams(o,c){const d=this.parser,_=d.json.materials[o];if(!_.extensions||!_.extensions[this.name])return Promise.resolve();const v=[],b=_.extensions[this.name];return b.bumpScale!==void 0&&(c.bumpScale=b.bumpScale),b.bumpTexture!==void 0&&v.push(d.assignTexture(c,"bumpMap",b.bumpTexture)),Promise.all(v)}}class GLTFMaterialsDisplacementMapExtension{constructor(o){this.parser=o,this.name=GLTFMaterialsDisplacementMapExtensionName}async extendMaterialParams(o,c){const d=this.parser,_=d.json.materials[o];if(!_.extensions||!_.extensions[this.name])return Promise.resolve();const v=[],b=_.extensions[this.name];return b.displacementScale!==void 0&&(c.displacementScale=b.displacementScale),b.displacementBias!==void 0&&(c.displacementBias=b.displacementBias),b.displacementTexture!==void 0&&v.push(d.assignTexture(c,"displacementMap",b.displacementTexture)),Promise.all(v)}}class GLTFMaterialsLightMapExtension{constructor(o){this.parser=o,this.name=GLTFMaterialsLightMapExtensionName}async extendMaterialParams(o,c){const d=this.parser,_=d.json.materials[o];if(!_.extensions||!_.extensions[this.name])return Promise.resolve();const v=[],b=_.extensions[this.name];return b.lightMapIntensity!==void 0&&(c.lightMapIntensity=b.lightMapIntensity),b.lightMapTexture!==void 0&&v.push(d.assignTexture(c,"lightMap",b.lightMapTexture)),Promise.all(v)}}class GLTFMaterialsAlphaMapExtension{constructor(o){this.parser=o,this.name=GLTFMaterialsAlphaMapExtensionName}async extendMaterialParams(o,c){const d=this.parser,_=d.json.materials[o];if(!_.extensions||!_.extensions[this.name])return Promise.resolve();const v=[],b=_.extensions[this.name];return b.alphaTexture!==void 0&&v.push(d.assignTexture(c,"alphaMap",b.alphaTexture)),Promise.all(v)}}var DRACOLoader2=__webpackgi_require__(957);function addDracoLoader(){return new Importer(DRACOLoader2.Z,["drc"],!0)}class DirectionalLight2 extends three_module.ZyN{get lightObject(){return this}get modelObject(){return this}constructor(o,c){super(),this.assetType="light",this.isDirectionalLight2=!0,this.color=new three_module.Q1f(o),this.intensity=c||1,this.target.position.set(0,0,-1),this.add(this.target)}copy(o,c){const d=this.target,_=o.userData;return o.userData={},super.copy(o,c),copyObject3DUserData(this.userData,_),d.position.copy(this.target.position),d.updateMatrixWorld(),this.target=d,this}get uiConfig(){return this._uiConfig?this._uiConfig:this._uiConfig={type:"folder",label:"Directional Light",children:[{type:"checkbox",label:"Enabled",property:[this,"visible"]},{type:"color",label:"Color",property:[this,"color"]},{type:"slider",label:"Intensity",bounds:[0,40],property:[this,"intensity"]},{type:"vec3",label:"Rotation",property:[this,"rotation"]},{type:"vec3",label:"Position",property:[this,"position"]},{type:"checkbox",label:"Shadow Enabled",property:[this,"castShadow"]},{type:"vec2",label:"Shadow Map Size",property:[this==null?void 0:this.shadow,"mapSize"],onChange:()=>{var o,c;(o=this.shadow.map)===null||o===void 0||o.dispose(),(c=this.shadow.mapPass)===null||c===void 0||c.dispose(),this.shadow.map=null,this.shadow.mapPass=null}},{type:"slider",bounds:[-.001,.001],stepSize:2e-5,label:"Shadow Bias",property:[this==null?void 0:this.shadow,"bias"],onChange:this.setDirty},{type:"slider",bounds:[-.1,.1],stepSize:.005,label:"Shadow Normal Bias",property:[this==null?void 0:this.shadow,"normalBias"],onChange:this.setDirty},{type:"slider",bounds:[0,5],label:"Shadow radius",property:[this==null?void 0:this.shadow,"radius"],onChange:this.setDirty},{type:"slider",bounds:[.1,50],label:"Shadow frustum",getValue:()=>2*this.shadow.camera.right,setValue:o=>{this.shadow.camera.left=-o/2,this.shadow.camera.right=o/2,this.shadow.camera.top=o/2,this.shadow.camera.bottom=-o/2},onChange:this.setDirty}]}}toJSON(o){const{userData:c,children:d}=this;this.userData={},this.children=[];const _=super.toJSON(o);return _.userData=serializeObject(copyObject3DUserData({},c),!1),this.userData=c,this.children=d,_.type="DirectionalLight2",_.target=this.target.position.toArray(),Object.assign(_,serializeObject(this,!0,o))}fromJSON(o,c){if(o.type!=="DirectionalLight2")return null;const d=o.target,_=o.object;return o.target&&(this.target.position.fromArray(o.target),this.target.updateMatrixWorld(),delete o.target),o.object&&delete o.object,deserializeObject(o,this,!0,c),d&&(o.target=d),_&&(_.color!==void 0&&this.color.set(_.color),_.intensity!==void 0&&(this.intensity=_.intensity),o.object=_),this}}class SpotLight2 extends three_module.nCl{get lightObject(){return this}get modelObject(){return this}constructor(o,c,d,_,v,b){super(o,c,d,_,v,b),this.assetType="light",this.target.position.set(0,0,-1),this.add(this.target)}copy(o,c){const d=this.target,_=o.userData;return o.userData={},super.copy(o,c),copyObject3DUserData(this.userData,_),d.position.copy(this.target.position),d.updateMatrixWorld(),this.target=d,this}get uiConfig(){return this._uiConfig?this._uiConfig:this._uiConfig={type:"folder",label:"Spot Light",children:[{type:"checkbox",label:"Enabled",property:[this,"visible"]},{type:"color",label:"Color",property:[this,"color"]},{type:"slider",label:"Intensity",bounds:[0,30],property:[this,"intensity"]},{type:"slider",bounds:[0,2],property:[this,"angle"]},{type:"slider",bounds:[0,.9999],property:[this,"penumbra"]},{type:"vec3",label:"Rotation",property:[this,"rotation"]},{type:"vec3",label:"Position",property:[this,"position"]},{type:"checkbox",label:"Shadow Enabled",property:[this,"castShadow"]},{type:"vec2",label:"Shadow Map Size",property:[this==null?void 0:this.shadow,"mapSize"],onChange:()=>{var o,c;(o=this.shadow.map)===null||o===void 0||o.dispose(),(c=this.shadow.mapPass)===null||c===void 0||c.dispose(),this.shadow.map=null,this.shadow.mapPass=null}},{type:"slider",bounds:[-.001,.001],stepSize:2e-5,label:"Shadow Bias",property:[this==null?void 0:this.shadow,"bias"],onChange:this.setDirty},{type:"slider",bounds:[0,5],label:"Shadow radius",property:[this==null?void 0:this.shadow,"radius"],onChange:this.setDirty}]}}toJSON(o){const{userData:c,children:d}=this;this.userData={},this.children=[];const _=super.toJSON(o);return _.userData=serializeObject(copyObject3DUserData({},c),!1),this.userData=c,this.children=d,_.type="SpotLight2",_.target=this.target.position.toArray(),Object.assign(_,serializeObject(this,!0,o))}fromJSON(o,c){return o.type!=="SpotLight2"?null:(o.target&&(this.target.position.fromArray(o.target),this.target.updateMatrixWorld()),o.object?(o.object.color!==void 0&&this.color.set(o.object.color),o.object.intensity!==void 0&&(this.intensity=o.object.intensity),o.object.distance!==void 0&&(this.distance=o.object.distance),o.object.angle!==void 0&&(this.angle=o.object.angle),o.object.decay!==void 0&&(this.decay=o.object.decay),o.object.penumbra!==void 0&&(this.penumbra=o.object.penumbra),deserializeObject(o,this,!0,c),this):this)}}class PointLight2 extends three_module.HiM{get lightObject(){return this}get modelObject(){return this}constructor(o,c,d,_){super(o,c,d,_),this.assetType="light"}copy(o,c){const d=o.userData;return o.userData={},super.copy(o,c),copyObject3DUserData(this.userData,d),this}get uiConfig(){return this._uiConfig?this._uiConfig:this._uiConfig={type:"folder",label:"Point Light",children:[{type:"checkbox",label:"Enabled",property:[this,"visible"]},{type:"color",label:"Color",property:[this,"color"]},{type:"slider",label:"Intensity",bounds:[0,20],property:[this,"intensity"]},{type:"input",label:"Distance",property:[this,"distance"]},{type:"input",property:[this,"decay"]},{type:"vec3",label:"Position",property:[this,"position"]},{type:"checkbox",label:"Shadow Enabled",property:[this,"castShadow"]},{type:"vec2",label:"Shadow Map Size",property:[this==null?void 0:this.shadow,"mapSize"],onChange:()=>{var o,c;(o=this.shadow.map)===null||o===void 0||o.dispose(),(c=this.shadow.mapPass)===null||c===void 0||c.dispose(),this.shadow.map=null,this.shadow.mapPass=null}},{type:"slider",bounds:[-.001,.001],stepSize:2e-5,label:"Shadow Bias",property:[this==null?void 0:this.shadow,"bias"],onChange:this.setDirty},{type:"slider",bounds:[0,5],label:"Shadow radius",property:[this==null?void 0:this.shadow,"radius"],onChange:this.setDirty}]}}toJSON(o){const{userData:c}=this;this.userData={};const d=super.toJSON(o);return d.userData=serializeObject(copyObject3DUserData({},c),!1),this.userData=c,d.type="PointLight2",Object.assign(d,serializeObject(this,!0,o))}fromJSON(o,c){return o.type!=="PointLight2"?null:o.object?(o.object.color!==void 0&&this.color.set(o.object.color),o.object.intensity!==void 0&&(this.intensity=o.object.intensity),o.object.distance!==void 0&&(this.distance=o.object.distance),o.object.decay!==void 0&&(this.decay=o.object.decay),deserializeObject(o,this,!0,c),this):this}}class AmbientLight2 extends three_module.$p8{get lightObject(){return this}get modelObject(){return this}constructor(o,c){super(o,c),this.assetType="light"}copy(o,c){const d=o.userData;return o.userData={},super.copy(o,c),copyObject3DUserData(this.userData,d),this}get uiConfig(){return this._uiConfig?this._uiConfig:this._uiConfig={type:"folder",label:"Ambient Light",children:[{type:"checkbox",label:"Enabled",property:[this,"visible"]},{type:"color",label:"Color",property:[this,"color"]},{type:"slider",label:"Intensity",bounds:[0,20],property:[this,"intensity"]}]}}toJSON(o){const{userData:c}=this;this.userData={};const d=super.toJSON(o);return d.userData=serializeObject(copyObject3DUserData({},c),!1),this.userData=c,d.type="AmbientLight2",Object.assign(d,serializeObject(this,!0,o))}fromJSON(o,c){return o.type!=="AmbientLight2"?null:o.object?(o.object.color!==void 0&&this.color.set(o.object.color),o.object.intensity!==void 0&&(this.intensity=o.object.intensity),deserializeObject(o,this,!0,c),this):this}}class LUTCubeLoader extends three_module.aHM{load(o,c,d,_){const v=new three_module.Y9S(this.manager);v.setPath(this.path),v.setResponseType("text"),v.load(o,b=>{try{c(this.parse(b))}catch(tt){_?_(tt):console.error(tt),this.manager.itemError(o)}},d,_)}parse(o){o=o.replace(/^#.*?(\n|\r)/gm,"").replace(/^\s*?(\n|\r)/gm,"").trim();let c=null,d=null;const _=new three_module.Pq0(0,0,0),v=new three_module.Pq0(1,1,1),b=o.split(/[\n\r]+/g);let tt=null,it=0;for(let ut=0,ht=b.length;ut<ht;ut++){const _t=b[ut].trim(),ft=_t.split(/\s/g);switch(ft[0]){case"TITLE":c=_t.substring(7,_t.length-1);break;case"LUT_3D_SIZE":const bt=ft[1];d=parseFloat(bt),tt=new Uint8Array(d*d*d*4);break;case"DOMAIN_MIN":_.x=parseFloat(ft[1]),_.y=parseFloat(ft[2]),_.z=parseFloat(ft[3]);break;case"DOMAIN_MAX":v.x=parseFloat(ft[1]),v.y=parseFloat(ft[2]),v.z=parseFloat(ft[3]);break;default:const xt=parseFloat(ft[0]),St=parseFloat(ft[1]),wt=parseFloat(ft[2]);if(xt>1||xt<0||St>1||St<0||wt>1||wt<0)throw new Error("LUTCubeLoader : Non normalized values not supported.");tt[it+0]=255*xt,tt[it+1]=255*St,tt[it+2]=255*wt,tt[it+3]=255,it+=4}}const nt=new three_module.GYF;nt.image.data=tt,nt.image.width=d,nt.image.height=d*d,nt.type=three_module.OUM,nt.magFilter=three_module.k6q,nt.minFilter=three_module.k6q,nt.wrapS=three_module.ghU,nt.wrapT=three_module.ghU,nt.generateMipmaps=!1,nt.needsUpdate=!0;const lt=new three_module.dYF;return lt.image.data=tt,lt.image.width=d,lt.image.height=d,lt.image.depth=d,lt.type=three_module.OUM,lt.magFilter=three_module.k6q,lt.minFilter=three_module.k6q,lt.wrapS=three_module.ghU,lt.wrapT=three_module.ghU,lt.wrapR=three_module.ghU,lt.generateMipmaps=!1,lt.needsUpdate=!0,{title:c,size:d,domainMin:_,domainMax:v,texture:nt,texture3D:lt}}}var LUTCubeLoader2_decorate=function(h,o,c,d){var _,v=arguments.length,b=v<3?o:d===null?d=Object.getOwnPropertyDescriptor(o,c):d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(h,o,c,d);else for(var tt=h.length-1;tt>=0;tt--)(_=h[tt])&&(b=(v<3?_(b):v>3?_(o,c,b):_(o,c))||b);return v>3&&b&&Object.defineProperty(o,c,b),b};let LUTCubeTextureWrapper=class{constructor({domainMax:h,domainMin:o,size:c,texture:d,texture3D:_,title:v}){this.userData={},this.type="LUTCubeTextureWrapper",this.assetType="lutTexture",this.domainMax=h,this.domainMin=o,this.size=c,this.texture=d,this.texture3D=_,this.title=v,this.uuid=three_module.cj9.generateUUID(),this.userData.__needsSourceBuffer=!0}fromJSON(h,o){return h.type!==this.type&&console.warn("WebGi LUTCubeLoader2: type mismatch while import",h,this),console.error("not supported"),this}toJSON(h){return serializeTextureInExtras(this,h,this.texture.name)}};LUTCubeTextureWrapper=LUTCubeLoader2_decorate([serializable("LUTCubeTextureWrapper")],LUTCubeTextureWrapper);class LUTCubeLoader2 extends LUTCubeLoader{parse(o){const c=super.parse(o);return new LUTCubeTextureWrapper(c)}}var ch2={},wk$1=function(h,o,c,d,_){var v=new Worker(ch2[o]||(ch2[o]=URL.createObjectURL(new Blob([h],{type:"text/javascript"}))));return v.onerror=function(b){return _(b.error,null)},v.onmessage=function(b){return _(null,b.data)},v.postMessage(c,d),v},u8=Uint8Array,u16=Uint16Array,u32=Uint32Array,fleb=new u8([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),fdeb=new u8([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),clim=new u8([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),freb=function(h,o){for(var c=new u16(31),d=0;d<31;++d)c[d]=o+=1<<h[d-1];var _=new u32(c[30]);for(d=1;d<30;++d)for(var v=c[d];v<c[d+1];++v)_[v]=v-c[d]<<5|d;return[c,_]},_a=freb(fleb,2),fl$1=_a[0],revfl=_a[1];fl$1[28]=258,revfl[258]=28;for(var _b=freb(fdeb,0),fd$1=_b[0],revfd=_b[1],rev=new u16(32768),browser_i=0;browser_i<32768;++browser_i){var browser_x=(43690&browser_i)>>>1|(21845&browser_i)<<1;browser_x=(52428&browser_x)>>>2|(13107&browser_x)<<2,browser_x=(61680&browser_x)>>>4|(3855&browser_x)<<4,rev[browser_i]=((65280&browser_x)>>>8|(255&browser_x)<<8)>>>1}for(var hMap=function(o,c,d){for(var _=o.length,v=0,b=new u16(c);v<_;++v)++b[o[v]-1];var tt,it=new u16(c);for(v=0;v<c;++v)it[v]=it[v-1]+b[v-1]<<1;if(d){tt=new u16(1<<c);var nt=15-c;for(v=0;v<_;++v)if(o[v])for(var lt=v<<4|o[v],ut=c-o[v],ht=it[o[v]-1]++<<ut,_t=ht|(1<<ut)-1;ht<=_t;++ht)tt[rev[ht]>>>nt]=lt}else for(tt=new u16(_),v=0;v<_;++v)o[v]&&(tt[v]=rev[it[o[v]-1]++]>>>15-o[v]);return tt},flt=new u8(288),browser_i=0;browser_i<144;++browser_i)flt[browser_i]=8;for(var browser_i=144;browser_i<256;++browser_i)flt[browser_i]=9;for(var browser_i=256;browser_i<280;++browser_i)flt[browser_i]=7;for(var browser_i=280;browser_i<288;++browser_i)flt[browser_i]=8;for(var fdt=new u8(32),browser_i=0;browser_i<32;++browser_i)fdt[browser_i]=5;var flm=hMap(flt,9,0),flrm=hMap(flt,9,1),fdm=hMap(fdt,5,0),fdrm=hMap(fdt,5,1),max=function(h){for(var o=h[0],c=1;c<h.length;++c)h[c]>o&&(o=h[c]);return o},bits=function(h,o,c){var d=o/8|0;return(h[d]|h[d+1]<<8)>>(7&o)&c},bits16=function(h,o){var c=o/8|0;return(h[c]|h[c+1]<<8|h[c+2]<<16)>>(7&o)},shft=function(h){return(h/8|0)+(7&h&&1)},slc=function(h,o,c){(o==null||o<0)&&(o=0),(c==null||c>h.length)&&(c=h.length);var d=new(h instanceof u16?u16:h instanceof u32?u32:u8)(c-o);return d.set(h.subarray(o,c)),d},inflt=function(h,o,c){var d=h.length;if(!d||c&&!c.l&&d<5)return o||new u8(0);var _=!o||c,v=!c||c.i;c||(c={}),o||(o=new u8(3*d));var b=function(dr){var Ir=o.length;if(dr>Ir){var Xr=new u8(Math.max(2*Ir,dr));Xr.set(o),o=Xr}},tt=c.f||0,it=c.p||0,nt=c.b||0,lt=c.l,ut=c.d,ht=c.m,_t=c.n,ft=8*d;do{if(!lt){c.f=tt=bits(h,it,1);var bt=bits(h,it+1,3);if(it+=3,!bt){var xt=h[(Kt=shft(it)+4)-4]|h[Kt-3]<<8,St=Kt+xt;if(St>d){if(v)throw"unexpected EOF";break}_&&b(nt+xt),o.set(h.subarray(Kt,St),nt),c.b=nt+=xt,c.p=it=8*St;continue}if(bt==1)lt=flrm,ut=fdrm,ht=9,_t=5;else{if(bt!=2)throw"invalid block type";var wt=bits(h,it,31)+257,Pt=bits(h,it+10,15)+4,Rt=wt+bits(h,it+5,31)+1;it+=14;for(var kt=new u8(Rt),Gt=new u8(19),Dt=0;Dt<Pt;++Dt)Gt[clim[Dt]]=bits(h,it+3*Dt,7);it+=3*Pt;var It=max(Gt),Nt=(1<<It)-1,Vt=hMap(Gt,It,1);for(Dt=0;Dt<Rt;){var Kt,Yt=Vt[bits(h,it,Nt)];if(it+=15&Yt,(Kt=Yt>>>4)<16)kt[Dt++]=Kt;else{var nr=0,rr=0;for(Kt==16?(rr=3+bits(h,it,3),it+=2,nr=kt[Dt-1]):Kt==17?(rr=3+bits(h,it,7),it+=3):Kt==18&&(rr=11+bits(h,it,127),it+=7);rr--;)kt[Dt++]=nr}}var lr=kt.subarray(0,wt),or=kt.subarray(wt);ht=max(lr),_t=max(or),lt=hMap(lr,ht,1),ut=hMap(or,_t,1)}if(it>ft){if(v)throw"unexpected EOF";break}}_&&b(nt+131072);for(var pr=(1<<ht)-1,hr=(1<<_t)-1,ur=it;;ur=it){var cr=(nr=lt[bits16(h,it)&pr])>>>4;if((it+=15&nr)>ft){if(v)throw"unexpected EOF";break}if(!nr)throw"invalid length/literal";if(cr<256)o[nt++]=cr;else{if(cr==256){ur=it,lt=null;break}var br=cr-254;if(cr>264){var fr=fleb[Dt=cr-257];br=bits(h,it,(1<<fr)-1)+fl$1[Dt],it+=fr}var kr=ut[bits16(h,it)&hr],gr=kr>>>4;if(!kr)throw"invalid distance";if(it+=15&kr,or=fd$1[gr],gr>3&&(fr=fdeb[gr],or+=bits16(h,it)&(1<<fr)-1,it+=fr),it>ft){if(v)throw"unexpected EOF";break}_&&b(nt+131072);for(var tr=nt+br;nt<tr;nt+=4)o[nt]=o[nt-or],o[nt+1]=o[nt+1-or],o[nt+2]=o[nt+2-or],o[nt+3]=o[nt+3-or];nt=tr}}c.l=lt,c.p=ur,c.b=nt,lt&&(tt=1,c.m=ht,c.d=ut,c.n=_t)}while(!tt);return nt==o.length?o:slc(o,0,nt)},wbits=function(h,o,c){c<<=7&o;var d=o/8|0;h[d]|=c,h[d+1]|=c>>>8},wbits16=function(h,o,c){c<<=7&o;var d=o/8|0;h[d]|=c,h[d+1]|=c>>>8,h[d+2]|=c>>>16},hTree=function(h,o){for(var c=[],d=0;d<h.length;++d)h[d]&&c.push({s:d,f:h[d]});var _=c.length,v=c.slice();if(!_)return[browser_et,0];if(_==1){var b=new u8(c[0].s+1);return b[c[0].s]=1,[b,1]}c.sort(function(kt,Gt){return kt.f-Gt.f}),c.push({s:-1,f:25001});var tt=c[0],it=c[1],nt=0,lt=1,ut=2;for(c[0]={s:-1,f:tt.f+it.f,l:tt,r:it};lt!=_-1;)tt=c[c[nt].f<c[ut].f?nt++:ut++],it=c[nt!=lt&&c[nt].f<c[ut].f?nt++:ut++],c[lt++]={s:-1,f:tt.f+it.f,l:tt,r:it};var ht=v[0].s;for(d=1;d<_;++d)v[d].s>ht&&(ht=v[d].s);var _t=new u16(ht+1),ft=ln(c[lt-1],_t,0);if(ft>o){d=0;var bt=0,xt=ft-o,St=1<<xt;for(v.sort(function(kt,Gt){return _t[Gt.s]-_t[kt.s]||kt.f-Gt.f});d<_;++d){var wt=v[d].s;if(!(_t[wt]>o))break;bt+=St-(1<<ft-_t[wt]),_t[wt]=o}for(bt>>>=xt;bt>0;){var Pt=v[d].s;_t[Pt]<o?bt-=1<<o-_t[Pt]++-1:++d}for(;d>=0&&bt;--d){var Rt=v[d].s;_t[Rt]==o&&(--_t[Rt],++bt)}ft=o}return[new u8(_t),ft]},ln=function(h,o,c){return h.s==-1?Math.max(ln(h.l,o,c+1),ln(h.r,o,c+1)):o[h.s]=c},lc$1=function(h){for(var o=h.length;o&&!h[--o];);for(var c=new u16(++o),d=0,_=h[0],v=1,b=function(it){c[d++]=it},tt=1;tt<=o;++tt)if(h[tt]==_&&tt!=o)++v;else{if(!_&&v>2){for(;v>138;v-=138)b(32754);v>2&&(b(v>10?v-11<<5|28690:v-3<<5|12305),v=0)}else if(v>3){for(b(_),--v;v>6;v-=6)b(8304);v>2&&(b(v-3<<5|8208),v=0)}for(;v--;)b(_);v=1,_=h[tt]}return[c.subarray(0,d),o]},clen=function(h,o){for(var c=0,d=0;d<o.length;++d)c+=h[d]*o[d];return c},wfblk=function(h,o,c){var d=c.length,_=shft(o+2);h[_]=255&d,h[_+1]=d>>>8,h[_+2]=255^h[_],h[_+3]=255^h[_+1];for(var v=0;v<d;++v)h[_+v+4]=c[v];return 8*(_+4+d)},wblk=function(h,o,c,d,_,v,b,tt,it,nt,lt){wbits(o,lt++,c),++_[256];for(var ut=hTree(_,15),ht=ut[0],_t=ut[1],ft=hTree(v,15),bt=ft[0],xt=ft[1],St=lc$1(ht),wt=St[0],Pt=St[1],Rt=lc$1(bt),kt=Rt[0],Gt=Rt[1],Dt=new u16(19),It=0;It<wt.length;++It)Dt[31&wt[It]]++;for(It=0;It<kt.length;++It)Dt[31&kt[It]]++;for(var Nt=hTree(Dt,7),Vt=Nt[0],Kt=Nt[1],Yt=19;Yt>4&&!Vt[clim[Yt-1]];--Yt);var nr,rr,lr,or,pr=nt+5<<3,hr=clen(_,flt)+clen(v,fdt)+b,ur=clen(_,ht)+clen(v,bt)+b+14+3*Yt+clen(Dt,Vt)+(2*Dt[16]+3*Dt[17]+7*Dt[18]);if(pr<=hr&&pr<=ur)return wfblk(o,lt,h.subarray(it,it+nt));if(wbits(o,lt,1+(ur<hr)),lt+=2,ur<hr){nr=hMap(ht,_t,0),rr=ht,lr=hMap(bt,xt,0),or=bt;var cr=hMap(Vt,Kt,0);for(wbits(o,lt,Pt-257),wbits(o,lt+5,Gt-1),wbits(o,lt+10,Yt-4),lt+=14,It=0;It<Yt;++It)wbits(o,lt+3*It,Vt[clim[It]]);lt+=3*Yt;for(var br=[wt,kt],fr=0;fr<2;++fr){var kr=br[fr];for(It=0;It<kr.length;++It){var gr=31&kr[It];wbits(o,lt,cr[gr]),lt+=Vt[gr],gr>15&&(wbits(o,lt,kr[It]>>>5&127),lt+=kr[It]>>>12)}}}else nr=flm,rr=flt,lr=fdm,or=fdt;for(It=0;It<tt;++It)if(d[It]>255){gr=d[It]>>>18&31,wbits16(o,lt,nr[gr+257]),lt+=rr[gr+257],gr>7&&(wbits(o,lt,d[It]>>>23&31),lt+=fleb[gr]);var tr=31&d[It];wbits16(o,lt,lr[tr]),lt+=or[tr],tr>3&&(wbits16(o,lt,d[It]>>>5&8191),lt+=fdeb[tr])}else wbits16(o,lt,nr[d[It]]),lt+=rr[d[It]];return wbits16(o,lt,nr[256]),lt+rr[256]},deo=new u32([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),browser_et=new u8(0),dflt=function(h,o,c,d,_,v){var b=h.length,tt=new u8(d+b+5*(1+Math.ceil(b/7e3))+_),it=tt.subarray(d,tt.length-_),nt=0;if(!o||b<8)for(var lt=0;lt<=b;lt+=65535){var ut=lt+65535;ut<b?nt=wfblk(it,nt,h.subarray(lt,ut)):(it[lt]=v,nt=wfblk(it,nt,h.subarray(lt,b)))}else{for(var ht=deo[o-1],_t=ht>>>13,ft=8191&ht,bt=(1<<c)-1,xt=new u16(32768),St=new u16(bt+1),wt=Math.ceil(c/3),Pt=2*wt,Rt=function(vn){return(h[vn]^h[vn+1]<<wt^h[vn+2]<<Pt)&bt},kt=new u32(25e3),Gt=new u16(288),Dt=new u16(32),It=0,Nt=0,Vt=(lt=0,0),Kt=0,Yt=0;lt<b;++lt){var nr=Rt(lt),rr=32767&lt,lr=St[nr];if(xt[rr]=lr,St[nr]=rr,Kt<=lt){var or=b-lt;if((It>7e3||Vt>24576)&&or>423){nt=wblk(h,it,0,kt,Gt,Dt,Nt,Vt,Yt,lt-Yt,nt),Vt=It=Nt=0,Yt=lt;for(var pr=0;pr<286;++pr)Gt[pr]=0;for(pr=0;pr<30;++pr)Dt[pr]=0}var hr=2,ur=0,cr=ft,br=rr-lr&32767;if(or>2&&nr==Rt(lt-br))for(var fr=Math.min(_t,or)-1,kr=Math.min(32767,lt),gr=Math.min(258,or);br<=kr&&--cr&&rr!=lr;){if(h[lt+hr]==h[lt+hr-br]){for(var tr=0;tr<gr&&h[lt+tr]==h[lt+tr-br];++tr);if(tr>hr){if(hr=tr,ur=br,tr>fr)break;var dr=Math.min(br,tr-2),Ir=0;for(pr=0;pr<dr;++pr){var Xr=lt-br+pr+32768&32767,Jr=Xr-xt[Xr]+32768&32767;Jr>Ir&&(Ir=Jr,lr=Xr)}}}br+=(rr=lr)-(lr=xt[rr])+32768&32767}if(ur){kt[Vt++]=268435456|revfl[hr]<<18|revfd[ur];var on=31&revfl[hr],Pn=31&revfd[ur];Nt+=fleb[on]+fdeb[Pn],++Gt[257+on],++Dt[Pn],Kt=lt+hr,++It}else kt[Vt++]=h[lt],++Gt[h[lt]]}}nt=wblk(h,it,v,kt,Gt,Dt,Nt,Vt,Yt,lt-Yt,nt),!v&&7&nt&&(nt=wfblk(it,nt+1,browser_et))}return slc(tt,0,d+shft(nt)+_)},crct=function(){for(var h=new Int32Array(256),o=0;o<256;++o){for(var c=o,d=9;--d;)c=(1&c&&-306674912)^c>>>1;h[o]=c}return h}(),crc=function(){var h=-1;return{p:function(o){for(var c=h,d=0;d<o.length;++d)c=crct[255&c^o[d]]^c>>>8;h=c},d:function(){return~h}}},adler=function(){var h=1,o=0;return{p:function(c){for(var d=h,_=o,v=c.length,b=0;b!=v;){for(var tt=Math.min(b+2655,v);b<tt;++b)_+=d+=c[b];d=(65535&d)+15*(d>>16),_=(65535&_)+15*(_>>16)}h=d,o=_},d:function(){return(255&(h%=65521))<<24|h>>>8<<16|(255&(o%=65521))<<8|o>>>8}}},dopt=function(h,o,c,d,_){return dflt(h,o.level==null?6:o.level,o.mem==null?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(h.length)))):12+o.mem,c,d,!_)},mrg=function(h,o){var c={};for(var d in h)c[d]=h[d];for(var d in o)c[d]=o[d];return c},wcln=function(h,o,c){for(var d=h(),_=h.toString(),v=_.slice(_.indexOf("[")+1,_.lastIndexOf("]")).replace(/ /g,"").split(","),b=0;b<d.length;++b){var tt=d[b],it=v[b];if(typeof tt=="function"){o+=";"+it+"=";var nt=tt.toString();if(tt.prototype)if(nt.indexOf("[native code]")!=-1){var lt=nt.indexOf(" ",8)+1;o+=nt.slice(lt,nt.indexOf("(",lt))}else for(var ut in o+=nt,tt.prototype)o+=";"+it+".prototype."+ut+"="+tt.prototype[ut].toString();else o+=nt}else c[it]=tt}return[o,c]},ch$1=[],cbfs=function(h){var o=[];for(var c in h)(h[c]instanceof u8||h[c]instanceof u16||h[c]instanceof u32)&&o.push((h[c]=new h[c].constructor(h[c])).buffer);return o},wrkr=function(h,o,c,d){var _;if(!ch$1[c]){for(var v="",b={},tt=h.length-1,it=0;it<tt;++it)v=(_=wcln(h[it],v,b))[0],b=_[1];ch$1[c]=wcln(h[tt],v,b)}var nt=mrg({},ch$1[c][1]);return wk$1(ch$1[c][0]+";onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage="+o.toString()+"}",c,nt,cbfs(nt),d)},bInflt=function(){return[u8,u16,u32,fleb,fdeb,clim,fl$1,fd$1,flrm,fdrm,rev,hMap,max,bits,bits16,shft,slc,inflt,inflateSync,pbf,gu8]},bDflt=function(){return[u8,u16,u32,fleb,fdeb,clim,revfl,revfd,flm,flt,fdm,fdt,rev,deo,browser_et,hMap,wbits,wbits16,hTree,ln,lc$1,clen,wfblk,wblk,shft,slc,dflt,dopt,deflateSync,pbf]},gze=function(){return[gzh,gzhl,wbytes,crc,crct]},guze=function(){return[gzs,gzl]},zle=function(){return[zlh,wbytes,adler]},zule=function(){return[zlv]},pbf=function(h){return postMessage(h,[h.buffer])},gu8=function(h){return h&&h.size&&new u8(h.size)},cbify=function(h,o,c,d,_,v){var b=wrkr(c,d,_,function(tt,it){b.terminate(),v(tt,it)});return b.postMessage([h,o],o.consume?[h.buffer]:[]),function(){b.terminate()}},astrm=function(h){return h.ondata=function(o,c){return postMessage([o,c],[o.buffer])},function(o){return h.push(o.data[0],o.data[1])}},astrmify=function(h,o,c,d,_){var v,b=wrkr(h,d,_,function(tt,it){tt?(b.terminate(),o.ondata.call(o,tt)):(it[1]&&b.terminate(),o.ondata.call(o,tt,it[0],it[1]))});b.postMessage(c),o.push=function(tt,it){if(v)throw"stream finished";if(!o.ondata)throw"no stream handler";b.postMessage([tt,v=it],[tt.buffer])},o.terminate=function(){b.terminate()}},b2=function(h,o){return h[o]|h[o+1]<<8},b4=function(h,o){return(h[o]|h[o+1]<<8|h[o+2]<<16|h[o+3]<<24)>>>0},b8=function(h,o){return b4(h,o)+4294967296*b4(h,o+4)},wbytes=function(h,o,c){for(;c;++o)h[o]=c,c>>>=8},gzh=function(h,o){var c=o.filename;if(h[0]=31,h[1]=139,h[2]=8,h[8]=o.level<2?4:o.level==9?2:0,h[9]=3,o.mtime!=0&&wbytes(h,4,Math.floor(new Date(o.mtime||Date.now())/1e3)),c){h[3]=8;for(var d=0;d<=c.length;++d)h[d+10]=c.charCodeAt(d)}},gzs=function(h){if(h[0]!=31||h[1]!=139||h[2]!=8)throw"invalid gzip data";var o=h[3],c=10;4&o&&(c+=h[10]|2+(h[11]<<8));for(var d=(o>>3&1)+(o>>4&1);d>0;d-=!h[c++]);return c+(2&o)},gzl=function(h){var o=h.length;return(h[o-4]|h[o-3]<<8|h[o-2]<<16|h[o-1]<<24)>>>0},gzhl=function(h){return 10+(h.filename&&h.filename.length+1||0)},zlh=function(h,o){var c=o.level,d=c==0?0:c<6?1:c==9?3:2;h[0]=120,h[1]=d<<6|(d?32-2*d:1)},zlv=function(h){if((15&h[0])!=8||h[0]>>>4>7||(h[0]<<8|h[1])%31)throw"invalid zlib data";if(32&h[1])throw"invalid zlib data: preset dictionaries not supported"};function AsyncCmpStrm(h,o){return o||typeof h!="function"||(o=h,h={}),this.ondata=o,h}var Deflate=function(){function h(o,c){c||typeof o!="function"||(c=o,o={}),this.ondata=c,this.o=o||{}}return h.prototype.p=function(o,c){this.ondata(dopt(o,this.o,0,0,!c),c)},h.prototype.push=function(o,c){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";this.d=c,this.p(o,c||!1)},h}(),AsyncDeflate=function(){return function(h,o){astrmify([bDflt,function(){return[astrm,Deflate]}],this,AsyncCmpStrm.call(this,h,o),function(c){var d=new Deflate(c.data);onmessage=astrm(d)},6)}}();function deflate(h,o,c){if(c||(c=o,o={}),typeof c!="function")throw"no callback";return cbify(h,o,[bDflt],function(d){return pbf(deflateSync(d.data[0],d.data[1]))},0,c)}function deflateSync(h,o){return dopt(h,o||{},0,0)}var Inflate=function(){function h(o){this.s={},this.p=new u8(0),this.ondata=o}return h.prototype.e=function(o){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";var c=this.p.length,d=new u8(c+o.length);d.set(this.p),d.set(o,c),this.p=d},h.prototype.c=function(o){this.d=this.s.i=o||!1;var c=this.s.b,d=inflt(this.p,this.o,this.s);this.ondata(slc(d,c,this.s.b),this.d),this.o=slc(d,this.s.b-32768),this.s.b=this.o.length,this.p=slc(this.p,this.s.p/8|0),this.s.p&=7},h.prototype.push=function(o,c){this.e(o),this.c(c)},h}(),AsyncInflate=function(){return function(h){this.ondata=h,astrmify([bInflt,function(){return[astrm,Inflate]}],this,0,function(){var o=new Inflate;onmessage=astrm(o)},7)}}();function inflate(h,o,c){if(c||(c=o,o={}),typeof c!="function")throw"no callback";return cbify(h,o,[bInflt],function(d){return pbf(inflateSync(d.data[0],gu8(d.data[1])))},1,c)}function inflateSync(h,o){return inflt(h,o)}var Gzip=function(){function h(o,c){this.c=crc(),this.l=0,this.v=1,Deflate.call(this,o,c)}return h.prototype.push=function(o,c){Deflate.prototype.push.call(this,o,c)},h.prototype.p=function(o,c){this.c.p(o),this.l+=o.length;var d=dopt(o,this.o,this.v&&gzhl(this.o),c&&8,!c);this.v&&(gzh(d,this.o),this.v=0),c&&(wbytes(d,d.length-8,this.c.d()),wbytes(d,d.length-4,this.l)),this.ondata(d,c)},h}(),AsyncGzip=function(){return function(h,o){astrmify([bDflt,gze,function(){return[astrm,Deflate,Gzip]}],this,AsyncCmpStrm.call(this,h,o),function(c){var d=new Gzip(c.data);onmessage=astrm(d)},8)}}();function gzip(h,o,c){if(c||(c=o,o={}),typeof c!="function")throw"no callback";return cbify(h,o,[bDflt,gze,function(){return[gzipSync]}],function(d){return pbf(gzipSync(d.data[0],d.data[1]))},2,c)}function gzipSync(h,o){o||(o={});var c=crc(),d=h.length;c.p(h);var _=dopt(h,o,gzhl(o),8),v=_.length;return gzh(_,o),wbytes(_,v-8,c.d()),wbytes(_,v-4,d),_}var Gunzip=function(){function h(o){this.v=1,Inflate.call(this,o)}return h.prototype.push=function(o,c){if(Inflate.prototype.e.call(this,o),this.v){var d=this.p.length>3?gzs(this.p):4;if(d>=this.p.length&&!c)return;this.p=this.p.subarray(d),this.v=0}if(c){if(this.p.length<8)throw"invalid gzip stream";this.p=this.p.subarray(0,-8)}Inflate.prototype.c.call(this,c)},h}(),AsyncGunzip=function(){return function(h){this.ondata=h,astrmify([bInflt,guze,function(){return[astrm,Inflate,Gunzip]}],this,0,function(){var o=new Gunzip;onmessage=astrm(o)},9)}}();function gunzip(h,o,c){if(c||(c=o,o={}),typeof c!="function")throw"no callback";return cbify(h,o,[bInflt,guze,function(){return[gunzipSync]}],function(d){return pbf(gunzipSync(d.data[0]))},3,c)}function gunzipSync(h,o){return inflt(h.subarray(gzs(h),-8),o||new u8(gzl(h)))}var Zlib=function(){function h(o,c){this.c=adler(),this.v=1,Deflate.call(this,o,c)}return h.prototype.push=function(o,c){Deflate.prototype.push.call(this,o,c)},h.prototype.p=function(o,c){this.c.p(o);var d=dopt(o,this.o,this.v&&2,c&&4,!c);this.v&&(zlh(d,this.o),this.v=0),c&&wbytes(d,d.length-4,this.c.d()),this.ondata(d,c)},h}(),AsyncZlib=function(){return function(h,o){astrmify([bDflt,zle,function(){return[astrm,Deflate,Zlib]}],this,AsyncCmpStrm.call(this,h,o),function(c){var d=new Zlib(c.data);onmessage=astrm(d)},10)}}();function zlib(h,o,c){if(c||(c=o,o={}),typeof c!="function")throw"no callback";return cbify(h,o,[bDflt,zle,function(){return[zlibSync]}],function(d){return pbf(zlibSync(d.data[0],d.data[1]))},4,c)}function zlibSync(h,o){o||(o={});var c=adler();c.p(h);var d=dopt(h,o,2,4);return zlh(d,o),wbytes(d,d.length-4,c.d()),d}var Unzlib=function(){function h(o){this.v=1,Inflate.call(this,o)}return h.prototype.push=function(o,c){if(Inflate.prototype.e.call(this,o),this.v){if(this.p.length<2&&!c)return;this.p=this.p.subarray(2),this.v=0}if(c){if(this.p.length<4)throw"invalid zlib stream";this.p=this.p.subarray(0,-4)}Inflate.prototype.c.call(this,c)},h}(),AsyncUnzlib=function(){return function(h){this.ondata=h,astrmify([bInflt,zule,function(){return[astrm,Inflate,Unzlib]}],this,0,function(){var o=new Unzlib;onmessage=astrm(o)},11)}}();function unzlib(h,o,c){if(c||(c=o,o={}),typeof c!="function")throw"no callback";return cbify(h,o,[bInflt,zule,function(){return[unzlibSync]}],function(d){return pbf(unzlibSync(d.data[0],gu8(d.data[1])))},5,c)}function unzlibSync(h,o){return inflt((zlv(h),h.subarray(2,-4)),o)}var Decompress=function(){function h(o){this.G=Gunzip,this.I=Inflate,this.Z=Unzlib,this.ondata=o}return h.prototype.push=function(o,c){if(!this.ondata)throw"no stream handler";if(this.s)this.s.push(o,c);else{if(this.p&&this.p.length){var d=new u8(this.p.length+o.length);d.set(this.p),d.set(o,this.p.length)}else this.p=o;if(this.p.length>2){var _=this,v=function(){_.ondata.apply(_,arguments)};this.s=this.p[0]==31&&this.p[1]==139&&this.p[2]==8?new this.G(v):(15&this.p[0])!=8||this.p[0]>>4>7||(this.p[0]<<8|this.p[1])%31?new this.I(v):new this.Z(v),this.s.push(this.p,c),this.p=null}}},h}(),AsyncDecompress=function(){function h(o){this.G=AsyncGunzip,this.I=AsyncInflate,this.Z=AsyncUnzlib,this.ondata=o}return h.prototype.push=function(o,c){Decompress.prototype.push.call(this,o,c)},h}();function decompress(h,o,c){if(c||(c=o,o={}),typeof c!="function")throw"no callback";return h[0]==31&&h[1]==139&&h[2]==8?gunzip(h,o,c):(15&h[0])!=8||h[0]>>4>7||(h[0]<<8|h[1])%31?inflate(h,o,c):unzlib(h,o,c)}function decompressSync(h,o){return h[0]==31&&h[1]==139&&h[2]==8?gunzipSync(h,o):(15&h[0])!=8||h[0]>>4>7||(h[0]<<8|h[1])%31?inflateSync(h,o):unzlibSync(h,o)}var fltn=function(h,o,c,d){for(var _ in h){var v=h[_],b=o+_;v instanceof u8?c[b]=[v,d]:Array.isArray(v)?c[b]=[v[0],mrg(d,v[1])]:fltn(v,b+"/",c,d)}},browser_te=typeof TextEncoder<"u"&&new TextEncoder,td$1=typeof TextDecoder<"u"&&new TextDecoder,tds=0;try{td$1.decode(browser_et,{stream:!0}),tds=1}catch(h){}var dutf8=function(h){for(var o="",c=0;;){var d=h[c++],_=(d>127)+(d>223)+(d>239);if(c+_>h.length)return[o,slc(h,c-1)];_?_==3?(d=((15&d)<<18|(63&h[c++])<<12|(63&h[c++])<<6|63&h[c++])-65536,o+=String.fromCharCode(55296|d>>10,56320|1023&d)):o+=1&_?String.fromCharCode((31&d)<<6|63&h[c++]):String.fromCharCode((15&d)<<12|(63&h[c++])<<6|63&h[c++]):o+=String.fromCharCode(d)}},DecodeUTF8=function(){function h(o){this.ondata=o,tds?this.t=new TextDecoder:this.p=browser_et}return h.prototype.push=function(o,c){if(!this.ondata)throw"no callback";if(c=!!c,this.t){if(this.ondata(this.t.decode(o,{stream:!0}),c),c){if(this.t.decode().length)throw"invalid utf-8 data";this.t=null}}else{if(!this.p)throw"stream finished";var d=new u8(this.p.length+o.length);d.set(this.p),d.set(o,this.p.length);var _=dutf8(d),v=_[0],b=_[1];if(c){if(b.length)throw"invalid utf-8 data";this.p=null}else this.p=b;this.ondata(v,c)}},h}(),EncodeUTF8=function(){function h(o){this.ondata=o}return h.prototype.push=function(o,c){if(!this.ondata)throw"no callback";if(this.d)throw"stream finished";this.ondata(strToU8(o),this.d=c||!1)},h}();function strToU8(h,o){if(o){for(var c=new u8(h.length),d=0;d<h.length;++d)c[d]=h.charCodeAt(d);return c}if(browser_te)return browser_te.encode(h);var _=h.length,v=new u8(h.length+(h.length>>1)),b=0,tt=function(lt){v[b++]=lt};for(d=0;d<_;++d){if(b+5>v.length){var it=new u8(b+8+(_-d<<1));it.set(v),v=it}var nt=h.charCodeAt(d);nt<128||o?tt(nt):nt<2048?(tt(192|nt>>6),tt(128|63&nt)):nt>55295&&nt<57344?(tt(240|(nt=65536+(1047552&nt)|1023&h.charCodeAt(++d))>>18),tt(128|nt>>12&63),tt(128|nt>>6&63),tt(128|63&nt)):(tt(224|nt>>12),tt(128|nt>>6&63),tt(128|63&nt))}return slc(v,0,b)}function strFromU8(h,o){if(o){for(var c="",d=0;d<h.length;d+=16384)c+=String.fromCharCode.apply(null,h.subarray(d,d+16384));return c}if(td$1)return td$1.decode(h);var _=dutf8(h),v=_[0];if(_[1].length)throw"invalid utf-8 data";return v}var dbf=function(h){return h==1?3:h<6?2:h==9?1:0},slzh=function(h,o){return o+30+b2(h,o+26)+b2(h,o+28)},zh$1=function(h,o,c){var d=b2(h,o+28),_=strFromU8(h.subarray(o+46,o+46+d),!(2048&b2(h,o+8))),v=o+46+d,b=b4(h,o+20),tt=c&&b==4294967295?z64e(h,v):[b,b4(h,o+24),b4(h,o+42)],it=tt[0],nt=tt[1],lt=tt[2];return[b2(h,o+10),it,nt,_,v+b2(h,o+30)+b2(h,o+32),lt]},z64e=function(h,o){for(;b2(h,o)!=1;o+=4+b2(h,o+2));return[b8(h,o+12),b8(h,o+4),b8(h,o+20)]},exfl=function(h){var o=0;if(h)for(var c in h){var d=h[c].length;if(d>65535)throw"extra field too long";o+=d+4}return o},wzh=function(h,o,c,d,_,v,b,tt){var it=d.length,nt=c.extra,lt=tt&&tt.length,ut=exfl(nt);wbytes(h,o,b!=null?33639248:67324752),o+=4,b!=null&&(h[o++]=20,h[o++]=c.os),h[o]=20,o+=2,h[o++]=c.flag<<1|(v==null&&8),h[o++]=_&&8,h[o++]=255&c.compression,h[o++]=c.compression>>8;var ht=new Date(c.mtime==null?Date.now():c.mtime),_t=ht.getFullYear()-1980;if(_t<0||_t>119)throw"date not in range 1980-2099";if(wbytes(h,o,_t<<25|ht.getMonth()+1<<21|ht.getDate()<<16|ht.getHours()<<11|ht.getMinutes()<<5|ht.getSeconds()>>>1),o+=4,v!=null&&(wbytes(h,o,c.crc),wbytes(h,o+4,v),wbytes(h,o+8,c.size)),wbytes(h,o+12,it),wbytes(h,o+14,ut),o+=16,b!=null&&(wbytes(h,o,lt),wbytes(h,o+6,c.attrs),wbytes(h,o+10,b),o+=14),h.set(d,o),o+=it,ut)for(var ft in nt){var bt=nt[ft],xt=bt.length;wbytes(h,o,+ft),wbytes(h,o+2,xt),h.set(bt,o+4),o+=4+xt}return lt&&(h.set(tt,o),o+=lt),o},wzf=function(h,o,c,d,_){wbytes(h,o,101010256),wbytes(h,o+8,c),wbytes(h,o+10,c),wbytes(h,o+12,d),wbytes(h,o+16,_)},ZipPassThrough=function(){function h(o){this.filename=o,this.c=crc(),this.size=0,this.compression=0}return h.prototype.process=function(o,c){this.ondata(null,o,c)},h.prototype.push=function(o,c){if(!this.ondata)throw"no callback - add to ZIP archive before pushing";this.c.p(o),this.size+=o.length,c&&(this.crc=this.c.d()),this.process(o,c||!1)},h}(),ZipDeflate=function(){function h(o,c){var d=this;c||(c={}),ZipPassThrough.call(this,o),this.d=new Deflate(c,function(_,v){d.ondata(null,_,v)}),this.compression=8,this.flag=dbf(c.level)}return h.prototype.process=function(o,c){try{this.d.push(o,c)}catch(d){this.ondata(d,null,c)}},h.prototype.push=function(o,c){ZipPassThrough.prototype.push.call(this,o,c)},h}(),AsyncZipDeflate=function(){function h(o,c){var d=this;c||(c={}),ZipPassThrough.call(this,o),this.d=new AsyncDeflate(c,function(_,v,b){d.ondata(_,v,b)}),this.compression=8,this.flag=dbf(c.level),this.terminate=this.d.terminate}return h.prototype.process=function(o,c){this.d.push(o,c)},h.prototype.push=function(o,c){ZipPassThrough.prototype.push.call(this,o,c)},h}(),Zip=function(){function h(o){this.ondata=o,this.u=[],this.d=1}return h.prototype.add=function(o){var c=this;if(2&this.d)throw"stream finished";var d=strToU8(o.filename),_=d.length,v=o.comment,b=v&&strToU8(v),tt=_!=o.filename.length||b&&v.length!=b.length,it=_+exfl(o.extra)+30;if(_>65535)throw"filename too long";var nt=new u8(it);wzh(nt,0,o,d,tt);var lt=[nt],ut=function(){for(var xt=0,St=lt;xt<St.length;xt++){var wt=St[xt];c.ondata(null,wt,!1)}lt=[]},ht=this.d;this.d=0;var _t=this.u.length,ft=mrg(o,{f:d,u:tt,o:b,t:function(){o.terminate&&o.terminate()},r:function(){if(ut(),ht){var xt=c.u[_t+1];xt?xt.r():c.d=1}ht=1}}),bt=0;o.ondata=function(xt,St,wt){if(xt)c.ondata(xt,St,wt),c.terminate();else if(bt+=St.length,lt.push(St),wt){var Pt=new u8(16);wbytes(Pt,0,134695760),wbytes(Pt,4,o.crc),wbytes(Pt,8,bt),wbytes(Pt,12,o.size),lt.push(Pt),ft.c=bt,ft.b=it+bt+16,ft.crc=o.crc,ft.size=o.size,ht&&ft.r(),ht=1}else ht&&ut()},this.u.push(ft)},h.prototype.end=function(){var o=this;if(2&this.d)throw 1&this.d?"stream finishing":"stream finished";this.d?this.e():this.u.push({r:function(){1&o.d&&(o.u.splice(-1,1),o.e())},t:function(){}}),this.d=3},h.prototype.e=function(){for(var o=0,c=0,d=0,_=0,v=this.u;_<v.length;_++)d+=46+(nt=v[_]).f.length+exfl(nt.extra)+(nt.o?nt.o.length:0);for(var b=new u8(d+22),tt=0,it=this.u;tt<it.length;tt++){var nt=it[tt];wzh(b,o,nt,nt.f,nt.u,nt.c,c,nt.o),o+=46+nt.f.length+exfl(nt.extra)+(nt.o?nt.o.length:0),c+=nt.b}wzf(b,o,this.u.length,d,c),this.ondata(null,b,!0),this.d=2},h.prototype.terminate=function(){for(var o=0,c=this.u;o<c.length;o++)c[o].t();this.d=2},h}();function zip(h,o,c){if(c||(c=o,o={}),typeof c!="function")throw"no callback";var d={};fltn(h,"",d,o);var _=Object.keys(d),v=_.length,b=0,tt=0,it=v,nt=new Array(v),lt=[],ut=function(){for(var bt=0;bt<lt.length;++bt)lt[bt]()},ht=function(){var bt=new u8(tt+22),xt=b,St=tt-b;tt=0;for(var wt=0;wt<it;++wt){var Pt=nt[wt];try{var Rt=Pt.c.length;wzh(bt,tt,Pt,Pt.f,Pt.u,Rt);var kt=30+Pt.f.length+exfl(Pt.extra),Gt=tt+kt;bt.set(Pt.c,Gt),wzh(bt,b,Pt,Pt.f,Pt.u,Rt,tt,Pt.m),b+=16+kt+(Pt.m?Pt.m.length:0),tt=Gt+Rt}catch(Dt){return c(Dt,null)}}wzf(bt,b,nt.length,St,xt),c(null,bt)};v||ht();for(var _t=function(bt){var xt=_[bt],St=d[xt],wt=St[0],Pt=St[1],Rt=crc(),kt=wt.length;Rt.p(wt);var Gt=strToU8(xt),Dt=Gt.length,It=Pt.comment,Nt=It&&strToU8(It),Vt=Nt&&Nt.length,Kt=exfl(Pt.extra),Yt=Pt.level==0?0:8,nr=function(rr,lr){if(rr)ut(),c(rr,null);else{var or=lr.length;nt[bt]=mrg(Pt,{size:kt,crc:Rt.d(),c:lr,f:Gt,m:Nt,u:Dt!=xt.length||Nt&&It.length!=Vt,compression:Yt}),b+=30+Dt+Kt+or,tt+=76+2*(Dt+Kt)+(Vt||0)+or,--v||ht()}};if(Dt>65535&&nr("filename too long",null),Yt)if(kt<16e4)try{nr(null,deflateSync(wt,Pt))}catch(rr){nr(rr,null)}else lt.push(deflate(wt,Pt,nr));else nr(null,wt)},ft=0;ft<it;++ft)_t(ft);return ut}function zipSync(h,o){o||(o={});var c={},d=[];fltn(h,"",c,o);var _=0,v=0;for(var b in c){var tt=c[b],it=tt[0],nt=tt[1],lt=nt.level==0?0:8,ut=(Dt=strToU8(b)).length,ht=nt.comment,_t=ht&&strToU8(ht),ft=_t&&_t.length,bt=exfl(nt.extra);if(ut>65535)throw"filename too long";var xt=lt?deflateSync(it,nt):it,St=xt.length,wt=crc();wt.p(it),d.push(mrg(nt,{size:it.length,crc:wt.d(),c:xt,f:Dt,m:_t,u:ut!=b.length||_t&&ht.length!=ft,o:_,compression:lt})),_+=30+ut+bt+St,v+=76+2*(ut+bt)+(ft||0)+St}for(var Pt=new u8(v+22),Rt=_,kt=v-_,Gt=0;Gt<d.length;++Gt){var Dt=d[Gt];wzh(Pt,Dt.o,Dt,Dt.f,Dt.u,Dt.c.length);var It=30+Dt.f.length+exfl(Dt.extra);Pt.set(Dt.c,Dt.o+It),wzh(Pt,_,Dt,Dt.f,Dt.u,Dt.c.length,Dt.o,Dt.m),_+=16+It+(Dt.m?Dt.m.length:0)}return wzf(Pt,_,d.length,kt,Rt),Pt}var UnzipPassThrough=function(){function h(){}return h.prototype.push=function(o,c){this.ondata(null,o,c)},h.compression=0,h}(),UnzipInflate=function(){function h(){var o=this;this.i=new Inflate(function(c,d){o.ondata(null,c,d)})}return h.prototype.push=function(o,c){try{this.i.push(o,c)}catch(d){this.ondata(d,o,c)}},h.compression=8,h}(),AsyncUnzipInflate=function(){function h(o,c){var d=this;c<32e4?this.i=new Inflate(function(_,v){d.ondata(null,_,v)}):(this.i=new AsyncInflate(function(_,v,b){d.ondata(_,v,b)}),this.terminate=this.i.terminate)}return h.prototype.push=function(o,c){this.i.terminate&&(o=slc(o,0)),this.i.push(o,c)},h.compression=8,h}(),Unzip=function(){function h(o){this.onfile=o,this.k=[],this.o={0:UnzipPassThrough},this.p=browser_et}return h.prototype.push=function(o,c){var d=this;if(!this.onfile)throw"no callback";if(!this.p)throw"stream finished";if(this.c>0){var _=Math.min(this.c,o.length),v=o.subarray(0,_);if(this.c-=_,this.d?this.d.push(v,!this.c):this.k[0].push(v),(o=o.subarray(_)).length)return this.push(o,c)}else{var b=0,tt=0,it=void 0,nt=void 0;this.p.length?o.length?((nt=new u8(this.p.length+o.length)).set(this.p),nt.set(o,this.p.length)):nt=this.p:nt=o;for(var lt=nt.length,ut=this.c,ht=ut&&this.d,_t=function(){var xt,St=b4(nt,tt);if(St==67324752){b=1,it=tt,ft.d=null,ft.c=0;var wt=b2(nt,tt+6),Pt=b2(nt,tt+8),Rt=2048&wt,kt=8&wt,Gt=b2(nt,tt+26),Dt=b2(nt,tt+28);if(lt>tt+30+Gt+Dt){var It=[];ft.k.unshift(It),b=2;var Nt,Vt=b4(nt,tt+18),Kt=b4(nt,tt+22),Yt=strFromU8(nt.subarray(tt+30,tt+=30+Gt),!Rt);Vt==4294967295?(xt=kt?[-2]:z64e(nt,tt),Vt=xt[0],Kt=xt[1]):kt&&(Vt=-1),tt+=Dt,ft.c=Vt;var nr={name:Yt,compression:Pt,start:function(){if(!nr.ondata)throw"no callback";if(Vt){var rr=d.o[Pt];if(!rr)throw"unknown compression type "+Pt;(Nt=Vt<0?new rr(Yt):new rr(Yt,Vt,Kt)).ondata=function(hr,ur,cr){nr.ondata(hr,ur,cr)};for(var lr=0,or=It;lr<or.length;lr++){var pr=or[lr];Nt.push(pr,!1)}d.k[0]==It&&d.c?d.d=Nt:Nt.push(browser_et,!0)}else nr.ondata(null,browser_et,!0)},terminate:function(){Nt&&Nt.terminate&&Nt.terminate()}};Vt>=0&&(nr.size=Vt,nr.originalSize=Kt),ft.onfile(nr)}return"break"}if(ut){if(St==134695760)return it=tt+=12+(ut==-2&&8),b=3,ft.c=0,"break";if(St==33639248)return it=tt-=4,b=3,ft.c=0,"break"}},ft=this;tt<lt-4&&_t()!=="break";++tt);if(this.p=browser_et,ut<0){var bt=b?nt.subarray(0,it-12-(ut==-2&&8)-(b4(nt,it-16)==134695760&&4)):nt.subarray(0,tt);ht?ht.push(bt,!!b):this.k[+(b==2)].push(bt)}if(2&b)return this.push(nt.subarray(tt),c);this.p=nt.subarray(tt)}if(c){if(this.c)throw"invalid zip file";this.p=null}},h.prototype.register=function(o){this.o[o.compression]=o},h}();function unzip(h,o){if(typeof o!="function")throw"no callback";for(var c=[],d=function(){for(var ht=0;ht<c.length;++ht)c[ht]()},_={},v=h.length-22;b4(h,v)!=101010256;--v)if(!v||h.length-v>65558)return void o("invalid zip file",null);var b=b2(h,v+8);b||o(null,{});var tt=b,it=b4(h,v+16),nt=it==4294967295;if(nt){if(v=b4(h,v-12),b4(h,v)!=101075792)return void o("invalid zip file",null);tt=b=b4(h,v+32),it=b4(h,v+48)}for(var lt=function(ht){var _t=zh$1(h,it,nt),ft=_t[0],bt=_t[1],xt=_t[2],St=_t[3],wt=_t[4],Pt=_t[5],Rt=slzh(h,Pt);it=wt;var kt=function(Dt,It){Dt?(d(),o(Dt,null)):(_[St]=It,--b||o(null,_))};if(ft)if(ft==8){var Gt=h.subarray(Rt,Rt+bt);if(bt<32e4)try{kt(null,inflateSync(Gt,new u8(xt)))}catch(Dt){kt(Dt,null)}else c.push(inflate(Gt,{size:xt},kt))}else kt("unknown compression type "+ft,null);else kt(null,slc(h,Rt,Rt+bt))},ut=0;ut<tt;++ut)lt();return d}function unzipSync(h){for(var o={},c=h.length-22;b4(h,c)!=101010256;--c)if(!c||h.length-c>65558)throw"invalid zip file";var d=b2(h,c+8);if(!d)return{};var _=b4(h,c+16),v=_==4294967295;if(v){if(c=b4(h,c-12),b4(h,c)!=101075792)throw"invalid zip file";d=b4(h,c+32),_=b4(h,c+48)}for(var b=0;b<d;++b){var tt=zh$1(h,_,v),it=tt[0],nt=tt[1],lt=tt[2],ut=tt[3],ht=tt[4],_t=tt[5],ft=slzh(h,_t);if(_=ht,it){if(it!=8)throw"unknown compression type "+it;o[ut]=inflateSync(h.subarray(ft,ft+nt),new u8(lt))}else o[ut]=slc(h,ft,ft+nt)}return o}class ZipLoader extends three_module.Y9S{load(o,c,d,_){return this.setResponseType("arraybuffer"),super.load(o,v=>{const b=unzipSync(new Uint8Array(v)),tt=new Map(Object.entries(b).map(([it,nt])=>[it,new File([nt],it)]));c==null||c(tt)},d,_)}}class SVGTextureLoader extends three_module.aHM{constructor(o){super(o)}load(o,c,d,_){const v=SVGTextureLoader.USE_CANVAS_TEXTURE?document.createElement("canvas"):void 0,b=SVGTextureLoader.USE_CANVAS_TEXTURE?new three_module.GOR(v):new three_module.gPd,tt=new three_module.$NF(this.manager);return tt.setCrossOrigin(this.crossOrigin),tt.setPath(this.path),tt.load(o,function(it){v?SVGTextureLoader.CopyImageToCanvas(v,it):b.image=it,b.needsUpdate=!0,c!==void 0&&c(b)},d,_),b}static CopyImageToCanvas(o,c){o.width=c.naturalWidth||c.width||512,o.height=c.naturalHeight||c.height||512;const d=o.getContext("2d");d?(d.clearRect(0,0,o.width,o.height),d.drawImage(c,0,0,o.width,o.height)):console.error("SVGTextureLoader: Failed to get canvas context.")}}SVGTextureLoader.USE_CANVAS_TEXTURE=rt("svg-load-disable-canvas")!=="true";class AssetImporter extends I$2{get cachedAssets(){return this._cachedAssets}get processors(){return this._processors}get loadingManager(){return this._loadingManager}constructor(o,c=!1){super(),this._processors=new ObjectProcessorMap,this._logger=console.log,this.Importers=[new Importer(SimpleJSONLoader,["json"],!1),new Importer(three_module.Y9S,["txt"],!1),new Importer(RGBEPNGLoader,["rgbe.png","hdr.png","hdrpng"],!1),new Importer(SVGTextureLoader,["svg","data:image/svg"],!1),new Importer(three_module.Tap,["webp","png","jpeg","jpg","data:image"],!1),new Importer(LUTCubeLoader2,["cube"],!1),new Importer(ZipLoader,["zip"],!0)],this._loaderCache=[],this._fileDatabase=new Map,this._cachedAssets=[],c||(this._logger=()=>{}),this._viewer=o,this._onLoad=this._onLoad.bind(this),this._onProgress=this._onProgress.bind(this),this._onError=this._onError.bind(this),this._onStart=this._onStart.bind(this),this._urlModifier=this._urlModifier.bind(this),this._loadingManager=new three_module.KPJ(this._onLoad,this._onProgress,this._onError),this._loadingManager.onStart=this._onStart,this._loadingManager.setURLModifier(this._urlModifier),this.Importers.push(addRGBELoader(o)),this.Importers.push(addGLTFLoader(o)),this.Importers.push(addDracoLoader())}_onLoad(){this.dispatchEvent({type:"onLoad"})}_onProgress(o,c,d){this.dispatchEvent({type:"onProgress",url:o,loaded:c,total:d})}_onError(o){this.dispatchEvent({type:"onError",url:o})}_onStart(o,c,d){this.dispatchEvent({type:"onStart",url:o,loaded:c,total:d})}_urlModifier(o){var c;let d=decodeURI(o);const _=(c=this._rootContext)===null||c===void 0?void 0:c.rootUrl;d.includes("://")||!_||d.startsWith(_)||(d=_+d),d=d.replace("./",""),d=d.replace(/^(\/\/)/,"/"),d=d.replace(/\?.*$/,"");const v=this._fileDatabase.get(d);return v?v.ext?(v.objectUrl||(v.objectUrl=URL.createObjectURL(v)+"#"+d),v.objectUrl):(console.error("Unable to determine file extension",v),o):o}_createLoader(o){const c=this._getImporter(o),d=c==null?void 0:c.ctor(this);return d&&(c==null||c.ext.forEach(_=>{const v=new RegExp(_.startsWith("data:")?"^"+_+"\\/":"\\."+_+"$","i");this._loadingManager.addHandler(v,d)})),d&&(this._loaderCache.push({loader:d,files:[]}),this.dispatchEvent({type:"loaderCreate",loader:d})),d}addEventListener(o,c){if(super.addEventListener(o,c),o==="loaderCreate")for(const d of this._loaderCache)this.dispatchEvent({type:"loaderCreate",loader:d.loader})}async importFiles(o,c={}){const d=new Map;let{allowedExtensions:_}=c;if(_&&_.length<1&&(_=void 0),o.size===0)return d;this.dispatchEvent({type:"importFiles",files:Object.keys(o),state:"start"});const v=[],b=[];if(o.forEach((tt,it)=>{var nt;this.registerFile(it,tt);const lt=tt.ext;lt&&((nt=_==null?void 0:_.includes(lt.toLowerCase()))===null||nt===void 0||nt)&&(this._isRootFileExtension(lt)?v.push(it):b.push(it))}),v.length>0)for(const tt of v){let it=await this._importFile(tt,void 0,c);it&&(it=await this.processImported(it,c)),d.set(tt,it)}else for(const tt of b){let it=await this._importFile(tt,void 0,c);it&&(it=await this.processImported(it,c)),d.set(tt,it)}return this.dispatchEvent({type:"importFiles",files:Object.keys(o),state:"end"}),o.forEach((tt,it)=>{this.unregisterFile(it)}),d}registerFile(o,c){var d,_,v;o=o.replace(/\?.*$/,"");const b=(d=c==null?void 0:c.ext)!==null&&d!==void 0?d:(v=ae$1((_=c==null?void 0:c.name)!==null&&_!==void 0?_:o.trim()))===null||v===void 0?void 0:v.toLowerCase();c&&(c.ext||(c.ext=b),this._fileDatabase.set(o,c));let tt=this._getLoader(o);if(tt||(tt=this._createLoader(c??{name:o,ext:b})),tt){for(const it of this._loaderCache)if(it.loader===tt){it.files.push(o);break}}return tt}unregisterFile(o){o=o.replace(/\?.*$/,"");const c=this._fileDatabase.get(o);c!=null&&c.objectUrl&&(URL.revokeObjectURL(c.objectUrl),c.objectUrl=void 0),c&&this._fileDatabase.delete(o)}_isRootFileExtension(o){return this.Importers.find(c=>c.root&&c.ext.includes(o.toLowerCase()))!=null}resolveURL(o){return this._loadingManager.resolveURL(o)}async _importFile(o,c,d={},_){var v,b;if(c!=null&&c.__imported)return c.__imported;let tt;this.dispatchEvent({type:"importFile",path:o,state:"downloading",progress:0});try{this.registerFile(o,c);const it=this.resolveURL(o),nt=o.replace(/\?.*$/,"").trim(),lt=(v=d.fileHandler)!==null&&v!==void 0?v:await this._loadingManager.getHandler(nt)||(c?await this._loadingManager.getHandler(c.name||c.ext||""):void 0);if(!lt)throw new Error("AssetImporter: Unable to find loader for "+o);this._rootContext={path:o,url:it,rootUrl:three_module.r6x.extractUrlBase(o),baseUrl:three_module.r6x.extractUrlBase(it)},tt=await lt.loadAsync(o+(d.queryString?(o.includes("?")?"&":"?")+d.queryString:""),ut=>{_&&_(ut),this.dispatchEvent({type:"importFile",path:o,state:"downloading",loadedBytes:ut.loaded||void 0,totalBytes:ut.total||void 0,progress:ut.total>0?ut.loaded/ut.total:1})}),lt.transform&&(tt=await lt.transform(tt,d)),this._rootContext=void 0,this.dispatchEvent({type:"importFile",path:o,state:"downloading",progress:1}),this.dispatchEvent({type:"importFile",path:o,state:"adding"}),c?this._logger("AssetImporter: loaded",o):this._logger("AssetImporter: downloaded",o),c&&this.unregisterFile(o)}catch(it){return console.error("AssetImporter: Unable to import file",o,c),console.error(it),console.error(it==null?void 0:it.stack),this.dispatchEvent({type:"importFile",path:o,state:"error",error:it}),c&&this.unregisterFile(o),[]}if(this.dispatchEvent({type:"importFile",path:o,state:"done"}),c&&tt){c.__imported=tt;let it=[];Array.isArray(tt)?it=tt:!((b=tt.userData)===null||b===void 0)&&b.rootSceneModelRoot?it.push(...tt.children):it.push(tt),it.forEach(nt=>{nt.addEventListener&&nt.addEventListener("dispose",()=>{c.__imported=void 0})})}if(tt&&typeof tt=="object"){tt.__rootPath=o;const it=c||this._fileDatabase.get(o);it&&(tt.__rootBlob=it)}return tt}_getImporter(o,c=!1){return this.Importers.find(d=>{if(c&&!d.root)return!1;const _=d.ext.find(v=>{var b,tt,it;return o.ext&&v===o.ext.toLowerCase()||((tt=(b=o.name)===null||b===void 0?void 0:b.toLowerCase())===null||tt===void 0?void 0:tt.endsWith("."+v.toLowerCase()))||(v==null?void 0:v.startsWith("data:"))&&((it=o.name)===null||it===void 0?void 0:it.startsWith(v))});return!!_&&(o.ext=_,!0)})}_getLoader(o){var c;return(c=this._loadingManager.getHandler(o.trim()))!==null&&c!==void 0?c:void 0}async importAsset(o,c={},d){var _,v,b;if(!o)return[];if(!this._cachedAssets.includes(o)){if(Object.entries(o).length===1&&o.path){const lt=this._cachedAssets.find(ut=>ut.path===o.path);lt&&Object.assign(o,lt)}const nt=this._cachedAssets.findIndex(lt=>lt.path===o.path);nt>=0&&this._cachedAssets.splice(nt,1),this._cachedAssets.push(o)}let tt;if(o!=null&&o.preImported&&(tt=await o.preImported),!c.forceImport&&tt){const nt=await this.processImported(tt,c);let lt=!1;for(const ut of nt){if(!((_=ut.userData)===null||_===void 0)&&_.rootSceneModelRoot&&[...ut.children,...ut.__processedChildren||[]].find(ht=>ht.__disposed)){lt=!0;break}if(ut.__disposed){lt=!0;break}}if(!lt||c.reimportDisposed===!1)return nt}const it=c.pathOverride||o.path;if(o.preImported=this._importFile(it,typeof((v=o.file)===null||v===void 0?void 0:v.arrayBuffer)=="function"?o.file:void 0,c,d),tt=await o.preImported,tt&&(this.dispatchEvent({type:"processFileStart",path:it,result:tt}),tt=await this.processImported(tt,c),this.dispatchEvent({type:"processFileEnd",path:it,result:tt})),tt){const nt=[];Array.isArray(tt)?nt.push(...tt):!((b=tt.userData)===null||b===void 0)&&b.rootSceneModelRoot?nt.push(...tt.children):nt.push(tt),nt.forEach(lt=>{var ut;return(ut=lt.addEventListener)===null||ut===void 0?void 0:ut.call(lt,"dispose",()=>{o!=null&&o.preImported&&(o.preImported=void 0)})})}return tt}async importSingle(o,c={}){var d;return typeof o=="string"?await this.importSinglePath(o,c):(d=await this.importAsset(o,c))===null||d===void 0?void 0:d[0]}async importSinglePath(o,c){var d;return(d=await this.importPath(o,c))===null||d===void 0?void 0:d[0]}async importPath(o,c={}){const d={...c};delete d.pathOverride,delete d.forceImport,delete d.reimportDisposed,delete d.fileHandler,delete d.importedFile;const _=JSON.stringify(d),v=this._cachedAssets.find(tt=>tt.path===o&&tt._options===_);let b;return b=v||{path:o},b._options=_,c.importedFile&&(b.file=c.importedFile),await this.importAsset(b,c)}async processImportedSingle(o,c={}){return(await this.processImported(o,c))[0]}async processImported(o,c={}){var d,_,v,b,tt,it,nt,lt;let ut=o;if(!ut)return[];if(c.processImported===!1)return[ut];if(Array.isArray(ut)){const ft=[];for(const bt of ut)ft.push(...await this.processImported(bt,c));return ft}if(!((d=ut.userData)===null||d===void 0)&&d.rootSceneModelRoot){if(c._rootSceneImported=!0,ut.__processedChildren&&!c.forceImporterReprocess)return ut.__processedChildren;if(!(ut.children.length<1))return ut.animations&&(ut.children[0].animations||(ut.children[0].animations=[]),ut.children[0].animations.push(...ut.animations)),ut.__importedViewerConfig&&(ut.children[0].__importedViewerConfig=ut.__importedViewerConfig),ut.userData.__importData&&(ut.children[0].userData.__importData=ut.userData.__importData),ut.__processedChildren=await this.processImported([...ut.children],c),ut.__processedChildren;if(((_=ut.animations)===null||_===void 0?void 0:_.length)>0&&console.error("AssetImporter: animations in empty scene not supported yet. animations will be ignored",ut.animations),!ut.__importedViewerConfig)return[];ut=ut.__importedViewerConfig}if(!((v=ut.userData)===null||v===void 0)&&v.iModel&&(ut=ut.userData.iModel),!((b=ut.userData)===null||b===void 0)&&b.iMaterial&&(ut=ut.userData.iMaterial),ut.assetImporterProcessed&&!c.forceImporterReprocess)return[ut];const ht=ut.__rootPath,_t=ut.__rootBlob;if(!ut.assetType){if(ut.isBufferGeometry&&(ut=new three_module.eaF(ut,new three_module._4j)),ut.isObject3D)if(ut.isLight)ut=upgradeThreejsLight(ut);else{const ft=[];ut.traverse(bt=>{bt!==ut&&bt.isLight&&ft.push(bt)});for(const bt of ft)upgradeThreejsLight(bt);ut=new Object3DModel(ut,c)}ut.isTexture&&(ut.assetType="texture",c._testDataTextureComplete&&(ut.isDataTexture&&!((tt=ut.image)===null||tt===void 0)&&tt.data&&(ut.image.complete=!0),!((it=ut.image)===null||it===void 0)&&it.complete&&(ut.needsUpdate=!0)),c.generateMipmaps!==void 0&&(ut.generateMipmaps=c.generateMipmaps),ut.generateMipmaps||ut.isRenderTargetTexture||(ut.minFilter=ut.minFilter===three_module.$_I?three_module.k6q:ut.minFilter,ut.magFilter=ut.magFilter===three_module.$_I?three_module.k6q:ut.magFilter)),ut.isMaterial&&(ut.assetType="material")}if(ut.assetType!=null)return ut.userData&&(ut.userData.rootPath||!ht||ht.startsWith("blob:")||ht.startsWith("/")||(ut.userData.rootPath=ht),_t&&(ut.userData.__sourceBlob=_t,ut.userData.__needsSourceBuffer&&(ut.userData.__sourceBuffer=await _t.arrayBuffer(),delete ut.userData.__needsSourceBuffer))),ut=await this._processors.process(ut.assetType,ut,{}),ut.assetImporterProcessed=!0,[ut];if(ut instanceof Map)return[...(await this.importFiles(ut,c)).values()].flat();if(ut.type&&ut.type!=="ViewerApp"&&ut.type!=="ThreeViewer"){const ft=this._viewer.getPluginByType(ut.type);if(ft){let bt=ut._importedResources||{};return ut.resources&&(bt=await((nt=this._viewer.getManager())===null||nt===void 0?void 0:nt.importConfigResources(ut.resources)),delete ut.resources,ut._importedResources=bt),typeof ft.fromJSON=="function"&&(await Promise.resolve(ft.fromJSON(ut,bt)),ut.assetImporterProcessed=!1),[]}}return ut.plugins||ut.type==="ViewerApp"||ut.type==="ThreeViewer"?(ut.resources=await((lt=this._viewer.getManager())===null||lt===void 0?void 0:lt.importConfigResources(ut.resources)),await this._viewer.getManager().importViewerConfig(ut),ut.assetImporterProcessed=!1,[]):(console.warn("WebGi AssetImporter: unknown/null asset type: ",ut,ut.plugins),[ut])}dispose(){var o;this.clearCache(),(o=this._processors)===null||o===void 0||o.dispose()}clearLoaderCache(){this._loaderCache.forEach(o=>{o.loader.dispose&&o.loader.dispose()}),this._loaderCache=[]}clearCache(){this.clearLoaderCache(),this._cachedAssets=[]}}function getTextureDataType(h){if(!h)return three_module.OUM;const o=h.extensions.has("EXT_color_buffer_half_float")||h.capabilities.isWebGL2&&h.extensions.has("EXT_color_buffer_float"),c=h.capabilities.isWebGL2||h.extensions.has("OES_texture_float")||h.extensions.has("WEBGL_color_buffer_float");return o?three_module.ix0:c?three_module.RQf:three_module.OUM}function upgradeThreejsLight(h){var o,c;if(!h.isLight||h.assetType==="light")return h;if(h.uiConfig)return console.warn("ui config already exists, not supported",h),h;let d;if(h.children.length,h.isDirectionalLight&&(d=new DirectionalLight2),h.isAmbientLight&&(d=new AmbientLight2),h.isSpotLight&&(d=new SpotLight2),h.isPointLight&&(d=new PointLight2),d){(c=(o=d.lightObject).copy)===null||c===void 0||c.call(o,h);const _=h.parent;_!=null&&_.isObject3D&&(_.remove(h),h.dispose(),h.userData.iModel=d,_.add(d.lightObject),d.uuid=h.uuid),setupIModel(d.lightObject,_)}else console.warn("unknown light type: ",h);return d}AssetImporter.WHITE_IMAGE_DATA=new ImageData(new Uint8ClampedArray([255,255,255,255]),1,1);class ThreeMaterialLoader extends three_module.jut{constructor(o){super(o)}async loadAsync(o,c){var d,_;const v=new three_module.Y9S(this.manager);v.setPath(this.path),v.setRequestHeader(this.requestHeader),v.setWithCredentials(this.withCredentials);const b=await v.loadAsync(o,c);try{const tt=JSON.parse(b);if(this.importer){const it={};let nt=(d=tt.images)!==null&&d!==void 0?d:[];Array.isArray(nt)||(nt=Object.values(nt));for(const lt of nt){if(!lt.url||!lt.uuid)continue;const ut=(_=await this.importer.importPath(lt.url,{processImported:!1}))===null||_===void 0?void 0:_[0],ht=ut==null?void 0:ut.source;if(!ut||!ht)continue;const _t=new three_module.kLi(ht.data);_t.uuid=lt.uuid,it[_t.uuid]=_t,ut.dispose()}return await ObjectLoader2.LoadRootPathTextures(tt.textures,it,this.importer),this.parse(tt,it)}return this.parse(tt)}catch(tt){throw console.error(tt),this.manager.itemError(o),tt}}parse(o,c){var d,_;let v;const b={p:new Promise(lt=>{v=lt})};if(o.images||o.textures){const lt=new ObjectLoader2(this.manager);let ut={};const ht=xt=>{v(),b.p=void 0,Object.values(ut).forEach(St=>{var wt;St.isTexture&&!((wt=St.image)===null||wt===void 0)&&wt.complete&&(St.needsUpdate=!0)})};let _t=o.images||[];Array.isArray(_t)||(_t=Object.values(_t));const ft=c||lt.parseImages(_t,ht);let bt=o.textures;Array.isArray(bt)||(bt=Object.values(bt)),ut=lt.parseTextures2(bt,ft,ht),this.setTextures(ut)}this.materials||console.warn("A Material Manager is not set to import three materials, trying standard materials");const tt={...o};if(Object.entries(tt).forEach(([lt,ut])=>{ut&&typeof ut=="string"&&this.textures[ut]&&(tt[lt]=this.textures[ut])}),o.vertexColors!==void 0&&(typeof o.vertexColors=="number"?tt.vertexColors=o.vertexColors>0:tt.vertexColors=o.vertexColors),o.normalScale!==void 0){const lt=o.normalScale;Array.isArray(lt)===!1&&(tt.normalScale=[lt,lt])}let it=o.type;it!=="MeshPhysicalMaterial"&&it!=="MeshStandardMaterial"&&it!=="PhysicalMaterial"||(it=MeshStandardMaterial2.TYPE),tt.userData=deserializeObject(tt.userData,void 0,!1,this);const nt=(_=(d=this.materials)===null||d===void 0?void 0:d.generateFromTemplateType(it,tt))!==null&&_!==void 0?_:super.parse(o);return this.setTextures({}),nt.userData.imageLoadAwaiter=b,nt}}class AssetManagerPlugin extends I$2{constructor(o,c,{simpleCache:d=!1,storage:_}={}){if(super(),this._sceneUpdated=this._sceneUpdated.bind(this),this.addAsset=this.addAsset.bind(this),this.addProcessedAssets=this.addProcessedAssets.bind(this),this.addImported=this.addImported.bind(this),(d||_)&&(d&&(three_module.l2R.enabled=!0),_&&window.Cache&&typeof window.Cache=="function"&&_ instanceof window.Cache)){const v={...three_module.l2R};three_module.l2R.get=(b,tt,it)=>tt?b.startsWith("data:")||b.startsWith("blob")||b.startsWith("chrome-extension")?Promise.resolve(void 0):_.match(b).then(nt=>{if(nt)switch(tt){case"arraybuffer":return nt.arrayBuffer();case"blob":return nt.blob();case"document":return nt.text().then(lt=>new DOMParser().parseFromString(lt,it??"text/html"));case"json":return nt.json();default:if(it===void 0)return nt.text();{const lt=/charset="?([^;"\s]*)"?/i.exec(it),ut=lt&&lt[1]?lt[1].toLowerCase():void 0,ht=new TextDecoder(ut);return nt.arrayBuffer().then(_t=>ht.decode(_t))}}}):v.get(b),three_module.l2R.add=async(b,tt,it)=>{if(!it)return v.add(b,tt);b.startsWith("data:")||b.startsWith("blob")||b.startsWith("chrome-extension")||(await _.match(b)&&await _.delete(b),await _.put(b,new Response(tt,{status:200})))},three_module.l2R.remove=(b,tt)=>{if(!tt)return v.remove(b);_.delete(b)}}this.storage=_,this._importer=o,this._materials=c}async addAsset(o,c={}){if(!this._importer||!this._viewer)return[];const d=await this._importer.importAsset(o,c);return d?(this.addProcessedAssets(d,c),d):(console.warn("WebGi AssetManager: Unable to import",o,d),[])}async addFromPath(o,c={}){if(!this._importer||!this._viewer)return[];const d=await this._importer.importPath(o,c);return d?(this.addProcessedAssets(d,c),d):(o&&!o.split("?")[0].endsWith(".vjson")&&console.warn("WebGi AssetManager: Unable to import",o,d),[])}addProcessedAssets(o,c){return o.map(d=>{var _;return(_=this._viewer)===null||_===void 0?void 0:_.scene.addSceneObject(d,{...c,allImported:o})})}async addAssetSingle(o,c={}){var d;return o?(d=await(typeof o=="string"?this.addFromPath:this.addAsset).call(this,o,c))===null||d===void 0?void 0:d[0]:void 0}async addImported(o,c={}){var d;return(d=this._importer)===null||d===void 0?void 0:d.processImported(o,c).then(_=>(this.addProcessedAssets(_,c),_))}async addImportedSingle(o,c={}){return this.addImported(o,c).then(d=>d==null?void 0:d[0])}_sceneUpdated(o){var c;if(o.type==="addSceneObject"){const d=o.object;d.assetType==="material"&&((c=this._materials)===null||c===void 0||c.processMaterial(d,{}))}else console.error("Unexpected")}onAdded(o){this._viewer=o,this._materials||(this._materials=new MaterialManager,this._viewer.scene.addEventListener("addSceneObject",this._sceneUpdated)),this._importer||(this._importer=new AssetImporter(o,!!o.getPluginByType("debug")),this._importer.processors.add("model",{forAssetType:"model",process:(d,_)=>(setupObject3dModel(d,v=>{var b;return(b=this._materials)===null||b===void 0?void 0:b.processModel(v,{recursive:!1})}),d)}),this._importer.processors.add("model",{forAssetType:"model",process:this._materials.processModel}),this._importer.processors.add("material",{forAssetType:"material",process:(d,_)=>{var v;return!((v=this.materials)===null||v===void 0)&&v.findMaterial(d.uuid)&&(console.warn("WebGi AssetManager: Material with same UUID already exists, creating new UUID"),d.uuid=three_module.cj9.generateUUID(),d.userData.uuid&&(d.userData.uuid=d.uuid)),this._materials.processMaterial(d,_)}})),this._importer.Importers.push(new Importer(ThreeMaterialLoader,[MeshStandardMaterial2.TypeSlug],!1,d=>(d&&(d.materials=this._materials),d&&(d.importer=this._importer),d)));const c=this.importViewerConfig.bind(this);this._importer.Importers.push(new Importer(class extends SimpleJSONLoader{async loadAsync(d,_){return c(await super.loadAsync(d,_))}},[AssetManagerPlugin.ViewerTypeSlug],!0))}onRemove(o){var c,d;o===this._viewer&&((c=this._importer)===null||c===void 0||c.dispose(),this._importer=void 0,this._viewer.scene.removeEventListener("addSceneObject",this._sceneUpdated),(d=this._materials)===null||d===void 0||d.dispose(),this._materials=void 0)}get importer(){return this._importer}get exporter(){var o,c;return(c=(o=this._viewer)===null||o===void 0?void 0:o.getPluginByType("AssetExporterPlugin"))===null||c===void 0?void 0:c.exporter}get materials(){return this._materials}exportViewerConfig(o=!0,c){if(!this._viewer)return{};const d={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},extras:{},...c},_=this._viewer.toJSON(d);return o||Object.values(d).forEach(v=>{v&&Object.values(v).forEach(b=>{b.url&&(b.url.data instanceof ArrayBuffer||Array.isArray(b.url.data))&&(b.url.type==="Uint16Array"?(b.url.data instanceof Uint16Array||(b.url.data=new Uint16Array(b.url.data)),b.url.data="data:application/octet-stream;base64,"+ie$1(b.url.data.buffer)):b.url.type==="Uint8Array"?(b.url.data instanceof Uint8Array||(b.url.data=new Uint8Array(b.url.data)),b.url.data="data:application/octet-stream;base64,"+ie$1(b.url.data.buffer)):b.url.data instanceof ArrayBuffer?b.url.data="data:application/octet-stream;base64,"+ie$1(b.url.data.buffer):console.warn("Unsupported buffer type",b.url.type))})}),_.resources=d,_}exportPluginPresets(o){var c;const d={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},extras:{}};return{plugins:(c=this._viewer)===null||c===void 0?void 0:c.serializePlugins(d,o),resources:d}}exportPluginPreset(o){if(!o.toJSON)return;const c={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},extras:{}},d=o.toJSON(c);return d.resources=c,d}async importPluginPreset(o,c){var d;const _=o.type;if(!(c=c||((d=this._viewer)===null||d===void 0?void 0:d.getPluginByType(_))))return void console.warn(`WebGi: No plugin found for type ${_} to import preset`);if(!c.fromJSON)return void console.warn(`WebGi: Plugin ${_} does not support importing presets`);const v=o.resources||{};o.resources&&delete o.resources;const b=await this.importConfigResources(v);return await c.fromJSON(o,b),b&&(o.resources=b),c}async importViewerConfig(o,c){if(!this._viewer||!this._importer)return void console.warn("WebGi: No viewer or importer");const d=await this.importConfigResources(o.resources||{},c);this.applyViewerConfig(o,d)}applyViewerConfig(o,c){var d;if(this._viewer&&this._importer)if((c=c||o.resources).__isLoadedResources){this._viewer.fromJSON(o,c);for(const _ of Object.values(c.materials))_.__useCount?delete _.__useCount:(d=this._materials)===null||d===void 0||d.unregisterMaterial(_);for(const _ of Object.values(c.textures))_.__useCount&&delete _.__useCount}else console.error("Cannot load viewer config: resources not loaded",o);else console.warn("WebGi: No viewer or importer")}async importConfigResources(o,c,d){var _,v,b;if(!this._importer)throw"Importer not initialized yet.";if(o.__isLoadedResources)return o;const tt={};Object.values(o).forEach(nt=>{nt&&Object.values(nt).forEach(lt=>{if(!lt||!lt.url||typeof lt.url.data!="string")return;const ut=lt.url.data.match(/^data:.*;base64,(.*)$/);ut!=null&&ut[1]?lt.url.data=re$1(ut==null?void 0:ut[1]):(lt.url.type!=="Uint8Array"&&console.error("Unsupported buffer type string for ",lt.url.type,"use base64"),lt.url.data=new TextEncoder().encode(lt.url.data).buffer)})}),c=c??new ObjectLoader2(this._importer.loadingManager),tt.animations=o.animations?c.parseAnimations(o.animations):{},d&&d.animations&&(tt.animations={...tt.animations,...d.animations}),tt.shapes=o.shapes?c.parseShapes(o.shapes):{},d&&d.shapes&&(tt.shapes={...tt.shapes,...d.shapes}),tt.geometries=o.geometries?c.parseGeometries(o.geometries,tt.shapes):{},d&&d.geometries&&(tt.geometries={...tt.geometries,...d.geometries}),tt.images=o.images?await c.parseImagesAsync(Object.values(o.images)):{},d&&d.images&&(tt.images={...tt.images,...d.images}),await ObjectLoader2.LoadRootPathTextures(o.textures,tt.images,this._importer),tt.textures=o.textures?c.parseTextures2(Object.values(o.textures),tt.images,()=>{Object.values(tt.textures).forEach(nt=>{var lt;nt.isTexture&&!((lt=nt.image)===null||lt===void 0)&&lt.complete&&(nt.needsUpdate=!0)})}):{};for(const nt of Object.entries(tt.textures))nt[1]=(_=await this._importer.processImported(nt[1],{}))===null||_===void 0?void 0:_[0],nt[1]?tt.textures[nt[0]]=nt[1]:delete tt.textures[nt[0]];d&&d.textures&&(tt.textures={...tt.textures,...d.textures});const it=o.materials?Object.values(o.materials):[];for(const nt of it)Object.entries(nt).forEach(([lt,ut])=>{ut&&ut.resource&&ut.uuid&&ut.resource==="textures"&&(nt[lt]=ut.uuid)});if(tt.materials=c.parseMaterials2(it,tt.textures,this._materials),d&&d.materials&&(tt.materials={...tt.materials,...d.materials}),o.object&&(tt.object=c.parseObject(o.object,tt.geometries,tt.materials,tt.textures,tt.animations),o.skeletons&&(tt.skeletons=c.parseSkeletons(o.skeletons,tt.object),c.bindSkeletons(tt.object,tt.skeletons))),o.extras){tt.extras=o.extras;for(const nt of Object.values(o.extras))if(nt.uuid&&nt.url)if(typeof nt.url=="string"){const lt=await((v=this._importer)===null||v===void 0?void 0:v.importPath(nt.url));(lt==null?void 0:lt.length)>0&&(tt.extras[nt.uuid]=lt[0])}else if(nt.url.data){const lt=new File([se$1(nt.url.type,nt.url.data)],nt.url.path),ut=await((b=this._importer)===null||b===void 0?void 0:b.importAsset({path:lt.name,file:lt}));(ut==null?void 0:ut.length)>0&&(tt.extras[nt.uuid]=ut[0])}else console.warn("WebGi: invalid URL type while loading extra resource")}return d&&d.extras&&(tt.extras={...tt.extras,...d.extras}),tt.__isLoadedResources=!0,tt}}AssetManagerPlugin.PluginType="AssetManager",AssetManagerPlugin.ViewerTypeSlug="vjson";const VIEWER_VERSION="0.11.1";class Dropzone{get inputEl(){return this._inputEl}get el(){return this._el}constructor(o,c,d){this._el=o,this._inputEl=c,this._listeners={drop:[],dropstart:[],droperror:[]},this._onDragover=this._onDragover.bind(this),this._onDrop=this._onDrop.bind(this),this._onSelect=this._onSelect.bind(this),o==null||o.addEventListener("dragover",this._onDragover,!1),o==null||o.addEventListener("drop",this._onDrop,!1),c==null||c.addEventListener("change",this._onSelect),d&&Object.entries(d).forEach(([_,v])=>v&&this.on(_,v))}on(o,c){return this._listeners[o].push(c),this}_emit(o,c){return this._listeners[o].forEach(d=>d(c)),this}destroy(){const o=this._el,c=this._inputEl;o==null||o.removeEventListener("dragover",this._onDragover),o==null||o.removeEventListener("drop",this._onDrop),c==null||c.removeEventListener("change",this._onSelect)}_onDrop(o){var c,d;o.stopPropagation(),o.preventDefault(),this._emit("dropstart");const _=Array.from(((c=o.dataTransfer)===null||c===void 0?void 0:c.files)||[]),v=Array.from(((d=o.dataTransfer)===null||d===void 0?void 0:d.items)||[]);if(_.length!==0||v.length!==0)if(v.length>0){const b=v.map(tt=>tt.webkitGetAsEntry());this._loadNextEntry(new Map,b)}else this._emit("drop",{files:new Map(_.map(b=>(b.filePath=b.name,[b.filePath,b])))});else this._fail("Required drag-and-drop APIs are not supported in this browser.")}_onDragover(o){o.stopPropagation(),o.preventDefault(),o.dataTransfer&&(o.dataTransfer.dropEffect="copy")}_onSelect(o){var c;if(!this._inputEl)return void console.warn("Invalid Dropzone event ",o);this._emit("dropstart");const d=[].slice.call((c=this._inputEl.files)!==null&&c!==void 0?c:new FileList),_=new Map;d.forEach(v=>{v.filePath=v.webkitRelativePath||v.name,_.set(v.filePath,v)}),this._emit("drop",{files:_})}_loadNextEntry(o,c){const d=c.pop();if(d)if(d.isFile)d.file(_=>{_.filePath=d.fullPath,o.set(d.fullPath,_),this._loadNextEntry(o,c)},()=>console.error("Could not load file: %s",d.fullPath));else if(d.isDirectory){const _=d.createReader(),v=b=>{b.length?(c=c.concat(b),_.readEntries(v)):this._loadNextEntry(o,c)};_.readEntries(v)}else console.warn("Unknown asset type: "+d.fullPath),this._loadNextEntry(o,c);else this._emit("drop",{files:o})}_fail(o){this._emit("droperror",{message:o})}}class DropzonePlugin extends I$2{constructor(o){super(),this._domElement=o,this._allowedExtensions=void 0,this.importerParams={autoScale:!0,autoScaleRadius:2,pseudoCenter:!1,autoCenter:!0,autoImport:!0,autoAdd:!0,centerOffset:new three_module.Pq0(.5,.5,3)},this.dependencies=[AssetManagerPlugin],this.uiConfig={type:"folder",label:"Drop Options",expanded:!0,children:[{label:"Auto Center",type:"checkbox",property:[this.importerParams,"autoCenter"],limitedUi:!0},{label:"Auto Scale",type:"checkbox",property:[this.importerParams,"autoScale"],limitedUi:!0},{label:"Auto scale radius",type:"slider",bounds:[.5,100],property:[this.importerParams,"autoScaleRadius"]},{label:"Select local file",type:"button",value:()=>this.promptForFile()}]}}onAdded(o){this._inputEl=document.createElement("input"),this._viewer=o,this._inputEl.type="file",this._dropzone=new Dropzone(this._domElement||o.canvas,this._inputEl,{drop:this._onFileDrop.bind(this)})}async _onFileDrop({files:o}){var c,d,_,v,b,tt;if(!o)return;const it=this._viewer;if(!it)return;if(this._allowedExtensions!==void 0)for(const ut of o.keys())this._allowedExtensions.includes((d=(c=ut.split(".").pop())===null||c===void 0?void 0:c.toLowerCase())!==null&&d!==void 0?d:"")||o.delete(ut);if(o.size<1)return;const nt=it.getPlugin(AssetManagerPlugin),lt={type:"drop",files:o};if(this.importerParams.autoImport){const ut={allowedExtensions:this.allowedExtensions,...this.importerParams};if(lt.imported=await((_=nt.importer)===null||_===void 0?void 0:_.importFiles(o,ut)),this.importerParams.autoAdd){const ht=(tt=[...(b=(v=lt.imported)===null||v===void 0?void 0:v.values())!==null&&b!==void 0?b:[]].flat(2).filter(_t=>!!_t))!==null&&tt!==void 0?tt:[];if(lt.assets=nt.addProcessedAssets(ht,{...this.importerParams}),!ut._rootSceneImported)for(const _t of lt.assets)_t.modelObject&&_t.modelObject.dispatchEvent({type:"select",value:_t.modelObject})}}this.dispatchEvent(lt)}promptForFile(){var o;(o=this._inputEl)===null||o===void 0||o.click()}onRemove(o){var c;(c=this._dropzone)===null||c===void 0||c.destroy(),this._dropzone=void 0,this._viewer=void 0}get allowedExtensions(){return this._allowedExtensions}set allowedExtensions(o){this._allowedExtensions=o,this._inputEl&&(this._inputEl.accept=o?o.map(c=>"."+c).join(", "):"")}}function legacySeparateMapSamplerUVFix(h,o){const c=(h.version?h.version:"0.0.0").split(".").map(_=>parseInt(_));if(h.type!=="ViewerApp"||c[0]!==0||!(c[1]<7||c[1]===7&&c[2].toString()[0]<"6"))return;const d=new Set;o.forEach(_=>_.traverse(v=>{v.material&&d.add(v.material)})),d.forEach(_=>{const v=_.map;if(!v)return;const b=v.repeat,tt=v.offset,it=v.center,nt=v.rotation;["alphaMap","aoMap","bumpMap","displacementMap","emissiveMap","lightMap","metalnessMap","normalMap","roughnessMap","transmissionMap"].forEach(lt=>{const ut=_[lt];ut&&(ut.repeat.copy(b),ut.offset.copy(tt),ut.center.copy(it),ut.rotation=nt,ut.needsUpdate=!0)}),_.needsUpdate=!0})}DropzonePlugin.PluginType="Dropzone";var ViewerApp_decorate=function(h,o,c,d){var _,v=arguments.length,b=v<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(h,o,c,d);else for(var tt=h.length-1;tt>=0;tt--)(_=h[tt])&&(b=(v<3?_(b):v>3?_(o,c,b):_(o,c))||b);return v>3&&b&&Object.defineProperty(o,c,b),b};function getPluginType(h){return Object.getPrototypeOf(h).constructor.PluginType}class ViewerApp extends I$2{get useRgbm(){return this._useRgbm}get screenShader(){return this._screenShader}get useGBufferDepth(){return this._useGBufferDepth}get isAntialiased(){return this._isAntialiased}constructor({isAntialiased:o=!1,useRgbm:c=!0,useGBufferDepth:d=!1,screenShader:_="",maxHDRIntensity:v,...b}){var tt,it;super(),this.console=console,this._state=ViewerState.None,this.plugins={},this._needsResize=!1,this.resizeObserver=window.ResizeObserver?new window.ResizeObserver(ft=>this.resize()):void 0,this._lastSize=new three_module.I9Y,this._onContextRestore=ft=>{this.enabled=!0,this._canvas.width=this._lastSize.width,this._canvas.height=this._lastSize.height,this.resize(),this.scene.setDirty({sceneUpdate:!0,frameFade:!1})},this._onContextLost=ft=>{this._lastSize.set(this._canvas.width,this._canvas.height),this._canvas.width=2,this._canvas.height=2,this.resize(),this.enabled=!1},this.resize=()=>{this._needsResize=!0,this.setDirty()},this._needsReset=!0,this.enabled=!0,this.renderEnabled=!0,this._isRenderingFrame=!1,this.maxFramePerLoop=1,this.rendersPerFrame=1,this._rawBackground=null,this._sceneEnvironmentChanged=()=>{this._rawBackground===envMapBackground&&this.scene.setBackground(this.scene.getEnvironment())},this._addSceneObject=ft=>{var bt,xt;if(!ft||!ft.object||ft.options&&ft.options.importConfig===!1)return;const St=ft.object.__importedViewerConfig||((bt=ft.object.modelObject)===null||bt===void 0?void 0:bt.__importedViewerConfig);if(!St)return;const wt=this.getManager();legacySeparateMapSamplerUVFix(St,!((xt=ft.options)===null||xt===void 0)&&xt.allImported?ft.options.allImported:[ft.object]),wt?wt.applyViewerConfig(St,St.resources):this.fromJSON(St,St.resources)},this.serializePluginsIgnored=[],this.alert=async ft=>alert(ft),this.confirm=async ft=>confirm(ft),this.prompt=async(ft,bt,xt=!0)=>prompt(ft,bt),this._useRgbm=c,this._useGBufferDepth=d,this._screenShader=_,this._canvas=b.canvas||j();let nt=b.container;if(nt&&!b.canvas&&nt.appendChild(this._canvas),nt||(nt=(tt=this._canvas.parentElement)!==null&&tt!==void 0?tt:void 0),!nt)throw new Error("No container.");this._container=nt,this._animationLoop=this._animationLoop.bind(this),this.setDirty=this.setDirty.bind(this),this._setActiveCameraView=this._setActiveCameraView.bind(this),window.webGiViewers||(window.webGiViewers=[]),window.webGiViewers.push(this),checkVersion();const lt=new CameraController(void 0,void 0,this._canvas);lt.autoLookAtTarget=!0,this.addEventListener("postFrame",()=>{var ft,bt;const xt=ht.scene.activeCamera;if(xt&&xt.interactionsEnabled){const St=(ft=this.getPluginByType("Progressive"))===null||ft===void 0?void 0:ft.postFrameConvergedRecordingDelta();if(St!==void 0&&St===0)return;(bt=xt.controls)===null||bt===void 0||bt.update()}}),this.scene=new RootScene(lt),this.scene.addEventListener("environmentChanged",this._sceneEnvironmentChanged),this.scene.addEventListener("addSceneObject",this._addSceneObject),this.scene.addEventListener("setView",this._setActiveCameraView),this.scene.addEventListener("activateMain",this._setActiveCameraView),this.scene.modelRoot.modelObject.scale.setScalar((it=b.modelRootScale)!==null&&it!==void 0?it:1),this._renderer=new BaseRenderer({canvas:this._canvas,animationLoop:this._animationLoop,targetOptions:{samples:o?4:0,colorSpace:c?RGBM16ColorSpace_:three_module.jf0,type:c?three_module.OUM:three_module.ix0,depthBuffer:!d,generateMipmaps:!!o,minFilter:o?three_module.NZq:three_module.k6q},maxHDRIntensity:v||(c?16:80)}),this._isAntialiased=o&&this._renderer.isWebGL2;let ut=!0;this._renderer.rendererObject.userData||(ut=!1,this._renderer.rendererObject.userData={}),this._renderer.rendererObject.userData.renderTransmissionPass=!ut;const ht=this;this.renderFilter={passId:"render",passObject:new RenderPass2(this,ut),update(){const ft=this.passObject;ft.scene=ht.scene.modelObject,ft.camera=ht.scene.renderCamera.cameraObject}};const _t={passId:"screen",after:["render"],required:["render"],passObject:buildScreenShader(_)};[this.renderFilter,_t].forEach(ft=>this._renderer.registerPass(ft)),this._renderer.pipeline=["render","screen"],this.scene.addEventListener("textureUpdate",ft=>this.setDirty(this.scene,ft)),this.scene.addEventListener("sceneMaterialUpdate",ft=>this.setDirty(this.scene,ft)),this.scene.addEventListener("sceneUpdate",ft=>{this.setDirty(this.scene,ft),ft.geometryChanged!==!1&&this.renderer.resetShadows()}),this.scene.addEventListener("update",ft=>this.setDirty(this.scene,ft)),this._renderer.addEventListener("update",ft=>this.setDirty(this._renderer,ft)),this.resizeObserver&&this.resizeObserver.observe(this._canvas),window&&window.addEventListener("resize",this.resize),this._canvas.addEventListener("webglcontextrestored",this._onContextRestore,!1),this._canvas.addEventListener("webglcontextlost",this._onContextLost,!1),this.renderer.addEventListener("resize",()=>{this.scene.activeCamera.refreshAspect()}),this.scene.setBackgroundColor("#202020"),b.assetManager&&this.addPluginSync(new AssetManagerPlugin(void 0,void 0,typeof b.assetManager=="boolean"?{}:b.assetManager)),b.dropzone&&this.addPluginSync(new DropzonePlugin),this.console.log("WebGi Viewer instance initialized, version: ",ViewerApp.VERSION)}setDirty(o,c){this._needsReset=!0,o=o??this,this.dispatchEvent({...c??{},type:"update",source:o})}get renderer(){return this._renderer}dispose(){var o;for(const c of[...Object.values(this.plugins)])this.removePlugin(c,!0);this.scene.dispose(),this.renderer.dispose(),this._canvas.removeEventListener("webglcontextrestored",this._onContextRestore,!1),this._canvas.removeEventListener("webglcontextlost",this._onContextLost,!1),(o=window.webGiViewers)===null||o===void 0||o.splice(window.webGiViewers.indexOf(this),1),this.resizeObserver?this.resizeObserver.unobserve(this._canvas):window.removeEventListener("resize",this.resize),this.dispatchEvent({type:"dispose"})}_renderEnabledChanged(){this.dispatchEvent({type:this.renderEnabled?"renderEnabled":"renderDisabled"})}_animationLoop({time:o,deltaTime:c,xrFrame:d}){var _,v;if(this.enabled&&this.renderEnabled)if(this._isRenderingFrame)this.console.warn("animation loop: frame skip");else{this._isRenderingFrame=!0;for(let b=0;b<this.maxFramePerLoop;b++){if(this._needsReset&&(this._renderer.reset(),this._needsReset=!1),this._needsResize){const nt=[this._canvas.clientWidth,this._canvas.clientHeight];if(d){const lt=(v=(_=this._renderer.rendererObject.xr.getCamera())===null||_===void 0?void 0:_.cameras[0])===null||v===void 0?void 0:v.viewport;lt?(lt.x===0&&lt.y===0||this.console.warn("x and y must be 0?"),nt[0]=lt.width,nt[1]=lt.height,this.console.log("resize for xr",nt)):this._needsResize=!1}this._needsResize&&(this._renderer.setSize(...nt),this._needsResize=!1)}this.dispatchEvent({type:"preFrame",target:this,time:o,deltaTime:c,xrFrame:d});const tt=Object.values(this.plugins).filter(nt=>nt.dirty);tt.length>0&&this.setDirty(tt),this._needsReset&&(this._renderer.reset(),this._needsReset=!1),this._renderer.updateDirty();const it=this._renderer.dirty;if(it)for(let nt=0;nt<this.rendersPerFrame;nt++){this.dispatchEvent({type:"preRender",target:this});try{this.scene.renderCamera=this.scene.activeCamera,this._renderer.render(this._renderer.defaultRenderToScreen)}catch(lt){this.console.error(lt),this.enabled=!1}this.dispatchEvent({type:"postRender",target:this})}if(this.dispatchEvent({type:"postFrame",target:this}),!it)break}this._isRenderingFrame=!1}}get state(){return this._state}get container(){return this._canvas.parentElement!==this._container&&this.console.error("ViewerApp: Canvas is not in the container, this might cause issues with some plugins."),this._container}get canvas(){return this._canvas}get canvasTexture(){if(!this._canvas)throw new Error("Canvas not found");return this._canvasTexture||(this._canvasTexture=new three_module.GOR(this._canvas),this._canvasTexture.flipY=!1,this._canvasTexture.needsUpdate=!0),this._canvasTexture}getPlugin(o){return typeof o=="string"?this.getPluginByType(o):this.plugins[o.PluginType]}getPluginByType(o){return this.plugins[o]}async getOrAddPlugin(o,...c){return this.getPlugin(o)||this.addPlugin(o,...c)}getOrAddPluginSync(o,...c){return this.getPlugin(o)||this.addPluginSync(o,...c)}async addPlugin(o,...c){let d;if(o.prototype){const v=this.getPlugin(o);if(v)return console.error(`Plugin of type ${getPluginType(v)} already exists, no new plugin created`,v),v;d=new o(...c)}else d=o;const _=getPluginType(d);if(!_)return this.console.error("PluginType is not defined for",d),d;for(const v of d.dependencies||[])await this.getOrAddPlugin(v);return this.plugins[_]&&(this.console.error(`Plugin of type ${_} already exists, old plugin will be removed and disposed`,this.plugins[_],d),await this.removePlugin(this.plugins[_],!0)),this.plugins[_]=d,await d.onAdded(this),this.dispatchEvent({type:"addPlugin",target:this,plugin:d}),this.setDirty(d),d}addPluginSync(o,...c){let d;if(o.prototype){const v=this.getPlugin(o);if(v)return console.error(`Plugin of type ${getPluginType(v)} already exists, no new plugin created`,v),v;d=new o(...c)}else d=o;const _=getPluginType(d);if(!_)return this.console.error("PluginType is not defined for",d),d;for(const v of d.dependencies||[])this.getOrAddPluginSync(v);return this.plugins[_]&&(this.console.error(`Plugin of type ${_} already exists, old plugin will be removed and disposed`,this.plugins[_],d),this.removePluginSync(this.plugins[_],!0)),this.plugins[_]=d,d.onAdded(this),this.dispatchEvent({type:"addPlugin",target:this,plugin:d}),this.setDirty(d),d}async addPlugins(o){for(const c of o)await this.addPlugin(c)}async addPluginsSync(o){for(const c of o)this.addPluginSync(c)}async removePlugin(o,c=!0){const d=getPluginType(o);this.plugins[d]&&(await o.onRemove(this),delete this.plugins[d],c&&o.onDispose&&await o.onDispose(this),this.setDirty(o))}removePluginSync(o,c=!0){const d=getPluginType(o);this.plugins[d]&&(o.onRemove(this),delete this.plugins[d],c&&o.onDispose&&o.onDispose(this),this.setDirty(o))}createCamera(o){var c;const d=(c=o.userData.iCamera)!==null&&c!==void 0?c:new CameraController(o,{controlsMode:"",aspect:"auto"},this._canvas);return o.userData.autoLookAtTarget===void 0?(d.autoLookAtTarget=!1,o.userData.autoLookAtTarget=!1):d.autoLookAtTarget=o.userData.autoLookAtTarget,d}setSize(o){this._canvas.style.width=o!=null&&o.width?o.width+"px":"100%",this._canvas.style.height=o!=null&&o.height?o.height+"px":"100%",this._canvas.offsetHeight,this.resize()}async doOnce(o,c){return new Promise(d=>{const _=async(...v)=>{this.removeEventListener(o,_),d(await(c==null?void 0:c(...v)))};this.addEventListener(o,_)})}setBackgroundColor(o){return console.warn("viewer.setBackground is deprecated, use viewer.scene.setBackgroundColor instead."),this.setBackgroundColor(o)}setBackground(o){if(console.warn("viewer.setBackground is deprecated, use viewer.scene.setBackground instead."),this._rawBackground=o,o==null||typeof o!="string"&&typeof o!="number"&&!o.isColor)!o&&this.useRgbm&&this.console.error("Transparent background not supported with HDR RGBM rendering mode");else if(o===envMapBackground)return this.scene.setBackground("environment");!o||o!=null&&o.isTexture?(this.scene.setBackground(o),o||this.scene.setBackgroundColor(o)):this.scene.setBackgroundColor(o)}getBackground(o=!1){var c;if(console.warn("viewer.getBackground is deprecated, use viewer.scene.background instead."),o)return this._rawBackground;let d=(c=this._rawBackground)!==null&&c!==void 0?c:this.scene.getBackground();return d?(d!=null&&d.isVector4&&(d=cRGBMToLinear(d,7).getHexString()),d!=null&&d.isColor?d.getHexString():this._rawBackground===envMapBackground?this.scene.getEnvironment():d):null}getManager(){return this.getPluginByType("AssetManager")||this.addPluginSync(AssetManagerPlugin)}resetCamera({rootObject:o,centerOffset:c=new three_module.Pq0(1,1,1),targetOffset:d=new three_module.Pq0(0,0,0),..._}={}){if(this.scene.activeCamera){this.scene.matrixWorldNeedsUpdate=!0,this.scene.updateMatrixWorld(!0);const v=o?new Box3B().expandByObject(o,!0,!0):this.scene.getBounds(!0),b=v.getCenter(new three_module.Pq0),tt=.5*v.getSize(new three_module.Pq0).length();b.add(d.clone().multiplyScalar(tt)),this.scene.activeCamera.position=new three_module.Pq0(b.x+c.x*tt,b.y+c.y*tt,b.z+c.z*tt),this.scene.activeCamera.target=b,this.setDirty()}}async fitToView(o,c=1.5,d,_){var v,b;const tt=this.getPluginByType("CameraViews");tt?await(tt==null?void 0:tt.animateToFitObject(o,c,d,_,{min:((b=(v=this.scene.activeCamera.getControls())===null||v===void 0?void 0:v.minDistance)!==null&&b!==void 0?b:.5)+.5,max:1e3})):this.console.error("CameraViews plugin is required for fitToView to work")}async createObject3D(o,c=!1){var d;return(d=this.getManager())===null||d===void 0?void 0:d.addImportedSingle(o||new three_module.B69,{autoScale:!1,pseudoCenter:!1,addToRoot:c})}createPhysicalMaterial(o){return this.createMaterial("standard",o)}createMaterial(o,c){var d,_,v,b;if(c!=null&&c.isMaterial){const tt=(_=(d=this.getManager())===null||d===void 0?void 0:d.materials)===null||_===void 0?void 0:_.findMaterial(c.uuid);if(tt)return tt}return(b=(v=this.getManager())===null||v===void 0?void 0:v.materials)===null||b===void 0?void 0:b.generateFromTemplate(o,c)}serializePlugins(o,c){return Object.entries(this.plugins).map(d=>{if((!c||c.includes(d[1].constructor.PluginType))&&!this.serializePluginsIgnored.includes(d[1].constructor.PluginType))return d[1].serializeWithViewer!==!1&&typeof d[1].toJSON=="function"?d[1].toJSON(o):void 0}).filter(d=>!!d)}deserializePlugins(o,c){return o.forEach(d=>{if(!d.type)return void this.console.warn("Invalid plugin to import ",d);if(this.serializePluginsIgnored.includes(d.type))return;const _=this.getPluginByType(d.type);_&&_.fromJSON&&_.fromJSON(d,c)}),this}traverseSceneObjects(o){this.scene.modelRoot.modelObject.traverse(o)}toJSON(o,c){const d=Object.assign({version:ViewerApp.VERSION,type:"ViewerApp",metadata:{generator:"WebGiViewerApp",version:1},plugins:this.serializePlugins(o,c)},serializeObject(this,!0,o));return d.backgroundIntensity=this.scene.backgroundIntensity,d.useLegacyLights=this.renderer.useLegacyLights,d.background=d.scene.background||d.scene.backgroundColor,d.background==="environment"&&(d.background="envMapBackground"),d}fromJSON(o,c){var d,_,v,b,tt;const it={...o};return it.backgroundIntensity!==void 0&&((d=it.scene)===null||d===void 0?void 0:d.backgroundIntensity)===void 0&&(this.console.warn("old file format, backgroundIntensity moved to RootScene"),this.scene.backgroundIntensity=it.backgroundIntensity,delete it.backgroundIntensity),it.useLegacyLights!==void 0&&((_=it.renderManager)===null||_===void 0?void 0:_.useLegacyLights)===void 0&&(this.console.warn("old file format, useLegacyLights moved to BaseRenderer"),this.renderer.useLegacyLights=it.useLegacyLights,delete it.useLegacyLights),it.background!==void 0&&((v=it.scene)===null||v===void 0?void 0:v.background)===void 0&&(this.console.warn("old file format, background moved to RootScene"),it.background==="envMapBackground"?it.background="environment":typeof it.background=="number"?it.background=new three_module.Q1f().setHex(it.background,three_module.Zr2):typeof it.background=="string"?it.background=new three_module.Q1f().setStyle(it.background,three_module.Zr2):!((b=it.background)===null||b===void 0)&&b.isColor&&(it.background=new three_module.Q1f(it.background)),!((tt=it.background)===null||tt===void 0)&&tt.isColor?(this.scene.backgroundColor=it.background,this.scene.background=null):it.background?(this.scene.backgroundColor=new three_module.Q1f("#ffffff"),it.scene.background=it.background):(this.scene.backgroundColor=null,this.scene.background=null),delete it.background),deserializeObject(it,this,!0,c),Array.isArray(it.plugins)&&this.deserializePlugins(it.plugins,c),this}get renderManager(){return this._renderer}get assetManager(){return this.getManager()}async load(o,c){if(o)return await this.assetManager.addAssetSingle(o,c)}async setEnvironmentMap(o,{setBackground:c=!1,...d}={}){return this.scene.environment=o&&!o.isTexture?await this.assetManager.importer.importSingle(o,d)||null:o||null,c?this.setBackgroundMap(this.scene.environment):this.scene.environment}async setBackgroundMap(o,{setEnvironment:c=!1,...d}={}){return this.scene.background=o&&!o.isTexture?await this.assetManager.importer.importSingle(o,d)||null:o||null,c?this.setEnvironmentMap(this.scene.background):this.scene.background}_setActiveCameraView(o={}){if(o.type==="setView"){if(!o.camera)return void this.console.warn("Cannot find camera",o);this.scene.activeCamera.copyFromCamera(o.camera)}else o.type==="activateMain"&&(this.scene.activeCamera=o.camera?this.createCamera(o.camera):void 0)}}async function checkVersion(){var h;const o=window.location.href,c="https://dev-sandbox.pixotronics.com/webgi/";if(!o.startsWith(c)||rt("noUpdate")!==null)return!0;const d=(h=o.match(/\/webgi\/([0-9.a-zA-Z-]+)/))===null||h===void 0?void 0:h[1],_=(await(await fetch(c+"version.txt")).text()).split(`
`)[0];if(d&&d!==_){if(confirm(`New version ${_} is available, do you want to open?`)){const v=window.location.href.replace(d,_);return window.location.href=v,!1}window.location.href.includes("noUpdate")||(window.location.href+=(window.location.href.includes("?")?"&":"?")+"noUpdate")}return!0}ViewerApp.VERSION=VIEWER_VERSION,ViewerApp_decorate([serialize("renderManager")],ViewerApp.prototype,"_renderer",void 0),ViewerApp_decorate([serialize()],ViewerApp.prototype,"scene",void 0),ViewerApp_decorate([x$1(ViewerApp.prototype._renderEnabledChanged)],ViewerApp.prototype,"renderEnabled",void 0);const envMapBackground="envMapBackground";function buildScreenShader(h){return h!=null&&h.isShaderPass2?h:new ShaderPass2({...CopyShader,fragmentShader:`
                       varying vec2 vUv;
                       
                       ${Array.isArray(h)?h[0]:(h==null?void 0:h.pars)||""}
                       
                       void main() {

                            gl_FragColor = tDiffuseTexelToLinear (texture2D(tDiffuse, vUv));
                            
                            ${Array.isArray(h)?h[1]:typeof h=="string"?h:(h==null?void 0:h.main)||""}
                            
                        }`,uniforms:{tDiffuse:{value:null}}},"tDiffuse")}var tonemapping=`int getToneMapBit(in int number){
#ifdef WebGL2Context
return(number/2)%2;
#else
return int(mod(floor(float(number)/2.),2.));
#endif
}vec3 TonemappingSaturation(vec3 rgb){const vec3 W=vec3(0.2125,0.7154,0.0721);vec3 intensity=vec3(dot(rgb,W));return mix(intensity,rgb,toneMappingSaturation);}vec3 TonemappingContrast(vec3 color){return(color-vec3(0.5))*toneMappingContrast+vec3(0.5);}vec4 ToneMapping(in vec4 color){vec4 outColor=opacity*color;
#if USE_DEPTH_TONEMAP > 0
bool doTonemap=getToneMapBit(getGBufferFlags(vUv).a)>0;float depth=getDepth(vUv);vec4 transparentCol=tTransparentTexelToLinear(texture2D(tTransparent,vUv));
#if TONEMAP_BACKGROUND < 1 || TRANSPARENT_BACKGROUND > 0
bool isBackground=depth>0.99&&transparentCol.a<0.001;if(isBackground)doTonemap=false;
#endif
if(doTonemap){
#endif
#if defined( TONE_MAPPING )
outColor.rgb=toneMapping(outColor.rgb);outColor.rgb=TonemappingContrast(outColor.rgb);outColor.rgb=TonemappingSaturation(outColor.rgb);
#endif
#if USE_DEPTH_TONEMAP > 0
}
#if TRANSPARENT_BACKGROUND > 0
if(isBackground)outColor.a=0.;if(depth>0.99&&transparentCol.a>=0.001)outColor.a=transparentCol.a;
#endif
if(depth<0.00001)outColor.a=0.;
#if defined(DEBUG_DEPTH) && DEBUG_DEPTH > 0
outColor.rgb=vec3(sRGBToLinear(vec4((1.-depth))).x);
#endif
#endif
return outColor;}`;class CombinedPostPass extends ShaderPass2{constructor(o){super({vertexShader:CopyShader.vertexShader,uniforms:{tDiffuse:{value:null},tNormalDepth:{value:null},tGBufferFlags:{value:null},tTransparent:{value:null}},defines:{},fragmentShader:`
                varying vec2 vUv;
                ${o[0]}
                void main() {
                    gl_FragColor = tDiffuseTexelToLinear (texture2D(tDiffuse, vUv));
                    #glMarker
                    ${o[1]}
                    
                    gl_FragColor.rgb *= gl_FragColor.a; // premultiply alpha
                }
                `},"tDiffuse","tTransparent"),this.uiConfig=void 0,this.material.transparent=!1,this.material.side=three_module.hB5}render(o,c,d,_,v){super.render(o,c,d,_,v),this._lastReadBuffer=d,this.needsSwap=!0}reRender(o,c,d,_){this._lastReadBuffer&&this.render(o,c,this._lastReadBuffer,d,_)}dispose(){this._lastReadBuffer=void 0,super.dispose()}}class CombinedPostPlugin extends GenericFilterPlugin{get renderToScreen(){return this._renderToScreen}constructor(o=!0,c=!0){super(),this.depthTonemap=o,this.passId="combinedPost",this.dependencies=[GBufferPlugin],this.toJSON=void 0,this._beforeFilters=[],this._afterFilters=["render","screen"],this._requiredFilters=["render"],this._renderToScreen=!0,this._postFrame=()=>{var d,_;this._needsReRender&&this._renderToScreen&&this._viewer&&this.pass&&(this._needsReRender=!1,(_=(d=this.pass).update)===null||_===void 0||_.call(d),this.pass.passObject.reRender(this._viewer.renderer.rendererObject,null))},this._needsReRender=!1,this._setDirty=this._setDirty.bind(this),this._renderToScreen=c}async onAdded(o){var c,d;return!((d=(c=this._viewer)===null||c===void 0?void 0:c.screenShader)===null||d===void 0)&&d.isShaderPass2&&(this._renderToScreen=!1),this._renderToScreen&&S$2(o.renderer.passes.find(_=>_.passId==="screen"),"enabled",!1,!0,!0),o.addEventListener("postFrame",this._postFrame),super.onAdded(o)}async onRemove(o){return this._renderToScreen&&S$2(o.renderer.passes.find(c=>c.passId==="screen"),"enabled",!0,!0,!0),super.onRemove(o)}passCtor(o){var c,d;const _=o.screenShader,v=["",""];this._renderToScreen&&!_.isShaderPass2&&(v[0]=Array.isArray(_)?_[0]:(_==null?void 0:_.pars)||"",v[1]=Array.isArray(_)?_[1]:typeof _=="string"?_:(_==null?void 0:_.main)||"");const b=new CombinedPostPass(v);return S$2((d=(c=b.uiConfig)===null||c===void 0?void 0:c.children)===null||d===void 0?void 0:d.find(tt=>(tt==null?void 0:tt.label)==="Enabled"),"hidden",!0,!0),b}_update(o){var c,d,_;return!!super._update(o)&&(this._pass.passObject.updateShaderProperties((c=this._viewer)===null||c===void 0?void 0:c.getPlugin(GBufferPlugin)),this._pass.passObject.material.uniforms.tTransparent.value=((_=(d=this._viewer)===null||d===void 0?void 0:d.renderFilter.passObject.transparentTarget)===null||_===void 0?void 0:_.texture)||null,!0)}_setDirty(){this.pass&&(this.pass.dirty=!0)}get uiConfig(){var o,c,d;return(d=(c=(o=this.pass)===null||o===void 0?void 0:o.passObject)===null||c===void 0?void 0:c.uiConfig)!==null&&d!==void 0?d:{}}addExtension(o){this.pass.passObject.material.registerMaterialExtensions([o])}reRender(){this._renderToScreen?this._needsReRender=!0:this._setDirty()}}CombinedPostPlugin.PluginType="CombinedPostPlugin";var GenericExtensionPlugin_decorate=function(h,o,c,d){var _,v=arguments.length,b=v<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(h,o,c,d);else for(var tt=h.length-1;tt>=0;tt--)(_=h[tt])&&(b=(v<3?_(b):v>3?_(o,c,b):_(o,c))||b);return v>3&&b&&Object.defineProperty(o,c,b),b};class GenericExtensionPlugin extends AViewerPlugin{constructor(){super(...arguments),this.enabled=!0,this.dependencies=[CombinedPostPlugin]}get uiConfig(){var o;return(o=this._extension)===null||o===void 0?void 0:o.uiConfig}get config(){return this._extension}disposeExtension(){}async onAdded(o){var c;await super.onAdded(o),this._extension=this.generateExtension(o),(c=o.getPlugin(CombinedPostPlugin))===null||c===void 0||c.addExtension(this._extension)}async onRemove(o){this.disposeExtension(),this._extension=void 0,await super.onRemove(o)}}function updateBit(h,o,c){return h&~(1<<o)|(c?1:0)<<o}function clearBit(h,o){return h&~(1<<o)}GenericExtensionPlugin_decorate([serialize("extension")],GenericExtensionPlugin.prototype,"_extension",void 0),GenericExtensionPlugin_decorate([serialize()],GenericExtensionPlugin.prototype,"enabled",void 0);var TonemapPlugin_decorate=function(h,o,c,d){var _,v=arguments.length,b=v<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(h,o,c,d);else for(var tt=h.length-1;tt>=0;tt--)(_=h[tt])&&(b=(v<3?_(b):v>3?_(o,c,b):_(o,c))||b);return v>3&&b&&Object.defineProperty(o,c,b),b};const Uncharted2Tonemapping=three_module.g7M;let TonemapExtension=class{constructor(h,o=!0){this.depthTonemap=o,this.toneMapping=three_module.FV,this.tonemapBackground=!0,this.clipBackground=!1,this.exposure=1,this.saturation=1,this.contrast=1,this.renderDepth=!1,this.enabled=!0,this._rendererState={},this.extraUniforms={opacity:{value:1},toneMappingContrast:{value:1},toneMappingSaturation:{value:1}},this.parsFragmentSnippet=(c,d)=>this.enabled?fe$1`
            ${this.depthTonemap?unpackGbuffer:""}
            #define USE_DEPTH_TONEMAP ${this.depthTonemap?"1":"0"}
            uniform float opacity;
            uniform float toneMappingContrast;
            uniform float toneMappingSaturation;
            ${tonemapping}
        `:"",this._combinedPostPlugin=h.getPlugin(CombinedPostPlugin),this._setDirty=this._setDirty.bind(this),this.depthTonemap=o}shaderExtender(h,o,c){this.enabled&&(h.fragmentShader=shaderReplaceString(h.fragmentShader,"#glMarker",`
gl_FragColor = ToneMapping(gl_FragColor);
`,{prepend:!0}))}onObjectRender(h,o,c){if(!this.enabled)return;const{toneMapping:d,toneMappingExposure:_,outputColorSpace:v}=c;this._rendererState.toneMapping=d,this._rendererState.toneMappingExposure=_,this._rendererState.outputColorSpace=v;let b=this.tonemapBackground?"1":"0";o.materialObject.defines.TONEMAP_BACKGROUND!==b&&(o.materialObject.defines.TONEMAP_BACKGROUND=b,o.materialObject.needsUpdate=!0),b=this.clipBackground?"1":"0",o.materialObject.defines.TRANSPARENT_BACKGROUND!==b&&(o.materialObject.defines.TRANSPARENT_BACKGROUND=b,o.materialObject.needsUpdate=!0),b=this.renderDepth?"1":"0",o.materialObject.defines.DEBUG_DEPTH!==b&&(o.materialObject.defines.DEBUG_DEPTH=b,o.materialObject.needsUpdate=!0),c.toneMapping=this.toneMapping,c.toneMappingExposure=this.exposure,c.outputColorSpace=three_module.er$,o.materialObject.toneMapped=!0,o.materialObject.needsUpdate=!0,this.extraUniforms.toneMappingContrast.value=this.contrast,this.extraUniforms.toneMappingSaturation.value=this.saturation}onAfterRender(h,o,c){c.toneMapping=this._rendererState.toneMapping,c.toneMappingExposure=this._rendererState.toneMappingExposure,c.outputColorSpace=this._rendererState.outputColorSpace}getUiConfig(){return this.uiConfig}computeCacheKey(h){return this.enabled?"1":"0"}isCompatible(h){return!0}_setDirty(){this._combinedPostPlugin&&(this._combinedPostPlugin.pass.dirty=!0)}setDirty(){var h;(h=this.__setDirty)===null||h===void 0||h.call(this),this._setDirty()}};TonemapExtension.PluginType="Tonemap",TonemapPlugin_decorate([uiDropdown("Mode",[["Linear",three_module.kyO],["Reinhard",three_module.Mjd],["Cineon",three_module.nNL],["ACESFilmic",three_module.FV],["Uncharted2",Uncharted2Tonemapping]].map(h=>({label:h[0],value:h[1]})),{limitedUi:!0}),x$1(TonemapExtension.prototype._setDirty),serialize()],TonemapExtension.prototype,"toneMapping",void 0),TonemapPlugin_decorate([x$1(TonemapExtension.prototype._setDirty),uiToggle("Tonemap Background",{limitedUi:!0}),serialize()],TonemapExtension.prototype,"tonemapBackground",void 0),TonemapPlugin_decorate([x$1(TonemapExtension.prototype._setDirty),uiToggle("Clip Background"),serialize()],TonemapExtension.prototype,"clipBackground",void 0),TonemapPlugin_decorate([x$1(TonemapExtension.prototype._setDirty),uiSlider("Exposure",[0,2*Math.PI],.01,{limitedUi:!0}),serialize()],TonemapExtension.prototype,"exposure",void 0),TonemapPlugin_decorate([x$1(TonemapExtension.prototype._setDirty),uiSlider("Saturation",[0,2],.01,{limitedUi:!0}),serialize()],TonemapExtension.prototype,"saturation",void 0),TonemapPlugin_decorate([x$1(TonemapExtension.prototype._setDirty),uiSlider("Contrast",[0,2],.01,{limitedUi:!0}),serialize()],TonemapExtension.prototype,"contrast",void 0),TonemapPlugin_decorate([x$1(TonemapExtension.prototype._setDirty),uiToggle("Render Depth")],TonemapExtension.prototype,"renderDepth",void 0),TonemapExtension=TonemapPlugin_decorate([uiFolder("Tonemapping")],TonemapExtension);class TonemapPlugin extends GenericExtensionPlugin{constructor(o=!0){super(),this.depthTonemap=o,this.depthTonemap=o,this.updateGBuffer=this.updateGBuffer.bind(this)}fromJSON(o,c){return o.pass&&((o={...o}).extension={...o.pass},delete o.extension.enabled,delete o.pass),super.fromJSON(o,c)}async onAdded(o){var c;await super.onAdded(o),(c=o.getPlugin(GBufferPlugin))===null||c===void 0||c.registerGBufferUpdater(this.updateGBuffer)}generateExtension(o){return new TonemapExtension(o,this.depthTonemap)}get exposure(){var o,c;return(c=(o=this._extension)===null||o===void 0?void 0:o.exposure)!==null&&c!==void 0?c:1}set exposure(o){this._extension&&(this._extension.exposure=o,this._extension.setDirty())}get saturation(){var o,c;return(c=(o=this._extension)===null||o===void 0?void 0:o.saturation)!==null&&c!==void 0?c:1}set saturation(o){this._extension&&(this._extension.saturation=o,this._extension.setDirty())}get contrast(){var o,c;return(c=(o=this._extension)===null||o===void 0?void 0:o.contrast)!==null&&c!==void 0?c:1}set contrast(o){this._extension&&(this._extension.contrast=o,this._extension.setDirty())}get toneMapping(){var o,c;return(c=(o=this._extension)===null||o===void 0?void 0:o.toneMapping)!==null&&c!==void 0?c:three_module.kyO}set toneMapping(o){this._extension&&(this._extension.toneMapping=o,this._extension.setDirty())}updateGBuffer(o,c){var d,_;if(o instanceof three_module.eaF&&!((d=o.material)===null||d===void 0)&&d.userData){const v=((_=o.material)===null||_===void 0?void 0:_.userData.postTonemap)===!1?0:1;c.w=updateBit(c.w,1,v)}}}TonemapPlugin.PluginType="Tonemap",three_module.vxI.tonemapping_pars_fragment=three_module.vxI.tonemapping_pars_fragment.replace("vec3 CustomToneMapping( vec3 color ) { return color; }",`

// source: http://filmicworlds.com/blog/filmic-tonemapping-operators/
#define Uncharted2Helper( x ) max( ( ( x * ( 0.15 * x + 0.10 * 0.50 ) + 0.20 * 0.02 ) / ( x * ( 0.15 * x + 0.50 ) + 0.20 * 0.30 ) ) - 0.02 / 0.30, vec3( 0.0 ) )
vec3 Uncharted2ToneMapping( vec3 color ) {

	// John Hable's filmic operator from Uncharted 2 video game
	color *= toneMappingExposure;
	return saturate( Uncharted2Helper( color ) / Uncharted2Helper( vec3( 1.0 ) ) );

}

vec3 CustomToneMapping( vec3 color ) { return Uncharted2ToneMapping( color ); }

`);var chromaticAberration="vec4 chromaticAberration(){vec2 distFromCenter=vUv-0.5;vec2 aberrated=aberrationIntensity*pow(abs(distFromCenter),vec2(2.));vec4 color=tDiffuseTexelToLinear(texture2D(tDiffuse,vUv));vec4 outColor=vec4(tDiffuseTexelToLinear(texture2D(tDiffuse,vUv+aberrated)).r,color.g,tDiffuseTexelToLinear(texture2D(tDiffuse,vUv-aberrated)).b,color.a);return outColor;}",ChromaticAberrationPlugin_decorate=function(h,o,c,d){var _,v=arguments.length,b=v<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(h,o,c,d);else for(var tt=h.length-1;tt>=0;tt--)(_=h[tt])&&(b=(v<3?_(b):v>3?_(o,c,b):_(o,c))||b);return v>3&&b&&Object.defineProperty(o,c,b),b};let ChromaticAberrationExtension=class{constructor(h){this.enabled=!1,this.aberrationIntensity=.01,this.extraUniforms={aberrationIntensity:{value:1}},this.parsFragmentSnippet=(o,c)=>this.enabled?fe$1`
            uniform float aberrationIntensity;
            ${chromaticAberration}
        `:"",this._combinedPostPlugin=h.getPlugin(CombinedPostPlugin),this._setDirty=this._setDirty.bind(this)}shaderExtender(h,o,c){this.enabled&&(h.fragmentShader=shaderReplaceString(h.fragmentShader,"#glMarker",` 
            gl_FragColor = chromaticAberration();
            #glMarker
        `))}onObjectRender(h,o,c){this.enabled&&(this.extraUniforms.aberrationIntensity.value=this.aberrationIntensity)}getUiConfig(){return this.uiConfig}computeCacheKey(h){return this.enabled?"1":"0"}isCompatible(h){return!0}_setDirty(){this._combinedPostPlugin&&(this._combinedPostPlugin.pass.dirty=!0)}setDirty(){var h;(h=this.__setDirty)===null||h===void 0||h.call(this),this._setDirty()}};ChromaticAberrationExtension.PluginType="ChromaticAberration",ChromaticAberrationPlugin_decorate([x$1(ChromaticAberrationExtension.prototype._setDirty),uiToggle("Enable"),serialize()],ChromaticAberrationExtension.prototype,"enabled",void 0),ChromaticAberrationPlugin_decorate([x$1(ChromaticAberrationExtension.prototype._setDirty),uiSlider("Intensity",[0,.1],.001,{limitedUi:!0}),serialize()],ChromaticAberrationExtension.prototype,"aberrationIntensity",void 0),ChromaticAberrationExtension=ChromaticAberrationPlugin_decorate([uiFolder("ChromaticAberration")],ChromaticAberrationExtension);class ChromaticAberrationPlugin extends GenericExtensionPlugin{constructor(){super()}generateExtension(o){return new ChromaticAberrationExtension(o)}get intensity(){var o,c;return(c=(o=this._extension)===null||o===void 0?void 0:o.aberrationIntensity)!==null&&c!==void 0?c:1}set intensity(o){this._extension&&(this._extension.aberrationIntensity=o,this._extension.setDirty())}}ChromaticAberrationPlugin.PluginType="ChromaticAberration";class MultiFilterPlugin extends AViewerPlugin{get passes(){if(!this._passes)throw"Plugin not yet added to the viewer";return this._passes}get pipeline(){return this._pipeline}set pipeline(o){this._pipeline=o}constructor(){super(),this._pipeline=[]}async onAdded(o){await super.onAdded(o);const c=this.createPasses(o);this._passes=Object.fromEntries(c.map(d=>(d.passId||(console.warn("no id found for pass",d),d.passId=esm_browser_v4()),o.renderer.registerPass(d,!0),[d.passId,d])))}async onRemove(o){var c;if(this._passes){for(const d of[...Object.values(this._passes)]){const _=d;o.renderer.unregisterPass(_),(c=_==null?void 0:_.dispose)===null||c===void 0||c.call(_)}this._passes=void 0}await super.onRemove(o)}toJSON(o){var c;const d=super.toJSON(o);if(!d.type)return d;const _=Object.entries(this.passes);d.passes={};for(const[v,b]of _)d.passes[v]=serializeObject((c=b==null?void 0:b.passObject)!==null&&c!==void 0?c:b,!1,o);return d}fromJSON(o,c){var d;if(!super.fromJSON(o,c))return null;if(o.passes){const _=Object.entries(this.passes);for(const[v,b]of _)deserializeObject(o.passes[v],(d=b==null?void 0:b.passObject)!==null&&d!==void 0?d:b,!1,c)}return this}}var ssaoBilateral=`uniform vec2 tDiffuseSize;uniform vec2 bilDirection;varying vec2 vUv;uniform bool smoothEnabled;uniform float edgeSharpness;vec4 bilaterialAO(){vec4 color=clamp((texture2D(tDiffuse,vUv.xy)).B_SRC_ACCESSOR,0.,5.);if(!smoothEnabled)return color;float depth;vec3 normal;getDepthNormal(vUv.xy,depth,normal);float gaussianWeights[4];gaussianWeights[0]=0.153170;gaussianWeights[1]=0.144893;gaussianWeights[2]=0.122649;gaussianWeights[3]=0.092902;float Z=gaussianWeights[0]+0.03;vec4 final_colour=Z*color;vec2 nuv;vec4 cc;float dp;vec3 nor;vec2 direction=bilDirection/tDiffuseSize.xy;
#pragma unroll_loop_start
for(int i=0;i<6;i++){direction*=-1.;nuv=vUv+2.*direction*float(UNROLLED_LOOP_INDEX/2+1);getDepthNormal(nuv,dp,nor);if(dp<0.999){float normalCloseness=dot(normal,nor);normalCloseness*=normalCloseness;float normalError=(1.-normalCloseness)*8.;float normalWeight=max((1.-normalError*edgeSharpness),0.00);float depthWeight=max(0.,1.-edgeSharpness*4000.*abs(depth-dp));float kernelWeight=gaussianWeights[UNROLLED_LOOP_INDEX/2]+0.03;float bilateralWeight=kernelWeight*depthWeight*normalWeight;Z+=bilateralWeight;cc=clamp((texture2D(tDiffuse,nuv)).B_SRC_ACCESSOR,0.,5.);final_colour+=bilateralWeight*cc;}}
#pragma unroll_loop_end
final_colour/=Z;return final_colour;}void main(){vec4 ao=clamp(bilaterialAO(),vec4(0.),vec4(1.));gl_FragColor=ao;}`,BilateralFilterPass_decorate=function(h,o,c,d){var _,v=arguments.length,b=v<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(h,o,c,d);else for(var tt=h.length-1;tt>=0;tt--)(_=h[tt])&&(b=(v<3?_(b):v>3?_(o,c,b):_(o,c))||b);return v>3&&b&&Object.defineProperty(o,c,b),b};class BilateralFilterPass extends ShaderPass2{constructor(o,c,d="rgba"){super({vertexShader:CopyShader.vertexShader,fragmentShader:c+ssaoBilateral,uniforms:{bilDirection:{value:new three_module.I9Y(1,0)},tNormalDepth:{value:null},tDiffuse:{value:o.texture},tDiffuseSize:{value:new three_module.I9Y}},defines:{B_SRC_ACCESSOR:d}},"tDiffuse"),this.smoothEnabled=!0,this.edgeSharpness=.1,this._target=o,this.clear=!1,this.needsSwap=!1}render(o,c,d,_,v){var b,tt,it,nt;this.enabled&&(this.uniforms.bilDirection.value.set(1,0),this.uniforms.tDiffuse.value=this._target.texture,this.uniforms.tDiffuseSize.value.set(((b=this.uniforms.tDiffuse.value)===null||b===void 0?void 0:b.image.width)||0,((tt=this.uniforms.tDiffuse.value)===null||tt===void 0?void 0:tt.image.height)||0),super.render(o,c,this._target,_,v),this.uniforms.bilDirection.value.set(0,1),this.uniforms.tDiffuse.value=c.texture,this.uniforms.tDiffuseSize.value.set(((it=this.uniforms.tDiffuse.value)===null||it===void 0?void 0:it.image.width)||0,((nt=this.uniforms.tDiffuse.value)===null||nt===void 0?void 0:nt.image.height)||0),super.render(o,this._target,c,_,v))}}BilateralFilterPass_decorate([serialize(),uniform()],BilateralFilterPass.prototype,"smoothEnabled",void 0),BilateralFilterPass_decorate([serialize(),uniform()],BilateralFilterPass.prototype,"edgeSharpness",void 0);var defaultVertex="varying vec2 vUv;void main(){vUv=uv;gl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.);}",randomHelpers=`#ifndef BASIC_RANDOM_HELPERS
#define BASIC_RANDOM_HELPERS 
uniform float frameCount;float random(float n){return fract(sin(n)*43758.5453123);}float random2(vec2 n,float x){n+=x;return fract(sin(dot(n.xy,vec2(12.9898,78.233)))*43758.5453);}float random3(vec3 v){v=fract(v*443.8975);v+=dot(v,v.yzx+19.19);return fract((v.x+v.y)*v.z);}float interleavedGradientNoise(const in vec2 fragCoord,const in float seed){vec3 magic=vec3(0.06711056,0.00583715,52.9829189);return fract(magic.z*fract(dot(fragCoord.xy+seed*vec2(2.083,4.867),magic.xy)));}vec3 hash3(vec2 p){vec3 q=vec3(dot(p,vec2(127.1,311.7)),dot(p,vec2(269.5,183.3)),dot(p,vec2(419.2,371.9)));return fract(sin(q)*43758.5453);}
#endif
`,ssao=`#include <common>
#include <packing>
varying vec2 vUv;uniform vec2 cameraNearFar;uniform mat4 projection;uniform sampler2D tLastThis;uniform vec4 saoData;uniform vec4 saoBiasEpsilon;uniform vec2 screenSize;const float INV_NUM_SAMPLES=1./float(NUM_SAMPLES);int getSelectionBit(in int number){
#ifdef WebGL2Context
return(number/8)%2;
#else
return int(mod(floor(float(number)/4.),2.));
#endif
}float getViewZFromNDCZ(const in float depth){
#if PERSPECTIVE_CAMERA == 1
return perspectiveDepthToViewZ(depth,cameraNearFar.x,cameraNearFar.y);
#else
return orthographicDepthToViewZ(depth,cameraNearFar.x,cameraNearFar.y);
#endif
}vec3 packFloatToRGB(const in float x){const vec3 code=vec3(1.,255.,65025.);vec3 pack=vec3(code*x);pack.gb=fract(pack.gb);pack.rg-=pack.gb*(1./256.);return pack;}vec3 getViewPositionFromViewZ(const in vec2 uv,const in float viewDepth){vec2 uv_=2.*uv-1.;float xe=-(uv_.x+projection[2][0])*viewDepth/projection[0][0];float ye=-(uv_.y+projection[2][1])*viewDepth/projection[1][1];return vec3(xe,ye,viewDepth);}float decodeDepth(const in vec2 uv){vec4 uncodedDepth;
#if DEPTH_PACKING_MODE == 2
uncodedDepth=texture2D(tNormalDepth,uv);
#else
uncodedDepth=texture2D(tDepth,uv);
#endif
#if DEPTH_PACKING_MODE == 0
return uncodedDepth.x;
#elif DEPTH_PACKING_MODE == 1
#if LINEAR_DEPTH == 1
return pow2(unpackRGBAToDepth(uncodedDepth));
#else
return unpackRGBAToDepth(uncodedDepth);
#endif
#else
return pow2(unpack16(uncodedDepth.xy));
#endif
}vec3 getPositionFromOffset(const in vec2 uvOffset){float d=decodeDepth(uvOffset);
#if LINEAR_DEPTH == 0
float centerViewZ=getViewZFromNDCZ(d);return getViewPositionFromViewZ(uvOffset,centerViewZ);
#else
d=mix(-cameraNearFar.x,-cameraNearFar.y,d);return getViewPositionFromViewZ(uvOffset,d);
#endif
}float getCavityAO(){float cutoff=-0.65;float curvature=float(getGBufferFlags(vUv).r)/255.;curvature=2.*curvature-1.;curvature=curvature*4.;float smoothCurvature=smoothstep(0.,1.,curvature-cutoff);smoothCurvature+=saoData.x;smoothCurvature=clamp(smoothCurvature,0.,1.);return 1.-smoothCurvature;}float getOcclusion(const in vec2 uv,const in int id,const in float randomAngle,const in float occlusionSphereRadius,const in vec3 centerPosition,const in vec3 centerNormal){float screenSpaceRadius=(float(id)+mod(randomAngle,1.)+0.5)*INV_NUM_SAMPLES;float angle=screenSpaceRadius*(float(NUM_SPIRAL_TURNS)*6.28318)+randomAngle;screenSpaceRadius=(screenSpaceRadius*occlusionSphereRadius);vec2 uvOffset=uv+floor(screenSpaceRadius*vec2(cos(angle),sin(angle)))/screenSize;
#if CHECK_GBUFFER_FLAG == 1
if(getSelectionBit(getGBufferFlags(uvOffset.xy).a)<1)return 0.;
#endif
vec3 samplePosition=getPositionFromOffset(uvOffset);vec3 direction=samplePosition-centerPosition;float d2=dot(direction,direction)/(saoBiasEpsilon.w*saoBiasEpsilon.w);float ao=max((dot(centerNormal,direction)/saoBiasEpsilon.w-saoBiasEpsilon.x)/(saoBiasEpsilon.z*d2+saoBiasEpsilon.y),0.);return ao;}void main(){float centerDepth;vec3 centerNormal;getDepthNormal(vUv,centerDepth,centerNormal);
#if LINEAR_DEPTH == 0
float centerViewZ=getViewZFromNDCZ(centerDepth);
#else
float centerViewZ=mix(-cameraNearFar.x,-cameraNearFar.y,centerDepth);
#endif
vec3 centerPosition=getViewPositionFromViewZ(vUv,centerViewZ);float occlusionSphereScreenRadius=0.09*saoData.z*saoBiasEpsilon.w/(-centerPosition.z);float randomAngle=6.2*random3(vec3(vUv,frameCount*0.1));float sum=0.;sum+=getOcclusion(vUv,0,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#if NUM_SAMPLES > 1
sum+=getOcclusion(vUv,1,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 2
sum+=getOcclusion(vUv,2,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 3
sum+=getOcclusion(vUv,3,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 4
sum+=getOcclusion(vUv,4,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 5
sum+=getOcclusion(vUv,5,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 6
sum+=getOcclusion(vUv,6,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 7
sum+=getOcclusion(vUv,7,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 8
sum+=getOcclusion(vUv,8,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 9
sum+=getOcclusion(vUv,9,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 10
sum+=getOcclusion(vUv,10,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
float aoValue=sum*saoData.y*INV_NUM_SAMPLES;float cavityAO=getCavityAO();aoValue=saoData.w>0.?max(aoValue,cavityAO):aoValue;aoValue=clamp(1.-max(aoValue,0.),0.,1.);gl_FragColor.gba=packFloatToRGB(centerDepth);gl_FragColor.r=(vec4(aoValue)).r;}`,ssaoPatch=`#ifndef USE_TRANSMISSION
#if defined(SSAO_ENABLED) && SSAO_ENABLED > 0
float ambientOcclusion=tSSAOMapTexelToLinear(texture2D(tSSAOMap,viewToScreen(vViewPosition.xyz).xy)).r;reflectedLight.indirectDiffuse*=ambientOcclusion;
#if defined( USE_ENVMAP )
float dotNV=saturate(dot(geometryNormal,geometryViewDir));reflectedLight.indirectSpecular*=computeSpecularOcclusion(dotNV,ambientOcclusion,material.roughness);
#endif
#else
#include <aomap_fragment>
#endif
#endif
`,simpleCameraHelpers=`#ifndef SIMPLE_CAMERA_HELPERS
#define SIMPLE_CAMERA_HELPERS 
#ifndef USE_TRANSMISSION
uniform mat4 projectionMatrix;
#endif
vec3 viewToScreen(const in vec3 pos){vec4 projected=projectionMatrix*vec4(pos,1.);return vec3(0.5+0.5*projected.xy/projected.w,projected.w);}
#endif
`,SSAOPass_decorate=function(h,o,c,d){var _,v=arguments.length,b=v<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(h,o,c,d);else for(var tt=h.length-1;tt>=0;tt--)(_=h[tt])&&(b=(v<3?_(b):v>3?_(o,c,b):_(o,c))||b);return v>3&&b&&Object.defineProperty(o,c,b),b};class SSAOPass extends ShaderPass2{constructor(o,c,d){super({defines:{LINEAR_DEPTH:1,NUM_SAMPLES:11,NUM_SPIRAL_TURNS:3,DEPTH_NORMAL_TEXTURE:1,DEPTH_PACKING_MODE:2,PERSPECTIVE_CAMERA:1,CHECK_GBUFFER_FLAG:0},uniforms:{tLastThis:{value:null},tNormalDepth:{value:null},tGBufferFlags:{value:null},screenSize:{value:new three_module.I9Y(512,512)},saoData:{value:new three_module.IUQ},frameCount:{value:0},cameraNearFar:{value:new three_module.I9Y(.1,1e3)},projection:{value:new three_module.kn4},saoBiasEpsilon:{value:new three_module.IUQ(1,1,1,1)},sceneBoundingRadius:{value:0}},vertexShader:defaultVertex,fragmentShader:`

${randomHelpers}

${d}

${ssao}

            `},"tDiffuse"),this.parameters={intensity:.25,occlusionWorldRadius:1,bias:.001,falloff:1.3,useSmallScaleAO:!1,intensitySmallAO:.2,autoRadius:!1,projScale:1},this._smoothEnabled=!0,this.materialExtension={shaderExtender:(_,v,b)=>{_.defines.SSAO_ENABLED&&(_.fragmentShader=shaderReplaceString(_.fragmentShader,"#include <aomap_fragment>",ssaoPatch))},onObjectRender:(_,v,b)=>{var tt,it;this.materialExtension.extraUniforms.tSSAOMap.value=(tt=this._target)===null||tt===void 0?void 0:tt.texture;const nt=v.materialObject;let lt=this.enabled&&b.userData.screenSpaceRendering!==!1&&!(!((it=v.userData)===null||it===void 0)&&it.ssaoDisabled)?1:0;nt.defines.SSAO_ENABLED!==lt&&(nt.defines.SSAO_ENABLED=lt,nt.needsUpdate=!0),lt=this._target.texture,this.materialExtension.extraUniforms.tSSAOMap.value!==lt&&(this.materialExtension.extraUniforms.tSSAOMap.value=lt,nt.needsUpdate=!0)},parsFragmentSnippet:_=>{var v,b;return fe$1`
             uniform sampler2D tSSAOMap;
             ${getTexelDecoding("tSSAOMap",(b=(v=this._target)===null||v===void 0?void 0:v.texture)===null||b===void 0?void 0:b.colorSpace)}
            ${simpleCameraHelpers}
        `},extraUniforms:{tSSAOMap:{value:null}},computeCacheKey:_=>{var v,b;return this.enabled?"1":"0"+((b=(v=this._target)===null||v===void 0?void 0:v.texture)===null||b===void 0?void 0:b.colorSpace)},isCompatible:_=>{var v;return!(!((v=_.materialObject.userData)===null||v===void 0)&&v.ssaoDisabled)&&_.isMeshStandardMaterial2}},this._renderer=o,this._target=c,this.needsSwap=!1,this.clear=!0,this.bilateralPass=new BilateralFilterPass(this._target,d,"rrrr")}get smoothEnabled(){return this._smoothEnabled}set smoothEnabled(o){this._smoothEnabled=o,this.bilateralPass.enabled=o,this.bilateralPass.uniforms.smoothEnabled.value=o}render(o,c,d,_,v){this.enabled&&(this._updateParameters(),this._renderer.blit(this._target.texture,c,{}),this.uniforms.tLastThis.value=c.texture,super.render(o,this._target,d,_,v),this._smoothEnabled&&this.bilateralPass.render(o,c,d,_,v))}_updateParameters(){const o=this.material.uniforms.saoData.value;o.x=this.parameters.intensitySmallAO,o.y=this.parameters.intensity,o.z=this.parameters.occlusionWorldRadius,o.w=this.parameters.useSmallScaleAO,o.z*=this.parameters.projScale;const c=this.material.uniforms.saoBiasEpsilon.value;if(c.x=this.parameters.bias,c.y=.001,c.z=this.parameters.falloff,this.parameters.autoRadius){const d=this.material.uniforms.sceneBoundingRadius.value;c.w=d}else c.w=1}}SSAOPass_decorate([serialize()],SSAOPass.prototype,"bilateralPass",void 0),SSAOPass_decorate([serialize()],SSAOPass.prototype,"parameters",void 0);class SSAOPlugin extends MultiFilterPlugin{get aoTarget(){return this._aoTarget}constructor(){super(),this.dependencies=[AssetManagerPlugin,GBufferPlugin],this.setDirty=this.setDirty.bind(this),this.updateGBuffer=this.updateGBuffer.bind(this)}async onAdded(o){var c;return o.getPluginByType("Ground")&&console.error("GroundPlugin must be added after SSAOPlugin"),(c=o.getPlugin(GBufferPlugin))===null||c===void 0||c.registerGBufferUpdater(this.updateGBuffer),super.onAdded(o)}updateGBuffer(o,c){var d;if(o instanceof three_module.eaF&&!((d=o.material)===null||d===void 0)&&d.userData){const _=o.material.userData.ssaoCastDisabled||o.material.userData.pluginsDisabled,v=_?0:1;c.w=updateBit(c.w,3,v),_&&this.passes.ssao.passObject&&this.passes.ssao.passObject.material.defines.CHECK_GBUFFER_FLAG!==1&&(this.passes.ssao.passObject.material.defines.CHECK_GBUFFER_FLAG=1,this.passes.ssao.passObject.material.needsUpdate=!0)}}createPasses(o){var c,d;return this._aoTarget=o.renderer.createTarget({sizeMultiplier:1}),[makeFilter(o,{passId:"ssao",after:["gbuffer"],before:["render"],required:["render","gbuffer"],passObject:new SSAOPass(o.renderer,this._aoTarget,(d=(c=o.getPlugin(GBufferPlugin))===null||c===void 0?void 0:c.getUnpackSnippet())!==null&&d!==void 0?d:""),update(){var _;const v=Math.max(1,(_=(o==null?void 0:o.scene.activeCamera.modelObject).fov)!==null&&_!==void 0?_:1),b=((o==null?void 0:o.canvas.height)||1)/(2*Math.tan(.5*v*three_module.cj9.DEG2RAD));this.passObject.parameters.projScale=b,this.passObject.bilateralPass.updateShaderProperties([o.getPlugin(GBufferPlugin)])}},()=>[o.getPlugin(GBufferPlugin),o.scene.activeCamera,o.renderer,o.scene])]}async onRemove(o){return o.renderer.disposeTarget(this._aoTarget),super.onRemove(o)}setDirty(){var o;(o=this._viewer)===null||o===void 0||o.setDirty()}get enabled(){var o,c;return((c=(o=this.passes.ssao)===null||o===void 0?void 0:o.passObject)===null||c===void 0?void 0:c.enabled)||!1}set enabled(o){var c;!((c=this.passes.ssao)===null||c===void 0)&&c.passObject&&(this.passes.ssao.passObject.enabled=o)}get uiConfig(){var o;if(this._uiConfig)return this._uiConfig;const c=this,d=c.passes.ssao.passObject;return this._uiConfig={type:"folder",label:"SS Ambient Occlusion",children:[{type:"checkbox",label:"Enabled",property:[d,"enabled"],onChange:c.setDirty},{type:"checkbox",label:"Enable Cavity",property:[d.parameters,"useSmallScaleAO"],onChange:c.setDirty},{type:"slider",label:"Cavity Brightness",bounds:[0,.5],stepSize:.01,property:[d.parameters,"intensitySmallAO"],onChange:c.setDirty},{type:"slider",label:"Intensity",bounds:[0,5],property:[d.parameters,"intensity"],onChange:c.setDirty},{type:"slider",label:"Radius",bounds:[.1,20],property:[d.parameters,"occlusionWorldRadius"],onChange:c.setDirty},{type:"slider",label:"Bias",bounds:[1e-5,.01],property:[d.parameters,"bias"],onChange:c.setDirty},{type:"slider",label:"Falloff",bounds:[.01,3],property:[d.parameters,"falloff"],onChange:c.setDirty},{type:"slider",label:"Num samples",stepSize:1,bounds:[1,11],property:[(o=d.material)===null||o===void 0?void 0:o.defines,"NUM_SAMPLES"],onChange:[()=>d.material.needsUpdate=!0,c.setDirty]},{type:"checkbox",property:[d.bilateralPass,"smoothEnabled"],onChange:c.setDirty},{type:"checkbox",property:[d.parameters,"autoRadius"],onChange:c.setDirty},{type:"vec4",property:[d.bilateralPass,"edgeSharpness"],onChange:c.setDirty}]}}}SSAOPlugin.PluginType="SSAO";var hdrBloom=`uniform float intensity;uniform float opacity;uniform vec2 tDiffuseSize;varying vec2 vUv;uniform float weight;
#if PASS_STEP == 0
uniform vec4 prefilter;vec4 Prefilter(vec4 c){if(getDepth(vUv)>0.999){return vec4(0.);}float brightness=max(c.r,max(c.g,c.b));float soft=brightness+prefilter.x*(prefilter.y-1.);soft=clamp(soft,0.,prefilter.z);soft=soft*soft*prefilter.w;float contribution=max(soft,brightness-prefilter.x);contribution/=max(brightness,0.001);return vec4(c.rgb*contribution,c.a);}
#endif
vec4 Sample(vec2 uv){return min(vec4(MAX_INTENSITY,MAX_INTENSITY,MAX_INTENSITY,1.),tDiffuseTexelToLinear(texture2D(tDiffuse,uv)));}vec4 SampleBox(vec2 uv,float delta){vec4 o=vec2(-delta,delta).xxyy/tDiffuseSize.xyxy;vec4 s=Sample(uv+o.xy)+Sample(uv+o.zy)+Sample(uv+o.xw)+Sample(uv+o.zw);return s*0.25;}int getBloomBit(in int number){
#ifdef WebGL2Context
return(number/4)%2;
#else
return int(mod(floor(float(number)/4.),2.));
#endif
}void main(){
#if PASS_STEP == 0 
int doBloom=getBloomBit(getGBufferFlags(vUv).a);gl_FragColor=float(doBloom)*weight*Prefilter(SampleBox(vUv,1.));gl_FragColor.a=1.;
#elif PASS_STEP == 1 
gl_FragColor=weight*(SampleBox(vUv,1.));gl_FragColor.a=1.;
#elif PASS_STEP == 2 
gl_FragColor=(SampleBox(vUv,0.5));gl_FragColor.a=1.;
#elif PASS_STEP == 3 
vec4 texel=tSourceTexelToLinear(texture2D(tSource,vUv));vec4 bloom=intensity*SampleBox(vUv,0.5).rgba;float brightness=max(bloom.r,max(bloom.g,bloom.b));texel.rgb+=bloom.rgb;texel.a=min(1.,texel.a+brightness);gl_FragColor=texel;
#elif PASS_STEP == 4 
vec4 texel=vec4(0.);texel.rgb+=intensity*SampleBox(vUv,0.5).rgb;texel.a=1.;gl_FragColor=texel;
#endif
#include <colorspace_fragment>
}`,BloomPass_decorate=function(h,o,c,d){var _,v=arguments.length,b=v<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(h,o,c,d);else for(var tt=h.length-1;tt>=0;tt--)(_=h[tt])&&(b=(v<3?_(b):v>3?_(o,c,b):_(o,c))||b);return v>3&&b&&Object.defineProperty(o,c,b),b};let BloomPass=class extends ShaderPass2{constructor(h=16){super({vertexShader:CopyShader.vertexShader,defines:{PASS_STEP:1,MAX_INTENSITY:Math.min(h,16)},uniforms:{tSource:{value:null},tDiffuse:{value:null},opacity:{value:1},tDiffuseSize:{value:new three_module.I9Y},weight:{value:1},tNormalDepth:{value:null},tGBufferFlags:{value:null}},fragmentShader:unpackGbuffer+`
`+hdrBloom},"tDiffuse","tSource"),this.uiConfig=void 0,this.prefilter=new three_module.IUQ(2,.5,0,0),this.threshold=2,this.softThreshold=.5,this.intensity=.2,this.bloomIterations=4,this.radius=.6,this.power=1,this.bloomDebug=!1,this._weights=[],this._updateWeights=this._updateWeights.bind(this),this._thresholdsUpdated=this._thresholdsUpdated.bind(this),this._updateWeights(),this._thresholdsUpdated(),this.clear=!0,this.userData={setDirty:()=>{this.setDirty()}}}_thresholdsUpdated(){this.prefilter.x=this.threshold,this.prefilter.y=this.softThreshold,this.prefilter.z=2*this.prefilter.x*this.prefilter.y,this.prefilter.w=.125/(this.uniforms.prefilter.value.z+1e-5)}render(h,o,c,d,_){const v=h.baseRenderer;this.material.defines.PASS_STEP=0,this.clear=!0;const b=c;let tt=.5,it=b.width*tt,nt=b.height*tt;const lt=[];let ut=v.getTempTarget({sizeMultiplier:1,type:three_module.ix0});lt.push(ut);let ht=b;this.material.needsUpdate=!0,this.material.uniforms.weight.value=this._weights[0],super.render(h,ut,ht,d,_),ht=ut;let _t=1;for(;_t<this.bloomIterations&&(it/=2,nt/=2,tt/=2,!(nt<2||it<2));_t++){ut=v.getTempTarget({sizeMultiplier:tt,type:three_module.ix0}),lt.push(ut),this.material.defines.PASS_STEP=1;let bt=this._weights[_t];bt=this._weights[_t-1]!==0?this._weights[_t]/this._weights[_t-1]:this._weights[_t],this.material.uniforms.weight.value=bt,this.material.needsUpdate=!0,super.render(h,ut,ht,d,_),ht=ut}this.clear=!1;const ft=h.autoClear;for(h.autoClear=!1,_t-=2;_t>=0;_t--)ut=lt[_t],lt[_t]=void 0,this.material.defines.PASS_STEP=2,this.material.transparent=!0,this.material.blending=three_module.EZo,this.material.needsUpdate=!0,h.autoClear=!1,super.render(h,ut,ht,d,_),this.material.blending=three_module.XIg,v.releaseTempTarget(ht),ht=ut;this.clear=!0,h.autoClear=ft,h.autoClear=!0,this.bloomDebug?(this.material.defines.PASS_STEP=4,this.material.needsUpdate=!0,super.render(h,o,ht,d,_)):(this.uniforms.tSource.value=b.texture,this.material.defines.PASS_STEP=3,this.material.needsUpdate=!0,super.render(h,o,ht,d,_),this.uniforms.tSource.value=null),v.releaseTempTarget(ht)}_updateWeights(){if(!this._weights)return;const h=Math.max(Math.min(this.radius,1),0),o=1/(this.bloomIterations-1);for(let c=0;c<this.bloomIterations;c++){let d=c*o+.1,_=1.2-d;d=Math.pow(d,this.power),_=Math.pow(_,this.power),this._weights[c]=_*(1-h)+d*h}this.setDirty()}};function addBloomData(h){const o=h==null?void 0:h.userData;return!!o&&(o[BloomPlugin.PluginType]||(o[BloomPlugin.PluginType]={}),o[BloomPlugin.PluginType].enable=!0,h.isMaterial&&(h.needsUpdate=!0),!0)}BloomPass_decorate([uniform()],BloomPass.prototype,"prefilter",void 0),BloomPass_decorate([uiSlider("Threshold",[0,2]),x$1(BloomPass.prototype._thresholdsUpdated),serialize()],BloomPass.prototype,"threshold",void 0),BloomPass_decorate([uiSlider("Soft Threshold",[0,1]),x$1(BloomPass.prototype._thresholdsUpdated),serialize()],BloomPass.prototype,"softThreshold",void 0),BloomPass_decorate([uiSlider("Intensity",[0,3]),serialize(),uniform()],BloomPass.prototype,"intensity",void 0),BloomPass_decorate([uiSlider("Iterations",[0,7],1),x$1(BloomPass.prototype._updateWeights),serialize()],BloomPass.prototype,"bloomIterations",void 0),BloomPass_decorate([uiSlider("Radius",[0,1],.01),x$1(BloomPass.prototype._updateWeights),serialize()],BloomPass.prototype,"radius",void 0),BloomPass_decorate([uiSlider("Power",[.2,10],.01),x$1(BloomPass.prototype._updateWeights),serialize()],BloomPass.prototype,"power",void 0),BloomPass_decorate([uiToggle("Debug")],BloomPass.prototype,"bloomDebug",void 0),BloomPass=BloomPass_decorate([uiFolder("Bloom")],BloomPass);class BloomPlugin extends GenericFilterPlugin{constructor(){super(...arguments),this.passId="bloom",this._beforeFilters=["combinedPost","screen"],this._afterFilters=["render","progressive"],this._requiredFilters=["render"],this.materialExtension={uuid:esm_browser_v4(),getUiConfig:o=>{if(o.__uiConfigs||(o.__uiConfigs={}),o.__uiConfigs[this.materialExtension.uuid])return o.__uiConfigs[this.materialExtension.uuid];const c=this._getUiConfig(o);return o.__uiConfigs[this.materialExtension.uuid]=c,c},isCompatible:o=>!0}}setDirty(){this.pass.dirty=!0}_getUiConfig(o){const c={type:"folder",label:"Bloom",children:[{type:"checkbox",label:"Enabled",get value(){var d,_;return(_=(d=o.materialObject.userData[BloomPlugin.PluginType])===null||d===void 0?void 0:d.enable)===null||_===void 0||_},set value(d){var _;const v=o.materialObject.userData[BloomPlugin.PluginType];d!==(v==null?void 0:v.enable)&&(v||addBloomData(o.materialObject),o.materialObject.userData[BloomPlugin.PluginType].enable=d,(_=c.uiRefresh)===null||_===void 0||_.call(c,"postFrame",!0))},onChange:this.setDirty}]};return c}passCtor(o){const c=new BloomPass(o.renderer.maxHDRIntensity);return this.updateGBuffer=this.updateGBuffer.bind(this),this.setDirty=this.setDirty.bind(this),c}async onAdded(o){var c,d;await super.onAdded(o),(c=o.getPlugin(GBufferPlugin))===null||c===void 0||c.registerGBufferUpdater(this.updateGBuffer);const _=o.getPlugin(AssetManagerPlugin);(d=_==null?void 0:_.materials)===null||d===void 0||d.registerMaterialExtension(this.materialExtension)}updateGBuffer(o,c){var d,_,v,b;if(o instanceof three_module.eaF&&!((d=o.material)===null||d===void 0)&&d.userData){const tt=((v=(_=o.material)===null||_===void 0?void 0:_.userData[BloomPlugin.PluginType])===null||v===void 0?void 0:v.enable)===!1||!((b=o.material)===null||b===void 0)&&b.userData.pluginsDisabled?0:1;c.w=updateBit(c.w,2,tt)}}_update(o){var c,d;return(c=o.getPlugin(GBufferPlugin))===null||c===void 0||c.updateShaderProperties((d=this.pass)===null||d===void 0?void 0:d.passObject.material),super._update(o)}get uiConfig(){var o;return(o=this.pass)===null||o===void 0?void 0:o.passObject.uiConfig}}BloomPlugin.PluginType="Bloom";var combineDepthOfField=`#include <common>
#include <packing>
varying vec2 vUv;uniform vec2 cocTextureSize;uniform vec2 nearFarBlurScale;uniform vec2 cameraNearFar;uniform vec2 focalDepthRange;uniform vec2 crossCenter;uniform float crossRadius;uniform float crossAlpha;uniform vec3 crossColor;float smoothBoundary(float d,float smooothFactor){smooothFactor*=0.5;float value=smoothstep(-smooothFactor,smooothFactor,d);return value;}float circle(vec2 p,float r){return min((length(p)-r),-(length(p)-r-0.01));}float computeCoc(){float depth=getDepth(vUv);if(depth>1.-0.01)return max(nearFarBlurScale.x,nearFarBlurScale.y);depth=mix(cameraNearFar.x,cameraNearFar.y,depth);float coc=(depth-focalDepthRange.x)/focalDepthRange.y;coc=clamp(coc,-1.,1.);return(coc>0.?coc*nearFarBlurScale.y:coc*nearFarBlurScale.x);}void main(){vec4 blur=blurTextureTexelToLinear(texture2D(blurTexture,vUv));float scale=0.5;blur+=blurTextureTexelToLinear(texture2D(blurTexture,vUv+scale*vec2(1.,1.)/cocTextureSize));blur+=blurTextureTexelToLinear(texture2D(blurTexture,vUv+scale*vec2(-1.,1.)/cocTextureSize));blur+=blurTextureTexelToLinear(texture2D(blurTexture,vUv+scale*vec2(-1.,-1.)/cocTextureSize));blur+=blurTextureTexelToLinear(texture2D(blurTexture,vUv+scale*vec2(1.,-1.)/cocTextureSize));blur/=5.;vec2 uvNearest=(floor(vUv*cocTextureSize)+0.5)/cocTextureSize;float coc=abs(min(2.*cocTextureTexelToLinear(texture2D(cocTexture,uvNearest)).a-1.,computeCoc()));float cocLower=0.005;float cocHigher=0.3;vec4 outColor=vec4(mix(colorTextureTexelToLinear(texture2D(colorTexture,vUv)).rgb,blur.rgb,smoothstep(cocLower,cocHigher,coc)),1.);vec2 d=vUv-crossCenter;if(length(d)>crossRadius+0.05){float dist=circle(d,crossRadius);gl_FragColor=outColor;}else{d.x*=cocTextureSize.x/cocTextureSize.y;float dist=circle(d,crossRadius);dist=smoothBoundary(dist,2.*fwidth(dist));vec4 color=outColor;vec3 dofCircleColor=mix(crossColor,color.rgb,1.-crossAlpha);gl_FragColor=vec4(mix(color.rgb,dofCircleColor,dist),color.a);}
#include <colorspace_fragment>
}`,computeCoCDoF=`#include <common>
#include <packing>
varying vec2 vUv;uniform vec2 nearFarBlurScale;uniform vec2 cameraNearFar;uniform vec2 focalDepthRange;float computeCoc(){float depth=getDepth(vUv);if(depth==1.)return max(nearFarBlurScale.x,nearFarBlurScale.y);depth=mix(cameraNearFar.x,cameraNearFar.y,depth);float coc=(depth-focalDepthRange.x)/focalDepthRange.y;coc=clamp(coc,-1.,1.);return(coc>0.?coc*nearFarBlurScale.y:coc*nearFarBlurScale.x);}void main(){gl_FragColor=vec4(colorTextureTexelToLinear(texture2D(colorTexture,vUv)).rgb,0.5*computeCoc()+0.5);
#include <colorspace_fragment>
}`,expandCoCDoF=`#include <common>
varying vec2 vUv;uniform vec2 colorTextureSize;uniform vec2 direction;uniform vec2 nearFarBlurScale;const float MAXIMUM_BLUR_SIZE=4.;float expandNear(const in vec2 offset,const in bool isBackground){float coc=0.;vec2 sampleOffsets=MAXIMUM_BLUR_SIZE*offset/5.;float coc0=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv)).a-1.;float coc1=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv-5.*sampleOffsets)).a-1.;float coc2=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv-4.*sampleOffsets)).a-1.;float coc3=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv-3.*sampleOffsets)).a-1.;float coc4=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv-2.*sampleOffsets)).a-1.;float coc5=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv-1.*sampleOffsets)).a-1.;float coc6=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv+1.*sampleOffsets)).a-1.;float coc7=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv+2.*sampleOffsets)).a-1.;float coc8=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv+3.*sampleOffsets)).a-1.;float coc9=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv+4.*sampleOffsets)).a-1.;float coc10=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv+5.*sampleOffsets)).a-1.;if(isBackground){coc=abs(coc0)*0.095474+(abs(coc1)+abs(coc10))*0.084264+(abs(coc2)+abs(coc9))*0.088139+(abs(coc3)+abs(coc8))*0.091276+(abs(coc4)+abs(coc7))*0.093585+(abs(coc5)+abs(coc6))*0.094998;}else{coc=min(coc0,0.);coc=min(coc1*0.3,coc);coc=min(coc2*0.5,coc);coc=min(coc3*0.75,coc);coc=min(coc4*0.8,coc);coc=min(coc5*0.95,coc);coc=min(coc6*0.95,coc);coc=min(coc7*0.8,coc);coc=min(coc8*0.75,coc);coc=min(coc9*0.5,coc);coc=min(coc10*0.3,coc);if(abs(coc0)>abs(coc))coc=coc0;}return coc;}void main(){vec2 offset=2.*direction/colorTextureSize;bool isBackground=getDepth(vUv)>1.-0.001;float coc=expandNear(offset,isBackground);gl_FragColor=vec4(colorTextureTexelToLinear(texture2D(colorTexture,vUv)).rgb,0.5*coc+0.5);
#include <colorspace_fragment>
}`,boxBlurDoF=`#include <common>
varying vec2 vUv;uniform vec2 colorTextureSize;uniform vec2 direction;const float MAXIMUM_BLUR_SIZE=16.;const float SIGMA=5.;const int NUM_SAMPLES=4;float normpdf(in float x,in float sigma){return 0.39894*exp(-0.5*x*x/(sigma*sigma))/sigma;}vec3 weightedBlur(){float cocIn=2.*cocTextureTexelToLinear(texture2D(cocTexture,vUv)).a-1.;float kernelRadius=MAXIMUM_BLUR_SIZE*cocIn;vec2 invSize=1./colorTextureSize;cocIn*=cocIn*cocIn;float centerSpaceWeight=normpdf(0.,SIGMA)*abs(cocIn);float weightSum=centerSpaceWeight;vec3 centerSample=colorTextureTexelToLinear(texture2D(colorTexture,vUv)).rgb;vec3 diffuseSum=centerSample*weightSum;vec2 delta=invSize*kernelRadius/float(NUM_SAMPLES);for(int i=1;i<=NUM_SAMPLES;i++){float spaceWeight=normpdf(float(i),SIGMA);vec2 texcoord=direction*delta*float(i);vec4 rightSample=colorTextureTexelToLinear(texture2D(colorTexture,vUv+texcoord));vec4 leftSample=colorTextureTexelToLinear(texture2D(colorTexture,vUv-texcoord));float leftCocWeight=abs(2.*cocTextureTexelToLinear(texture2D(cocTexture,vUv-texcoord)).a-1.);float rightCocWeight=abs(2.*cocTextureTexelToLinear(texture2D(cocTexture,vUv+texcoord)).a-1.);leftCocWeight*=leftCocWeight*leftCocWeight;rightCocWeight*=rightCocWeight*rightCocWeight;diffuseSum+=((leftSample.rgb*leftCocWeight)+(rightSample.rgb*rightCocWeight))*spaceWeight;weightSum+=(spaceWeight*(leftCocWeight+rightCocWeight));}return diffuseSum/weightSum;}void main(){gl_FragColor=vec4(weightedBlur(),1.);
#include <colorspace_fragment>
}`,poissonBlurDoF=`#include <common>
varying vec2 vUv;uniform vec2 colorTextureSize;uniform float blurRadius;vec4 CircularBlur(){vec4 color=colorTextureTexelToLinear(texture2D(colorTexture,vUv));
#ifdef DOF_MODE
float blurDist=blurRadius*(2.*color.a-1.);
#else
float blurDist=blurRadius*color.a;
#endif
float rnd=PI2*random3(vec3(vUv,frameCount*0.1));float costheta=cos(rnd);float sintheta=sin(rnd);vec4 rotationMatrix=vec4(costheta,-sintheta,sintheta,costheta);vec3 colorSum=vec3(0.);float weightSum=0.001;vec2 ofs;vec4 sampleColor;setPds();
#pragma unroll_loop_start
for(int i=0;i<16;i++){ofs=poisson_disk_samples[UNROLLED_LOOP_INDEX];ofs=vec2(dot(ofs,rotationMatrix.xy),dot(ofs,rotationMatrix.zw));sampleColor=colorTextureTexelToLinear(texture2D(colorTexture,vUv+blurDist*ofs/colorTextureSize.xy));
#ifdef DOF_MODE
sampleColor.a=abs(sampleColor.a*2.-1.);sampleColor.a*=sampleColor.a*sampleColor.a;
#endif
colorSum+=sampleColor.rgb*sampleColor.a;weightSum+=sampleColor.a;}
#pragma unroll_loop_end
colorSum/=weightSum;return vec4(min(vec3(72.),max(vec3(0.),colorSum)),1.);}void main(){gl_FragColor=CircularBlur();
#include <colorspace_fragment>
}`,poissonDiskSamples="vec2 poisson_disk_samples[16];void setPds(){poisson_disk_samples[0]=vec2(-0.399691779231,0.728591545584);poisson_disk_samples[1]=vec2(-0.48622557676,-0.84016533712);poisson_disk_samples[2]=vec2(0.770309468987,-0.24906070432);poisson_disk_samples[3]=vec2(0.556596796154,0.820359876432);poisson_disk_samples[4]=vec2(-0.933902004071,0.0600539051593);poisson_disk_samples[5]=vec2(0.330144964342,0.207477293384);poisson_disk_samples[6]=vec2(0.289013230975,-0.686749271417);poisson_disk_samples[7]=vec2(-0.0832470893559,-0.187351643125);poisson_disk_samples[8]=vec2(-0.296314525615,0.254474834305);poisson_disk_samples[9]=vec2(-0.850977666059,0.484642744689);poisson_disk_samples[10]=vec2(0.829287915319,0.2345063545);poisson_disk_samples[11]=vec2(-0.773042143899,-0.543741521254);poisson_disk_samples[12]=vec2(0.0561133030864,0.928419742597);poisson_disk_samples[13]=vec2(-0.205799249508,-0.562072714492);poisson_disk_samples[14]=vec2(-0.526991665882,-0.193690188118);poisson_disk_samples[15]=vec2(-0.051789270667,-0.935374050821);}",DepthOfFieldPass_decorate=function(h,o,c,d){var _,v=arguments.length,b=v<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(h,o,c,d);else for(var tt=h.length-1;tt>=0;tt--)(_=h[tt])&&(b=(v<3?_(b):v>3?_(o,c,b):_(o,c))||b);return v>3&&b&&Object.defineProperty(o,c,b),b};const combineDofShader={uniforms:{colorTexture:{value:null},tNormalDepth:{value:null},blurTexture:{value:null},cocTexture:{value:null},cocTextureSize:{value:new three_module.I9Y},cameraNearFar:{value:new three_module.I9Y}},vertexShader:defaultVertex,fragmentShader:unpackGbuffer+`
`+combineDepthOfField};patchShaderEncodingSupport({uniforms:{cocTexture:{value:null},colorTexture:{value:null},colorTextureSize:{value:new three_module.I9Y},direction:{value:new three_module.I9Y}},vertexShader:defaultVertex,fragmentShader:boxBlurDoF},"colorTexture","cocTexture");const dofBlurMaterialPoisson=patchShaderEncodingSupport({uniforms:{colorTexture:{value:null},colorTextureSize:{value:new three_module.I9Y},direction:{value:new three_module.I9Y},frameCount:{value:0},blurRadius:{value:16}},vertexShader:defaultVertex,fragmentShader:randomHelpers+`
`+poissonDiskSamples+`
`+poissonBlurDoF,defines:{DOF_MODE:1}},"colorTexture");class DepthOfFieldPass extends ShaderPass2{constructor(){super(combineDofShader,"colorTexture","cocTexture","blurTexture"),this.dofBlurMaterial=dofBlurMaterialPoisson,this.nearFarBlurScale=new three_module.I9Y(.25,.25),this.focalDepthRange=new three_module.I9Y(.5,1.5),this.crossCenter=new three_module.I9Y(.5,.5),this.crossRadius=.04,this.crossAlpha=1,this.crossColor=new three_module.Q1f(16750848),this.uiConfig={type:"folder",label:"Depth of Field",children:[{type:"checkbox",label:"Enabled",limitedUi:!0,property:[this,"enabled"]},{type:"slider",label:"Depth Range",bounds:[.5,3],property:[this.focalDepthRange,"y"]},{type:"slider",label:"Near Blur scale",bounds:[0,1],property:[this.nearFarBlurScale,"x"]},{type:"slider",label:"Far Blur scale",bounds:[0,1],property:[this.nearFarBlurScale,"y"]}]},this.material.extensions.derivatives=!0,this.computeCocMaterial=patchShaderEncodingSupport({uniforms:{colorTexture:{value:null},tNormalDepth:this.uniforms.tNormalDepth,cameraNearFar:this.uniforms.cameraNearFar,nearFarBlurScale:this.uniforms.nearFarBlurScale,focalDepthRange:this.uniforms.focalDepthRange},vertexShader:defaultVertex,fragmentShader:unpackGbuffer+`
`+computeCoCDoF},"colorTexture"),this.expandCocMaterial=patchShaderEncodingSupport({uniforms:{colorTexture:{value:null},colorTextureSize:{value:new three_module.I9Y},direction:{value:new three_module.I9Y},tNormalDepth:this.uniforms.tNormalDepth,nearFarBlurScale:this.uniforms.nearFarBlurScale},vertexShader:defaultVertex,fragmentShader:unpackGbuffer+`
`+expandCoCDoF},"colorTexture")}render(o,c,d,_,v){if(!this.enabled)return;const b=o.baseRenderer,tt={minFilter:three_module.hxR,magFilter:three_module.hxR,type:three_module.ix0,colorSpace:three_module.Zr2,sizeMultiplier:.5,format:three_module.GWd,depthBuffer:!1,generateMipmaps:!1},it=b.getTempTarget(tt),nt=b.getTempTarget(tt);if(this.computeCocMaterial.uniforms.colorTexture.value=d.texture,b.blit(void 0,it,{material:this.computeCocMaterial}),this.expandCocMaterial.uniforms.colorTexture.value=it.texture,this.expandCocMaterial.uniforms.direction.value.set(1,0),b.blit(void 0,nt,{material:this.expandCocMaterial}),this.expandCocMaterial.uniforms.colorTexture.value=nt.texture,this.expandCocMaterial.uniforms.direction.value.set(0,1),b.blit(void 0,it,{material:this.expandCocMaterial}),this.dofBlurMaterial.uniforms.frameCount)this.dofBlurMaterial.uniforms.colorTexture.value=it.texture,b.blit(void 0,nt,{material:this.dofBlurMaterial});else{const lt=b.getTempTarget(tt);this.dofBlurMaterial.uniforms.cocTexture.value=it.texture,this.dofBlurMaterial.uniforms.colorTexture.value=it.texture,this.dofBlurMaterial.uniforms.direction.value.set(1,0),b.blit(void 0,lt,{material:this.dofBlurMaterial}),this.dofBlurMaterial.uniforms.colorTexture.value=lt.texture,this.dofBlurMaterial.uniforms.direction.value.set(0,1),b.blit(void 0,nt,{material:this.dofBlurMaterial}),b.releaseTempTarget(lt)}this.material.uniforms.blurTexture.value=nt.texture,this.material.uniforms.cocTexture.value=it.texture,super.render(o,c,d,_,v),b.releaseTempTarget(it),b.releaseTempTarget(nt)}}DepthOfFieldPass_decorate([serialize(),uniform()],DepthOfFieldPass.prototype,"nearFarBlurScale",void 0),DepthOfFieldPass_decorate([serialize(),uniform()],DepthOfFieldPass.prototype,"focalDepthRange",void 0),DepthOfFieldPass_decorate([uniform()],DepthOfFieldPass.prototype,"crossCenter",void 0),DepthOfFieldPass_decorate([uniform()],DepthOfFieldPass.prototype,"crossRadius",void 0),DepthOfFieldPass_decorate([uniform()],DepthOfFieldPass.prototype,"crossAlpha",void 0),DepthOfFieldPass_decorate([uniform()],DepthOfFieldPass.prototype,"crossColor",void 0);class AddBlendPass extends ShaderPass2{constructor(o,c=120){super({vertexShader:CopyShader.vertexShader,fragmentShader:fe$1`
                uniform vec4 weight;
                uniform vec4 weight2;
                varying vec2 vUv;
                void main() {
                    vec4 texel = clamp(weight * tDiffuseTexelToLinear ( texture2D( tDiffuse, vUv ) ) + weight2 * tDiffuse2TexelToLinear ( texture2D( tDiffuse2, vUv ) ), vec4(0), vec4(MAX_INTENSITY));
                    gl_FragColor = texel;
                    #include <colorspace_fragment>
                }
            `,uniforms:{tDiffuse:{value:null},tDiffuse2:{value:o},weight:{value:new three_module.IUQ(1,1,1,1)},weight2:{value:new three_module.IUQ(1,1,1,1)}},defines:{MAX_INTENSITY:c}},"tDiffuse","tDiffuse2"),this.clear=!1,this.needsSwap=!0}set weights2(o){this.uniforms.weight2.value.copy(o)}get weights2(){return this.uniforms.weight2.value}set weights1(o){this.uniforms.weight.value.copy(o)}get weights1(){return this.uniforms.weight.value}set blendTexture(o){this.uniforms.tDiffuse2.value=o}}var ProgressivePlugin_decorate=function(h,o,c,d){var _,v=arguments.length,b=v<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(h,o,c,d);else for(var tt=h.length-1;tt>=0;tt--)(_=h[tt])&&(b=(v<3?_(b):v>3?_(o,c,b):_(o,c))||b);return v>3&&b&&Object.defineProperty(o,c,b),b};const offsets=[{x:0,y:0},{x:-.5,y:0},{x:-.375,y:-.25},{x:-.1875,y:-.125},{x:-.125,y:-.375},{x:.0625,y:-.0625},{x:.125,y:-.3125},{x:.375,y:-.4375},{x:.3125,y:-.1875},{x:.25,y:.0625},{x:.4375,y:.25},{x:.1875,y:.3125},{x:0,y:.4375},{x:-.0625,y:.1875},{x:-.25,y:.375},{x:-.4375,y:.5},{x:-.3125,y:.125}];class ProgressivePlugin extends MultiFilterPlugin{constructor(o=2*offsets.length){super(),this._lastFrames=new Map,this.enabled=!0,this.jitter=!0,this._hasSetOffset=!1,this.trackedJitterCameras=new Set,this._addSceneObject=c=>{const d=c.object;(d.modelObject||d.lightObject)&&(d.modelObject||d.lightObject).traverse(_=>{var v;!((v=_==null?void 0:_.shadow)===null||v===void 0)&&v.camera&&_.shadow.mapSize&&this.trackedJitterCameras.add([_.shadow.camera,_.shadow.mapSize])})},this._jitterCamera=c=>{var d;const _=c.target;if(this.jitter&&_.renderer.frameCount>1){const v=(tt,it)=>{const nt={...offsets[_.renderer.frameCount%offsets.length]};tt.setViewOffset(it.width,it.height,nt.x,nt.y,it.width,it.height)},b=_.scene.activeCamera.cameraObject;v(b,{width:_.canvas.clientWidth*_.renderer.displayCanvasScaling,height:_.canvas.clientHeight*_.renderer.displayCanvasScaling}),this.trackedJitterCameras.forEach(tt=>v(...tt)),this._hasSetOffset=!0,(d=this._viewer)===null||d===void 0||d.renderer.resetShadows()}},this._resetCameraJitter=c=>{const d=c.target;this._hasSetOffset&&(d.scene.activeCamera.cameraObject.clearViewOffset(),this._hasSetOffset=!1)},this.uiConfig=generateUiFolder("Progressive",this),this.maxFrameCount=o}async onAdded(o){return await super.onAdded(o)}async onRemove(o){o.removeEventListener("preRender",this._jitterCamera),o.removeEventListener("postRender",this._resetCameraJitter),o.scene.removeEventListener("addSceneObject",this._addSceneObject),this._lastFrames.forEach(c=>o.renderer.disposeTarget(c)),this._lastFrames.clear(),await super.onRemove(o)}get lastFrame(){var o;return this._lastFrames.get((o=this._viewer)===null||o===void 0?void 0:o.scene.renderCamera.cameraObject.uuid)}getLastFrame(o){return o?this._lastFrames.get(o.cameraObject.uuid):this.lastFrame}createPasses(o){o.addEventListener("preRender",this._jitterCamera),o.addEventListener("postRender",this._resetCameraJitter),o.scene.addEventListener("addSceneObject",this._addSceneObject);const c=this;return[makeFilter(o,{passId:"progressive",get dirty(){var d;return c.jitter&&(((d=c._viewer)===null||d===void 0?void 0:d.renderer.frameCount)||0)<c.maxFrameCount},after:["render"],before:["combinedPost","screen"],required:["render"],passObject:new class extends AddBlendPass{render(d,_,v,b,tt){if(c.lastFrame){if(o.renderer.frameCount<1)return this.needsSwap=!1,void((v==null?void 0:v.texture)&&o.renderer.blit(v.texture,c.lastFrame,{}));this.needsSwap=!0,super.render(d,_,v,b,tt),o.renderer.blit(_.texture,c.lastFrame,{})}else o.console.error("lastFrame render target undefined")}}(void 0,o.renderer.maxHDRIntensity||120),update(){if(!c.lastFrame&&o.scene.renderCamera&&c._lastFrames.set(o.scene.renderCamera.cameraObject.uuid,o.renderer.composerTarget.clone(!0)),!c.lastFrame)return void console.error("lastFrame render target undefined");let d=1/(Math.max(o.renderer.frameCount,0)+1);this.passObject.weights1.set(d,d,d,d),d=1-d,this.passObject.weights2.set(d,d,d,d),this.passObject.blendTexture=c.lastFrame.texture,this.passObject.material.uniformsNeedUpdate=!0}})]}isConverged(o=!1){var c;return(((c=this._viewer)===null||c===void 0?void 0:c.renderer.frameCount)||0)>=this.maxFrameCount-1+(o?1:0)}updateShaderProperties(o){var c,d;return o.uniforms.tLastFrame&&(o.uniforms.tLastFrame.value=(d=(c=this.lastFrame)===null||c===void 0?void 0:c.texture)!==null&&d!==void 0?d:void 0),this}postFrameConvergedRecordingDelta(o="CanvasRecorder"){const c=this._viewer.getPluginByType(o);return c&&c.isRecording()&&c.convergeMode?this.isConverged(!0)?1/c.videoFrameRate:0:-1}}ProgressivePlugin.PluginType="Progressive",ProgressivePlugin_decorate([serialize(),uiInput("Frame count")],ProgressivePlugin.prototype,"maxFrameCount",void 0),ProgressivePlugin_decorate([serialize(),uiToggle("Jitter")],ProgressivePlugin.prototype,"jitter",void 0);class FrameFadePlugin extends GenericFilterPlugin{async startTransition(o){this._viewer&&this._pass&&!this.isDisabled()&&(this._target||(this._target=this._viewer.renderer.getTempTarget({sizeMultiplier:1,minFilter:three_module.k6q,magFilter:three_module.k6q,colorSpace:this._viewer.renderer.composerTarget.texture.colorSpace})),this._fadeTimeState<500&&(this._toSaveFrame=!0),this._fadeTimeState=Math.max(o,this._fadeTimeState),this._fadeTime=this._fadeTimeState,this.setDirty(),await X$2(o))}stopTransition(){this._fadeTimeState=0}constructor(){super(),this.passId="frameFade",this._fadeTime=0,this._fadeTimeState=0,this._toSaveFrame=!1,this._beforeFilters=["progressive","taa"],this._afterFilters=["render"],this._requiredFilters=["render","progressive"],this.dependencies=[ProgressivePlugin],this.isEditor=!1,this.fadeOnActiveCameraChange=!0,this.fadeOnMaterialUpdate=!0,this.fadeOnSceneUpdate=!0,this.pointerEnabled=!0,this._fadeCam=o=>o.frameFade!==!1&&!this.isEditor&&this.fadeOnActiveCameraChange&&this.startTransition(o.fadeDuration||1e3),this._fadeMat=o=>{o.frameFade!==!1&&!this.isEditor&&this.fadeOnMaterialUpdate&&this.startTransition(o.fadeDuration||200)},this._fadeScene=o=>{o.frameFade!==!1&&!this.isEditor&&this.fadeOnSceneUpdate&&this.startTransition(o.fadeDuration||500)},this._onPointerMove=o=>{var c;const d=(c=this._viewer)===null||c===void 0?void 0:c.canvas;if(!d)return void(this.pointerEnabled=!1);if(!o.buttons||o.target!==d)return void(this.pointerEnabled=!0);const _=d.getBoundingClientRect(),v=(o.clientX-_.left)/_.width,b=(o.clientY-_.top)/_.height;this.pointerEnabled=v<0||v>1||b<0||b>1},this._disabledBy=[],this.startTransition=this.startTransition.bind(this),this.stopTransition=this.stopTransition.bind(this),this._fadeCam=this._fadeCam.bind(this),this._fadeMat=this._fadeMat.bind(this)}async onAdded(o){await super.onAdded(o),o.scene.addEventListener("activeCameraChange",this._fadeCam),o.scene.addEventListener("activeCameraUpdate",this.stopTransition),o.scene.addEventListener("sceneMaterialUpdate",this._fadeMat),o.scene.addEventListener("sceneUpdate",this._fadeScene),window.addEventListener("pointermove",this._onPointerMove)}async onRemove(o){return o.scene.removeEventListener("activeCameraChange",this._fadeCam),o.scene.removeEventListener("activeCameraUpdate",this.stopTransition),o.scene.removeEventListener("sceneMaterialUpdate",this._fadeMat),o.scene.removeEventListener("sceneUpdate",this._fadeScene),window.removeEventListener("pointermove",this._onPointerMove),super.onRemove(o)}passCtor(o){const c=this,d=o.getPlugin(ProgressivePlugin),_=new class extends AddBlendPass{constructor(){super(...arguments),this._lastTime=0,this._saveNextFrame=!1,this.uiConfig=generateUiFolder("Frame Fade",this)}render(v,b,tt,it,nt){this.needsSwap=!1;const lt=c._target;if(!lt||!c.pointerEnabled||!this.enabled||!c.dirty||c._fadeTimeState<.001||o.scene.renderCamera!==o.scene.activeCamera)return;c._toSaveFrame&&(this._saveNextFrame=!0,c._toSaveFrame=!1),this._saveNextFrame&&d.lastFrame&&(o.renderer.blit(d.lastFrame.texture,lt),this._lastTime=0,this._saveNextFrame=!1),this.blendTexture=lt==null?void 0:lt.texture;const ut=c._fadeTimeState/c._fadeTime;this.weights2.setScalar(ut),this.weights2.w=1,this.weights1.setScalar(1-ut),this.weights1.w=1,super.render(v,b,tt,it,nt),this.needsSwap=!0;const ht=g();this._lastTime<10&&(this._lastTime=ht-10);const _t=ht-this._lastTime;this._lastTime=ht,c._fadeTimeState-=_t}}(void 0,o.renderer.maxHDRIntensity);return _.enabled=!0,_}setDirty(){var o;this.enabled&&((o=this._viewer)===null||o===void 0||o.setDirty())}get dirty(){return this.enabled&&this._fadeTimeState>0}set dirty(o){console.warn("FrameFadePlugin.dirty is readonly")}_update(o){return!!super._update(o)&&(this.isDisabled()&&this.stopTransition(),this._fadeTimeState<1&&(this._toSaveFrame=!1,this._target&&this._viewer&&(this._viewer.renderer.releaseTempTarget(this._target),this._target=void 0)),!0)}get uiConfig(){var o,c;return(c=(o=this.pass)===null||o===void 0?void 0:o.passObject)===null||c===void 0?void 0:c.uiConfig}disable(o){this._disabledBy.includes(o)||this._disabledBy.push(o)}enable(o){const c=this._disabledBy.indexOf(o);c>=0&&this._disabledBy.splice(c,1)}isDisabled(){return!this.pointerEnabled||this._disabledBy.length>0||!this.enabled}}FrameFadePlugin.PluginType="FrameFade";var DepthOfFieldPlugin_decorate=function(h,o,c,d){var _,v=arguments.length,b=v<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(h,o,c,d);else for(var tt=h.length-1;tt>=0;tt--)(_=h[tt])&&(b=(v<3?_(b):v>3?_(o,c,b):_(o,c))||b);return v>3&&b&&Object.defineProperty(o,c,b),b};class DepthOfFieldPlugin extends GenericFilterPlugin{passCtor(o){return new DepthOfFieldPass}constructor(o=!0,c=!1){super(),this.passId="depthOfField",this._beforeFilters=["progressive","tonemap","screen"],this._afterFilters=["render"],this._requiredFilters=["render"],this.dependencies=[GBufferPlugin],this.enableEdit=!1,this._focalPointHit=new three_module.Pq0(0,0,0),this.crossFadeTime=200,this._focalPointHitTime=0,this._tempVec=new three_module.Pq0,this.enabled=o,this.enableEdit=c,this._onObjectHit=this._onObjectHit.bind(this),this.setDirty=this.setDirty.bind(this)}setFocalPoint(o,c=!0,d=!1){var _,v;this._focalPointHit.copy(o),c&&((v=(_=this._viewer)===null||_===void 0?void 0:_.getPlugin(FrameFadePlugin))===null||v===void 0||v.startTransition(this._frameFadeTime)),d&&(this._focalPointHitTime=g()),this.setDirty()}getFocalPoint(){return this._focalPointHit}get depthRange(){var o,c;return(c=(o=this.pass)===null||o===void 0?void 0:o.passObject.focalDepthRange.y)!==null&&c!==void 0?c:0}set depthRange(o){this.pass&&(this.pass.passObject.focalDepthRange.y=o),this.setDirty()}get nearBlurScale(){var o,c;return(c=(o=this.pass)===null||o===void 0?void 0:o.passObject.nearFarBlurScale.x)!==null&&c!==void 0?c:0}set nearBlurScale(o){this.pass&&(this.pass.passObject.nearFarBlurScale.x=o),this.setDirty()}get farBlurScale(){var o,c;return(c=(o=this.pass)===null||o===void 0?void 0:o.passObject.nearFarBlurScale.y)!==null&&c!==void 0?c:0}set farBlurScale(o){this.pass&&(this.pass.passObject.nearFarBlurScale.y=o),this.setDirty()}get _frameFadeTime(){return 2.5*this.crossFadeTime}_onObjectHit(o){var c,d;this._pass&&o.intersects.intersect&&this.enabled&&this.enableEdit&&(this._focalPointHit.copy(o.intersects.intersect.point),this._focalPointHitTime=o.time,o.intersects.selectedObject=null,(d=(c=this._viewer)===null||c===void 0?void 0:c.getPlugin(FrameFadePlugin))===null||d===void 0||d.startTransition(this._frameFadeTime),this.setDirty())}async onAdded(o){var c;await super.onAdded(o),(c=o.getPluginByType("Picking"))===null||c===void 0||c.addEventListener("hitObject",this._onObjectHit)}async onRemove(o){var c;return(c=o.getPluginByType("Picking"))===null||c===void 0||c.removeEventListener("hitObject",this._onObjectHit),super.onRemove(o)}setDirty(){var o;(o=this._viewer)===null||o===void 0||o.setDirty()}_update(o){var c,d;if(!super._update(o))return!1;const _=(c=this.pass)===null||c===void 0?void 0:c.passObject;if(!_)return!1;const v=o.getPlugin(GBufferPlugin);v==null||v.updateShaderProperties(_.material),_.dofBlurMaterial.uniforms.frameCount&&((d=o.renderer)===null||d===void 0||d.updateShaderProperties(_.dofBlurMaterial));const b=o.scene.renderCamera;if(!b)return!1;b.cameraObject.updateMatrixWorld(!0),b.updateShaderProperties(_.material),b.cameraObject.getWorldPosition(this._tempVec),this._tempVec.subVectors(this._focalPointHit,this._tempVec),_.focalDepthRange.x=this._tempVec.length(),_.focalDepthRange.x*=b.cameraObject.getWorldDirection(new three_module.Pq0).dot(this._tempVec.normalize());let tt=(g()-this._focalPointHitTime)/this.crossFadeTime;if(tt=1-Math.min(1,Math.max(0,tt)),Math.abs(tt-_.crossAlpha)>.01&&(_.crossAlpha=tt,this.setDirty()),tt>0){const it=this._tempVec.copy(this._focalPointHit).project(b.cameraObject).addScalar(1).divideScalar(2);_.crossCenter.set(it.x,it.y),_.computeCocMaterial.uniformsNeedUpdate=!0,_.expandCocMaterial.uniformsNeedUpdate=!0}return!0}get uiConfig(){var o,c,d,_,v;if(this._uiConfig)return this._uiConfig;const b=(c=(o=this._pass)===null||o===void 0?void 0:o.passObject)===null||c===void 0?void 0:c.uiConfig;return b?((_=(d=b.children)===null||d===void 0?void 0:d.map(tt=>Ee$1(tt)))===null||_===void 0||_.flat(2).forEach(tt=>tt&&(tt.onChange=this.setDirty)),(v=b.children)===null||v===void 0||v.push({type:"checkbox",label:"Enable Edit",limitedUi:!0,property:[this,"enableEdit"]}),this._uiConfig=b,b):{}}}DepthOfFieldPlugin.PluginType="DepthOfField",DepthOfFieldPlugin_decorate([serialize()],DepthOfFieldPlugin.prototype,"enableEdit",void 0),DepthOfFieldPlugin_decorate([serialize("focalPoint")],DepthOfFieldPlugin.prototype,"_focalPointHit",void 0),DepthOfFieldPlugin_decorate([serialize()],DepthOfFieldPlugin.prototype,"crossFadeTime",void 0);var voronoise=`#ifndef VORONOISE_HELPER
#define VORONOISE_HELPER 
float voronoise(in vec2 p,float u,float v){float k=1.+63.*pow(max(0.,1.-v),6.);vec2 i=floor(p);vec2 f=fract(p);vec2 a=vec2(0.,0.);for(int y=-2;y<=2;y++)for(int x=-2;x<=2;x++){vec2 g=vec2(x,y);vec3 o=hash3(i+g)*vec3(u,u,1.);vec2 d=g-f+o.xy;float w=pow(max(0.,1.-smoothstep(0.,1.414,length(d))),k);a+=vec2(o.z*w,w);}return a.x/a.y;}vec3 voronoise3(vec2 p,float u,float v){return vec3(voronoise(p,u,v),voronoise(p+vec2(0.435,0.23),u,v),voronoise(p-vec2(0.83,0.45),u,v));}vec3 voronoiseNormal(vec2 p,float u,float v){return vec3(voronoise(p,u,v),voronoise(p+vec2(0.435,0.23),u,v),1.);}
#endif
`,thinFilmLayer="vec3 incident=normalize(vViewPosition.xyz);float hWeight=1.-dot(normal,incident);vec3 noiseV=voronoise3(vUv.xy*thinColorNoiseParams.xy*60.,thinColorNoiseParams.z,thinColorNoiseParams.w);float hWeight2=1.-dot(normalize(noiseV),incident);vec3 film=hsv2rgb(vec3(fract(hWeight+thinBaseLayerFactors.x),thinBaseLayerFactors.y,thinBaseLayerFactors.z))*thinBaseLayerFactors.a;vec3 film2=hsv2rgb(vec3(fract(hWeight2+thinNoiseLayerFactors.x),thinNoiseLayerFactors.y,thinNoiseLayerFactors.z))*thinNoiseLayerFactors.a;film=(film+film2)/(thinBaseLayerFactors.a+thinNoiseLayerFactors.a);diffuseColor.rgb=mix(diffuseColor.rgb,film,thinFilmFactor);",hsvHelpers=`#ifndef HSV_HELPERS
#define HSV_HELPERS 
vec3 hsv2rgb(vec3 c){vec4 K=vec4(1.,2./3.,1./3.,3.);vec3 p=abs(fract(c.xxx+K.xyz)*6.-K.www);return c.z*mix(K.xxx,clamp(p-K.xxx,0.,1.),c.y);}vec3 rgb2hsv(vec3 c){vec4 K=vec4(0.,-1./3.,2./3.,-1.);vec4 p=c.g<c.b?vec4(c.bg,K.wz):vec4(c.gb,K.xy);vec4 q=c.r<p.x?vec4(p.xyw,c.r):vec4(c.r,p.yzx);float d=q.x-min(q.w,q.y);float e=1.0e-10;return vec3(abs(q.z+(q.w-q.y)/(6.*d+e)),d/(q.x+e),q.x);}
#endif 
`,ThinFilmLayerPlugin_decorate=function(h,o,c,d){var _,v=arguments.length,b=v<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(h,o,c,d);else for(var tt=h.length-1;tt>=0;tt--)(_=h[tt])&&(b=(v<3?_(b):v>3?_(o,c,b):_(o,c))||b);return v>3&&b&&Object.defineProperty(o,c,b),b};let ThinFilmLayerPlugin=class extends AViewerPlugin{addThinFilmLayer(h){return addThinFilmLayer(h.materialObject)}_loaderCreate({loader:h}){h.isGLTFLoader2&&h.register(o=>new GLTFMaterialsThinFilmLayerExtensionImport(o))}constructor(){super(),this.enabled=!0,this.dependencies=[AssetManagerPlugin],this._defines={},this._uniforms={thinBaseLayerFactors:{value:new three_module.IUQ},thinNoiseLayerFactors:{value:new three_module.IUQ},thinColorNoiseParams:{value:new three_module.IUQ},thinFilmFactor:{value:.8}},this.materialExtension={parsFragmentSnippet:(h,o)=>{var c;return this.enabled&&!((c=o==null?void 0:o.materialObject.userData._thinFilmLayer)===null||c===void 0)&&c.hasThinFilm?randomHelpers+`
`+voronoise+`
`+hsvHelpers+`
uniform vec4 thinBaseLayerFactors;
uniform vec4 thinNoiseLayerFactors;
uniform vec4 thinColorNoiseParams;
uniform float thinFilmFactor;
        `:""},shaderExtender:(h,o,c)=>{var d;if(!this.enabled||!(!((d=o.materialObject.userData._thinFilmLayer)===null||d===void 0)&&d.hasThinFilm))return;const _="#glMarker beforeAccumulation";h.fragmentShader=h.fragmentShader.replace(_,thinFilmLayer+_),h.defines.USE_UV=""},onObjectRender:(h,o)=>{var c;const d=(c=o.materialObject.userData)===null||c===void 0?void 0:c._thinFilmLayer;if(!(d!=null&&d.hasThinFilm))return;this._uniforms.thinBaseLayerFactors.value.fromArray(d.baseLayerFactors),this._uniforms.thinNoiseLayerFactors.value.fromArray(d.noiseLayerFactors),this._uniforms.thinColorNoiseParams.value.fromArray(d.colorNoiseParams),this._uniforms.thinFilmFactor.value=d.filmFactor;const _=this.enabled?1:0;o.materialObject.defines.THIN_FILM_LAYER_ENABLED!==_&&(o.materialObject.defines.THIN_FILM_LAYER_ENABLED=_,o.materialObject.needsUpdate=!0)},extraUniforms:{...this._uniforms},computeCacheKey:h=>{var o,c;return(this.enabled?"1":"0")+(!((c=(o=h.materialObject.userData)===null||o===void 0?void 0:o._thinFilmLayer)===null||c===void 0)&&c.hasThinFilm?"1":"0")},isCompatible:h=>h.isMeshStandardMaterial2||h.isDiamondMaterial,updaters:()=>[],getUiConfig:h=>{const o=this._viewer,c={type:"folder",label:"ThinFilmLayer",children:[{type:"checkbox",label:"Enabled",get value(){var d;return((d=h.materialObject.userData._thinFilmLayer)===null||d===void 0?void 0:d.hasThinFilm)||!1},set value(d){var _,v;d!==((_=h.materialObject.userData._thinFilmLayer)===null||_===void 0?void 0:_.hasThinFilm)&&(d?addThinFilmLayer(h.materialObject)||o.alert("Cannot add thin film."):h.materialObject.userData._thinFilmLayer&&(h.materialObject.userData._thinFilmLayer.hasThinFilm=!1,h.materialObject.needsUpdate=!0),(v=c.uiRefresh)===null||v===void 0||v.call(c,"postFrame",!0))},onChange:this.setDirty},()=>({type:"slider",bounds:[0,1],label:"Intensity",hidden:()=>{var d;return!(!((d=h.materialObject.userData._thinFilmLayer)===null||d===void 0)&&d.hasThinFilm)},property:[h.materialObject.userData._thinFilmLayer,"filmFactor"],onChange:this.setDirty}),()=>({type:"vec4",label:"Base Layer",bounds:[0,1],hidden:()=>{var d;return!(!((d=h.materialObject.userData._thinFilmLayer)===null||d===void 0)&&d.hasThinFilm)},property:[h.materialObject.userData._thinFilmLayer,"baseLayerFactors"],onChange:this.setDirty}),()=>({type:"vec4",label:"Noise Layer",bounds:[0,1],hidden:()=>{var d;return!(!((d=h.materialObject.userData._thinFilmLayer)===null||d===void 0)&&d.hasThinFilm)},property:[h.materialObject.userData._thinFilmLayer,"noiseLayerFactors"],onChange:this.setDirty}),()=>({type:"vec4",label:"Noise Params",bounds:[0,1],hidden:()=>{var d;return!(!((d=h.materialObject.userData._thinFilmLayer)===null||d===void 0)&&d.hasThinFilm)},property:[h.materialObject.userData._thinFilmLayer,"colorNoiseParams"],onChange:this.setDirty})]};return c}},this.setDirty=()=>{var h;(h=this._viewer)===null||h===void 0||h.setDirty()},this._loaderCreate=this._loaderCreate.bind(this)}async onAdded(h){var o,c,d,_,v;await super.onAdded(h);const b=h.getPlugin(AssetManagerPlugin);(o=b==null?void 0:b.materials)===null||o===void 0||o.registerMaterialExtension(this.materialExtension),(c=b==null?void 0:b.importer)===null||c===void 0||c.addEventListener("loaderCreate",this._loaderCreate),(v=(_=(d=b==null?void 0:b.exporter)===null||d===void 0?void 0:d.getExporter("gltf","glb"))===null||_===void 0?void 0:_.extensions)===null||v===void 0||v.push(glTFMaterialsThinFilmLayerExtensionExport)}async onRemove(h){var o,c,d,_;return(c=(o=h.getPlugin(AssetManagerPlugin))===null||o===void 0?void 0:o.materials)===null||c===void 0||c.unregisterMaterialExtension(this.materialExtension),(_=(d=h.getPlugin(AssetManagerPlugin))===null||d===void 0?void 0:d.importer)===null||_===void 0||_.removeEventListener("loaderCreate",this._loaderCreate),super.onRemove(h)}};function addThinFilmLayer(h){const o=h==null?void 0:h.userData;if(!o)return!1;o._thinFilmLayer||(o._thinFilmLayer={});const c=o._thinFilmLayer;return c.hasThinFilm=!0,c.baseLayerFactors===void 0&&(c.baseLayerFactors=[.3,.6,1,.9]),c.noiseLayerFactors===void 0&&(c.noiseLayerFactors=[.7,.5,.9,.7]),c.colorNoiseParams===void 0&&(c.colorNoiseParams=[.5,.5,.5,.7]),c.filmFactor===void 0&&(c.filmFactor=.3),h.isMaterial&&(h.needsUpdate=!0),!0}ThinFilmLayerPlugin.PluginType="ThinFilmLayerPlugin",ThinFilmLayerPlugin.THIN_FILM_LAYER_GLTF_EXTENSION="WEBGI_materials_thin_film_layer",ThinFilmLayerPlugin_decorate([uiToggle("Enabled",h=>({onChange:h.setDirty})),serialize()],ThinFilmLayerPlugin.prototype,"enabled",void 0),ThinFilmLayerPlugin=ThinFilmLayerPlugin_decorate([uiFolder("ThinFilmLayer Materials")],ThinFilmLayerPlugin);class GLTFMaterialsThinFilmLayerExtensionImport{constructor(o){this.parser=o,this.name=ThinFilmLayerPlugin.THIN_FILM_LAYER_GLTF_EXTENSION}async extendMaterialParams(o,c){const d=this.parser.json.materials[o];if(!d.extensions||!d.extensions[this.name])return Promise.resolve();const _=d.extensions[this.name];return c.userData||(c.userData={}),addThinFilmLayer(c),c.userData._thinFilmLayer=deserializeObject(_,c.userData._thinFilmLayer,!1,{}),Promise.resolve()}}const glTFMaterialsThinFilmLayerExtensionExport=h=>({writeMaterial:(o,c)=>{if(!o.isMeshStandardMaterial||!o.userData._thinFilmLayer||!o.userData._thinFilmLayer.hasThinFilm)return;c.extensions=c.extensions||{};const d=serializeObject(o.userData._thinFilmLayer,!1);c.extensions[ThinFilmLayerPlugin.THIN_FILM_LAYER_GLTF_EXTENSION]=d,h.extensionsUsed[ThinFilmLayerPlugin.THIN_FILM_LAYER_GLTF_EXTENSION]=!0}});function match(h,o){const c=typeof h=="string"?h:h.path;return c===(typeof o=="string"?o:o.path)&&c||typeof h!="string"&&typeof o!="string"&&h.id&&h.id===o.id}class PresetGroup{async apply(o,c,d){var _,v,b,tt;if(!c)return void(this.selected=void 0);let it=this.presets.find(nt=>match(nt,c));return it||(this.presets.push(c),it=c),this.selected=it,typeof it!="string"?(v=(_=o.getManager())===null||_===void 0?void 0:_.importer)===null||v===void 0?void 0:v.importAsset(it,d):(tt=(b=o.getManager())===null||b===void 0?void 0:b.importer)===null||tt===void 0?void 0:tt.importPath(it,d)}addPresets(o){this.presets.push(...o.filter(c=>{const d=this.presets.find(_=>match(_,c));return!d||(typeof d=="string"?(this.presets=this.presets.filter(_=>_!==d),!0):(typeof c=="string"||Object.assign(d,c),!1))}))}clear(){this.selected=void 0}constructor(o){this.presets=[],this.name="",this.selected=void 0,o&&(this.name=o)}}class BackgroundPresetGroup extends PresetGroup{constructor(){super(...arguments),this.name="Background"}async apply(o,c){const d=await super.apply(o,c),_=d==null?void 0:d[0];return _&&(_.colorSpace=three_module.er$,o.scene.background=_,o.scene.backgroundColor=new three_module.Q1f(1,1,1)),_}}class EnvironmentPresetGroup extends PresetGroup{constructor(){super(...arguments),this.name="Environment"}async apply(o,c){const d=await super.apply(o,c),_=d==null?void 0:d[0];return _&&(o.scene.environment=_),_}}class GemEnvironmentPresetGroup extends PresetGroup{constructor(o="envMap"){super(),this.key=o,this.name="GemEnvironment",this.name+=o.split("Map")[1]}async apply(o,c){const d=await super.apply(o,c),_=d==null?void 0:d[0];return S$2(o.getPluginByType("Diamond"),this.key,_),_}}class PluginPresetGroup extends PresetGroup{async apply(o,c){var d,_;const v=await super.apply(o,c,{processImported:!1});return v?(_=(d=o.getManager())===null||d===void 0?void 0:d.importer)===null||_===void 0?void 0:_.processImported(v):void 0}}class ModelStagePresetGroup extends PresetGroup{constructor(){super(...arguments),this.name="ModelStage"}async apply(o,c){var d;const _=typeof c=="string"?c:c.path;let v=!1;try{v=new URL(_.includes("://")?_:"https://example.com/"+_).pathname.endsWith(".json")}catch{v=_.endsWith(".json")}if(v)return super.apply(o,c);{const b=o.getPluginByType("ModelStagePlugin");return b==null?void 0:b.setModel((d=c.file)!==null&&d!==void 0?d:_)}}}class MaterialLibPresetGroupPresetGroup extends PluginPresetGroup{constructor(){super(...arguments),this.name="MaterialLibraries"}async apply(o,c){const d=await super.apply(o,c);return d&&await o.alert("Material Library successfully imported."),d}}class VJSONPresetGroup extends PresetGroup{constructor(){super(...arguments),this.name="VJSON",this.usePresetCamera=!1,this.usePresetLoadingPlugin=!1,this.usePresetInteractionPlugin=!1,this.usePresetParallaxMappingPlugin=!1,this.usePresetRendererUiPlugin=!1,this.usePresetCameraViewPlugin=!1,this.usePresetMaterialConfiguratorPlugin=!1,this.usePresetSwitchNodePlugin=!1}async apply(o,c){const d=o.scene.activeCamera.toJSON(),_=o.serializePluginsIgnored;o.serializePluginsIgnored=[..._,this.usePresetLoadingPlugin?null:"LoadingScreenPlugin",this.usePresetInteractionPlugin?null:"InteractionPromptPlugin",this.usePresetParallaxMappingPlugin?null:"ReliefParallaxMapping",this.usePresetRendererUiPlugin?null:"RendererParamsUiPlugin",this.usePresetCameraViewPlugin?null:"CameraViews",this.usePresetMaterialConfiguratorPlugin?null:"MaterialConfiguratorPlugin",this.usePresetSwitchNodePlugin?null:"SwitchNodePlugin","FrameFade","GLTFAnimationPlugin","ModelStagePlugin","AssetExporterPlugin"].filter(b=>b);const v=await super.apply(o,c);return o.serializePluginsIgnored=_,this.usePresetCamera||o.scene.activeCamera.fromJSON(d),v}}class PresetLibraryPlugin extends AViewerPlugin{constructor(){super(...arguments),this.toJSON=null,this.enabled=!0,this.presetGroups=[],this.uiConfig={type:"folder",label:"Presets",expanded:!0,limitedUi:!0,children:[()=>this.presetGroups.map(o=>({type:"dropdown",label:o.name,limitedUi:!0,children:[{value:"",label:"none"},...o.presets.map(c=>{var d;return{label:((d=tPresetToString(c))===null||d===void 0?void 0:d.split("/").pop())||"",value:tPresetToString(c)}})],getValue:()=>tPresetToString(o.selected)||"",setValue:c=>{o.apply(this._viewer,o.presets.find(d=>tPresetToString(d)===c))}})),{type:"button",label:"Download Selection",limitedUi:!0,value:()=>{const o=this.exportPresets();me$1(new File([JSON.stringify(o,null,2)],"preset.template.json",{type:"application/json"}))}},{type:"button",label:"Export Preset Groups",limitedUi:!1,value:()=>{const o=this.exportPresetGroups();me$1(new File([JSON.stringify(o,null,2)],"presetGroups.json",{type:"application/json"}))}}]}}async onAdded(o){var c,d;await super.onAdded(o),this.presetGroups.push(new BackgroundPresetGroup),this.presetGroups.push(new EnvironmentPresetGroup),this.presetGroups.push(new GemEnvironmentPresetGroup),this.presetGroups.push(new GemEnvironmentPresetGroup("envMap2")),this.presetGroups.push(new GemEnvironmentPresetGroup("envMap3")),this.presetGroups.push(new PluginPresetGroup("Ground")),this.presetGroups.push(new PluginPresetGroup("CameraViews")),this.presetGroups.push(new PluginPresetGroup("MaterialConfiguration")),this.presetGroups.push(new ModelStagePresetGroup),this.presetGroups.push(new MaterialLibPresetGroupPresetGroup),this.presetGroups.push(new VJSONPresetGroup),(d=(c=this.uiConfig).uiRefresh)===null||d===void 0||d.call(c,"postFrame",!0)}exportPresets(){const o=Object.fromEntries(this.presetGroups.map(c=>[c.name,c.selected?cleanAsset(c.selected):void 0]).filter(([,c])=>c));return o.type=PresetLibraryPlugin.PluginType,o}async fromJSON(o,c){var d,_;if(!super.fromJSON(o,c))return null;const v={...o};if(delete v.type,v.VJSON&&this._viewer){const tt=this.presetGroups.find(nt=>nt.name==="VJSON"),it=tt==null?void 0:tt.presets;tt&&it&&await tt.apply(this._viewer,v.VJSON),delete v.VJSON}const b=[];for(const[tt,it]of Object.entries(v)){const nt=this.presetGroups.find(ht=>ht.name===tt),lt=nt==null?void 0:nt.presets;if(!nt||!lt)continue;const ut=it;b.push(nt.apply(this._viewer,ut))}return await Promise.all(b),(_=(d=this.uiConfig).uiRefresh)===null||_===void 0||_.call(d,"postFrame",!0),this}async loadPresetGroups(o){typeof o=="string"&&o.startsWith("http")&&(o=await fetch(o).then(async c=>c.json()));for(const[c,d]of Object.entries(o)){const _=this.presetGroups.find(v=>v.name===c);_==null||_.addPresets(d)}}exportPresetGroups(){return Object.fromEntries(this.presetGroups.map(o=>[o.name,o.presets.map(cleanAsset)]).filter(([,o])=>o.length>0))}clear(){this.presetGroups.forEach(o=>{o.clear()})}}function tPresetToString(h){return h&&typeof h!="string"?h.path||h.id:h}PresetLibraryPlugin.PluginType="PresetLibraryPlugin";const cleanAsset=h=>(h.preImported&&delete(h={...h}).preImported,h);var grain="vec4 grain(in vec4 color){float x=(vUv.x+4.)*(vUv.y+4.)*(10.);vec4 grain=vec4(mod((mod(x,13.)+1.)*(mod(x,123.)+1.),0.01)-0.005)*grainIntensity;vec4 outColor=color;if(grainMultiply){grain=1.-grain;outColor.rgb=color.rgb*vec3(grain);}else{outColor.rgb=color.rgb+vec3(grain);}return outColor;}",FilmicGrainPlugin_decorate=function(h,o,c,d){var _,v=arguments.length,b=v<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(h,o,c,d);else for(var tt=h.length-1;tt>=0;tt--)(_=h[tt])&&(b=(v<3?_(b):v>3?_(o,c,b):_(o,c))||b);return v>3&&b&&Object.defineProperty(o,c,b),b};let FilmicGrainExtension=class{constructor(h){this.enabled=!1,this.grainMultiply=!1,this.grainIntensity=10,this.extraUniforms={grainIntensity:{value:1},grainMultiply:{value:1}},this.parsFragmentSnippet=(o,c)=>this.enabled?fe$1`
            uniform float grainIntensity;
            uniform bool grainMultiply;
            ${grain}
        `:"",this._combinedPostPlugin=h.getPlugin(CombinedPostPlugin),this._setDirty=this._setDirty.bind(this)}shaderExtender(h,o,c){this.enabled&&(h.fragmentShader=shaderReplaceString(h.fragmentShader,"#glMarker",` 
            gl_FragColor = grain(gl_FragColor);
            #glMarker
        `))}onObjectRender(h,o,c){this.enabled&&(this.extraUniforms.grainIntensity.value=this.grainIntensity,this.extraUniforms.grainMultiply.value=this.grainMultiply)}getUiConfig(){return this.uiConfig}computeCacheKey(h){return this.enabled?"1":"0"}isCompatible(h){return!0}_setDirty(){this._combinedPostPlugin&&(this._combinedPostPlugin.pass.dirty=!0)}setDirty(){var h;(h=this.__setDirty)===null||h===void 0||h.call(this),this._setDirty()}};FilmicGrainPlugin_decorate([x$1(FilmicGrainExtension.prototype._setDirty),uiToggle("Enable"),serialize()],FilmicGrainExtension.prototype,"enabled",void 0),FilmicGrainPlugin_decorate([x$1(FilmicGrainExtension.prototype._setDirty),uiToggle("Multiply"),serialize()],FilmicGrainExtension.prototype,"grainMultiply",void 0),FilmicGrainPlugin_decorate([x$1(FilmicGrainExtension.prototype._setDirty),uiSlider("Intensity",[0,20],.01,{limitedUi:!0}),serialize()],FilmicGrainExtension.prototype,"grainIntensity",void 0),FilmicGrainExtension=FilmicGrainPlugin_decorate([uiFolder("FilmicGrain")],FilmicGrainExtension);class FilmicGrainPlugin extends GenericExtensionPlugin{constructor(){super()}generateExtension(o){return new FilmicGrainExtension(o)}get intensity(){var o,c;return(c=(o=this._extension)===null||o===void 0?void 0:o.grainIntensity)!==null&&c!==void 0?c:1}set intensity(o){this._extension&&(this._extension.grainIntensity=o,this._extension.setDirty())}get multiply(){var o,c;return(c=(o=this._extension)===null||o===void 0?void 0:o.grainMultiply)!==null&&c!==void 0&&c}set multiply(o){this._extension&&(this._extension.grainMultiply=o,this._extension.setDirty())}}FilmicGrainPlugin.PluginType="FilmicGrain";class ObjectPicker extends I$2{get scene(){return this._scene}set scene(o){var c;(c=this._scene)===null||c===void 0||c.removeEventListener("activeCameraChange",this._activeCameraChange),this._scene=o,this._scene.addEventListener("activeCameraChange",this._activeCameraChange)}constructor(o,c,d,_){super(),this.hoverEnabled=!1,this._mouseDownPos=new three_module.I9Y,this._scene=o,this._camera=d??this._scene.activeCamera,this.domElement=c,this._time=this.time,this._mouseDownTime=0,this._mouseUpTime=1,this.selectionCondition=_??(v=>v.userData.userSelectable!==!1&&v.userData.bboxVisible!==!1&&v.material!=null&&v.material.type!=="ShadowMaterial"),this.raycaster=new three_module.tBo,this.mouse=new three_module.I9Y,this._selected=[],this._hovering=[],this.cursorStyles={default:"grab",down:"grabbing"},this._activeCameraChange=this._activeCameraChange.bind(this),this._scene.addEventListener("activeCameraChange",this._activeCameraChange),this.domElement.style.touchAction="none",this.domElement.style.cursor=this.cursorStyles.default,this.domElement.addEventListener("pointermove",v=>this.onPointerMove(v)),this.domElement.addEventListener("pointerleave",v=>this.onPointerLeave(v)),this.domElement.addEventListener("pointerout",v=>this.onPointerLeave(v)),this.domElement.addEventListener("pointercancel",v=>this.onPointerCancel(v)),this.domElement.addEventListener("pointerenter",v=>this.onPointerEnter(v)),this.domElement.addEventListener("pointerdown",v=>this.onPointerDown(v)),this.domElement.addEventListener("pointerup",v=>this.onPointerUp(v))}_activeCameraChange(){this.camera=this._scene.activeCamera}get camera(){return this._camera}set camera(o){this._camera=o}get selectedObject(){return this._selected.length>0?this._selected[0]:null}set selectedObject(o){this._selected.length===1&&this._selected[0]===o||(this._selected=o?Array.isArray(o)?[...o]:[o]:[],this.dispatchEvent({type:"selectedObjectChanged",object:this.selectedObject}))}get hoverObject(){return this._hovering.length>0?this._hovering[0]:null}set hoverObject(o){this._hovering=o?Array.isArray(o)?[...o]:[o]:[],this.dispatchEvent({type:"hoverObjectChanged",object:this.hoverObject})}get time(){return this._time=g(),this._time}get isMouseDown(){return this.mouseDownDeltaTime<0}get mouseDownDeltaTime(){return this._mouseUpTime-this._mouseDownTime}onPointerMove(o){var c,d;o.isPrimary!==!1&&(this.updateMouseFromEvent(o),this.hoverEnabled&&(this.hoverObject=(d=(c=this.checkIntersection())===null||c===void 0?void 0:c.intersects[0].object)!==null&&d!==void 0?d:null))}onPointerLeave(o){o.isPrimary!==!1&&(this.domElement.style.cursor=this.cursorStyles.default,(this.hoverEnabled||this.hoverObject)&&(this.hoverObject=null))}onPointerEnter(o){}onPointerCancel(o){}updateMouseFromEvent(o){const c=this.domElement.getBoundingClientRect();this.mouse.x=(o.clientX-c.x)/c.width*2-1,this.mouse.y=-(o.clientY-c.y)/c.height*2+1}onPointerDown(o){o.isPrimary!==!1&&(this.domElement.style.cursor=this.cursorStyles.down,this._mouseDownTime=this.time,this._mouseDownPos.copy(this.mouse))}onDoubleClick(o){console.log("double click")}onPointerUp(o){if(o.isPrimary===!1)return;this.domElement.style.cursor=this.cursorStyles.default,this._mouseUpTime=this.time;const c=this.mouseDownDeltaTime,d=this._mouseDownPos.distanceTo(this.mouse);c<ObjectPicker.PointerClickMaxTime&&d<ObjectPicker.PointerClickMaxDistance&&this.onPointerClick(o)}onPointerClick(o){if(o.isPrimary===!1)return;this.updateMouseFromEvent(o);const c=this.checkIntersection();c&&this.dispatchEvent({type:"hitObject",time:this._mouseUpTime,intersects:c}),this.selectedObject=(c==null?void 0:c.selectedObject)||null}addPasses(){}checkIntersection(){var o;const c=(o=this._camera)===null||o===void 0?void 0:o.cameraObject;if(!c)return null;this.raycaster.setFromCamera(this.mouse,c);let d=this.raycaster.intersectObject(this._scene.modelRoot.modelObject,!0);const _=[];d=d.filter(it=>!_.includes(it.object.id)&&(_.push(it.object.id),!0));let v,b=null;const tt=[];for(const it of d){for(b=it.object,v=it;!(b==null||b.visible&&this.selectionCondition(b));)b=b.parent;b!=null&&tt.push(it)}if(d=tt,d.length>0){if(b=d[0].object,v=d[0],this._firstHit&&b.id!==this._firstHit.id)b=v.object;else for(let it=0;it<d.length;it++)if(this.selectedObject&&this.selectedObject.id===d[it].object.id){const nt=it+1;if(!(nt<d.length))return null;v=d[nt],b=v.object}this._firstHit=d[0].object}return b&&v&&b?{selectedObject:b,intersect:v,intersects:d,mouse:this.mouse.toArray()}:null}isHovering(){return this.hoverObject!=null}isSelected(){return this.selectedObject!=null}}ObjectPicker.PointerClickMaxTime=200,ObjectPicker.PointerClickMaxDistance=.1;const LineSegmentsGeometry_box=new three_module.NRn,LineSegmentsGeometry_vector=new three_module.Pq0;class LineSegmentsGeometry extends three_module.CmU{constructor(){super(),this.isLineSegmentsGeometry=!0,this.type="LineSegmentsGeometry",this.setIndex([0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5]),this.setAttribute("position",new three_module.qtW([-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],3)),this.setAttribute("uv",new three_module.qtW([-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],2))}applyMatrix4(o){const c=this.attributes.instanceStart,d=this.attributes.instanceEnd;return c!==void 0&&(c.applyMatrix4(o),d.applyMatrix4(o),c.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}setPositions(o){let c;o instanceof Float32Array?c=o:Array.isArray(o)&&(c=new Float32Array(o));const d=new three_module.LuO(c,6,1);return this.setAttribute("instanceStart",new three_module.eHs(d,3,0)),this.setAttribute("instanceEnd",new three_module.eHs(d,3,3)),this.computeBoundingBox(),this.computeBoundingSphere(),this}setColors(o){let c;o instanceof Float32Array?c=o:Array.isArray(o)&&(c=new Float32Array(o));const d=new three_module.LuO(c,6,1);return this.setAttribute("instanceColorStart",new three_module.eHs(d,3,0)),this.setAttribute("instanceColorEnd",new three_module.eHs(d,3,3)),this}fromWireframeGeometry(o){return this.setPositions(o.attributes.position.array),this}fromEdgesGeometry(o){return this.setPositions(o.attributes.position.array),this}fromMesh(o){return this.fromWireframeGeometry(new three_module.XJ7(o.geometry)),this}fromLineSegments(o){const c=o.geometry;return this.setPositions(c.attributes.position.array),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new three_module.NRn);const o=this.attributes.instanceStart,c=this.attributes.instanceEnd;o!==void 0&&c!==void 0&&(this.boundingBox.setFromBufferAttribute(o),LineSegmentsGeometry_box.setFromBufferAttribute(c),this.boundingBox.union(LineSegmentsGeometry_box))}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new three_module.iyt),this.boundingBox===null&&this.computeBoundingBox();const o=this.attributes.instanceStart,c=this.attributes.instanceEnd;if(o!==void 0&&c!==void 0){const d=this.boundingSphere.center;this.boundingBox.getCenter(d);let _=0;for(let v=0,b=o.count;v<b;v++)LineSegmentsGeometry_vector.fromBufferAttribute(o,v),_=Math.max(_,d.distanceToSquared(LineSegmentsGeometry_vector)),LineSegmentsGeometry_vector.fromBufferAttribute(c,v),_=Math.max(_,d.distanceToSquared(LineSegmentsGeometry_vector));this.boundingSphere.radius=Math.sqrt(_),isNaN(this.boundingSphere.radius)&&console.error("THREE.LineSegmentsGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}toJSON(){}applyMatrix(o){return console.warn("THREE.LineSegmentsGeometry: applyMatrix() has been renamed to applyMatrix4()."),this.applyMatrix4(o)}}class WireframeGeometry2 extends LineSegmentsGeometry{constructor(o){super(),this.isWireframeGeometry2=!0,this.type="WireframeGeometry2",this.fromWireframeGeometry(new three_module.XJ7(o))}}three_module.fCn.line={worldUnits:{value:1},linewidth:{value:1},resolution:{value:new three_module.I9Y(1,1)},dashOffset:{value:0},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1}},three_module.zkh.line={uniforms:three_module.LlO.merge([three_module.fCn.common,three_module.fCn.fog,three_module.fCn.line]),vertexShader:`
		#include <common>
		#include <color_pars_vertex>
		#include <fog_pars_vertex>
		#include <logdepthbuf_pars_vertex>
		#include <clipping_planes_pars_vertex>

		uniform float linewidth;
		uniform vec2 resolution;

		attribute vec3 instanceStart;
		attribute vec3 instanceEnd;

		attribute vec3 instanceColorStart;
		attribute vec3 instanceColorEnd;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#ifdef USE_DASH

			uniform float dashScale;
			attribute float instanceDistanceStart;
			attribute float instanceDistanceEnd;
			varying float vLineDistance;

		#endif

		void trimSegment( const in vec4 start, inout vec4 end ) {

			// trim end segment so it terminates between the camera plane and the near plane

			// conservative estimate of the near plane
			float a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column
			float b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column
			float nearEstimate = - 0.5 * b / a;

			float alpha = ( nearEstimate - start.z ) / ( end.z - start.z );

			end.xyz = mix( start.xyz, end.xyz, alpha );

		}

		void main() {

			#ifdef USE_COLOR

				vColor.xyz = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;

			#endif

			#ifdef USE_DASH

				vLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;
				vUv = uv;

			#endif

			float aspect = resolution.x / resolution.y;

			// camera space
			vec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );
			vec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );

			#ifdef WORLD_UNITS

				worldStart = start.xyz;
				worldEnd = end.xyz;

			#else

				vUv = uv;

			#endif

			// special case for perspective projection, and segments that terminate either in, or behind, the camera plane
			// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space
			// but we need to perform ndc-space calculations in the shader, so we must address this issue directly
			// perhaps there is a more elegant solution -- WestLangley

			bool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column

			if ( perspective ) {

				if ( start.z < 0.0 && end.z >= 0.0 ) {

					trimSegment( start, end );

				} else if ( end.z < 0.0 && start.z >= 0.0 ) {

					trimSegment( end, start );

				}

			}

			// clip space
			vec4 clipStart = projectionMatrix * start;
			vec4 clipEnd = projectionMatrix * end;

			// ndc space
			vec3 ndcStart = clipStart.xyz / clipStart.w;
			vec3 ndcEnd = clipEnd.xyz / clipEnd.w;

			// direction
			vec2 dir = ndcEnd.xy - ndcStart.xy;

			// account for clip-space aspect ratio
			dir.x *= aspect;
			dir = normalize( dir );

			#ifdef WORLD_UNITS

				// get the offset direction as perpendicular to the view vector
				vec3 worldDir = normalize( end.xyz - start.xyz );
				vec3 offset;
				if ( position.y < 0.5 ) {

					offset = normalize( cross( start.xyz, worldDir ) );

				} else {

					offset = normalize( cross( end.xyz, worldDir ) );

				}

				// sign flip
				if ( position.x < 0.0 ) offset *= - 1.0;

				float forwardOffset = dot( worldDir, vec3( 0.0, 0.0, 1.0 ) );

				// don't extend the line if we're rendering dashes because we
				// won't be rendering the endcaps
				#ifndef USE_DASH

					// extend the line bounds to encompass  endcaps
					start.xyz += - worldDir * linewidth * 0.5;
					end.xyz += worldDir * linewidth * 0.5;

					// shift the position of the quad so it hugs the forward edge of the line
					offset.xy -= dir * forwardOffset;
					offset.z += 0.5;

				#endif

				// endcaps
				if ( position.y > 1.0 || position.y < 0.0 ) {

					offset.xy += dir * 2.0 * forwardOffset;

				}

				// adjust for linewidth
				offset *= linewidth * 0.5;

				// set the world position
				worldPos = ( position.y < 0.5 ) ? start : end;
				worldPos.xyz += offset;

				// project the worldpos
				vec4 clip = projectionMatrix * worldPos;

				// shift the depth of the projected points so the line
				// segments overlap neatly
				vec3 clipPose = ( position.y < 0.5 ) ? ndcStart : ndcEnd;
				clip.z = clipPose.z * clip.w;

			#else

				vec2 offset = vec2( dir.y, - dir.x );
				// undo aspect ratio adjustment
				dir.x /= aspect;
				offset.x /= aspect;

				// sign flip
				if ( position.x < 0.0 ) offset *= - 1.0;

				// endcaps
				if ( position.y < 0.0 ) {

					offset += - dir;

				} else if ( position.y > 1.0 ) {

					offset += dir;

				}

				// adjust for linewidth
				offset *= linewidth;

				// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...
				offset /= resolution.y;

				// select end
				vec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;

				// back to clip space
				offset *= clip.w;

				clip.xy += offset;

			#endif

			gl_Position = clip;

			vec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation

			#include <logdepthbuf_vertex>
			#include <clipping_planes_vertex>
			#include <fog_vertex>

		}
		`,fragmentShader:`
		uniform vec3 diffuse;
		uniform float opacity;
		uniform float linewidth;

		#ifdef USE_DASH

			uniform float dashOffset;
			uniform float dashSize;
			uniform float gapSize;

		#endif

		varying float vLineDistance;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#include <common>
		#include <color_pars_fragment>
		#include <fog_pars_fragment>
		#include <logdepthbuf_pars_fragment>
		#include <clipping_planes_pars_fragment>

		vec2 closestLineToLine(vec3 p1, vec3 p2, vec3 p3, vec3 p4) {

			float mua;
			float mub;

			vec3 p13 = p1 - p3;
			vec3 p43 = p4 - p3;

			vec3 p21 = p2 - p1;

			float d1343 = dot( p13, p43 );
			float d4321 = dot( p43, p21 );
			float d1321 = dot( p13, p21 );
			float d4343 = dot( p43, p43 );
			float d2121 = dot( p21, p21 );

			float denom = d2121 * d4343 - d4321 * d4321;

			float numer = d1343 * d4321 - d1321 * d4343;

			mua = numer / denom;
			mua = clamp( mua, 0.0, 1.0 );
			mub = ( d1343 + d4321 * ( mua ) ) / d4343;
			mub = clamp( mub, 0.0, 1.0 );

			return vec2( mua, mub );

		}

		void main() {

			#include <clipping_planes_fragment>

			#ifdef USE_DASH

				if ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps

				if ( mod( vLineDistance + dashOffset, dashSize + gapSize ) > dashSize ) discard; // todo - FIX

			#endif

			float alpha = opacity;

			#ifdef WORLD_UNITS

				// Find the closest points on the view ray and the line segment
				vec3 rayEnd = normalize( worldPos.xyz ) * 1e5;
				vec3 lineDir = worldEnd - worldStart;
				vec2 params = closestLineToLine( worldStart, worldEnd, vec3( 0.0, 0.0, 0.0 ), rayEnd );

				vec3 p1 = worldStart + lineDir * params.x;
				vec3 p2 = rayEnd * params.y;
				vec3 delta = p1 - p2;
				float len = length( delta );
				float norm = len / linewidth;

				#ifndef USE_DASH

					#ifdef USE_ALPHA_TO_COVERAGE

						float dnorm = fwidth( norm );
						alpha = 1.0 - smoothstep( 0.5 - dnorm, 0.5 + dnorm, norm );

					#else

						if ( norm > 0.5 ) {

							discard;

						}

					#endif

				#endif

			#else

				#ifdef USE_ALPHA_TO_COVERAGE

					// artifacts appear on some hardware if a derivative is taken within a conditional
					float a = vUv.x;
					float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
					float len2 = a * a + b * b;
					float dlen = fwidth( len2 );

					if ( abs( vUv.y ) > 1.0 ) {

						alpha = 1.0 - smoothstep( 1.0 - dlen, 1.0 + dlen, len2 );

					}

				#else

					if ( abs( vUv.y ) > 1.0 ) {

						float a = vUv.x;
						float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
						float len2 = a * a + b * b;

						if ( len2 > 1.0 ) discard;

					}

				#endif

			#endif

			vec4 diffuseColor = vec4( diffuse, alpha );

			#include <logdepthbuf_fragment>
			#include <color_fragment>

			gl_FragColor = vec4( diffuseColor.rgb, alpha );

			#include <tonemapping_fragment>
			#include <colorspace_fragment>
			#include <fog_fragment>
			#include <premultiplied_alpha_fragment>

		}
		`};class LineMaterial extends three_module.BKk{constructor(o){super({type:"LineMaterial",uniforms:three_module.LlO.clone(three_module.zkh.line.uniforms),vertexShader:three_module.zkh.line.vertexShader,fragmentShader:three_module.zkh.line.fragmentShader,clipping:!0}),this.isLineMaterial=!0,this.setValues(o)}get color(){return this.uniforms.diffuse.value}set color(o){this.uniforms.diffuse.value=o}get worldUnits(){return"WORLD_UNITS"in this.defines}set worldUnits(o){o===!0?this.defines.WORLD_UNITS="":delete this.defines.WORLD_UNITS}get linewidth(){return this.uniforms.linewidth.value}set linewidth(o){this.uniforms.linewidth&&(this.uniforms.linewidth.value=o)}get dashed(){return"USE_DASH"in this.defines}set dashed(o){o===!0!==this.dashed&&(this.needsUpdate=!0),o===!0?this.defines.USE_DASH="":delete this.defines.USE_DASH}get dashScale(){return this.uniforms.dashScale.value}set dashScale(o){this.uniforms.dashScale.value=o}get dashSize(){return this.uniforms.dashSize.value}set dashSize(o){this.uniforms.dashSize.value=o}get dashOffset(){return this.uniforms.dashOffset.value}set dashOffset(o){this.uniforms.dashOffset.value=o}get gapSize(){return this.uniforms.gapSize.value}set gapSize(o){this.uniforms.gapSize.value=o}get opacity(){return this.uniforms.opacity.value}set opacity(o){this.uniforms&&(this.uniforms.opacity.value=o)}get resolution(){return this.uniforms.resolution.value}set resolution(o){this.uniforms.resolution.value.copy(o)}get alphaToCoverage(){return"USE_ALPHA_TO_COVERAGE"in this.defines}set alphaToCoverage(o){this.defines&&(o===!0!==this.alphaToCoverage&&(this.needsUpdate=!0),o===!0?(this.defines.USE_ALPHA_TO_COVERAGE="",this.extensions.derivatives=!0):(delete this.defines.USE_ALPHA_TO_COVERAGE,this.extensions.derivatives=!1))}}const _start=new three_module.Pq0,_end=new three_module.Pq0;class Wireframe extends three_module.eaF{constructor(o=new LineSegmentsGeometry,c=new LineMaterial({color:16777215*Math.random()})){super(o,c),this.isWireframe=!0,this.type="Wireframe"}computeLineDistances(){const o=this.geometry,c=o.attributes.instanceStart,d=o.attributes.instanceEnd,_=new Float32Array(2*c.count);for(let b=0,tt=0,it=c.count;b<it;b++,tt+=2)_start.fromBufferAttribute(c,b),_end.fromBufferAttribute(d,b),_[tt]=tt===0?0:_[tt-1],_[tt+1]=_[tt]+_start.distanceTo(_end);const v=new three_module.LuO(_,2,1);return o.setAttribute("instanceDistanceStart",new three_module.eHs(v,1,0)),o.setAttribute("instanceDistanceEnd",new three_module.eHs(v,1,1)),this}}class SelectionWidget extends three_module.YJl{_updater(){const o=this._object;if(o){const c=new Box3B().expandByObject(o,!1);c.getCenter(this.position);const d=c.getBoundingSphere(new three_module.iyt).radius;this.scale.setScalar(d*this.boundingScaleMultiplier),this.setVisible(!0)}else this.setVisible(!1)}constructor(){super(),this.assetType="widget",this.modelObject=this,this._object=null,this.boundingScaleMultiplier=1,this.position.set(0,0,0),this.visible=!1,this.renderOrder=1,this.userData.bboxVisible=!1,this._updater=this._updater.bind(this)}_initGeometry(o){if(this._geometry)return;const c=new WireframeGeometry2(o);this._geometry=c;const d=new LineMaterial({color:"#ff2222",transparent:!0,opacity:.9,linewidth:5,resolution:new three_module.I9Y(1024,1024),dashed:!1,toneMapped:!1}),_=new Wireframe(c,d);_.computeLineDistances(),_.scale.set(1,1,1),_.visible=!0,this.add(_)}setVisible(o){var c;o!==this.visible&&(this.visible=o,(c=this.setDirty)===null||c===void 0||c.call(this,{sceneUpdate:!1}))}attach(o){return this.detach(),o?(this._object=o,this._object.addEventListener("objectUpdate",this._updater),this._updater(),this):this}detach(){var o;return this._object?((o=this._object)===null||o===void 0||o.removeEventListener("objectUpdate",this._updater),this._object=null,this._updater(),this):this}get object(){return this._object}}class BoxSelectionWidget extends SelectionWidget{constructor(){super(),this.boundingScaleMultiplier=1/1.7,this._initGeometry(new three_module.iNn(2,2,2,1,1,1))}_updater(){super._updater();const o=this.object;o&&(new Box3B().expandByObject(o,!1).getSize(this.scale).multiplyScalar(this.boundingScaleMultiplier).clampScalar(.1,100),this.setVisible(!0))}}var PickingPlugin_decorate=function(h,o,c,d){var _,v=arguments.length,b=v<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(h,o,c,d);else for(var tt=h.length-1;tt>=0;tt--)(_=h[tt])&&(b=(v<3?_(b):v>3?_(o,c,b):_(o,c))||b);return v>3&&b&&Object.defineProperty(o,c,b),b};class PickingPlugin extends AViewerPlugin{get widgetEnabled(){return this._enableWidget}get picker(){return this._picker}setDirty(){var o;(o=this._viewer)===null||o===void 0||o.setDirty()}constructor(o=BoxSelectionWidget,c=!1,d=!0,_=!1){super(),this.enabled=!0,this._enableWidget=!0,this.autoFocus=!1,this._onObjectHit=v=>{this._viewer&&(this.enabled?this.dispatchEvent(v):v.intersects.selectedObject=null)},this._uiConfigChildren=[{label:"Enabled",type:"checkbox",property:[this,"enabled"]},{label:"AutoFocus",type:"checkbox",property:[this,"autoFocus"],onChange:()=>{const v=this.getSelectedObject();this.autoFocus&&v&&this.setSelectedObject(v,!0)}}],o&&(this._widget=new o),c&&console.error("PickingPlugin - controls removed. Use the new TransformControlsPlugin"),this._pickUi=d,this.autoFocus=_}getSelectedObject(){var o;if(this.enabled)return((o=this._picker)===null||o===void 0?void 0:o.selectedObject)||void 0}setSelectedObject(o,c=!1){if(!this.enabled||!this._picker)return;const d=this.autoFocus;this.autoFocus=!1,this._picker.selectedObject=o||null,this.autoFocus=d,(d||c)&&this.focusObject(o)}async onAdded(o){await super.onAdded(o),this._picker=new ObjectPicker(o.scene,o.canvas,void 0,c=>{var d,_;if(!c.material)return!1;let v=c,b=!1;for(;v;){if(!v.visible||(((d=v.userData.iModel)!==null&&d!==void 0?d:v).assetType==="model"&&(b=!0),((_=v.userData.iModel)!==null&&_!==void 0?_:v).assetType==="widget")||v.userData.userSelectable===!1||v.userData.bboxVisible===!1)return!1;v=v.parent}return b}),this._widget&&o.scene.addWidget(this._widget),this._picker.addEventListener("selectedObjectChanged",c=>{var d,_;this.dispatchEvent(c);const v=((d=this._picker)===null||d===void 0?void 0:d.selectedObject)||void 0;if(this._pickUi){const tt=v==null?void 0:v.uiConfig,it=this.uiConfig;it.children=[...this._uiConfigChildren],tt&&it.children.push(tt),(_=it.uiRefresh)===null||_===void 0||_.call(it)}const b=this._widget;b&&this._enableWidget&&(v?b.attach(v):b.detach()),o.setDirty(),this.autoFocus&&this.focusObject(v)}),this._picker.addEventListener("hoverObjectChanged",this.dispatchEvent),this._picker.addEventListener("hitObject",this._onObjectHit),o.scene.addEventListener("select",c=>{c.value===void 0?console.warn("WebGi: e.value must be set for picking, can be null to unselect"):c.value.isObject3D&&this.setSelectedObject(c.value,this.autoFocus||c.focusCamera)}),o.scene.addEventListener("addSceneObject",async c=>{var d,_,v;const b=c.object,tt=this.getSelectedObject();if(tt&&(b==null?void 0:b.assetType)==="material"&&typeof(tt==null?void 0:tt.setMaterial)=="function"&&!((d=tt==null?void 0:tt.modelObject)===null||d===void 0)&&d.isMesh&&await o.confirm("Applying material: Apply material to the selected object?")){const it=tt.material;if(Array.isArray(it))console.warn("WebGi: Dropping on material array not yet fully supported."),tt.setMaterial(b);else{let nt=Array.from((_=it==null?void 0:it.userData.__appliedMeshes)!==null&&_!==void 0?_:[]);(nt.length>1?!await o.confirm("Applying material: Apply to all objects using this material?"):nt.length<1)&&(nt=[tt]);for(const lt of nt)lt&&((v=lt.setMaterial)===null||v===void 0||v.call(lt,b))}}}),o.scene.addEventListener("sceneUpdate",c=>{if(!c.hierarchyChanged)return;const d=this.getSelectedObject();let _=!1;d==null||d.traverseAncestors(v=>{v===o.scene.modelObject&&(_=!0)}),_||this.setSelectedObject(void 0)})}async focusObject(o){var c,d,_,v;const b=(c=this._viewer)===null||c===void 0?void 0:c.getPluginByType("CameraViews");await(b==null?void 0:b.animateToFitObject(o,1.25,1e3,"easeOut",{min:((v=(_=(d=this._viewer)===null||d===void 0?void 0:d.scene.activeCamera.getControls())===null||_===void 0?void 0:_.minDistance)!==null&&v!==void 0?v:.5)+.5,max:50}))}enableWidget(o){var c,d,_;if(this._enableWidget=o,o){const v=((c=this._picker)===null||c===void 0?void 0:c.selectedObject)||void 0;v&&((d=this._widget)===null||d===void 0||d.attach(v))}else(_=this._widget)===null||_===void 0||_.detach()}get uiConfig(){return this._pickUi?this._uiConfig?this._uiConfig:this._uiConfig={type:"panel",label:"Picker",expanded:!0,children:[...this._uiConfigChildren]}:{}}get widget(){return this._widget}}PickingPlugin.PluginType="Picking",PickingPlugin_decorate([serialize()],PickingPlugin.prototype,"enabled",void 0),PickingPlugin_decorate([serialize()],PickingPlugin.prototype,"autoFocus",void 0);var customBumpMat=`#if defined(CUSTOM_BUMP_MAP_ENABLED) && CUSTOM_BUMP_MAP_ENABLED > 0
#if CUSTOM_BUMP_MAP_BICUBIC > 0  
vec4 cubic_cb(float v){vec4 n=vec4(1.,2.,3.,4.)-v;vec4 s=n*n*n;float x=s.x;float y=s.y-4.*s.x;float z=s.z-4.*s.y+6.*s.x;float w=6.-x-y-z;return vec4(x,y,z,w)*(1./6.);}vec4 textureBicubic_cb(sampler2D sampler,vec2 texCoords){vec2 texSize=vec2(textureSize(sampler,0));vec2 invTexSize=1./texSize;texCoords=texCoords*texSize-0.5;vec2 fxy=fract(texCoords);texCoords-=fxy;vec4 xcubic=cubic_cb(fxy.x);vec4 ycubic=cubic_cb(fxy.y);vec4 c=texCoords.xxyy+vec2(-0.5,+1.5).xyxy;vec4 s=vec4(xcubic.xz+xcubic.yw,ycubic.xz+ycubic.yw);vec4 offset=c+vec4(xcubic.yw,ycubic.yw)/s;offset*=invTexSize.xxyy;vec4 sample0=texture(sampler,offset.xz);vec4 sample1=texture(sampler,offset.yz);vec4 sample2=texture(sampler,offset.xw);vec4 sample3=texture(sampler,offset.yw);float sx=s.x/(s.x+s.y);float sy=s.z/(s.z+s.w);return mix(mix(sample3,sample2,sx),mix(sample1,sample0,sx),sy);}
#endif
varying vec2 vCustomBumpUv;uniform sampler2D customBumpMap;uniform float customBumpScale;vec2 dHdxy_fwd_cb(){vec2 dSTdx=dFdx(vCustomBumpUv);vec2 dSTdy=dFdy(vCustomBumpUv);
#if CUSTOM_BUMP_MAP_BICUBIC > 0
float Hll=customBumpScale*textureBicubic_cb(customBumpMap,vCustomBumpUv).x;float dBx=customBumpScale*textureBicubic_cb(customBumpMap,vCustomBumpUv+dSTdx).x-Hll;float dBy=customBumpScale*textureBicubic_cb(customBumpMap,vCustomBumpUv+dSTdy).x-Hll;
#else
float Hll=customBumpScale*texture2D(customBumpMap,vCustomBumpUv).x;float dBx=customBumpScale*texture2D(customBumpMap,vCustomBumpUv+dSTdx).x-Hll;float dBy=customBumpScale*texture2D(customBumpMap,vCustomBumpUv+dSTdy).x-Hll;
#endif
return vec2(dBx,dBy);}
#ifndef USE_BUMPMAP
vec3 perturbNormalArb(vec3 surf_pos,vec3 surf_norm,vec2 dHdxy,float faceDirection){vec3 vSigmaX=dFdx(surf_pos.xyz);vec3 vSigmaY=dFdy(surf_pos.xyz);vec3 vN=surf_norm;vec3 R1=cross(vSigmaY,vN);vec3 R2=cross(vN,vSigmaX);float fDet=dot(vSigmaX,R1)*faceDirection;vec3 vGrad=sign(fDet)*(dHdxy.x*R1+dHdxy.y*R2);return normalize(abs(fDet)*surf_norm-vGrad);}
#endif
#endif
`,CustomBumpMapPlugin_decorate=function(h,o,c,d){var _,v=arguments.length,b=v<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(h,o,c,d);else for(var tt=h.length-1;tt>=0;tt--)(_=h[tt])&&(b=(v<3?_(b):v>3?_(o,c,b):_(o,c))||b);return v>3&&b&&Object.defineProperty(o,c,b),b};let CustomBumpMapPlugin=class extends AViewerPlugin{enableCustomBump(h,o,c){var d,_;const v=(d=h.materialObject)===null||d===void 0?void 0:d.userData;if(!v)return!1;if(v._hasCustomBump===void 0){const b=v.__appliedMeshes;let tt=!0;if(b)for(const{geometry:it}of b)!it||it.attributes.position&&it.attributes.normal&&it.attributes.uv||(tt=!1);if(!tt)return!1}return v._hasCustomBump=!0,v._customBumpScale=(_=c??v._customBumpScale)!==null&&_!==void 0?_:.001,v._customBumpMap=o??v._customBumpMap,h.materialObject.needsUpdate=!0,!0}_loaderCreate({loader:h}){h.isGLTFLoader2&&h.register(o=>new GLTFMaterialsCustomBumpMapExtensionImport(o))}constructor(){super(),this.enabled=!0,this.dependencies=[AssetManagerPlugin],this.bicubicFiltering=!0,this._defines={CUSTOM_BUMP_MAP_DEBUG:!1,CUSTOM_BUMP_MAP_BICUBIC:!0},this._uniforms={customBumpUvTransform:{value:new three_module.dwI},customBumpScale:{value:.001},customBumpMap:{value:null}},this.materialExtension={parsFragmentSnippet:(h,o)=>this.enabled&&o!=null&&o.materialObject.userData._hasCustomBump?customBumpMat:"",shaderExtender:(h,o,c)=>{var d;this.enabled&&o.materialObject.userData._hasCustomBump&&!((d=o.materialObject.userData)===null||d===void 0)&&d._customBumpMap&&(h.fragmentShader=shaderReplaceString(h.fragmentShader,"#glMarker beforeAccumulation",`
#if defined(CUSTOM_BUMP_MAP_ENABLED) && CUSTOM_BUMP_MAP_ENABLED > 0
    normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd_cb(), faceDirection );
#endif
                `,{prepend:!0}),h.vertexShader=shaderReplaceString(h.vertexShader,"#include <uv_pars_vertex>",`
#if defined(CUSTOM_BUMP_MAP_ENABLED) && CUSTOM_BUMP_MAP_ENABLED > 0
                varying vec2 vCustomBumpUv;
                uniform mat3 customBumpUvTransform;
#endif
                `,{prepend:!0}),h.vertexShader=shaderReplaceString(h.vertexShader,"#include <uv_vertex>",`
#if defined(CUSTOM_BUMP_MAP_ENABLED) && CUSTOM_BUMP_MAP_ENABLED > 0
                vCustomBumpUv = ( customBumpUvTransform * vec3( uv, 1 ) ).xy;
#endif
                `,{prepend:!0}),h.defines.USE_UV="")},onObjectRender:(h,o)=>{var c;const d=o.materialObject.userData;if(!(d!=null&&d._hasCustomBump))return;const _=h;if(!_.isMesh||!_.geometry)return;const v=!((c=d._customBumpMap)===null||c===void 0)&&c.isTexture?d._customBumpMap:null;this._uniforms.customBumpMap.value=v,this._uniforms.customBumpScale.value=v?d._customBumpScale:0,v&&(v.updateMatrix(),this._uniforms.customBumpUvTransform.value.copy(v.matrix));let b=this.enabled&&v?1:0;o.materialObject.defines.CUSTOM_BUMP_MAP_ENABLED!==b&&(o.materialObject.defines.CUSTOM_BUMP_MAP_ENABLED=b,o.materialObject.needsUpdate=!0),b=+this._defines.CUSTOM_BUMP_MAP_DEBUG,o.materialObject.defines.CUSTOM_BUMP_MAP_DEBUG!==b&&(o.materialObject.defines.CUSTOM_BUMP_MAP_DEBUG=b,o.materialObject.needsUpdate=!0),b=+this._defines.CUSTOM_BUMP_MAP_BICUBIC,o.materialObject.defines.CUSTOM_BUMP_MAP_BICUBIC!==b&&(o.materialObject.defines.CUSTOM_BUMP_MAP_BICUBIC=b,o.materialObject.needsUpdate=!0)},extraUniforms:{...this._uniforms},computeCacheKey:h=>{var o,c,d;return(this.enabled?"1":"0")+(!((o=h.materialObject.userData)===null||o===void 0)&&o._hasCustomBump?"1":"0")+((d=(c=h.materialObject.userData)===null||c===void 0?void 0:c._customBumpMap)===null||d===void 0?void 0:d.uuid)},isCompatible:h=>h.isMeshStandardMaterial2,updaters:()=>[],getUiConfig:h=>{const o=this._viewer,c=this.enableCustomBump,d={type:"folder",label:"CustomBumpMap",children:[{type:"checkbox",label:"Enabled",get value(){return h.materialObject.userData._hasCustomBump||!1},set value(_){var v;_!==h.materialObject.userData._hasCustomBump&&(_?c(h)||o.alert("One or more geometries cannot be made anisotropic."):(h.materialObject.userData._hasCustomBump=!1,h.materialObject.needsUpdate=!0),(v=d.uiRefresh)===null||v===void 0||v.call(d,"postFrame",!0))},onChange:this.setDirty},{type:"slider",label:"Bump Scale",bounds:[-1,1],hidden:()=>!h.materialObject.userData._hasCustomBump,property:[h.materialObject.userData,"_customBumpScale"],onChange:this.setDirty},{type:"image",label:"Bump Map",hidden:()=>!h.materialObject.userData._hasCustomBump,property:[h.materialObject.userData,"_customBumpMap"],onChange:()=>{h.materialObject.needsUpdate=!0,this.setDirty()}},makeSamplerUi(h.materialObject.userData,"_customBumpMap")]};return d}},this.setDirty=()=>{var h,o,c;(o=(h=this.materialExtension).setDirty)===null||o===void 0||o.call(h),(c=this._viewer)===null||c===void 0||c.setDirty()},this.enableCustomBumpSelected=()=>{var h,o,c;const d=(c=(o=(h=this._viewer)===null||h===void 0?void 0:h.getPlugin(PickingPlugin))===null||o===void 0?void 0:o.getSelectedObject())===null||c===void 0?void 0:c.material;return(d==null?void 0:d.assetType)==="material"&&this.enableCustomBump(d)},this._loaderCreate=this._loaderCreate.bind(this)}async onAdded(h){var o,c,d,_,v;await super.onAdded(h);const b=h.getPlugin(AssetManagerPlugin);(o=b==null?void 0:b.materials)===null||o===void 0||o.registerMaterialExtension(this.materialExtension),(c=b==null?void 0:b.importer)===null||c===void 0||c.addEventListener("loaderCreate",this._loaderCreate),(v=(_=(d=b==null?void 0:b.exporter)===null||d===void 0?void 0:d.getExporter("gltf","glb"))===null||_===void 0?void 0:_.extensions)===null||v===void 0||v.push(glTFMaterialsCustomBumpMapExtensionExport)}async onRemove(h){var o,c,d,_,v,b,tt,it,nt,lt,ut,ht;(c=(o=h.getPlugin(AssetManagerPlugin))===null||o===void 0?void 0:o.materials)===null||c===void 0||c.unregisterMaterialExtension(this.materialExtension),(_=(d=h.getPlugin(AssetManagerPlugin))===null||d===void 0?void 0:d.importer)===null||_===void 0||_.removeEventListener("loaderCreate",this._loaderCreate);const _t=(it=(tt=(b=(v=h.getPlugin(AssetManagerPlugin))===null||v===void 0?void 0:v.exporter)===null||b===void 0?void 0:b.getExporter("gltf","glb"))===null||tt===void 0?void 0:tt.extensions)===null||it===void 0?void 0:it.indexOf(glTFMaterialsCustomBumpMapExtensionExport);return _t!==void 0&&_t!==-1&&((ht=(ut=(lt=(nt=h.getPlugin(AssetManagerPlugin))===null||nt===void 0?void 0:nt.exporter)===null||lt===void 0?void 0:lt.getExporter("gltf","glb"))===null||ut===void 0?void 0:ut.extensions)===null||ht===void 0||ht.splice(_t,1)),super.onRemove(h)}};CustomBumpMapPlugin.PluginType="CustomBumpMapPlugin",CustomBumpMapPlugin.CUSTOM_BUMP_MAP_GLTF_EXTENSION="WEBGI_materials_custom_bump_map",CustomBumpMapPlugin_decorate([uiToggle("Enabled",h=>({onChange:h.setDirty})),serialize()],CustomBumpMapPlugin.prototype,"enabled",void 0),CustomBumpMapPlugin_decorate([uiToggle("Bicubic",h=>({onChange:h.setDirty})),matDefine("CUSTOM_BUMP_MAP_BICUBIC",void 0,!0,CustomBumpMapPlugin.prototype.setDirty),serialize()],CustomBumpMapPlugin.prototype,"bicubicFiltering",void 0),CustomBumpMapPlugin_decorate([uiButton("Enable CustomBumpMap",h=>({hidden:()=>{var o;return!(!((o=h._viewer)===null||o===void 0)&&o.getPlugin(PickingPlugin))}}))],CustomBumpMapPlugin.prototype,"enableCustomBumpSelected",void 0),CustomBumpMapPlugin=CustomBumpMapPlugin_decorate([uiFolder("CustomBumpMap Materials")],CustomBumpMapPlugin);class GLTFMaterialsCustomBumpMapExtensionImport{constructor(o){this.parser=o,this.name=CustomBumpMapPlugin.CUSTOM_BUMP_MAP_GLTF_EXTENSION}async extendMaterialParams(o,c){var d;const _=this.parser,v=_.json.materials[o];if(!v.extensions||!v.extensions[this.name])return Promise.resolve();const b=[],tt=v.extensions[this.name];c.userData||(c.userData={}),c.userData._hasCustomBump=!0,c.userData._customBumpScale=(d=tt.customBumpScale)!==null&&d!==void 0?d:0;const it=tt.customBumpMap;return it&&b.push(_.assignTexture(c.userData,"_customBumpMap",it).then(nt=>{nt.colorSpace=three_module.er$})),Promise.all(b)}}const glTFMaterialsCustomBumpMapExtensionExport=h=>({writeMaterial:(o,c)=>{if(!o.isMeshStandardMaterial||!o.userData._hasCustomBump||(o.userData._customBumpScale||0)<.001)return;c.extensions=c.extensions||{};const d={};if(d.customBumpScale=o.userData._customBumpScale||1,h.checkEmptyMap(o.userData._customBumpMap)){const _={index:h.processTexture(o.userData._customBumpMap)};h.applyTextureTransform(_,o.userData._customBumpMap),d.customBumpMap=_}c.extensions[CustomBumpMapPlugin.CUSTOM_BUMP_MAP_GLTF_EXTENSION]=d,h.extensionsUsed[CustomBumpMapPlugin.CUSTOM_BUMP_MAP_GLTF_EXTENSION]=!0}});var GLTFAnimationPlugin_decorate=function(h,o,c,d){var _,v=arguments.length,b=v<3?o:d===null?d=Object.getOwnPropertyDescriptor(o,c):d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(h,o,c,d);else for(var tt=h.length-1;tt>=0;tt--)(_=h[tt])&&(b=(v<3?_(b):v>3?_(o,c,b):_(o,c))||b);return v>3&&b&&Object.defineProperty(o,c,b),b},GLTFAnimationPlugin_1;let GLTFAnimationPlugin=GLTFAnimationPlugin_1=class extends AViewerPlugin{get animationState(){return this._animationState}get animationTime(){return this._animationTime}get animationDuration(){return this._animationDuration}setTime(h){this._animationTime=Math.max(0,Math.min(h,this._animationDuration))}_wheel({deltaY:h}){this.enabled&&Math.abs(h)>.001&&(this._scrollAnimationState=-1*Math.sign(h))}_drag(h){this.enabled&&this._viewer&&(this.dragAxis==="x"?this._dragAnimationState=h.delta.x*this._viewer.canvas.width/4:this._dragAnimationState=h.delta.y*this._viewer.canvas.height/4)}_postFrame(){var h,o;if(!this._viewer)return;const c=this._viewer,d=this.animateOnScroll,_=this.animateOnDrag;if(!this.enabled||this.animations.length<1||this._animationState!=="playing"&&!d&&!_)return this._lastFrameTime=0,void(this._fadeDisabled&&((h=this._viewer.getPluginByType("FrameFade"))===null||h===void 0||h.enable(GLTFAnimationPlugin_1.PluginType),this._fadeDisabled=!1));if(this._animationTime<1e-4&&this.dispatchEvent({type:"checkpointBegin"}),this.autoIncrementTime){const tt=g()/1e3;this._lastFrameTime<1&&(this._lastFrameTime=tt-1/30);let it=tt-this._lastFrameTime;if(it*=this.animationSpeed,this._lastFrameTime=tt,d&&_?it*=et(this._scrollAnimationState,this._dragAnimationState):d?it*=this._scrollAnimationState:_&&(it*=this._dragAnimationState),Math.abs(it)<1e-4)return;const nt=(o=this._viewer.getPluginByType("Progressive"))===null||o===void 0?void 0:o.postFrameConvergedRecordingDelta();if(nt&&nt>0&&(it=nt),nt===0)return;const lt=Math.abs(this.timeScale);this._animationTime+=it*(lt>0?lt:1)}const v=this._animationTime-this._lastAnimationTime;this._lastAnimationTime=this._animationTime;const b=this.timeScale<0?(isFinite(this._animationDuration)?this._animationDuration:0)-this._animationTime:this._animationTime;if(this.animations.map(tt=>{tt.mixer.setTime(b)}),!(Math.abs(v)<1e-5)){if(Math.abs(this._scrollAnimationState)<.001?this._scrollAnimationState=0:this._scrollAnimationState*=1-this.scrollAnimationDamping,Math.abs(this._dragAnimationState)<.001?this._dragAnimationState=0:this._dragAnimationState*=1-this.dragAnimationDamping,this.dispatchEvent({type:"animationStep",delta:v,time:b}),c.scene.activeCamera.cameraObject.userData.__animatingCamera&&c.scene.activeCamera.setDirty(),c.scene.refreshActiveCameraNearFar(),c.renderer.resetShadows(),c.setDirty(),!this._fadeDisabled){const tt=this._viewer.getPluginByType("FrameFade");tt&&(tt.disable(GLTFAnimationPlugin_1.PluginType),this._fadeDisabled=!0)}this._animationTime>=this._animationDuration&&this.dispatchEvent({type:"checkpointEnd"})}}constructor(){super(),this.enabled=!0,this._lastAnimationTime=0,this.autoIncrementTime=!0,this.animations=[],this.loopAnimations=!0,this.loopRepetitions=1/0,this.timeScale=1,this.animationSpeed=1,this.animateOnScroll=!1,this._scrollAnimationState=0,this.scrollAnimationDamping=.1,this.animateOnDrag=!1,this.dragAxis="y",this.autoplayOnLoad=!1,this.syncMaxDuration=!1,this._dragAnimationState=0,this.dragAnimationDamping=.3,this.dependencies=[AssetManagerPlugin],this._pointerDragHelper=new Z$1,this._lastFrameTime=0,this._fadeDisabled=!1,this._objectAdded=h=>{var o;const c=h.object;if(c.assetType!=="model"||!c.modelObject||!this._viewer)return;let d=!1;const _=(o=h.options)===null||o===void 0?void 0:o.addToRoot;c.modelObject.traverse(v=>{var b;const tt=v.animations;if(tt.length<1)return;const it=Math.max(...tt.map(ut=>ut.duration));((b=c.modelObject.userData.gltfAnim_SyncMaxDuration)!==null&&b!==void 0?b:this.syncMaxDuration)&&(tt.forEach(ut=>ut.duration=it),c.modelObject.userData.gltfAnim_SyncMaxDuration=!0);const nt=new three_module.Iw4(_?this._viewer.scene.modelObject:this._viewer.scene.modelRoot.modelObject),lt=tt.map(ut=>nt.clipAction(ut).setLoop(this.loopAnimations?three_module.aMy:three_module.G3T,this.loopRepetitions));lt.forEach(ut=>ut.clampWhenFinished=!0),this.animations.push({mixer:nt,clips:tt,actions:lt,duration:it}),d=!0}),d&&(this._onPropertyChange(!this.autoplayOnLoad),this.autoplayOnLoad&&this.playAnimation())},this._animationTime=0,this._animationDuration=0,this._animationState="none",this.uiConfig=void 0,this._lastAnimId="",this.timelineMarkers=[],this._postFrame=this._postFrame.bind(this),this._wheel=this._wheel.bind(this),this.playClips=this.playClips.bind(this),this.playClip=this.playClip.bind(this),this.playAnimation=this.playAnimation.bind(this),this.playPauseAnimation=this.playPauseAnimation.bind(this),this.pauseAnimation=this.pauseAnimation.bind(this),this.stopAnimation=this.stopAnimation.bind(this),this.resetAnimation=this.resetAnimation.bind(this),this._onPropertyChange=this._onPropertyChange.bind(this),this._loaderCreate=this._loaderCreate.bind(this),this._pointerDragHelper.addEventListener("drag",this._drag.bind(this))}_loaderCreate({loader:h}){h.isGLTFLoader2&&h.register(o=>new GLTFTimelineMarkersExtensionImport(o,this))}async onAdded(h){var o,c,d,_,v,b;(c=(o=h.getPlugin(AssetManagerPlugin))===null||o===void 0?void 0:o.importer)===null||c===void 0||c.addEventListener("loaderCreate",this._loaderCreate),h.scene.addEventListener("addSceneObject",this._objectAdded),(b=(v=(_=(d=h.getPlugin(AssetManagerPlugin))===null||d===void 0?void 0:d.exporter)===null||_===void 0?void 0:_.getExporter("gltf","glb"))===null||v===void 0?void 0:v.extensions)===null||b===void 0||b.push(glTFTimelineMarkersExtensionExport),h.addEventListener("postFrame",this._postFrame),window.addEventListener("wheel",this._wheel),this._pointerDragHelper.element=h.canvas;let tt=-1;return Object.defineProperty(h.scene.modelRoot,"currentTimelineMarker",{get:()=>tt,set:it=>h.scene.modelRoot.dispatchEvent({type:"animationTimelineMarker",marker:this.timelineMarkers[tt=it]})}),h.scene.modelRoot.addEventListener("animationTimelineMarker",({marker:it})=>{var nt;if(!this._viewer)return;if(!it)return this._viewer.scene.activeCamera=(nt=this._viewer)===null||nt===void 0?void 0:nt.scene.defaultCamera,void this._viewer.setDirty();const lt=it.camera;lt&&(lt.userData.__animatingCamera=!0,this._viewer.scene.activeCamera=this._viewer.createCamera(lt))}),super.onAdded(h)}async onRemove(h){for(var o,c;this.animations.length;)this.animations.pop();return h.scene.removeEventListener("addSceneObject",this._objectAdded),(c=(o=h.getPlugin(AssetManagerPlugin))===null||o===void 0?void 0:o.importer)===null||c===void 0||c.addEventListener("loaderCreate",this._loaderCreate),h.removeEventListener("postFrame",this._postFrame),window.removeEventListener("wheel",this._wheel),this._pointerDragHelper.element=void 0,super.onRemove(h)}_onPropertyChange(h=!0){this._animationDuration=Math.max(...this.animations.map(({duration:o})=>o))*(this.loopAnimations?this.loopRepetitions:1),this._animationState==="playing"&&h&&this.playAnimation()}onStateChange(){var h,o;(o=(h=this.uiConfig)===null||h===void 0?void 0:h.children)===null||o===void 0||o.map(c=>c&&Ee$1(c)).flat(2).forEach(c=>{var d;return(d=c==null?void 0:c.uiRefresh)===null||d===void 0?void 0:d.call(c)})}playPauseAnimation(){this._animationState==="playing"?this.pauseAnimation():this.playAnimation()}async playClip(h,o=!1){return this.playClips([h],o)}async playClips(h,o=!1){const c=[];return this.animations.forEach(({actions:d})=>{d.forEach(_=>{h.includes(_.getClip().name)&&c.push(_)})}),this.playAnimation(o,c)}async playAnimation(h=!1,o){var c;if(!this.enabled)return;let d=!1;this._animationState==="playing"&&(this.stopAnimation(!1),d=!0);let _=0;const v=!o;o||(o=[],this.animations.forEach(({mixer:tt,actions:it,clips:nt})=>{o.push(...it)})),d?this.resetAnimation():this.animationState!=="paused"&&(o.forEach(tt=>{tt.reset()}),this._animationTime=0);const b=esm_browser_v4();this._lastAnimId=b;for(const tt of o)tt.setLoop(this.loopAnimations?three_module.aMy:three_module.G3T,this.loopRepetitions),tt.play(),_=Math.max(_,tt.getClip().duration/Math.abs(tt.timeScale));if(this._animationState="playing",(c=this._viewer)===null||c===void 0||c.setDirty(),v){if(!isFinite(this._animationDuration))return;await new Promise((tt,it)=>{const nt=()=>{this.removeEventListener("checkpointEnd",nt),tt()};this.addEventListener("checkpointEnd",nt)})}else{const tt=this.loopAnimations?this.loopRepetitions:1;if(_*=tt,!isFinite(_))return;await new Promise((it,nt)=>{const lt=ut=>{ut.time>=_&&(this.removeEventListener("animationStep",lt),it())};this.addEventListener("animationStep",lt)})}b===this._lastAnimId&&this.stopAnimation(h)}pauseAnimation(){var h;this._animationState==="playing"?(this._animationState="paused",(h=this._viewer)===null||h===void 0||h.setDirty()):console.warn("pauseAnimation called when animation was not playing.")}resumeAnimation(){var h;this._animationState==="paused"?(this._animationState="playing",(h=this._viewer)===null||h===void 0||h.setDirty()):console.warn("resumeAnimation called when animation was not paused.")}stopAnimation(h=!1){var o,c;this._animationState="stopped",h?this.resetAnimation():(o=this._viewer)===null||o===void 0||o.setDirty(),this._lastAnimId="",this._viewer&&this._fadeDisabled&&((c=this._viewer.getPluginByType("FrameFade"))===null||c===void 0||c.enable(GLTFAnimationPlugin_1.PluginType),this._fadeDisabled=!1)}resetAnimation(){var h;this._animationState==="stopped"||this._animationState==="none"?(this.animations.forEach(({mixer:o,actions:c,clips:d})=>{o.stopAllAction(),o.setTime(0)}),this._animationTime=0,(h=this._viewer)===null||h===void 0||h.setDirty()):this.stopAnimation(!0)}};GLTFAnimationPlugin.PluginType="GLTFAnimation",GLTFAnimationPlugin.AnimationMarkersExtension="WEBGI_animation_markers",GLTFAnimationPlugin_decorate([serialize()],GLTFAnimationPlugin.prototype,"autoIncrementTime",void 0),GLTFAnimationPlugin_decorate([uiMonitor()],GLTFAnimationPlugin.prototype,"animationState",null),GLTFAnimationPlugin_decorate([uiMonitor()],GLTFAnimationPlugin.prototype,"animationTime",null),GLTFAnimationPlugin_decorate([uiMonitor()],GLTFAnimationPlugin.prototype,"animationDuration",null),GLTFAnimationPlugin_decorate([ze$1(GLTFAnimationPlugin.prototype._onPropertyChange),uiToggle("Loop",{limitedUi:!0}),serialize()],GLTFAnimationPlugin.prototype,"loopAnimations",void 0),GLTFAnimationPlugin_decorate([ze$1(GLTFAnimationPlugin.prototype._onPropertyChange),serialize()],GLTFAnimationPlugin.prototype,"loopRepetitions",void 0),GLTFAnimationPlugin_decorate([uiSlider("Timescale",[-2,2],.01),serialize()],GLTFAnimationPlugin.prototype,"timeScale",void 0),GLTFAnimationPlugin_decorate([uiSlider("Speed",[.1,4],.1,{limitedUi:!0}),serialize()],GLTFAnimationPlugin.prototype,"animationSpeed",void 0),GLTFAnimationPlugin_decorate([uiToggle(),serialize()],GLTFAnimationPlugin.prototype,"animateOnScroll",void 0),GLTFAnimationPlugin_decorate([uiToggle(),serialize()],GLTFAnimationPlugin.prototype,"animateOnDrag",void 0),GLTFAnimationPlugin_decorate([uiDropdown("Drag Axis",[{label:"x"},{label:"y"}]),serialize()],GLTFAnimationPlugin.prototype,"dragAxis",void 0),GLTFAnimationPlugin_decorate([uiToggle(),serialize()],GLTFAnimationPlugin.prototype,"autoplayOnLoad",void 0),GLTFAnimationPlugin_decorate([uiToggle("syncMaxDuration(dev)"),serialize()],GLTFAnimationPlugin.prototype,"syncMaxDuration",void 0),GLTFAnimationPlugin_decorate([x$1(GLTFAnimationPlugin.prototype.onStateChange)],GLTFAnimationPlugin.prototype,"_animationState",void 0),GLTFAnimationPlugin_decorate([uiButton("Play/Pause",h=>({label:()=>h.animationState==="playing"?"Pause":"Play",limitedUi:!0}))],GLTFAnimationPlugin.prototype,"playPauseAnimation",null),GLTFAnimationPlugin_decorate([uiButton("Stop",{limitedUi:!0})],GLTFAnimationPlugin.prototype,"stopAnimation",null),GLTFAnimationPlugin_decorate([uiButton("Reset",{limitedUi:!0})],GLTFAnimationPlugin.prototype,"resetAnimation",null),GLTFAnimationPlugin=GLTFAnimationPlugin_1=GLTFAnimationPlugin_decorate([uiFolder("GLTF Animations")],GLTFAnimationPlugin);class GLTFTimelineMarkersExtensionImport{constructor(o,c){this.parser=o,this.name=GLTFAnimationPlugin.AnimationMarkersExtension,this.plugin=c}async afterRoot(o){var c;let d=[];for(const ht of this.parser.json.scenes||[]){if(!ht.extensions)continue;const _t=ht.extensions[this.name];for(const ft of(_t==null?void 0:_t.markers)||[]){const bt=ft.camera!==void 0?await this.parser.getDependency("camera",ft.camera):void 0;ft.time===void 0&&(ft.time=ft.frame/30,console.error("Update timeline markers plugin for correct times.")),d.push({name:ft.name,frame:ft.frame,time:ft.time,camera:bt})}}if(d.length<1)return;d=d.sort((ht,_t)=>ht.frame-_t.frame);const _=(c=o.scene)!==null&&c!==void 0?c:o.scenes[0];if(!_)return;_.userData.__markers=d;const v=this.plugin.timelineMarkers,b=d.map(ht=>ht.time);let tt=v.length;const it=d.map(ht=>tt++),nt=Math.max(...b)+.01;v.push(...d);const lt=new three_module.Hit(".currentTimelineMarker",b,it,three_module.ljd),ut=new three_module.tz3("animationTimelineMarker",nt,[lt]);ut.__gltfExport=!1,o.animations.push(ut)}}const glTFTimelineMarkersExtensionExport=h=>({afterParse(o){const c=h.json.scenes[h.json.scene||0];c.extensions=c.extensions||{};const d={markers:[]},_=[];if((Array.isArray(o)?o:[o]).forEach(v=>v.traverse(b=>{b.userData.__markers&&_.push(...b.userData.__markers)})),_.sort((v,b)=>v.frame-b.frame),!(_.length<1)){for(const v of _){const b=v.camera;if(b){const tt=h.nodeMap.get(b);if(tt===void 0){console.warn("Camera not found in gltf export",b,h.nodeMap);continue}const it=h.json.nodes[tt].camera;v.camera=it,d.markers.push(v)}}c.extensions[GLTFAnimationPlugin.AnimationMarkersExtension]=d,h.extensionsUsed[GLTFAnimationPlugin.AnimationMarkersExtension]=!0}}});var giPatch=`#if defined(SSRTAO_ENABLED) && SSRTAO_ENABLED > 0
vec4 ssgi=tSSGIMapTexelToLinear(texture2D(tSSGIMap,viewToScreen(vViewPosition.xyz).xy));float ambientOcclusion=1.-ssgi.a;ambientOcclusion=max(0.,ambientOcclusion);ambientOcclusion=pow(ambientOcclusion,ssaoPower);ambientOcclusion=min(1.,ambientOcclusion);reflectedLight.indirectDiffuse*=ambientOcclusion;
#if defined(SSGI_ENABLED) && SSGI_ENABLED > 0
vec3 ssgiColor=ssgi.rgb*ssgiIntensity;reflectedLight.indirectDiffuse+=ssgiColor*(material.diffuseColor.rgb);
#endif
#if defined( USE_ENVMAP )
float dotNV=saturate(dot(geometryNormal,geometryViewDir));float specularOcclusion=saturate(pow(dotNV+ambientOcclusion,exp2(-16.*material.roughness-1.))-1.+ambientOcclusion);reflectedLight.indirectSpecular*=specularOcclusion;
#if defined(SSGI_ENABLED) && SSGI_ENABLED > 0
#if !defined(SSR_ENABLED) || SSR_ENABLED < 1
reflectedLight.indirectSpecular+=ssgiColor*material.specularColor;
#endif
#endif
#endif
#endif
`,cameraHelpers=`#ifndef BASIC_CAMERA_HELPERS
#define BASIC_CAMERA_HELPERS 
uniform vec2 cameraNearFar;uniform vec3 cameraPositionWorld;uniform mat4 projection;
#ifndef THREE_PACKING_INCLUDED
#define THREE_PACKING_INCLUDED 
#include <packing>
#endif
float linstep(float edge0,float edge1,float value){return clamp((value-edge0)/(edge1-edge0),0.,1.);}float depthToViewZ(const in float depth){return(depth>0.999)?-cameraNearFar.y*1000.:-mix(cameraNearFar.x,cameraNearFar.y,depth);}float viewZToDepth(const in float viewZ){return linstep(-cameraNearFar.x,-cameraNearFar.y,viewZ);}vec4 viewToScreen3(const in vec3 pos){vec4 projected=projection*vec4(pos,1.);projected.z=pos.z;projected.w=1./projected.w;projected.xyz*=projected.w;projected.xy=0.5+0.5*projected.xy;return projected;}vec3 screenToView(const in vec2 uv,const in float viewZ){vec2 uv_=2.*uv-1.;float xe=-(uv_.x+projection[2][0])*viewZ/projection[0][0];float ye=-(uv_.y+projection[2][1])*viewZ/projection[1][1];return vec3(xe,ye,viewZ);}
#endif
`,samplePointHelpers=`#define PI  3.141592653589793
mat3 GetTangentBasis(vec3 TangentZ){vec3 up=vec3(0.,0.,1.);vec3 TangentX=normalize(cross(dot(TangentZ,up)<0.8?up:vec3(1.,0.,0.),TangentZ));vec3 TangentY=cross(TangentZ,TangentX);return mat3(TangentX,TangentY,TangentZ);}vec4 CosineSampleHemisphere(vec2 E){float Phi=2.*PI*E.x;float CosTheta=sqrt(E.y);float SinTheta=sqrt(1.-CosTheta*CosTheta);vec3 H;H.x=SinTheta*cos(Phi);H.y=SinTheta*sin(Phi);H.z=CosTheta;float PDF=CosTheta*(1./PI);return vec4(H,PDF);}vec4 UniformSampleHemisphere(vec2 E){float Phi=2.*PI*E.x;float CosTheta=E.y;float SinTheta=sqrt(1.-CosTheta*CosTheta);vec3 H;H.x=SinTheta*cos(Phi);H.y=SinTheta*sin(Phi);H.z=CosTheta;float PDF=1./(2.*PI);return vec4(H,PDF);}vec2 UniformSampleDiskConcentric(vec2 E){vec2 p=2.*E-1.;float Radius;float Phi;if(abs(p.x)>abs(p.y)){Radius=p.x;Phi=(PI/4.)*(p.y/p.x);}else{Radius=p.y;Phi=(PI/2.)-(PI/4.)*(p.x/p.y);}return vec2(Radius*cos(Phi),Radius*sin(Phi));}vec2 UniformSampleDiskConcentricApprox(vec2 E){vec2 sf=E*sqrt(2.)-sqrt(0.5);vec2 sq=sf*sf;float root=sqrt(2.*max(sq.x,sq.y)-min(sq.x,sq.y));if(sq.x>sq.y){sf.x=sf.x>0.?root:-root;}else{sf.y=sf.y>0.?root:-root;}return sf;}`,ssrt=`#ifndef SSRT_PARS_SNIP
#define SSRT_PARS_SNIP 
#define pow2(a)a*a
float getDepth2(const in vec2 uv,const in float lod){float viewDepth=getDepth(uv);return depthToViewZ(viewDepth);}
#define LOD_DEPTH  1.0
#define LOD_COLOR  5.0
void _traceRay(in vec4 ray_origin,in vec4 ray_dir,in float tolerance,inout vec3 state,in int loopMax,in float iStepCount){vec4 sample_uv;float d,hit;float dLod=0.;
#pragma unroll_loop_start
for(int i=0;i<8;i++){if(UNROLLED_LOOP_INDEX<loopMax){sample_uv=ray_origin+ray_dir*state.y;d=getDepth2(sample_uv.xy,dLod);d=sample_uv.z/sample_uv.w-d;if(abs(d+tolerance)<tolerance){hit=clamp(state.x/(state.x-d),0.,1.)-1.;hit=(state.y+hit*iStepCount);state.z=min(state.z,hit);}state.x=d;state.y+=1.*iStepCount;}}
#pragma unroll_loop_end
}vec3 traceRay(in vec3 ray_origin_view,in vec3 ray_dir_view,in float tolerance,inout vec3 state,in int _STEP_COUNT){vec4 sample_uv;vec4 ray_origin=viewToScreen3(ray_origin_view);vec3 ray_end_view=ray_origin_view+ray_dir_view;vec4 ray_dir=viewToScreen3(ray_end_view);vec2 clamp_end=clamp(ray_dir.xy,vec2(0.),vec2(1.));vec2 correction=abs(ray_dir.xy-clamp_end);correction=(step(0.01,correction)*correction/(abs(clamp_end-ray_origin.xy)+0.01))+1.;correction.x=1./min(max(correction.y,correction.x),10.);ray_dir=ray_dir-ray_origin;ray_dir.xyw*=correction.x;float iStepCount=1./float(_STEP_COUNT);tolerance*=0.125;_traceRay(ray_origin,ray_dir,tolerance,state,_STEP_COUNT,iStepCount);if(_STEP_COUNT>8&&state.z>0.98)_traceRay(ray_origin,ray_dir,tolerance,state,_STEP_COUNT-8,iStepCount);if(_STEP_COUNT>15&&state.z>0.98)_traceRay(ray_origin,ray_dir,tolerance,state,_STEP_COUNT-16,iStepCount);if(_STEP_COUNT>23&&state.z>0.98)_traceRay(ray_origin,ray_dir,tolerance,state,_STEP_COUNT-16,iStepCount);sample_uv=ray_origin+ray_dir*state.z;sample_uv.z/=sample_uv.w;state.z=state.z<0.999?state.z:9999999.;return sample_uv.xyz;}
#endif
`,basicHelpers=`#ifndef BASIC_HELPERS
#define BASIC_HELPERS 
float saturate2(float v,float mx){return max(0.,min(mx,v));}vec3 saturate2(vec3 v){return max(vec3(0.),min(vec3(1.),v));}
#endif
`,ssrtao=`varying vec2 vUv;uniform float frameCount2;uniform float intensity;uniform float objectRadius;uniform float rayCount;uniform float power;uniform float bias;uniform float falloff;uniform float tolerance;uniform bool autoRadius;uniform vec2 screenSize;vec3 ComputeUniformL(vec3 N,vec2 E){vec3 L;L.xy=E;L.z=interleavedGradientNoise(gl_FragCoord.xy,frameCount2*5.);L=L*2.-1.;return L;}vec2 GetRandomE(float seed){vec2 rand_e;rand_e.x=random3(vec3(gl_FragCoord.xy,frameCount2+seed));rand_e.y=random3(vec3(gl_FragCoord.yx,rand_e.x+(frameCount2)*7.));return rand_e;}vec4 calculateGI(in float seed,in vec3 screenPos,in vec3 normal,in float radiusFactor){vec3 viewPos=screenToView(screenPos.xy,screenPos.z);normal=normalize(normal);vec2 E=GetRandomE(seed);vec3 L=ComputeUniformL(normal,E);L=normalize(L);L*=sign(dot(L,normal));float cameraDist=length(cameraPositionWorld);float rayLen=autoRadius?length(viewPos-screenToView(screenPos.xy+objectRadius/10.,screenPos.z)):mix((cameraNearFar.y)+viewPos.z,-viewPos.z-cameraNearFar.x,L.z*0.5+0.5)*objectRadius;rayLen*=radiusFactor;float r=interleavedGradientNoise(gl_FragCoord.xy,frameCount2*14.+seed)+0.05;rayLen=max(rayLen,0.001);vec3 state=vec3(1.,(r+0.5)/float(RTAO_STEP_COUNT),2.);viewPos+=normal*max(-0.01*viewPos.z,0.001);vec3 screenHitP=traceRay(viewPos,L*rayLen,tolerance*rayLen,state,RTAO_STEP_COUNT);vec3 viewHitP=screenToView(screenHitP.xy,screenHitP.z);vec3 LRes=viewHitP-viewPos;if(state.z>1.)LRes=vec3(9999999.);float dist=length(LRes)*falloff;float EPS=0.01;float zBias=(viewPos.z)*bias;float ao=(max(dot(normal,L)+zBias,0.))/(dist*dist+EPS);
#if defined(SSGI_ENABLED) && SSGI_ENABLED > 0
vec3 hitColor=tLastFrameTexelToLinear(texture2D(tLastFrame,screenHitP.xy)).rgb;vec3 hitNormal=getViewNormal(screenHitP.xy);float giWeight=1.;giWeight=saturate2(giWeight/(dist+EPS),1.);giWeight*=saturate2((dot(normal,L)),1.);giWeight*=saturate2((dot(hitNormal,-L)),1.);return vec4(hitColor*giWeight,ao);
#endif
return vec4(0,0,0,ao);}float normpdf(in float x,in float sigma){return exp(-0.5*x*x/(sigma*sigma));}vec4 getLastThis(sampler2D tex,float depth,vec3 normal){vec2 direction=vec2(1,1);vec4 color=clamp(tLastThisTexelToLinear(texture2D(tex,vUv.xy)),0.,5.);return color;}void main(){float depth;vec3 normal;getDepthNormal(vUv,depth,normal);if(depth>0.99){discard;gl_FragColor=getLastThis(tLastThis,depth,normal);return;}float viewZ=depthToViewZ(depth);vec3 screenPos=vec3(vUv.x,vUv.y,viewZ);vec4 gi=vec4(0.);gi+=calculateGI(8.,screenPos,normal,1.);if(rayCount>1.5)gi=max(gi,calculateGI(2.,screenPos,normal,0.4));if(rayCount>2.5)gi=max(gi,calculateGI(3.,screenPos,normal,1.5));if(rayCount>3.5)gi=max(gi,calculateGI(1.,screenPos,normal,0.6));if(rayCount>4.5)gi=max(gi,calculateGI(3.,screenPos,normal,1.));gi.a=min(1.,gi.a);gi.a=max(0.,gi.a);gi.rgb=min(vec3(3.),gi.rgb);gi.rgb=max(vec3(0.),gi.rgb);if(frameCount2<3.){gl_FragColor=gi;return;}gl_FragColor=(texture2D(tLastThis,vUv));gl_FragColor=((gi+(gl_FragColor)*frameCount2)/(frameCount2+1.));}`,SSRTAOPass_decorate=function(h,o,c,d){var _,v=arguments.length,b=v<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(h,o,c,d);else for(var tt=h.length-1;tt>=0;tt--)(_=h[tt])&&(b=(v<3?_(b):v>3?_(o,c,b):_(o,c))||b);return v>3&&b&&Object.defineProperty(o,c,b),b};class SSRTAOPass extends ShaderPass2{get ssgiEnabled(){return parseInt(this.material.defines.SSGI_ENABLED)>.5}set ssgiEnabled(o){o=o&&this._giActivated,this.material.defines.SSGI_ENABLED=o?1:0,this.material.needsUpdate=!0}constructor(o,c,d,_=!1){super({vertexShader:defaultVertex,fragmentShader:`

${basicHelpers}
${cameraHelpers}
${randomHelpers}
${samplePointHelpers}
${d}

${ssrt}

${ssrtao}

            `,uniforms:{tLastThis:{value:null},tDiffuse:{value:null},tNormalDepth:{value:null},tLastFrame:{value:null},opacity:{value:1},intensity:{value:2.14},rayCount:{value:.1},objectRadius:{value:1},autoRadius:{value:!_},power:{value:1.1},bias:{value:.015},falloff:{value:.7},tolerance:{value:1.5},frameCount:{value:0},frameCount2:{value:0},projection:{value:new three_module.kn4},screenSize:{value:new three_module.I9Y},cameraPositionWorld:{value:new three_module.Pq0},cameraNearFar:{value:new three_module.I9Y(.1,1e3)}},defines:{PERSPECTIVE_CAMERA:1,SSGI_ENABLED:_?1:0}},"tDiffuse","tLastFrame","tLastThis"),this.materialExtension={shaderExtender:(v,b,tt)=>{var it;if(!v.defines.SSRTAO_ENABLED)return;this.materialExtension.extraUniforms.tSSGIMap.value=(it=this._target)===null||it===void 0?void 0:it.texture;const nt=b.materialObject;let lt=this.material.defines.SSGI_ENABLED;nt.defines.SSGI_ENABLED!==lt&&(nt.defines.SSGI_ENABLED=lt,nt.needsUpdate=!0),lt=this._target.texture,this.materialExtension.extraUniforms.tSSGIMap.value!==lt&&(this.materialExtension.extraUniforms.tSSGIMap.value=lt,nt.needsUpdate=!0);const ut="vec3 totalDiffuse =",ht=`
            
            ${giPatch}
            
            // reflectedLight.directDiffuse = vec3(0.);
            // reflectedLight.indirectDiffuse = vec3(0.);
            // reflectedLight.directSpecular = vec3(0.);
            // reflectedLight.indirectSpecular = vec3(0.);
            
            `;v.fragmentShader=v.fragmentShader.replace(ut,`
${ht}
${ut}`),v.fragmentShader=v.fragmentShader.replace("#include <aomap_fragment>",""),v.defines.USE_UV=""},onObjectRender:(v,b,tt)=>{var it,nt,lt;const ut=b.materialObject,ht=!ut.transparent&&ut.transmission<.001,_t=this.enabled&&ht&&(this.renderWithCamera||this._renderer.frameCount>1)&&tt.userData.screenSpaceRendering!==!1&&!(!((it=ut.userData)===null||it===void 0)&&it.ssrtaoDisabled)&&!(!((nt=ut.userData)===null||nt===void 0)&&nt.ssaoDisabled)&&!(!((lt=ut.userData)===null||lt===void 0)&&lt.pluginsDisabled)?1:0;ut.defines.SSRTAO_ENABLED!==_t&&(ut.defines.SSRTAO_ENABLED=_t,ut.needsUpdate=!0)},parsFragmentSnippet:v=>{var b;return fe$1`
            uniform float ssaoPower;
            uniform float ssgiIntensity;
            uniform sampler2D tSSGIMap;
            ${getTexelDecoding("tSSGIMap",(b=this._target)===null||b===void 0?void 0:b.texture.colorSpace)}

            ${simpleCameraHelpers}

        `},extraUniforms:{tSSGIMap:{value:null},ssaoPower:this.material.uniforms.power,ssgiIntensity:this.material.uniforms.intensity},computeCacheKey:v=>{var b,tt,it,nt;return this.enabled?"1":"0"+((tt=(b=this._target)===null||b===void 0?void 0:b.texture)===null||tt===void 0?void 0:tt.colorSpace)+((nt=(it=this._target)===null||it===void 0?void 0:it.texture)===null||nt===void 0?void 0:nt.uuid)+this.material.defines.SSGI_ENABLED},isCompatible:v=>{var b;return!(!((b=v.materialObject.userData)===null||b===void 0)&&b.ssaoDisabled)&&v.isMeshStandardMaterial2}},this.intensity=2,this.power=1.1,this.autoRadius=!0,this.objectRadius=2,this.tolerance=1,this.bias=.15,this.falloff=.7,this.rayCount=2,this.stepCount=4,this.smoothEnabled=!0,this.renderWithCamera=!0,this.uiConfig={type:"folder",label:"SS Global illumination (Dev)",children:[...generateUiConfig(this),{type:"checkbox",label:"GI Enabled",hidden:()=>!this._giActivated,property:[this,"ssgiEnabled"]}]},this._renderer=o,this._target=c,this.needsSwap=!0,this._giActivated=_,this.ssgiEnabled=_,this.bilateralPass=new BilateralFilterPass(this._target,d,"rgba")}render(o,c,d,_,v){this.needsSwap=!1,!this.renderWithCamera&&this._renderer.frameCount<2||(this._renderer.blit(this._target.texture,c),this.uniforms.tLastThis.value=c.texture,super.render(o,this._target,d,_,v),this.smoothEnabled&&this.bilateralPass.render(o,c,d,_,v))}}SSRTAOPass_decorate([serialize()],SSRTAOPass.prototype,"bilateralPass",void 0),SSRTAOPass_decorate([uiSlider("Intensity",[0,4]),serialize(),uniform()],SSRTAOPass.prototype,"intensity",void 0),SSRTAOPass_decorate([uiSlider("Power",[0,3]),serialize(),uniform()],SSRTAOPass.prototype,"power",void 0),SSRTAOPass_decorate([uiToggle("Auto radius"),serialize(),uniform()],SSRTAOPass.prototype,"autoRadius",void 0),SSRTAOPass_decorate([uiSlider("Object Radius",[.01,10]),serialize(),uniform()],SSRTAOPass.prototype,"objectRadius",void 0),SSRTAOPass_decorate([uiSlider("Tolerance",[.1,5]),serialize(),uniform()],SSRTAOPass.prototype,"tolerance",void 0),SSRTAOPass_decorate([uiSlider("Bias",[-.3,.3]),serialize(),uniform()],SSRTAOPass.prototype,"bias",void 0),SSRTAOPass_decorate([uiSlider("Falloff",[1e-4,4]),serialize(),uniform()],SSRTAOPass.prototype,"falloff",void 0),SSRTAOPass_decorate([uiSlider("Ray Count",[1,5],1),serialize(),uniform()],SSRTAOPass.prototype,"rayCount",void 0),SSRTAOPass_decorate([uiSlider("Step count",[1,16],1),serialize(),matDefine("RTAO_STEP_COUNT")],SSRTAOPass.prototype,"stepCount",void 0),SSRTAOPass_decorate([uiToggle("Smooth Enabled"),serialize()],SSRTAOPass.prototype,"smoothEnabled",void 0),SSRTAOPass_decorate([uiToggle("Render with Camera")],SSRTAOPass.prototype,"renderWithCamera",void 0);class SSGIPlugin extends MultiFilterPlugin{get rtgiTarget(){return this._rtgiTarget}constructor(o=!0){super(),this.dependencies=[AssetManagerPlugin,GBufferPlugin,ProgressivePlugin],this._initEnabled=!1,this.setDirty=this.setDirty.bind(this),this._initEnabled=o}async onAdded(o){var c,d;await super.onAdded(o),this.enabled=this._initEnabled,(d=(c=this.uiConfig).uiRefresh)===null||d===void 0||d.call(c,"postFrame",!0)}get enabled(){var o,c;return((c=(o=this.passes.ssrtgi)===null||o===void 0?void 0:o.passObject)===null||c===void 0?void 0:c.enabled)||!1}set enabled(o){var c;!((c=this.passes.ssrtgi)===null||c===void 0)&&c.passObject&&(this.passes.ssrtgi.passObject.enabled=o)}createPasses(o){var c,d,_;return this._rtgiTarget=o.renderer.createTarget({sizeMultiplier:1}),(c=this._viewer)===null||c===void 0||c.getPluginByType("debug"),[makeFilter(o,{passId:"ssrtgi",after:["gbuffer"],before:["render"],required:["render","gbuffer","progressive"],passObject:new SSRTAOPass(o.renderer,this._rtgiTarget,(_=(d=o.getPlugin(GBufferPlugin))===null||d===void 0?void 0:d.getUnpackSnippet())!==null&&_!==void 0?_:"",!0),update:()=>{var v;const b=this.enabled;if(b){const tt=(v=this._viewer)===null||v===void 0?void 0:v.getPluginByType("SSAO");tt!=null&&tt.enabled&&(tt.enabled=!1)}b&&this.passes.ssrtgi.passObject.bilateralPass.updateShaderProperties([o.getPlugin(GBufferPlugin)])}},()=>[o.getPlugin(GBufferPlugin),o.getPlugin(ProgressivePlugin),o.scene.activeCamera,o.renderer])]}async onRemove(o){return o.renderer.disposeTarget(this._rtgiTarget),super.onRemove(o)}setDirty(){var o;(o=this._viewer)===null||o===void 0||o.setDirty()}get uiConfig(){var o,c,d,_,v;const b=(d=(c=(o=this.passes.ssrtgi)===null||o===void 0?void 0:o.passObject)===null||c===void 0?void 0:c.uiConfig)!==null&&d!==void 0?d:{};return(v=(_=b.children)===null||_===void 0?void 0:_.map(tt=>Ee$1(tt)))===null||v===void 0||v.flat(2).forEach(tt=>tt&&(tt.onChange=this.setDirty)),b}}SSGIPlugin.PluginType="SSGI";var NormalRenderPass_decorate=function(h,o,c,d){var _,v=arguments.length,b=v<3?o:d===null?d=Object.getOwnPropertyDescriptor(o,c):d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(h,o,c,d);else for(var tt=h.length-1;tt>=0;tt--)(_=h[tt])&&(b=(v<3?_(b):v>3?_(o,c,b):_(o,c))||b);return v>3&&b&&Object.defineProperty(o,c,b),b};let NormalRenderPass=class extends RenderPass{constructor(h,o,c){super(h,o,c??new NormalMaterial,new three_module.Q1f(0,0,0),1),this.enabled=!0,this._firstCall=!0}render(h,o,c,d,_){this.enabled&&super.render(h,o,c,d,_)}};NormalRenderPass=NormalRenderPass_decorate([uiFolder("High Precision Normal Buffer")],NormalRenderPass);class NormalMaterial extends three_module.qBx{constructor(){super()}onBeforeRender(o,c,d,_,v){var b,tt,it;let nt=v.material;Array.isArray(nt)&&(nt=nt[0]),this.normalMap=(b=nt==null?void 0:nt.normalMap)!==null&&b!==void 0?b:null,this.bumpMap=(tt=nt==null?void 0:nt.bumpMap)!==null&&tt!==void 0?tt:null,this.bumpScale=nt==null?void 0:nt.bumpScale,nt!=null&&nt.normalScale&&this.normalScale.copy(nt==null?void 0:nt.normalScale),this.needsUpdate=!0,this.side=(it=nt.side)!==null&&it!==void 0?it:three_module.$EB}}class NormalBufferPlugin extends GenericFilterPlugin{passCtor(o){this._normalTarget=o.renderer.createTarget({depthBuffer:!0,type:three_module.ix0,minFilter:three_module.hxR,magFilter:three_module.hxR,generateMipmaps:!1}),this._normalTarget.texture.name="normalBuffer",this._normalTarget.texture.generateMipmaps=!1;const c=this._normalTarget,d=new Set,_=new Set;return new class extends NormalRenderPass{render(v,b,tt,it,nt){const lt=v.getRenderTarget(),ut=v.getActiveCubeFace(),ht=v.getActiveMipmapLevel();this.scene&&(this.scene.traverse(({material:_t})=>{_t&&((_t.transparent&&_t.userData.renderToDepth||!_t.transparent&&_t.transmission===0&&_t.userData.renderToDepth===!1)&&(d.add(_t),_t.transparent=!_t.transparent),Math.abs(_t.transmission||0)>0&&_t.userData.renderToDepth&&(_.add([_t,_t.transmission]),_t.transmission=0))}),setThreeRendererMode(v,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!0,transparentRender:!1,transmissionRender:!1,mainRenderPass:!1},()=>super.render(v,b,c,it,nt)),d.forEach(_t=>_t.transparent=!_t.transparent),d.clear(),_.forEach(([_t,ft])=>_t.transmission=ft),_.clear(),v.setRenderTarget(lt,ut,ht))}}}_update(o){if(!super._update(o))return!1;const c=this.pass.passObject;return c.scene=o.scene.modelObject,c.camera=o.scene.activeCamera.cameraObject,!0}constructor(o=!0){super(),this.passId="normalBuffer",this._beforeFilters=["render"],this._afterFilters=[],this._requiredFilters=["render"],this.enabled=o}getNormalBuffer(){return this._normalTarget}async onDispose(o){}async onRemove(o){var c,d;return o.renderer.disposeTarget((d=(c=this._normalTarget)===null||c===void 0?void 0:c.dispose)===null||d===void 0?void 0:d.call(c)),super.onRemove(o)}updateShaderProperties(o){var c,d;return o.uniforms.tNormalBuffer?o.uniforms.tNormalBuffer.value=this.enabled&&(d=(c=this.getNormalBuffer())===null||c===void 0?void 0:c.texture)!==null&&d!==void 0?d:null:console.warn("BaseRenderer: no uniform: tNormalBuffer"),this}get uiConfig(){var o;return(o=this.pass)===null||o===void 0?void 0:o.passObject.uiConfig}}NormalBufferPlugin.PluginType="NormalBufferPlugin";class e{static _xfnv1a(o){let c=2166136261;for(let d=0;d<o.length;d++)c=Math.imul(c^o.charCodeAt(d),16777619);return()=>(c+=c<<13,c^=c>>>7,c+=c<<3,c^=c>>>17,(c+=c<<5)>>>0)}}let t$1=class yw extends e{constructor(o){super(),Object.defineProperty(this,"a",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.a=yw._xfnv1a(o)()}next(){let o=this.a+=1831565813;return o=Math.imul(o^o>>>15,1|o),o^=o+Math.imul(o^o>>>7,61|o),((o^o>>>14)>>>0)/4294967296}};class es_i extends e{constructor(o){super(),Object.defineProperty(this,"a",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"b",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"c",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"d",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const c=es_i._xfnv1a(o);this.a=c(),this.b=c(),this.c=c(),this.d=c()}next(){this.a>>>=0,this.b>>>=0,this.c>>>=0,this.d>>>=0;let o=this.a+this.b|0;return this.a=this.b^this.b>>>9,this.b=this.c+(this.c<<3)|0,this.c=this.c<<21|this.c>>>11,this.d=this.d+1|0,o=o+this.d|0,this.c=this.c+o|0,(o>>>0)/4294967296}}let r$1=class bw extends e{constructor(o){super(),Object.defineProperty(this,"a",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"b",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"c",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"d",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const c=bw._xfnv1a(o);this.a=c(),this.b=c(),this.c=c(),this.d=c()}next(){const o=this.b<<9;let c=5*this.b;return c=9*(c<<7|c>>>25),this.c^=this.a,this.d^=this.b,this.b^=this.c,this.a^=this.d,this.c^=o,this.d=this.d<<11|this.d>>>21,(c>>>0)/4294967296}};var s;(function(h){h.sfc32="sfc32",h.mulberry32="mulberry32",h.xoshiro128ss="xoshiro128ss"})(s||(s={}));class a{constructor(o,c=s.sfc32){Object.defineProperty(this,"str",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"prng",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"generator",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.str=o,this.prng=c,this.generator=this._initializeGenerator()}next(){return this.generator.next()}_initializeGenerator(){if((c=>c===null)(o=this.str)||(c=>c===void 0)(o))return this.wrap();var o;switch(this.prng){case"sfc32":return new es_i(this.str);case"mulberry32":return new t$1(this.str);case"xoshiro128ss":return new r$1(this.str);default:return this.wrap()}}wrap(){return{next:()=>Math.random()}}}var RandomizedDirectionalLight_decorate=function(h,o,c,d){var _,v=arguments.length,b=v<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(h,o,c,d);else for(var tt=h.length-1;tt>=0;tt--)(_=h[tt])&&(b=(v<3?_(b):v>3?_(o,c,b):_(o,c))||b);return v>3&&b&&Object.defineProperty(o,c,b),b};class RandomizedDirectionalLight extends DirectionalLight2{constructor(o,c,d,_){super(o,c),this._shadowParams={enabled:!0,radius:2,width:1024,height:1024,bias:-.001,normalBias:0,near:1.5,far:4,frustumSize:4},this._randomParams={focus:1,spread:.01,distanceScale:50,minDistanceScale:new three_module.Pq0(10,10,10),normalDirection:new three_module.Pq0(.01,.98,.01).normalize(),direction:new three_module.Pq0(-.9,.5,-1)},this.isRandomizedDirectionalLight=!0,this.shadowParams=d??{},this.randomParams=_??{},this.updateShadowParams=this.updateShadowParams.bind(this)}get shadowParams(){return this._shadowParams}set shadowParams(o){Object.keys(o).forEach(c=>o[c]===void 0&&delete o[c]),this._shadowParams={...this._shadowParams,...o},this.updateShadowParams()}get randomParams(){return this._randomParams}set randomParams(o){Object.keys(o).forEach(c=>o[c]===void 0&&delete o[c]),Object.assign(this._randomParams,o)}updateShadowParams(){this.castShadow=this._shadowParams.enabled,this.shadow.mapSize.x=this._shadowParams.width,this.shadow.mapSize.y=this._shadowParams.height,this.shadow.bias=this._shadowParams.bias,this.shadow.normalBias=this._shadowParams.normalBias,this.refreshShadowCamNearFar(),this.shadow.radius=this._shadowParams.radius,this.shadow.camera.right=this._shadowParams.frustumSize/2,this.shadow.camera.left=-this._shadowParams.frustumSize/2,this.shadow.camera.top=this._shadowParams.frustumSize/2,this.shadow.camera.bottom=-this._shadowParams.frustumSize/2,this.shadow.camera.updateProjectionMatrix(),this.matrixWorldNeedsUpdate=!0}randomizePosition(o,c=null,d=null){const _=new a(o.toString()),v=new three_module.I9Y(_.next()*Math.PI*2,Math.asin(2*_.next()-1));let b=new three_module.Pq0(Math.cos(v.x)*Math.cos(v.y),Math.sin(v.y),Math.sin(v.x)*Math.cos(v.y));const tt=new three_module.I9Y;for(let it=0;it<5;it++){tt.set(_.next(),_.next()),b=getSample(tt,this._randomParams.normalDirection,.4),_.next()<Math.sqrt(c??this._randomParams.focus)&&(tt.set(_.next(),_.next()),b=getSample(tt,this._randomParams.direction,Math.pow((d??this._randomParams.spread)/2,2)));const nt=b.dot(this._randomParams.normalDirection);if(nt>0&&nt<.4)break}b.normalize(),b.multiplyScalar(this._randomParams.distanceScale),this.position.set(0,0,0),this.target.position.copy(b.normalize().negate()),this.target.updateMatrixWorld(),this.refreshShadowCamNearFar(),this.updateMatrixWorld()}refreshShadowCamNearFar(){const o=new three_module.Pq0().subVectors(this.target.position,this.shadow.camera.position).length();this.shadow.camera.near=o-this._shadowParams.near*this._shadowParams.frustumSize/2,this.shadow.camera.far=o+this._shadowParams.far*this._shadowParams.frustumSize/2}dispose(){}get uiConfig(){if(this._uiConfig)return this._uiConfig}fromJSON(o,c){return super.fromJSON(o,c)?(this.updateShadowParams(),this):null}}function getSample(h,o,c){o=o.clone().normalize();const d=new three_module.Pq0(0,-o.z,o.y).normalize(),_=new three_module.Pq0().crossVectors(o,d).normalize(),v=h;v.x=2*v.x*Math.PI,v.y=1-v.y*c;const b=Math.sqrt(1-v.y*v.y);return d.multiplyScalar(Math.cos(v.x)*b).add(_.multiplyScalar(Math.sin(v.x)*b)).add(o.multiplyScalar(v.y))}RandomizedDirectionalLight_decorate([serialize("shadowParams")],RandomizedDirectionalLight.prototype,"_shadowParams",void 0),RandomizedDirectionalLight_decorate([serialize("randomParams")],RandomizedDirectionalLight.prototype,"_randomParams",void 0);var RandomizedDirectionalLightPlugin_decorate=function(h,o,c,d){var _,v=arguments.length,b=v<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(h,o,c,d);else for(var tt=h.length-1;tt>=0;tt--)(_=h[tt])&&(b=(v<3?_(b):v>3?_(o,c,b):_(o,c))||b);return v>3&&b&&Object.defineProperty(o,c,b),b};class RandomizedDirectionalLightPlugin extends AViewerPlugin{get cameraHelper(){return this._cameraHelper}constructor(o=!0){super(),this.enabled=!0,this.light=new RandomizedDirectionalLight("#cceeff",.3),this.lightLayers=1,this._preRender=()=>{var c,d,_;if(!this.enabled)return void(this.light.layers.mask=0);const v=(d=(c=this._viewer)===null||c===void 0?void 0:c.renderer.frameCount)!==null&&d!==void 0?d:0;this.light.randomizePosition(v<5?0:v),this.light.layers.mask=this.lightLayers,this.light.updateShadowParams(),(_=this._cameraHelper)===null||_===void 0||_.update()},this._setDirty=this._setDirty.bind(this),this.enabled=o}async onAdded(o){await super.onAdded(o),this._cameraHelper=new three_module.WTh(this.light.shadow.camera),this._cameraHelper.visible=!1,this._cameraHelper.userData.bboxVisible=!1,o.scene.add(this._cameraHelper),o.scene.addLight(this.light,{addToRoot:!0}),o.addEventListener("preRender",this._preRender)}async onRemove(o){return o.removeEventListener("preRender",this._preRender),this.light.removeFromParent(),super.onRemove(o)}_setDirty(o=!1){var c,d;o?(c=this._viewer)===null||c===void 0||c.scene.setDirty():(d=this._viewer)===null||d===void 0||d.setDirty()}get uiConfig(){return this._uiConfig?this._uiConfig:this._uiConfig={type:"folder",label:"Progressive Shadow",children:[{type:"checkbox",label:"Enabled",property:[this,"enabled"],onChange:this._setDirty},{type:"folder",label:"Directional Light",children:[{type:"checkbox",label:"Visible",property:[this.light,"visible"],onChange:this._setDirty},{type:"slider",label:"Intensity",bounds:[0,50],property:[this.light,"intensity"],onChange:this._setDirty},{type:"color",label:"Color",property:[this.light,"color"],onChange:this._setDirty},{type:"checkbox",label:"Shadow Enabled",property:[this.light.shadowParams,"enabled"],onChange:[this.light.updateShadowParams,this._setDirty]},{type:"slider",bounds:[0,1],property:[this.light.randomParams,"focus"],onChange:this._setDirty},{type:"slider",bounds:[0,1],property:[this.light.randomParams,"spread"],onChange:this._setDirty},{type:"slider",bounds:[.01,60],property:[this.light.randomParams,"distanceScale"],onChange:this._setDirty},{type:"vec3",bounds:[-5,5],property:[this.light.randomParams,"direction"],onChange:this._setDirty},{type:"slider",bounds:[.01,10],property:[this.light.shadowParams,"radius"],onChange:[this.light.updateShadowParams,this._setDirty]},{type:"slider",bounds:[.01,30],property:[this.light.shadowParams,"frustumSize"],onChange:[this.light.updateShadowParams,this._setDirty]},{type:"slider",bounds:[-.01,.01],property:[this.light.shadowParams,"bias"],onChange:[this.light.updateShadowParams,this._setDirty]},{type:"slider",bounds:[-.05,.05],property:[this.light.shadowParams,"normalBias"],onChange:[this.light.updateShadowParams,this._setDirty]}]}]}}}RandomizedDirectionalLightPlugin.PluginType="RandomizedDirectionalLight",RandomizedDirectionalLightPlugin_decorate([serialize()],RandomizedDirectionalLightPlugin.prototype,"enabled",void 0),RandomizedDirectionalLightPlugin_decorate([serialize("rdLight")],RandomizedDirectionalLightPlugin.prototype,"light",void 0),RandomizedDirectionalLightPlugin_decorate([serialize()],RandomizedDirectionalLightPlugin.prototype,"lightLayers",void 0);var ssrPatch=`#if defined(SSR_ENABLED) && SSR_ENABLED > 0
vec3 screenPos=viewToScreen(geometryPosition);vec4 ssrColor=vec4(0,0,0,0);float alphaModifier=1.-clamp(material.roughness*.3,0.,1.);alphaModifier*=ssrIntensity;
#if defined(SSR_MASK_FRONT_RAYS) && SSR_MASK_FRONT_RAYS > 0
alphaModifier*=clamp(-4.*dot(geometryViewDir,normal)+(4.+ssrMaskFrontFactor),0.,1.);
#endif
#ifdef USE_TRANSMISSION
alphaModifier*=1.-transmission;
#endif
float vignette=1.;if(true){float fadeStrength=0.1;float dist=max(0.,min(min(1.-screenPos.x,1.-screenPos.y),min(screenPos.x,screenPos.y)));float fade=dist*dist/(fadeStrength+0.001);fade=clamp(fade,0.,1.);fade=pow(fade,0.3);vignette=fade;}alphaModifier*=vignette;vec3 specularColor=EnvironmentBRDF(geometryNormal,geometryViewDir,material.specularColor.rgb,material.specularF90,material.roughness);if(length(specularColor.rgb)*alphaModifier>0.01&&roughnessFactor<0.9){
#if defined(SSR_INLINE) && SSR_INLINE > 0
ssrColor=calculateSSR(8.,vec3(screenPos.xy,geometryPosition.z),geometryNormal,1.,material.roughness);
#else
ssrColor=tSSRMapTexelToLinear(texture2D(tSSRMap,screenPos.xy));
#endif 
}ssrColor.rgb*=ssrBoost;ssrColor.a*=alphaModifier;ssrColor.a=min(ssrColor.a,1.);
#if defined(SSR_NON_PHYSICAL) && SSR_NON_PHYSICAL > 0
diffuseColor.a=max(ssrColor.a,diffuseColor.a*diffuseColor.a);reflectedLight.indirectSpecular=mix(reflectedLight.indirectSpecular,saturate(diffuseColor.rgb*ssrColor.rgb),1.);reflectedLight.indirectDiffuse=diffuseColor.rgb*(1.-ssrColor.a);reflectedLight.directDiffuse=vec3(0.);reflectedLight.directSpecular=vec3(0.);
#else
reflectedLight.indirectSpecular=mix(reflectedLight.indirectSpecular,saturate(specularColor.rgb*ssrColor.rgb),ssrColor.a);
#endif
#endif
`,ssreflection=`uniform float objectRadius;uniform float radius;uniform float tolerance;uniform bool autoRadius;
#ifndef D_sceneBoundingRadius
#define D_sceneBoundingRadius 
uniform float sceneBoundingRadius;
#endif
vec3 ComputeReflectionL(vec3 N,vec2 E,vec3 V,float rough){float rough4=rough*rough*rough*rough;float phi=2.*PI*E.x;float cos_theta=pow(max(E.y,0.000001),rough4/(2.-rough4));float sin_theta=sqrt(max(0.,1.-cos_theta*cos_theta));vec3 half_vec=vec3(sin_theta*cos(phi),sin_theta*sin(phi),cos_theta);vec3 tangentX=normalize(cross(abs(N.z)<0.999?vec3(0.,0.,1.):vec3(1.,0.,0.),N));vec3 tangentY=cross(N,tangentX);half_vec=half_vec.x*tangentX+half_vec.y*tangentY+half_vec.z*N;vec3 ray_dir=(2.*dot(V,half_vec))*half_vec-V;return ray_dir;}vec2 GetRandomE(float seed){vec2 rand_e;rand_e.x=interleavedGradientNoise(gl_FragCoord.xy,frameCount*117.);rand_e.y=fract(rand_e.x*38.65435);rand_e.y=mix(rand_e.y,1.,0.7);return rand_e;}vec4 calculateSSR(in float seed,in vec3 screenPos,in vec3 normal,in float radiusFactor,in float roughness){vec3 viewPos=screenToView(screenPos.xy,screenPos.z);normal=normalize(normal);vec2 E=GetRandomE(seed);vec3 L=ComputeReflectionL(normal,E,-normalize(viewPos),roughness);L=normalize(L);float cameraDist=length(cameraPositionWorld);float rayLen=objectRadius*sceneBoundingRadius;rayLen=autoRadius?min(max(mix(max(0.,(cameraDist+rayLen)+viewPos.z),max(0.,-viewPos.z-max(0.,cameraDist-rayLen)),L.z*0.5+0.5),rayLen*0.1),rayLen*5.):rayLen;rayLen*=radiusFactor;float r=interleavedGradientNoise(gl_FragCoord.xy,frameCount+seed);rayLen=max(rayLen,0.001);int steps=SSR_STEP_COUNT/(frameCount<float(SSR_LOW_QUALITY_FRAMES)?2:1);vec3 state=vec3(0.,(r+0.5)/float(steps),2.);viewPos+=normal*max(-0.0001*viewPos.z,0.001);vec3 screenHitP=traceRay(viewPos,L*rayLen,tolerance*rayLen,state,steps);if(state.z<0.9999){vec3 hitColor=(tLastFrameTexelToLinear(texture2D(tLastFrame,screenHitP.xy))).rgb;float ssrWeight=1.;return vec4(hitColor*ssrWeight,1.);}return vec4(0.);}`,ssreflectionMain=`uniform sampler2D tLastThis;void main(){vec4 texel=tDiffuseTexelToLinear(texture2D(tDiffuse,vUv));vec4 lastAO=tLastThisTexelToLinear(texture2D(tLastThis,vUv));float depth;vec3 normal;getDepthNormal(vUv,depth,normal);if(depth>=0.999){discard;}float viewZ=depthToViewZ(depth);vec3 screenPos=vec3(vUv.x,vUv.y,viewZ);vec3 viewPos=screenToView(screenPos.xy,screenPos.z);viewPos.z=viewZ/viewPos.z;vec4 ao=vec4(0.);ao+=calculateSSR(8.,screenPos,normal,1.,0.1);ao.rgb=min(vec3(3.),ao.rgb);ao.rgb=max(vec3(0.),ao.rgb);if(frameCount<1.){gl_FragColor=ao;return;}if(ao.a<0.01){gl_FragColor.rgb=lastAO.rgb;gl_FragColor.a=(((lastAO.a)*frameCount)/(frameCount+1.));}else{gl_FragColor=((ao+(lastAO)*frameCount)/(frameCount+1.));}
#include <colorspace_fragment>
}`,SSRPass_decorate=function(h,o,c,d){var _,v=arguments.length,b=v<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(h,o,c,d);else for(var tt=h.length-1;tt>=0;tt--)(_=h[tt])&&(b=(v<3?_(b):v>3?_(o,c,b):_(o,c))||b);return v>3&&b&&Object.defineProperty(o,c,b),b};let SSRPass=class extends ShaderPass2{constructor(h,o,c,d=!0){super({vertexShader:defaultVertex,fragmentShader:`

varying vec2 vUv;

${basicHelpers}
${cameraHelpers}
${randomHelpers}
${samplePointHelpers}
${c}

${ssrt}

${ssreflection}

${ssreflectionMain}


            `,uniforms:{tLastThis:{value:null},tDiffuse:{value:null},tNormalDepth:{value:null},tLastFrame:{value:null},opacity:{value:1},intensity:{value:0},boost:{value:new three_module.Pq0(0,0,0)},objectRadius:{value:0},autoRadius:{value:!1},power:{value:0},maskFrontFactor:{value:-.1},tolerance:{value:0},frameCount:{value:0},projection:{value:new three_module.kn4},cameraPositionWorld:{value:new three_module.Pq0},cameraNearFar:{value:new three_module.I9Y(.1,1e3)},sceneBoundingRadius:{value:0}},defines:{PERSPECTIVE_CAMERA:1,SSR_STEP_COUNT:16,SSR_LOW_QUALITY_FRAMES:2,SSR_MASK_FRONT_RAYS:!0,SSR_INLINE:d?"1":"0",SSR_NON_PHYSICAL:"0"}},"tDiffuse","tLastThis","tLastFrame"),this.uiConfig=void 0,this.materialExtension={shaderExtender:(_,v,b)=>{var tt,it,nt,lt,ut;let ht=!this.enabled||b.userData.screenSpaceRendering===!1||!((tt=v.materialObject.userData)===null||tt===void 0)&&tt.pluginsDisabled||!((it=v.materialObject.userData)===null||it===void 0)&&it.ssreflDisabled?0:1;if(v.materialObject.defines.SSR_ENABLED!==ht&&(v.materialObject.defines.SSR_ENABLED=ht,v.materialObject.needsUpdate=!0),!_.defines.SSR_ENABLED)return;ht=this.material.defines.SSR_STEP_COUNT,v.materialObject.defines.SSR_STEP_COUNT!==ht&&(v.materialObject.defines.SSR_STEP_COUNT=ht,v.materialObject.needsUpdate=!0),ht=this.material.defines.SSR_LOW_QUALITY_FRAMES,v.materialObject.defines.SSR_LOW_QUALITY_FRAMES!==ht&&(v.materialObject.defines.SSR_LOW_QUALITY_FRAMES=ht,v.materialObject.needsUpdate=!0),ht=this.material.defines.PERSPECTIVE_CAMERA,v.materialObject.defines.PERSPECTIVE_CAMERA!==ht&&(v.materialObject.defines.PERSPECTIVE_CAMERA=ht,v.materialObject.needsUpdate=!0),ht=this.material.defines.SSR_INLINE,v.materialObject.defines.SSR_INLINE!==ht&&(v.materialObject.defines.SSR_INLINE=ht,v.materialObject.needsUpdate=!0),ht=this.material.defines.SSR_MASK_FRONT_RAYS?1:0,v.materialObject.defines.SSR_MASK_FRONT_RAYS!==ht&&(v.materialObject.defines.SSR_MASK_FRONT_RAYS=ht,v.materialObject.needsUpdate=!0),ht=!((nt=v.materialObject.userData)===null||nt===void 0)&&nt.ssreflNonPhysical?"1":"0",v.materialObject.defines.SSR_NON_PHYSICAL!==ht&&(v.materialObject.defines.SSR_NON_PHYSICAL=ht,v.materialObject.needsUpdate=!0),ht=(ut=(lt=this._target)===null||lt===void 0?void 0:lt.texture)!==null&&ut!==void 0?ut:null,this.materialExtension.extraUniforms.tSSRMap.value!==ht&&(this.materialExtension.extraUniforms.tSSRMap.value=ht,v.materialObject.needsUpdate=!0);const _t="#glMarker beforeModulation",ft=`
            
            ${ssrPatch}
            
            // reflectedLight.directDiffuse = vec3(0.);
            // reflectedLight.indirectDiffuse = vec3(0.);
            // reflectedLight.directSpecular = vec3(0.);
            // reflectedLight.indirectSpecular = vec3(0.);
            
            `;_.fragmentShader=_.fragmentShader.replace(_t,`
${ft}
${_t}`)},onObjectRender:(_,v,b)=>{var tt,it;const nt=!this.enabled||b.userData.screenSpaceRendering===!1||!((tt=v.materialObject.userData)===null||tt===void 0)&&tt.pluginsDisabled||!((it=v.materialObject.userData)===null||it===void 0)&&it.ssreflDisabled?0:1;v.materialObject.defines.SSR_ENABLED!==nt&&(v.materialObject.defines.SSR_ENABLED=nt,v.materialObject.needsUpdate=!0)},parsFragmentSnippet:(_,v)=>{var b,tt,it,nt;return!this.enabled||_.userData.screenSpaceRendering===!1||!((b=v==null?void 0:v.materialObject.userData)===null||b===void 0)&&b.ssreflDisabled||!((tt=v==null?void 0:v.materialObject.userData)===null||tt===void 0)&&tt.pluginsDisabled?"":`
uniform float ssrPower;
uniform float ssrIntensity;
uniform float ssrMaskFrontFactor;
uniform vec3 ssrBoost;
uniform sampler2D tSSRMap;
uniform sampler2D tLastFrame;
`+getTexelDecoding("tSSRMap",(it=this._target)===null||it===void 0?void 0:it.texture.colorSpace)+getTexelDecoding("tLastFrame",(nt=this.materialExtension.extraUniforms.tLastFrame.value)===null||nt===void 0?void 0:nt.colorSpace)+(this._inline?`
#if 1
// #if SSR_INLINE
    ${basicHelpers}
    
    #define THREE_PACKING_INCLUDED
    ${cameraHelpers}
    
    ${randomHelpers}
    ${samplePointHelpers}
    ${unpackGbuffer}
    
    ${ssrt}
    
    ${ssreflection}
// #endif // SSR_INLINE
#endif
`:"")+`
${simpleCameraHelpers}
        `},extraUniforms:{tSSRMap:{value:null},ssrPower:this.material.uniforms.power,ssrIntensity:this.material.uniforms.intensity,ssrMaskFrontFactor:this.material.uniforms.maskFrontFactor,ssrBoost:this.material.uniforms.boost,tNormalDepth:this.material.uniforms.tNormalDepth,tLastFrame:this.material.uniforms.tLastFrame,objectRadius:this.material.uniforms.objectRadius,autoRadius:this.material.uniforms.autoRadius,tolerance:this.material.uniforms.tolerance,frameCount:this.material.uniforms.frameCount,projection:this.material.uniforms.projection,cameraPositionWorld:this.material.uniforms.cameraPositionWorld,cameraNearFar:this.material.uniforms.cameraNearFar,sceneBoundingRadius:this.material.uniforms.sceneBoundingRadius},computeCacheKey:_=>{var v,b,tt;return this.enabled?"1":"0"+((b=(v=this._target)===null||v===void 0?void 0:v.texture)===null||b===void 0?void 0:b.colorSpace)+(this.enabled&&!(!((tt=_.materialObject.userData)===null||tt===void 0)&&tt.ssreflDisabled)?1:0)+Object.values(this.material.defines).map(it=>it+"").join(",")},isCompatible:_=>{var v;return!(!((v=_.materialObject.userData)===null||v===void 0)&&v.ssreflDisabled)&&_.isMeshStandardMaterial2}},this.intensity=1,this.boost=new three_module.Pq0(1,1,1),this.objectRadius=1,this.autoRadius=!0,this.power=1.1,this.tolerance=.5,this.stepCount=16,this.lowQualityFrames=0,this.maskFrontRays=!0,this.maskFrontFactor=-.2,this._renderer=h,this._target=o,this.needsSwap=!1,this._inline=d}render(h,o,c,d,_){if(this._inline)this.needsSwap=!1;else{if(!this._target)throw"Target must be set when inline = false";this._renderer.blit(this._target.texture,o,{}),this.uniforms.tLastThis.value=o.texture,super.render(h,this._target,c,d,_),this.needsSwap=!1}}};SSRPass_decorate([uiSlider("Intensity",[0,4]),serialize(),uniform()],SSRPass.prototype,"intensity",void 0),SSRPass_decorate([uiVector("Boost"),serialize(),uniform()],SSRPass.prototype,"boost",void 0),SSRPass_decorate([uiSlider("Object Radius",[.01,2]),serialize(),uniform()],SSRPass.prototype,"objectRadius",void 0),SSRPass_decorate([uiToggle("Auto radius"),serialize(),uniform()],SSRPass.prototype,"autoRadius",void 0),SSRPass_decorate([uiSlider("Power",[0,3]),serialize(),uniform()],SSRPass.prototype,"power",void 0),SSRPass_decorate([uiSlider("Tolerance",[.1,5]),serialize(),uniform()],SSRPass.prototype,"tolerance",void 0),SSRPass_decorate([uiSlider("Step count",[1,32],1),serialize(),matDefine("SSR_STEP_COUNT")],SSRPass.prototype,"stepCount",void 0),SSRPass_decorate([uiSlider("Low Quality Frames",[0,4],1),serialize(),matDefine("SSR_LOW_QUALITY_FRAMES")],SSRPass.prototype,"lowQualityFrames",void 0),SSRPass_decorate([uiToggle("Ignore front rays"),serialize(),matDefine("SSR_MASK_FRONT_RAYS")],SSRPass.prototype,"maskFrontRays",void 0),SSRPass_decorate([uiSlider("Mask front rays factor",[-1,1],.01,h=>({hidden:()=>!h.maskFrontRays})),serialize(),uniform()],SSRPass.prototype,"maskFrontFactor",void 0),SSRPass=SSRPass_decorate([uiFolder("Screen Space Reflections")],SSRPass);class SSRPlugin extends MultiFilterPlugin{get ssrTarget(){return this._ssrTarget}constructor(){super(),this.dependencies=[AssetManagerPlugin,GBufferPlugin,ProgressivePlugin],this.inlineSSR=!0,this.setDirty=this.setDirty.bind(this)}get enabled(){var o,c;return((c=(o=this.passes.ssr)===null||o===void 0?void 0:o.passObject)===null||c===void 0?void 0:c.enabled)||!1}set enabled(o){var c;!((c=this.passes.ssr)===null||c===void 0)&&c.passObject&&(this.passes.ssr.passObject.enabled=o)}async onAdded(o){var c,d;o.getPluginByType("Ground")&&console.error("GroundPlugin must be added after SSRPlugin"),await super.onAdded(o),(d=(c=this.uiConfig).uiRefresh)===null||d===void 0||d.call(c,"postFrame",!0)}createPasses(o){var c,d;return this._ssrTarget=this.inlineSSR?void 0:o.renderer.createTarget({sizeMultiplier:1}),[makeFilter(o,{passId:"ssr",after:["gbuffer"],before:["render"],required:["render","gbuffer","progressive"],passObject:new SSRPass(o.renderer,this._ssrTarget,(d=(c=o.getPlugin(GBufferPlugin))===null||c===void 0?void 0:c.getUnpackSnippet())!==null&&d!==void 0?d:"",this.inlineSSR)},()=>[o.getPlugin(GBufferPlugin),o.getPlugin(ProgressivePlugin),o.scene.activeCamera,o.renderer,o.scene])]}async onRemove(o){return this._ssrTarget&&o.renderer.disposeTarget(this._ssrTarget),super.onRemove(o)}setDirty(){var o;(o=this._viewer)===null||o===void 0||o.setDirty()}get uiConfig(){var o,c,d,_,v;const b=(d=(c=(o=this.passes.ssr)===null||o===void 0?void 0:o.passObject)===null||c===void 0?void 0:c.uiConfig)!==null&&d!==void 0?d:{};return(v=(_=b.children)===null||_===void 0?void 0:_.map(tt=>Ee$1(tt)))===null||v===void 0||v.flat(2).forEach(tt=>tt&&(tt.onChange=this.setDirty)),b}}SSRPlugin.PluginType="SSReflection";var anisotropyBsdf=`uniform float anisotropyFactor;uniform float anisotropyNoise;
#if ANISOTROPY_TEX_MODE == 0
uniform float anisotropyDirection;
#else
uniform sampler2D anisotropyDirectionMap;varying vec2 vAnisotropy2MapUv;
#endif
const float MIN_ROUGHNESS=0.05;vec3 indirectAnisotropyBentNormal(const in vec3 normal,const in vec3 viewDir,const in float roughness,const in vec3 anisotropicT,const in vec3 anisotropicB){vec3 aDirection=anisotropyFactor>=0.?anisotropicB:anisotropicT;vec3 aTangent=cross(aDirection,viewDir);vec3 aNormal=cross(aTangent,aDirection);float bendFactor=abs(anisotropyFactor)*saturate(5.*max(roughness,MIN_ROUGHNESS));return normalize(mix(normal,aNormal,bendFactor));}vec3 BRDF_GGX_Anisotropy(const in vec3 lightDir,const in vec3 viewDir,const in vec3 normal,const in vec3 f0,const in float f90,const in float roughness,const in vec3 anisotropicT,const in vec3 anisotropicB){float alpha=pow2(roughness);vec3 halfDir=normalize(lightDir+viewDir);float dotNL=saturate(dot(normal,lightDir));float dotNV=saturate(dot(normal,viewDir));float dotNH=saturate(dot(normal,halfDir));float dotVH=saturate(dot(viewDir,halfDir));float dotTV=dot(anisotropicT,viewDir);float dotBV=dot(anisotropicB,viewDir);float dotTL=dot(anisotropicT,lightDir);float dotBL=dot(anisotropicB,lightDir);float dotTH=dot(anisotropicT,halfDir);float dotBH=dot(anisotropicB,halfDir);float aspect=sqrt(1.-min(1.-MIN_ROUGHNESS,abs(anisotropyFactor)*0.9));if(anisotropyFactor>0.)aspect=1./aspect;float at=roughness*aspect;float ab=roughness/aspect;vec3 F=F_Schlick(f0,f90,dotVH);float V=V_GGX_SmithCorrelated_Anisotropic(at,ab,dotTV,dotBV,dotTL,dotBL,dotNV,dotNL);float D=D_GGX_Anisotropic(at,ab,dotTH,dotBH,dotNH);return F*(V*D);}`,anisotropyTBN=`float rnd=(random2(vUv.xy,frameCount)-0.5)*anisotropyNoise*material.roughness;
#if ANISOTROPY_TEX_MODE < 2
#if ANISOTROPY_TEX_MODE == 0 
float rot=saturate(anisotropyDirection);
#else 
float rot=(anisotropyDirectionMapTexelToLinear(texture2D(anisotropyDirectionMap,vAnisotropy2MapUv)).r);
#endif
rot=rot*2.*PI+rnd;vec2 rot2=vec2(sin(rot),cos(rot));
#else 
vec2 rot2=(anisotropyDirectionMapTexelToLinear(texture2D(anisotropyDirectionMap,vAnisotropy2MapUv)).rg*2.-1.)+vec2(rnd,rnd);rot2=normalize(rot2);const float anisoSpecMultiplier=0.25;float matSpecAniso=(length(material.specularColor.rgb))*2.*PI;rot2=mix(rot2,vec2(sin(matSpecAniso),cos(matSpecAniso)),anisoSpecMultiplier);rot2=normalize(rot2);
#endif
vec3 anisotropicT=(tbn[0]*rot2.x+tbn[1]*rot2.y);anisotropicT=normalize(anisotropicT-normal*dot(anisotropicT,normal));vec3 anisotropicB=normalize(cross(normal,anisotropicT));`,AnisotropyPlugin_decorate=function(h,o,c,d){var _,v=arguments.length,b=v<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(h,o,c,d);else for(var tt=h.length-1;tt>=0;tt--)(_=h[tt])&&(b=(v<3?_(b):v>3?_(o,c,b):_(o,c))||b);return v>3&&b&&Object.defineProperty(o,c,b),b};let AnisotropyPlugin=class extends AViewerPlugin{makeAnisotropic(h){var o;const c=(o=h.materialObject)===null||o===void 0?void 0:o.userData;if(!c)return!1;if(c._isAnisotropic===void 0){const d=c.__appliedMeshes;let _=!0;if(d)for(const{geometry:v}of d)!v||v.index&&v.attributes.position&&v.attributes.normal&&v.attributes.uv||(_=!1),_&&!v.attributes.tangent&&v.computeTangents();if(!_)return!1}return c._isAnisotropic=!0,c._anisotropyFactor===void 0&&(c._anisotropyFactor=1),c._anisotropyNoise===void 0&&(c._anisotropyNoise=0),c._anisotropyDirectionMode===void 0&&(c._anisotropyDirectionMode="DIRECTION"),h.materialObject.needsUpdate=!0,!0}tryComputeTangents(h,o){if(h.geometry&&!h.geometry.attributes.tangent){let c=!0;h.geometry.index&&h.geometry.attributes.position&&h.geometry.attributes.normal&&h.geometry.attributes.uv||(c=!1),c?h.geometry.computeTangents():o.map(d=>{var _;!((_=d==null?void 0:d.userData)===null||_===void 0)&&_._isAnisotropic&&(d.userData._isAnisotropic=!1)})}}_loaderCreate({loader:h}){h.isGLTFLoader2&&h.register(o=>new GLTFMaterialsAnisotropyExtensionImport(o))}constructor(){super(),this.enabled=!0,this.dependencies=[AssetManagerPlugin],this._defines={ANISOTROPY_DEBUG:!1},this._uniforms={anisotropyFactor:{value:1},anisotropyNoise:{value:1},anisotropyDirection:{value:1},anisotropyDirectionMap:{value:null},anisotropy2MapUvTransform:{value:new three_module.dwI},frameCount:{value:0}},this.materialExtension={shaderExtender:(h,o,c)=>{var d;if(!this.enabled||!o.materialObject.userData._isAnisotropic)return;const _=(d=o.materialObject.userData)===null||d===void 0?void 0:d._anisotropyDirectionMap,v=fe$1`
                //#if ANISOTROPY_ENABLED
                ${randomHelpers}
            `+(_?getTexelDecoding("anisotropyDirectionMap",_.colorSpace):"")+`
`;h.fragmentShader=shaderReplaceString(h.fragmentShader,"#include <common>",v,{append:!0}),h.fragmentShader=h.fragmentShader.replace("#include <lights_fragment_begin>",three_module.vxI.lights_fragment_begin),h.fragmentShader=shaderReplaceString(shaderReplaceString(h.fragmentShader,"IncidentLight directLight;",anisotropyTBN,{prepend:!0}),"RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight )","RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight, anisotropicT, anisotropicB )",{replaceAll:!0});let b=shaderReplaceString(three_module.vxI.lights_physical_pars_fragment,"void RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {","void RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight, const in vec3 anisotropicT, const in vec3 anisotropicB ) {");b=shaderReplaceString(b,"vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {",anisotropyBsdf+`
`,{prepend:!0}),b=shaderReplaceString(b,"BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material )","BRDF_GGX_Anisotropy( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularF90, material.roughness, anisotropicT, anisotropicB )"),h.fragmentShader=shaderReplaceString(h.fragmentShader,"#include <lights_physical_pars_fragment>",b),h.fragmentShader=shaderReplaceString(h.fragmentShader,"#include <normal_fragment_begin>",three_module.vxI.normal_fragment_begin),h.fragmentShader=shaderReplaceString(h.fragmentShader,"#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )","#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) || defined( USE_TANGENT )");let tt=fe$1`
                #if defined( USE_ENVMAP )
                vec3 anisotropyBentNormal = indirectAnisotropyBentNormal(geometryNormal, geometryViewDir, material.roughness, anisotropicT, anisotropicB);
                #endif
            `+three_module.vxI.lights_fragment_maps;tt=shaderReplaceString(tt,"getIBLIrradiance( geometryNormal )","getIBLIrradiance( anisotropyBentNormal )"),tt=shaderReplaceString(tt,"getIBLRadiance( geometryViewDir, geometryNormal, material.roughness )","getIBLRadiance( geometryViewDir, anisotropyBentNormal, material.roughness )"),h.fragmentShader=shaderReplaceString(h.fragmentShader,"#include <lights_fragment_maps>",tt),h.vertexShader=shaderReplaceString(h.vertexShader,"#include <uv_pars_vertex>",`
#if defined(ANISOTROPY_ENABLED) && ANISOTROPY_ENABLED > 0
    varying vec2 vAnisotropy2MapUv;
    uniform mat3 anisotropy2MapUvTransform;
#endif
                `,{prepend:!0}),h.vertexShader=shaderReplaceString(h.vertexShader,"#include <uv_vertex>",`
#if defined(ANISOTROPY_ENABLED) && ANISOTROPY_ENABLED > 0
    vAnisotropy2MapUv = ( anisotropy2MapUvTransform * vec3( uv, 1 ) ).xy;
#endif
                `,{prepend:!0}),h.defines.USE_ANISOTROPY_BRDF="",h.defines.USE_UV="",h.vertexTangents=!0},onObjectRender:(h,o)=>{var c;const d=o.materialObject.userData;if(!(d!=null&&d._isAnisotropic))return;const _=h;if(!_.isMesh||!_.geometry)return;_.geometry.attributes.tangent?_.geometry.userData.__forceUseTangent=!0:console.error("WebGi AnisotropyPlugin - No tangents on the geometry, cannot use anisotropy. Make sure the tangents are computed before rendering the model. The model will render as black.",_),this._uniforms.anisotropyFactor.value=d._anisotropyFactor,this._uniforms.anisotropyNoise.value=d._anisotropyNoise,this._uniforms.anisotropyDirection.value=d._anisotropyDirection;const v=!((c=d._anisotropyDirectionMap)===null||c===void 0)&&c.isTexture?d._anisotropyDirectionMap:null;this._uniforms.anisotropyDirectionMap.value=v,v&&(v.updateMatrix(),this._uniforms.anisotropy2MapUvTransform.value.copy(v.matrix));let b=this.enabled?1:0;o.materialObject.defines.ANISOTROPY_ENABLED!==b&&(o.materialObject.defines.ANISOTROPY_ENABLED=b,o.materialObject.needsUpdate=!0),b=+this._defines.ANISOTROPY_DEBUG,o.materialObject.defines.ANISOTROPY_DEBUG!==b&&(o.materialObject.defines.ANISOTROPY_DEBUG=b,o.materialObject.needsUpdate=!0),b=d._anisotropyDirectionMode,this._uniforms.anisotropyDirectionMap.value||(b="CONSTANT"),b=b==="DIRECTION"?2:b==="ROTATION"?1:0,o.materialObject.defines.ANISOTROPY_TEX_MODE!==b&&(o.materialObject.defines.ANISOTROPY_TEX_MODE=b,o.materialObject.needsUpdate=!0)},extraUniforms:{...this._uniforms},computeCacheKey:h=>{var o,c,d;return(this.enabled?"1":"0")+(!((o=h.materialObject.userData)===null||o===void 0)&&o._isAnisotropic?"1":"0")+((d=(c=h.materialObject.userData)===null||c===void 0?void 0:c._anisotropyDirectionMap)===null||d===void 0?void 0:d.uuid)},isCompatible:h=>h.isMeshStandardMaterial2,updaters:()=>{var h;return[(h=this._viewer)===null||h===void 0?void 0:h.renderer]},getUiConfig:h=>{const o=this._viewer,c=this.makeAnisotropic,d={type:"folder",label:"Anisotropy",children:[{type:"checkbox",label:"Enabled",get value(){return h.materialObject.userData._isAnisotropic||!1},set value(_){var v;_!==h.materialObject.userData._isAnisotropic&&(_?c(h)||o.alert("One or more geometries cannot be made anisotropic."):(h.materialObject.userData._isAnisotropic=!1,h.materialObject.needsUpdate=!0),(v=d.uiRefresh)===null||v===void 0||v.call(d,"postFrame",!0))},onChange:this.setDirty},{type:"slider",label:"Factor",bounds:[-2,2],hidden:()=>!h.materialObject.userData._isAnisotropic,property:[h.materialObject.userData,"_anisotropyFactor"],onChange:this.setDirty},{type:"slider",label:"Noise",bounds:[0,2],hidden:()=>!h.materialObject.userData._isAnisotropic,property:[h.materialObject.userData,"_anisotropyNoise"],onChange:this.setDirty},{type:"image",label:"Texture",hidden:()=>!h.materialObject.userData._isAnisotropic,property:[h.materialObject.userData,"_anisotropyDirectionMap"],onChange:()=>{h.materialObject.needsUpdate=!0,this.setDirty()}},makeSamplerUi(h.materialObject.userData,"_anisotropyDirectionMap","Sampler",()=>!h.materialObject.userData._isAnisotropic||h.materialObject.userData._anisotropyDirectionMode==="CONSTANT",()=>h.setDirty&&h.setDirty()),{type:"dropdown",label:"Mode",hidden:()=>!h.materialObject.userData._isAnisotropic,property:[h.materialObject.userData,"_anisotropyDirectionMode"],children:["CONSTANT","ROTATION","DIRECTION"].map(_=>({label:_})),onChange:()=>{h.materialObject.needsUpdate=!0,this.setDirty()}}]};return d},onMaterialUpdate:h=>{var o,c;!((o=h.userData)===null||o===void 0)&&o._isAnisotropic&&((c=h.userData.__appliedMeshes)===null||c===void 0||c.forEach(d=>this.tryComputeTangents(d,[h])))},onRegister:h=>{var o,c;!((o=h.userData)===null||o===void 0)&&o._isAnisotropic&&((c=h.userData.__appliedMeshes)===null||c===void 0||c.forEach(d=>this.tryComputeTangents(d,[h])))},onAddToMesh:h=>{const o=h,c=Array.isArray(o.material)?o.material:[o.material];c.find(d=>{var _;return(_=d==null?void 0:d.userData)===null||_===void 0?void 0:_._isAnisotropic})&&this.tryComputeTangents(o,c)}},this.setDirty=()=>{var h,o,c;(o=(h=this.materialExtension).setDirty)===null||o===void 0||o.call(h),(c=this._viewer)===null||c===void 0||c.setDirty()},this.makeSelectedAnisotropic=()=>{var h,o,c;const d=(c=(o=(h=this._viewer)===null||h===void 0?void 0:h.getPlugin(PickingPlugin))===null||o===void 0?void 0:o.getSelectedObject())===null||c===void 0?void 0:c.material;return(d==null?void 0:d.assetType)==="material"&&this.makeAnisotropic(d)},this._loaderCreate=this._loaderCreate.bind(this)}async onAdded(h){var o,c,d,_,v;await super.onAdded(h);const b=h.getPlugin(AssetManagerPlugin);(o=b==null?void 0:b.materials)===null||o===void 0||o.registerMaterialExtension(this.materialExtension),(c=b==null?void 0:b.importer)===null||c===void 0||c.addEventListener("loaderCreate",this._loaderCreate),(v=(_=(d=b==null?void 0:b.exporter)===null||d===void 0?void 0:d.getExporter("gltf","glb"))===null||_===void 0?void 0:_.extensions)===null||v===void 0||v.push(glTFMaterialsAnisotropyExtensionExport)}async onRemove(h){var o,c,d,_;return(c=(o=h.getPlugin(AssetManagerPlugin))===null||o===void 0?void 0:o.materials)===null||c===void 0||c.unregisterMaterialExtension(this.materialExtension),(_=(d=h.getPlugin(AssetManagerPlugin))===null||d===void 0?void 0:d.importer)===null||_===void 0||_.removeEventListener("loaderCreate",this._loaderCreate),super.onRemove(h)}};AnisotropyPlugin.PluginType="AnisotropyPlugin",AnisotropyPlugin.ANISOTROPY_GLTF_EXTENSION="WEBGI_materials_anisotropy",AnisotropyPlugin_decorate([uiToggle("Enabled",h=>({onChange:h.setDirty})),serialize()],AnisotropyPlugin.prototype,"enabled",void 0),AnisotropyPlugin_decorate([uiButton("Make Anisotropy",h=>({hidden:()=>{var o;return!(!((o=h._viewer)===null||o===void 0)&&o.getPlugin(PickingPlugin))}}))],AnisotropyPlugin.prototype,"makeSelectedAnisotropic",void 0),AnisotropyPlugin=AnisotropyPlugin_decorate([uiFolder("Anisotropy Materials")],AnisotropyPlugin);class GLTFMaterialsAnisotropyExtensionImport{constructor(o){this.parser=o,this.name=AnisotropyPlugin.ANISOTROPY_GLTF_EXTENSION}async extendMaterialParams(o,c){var d,_,v;const b=this.parser,tt=b.json.materials[o];if(!tt.extensions||!tt.extensions[this.name])return Promise.resolve();const it=[],nt=tt.extensions[this.name];c.userData||(c.userData={}),c.userData._isAnisotropic=!0,c.userData._anisotropyFactor=(d=nt.anisotropyFactor)!==null&&d!==void 0?d:0,c.userData._anisotropyNoise=(v=(_=nt.anisotropyNoiseFactor)!==null&&_!==void 0?_:nt.anisotropyNoise)!==null&&v!==void 0?v:0;let{anisotropyDirectionMode:lt,anisotropyDirection:ut}=nt;return lt||(lt=nt.anisotropyTextureMode),ut||(ut=nt.anisotropyRotation),c.userData._anisotropyDirectionMode=lt&&typeof(ut==null?void 0:ut.index)=="number"?lt:"CONSTANT",lt==="ROTATION"||lt==="DIRECTION"?it.push(b.assignTexture(c.userData,"_anisotropyDirectionMap",ut).then(ht=>{ht.colorSpace=three_module.er$})):c.userData._anisotropyDirection=ut??0,Promise.all(it)}afterRoot(o){var c;return(c=o.scene)===null||c===void 0||c.traverse(d=>{var _,v;if(!(!((v=(_=d.material)===null||_===void 0?void 0:_.userData)===null||v===void 0)&&v._isAnisotropic))return;const b=d.geometry;b.attributes.tangent||(b.computeTangents(),b.attributes.tangent.needsUpdate=!0)}),null}}const glTFMaterialsAnisotropyExtensionExport=h=>({writeMaterial:(o,c)=>{if(!o.isMeshStandardMaterial||!o.userData._isAnisotropic||(o.userData._anisotropyFactor||0)<.001)return;c.extensions=c.extensions||{};const d={};if(d.anisotropyFactor=o.userData._anisotropyFactor||1,d.anisotropyNoiseFactor=o.userData._anisotropyNoise||0,d.anisotropyDirectionMode=o.userData._anisotropyDirectionMode||"CONSTANT",h.checkEmptyMap(o.userData._anisotropyDirectionMap)&&d.anisotropyDirectionMode!=="CONSTANT"){const _={index:h.processTexture(o.userData._anisotropyDirectionMap)};h.applyTextureTransform(_,o.userData._anisotropyDirectionMap),d.anisotropyDirection=_}else d.anisotropyDirectionMode="CONSTANT",d.anisotropyDirection=o.userData._anisotropyDirection||0;c.extensions[AnisotropyPlugin.ANISOTROPY_GLTF_EXTENSION]=d,h.extensionsUsed[AnisotropyPlugin.ANISOTROPY_GLTF_EXTENSION]=!0}});var FragmentClippingExtensionPlugin_decorate=function(h,o,c,d){var _,v=arguments.length,b=v<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(h,o,c,d);else for(var tt=h.length-1;tt>=0;tt--)(_=h[tt])&&(b=(v<3?_(b):v>3?_(o,c,b):_(o,c))||b);return v>3&&b&&Object.defineProperty(o,c,b),b},FragmentClippingExtensionPlugin_1;let FragmentClippingExtensionPlugin=FragmentClippingExtensionPlugin_1=class extends AViewerPlugin{static AddFragmentClipping(h,o,c,d,_){var v,b,tt;const it=(v=h.materialObject)===null||v===void 0?void 0:v.userData;if(!it)return!1;it._fragmentClippingExt||(it._fragmentClippingExt={});const nt=it._fragmentClippingExt;return nt.clipEnabled=!0,nt.clipPosition===void 0&&(nt.clipPosition=(b=o==null?void 0:o.toArray())!==null&&b!==void 0?b:[0,0,0,0]),nt.clipParams===void 0&&(nt.clipParams=(tt=c==null?void 0:c.toArray())!==null&&tt!==void 0?tt:[1,0,0,0]),nt.clipMode===void 0&&(nt.clipMode=d??FragmentClippingMode.Circle),nt.clipInvert===void 0&&(nt.clipInvert=_!=null&&_),h.materialObject.isMaterial&&(h.needsUpdate=!0),!0}_loaderCreate({loader:h}){h.isGLTFLoader2&&h.register(o=>new GLTFMaterialsFragmentClippingExtensionImport(o))}constructor(){super(),this.enabled=!0,this.dependencies=[AssetManagerPlugin,GBufferPlugin],this._plane=new three_module.Zcv,this._viewNormalMatrix=new three_module.dwI,this._defines={FRAG_CLIPPING_DEBUG:!1},this._uniforms={fragClippingPosition:{value:new three_module.IUQ},fragClippingParams:{value:new three_module.IUQ},fragClippingCamAspect:{value:1}},this.materialExtension={parsFragmentSnippet:(h,o)=>{var c;return this.enabled&&!((c=o==null?void 0:o.materialObject.userData._fragmentClippingExt)===null||c===void 0)&&c.clipEnabled?simpleCameraHelpers+fe$1`
uniform vec4 fragClippingPosition;
uniform vec4 fragClippingParams;
uniform float fragClippingCamAspect;
#if FRAG_CLIPPING_MODE == ${FragmentClippingMode.Circle}
float fragClippingCircle(){
    vec2 pos = viewToScreen(vViewPosition.xyz).xy;
    float radius = fragClippingParams.x;
    vec2 center = fragClippingPosition.xy;
    pos.y /= fragClippingCamAspect;
    center.y /= fragClippingCamAspect;
    return length(pos - center) - radius;
}
#elif FRAG_CLIPPING_MODE == ${FragmentClippingMode.Ellipse}
float fragClippingEllipse(){
    vec2 pos = viewToScreen(vViewPosition.xyz).xy;
    vec2 radius = fragClippingParams.xy;
    vec2 center = fragClippingPosition.xy;
    pos.y /= fragClippingCamAspect;
    center.y /= fragClippingCamAspect;
    return length((pos - center) / radius) - 1.0;
}
#elif FRAG_CLIPPING_MODE == ${FragmentClippingMode.Rectangle}
float fragClippingRectangle(){
    vec2 pos = viewToScreen(vViewPosition.xyz).xy;
    vec2 radius = fragClippingParams.xy;
    vec2 center = fragClippingPosition.xy;
    pos.y /= fragClippingCamAspect;
    center.y /= fragClippingCamAspect;
    vec2 d = abs(pos - center) - radius;
    return min(max(d.x,d.y),0.0) + length(max(d,0.0));
}
#elif FRAG_CLIPPING_MODE == ${FragmentClippingMode.Plane}
float fragClippingPlane(){
    vec3 pos = vViewPosition.xyz;
    vec3 normal = fragClippingParams.xyz;
    float d = dot(pos, normal) - fragClippingParams.w;
    return d;
}
#elif FRAG_CLIPPING_MODE == ${FragmentClippingMode.Sphere}
float fragClippingSphere(){
    vec3 pos = vViewPosition.xyz;
    vec3 center = fragClippingPosition.xyz;
    float radius = fragClippingParams.x;
    pos.y /= fragClippingCamAspect;
    center.y /= fragClippingCamAspect;
    return length(pos - center) - radius;
}
#endif
        `:""},shaderExtender:(h,o,c)=>{var d;this.enabled&&!((d=o.materialObject.userData._fragmentClippingExt)===null||d===void 0)&&d.clipEnabled&&(h.fragmentShader=shaderReplaceString(h.fragmentShader,"#glMarker mainStart",fe$1`
    float fragClippingDist = 0.0;
    #if FRAG_CLIPPING_MODE == ${FragmentClippingMode.Circle}
    fragClippingDist = fragClippingCircle();
    #elif FRAG_CLIPPING_MODE == ${FragmentClippingMode.Ellipse}
    fragClippingDist = fragClippingEllipse();
    #elif FRAG_CLIPPING_MODE == ${FragmentClippingMode.Rectangle}
    fragClippingDist = fragClippingRectangle();
    #elif FRAG_CLIPPING_MODE == ${FragmentClippingMode.Plane}
    fragClippingDist = fragClippingPlane();
    #elif FRAG_CLIPPING_MODE == ${FragmentClippingMode.Sphere}
    fragClippingDist = fragClippingSphere();
    #endif
    #if FRAG_CLIPPING_DEBUG
    gl_FragColor = vec4(max(fragClippingDist, 0.0), 0.0, 0.0, 1.0); 
//    gl_FragColor = vec4(vViewPosition.xyz, 1.0);
    #include <colorspace_fragment>
    return;
    #endif
    
    #if FRAG_CLIPPING_INVERSE == 1
    if (fragClippingDist > 0.0) discard;
    #else
    if (fragClippingDist < 0.0) discard;
    #endif
            `,{append:!0}))},onObjectRender:(h,o)=>{var c,d,_,v,b,tt;let it=(c=o.materialObject.userData)===null||c===void 0?void 0:c._fragmentClippingExt;if(o.materialObject.userData.isGBufferMaterial&&h&&(it=(_=(d=h.material)===null||d===void 0?void 0:d.userData)===null||_===void 0?void 0:_._fragmentClippingExt),!(it!=null&&it.clipEnabled))return;if(this._uniforms.fragClippingPosition.value.fromArray(it.clipPosition),it.clipMode===FragmentClippingMode.Plane){const lt=(v=this._viewer)===null||v===void 0?void 0:v.scene.activeCamera.cameraObject.matrixWorldInverse;this._plane.normal.set(it.clipParams[0],it.clipParams[1],it.clipParams[2]),this._plane.constant=it.clipParams[3],this._viewNormalMatrix.getNormalMatrix(lt),this._plane.applyMatrix4(lt,this._viewNormalMatrix),this._uniforms.fragClippingParams.value.set(this._plane.normal.x,this._plane.normal.y,this._plane.normal.z,this._plane.constant)}else this._uniforms.fragClippingParams.value.fromArray(it.clipParams);((b=this._viewer)===null||b===void 0?void 0:b.scene.activeCamera.cameraObject)instanceof three_module.ubm?this._uniforms.fragClippingCamAspect.value=(tt=this._viewer)===null||tt===void 0?void 0:tt.scene.activeCamera.cameraObject.aspect:this._uniforms.fragClippingCamAspect.value=1;let nt=this.enabled?1:0;nt=+this._defines.FRAG_CLIPPING_DEBUG,o.materialObject.defines.FRAG_CLIPPING_DEBUG!==nt&&(o.materialObject.defines.FRAG_CLIPPING_DEBUG=nt,o.materialObject.needsUpdate=!0),nt=+it.clipMode,o.materialObject.defines.FRAG_CLIPPING_MODE!==nt&&(o.materialObject.defines.FRAG_CLIPPING_MODE=nt,o.materialObject.needsUpdate=!0),nt=+it.clipInvert,o.materialObject.defines.FRAG_CLIPPING_INVERSE!==nt&&(o.materialObject.defines.FRAG_CLIPPING_INVERSE=nt,o.materialObject.needsUpdate=!0)},extraUniforms:{...this._uniforms},computeCacheKey:h=>{var o,c;return(this.enabled?"1":"0")+(!((c=(o=h.materialObject.userData)===null||o===void 0?void 0:o._fragmentClippingExt)===null||c===void 0)&&c.clipEnabled?"1":"0")},isCompatible:h=>h.isMeshStandardMaterial2||h.userData.isGBufferMaterial,updaters:()=>[],getUiConfig:h=>{const o=this._viewer,c={type:"folder",label:"FragmentClipping",children:[{type:"checkbox",label:"Enabled",getValue:()=>{var d;return((d=h.materialObject.userData._fragmentClippingExt)===null||d===void 0?void 0:d.clipEnabled)||!1},setValue:d=>{var _,v;d!==((_=h.materialObject.userData._fragmentClippingExt)===null||_===void 0?void 0:_.clipEnabled)&&(d?FragmentClippingExtensionPlugin_1.AddFragmentClipping(h.materialObject)||o.alert("Cannot add fragment clipping extension."):h.materialObject.userData._fragmentClippingExt&&(h.materialObject.userData._fragmentClippingExt.clipEnabled=!1,h.materialObject.needsUpdate=!0),(v=c.uiRefresh)===null||v===void 0||v.call(c,"postFrame",!0))},onChange:this.setDirty},()=>({type:"dropdown",label:"Mode",children:Object.entries(FragmentClippingMode).map(d=>({label:d[0],value:d[1]})),hidden:()=>{var d;return!(!((d=h.materialObject.userData._fragmentClippingExt)===null||d===void 0)&&d.clipEnabled)},property:[h.materialObject.userData._fragmentClippingExt,"clipMode"],onChange:this.setDirty}),()=>({type:"vec4",label:"Position",hidden:()=>{var d;return!(!((d=h.materialObject.userData._fragmentClippingExt)===null||d===void 0)&&d.clipEnabled)},property:[h.materialObject.userData._fragmentClippingExt,"clipPosition"],onChange:this.setDirty}),()=>({type:"vec4",label:"Params",hidden:()=>{var d;return!(!((d=h.materialObject.userData._fragmentClippingExt)===null||d===void 0)&&d.clipEnabled)},property:[h.materialObject.userData._fragmentClippingExt,"clipParams"],onChange:this.setDirty}),()=>({type:"toggle",label:"Invert",hidden:()=>{var d;return!(!((d=h.materialObject.userData._fragmentClippingExt)===null||d===void 0)&&d.clipEnabled)},property:[h.materialObject.userData._fragmentClippingExt,"clipInvert"],onChange:this.setDirty})]};return c}},this.setDirty=()=>{var h,o,c;(o=(h=this.materialExtension).setDirty)===null||o===void 0||o.call(h),(c=this._viewer)===null||c===void 0||c.setDirty()},this._loaderCreate=this._loaderCreate.bind(this)}async onAdded(h){var o,c,d,_,v,b,tt;await super.onAdded(h);const it=h.getPlugin(AssetManagerPlugin);(o=it==null?void 0:it.materials)===null||o===void 0||o.registerMaterialExtension(this.materialExtension),(c=it==null?void 0:it.importer)===null||c===void 0||c.addEventListener("loaderCreate",this._loaderCreate),(v=(_=(d=it==null?void 0:it.exporter)===null||d===void 0?void 0:d.getExporter("gltf","glb"))===null||_===void 0?void 0:_.extensions)===null||v===void 0||v.push(glTFMaterialsFragmentClippingExtensionExport),(tt=(b=h.getPlugin(GBufferPlugin))===null||b===void 0?void 0:b.material)===null||tt===void 0||tt.registerMaterialExtensions([this.materialExtension])}async onRemove(h){var o,c,d,_;return(c=(o=h.getPlugin(AssetManagerPlugin))===null||o===void 0?void 0:o.materials)===null||c===void 0||c.unregisterMaterialExtension(this.materialExtension),(_=(d=h.getPlugin(AssetManagerPlugin))===null||d===void 0?void 0:d.importer)===null||_===void 0||_.removeEventListener("loaderCreate",this._loaderCreate),super.onRemove(h)}};var FragmentClippingMode;FragmentClippingExtensionPlugin.PluginType="FragmentClippingExtensionPlugin1",FragmentClippingExtensionPlugin.FRAGMENT_CLIPPING_EXTENSION_GLTF_EXTENSION="WEBGI_materials_fragment_clipping_extension",FragmentClippingExtensionPlugin_decorate([uiToggle("Enabled",h=>({onChange:h.setDirty})),serialize()],FragmentClippingExtensionPlugin.prototype,"enabled",void 0),FragmentClippingExtensionPlugin=FragmentClippingExtensionPlugin_1=FragmentClippingExtensionPlugin_decorate([uiFolder("FragmentClipping Materials")],FragmentClippingExtensionPlugin),function(h){h[h.Circle=0]="Circle",h[h.Ellipse=1]="Ellipse",h[h.Rectangle=2]="Rectangle",h[h.Plane=3]="Plane",h[h.Sphere=4]="Sphere"}(FragmentClippingMode||(FragmentClippingMode={}));class GLTFMaterialsFragmentClippingExtensionImport{constructor(o){this.parser=o,this.name=FragmentClippingExtensionPlugin.FRAGMENT_CLIPPING_EXTENSION_GLTF_EXTENSION}async extendMaterialParams(o,c){const d=this.parser.json.materials[o];if(!d.extensions||!d.extensions[this.name])return Promise.resolve();const _=d.extensions[this.name];return c.userData||(c.userData={}),FragmentClippingExtensionPlugin.AddFragmentClipping(c),c.userData._fragmentClippingExt=deserializeObject(_,c.userData._fragmentClippingExt,!1,{}),Promise.resolve()}}const glTFMaterialsFragmentClippingExtensionExport=h=>({writeMaterial:(o,c)=>{if(!o.isMeshStandardMaterial||!o.userData._fragmentClippingExt||!o.userData._fragmentClippingExt.clipEnabled)return;c.extensions=c.extensions||{};const d=serializeObject(o.userData._fragmentClippingExt,!1);c.extensions[FragmentClippingExtensionPlugin.FRAGMENT_CLIPPING_EXTENSION_GLTF_EXTENSION]=d,h.extensionsUsed[FragmentClippingExtensionPlugin.FRAGMENT_CLIPPING_EXTENSION_GLTF_EXTENSION]=!0}});var hdriGroundProj=`#ifdef HDRi_GROUND_PROJ
float intersectPlane1(const in vec3 r0,const in vec3 rd,const in vec3 n,const in vec3 p0){float t=dot(p0-r0,n)/(dot(n,rd)+1e-6);return t<0.?1000.:t;}float intersectSphere1(in vec3 ro,in vec3 rd,in vec3 sph,in float rad){vec3 oc=ro-sph;float b=dot(oc,rd);float c=dot(oc,oc)-rad*rad;float t=b*b-c;return t<0.?t:-b+sqrt(t);}
#define PI_HALF  1.5707963267948966
uniform float worldRadius;uniform float tripodHeight;uniform vec3 originPosition;vec3 hdriProject(){vec3 p=normalize(vWorldDirection);vec3 camPos=cameraPosition;camPos.y-=tripodHeight;float t=intersectSphere1(camPos,p,originPosition,worldRadius);if(t>0.){float t2=intersectPlane1(camPos,p,vec3(0,-1,0),originPosition+vec3(0.,-tripodHeight,0.));p=(camPos+min(t,t2)*p)/worldRadius;}else p=vec3(0.,1.,0.);return p;}
#endif
`,HDRiGroundPlugin_decorate=function(h,o,c,d){var _,v=arguments.length,b=v<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(h,o,c,d);else for(var tt=h.length-1;tt>=0;tt--)(_=h[tt])&&(b=(v<3?_(b):v>3?_(o,c,b):_(o,c))||b);return v>3&&b&&Object.defineProperty(o,c,b),b};let HDRiGroundPlugin=class extends AViewerPlugin{constructor(h=!1){super(),this.enabled=!1,this.worldRadius=100,this.tripodHeight=10,this.originPosition=new three_module.Pq0(0,0,0),this._paramsChanged=this._paramsChanged.bind(this),this.enabled=h,this.addEventListener("deserialize",this._paramsChanged)}_paramsChanged(){var h,o,c,d;if(!this._viewer)return;const _=this._viewer.scene.background;if(this.enabled&&_!==this._viewer.scene.environment&&_!=="environment")if(_&&_.isDataTexture)_.mapping=three_module.wfO;else if(confirm("Background must be same as environment, do you want to change it?")){const tt=this._viewer.getPluginByType("SimpleBackgroundEnvUiPlugin1");tt?(tt.envmapBg=!0,(o=(h=tt.uiConfig).uiRefresh)===null||o===void 0||o.call(h,"postFrame",!0)):this._viewer.scene.setBackground("environment")}else this.enabled=!1;const v=(c=this._viewer.renderer.rendererObject.background.getBoxMesh2())===null||c===void 0?void 0:c.material,b=(d=v==null?void 0:v.uniforms)!==null&&d!==void 0?d:three_module.zkh.backgroundCube.uniforms;b.tripodHeight||(b.tripodHeight={value:1}),b.worldRadius||(b.worldRadius={value:1}),b.originPosition||(b.originPosition={value:new three_module.Pq0}),b.tripodHeight.value=this.tripodHeight,b.worldRadius.value=this.worldRadius,b.originPosition.value.copy(this.originPosition),v&&(!this.enabled&&v.defines.HDRi_GROUND_PROJ?delete v.defines.HDRi_GROUND_PROJ:this.enabled&&(v.defines.HDRi_GROUND_PROJ="1"),v.needsUpdate=!0),this._viewer.setDirty()}async onAdded(h){var o,c,d;await super.onAdded(h),!((d=(c=(o=this._viewer)===null||o===void 0?void 0:o.renderer)===null||c===void 0?void 0:c.rendererObject)===null||d===void 0)&&d.background.getBoxMesh()&&h.console.error("HDRi Ground Plugin must be added before setting any cube or env map"),three_module.zkh.backgroundCube.fragmentShader.includes("#ifdef HDRi_GROUND_PROJ")||(three_module.zkh.backgroundCube.fragmentShader=shaderReplaceString(three_module.zkh.backgroundCube.fragmentShader,"void main() {",hdriGroundProj,{prepend:!0}),three_module.zkh.backgroundCube.fragmentShader=shaderReplaceString(three_module.zkh.backgroundCube.fragmentShader,"vec3 vReflect = vWorldDirection;",`
vec3 vReflect = 
#ifdef HDRi_GROUND_PROJ
hdriProject()
#else
vWorldDirection
#endif
;
`)),h.scene.addEventListener("environmentChanged",this._paramsChanged)}};HDRiGroundPlugin.PluginType="HDRiGroundPlugin",HDRiGroundPlugin_decorate([serialize(),x$1(HDRiGroundPlugin.prototype._paramsChanged),uiToggle("Enabled")],HDRiGroundPlugin.prototype,"enabled",void 0),HDRiGroundPlugin_decorate([serialize(),x$1(HDRiGroundPlugin.prototype._paramsChanged),uiSlider("World Radius",[1,1e3],.01)],HDRiGroundPlugin.prototype,"worldRadius",void 0),HDRiGroundPlugin_decorate([serialize(),x$1(HDRiGroundPlugin.prototype._paramsChanged),uiSlider("Tripod height",[0,50],.01)],HDRiGroundPlugin.prototype,"tripodHeight",void 0),HDRiGroundPlugin_decorate([serialize(),x$1(HDRiGroundPlugin.prototype._paramsChanged),uiVector("Origin Position",void 0,.001,h=>({onChange:h._paramsChanged}))],HDRiGroundPlugin.prototype,"originPosition",void 0),HDRiGroundPlugin=HDRiGroundPlugin_decorate([uiFolder("HDRi Ground")],HDRiGroundPlugin);var SSContactShadows_decorate=function(h,o,c,d){var _,v=arguments.length,b=v<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(h,o,c,d);else for(var tt=h.length-1;tt>=0;tt--)(_=h[tt])&&(b=(v<3?_(b):v>3?_(o,c,b):_(o,c))||b);return v>3&&b&&Object.defineProperty(o,c,b),b},SSContactShadows_1;let SSContactShadows=SSContactShadows_1=class extends AViewerPlugin{constructor(h=!0){super(),this.enabled=!0,this.radius=.015,this.intensity=1,this.tolerance=1.5,this._defines={},this.onlySSCSDebug=!1,this.stepCount=2,this.dependencies=[GBufferPlugin,AssetManagerPlugin],this.materialExtension={shaderExtender:(o,c,d)=>{if(!o.defines.SSCS_ENABLED)return;const _=fe$1`
                #ifndef D_sceneBoundingRadius
                #define D_sceneBoundingRadius
                uniform float sceneBoundingRadius;
                #endif
                float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, vec3 lightDirection ) {
                    vec3 ray_origin_view = -vViewPosition;
                    float rnd = interleavedGradientNoise(gl_FragCoord.xy, frameCount+34.);
                    float cameraDist = length(cameraPositionWorld);
//                    float radius = mix((cameraNearFar.y) + ray_origin_view.z, -ray_origin_view.z - cameraNearFar.x, rnd * 0.5 + 0.5)*sscsRadius;
                    float radius = mix((cameraDist + sceneBoundingRadius) + ray_origin_view.z, -ray_origin_view.z - max(0.0, cameraDist - sceneBoundingRadius), rnd * 0.5 + 0.5)*sscsRadius;
                    vec3 state = vec3(1.,(rnd+0.5)/float(SSCS_STEP_COUNT),2.);
                    traceRay(ray_origin_view, normalize(lightDirection) * radius, sscsTolerance * radius * 2., state, SSCS_STEP_COUNT);
                    state.z = state.z > 0.99 ? 1. : max(0.,min(state.z * state.z * (1.-sscsIntensity), 1.));
                    
                #if defined(SSCS_DEBUG) && SSCS_DEBUG > 0
                    return state.z;
                #endif
            `,v=`
#if SSCS_ENABLED

    uniform float sscsIntensity;
    uniform float sscsRadius;
    uniform float sscsTolerance;

    ${basicHelpers}
    
    #define THREE_PACKING_INCLUDED
    ${cameraHelpers}
    
    ${unpackGbuffer}
    ${randomHelpers}
    
    ${ssrt}

#endif
            
            `+three_module.vxI.shadowmap_pars_fragment.replace("float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {",`${_}
`).replace("return shadow;","return min(shadow, state.z);");o.fragmentShader=o.fragmentShader.replace("#include <shadowmap_pars_fragment>",v),o.fragmentShader=o.fragmentShader.replace("#include <lights_fragment_begin>",three_module.vxI.lights_fragment_begin),o.fragmentShader=shaderReplaceString(o.fragmentShader,"directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;","directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ], directLight.direction ) : 1.0;"),o.fragmentShader=shaderReplaceString(o.fragmentShader,"directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;","directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ], directLight.direction ) : 1.0;")},onObjectRender:(o,c,d)=>{var _,v;const b=c.materialObject;let tt=!this.enabled||d.userData.screenSpaceRendering===!1||!((_=b.userData)===null||_===void 0)&&_.sscsDisabled||!((v=b.userData)===null||v===void 0)&&v.pluginsDisabled?0:1;b.defines.SSCS_ENABLED!==tt&&(b.defines.SSCS_ENABLED=tt,b.needsUpdate=!0),tt=this._defines.SSCS_STEP_COUNT,b.defines.SSCS_STEP_COUNT!==tt&&(b.defines.SSCS_STEP_COUNT=tt,b.needsUpdate=!0),tt=+this._defines.SSCS_DEBUG,b.defines.SSCS_DEBUG!==tt&&(b.defines.SSCS_DEBUG=tt,b.needsUpdate=!0)},parsFragmentSnippet:()=>`
`,extraUniforms:{...SSContactShadows_1._uniforms},computeCacheKey:o=>this.enabled?"1":"0",isCompatible:o=>o.isMeshStandardMaterial2,updaters:()=>{var o,c,d,_,v;return[(o=this._viewer)===null||o===void 0?void 0:o.getPlugin(GBufferPlugin),(c=this._viewer)===null||c===void 0?void 0:c.getPlugin(ProgressivePlugin),(d=this._viewer)===null||d===void 0?void 0:d.scene.renderCamera,(_=this._viewer)===null||_===void 0?void 0:_.renderer,(v=this._viewer)===null||v===void 0?void 0:v.scene]}},this.enabled=h,this.userData={setDirty:()=>{var o;(o=this._viewer)===null||o===void 0||o.setDirty()}}}async onAdded(h){var o,c;await super.onAdded(h),(c=(o=h.getPlugin(AssetManagerPlugin))===null||o===void 0?void 0:o.materials)===null||c===void 0||c.registerMaterialExtension(this.materialExtension)}async onRemove(h){var o,c;return(c=(o=h.getPlugin(AssetManagerPlugin))===null||o===void 0?void 0:o.materials)===null||c===void 0||c.unregisterMaterialExtension(this.materialExtension),super.onRemove(h)}};SSContactShadows.PluginType="SSContactShadows",SSContactShadows._uniforms={tNormalDepth:{value:null},frameCount:{value:0},projection:{value:new three_module.kn4},cameraPositionWorld:{value:new three_module.Pq0},cameraNearFar:{value:new three_module.I9Y(.1,1e3)},sceneBoundingRadius:{value:0}},SSContactShadows_decorate([uiToggle("Enabled"),serialize()],SSContactShadows.prototype,"enabled",void 0),SSContactShadows_decorate([uniform({uniforms:SSContactShadows._uniforms,propKey:"sscsRadius"}),uiSlider("Radius",[1e-4,.1],1e-4),serialize()],SSContactShadows.prototype,"radius",void 0),SSContactShadows_decorate([uniform({uniforms:SSContactShadows._uniforms,propKey:"sscsIntensity"}),uiSlider("Intensity",[1e-4,1],1e-4),serialize()],SSContactShadows.prototype,"intensity",void 0),SSContactShadows_decorate([uniform({uniforms:SSContactShadows._uniforms,propKey:"sscsTolerance"}),uiSlider("Tolerance",[.1,5]),serialize()],SSContactShadows.prototype,"tolerance",void 0),SSContactShadows_decorate([matDefine("SSCS_DEBUG",void 0,!0),uiToggle("Debug only SSCS"),serialize()],SSContactShadows.prototype,"onlySSCSDebug",void 0),SSContactShadows_decorate([matDefine("SSCS_STEP_COUNT",void 0,!0),uiSlider("Step count",[1,8],1),serialize()],SSContactShadows.prototype,"stepCount",void 0),SSContactShadows=SSContactShadows_1=SSContactShadows_decorate([uiFolder("Screen Space Contact Shadows")],SSContactShadows);var cubeNormalVert=`varying vec3 vNormal;varying vec3 vecPosition;uniform mat4 offsetMatrixInv;uniform vec3 offsetCenter;
#include <morphtarget_pars_vertex>
void main(){vNormal=normalize((offsetMatrixInv*vec4(normal,0.)).xyz);
#include <begin_vertex>
transformed-=offsetCenter;
#include <morphtarget_vertex>
vec4 offsetPos=offsetMatrixInv*vec4(transformed,1.);vecPosition=(modelMatrix*offsetPos).xyz;gl_Position=projectionMatrix*modelViewMatrix*offsetPos;}`,cubeNormalFrag="varying vec3 vNormal;varying vec3 vecPosition;uniform float radius;void main(){vec3 color=normalize(vNormal);color=color*0.5+0.5;gl_FragColor=vec4(color.x,color.y,color.z,length(vecPosition)/radius);}";class CubeNormalsCaptureHelper{constructor(o){this._normalsCache={},this._renderer=o,this._scene=new three_module.Z58,this._mesh=new three_module.eaF,this._mesh.frustumCulled=!1,this._scene.add(this._mesh),this._mesh.position.set(0,0,0),this._mesh.material=new NormalCaptureMaterial}dispose(){var o;(o=this._mesh.geometry)===null||o===void 0||o.dispose(),this._mesh.material.dispose(),this.disposeAllTargets()}disposeTarget(o){o.split(";").forEach(c=>{var d;return(d=this._normalsCache[c])===null||d===void 0?void 0:d.dispose()})}disposeAllTargets(){Object.values(this._normalsCache).forEach(o=>o.dispose()),this._normalsCache={}}hasCapturedNormalMap(o){return!!o.userData._normalsCaptureMap}_getPrecisionType(o){return o==="low"?three_module.OUM:o==="medium"?three_module.ix0:o==="high"?three_module.RQf:three_module.ix0}captureNormalMap(o,c,d=512,_="medium",v){if(!o)throw"No geometry";if(this.hasCapturedNormalMap(o))return!1;const b=c==null?void 0:c.split(";").find(nt=>this._normalsCache[nt]);if(b){const nt=this._normalsCache[b];return c==null||c.split(";").forEach(lt=>lt!==b&&(this._normalsCache[lt]=nt)),nt.width!==d&&console.warn("last cacheKey normalMapRes mismatch, check model",d),o.userData._normalsCaptureMap=nt,!1}const tt=this._renderer.createTargetCustom({width:d,height:d},{minFilter:three_module.hxR,magFilter:three_module.hxR,generateMipmaps:!1,type:this._getPrecisionType(_)},three_module.o6l);if(tt.attachedGeometries=[],tt.autoDispose=CubeNormalsCaptureHelper.AutoDisposeTargets,!tt)throw"Unable to create render target";const it=()=>{var nt;const lt=new three_module.F1T(1e-4,100,tt);this._scene.add(lt);const ut=o.userData.normalsCaptureOffsets;ut.center!==void 0&&this._mesh.material.uniforms.offsetCenter.value.fromArray(ut.center),ut.offsetMatrixInv!==void 0&&this._mesh.material.uniforms.offsetMatrixInv.value.fromArray(ut.offsetMatrixInv),ut.radius!==void 0&&(this._mesh.material.uniforms.radius.value=ut.radius),this._mesh.geometry=o,v!=null&&v.morphTargetInfluences&&!((nt=o.morphAttributes)===null||nt===void 0)&&nt.position&&(this._mesh.morphTargetInfluences=v.morphTargetInfluences,this._mesh.morphTargetDictionary=v.morphTargetDictionary);const ht=this._renderer.rendererObject.getClearColor(new three_module.Q1f),_t=this._renderer.rendererObject.getClearAlpha();this._renderer.rendererObject.setClearColor(new three_module.Q1f(0,0,0),1),lt.update(this._renderer.rendererObject,this._scene),this._renderer.rendererObject.setClearColor(ht,_t),this._mesh.morphTargetInfluences=void 0,this._mesh.morphTargetDictionary=void 0,this._scene.remove(lt),this._mesh.geometry=void 0,o.userData._normalsCaptureMap=tt};return it(),this._renderer.addEventListener("contextRestored",it),tt.attachedGeometries.push(o),o.addEventListener("dispose",()=>{var nt,lt;tt.attachedGeometries=(lt=(nt=tt.attachedGeometries)===null||nt===void 0?void 0:nt.filter(ut=>ut!==o))!==null&&lt!==void 0?lt:[],delete o.userData._normalsCaptureMap,this._renderer.removeEventListener("contextRestored",it),tt.autoDispose&&!tt.attachedGeometries.length&&tt.dispose()}),c==null||c.split(";").forEach(nt=>this._normalsCache[nt]=tt),tt.addEventListener("dispose",()=>{var nt;c==null||c.split(";").forEach(lt=>delete this._normalsCache[lt]),this._renderer.removeEventListener("contextRestored",it),(nt=tt.attachedGeometries)===null||nt===void 0||nt.forEach(lt=>delete lt.userData._normalsCaptureMap)}),!0}removeNormalMap(o){o.userData._normalsCaptureMap&&(o.userData._normalsCaptureMap.dispose(),delete o.userData._normalsCaptureMap)}}CubeNormalsCaptureHelper.AutoDisposeTargets=!0;class NormalCaptureMaterial extends three_module.BKk{constructor(){super({vertexShader:cubeNormalVert,fragmentShader:cubeNormalFrag,side:three_module.$EB,clipping:!1,uniforms:{radius:{value:1},offsetMatrixInv:{value:new three_module.kn4().identity()},offsetCenter:{value:new three_module.Pq0}}})}}var diamond_frag=`varying vec3 vWorldNormal;varying vec3 vWorldPosition;varying vec3 vViewPosition;varying vec3 vNormal;varying vec2 vUv;uniform float radius;uniform vec3 centerOffset;
#ifdef USE_INSTANCING
varying mat4 vModelInstanceOffsetMatrix;varying mat4 vModelInstanceOffsetMatrixInv;
#define MODEL_OFFSET_MATRIX  vModelInstanceOffsetMatrix
#define INV_MODEL_OFFSET_MATRIX  vModelInstanceOffsetMatrixInv
#else
uniform mat4 modelOffsetMatrixInv;uniform mat4 modelOffsetMatrix;
#define MODEL_OFFSET_MATRIX  modelOffsetMatrix
#define INV_MODEL_OFFSET_MATRIX  modelOffsetMatrixInv
#endif
#ifdef USE_MORPHTARGETS
varying vec3 vCenterOffset;
#define CENTER_OFFSET  (centerOffset + vCenterOffset)
#else
#define CENTER_OFFSET  (centerOffset) 
#endif
uniform mat4 projectionMatrix;uniform samplerCube tCubeMapNormals;
#if ENV_MAP_TYPE == 0
uniform samplerCube envMap;
#elif ENV_MAP_TYPE == 1
uniform sampler2D envMap;
#endif
uniform float envMapIntensity;uniform float transmission;uniform vec2 transmissionSamplerSize;uniform sampler2D transmissionSamplerMap;uniform float refractiveIndex;uniform float rIndexDelta;uniform float squashFactor;uniform float geometryFactor;uniform vec3 color;uniform vec3 colorCorrection;uniform vec3 boostFactors;uniform float gammaFactor;uniform float absorptionFactor;uniform float envMapRotation;uniform vec4 envMapRotationQuat;uniform float reflectivity;vec3 BRDF_Specular_GGX_Environment(const in vec3 viewDir,const in vec3 normal,const in vec3 specularColor,const in float roughness){float dotNV=abs(dot(normal,viewDir));const vec4 c0=vec4(-1,-0.0275,-0.572,0.022);const vec4 c1=vec4(1,0.0425,1.04,-0.04);vec4 r=roughness*c0+c1;float a004=min(r.x*r.x,exp2(-9.28*dotNV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec2 cartesianToPolar(vec3 n){vec2 uv;uv.x=atan(n.z,n.x)/(PI*2.)+0.5;uv.y=asin(n.y)/PI+0.5;return uv;}vec4 sampleEnvMap(vec3 direction){
#if !defined(USE_ENVMAP)
return vec4(direction,1);
#else
float cs=cos(envMapRotation);float sn=sin(envMapRotation);float temp=cs*direction.x+sn*direction.z;direction.z=-sn*direction.x+cs*direction.z;direction.x=temp;direction.x*=-1.;direction.y*=-1.;direction.z*=-1.;vec3 t=2.*cross(envMapRotationQuat.xyz,direction);direction+=envMapRotationQuat.w*t+cross(envMapRotationQuat.xyz,t);
#if ENV_MAP_TYPE == 0
return(textureCube(envMap,direction));
#elif ENV_MAP_TYPE == 1
return(texture2D(envMap,cartesianToPolar(direction)));
#endif
return vec4(1,0,1,1);
#endif
}vec4 SampleSpecularReflection(vec3 direction){
#if defined(FIX_ENV_DIRECTION)
direction=(viewMatrix*vec4(direction,0.)).xyz;
#endif
return envMapIntensity*(sampleEnvMap(direction));}vec4 SampleSpecularContribution(vec3 direction){
#if DIA_ORIENT_ENVMAP < 1
direction=mat3(MODEL_OFFSET_MATRIX)*direction;
#endif
#if defined(FIX_ENV_DIRECTION)
direction=(viewMatrix*vec4(direction,0.)).xyz;
#endif
direction=normalize(direction);direction.x*=-1.;direction.z*=-1.;return envMapIntensity*(sampleEnvMap(direction));}vec4 SampleSpecularContributionRef(vec3 origin,int i){vec4 ndcPos=projectionMatrix*viewMatrix*vec4(origin,1.);vec2 refractionCoords=ndcPos.xy/ndcPos.w;refractionCoords+=1.;refractionCoords/=2.;return transmissionSamplerMapTexelToLinear(texture2D(transmissionSamplerMap,refractionCoords));}vec3 intersectSphere(vec3 origin,vec3 direction){origin-=CENTER_OFFSET;direction.y/=squashFactor;float A=dot(direction,direction);float B=2.*dot(origin,direction);float C=dot(origin,origin)-radius*radius;float disc=B*B-4.*A*C;if(disc>0.){disc=sqrt(disc);float t1=(-B+disc)*geometryFactor/A;float t2=(-B-disc)*geometryFactor/A;float t=(t1>t2)?t1:t2;direction.y*=squashFactor;return vec3(origin+CENTER_OFFSET+direction*t);}return vec3(0.);}vec3 linePlaneIntersect(in vec3 pointOnLine,in vec3 lineDirection,in vec3 pointOnPlane,in vec3 planeNormal){return lineDirection*(dot(planeNormal,pointOnPlane-pointOnLine)/dot(planeNormal,lineDirection))+pointOnLine;}vec4 getNormalDistance(vec3 d){return textureCube(tCubeMapNormals,d);}vec3 getSurfaceNormal(vec4 surfaceInfos){vec3 surfaceNormal=surfaceInfos.rgb;surfaceNormal=surfaceNormal*2.-1.;return-normalize(surfaceNormal);}vec3 intersect(vec3 rayOrigin,vec3 rayDirection){vec3 sphereHitPoint=intersectSphere(rayOrigin,rayDirection);vec3 direction1=normalize(sphereHitPoint-CENTER_OFFSET);vec4 normalDistanceData1=getNormalDistance(direction1);float distance1=normalDistanceData1.a*radius;vec3 pointOnPlane1=CENTER_OFFSET+direction1*distance1;vec3 planeNormal1=getSurfaceNormal(normalDistanceData1);vec3 hitPoint1=linePlaneIntersect(rayOrigin,rayDirection,pointOnPlane1,planeNormal1);vec3 direction2=normalize(hitPoint1-CENTER_OFFSET);vec4 normalDistanceData2=getNormalDistance(direction2);float distance2=normalDistanceData2.a*radius;vec3 pointOnPlane2=CENTER_OFFSET+direction2*distance2;vec3 hitPoint=hitPoint1;vec3 planeNormal2=getSurfaceNormal(normalDistanceData2);hitPoint=linePlaneIntersect(rayOrigin,rayDirection,pointOnPlane2,planeNormal2);return hitPoint;}vec3 debugBounces(int count){vec3 color=vec3(1.,1.,1.);if(count==1)color=vec3(0.,1.,0.);else if(count==2)color=vec3(0.,0.,1.);else if(count==3)color=vec3(1.,1.,0.);else if(count==4)color=vec3(0.,1.,1.);else color=vec3(0.,1.,0.);if(count==0)color=vec3(1.,0.,0.);return color;}vec3 getRefractionColor(vec3 origin,vec3 direction,vec3 normal){vec3 outColor=vec3(0.);const float n1=1.;const float epsilon=1e-4;float f0=(2.4-n1)/(2.4+n1);f0*=f0;vec3 attenuationFactor=vec3(1.);vec3 newDirection=refract(direction,normal,n1/refractiveIndex);vec3 brdfRefracted=BRDF_Specular_GGX_Environment(newDirection,-normal,vec3(f0),0.);attenuationFactor*=(vec3(1.)-brdfRefracted);int count=0;mat4 invModelOffsetMatrix=INV_MODEL_OFFSET_MATRIX;newDirection=normalize((invModelOffsetMatrix*vec4(newDirection,0.)).xyz);origin=(invModelOffsetMatrix*vec4(origin,1.)).xyz;for(int i=0;i<RAY_BOUNCES;i++){vec3 intersectedPos=intersect(origin,newDirection);vec3 dist=intersectedPos-origin;vec3 d=normalize(intersectedPos-CENTER_OFFSET);vec3 mappedNormal=getNormalDistance(d).rgb;mappedNormal=2.*mappedNormal-1.;mappedNormal=-normalize(mappedNormal);float r=length(dist)/radius*absorptionFactor;attenuationFactor*=exp(-r*(1.-color));origin=intersectedPos;vec3 origin2=(MODEL_OFFSET_MATRIX*vec4(intersectedPos,1)).xyz;vec3 oldDir=newDirection;newDirection=refract(newDirection,mappedNormal,refractiveIndex/n1);if(dot(newDirection,newDirection)<epsilon){newDirection=reflect(oldDir,mappedNormal);if(i==RAY_BOUNCES-1){vec3 brdfReflected=BRDF_Specular_GGX_Environment(-oldDir,mappedNormal,vec3(f0),0.);vec3 d1=mat3(MODEL_OFFSET_MATRIX)*oldDir;d1=normalize(d1);float cosT=1.-dot(direction,d1);outColor+=((transmission>0.&&cosT<transmission)?SampleSpecularContributionRef(origin2+0.5*d1*cosT,i).rgb:SampleSpecularContribution(oldDir).rgb)*attenuationFactor*colorCorrection*boostFactors*(vec3(1.)-min(vec3(1.),brdfReflected));}}else{vec3 brdfRefracted=vec3(1.)-min(vec3(1.),BRDF_Specular_GGX_Environment(newDirection,-mappedNormal,vec3(f0),0.));vec3 d1=normalize(mat3(MODEL_OFFSET_MATRIX)*newDirection);float cosT=1.-dot(direction,d1);if(transmission>0.&&cosT<transmission){outColor+=SampleSpecularContributionRef(origin2+0.5*d1*cosT,i).rgb*brdfRefracted*attenuationFactor*colorCorrection*boostFactors;}else{vec3 dir0=newDirection;vec3 dir1=refract(oldDir,mappedNormal,(refractiveIndex+rIndexDelta)/n1);vec3 dir2=refract(oldDir,mappedNormal,(refractiveIndex-rIndexDelta)/n1);outColor+=vec3(SampleSpecularContribution(dir1).r,SampleSpecularContribution(dir0).g,SampleSpecularContribution(dir2).b)*brdfRefracted*attenuationFactor*colorCorrection*boostFactors;}newDirection=reflect(oldDir,mappedNormal);vec3 brdfReflected=BRDF_Specular_GGX_Environment(newDirection,mappedNormal,vec3(f0),0.);attenuationFactor*=brdfReflected*boostFactors;count++;}}return outColor;}void main(){vec3 normalizedNormal=normalize(vWorldNormal);vec3 viewVector=normalize(vWorldPosition-cameraPosition);const float n1=1.;const float epsilon=1e-4;float f0=(2.4-n1)/(2.4+n1);f0*=f0;vec3 attenuationFactor=vec3(1.);vec3 reflectedDirection=reflect(viewVector,normalizedNormal);vec3 brdfReflected=BRDF_Specular_GGX_Environment(reflectedDirection,normalizedNormal,vec3(f0),0.);vec3 reflectionColor=SampleSpecularReflection(reflectedDirection).rgb*brdfReflected*reflectivity*2.;vec3 refractionColor=getRefractionColor(vWorldPosition,viewVector,normalizedNormal);vec3 normal=normalize(vNormal);vec3 diffuseColor=vec3(1.);
#glMarker beforeAccumulation
gl_FragColor=vec4((refractionColor.rgb+reflectionColor.rgb)*diffuseColor,1.);gl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(gammaFactor));gl_FragColor.rgb=max(gl_FragColor.rgb,0.);
#include <colorspace_fragment>
}`,diamond_vert=`#ifndef USE_ENVMAP
#define USE_ENVMAP  
#endif
varying vec3 vWorldPosition;varying vec3 vWorldNormal;varying vec3 vViewPosition;varying vec3 vNormal;varying vec2 vUv;
#ifdef USE_INSTANCING
uniform mat4 inverseModelMatrix;uniform mat4 modelOffsetMatrix;varying mat4 vModelInstanceOffsetMatrix;varying mat4 vModelInstanceOffsetMatrixInv;
#endif
#include <morphtarget_pars_vertex>
#ifdef USE_MORPHTARGETS
varying vec3 vCenterOffset;
#ifndef USE_INSTANCING
uniform mat4 modelOffsetMatrixInv;
#endif
#endif
void main(){
#ifdef USE_INSTANCING
vWorldNormal=(modelMatrix*instanceMatrix*vec4(normal,0.)).xyz;
#else
vWorldNormal=(modelMatrix*vec4(normal,0.)).xyz;
#endif
#include <beginnormal_vertex>
#include <defaultnormal_vertex>
#include <normal_vertex>
#include <begin_vertex>
#ifdef USE_MORPHTARGETS
vCenterOffset=transformed;
#include <morphtarget_vertex>
vCenterOffset=transformed-vCenterOffset;
#ifndef USE_INSTANCING
vCenterOffset=(modelOffsetMatrixInv*modelMatrix*vec4(vCenterOffset,1.)).xyz;
#endif
#endif
#include <project_vertex>
vViewPosition=-mvPosition.xyz;vUv=uv;
#include <worldpos_vertex>
vWorldPosition=worldPosition.xyz;
#ifdef USE_INSTANCING
vModelInstanceOffsetMatrix=modelMatrix*instanceMatrix*inverseModelMatrix*modelOffsetMatrix;vModelInstanceOffsetMatrixInv=inverse(vModelInstanceOffsetMatrix);
#ifdef USE_MORPHTARGETS
vCenterOffset=(vModelInstanceOffsetMatrixInv*modelMatrix*vec4(vCenterOffset,1.)).xyz;
#endif
#endif
}`,pca=__webpackgi_require__(391);function computeOffsetMatrix(h){const o=new three_module.Pq0(0,0,0),c=new three_module.Pq0(0,0,0),d=new three_module.Pq0(0,0,0),_=new three_module.Pq0(0,0,0),v=h.getAttribute("position"),b=h.index;if(b)for(let ht=Math.max(0,h.drawRange.start),_t=Math.min(b.count,h.drawRange.start+h.drawRange.count)-1;ht<_t/3;ht+=3){const ft=b.getX(ht),bt=b.getX(ht+1),xt=b.getX(ht+2);c.set(v.getX(ft),v.getY(ft),v.getZ(ft)),d.set(v.getX(bt),v.getY(bt),v.getZ(bt)),_.set(v.getX(xt),v.getY(xt),v.getZ(xt)),d.sub(c),_.sub(c),_.cross(d),_.normalize(),o.add(_)}else for(let ht=0;ht<v.count;ht+=3)c.set(v.getX(ht),v.getY(ht),v.getZ(ht)),d.set(v.getX(ht+1),v.getY(ht+1),v.getZ(ht+1)),_.set(v.getX(ht+2),v.getY(ht+2),v.getZ(ht+2)),d.sub(c),_.sub(c),_.cross(d),_.normalize(),o.add(_);o.normalize();let tt=!1,it=0;for(;!tt;){const ht=it/3,_t=b?b.getX(ht):ht,ft=b?b.getX(ht+1):ht+1;c.set(v.getX(_t),v.getY(_t),v.getZ(_t)),d.set(v.getX(ft),v.getY(ft),v.getZ(ft)),c.sub(d),c.normalize();const bt=o.dot(c);Math.abs(bt-1)>.001&&c.length()>.5&&(tt=!0),it+=3}d.crossVectors(c,o),d.normalize(),c.crossVectors(o,d),c.normalize();const nt=new three_module.kn4;nt.elements[0]=c.x,nt.elements[1]=c.y,nt.elements[2]=c.z,nt.elements[3]=0,nt.elements[4]=o.x,nt.elements[5]=o.y,nt.elements[6]=o.z,nt.elements[7]=0,nt.elements[8]=d.x,nt.elements[9]=d.y,nt.elements[10]=d.z,nt.elements[11]=0,nt.elements[12]=0,nt.elements[13]=0,nt.elements[14]=0,nt.elements[15]=1,h.computeBoundingSphere();const lt=h.boundingSphere.radius,ut=new three_module.kn4().makeScale(lt,lt,lt);return nt.multiply(ut),nt}function SignedTetrahedronVolume(h,o,c){const d=new three_module.Pq0().copy(h),_=new three_module.Pq0().copy(o),v=new three_module.Pq0().copy(c);return d.dot(_.cross(v))/6}function TriangleArea(h,o,c){const d=new three_module.Pq0().copy(h),_=new three_module.Pq0().copy(o),v=new three_module.Pq0().copy(c);return _.sub(d),v.sub(d),v.cross(_),.5*v.length()}function computeCenterAndCOM(h,o){const c=new three_module.Pq0;for(let ut=0;ut<h.length;ut+=3)c.x+=h[ut],c.y+=h[ut+1],c.z+=h[ut+2];c.multiplyScalar(1/(h.length/3));const d=new three_module.Pq0,_=new three_module.Pq0,v=new three_module.Pq0,b=new three_module.Pq0,tt=new three_module.Pq0;let it=0,nt=0,lt=o.length;lt%3!=0&&(lt-=lt%3);for(let ut=0;ut<lt;ut+=3){d.set(o[ut][0],o[ut][1],o[ut][2]),_.set(o[ut+1][0],o[ut+1][1],o[ut+1][2]),v.set(o[ut+2][0],o[ut+2][1],o[ut+2][2]),tt.copy(d).add(_).add(v);const ht=TriangleArea(d,_,v);tt.multiplyScalar(ht/3),b.add(tt),it+=ht,nt+=SignedTetrahedronVolume(d,_,v)}return b.multiplyScalar(1/it),{center:c,com:b,volume:nt,area:it}}function computeEigenVectors(h){const o=h.getAttribute("position"),c=h.getAttribute("normal");if(o.count/3>1500)return console.warn("DiamondPlugin:: Too many faces. Mirror/Topology issues will not be fixed",o.count/3),computeOffsetMatrix(h);const d=new three_module.Pq0(0,0,0),_=new three_module.Pq0(0,0,0),v=new three_module.Pq0(0,0,0),b=h.index,tt=[];if(b)for(let St=Math.max(0,h.drawRange.start),wt=Math.min(b.count,h.drawRange.start+h.drawRange.count)-1;St<wt;St+=3){const Pt=b.getX(St),Rt=b.getX(St+1),kt=b.getX(St+2);d.set(o.getX(Pt),o.getY(Pt),o.getZ(Pt)),_.set(o.getX(Rt),o.getY(Rt),o.getZ(Rt)),v.set(o.getX(kt),o.getY(kt),o.getZ(kt)),tt.push(d.toArray(),_.toArray(),v.toArray())}else for(let St=0;St<o.count;St++)d.set(o.getX(St),o.getY(St),o.getZ(St)),tt.push(d.toArray());const it=computeCenterAndCOM(o.array,tt);if(it.volume<0){console.warn("DiamondPlugin:: Negative Volume, Fixing Normals");for(let St=0;St<c.count;St++)c.setX(St,-c.getX(St)),c.setY(St,-c.getY(St)),c.setZ(St,-c.getZ(St));c.needsUpdate=!0}const nt=[];for(let St=0;St<o.array.length;St+=3)nt.push([o.array[St],o.array[St+1],o.array[St+2]]);const lt=console.log;console.log=()=>{};const ut=(0,pca.getEigenVectors)(nt);console.log=lt;const ht=new three_module.kn4;ht.elements[0]=ut[0].vector[0],ht.elements[1]=ut[0].vector[1],ht.elements[2]=ut[0].vector[2],ht.elements[3]=0,ht.elements[4]=ut[1].vector[0],ht.elements[5]=ut[1].vector[1],ht.elements[6]=ut[1].vector[2],ht.elements[7]=0,ht.elements[8]=ut[2].vector[0],ht.elements[9]=ut[2].vector[1],ht.elements[10]=ut[2].vector[2],ht.elements[11]=0,ht.elements[12]=0,ht.elements[13]=0,ht.elements[14]=0,ht.elements[15]=1;const _t=new three_module.Pq0;_t.copy(it.com).sub(it.center),_t.normalize();const ft=new three_module.Pq0(ut[2].vector[0],ut[2].vector[1],ut[2].vector[2]);_t.dot(ft)<0&&(ht.elements[4]=-ut[1].vector[0],ht.elements[5]=-ut[1].vector[1],ht.elements[6]=-ut[1].vector[2],ht.elements[8]=-ut[2].vector[0],ht.elements[9]=-ut[2].vector[1],ht.elements[10]=-ut[2].vector[2]),h.computeBoundingSphere();const bt=h.boundingSphere.radius,xt=new three_module.kn4().makeScale(bt,bt,bt);return ht.multiply(xt),ht}const diamondMaterialPropList={...threeMaterialPropList,color:new three_module.Q1f(1,1,1),envMapIntensity:1,envMapRotation:0,dispersion:.012,squashFactor:.98,geometryFactor:.5,gammaFactor:2.2,absorptionFactor:1,reflectivity:.5,refractiveIndex:2.4,boostFactors:new three_module.Pq0(.892,.892,.98595025),wireframe:!1,envMapRotationOffset:0,wireframeLinewidth:0,skinning:!1,transmission:0,morphTargets:!1,morphNormals:!1,rayBounces:1,diamondOrientedEnvMap:0,envMapIndex:0};var diamondMaterial_decorate=function(h,o,c,d){var _,v=arguments.length,b=v<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(h,o,c,d);else for(var tt=h.length-1;tt>=0;tt--)(_=h[tt])&&(b=(v<3?_(b):v>3?_(o,c,b):_(o,c))||b);return v>3&&b&&Object.defineProperty(o,c,b),b};class DiamondMaterial extends three_module.BKk{get mmMaterial(){return this}get materialObject(){return this}onBeforeRender(o,c,d,_,v){var b,tt;super.onBeforeRender(o,c,d,_,v),this.envMapIntensity===void 0||this.userData.separateEnvMapIntensity||c.envMapIntensity===void 0||(this.userData.__envIntensity=this.envMapIntensity,this.envMapIntensity=c.envMapIntensity),this.envMap!==void 0&&c.fixedEnvMapDirection!==void 0&&(c.fixedEnvMapDirection?this.defines.FIX_ENV_DIRECTION||(this.defines.FIX_ENV_DIRECTION="1",this.needsUpdate=!0):this.defines.FIX_ENV_DIRECTION!==void 0&&(delete this.defines.FIX_ENV_DIRECTION,this.needsUpdate=!0)),this.uniforms.envMapRotation.value=(((b=this.envMap)===null||b===void 0?void 0:b.rotation)||0)+this.envMapRotationOffset,this.uniforms.envMapRotationQuat.value.setFromEuler(new three_module.O9p(this.envMapRotationOffsetX,this.envMapRotationOffsetY,this.envMapRotationOffsetZ)),this.extraUniformsToUpload.inverseModelMatrix.value.copy(v.matrixWorld).invert();const it=_.userData.normalsCaptureOffsets;it&&(this.extraUniformsToUpload.centerOffset.value.fromArray(it.centerOffset),this.extraUniformsToUpload.modelOffsetMatrix.value.fromArray(it.offsetMatrix).premultiply(v.matrixWorld),this.extraUniformsToUpload.modelOffsetMatrixInv.value.copy(this.extraUniformsToUpload.modelOffsetMatrix.value).invert(),this.extraUniformsToUpload.radius.value=it.radius);const nt=(tt=_.userData._normalsCaptureMap)===null||tt===void 0?void 0:tt.texture;this.normalsCaptureMap!==nt&&(this.normalsCaptureMap=nt),this.dispatchEvent({type:"beforeRender",renderer:o,scene:c,camera:d,geometry:_,object:v})}onAfterRender(o,c,d,_,v){super.onAfterRender(o,c,d,_,v),this.userData.__envIntensity!==void 0&&(this.envMapIntensity=this.userData.__envIntensity,delete this.userData.__envIntensity),this.dispatchEvent({type:"afterRender",renderer:o,scene:c,camera:d,geometry:_,object:v})}constructor(o){var c;super({side:three_module.$EB,defines:{DIA_ORIENT_ENVMAP:0,RAY_BOUNCES:5,ENV_MAP_TYPE:0,PI:3.1428},vertexShader:diamond_vert,fragmentShader:diamond_frag,uniforms:{envMap:{value:(o==null?void 0:o.envMap)||null},envMapRotation:{value:0},envMapRotationQuat:{value:new three_module.PTz},transmission:{value:0},transmissionSamplerMap:{value:null},transmissionSamplerSize:{value:new three_module.I9Y},normalOffset:{value:0},distanceOffset:{value:0},colorCorrection:{value:new three_module.Pq0(1,1,1)}}}),this.typeSlug=DiamondMaterial.TypeSlug,this.assetType="material",this.__envMap=[],this.isDiamondMaterial=!0,this.color=new three_module.Q1f(1,1,1),this.envMapIntensity=.05,this.envMapRotationOffset=0,this.envMapRotationOffsetX=0,this.envMapRotationOffsetY=0,this.envMapRotationOffsetZ=0,this.dispersion=.012,this.absorptionFactor=1,this.refractiveIndex=2.4,this.squashFactor=.98,this.geometryFactor=.5,this.gammaFactor=2.2,this.boostFactors=new three_module.Pq0(.892,.892,.98595025),this.transmission=0,this.reflectivity=.5,this.rayBounces=5,this.diamondOrientedEnvMap=0,this.normalsCaptureMap=null,this.extraUniformsToUpload={inverseModelMatrix:{value:new three_module.kn4().identity()},radius:{value:1},centerOffset:{value:new three_module.Pq0(0,0,0)},modelOffsetMatrix:{value:new three_module.kn4().identity()},modelOffsetMatrixInv:{value:new three_module.kn4().identity()}},this.envMapIndex=0,this.setDirty=this.setDirty.bind(this),this.userData.setDirty=d=>{console.warn("WebGi DiamondMaterial: userData.setDirty is deprecated. Use setDirty instead."),this.setDirty(d)},this.userData.separateEnvMapIntensity=!0,o&&this.setValues(o),this.materialExtensions=MaterialExtender.RegisterExtensions(this,(c=o==null?void 0:o.customMaterialExtensions)!==null&&c!==void 0?c:[])}registerMaterialExtensions(o){this.materialExtensions=[...this.materialExtensions,...MaterialExtender.RegisterExtensions(this,o)]}unregisterMaterialExtensions(o){}onBeforeCompile(o,c){MaterialExtender.ApplyMaterialExtensions(this,o,this.materialExtensions,c),this.dispatchEvent({type:"beforeCompile",shader:o,renderer:c}),o.fragmentShader=o.fragmentShader.replaceAll("#glMarker","// "),o.vertexShader=o.vertexShader.replaceAll("#glMarker","// "),super.onBeforeCompile(o,c)}customProgramCacheKey(){return super.customProgramCacheKey()+MaterialExtender.CacheKeyForExtensions(this,this.materialExtensions)}setDirty(o){var c,d;this.needsUpdate=!0,this.dispatchEvent({...o,type:"materialUpdate",frameFade:o==null?void 0:o.last}),(o==null?void 0:o.last)!==!1&&((d=(c=this._uiConfig)===null||c===void 0?void 0:c.uiRefresh)===null||d===void 0||d.call(c,"postFrame",!0,1))}set envMaps(o){this.__envMap=o,this.refreshEnvUniform()}refreshEnvUniform(){var o;this.uniforms.envMap.value=this.envMap,this.defines.ENV_MAP_TYPE=!((o=this.uniforms.envMap.value)===null||o===void 0)&&o.isCubeTexture?0:1,this.needsUpdate=!0}get envMap(){var o,c;return(c=(o=this.__envMap[this.envMapIndex])!==null&&o!==void 0?o:this.__envMap[0])!==null&&c!==void 0?c:null}set envMap(o){console.error("Setting separate envmap for individual diamond material not supported yet.")}clone(){return super.clone()}toJSON(o){const c={metadata:{version:4.6,type:"DiamondMaterial",generator:"DiamondMaterial.toJSON"}};return c.name=this.name,c.uuid=this.uuid,c.color=this.color.getHex(),c.envMapIntensity=this.envMapIntensity,c.envMapIndex=this.envMapIndex,c.envMapRotationOffset=this.envMapRotationOffset,c.dispersion=this.dispersion,c.squashFactor=this.squashFactor,c.geometryFactor=this.geometryFactor,c.gammaFactor=this.gammaFactor,c.absorptionFactor=this.absorptionFactor,c.reflectivity=this.reflectivity,c.refractiveIndex=this.refractiveIndex,c.rayBounces=this.rayBounces,c.diamondOrientedEnvMap=this.diamondOrientedEnvMap,c.boostFactors={x:this.boostFactors.x,y:this.boostFactors.y,z:this.boostFactors.z,isVector3:!0},c.transmission=this.transmission,c.isDiamondMaterialParameters=!0,c.type=DiamondMaterial.TYPE,c.userData={},copyMaterialUserData(c.userData,this.userData),c.userData.uuid=this.userData.uuid,c}get uiConfig(){const o=this;return this._uiConfigChildren||(this._uiConfigChildren=[{type:"input",property:[this,"name"]},{type:"checkbox",property:[this,"wireframe"]},{type:"dropdown",label:"Environment",property:[this,"envMapIndex"],children:[0,1,2].map(c=>({label:"env"+(c+1),value:c}))},...generateUiConfig(this),{type:"input",label:"Mesh count",get value(){var c,d,_;return(_=(d=(c=o.userData)===null||c===void 0?void 0:c.__appliedMeshes)===null||d===void 0?void 0:d.size)!==null&&_!==void 0?_:0},set value(c){},disabled:!0},{type:"input",label:"uuid",get value(){return o.uuid},set value(c){},disabled:!0},{type:"checkbox",label:"Render to Depth",hidden:()=>this.transmission===0,get value(){return o.userData.renderToDepth===!0},set value(c){o.userData.renderToDepth=c||void 0}},{type:"button",label:"Download .dmat",value:()=>{N$2(new Blob([JSON.stringify(o.toJSON(),null,2)],{type:"application/json"}),"diamond-material.dmat")}}]),this._uiConfig||(this._uiConfig={type:"folder",label:"Diamond Material",expanded:!0,children:this._uiConfigChildren,limitedUi:!0}),this._uiConfig.children=[...this._uiConfigChildren,...this.materialExtensions.map(c=>{var d;return(d=c.getUiConfig)===null||d===void 0?void 0:d.call(c,this)})].filter(c=>c),this._uiConfig}copyProps(o){if(!o.isDiamondMaterialParameters&&!o.isDiamondMaterial&&!o.isDiamond&&o.type!==DiamondMaterial.TYPE)return console.warn("WebGi DiamondMaterial: Material type is not supported",o),this;const c={};xe$1(o,c,Array.from(Object.keys(diamondMaterialPropList)));const d=c.userData;return delete c.userData,this.setValues(c),copyMaterialUserData(this.userData,d),this.setDirty(),this}fromJSON(o,c){return this.copyProps(o)}}DiamondMaterial.TypeSlug="dmat",DiamondMaterial.TYPE="DiamondMaterial",diamondMaterial_decorate([uiColor("Color",{limitedUi:!0}),uniform()],DiamondMaterial.prototype,"color",void 0),diamondMaterial_decorate([uiSlider("Env Intensity",[0,5],.01,{limitedUi:!0}),uniform()],DiamondMaterial.prototype,"envMapIntensity",void 0),diamondMaterial_decorate([uiSlider("Env Rotation Offset",[-Math.PI,Math.PI],.01),ze$1(DiamondMaterial.prototype.setDirty)],DiamondMaterial.prototype,"envMapRotationOffset",void 0),diamondMaterial_decorate([uiSlider("Env Rotation Offset X",[-Math.PI,Math.PI],.01),ze$1(DiamondMaterial.prototype.setDirty)],DiamondMaterial.prototype,"envMapRotationOffsetX",void 0),diamondMaterial_decorate([uiSlider("Env Rotation Offset Y",[-Math.PI,Math.PI],.01),ze$1(DiamondMaterial.prototype.setDirty)],DiamondMaterial.prototype,"envMapRotationOffsetY",void 0),diamondMaterial_decorate([uiSlider("Env Rotation Offset Z",[-Math.PI,Math.PI],.01),ze$1(DiamondMaterial.prototype.setDirty)],DiamondMaterial.prototype,"envMapRotationOffsetZ",void 0),diamondMaterial_decorate([uiSlider("Dispersion",[0,.1],1e-4,{limitedUi:!0}),uniform({propKey:"rIndexDelta"})],DiamondMaterial.prototype,"dispersion",void 0),diamondMaterial_decorate([uiSlider("Absorption",[0,15],.01,{limitedUi:!0}),uniform()],DiamondMaterial.prototype,"absorptionFactor",void 0),diamondMaterial_decorate([uiSlider("Refractive Index",[0,4],.01,{limitedUi:!0}),uniform()],DiamondMaterial.prototype,"refractiveIndex",void 0),diamondMaterial_decorate([uniform()],DiamondMaterial.prototype,"squashFactor",void 0),diamondMaterial_decorate([uniform()],DiamondMaterial.prototype,"geometryFactor",void 0),diamondMaterial_decorate([uiSlider("Gamma",[.1,4],.01,{limitedUi:!0}),uniform()],DiamondMaterial.prototype,"gammaFactor",void 0),diamondMaterial_decorate([uiVector("RGB Boost",void 0,void 0,{limitedUi:!0}),uniform()],DiamondMaterial.prototype,"boostFactors",void 0),diamondMaterial_decorate([uiSlider("Transmission",[0,1],.01,{limitedUi:!0}),uniform()],DiamondMaterial.prototype,"transmission",void 0),diamondMaterial_decorate([uiSlider("Reflectivity",[0,2],.01,{limitedUi:!0}),uniform()],DiamondMaterial.prototype,"reflectivity",void 0),diamondMaterial_decorate([matDefine("RAY_BOUNCES",void 0,!0),uiSlider("Ray Bounces",[1,16],1)],DiamondMaterial.prototype,"rayBounces",void 0),diamondMaterial_decorate([matDefine("DIA_ORIENT_ENVMAP",void 0,!0),uiSlider("Diamond Oriented Lighting",[0,1],1)],DiamondMaterial.prototype,"diamondOrientedEnvMap",void 0),diamondMaterial_decorate([uniform({propKey:"tCubeMapNormals"})],DiamondMaterial.prototype,"normalsCaptureMap",void 0),diamondMaterial_decorate([x$1(DiamondMaterial.prototype.refreshEnvUniform)],DiamondMaterial.prototype,"envMapIndex",void 0);const algorithms={ES256:{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}},ES384:{name:"ECDSA",namedCurve:"P-384",hash:{name:"SHA-384"}},ES512:{name:"ECDSA",namedCurve:"P-521",hash:{name:"SHA-512"}},HS256:{name:"HMAC",hash:{name:"SHA-256"}},HS384:{name:"HMAC",hash:{name:"SHA-384"}},HS512:{name:"HMAC",hash:{name:"SHA-512"}},RS256:{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},RS384:{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-384"}},RS512:{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-512"}}};function decode(h){return JSON.parse(atob(h.split(".")[1]))}async function verify(h,o,c){const d=algorithms[c.algorithm||"RS512"],_=await crypto.subtle.importKey("jwk",o,d,!0,["verify"]),v=h.split("."),b=new Uint8Array(atob(v[2].replace(/-/g,"+").replace(/_/g,"/").replace(/\s/g,"")).split("").map(it=>it.charCodeAt(0))),tt=new Uint8Array((v[0]+"."+v[1]).split("").map(it=>it.charCodeAt(0)));return await crypto.subtle.verify(d,_,b,tt)}const jwt={decode,verify};class LicenseVerification{constructor(o,c){this.PRODUCT_ID="IJewel3D_WebGi_V0",this.KEY_TYPE_ID="online-v1",this.TOKEN_FILE="0.txt",this.PUBLIC_KEY_FILE="1.json",this.KEY_SERVER="https://license.ijewel3d.com",this.KEY_SERVER_VERIFY="/api/v1/verify",this.KEY_SERVER_CERTS="/api/v1/certs/"+this.KEY_TYPE_ID,this.id="",this.idHash="",this.appVersion="",this.appName="",this._storage={getItem:async d=>localStorage.getItem(d),setItem:async(d,_)=>(localStorage.setItem(d,_),_)},this.silent=!0,this.appVersion=c,this.appName=o}_getOriginId(){const o=getCurrentDomain(window);if(!o||!(o!=null&&o[0]))throw new Error("Failed to get id");return"\\\\"+o.map(c=>btoa(c)).join("\\\\")}_getStorage(){return this._storage}async init(){var o,c;if(this.id=this.id||this._getOriginId(),!this.id)throw new Error("Failed to get machine id");this.idHash=await hash(this.id);const d=this._getStorage(),_=this.idHash+this.TOKEN_FILE;let v=(o=await d.getItem(_))!==null&&o!==void 0?o:await d.setItem(_,"");const b=this.idHash+this.PUBLIC_KEY_FILE,tt=(c=await d.getItem(b))!==null&&c!==void 0?c:null;let it=await this.getPublicKey().catch(()=>null);return!it&&tt&&(it=JSON.parse(tt)),it!==tt&&await d.setItem(b,JSON.stringify(it)),it||this._throw(new Error("Failed to get public key")),{token:v,publicKey:it}}async verify(o,c){var d;try{let _,v=(c=c??await this.init()).token;v&&!await jwt.verify(v,c.publicKey,{algorithm:"RS512",throwError:!1})&&(v=""),v&&(_=jwt.decode(v),((d=_.payload)===null||d===void 0?void 0:d.key)!==o&&(v="")),v&&v.length||(v=await this.setLicenseKey(o)),_=v?jwt.decode(v):void 0;let b=!1;return b=b||v&&await jwt.verify(v,c.publicKey,{algorithm:"RS512",throwError:!1}),b=b||!!_&&await this.verifyData(_),b}catch(_){return this.silent||console.error(_),!1}}async writeToken(o){const c=this.idHash+this.TOKEN_FILE;await this._getStorage().setItem(c,o)}async verifyData(o){var c,d,_;return((c=o.payload)===null||c===void 0?void 0:c.sub)===this.id&&((d=o.payload)===null||d===void 0?void 0:d.app)===this.appName+"_"+this.appVersion&&((_=o.payload)===null||_===void 0?void 0:_.pid)===this.PRODUCT_ID}async _getPublicKeyFromServer(){return fetch(this.KEY_SERVER+this.KEY_SERVER_CERTS).then(o=>o.json()).catch(o=>({status:o==null?void 0:o.status,error:o}))}async _validateKeyFromServer(o){return await fetch(this.KEY_SERVER+this.KEY_SERVER_VERIFY,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({key:o,id:this.id,app:{name:this.appName,version:this.appVersion},pid:this.PRODUCT_ID})}).then(c=>c.json()).catch(c=>({status:c==null?void 0:c.status,error:c}))}_throw(o){if(!this.silent)throw o;return null}async setLicenseKey(o){const c=await this._validateKeyFromServer(o);if(c.error)return this._throw((c.status?c.status+": ":"")+ +c.error);const d=c.token;return d?(await this.writeToken(d),d):this._throw(new Error("Invalid license key, no token"))}async getPublicKey(){const o=await this._getPublicKeyFromServer();return o.error?this._throw(o.error):o.jwk||this._throw(new Error("Invalid public key"))}}async function hash(h){const o=new TextEncoder().encode(h),c=await crypto.subtle.digest("SHA-256",o);return Array.from(new Uint8Array(c)).map(d=>d.toString(16).padStart(2,"0")).join("")}function getCurrentDomain(h){let o,c,d,_,v,b;const tt=function(ft,bt,xt){if(ft.length!=bt)return!1;for(let St=0;St<bt;St++)for(let wt=0;wt<xt.length;wt+=2)if(St==xt[wt]&&ft.charCodeAt(St)!=xt[wt+1])return!1;return!0},it=function(ft,bt,xt){return tt(bt,xt,ft)},nt=function(ft,bt,xt){return it(bt,ft,xt)};for(let ft in h)if(tt(ft,8,[7,116,5,101,3,117,0,100])){o=ft;break}for(let ft in h)if(tt(ft,6,[5,116,0,112,4,110,2,114])){v=ft;break}for(let ft in h[o])if(nt(ft,[5,110,0,100],6)){c=ft;break}for(let ft in h[o])if(nt(ft,[7,110,0,108],8)){d=ft;break}for(let ft in h[o])if(nt(ft,[7,114,0,114],8)){b=ft;break}if(!("~">c)){for(let ft in h[o][d])if(it([7,101,0,104],ft,8)){_=ft;break}}if(!o||!h[o])return;const lt=h[v]!==h,ut=h[o][c],ht=!!h[o][d]&&h[o][d][_],_t=lt&&b?h[o][b]:ut||ht;return _t?[_t,ut||ht]:void 0}var injectStylesIntoStyleTag=__webpackgi_require__(186),injectStylesIntoStyleTag_default=__webpackgi_require__.n(injectStylesIntoStyleTag),styleDomAPI=__webpackgi_require__(155),styleDomAPI_default=__webpackgi_require__.n(styleDomAPI),setAttributesWithoutAttributes=__webpackgi_require__(626),setAttributesWithoutAttributes_default=__webpackgi_require__.n(setAttributesWithoutAttributes),insertStyleElement=__webpackgi_require__(990),insertStyleElement_default=__webpackgi_require__.n(insertStyleElement),styleTagTransform=__webpackgi_require__(827),styleTagTransform_default=__webpackgi_require__.n(styleTagTransform),loadingScreen=__webpackgi_require__(646),exported={};loadingScreen.A&&loadingScreen.A.locals&&(exported.locals=loadingScreen.A.locals);var refs=0,update,options={};options.styleTagTransform=styleTagTransform_default(),options.setAttributes=setAttributesWithoutAttributes_default(),options.insert=function(h,o){(o.target||document.head).appendChild(h)},options.domAPI=styleDomAPI_default(),options.insertStyleElement=insertStyleElement_default(),exported.use=function(h){return options.options=h||{},refs++||(update=injectStylesIntoStyleTag_default()(loadingScreen.A,options)),exported},exported.unuse=function(){refs>0&&!--refs&&(update(),update=null)};var styles_loadingScreen=exported,spinner1=__webpackgi_require__(611),spinner1_exported={};spinner1.A&&spinner1.A.locals&&(spinner1_exported.locals=spinner1.A.locals);var spinner1_refs=0,spinner1_update,spinner1_options={};spinner1_options.styleTagTransform=styleTagTransform_default(),spinner1_options.setAttributes=setAttributesWithoutAttributes_default(),spinner1_options.insert=function(h,o){(o.target||document.head).appendChild(h)},spinner1_options.domAPI=styleDomAPI_default(),spinner1_options.insertStyleElement=insertStyleElement_default(),spinner1_exported.use=function(h){return spinner1_options.options=h||{},spinner1_refs++||(spinner1_update=injectStylesIntoStyleTag_default()(spinner1.A,spinner1_options)),spinner1_exported},spinner1_exported.unuse=function(){spinner1_refs>0&&!--spinner1_refs&&(spinner1_update(),spinner1_update=null)};var loaders_spinner1=spinner1_exported,AAssetManagerProcessStatePlugin_decorate=function(h,o,c,d){var _,v=arguments.length,b=v<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(h,o,c,d);else for(var tt=h.length-1;tt>=0;tt--)(_=h[tt])&&(b=(v<3?_(b):v>3?_(o,c,b):_(o,c))||b);return v>3&&b&&Object.defineProperty(o,c,b),b};class AAssetManagerProcessStatePlugin extends AViewerPlugin{_onEnabledChange(){this.enabled||(this._mainDiv.style.display="none")}constructor(o,c){super(),this.container=c,this.enabled=!0,this.dependencies=[AssetManagerPlugin],this.processState=new Map,this._mainDiv=ee$1({id:"assetManager"+o,addToBody:!1,innerHTML:""}),this._contentDiv=ee$1({id:"assetManager"+o+"Content",addToBody:!1,innerHTML:""}),this.enabled||(this._mainDiv.style.display="none"),this._mainDiv.appendChild(this._contentDiv)}async onAdded(o){var c,d,_,v,b,tt,it,nt,lt,ut,ht,_t,ft;await super.onAdded(o),((c=this.container)!==null&&c!==void 0?c:o.container).appendChild(this._mainDiv),this._updateMainDiv(this.processState),(_=(d=o.getManager())===null||d===void 0?void 0:d.importer)===null||_===void 0||_.addEventListener("importFile",bt=>{bt.state!=="done"?this.processState.set(bt.path,{state:bt.state,progress:bt.progress?100*bt.progress:void 0}):this.processState.delete(bt.path),this._updateMainDiv(this.processState)}),(b=(v=o.getManager())===null||v===void 0?void 0:v.importer)===null||b===void 0||b.addEventListener("processFileStart",bt=>{this.processState.set(bt.path,{state:"processing",progress:void 0}),this._updateMainDiv(this.processState)}),(it=(tt=o.getManager())===null||tt===void 0?void 0:tt.importer)===null||it===void 0||it.addEventListener("processFileEnd",bt=>{this.processState.delete(bt.path),this._updateMainDiv(this.processState)}),(lt=(nt=o.getManager())===null||nt===void 0?void 0:nt.exporter)===null||lt===void 0||lt.addEventListener("exportFile",bt=>{bt.state!=="done"?this.processState.set(bt.obj.name,{state:bt.state,progress:bt.progress?100*bt.progress:void 0}):this.processState.delete(bt.obj.name),this._updateMainDiv(this.processState)}),(ut=o.getPluginByType("FileTransferPlugin"))===null||ut===void 0||ut.addEventListener("transferFile",bt=>{bt.state!=="done"?this.processState.set(bt.path,{state:bt.state,progress:bt.progress?100*bt.progress:void 0}):this.processState.delete(bt.path),this._updateMainDiv(this.processState)}),(ht=o.getPluginByType("MaterialConfiguratorPlugin"))===null||ht===void 0||ht.addEventListener("progress",bt=>{bt.state!=="done"?this.processState.set("MatpreviewGeneration",{state:bt.state,progress:0}):this.processState.delete("MatpreviewGeneration"),this._updateMainDiv(this.processState)}),(_t=o.getPluginByType("SwitchNodePlugin"))===null||_t===void 0||_t.addEventListener("progress",bt=>{bt.state!=="done"?this.processState.set("SwitchNodeGeneration",{state:bt.state,progress:0}):this.processState.delete("SwitchNodeGeneration"),this._updateMainDiv(this.processState)}),(ft=o.getPluginByType("ThemePlugin"))===null||ft===void 0||ft.addEventListener("progress",bt=>{bt.state!=="done"?this.processState.set("ThemeInit",{state:bt.state,progress:0}):this.processState.delete("ThemeInit"),this._updateMainDiv(this.processState)})}async onRemove(o){var c;return this._mainDiv.remove(),(c=this._contentDiv)===null||c===void 0||c.remove(),this.processState.clear(),super.onRemove(o)}}AAssetManagerProcessStatePlugin_decorate([uiToggle("Enabled"),x$1(AAssetManagerProcessStatePlugin.prototype._onEnabledChange),serialize()],AAssetManagerProcessStatePlugin.prototype,"enabled",void 0);var LoadingScreenPlugin_decorate=function(h,o,c,d){var _,v=arguments.length,b=v<3?o:d===null?d=Object.getOwnPropertyDescriptor(o,c):d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(h,o,c,d);else for(var tt=h.length-1;tt>=0;tt--)(_=h[tt])&&(b=(v<3?_(b):v>3?_(o,c,b):_(o,c))||b);return v>3&&b&&Object.defineProperty(o,c,b),b},LoadingScreenPlugin_1;let LoadingScreenPlugin=LoadingScreenPlugin_1=class extends AAssetManagerProcessStatePlugin{refresh(){this._updateMainDiv(this._isPreviewing?this._previewState:this.processState,!1)}togglePreview(){this.maximize(),this._isPreviewing=!this._isPreviewing,this.refresh(),this._isPreviewing?this.show():this.hideWithDelay()}constructor(h){super("LoadingScreen",h),this.styles=styles_loadingScreen,this.spinners=[{styles:loaders_spinner1,html:'<span class="loader"></span>'}],this.loader=0,this.loadingTextHeader="Loading Files",this.errorTextHeader="Error Loading Files",this.showFileNames=!0,this.showProcessStates=!0,this.showProgress=!0,this.hideOnOnlyErrors=!0,this.hideOnFilesLoad=!0,this.hideOnSceneObjectLoad=!1,this.minimizeOnSceneObjectLoad=!0,this.showOnFilesLoading=!0,this.showOnSceneEmpty=!0,this.hideDelay=500,this.backgroundOpacity=.5,this.backgroundBlur=24,this.background="#ffffff",this.textColor="#222222",this.logoImage=LoadingScreenPlugin_1.LS_DEFAULT_LOGO,this._isPreviewing=!1,this._previewState=new Map([["file.glb",{state:"downloading",progress:50}],["1_metal_whitegold_polished_0db3fb834b.pmat",{state:"adding"}]]),this.loadingElement=ee$1({classList:["loadingScreenLoadingElement"],addToBody:!1}),this.filesElement=ee$1({classList:["loadingScreenFilesElement"],addToBody:!1}),this.logoElement=ee$1({classList:["loadingScreenLogoElement"],addToBody:!1}),this._isHidden=!1,this._temp=document.createElement("template"),this.isEditor=!1,this._sceneUpdate=o=>{if(!this._viewer||!o.hierarchyChanged)return;const c=this._viewer.scene.modelRoot.children;c.length===0&&this.showOnSceneEmpty&&!this.isEditor&&this.show(),c.length>0?this.hideOnSceneObjectLoad?this.hideWithDelay():this.minimizeOnSceneObjectLoad&&this._viewer.scene.environment&&X$2(this.hideDelay+300).then(()=>this.minimize()):this.minimizeOnSceneObjectLoad&&this.maximize()},this._mainDiv.prepend(this.loadingElement),this._mainDiv.prepend(this.logoElement),this._mainDiv.appendChild(this.filesElement)}get visible(){return!this._isHidden}async hide(){this._isHidden=!0,this._mainDiv.style.opacity="0",await X$2(502),this._isHidden&&(this._mainDiv.style.display="none",this._showMainDiv())}async hideWithDelay(){if(this._isHidden=!0,await X$2(this.hideDelay),this._isHidden)return this.hide()}show(){this._isHidden&&(this._isHidden=!1,this._showMainDiv(),this._mainDiv.style.display="flex")}_showMainDiv(){this._mainDiv.style.opacity="1"}minimize(){this._mainDiv.classList.add("minimizedLoadingScreen"),this.showFileNames||(this.loadingElement.style.display="block")}maximize(){this._mainDiv.classList.remove("minimizedLoadingScreen"),this.loadingElement.style.display=""}_setHTML(h,o){this._temp.innerHTML=o,this._temp.innerHTML.trim()==h.innerHTML.trim()||(h.innerHTML=o)}_updateMainDiv(h,o=!0){if(!this._viewer||!this._contentDiv)return;if(!this.enabled)return void(this._mainDiv.style.display="none");if(this.showFileNames){let d="";h.forEach((_,v)=>{let b=(v||"").split("/").pop();if(b&&b.length>16){const tt=b.split(".").pop();b=tt===b?b.slice(0,16):b.slice(0,-tt.length-1).slice(0,16)+"..."+tt}d+=(this.showProcessStates?`<span class="loadingScreenProcessState">${_.state}</span>: `:"")+b+(this.showProgress&&_.progress?" - "+_.progress.toFixed(0)+"%":"")+"<br>"}),this._setHTML(this.filesElement,d)}else this._setHTML(this.filesElement,"");const c=[...h.values()].filter(d=>d.state==="error");c.length>0&&c.length===h.size&&!this.hideOnOnlyErrors?this._setHTML(this._contentDiv,this.errorTextHeader):this._setHTML(this._contentDiv,this.loadingTextHeader),this._setHTML(this.loadingElement,this.spinners[this.loader].html),this._mainDiv.style.setProperty("--b-opacity",this.backgroundOpacity.toString()),this._mainDiv.style.setProperty("--b-background",this.background),this._mainDiv.style.backdropFilter=`blur(${this.backgroundBlur}px)`,this._mainDiv.style.color=this.textColor,this._setHTML(this.logoElement,this.logoImage?`<img class="loadingScreenLogoImage" src="${this.logoImage}"/>`:""),o&&(this.hideOnFilesLoad&&(h.size===0||c.length===h.size&&this.hideOnOnlyErrors)?this.hideDelay?this.hideWithDelay():this.hide():h.size>0&&this.showOnFilesLoading&&(this._viewer.scene.modelRoot.children.length>0&&this.minimizeOnSceneObjectLoad&&this._viewer.scene.environment?this.minimize():this.maximize(),this.show()))}async onAdded(h){var o;this.styles.use({target:(o=this.container)!==null&&o!==void 0?o:h.container}),this.spinners.forEach(c=>{var d;c.styles.use({target:(d=this.container)!==null&&d!==void 0?d:h.container})}),h.scene.addEventListener("sceneUpdate",this._sceneUpdate),await super.onAdded(h)}async onRemove(h){h.scene.removeEventListener("sceneUpdate",this._sceneUpdate),await super.onRemove(h)}};LoadingScreenPlugin.PluginType="LoadingScreenPlugin",LoadingScreenPlugin.LS_DEFAULT_LOGO="https://tiexbrasil.com.br/logo.svg",LoadingScreenPlugin_decorate([uiDropdown("Loader",["Spinner 1"].map((h,o)=>({value:o,label:h}))),serialize()],LoadingScreenPlugin.prototype,"loader",void 0),LoadingScreenPlugin_decorate([uiInput("Loading text header"),x$1(LoadingScreenPlugin.prototype.refresh),serialize()],LoadingScreenPlugin.prototype,"loadingTextHeader",void 0),LoadingScreenPlugin_decorate([uiInput("Error text header"),serialize()],LoadingScreenPlugin.prototype,"errorTextHeader",void 0),LoadingScreenPlugin_decorate([uiToggle("Show file names"),serialize(),x$1(LoadingScreenPlugin.prototype.refresh)],LoadingScreenPlugin.prototype,"showFileNames",void 0),LoadingScreenPlugin_decorate([uiToggle("Show process states"),serialize(),x$1(LoadingScreenPlugin.prototype.refresh)],LoadingScreenPlugin.prototype,"showProcessStates",void 0),LoadingScreenPlugin_decorate([uiToggle("Show progress"),serialize(),x$1(LoadingScreenPlugin.prototype.refresh)],LoadingScreenPlugin.prototype,"showProgress",void 0),LoadingScreenPlugin_decorate([uiToggle("Hide on only errors"),serialize()],LoadingScreenPlugin.prototype,"hideOnOnlyErrors",void 0),LoadingScreenPlugin_decorate([uiToggle("Hide on files load"),serialize()],LoadingScreenPlugin.prototype,"hideOnFilesLoad",void 0),LoadingScreenPlugin_decorate([uiToggle("Hide on scene object load"),serialize()],LoadingScreenPlugin.prototype,"hideOnSceneObjectLoad",void 0),LoadingScreenPlugin_decorate([uiToggle("Minimize on scene object load"),serialize()],LoadingScreenPlugin.prototype,"minimizeOnSceneObjectLoad",void 0),LoadingScreenPlugin_decorate([uiToggle("Show when files start loading"),serialize()],LoadingScreenPlugin.prototype,"showOnFilesLoading",void 0),LoadingScreenPlugin_decorate([uiToggle("Show when scene empty"),serialize()],LoadingScreenPlugin.prototype,"showOnSceneEmpty",void 0),LoadingScreenPlugin_decorate([uiInput("Hide delay (ms)"),serialize()],LoadingScreenPlugin.prototype,"hideDelay",void 0),LoadingScreenPlugin_decorate([uiSlider("Background Opacity",[0,1]),x$1(LoadingScreenPlugin.prototype.refresh),serialize()],LoadingScreenPlugin.prototype,"backgroundOpacity",void 0),LoadingScreenPlugin_decorate([uiSlider("Background Blur",[0,100]),x$1(LoadingScreenPlugin.prototype.refresh),serialize()],LoadingScreenPlugin.prototype,"backgroundBlur",void 0),LoadingScreenPlugin_decorate([uiInput("Background Color"),x$1(LoadingScreenPlugin.prototype.refresh),serialize()],LoadingScreenPlugin.prototype,"background",void 0),LoadingScreenPlugin_decorate([uiInput("Text Color"),x$1(LoadingScreenPlugin.prototype.refresh),serialize()],LoadingScreenPlugin.prototype,"textColor",void 0),LoadingScreenPlugin_decorate([uiInput("Logo Image"),x$1(LoadingScreenPlugin.prototype.refresh),serialize()],LoadingScreenPlugin.prototype,"logoImage",void 0),LoadingScreenPlugin_decorate([uiButton("Toggle preview")],LoadingScreenPlugin.prototype,"togglePreview",null),LoadingScreenPlugin_decorate([uiButton("Minimize")],LoadingScreenPlugin.prototype,"minimize",null),LoadingScreenPlugin_decorate([uiButton("Maximize")],LoadingScreenPlugin.prototype,"maximize",null),LoadingScreenPlugin=LoadingScreenPlugin_1=LoadingScreenPlugin_decorate([uiFolder("Loading Screen")],LoadingScreenPlugin);const APP_NAME="iJewel3dSDK_WebGi",APP_VERSION=ViewerApp.VERSION,logoSvgUrl="https://playground.ijewel3d.com/logo_black.svg",console1={error:h=>setTimeout(()=>console.error(new Error(h)),612)};class BaseIJewel3DKeyPlugin extends AViewerPlugin{setKey(o){this._checking||this._checkPromise||(this._checking=Date.now(),this._checkPromise=this._check(o),this._checkPromise.then(()=>this._checkPromise=void 0))}async _check(o){await new LicenseVerification(APP_NAME,APP_VERSION).verify(o)||(console1.error(this._errMessage),this._logoContainer=this._createContainerLogo())}_createContainerLogo(){const o=document.createElement("div");o.innerHTML=logoSvg,o.style.position="absolute",o.style.padding="1rem",o.style.left="0",o.style.bottom="0",o.style.width="100%",o.style.height="auto",o.style.display="flex",o.style.alignItems="center",o.style.backgroundColor="rgba(0, 0, 0, 0)",o.style.zIndex="9999",o.style.pointerEvents="none";const c=o.children[0];c&&c.style&&(c.style.width="calc(min(20%, 150px))",c.style.height="auto",c.onclick=()=>{window.open("https://ijewel3d.com/","_top")}),this._logoContainer=o;const d=document.getElementById("webgi-logo");return d&&d.remove(),o}constructor(){super(),this._errMessage=`iJewel3D ${APP_NAME} ${APP_VERSION}. FOR EVALUATION PURPOSES ONLY. For more information visit: https://ijewel3d.com/`,this._checking=0,this._licenseInUse=!1,this._autoKey=!0,setInterval(()=>{var o;if(this._checkPromise&&Date.now()-this._checking>15e3&&(console1.error(this._errMessage),this._logoContainer=this._createContainerLogo(),typeof this._checkPromise.cancel=="function"&&this._checkPromise.cancel(),this._checkPromise=void 0),this._logoContainer&&!this._logoContainer.parentElement&&this._viewer&&this._licenseInUse){this._lContainer.appendChild(this._logoContainer);const c=(o=this._viewer)===null||o===void 0?void 0:o.getPlugin(LoadingScreenPlugin);c&&(c.logoImage=logoSvgUrl,LoadingScreenPlugin.LS_DEFAULT_LOGO=logoSvgUrl)}},5e3)}get _lContainer(){var o;const c=(o=this._viewer)===null||o===void 0?void 0:o.container;if(!c)return document.body;const d=window.getComputedStyle(c).position;return d!=="absolute"&&d!=="relative"&&d!=="fixed"?document.body:c}use(){var o;if(!this._licenseInUse&&(this._licenseInUse=!0,!this._checking))if(this._autoKey)this.setKey("auto");else{console1.error(this._errMessage),this._logoContainer=this._createContainerLogo(),this._lContainer.appendChild(this._logoContainer);const c=(o=this._viewer)===null||o===void 0?void 0:o.getPlugin(LoadingScreenPlugin);c&&(LoadingScreenPlugin.LS_DEFAULT_LOGO=logoSvgUrl,c.logoImage=logoSvgUrl)}}unuse(){}async onAdded(o){await super.onAdded(o)}}const logoSvg=`
`;var diamondPlugin_decorate=function(h,o,c,d){var _,v=arguments.length,b=v<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(h,o,c,d);else for(var tt=h.length-1;tt>=0;tt--)(_=h[tt])&&(b=(v<3?_(b):v>3?_(o,c,b):_(o,c))||b);return v>3&&b&&Object.defineProperty(o,c,b),b};class DiamondPlugin extends BaseIJewel3DKeyPlugin{get envMapRotation(){var o,c;return(c=(o=this.envMap)===null||o===void 0?void 0:o.rotation)!==null&&c!==void 0?c:0}set envMapRotation(o){var c;const d=[this.envMap,this.envMap2,this.envMap3];for(const _ of d)_&&(_.rotation=o,(c=this._viewer)===null||c===void 0||c.scene.setDirty())}refreshEnvMaps(){var o,c,d;if(!this._viewer)return;const _=this.getEnvMaps(),v=((c=(o=this._viewer.getPlugin(AssetManagerPlugin))===null||o===void 0?void 0:o.materials)===null||c===void 0?void 0:c.getMaterialsOfType(DiamondMaterial.TypeSlug))||[];for(const b of v)b&&(b.envMaps=_);(d=this._viewer)===null||d===void 0||d.scene.setDirty()}constructor(){super(),this.offsetCache={},this.enabled=!0,this.envMap=null,this.envMap2=null,this.envMap3=null,this.forceSceneEnvMap=!1,this.getEnvMaps=()=>{var o;if(!this.forceSceneEnvMap&&this.envMap)return[this.envMap,this.envMap2,this.envMap3];const c=((o=this._viewer)===null||o===void 0?void 0:o.scene.environment)||null;return[c,c,c]},this._modelProcessor={forAssetType:"model",processAsync:async(o,c)=>{const d=[];return o.modelObject.traverse(_=>{var v,b,tt,it;const nt=(b=(v=_.userData)===null||v===void 0?void 0:v.gltfExtensions)===null||b===void 0?void 0:b[DiamondPlugin.DIAMOND_GLTF_EXTENSION];nt&&_.geometry&&(this.prepareDiamondMesh(_,nt),delete _.userData.gltfExtensions[DiamondPlugin.DIAMOND_GLTF_EXTENSION]),_.material&&!d.includes(_.material)&&!((it=(tt=_.material.userData)===null||tt===void 0?void 0:tt.gltfExtensions)===null||it===void 0)&&it[DiamondPlugin.DIAMOND_GLTF_EXTENSION]&&(_.material.materialObject||console.warn("WebGi DiamondPlugin: material not processed",_.material),d.push(_.material))}),d.forEach(_=>{const v=_.userData.gltfExtensions[DiamondPlugin.DIAMOND_GLTF_EXTENSION];v&&this._convertToDiamondMaterial(_,v)}),o}},this.uiConfig={type:"folder",label:"Diamonds",children:[{type:"checkbox",label:"Use Scene Environment",property:[this,"forceSceneEnvironment"],limitedUi:!0},{type:"image",label:"Environment",hidden:()=>this.forceSceneEnvMap,property:[this,"envMap"],limitedUi:!0},{type:"slider",bounds:[0,2*Math.PI],hidden:()=>this.forceSceneEnvMap,label:"Env Rotation",property:[this,"envMapRotation"],limitedUi:!0},{type:"image",label:"Environment 2",hidden:()=>this.forceSceneEnvMap,property:[this,"envMap2"]},{type:"image",label:"Environment 3",hidden:()=>this.forceSceneEnvMap,property:[this,"envMap3"]},{type:"button",label:"Make Diamond",hidden:()=>{var o,c,d;const _=(d=(c=(o=this._viewer)===null||o===void 0?void 0:o.getPlugin(PickingPlugin))===null||c===void 0?void 0:c.getSelectedObject())===null||d===void 0?void 0:d.material;return!!Array.isArray(_)||(_==null?void 0:_.typeSlug)!==MeshStandardMaterial2.TypeSlug},value:async()=>{var o,c,d,_,v,b;const tt=(c=(o=this._viewer)===null||o===void 0?void 0:o.getPlugin(PickingPlugin))===null||c===void 0?void 0:c.getSelectedObject();if(!(tt!=null&&tt.material))return;const it=await((d=this._viewer)===null||d===void 0?void 0:d.prompt("Cache key: Enter optional cache key unique to the diamond shape.","",!1)),nt=(await((_=this._viewer)===null||_===void 0?void 0:_.prompt("Cache size: Enter size of the cache [64-1024]","512",!1))||"512").toLowerCase(),lt=nt.endsWith("high")?"high":nt.endsWith("low")?"low":"medium";let ut=parseInt(nt);isFinite(ut)||(ut=512),ut<64&&(ut=64),((v=tt.material.userData)===null||v===void 0?void 0:v.__appliedMeshes.size)>1&&await((b=this._viewer)===null||b===void 0?void 0:b.confirm("Convert all: Apply diamond material to all the meshes with the same material?"))?this.makeDiamond(tt.material,{cacheKey:it||void 0,normalMapRes:ut,normalMapPrecision:lt},{}):this.makeDiamondMesh(tt,{cacheKey:it||void 0,normalMapRes:ut,normalMapPrecision:lt},{}),this.refreshUi()},limitedUi:!0},{type:"button",label:"Make Standard",hidden:()=>{var o,c,d;const _=(d=(c=(o=this._viewer)===null||o===void 0?void 0:o.getPlugin(PickingPlugin))===null||c===void 0?void 0:c.getSelectedObject())===null||d===void 0?void 0:d.material;return!!Array.isArray(_)||(_==null?void 0:_.typeSlug)!==DiamondMaterial.TypeSlug},value:async()=>{var o,c,d,_,v,b,tt,it;const nt=(c=(o=this._viewer)===null||o===void 0?void 0:o.getPlugin(PickingPlugin))===null||c===void 0?void 0:c.getSelectedObject(),lt=nt==null?void 0:nt.material;if(!lt)return;const ut=lt.userData.__baseMaterial;let ht=(v=(_=(d=this._viewer)===null||d===void 0?void 0:d.getManager())===null||_===void 0?void 0:_.materials)===null||v===void 0?void 0:v.findMaterial(ut);if(ht&&!ht.isDiamondMaterial||(ht=(b=this._viewer)===null||b===void 0?void 0:b.createPhysicalMaterial({color:lt.color})),ht){const _t=lt.userData.__appliedMeshes.size>1&&await((tt=this._viewer)===null||tt===void 0?void 0:tt.confirm("Convert all with this material?"))?Array.from(lt.userData.__appliedMeshes):[nt];for(const ft of _t)(it=ft==null?void 0:ft.setMaterial)===null||it===void 0||it.call(ft,ht),this.unprepareDiamondMesh(ft)}this.refreshUi()},limitedUi:!0},{type:"button",label:"Auto Instance Diamonds (dev)",hidden:()=>{var o,c,d,_;const v=(d=(c=(o=this._viewer)===null||o===void 0?void 0:o.getPlugin(PickingPlugin))===null||c===void 0?void 0:c.getSelectedObject())===null||d===void 0?void 0:d.material;return!!Array.isArray(v)||(v==null?void 0:v.typeSlug)!==DiamondMaterial.TypeSlug||((_=v.userData.__appliedMeshes)===null||_===void 0?void 0:_.size)<2},value:async()=>{var o,c;const d=(c=(o=this._viewer)===null||o===void 0?void 0:o.getPlugin(PickingPlugin))===null||c===void 0?void 0:c.getSelectedObject();if(!d)return;const _=d.material;_&&!Array.isArray(_)&&autoGPUInstanceMeshes(_)}},{type:"button",label:"Clear Cache",value:()=>{this.disposeAllCacheMaps()}}]},this.refreshEnvMaps=this.refreshEnvMaps.bind(this),this.refreshUi=this.refreshUi.bind(this)}refreshUi(){var o,c,d;(o=this._viewer)===null||o===void 0||o.setDirty(),(d=(c=this.uiConfig)===null||c===void 0?void 0:c.uiRefresh)===null||d===void 0||d.call(c,"postFrame",!0)}async onAdded(o){var c,d,_,v,b,tt,it;this._normalCapture=new CubeNormalsCaptureHelper(o.renderer),this.offsetCache={},o.scene.addEventListener("materialChanged",ht=>{var _t,ft,bt,xt,St;if(!((_t=ht.material)===null||_t===void 0)&&_t.isDiamondMaterial){const wt=ht.material,Pt=ht.mesh||ht.object;if(Pt.geometry&&!(!((ft=this._normalCapture)===null||ft===void 0)&&ft.hasCapturedNormalMap(Pt.geometry))){const kt=(St=(xt=(bt=wt==null?void 0:wt.userData)===null||bt===void 0?void 0:bt.gltfExtensions)===null||xt===void 0?void 0:xt[DiamondPlugin.DIAMOND_GLTF_EXTENSION])!==null&&St!==void 0?St:{};kt.cacheKey===void 0&&!Pt.userData._diamondCacheKey&&wt!=null&&wt.name&&(kt.cacheKey=wt.name),this.prepareDiamondMesh(Pt,kt)}const Rt=this.getEnvMaps();wt.envMaps=Rt}}),o.scene.addEventListener("environmentChanged",this.refreshEnvMaps);const nt=o.getPlugin(AssetManagerPlugin);(c=nt==null?void 0:nt.importer)===null||c===void 0||c.processors.add("model",this._modelProcessor),(d=o.getPlugin(PickingPlugin))===null||d===void 0||d.addEventListener("selectedObjectChanged",this.refreshUi);const lt=this.getEnvMaps,ut=new Importer(class extends SimpleJSONLoader{async loadAsync(ht,_t){var ft;const bt=await super.loadAsync(ht,_t);return bt.type===DiamondMaterial.TYPE||bt.isDiamondMaterialParameters?(bt.envMap=lt(),(ft=nt==null?void 0:nt.materials)===null||ft===void 0?void 0:ft.generateFromTemplate("diamond",bt)):(console.error("Invalid material type for Diamond Material.",bt),null)}},[DiamondMaterial.TypeSlug],!1);return(_=nt==null?void 0:nt.importer)===null||_===void 0||_.Importers.push(ut),(tt=(b=(v=nt==null?void 0:nt.exporter)===null||v===void 0?void 0:v.getExporter("gltf","glb"))===null||b===void 0?void 0:b.extensions)===null||tt===void 0||tt.push(diamondMaterialGLTFExportExtension),(it=nt==null?void 0:nt.materials)===null||it===void 0||it.registerMaterialTemplate({name:"diamond",materialType:DiamondMaterial.TYPE,isDiamondMaterialParameters:!0,generator:(ht,_t)=>{const ft=!(_t!=null&&_t.metadata||!_t.isDiamondMaterialParameters)||(_t==null?void 0:_t.metadata)&&(_t==null?void 0:_t.metadata.version)<=4.5,bt=_t==null?void 0:_t.color;ft&&typeof _t.color=="number"&&(_t.color=new three_module.Q1f().setHex(_t.color,three_module.Zr2).getHex());const xt=new DiamondMaterial(ht);return xt.envMaps=this.getEnvMaps(),!_t||_t.isMeshStandardMaterial||_t.isMeshPhysicalMaterial||xt.copyProps(_t),_t.color=bt,xt}}),super.onAdded(o)}async onRemove(o){var c,d,_,v;return(c=this._normalCapture)===null||c===void 0||c.dispose(),this._normalCapture=void 0,this.offsetCache={},(_=(d=o.getPlugin(AssetManagerPlugin))===null||d===void 0?void 0:d.importer)===null||_===void 0||_.processors.remove("model",this._modelProcessor),(v=o.getPlugin(PickingPlugin))===null||v===void 0||v.removeEventListener("selectedObjectChanged",this.refreshUi),super.onRemove(o)}unprepareDiamondMesh(o){var c;o.userData&&(delete o.userData._diamondCacheKey,delete o.userData._diamondNormalMapRes,delete o.userData._diamondNormalMapPrecision,o.geometry&&(this._removeOffsets(o.geometry),(c=this._normalCapture)===null||c===void 0||c.removeNormalMap(o.geometry)))}prepareDiamondMesh(o,{cacheKey:c,normalMapRes:d,normalMapPrecision:_}){var v,b,tt;this.use(),o.userData._diamondCacheKey=c??o.userData._diamondCacheKey,o.userData._diamondNormalMapRes=d??o.userData._diamondNormalMapRes,o.userData._diamondNormalMapPrecision=_??o.userData._diamondNormalMapPrecision,c=c&&c.length>0?c.includes(";"+o.geometry.uuid)?c:c+";"+o.geometry.uuid:o.geometry.uuid,this._computeOffsets(o.geometry,o.geometry.uuid);const it=(b=(v=this._normalCapture)===null||v===void 0?void 0:v.captureNormalMap(o.geometry,c,d,_,o))!==null&&b!==void 0?b:[void 0,!1],nt=(tt=this._viewer)===null||tt===void 0?void 0:tt.getPluginByType("debug");nt&&it&&(nt.counters.normalsCapture||(nt.counters.normalsCapture=0),nt.counters.normalsCapture++,console.log("DEBUG: new normal map captured",nt.counters.normalsCapture,c),nt.addTexture("normal"+nt.counters.normalsCapture,()=>{var lt,ut;return(ut=(lt=o.geometry)===null||lt===void 0?void 0:lt.userData._normalsCaptureMap)===null||ut===void 0?void 0:ut.texture},[40,110*nt.counters.normalsCapture-100,200,100],void 0,void 0,"postRender",!0))}makeDiamond(o,c,d){var _,v;Array.from((_=o==null?void 0:o.userData.__appliedMeshes)!==null&&_!==void 0?_:[]).forEach(b=>{b!=null&&b.isMesh&&b.geometry&&this.prepareDiamondMesh(b,c)}),this._convertToDiamondMaterial(o,d),(v=this._viewer)===null||v===void 0||v.setDirty()}makeDiamondMesh(o,c,d){if(!o.modelObject.isMesh||!o.geometry||!o.setMaterial)return;this.prepareDiamondMesh(o.modelObject,c);const _=Array.isArray(o.material)?o.material[0]:o.material,v=this._convertToDiamondMaterial(_,d,!1);o.setMaterial(v)}_convertToDiamondMaterial(o,c={isDiamond:!0},d=!0){var _,v,b,tt,it,nt,lt,ut;let ht={...c??{}};ht.isDiamond||ht.isDiamondMaterialParameters?Array.isArray(ht.boostFactors)&&(ht.boostFactors=new three_module.Pq0().fromArray(ht.boostFactors)):ht={isDiamondMaterialParameters:!0},ht.color=(v=(_=ht.color)!==null&&_!==void 0?_:o==null?void 0:o.color)!==null&&v!==void 0?v:new three_module.Q1f(1,1,1),ht.name=(tt=(b=ht.name)!==null&&b!==void 0?b:o==null?void 0:o.name)!==null&&tt!==void 0?tt:"diamond";const _t=(lt=(nt=(it=this._viewer)===null||it===void 0?void 0:it.getManager())===null||nt===void 0?void 0:nt.materials)===null||lt===void 0?void 0:lt.generateFromTemplate("diamond",ht);if(_t&&o&&!o.isDiamondMaterial&&(_t.userData.__baseMaterial=o.uuid),d){const ft=bt=>{var xt;return(xt=bt.setMaterial)!==null&&xt!==void 0?xt:St=>{bt.material=St.materialObject}};Array.from((ut=o==null?void 0:o.userData.__appliedMeshes)!==null&&ut!==void 0?ut:[]).forEach(bt=>{ft(bt)(_t),this.prepareDiamondMesh(bt,c)})}return _t}_computeOffsets(o,c,d=!1){var _;if(o.userData.normalsCaptureOffsets){if(rt("recomputeOffsets")===null)return o.userData.normalsCaptureOffsets;console.warn("WebGi DiamondPlugin: recomputeOffsets",o.userData.normalsCaptureOffsets)}let v;!((_=o.morphAttributes)===null||_===void 0)&&_.position&&(v=o.morphAttributes,o.morphAttributes={}),o.computeBoundingBox();const b=o.boundingBox.getCenter(new three_module.Pq0).toArray(),tt=computeEigenVectors(o).toArray(),it=new three_module.kn4().fromArray(tt).invert(),nt=new three_module.Pq0().fromArray(b).applyMatrix4(it).toArray(),lt={center:b,offsetMatrix:tt,offsetMatrixInv:it.toArray(),radius:1,centerOffset:nt};return o.userData.normalsCaptureOffsets=lt,v&&(o.morphAttributes=v,o.computeBoundingBox()),rt("recomputeOffsets")!==null&&console.warn("WebGi DiamondPlugin: recomputeOffsets",lt),lt}_removeOffsets(o){delete o.userData.normalsCaptureOffsets}getAllCacheMaps(){var o;const c=new Set;return(o=this._viewer)===null||o===void 0||o.scene.modelObject.traverse(d=>{d.geometry&&d.geometry.userData._normalsCaptureMap&&c.add(d.geometry.userData._normalsCaptureMap)}),[...c]}disposeCacheMap(o){var c;(c=this._normalCapture)===null||c===void 0||c.disposeTarget(o)}disposeAllCacheMaps(){var o;(o=this._normalCapture)===null||o===void 0||o.disposeAllTargets()}}DiamondPlugin.PluginType="Diamond",DiamondPlugin.DIAMOND_GLTF_EXTENSION="WEBGI_materials_diamond",diamondPlugin_decorate([x$1(DiamondPlugin.prototype.refreshEnvMaps),serialize()],DiamondPlugin.prototype,"envMap",void 0),diamondPlugin_decorate([x$1(DiamondPlugin.prototype.refreshEnvMaps),serialize()],DiamondPlugin.prototype,"envMap2",void 0),diamondPlugin_decorate([x$1(DiamondPlugin.prototype.refreshEnvMaps),serialize()],DiamondPlugin.prototype,"envMap3",void 0),diamondPlugin_decorate([x$1(DiamondPlugin.prototype.refreshEnvMaps),serialize()],DiamondPlugin.prototype,"forceSceneEnvMap",void 0);const diamondMaterialGLTFExportExtension=h=>({writeMaterial:(o,c)=>{o.isDiamondMaterial&&(c.extensions=c.extensions||{},c.extensions[DiamondPlugin.DIAMOND_GLTF_EXTENSION]=o.toJSON(),h.extensionsUsed[DiamondPlugin.DIAMOND_GLTF_EXTENSION]=!0)},writeMesh:(o,c)=>{var d,_;if(!(o!=null&&o.material.isDiamondMaterial))return;c.extensions=c.extensions||{};const v={};(_=(d=o.userData)===null||d===void 0?void 0:d.gltfExtensions)===null||_===void 0||delete _[DiamondPlugin.DIAMOND_GLTF_EXTENSION],o.userData._diamondNormalMapRes&&(v.normalMapRes=o.userData._diamondNormalMapRes),o.userData._diamondNormalMapPrecision&&(v.normalMapPrecision=o.userData._diamondNormalMapPrecision),o.userData._diamondCacheKey&&(v.cacheKey=o.userData._diamondCacheKey),c.extensions[DiamondPlugin.DIAMOND_GLTF_EXTENSION]=v,h.extensionsUsed[DiamondPlugin.DIAMOND_GLTF_EXTENSION]=!0}});var __assign=function(){return __assign=Object.assign||function(h){for(var o,c=1,d=arguments.length;c<d;c++)for(var _ in o=arguments[c])Object.prototype.hasOwnProperty.call(o,_)&&(h[_]=o[_]);return h},__assign.apply(this,arguments)};function __rest(h,o){var c={};for(var d in h)Object.prototype.hasOwnProperty.call(h,d)&&o.indexOf(d)<0&&(c[d]=h[d]);if(h!=null&&typeof Object.getOwnPropertySymbols=="function"){var _=0;for(d=Object.getOwnPropertySymbols(h);_<d.length;_++)o.indexOf(d[_])<0&&Object.prototype.propertyIsEnumerable.call(h,d[_])&&(c[d[_]]=h[d[_]])}return c}function __spreadArray(h,o,c){if(c||arguments.length===2)for(var d,_=0,v=o.length;_<v;_++)!d&&_ in o||(d||(d=Array.prototype.slice.call(o,0,_)),d[_]=o[_]);return h.concat(d||Array.prototype.slice.call(o))}var invariant$1=function(){},clamp$1=function(h,o,c){return Math.min(Math.max(c,h),o)},safeMin$1=.001,minDuration$1=.01,maxDuration$2=10,minDamping$1=.05,maxDamping$1=1;function findSpring$1(h){var o,c,d=h.duration,_=d===void 0?800:d,v=h.bounce,b=v===void 0?.25:v,tt=h.velocity,it=tt===void 0?0:tt,nt=h.mass,lt=nt===void 0?1:nt,ut=1-b;ut=clamp$1(minDamping$1,maxDamping$1,ut),_=clamp$1(minDuration$1,maxDuration$2,_/1e3),ut<1?(o=function(ft){var bt=ft*ut,xt=bt*_,St=bt-it,wt=calcAngularFreq$1(ft,ut),Pt=Math.exp(-xt);return safeMin$1-St/wt*Pt},c=function(ft){var bt=ft*ut*_,xt=bt*it+it,St=Math.pow(ut,2)*Math.pow(ft,2)*_,wt=Math.exp(-bt),Pt=calcAngularFreq$1(Math.pow(ft,2),ut);return(-o(ft)+safeMin$1>0?-1:1)*((xt-St)*wt)/Pt}):(o=function(ft){return Math.exp(-ft*_)*((ft-it)*_+1)-safeMin$1},c=function(ft){return Math.exp(-ft*_)*(_*_*(it-ft))});var ht=approximateRoot$1(o,c,5/_);if(_*=1e3,isNaN(ht))return{stiffness:100,damping:10,duration:_};var _t=Math.pow(ht,2)*lt;return{stiffness:_t,damping:2*ut*Math.sqrt(lt*_t),duration:_}}var rootIterations$1=12;function approximateRoot$1(h,o,c){for(var d=c,_=1;_<rootIterations$1;_++)d-=h(d)/o(d);return d}function calcAngularFreq$1(h,o){return h*Math.sqrt(1-o*o)}var durationKeys$1=["duration","bounce"],physicsKeys$1=["stiffness","damping","mass"];function isSpringType$1(h,o){return o.some(function(c){return h[c]!==void 0})}function getSpringOptions$1(h){var o=__assign({velocity:0,stiffness:100,damping:10,mass:1,isResolvedFromDuration:!1},h);if(!isSpringType$1(h,physicsKeys$1)&&isSpringType$1(h,durationKeys$1)){var c=findSpring$1(h);(o=__assign(__assign(__assign({},o),c),{velocity:0,mass:1})).isResolvedFromDuration=!0}return o}function spring$1(h){var o=h.from,c=o===void 0?0:o,d=h.to,_=d===void 0?1:d,v=h.restSpeed,b=v===void 0?2:v,tt=h.restDelta,it=__rest(h,["from","to","restSpeed","restDelta"]),nt={done:!1,value:c},lt=getSpringOptions$1(it),ut=lt.stiffness,ht=lt.damping,_t=lt.mass,ft=lt.velocity,bt=lt.duration,xt=lt.isResolvedFromDuration,St=zero,wt=zero;function Pt(){var Rt=ft?-ft/1e3:0,kt=_-c,Gt=ht/(2*Math.sqrt(ut*_t)),Dt=Math.sqrt(ut/_t)/1e3;if(tt!=null||(tt=Math.abs(_-c)<=1?.01:.4),Gt<1){var It=calcAngularFreq$1(Dt,Gt);St=function(Vt){var Kt=Math.exp(-Gt*Dt*Vt);return _-Kt*((Rt+Gt*Dt*kt)/It*Math.sin(It*Vt)+kt*Math.cos(It*Vt))},wt=function(Vt){var Kt=Math.exp(-Gt*Dt*Vt);return Gt*Dt*Kt*(Math.sin(It*Vt)*(Rt+Gt*Dt*kt)/It+kt*Math.cos(It*Vt))-Kt*(Math.cos(It*Vt)*(Rt+Gt*Dt*kt)-It*kt*Math.sin(It*Vt))}}else if(Gt===1)St=function(Vt){return _-Math.exp(-Dt*Vt)*(kt+(Rt+Dt*kt)*Vt)};else{var Nt=Dt*Math.sqrt(Gt*Gt-1);St=function(Vt){var Kt=Math.exp(-Gt*Dt*Vt),Yt=Math.min(Nt*Vt,300);return _-Kt*((Rt+Gt*Dt*kt)*Math.sinh(Yt)+Nt*kt*Math.cosh(Yt))/Nt}}}return Pt(),{next:function(Rt){var kt=St(Rt);if(xt)nt.done=Rt>=bt;else{var Gt=1e3*wt(Rt),Dt=Math.abs(Gt)<=b,It=Math.abs(_-kt)<=tt;nt.done=Dt&&It}return nt.value=nt.done?_:kt,nt},flipTarget:function(){var Rt;ft=-ft,c=(Rt=[_,c])[0],_=Rt[1],Pt()}}}spring$1.needsInterpolation=function(h,o){return typeof h=="string"||typeof o=="string"};var zero=function(h){return 0},progress$1=function(h,o,c){var d=o-h;return d===0?1:(c-h)/d},mix$1=function(h,o,c){return-c*h+c*o+h},utils_clamp=function(h,o){return function(c){return Math.max(Math.min(c,o),h)}},sanitize$1=function(h){return h%1?Number(h.toFixed(5)):h},floatRegex$1=/(-)?([\d]*\.?[\d])+/g,colorRegex$1=/(#[0-9a-f]{6}|#[0-9a-f]{3}|#(?:[0-9a-f]{2}){2,4}|(rgb|hsl)a?\((-?[\d\.]+%?[,\s]+){2,3}\s*\/*\s*[\d\.]+%?\))/gi,singleColorRegex$1=/^(#[0-9a-f]{3}|#(?:[0-9a-f]{2}){2,4}|(rgb|hsl)a?\((-?[\d\.]+%?[,\s]+){2,3}\s*\/*\s*[\d\.]+%?\))$/i;function isString$1(h){return typeof h=="string"}var number$1={test:function(h){return typeof h=="number"},parse:parseFloat,transform:function(h){return h}},alpha$1=__assign(__assign({},number$1),{transform:utils_clamp(0,1)});__assign(__assign({},number$1),{default:1});var isColorString$1=function(h,o){return function(c){return!!(isString$1(c)&&singleColorRegex$1.test(c)&&c.startsWith(h)||o&&Object.prototype.hasOwnProperty.call(c,o))}},splitColor$1=function(h,o,c){return function(d){var _;if(!isString$1(d))return d;var v=d.match(floatRegex$1),b=v[0],tt=v[1],it=v[2],nt=v[3];return(_={})[h]=parseFloat(b),_[o]=parseFloat(tt),_[c]=parseFloat(it),_.alpha=nt!==void 0?parseFloat(nt):1,_}},clampRgbUnit$1=utils_clamp(0,255),rgbUnit$1=__assign(__assign({},number$1),{transform:function(h){return Math.round(clampRgbUnit$1(h))}}),rgba$1={test:isColorString$1("rgb","red"),parse:splitColor$1("red","green","blue"),transform:function(h){var o=h.red,c=h.green,d=h.blue,_=h.alpha,v=_===void 0?1:_;return"rgba("+rgbUnit$1.transform(o)+", "+rgbUnit$1.transform(c)+", "+rgbUnit$1.transform(d)+", "+sanitize$1(alpha$1.transform(v))+")"}};function parseHex$1(h){var o="",c="",d="",_="";return h.length>5?(o=h.substr(1,2),c=h.substr(3,2),d=h.substr(5,2),_=h.substr(7,2)):(o=h.substr(1,1),c=h.substr(2,1),d=h.substr(3,1),_=h.substr(4,1),o+=o,c+=c,d+=d,_+=_),{red:parseInt(o,16),green:parseInt(c,16),blue:parseInt(d,16),alpha:_?parseInt(_,16)/255:1}}var hex$1={test:isColorString$1("#"),parse:parseHex$1,transform:rgba$1.transform},createUnitType$1=function(h){return{test:function(o){return isString$1(o)&&o.endsWith(h)&&o.split(" ").length===1},parse:parseFloat,transform:function(o){return""+o+h}}},percent$1=createUnitType$1("%");__assign(__assign({},percent$1),{parse:function(h){return percent$1.parse(h)/100},transform:function(h){return percent$1.transform(100*h)}});var hsla$1={test:isColorString$1("hsl","hue"),parse:splitColor$1("hue","saturation","lightness"),transform:function(h){var o=h.hue,c=h.saturation,d=h.lightness,_=h.alpha,v=_===void 0?1:_;return"hsla("+Math.round(o)+", "+percent$1.transform(sanitize$1(c))+", "+percent$1.transform(sanitize$1(d))+", "+sanitize$1(alpha$1.transform(v))+")"}},mixLinearColor$1=function(h,o,c){var d=h*h,_=o*o;return Math.sqrt(Math.max(0,c*(_-d)+d))},colorTypes$1=[hex$1,rgba$1,hsla$1],getColorType$1=function(h){return colorTypes$1.find(function(o){return o.test(h)})},mixColor$1=function(h,o){var c=getColorType$1(h),d=getColorType$1(o);if(invariant$1(c.transform===d.transform),!c||!d||c.transform!==d.transform)return function(it){return""+(it>0?o:h)};var _=c.parse(h),v=d.parse(o),b=__assign({},_),tt=c===hsla$1?mix$1:mixLinearColor$1;return function(it){for(var nt in b)nt!=="alpha"&&(b[nt]=tt(_[nt],v[nt],it));return b.alpha=mix$1(_.alpha,v.alpha,it),c.transform(b)}},color$1={test:function(h){return rgba$1.test(h)||hex$1.test(h)||hsla$1.test(h)},parse:function(h){return rgba$1.test(h)?rgba$1.parse(h):hsla$1.test(h)?hsla$1.parse(h):hex$1.parse(h)},transform:function(h){return isString$1(h)?h:h.hasOwnProperty("red")?rgba$1.transform(h):hsla$1.transform(h)}},colorToken="${c}",numberToken="${n}";function test$1(h){var o,c,d,_;return isNaN(h)&&isString$1(h)&&((c=(o=h.match(floatRegex$1))===null||o===void 0?void 0:o.length)!==null&&c!==void 0?c:0)+((_=(d=h.match(colorRegex$1))===null||d===void 0?void 0:d.length)!==null&&_!==void 0?_:0)>0}function analyse(h){typeof h=="number"&&(h=""+h);var o=[],c=0,d=h.match(colorRegex$1);d&&(c=d.length,h=h.replace(colorRegex$1,colorToken),o.push.apply(o,d.map(color$1.parse)));var _=h.match(floatRegex$1);return _&&(h=h.replace(floatRegex$1,numberToken),o.push.apply(o,_.map(number$1.parse))),{values:o,numColors:c,tokenised:h}}function parse(h){return analyse(h).values}function createTransformer$1(h){var o=analyse(h),c=o.values,d=o.numColors,_=o.tokenised,v=c.length;return function(b){for(var tt=_,it=0;it<v;it++)tt=tt.replace(it<d?colorToken:numberToken,it<d?color$1.transform(b[it]):sanitize$1(b[it]));return tt}}var convertNumbersToZero$1=function(h){return typeof h=="number"?0:h};function getAnimatableNone$2(h){var o=parse(h);return createTransformer$1(h)(o.map(convertNumbersToZero$1))}var complex$1={test:test$1,parse,createTransformer:createTransformer$1,getAnimatableNone:getAnimatableNone$2},zeroPoint={x:0,y:0,z:0},isNum=function(h){return typeof h=="number"},combineFunctions$1=function(h,o){return function(c){return o(h(c))}},pipe$1=function(){for(var h=[],o=0;o<arguments.length;o++)h[o]=arguments[o];return h.reduce(combineFunctions$1)};function getMixer$2(h,o){return isNum(h)?function(c){return mix$1(h,o,c)}:color$1.test(h)?mixColor$1(h,o):mixComplex$1(h,o)}var mixArray$1=function(h,o){var c=__spreadArray([],h),d=c.length,_=h.map(function(v,b){return getMixer$2(v,o[b])});return function(v){for(var b=0;b<d;b++)c[b]=_[b](v);return c}},mixObject$1=function(h,o){var c=__assign(__assign({},h),o),d={};for(var _ in c)h[_]!==void 0&&o[_]!==void 0&&(d[_]=getMixer$2(h[_],o[_]));return function(v){for(var b in d)c[b]=d[b](v);return c}};function mix_complex_analyse(h){for(var o=complex$1.parse(h),c=o.length,d=0,_=0,v=0,b=0;b<c;b++)d||typeof o[b]=="number"?d++:o[b].hue!==void 0?v++:_++;return{parsed:o,numNumbers:d,numRGB:_,numHSL:v}}var mixComplex$1=function(h,o){var c=complex$1.createTransformer(o),d=mix_complex_analyse(h),_=mix_complex_analyse(o);return d.numHSL===_.numHSL&&d.numRGB===_.numRGB&&d.numNumbers>=_.numNumbers?pipe$1(mixArray$1(d.parsed,_.parsed),c):function(v){return""+(v>0?o:h)}},mixNumber$2=function(h,o){return function(c){return mix$1(h,o,c)}};function detectMixerFactory(h){return typeof h=="number"?mixNumber$2:typeof h=="string"?color$1.test(h)?mixColor$1:mixComplex$1:Array.isArray(h)?mixArray$1:typeof h=="object"?mixObject$1:void 0}function createMixers$1(h,o,c){for(var d=[],_=c||detectMixerFactory(h[0]),v=h.length-1,b=0;b<v;b++){var tt=_(h[b],h[b+1]);if(o){var it=Array.isArray(o)?o[b]:o;tt=pipe$1(it,tt)}d.push(tt)}return d}function fastInterpolate(h,o){var c=h[0],d=h[1],_=o[0];return function(v){return _(progress$1(c,d,v))}}function slowInterpolate(h,o){var c=h.length,d=c-1;return function(_){var v=0,b=!1;if(_<=h[0]?b=!0:_>=h[d]&&(v=d-1,b=!0),!b){for(var tt=1;tt<c&&!(h[tt]>_||tt===d);tt++);v=tt-1}var it=progress$1(h[v],h[v+1],_);return o[v](it)}}function interpolate$1(h,o,c){var d=c===void 0?{}:c,_=d.clamp,v=_===void 0||_,b=d.ease,tt=d.mixer,it=h.length;invariant$1(it===o.length),invariant$1(!b||!Array.isArray(b)||b.length===it-1),h[0]>h[it-1]&&(h=[].concat(h),o=[].concat(o),h.reverse(),o.reverse());var nt=createMixers$1(o,b,tt),lt=it===2?fastInterpolate(h,nt):slowInterpolate(h,nt);return v?function(ut){return lt(clamp$1(h[0],h[it-1],ut))}:lt}var reverseEasing$1=function(h){return function(o){return 1-h(1-o)}},mirrorEasing$1=function(h){return function(o){return o<=.5?h(2*o)/2:(2-h(2*(1-o)))/2}},createExpoIn=function(h){return function(o){return Math.pow(o,h)}},createBackIn=function(h){return function(o){return o*o*((h+1)*o-h)}},createAnticipate=function(h){var o=createBackIn(h);return function(c){return(c*=2)<1?.5*o(c):.5*(2-Math.pow(2,-10*(c-1)))}},DEFAULT_OVERSHOOT_STRENGTH=1.525,BOUNCE_FIRST_THRESHOLD=4/11,BOUNCE_SECOND_THRESHOLD=8/11,BOUNCE_THIRD_THRESHOLD=.9,linear=function(h){return h},easeIn$1=createExpoIn(2),easeOut$1=reverseEasing$1(easeIn$1),easeInOut$1=mirrorEasing$1(easeIn$1),circIn$1=function(h){return 1-Math.sin(Math.acos(h))},circOut$1=reverseEasing$1(circIn$1),circInOut$1=mirrorEasing$1(circOut$1),backIn$1=createBackIn(DEFAULT_OVERSHOOT_STRENGTH),backOut$1=reverseEasing$1(backIn$1),backInOut$1=mirrorEasing$1(backIn$1),anticipate$1=createAnticipate(DEFAULT_OVERSHOOT_STRENGTH),ca$1=4356/361,cb$1=35442/1805,cc$1=16061/1805,bounceOut=function(h){if(h===1||h===0)return h;var o=h*h;return h<BOUNCE_FIRST_THRESHOLD?7.5625*o:h<BOUNCE_SECOND_THRESHOLD?9.075*o-9.9*h+3.4:h<BOUNCE_THIRD_THRESHOLD?ca$1*o-cb$1*h+cc$1:10.8*h*h-20.52*h+10.72},bounceIn=reverseEasing$1(bounceOut),bounceInOut=function(h){return h<.5?.5*(1-bounceOut(1-2*h)):.5*bounceOut(2*h-1)+.5};function defaultEasing$1(h,o){return h.map(function(){return o||easeInOut$1}).splice(0,h.length-1)}function defaultOffset$1(h){var o=h.length;return h.map(function(c,d){return d!==0?d/(o-1):0})}function convertOffsetToTimes$1(h,o){return h.map(function(c){return c*o})}function keyframes$1(h){var o=h.from,c=o===void 0?0:o,d=h.to,_=d===void 0?1:d,v=h.ease,b=h.offset,tt=h.duration,it=tt===void 0?300:tt,nt={done:!1,value:c},lt=Array.isArray(_)?_:[c,_],ut=convertOffsetToTimes$1(b&&b.length===lt.length?b:defaultOffset$1(lt),it);function ht(){return interpolate$1(ut,lt,{ease:Array.isArray(v)?v:defaultEasing$1(lt,v)})}var _t=ht();return{next:function(ft){return nt.value=_t(ft),nt.done=ft>=it,nt},flipTarget:function(){lt.reverse(),_t=ht()}}}function decay(h){var o=h.velocity,c=o===void 0?0:o,d=h.from,_=d===void 0?0:d,v=h.power,b=v===void 0?.8:v,tt=h.timeConstant,it=tt===void 0?350:tt,nt=h.restDelta,lt=nt===void 0?.5:nt,ut=h.modifyTarget,ht={done:!1,value:_},_t=b*c,ft=_+_t,bt=ut===void 0?ft:ut(ft);return bt!==ft&&(_t=bt-_),{next:function(xt){var St=-_t*Math.exp(-xt/it);return ht.done=!(St>lt||St<-lt),ht.value=ht.done?bt:bt+St,ht},flipTarget:function(){}}}var types={keyframes:keyframes$1,spring:spring$1,decay};function detectAnimationFromOptions(h){if(Array.isArray(h.to))return keyframes$1;if(types[h.type])return types[h.type];var o=new Set(Object.keys(h));return o.has("ease")||o.has("duration")&&!o.has("dampingRatio")?keyframes$1:o.has("dampingRatio")||o.has("stiffness")||o.has("mass")||o.has("damping")||o.has("restSpeed")||o.has("restDelta")?spring$1:keyframes$1}var defaultTimestep=1/60*1e3,getCurrentTime=typeof performance<"u"?function(){return performance.now()}:function(){return Date.now()},onNextFrame=typeof window<"u"?function(h){return window.requestAnimationFrame(h)}:function(h){return setTimeout(function(){return h(getCurrentTime())},defaultTimestep)};function createRenderStep$1(h){var o=[],c=[],d=0,_=!1,v=new WeakSet,b={schedule:function(tt,it,nt){it===void 0&&(it=!1),nt===void 0&&(nt=!1);var lt=nt&&_,ut=lt?o:c;return it&&v.add(tt),ut.indexOf(tt)===-1&&(ut.push(tt),lt&&_&&(d=o.length)),tt},cancel:function(tt){var it=c.indexOf(tt);it!==-1&&c.splice(it,1),v.delete(tt)},process:function(tt){var it;if(_=!0,o=(it=[c,o])[0],(c=it[1]).length=0,d=o.length)for(var nt=0;nt<d;nt++){var lt=o[nt];lt(tt),v.has(lt)&&(b.schedule(lt),h())}_=!1}};return b}var maxElapsed$1=40,useDefaultElapsed=!0,runNextFrame=!1,isProcessing=!1,es_frame={delta:0,timestamp:0},stepsOrder$1=["read","update","preRender","render","postRender"],steps$1=stepsOrder$1.reduce(function(h,o){return h[o]=createRenderStep$1(function(){return runNextFrame=!0}),h},{}),sync=stepsOrder$1.reduce(function(h,o){var c=steps$1[o];return h[o]=function(d,_,v){return _===void 0&&(_=!1),v===void 0&&(v=!1),runNextFrame||startLoop(),c.schedule(d,_,v)},h},{}),cancelSync=stepsOrder$1.reduce(function(h,o){return h[o]=steps$1[o].cancel,h},{});stepsOrder$1.reduce(function(h,o){return h[o]=function(){return steps$1[o].process(es_frame)},h},{});var processStep=function(h){return steps$1[h].process(es_frame)},processFrame=function(h){runNextFrame=!1,es_frame.delta=useDefaultElapsed?defaultTimestep:Math.max(Math.min(h-es_frame.timestamp,maxElapsed$1),1),es_frame.timestamp=h,isProcessing=!0,stepsOrder$1.forEach(processStep),isProcessing=!1,runNextFrame&&(useDefaultElapsed=!1,onNextFrame(processFrame))},startLoop=function(){runNextFrame=!0,useDefaultElapsed=!0,isProcessing||onNextFrame(processFrame)},getFrameData=function(){return es_frame},es=sync;function loopElapsed(h,o,c){return c===void 0&&(c=0),h-o-c}function reverseElapsed(h,o,c,d){return c===void 0&&(c=0),d===void 0&&(d=!0),d?loopElapsed(o+-h,o,c):o-(h-o)+c}function hasRepeatDelayElapsed(h,o,c,d){return d?h>=o+c:h<=-c}var framesync=function(h){var o=function(c){var d=c.delta;return h(d)};return{start:function(){return es.update(o,!0)},stop:function(){return cancelSync.update(o)}}};function animate(h){var o,c,d,_,v,b=h.from,tt=h.autoplay,it=tt===void 0||tt,nt=h.driver,lt=nt===void 0?framesync:nt,ut=h.elapsed,ht=ut===void 0?0:ut,_t=h.repeat,ft=_t===void 0?0:_t,bt=h.repeatType,xt=bt===void 0?"loop":bt,St=h.repeatDelay,wt=St===void 0?0:St,Pt=h.onPlay,Rt=h.onStop,kt=h.onComplete,Gt=h.onRepeat,Dt=h.onUpdate,It=__rest(h,["from","autoplay","driver","elapsed","repeat","repeatType","repeatDelay","onPlay","onStop","onComplete","onRepeat","onUpdate"]),Nt=It.to,Vt=0,Kt=It.duration,Yt=!1,nr=!0,rr=detectAnimationFromOptions(It);!((c=(o=rr).needsInterpolation)===null||c===void 0)&&c.call(o,b,Nt)&&(v=interpolate$1([0,100],[b,Nt],{clamp:!1}),b=0,Nt=100);var lr=rr(__assign(__assign({},It),{from:b,to:Nt}));return it&&(Pt==null||Pt(),(d=lt(function(or){if(nr||(or=-or),ht+=or,!Yt){var pr=lr.next(Math.max(0,ht));_=pr.value,v&&(_=v(_)),Yt=nr?pr.done:ht<=0}Dt==null||Dt(_),Yt&&(Vt===0&&(Kt!=null||(Kt=ht)),Vt<ft?hasRepeatDelayElapsed(ht,Kt,wt,nr)&&(Vt++,xt==="reverse"?ht=reverseElapsed(ht,Kt,wt,nr=Vt%2==0):(ht=loopElapsed(ht,Kt,wt),xt==="mirror"&&lr.flipTarget()),Yt=!1,Gt&&Gt()):(d.stop(),kt&&kt()))})).start()),{stop:function(){Rt==null||Rt(),d.stop()}}}const easeInOutSine=h=>-(Math.cos(Math.PI*h)-1)/2,EasingFunctions={linear,easeIn:easeIn$1,easeOut:easeOut$1,easeInOut:easeInOut$1,circIn:circIn$1,circOut:circOut$1,circInOut:circInOut$1,backIn:backIn$1,backOut:backOut$1,backInOut:backInOut$1,anticipate:anticipate$1,bounceOut,bounceIn,bounceInOut,easeInOutSine};function makeSetterFor(h,o,c){const d=h[o],_=()=>{c==null||c()};return d&&d.isColor?v=>{d.set(v),_()}:d&&typeof d.copy=="function"?v=>{d.copy(v),_()}:v=>{h[o]=v,_()}}function isAnimatableType(h){return typeof h!="boolean"}async function animateTarget$1(h,o,c,d,_=!1){o in h||console.error("invalid key",o,h);const v=makeSetterFor(h,o),b=_||c.from===void 0?h[o]:c.from,tt=it=>{var nt;v(it),(nt=c.onUpdate)===null||nt===void 0||nt.call(c,it)};if(isAnimatableType(b))return typeof c.to=="function"&&(c={...c,to:c.to(b,h)}),animateAsync({...c,from:b,onUpdate:tt},d);{const{duration:it}=c;return X$2(it??0).then(()=>tt(c.to))}}async function animateAsync(h,o){const c=h.onComplete,d=h.onStop,_=h.onEnd;return h={...h},new Promise((v,b)=>{h.onComplete=()=>{try{c==null||c()}catch(it){return _==null||_(),void b(it)}_==null||_(),v()},h.onStop=()=>{try{d==null||d()}catch(it){return _==null||_(),void b(it)}_==null||_(),v()};const tt=animate(h);o&&o.push(tt)})}var InteractionPromptPlugin_decorate=function(h,o,c,d){var _,v=arguments.length,b=v<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(h,o,c,d);else for(var tt=h.length-1;tt>=0;tt--)(_=h[tt])&&(b=(v<3?_(b):v>3?_(o,c,b):_(o,c))||b);return v>3&&b&&Object.defineProperty(o,c,b),b},InteractionPromptPlugin_1;let InteractionPromptPlugin=InteractionPromptPlugin_1=class extends AViewerPlugin{constructor(h=!0){super(),this.animationRunning=!1,this.animationDuration=2e3,this.animationDistance=80,this.animationPauseDuration=6e3,this.rotationDistance=.3,this.yOffset=0,this.autoStart=!0,this.autoStartDelay=3e4,this.autoStop=!0,this.autoStartOnObjectLoad=!0,this.autoStartOnObjectLoadDelay=3e3,this.currentTime=0,this.lastActionTime=1/0,this._xDamper=new k$1(50),this.pointerIcon=`<svg xmlns="http://www.w3.org/2000/svg" style="transform: translate(-50%, -25%);" width="25" height="36">
    <defs>
        <path id="A" d="M.001.232h24.997V36H.001z"></path>
    </defs>
    <g transform="translate(-11 -4)" fill="none" fill-rule="evenodd">
        <path fill-opacity="0" fill="#fff" d="M0 0h44v44H0z"></path>
        <g transform="translate(11 3)">
            <path d="M8.733 11.165c.04-1.108.766-2.027 1.743-2.307a2.54 2.54 0 0 1 .628-.089c.16 0 .314.017.463.044 1.088.2 1.9 1.092 1.9 2.16v8.88h1.26c2.943-1.39 5-4.45 5-8.025a9.01 9.01 0 0 0-1.9-5.56l-.43-.5c-.765-.838-1.683-1.522-2.712-2-1.057-.49-2.226-.77-3.46-.77s-2.4.278-3.46.77c-1.03.478-1.947 1.162-2.71 2l-.43.5a9.01 9.01 0 0 0-1.9 5.56 9.04 9.04 0 0 0 .094 1.305c.03.21.088.41.13.617l.136.624c.083.286.196.56.305.832l.124.333a8.78 8.78 0 0 0 .509.953l.065.122a8.69 8.69 0 0 0 3.521 3.191l1.11.537v-9.178z" fill-opacity=".5" fill="#e4e4e4"></path>
            <path d="M22.94 26.218l-2.76 7.74c-.172.485-.676.8-1.253.8H12.24c-1.606 0-3.092-.68-3.98-1.82-1.592-2.048-3.647-3.822-6.11-5.27-.095-.055-.15-.137-.152-.23-.004-.1.046-.196.193-.297.56-.393 1.234-.6 1.926-.6a3.43 3.43 0 0 1 .691.069l4.922.994V10.972c0-.663.615-1.203 1.37-1.203s1.373.54 1.373 1.203v9.882h2.953c.273 0 .533.073.757.21l6.257 3.874c.027.017.045.042.07.06.41.296.586.77.426 1.22M4.1 16.614c-.024-.04-.042-.083-.065-.122a8.69 8.69 0 0 1-.509-.953c-.048-.107-.08-.223-.124-.333l-.305-.832c-.058-.202-.09-.416-.136-.624l-.13-.617a9.03 9.03 0 0 1-.094-1.305c0-2.107.714-4.04 1.9-5.56l.43-.5c.764-.84 1.682-1.523 2.71-2 1.058-.49 2.226-.77 3.46-.77s2.402.28 3.46.77c1.03.477 1.947 1.16 2.712 2l.428.5a9 9 0 0 1 1.901 5.559c0 3.577-2.056 6.636-5 8.026h-1.26v-8.882c0-1.067-.822-1.96-1.9-2.16-.15-.028-.304-.044-.463-.044-.22 0-.427.037-.628.09-.977.28-1.703 1.198-1.743 2.306v9.178l-1.11-.537C6.18 19.098 4.96 18 4.1 16.614M22.97 24.09l-6.256-3.874c-.102-.063-.218-.098-.33-.144 2.683-1.8 4.354-4.855 4.354-8.243 0-.486-.037-.964-.104-1.43a9.97 9.97 0 0 0-1.57-4.128l-.295-.408-.066-.092a10.05 10.05 0 0 0-.949-1.078c-.342-.334-.708-.643-1.094-.922-1.155-.834-2.492-1.412-3.94-1.65l-.732-.088-.748-.03a9.29 9.29 0 0 0-1.482.119c-1.447.238-2.786.816-3.94 1.65a9.33 9.33 0 0 0-.813.686 9.59 9.59 0 0 0-.845.877l-.385.437-.36.5-.288.468-.418.778-.04.09c-.593 1.28-.93 2.71-.93 4.222 0 3.832 2.182 7.342 5.56 8.938l1.437.68v4.946L5 25.64a4.44 4.44 0 0 0-.888-.086c-.017 0-.034.003-.05.003-.252.004-.503.033-.75.08a5.08 5.08 0 0 0-.237.056c-.193.046-.382.107-.568.18-.075.03-.15.057-.225.1-.25.114-.494.244-.723.405a1.31 1.31 0 0 0-.566 1.122 1.28 1.28 0 0 0 .645 1.051C4 29.925 5.96 31.614 7.473 33.563a5.06 5.06 0 0 0 .434.491c1.086 1.082 2.656 1.713 4.326 1.715h6.697c.748-.001 1.43-.333 1.858-.872.142-.18.256-.38.336-.602l2.757-7.74c.094-.26.13-.53.112-.794s-.088-.52-.203-.76a2.19 2.19 0 0 0-.821-.91" fill-opacity=".6" fill="#000"></path>
            <path d="M22.444 24.94l-6.257-3.874a1.45 1.45 0 0 0-.757-.211h-2.953v-9.88c0-.663-.616-1.203-1.373-1.203s-1.37.54-1.37 1.203v16.643l-4.922-.994a3.44 3.44 0 0 0-.692-.069 3.35 3.35 0 0 0-1.925.598c-.147.102-.198.198-.194.298.004.094.058.176.153.23 2.462 1.448 4.517 3.22 6.11 5.27.887 1.14 2.373 1.82 3.98 1.82h6.686c.577 0 1.08-.326 1.253-.8l2.76-7.74c.16-.448-.017-.923-.426-1.22-.025-.02-.043-.043-.07-.06z" fill="#fff"></path>
            <g transform="translate(0 .769)">
                <mask id="B" fill="#fff">
                    <use xlink:href="#A"></use>
                </mask>
                <path d="M23.993 24.992a1.96 1.96 0 0 1-.111.794l-2.758 7.74c-.08.22-.194.423-.336.602-.427.54-1.11.87-1.857.872h-6.698c-1.67-.002-3.24-.633-4.326-1.715-.154-.154-.3-.318-.434-.49C5.96 30.846 4 29.157 1.646 27.773c-.385-.225-.626-.618-.645-1.05a1.31 1.31 0 0 1 .566-1.122 4.56 4.56 0 0 1 .723-.405l.225-.1a4.3 4.3 0 0 1 .568-.18l.237-.056c.248-.046.5-.075.75-.08.018 0 .034-.003.05-.003.303-.001.597.027.89.086l3.722.752V20.68l-1.436-.68c-3.377-1.596-5.56-5.106-5.56-8.938 0-1.51.336-2.94.93-4.222.015-.03.025-.06.04-.09.127-.267.268-.525.418-.778.093-.16.186-.316.288-.468.063-.095.133-.186.2-.277L3.773 5c.118-.155.26-.29.385-.437.266-.3.544-.604.845-.877a9.33 9.33 0 0 1 .813-.686C6.97 2.167 8.31 1.59 9.757 1.35a9.27 9.27 0 0 1 1.481-.119 8.82 8.82 0 0 1 .748.031c.247.02.49.05.733.088 1.448.238 2.786.816 3.94 1.65.387.28.752.588 1.094.922a9.94 9.94 0 0 1 .949 1.078l.066.092c.102.133.203.268.295.408a9.97 9.97 0 0 1 1.571 4.128c.066.467.103.945.103 1.43 0 3.388-1.67 6.453-4.353 8.243.11.046.227.08.33.144l6.256 3.874c.37.23.645.55.82.9.115.24.185.498.203.76m.697-1.195c-.265-.55-.677-1.007-1.194-1.326l-5.323-3.297c2.255-2.037 3.564-4.97 3.564-8.114 0-2.19-.637-4.304-1.84-6.114-.126-.188-.26-.37-.4-.552-.645-.848-1.402-1.6-2.252-2.204C15.472.91 13.393.232 11.238.232A10.21 10.21 0 0 0 5.23 2.19c-.848.614-1.606 1.356-2.253 2.205-.136.18-.272.363-.398.55C1.374 6.756.737 8.87.737 11.06c0 4.218 2.407 8.08 6.133 9.842l.863.41v3.092l-2.525-.51c-.356-.07-.717-.106-1.076-.106a5.45 5.45 0 0 0-3.14.996c-.653.46-1.022 1.202-.99 1.983a2.28 2.28 0 0 0 1.138 1.872c2.24 1.318 4.106 2.923 5.543 4.772 1.26 1.62 3.333 2.59 5.55 2.592h6.698c1.42-.001 2.68-.86 3.134-2.138l2.76-7.74c.272-.757.224-1.584-.134-2.325" fill-opacity=".05" fill="#000" mask="url(#B)"></path>
            </g>
        </g>
    </g>
</svg>`,this._activeCameraUpdate=o=>{this.isDisabled()||(o.change==="deserialize"&&this.animationRunning?(this.stopAnimation({reset:!1}),this.startAnimation()):this.lastActionTime=g())},this._addSceneObject=()=>{this.autoStartOnObjectLoad&&(this.lastActionTime=g()-this.autoStartDelay+this.autoStartOnObjectLoadDelay)},this.onlyOnOrbitControls=!0,this._orbitWarning=!1,this.startAnimation=()=>{var o;if(this._viewer&&this.cursorEl&&!this.isDisabled())return((o=this._viewer.scene.activeCamera.controls)===null||o===void 0?void 0:o.type)!=="OrbitControls"&&this.onlyOnOrbitControls?(this._orbitWarning||console.warn("WebGi InteractionPromptPlugin requires OrbitControls, to run anyway, set onlyOnOrbitControls to false"),void(this._orbitWarning=!0)):void(this._viewer.scene.modelRoot.children.length!==0&&(this.currentSphericalPosition=new three_module.YHV().setFromVector3(new three_module.Pq0().subVectors(this._viewer.scene.activeCamera.position,this._viewer.scene.activeCamera.target)),this.cursorEl.style.opacity="1",this.currentTime=0,this.animationRunning=!0,this._viewer.scene.activeCamera.setInteractions(!1,InteractionPromptPlugin_1.PluginType)))},this.stopAnimation=({reset:o=!0}={})=>{if(this._viewer&&this.cursorEl)return this.animationRunning=!1,this.cursorEl.style.opacity="0",this.currentSphericalPosition&&o&&(this._viewer.scene.activeCamera.position.setFromSpherical(this.currentSphericalPosition).add(this._viewer.scene.activeCamera.target),this._viewer.scene.activeCamera.positionUpdated(),this.currentSphericalPosition=void 0),this._viewer.scene.activeCamera.setInteractions(!0,InteractionPromptPlugin_1.PluginType),this._viewer.doOnce("postFrame")},this._pointerDown=()=>{this.isDisabled()||(this.autoStop&&this.stopAnimation({reset:!1}),this.lastActionTime=g())},this._x=0,this._preFrame=async o=>{if(!this._viewer||!this.cursorEl||(this.isDisabled()&&this.animationRunning&&this.stopAnimation(),this.isDisabled())||(!this.animationRunning&&this.autoStart&&this.lastActionTime+this.autoStartDelay<g()&&this.startAnimation(),!this.animationRunning))return;if(this.currentTime<=this.animationDuration){this.cursorEl.style.opacity="1";const v=this.currentTime/this.animationDuration;this._x=Math.sin(2*Math.PI*v),(v<.25||v>.75)&&(this._x*=this._x*Math.sign(this._x))}else this.cursorEl.style.opacity="0",this._x=0;if(this.currentTime<=this.animationDuration+50){const v=this.currentSphericalPosition.clone();v.theta+=this._x*this.rotationDistance,this._viewer.scene.activeCamera.position.setFromSpherical(v).add(this._viewer.scene.activeCamera.target),this._viewer.scene.activeCamera.positionUpdated()}const c=this._viewer.container.getBoundingClientRect(),d=c.width/2+-this._x*Math.min(this.animationDistance,c.width/4),_=c.height/2+this.yOffset*c.height/2;this.cursorEl.style.transform=`translate(${Math.floor(d)}px, ${Math.floor(_)}px)`,this.currentTime+=o.deltaTime,this.currentTime>this.animationDuration+this.animationPauseDuration&&(this.currentTime=0)},this._disabledBy=new Set,this.disable=o=>{this._disabledBy.size,this._disabledBy.add(o)},this.enable=o=>{this._disabledBy.size,this._disabledBy.delete(o)},this.isDisabled=()=>this._disabledBy.size>0||!this.enabled,this.enabled=h}async onAdded(h){await super.onAdded(h);{Object.hasOwn(h.plugins,"InteractionPointerPlugin")&&delete h.plugins.InteractionPointerPlugin;const o=this;Object.defineProperty(h.plugins,"InteractionPointerPlugin",{get(){return console.warn("WebGi InteractionPromptPlugin: PluginType renamed from InteractionPointerPlugin to InteractionPromptPlugin. Please update your code/vjson."),o},configurable:!0})}this.lastActionTime=1/0,h.addEventListener("preFrame",this._preFrame),h.container.addEventListener("pointerdown",this._pointerDown,!0),h.container.addEventListener("wheel",this._pointerDown,!0),h.scene.addEventListener("addSceneObject",this._addSceneObject),h.scene.addEventListener("activeCameraUpdate",this._activeCameraUpdate),this._initializeCursor()}async onRemove(h){return this.stopAnimation(),h.removeEventListener("preFrame",this._preFrame),h.container.removeEventListener("pointerdown",this._pointerDown,!0),h.container.removeEventListener("wheel",this._pointerDown,!0),h.scene.removeEventListener("addSceneObject",this._addSceneObject),h.scene.removeEventListener("activeCameraUpdate",this._activeCameraUpdate),this.cursorEl&&this.cursorEl.remove(),super.onRemove(h)}_initializeCursor(){this.cursorEl=document.createElement("div"),this.cursorEl.style.position="absolute",this.cursorEl.style.top="0",this.cursorEl.style.left="0",this.cursorEl.style.width="10px",this.cursorEl.style.height="10px",this.cursorEl.style.opacity="0",this.cursorEl.innerHTML=this.pointerIcon,this._viewer.container.appendChild(this.cursorEl)}};InteractionPromptPlugin.PluginType="InteractionPromptPlugin",InteractionPromptPlugin_decorate([serialize(),uiToggle()],InteractionPromptPlugin.prototype,"enabled",void 0),InteractionPromptPlugin_decorate([serialize(),uiInput()],InteractionPromptPlugin.prototype,"animationDuration",void 0),InteractionPromptPlugin_decorate([serialize(),uiInput()],InteractionPromptPlugin.prototype,"animationDistance",void 0),InteractionPromptPlugin_decorate([serialize(),uiInput()],InteractionPromptPlugin.prototype,"animationPauseDuration",void 0),InteractionPromptPlugin_decorate([serialize(),uiInput()],InteractionPromptPlugin.prototype,"rotationDistance",void 0),InteractionPromptPlugin_decorate([serialize(),uiInput()],InteractionPromptPlugin.prototype,"yOffset",void 0),InteractionPromptPlugin_decorate([serialize(),uiToggle()],InteractionPromptPlugin.prototype,"autoStart",void 0),InteractionPromptPlugin_decorate([serialize(),uiInput()],InteractionPromptPlugin.prototype,"autoStartDelay",void 0),InteractionPromptPlugin_decorate([serialize(),uiToggle()],InteractionPromptPlugin.prototype,"autoStop",void 0),InteractionPromptPlugin_decorate([serialize(),uiToggle()],InteractionPromptPlugin.prototype,"autoStartOnObjectLoad",void 0),InteractionPromptPlugin_decorate([serialize(),uiToggle()],InteractionPromptPlugin.prototype,"autoStartOnObjectLoadDelay",void 0),InteractionPromptPlugin_decorate([uiMonitor()],InteractionPromptPlugin.prototype,"currentTime",void 0),InteractionPromptPlugin_decorate([uiMonitor()],InteractionPromptPlugin.prototype,"lastActionTime",void 0),InteractionPromptPlugin_decorate([serialize()],InteractionPromptPlugin.prototype,"onlyOnOrbitControls",void 0),InteractionPromptPlugin_decorate([uiButton()],InteractionPromptPlugin.prototype,"startAnimation",void 0),InteractionPromptPlugin_decorate([uiButton()],InteractionPromptPlugin.prototype,"stopAnimation",void 0),InteractionPromptPlugin=InteractionPromptPlugin_1=InteractionPromptPlugin_decorate([uiFolder("Interaction Prompt")],InteractionPromptPlugin);var CameraViewPlugin_decorate=function(h,o,c,d){var _,v=arguments.length,b=v<3?o:d===null?d=Object.getOwnPropertyDescriptor(o,c):d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(h,o,c,d);else for(var tt=h.length-1;tt>=0;tt--)(_=h[tt])&&(b=(v<3?_(b):v>3?_(o,c,b):_(o,c))||b);return v>3&&b&&Object.defineProperty(o,c,b),b};let viewId=1,CameraView=class{constructor(h,o,c,d,_=1){this.position=new three_module.Pq0,this.target=new three_module.Pq0,this.quaternion=new three_module.PTz,this.up=new three_module.Pq0,this.duration=1,this.name="Camera View",this.focusView=()=>{},this.deleteView=()=>{},this.updateView=()=>{},this.uiConfig=generateUiFolder(this.name,this),h&&(this.position=h),o&&(this.target=o),c&&(this.up=c),d&&(this.quaternion=d),_!==void 0&&_!==0&&(this.duration=_),this.name="#view"+viewId++}_nameChanged(){var h,o;this.uiConfig&&(this.uiConfig.label=this.name,(o=(h=this.uiConfig).uiRefresh)===null||o===void 0||o.call(h))}};CameraViewPlugin_decorate([serialize(),uiVector()],CameraView.prototype,"position",void 0),CameraViewPlugin_decorate([serialize(),uiVector()],CameraView.prototype,"target",void 0),CameraViewPlugin_decorate([serialize(),uiVector()],CameraView.prototype,"quaternion",void 0),CameraViewPlugin_decorate([serialize(),uiVector()],CameraView.prototype,"up",void 0),CameraViewPlugin_decorate([serialize(),uiInput()],CameraView.prototype,"duration",void 0),CameraViewPlugin_decorate([serialize(),uiInput()],CameraView.prototype,"name",void 0),CameraViewPlugin_decorate([uiButton()],CameraView.prototype,"focusView",void 0),CameraViewPlugin_decorate([uiButton()],CameraView.prototype,"deleteView",void 0),CameraViewPlugin_decorate([uiButton()],CameraView.prototype,"updateView",void 0),CameraView=CameraViewPlugin_decorate([serializable("CameraView")],CameraView);class CameraViewPlugin extends AViewerPlugin{get animationLooping(){return this._animationLooping}get animating(){return this._animating}constructor(){super(),this.enabled=!0,this._cameraViews=[],this.viewLooping=!1,this.viewPauseTime=200,this.animEase="easeInOutSine",this.animDuration=1e3,this.rotationOffset=.25,this.interpolateMode="spherical",this.splineCurve="chordal",this.animateOnScroll=!1,this.seekOnScroll=!1,this._animating=!1,this.dependencies=[],this._scrollAnimationState=0,this.scrollAnimationDamping=.1,this._updaters=[],this._lastFrameTime=0,this._fadeDisabled=!1,this._viewQueue=[],this._animationLooping=!1,this._infiniteLooping=!0,this._driver=o=>({start:()=>this._updaters.push({u:o,time:0}),stop:()=>this._updaters.splice(this._updaters.findIndex(c=>c.u===o),1)}),this.focusNext=(o=!0)=>{if(this._animating||this._cameraViews.length<2)return;let c=this._cameraViews.findIndex(d=>d===this._currentView);c<0&&(c=-1),c+=1,o?c%=this._cameraViews.length:c=Math.min(c,this._cameraViews.length-1),this.focusView(this._cameraViews[c])},this.focusPrevious=(o=!0)=>{if(this._animating||this._cameraViews.length<2||!this._currentView)return;let c=this._cameraViews.findIndex(d=>d===this._currentView);c<0&&(c=0),c-=1,c=o?(c+this._cameraViews.length)%this._cameraViews.length:Math.max(c,0),this.focusView(this._cameraViews[c])},this._popAnimations=[],this.uiConfig={type:"folder",label:"Camera Views",children:[()=>[...this._cameraViews.map(o=>o.uiConfig)],...generateUiConfig(this)]},this.addCurrentView=this.addCurrentView.bind(this),this.animateAllViews=this.animateAllViews.bind(this),this.recordAllViews=this.recordAllViews.bind(this),this.resetToFirstView=this.resetToFirstView.bind(this),this._wheel=this._wheel.bind(this),this._pointerMove=this._pointerMove.bind(this),this._postFrame=this._postFrame.bind(this)}get camViews(){return this._cameraViews}_wheel(o){this.enabled&&(this.seekOnScroll&&!this._animating||Math.abs(o.deltaY)>.001&&(this._scrollAnimationState=-1*Math.sign(o.deltaY)))}_pointerMove(o){var c;if(this.enabled&&!this._animating&&this.seekOnScroll){const d=(c=this._viewer)===null||c===void 0?void 0:c.scene.activeCamera;if(!d)return;const _=new three_module.YHV,v=d.position,b=d.target,tt=new three_module.PTz().setFromUnitVectors(d.cameraObject.up,new three_module.Pq0(0,1,0)),it=tt.clone().invert(),nt=v.clone().sub(b);nt.applyQuaternion(tt),_.setFromVector3(nt),_.theta+=this.rotationOffset*o.movementX/this._viewer.canvas.clientWidth,_.phi+=this.rotationOffset*o.movementY/this._viewer.canvas.clientHeight,_.makeSafe(),nt.setFromSpherical(_),nt.applyQuaternion(it),v.copy(b).add(nt),d.positionUpdated(!1),d.targetUpdated()}}async onAdded(o){await super.onAdded(o),o.addEventListener("preFrame",c=>{this.seekOnScroll||this._animating?this._viewer.scene.activeCamera.setInteractions(!1,CameraViewPlugin.PluginType):this._viewer.scene.activeCamera.setInteractions(!0,CameraViewPlugin.PluginType)}),o.addEventListener("postFrame",this._postFrame),window.addEventListener("wheel",this._wheel),window.addEventListener("pointermove",this._pointerMove)}_postFrame(){var o,c;if(!this._viewer)return;if(!this.enabled||!this._animating)return this._lastFrameTime=0,void(this._fadeDisabled&&((o=this._viewer.getPluginByType("FrameFade"))===null||o===void 0||o.enable(CameraViewPlugin.PluginType),this._fadeDisabled=!1));const d=g()/1e3;this._lastFrameTime<1&&(this._lastFrameTime=d-1/60);let _=d-this._lastFrameTime;this._lastFrameTime=d,_*=this.animateOnScroll?this._scrollAnimationState:1;const v=(c=this._viewer.getPluginByType("Progressive"))===null||c===void 0?void 0:c.postFrameConvergedRecordingDelta();if(v&&v>0&&(_=v),v!==0&&(_*=1e3,!(_<=0||(this._updaters.forEach(b=>{let tt=_;b.time+tt<0&&(tt=-b.time),b.time+=tt,Math.abs(tt)>.001&&b.u(tt)}),this._scrollAnimationState<.001?this._scrollAnimationState=0:this._scrollAnimationState*=1-this.scrollAnimationDamping,this._fadeDisabled)))){const b=this._viewer.getPluginByType("FrameFade");b&&(b.disable(CameraViewPlugin.PluginType),this._fadeDisabled=!0)}}async onRemove(o){return o.removeEventListener("postFrame",this._postFrame),window.removeEventListener("wheel",this._wheel),window.removeEventListener("pointermove",this._pointerMove),super.onRemove(o)}async _animationLoop(){if(!this._animationLooping){for(this._animationLooping=!0;(this.viewLooping||!this._infiniteLooping)&&this.enabled&&!(this._cameraViews.length<1);){if(this._viewQueue.length===0){if(!this._infiniteLooping)break;this._viewQueue.push(...this._cameraViews)}await this.animateToView(this._viewQueue.shift()),await X$2(2+this.viewPauseTime)}this._animationLooping=!1}}async animateAllViews(){if(this.enabled&&!(this.viewLooping||this._cameraViews.length<2)){for(;this._viewQueue.length>0;)this._viewQueue.pop();this._viewQueue.push(...this._cameraViews),this._viewQueue.push(this._viewQueue.shift()),this._infiniteLooping=!1,await this._animationLoop(),this._infiniteLooping=!0}}async resetToFirstView(o=100){this.enabled&&(this._currentView=void 0,await this.animateToView(this._cameraViews[0],o),await X$2(2))}async recordAllViews(o,c=!0){var d;if(!this.enabled)return;const _=(d=this._viewer)===null||d===void 0?void 0:d.getPluginByType("CanvasRecorder");if(!_||!_.enabled||this._cameraViews.length<1)return;if(_.isRecording())return void console.error("CanvasRecorderPlugin is already recording");let v=!1;return this.viewLooping&&(v=!0,this.viewLooping=!1),await this.resetToFirstView(),new Promise((b,tt)=>{const it=()=>{_.removeEventListener("start",nt),_.removeEventListener("stop",it),_.removeEventListener("error",lt)},nt=async()=>{var ut;it(),o==null||o(),await this.animateAllViews();const ht=await _.stopRecording();if(v&&(this.viewLooping=!0),c){const _t=await((ut=this._viewer)===null||ut===void 0?void 0:ut.prompt("Canvas Recorder: Save file as","recording.mp4"));_t!==null&&ht&&await this._downloadBlob(ht,_t||"recording.mp4")}b(ht)},lt=async()=>{it(),tt()};_.addEventListener("start",nt),_.addEventListener("stop",it),_.addEventListener("error",lt),_.startRecording()||console.error("cannot start recording")})}async addCurrentView(){if(!this.enabled)return;const o=this.getCurrentCameraView();this.addView(o)}addView(o){var c,d;this._cameraViews.push(o),(d=(c=this.uiConfig).uiRefresh)===null||d===void 0||d.call(c),this.dispatchEvent({type:"viewAdd",view:o})}getCurrentCameraView(o,c=!0,d){var _,v,b;if(o||(o=(_=this._viewer)===null||_===void 0?void 0:_.scene.activeCamera),!o)return new CameraView;const tt=new three_module.Pq0;o.cameraObject.updateWorldMatrix(!0,!1);const it=o.cameraObject.matrixWorld;tt.x=it.elements[4],tt.y=it.elements[5],tt.z=it.elements[6],tt.normalize();const nt=o.target.clone(),lt=o.position.clone(),ut=o.cameraObject.parent;ut&&(c?lt.applyMatrix4(ut.matrixWorld):tt.transformDirection(ut.matrixWorld.clone().invert()));const ht=c?o.cameraObject.getWorldQuaternion(new three_module.PTz):o.cameraObject.quaternion.clone();return d?(d.position.copy(lt),d.target.copy(nt),d.up.copy(tt),d.quaternion.copy(ht)):((d=new CameraView(lt,nt,tt,ht,1)).focusView=async()=>d&&this.focusView(d),d.deleteView=()=>d&&this.deleteView(d),d.updateView=()=>this.getCurrentCameraView(o,c,d)),(b=(v=d.uiConfig).uiRefresh)===null||b===void 0||b.call(v,"postFrame",!0),d}setCurrentCameraView(o){var c;const d=(c=this._viewer)===null||c===void 0?void 0:c.scene.activeCamera;d&&(d.position.copy(o.position),d.target.copy(o.target),d.cameraObject.quaternion.copy(o.quaternion),d.positionUpdated())}async focusView(o){return this.animateToView(o)}deleteView(o){var c,d;const _=this._cameraViews.indexOf(o);_>=0&&this._cameraViews.splice(_,1),(d=(c=this.uiConfig).uiRefresh)===null||d===void 0||d.call(c),this.dispatchEvent({type:"viewDelete",view:o})}async stopAllAnimations(){for(this.viewLooping=!1,this._popAnimations.forEach(o=>{var c;return(c=o==null?void 0:o.stop)===null||c===void 0?void 0:c.call(o)}),this._popAnimations=[];this._animating||this._animationLooping;)await X$2(100)}async animateToView(o,c,d,_=!1){var v,b,tt;const it=(v=this._viewer)===null||v===void 0?void 0:v.scene.activeCamera;if(!it)return;if(this._animating){this._popAnimations.forEach(St=>(St==null?void 0:St.stop)&&St.stop()),this._popAnimations=[];let xt=0;for(;this._animating&&(await X$2(100),!(xt++>20)););if(this._animating)return void console.warn("Unable to stop all animations, maybe because of viewLooping?")}const nt=(b=this._viewer)===null||b===void 0?void 0:b.getPlugin(InteractionPromptPlugin);nt&&nt.animationRunning&&await nt.stopAnimation({reset:!0}),this._currentView=o,this._animating=!0,this.dispatchEvent({type:"startViewChange",view:o}),c===void 0&&(c=this.animDuration),c=Math.max(10,c);const lt=typeof d=="function"?d:EasingFunctions[d||this.animEase],ut=this._driver,ht=[];this._popAnimations=[];const _t=this._popAnimations,ft=this.camViews.indexOf(o);let bt=this.interpolateMode;if(ft<0&&bt==="spline"&&(console.warn("CameraViewPlugin - Cannot animate along a spline with external camera view, fallback to spherical"),bt="spherical"),bt==="spherical")ht.push(animateCameraToViewSpherical(it,o,c*o.duration,lt,ut,_t));else if(bt==="linear"){ht.push(animateAsync({from:it.position.clone(),to:o.position.clone(),duration:c*o.duration,ease:lt,driver:ut,onUpdate:wt=>it.position=wt,onComplete:()=>it.position=o.position,onStop:()=>{throw new Error("Animation stopped")}},_t)),ht.push(animateAsync({from:it.target.clone(),to:o.target.clone(),duration:c*o.duration,ease:lt,driver:ut,onUpdate:wt=>{it.target=wt,it.targetUpdated()},onComplete:()=>{it.target=o.target,it.targetUpdated()}},_t));const xt=it.cameraObject.quaternion.clone(),St=new three_module.PTz;ht.push(animateAsync({from:0,to:1,duration:c*o.duration,ease:lt,driver:ut,onUpdate:wt=>{St.copy(xt).slerp(o.quaternion,wt),it.cameraObject.quaternion.copy(St),it.cameraObject.updateProjectionMatrix()},onComplete:()=>{it.cameraObject.quaternion.copy(o.quaternion),it.cameraObject.updateProjectionMatrix()}},_t))}else if(bt==="spline"){const xt=this.camViews.map(Pt=>Pt.position.clone()),St=new three_module.B6O(xt,!0,this.splineCurve,.75),wt=Pt=>{const Rt=new three_module.Pq0,kt=1/xt.length,Gt=((ft===0?xt.length:ft)-1)*kt;return St.getPointAt(Gt+Pt*kt,Rt),Rt};ht.push(animateAsync({from:0,to:1,duration:c*o.duration,ease:lt,driver:ut,onUpdate:Pt=>it.position=wt(Pt),onComplete:()=>it.position=wt(1),onStop:()=>{throw new Error("Animation stopped")}},_t)),ht.push(animateAsync({from:it.target.clone(),to:o.target.clone(),duration:c*o.duration,ease:lt,driver:ut,onUpdate:Pt=>{it.target=Pt,it.targetUpdated()},onComplete:()=>{it.target=o.target,it.targetUpdated()}},_t))}await Promise.allSettled(ht).catch(xt=>{if(_)throw xt}),(tt=this._viewer)===null||tt===void 0||tt.setDirty(),this._animating=!1,this.dispatchEvent({type:"viewChange",view:o}),await X$2(10)}fromJSON(o,c){var d,_;return this._cameraViews.forEach(v=>this.deleteView(v)),super.fromJSON(o,c)?(this._cameraViews.forEach(v=>v.focusView=async()=>this.focusView(v)),this._cameraViews.forEach(v=>v.deleteView=()=>this.deleteView(v)),this._cameraViews.forEach(v=>v.updateView=()=>this.getCurrentCameraView(void 0,void 0,v)),(_=(d=this.uiConfig).uiRefresh)===null||_===void 0||_.call(d),this):null}async animateToObject(o,c=4,d,_,v={min:.5,max:5}){if(!this._viewer)return;const b=new Box3B().expandByObject(o||this._viewer.scene.modelRoot.modelObject,!1,!0),tt=b.getCenter(new three_module.Pq0),it=b.getSize(new three_module.Pq0).length()/2;await this.animateToTarget(Math.min(v.max,Math.max(v.min,it*c)),tt,d,_)}async animateToFitObject(o,c=1.5,d=1e3,_,v={min:.5,max:50}){if(!this._viewer)return;const b=new Box3B().expandByObject(o||this._viewer.scene.modelRoot.modelObject,!1,!0),tt=b.getCenter(new three_module.Pq0),it=this._viewer.scene.activeCamera.getFittingDistance(b);await this.animateToTarget(Math.min(v.max,Math.max(v.min,it*c)),tt,d,_)}async animateToTarget(o,c,d,_){const v=this.getCurrentCameraView();v.target.copy(c);const b=new three_module.Pq0().subVectors(v.target,v.position).normalize();v.position.copy(b.multiplyScalar(-o).add(v.target)),await this.animateToView(v,d,_)}async _downloadBlob(o,c){var d,_;const v=(d=this._viewer)===null||d===void 0?void 0:d.getPluginByType("FileTransferPlugin");v?await v.exportFile(o,c):(_=this._viewer)===null||_===void 0||_.console.error("FileTransferPlugin required to export/download file")}}function sphericalFromObject(h,o){const c=h.position.clone();c.sub(o);const d=new three_module.YHV().setFromVector3(c);return d.makeSafe(),d}async function animateCameraToViewSpherical(h,o,c,d,_,v,b){const tt=h.target.clone(),it=new three_module.Pq0,nt=new three_module.Pq0,lt=h.cameraObject.parent,ut=h.cameraObject.up.clone(),ht=sphericalFromObject({position:h.cameraObject.getWorldPosition(new three_module.Pq0),up:lt?ut.transformDirection(lt.matrixWorld):ut},tt),_t=sphericalFromObject(o,o.target),ft=new three_module.YHV;function bt(){h.position.copy(lt?lt.worldToLocal(nt):nt),h.target.copy(it),h.positionUpdated()}return animateAsync({from:0,to:1,duration:c,ease:d,driver:_,...b,onUpdate:xt=>{ft.phi=lerpAngle(ht.phi,_t.phi,xt),ft.theta=lerpAngle(ht.theta,_t.theta,xt),ft.radius=three_module.cj9.lerp(ht.radius,_t.radius,xt),it.copy(tt).lerp(o.target,xt),nt.setFromSpherical(ft),nt.add(it),bt()},onComplete:()=>{nt.copy(o.position),it.copy(o.target),bt()},onStop:()=>{throw new Error("Animation Stopped")}},v)}function lerpAngle(h,o,c){const d=o-h;return d>=Math.PI?h+(d-2*Math.PI)*c:d<=-Math.PI?h+(d+2*Math.PI)*c:h+d*c}function lerpAngle2(h,o,c){const d=(1-c)*Math.cos(h)+c*Math.cos(o),_=(1-c)*Math.sin(h)+c*Math.sin(o);return Math.atan2(_,d)}CameraViewPlugin.PluginType="CameraViews",CameraViewPlugin_decorate([serialize("cameraViews")],CameraViewPlugin.prototype,"_cameraViews",void 0),CameraViewPlugin_decorate([x$1(CameraViewPlugin.prototype._animationLoop),serialize(),uiToggle("Loop All Views",{limitedUi:!0})],CameraViewPlugin.prototype,"viewLooping",void 0),CameraViewPlugin_decorate([serialize(),uiInput("View Pause Time")],CameraViewPlugin.prototype,"viewPauseTime",void 0),CameraViewPlugin_decorate([serialize(),uiDropdown("Ease",Object.keys(EasingFunctions).map(h=>({label:h})))],CameraViewPlugin.prototype,"animEase",void 0),CameraViewPlugin_decorate([serialize(),uiSlider("Duration",[10,1e4],10,{limitedUi:!0})],CameraViewPlugin.prototype,"animDuration",void 0),CameraViewPlugin_decorate([serialize(),uiSlider("RotationOffset",[.2,.75],.01)],CameraViewPlugin.prototype,"rotationOffset",void 0),CameraViewPlugin_decorate([serialize(),uiDropdown("Interpolation",["spherical","linear","spline (dev)"].map(h=>({label:h,value:h.split(" ")[0]})))],CameraViewPlugin.prototype,"interpolateMode",void 0),CameraViewPlugin_decorate([serialize(),uiDropdown("Spline Curve",["centripetal","chordal","catmullrom"].map(h=>({label:h})),h=>({hidden:()=>h.interpolateMode!=="spline",onChange:()=>{var o,c;return(c=(o=h.uiConfig)===null||o===void 0?void 0:o.uiRefresh)===null||c===void 0?void 0:c.call(o)}}))],CameraViewPlugin.prototype,"splineCurve",void 0),CameraViewPlugin_decorate([uiToggle(),serialize()],CameraViewPlugin.prototype,"seekOnScroll",void 0),CameraViewPlugin_decorate([uiButton("Animate All Views",{limitedUi:!0})],CameraViewPlugin.prototype,"animateAllViews",null),CameraViewPlugin_decorate([uiButton("Record All Views")],CameraViewPlugin.prototype,"recordAllViews",null),CameraViewPlugin_decorate([uiButton("Add Current View")],CameraViewPlugin.prototype,"addCurrentView",null),CameraViewPlugin_decorate([uiButton("Focus Next")],CameraViewPlugin.prototype,"focusNext",void 0),CameraViewPlugin_decorate([uiButton("Focus Previous")],CameraViewPlugin.prototype,"focusPrevious",void 0);const tempVec=new three_module.Pq0;function slerp(h,o,c){let d=h.dot(o);d=Math.min(Math.max(d,-1),1);const _=Math.acos(d)*c;return tempVec.copy(h).multiplyScalar(d).sub(o).negate().normalize(),h.multiplyScalar(Math.cos(_)).add(tempVec.multiplyScalar(Math.sin(_)))}var vignette="vec4 Vignette(in vec4 color){vec2 uv=vUv*(1.-vUv);float vig=uv.x*uv.y*16.;vig=pow(abs(vig),power);return vec4(mix(color.rgb,vec3(bgcolor),1.-vig),color.a);}",VignettePlugin_decorate=function(h,o,c,d){var _,v=arguments.length,b=v<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(h,o,c,d);else for(var tt=h.length-1;tt>=0;tt--)(_=h[tt])&&(b=(v<3?_(b):v>3?_(o,c,b):_(o,c))||b);return v>3&&b&&Object.defineProperty(o,c,b),b};let VignetteExtension=class{constructor(h){this.enabled=!1,this.power=.5,this.bgcolor=new three_module.Q1f(0),this.extraUniforms={power:{value:.5},bgcolor:{value:new three_module.Q1f}},this.parsFragmentSnippet=(o,c)=>this.enabled?fe$1`
            uniform float power;
            uniform vec3 bgcolor;
            ${vignette}
        `:"",this._combinedPostPlugin=h.getPlugin(CombinedPostPlugin),this._setDirty=this._setDirty.bind(this)}shaderExtender(h,o,c){this.enabled&&(h.fragmentShader=shaderReplaceString(h.fragmentShader,"#glMarker",` 
            gl_FragColor = Vignette(gl_FragColor);
            #glMarker
        `))}onObjectRender(h,o,c){this.enabled&&(this.extraUniforms.power.value=this.power,this.extraUniforms.bgcolor.value.copy(this.bgcolor))}getUiConfig(){return this.uiConfig}computeCacheKey(h){return this.enabled?"1":"0"}isCompatible(h){return!0}_setDirty(){this._combinedPostPlugin&&(this._combinedPostPlugin.pass.dirty=!0)}setDirty(){var h;(h=this.__setDirty)===null||h===void 0||h.call(this),this._setDirty()}};VignetteExtension.PluginType="Vignette",VignettePlugin_decorate([x$1(VignetteExtension.prototype._setDirty),uiToggle("Enable"),serialize()],VignetteExtension.prototype,"enabled",void 0),VignettePlugin_decorate([x$1(VignetteExtension.prototype._setDirty),uiSlider("Power",[.1,4],.01,{limitedUi:!0}),serialize()],VignetteExtension.prototype,"power",void 0),VignettePlugin_decorate([x$1(VignetteExtension.prototype._setDirty),uiColor("Color"),serialize()],VignetteExtension.prototype,"bgcolor",void 0),VignetteExtension=VignettePlugin_decorate([uiFolder("Vignette")],VignetteExtension);class VignettePlugin extends GenericExtensionPlugin{constructor(){super()}generateExtension(o){return new VignetteExtension(o)}get power(){var o,c;return(c=(o=this._extension)===null||o===void 0?void 0:o.power)!==null&&c!==void 0?c:1}set power(o){this._extension&&(this._extension.power=o,this._extension.setDirty())}get color(){var o,c;return(c=(o=this._extension)===null||o===void 0?void 0:o.bgcolor)!==null&&c!==void 0?c:new three_module.Q1f}set color(o){this._extension&&(this._extension.bgcolor.set(o),this._extension.setDirty())}}VignettePlugin.PluginType="Vignette";var ssVelocityVert=`#ifdef USE_ALPHAMAP
#define USE_UV 
#endif
#include <uv_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec3 vWorldPosition;varying vec3 vWorldPositionPrevious;uniform mat4 modelMatrixPrevious;void main(){
#include <uv_vertex>
#include <skinbase_vertex>
#include <begin_vertex>
#include <morphtarget_vertex>
#include <skinning_vertex>
#include <displacementmap_vertex>
vec4 mvPosition=vec4(transformed,1.);
#ifdef USE_INSTANCING
mvPosition=instanceMatrix*mvPosition;
#endif
vWorldPosition=(modelMatrix*mvPosition).xyz;vWorldPositionPrevious=(modelMatrixPrevious*mvPosition).xyz;mvPosition=modelViewMatrix*mvPosition;gl_Position=projectionMatrix*mvPosition;
#include <logdepthbuf_vertex>
#include <clipping_planes_vertex>
}`,ssVelocityFrag="varying vec3 vWorldPosition;varying vec3 vWorldPositionPrevious;uniform mat4 currentProjectionViewMatrix;uniform mat4 lastProjectionViewMatrix;vec2 computeScreenSpaceVelocity2(){vec4 currentPositionClip=currentProjectionViewMatrix*vec4(vWorldPosition,1.);vec4 prevPositionClip=lastProjectionViewMatrix*vec4(vWorldPositionPrevious,1.);vec2 currentPositionNDC=currentPositionClip.xy/currentPositionClip.w;vec2 prevPositionNDC=prevPositionClip.xy/prevPositionClip.w;if(prevPositionNDC.x>=1.||prevPositionNDC.x<=-1.||prevPositionNDC.x>=1.||prevPositionNDC.y<=-1.){return vec2(0.);}return 0.5*(currentPositionNDC-prevPositionNDC);}void main(){vec2 velocity=clamp(computeScreenSpaceVelocity2(),-1.,1.);velocity=sign(velocity)*pow(abs(velocity),vec2(1./4.));velocity=velocity*0.5+0.5;gl_FragColor=vec4(velocity.x,velocity.y,1.,1.);}",SSVelocityPass_decorate=function(h,o,c,d){var _,v=arguments.length,b=v<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(h,o,c,d);else for(var tt=h.length-1;tt>=0;tt--)(_=h[tt])&&(b=(v<3?_(b):v>3?_(o,c,b):_(o,c))||b);return v>3&&b&&Object.defineProperty(o,c,b),b};let SSVelocityPass=class extends RenderPass{constructor(h,o,c){super(h,o,c??new SSVelocityMaterial,new three_module.Q1f(.5,.5,.5),1),this.enabled=!0,this._firstCall=!0}render(h,o,c,d,_){if(!this.enabled||!this.camera)return;const v=this.overrideMaterial;v.uniforms.currentProjectionViewMatrix.value.copy(this.camera.projectionMatrix).multiply(this.camera.matrixWorldInverse),this._firstCall&&(v.uniforms.lastProjectionViewMatrix.value.copy(v.uniforms.currentProjectionViewMatrix.value),this._firstCall=!1),super.render(h,o,c,d,_),v.uniforms.lastProjectionViewMatrix.value.copy(v.uniforms.currentProjectionViewMatrix.value)}};SSVelocityPass_decorate([uiToggle("Enabled")],SSVelocityPass.prototype,"enabled",void 0),SSVelocityPass=SSVelocityPass_decorate([uiFolder("Velocity Buffer (TAA)")],SSVelocityPass);class SSVelocityMaterial extends three_module.BKk{constructor(){super({vertexShader:ssVelocityVert,fragmentShader:ssVelocityFrag,uniforms:{cameraNearFar:{value:new three_module.I9Y(.1,1e3)},alphaMap:{value:null},alphaTest:{value:null},alphaMapTransform:{value:new three_module.dwI},currentProjectionViewMatrix:{value:new three_module.kn4},lastProjectionViewMatrix:{value:new three_module.kn4}}}),this.extraUniformsToUpload={modelMatrixPrevious:{value:new three_module.kn4().identity()}},this._previousWorldMatrices={}}onBeforeRender(o,c,d,_,v){var b,tt;const it=this._previousWorldMatrices[v.uuid];this.extraUniformsToUpload.modelMatrixPrevious.value.copy(it??v.matrixWorld),it?it.copy(v.matrixWorld):this._previousWorldMatrices[v.uuid]=v.matrixWorld.clone();let nt=v.material;Array.isArray(nt)&&(nt=nt[0]),this.uniforms.alphaMap.value=(b=nt==null?void 0:nt.alphaMap)!==null&&b!==void 0?b:null,this.uniforms.alphaTest.value=!nt||!nt.alphaTest||nt.alphaTest<1e-7?.001:nt.alphaTest;let lt=this.uniforms.alphaMap.value?1:void 0;lt!==this.defines.USE_ALPHAMAP&&(lt===void 0?delete this.defines.USE_ALPHAMAP:this.defines.USE_ALPHAMAP=lt,this.needsUpdate=!0),lt=nt.userData.ALPHA_I_RGBA_PACKING?1:void 0,lt!==this.defines.ALPHA_I_RGBA_PACKING&&(lt===void 0?delete this.defines.ALPHA_I_RGBA_PACKING:this.defines.ALPHA_I_RGBA_PACKING=lt,this.needsUpdate=!0),this.side=(tt=nt.side)!==null&&tt!==void 0?tt:three_module.$EB}}class VelocityBufferPlugin extends GenericFilterPlugin{passCtor(o){const c=o.renderer.createTarget({depthBuffer:!0,type:three_module.OUM});c.texture.name="velocityBuffer",this._velocityBuffers.push(c),o.getPluginByType("debug");const d=new Set,_=new Set;return new class extends SSVelocityPass{render(v,b,tt,it,nt){var lt;if(o.renderer.frameCount>0)return;const ut=v.getRenderTarget(),ht=v.getActiveCubeFace(),_t=v.getActiveMipmapLevel();(lt=this.scene)===null||lt===void 0||lt.traverse(({material:ft})=>{var bt,xt;if(!ft)return;const St=ft.userData.renderToDepth&&!ft.userData.pluginsDisabled&&!(!((bt=ft.userData[VelocityBufferPlugin.PluginType])===null||bt===void 0)&&bt.disabled),wt=ft.userData.renderToDepth===!1||ft.userData.pluginsDisabled||((xt=ft.userData[VelocityBufferPlugin.PluginType])===null||xt===void 0?void 0:xt.disabled);(ft.transparent&&St||!ft.transparent&&!ft.transmission&&wt)&&(d.add(ft),ft.transparent=!ft.transparent),Math.abs(ft.transmission||0)>0&&St&&(_.add([ft,ft.transmission]),ft.transmission=0)}),setThreeRendererMode(v,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!0,transparentRender:!1,transmissionRender:!1,mainRenderPass:!1},()=>super.render(v,b,c,it,nt)),d.forEach(ft=>ft.transparent=!ft.transparent),d.clear(),_.forEach(([ft,bt])=>ft.transmission=bt),_.clear(),v.setRenderTarget(ut,ht,_t)}}}_update(o){if(!super._update(o)||o.renderer.frameCount>0)return!1;const c=this.pass.passObject;return c.scene=o.scene.modelObject,o.scene.renderCamera.updateShaderProperties(c.overrideMaterial),c.camera=o.scene.renderCamera.cameraObject,!0}constructor(o=!0){super(),this.passId="velocityBuffer",this._beforeFilters=["render"],this._afterFilters=[],this._requiredFilters=["render"],this._velocityBuffers=[],this.enabled=o}getVelocityBuffer(){return this._velocityBuffers.length>0?this._velocityBuffers[0]:void 0}async onDispose(o){}async onRemove(o){return this._velocityBuffers.forEach(c=>{var d;return o.renderer.disposeTarget((d=c==null?void 0:c.dispose)===null||d===void 0?void 0:d.call(c))}),super.onRemove(o)}updateShaderProperties(o){var c,d;return o.uniforms.tVelocity?o.uniforms.tVelocity.value=this.enabled&&(d=(c=this.getVelocityBuffer())===null||c===void 0?void 0:c.texture)!==null&&d!==void 0?d:null:console.warn("BaseRenderer: no uniform: tVelocity"),this}get uiConfig(){var o;return(o=this.pass)===null||o===void 0?void 0:o.passObject.uiConfig}}VelocityBufferPlugin.PluginType="VelocityBuffer";var lut=`#if (USE_LUT == 1 || USE_LUT1 == 1 || USE_LUT2 == 1)
uniform float lutSize;uniform float lutSize1;uniform float lutSize2;uniform float intensity;
#if USE_3DTEXTURE == 1
precision highp sampler3D;
#if USE_LUT == 1
uniform sampler3D lut3d;
#endif
#if USE_LUT1 == 1
uniform sampler3D lut3d1;
#endif
#if USE_LUT2 == 1
uniform sampler3D lut3d2;
#endif
#else
#if USE_LUT == 1
uniform sampler2D lut2d;
#endif
#if USE_LUT1 == 1
uniform sampler2D lut2d1;
#endif
#if USE_LUT2 == 1
uniform sampler2D lut2d2;
#endif
vec3 lutLookup(sampler2D tex,float size,vec3 rgb){float sliceHeight=1./size;float yPixelHeight=1./(size*size);float slice=rgb.b*size;float interp=fract(slice);float slice0=slice-interp;float centeredInterp=interp-0.5;float slice1=slice0+sign(centeredInterp);float greenOffset=clamp(rgb.g*sliceHeight,yPixelHeight*0.5,sliceHeight-yPixelHeight*0.5);vec2 uv0=vec2(rgb.r,slice0*sliceHeight+greenOffset);vec2 uv1=vec2(rgb.r,slice1*sliceHeight+greenOffset);vec3 sample0=texture2D(tex,uv0).rgb;vec3 sample1=texture2D(tex,uv1).rgb;return mix(sample0,sample1,abs(centeredInterp));}
#endif
int getLUTBit(in int number){
#ifdef WebGL2Context
return number%2;
#else
return int(mod(float(number),2.));
#endif
}int getLUTIndex(in int number){
#ifdef WebGL2Context
return number%8;
#else
return int(mod(float(number),8.));
#endif
}vec3 getUVW(in float lutSize,in vec4 color){float pixelWidth=1./lutSize;float halfPixelWidth=0.5/lutSize;vec3 uvw=vec3(halfPixelWidth)+color.rgb*(1.-pixelWidth);return uvw;}vec4 colorLookUp(in vec4 color){vec4 outColor;float lutFac=float(getLUTBit(getGBufferFlags(vUv).a));float lutIndex=float(getLUTIndex(getGBufferFlags(vUv).g));
#if USE_3DTEXTURE == 1
if(lutIndex==0.){
#if USE_LUT == 1
outColor=vec4(texture(lut3d,getUVW(lutSize,color)).rgb,color.a);
#endif
}else if(lutIndex==1.){
#if USE_LUT1 == 1
outColor=vec4(texture(lut3d1,getUVW(lutSize1,color)).rgb,color.a);
#endif
}else if(lutIndex==2.){
#if USE_LUT2 == 1
outColor=vec4(texture(lut3d2,getUVW(lutSize2,color)).rgb,color.a);
#endif
}else{
#if USE_LUT == 1
outColor=vec4(texture(lut3d,getUVW(lutSize,color)).rgb,color.a);
#endif
}
#else
if(lutIndex==0.){outColor=vec4(lutLookup(lut2d,lutSize,getUVW(lutSize,color)),color.a);}else if(lutIndex==1.){
#if USE_LUT1 == 1
outColor=vec4(lutLookup(lut2d1,lutSize,getUVW(lutSize1,color)),color.a);
#endif
}else if(lutIndex==2.){
#if USE_LUT2 == 1
outColor=vec4(lutLookup(lut2d2,lutSize,getUVW(lutSize2,color)),color.a);
#endif
}else{outColor=vec4(lutLookup(lut2d,lutSize,getUVW(lutSize,color)),color.a);}
#endif
outColor=mix(color,outColor,lutFac);return vec4(mix(color,outColor,intensity));}
#endif
`,LUTPlugin_decorate=function(h,o,c,d){var _,v=arguments.length,b=v<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(h,o,c,d);else for(var tt=h.length-1;tt>=0;tt--)(_=h[tt])&&(b=(v<3?_(b):v>3?_(o,c,b):_(o,c))||b);return v>3&&b&&Object.defineProperty(o,c,b),b};let LUTExtension=class{constructor(h){this.enabled=!1,this.lutBackground=!0,this.intensity=1,this.lutMap=void 0,this.lutMap1=void 0,this.lutMap2=void 0,this.extraUniforms={intensity:{value:1},lutSize:{value:1},lutSize1:{value:1},lutSize2:{value:1},lut3d:{value:null},lut3d1:{value:null},lut3d2:{value:null},lut2d:{value:null},lut2d1:{value:null},lut2d2:{value:null}},this.extraDefines={USE_LUT:0,USE_LUT1:0,USE_LUT2:0,USE_3DTEXTURE:0,LUT_BACKGROUND:0},this.parsFragmentSnippet=(o,c)=>this.enabled?lut:"",this._viewer=h,this._combinedPostPlugin=h.getPlugin(CombinedPostPlugin),this._setDirty=this._setDirty.bind(this),this.setDirty=this.setDirty.bind(this)}_updateParams(){if(!this.enabled)return;const h=this._viewer.renderer.rendererObject.capabilities.isWebGL2?1:0;let o=h?this.extraUniforms.lut3d:this.extraUniforms.lut2d;this._updateLUTMap(this.lutMap,o,this.extraUniforms.lutSize,h),this.extraDefines.USE_LUT=this.lutMap?1:0,o=h?this.extraUniforms.lut3d1:this.extraUniforms.lut2d1,this._updateLUTMap(this.lutMap1,o,this.extraUniforms.lutSize1,h),this.extraDefines.USE_LUT1=this.lutMap1?1:0,o=h?this.extraUniforms.lut3d2:this.extraUniforms.lut2d2,this._updateLUTMap(this.lutMap2,o,this.extraUniforms.lutSize2,h),this.extraDefines.USE_LUT2=this.lutMap2?1:0,this.extraUniforms.intensity.value=this.intensity,this.extraDefines.LUT_BACKGROUND=this.lutBackground?1:0,this.extraDefines.USE_3DTEXTURE=h,this._setDirty()}_updateLUTMap(h,o,c,d){if(h){let _=1;d==1?(o.value=h.texture3D,_=h.texture3D.image.width):h.texture&&(o.value=h.texture,_=h.texture.image.width),o.value.needsUpdate=!0,c.value=_}}shaderExtender(h,o,c){this.enabled&&(h.fragmentShader=shaderReplaceString(h.fragmentShader,"#glMarker",` 
            #if USE_LUT == 1
                bool isBackground = getDepth(vUv)>0.9999;
                #if LUT_BACKGROUND == 1
                    gl_FragColor = colorLookUp(gl_FragColor);
                #else
                    gl_FragColor = isBackground ? gl_FragColor : colorLookUp(gl_FragColor);
                #endif
            #endif
            #glMarker
        `))}computeCacheKey(h){return this.enabled?"1":"0"}isCompatible(h){return!0}_setDirty(){var h;(h=this.__setDirty)===null||h===void 0||h.call(this),this._combinedPostPlugin&&(this._combinedPostPlugin.pass.dirty=!0)}setDirty(){this._setDirty()}};function addLUTData(h){const o=h==null?void 0:h.userData;if(!o)return!1;o[LUTPlugin.PluginType]||(o[LUTPlugin.PluginType]={});const c=o[LUTPlugin.PluginType];return c.enable=!0,c.index===void 0&&(c.index=0),h.isMaterial&&(h.needsUpdate=!0),!0}LUTPlugin_decorate([serialize(),x$1(LUTExtension.prototype._updateParams),uiToggle("Enable")],LUTExtension.prototype,"enabled",void 0),LUTPlugin_decorate([serialize(),x$1(LUTExtension.prototype._updateParams),uiToggle("LUT Background")],LUTExtension.prototype,"lutBackground",void 0),LUTPlugin_decorate([serialize(),x$1(LUTExtension.prototype._updateParams),uiSlider("Intensity")],LUTExtension.prototype,"intensity",void 0),LUTPlugin_decorate([x$1(LUTExtension.prototype._updateParams),uiImage("LUT"),serialize()],LUTExtension.prototype,"lutMap",void 0),LUTPlugin_decorate([x$1(LUTExtension.prototype._updateParams),uiImage("LUT1"),serialize()],LUTExtension.prototype,"lutMap1",void 0),LUTPlugin_decorate([x$1(LUTExtension.prototype._updateParams),uiImage("LUT2"),serialize()],LUTExtension.prototype,"lutMap2",void 0),LUTExtension=LUTPlugin_decorate([uiFolder("LUT")],LUTExtension);class LUTPlugin extends GenericExtensionPlugin{_getUiConfig(o){var c,d;const _={type:"folder",label:"LUT",children:[{type:"checkbox",label:"Enabled",get value(){var v,b;return(b=(v=o.materialObject.userData[LUTPlugin.PluginType])===null||v===void 0?void 0:v.enable)===null||b===void 0||b},set value(v){var b;const tt=o.materialObject.userData[LUTPlugin.PluginType];v!==(tt==null?void 0:tt.enable)&&(tt||addLUTData(o.materialObject),o.materialObject.userData[LUTPlugin.PluginType].enable=v,(b=_.uiRefresh)===null||b===void 0||b.call(_,"postFrame",!0))},onChange:(c=this._extension)===null||c===void 0?void 0:c.setDirty},{type:"dropdown",children:[["LUT 0",0],["LUT 1",1],["LUT 2",2]].map(v=>({label:v[0],value:v[1]})),label:"index",hidden:()=>{const v=o.materialObject.userData[LUTPlugin.PluginType];return!!v&&!v.enable},get value(){var v,b;return(b=(v=o.materialObject.userData[LUTPlugin.PluginType])===null||v===void 0?void 0:v.index)!==null&&b!==void 0?b:0},set value(v){var b;o.materialObject.userData[LUTPlugin.PluginType]||addLUTData(o.materialObject),o.materialObject.userData[LUTPlugin.PluginType].index=v,(b=_.uiRefresh)===null||b===void 0||b.call(_,"postFrame",!0)},onChange:(d=this._extension)===null||d===void 0?void 0:d.setDirty}]};return _}constructor(){super(),this.materialExtension={uuid:esm_browser_v4(),getUiConfig:o=>{if(o.__uiConfigs||(o.__uiConfigs={}),o.__uiConfigs[this.materialExtension.uuid])return o.__uiConfigs[this.materialExtension.uuid];const c=this._getUiConfig(o);return o.__uiConfigs[this.materialExtension.uuid]=c,c},computeCacheKey:o=>{var c;return(this.enabled?"1":"0")+(!((c=o.materialObject.userData[LUTPlugin.PluginType])===null||c===void 0)&&c.enable?"1":"0")},isCompatible:o=>!0},this.updateGBuffer=this.updateGBuffer.bind(this)}async onAdded(o){var c,d;await super.onAdded(o),(c=o.getPlugin(GBufferPlugin))===null||c===void 0||c.registerGBufferUpdater(this.updateGBuffer);const _=o.getPlugin(AssetManagerPlugin);(d=_==null?void 0:_.materials)===null||d===void 0||d.registerMaterialExtension(this.materialExtension)}generateExtension(o){return new LUTExtension(o)}updateGBuffer(o,c){var d,_;if(o instanceof three_module.eaF&&!((d=o.material)===null||d===void 0)&&d.userData){const v=(_=o.material)===null||_===void 0?void 0:_.userData[LUTPlugin.PluginType];if(v){const b=v.enable===!1?0:1;c.w=updateBit(c.w,0,b);for(let it=0;it<3;it++)c.y=clearBit(c.y,it);let tt=v.enable?v.index:0;tt=Math.min(tt,7),c.y=c.y|tt}else c.w=updateBit(c.w,0,1)}}}LUTPlugin.PluginType="LUTPlugin1";class GyroInputDevice{constructor(o){this._zee=new three_module.Pq0(0,0,1),this._euler=new three_module.O9p,this._q0=new three_module.PTz,this._q1=new three_module.PTz(-Math.sqrt(.5),0,0,Math.sqrt(.5)),this._q2=new three_module.PTz,this._initQuaternionDest=new three_module.PTz,this.onScreenOrientationChangeEvent=()=>{this.screenOrientation=screen.orientation},this.onDeviceOrientationChangeEvent=c=>{this.deviceOrientation=c},this._isConnected=!1,this._viewer=o}getOffsetFromCenter(o=!0){if(!this.deviceOrientation)return new three_module.I9Y;this.getQuaternion(o,this._q2);const c=new three_module.Pq0(0,0,1);return c.applyQuaternion(this._q2),new three_module.I9Y(c.x,c.y)}getQuaternion(o,c){if(c||(c=new three_module.PTz),!this.deviceOrientation)return c.identity();const d=this.deviceOrientation,_=d.alpha!==null?three_module.cj9.degToRad(d.alpha):0,v=d.beta!==null?three_module.cj9.degToRad(d.beta):0,b=d.gamma!==null?three_module.cj9.degToRad(d.gamma):0,tt=this.screenOrientation?three_module.cj9.degToRad(this.screenOrientation.angle):0;return this._toQuaternion(c,_,v,b,tt,o),c}_toQuaternion(o,c,d,_,v,b){this._euler.set(d,c,-_,"YXZ"),o.setFromEuler(this._euler),o.multiply(this._q1);const tt=document.getElementById("debug");return tt&&(tt.textContent=v+""),o.multiply(this._q0.setFromAxisAngle(this._zee,-v)),this._initQuaternionDest.__init||(this._initQuaternionDest.copy(o).invert(),this._initQuaternionDest.__init=!0),b&&o.premultiply(this._initQuaternionDest),o}static IsCompatible(){return window.DeviceOrientationEvent!==void 0&&"ontouchstart"in window}addPermissionMessage(){this.permissionMessage=document.createElement("div"),this.permissionMessage.innerHTML="Tap on the screen to allow gyroscope",this.permissionMessage.style.visibility="visible",this.permissionMessage.style.width="100%",this.permissionMessage.style.height="40px",this.permissionMessage.style.color="black",this.permissionMessage.style.position="absolute",this.permissionMessage.style.textAlign="center",this.permissionMessage.style.fontSize="12px",this.permissionMessage.style.bottom="20%",this._viewer.container.appendChild(this.permissionMessage)}connect(){var o;if(!this._isConnected)return this._isConnected=!0,this.onScreenOrientationChangeEvent(),!!window.DeviceOrientationEvent&&(this.askPermission(),(o=this._viewer)===null||o===void 0||o.renderer.rendererObject.domElement.addEventListener("click",this.askPermission.bind(this)),window.addEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.addEventListener("deviceorientation",this.onDeviceOrientationChangeEvent),!0)}askPermission(){this.onScreenOrientationChangeEvent(),typeof DeviceMotionEvent.requestPermission=="function"&&(this.addPermissionMessage(),DeviceOrientationEvent.requestPermission().then(o=>{o=="granted"&&(window.addEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.addEventListener("deviceorientation",this.onDeviceOrientationChangeEvent),this._viewer.container.removeChild(this.permissionMessage))}).catch(o=>{console.error("DeviceOrientationControls2: Unable to use DeviceOrientation API:",o)}))}disconnect(){this._isConnected&&(this._isConnected=!1,window.removeEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.removeEventListener("deviceorientation",this.onDeviceOrientationChangeEvent),this._initQuaternionDest=new three_module.PTz)}}class MouseInputDevice{constructor(){this._mousePos=new three_module.I9Y(0,0),this._isConnected=!1}getOffsetFromCenter(){return new three_module.I9Y(this._mousePos.x/window.innerWidth*2-1,-(this._mousePos.y/window.innerHeight*2-1))}connect(){this._isConnected||(this._isConnected=!0,window.addEventListener("mousemove",this._onMouseMove.bind(this)))}disconnect(){this._isConnected&&(this._isConnected=!1,window.removeEventListener("mousemove",this._onMouseMove.bind(this)))}_onMouseMove(o){this._mousePos.set(o.clientX,o.clientY)}}var ParallaxCameraControllerPlugin_decorate=function(h,o,c,d){var _,v=arguments.length,b=v<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(h,o,c,d);else for(var tt=h.length-1;tt>=0;tt--)(_=h[tt])&&(b=(v<3?_(b):v>3?_(o,c,b):_(o,c))||b);return v>3&&b&&Object.defineProperty(o,c,b),b},ParallaxCameraControllerPlugin_1;let ParallaxCameraControllerPlugin=ParallaxCameraControllerPlugin_1=class extends AViewerPlugin{constructor(){super(),this.enabled=!1,this.enableEdit=!1,this.invert=!1,this.sensitivity=.5,this.focalPointHit=new three_module.Pq0(0,0,0),this.damping=.5,this.cameraView="",this._target=new three_module.Pq0,this._center=new three_module.Pq0,this._pointerDown=!1,this._focalDistance=100,this._updateProjectionMatrix=()=>{var h,o;if(!this.enabled)return void((o=(h=this._object)._updateProjectionMatrixParallax)===null||o===void 0||o.call(h));const c=this._object,d=c.near;let _=d*Math.tan(.5*three_module.cj9.DEG2RAD*c.fov)/c.zoom,v=2*_,b=c.aspect*v,tt=-.5*b;if(c.view!==null&&c.view.enabled){const nt=c.view.fullWidth,lt=c.view.fullHeight;tt+=c.view.offsetX*b/nt,_-=c.view.offsetY*v/lt,b*=c.view.width/nt,v*=c.view.height/lt}tt-=this._offX*d/this._focalDistance,_-=this._offY*d/this._focalDistance;const it=c.filmOffset;it!==0&&(tt+=d*it/c.getFilmWidth()),c.projectionMatrix.makePerspective(tt,tt+b,_,_-v,d,c.far),c.projectionMatrixInverse.copy(c.projectionMatrix).invert()},this._preFrame=h=>{this.update(h.deltaTime)},this._offX=0,this._offY=0,this._xDamper=new k$1,this._yDamper=new k$1,this._onEnabledChange=this._onEnabledChange.bind(this),this._onDampingChange=this._onDampingChange.bind(this),this._onObjectHit=this._onObjectHit.bind(this),this._onActiveCameraChange=this._onActiveCameraChange.bind(this)}async onAdded(h){var o,c,d;await super.onAdded(h),GyroInputDevice.IsCompatible()?this._input=new GyroInputDevice(h):this._input=new MouseInputDevice,h.scene.addEventListener("activeCameraChange",this._onActiveCameraChange),this.addIndicator(),h.addEventListener("preFrame",this._preFrame),(o=this._viewer)===null||o===void 0||o.container.addEventListener("pointerdown",this.onPointerDown.bind(this)),(c=this._viewer)===null||c===void 0||c.container.addEventListener("pointerup",this.onPointerUp.bind(this)),(d=h.getPluginByType("Picking"))===null||d===void 0||d.addEventListener("hitObject",this._onObjectHit),this._onEnabledChange()}_onActiveCameraChange(){var h,o,c,d;this._object&&!((h=this._object)===null||h===void 0)&&h._updateProjectionMatrixParallax&&(this._object.updateProjectionMatrix=this._object._updateProjectionMatrixParallax,delete this._object._updateProjectionMatrixParallax),this._focalDistance=.01,this._object=(o=this._viewer)===null||o===void 0?void 0:o.scene.activeCamera.cameraObject,!((c=this._object)===null||c===void 0)&&c.isOrthographicCamera?(d=this._viewer)===null||d===void 0||d.console.warn("ParallaxCameraControllerPlugin: Orthographic camera is not supported"):this.enabled&&(this._object._updateProjectionMatrixParallax=this._object.updateProjectionMatrix,this._object.updateProjectionMatrix=this._updateProjectionMatrix)}addIndicator(){var h;this._viewer&&(this._indicator&&this._indicator.remove(),this._indicator=document.createElement("div"),this._indicator.style.width="40px",this._indicator.style.height="40px",this._indicator.style.borderRadius="100%",this._indicator.style.border="4px solid #ff4444",this._indicator.style.transform="translate(-50%, -50%)",this._indicator.style.position="absolute",this._indicator.style.top="0",this._indicator.style.left="0",this._indicator.style.zIndex="10000",this._indicator.style.opacity="0",this._indicator.style.transition="opacity 0.5s",this._indicator.style.pointerEvents="none",(h=this._viewer)===null||h===void 0||h.container.appendChild(this._indicator))}onPointerDown(h){this.enabled&&this._viewer&&(this._pointerDown=!0,this.enableEdit&&this._indicator&&(this._indicator.style.top=h.clientY-this._viewer.container.offsetTop+"px",this._indicator.style.left=h.clientX-this._viewer.container.offsetLeft+"px"))}onPointerUp(){this._pointerDown=!1}update(h){if(!this.enabled||this._pointerDown||!this._input||!this._object||!this._viewer)return;this._viewer.scene.activeCamera.setInteractions(!1,ParallaxCameraControllerPlugin_1.PluginType),this._updateFocalDistance();const o=this._object.matrixWorld.elements,c=new three_module.Pq0(o[0],o[1],o[2]),d=new three_module.Pq0(o[4],o[5],o[6]);this._object.position.copy(this._center),this._viewer.scene.activeCamera.positionUpdated();let _=this.sensitivity;this.invert&&(_*=-1),this._offX=this._xDamper.update(this._offX,this._input.getOffsetFromCenter().x*_,h,1),this._offY=this._yDamper.update(this._offY,this._input.getOffsetFromCenter().y*_,h,1);const v=this._object;v.position.add(d.multiplyScalar(this._offY)).add(c.multiplyScalar(this._offX)),v.updateProjectionMatrix(),v.updateMatrixWorld(),this._dirty=!0}_onObjectHit(h){var o,c;h.intersects.intersect&&this.enableEdit&&(this.focalPointHit.copy(h.intersects.intersect.point),h.intersects.selectedObject=null,(c=(o=this.uiConfig)===null||o===void 0?void 0:o.uiRefresh)===null||c===void 0||c.call(o,"postFrame",!0),this._indicator&&(this._indicator.style.display="block",this._indicator.style.opacity="1",setTimeout(()=>{var d,_;this._indicator.style.opacity="0",setTimeout(()=>this._indicator.style.display="none",600),(_=(d=this.uiConfig)===null||d===void 0?void 0:d.uiRefresh)===null||_===void 0||_.call(d,"postFrame",!0)},200)))}_updateFocalDistance(){if(!this._object)return;const h=this._object,o=new three_module.Pq0;h.getWorldDirection(o),o.normalize(),this._focalDistance=this.focalPointHit.clone().sub(h.position).dot(o)}_onEnabledChange(){var h,o,c;if(this._viewer){if(this.enabled){if((h=this._input)===null||h===void 0||h.connect(),this._onActiveCameraChange(),!this._object)return;this._viewer.scene.activeCamera.setInteractions(!1,ParallaxCameraControllerPlugin_1.PluginType);const d=this._viewer.getPluginByType("CameraViews"),_=d==null?void 0:d.camViews.find(v=>v.name===this.cameraView);d&&_&&d.setCurrentCameraView(_),this._updateFocalDistance(),this._center.copy(this._object.position),this._object.lookAt(this._viewer.scene.activeCamera.target)}else if(this._object){this._onActiveCameraChange(),this._viewer.scene.activeCamera.setInteractions(!0,ParallaxCameraControllerPlugin_1.PluginType),this._object.position.copy(this._center),this._object.lookAt(this._viewer.scene.activeCamera.target);const d=this._object;d.updateProjectionMatrix(),d.updateMatrixWorld()}(c=(o=this.uiConfig)===null||o===void 0?void 0:o.uiRefresh)===null||c===void 0||c.call(o,"postFrame",!0)}}_onDampingChange(){this._xDamper&&this._yDamper&&(this._xDamper.setDecayTime(100*this.damping),this._yDamper.setDecayTime(100*this.damping))}dispose(){var h;(h=this._input)===null||h===void 0||h.disconnect()}};ParallaxCameraControllerPlugin.PluginType="ParallaxCameraControllerPlugin",ParallaxCameraControllerPlugin_decorate([x$1(ParallaxCameraControllerPlugin.prototype._onEnabledChange),serialize(),uiToggle("Enabled")],ParallaxCameraControllerPlugin.prototype,"enabled",void 0),ParallaxCameraControllerPlugin_decorate([serialize(),uiToggle("enableEdit")],ParallaxCameraControllerPlugin.prototype,"enableEdit",void 0),ParallaxCameraControllerPlugin_decorate([serialize(),uiToggle("Invert")],ParallaxCameraControllerPlugin.prototype,"invert",void 0),ParallaxCameraControllerPlugin_decorate([serialize(),uiSlider("Sensitivity",[.1,2],.01)],ParallaxCameraControllerPlugin.prototype,"sensitivity",void 0),ParallaxCameraControllerPlugin_decorate([serialize("focalPoint"),uiVector("Focal Point Hit",void 0,.001)],ParallaxCameraControllerPlugin.prototype,"focalPointHit",void 0),ParallaxCameraControllerPlugin_decorate([x$1(ParallaxCameraControllerPlugin.prototype._onDampingChange),serialize(),uiSlider("Damping",[0,1],.001)],ParallaxCameraControllerPlugin.prototype,"damping",void 0),ParallaxCameraControllerPlugin_decorate([serialize(),uiInput("Camera View")],ParallaxCameraControllerPlugin.prototype,"cameraView",void 0),ParallaxCameraControllerPlugin=ParallaxCameraControllerPlugin_1=ParallaxCameraControllerPlugin_decorate([uiFolder("Parallax Camera Controller")],ParallaxCameraControllerPlugin);var voronoi=`#ifndef VORONOI_HELPER
#define VORONOI_HELPER 
float voronoi_distance(vec2 a,vec2 b,float metric){return distance(a,b);}float voronoi_f1_2d(in vec2 coord,in float randomness,in float flakeClamp,in float flakeRadius,inout vec3 outColor){vec2 cellPosition=floor(coord);vec2 localPosition=coord-cellPosition;float minDistance=8.;vec2 targetOffset,targetPosition;for(int j=-1;j<=1;j++){for(int i=-1;i<=1;i++){vec2 cellOffset=vec2(i,j);vec2 pointPosition=cellOffset+hash3(cellPosition+cellOffset).xy*randomness;float distanceToPoint=voronoi_distance(pointPosition,localPosition,1.);if(distanceToPoint<minDistance){targetOffset=cellOffset;minDistance=distanceToPoint;targetPosition=pointPosition;}}}float outDistance=minDistance;float dist=step(flakeRadius,outDistance);outColor=hash3(cellPosition+hash3(cellPosition+targetOffset).xy*randomness+targetOffset);vec3 outColor1=minDistance<flakeRadius?outColor:vec3(0.5,0.5,1.);outDistance=mix(dist,minDistance,flakeClamp);outColor=mix(outColor1,outColor,flakeClamp);return outDistance;}
#endif
`,noiseBumpMatPars="uniform vec2 noiseBumpParams;uniform float noiseBumpScale;uniform float noiseBumpFlakeScale;uniform float noiseFlakeClamp;uniform float noiseFlakeRadius;uniform bool useColorFlakes;uniform vec4 flakeParams;uniform vec3 flakeFallOffParams;vec3 perturbNormalArb_nb(vec3 surf_pos,vec3 surf_norm,vec2 dHdxy,float faceDirection){vec3 vSigmaX=dFdx(surf_pos.xyz);vec3 vSigmaY=dFdy(surf_pos.xyz);vec3 vN=surf_norm;vec3 R1=cross(vSigmaY,vN);vec3 R2=cross(vN,vSigmaX);float fDet=dot(vSigmaX,R1)*faceDirection;vec3 vGrad=sign(fDet)*(dHdxy.x*R1+dHdxy.y*R2);return normalize(abs(fDet)*surf_norm-vGrad);}",noiseBumpMat=`vec3 outColor,outColor1,outColor2,outColor3,outColor4,outColor5;float distFac=length(vViewPosition.xyz);float level=1.;vec2 uvMod=noiseBumpFlakeScale*noiseBumpParams.xy*vUv*level;float voronoiDist=clamp(voronoi_f1_2d(uvMod,1.,noiseFlakeClamp,noiseFlakeRadius,outColor),0.,1.);vec3 oldNormal=normal;normal=perturbNormalArb_nb(-vViewPosition,normal,(2.*outColor.xy-1.)*noiseBumpScale,faceDirection);float oldRoughnessFactor=roughnessFactor;float oldMetalnessFactor=metalnessFactor;roughnessFactor=mix(roughnessFactor,flakeParams.x,1.-voronoiDist);metalnessFactor=mix(metalnessFactor,flakeParams.y,1.-voronoiDist);
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
vec3 sparkleRadiance=getIBLRadiance(normalize(vViewPosition),normal,roughnessFactor);float sparkleIntensity=length(sparkleRadiance);float sparkleIntensityMultiplier=sparkleIntensity>1.3?flakeParams.z:1.;vec3 oldDiffuseColor=diffuseColor.rgb;vec2 cellPosition_=floor(uvMod);vec3 colorRGB=useColorFlakes?hash3(cellPosition_):vec3(1.);float fallOff_=mix(1.,1./(1.+flakeFallOffParams.y*distFac+flakeFallOffParams.z*distFac*distFac),flakeFallOffParams.x);diffuseColor.rgb*=mix(vec3(1.),sparkleIntensityMultiplier*colorRGB*fallOff_,vec3(1.-voronoiDist));if(sparkleIntensity<flakeParams.w){float mixFactor=1.;roughnessFactor=mix(roughnessFactor,oldRoughnessFactor,mixFactor);metalnessFactor=mix(metalnessFactor,oldMetalnessFactor,mixFactor);normal=normalize(mix(normal,oldNormal,mixFactor));diffuseColor.rgb=mix(diffuseColor.rgb,oldDiffuseColor,mixFactor);}
#endif
`,NoiseBumpMaterialPlugin_decorate=function(h,o,c,d){var _,v=arguments.length,b=v<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(h,o,c,d);else for(var tt=h.length-1;tt>=0;tt--)(_=h[tt])&&(b=(v<3?_(b):v>3?_(o,c,b):_(o,c))||b);return v>3&&b&&Object.defineProperty(o,c,b),b};let NoiseBumpMaterialPlugin=class extends AViewerPlugin{addNoiseBumpMaterial(h){return addNoiseBumpMaterial(h.materialObject)}_loaderCreate({loader:h}){h.isGLTFLoader2&&h.register(o=>new GLTFMaterialsNoiseBumpMaterialExtensionImport(o))}constructor(){super(),this.enabled=!0,this.dependencies=[AssetManagerPlugin],this._uniforms={noiseBumpParams:{value:new three_module.I9Y},noiseBumpScale:{value:.05},noiseBumpFlakeScale:{value:1e3},noiseFlakeClamp:{value:1},noiseFlakeRadius:{value:.5},flakeParams:{value:new three_module.IUQ(0,1,3,0)},flakeFallOffParams:{value:new three_module.Pq0(0,1,0)},useColorFlakes:{value:!1}},this.materialExtension={parsFragmentSnippet:(h,o)=>{var c;return this.enabled&&!((c=o==null?void 0:o.materialObject.userData._noiseBumpMat)===null||c===void 0)&&c.hasBump?randomHelpers+`
`+voronoi+`
`+noiseBumpMatPars+`
`:""},shaderExtender:(h,o,c)=>{var d;if(!this.enabled||!(!((d=o.materialObject.userData._noiseBumpMat)===null||d===void 0)&&d.hasBump))return;const _="#glMarker beforeAccumulation",v=noiseBumpMat;h.fragmentShader=h.fragmentShader.replace(_,v+`
`+_),h.defines.USE_UV="",h.extensionDerivatives=!0},onObjectRender:(h,o)=>{var c;const d=(c=o.materialObject.userData)===null||c===void 0?void 0:c._noiseBumpMat;if(!(d!=null&&d.hasBump))return;this._uniforms.noiseBumpParams.value.fromArray(d.bumpNoiseParams),this._uniforms.noiseBumpScale.value=d.bumpScale,this._uniforms.noiseBumpFlakeScale.value=d.flakeScale,this._uniforms.noiseFlakeClamp.value=d.flakeClamp,this._uniforms.noiseFlakeRadius.value=d.flakeRadius,d.flakeParams&&this._uniforms.flakeParams.value.copy(d.flakeParams),d.flakeFallOffParams&&this._uniforms.flakeFallOffParams.value.copy(d.flakeFallOffParams),this._uniforms.useColorFlakes.value=d.useColorFlakes;const _=this.enabled?1:0;o.materialObject.defines.NOISE_BUMP_MATERIAL_ENABLED!==_&&(o.materialObject.defines.NOISE_BUMP_MATERIAL_ENABLED=_,o.materialObject.needsUpdate=!0)},extraUniforms:{...this._uniforms},computeCacheKey:h=>{var o,c;return(this.enabled?"1":"0")+(!((c=(o=h.materialObject.userData)===null||o===void 0?void 0:o._noiseBumpMat)===null||c===void 0)&&c.hasBump?"1":"0")},isCompatible:h=>h.isMeshStandardMaterial2,updaters:()=>[],getUiConfig:h=>{const o=this._viewer,c={type:"folder",label:"SparkleBump (NoiseBump)",children:[{type:"checkbox",label:"Enabled",get value(){var d;return((d=h.materialObject.userData._noiseBumpMat)===null||d===void 0?void 0:d.hasBump)||!1},set value(d){var _,v;d!==((_=h.materialObject.userData._noiseBumpMat)===null||_===void 0?void 0:_.hasBump)&&(d?addNoiseBumpMaterial(h.materialObject)||o.alert("Cannot add noise bump."):h.materialObject.userData._noiseBumpMat&&(h.materialObject.userData._noiseBumpMat.hasBump=!1,h.materialObject.needsUpdate=!0),(v=c.uiRefresh)===null||v===void 0||v.call(c,"postFrame",!0))},onChange:this.setDirty},()=>({type:"vec4",label:"Bump Noise Params",bounds:[0,1],hidden:()=>{var d;return!(!((d=h.materialObject.userData._noiseBumpMat)===null||d===void 0)&&d.hasBump)},property:[h.materialObject.userData._noiseBumpMat,"bumpNoiseParams"],onChange:this.setDirty}),()=>({type:"slider",label:"Bump Scale",bounds:[0,.001],stepSize:1e-5,hidden:()=>{var d;return!(!((d=h.materialObject.userData._noiseBumpMat)===null||d===void 0)&&d.hasBump)},property:[h.materialObject.userData._noiseBumpMat,"bumpScale"],onChange:this.setDirty}),()=>({type:"slider",label:"Flake Scale",bounds:[100,1e4],stepSize:1e-4,hidden:()=>{var d;return!(!((d=h.materialObject.userData._noiseBumpMat)===null||d===void 0)&&d.hasBump)},property:[h.materialObject.userData._noiseBumpMat,"flakeScale"],onChange:this.setDirty}),()=>({type:"slider",label:"Flake Clamp",bounds:[0,1],stepSize:1,hidden:()=>{var d;return!(!((d=h.materialObject.userData._noiseBumpMat)===null||d===void 0)&&d.hasBump)},property:[h.materialObject.userData._noiseBumpMat,"flakeClamp"],onChange:this.setDirty}),()=>({type:"slider",label:"Flake Radius",bounds:[.01,1],stepSize:.001,hidden:()=>{var d;return!(!((d=h.materialObject.userData._noiseBumpMat)===null||d===void 0)&&d.hasBump)},property:[h.materialObject.userData._noiseBumpMat,"flakeRadius"],onChange:this.setDirty}),()=>{var d;return{type:"slider",label:"Flake Roughness",bounds:[0,1],stepSize:.01,hidden:()=>{var _;return!(!((_=h.materialObject.userData._noiseBumpMat)===null||_===void 0)&&_.hasBump)},property:[(d=h.materialObject.userData._noiseBumpMat)===null||d===void 0?void 0:d.flakeParams,"x"],onChange:this.setDirty}},()=>{var d;return{type:"slider",label:"Flake Metalness",bounds:[0,1],stepSize:.01,hidden:()=>{var _;return!(!((_=h.materialObject.userData._noiseBumpMat)===null||_===void 0)&&_.hasBump)},property:[(d=h.materialObject.userData._noiseBumpMat)===null||d===void 0?void 0:d.flakeParams,"y"],onChange:this.setDirty}},()=>{var d;return{type:"slider",label:"Flake Strength",bounds:[0,100],stepSize:.001,hidden:()=>{var _;return!(!((_=h.materialObject.userData._noiseBumpMat)===null||_===void 0)&&_.hasBump)},property:[(d=h.materialObject.userData._noiseBumpMat)===null||d===void 0?void 0:d.flakeParams,"z"],onChange:this.setDirty}},()=>{var d;return{type:"slider",label:"Flake Threshold",bounds:[.1,10],stepSize:.001,hidden:()=>{var _;return!(!((_=h.materialObject.userData._noiseBumpMat)===null||_===void 0)&&_.hasBump)},property:[(d=h.materialObject.userData._noiseBumpMat)===null||d===void 0?void 0:d.flakeParams,"w"],onChange:this.setDirty}},()=>{var d;return{type:"slider",label:"Falloff",stepSize:1,bounds:[0,1],hidden:()=>{var _;return!(!((_=h.materialObject.userData._noiseBumpMat)===null||_===void 0)&&_.hasBump)},property:[(d=h.materialObject.userData._noiseBumpMat)===null||d===void 0?void 0:d.flakeFallOffParams,"x"],onChange:this.setDirty}},()=>{var d;return{type:"slider",label:"Linear falloff factor",bounds:[0,10],stepSize:.001,hidden:()=>{var _;return!(!((_=h.materialObject.userData._noiseBumpMat)===null||_===void 0)&&_.hasBump)},property:[(d=h.materialObject.userData._noiseBumpMat)===null||d===void 0?void 0:d.flakeFallOffParams,"y"],onChange:this.setDirty}},()=>{var d;return{type:"slider",label:"Quadratic falloff factor",bounds:[0,10],stepSize:.001,hidden:()=>{var _;return!(!((_=h.materialObject.userData._noiseBumpMat)===null||_===void 0)&&_.hasBump)},property:[(d=h.materialObject.userData._noiseBumpMat)===null||d===void 0?void 0:d.flakeFallOffParams,"z"],onChange:this.setDirty}},()=>({type:"checkbox",label:"Colored Flakes",hidden:()=>{var d;return!(!((d=h.materialObject.userData._noiseBumpMat)===null||d===void 0)&&d.hasBump)},property:[h.materialObject.userData._noiseBumpMat,"useColorFlakes"],onChange:this.setDirty})]};return c}},this.setDirty=()=>{var h,o,c;(o=(h=this.materialExtension).setDirty)===null||o===void 0||o.call(h),(c=this._viewer)===null||c===void 0||c.setDirty()},this._loaderCreate=this._loaderCreate.bind(this)}async onAdded(h){var o,c,d,_,v;await super.onAdded(h);const b=h.getPlugin(AssetManagerPlugin);(o=b==null?void 0:b.materials)===null||o===void 0||o.registerMaterialExtension(this.materialExtension),(c=b==null?void 0:b.importer)===null||c===void 0||c.addEventListener("loaderCreate",this._loaderCreate),(v=(_=(d=b==null?void 0:b.exporter)===null||d===void 0?void 0:d.getExporter("gltf","glb"))===null||_===void 0?void 0:_.extensions)===null||v===void 0||v.push(glTFMaterialsNoiseBumpMaterialExtensionExport)}async onRemove(h){var o,c,d,_;return(c=(o=h.getPlugin(AssetManagerPlugin))===null||o===void 0?void 0:o.materials)===null||c===void 0||c.unregisterMaterialExtension(this.materialExtension),(_=(d=h.getPlugin(AssetManagerPlugin))===null||d===void 0?void 0:d.importer)===null||_===void 0||_.removeEventListener("loaderCreate",this._loaderCreate),super.onRemove(h)}};function addNoiseBumpMaterial(h){const o=h==null?void 0:h.userData;if(!o)return!1;o._noiseBumpMat||(o._noiseBumpMat={});const c=o._noiseBumpMat;return c.hasBump=!0,c.bumpNoiseParams===void 0&&(c.bumpNoiseParams=[.5,.5]),c.bumpScale===void 0&&(c.bumpScale=.05),c.flakeScale===void 0&&(c.flakeScale=.05),c.flakeClamp===void 0&&(c.flakeClamp=1),c.flakeRadius===void 0&&(c.flakeRadius=.3),c.useColorFlakes===void 0&&(c.useColorFlakes=!1),c.flakeParams===void 0&&(c.flakeParams=new three_module.IUQ(0,1,3,0)),c.flakeFallOffParams===void 0&&(c.flakeFallOffParams=new three_module.Pq0(0,1,0)),h.isMaterial&&(h.needsUpdate=!0),!0}NoiseBumpMaterialPlugin.PluginType="NoiseBumpMaterialPlugin",NoiseBumpMaterialPlugin.NOISE_BUMP_MATERIAL_GLTF_EXTENSION="WEBGI_materials_noise_bump",NoiseBumpMaterialPlugin_decorate([uiToggle("Enabled",h=>({onChange:h.setDirty})),serialize()],NoiseBumpMaterialPlugin.prototype,"enabled",void 0),NoiseBumpMaterialPlugin=NoiseBumpMaterialPlugin_decorate([uiFolder("NoiseBump Materials")],NoiseBumpMaterialPlugin);class GLTFMaterialsNoiseBumpMaterialExtensionImport{constructor(o){this.parser=o,this.name=NoiseBumpMaterialPlugin.NOISE_BUMP_MATERIAL_GLTF_EXTENSION}async extendMaterialParams(o,c){const d=this.parser.json.materials[o];if(!d.extensions||!d.extensions[this.name])return Promise.resolve();const _=d.extensions[this.name];return c.userData||(c.userData={}),addNoiseBumpMaterial(c),c.userData._noiseBumpMat=deserializeObject(_,c.userData._noiseBumpMat,!1,{}),Promise.resolve()}}const glTFMaterialsNoiseBumpMaterialExtensionExport=h=>({writeMaterial:(o,c)=>{if(!o.isMeshStandardMaterial||!o.userData._noiseBumpMat||!o.userData._noiseBumpMat.hasBump)return;c.extensions=c.extensions||{};const d=serializeObject(o.userData._noiseBumpMat,!1);c.extensions[NoiseBumpMaterialPlugin.NOISE_BUMP_MATERIAL_GLTF_EXTENSION]=d,h.extensionsUsed[NoiseBumpMaterialPlugin.NOISE_BUMP_MATERIAL_GLTF_EXTENSION]=!0}});var taa=`#include <common>
varying vec2 vUv;uniform vec2 previousRTSize;uniform mat4 lastProjectionViewMatrix;uniform mat4 currentProjectionViewMatrix;uniform mat4 inverseViewMatrix;uniform vec2 jitterSample;uniform vec2 feedBack;uniform bool firstFrame;
#if HAS_VELOCITY_BUFFER == 1
uniform sampler2D tVelocity;
#endif
vec3 find_closest_fragment_3x3(const in vec2 uv){const vec3 offset=vec3(-1.,1.,0.);vec2 texelSize=1./previousRTSize;vec3 dtr=vec3(1,1,getDepth(uv+offset.yy*texelSize));vec3 dtc=vec3(0,1,getDepth(uv+offset.zy*texelSize));vec3 dtl=vec3(-1,1,getDepth(uv+offset.xy*texelSize));vec3 dml=vec3(-1,0,getDepth(uv+offset.xz*texelSize));vec3 dmc=vec3(0,0,getDepth(uv));vec3 dmr=vec3(1,0,getDepth(uv+offset.yz*texelSize));vec3 dbl=vec3(-1,-1,getDepth(uv+offset.xx*texelSize));vec3 dbc=vec3(0,-1,getDepth(uv+offset.zx*texelSize));vec3 dbr=vec3(1,-1,getDepth(uv+offset.yx*texelSize));vec3 dmin=dtl;if(dmin.z>dtc.z)dmin=dtc;if(dmin.z>dtr.z)dmin=dtr;if(dmin.z>dml.z)dmin=dml;if(dmin.z>dmc.z)dmin=dmc;if(dmin.z>dmr.z)dmin=dmr;if(dmin.z>dbl.z)dmin=dbl;if(dmin.z>dbc.z)dmin=dbc;if(dmin.z>dbr.z)dmin=dbr;return vec3(uv+texelSize.xy*dmin.xy,dmin.z);}vec3 find_closest_fragment_5tap(const in vec2 uv){vec2 texelSize=1./previousRTSize;vec2 offset=vec2(1.,-1.);vec3 dtl=vec3(-1,1,getDepth(uv+offset.yx*texelSize));vec3 dtr=vec3(1,1,getDepth(uv+offset.xx*texelSize));vec3 dmc=vec3(0,0,getDepth(uv));vec3 dbl=vec3(-1,-1,getDepth(uv+offset.yy*texelSize));vec3 dbr=vec3(1,-1,getDepth(uv+offset.xy*texelSize));vec3 dmin=dtl;if(dmin.z>dtr.z)dmin=dtr;if(dmin.z>dmc.z)dmin=dmc;if(dmin.z>dbl.z)dmin=dbl;if(dmin.z>dbr.z)dmin=dbr;return vec3(uv+dmin.xy*texelSize,dmin.z);}vec4 clip_aabb(const in vec4 aabb_min,const in vec4 aabb_max,vec4 p){const float FLT_EPS=1e-8;vec4 p_clip=0.5*(aabb_max+aabb_min);vec4 e_clip=0.5*(aabb_max-aabb_min)+FLT_EPS;vec4 v_clip=p-p_clip;vec4 v_unit=abs(v_clip/e_clip);float ma_unit=max(v_unit.x,max(v_unit.y,v_unit.z));if(ma_unit>1.)return p_clip+v_clip/ma_unit;else return p;}
#if HAS_VELOCITY_BUFFER == 0
vec2 computeScreenSpaceVelocity(const in vec3 worldPosition){vec4 currentPositionClip=currentProjectionViewMatrix*vec4(worldPosition,1.);vec4 prevPositionClip=lastProjectionViewMatrix*vec4(worldPosition,1.);vec2 currentPositionNDC=currentPositionClip.xy/currentPositionClip.w;vec2 prevPositionNDC=prevPositionClip.xy/prevPositionClip.w;if(prevPositionNDC.x>=1.||prevPositionNDC.x<=-1.||prevPositionNDC.x>=1.||prevPositionNDC.y<=-1.){return vec2(0.);}return 0.5*(currentPositionNDC-prevPositionNDC);}
#endif
vec4 computeTAA(const in vec2 uv,const in vec2 screenSpaceVelocity,const in float feedbackScale){vec2 uvUnJitter=uv;vec4 currentColor=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter));vec4 previousColor=previousRTTexelToLinear(texture2D(previousRT,uv-screenSpaceVelocity));const vec3 offset=vec3(1.,-1.,0.);vec2 texelSize=1./previousRTSize;float texelSpeed=length(screenSpaceVelocity);vec4 tl=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.yx*texelSize));vec4 tc=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.zx*texelSize));vec4 tr=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.xx*texelSize));vec4 ml=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.yz*texelSize));vec4 mc=currentColor;vec4 mr=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.xz*texelSize));vec4 bl=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.yy*texelSize));vec4 bc=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.zy*texelSize));vec4 br=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.xy*texelSize));vec4 corners=2.*(tr+bl+br+tl)-2.*mc;mc+=(mc-(corners*0.166667))*2.718282*0.3;mc=max(vec4(0.),mc);vec4 min5=min(tc,min(ml,min(mc,min(mr,bc))));vec4 max5=max(tc,max(ml,max(mc,max(mr,bc))));vec4 cmin=min(min5,min(tl,min(tr,min(bl,br))));vec4 cmax=max(min5,max(tl,max(tr,max(bl,br))));;cmin=0.5*(cmin+min5);cmax=0.5*(cmax+max5);previousColor=clip_aabb(cmin,cmax,previousColor);float lum0=luminance(currentColor.rgb);float lum1=luminance(previousColor.rgb);float unbiased_diff=abs(lum0-lum1)/max(lum0,max(lum1,0.2));float unbiased_weight=1.-unbiased_diff;float unbiased_weight_sqr=unbiased_weight*unbiased_weight;float k_feedback=mix(feedBack.x,feedBack.y,unbiased_weight_sqr);return mix(currentColor,previousColor,clamp(k_feedback*feedbackScale,0.,1.));}vec3 getWorldPositionFromViewZ(const in vec2 uv,const in float viewDepth){vec2 uv_=2.*uv-1.;float xe=-(uv_.x+projection[2][0])*viewDepth/projection[0][0];float ye=-(uv_.y+projection[2][1])*viewDepth/projection[1][1];return(inverseViewMatrix*vec4(xe,ye,viewDepth,1.)).xyz;}void main(){
#if HAS_VELOCITY_BUFFER == 0
#if QUALITY == 1
vec3 c_frag=find_closest_fragment_3x3(vUv);
#else
vec3 c_frag=find_closest_fragment_5tap(vUv);
#endif
#else
vec3 c_frag=vec3(vUv,0.);
#endif
bool bg=firstFrame;
#if BACKGROUND_TAA 
float d=c_frag.z;float edgef=min(1.,max(0.,1.-(d*100.-99.)));
#else
bg=bg||c_frag.z>0.999;
#endif
if(firstFrame){gl_FragColor=currentRTTexelToLinear(texture2D(currentRT,vUv));}else{
#if HAS_VELOCITY_BUFFER == 0
float sampleViewZ=mix(-cameraNearFar.x,-cameraNearFar.y,c_frag.z);vec3 worldPosition=getWorldPositionFromViewZ(c_frag.xy,sampleViewZ);vec2 screenSpaceVelocity=computeScreenSpaceVelocity(worldPosition);
#else
vec2 screenSpaceVelocity=texture2D(tVelocity,c_frag.xy).xy*2.-1.;screenSpaceVelocity=sign(screenSpaceVelocity)*pow(abs(screenSpaceVelocity),vec2(4.));
#endif
#if BACKGROUND_TAA
gl_FragColor=computeTAA(vUv,screenSpaceVelocity*edgef,edgef);
#else
gl_FragColor=computeTAA(vUv,screenSpaceVelocity,1.);
#endif
}
#include <colorspace_fragment>
#ifdef DEBUG_VELOCITY
float sampleViewZ=mix(-cameraNearFar.x,-cameraNearFar.y,c_frag.z);vec3 worldPosition=getWorldPositionFromViewZ(c_frag.xy,sampleViewZ);vec2 screenSpaceVelocity=computeScreenSpaceVelocity(worldPosition);gl_FragColor=vec4(10.*length(screenSpaceVelocity),0.,0.,1.);
#endif
}`,TAAPass_decorate=function(h,o,c,d){var _,v=arguments.length,b=v<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(h,o,c,d);else for(var tt=h.length-1;tt>=0;tt--)(_=h[tt])&&(b=(v<3?_(b):v>3?_(o,c,b):_(o,c))||b);return v>3&&b&&Object.defineProperty(o,c,b),b};class TAAPass extends ShaderPass2{constructor(o,c,d=!1){super({vertexShader:CopyShader.vertexShader,fragmentShader:c+`
`+cameraHelpers+`
`+taa,uniforms:{currentRT:{value:null},previousRT:{value:null},previousRTSize:{value:new three_module.I9Y},cameraNearFar:{value:new three_module.I9Y},lastProjectionViewMatrix:{value:new three_module.kn4},currentProjectionViewMatrix:{value:new three_module.kn4},projection:{value:new three_module.kn4},inverseViewMatrix:{value:new three_module.kn4},jitterSample:{value:new three_module.I9Y},firstFrame:{value:!0},tNormalDepth:{value:null},tVelocity:{value:null}},defines:{HAS_VELOCITY_BUFFER:0,QUALITY:1,UNJITTER:0,BACKGROUND_TAA:d?1:0}},"currentRT","previousRT"),this.taaEnabled=!0,this.feedBack=new three_module.I9Y(.88,.97),this.uiConfig={type:"folder",label:"Temporal AA",children:[{type:"checkbox",label:"Enabled",property:[this,"enabled"],onChange:()=>this.onSizeUpdate()},{type:"input",label:"Feedback",stepSize:1e-4,property:[this,"feedBack"],onChange:this.setDirty}]},this.onSizeUpdate=this.onSizeUpdate.bind(this),this.target=o,this.clear=!1,this.needsSwap=!0}render(o,c,d,_,v){var b,tt;if(!this.taaEnabled||!this.enabled)return void(this.needsSwap=!1);this.needsSwap=!0;const it=this.uniforms.tVelocity.value?1:0;it!==this.material.defines.HAS_VELOCITY_BUFFER&&(this.material.defines.HAS_VELOCITY_BUFFER=it,this.material.needsUpdate=!0),this.uniforms.previousRT.value=(tt=(b=Ee$1(this.target))===null||b===void 0?void 0:b.texture)!==null&&tt!==void 0?tt:null,super.render(o,c,d,_,v),this.uniforms.lastProjectionViewMatrix.value.copy(this.uniforms.currentProjectionViewMatrix.value),this.uniforms.firstFrame.value=!1}updateCameraProperties(o){o&&(this.uniforms.currentProjectionViewMatrix.value.multiplyMatrices(o.projectionMatrix,o.matrixWorldInverse),this.uniforms.inverseViewMatrix.value.copy(o.matrixWorld))}onSizeUpdate(){this.uniforms.firstFrame.value=!0,this.setDirty()}setSize(o,c){super.setSize(o,c),this.onSizeUpdate()}}TAAPass_decorate([serialize(),uniform()],TAAPass.prototype,"feedBack",void 0);class TemporalAAPlugin extends GenericFilterPlugin{constructor(){super(...arguments),this.passId="taa",this._beforeFilters=["progressive"],this._afterFilters=[],this._requiredFilters=["render","progressive"],this.dependencies=[GBufferPlugin],this._stableNoise=!0,this._stableNoiseConfig={label:"Stable Noise (Use Total Frame Count)",type:"checkbox",property:[this,"stableNoise"]}}passCtor(o){if(!o.getPlugin(ProgressivePlugin))throw"Add ProgressivePlugin before TAA";const c=o.isAntialiased,d=new TAAPass(()=>{var _;return(_=o.getPlugin(ProgressivePlugin))===null||_===void 0?void 0:_.lastFrame},o.getPlugin(GBufferPlugin).getUnpackSnippet(),c);return o.renderer.addEventListener("resize",d.onSizeUpdate),d}setDirty(){var o;(o=this._viewer)===null||o===void 0||o.setDirty()}async onDispose(o){return this.pass&&o.renderer.removeEventListener("resize",this.pass.passObject.onSizeUpdate),super.onDispose(o)}_update(o){if(!super._update(o))return!1;const c=o.renderer.frameCount,d=this._pass.passObject;if(d.taaEnabled=c<=1&&o.scene.renderCamera===o.scene.activeCamera,!d.taaEnabled)return!1;const _=o.scene.renderCamera;return d.updateShaderProperties([o.getPlugin(GBufferPlugin),_,o.getPluginByType("VelocityBuffer")]),d.target=o.getPlugin(ProgressivePlugin).lastFrame,d.updateCameraProperties(_==null?void 0:_.cameraObject),!0}async onAdded(o){await super.onAdded(o),this.stableNoise=this._stableNoise}get stableNoise(){var o,c;return(c=(o=this._viewer)===null||o===void 0?void 0:o.renderer.stableNoise)!==null&&c!==void 0?c:this._stableNoise}set stableNoise(o){this._viewer&&(this._viewer.renderer.stableNoise=o),this._stableNoise=o}get uiConfig(){var o;const c=(o=this.pass)===null||o===void 0?void 0:o.passObject.uiConfig;if(c&&c.children)return c.children.includes(this._stableNoiseConfig)||c.children.push(this._stableNoiseConfig),c}}TemporalAAPlugin.PluginType="TAA";var FullScreenPlugin_decorate=function(h,o,c,d){var _,v=arguments.length,b=v<3?o:d===null?d=Object.getOwnPropertyDescriptor(o,c):d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(h,o,c,d);else for(var tt=h.length-1;tt>=0;tt--)(_=h[tt])&&(b=(v<3?_(b):v>3?_(o,c,b):_(o,c))||b);return v>3&&b&&Object.defineProperty(o,c,b),b};let FullScreenPlugin=class extends AViewerPlugin{constructor(){super(),this.toJSON=void 0,this.enabled=!0,this._lastSize=["100%","100%"],this._lastFsElement=null,this._fsChangeHandler=h=>{var o;if(this.isFullScreen())this.dispatchEvent({type:"enter"});else{const c=this._lastFsElement||((o=this._viewer)===null||o===void 0?void 0:o.canvas);c&&(c.style.width=this._lastSize[0],c.style.height=this._lastSize[1]),document.removeEventListener("webkitfullscreenchange",this._fsChangeHandler,!1),document.removeEventListener("mozfullscreenchange",this._fsChangeHandler,!1),document.removeEventListener("fullscreenchange",this._fsChangeHandler,!1),document.removeEventListener("MSFullscreenChange",this._fsChangeHandler,!1),this.dispatchEvent({type:"exit"})}},this.enter=this.enter.bind(this),this.exit=this.exit.bind(this)}async enter(h){var o;if(this.isFullScreen())return;const c=h||((o=this._viewer)===null||o===void 0?void 0:o.canvas);return c?(this._lastFsElement=c,document.addEventListener&&(document.addEventListener("webkitfullscreenchange",this._fsChangeHandler,!1),document.addEventListener("mozfullscreenchange",this._fsChangeHandler,!1),document.addEventListener("fullscreenchange",this._fsChangeHandler,!1),document.addEventListener("MSFullscreenChange",this._fsChangeHandler,!1)),this._lastSize=[c.style.width,c.style.height],c.style.width="100%",c.style.height="100%",c.requestFullscreen?c.requestFullscreen():c.mozRequestFullScreen?c.mozRequestFullScreen():c.webkitRequestFullscreen?c.webkitRequestFullscreen():c.msRequestFullscreen?c.msRequestFullscreen():void 0):void 0}async exit(){return document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen?document.msExitFullscreen():void 0}async toggle(h){return this.isFullScreen()?this.exit():this.enter(h)}isFullScreen(){return document.webkitIsFullScreen||document.mozFullScreen||document.msFullscreenElement!==void 0}};FullScreenPlugin.PluginType="FullScreenPlugin",FullScreenPlugin_decorate([uiButton("Enter FullScreen")],FullScreenPlugin.prototype,"enter",null),FullScreenPlugin_decorate([uiButton("Exit FullScreen")],FullScreenPlugin.prototype,"exit",null),FullScreenPlugin_decorate([uiButton("Toggle FullScreen")],FullScreenPlugin.prototype,"toggle",null),FullScreenPlugin=FullScreenPlugin_decorate([uiFolder("Full Screen")],FullScreenPlugin);const ensureUniqueNames=h=>{const o=[],c=new Set;for(const d of h){let _=d,v=0;for(;c.has(_);)_=d+"."+ ++v;c.add(_),o.push(_)}return o},mappingsArrayToTable=(h,o)=>{const c={};for(const d of h.mappings)for(const _ of d.variants)c[o[_]]={material:null,gltfMaterialIndex:d.material};return c},compatibleObject=h=>h.material!==void 0&&h.userData&&h.userData._variantMaterials,khrMaterialsVariantsGLTF="KHR_materials_variants";class GLTFMaterialsVariantsExtensionImport{constructor(o){this.parser=o,this.name=khrMaterialsVariantsGLTF}async afterRoot(o){const c=this.parser,d=c.json;if(!d.extensions||!d.extensions[this.name])return;const _=d.extensions[this.name].variants||[],v=ensureUniqueNames(_.map(b=>b.name));for(const b of o.scenes)b.traverse(tt=>{const it=c.associations.get(tt);if(!it||it.meshes===void 0||it.primitives===void 0)return;const nt=d.meshes[it.meshes].primitives[it.primitives].extensions;nt&&nt[this.name]&&(tt.userData._variantMaterials=mappingsArrayToTable(nt[this.name],v))});await Promise.all(o.scenes.map(async b=>{const tt=[];return b.traverse(it=>compatibleObject(it)&&tt.push((async nt=>{const lt=nt.material,ut=nt.userData._variantMaterials,ht=[];for(const _t in ut){const ft=ut[_t];if(ft.material)continue;const bt=ft.gltfMaterialIndex;ht.push(c.getDependency("material",bt).then(xt=>{nt.material=xt,c.assignFinalMaterial(nt),ut[_t].material=nt.material}))}return Promise.all(ht).then(()=>{nt.material=lt})})(it))),b.userData.__importData||(b.userData.__importData={}),b.userData.__importData[khrMaterialsVariantsGLTF]={names:v},Promise.all(tt)}))}}const GLTFMaterialsVariantsExtensionExport_compatibleObject=h=>h.material!==void 0&&h.userData&&h.userData._variantMaterials&&!!Object.values(h.userData._variantMaterials).filter(o=>compatibleMaterial(o==null?void 0:o.material)),compatibleMaterial=h=>h&&h.isMaterial&&!Array.isArray(h);class GLTFExporterMaterialsVariantsExtensionExport{constructor(o){this.writer=o,this.name=khrMaterialsVariantsGLTF,this.variantNames=[]}beforeParse(o){const c=new Set;for(const d of o)d.traverse(_=>{if(!GLTFMaterialsVariantsExtensionExport_compatibleObject(_))return;const v=_.userData._variantMaterials;for(const b in v){const tt=v[b];compatibleMaterial(tt.material)&&c.add(b)}});c.forEach(d=>this.variantNames.push(d))}writeMesh(o,c){var d;if(!GLTFMaterialsVariantsExtensionExport_compatibleObject(o))return;const _=o.userData,v=_._variantMaterials,b={};for(const nt in v){const lt=v[nt].material;if(!compatibleMaterial(lt))continue;const ut=this.variantNames.indexOf(nt),ht=this.writer.processMaterial(lt);b[ht]||(b[ht]={material:ht,variants:[]}),b[ht].variants.push(ut)}const tt=Object.values(b).map(nt=>nt.variants.sort((lt,ut)=>lt-ut)&&nt).sort((nt,lt)=>nt.material-lt.material);if(tt.length===0)return;const it=compatibleMaterial(_._originalMaterial)&&(d=this.writer.processMaterial(_._originalMaterial))!==null&&d!==void 0?d:-1;for(const nt of c.primitives)it>=0&&(nt.material=it),nt.extensions=nt.extensions||{},nt.extensions[this.name]={mappings:tt}}afterParse(o){if(this.variantNames.length===0)return;const c=this.writer.json;c.extensions=c.extensions||{};const d=this.variantNames.map(_=>({name:_}));c.extensions[this.name]={variants:d},this.writer.extensionsUsed[this.name]=!0}}function gltfExporterMaterialsVariantsExtensionExport(h){return new GLTFExporterMaterialsVariantsExtensionExport(h)}var GLTFKHRMaterialVariantsPlugin_decorate=function(h,o,c,d){var _,v=arguments.length,b=v<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(h,o,c,d);else for(var tt=h.length-1;tt>=0;tt--)(_=h[tt])&&(b=(v<3?_(b):v>3?_(o,c,b):_(o,c))||b);return v>3&&b&&Object.defineProperty(o,c,b),b};class GLTFKHRMaterialVariantsPlugin extends AViewerPlugin{constructor(){super(),this.enabled=!0,this.toJSON=void 0,this.dependencies=[AssetManagerPlugin],this.variants={},this.selectedVariant="",this._objectAdded=o=>{var c,d;const _=o.object;(_==null?void 0:_.assetType)==="model"&&_.modelObject&&this._viewer&&(_.modelObject.traverse(v=>{var b,tt,it,nt,lt;if(v.userData._variantMaterials)for(const _t of Object.values(v.userData._variantMaterials))_t!=null&&_t.material&&(_t.material=((it=(tt=(b=this._viewer)===null||b===void 0?void 0:b.getManager())===null||tt===void 0?void 0:tt.materials)===null||it===void 0?void 0:it.processMaterial(_t.material,{}))||_t.material);const ut=(lt=(nt=v.userData)===null||nt===void 0?void 0:nt.__importData)===null||lt===void 0?void 0:lt[khrMaterialsVariantsGLTF];if(!ut)return;const ht=ut.names||[];for(const _t of ht)this.variants[_t]||(this.variants[_t]=[]),this.variants[_t].push(v);delete v.userData.__importData[khrMaterialsVariantsGLTF]}),(d=(c=this.uiConfig).uiRefresh)===null||d===void 0||d.call(c))},this.uiConfig={type:"folder",label:"KHR Material Variants",children:[()=>({children:[null,...Object.keys(this.variants)].map(o=>o?{label:o}:{label:"none",value:""}),type:"dropdown",label:"Variant",property:[this,"selectedVariant"]})]},this._loaderCreate=this._loaderCreate.bind(this)}async onAdded(o){var c,d,_,v;await super.onAdded(o),o.scene.addEventListener("addSceneObject",this._objectAdded);const b=o.getPlugin(AssetManagerPlugin);(c=b==null?void 0:b.importer)===null||c===void 0||c.addEventListener("loaderCreate",this._loaderCreate),(v=(_=(d=b==null?void 0:b.exporter)===null||d===void 0?void 0:d.getExporter("gltf","glb"))===null||_===void 0?void 0:_.extensions)===null||v===void 0||v.push(gltfExporterMaterialsVariantsExtensionExport)}_loaderCreate({loader:o}){o.isGLTFLoader2&&o.register(c=>new GLTFMaterialsVariantsExtensionImport(c))}async onRemove(o){var c,d,_,v,b,tt;o.scene.removeEventListener("addSceneObject",this._objectAdded);const it=o.getPlugin(AssetManagerPlugin);(c=it.importer)===null||c===void 0||c.removeEventListener("loaderCreate",this._loaderCreate);const nt=(v=(_=(d=it.exporter)===null||d===void 0?void 0:d.getExporter("gltf","glb"))===null||_===void 0?void 0:_.extensions)===null||v===void 0?void 0:v.indexOf(gltfExporterMaterialsVariantsExtensionExport);return nt!==void 0&&nt!==-1&&((tt=(b=it.exporter.getExporter("gltf","glb"))===null||b===void 0?void 0:b.extensions)===null||tt===void 0||tt.splice(nt,1)),this.variants={},super.onRemove(o)}_variantChanged(){this.applyVariant(this.selectedVariant||"",!0)}applyVariant(o,c=!1,d,_=!0){if(!c&&!d&&this.selectedVariant===o||!o)return;d||(this.selectedVariant=o);const v=d?Array.isArray(d)?d:[d]:o?this.variants[o]||[]:Object.values(this.variants).flat();for(const b of v){const tt=new Set,it=nt=>{var lt,ut;if(!nt.userData._variantMaterials||tt.has(nt))return;const ht=o?(lt=nt.userData._variantMaterials[o])===null||lt===void 0?void 0:lt.material:nt.userData._originalMaterial;ht&&(nt.userData._originalMaterial||(nt.userData._originalMaterial=nt.material),(ut=nt==null?void 0:nt.setMaterial)===null||ut===void 0||ut.call(nt,ht)),tt.add(nt)};_?b.traverse(it):it(b)}}}GLTFKHRMaterialVariantsPlugin.PluginType="GLTFKHRMaterialVariantsPlugin",GLTFKHRMaterialVariantsPlugin_decorate([x$1(GLTFKHRMaterialVariantsPlugin.prototype._variantChanged)],GLTFKHRMaterialVariantsPlugin.prototype,"selectedVariant",void 0);var edgeMask="uniform vec2 screenSize;uniform sampler2D tNormalDepth;uniform sampler2D tNormalBuffer;uniform sampler2D tGBufferFlags;uniform float radius;uniform vec2 cameraNearFar;uniform vec3 cameraPositionWorld;const float depthStep=0.2;const float normalThreshold=0.9;float unpack16(vec2 value){return(value.x*0.996108949416342426275150501169264316558837890625+value.y*0.00389105058365758760263730664519243873655796051025390625);}vec3 unpackNormal(vec2 enc){vec2 fenc=enc*4.-2.;float f=dot(fenc,fenc);float g=sqrt(1.-f/4.);return vec3(fenc*g,1.-f/2.);}void lookupNormalDepth(out float depth,out vec3 normal,vec2 off){vec2 uv=(gl_FragCoord.st+off)/screenSize;vec4 texel=texture2D(tNormalDepth,uv);depth=mix(cameraNearFar.x,cameraNearFar.y,pow(unpack16(texel.xy),2.));normal=2.*texture2D(tNormalBuffer,uv).rgb-1.;}float getBorderWeight(){float depth1,depth2,depth3,depth4;vec3 normal1,normal2,normal3,normal4;float d_=dot(cameraPositionWorld,cameraPositionWorld);float radiusModifier=clamp(3./(1.+pow(abs(d_),0.5)),0.,1.);float modRad=radius;lookupNormalDepth(depth1,normal1,vec2(0.,modRad));lookupNormalDepth(depth2,normal2,vec2(0.,-modRad));lookupNormalDepth(depth3,normal3,vec2(modRad,0.));lookupNormalDepth(depth4,normal4,vec2(-modRad,0.));vec2 uv=(gl_FragCoord.st)/screenSize;float mask=step(0.0001,texture2D(tGBufferFlags,uv).g);float mask1=texture2D(tGBufferFlags,uv+vec2(0.,modRad)/screenSize).b*255.;float mask2=texture2D(tGBufferFlags,uv+vec2(0.,-modRad)/screenSize).b*255.;float mask3=texture2D(tGBufferFlags,uv+vec2(modRad,0.)/screenSize).b*255.;float mask4=texture2D(tGBufferFlags,uv+vec2(-modRad,0.)/screenSize).b*255.;float maskWeight=max(abs(mask1-mask2),abs(mask3-mask4))*255.;maskWeight=(step(maskWeight,0.01));float a1=dot(normal1,normal2);float a2=dot(normal3,normal4);float normalWeight=min(abs(a1),abs(a2));normalWeight=1.-step(normalThreshold,normalWeight);float depthWeight=max(abs(depth1-depth2),abs(depth3-depth4));depthWeight=(step(depthWeight,depthStep));return normalWeight*depthWeight*maskWeight*mask;}void main(){float weight=getBorderWeight();vec2 uv=gl_FragCoord.st/screenSize;vec4 texel=texture2D(tNormalDepth,uv);float depth=pow(unpack16(texel.xy),2.);vec3 outColor=vec3(0.);if(depth>0.999){weight=0.;}else{outColor=vec3(weight);}gl_FragColor=vec4(outColor,1.);}",seperableBlurShaderMasked="varying vec2 vUv;uniform sampler2D colorTexture;uniform sampler2D maskTexture;uniform vec2 texSize;uniform vec2 direction;float gaussianPdf(in float x,in float sigma){return 0.39894*exp(-0.5*x*x/(sigma*sigma))/sigma;}void main(){vec2 invSize=1./texSize;float fSigma=float(SIGMA);float weightSum=gaussianPdf(0.,fSigma);vec4 mask=texture2D(maskTexture,vUv);vec3 diffuseSum=texture2D(colorTexture,vUv).rgb*weightSum;for(int i=1;i<KERNEL_RADIUS;i++){float x=float(i);float w=gaussianPdf(x,fSigma);vec2 uvOffset=direction*invSize*x;vec3 sample1=texture2D(colorTexture,vUv+uvOffset).rgb;vec3 sample2=texture2D(colorTexture,vUv-uvOffset).rgb;diffuseSum+=(sample1+sample2)*w;weightSum+=2.*w;}gl_FragColor=vec4(diffuseSum/weightSum,1.);}",blurNormal=`uniform sampler2D tNormalBuffer;uniform sampler2D edgeMaskBuffer;uniform vec2 screenSize;uniform float dpr;const float depthStep=0.02;uniform vec2 samples[NUM_SAMPLES];uniform vec3 cameraPositionWorld;varying vec2 vUv;
#include <common>
float getBevelRadius(in float number){return floor(number/8.);}vec3 smoothNormal(){vec2 uv=gl_FragCoord.xy/screenSize;vec4 texel=texture2D(tNormalDepth,uv);vec4 edgeMask=texture2D(edgeMaskBuffer,uv);vec3 avgNormal=2.*texture2D(tNormalBuffer,uv).rgb-1.;float depth=pow(unpack16(texel.xy),2.);vec2 invScreenSize=vec2(1.)/screenSize;vec4 mask=texture2D(tGBufferFlags,uv);float weightSum=0.;float radius=getBevelRadius(mask.g*255.)*2.*dpr;float randomAngle=6.2*random(frameCount*0.1);float theta=randomAngle;float snTheta=sin(theta);float csTheta=cos(theta);mat2 randomRotationMatrix=mat2(csTheta,snTheta,-snTheta,csTheta);float d_=dot(cameraPositionWorld,cameraPositionWorld);float radiusModifier=clamp(1./(1.+pow(abs(d_),0.5)),0.,1.);for(int i=0;i<5;i++){float x=float(i)-2.;for(int j=0;j<5;j++){float y=float(j)-2.;vec2 offset=randomRotationMatrix*vec2(x,y)*radius*radiusModifier*invScreenSize;vec4 texel=texture2D(tNormalDepth,uv+offset);float offsetDepth=pow(unpack16(texel.xy),2.);float depthWeight=abs(offsetDepth-depth);depthWeight=(1.-step(depthStep,depthWeight));vec3 offsetNormal=2.*texture2D(tNormalBuffer,uv+offset).rgb-1.;if(dot(offsetNormal,offsetNormal)>0.){avgNormal+=offsetNormal*depthWeight;}}}return normalize(avgNormal);}void main(){vec2 uv=gl_FragCoord.xy/screenSize;vec4 edgeMask=texture2D(edgeMaskBuffer,uv);vec3 normal=vec3(0.);if(edgeMask.x>0.){normal=smoothNormal();}else{normal=2.*texture2D(tNormalBuffer,uv).rgb-1.;}gl_FragColor=vec4(vec3(0.5*normal+0.5),1.);}`,SSBevelPass_decorate=function(h,o,c,d){var _,v=arguments.length,b=v<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(h,o,c,d);else for(var tt=h.length-1;tt>=0;tt--)(_=h[tt])&&(b=(v<3?_(b):v>3?_(o,c,b):_(o,c))||b);return v>3&&b&&Object.defineProperty(o,c,b),b};function addSSBevel(h){const o=h==null?void 0:h.userData;if(!o)return!1;o._ssBevel||(o._ssBevel={});const c=o._ssBevel;return c.hasSSBevel=!0,c.radius===void 0&&(c.radius=0),h.isMaterial&&(h.needsUpdate=!0),!0}let SSBevelPass=class extends ShaderPass2{constructor(h,o,c,d){super({defines:{NUM_SAMPLES:16},uniforms:{tNormalDepth:{value:null},tNormalBuffer:{value:null},tGBufferFlags:{value:null},edgeMaskBuffer:{value:null},screenSize:{value:new three_module.I9Y},radius:{value:1},samples:{value:null},frameCount:{value:0},dpr:{value:1},cameraPositionWorld:{value:new three_module.Pq0(1,1,1)}},vertexShader:defaultVertex,fragmentShader:`

            ${c}

            ${randomHelpers}

            ${blurNormal}
            
            `},"tDiffuse"),this.uiConfig=void 0,this.sceneBevel=!1,this.sceneBevelRadius=2,this.materialExtension={shaderExtender:(_,v,b)=>{var tt,it;const nt=(it=(tt=v.materialObject.userData)===null||tt===void 0?void 0:tt._ssBevel)===null||it===void 0?void 0:it.hasSSBevel;!this.enabled||this.sceneBevel&&nt===!1||!this.sceneBevel&&!nt||(_.fragmentShader=shaderReplaceString(_.fragmentShader,"#include <normal_fragment_maps>",` 
                normal = 2. * texture2D(tSSBevelMap, viewToScreen(vViewPosition.xyz).xy).rgb - 1.;
                normal = normalize(normal);
            `))},onObjectRender:(_,v,b)=>{var tt,it;const nt=(it=(tt=v.materialObject.userData)===null||tt===void 0?void 0:tt._ssBevel)===null||it===void 0?void 0:it.hasSSBevel;if(!this.enabled||this.sceneBevel&&nt===!1||!this.sceneBevel&&!nt)return;const lt=v.materialObject,ut=this._target.texture;this.materialExtension.extraUniforms.tSSBevelMap.value!==ut&&(this.materialExtension.extraUniforms.tSSBevelMap.value=ut,lt.needsUpdate=!0)},getUiConfig:_=>{const v={type:"folder",label:"SSBevel (Dev)",children:[{type:"checkbox",label:"Enabled",get value(){var b;return((b=_.materialObject.userData._ssBevel)===null||b===void 0?void 0:b.hasSSBevel)||!1},set value(b){var tt,it;b!==((tt=_.materialObject.userData._ssBevel)===null||tt===void 0?void 0:tt.hasSSBevel)&&(b?addSSBevel(_.materialObject)||alert("Cannot add screen space bevel."):_.materialObject.userData._ssBevel&&(_.materialObject.userData._ssBevel.hasSSBevel=!1,_.materialObject.needsUpdate=!0),(it=v.uiRefresh)===null||it===void 0||it.call(v,"postFrame",!0))},onChange:this.setDirty},()=>({type:"slider",bounds:[0,16],label:"radius",hidden:()=>{var b;return!(!((b=_.materialObject.userData._ssBevel)===null||b===void 0)&&b.hasSSBevel)},property:[_.materialObject.userData._ssBevel,"radius"],onChange:this.setDirty})]};return v},parsFragmentSnippet:(_,v)=>{var b,tt;const it=(tt=(b=v==null?void 0:v.materialObject.userData)===null||b===void 0?void 0:b._ssBevel)===null||tt===void 0?void 0:tt.hasSSBevel;return!this.enabled||this.sceneBevel&&it===!1||!this.sceneBevel&&!it?"":fe$1`
            uniform sampler2D tSSBevelMap;
            ${simpleCameraHelpers}
            `},extraUniforms:{tSSBevelMap:{value:null}},computeCacheKey:_=>{var v,b;return(this.enabled?"1":"0")+(this.sceneBevel?"1":"0")+(!((b=(v=_.materialObject.userData)===null||v===void 0?void 0:v._ssBevel)===null||b===void 0)&&b.hasSSBevel?"1":"0")},isCompatible:_=>_.isMeshStandardMaterial2},this._target=o,this.needsSwap=!1,this.clear=!0,this._viewerApp=d,this._edgeMaterial=new ShaderMaterial2({uniforms:{tNormalDepth:{value:null},tNormalBuffer:{value:null},tGBufferFlags:{value:null},screenSize:{value:null},radius:{value:10},cameraNearFar:{value:new three_module.I9Y(1,1)},cameraPositionWorld:{value:new three_module.Pq0(1,1,1)}},vertexShader:defaultVertex,fragmentShader:edgeMask}),this._separableBlurMaterial=new ShaderMaterial2({defines:{KERNEL_RADIUS:3,SIGMA:3},uniforms:{colorTexture:{value:null},maskTexture:{value:null},texSize:{value:new three_module.I9Y(.5,.5)},direction:{value:new three_module.I9Y(.5,.5)}},vertexShader:defaultVertex,fragmentShader:seperableBlurShaderMasked})}render(h,o,c,d,_){var v,b;if(!this.enabled)return;const tt=h.baseRenderer,it={minFilter:three_module.k6q,magFilter:three_module.k6q,isAntialiased:!1,format:three_module.GWd,depthBuffer:!1,generateMipmaps:!1},nt=tt.getTempTarget(it);this._renderEdges(tt,nt),this._blurEdges(tt,nt),this._viewerApp.scene.renderCamera.updateShaderProperties(this.material),(v=this._viewerApp.getPlugin(GBufferPlugin))===null||v===void 0||v.updateShaderProperties(this.material),(b=this._viewerApp.getPlugin(NormalBufferPlugin))===null||b===void 0||b.updateShaderProperties(this.material),this._viewerApp.renderer.updateShaderProperties(this.material),this.uniforms.edgeMaskBuffer.value=nt.texture,this.uniforms.dpr.value=this._viewerApp.renderer.displayCanvasScaling,super.render(h,this._target,nt,d,_),tt.releaseTempTarget(nt)}_initsamples(){const h=[];return h.push(new three_module.I9Y(-8,0).multiplyScalar(.125)),h.push(new three_module.I9Y(-6,-4).multiplyScalar(.125)),h.push(new three_module.I9Y(-3,-2).multiplyScalar(.125)),h.push(new three_module.I9Y(-2,-6).multiplyScalar(.125)),h.push(new three_module.I9Y(1,-1).multiplyScalar(.125)),h.push(new three_module.I9Y(2,-5).multiplyScalar(.125)),h.push(new three_module.I9Y(6,-7).multiplyScalar(.125)),h.push(new three_module.I9Y(5,-3).multiplyScalar(.125)),h.push(new three_module.I9Y(4,1).multiplyScalar(.125)),h.push(new three_module.I9Y(7,4).multiplyScalar(.125)),h.push(new three_module.I9Y(3,5).multiplyScalar(.125)),h.push(new three_module.I9Y(0,7).multiplyScalar(.125)),h.push(new three_module.I9Y(-1,3).multiplyScalar(.125)),h.push(new three_module.I9Y(-4,6).multiplyScalar(.125)),h.push(new three_module.I9Y(-7,8).multiplyScalar(.125)),h.push(new three_module.I9Y(-5,2).multiplyScalar(.125)),h}_blurEdges(h,o){var c,d;const _={minFilter:three_module.k6q,magFilter:three_module.k6q,isAntialiased:!1,format:three_module.GWd,depthBuffer:!1,generateMipmaps:!1,sizeMultiplier:.5},v=h.getTempTarget(_),b=((c=o.texture.image)===null||c===void 0?void 0:c.width)||1,tt=((d=o.texture.image)===null||d===void 0?void 0:d.height)||1;this._separableBlurMaterial.uniforms.texSize.value=new three_module.I9Y(b,tt),this._separableBlurMaterial.uniforms.colorTexture.value=o.texture,this._separableBlurMaterial.uniforms.direction.value=new three_module.I9Y(1,0),h.blit(void 0,v,{material:this._separableBlurMaterial}),this._separableBlurMaterial.uniforms.texSize.value=new three_module.I9Y(b/2,tt/2),this._separableBlurMaterial.uniforms.colorTexture.value=v.texture,this._separableBlurMaterial.uniforms.direction.value=new three_module.I9Y(0,1),h.blit(void 0,o,{material:this._separableBlurMaterial}),h.releaseTempTarget(v)}_renderEdges(h,o){var c,d,_,v;const b=((c=o.texture.image)===null||c===void 0?void 0:c.width)||1,tt=((d=o.texture.image)===null||d===void 0?void 0:d.height)||1;this._edgeMaterial.uniforms.screenSize.value=new three_module.I9Y(b,tt),this._viewerApp.scene.renderCamera.updateShaderProperties(this._edgeMaterial),(_=this._viewerApp.getPlugin(GBufferPlugin))===null||_===void 0||_.updateShaderProperties(this._edgeMaterial),(v=this._viewerApp.getPlugin(NormalBufferPlugin))===null||v===void 0||v.updateShaderProperties(this._edgeMaterial),h.blit(void 0,o,{material:this._edgeMaterial})}};SSBevelPass_decorate([uiToggle("Scene Bevel"),serialize(),x$1(SSBevelPass.prototype.setDirty)],SSBevelPass.prototype,"sceneBevel",void 0),SSBevelPass_decorate([uiSlider("Scene Bevel Radius",[0,8],.1),serialize(),x$1(SSBevelPass.prototype.setDirty)],SSBevelPass.prototype,"sceneBevelRadius",void 0),SSBevelPass=SSBevelPass_decorate([uiFolder("SSBevel")],SSBevelPass);class SSBevelPlugin extends GenericFilterPlugin{get bevelTarget(){return this._bevelTarget}constructor(o=!0){super(),this.passId="ssBevel",this._beforeFilters=["render"],this._afterFilters=["gbuffer","normalBuffer"],this._requiredFilters=["render","gbuffer","normalBuffer"],this._lastEnabled=!1,this.dependencies=[AssetManagerPlugin,GBufferPlugin,NormalBufferPlugin],this.enabled=o,this.setDirty=this.setDirty.bind(this),this._loaderCreate=this._loaderCreate.bind(this),this.updateGBuffer=this.updateGBuffer.bind(this)}_loaderCreate({loader:o}){o.isGLTFLoader2&&o.register(c=>new GLTFMaterialsSSBevelExtensionImport(c))}passCtor(o){var c,d;return this._bevelTarget=o.renderer.createTarget({depthBuffer:!0,type:three_module.ix0,minFilter:three_module.hxR,magFilter:three_module.hxR,generateMipmaps:!1}),this._bevelTarget.texture.name="bevelBuffer",this._bevelTarget.texture.generateMipmaps=!1,o.getPluginByType("debug"),new SSBevelPass(o.renderer,this._bevelTarget,(d=(c=o.getPlugin(GBufferPlugin))===null||c===void 0?void 0:c.getUnpackSnippet())!==null&&d!==void 0?d:"",o)}async onAdded(o){var c,d,_,v,b,tt,it,nt;await super.onAdded(o);const lt=o.getPlugin(AssetManagerPlugin);return!((c=this.pass)===null||c===void 0)&&c.passObject.materialExtension&&((d=lt==null?void 0:lt.materials)===null||d===void 0||d.registerMaterialExtension((_=this.pass)===null||_===void 0?void 0:_.passObject.materialExtension)),(v=lt==null?void 0:lt.importer)===null||v===void 0||v.addEventListener("loaderCreate",this._loaderCreate),(it=(tt=(b=lt==null?void 0:lt.exporter)===null||b===void 0?void 0:b.getExporter("gltf","glb"))===null||tt===void 0?void 0:tt.extensions)===null||it===void 0||it.push(glTFMaterialsSSBevelExtensionExport),(nt=o.getPlugin(GBufferPlugin))===null||nt===void 0||nt.registerGBufferUpdater(this.updateGBuffer),super.onAdded(o)}async onRemove(o){return o.renderer.disposeTarget(this._bevelTarget),super.onRemove(o)}setDirty(){var o,c,d,_;(o=this._viewer)===null||o===void 0||o.setDirty(),(_=(c=this.pass)===null||c===void 0?void 0:(d=c.passObject.materialExtension).setDirty)===null||_===void 0||_.call(d)}_update(o){var c,d;let _=this.enabled;if(_&&!this._lastEnabled){const v=(c=this._viewer)===null||c===void 0?void 0:c.getPluginByType("NormalBufferPlugin");v&&!v.enabled&&(v.enabled=!0),v||(d=this._viewer)===null||d===void 0||d.console.error("SSBevelPlugin needs NormalBufferPlugin")}return this._lastEnabled=_,_}get uiConfig(){var o,c,d,_,v;const b=(d=(c=(o=this.pass)===null||o===void 0?void 0:o.passObject)===null||c===void 0?void 0:c.uiConfig)!==null&&d!==void 0?d:{};return(v=(_=b.children)===null||_===void 0?void 0:_.map(tt=>Ee$1(tt)))===null||v===void 0||v.flat(2).forEach(tt=>tt&&(tt.onChange=this.setDirty)),b}updateGBuffer(o,c){var d,_,v,b;if(!((d=this._pass)===null||d===void 0)&&d.passObject&&o.isMesh&&!((_=o.material)===null||_===void 0)&&_.userData){for(let nt=3;nt<8;nt++)c.y=clearBit(c.y,nt);const tt=(b=(v=o.material)===null||v===void 0?void 0:v.userData)===null||b===void 0?void 0:b._ssBevel;let it=this._pass.passObject.sceneBevel&&!(tt!=null&&tt.hasSSBevel)?this._pass.passObject.sceneBevelRadius:(tt==null?void 0:tt.radius)||0;it=Math.min(it,31),it<<=3,c.y=c.y|it}}getBevelMaterials(){var o;const c=new Set;return(o=this._viewer)===null||o===void 0||o.scene.modelRoot.traverse(d=>{var _,v;!((v=(_=d.material)===null||_===void 0?void 0:_.userData)===null||v===void 0)&&v._ssBevel.hasSSBevel&&c.add(d.material)}),Array.from(c)}}SSBevelPlugin.PluginType="SSBevelPlugin",SSBevelPlugin.SSBEVEL_GLTF_EXTENSION="WEBGI_materials_ssbevel";class GLTFMaterialsSSBevelExtensionImport{constructor(o){this.parser=o,this.name=SSBevelPlugin.SSBEVEL_GLTF_EXTENSION}async extendMaterialParams(o,c){const d=this.parser.json.materials[o];if(!d.extensions||!d.extensions[this.name])return Promise.resolve();const _=d.extensions[this.name];return c.userData||(c.userData={}),addSSBevel(c),c.userData._ssBevel=deserializeObject(_,c.userData._ssBevel,!1,{}),Promise.resolve()}}const glTFMaterialsSSBevelExtensionExport=h=>({writeMaterial:(o,c)=>{if(!o.isMeshStandardMaterial||!o.userData._ssBevel||!o.userData._ssBevel.hasSSBevel)return;c.extensions=c.extensions||{};const d=serializeObject(o.userData._ssBevel,!1);c.extensions[SSBevelPlugin.SSBEVEL_GLTF_EXTENSION]=d,h.extensionsUsed[SSBevelPlugin.SSBEVEL_GLTF_EXTENSION]=!0}});class GammaCorrectionExtension{constructor(){this.uiConfig=void 0,this.enabled=!0}shaderExtender(o,c,d){this.enabled&&(o.fragmentShader=shaderReplaceString(o.fragmentShader,"#glMarker",` 
            gl_FragColor = LinearTosRGB(gl_FragColor);
            #glMarker
        `))}computeCacheKey(o){return this.enabled?"1":"0"}isCompatible(o){return!0}}class GammaCorrectionPlugin extends GenericExtensionPlugin{generateExtension(o){return new GammaCorrectionExtension}}GammaCorrectionPlugin.PluginType="GammaCorrection";var triplanarmapping="struct TriplanarUV{vec2 x;vec2 y;vec2 z;};uniform float triplanarScale;uniform float triplanarBlend;uniform float triplanarOffset;vec3 getTriplanarWeights(in vec3 position,in vec3 normal){vec3 triW=abs(normal);triW=clamp(triW-vec3(triplanarOffset),vec3(0.),vec3(1.));triW=pow(triW,vec3(triplanarBlend));return triW/(triW.x+triW.y+triW.z);}TriplanarUV getTriplanarUV(in vec3 position,in vec3 normal){TriplanarUV triUV;triUV.x=position.zy*triplanarScale;triUV.y=position.xz*triplanarScale;triUV.z=position.xy*triplanarScale;if(normal.x<0.){triUV.x.x=-triUV.x.x;}if(normal.y<0.){triUV.y.x=-triUV.y.x;}if(normal.z>=0.){triUV.z.x=-triUV.z.x;}return triUV;}vec4 textureTriplanar(in sampler2D tex,in vec3 position,in vec3 normal){TriplanarUV triUV=getTriplanarUV(position,normal);vec4 texX=texture2D(tex,triUV.x);vec4 texY=texture2D(tex,triUV.y);vec4 texZ=texture2D(tex,triUV.z);vec3 triW=getTriplanarWeights(position,normal);return texX*triW.x+texY*triW.y+texZ*triW.z;}",TriplanarUVMappingPlugin_decorate=function(h,o,c,d){var _,v=arguments.length,b=v<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(h,o,c,d);else for(var tt=h.length-1;tt>=0;tt--)(_=h[tt])&&(b=(v<3?_(b):v>3?_(o,c,b):_(o,c))||b);return v>3&&b&&Object.defineProperty(o,c,b),b};let TriplanarUVMappingPlugin=class extends AViewerPlugin{addTriplanarMapping(h){var o;const c=(o=h.materialObject)===null||o===void 0?void 0:o.userData;return!!c&&(c._triplanarMapping||(c._triplanarMapping={}),c._triplanarMapping.enable=!0,c._triplanarMapping.scaleFactor===void 0&&(c._triplanarMapping.scaleFactor=1),c._triplanarMapping.blendFactor===void 0&&(c._triplanarMapping.blendFactor=1),c._triplanarMapping.offsetFactor===void 0&&(c._triplanarMapping.offsetFactor=0),h.materialObject.needsUpdate=!0,!0)}_loaderCreate({loader:h}){h.isGLTFLoader2&&h.register(o=>new GLTFMaterialsTriplanarMappingExtensionImport(o))}constructor(){super(),this.enabled=!0,this.dependencies=[AssetManagerPlugin],this._uniforms={triplanarScale:{value:1},triplanarBlend:{value:1},triplanarOffset:{value:0}},this.materialExtension={shaderExtender:(h,o,c)=>{var d,_;if(!this.enabled||!(!((_=(d=o.materialObject.userData)===null||d===void 0?void 0:d._triplanarMapping)===null||_===void 0)&&_.enable))return;const v=fe$1`
                #ifndef USE_TRANSMISSION
                    varying vec3 vWorldPosition;
                #endif
                varying vec3 vWorldNormal;
            `;h.vertexShader=shaderReplaceString(h.vertexShader,"#include <common>",v,{prepend:!0});const b=fe$1`
                // same as worldpos_vertex.glsl.js but added a !
                #if !(defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0)
                vec4 worldPosition = vec4( transformed, 1.0 );
                #ifdef USE_INSTANCING
                worldPosition = instanceMatrix * worldPosition;
                #endif
                worldPosition = modelMatrix * worldPosition;
                #endif
                
                #ifndef USE_TRANSMISSION
                    vWorldPosition = worldPosition.xyz; 
                #endif
                vWorldNormal = normalize((modelMatrix * vec4(objectNormal, 0.)).xyz);
            `;h.vertexShader=shaderReplaceString(h.vertexShader,"#include <worldpos_vertex>",b,{append:!0});const tt=fe$1`
                ${triplanarmapping}
                #ifndef USE_TRANSMISSION
                    varying vec3 vWorldPosition;
                #endif
                varying vec3 vWorldNormal;
            `;h.fragmentShader=shaderReplaceString(h.fragmentShader,"#include <common>",tt,{prepend:!0});const it=fe$1`

            #ifdef USE_BUMPMAP

            uniform sampler2D bumpMap;
            uniform float bumpScale;

            // Bump Mapping Unparametrized Surfaces on the GPU by Morten S. Mikkelsen
            // https://mmikk.github.io/papers3d/mm_sfgrad_bump.pdf

            // Evaluate the derivative of the height w.r.t. screen-space using forward differencing (listing 2)

            vec2 dHdxy_fwd() {

                vec3 dSTdx = dFdx( vWorldPosition );
                vec3 dSTdy = dFdy( vWorldPosition );

                vec3 normal_ = normalize(vWorldNormal);
                float Hll = bumpScale * textureTriplanar( bumpMap, vWorldPosition, normal_ ).x;
                float dBx = bumpScale * textureTriplanar( bumpMap, vWorldPosition + dSTdx, normal_ ).x - Hll;
                float dBy = bumpScale * textureTriplanar( bumpMap, vWorldPosition + dSTdy, normal_ ).x - Hll;

                return vec2( dBx, dBy );

            }

            vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {

                vec3 vSigmaX = dFdx( surf_pos.xyz );
                vec3 vSigmaY = dFdy( surf_pos.xyz );
                vec3 vN = surf_norm; // normalized

                vec3 R1 = cross( vSigmaY, vN );
                vec3 R2 = cross( vN, vSigmaX );

                float fDet = dot( vSigmaX, R1 ) * faceDirection;

                vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
                return normalize( abs( fDet ) * surf_norm - vGrad );

            }

        #endif
            `;h.fragmentShader=shaderReplaceString(h.fragmentShader,"#include <bumpmap_pars_fragment>",it);let nt=shaderReplaceString(three_module.vxI.map_fragment,"texture2D( map, vMapUv );","textureTriplanar( map, vWorldPosition, normalize(vWorldNormal) );");h.fragmentShader=shaderReplaceString(h.fragmentShader,"#include <map_fragment>",nt),nt=shaderReplaceString(three_module.vxI.roughnessmap_fragment,"texture2D( roughnessMap, vRoughnessMapUv );","textureTriplanar( roughnessMap, vWorldPosition, normalize(vWorldNormal));"),h.fragmentShader=shaderReplaceString(h.fragmentShader,"#include <roughnessmap_fragment>",nt),nt=shaderReplaceString(three_module.vxI.metalnessmap_fragment,"texture2D( metalnessMap, vMetalnessMapUv );","textureTriplanar( metalnessMap, vWorldPosition, normalize(vWorldNormal));"),h.fragmentShader=shaderReplaceString(h.fragmentShader,"#include <metalnessmap_fragment>",nt),nt=shaderReplaceString(three_module.vxI.normal_fragment_maps,"vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;","vec3 mapN = textureTriplanar( normalMap, vWorldPosition, normalize(vWorldNormal) ).xyz * 2.0 - 1.0;"),h.fragmentShader=shaderReplaceString(h.fragmentShader,"#include <normal_fragment_maps>",nt),h.defines.USE_UV=""},onObjectRender:(h,o)=>{var c,d,_,v;const b=o.materialObject.userData;if(!(!((c=b==null?void 0:b._triplanarMapping)===null||c===void 0)&&c.enable))return;const tt=h;tt.isMesh&&tt.geometry&&(this._uniforms.triplanarScale.value=(d=b._triplanarMapping)===null||d===void 0?void 0:d.scaleFactor,this._uniforms.triplanarBlend.value=(_=b._triplanarMapping)===null||_===void 0?void 0:_.blendFactor,this._uniforms.triplanarOffset.value=(v=b._triplanarMapping)===null||v===void 0?void 0:v.offsetFactor)},extraUniforms:{...this._uniforms},computeCacheKey:h=>{var o,c;return(this.enabled?"1":"0")+(!((c=(o=h.materialObject.userData)===null||o===void 0?void 0:o._triplanarMapping)===null||c===void 0)&&c.enable?"1":"0")},isCompatible:h=>h.isMeshStandardMaterial2,updaters:()=>{var h;return[(h=this._viewer)===null||h===void 0?void 0:h.renderer]},getUiConfig:h=>{const o=this._viewer,c=this.addTriplanarMapping,d={type:"folder",label:"Triplanar",children:[{type:"checkbox",label:"Enabled",get value(){var _;return((_=h.materialObject.userData._triplanarMapping)===null||_===void 0?void 0:_.enable)||!1},set value(_){var v,b;_!==((v=h.materialObject.userData._triplanarMapping)===null||v===void 0?void 0:v.enable)&&(_?c(h)||o.alert("Cannot add Triplanar mapping."):h.materialObject.userData._triplanarMapping&&(h.materialObject.userData._triplanarMapping.enable=!1,h.materialObject.needsUpdate=!0),(b=d.uiRefresh)===null||b===void 0||b.call(d,"postFrame",!0))},onChange:this.setDirty},()=>({type:"slider",bounds:[.1,10],label:"Scale",hidden:()=>{var _;return!(!((_=h.materialObject.userData._triplanarMapping)===null||_===void 0)&&_.enable)},property:[h.materialObject.userData._triplanarMapping,"scaleFactor"],onChange:this.setDirty}),()=>({type:"slider",bounds:[1,10],label:"Blend",hidden:()=>{var _;return!(!((_=h.materialObject.userData._triplanarMapping)===null||_===void 0)&&_.enable)},property:[h.materialObject.userData._triplanarMapping,"blendFactor"],onChange:this.setDirty}),()=>({type:"slider",bounds:[0,.5],stepSize:.01,label:"Offset",hidden:()=>{var _;return!(!((_=h.materialObject.userData._triplanarMapping)===null||_===void 0)&&_.enable)},property:[h.materialObject.userData._triplanarMapping,"offsetFactor"],onChange:this.setDirty})]};return d}},this.setDirty=()=>{var h,o,c;(o=(h=this.materialExtension).setDirty)===null||o===void 0||o.call(h),(c=this._viewer)===null||c===void 0||c.setDirty()},this._loaderCreate=this._loaderCreate.bind(this)}async onAdded(h){var o,c,d,_,v;await super.onAdded(h);const b=h.getPlugin(AssetManagerPlugin);(o=b==null?void 0:b.materials)===null||o===void 0||o.registerMaterialExtension(this.materialExtension),(c=b==null?void 0:b.importer)===null||c===void 0||c.addEventListener("loaderCreate",this._loaderCreate),(v=(_=(d=b==null?void 0:b.exporter)===null||d===void 0?void 0:d.getExporter("gltf","glb"))===null||_===void 0?void 0:_.extensions)===null||v===void 0||v.push(glTFMaterialsTriplanarMappingExtensionExport)}async onRemove(h){var o,c,d,_;return(c=(o=h.getPlugin(AssetManagerPlugin))===null||o===void 0?void 0:o.materials)===null||c===void 0||c.unregisterMaterialExtension(this.materialExtension),(_=(d=h.getPlugin(AssetManagerPlugin))===null||d===void 0?void 0:d.importer)===null||_===void 0||_.removeEventListener("loaderCreate",this._loaderCreate),super.onRemove(h)}};TriplanarUVMappingPlugin.PluginType="TriplanarUVMappingPlugin",TriplanarUVMappingPlugin.TRIPLANAR_GLTF_EXTENSION="WEBGI_materials_triplanar",TriplanarUVMappingPlugin_decorate([uiToggle("Enabled",h=>({onChange:h.setDirty})),serialize()],TriplanarUVMappingPlugin.prototype,"enabled",void 0),TriplanarUVMappingPlugin=TriplanarUVMappingPlugin_decorate([uiFolder("Triplanar Mapping")],TriplanarUVMappingPlugin);class GLTFMaterialsTriplanarMappingExtensionImport{constructor(o){this.parser=o,this.name=TriplanarUVMappingPlugin.TRIPLANAR_GLTF_EXTENSION}async extendMaterialParams(o,c){const d=this.parser.json.materials[o];if(!d.extensions||!d.extensions[this.name])return Promise.resolve();const _=d.extensions[this.name];c.userData||(c.userData={});const v=c.userData;return v._triplanarMapping||(v._triplanarMapping={}),v._triplanarMapping.enable=!0,v._triplanarMapping.scaleFactor===void 0&&(v._triplanarMapping.scaleFactor=1),v._triplanarMapping.blendFactor===void 0&&(v._triplanarMapping.blendFactor=1),v._triplanarMapping.offsetFactor===void 0&&(v._triplanarMapping.offsetFactor=0),c.userData._triplanarMapping=deserializeObject(_,c.userData._triplanarMapping,!1,{}),Promise.resolve()}}const glTFMaterialsTriplanarMappingExtensionExport=h=>({writeMaterial:(o,c)=>{var d;if(!o.isMeshStandardMaterial||!(!((d=o.userData._triplanarMapping)===null||d===void 0)&&d.enable))return;c.extensions=c.extensions||{};const _=serializeObject(o.userData._triplanarMapping,!1);c.extensions[TriplanarUVMappingPlugin.TRIPLANAR_GLTF_EXTENSION]=_,h.extensionsUsed[TriplanarUVMappingPlugin.TRIPLANAR_GLTF_EXTENSION]=!0}});var sscurvature="uniform float cutoff;uniform vec3 cavityColor;uniform float cavityRoughness;uniform float cavityMetalness;uniform float cavityScale;uniform float stepSize;uniform sampler2D cavityMap;float getSSCurvature(in vec3 position,in vec3 normal){vec3 n=normalize(normal);vec3 dx=dFdx(n);vec3 dy=dFdy(n);vec3 xneg=n-stepSize*dx;vec3 xpos=n+stepSize*dx;vec3 yneg=n-stepSize*dy;vec3 ypos=n+stepSize*dy;float depth=length(position);float curvature=(cross(xneg,xpos).y-cross(yneg,ypos).x)*4./depth;return curvature;}",LayeredMaterialPlugin_decorate=function(h,o,c,d){var _,v=arguments.length,b=v<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(h,o,c,d);else for(var tt=h.length-1;tt>=0;tt--)(_=h[tt])&&(b=(v<3?_(b):v>3?_(o,c,b):_(o,c))||b);return v>3&&b&&Object.defineProperty(o,c,b),b};let LayeredMaterialPlugin=class extends AViewerPlugin{addLayeredMaterial(h){var o;const c=(o=h.materialObject)===null||o===void 0?void 0:o.userData;return!!c&&(c._layeredMaterial||(c._layeredMaterial={}),c._layeredMaterial.enable=!0,c._layeredMaterial.cutoff===void 0&&(c._layeredMaterial.cutoff=-.65),c._layeredMaterial.cavityColor===void 0&&(c._layeredMaterial.cavityColor=new three_module.Q1f(5789527)),c._layeredMaterial.cavityRoughness===void 0&&(c._layeredMaterial.cavityRoughness=.5),c._layeredMaterial.cavityMetalness===void 0&&(c._layeredMaterial.cavityMetalness=.5),c._layeredMaterial.cavityScale===void 0&&(c._layeredMaterial.cavityScale=1),c._layeredMaterial.stepSize===void 0&&(c._layeredMaterial.stepSize=5),h.materialObject.needsUpdate=!0,!0)}_loaderCreate({loader:h}){h.isGLTFLoader2&&h.register(o=>new GLTFLayeredMaterialsExtensionImport(o))}constructor(){super(),this.enabled=!0,this.dependencies=[AssetManagerPlugin],this._uniforms={cutoff:{value:0},cavityColor:{value:new three_module.Q1f},cavityRoughness:{value:0},cavityMetalness:{value:0},cavityScale:{value:1},stepSize:{value:1}},this.materialExtension={shaderExtender:(h,o,c)=>{var d,_;if(!this.enabled||!(!((_=(d=o.materialObject.userData)===null||d===void 0?void 0:d._layeredMaterial)===null||_===void 0)&&_.enable))return;const v=fe$1`
                ${sscurvature}
            `;h.fragmentShader=shaderReplaceString(h.fragmentShader,"#include <common>",v,{prepend:!0});const b=fe$1`
                material.roughness = min( material.roughness, 1.0 );
                float curvature = getSSCurvature(vViewPosition, normal);
                float smoothCurvature = smoothstep(0., 1., curvature - cutoff);
                material.roughness = min( material.roughness, 1.0 );
                curvature = curvature * cavityScale;
                smoothCurvature = smoothCurvature * cavityScale;
                smoothCurvature = min(smoothCurvature, 1.);
                vec3 finalCavityColor = mix(cavityColor, cavityColor*0.5, vec3(smoothCurvature));
                material.roughness = mix(cavityRoughness, material.roughness, smoothCurvature);
                material.diffuseColor = mix(finalCavityColor, material.diffuseColor, smoothCurvature);
            `,tt=fe$1`
                material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
                material.specularColor = mix(material.specularColor, finalCavityColor, (1. - smoothCurvature) * cavityMetalness);
            `;let it=three_module.vxI.lights_physical_fragment.replace("material.roughness = min( material.roughness, 1.0 );",b);it=it.replace("material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );",tt),h.fragmentShader=shaderReplaceString(h.fragmentShader,"#include <lights_physical_fragment>",it);const nt=fe$1`
                vec3 debugCurvatureColor = vec3(0., 0., 1.);
                float _epsilon = 1e-4;
                vec3 green = vec3(0., 0., 0.);
                vec3 red = vec3(1., 1., 1.);
                //if(curvature > cutoff)debugCurvatureColor = green;
                //if(curvature < cutoff)debugCurvatureColor = red;
                // curvature /= 2.;
                // curvature = curvature * 0.5 + 0.5;
                debugCurvatureColor = smoothstep(green, red, vec3(curvature - cutoff));
                //debugCurvatureColor = step(red, vec3(curvature - cutoff));
                //debugCurvatureColor = step(green, vec3(curvature - cutoff));
                //gl_FragColor = vec4(vec3(curvature), 1./16.);
            `;h.fragmentShader=shaderReplaceString(h.fragmentShader,"#include <dithering_fragment>",nt),h.vertexUvs=!0},onObjectRender:(h,o)=>{var c,d,_,v,b,tt,it;const nt=o.materialObject.userData;if(!(!((c=nt==null?void 0:nt._layeredMaterial)===null||c===void 0)&&c.enable))return;const lt=h;lt.isMesh&&lt.geometry&&(this._uniforms.cutoff.value=(d=nt._layeredMaterial)===null||d===void 0?void 0:d.cutoff,this._uniforms.cavityRoughness.value=(_=nt._layeredMaterial)===null||_===void 0?void 0:_.cavityRoughness,this._uniforms.cavityMetalness.value=(v=nt._layeredMaterial)===null||v===void 0?void 0:v.cavityMetalness,this._uniforms.cavityScale.value=(b=nt._layeredMaterial)===null||b===void 0?void 0:b.cavityScale,this._uniforms.stepSize.value=(tt=nt._layeredMaterial)===null||tt===void 0?void 0:tt.stepSize,this._uniforms.cavityColor.value.copy((it=nt._layeredMaterial)===null||it===void 0?void 0:it.cavityColor))},extraUniforms:{...this._uniforms},computeCacheKey:h=>{var o,c;return(this.enabled?"1":"0")+(!((c=(o=h.materialObject.userData)===null||o===void 0?void 0:o._layeredMaterial)===null||c===void 0)&&c.enable?"1":"0")},isCompatible:h=>h.isMeshStandardMaterial2,updaters:()=>{var h;return[(h=this._viewer)===null||h===void 0?void 0:h.renderer]},getUiConfig:h=>{const o=this._viewer,c=this.addLayeredMaterial,d={type:"folder",label:"LayeredMaterial",children:[{type:"checkbox",label:"Enabled",get value(){var _;return((_=h.materialObject.userData._layeredMaterial)===null||_===void 0?void 0:_.enable)||!1},set value(_){var v,b;_!==((v=h.materialObject.userData._layeredMaterial)===null||v===void 0?void 0:v.enable)&&(_?c(h)||o.alert("Cannot add Triplanar mapping."):(h.materialObject.userData._layeredMaterial.enable=!1,h.materialObject.needsUpdate=!0),(b=d.uiRefresh)===null||b===void 0||b.call(d,"postFrame",!0))},onChange:this.setDirty},()=>({type:"slider",bounds:[-1,1],stepSize:.001,label:"cutoff",hidden:()=>{var _;return!(!((_=h.materialObject.userData._layeredMaterial)===null||_===void 0)&&_.enable)},property:[h.materialObject.userData._layeredMaterial,"cutoff"],onChange:this.setDirty}),()=>({type:"color",label:"color",hidden:()=>{var _;return!(!((_=h.materialObject.userData._layeredMaterial)===null||_===void 0)&&_.enable)},property:[h.materialObject.userData._layeredMaterial,"cavityColor"],onChange:this.setDirty}),()=>({type:"slider",bounds:[0,1],stepSize:.01,label:"roughness",hidden:()=>{var _;return!(!((_=h.materialObject.userData._layeredMaterial)===null||_===void 0)&&_.enable)},property:[h.materialObject.userData._layeredMaterial,"cavityRoughness"],onChange:this.setDirty}),()=>({type:"slider",bounds:[.1,20],stepSize:.01,label:"Scale",hidden:()=>{var _;return!(!((_=h.materialObject.userData._layeredMaterial)===null||_===void 0)&&_.enable)},property:[h.materialObject.userData._layeredMaterial,"cavityScale"],onChange:this.setDirty}),()=>({type:"slider",bounds:[.1,100],stepSize:.01,label:"StepSize",hidden:()=>{var _;return!(!((_=h.materialObject.userData._layeredMaterial)===null||_===void 0)&&_.enable)},property:[h.materialObject.userData._layeredMaterial,"stepSize"],onChange:this.setDirty}),()=>({type:"slider",bounds:[0,1],stepSize:.01,label:"metalness",hidden:()=>{var _;return!(!((_=h.materialObject.userData._layeredMaterial)===null||_===void 0)&&_.enable)},property:[h.materialObject.userData._layeredMaterial,"cavityMetalness"],onChange:this.setDirty})]};return d}},this.setDirty=()=>{var h;(h=this._viewer)===null||h===void 0||h.setDirty()},this._loaderCreate=this._loaderCreate.bind(this)}async onAdded(h){var o,c,d,_,v;await super.onAdded(h);const b=h.getPlugin(AssetManagerPlugin);(o=b==null?void 0:b.materials)===null||o===void 0||o.registerMaterialExtension(this.materialExtension),(c=b==null?void 0:b.importer)===null||c===void 0||c.addEventListener("loaderCreate",this._loaderCreate),(v=(_=(d=b==null?void 0:b.exporter)===null||d===void 0?void 0:d.getExporter("gltf","glb"))===null||_===void 0?void 0:_.extensions)===null||v===void 0||v.push(glTFLayeredMaterialsExtensionExport)}async onRemove(h){var o,c,d,_;return(c=(o=h.getPlugin(AssetManagerPlugin))===null||o===void 0?void 0:o.materials)===null||c===void 0||c.unregisterMaterialExtension(this.materialExtension),(_=(d=h.getPlugin(AssetManagerPlugin))===null||d===void 0?void 0:d.importer)===null||_===void 0||_.removeEventListener("loaderCreate",this._loaderCreate),super.onRemove(h)}};LayeredMaterialPlugin.PluginType="LayeredMaterialPlugin",LayeredMaterialPlugin.LAYERED_MATERIAL_GLTF_EXTENSION="WEBGI_materials_layered",LayeredMaterialPlugin_decorate([uiToggle("Enabled",h=>({onChange:h.setDirty})),serialize()],LayeredMaterialPlugin.prototype,"enabled",void 0),LayeredMaterialPlugin=LayeredMaterialPlugin_decorate([uiFolder("Layered Metal")],LayeredMaterialPlugin);class GLTFLayeredMaterialsExtensionImport{constructor(o){this.parser=o,this.name=LayeredMaterialPlugin.LAYERED_MATERIAL_GLTF_EXTENSION}async extendMaterialParams(o,c){const d=this.parser.json.materials[o];if(!d.extensions||!d.extensions[this.name])return Promise.resolve();const _=d.extensions[this.name];c.userData||(c.userData={});const v=c.userData;return v._layeredMaterial||(v._layeredMaterial={}),v._layeredMaterial.enable=!0,c.userData._layeredMaterial=deserializeObject(_,c.userData._layeredMaterial,!1,{}),Promise.resolve()}}const glTFLayeredMaterialsExtensionExport=h=>({writeMaterial:(o,c)=>{var d;if(!o.isMeshStandardMaterial||!(!((d=o.userData._layeredMaterial)===null||d===void 0)&&d.enable))return;c.extensions=c.extensions||{};const _=serializeObject(o.userData._layeredMaterial,!1);c.extensions[LayeredMaterialPlugin.LAYERED_MATERIAL_GLTF_EXTENSION]=_,h.extensionsUsed[LayeredMaterialPlugin.LAYERED_MATERIAL_GLTF_EXTENSION]=!0}});var ClearcoatTintPlugin_decorate=function(h,o,c,d){var _,v=arguments.length,b=v<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(h,o,c,d);else for(var tt=h.length-1;tt>=0;tt--)(_=h[tt])&&(b=(v<3?_(b):v>3?_(o,c,b):_(o,c))||b);return v>3&&b&&Object.defineProperty(o,c,b),b};let ClearcoatTintPlugin=class extends AViewerPlugin{addClearcoatTint(h){return addClearcoatTint(h.materialObject)}_loaderCreate({loader:h}){h.isGLTFLoader2&&h.register(o=>new GLTFMaterialsClearcoatTintExtensionImport(o))}constructor(){super(),this.enabled=!0,this.dependencies=[AssetManagerPlugin],this._defines={},this._uniforms={ccTintColor:{value:new three_module.Q1f},ccThickness:{value:0},ccIor:{value:0}},this.materialExtension={parsFragmentSnippet:(h,o)=>{var c;return this.enabled&&!((c=o==null?void 0:o.materialObject.userData._clearcoatTint)===null||c===void 0)&&c.enableTint&&o.materialObject.clearcoat>0?`
uniform vec3 ccTintColor;
uniform float ccThickness;
uniform float ccIor;
vec3 clearcoatTint(const in float dotNV, const in float dotNL, const in float clearcoat) {
    vec3 tint = ( ccThickness > 0. ? 1. - ccTintColor : ccTintColor); // Set thickness < 0 for glow.
    tint = exp(tint * -(ccThickness * ((dotNL + dotNV) / max(dotNL * dotNV, 1e-3)))); // beer's law
    return mix(vec3(1.0), tint, clearcoat);
}
        `:""},shaderExtender:(h,o,c)=>{var d;if(!(this.enabled&&!((d=o==null?void 0:o.materialObject.userData._clearcoatTint)===null||d===void 0)&&d.enableTint&&o.materialObject.clearcoat>0))return;const _="outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;",v="float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );";h.fragmentShader.includes(v)&&h.fragmentShader.includes(_)||console.error("ClearcoatTintPlugin: shaderExtender cannot patch shader, version changed?"),h.fragmentShader=h.fragmentShader.replace(v,`
            float dotNVcc = saturate( dot( geometryClearcoatNormal, -refract(geometryViewDir, geometryClearcoatNormal, 1./ccIor) ) );
            `),h.fragmentShader=h.fragmentShader.replace(_,`
            outgoingLight *= clearcoatTint(dotNVcc, dotNVcc, material.clearcoat);
            `+_),h.defines.USE_UV=""},onObjectRender:(h,o)=>{var c;const d=(c=o.materialObject.userData)===null||c===void 0?void 0:c._clearcoatTint;if(!(d!=null&&d.enableTint))return;this._uniforms.ccTintColor.value.set(d.tintColor),this._uniforms.ccThickness.value=d.thickness,this._uniforms.ccIor.value=d.ior;const _=this.enabled?1:0;o.materialObject.defines.CLEARCOAT_TINT_ENABLED!==_&&(o.materialObject.defines.CLEARCOAT_TINT_ENABLED=_,o.materialObject.needsUpdate=!0)},extraUniforms:{...this._uniforms},computeCacheKey:h=>{var o,c;return(this.enabled?"1":"0")+(!((c=(o=h.materialObject.userData)===null||o===void 0?void 0:o._clearcoatTint)===null||c===void 0)&&c.enableTint?"1":"0")+(h.materialObject.clearcoat>0?"1":"0")},isCompatible:h=>h.isMeshStandardMaterial2,updaters:()=>[],getUiConfig:h=>{const o=this._viewer,c={type:"folder",label:"ClearcoatTint",children:[{type:"checkbox",label:"Enabled",get value(){var d;return((d=h.materialObject.userData._clearcoatTint)===null||d===void 0?void 0:d.enableTint)||!1},set value(d){var _,v;d!==((_=h.materialObject.userData._clearcoatTint)===null||_===void 0?void 0:_.enableTint)&&(d?addClearcoatTint(h.materialObject)||o.alert("Cannot add clearcoat tint."):h.materialObject.userData._clearcoatTint&&(h.materialObject.userData._clearcoatTint.enableTint=!1,h.materialObject.needsUpdate=!0),(v=c.uiRefresh)===null||v===void 0||v.call(c,"postFrame",!0))},onChange:this.setDirty},()=>({type:"color",label:"Tint color",hidden:()=>{var d;return!(!((d=h.materialObject.userData._clearcoatTint)===null||d===void 0)&&d.enableTint)},property:[h.materialObject.userData._clearcoatTint,"tintColor"],onChange:this.setDirty}),()=>({type:"input",label:"Thickness",hidden:()=>{var d;return!(!((d=h.materialObject.userData._clearcoatTint)===null||d===void 0)&&d.enableTint)},property:[h.materialObject.userData._clearcoatTint,"thickness"],onChange:this.setDirty}),()=>({type:"slider",bounds:[.8,2.5],label:"IOR",hidden:()=>{var d;return!(!((d=h.materialObject.userData._clearcoatTint)===null||d===void 0)&&d.enableTint)},property:[h.materialObject.userData._clearcoatTint,"ior"],onChange:this.setDirty})]};return c}},this.setDirty=()=>{var h,o,c;(o=(h=this.materialExtension).setDirty)===null||o===void 0||o.call(h),(c=this._viewer)===null||c===void 0||c.setDirty()},this._loaderCreate=this._loaderCreate.bind(this)}async onAdded(h){var o,c,d,_,v;await super.onAdded(h);const b=h.getPlugin(AssetManagerPlugin);(o=b==null?void 0:b.materials)===null||o===void 0||o.registerMaterialExtension(this.materialExtension),(c=b==null?void 0:b.importer)===null||c===void 0||c.addEventListener("loaderCreate",this._loaderCreate),(v=(_=(d=b==null?void 0:b.exporter)===null||d===void 0?void 0:d.getExporter("gltf","glb"))===null||_===void 0?void 0:_.extensions)===null||v===void 0||v.push(glTFMaterialsClearcoatTintExtensionExport)}async onRemove(h){var o,c,d,_;return(c=(o=h.getPlugin(AssetManagerPlugin))===null||o===void 0?void 0:o.materials)===null||c===void 0||c.unregisterMaterialExtension(this.materialExtension),(_=(d=h.getPlugin(AssetManagerPlugin))===null||d===void 0?void 0:d.importer)===null||_===void 0||_.removeEventListener("loaderCreate",this._loaderCreate),super.onRemove(h)}};function addClearcoatTint(h){const o=h==null?void 0:h.userData;if(!o)return!1;o._clearcoatTint||(o._clearcoatTint={});const c=o._clearcoatTint;return c.enableTint=!0,c.tintColor===void 0&&(c.tintColor=16777215),c.thickness===void 0&&(c.thickness=.1),c.ior===void 0&&(c.ior=1.5),h.isMaterial&&(h.needsUpdate=!0),!0}ClearcoatTintPlugin.PluginType="ClearcoatTintPlugin",ClearcoatTintPlugin.CLEARCOAT_TINT_GLTF_EXTENSION="WEBGI_materials_clearcoat_tint",ClearcoatTintPlugin_decorate([uiToggle("Enabled",h=>({onChange:h.setDirty})),serialize()],ClearcoatTintPlugin.prototype,"enabled",void 0),ClearcoatTintPlugin=ClearcoatTintPlugin_decorate([uiFolder("ClearcoatTint Materials")],ClearcoatTintPlugin);class GLTFMaterialsClearcoatTintExtensionImport{constructor(o){this.parser=o,this.name=ClearcoatTintPlugin.CLEARCOAT_TINT_GLTF_EXTENSION}async extendMaterialParams(o,c){const d=this.parser.json.materials[o];if(!d.extensions||!d.extensions[this.name])return Promise.resolve();const _=d.extensions[this.name];return c.userData||(c.userData={}),addClearcoatTint(c),deserializeObject(_,c.userData._clearcoatTint,!1,{}),Promise.resolve()}}const glTFMaterialsClearcoatTintExtensionExport=h=>({writeMaterial:(o,c)=>{if(!o.isMeshStandardMaterial||!o.userData._clearcoatTint||!o.userData._clearcoatTint.enableTint)return;c.extensions=c.extensions||{};const d=serializeObject(o.userData._clearcoatTint,!1);c.extensions[ClearcoatTintPlugin.CLEARCOAT_TINT_GLTF_EXTENSION]=d,h.extensionsUsed[ClearcoatTintPlugin.CLEARCOAT_TINT_GLTF_EXTENSION]=!0}});class WorkerPool{constructor(o=4){this.pool=o,this.queue=[],this.workers=[],this.workersResolve=[],this.workerStatus=0}_initWorker(o){if(!this.workers[o]){const c=this.workerCreator();c.addEventListener("message",this._onMessage.bind(this,o)),this.workers[o]=c}}_getIdleWorker(){for(let o=0;o<this.pool;o++)if(!(this.workerStatus&1<<o))return o;return-1}_onMessage(o,c){const d=this.workersResolve[o];if(d&&d(c),this.queue.length){const{resolve:_,msg:v,transfer:b}=this.queue.shift();this.workersResolve[o]=_,this.workers[o].postMessage(v,b)}else this.workerStatus^=1<<o}setWorkerCreator(o){this.workerCreator=o}setWorkerLimit(o){this.pool=o}postMessage(o,c){return new Promise(d=>{const _=this._getIdleWorker();_!==-1?(this._initWorker(_),this.workerStatus|=1<<_,this.workersResolve[_]=d,this.workers[_].postMessage(o,c)):this.queue.push({resolve:d,msg:o,transfer:c})})}dispose(){this.workers.forEach(o=>o.terminate()),this.workersResolve.length=0,this.workers.length=0,this.queue.length=0,this.workerStatus=0}}const ktx_parse_module_t=0,n$2=2,ktx_parse_module_p=1,ktx_parse_module_x=2,ktx_parse_module_E=0,ktx_parse_module_F=1,ktx_parse_module_X=10,ktx_parse_module_nt=0,ktx_parse_module_ct=9,gt=15,yt=16,dt=22,Ot=37,Ft=43,$t=76,ktx_parse_module_se=83,ktx_parse_module_pe=97,ktx_parse_module_xe=100,ktx_parse_module_de=103,ktx_parse_module_Ae=109,Sn=165,In=166;let Si$1=class{constructor(){this.vkFormat=0,this.typeSize=1,this.pixelWidth=0,this.pixelHeight=0,this.pixelDepth=0,this.layerCount=0,this.faceCount=1,this.supercompressionScheme=0,this.levels=[],this.dataFormatDescriptor=[{vendorId:0,descriptorType:0,descriptorBlockSize:0,versionNumber:2,colorModel:0,colorPrimaries:1,transferFunction:2,flags:0,texelBlockDimension:[0,0,0,0],bytesPlane:[0,0,0,0,0,0,0,0],samples:[]}],this.keyValue={},this.globalData=null}},Ii$1=class{constructor(h,o,c,d){this._dataView=new DataView(h.buffer,h.byteOffset+o,c),this._littleEndian=d,this._offset=0}_nextUint8(){const h=this._dataView.getUint8(this._offset);return this._offset+=1,h}_nextUint16(){const h=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,h}_nextUint32(){const h=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,h}_nextUint64(){const h=this._dataView.getUint32(this._offset,this._littleEndian)+4294967296*this._dataView.getUint32(this._offset+4,this._littleEndian);return this._offset+=8,h}_nextInt32(){const h=this._dataView.getInt32(this._offset,this._littleEndian);return this._offset+=4,h}_skip(h){return this._offset+=h,this}_scan(h,o=0){const c=this._offset;let d=0;for(;this._dataView.getUint8(this._offset)!==o&&d<h;)d++,this._offset++;return d<h&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+c,d)}};const Ti$1=[171,75,84,88,32,50,48,187,13,10,26,10];function Ei$1(h){return typeof TextDecoder<"u"?new TextDecoder().decode(h):Buffer.from(h).toString("utf8")}function Pi$1(h){const o=new Uint8Array(h.buffer,h.byteOffset,Ti$1.length);if(o[0]!==Ti$1[0]||o[1]!==Ti$1[1]||o[2]!==Ti$1[2]||o[3]!==Ti$1[3]||o[4]!==Ti$1[4]||o[5]!==Ti$1[5]||o[6]!==Ti$1[6]||o[7]!==Ti$1[7]||o[8]!==Ti$1[8]||o[9]!==Ti$1[9]||o[10]!==Ti$1[10]||o[11]!==Ti$1[11])throw new Error("Missing KTX 2.0 identifier.");const c=new Si$1,d=17*Uint32Array.BYTES_PER_ELEMENT,_=new Ii$1(h,Ti$1.length,d,!0);c.vkFormat=_._nextUint32(),c.typeSize=_._nextUint32(),c.pixelWidth=_._nextUint32(),c.pixelHeight=_._nextUint32(),c.pixelDepth=_._nextUint32(),c.layerCount=_._nextUint32(),c.faceCount=_._nextUint32();const v=_._nextUint32();c.supercompressionScheme=_._nextUint32();const b=_._nextUint32(),tt=_._nextUint32(),it=_._nextUint32(),nt=_._nextUint32(),lt=_._nextUint64(),ut=_._nextUint64(),ht=new Ii$1(h,Ti$1.length+d,3*v*8,!0);for(let pr=0;pr<v;pr++)c.levels.push({levelData:new Uint8Array(h.buffer,h.byteOffset+ht._nextUint64(),ht._nextUint64()),uncompressedByteLength:ht._nextUint64()});const _t=new Ii$1(h,b,tt,!0),ft={vendorId:_t._skip(4)._nextUint16(),descriptorType:_t._nextUint16(),versionNumber:_t._nextUint16(),descriptorBlockSize:_t._nextUint16(),colorModel:_t._nextUint8(),colorPrimaries:_t._nextUint8(),transferFunction:_t._nextUint8(),flags:_t._nextUint8(),texelBlockDimension:[_t._nextUint8(),_t._nextUint8(),_t._nextUint8(),_t._nextUint8()],bytesPlane:[_t._nextUint8(),_t._nextUint8(),_t._nextUint8(),_t._nextUint8(),_t._nextUint8(),_t._nextUint8(),_t._nextUint8(),_t._nextUint8()],samples:[]},bt=(ft.descriptorBlockSize/4-6)/4;for(let pr=0;pr<bt;pr++){const hr={bitOffset:_t._nextUint16(),bitLength:_t._nextUint8(),channelType:_t._nextUint8(),samplePosition:[_t._nextUint8(),_t._nextUint8(),_t._nextUint8(),_t._nextUint8()],sampleLower:-1/0,sampleUpper:1/0};64&hr.channelType?(hr.sampleLower=_t._nextInt32(),hr.sampleUpper=_t._nextInt32()):(hr.sampleLower=_t._nextUint32(),hr.sampleUpper=_t._nextUint32()),ft.samples[pr]=hr}c.dataFormatDescriptor.length=0,c.dataFormatDescriptor.push(ft);const xt=new Ii$1(h,it,nt,!0);for(;xt._offset<nt;){const pr=xt._nextUint32(),hr=xt._scan(pr),ur=Ei$1(hr),cr=xt._scan(pr-hr.byteLength);c.keyValue[ur]=ur.match(/^ktx/i)?Ei$1(cr):cr,xt._offset%4&&xt._skip(4-xt._offset%4)}if(ut<=0)return c;const St=new Ii$1(h,lt,ut,!0),wt=St._nextUint16(),Pt=St._nextUint16(),Rt=St._nextUint32(),kt=St._nextUint32(),Gt=St._nextUint32(),Dt=St._nextUint32(),It=[];for(let pr=0;pr<v;pr++)It.push({imageFlags:St._nextUint32(),rgbSliceByteOffset:St._nextUint32(),rgbSliceByteLength:St._nextUint32(),alphaSliceByteOffset:St._nextUint32(),alphaSliceByteLength:St._nextUint32()});const Nt=lt+St._offset,Vt=Nt+Rt,Kt=Vt+kt,Yt=Kt+Gt,nr=new Uint8Array(h.buffer,h.byteOffset+Nt,Rt),rr=new Uint8Array(h.buffer,h.byteOffset+Vt,kt),lr=new Uint8Array(h.buffer,h.byteOffset+Kt,Gt),or=new Uint8Array(h.buffer,h.byteOffset+Yt,Dt);return c.globalData={endpointCount:wt,selectorCount:Pt,imageDescs:It,endpointsData:nr,selectorsData:rr,tablesData:lr,extendedData:or},c}let zstddec_module_A,zstddec_module_I,zstddec_module_B;const zstddec_module_g={env:{emscripten_notify_memory_growth:function(h){zstddec_module_B=new Uint8Array(zstddec_module_I.exports.memory.buffer)}}};class zstddec_module_Q{init(){return zstddec_module_A||(zstddec_module_A=typeof fetch<"u"?fetch("data:application/wasm;base64,"+zstddec_module_C).then(o=>o.arrayBuffer()).then(o=>WebAssembly.instantiate(o,zstddec_module_g)).then(this._init):WebAssembly.instantiate(Buffer.from(zstddec_module_C,"base64"),zstddec_module_g).then(this._init),zstddec_module_A)}_init(o){zstddec_module_I=o.instance,zstddec_module_g.env.emscripten_notify_memory_growth(0)}decode(o,c=0){if(!zstddec_module_I)throw new Error("ZSTDDecoder: Await .init() before decoding.");const d=o.byteLength,_=zstddec_module_I.exports.malloc(d);zstddec_module_B.set(o,_),c=c||Number(zstddec_module_I.exports.ZSTD_findDecompressedSize(_,d));const v=zstddec_module_I.exports.malloc(c),b=zstddec_module_I.exports.ZSTD_decompress(v,c,_,d),tt=zstddec_module_B.slice(v,v+b);return zstddec_module_I.exports.free(_),zstddec_module_I.exports.free(v),tt}}const zstddec_module_C="AGFzbQEAAAABpQEVYAF/AX9gAn9/AGADf39/AX9gBX9/f39/AX9gAX8AYAJ/fwF/YAR/f39/AX9gA39/fwBgBn9/f39/fwF/YAd/f39/f39/AX9gAn9/AX5gAn5+AX5gAABgBX9/f39/AGAGf39/f39/AGAIf39/f39/f38AYAl/f39/f39/f38AYAABf2AIf39/f39/f38Bf2ANf39/f39/f39/f39/fwF/YAF/AX4CJwEDZW52H2Vtc2NyaXB0ZW5fbm90aWZ5X21lbW9yeV9ncm93dGgABANpaAEFAAAFAgEFCwACAQABAgIFBQcAAwABDgsBAQcAEhMHAAUBDAQEAAANBwQCAgYCBAgDAwMDBgEACQkHBgICAAYGAgQUBwYGAwIGAAMCAQgBBwUGCgoEEQAEBAEIAwgDBQgDEA8IAAcABAUBcAECAgUEAQCAAgYJAX8BQaCgwAILB2AHBm1lbW9yeQIABm1hbGxvYwAoBGZyZWUAJgxaU1REX2lzRXJyb3IAaBlaU1REX2ZpbmREZWNvbXByZXNzZWRTaXplAFQPWlNURF9kZWNvbXByZXNzAEoGX3N0YXJ0ACQJBwEAQQELASQKussBaA8AIAAgACgCBCABajYCBAsZACAAKAIAIAAoAgRBH3F0QQAgAWtBH3F2CwgAIABBiH9LC34BBH9BAyEBIAAoAgQiA0EgTQRAIAAoAggiASAAKAIQTwRAIAAQDQ8LIAAoAgwiAiABRgRAQQFBAiADQSBJGw8LIAAgASABIAJrIANBA3YiBCABIARrIAJJIgEbIgJrIgQ2AgggACADIAJBA3RrNgIEIAAgBCgAADYCAAsgAQsUAQF/IAAgARACIQIgACABEAEgAgv3AQECfyACRQRAIABCADcCACAAQQA2AhAgAEIANwIIQbh/DwsgACABNgIMIAAgAUEEajYCECACQQRPBEAgACABIAJqIgFBfGoiAzYCCCAAIAMoAAA2AgAgAUF/ai0AACIBBEAgAEEIIAEQFGs2AgQgAg8LIABBADYCBEF/DwsgACABNgIIIAAgAS0AACIDNgIAIAJBfmoiBEEBTQRAIARBAWtFBEAgACABLQACQRB0IANyIgM2AgALIAAgAS0AAUEIdCADajYCAAsgASACakF/ai0AACIBRQRAIABBADYCBEFsDwsgAEEoIAEQFCACQQN0ams2AgQgAgsWACAAIAEpAAA3AAAgACABKQAINwAICy8BAX8gAUECdEGgHWooAgAgACgCAEEgIAEgACgCBGprQR9xdnEhAiAAIAEQASACCyEAIAFCz9bTvtLHq9lCfiAAfEIfiUKHla+vmLbem55/fgsdAQF/IAAoAgggACgCDEYEfyAAKAIEQSBGBUEACwuCBAEDfyACQYDAAE8EQCAAIAEgAhBnIAAPCyAAIAJqIQMCQCAAIAFzQQNxRQRAAkAgAkEBSARAIAAhAgwBCyAAQQNxRQRAIAAhAgwBCyAAIQIDQCACIAEtAAA6AAAgAUEBaiEBIAJBAWoiAiADTw0BIAJBA3ENAAsLAkAgA0F8cSIEQcAASQ0AIAIgBEFAaiIFSw0AA0AgAiABKAIANgIAIAIgASgCBDYCBCACIAEoAgg2AgggAiABKAIMNgIMIAIgASgCEDYCECACIAEoAhQ2AhQgAiABKAIYNgIYIAIgASgCHDYCHCACIAEoAiA2AiAgAiABKAIkNgIkIAIgASgCKDYCKCACIAEoAiw2AiwgAiABKAIwNgIwIAIgASgCNDYCNCACIAEoAjg2AjggAiABKAI8NgI8IAFBQGshASACQUBrIgIgBU0NAAsLIAIgBE8NAQNAIAIgASgCADYCACABQQRqIQEgAkEEaiICIARJDQALDAELIANBBEkEQCAAIQIMAQsgA0F8aiIEIABJBEAgACECDAELIAAhAgNAIAIgAS0AADoAACACIAEtAAE6AAEgAiABLQACOgACIAIgAS0AAzoAAyABQQRqIQEgAkEEaiICIARNDQALCyACIANJBEADQCACIAEtAAA6AAAgAUEBaiEBIAJBAWoiAiADRw0ACwsgAAsMACAAIAEpAAA3AAALQQECfyAAKAIIIgEgACgCEEkEQEEDDwsgACAAKAIEIgJBB3E2AgQgACABIAJBA3ZrIgE2AgggACABKAAANgIAQQALDAAgACABKAIANgAAC/cCAQJ/AkAgACABRg0AAkAgASACaiAASwRAIAAgAmoiBCABSw0BCyAAIAEgAhALDwsgACABc0EDcSEDAkACQCAAIAFJBEAgAwRAIAAhAwwDCyAAQQNxRQRAIAAhAwwCCyAAIQMDQCACRQ0EIAMgAS0AADoAACABQQFqIQEgAkF/aiECIANBAWoiA0EDcQ0ACwwBCwJAIAMNACAEQQNxBEADQCACRQ0FIAAgAkF/aiICaiIDIAEgAmotAAA6AAAgA0EDcQ0ACwsgAkEDTQ0AA0AgACACQXxqIgJqIAEgAmooAgA2AgAgAkEDSw0ACwsgAkUNAgNAIAAgAkF/aiICaiABIAJqLQAAOgAAIAINAAsMAgsgAkEDTQ0AIAIhBANAIAMgASgCADYCACABQQRqIQEgA0EEaiEDIARBfGoiBEEDSw0ACyACQQNxIQILIAJFDQADQCADIAEtAAA6AAAgA0EBaiEDIAFBAWohASACQX9qIgINAAsLIAAL8wICAn8BfgJAIAJFDQAgACACaiIDQX9qIAE6AAAgACABOgAAIAJBA0kNACADQX5qIAE6AAAgACABOgABIANBfWogAToAACAAIAE6AAIgAkEHSQ0AIANBfGogAToAACAAIAE6AAMgAkEJSQ0AIABBACAAa0EDcSIEaiIDIAFB/wFxQYGChAhsIgE2AgAgAyACIARrQXxxIgRqIgJBfGogATYCACAEQQlJDQAgAyABNgIIIAMgATYCBCACQXhqIAE2AgAgAkF0aiABNgIAIARBGUkNACADIAE2AhggAyABNgIUIAMgATYCECADIAE2AgwgAkFwaiABNgIAIAJBbGogATYCACACQWhqIAE2AgAgAkFkaiABNgIAIAQgA0EEcUEYciIEayICQSBJDQAgAa0iBUIghiAFhCEFIAMgBGohAQNAIAEgBTcDGCABIAU3AxAgASAFNwMIIAEgBTcDACABQSBqIQEgAkFgaiICQR9LDQALCyAACy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAIajYCACADCy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAFajYCACADCx8AIAAgASACKAIEEAg2AgAgARAEGiAAIAJBCGo2AgQLCAAgAGdBH3MLugUBDX8jAEEQayIKJAACfyAEQQNNBEAgCkEANgIMIApBDGogAyAEEAsaIAAgASACIApBDGpBBBAVIgBBbCAAEAMbIAAgACAESxsMAQsgAEEAIAEoAgBBAXRBAmoQECENQVQgAygAACIGQQ9xIgBBCksNABogAiAAQQVqNgIAIAMgBGoiAkF8aiEMIAJBeWohDiACQXtqIRAgAEEGaiELQQQhBSAGQQR2IQRBICAAdCIAQQFyIQkgASgCACEPQQAhAiADIQYCQANAIAlBAkggAiAPS3JFBEAgAiEHAkAgCARAA0AgBEH//wNxQf//A0YEQCAHQRhqIQcgBiAQSQR/IAZBAmoiBigAACAFdgUgBUEQaiEFIARBEHYLIQQMAQsLA0AgBEEDcSIIQQNGBEAgBUECaiEFIARBAnYhBCAHQQNqIQcMAQsLIAcgCGoiByAPSw0EIAVBAmohBQNAIAIgB0kEQCANIAJBAXRqQQA7AQAgAkEBaiECDAELCyAGIA5LQQAgBiAFQQN1aiIHIAxLG0UEQCAHKAAAIAVBB3EiBXYhBAwCCyAEQQJ2IQQLIAYhBwsCfyALQX9qIAQgAEF/anEiBiAAQQF0QX9qIgggCWsiEUkNABogBCAIcSIEQQAgESAEIABIG2shBiALCyEIIA0gAkEBdGogBkF/aiIEOwEAIAlBASAGayAEIAZBAUgbayEJA0AgCSAASARAIABBAXUhACALQX9qIQsMAQsLAn8gByAOS0EAIAcgBSAIaiIFQQN1aiIGIAxLG0UEQCAFQQdxDAELIAUgDCIGIAdrQQN0awshBSACQQFqIQIgBEUhCCAGKAAAIAVBH3F2IQQMAQsLQWwgCUEBRyAFQSBKcg0BGiABIAJBf2o2AgAgBiAFQQdqQQN1aiADawwBC0FQCyEAIApBEGokACAACwkAQQFBBSAAGwsMACAAIAEoAAA2AAALqgMBCn8jAEHwAGsiCiQAIAJBAWohDiAAQQhqIQtBgIAEIAVBf2p0QRB1IQxBACECQQEhBkEBIAV0IglBf2oiDyEIA0AgAiAORkUEQAJAIAEgAkEBdCINai8BACIHQf//A0YEQCALIAhBA3RqIAI2AgQgCEF/aiEIQQEhBwwBCyAGQQAgDCAHQRB0QRB1ShshBgsgCiANaiAHOwEAIAJBAWohAgwBCwsgACAFNgIEIAAgBjYCACAJQQN2IAlBAXZqQQNqIQxBACEAQQAhBkEAIQIDQCAGIA5GBEADQAJAIAAgCUYNACAKIAsgAEEDdGoiASgCBCIGQQF0aiICIAIvAQAiAkEBajsBACABIAUgAhAUayIIOgADIAEgAiAIQf8BcXQgCWs7AQAgASAEIAZBAnQiAmooAgA6AAIgASACIANqKAIANgIEIABBAWohAAwBCwsFIAEgBkEBdGouAQAhDUEAIQcDQCAHIA1ORQRAIAsgAkEDdGogBjYCBANAIAIgDGogD3EiAiAISw0ACyAHQQFqIQcMAQsLIAZBAWohBgwBCwsgCkHwAGokAAsjAEIAIAEQCSAAhUKHla+vmLbem55/fkLj3MqV/M7y9YV/fAsQACAAQn43AwggACABNgIACyQBAX8gAARAIAEoAgQiAgRAIAEoAgggACACEQEADwsgABAmCwsfACAAIAEgAi8BABAINgIAIAEQBBogACACQQRqNgIEC0oBAX9BoCAoAgAiASAAaiIAQX9MBEBBiCBBMDYCAEF/DwsCQCAAPwBBEHRNDQAgABBmDQBBiCBBMDYCAEF/DwtBoCAgADYCACABC9cBAQh/Qbp/IQoCQCACKAIEIgggAigCACIJaiIOIAEgAGtLDQBBbCEKIAkgBCADKAIAIgtrSw0AIAAgCWoiBCACKAIIIgxrIQ0gACABQWBqIg8gCyAJQQAQKSADIAkgC2o2AgACQAJAIAwgBCAFa00EQCANIQUMAQsgDCAEIAZrSw0CIAcgDSAFayIAaiIBIAhqIAdNBEAgBCABIAgQDxoMAgsgBCABQQAgAGsQDyEBIAIgACAIaiIINgIEIAEgAGshBAsgBCAPIAUgCEEBECkLIA4hCgsgCgubAgEBfyMAQYABayINJAAgDSADNgJ8AkAgAkEDSwRAQX8hCQwBCwJAAkACQAJAIAJBAWsOAwADAgELIAZFBEBBuH8hCQwEC0FsIQkgBS0AACICIANLDQMgACAHIAJBAnQiAmooAgAgAiAIaigCABA7IAEgADYCAEEBIQkMAwsgASAJNgIAQQAhCQwCCyAKRQRAQWwhCQwCC0EAIQkgC0UgDEEZSHINAUEIIAR0QQhqIQBBACECA0AgAiAATw0CIAJBQGshAgwAAAsAC0FsIQkgDSANQfwAaiANQfgAaiAFIAYQFSICEAMNACANKAJ4IgMgBEsNACAAIA0gDSgCfCAHIAggAxAYIAEgADYCACACIQkLIA1BgAFqJAAgCQsLACAAIAEgAhALGgsQACAALwAAIAAtAAJBEHRyCy8AAn9BuH8gAUEISQ0AGkFyIAAoAAQiAEF3Sw0AGkG4fyAAQQhqIgAgACABSxsLCwkAIAAgATsAAAsDAAELigYBBX8gACAAKAIAIgVBfnE2AgBBACAAIAVBAXZqQYQgKAIAIgQgAEYbIQECQAJAIAAoAgQiAkUNACACKAIAIgNBAXENACACQQhqIgUgA0EBdkF4aiIDQQggA0EISxtnQR9zQQJ0QYAfaiIDKAIARgRAIAMgAigCDDYCAAsgAigCCCIDBEAgAyACKAIMNgIECyACKAIMIgMEQCADIAIoAgg2AgALIAIgAigCACAAKAIAQX5xajYCAEGEICEAAkACQCABRQ0AIAEgAjYCBCABKAIAIgNBAXENASADQQF2QXhqIgNBCCADQQhLG2dBH3NBAnRBgB9qIgMoAgAgAUEIakYEQCADIAEoAgw2AgALIAEoAggiAwRAIAMgASgCDDYCBAsgASgCDCIDBEAgAyABKAIINgIAQYQgKAIAIQQLIAIgAigCACABKAIAQX5xajYCACABIARGDQAgASABKAIAQQF2akEEaiEACyAAIAI2AgALIAIoAgBBAXZBeGoiAEEIIABBCEsbZ0Efc0ECdEGAH2oiASgCACEAIAEgBTYCACACIAA2AgwgAkEANgIIIABFDQEgACAFNgIADwsCQCABRQ0AIAEoAgAiAkEBcQ0AIAJBAXZBeGoiAkEIIAJBCEsbZ0Efc0ECdEGAH2oiAigCACABQQhqRgRAIAIgASgCDDYCAAsgASgCCCICBEAgAiABKAIMNgIECyABKAIMIgIEQCACIAEoAgg2AgBBhCAoAgAhBAsgACAAKAIAIAEoAgBBfnFqIgI2AgACQCABIARHBEAgASABKAIAQQF2aiAANgIEIAAoAgAhAgwBC0GEICAANgIACyACQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgIoAgAhASACIABBCGoiAjYCACAAIAE2AgwgAEEANgIIIAFFDQEgASACNgIADwsgBUEBdkF4aiIBQQggAUEISxtnQR9zQQJ0QYAfaiICKAIAIQEgAiAAQQhqIgI2AgAgACABNgIMIABBADYCCCABRQ0AIAEgAjYCAAsLDgAgAARAIABBeGoQJQsLgAIBA38CQCAAQQ9qQXhxQYQgKAIAKAIAQQF2ayICEB1Bf0YNAAJAQYQgKAIAIgAoAgAiAUEBcQ0AIAFBAXZBeGoiAUEIIAFBCEsbZ0Efc0ECdEGAH2oiASgCACAAQQhqRgRAIAEgACgCDDYCAAsgACgCCCIBBEAgASAAKAIMNgIECyAAKAIMIgFFDQAgASAAKAIINgIAC0EBIQEgACAAKAIAIAJBAXRqIgI2AgAgAkEBcQ0AIAJBAXZBeGoiAkEIIAJBCEsbZ0Efc0ECdEGAH2oiAygCACECIAMgAEEIaiIDNgIAIAAgAjYCDCAAQQA2AgggAkUNACACIAM2AgALIAELtwIBA38CQAJAIABBASAAGyICEDgiAA0AAkACQEGEICgCACIARQ0AIAAoAgAiA0EBcQ0AIAAgA0EBcjYCACADQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgEoAgAgAEEIakYEQCABIAAoAgw2AgALIAAoAggiAQRAIAEgACgCDDYCBAsgACgCDCIBBEAgASAAKAIINgIACyACECchAkEAIQFBhCAoAgAhACACDQEgACAAKAIAQX5xNgIAQQAPCyACQQ9qQXhxIgMQHSICQX9GDQIgAkEHakF4cSIAIAJHBEAgACACaxAdQX9GDQMLAkBBhCAoAgAiAUUEQEGAICAANgIADAELIAAgATYCBAtBhCAgADYCACAAIANBAXRBAXI2AgAMAQsgAEUNAQsgAEEIaiEBCyABC7kDAQJ/IAAgA2ohBQJAIANBB0wEQANAIAAgBU8NAiAAIAItAAA6AAAgAEEBaiEAIAJBAWohAgwAAAsACyAEQQFGBEACQCAAIAJrIgZBB00EQCAAIAItAAA6AAAgACACLQABOgABIAAgAi0AAjoAAiAAIAItAAM6AAMgAEEEaiACIAZBAnQiBkHAHmooAgBqIgIQFyACIAZB4B5qKAIAayECDAELIAAgAhAMCyACQQhqIQIgAEEIaiEACwJAAkACQAJAIAUgAU0EQCAAIANqIQEgBEEBRyAAIAJrQQ9Kcg0BA0AgACACEAwgAkEIaiECIABBCGoiACABSQ0ACwwFCyAAIAFLBEAgACEBDAQLIARBAUcgACACa0EPSnINASAAIQMgAiEEA0AgAyAEEAwgBEEIaiEEIANBCGoiAyABSQ0ACwwCCwNAIAAgAhAHIAJBEGohAiAAQRBqIgAgAUkNAAsMAwsgACEDIAIhBANAIAMgBBAHIARBEGohBCADQRBqIgMgAUkNAAsLIAIgASAAa2ohAgsDQCABIAVPDQEgASACLQAAOgAAIAFBAWohASACQQFqIQIMAAALAAsLQQECfyAAIAAoArjgASIDNgLE4AEgACgCvOABIQQgACABNgK84AEgACABIAJqNgK44AEgACABIAQgA2tqNgLA4AELpgEBAX8gACAAKALs4QEQFjYCyOABIABCADcD+OABIABCADcDuOABIABBwOABakIANwMAIABBqNAAaiIBQYyAgOAANgIAIABBADYCmOIBIABCADcDiOEBIABCAzcDgOEBIABBrNABakHgEikCADcCACAAQbTQAWpB6BIoAgA2AgAgACABNgIMIAAgAEGYIGo2AgggACAAQaAwajYCBCAAIABBEGo2AgALYQEBf0G4fyEDAkAgAUEDSQ0AIAIgABAhIgFBA3YiADYCCCACIAFBAXE2AgQgAiABQQF2QQNxIgM2AgACQCADQX9qIgFBAksNAAJAIAFBAWsOAgEAAgtBbA8LIAAhAwsgAwsMACAAIAEgAkEAEC4LiAQCA38CfiADEBYhBCAAQQBBKBAQIQAgBCACSwRAIAQPCyABRQRAQX8PCwJAAkAgA0EBRg0AIAEoAAAiBkGo6r5pRg0AQXYhAyAGQXBxQdDUtMIBRw0BQQghAyACQQhJDQEgAEEAQSgQECEAIAEoAAQhASAAQQE2AhQgACABrTcDAEEADwsgASACIAMQLyIDIAJLDQAgACADNgIYQXIhAyABIARqIgVBf2otAAAiAkEIcQ0AIAJBIHEiBkUEQEFwIQMgBS0AACIFQacBSw0BIAVBB3GtQgEgBUEDdkEKaq2GIgdCA4h+IAd8IQggBEEBaiEECyACQQZ2IQMgAkECdiEFAkAgAkEDcUF/aiICQQJLBEBBACECDAELAkACQAJAIAJBAWsOAgECAAsgASAEai0AACECIARBAWohBAwCCyABIARqLwAAIQIgBEECaiEEDAELIAEgBGooAAAhAiAEQQRqIQQLIAVBAXEhBQJ+AkACQAJAIANBf2oiA0ECTQRAIANBAWsOAgIDAQtCfyAGRQ0DGiABIARqMQAADAMLIAEgBGovAACtQoACfAwCCyABIARqKAAArQwBCyABIARqKQAACyEHIAAgBTYCICAAIAI2AhwgACAHNwMAQQAhAyAAQQA2AhQgACAHIAggBhsiBzcDCCAAIAdCgIAIIAdCgIAIVBs+AhALIAMLWwEBf0G4fyEDIAIQFiICIAFNBH8gACACakF/ai0AACIAQQNxQQJ0QaAeaigCACACaiAAQQZ2IgFBAnRBsB5qKAIAaiAAQSBxIgBFaiABRSAAQQV2cWoFQbh/CwsdACAAKAKQ4gEQWiAAQQA2AqDiASAAQgA3A5DiAQu1AwEFfyMAQZACayIKJABBuH8hBgJAIAVFDQAgBCwAACIIQf8BcSEHAkAgCEF/TARAIAdBgn9qQQF2IgggBU8NAkFsIQYgB0GBf2oiBUGAAk8NAiAEQQFqIQdBACEGA0AgBiAFTwRAIAUhBiAIIQcMAwUgACAGaiAHIAZBAXZqIgQtAABBBHY6AAAgACAGQQFyaiAELQAAQQ9xOgAAIAZBAmohBgwBCwAACwALIAcgBU8NASAAIARBAWogByAKEFMiBhADDQELIAYhBEEAIQYgAUEAQTQQECEJQQAhBQNAIAQgBkcEQCAAIAZqIggtAAAiAUELSwRAQWwhBgwDBSAJIAFBAnRqIgEgASgCAEEBajYCACAGQQFqIQZBASAILQAAdEEBdSAFaiEFDAILAAsLQWwhBiAFRQ0AIAUQFEEBaiIBQQxLDQAgAyABNgIAQQFBASABdCAFayIDEBQiAXQgA0cNACAAIARqIAFBAWoiADoAACAJIABBAnRqIgAgACgCAEEBajYCACAJKAIEIgBBAkkgAEEBcXINACACIARBAWo2AgAgB0EBaiEGCyAKQZACaiQAIAYLxhEBDH8jAEHwAGsiBSQAQWwhCwJAIANBCkkNACACLwAAIQogAi8AAiEJIAIvAAQhByAFQQhqIAQQDgJAIAMgByAJIApqakEGaiIMSQ0AIAUtAAohCCAFQdgAaiACQQZqIgIgChAGIgsQAw0BIAVBQGsgAiAKaiICIAkQBiILEAMNASAFQShqIAIgCWoiAiAHEAYiCxADDQEgBUEQaiACIAdqIAMgDGsQBiILEAMNASAAIAFqIg9BfWohECAEQQRqIQZBASELIAAgAUEDakECdiIDaiIMIANqIgIgA2oiDiEDIAIhBCAMIQcDQCALIAMgEElxBEAgACAGIAVB2ABqIAgQAkECdGoiCS8BADsAACAFQdgAaiAJLQACEAEgCS0AAyELIAcgBiAFQUBrIAgQAkECdGoiCS8BADsAACAFQUBrIAktAAIQASAJLQADIQogBCAGIAVBKGogCBACQQJ0aiIJLwEAOwAAIAVBKGogCS0AAhABIAktAAMhCSADIAYgBUEQaiAIEAJBAnRqIg0vAQA7AAAgBUEQaiANLQACEAEgDS0AAyENIAAgC2oiCyAGIAVB2ABqIAgQAkECdGoiAC8BADsAACAFQdgAaiAALQACEAEgAC0AAyEAIAcgCmoiCiAGIAVBQGsgCBACQQJ0aiIHLwEAOwAAIAVBQGsgBy0AAhABIActAAMhByAEIAlqIgkgBiAFQShqIAgQAkECdGoiBC8BADsAACAFQShqIAQtAAIQASAELQADIQQgAyANaiIDIAYgBUEQaiAIEAJBAnRqIg0vAQA7AAAgBUEQaiANLQACEAEgACALaiEAIAcgCmohByAEIAlqIQQgAyANLQADaiEDIAVB2ABqEA0gBUFAaxANciAFQShqEA1yIAVBEGoQDXJFIQsMAQsLIAQgDksgByACS3INAEFsIQsgACAMSw0BIAxBfWohCQNAQQAgACAJSSAFQdgAahAEGwRAIAAgBiAFQdgAaiAIEAJBAnRqIgovAQA7AAAgBUHYAGogCi0AAhABIAAgCi0AA2oiACAGIAVB2ABqIAgQAkECdGoiCi8BADsAACAFQdgAaiAKLQACEAEgACAKLQADaiEADAEFIAxBfmohCgNAIAVB2ABqEAQgACAKS3JFBEAgACAGIAVB2ABqIAgQAkECdGoiCS8BADsAACAFQdgAaiAJLQACEAEgACAJLQADaiEADAELCwNAIAAgCk0EQCAAIAYgBUHYAGogCBACQQJ0aiIJLwEAOwAAIAVB2ABqIAktAAIQASAAIAktAANqIQAMAQsLAkAgACAMTw0AIAAgBiAFQdgAaiAIEAIiAEECdGoiDC0AADoAACAMLQADQQFGBEAgBUHYAGogDC0AAhABDAELIAUoAlxBH0sNACAFQdgAaiAGIABBAnRqLQACEAEgBSgCXEEhSQ0AIAVBIDYCXAsgAkF9aiEMA0BBACAHIAxJIAVBQGsQBBsEQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiIAIAYgBUFAayAIEAJBAnRqIgcvAQA7AAAgBUFAayAHLQACEAEgACAHLQADaiEHDAEFIAJBfmohDANAIAVBQGsQBCAHIAxLckUEQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiEHDAELCwNAIAcgDE0EQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiEHDAELCwJAIAcgAk8NACAHIAYgBUFAayAIEAIiAEECdGoiAi0AADoAACACLQADQQFGBEAgBUFAayACLQACEAEMAQsgBSgCREEfSw0AIAVBQGsgBiAAQQJ0ai0AAhABIAUoAkRBIUkNACAFQSA2AkQLIA5BfWohAgNAQQAgBCACSSAFQShqEAQbBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2oiACAGIAVBKGogCBACQQJ0aiIELwEAOwAAIAVBKGogBC0AAhABIAAgBC0AA2ohBAwBBSAOQX5qIQIDQCAFQShqEAQgBCACS3JFBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2ohBAwBCwsDQCAEIAJNBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2ohBAwBCwsCQCAEIA5PDQAgBCAGIAVBKGogCBACIgBBAnRqIgItAAA6AAAgAi0AA0EBRgRAIAVBKGogAi0AAhABDAELIAUoAixBH0sNACAFQShqIAYgAEECdGotAAIQASAFKAIsQSFJDQAgBUEgNgIsCwNAQQAgAyAQSSAFQRBqEAQbBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2oiACAGIAVBEGogCBACQQJ0aiICLwEAOwAAIAVBEGogAi0AAhABIAAgAi0AA2ohAwwBBSAPQX5qIQIDQCAFQRBqEAQgAyACS3JFBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2ohAwwBCwsDQCADIAJNBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2ohAwwBCwsCQCADIA9PDQAgAyAGIAVBEGogCBACIgBBAnRqIgItAAA6AAAgAi0AA0EBRgRAIAVBEGogAi0AAhABDAELIAUoAhRBH0sNACAFQRBqIAYgAEECdGotAAIQASAFKAIUQSFJDQAgBUEgNgIUCyABQWwgBUHYAGoQCiAFQUBrEApxIAVBKGoQCnEgBUEQahAKcRshCwwJCwAACwALAAALAAsAAAsACwAACwALQWwhCwsgBUHwAGokACALC7UEAQ5/IwBBEGsiBiQAIAZBBGogABAOQVQhBQJAIARB3AtJDQAgBi0ABCEHIANB8ARqQQBB7AAQECEIIAdBDEsNACADQdwJaiIJIAggBkEIaiAGQQxqIAEgAhAxIhAQA0UEQCAGKAIMIgQgB0sNASADQdwFaiEPIANBpAVqIREgAEEEaiESIANBqAVqIQEgBCEFA0AgBSICQX9qIQUgCCACQQJ0aigCAEUNAAsgAkEBaiEOQQEhBQNAIAUgDk9FBEAgCCAFQQJ0IgtqKAIAIQwgASALaiAKNgIAIAVBAWohBSAKIAxqIQoMAQsLIAEgCjYCAEEAIQUgBigCCCELA0AgBSALRkUEQCABIAUgCWotAAAiDEECdGoiDSANKAIAIg1BAWo2AgAgDyANQQF0aiINIAw6AAEgDSAFOgAAIAVBAWohBQwBCwtBACEBIANBADYCqAUgBEF/cyAHaiEJQQEhBQNAIAUgDk9FBEAgCCAFQQJ0IgtqKAIAIQwgAyALaiABNgIAIAwgBSAJanQgAWohASAFQQFqIQUMAQsLIAcgBEEBaiIBIAJrIgRrQQFqIQgDQEEBIQUgBCAIT0UEQANAIAUgDk9FBEAgBUECdCIJIAMgBEE0bGpqIAMgCWooAgAgBHY2AgAgBUEBaiEFDAELCyAEQQFqIQQMAQsLIBIgByAPIAogESADIAIgARBkIAZBAToABSAGIAc6AAYgACAGKAIENgIACyAQIQULIAZBEGokACAFC8ENAQt/IwBB8ABrIgUkAEFsIQkCQCADQQpJDQAgAi8AACEKIAIvAAIhDCACLwAEIQYgBUEIaiAEEA4CQCADIAYgCiAMampBBmoiDUkNACAFLQAKIQcgBUHYAGogAkEGaiICIAoQBiIJEAMNASAFQUBrIAIgCmoiAiAMEAYiCRADDQEgBUEoaiACIAxqIgIgBhAGIgkQAw0BIAVBEGogAiAGaiADIA1rEAYiCRADDQEgACABaiIOQX1qIQ8gBEEEaiEGQQEhCSAAIAFBA2pBAnYiAmoiCiACaiIMIAJqIg0hAyAMIQQgCiECA0AgCSADIA9JcQRAIAYgBUHYAGogBxACQQF0aiIILQAAIQsgBUHYAGogCC0AARABIAAgCzoAACAGIAVBQGsgBxACQQF0aiIILQAAIQsgBUFAayAILQABEAEgAiALOgAAIAYgBUEoaiAHEAJBAXRqIggtAAAhCyAFQShqIAgtAAEQASAEIAs6AAAgBiAFQRBqIAcQAkEBdGoiCC0AACELIAVBEGogCC0AARABIAMgCzoAACAGIAVB2ABqIAcQAkEBdGoiCC0AACELIAVB2ABqIAgtAAEQASAAIAs6AAEgBiAFQUBrIAcQAkEBdGoiCC0AACELIAVBQGsgCC0AARABIAIgCzoAASAGIAVBKGogBxACQQF0aiIILQAAIQsgBUEoaiAILQABEAEgBCALOgABIAYgBUEQaiAHEAJBAXRqIggtAAAhCyAFQRBqIAgtAAEQASADIAs6AAEgA0ECaiEDIARBAmohBCACQQJqIQIgAEECaiEAIAkgBUHYAGoQDUVxIAVBQGsQDUVxIAVBKGoQDUVxIAVBEGoQDUVxIQkMAQsLIAQgDUsgAiAMS3INAEFsIQkgACAKSw0BIApBfWohCQNAIAVB2ABqEAQgACAJT3JFBEAgBiAFQdgAaiAHEAJBAXRqIggtAAAhCyAFQdgAaiAILQABEAEgACALOgAAIAYgBUHYAGogBxACQQF0aiIILQAAIQsgBUHYAGogCC0AARABIAAgCzoAASAAQQJqIQAMAQsLA0AgBUHYAGoQBCAAIApPckUEQCAGIAVB2ABqIAcQAkEBdGoiCS0AACEIIAVB2ABqIAktAAEQASAAIAg6AAAgAEEBaiEADAELCwNAIAAgCkkEQCAGIAVB2ABqIAcQAkEBdGoiCS0AACEIIAVB2ABqIAktAAEQASAAIAg6AAAgAEEBaiEADAELCyAMQX1qIQADQCAFQUBrEAQgAiAAT3JFBEAgBiAFQUBrIAcQAkEBdGoiCi0AACEJIAVBQGsgCi0AARABIAIgCToAACAGIAVBQGsgBxACQQF0aiIKLQAAIQkgBUFAayAKLQABEAEgAiAJOgABIAJBAmohAgwBCwsDQCAFQUBrEAQgAiAMT3JFBEAgBiAFQUBrIAcQAkEBdGoiAC0AACEKIAVBQGsgAC0AARABIAIgCjoAACACQQFqIQIMAQsLA0AgAiAMSQRAIAYgBUFAayAHEAJBAXRqIgAtAAAhCiAFQUBrIAAtAAEQASACIAo6AAAgAkEBaiECDAELCyANQX1qIQADQCAFQShqEAQgBCAAT3JFBEAgBiAFQShqIAcQAkEBdGoiAi0AACEKIAVBKGogAi0AARABIAQgCjoAACAGIAVBKGogBxACQQF0aiICLQAAIQogBUEoaiACLQABEAEgBCAKOgABIARBAmohBAwBCwsDQCAFQShqEAQgBCANT3JFBEAgBiAFQShqIAcQAkEBdGoiAC0AACECIAVBKGogAC0AARABIAQgAjoAACAEQQFqIQQMAQsLA0AgBCANSQRAIAYgBUEoaiAHEAJBAXRqIgAtAAAhAiAFQShqIAAtAAEQASAEIAI6AAAgBEEBaiEEDAELCwNAIAVBEGoQBCADIA9PckUEQCAGIAVBEGogBxACQQF0aiIALQAAIQIgBUEQaiAALQABEAEgAyACOgAAIAYgBUEQaiAHEAJBAXRqIgAtAAAhAiAFQRBqIAAtAAEQASADIAI6AAEgA0ECaiEDDAELCwNAIAVBEGoQBCADIA5PckUEQCAGIAVBEGogBxACQQF0aiIALQAAIQIgBUEQaiAALQABEAEgAyACOgAAIANBAWohAwwBCwsDQCADIA5JBEAgBiAFQRBqIAcQAkEBdGoiAC0AACECIAVBEGogAC0AARABIAMgAjoAACADQQFqIQMMAQsLIAFBbCAFQdgAahAKIAVBQGsQCnEgBUEoahAKcSAFQRBqEApxGyEJDAELQWwhCQsgBUHwAGokACAJC8oCAQR/IwBBIGsiBSQAIAUgBBAOIAUtAAIhByAFQQhqIAIgAxAGIgIQA0UEQCAEQQRqIQIgACABaiIDQX1qIQQDQCAFQQhqEAQgACAET3JFBEAgAiAFQQhqIAcQAkEBdGoiBi0AACEIIAVBCGogBi0AARABIAAgCDoAACACIAVBCGogBxACQQF0aiIGLQAAIQggBUEIaiAGLQABEAEgACAIOgABIABBAmohAAwBCwsDQCAFQQhqEAQgACADT3JFBEAgAiAFQQhqIAcQAkEBdGoiBC0AACEGIAVBCGogBC0AARABIAAgBjoAACAAQQFqIQAMAQsLA0AgACADT0UEQCACIAVBCGogBxACQQF0aiIELQAAIQYgBUEIaiAELQABEAEgACAGOgAAIABBAWohAAwBCwsgAUFsIAVBCGoQChshAgsgBUEgaiQAIAILtgMBCX8jAEEQayIGJAAgBkEANgIMIAZBADYCCEFUIQQCQAJAIANBQGsiDCADIAZBCGogBkEMaiABIAIQMSICEAMNACAGQQRqIAAQDiAGKAIMIgcgBi0ABEEBaksNASAAQQRqIQogBkEAOgAFIAYgBzoABiAAIAYoAgQ2AgAgB0EBaiEJQQEhBANAIAQgCUkEQCADIARBAnRqIgEoAgAhACABIAU2AgAgACAEQX9qdCAFaiEFIARBAWohBAwBCwsgB0EBaiEHQQAhBSAGKAIIIQkDQCAFIAlGDQEgAyAFIAxqLQAAIgRBAnRqIgBBASAEdEEBdSILIAAoAgAiAWoiADYCACAHIARrIQhBACEEAkAgC0EDTQRAA0AgBCALRg0CIAogASAEakEBdGoiACAIOgABIAAgBToAACAEQQFqIQQMAAALAAsDQCABIABPDQEgCiABQQF0aiIEIAg6AAEgBCAFOgAAIAQgCDoAAyAEIAU6AAIgBCAIOgAFIAQgBToABCAEIAg6AAcgBCAFOgAGIAFBBGohAQwAAAsACyAFQQFqIQUMAAALAAsgAiEECyAGQRBqJAAgBAutAQECfwJAQYQgKAIAIABHIAAoAgBBAXYiAyABa0F4aiICQXhxQQhHcgR/IAIFIAMQJ0UNASACQQhqC0EQSQ0AIAAgACgCACICQQFxIAAgAWpBD2pBeHEiASAAa0EBdHI2AgAgASAANgIEIAEgASgCAEEBcSAAIAJBAXZqIAFrIgJBAXRyNgIAQYQgIAEgAkH/////B3FqQQRqQYQgKAIAIABGGyABNgIAIAEQJQsLygIBBX8CQAJAAkAgAEEIIABBCEsbZ0EfcyAAaUEBR2oiAUEESSAAIAF2cg0AIAFBAnRB/B5qKAIAIgJFDQADQCACQXhqIgMoAgBBAXZBeGoiBSAATwRAIAIgBUEIIAVBCEsbZ0Efc0ECdEGAH2oiASgCAEYEQCABIAIoAgQ2AgALDAMLIARBHksNASAEQQFqIQQgAigCBCICDQALC0EAIQMgAUEgTw0BA0AgAUECdEGAH2ooAgAiAkUEQCABQR5LIQIgAUEBaiEBIAJFDQEMAwsLIAIgAkF4aiIDKAIAQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgEoAgBGBEAgASACKAIENgIACwsgAigCACIBBEAgASACKAIENgIECyACKAIEIgEEQCABIAIoAgA2AgALIAMgAygCAEEBcjYCACADIAAQNwsgAwvhCwINfwV+IwBB8ABrIgckACAHIAAoAvDhASIINgJcIAEgAmohDSAIIAAoAoDiAWohDwJAAkAgBUUEQCABIQQMAQsgACgCxOABIRAgACgCwOABIREgACgCvOABIQ4gAEEBNgKM4QFBACEIA0AgCEEDRwRAIAcgCEECdCICaiAAIAJqQazQAWooAgA2AkQgCEEBaiEIDAELC0FsIQwgB0EYaiADIAQQBhADDQEgB0EsaiAHQRhqIAAoAgAQEyAHQTRqIAdBGGogACgCCBATIAdBPGogB0EYaiAAKAIEEBMgDUFgaiESIAEhBEEAIQwDQCAHKAIwIAcoAixBA3RqKQIAIhRCEIinQf8BcSEIIAcoAkAgBygCPEEDdGopAgAiFUIQiKdB/wFxIQsgBygCOCAHKAI0QQN0aikCACIWQiCIpyEJIBVCIIghFyAUQiCIpyECAkAgFkIQiKdB/wFxIgNBAk8EQAJAIAZFIANBGUlyRQRAIAkgB0EYaiADQSAgBygCHGsiCiAKIANLGyIKEAUgAyAKayIDdGohCSAHQRhqEAQaIANFDQEgB0EYaiADEAUgCWohCQwBCyAHQRhqIAMQBSAJaiEJIAdBGGoQBBoLIAcpAkQhGCAHIAk2AkQgByAYNwNIDAELAkAgA0UEQCACBEAgBygCRCEJDAMLIAcoAkghCQwBCwJAAkAgB0EYakEBEAUgCSACRWpqIgNBA0YEQCAHKAJEQX9qIgMgA0VqIQkMAQsgA0ECdCAHaigCRCIJIAlFaiEJIANBAUYNAQsgByAHKAJINgJMCwsgByAHKAJENgJIIAcgCTYCRAsgF6chAyALBEAgB0EYaiALEAUgA2ohAwsgCCALakEUTwRAIAdBGGoQBBoLIAgEQCAHQRhqIAgQBSACaiECCyAHQRhqEAQaIAcgB0EYaiAUQhiIp0H/AXEQCCAUp0H//wNxajYCLCAHIAdBGGogFUIYiKdB/wFxEAggFadB//8DcWo2AjwgB0EYahAEGiAHIAdBGGogFkIYiKdB/wFxEAggFqdB//8DcWo2AjQgByACNgJgIAcoAlwhCiAHIAk2AmggByADNgJkAkACQAJAIAQgAiADaiILaiASSw0AIAIgCmoiEyAPSw0AIA0gBGsgC0Egak8NAQsgByAHKQNoNwMQIAcgBykDYDcDCCAEIA0gB0EIaiAHQdwAaiAPIA4gESAQEB4hCwwBCyACIARqIQggBCAKEAcgAkERTwRAIARBEGohAgNAIAIgCkEQaiIKEAcgAkEQaiICIAhJDQALCyAIIAlrIQIgByATNgJcIAkgCCAOa0sEQCAJIAggEWtLBEBBbCELDAILIBAgAiAOayICaiIKIANqIBBNBEAgCCAKIAMQDxoMAgsgCCAKQQAgAmsQDyEIIAcgAiADaiIDNgJkIAggAmshCCAOIQILIAlBEE8EQCADIAhqIQMDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALDAELAkAgCUEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgCUECdCIDQcAeaigCAGoiAhAXIAIgA0HgHmooAgBrIQIgBygCZCEDDAELIAggAhAMCyADQQlJDQAgAyAIaiEDIAhBCGoiCCACQQhqIgJrQQ9MBEADQCAIIAIQDCACQQhqIQIgCEEIaiIIIANJDQAMAgALAAsDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALCyAHQRhqEAQaIAsgDCALEAMiAhshDCAEIAQgC2ogAhshBCAFQX9qIgUNAAsgDBADDQFBbCEMIAdBGGoQBEECSQ0BQQAhCANAIAhBA0cEQCAAIAhBAnQiAmpBrNABaiACIAdqKAJENgIAIAhBAWohCAwBCwsgBygCXCEIC0G6fyEMIA8gCGsiACANIARrSw0AIAQEfyAEIAggABALIABqBUEACyABayEMCyAHQfAAaiQAIAwLkRcCFn8FfiMAQdABayIHJAAgByAAKALw4QEiCDYCvAEgASACaiESIAggACgCgOIBaiETAkACQCAFRQRAIAEhAwwBCyAAKALE4AEhESAAKALA4AEhFSAAKAK84AEhDyAAQQE2AozhAUEAIQgDQCAIQQNHBEAgByAIQQJ0IgJqIAAgAmpBrNABaigCADYCVCAIQQFqIQgMAQsLIAcgETYCZCAHIA82AmAgByABIA9rNgJoQWwhECAHQShqIAMgBBAGEAMNASAFQQQgBUEESBshFyAHQTxqIAdBKGogACgCABATIAdBxABqIAdBKGogACgCCBATIAdBzABqIAdBKGogACgCBBATQQAhBCAHQeAAaiEMIAdB5ABqIQoDQCAHQShqEARBAksgBCAXTnJFBEAgBygCQCAHKAI8QQN0aikCACIdQhCIp0H/AXEhCyAHKAJQIAcoAkxBA3RqKQIAIh5CEIinQf8BcSEJIAcoAkggBygCREEDdGopAgAiH0IgiKchCCAeQiCIISAgHUIgiKchAgJAIB9CEIinQf8BcSIDQQJPBEACQCAGRSADQRlJckUEQCAIIAdBKGogA0EgIAcoAixrIg0gDSADSxsiDRAFIAMgDWsiA3RqIQggB0EoahAEGiADRQ0BIAdBKGogAxAFIAhqIQgMAQsgB0EoaiADEAUgCGohCCAHQShqEAQaCyAHKQJUISEgByAINgJUIAcgITcDWAwBCwJAIANFBEAgAgRAIAcoAlQhCAwDCyAHKAJYIQgMAQsCQAJAIAdBKGpBARAFIAggAkVqaiIDQQNGBEAgBygCVEF/aiIDIANFaiEIDAELIANBAnQgB2ooAlQiCCAIRWohCCADQQFGDQELIAcgBygCWDYCXAsLIAcgBygCVDYCWCAHIAg2AlQLICCnIQMgCQRAIAdBKGogCRAFIANqIQMLIAkgC2pBFE8EQCAHQShqEAQaCyALBEAgB0EoaiALEAUgAmohAgsgB0EoahAEGiAHIAcoAmggAmoiCSADajYCaCAKIAwgCCAJSxsoAgAhDSAHIAdBKGogHUIYiKdB/wFxEAggHadB//8DcWo2AjwgByAHQShqIB5CGIinQf8BcRAIIB6nQf//A3FqNgJMIAdBKGoQBBogB0EoaiAfQhiIp0H/AXEQCCEOIAdB8ABqIARBBHRqIgsgCSANaiAIazYCDCALIAg2AgggCyADNgIEIAsgAjYCACAHIA4gH6dB//8DcWo2AkQgBEEBaiEEDAELCyAEIBdIDQEgEkFgaiEYIAdB4ABqIRogB0HkAGohGyABIQMDQCAHQShqEARBAksgBCAFTnJFBEAgBygCQCAHKAI8QQN0aikCACIdQhCIp0H/AXEhCyAHKAJQIAcoAkxBA3RqKQIAIh5CEIinQf8BcSEIIAcoAkggBygCREEDdGopAgAiH0IgiKchCSAeQiCIISAgHUIgiKchDAJAIB9CEIinQf8BcSICQQJPBEACQCAGRSACQRlJckUEQCAJIAdBKGogAkEgIAcoAixrIgogCiACSxsiChAFIAIgCmsiAnRqIQkgB0EoahAEGiACRQ0BIAdBKGogAhAFIAlqIQkMAQsgB0EoaiACEAUgCWohCSAHQShqEAQaCyAHKQJUISEgByAJNgJUIAcgITcDWAwBCwJAIAJFBEAgDARAIAcoAlQhCQwDCyAHKAJYIQkMAQsCQAJAIAdBKGpBARAFIAkgDEVqaiICQQNGBEAgBygCVEF/aiICIAJFaiEJDAELIAJBAnQgB2ooAlQiCSAJRWohCSACQQFGDQELIAcgBygCWDYCXAsLIAcgBygCVDYCWCAHIAk2AlQLICCnIRQgCARAIAdBKGogCBAFIBRqIRQLIAggC2pBFE8EQCAHQShqEAQaCyALBEAgB0EoaiALEAUgDGohDAsgB0EoahAEGiAHIAcoAmggDGoiGSAUajYCaCAbIBogCSAZSxsoAgAhHCAHIAdBKGogHUIYiKdB/wFxEAggHadB//8DcWo2AjwgByAHQShqIB5CGIinQf8BcRAIIB6nQf//A3FqNgJMIAdBKGoQBBogByAHQShqIB9CGIinQf8BcRAIIB+nQf//A3FqNgJEIAcgB0HwAGogBEEDcUEEdGoiDSkDCCIdNwPIASAHIA0pAwAiHjcDwAECQAJAAkAgBygCvAEiDiAepyICaiIWIBNLDQAgAyAHKALEASIKIAJqIgtqIBhLDQAgEiADayALQSBqTw0BCyAHIAcpA8gBNwMQIAcgBykDwAE3AwggAyASIAdBCGogB0G8AWogEyAPIBUgERAeIQsMAQsgAiADaiEIIAMgDhAHIAJBEU8EQCADQRBqIQIDQCACIA5BEGoiDhAHIAJBEGoiAiAISQ0ACwsgCCAdpyIOayECIAcgFjYCvAEgDiAIIA9rSwRAIA4gCCAVa0sEQEFsIQsMAgsgESACIA9rIgJqIhYgCmogEU0EQCAIIBYgChAPGgwCCyAIIBZBACACaxAPIQggByACIApqIgo2AsQBIAggAmshCCAPIQILIA5BEE8EQCAIIApqIQoDQCAIIAIQByACQRBqIQIgCEEQaiIIIApJDQALDAELAkAgDkEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgDkECdCIKQcAeaigCAGoiAhAXIAIgCkHgHmooAgBrIQIgBygCxAEhCgwBCyAIIAIQDAsgCkEJSQ0AIAggCmohCiAIQQhqIgggAkEIaiICa0EPTARAA0AgCCACEAwgAkEIaiECIAhBCGoiCCAKSQ0ADAIACwALA0AgCCACEAcgAkEQaiECIAhBEGoiCCAKSQ0ACwsgCxADBEAgCyEQDAQFIA0gDDYCACANIBkgHGogCWs2AgwgDSAJNgIIIA0gFDYCBCAEQQFqIQQgAyALaiEDDAILAAsLIAQgBUgNASAEIBdrIQtBACEEA0AgCyAFSARAIAcgB0HwAGogC0EDcUEEdGoiAikDCCIdNwPIASAHIAIpAwAiHjcDwAECQAJAAkAgBygCvAEiDCAepyICaiIKIBNLDQAgAyAHKALEASIJIAJqIhBqIBhLDQAgEiADayAQQSBqTw0BCyAHIAcpA8gBNwMgIAcgBykDwAE3AxggAyASIAdBGGogB0G8AWogEyAPIBUgERAeIRAMAQsgAiADaiEIIAMgDBAHIAJBEU8EQCADQRBqIQIDQCACIAxBEGoiDBAHIAJBEGoiAiAISQ0ACwsgCCAdpyIGayECIAcgCjYCvAEgBiAIIA9rSwRAIAYgCCAVa0sEQEFsIRAMAgsgESACIA9rIgJqIgwgCWogEU0EQCAIIAwgCRAPGgwCCyAIIAxBACACaxAPIQggByACIAlqIgk2AsQBIAggAmshCCAPIQILIAZBEE8EQCAIIAlqIQYDQCAIIAIQByACQRBqIQIgCEEQaiIIIAZJDQALDAELAkAgBkEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgBkECdCIGQcAeaigCAGoiAhAXIAIgBkHgHmooAgBrIQIgBygCxAEhCQwBCyAIIAIQDAsgCUEJSQ0AIAggCWohBiAIQQhqIgggAkEIaiICa0EPTARAA0AgCCACEAwgAkEIaiECIAhBCGoiCCAGSQ0ADAIACwALA0AgCCACEAcgAkEQaiECIAhBEGoiCCAGSQ0ACwsgEBADDQMgC0EBaiELIAMgEGohAwwBCwsDQCAEQQNHBEAgACAEQQJ0IgJqQazQAWogAiAHaigCVDYCACAEQQFqIQQMAQsLIAcoArwBIQgLQbp/IRAgEyAIayIAIBIgA2tLDQAgAwR/IAMgCCAAEAsgAGoFQQALIAFrIRALIAdB0AFqJAAgEAslACAAQgA3AgAgAEEAOwEIIABBADoACyAAIAE2AgwgACACOgAKC7QFAQN/IwBBMGsiBCQAIABB/wFqIgVBfWohBgJAIAMvAQIEQCAEQRhqIAEgAhAGIgIQAw0BIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahASOgAAIAMgBEEIaiAEQRhqEBI6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0FIAEgBEEQaiAEQRhqEBI6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBSABIARBCGogBEEYahASOgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEjoAACABIAJqIABrIQIMAwsgAyAEQRBqIARBGGoQEjoAAiADIARBCGogBEEYahASOgADIANBBGohAwwAAAsACyAEQRhqIAEgAhAGIgIQAw0AIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahAROgAAIAMgBEEIaiAEQRhqEBE6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0EIAEgBEEQaiAEQRhqEBE6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBCABIARBCGogBEEYahAROgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEToAACABIAJqIABrIQIMAgsgAyAEQRBqIARBGGoQEToAAiADIARBCGogBEEYahAROgADIANBBGohAwwAAAsACyAEQTBqJAAgAgtpAQF/An8CQAJAIAJBB00NACABKAAAQbfIwuF+Rw0AIAAgASgABDYCmOIBQWIgAEEQaiABIAIQPiIDEAMNAhogAEKBgICAEDcDiOEBIAAgASADaiACIANrECoMAQsgACABIAIQKgtBAAsLrQMBBn8jAEGAAWsiAyQAQWIhCAJAIAJBCUkNACAAQZjQAGogAUEIaiIEIAJBeGogAEGY0AAQMyIFEAMiBg0AIANBHzYCfCADIANB/ABqIANB+ABqIAQgBCAFaiAGGyIEIAEgAmoiAiAEaxAVIgUQAw0AIAMoAnwiBkEfSw0AIAMoAngiB0EJTw0AIABBiCBqIAMgBkGAC0GADCAHEBggA0E0NgJ8IAMgA0H8AGogA0H4AGogBCAFaiIEIAIgBGsQFSIFEAMNACADKAJ8IgZBNEsNACADKAJ4IgdBCk8NACAAQZAwaiADIAZBgA1B4A4gBxAYIANBIzYCfCADIANB/ABqIANB+ABqIAQgBWoiBCACIARrEBUiBRADDQAgAygCfCIGQSNLDQAgAygCeCIHQQpPDQAgACADIAZBwBBB0BEgBxAYIAQgBWoiBEEMaiIFIAJLDQAgAiAFayEFQQAhAgNAIAJBA0cEQCAEKAAAIgZBf2ogBU8NAiAAIAJBAnRqQZzQAWogBjYCACACQQFqIQIgBEEEaiEEDAELCyAEIAFrIQgLIANBgAFqJAAgCAtGAQN/IABBCGohAyAAKAIEIQJBACEAA0AgACACdkUEQCABIAMgAEEDdGotAAJBFktqIQEgAEEBaiEADAELCyABQQggAmt0C4YDAQV/Qbh/IQcCQCADRQ0AIAItAAAiBEUEQCABQQA2AgBBAUG4fyADQQFGGw8LAn8gAkEBaiIFIARBGHRBGHUiBkF/Sg0AGiAGQX9GBEAgA0EDSA0CIAUvAABBgP4BaiEEIAJBA2oMAQsgA0ECSA0BIAItAAEgBEEIdHJBgIB+aiEEIAJBAmoLIQUgASAENgIAIAVBAWoiASACIANqIgNLDQBBbCEHIABBEGogACAFLQAAIgVBBnZBI0EJIAEgAyABa0HAEEHQEUHwEiAAKAKM4QEgACgCnOIBIAQQHyIGEAMiCA0AIABBmCBqIABBCGogBUEEdkEDcUEfQQggASABIAZqIAgbIgEgAyABa0GAC0GADEGAFyAAKAKM4QEgACgCnOIBIAQQHyIGEAMiCA0AIABBoDBqIABBBGogBUECdkEDcUE0QQkgASABIAZqIAgbIgEgAyABa0GADUHgDkGQGSAAKAKM4QEgACgCnOIBIAQQHyIAEAMNACAAIAFqIAJrIQcLIAcLrQMBCn8jAEGABGsiCCQAAn9BUiACQf8BSw0AGkFUIANBDEsNABogAkEBaiELIABBBGohCUGAgAQgA0F/anRBEHUhCkEAIQJBASEEQQEgA3QiB0F/aiIMIQUDQCACIAtGRQRAAkAgASACQQF0Ig1qLwEAIgZB//8DRgRAIAkgBUECdGogAjoAAiAFQX9qIQVBASEGDAELIARBACAKIAZBEHRBEHVKGyEECyAIIA1qIAY7AQAgAkEBaiECDAELCyAAIAQ7AQIgACADOwEAIAdBA3YgB0EBdmpBA2ohBkEAIQRBACECA0AgBCALRkUEQCABIARBAXRqLgEAIQpBACEAA0AgACAKTkUEQCAJIAJBAnRqIAQ6AAIDQCACIAZqIAxxIgIgBUsNAAsgAEEBaiEADAELCyAEQQFqIQQMAQsLQX8gAg0AGkEAIQIDfyACIAdGBH9BAAUgCCAJIAJBAnRqIgAtAAJBAXRqIgEgAS8BACIBQQFqOwEAIAAgAyABEBRrIgU6AAMgACABIAVB/wFxdCAHazsBACACQQFqIQIMAQsLCyEFIAhBgARqJAAgBQvjBgEIf0FsIQcCQCACQQNJDQACQAJAAkACQCABLQAAIgNBA3EiCUEBaw4DAwEAAgsgACgCiOEBDQBBYg8LIAJBBUkNAkEDIQYgASgAACEFAn8CQAJAIANBAnZBA3EiCEF+aiIEQQFNBEAgBEEBaw0BDAILIAVBDnZB/wdxIQQgBUEEdkH/B3EhAyAIRQwCCyAFQRJ2IQRBBCEGIAVBBHZB//8AcSEDQQAMAQsgBUEEdkH//w9xIgNBgIAISw0DIAEtAARBCnQgBUEWdnIhBEEFIQZBAAshBSAEIAZqIgogAksNAgJAIANBgQZJDQAgACgCnOIBRQ0AQQAhAgNAIAJBg4ABSw0BIAJBQGshAgwAAAsACwJ/IAlBA0YEQCABIAZqIQEgAEHw4gFqIQIgACgCDCEGIAUEQCACIAMgASAEIAYQXwwCCyACIAMgASAEIAYQXQwBCyAAQbjQAWohAiABIAZqIQEgAEHw4gFqIQYgAEGo0ABqIQggBQRAIAggBiADIAEgBCACEF4MAQsgCCAGIAMgASAEIAIQXAsQAw0CIAAgAzYCgOIBIABBATYCiOEBIAAgAEHw4gFqNgLw4QEgCUECRgRAIAAgAEGo0ABqNgIMCyAAIANqIgBBiOMBakIANwAAIABBgOMBakIANwAAIABB+OIBakIANwAAIABB8OIBakIANwAAIAoPCwJ/AkACQAJAIANBAnZBA3FBf2oiBEECSw0AIARBAWsOAgACAQtBASEEIANBA3YMAgtBAiEEIAEvAABBBHYMAQtBAyEEIAEQIUEEdgsiAyAEaiIFQSBqIAJLBEAgBSACSw0CIABB8OIBaiABIARqIAMQCyEBIAAgAzYCgOIBIAAgATYC8OEBIAEgA2oiAEIANwAYIABCADcAECAAQgA3AAggAEIANwAAIAUPCyAAIAM2AoDiASAAIAEgBGo2AvDhASAFDwsCfwJAAkACQCADQQJ2QQNxQX9qIgRBAksNACAEQQFrDgIAAgELQQEhByADQQN2DAILQQIhByABLwAAQQR2DAELIAJBBEkgARAhIgJBj4CAAUtyDQFBAyEHIAJBBHYLIQIgAEHw4gFqIAEgB2otAAAgAkEgahAQIQEgACACNgKA4gEgACABNgLw4QEgB0EBaiEHCyAHC0sAIABC+erQ0OfJoeThADcDICAAQgA3AxggAELP1tO+0ser2UI3AxAgAELW64Lu6v2J9eAANwMIIABCADcDACAAQShqQQBBKBAQGgviAgICfwV+IABBKGoiASAAKAJIaiECAn4gACkDACIDQiBaBEAgACkDECIEQgeJIAApAwgiBUIBiXwgACkDGCIGQgyJfCAAKQMgIgdCEol8IAUQGSAEEBkgBhAZIAcQGQwBCyAAKQMYQsXP2bLx5brqJ3wLIAN8IQMDQCABQQhqIgAgAk0EQEIAIAEpAAAQCSADhUIbiUKHla+vmLbem55/fkLj3MqV/M7y9YV/fCEDIAAhAQwBCwsCQCABQQRqIgAgAksEQCABIQAMAQsgASgAAK1Ch5Wvr5i23puef34gA4VCF4lCz9bTvtLHq9lCfkL5893xmfaZqxZ8IQMLA0AgACACSQRAIAAxAABCxc/ZsvHluuonfiADhUILiUKHla+vmLbem55/fiEDIABBAWohAAwBCwsgA0IhiCADhULP1tO+0ser2UJ+IgNCHYggA4VC+fPd8Zn2masWfiIDQiCIIAOFC+8CAgJ/BH4gACAAKQMAIAKtfDcDAAJAAkAgACgCSCIDIAJqIgRBH00EQCABRQ0BIAAgA2pBKGogASACECAgACgCSCACaiEEDAELIAEgAmohAgJ/IAMEQCAAQShqIgQgA2ogAUEgIANrECAgACAAKQMIIAQpAAAQCTcDCCAAIAApAxAgACkAMBAJNwMQIAAgACkDGCAAKQA4EAk3AxggACAAKQMgIABBQGspAAAQCTcDICAAKAJIIQMgAEEANgJIIAEgA2tBIGohAQsgAUEgaiACTQsEQCACQWBqIQMgACkDICEFIAApAxghBiAAKQMQIQcgACkDCCEIA0AgCCABKQAAEAkhCCAHIAEpAAgQCSEHIAYgASkAEBAJIQYgBSABKQAYEAkhBSABQSBqIgEgA00NAAsgACAFNwMgIAAgBjcDGCAAIAc3AxAgACAINwMICyABIAJPDQEgAEEoaiABIAIgAWsiBBAgCyAAIAQ2AkgLCy8BAX8gAEUEQEG2f0EAIAMbDwtBun8hBCADIAFNBH8gACACIAMQEBogAwVBun8LCy8BAX8gAEUEQEG2f0EAIAMbDwtBun8hBCADIAFNBH8gACACIAMQCxogAwVBun8LC6gCAQZ/IwBBEGsiByQAIABB2OABaikDAEKAgIAQViEIQbh/IQUCQCAEQf//B0sNACAAIAMgBBBCIgUQAyIGDQAgACgCnOIBIQkgACAHQQxqIAMgAyAFaiAGGyIKIARBACAFIAYbayIGEEAiAxADBEAgAyEFDAELIAcoAgwhBCABRQRAQbp/IQUgBEEASg0BCyAGIANrIQUgAyAKaiEDAkAgCQRAIABBADYCnOIBDAELAkACQAJAIARBBUgNACAAQdjgAWopAwBCgICACFgNAAwBCyAAQQA2ApziAQwBCyAAKAIIED8hBiAAQQA2ApziASAGQRRPDQELIAAgASACIAMgBSAEIAgQOSEFDAELIAAgASACIAMgBSAEIAgQOiEFCyAHQRBqJAAgBQtnACAAQdDgAWogASACIAAoAuzhARAuIgEQAwRAIAEPC0G4fyECAkAgAQ0AIABB7OABaigCACIBBEBBYCECIAAoApjiASABRw0BC0EAIQIgAEHw4AFqKAIARQ0AIABBkOEBahBDCyACCycBAX8QVyIERQRAQUAPCyAEIAAgASACIAMgBBBLEE8hACAEEFYgAAs/AQF/AkACQAJAIAAoAqDiAUEBaiIBQQJLDQAgAUEBaw4CAAECCyAAEDBBAA8LIABBADYCoOIBCyAAKAKU4gELvAMCB38BfiMAQRBrIgkkAEG4fyEGAkAgBCgCACIIQQVBCSAAKALs4QEiBRtJDQAgAygCACIHQQFBBSAFGyAFEC8iBRADBEAgBSEGDAELIAggBUEDakkNACAAIAcgBRBJIgYQAw0AIAEgAmohCiAAQZDhAWohCyAIIAVrIQIgBSAHaiEHIAEhBQNAIAcgAiAJECwiBhADDQEgAkF9aiICIAZJBEBBuH8hBgwCCyAJKAIAIghBAksEQEFsIQYMAgsgB0EDaiEHAn8CQAJAAkAgCEEBaw4CAgABCyAAIAUgCiAFayAHIAYQSAwCCyAFIAogBWsgByAGEEcMAQsgBSAKIAVrIActAAAgCSgCCBBGCyIIEAMEQCAIIQYMAgsgACgC8OABBEAgCyAFIAgQRQsgAiAGayECIAYgB2ohByAFIAhqIQUgCSgCBEUNAAsgACkD0OABIgxCf1IEQEFsIQYgDCAFIAFrrFINAQsgACgC8OABBEBBaiEGIAJBBEkNASALEEQhDCAHKAAAIAynRw0BIAdBBGohByACQXxqIQILIAMgBzYCACAEIAI2AgAgBSABayEGCyAJQRBqJAAgBgsuACAAECsCf0EAQQAQAw0AGiABRSACRXJFBEBBYiAAIAEgAhA9EAMNARoLQQALCzcAIAEEQCAAIAAoAsTgASABKAIEIAEoAghqRzYCnOIBCyAAECtBABADIAFFckUEQCAAIAEQWwsL0QIBB38jAEEQayIGJAAgBiAENgIIIAYgAzYCDCAFBEAgBSgCBCEKIAUoAgghCQsgASEIAkACQANAIAAoAuzhARAWIQsCQANAIAQgC0kNASADKAAAQXBxQdDUtMIBRgRAIAMgBBAiIgcQAw0EIAQgB2shBCADIAdqIQMMAQsLIAYgAzYCDCAGIAQ2AggCQCAFBEAgACAFEE5BACEHQQAQA0UNAQwFCyAAIAogCRBNIgcQAw0ECyAAIAgQUCAMQQFHQQAgACAIIAIgBkEMaiAGQQhqEEwiByIDa0EAIAMQAxtBCkdyRQRAQbh/IQcMBAsgBxADDQMgAiAHayECIAcgCGohCEEBIQwgBigCDCEDIAYoAgghBAwBCwsgBiADNgIMIAYgBDYCCEG4fyEHIAQNASAIIAFrIQcMAQsgBiADNgIMIAYgBDYCCAsgBkEQaiQAIAcLRgECfyABIAAoArjgASICRwRAIAAgAjYCxOABIAAgATYCuOABIAAoArzgASEDIAAgATYCvOABIAAgASADIAJrajYCwOABCwutAgIEfwF+IwBBQGoiBCQAAkACQCACQQhJDQAgASgAAEFwcUHQ1LTCAUcNACABIAIQIiEBIABCADcDCCAAQQA2AgQgACABNgIADAELIARBGGogASACEC0iAxADBEAgACADEBoMAQsgAwRAIABBuH8QGgwBCyACIAQoAjAiA2shAiABIANqIQMDQAJAIAAgAyACIARBCGoQLCIFEAMEfyAFBSACIAVBA2oiBU8NAUG4fwsQGgwCCyAGQQFqIQYgAiAFayECIAMgBWohAyAEKAIMRQ0ACyAEKAI4BEAgAkEDTQRAIABBuH8QGgwCCyADQQRqIQMLIAQoAighAiAEKQMYIQcgAEEANgIEIAAgAyABazYCACAAIAIgBmytIAcgB0J/URs3AwgLIARBQGskAAslAQF/IwBBEGsiAiQAIAIgACABEFEgAigCACEAIAJBEGokACAAC30BBH8jAEGQBGsiBCQAIARB/wE2AggCQCAEQRBqIARBCGogBEEMaiABIAIQFSIGEAMEQCAGIQUMAQtBVCEFIAQoAgwiB0EGSw0AIAMgBEEQaiAEKAIIIAcQQSIFEAMNACAAIAEgBmogAiAGayADEDwhBQsgBEGQBGokACAFC4cBAgJ/An5BABAWIQMCQANAIAEgA08EQAJAIAAoAABBcHFB0NS0wgFGBEAgACABECIiAhADRQ0BQn4PCyAAIAEQVSIEQn1WDQMgBCAFfCIFIARUIQJCfiEEIAINAyAAIAEQUiICEAMNAwsgASACayEBIAAgAmohAAwBCwtCfiAFIAEbIQQLIAQLPwIBfwF+IwBBMGsiAiQAAn5CfiACQQhqIAAgARAtDQAaQgAgAigCHEEBRg0AGiACKQMICyEDIAJBMGokACADC40BAQJ/IwBBMGsiASQAAkAgAEUNACAAKAKI4gENACABIABB/OEBaigCADYCKCABIAApAvThATcDICAAEDAgACgCqOIBIQIgASABKAIoNgIYIAEgASkDIDcDECACIAFBEGoQGyAAQQA2AqjiASABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALKgECfyMAQRBrIgAkACAAQQA2AgggAEIANwMAIAAQWCEBIABBEGokACABC4cBAQN/IwBBEGsiAiQAAkAgACgCAEUgACgCBEVzDQAgAiAAKAIINgIIIAIgACkCADcDAAJ/IAIoAgAiAQRAIAIoAghBqOMJIAERBQAMAQtBqOMJECgLIgFFDQAgASAAKQIANwL04QEgAUH84QFqIAAoAgg2AgAgARBZIAEhAwsgAkEQaiQAIAMLywEBAn8jAEEgayIBJAAgAEGBgIDAADYCtOIBIABBADYCiOIBIABBADYC7OEBIABCADcDkOIBIABBADYCpOMJIABBADYC3OIBIABCADcCzOIBIABBADYCvOIBIABBADYCxOABIABCADcCnOIBIABBpOIBakIANwIAIABBrOIBakEANgIAIAFCADcCECABQgA3AhggASABKQMYNwMIIAEgASkDEDcDACABKAIIQQh2QQFxIQIgAEEANgLg4gEgACACNgKM4gEgAUEgaiQAC3YBA38jAEEwayIBJAAgAARAIAEgAEHE0AFqIgIoAgA2AiggASAAKQK80AE3AyAgACgCACEDIAEgAigCADYCGCABIAApArzQATcDECADIAFBEGoQGyABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALzAEBAX8gACABKAK00AE2ApjiASAAIAEoAgQiAjYCwOABIAAgAjYCvOABIAAgAiABKAIIaiICNgK44AEgACACNgLE4AEgASgCuNABBEAgAEKBgICAEDcDiOEBIAAgAUGk0ABqNgIMIAAgAUGUIGo2AgggACABQZwwajYCBCAAIAFBDGo2AgAgAEGs0AFqIAFBqNABaigCADYCACAAQbDQAWogAUGs0AFqKAIANgIAIABBtNABaiABQbDQAWooAgA2AgAPCyAAQgA3A4jhAQs7ACACRQRAQbp/DwsgBEUEQEFsDwsgAiAEEGAEQCAAIAEgAiADIAQgBRBhDwsgACABIAIgAyAEIAUQZQtGAQF/IwBBEGsiBSQAIAVBCGogBBAOAn8gBS0ACQRAIAAgASACIAMgBBAyDAELIAAgASACIAMgBBA0CyEAIAVBEGokACAACzQAIAAgAyAEIAUQNiIFEAMEQCAFDwsgBSAESQR/IAEgAiADIAVqIAQgBWsgABA1BUG4fwsLRgEBfyMAQRBrIgUkACAFQQhqIAQQDgJ/IAUtAAkEQCAAIAEgAiADIAQQYgwBCyAAIAEgAiADIAQQNQshACAFQRBqJAAgAAtZAQF/QQ8hAiABIABJBEAgAUEEdCAAbiECCyAAQQh2IgEgAkEYbCIAQYwIaigCAGwgAEGICGooAgBqIgJBA3YgAmogAEGACGooAgAgAEGECGooAgAgAWxqSQs3ACAAIAMgBCAFQYAQEDMiBRADBEAgBQ8LIAUgBEkEfyABIAIgAyAFaiAEIAVrIAAQMgVBuH8LC78DAQN/IwBBIGsiBSQAIAVBCGogAiADEAYiAhADRQRAIAAgAWoiB0F9aiEGIAUgBBAOIARBBGohAiAFLQACIQMDQEEAIAAgBkkgBUEIahAEGwRAIAAgAiAFQQhqIAMQAkECdGoiBC8BADsAACAFQQhqIAQtAAIQASAAIAQtAANqIgQgAiAFQQhqIAMQAkECdGoiAC8BADsAACAFQQhqIAAtAAIQASAEIAAtAANqIQAMAQUgB0F+aiEEA0AgBUEIahAEIAAgBEtyRQRAIAAgAiAFQQhqIAMQAkECdGoiBi8BADsAACAFQQhqIAYtAAIQASAAIAYtAANqIQAMAQsLA0AgACAES0UEQCAAIAIgBUEIaiADEAJBAnRqIgYvAQA7AAAgBUEIaiAGLQACEAEgACAGLQADaiEADAELCwJAIAAgB08NACAAIAIgBUEIaiADEAIiA0ECdGoiAC0AADoAACAALQADQQFGBEAgBUEIaiAALQACEAEMAQsgBSgCDEEfSw0AIAVBCGogAiADQQJ0ai0AAhABIAUoAgxBIUkNACAFQSA2AgwLIAFBbCAFQQhqEAobIQILCwsgBUEgaiQAIAILkgIBBH8jAEFAaiIJJAAgCSADQTQQCyEDAkAgBEECSA0AIAMgBEECdGooAgAhCSADQTxqIAgQIyADQQE6AD8gAyACOgA+QQAhBCADKAI8IQoDQCAEIAlGDQEgACAEQQJ0aiAKNgEAIARBAWohBAwAAAsAC0EAIQkDQCAGIAlGRQRAIAMgBSAJQQF0aiIKLQABIgtBAnRqIgwoAgAhBCADQTxqIAotAABBCHQgCGpB//8DcRAjIANBAjoAPyADIAcgC2siCiACajoAPiAEQQEgASAKa3RqIQogAygCPCELA0AgACAEQQJ0aiALNgEAIARBAWoiBCAKSQ0ACyAMIAo2AgAgCUEBaiEJDAELCyADQUBrJAALowIBCX8jAEHQAGsiCSQAIAlBEGogBUE0EAsaIAcgBmshDyAHIAFrIRADQAJAIAMgCkcEQEEBIAEgByACIApBAXRqIgYtAAEiDGsiCGsiC3QhDSAGLQAAIQ4gCUEQaiAMQQJ0aiIMKAIAIQYgCyAPTwRAIAAgBkECdGogCyAIIAUgCEE0bGogCCAQaiIIQQEgCEEBShsiCCACIAQgCEECdGooAgAiCEEBdGogAyAIayAHIA4QYyAGIA1qIQgMAgsgCUEMaiAOECMgCUEBOgAPIAkgCDoADiAGIA1qIQggCSgCDCELA0AgBiAITw0CIAAgBkECdGogCzYBACAGQQFqIQYMAAALAAsgCUHQAGokAA8LIAwgCDYCACAKQQFqIQoMAAALAAs0ACAAIAMgBCAFEDYiBRADBEAgBQ8LIAUgBEkEfyABIAIgAyAFaiAEIAVrIAAQNAVBuH8LCyMAIAA/AEEQdGtB//8DakEQdkAAQX9GBEBBAA8LQQAQAEEBCzsBAX8gAgRAA0AgACABIAJBgCAgAkGAIEkbIgMQCyEAIAFBgCBqIQEgAEGAIGohACACIANrIgINAAsLCwYAIAAQAwsLqBUJAEGICAsNAQAAAAEAAAACAAAAAgBBoAgLswYBAAAAAQAAAAIAAAACAAAAJgAAAIIAAAAhBQAASgAAAGcIAAAmAAAAwAEAAIAAAABJBQAASgAAAL4IAAApAAAALAIAAIAAAABJBQAASgAAAL4IAAAvAAAAygIAAIAAAACKBQAASgAAAIQJAAA1AAAAcwMAAIAAAACdBQAASgAAAKAJAAA9AAAAgQMAAIAAAADrBQAASwAAAD4KAABEAAAAngMAAIAAAABNBgAASwAAAKoKAABLAAAAswMAAIAAAADBBgAATQAAAB8NAABNAAAAUwQAAIAAAAAjCAAAUQAAAKYPAABUAAAAmQQAAIAAAABLCQAAVwAAALESAABYAAAA2gQAAIAAAABvCQAAXQAAACMUAABUAAAARQUAAIAAAABUCgAAagAAAIwUAABqAAAArwUAAIAAAAB2CQAAfAAAAE4QAAB8AAAA0gIAAIAAAABjBwAAkQAAAJAHAACSAAAAAAAAAAEAAAABAAAABQAAAA0AAAAdAAAAPQAAAH0AAAD9AAAA/QEAAP0DAAD9BwAA/Q8AAP0fAAD9PwAA/X8AAP3/AAD9/wEA/f8DAP3/BwD9/w8A/f8fAP3/PwD9/38A/f//AP3//wH9//8D/f//B/3//w/9//8f/f//P/3//38AAAAAAQAAAAIAAAADAAAABAAAAAUAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAABEAAAASAAAAEwAAABQAAAAVAAAAFgAAABcAAAAYAAAAGQAAABoAAAAbAAAAHAAAAB0AAAAeAAAAHwAAAAMAAAAEAAAABQAAAAYAAAAHAAAACAAAAAkAAAAKAAAACwAAAAwAAAANAAAADgAAAA8AAAAQAAAAEQAAABIAAAATAAAAFAAAABUAAAAWAAAAFwAAABgAAAAZAAAAGgAAABsAAAAcAAAAHQAAAB4AAAAfAAAAIAAAACEAAAAiAAAAIwAAACUAAAAnAAAAKQAAACsAAAAvAAAAMwAAADsAAABDAAAAUwAAAGMAAACDAAAAAwEAAAMCAAADBAAAAwgAAAMQAAADIAAAA0AAAAOAAAADAAEAQeAPC1EBAAAAAQAAAAEAAAABAAAAAgAAAAIAAAADAAAAAwAAAAQAAAAEAAAABQAAAAcAAAAIAAAACQAAAAoAAAALAAAADAAAAA0AAAAOAAAADwAAABAAQcQQC4sBAQAAAAIAAAADAAAABAAAAAUAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAABIAAAAUAAAAFgAAABgAAAAcAAAAIAAAACgAAAAwAAAAQAAAAIAAAAAAAQAAAAIAAAAEAAAACAAAABAAAAAgAAAAQAAAAIAAAAAAAQBBkBIL5gQBAAAAAQAAAAEAAAABAAAAAgAAAAIAAAADAAAAAwAAAAQAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAAAEAAAAEAAAACAAAAAAAAAABAAEBBgAAAAAAAAQAAAAAEAAABAAAAAAgAAAFAQAAAAAAAAUDAAAAAAAABQQAAAAAAAAFBgAAAAAAAAUHAAAAAAAABQkAAAAAAAAFCgAAAAAAAAUMAAAAAAAABg4AAAAAAAEFEAAAAAAAAQUUAAAAAAABBRYAAAAAAAIFHAAAAAAAAwUgAAAAAAAEBTAAAAAgAAYFQAAAAAAABwWAAAAAAAAIBgABAAAAAAoGAAQAAAAADAYAEAAAIAAABAAAAAAAAAAEAQAAAAAAAAUCAAAAIAAABQQAAAAAAAAFBQAAACAAAAUHAAAAAAAABQgAAAAgAAAFCgAAAAAAAAULAAAAAAAABg0AAAAgAAEFEAAAAAAAAQUSAAAAIAABBRYAAAAAAAIFGAAAACAAAwUgAAAAAAADBSgAAAAAAAYEQAAAABAABgRAAAAAIAAHBYAAAAAAAAkGAAIAAAAACwYACAAAMAAABAAAAAAQAAAEAQAAACAAAAUCAAAAIAAABQMAAAAgAAAFBQAAACAAAAUGAAAAIAAABQgAAAAgAAAFCQAAACAAAAULAAAAIAAABQwAAAAAAAAGDwAAACAAAQUSAAAAIAABBRQAAAAgAAIFGAAAACAAAgUcAAAAIAADBSgAAAAgAAQFMAAAAAAAEAYAAAEAAAAPBgCAAAAAAA4GAEAAAAAADQYAIABBgBcLhwIBAAEBBQAAAAAAAAUAAAAAAAAGBD0AAAAAAAkF/QEAAAAADwX9fwAAAAAVBf3/HwAAAAMFBQAAAAAABwR9AAAAAAAMBf0PAAAAABIF/f8DAAAAFwX9/38AAAAFBR0AAAAAAAgE/QAAAAAADgX9PwAAAAAUBf3/DwAAAAIFAQAAABAABwR9AAAAAAALBf0HAAAAABEF/f8BAAAAFgX9/z8AAAAEBQ0AAAAQAAgE/QAAAAAADQX9HwAAAAATBf3/BwAAAAEFAQAAABAABgQ9AAAAAAAKBf0DAAAAABAF/f8AAAAAHAX9//8PAAAbBf3//wcAABoF/f//AwAAGQX9//8BAAAYBf3//wBBkBkLhgQBAAEBBgAAAAAAAAYDAAAAAAAABAQAAAAgAAAFBQAAAAAAAAUGAAAAAAAABQgAAAAAAAAFCQAAAAAAAAULAAAAAAAABg0AAAAAAAAGEAAAAAAAAAYTAAAAAAAABhYAAAAAAAAGGQAAAAAAAAYcAAAAAAAABh8AAAAAAAAGIgAAAAAAAQYlAAAAAAABBikAAAAAAAIGLwAAAAAAAwY7AAAAAAAEBlMAAAAAAAcGgwAAAAAACQYDAgAAEAAABAQAAAAAAAAEBQAAACAAAAUGAAAAAAAABQcAAAAgAAAFCQAAAAAAAAUKAAAAAAAABgwAAAAAAAAGDwAAAAAAAAYSAAAAAAAABhUAAAAAAAAGGAAAAAAAAAYbAAAAAAAABh4AAAAAAAAGIQAAAAAAAQYjAAAAAAABBicAAAAAAAIGKwAAAAAAAwYzAAAAAAAEBkMAAAAAAAUGYwAAAAAACAYDAQAAIAAABAQAAAAwAAAEBAAAABAAAAQFAAAAIAAABQcAAAAgAAAFCAAAACAAAAUKAAAAIAAABQsAAAAAAAAGDgAAAAAAAAYRAAAAAAAABhQAAAAAAAAGFwAAAAAAAAYaAAAAAAAABh0AAAAAAAAGIAAAAAAAEAYDAAEAAAAPBgOAAAAAAA4GA0AAAAAADQYDIAAAAAAMBgMQAAAAAAsGAwgAAAAACgYDBABBpB0L2QEBAAAAAwAAAAcAAAAPAAAAHwAAAD8AAAB/AAAA/wAAAP8BAAD/AwAA/wcAAP8PAAD/HwAA/z8AAP9/AAD//wAA//8BAP//AwD//wcA//8PAP//HwD//z8A//9/AP///wD///8B////A////wf///8P////H////z////9/AAAAAAEAAAACAAAABAAAAAAAAAACAAAABAAAAAgAAAAAAAAAAQAAAAIAAAABAAAABAAAAAQAAAAEAAAABAAAAAgAAAAIAAAACAAAAAcAAAAIAAAACQAAAAoAAAALAEGgIAsDwBBQ",_taskCache=new WeakMap;let _activeLoaders=0,_zstd;class KTX2Loader extends three_module.aHM{constructor(o){super(o),this.transcoderPath="",this.transcoderBinary=null,this.transcoderPending=null,this.workerPool=new WorkerPool,this.workerSourceURL="",this.workerConfig=null,typeof MSC_TRANSCODER<"u"&&console.warn('THREE.KTX2Loader: Please update to latest "basis_transcoder". "msc_basis_transcoder" is no longer supported in three.js r125+.')}setTranscoderPath(o){return this.transcoderPath=o,this}setWorkerLimit(o){return this.workerPool.setWorkerLimit(o),this}detectSupport(o){return o.isWebGPURenderer===!0?this.workerConfig={astcSupported:o.hasFeature("texture-compression-astc"),etc1Supported:!1,etc2Supported:o.hasFeature("texture-compression-etc2"),dxtSupported:o.hasFeature("texture-compression-bc"),bptcSupported:!1,pvrtcSupported:!1}:(this.workerConfig={astcSupported:o.extensions.has("WEBGL_compressed_texture_astc"),etc1Supported:o.extensions.has("WEBGL_compressed_texture_etc1"),etc2Supported:o.extensions.has("WEBGL_compressed_texture_etc"),dxtSupported:o.extensions.has("WEBGL_compressed_texture_s3tc"),bptcSupported:o.extensions.has("EXT_texture_compression_bptc"),pvrtcSupported:o.extensions.has("WEBGL_compressed_texture_pvrtc")||o.extensions.has("WEBKIT_WEBGL_compressed_texture_pvrtc")},o.capabilities.isWebGL2&&(this.workerConfig.etc1Supported=!1)),this}init(){if(!this.transcoderPending){const o=new three_module.Y9S(this.manager);o.setPath(this.transcoderPath),o.setWithCredentials(this.withCredentials);const c=o.loadAsync("basis_transcoder.js"),d=new three_module.Y9S(this.manager);d.setPath(this.transcoderPath),d.setResponseType("arraybuffer"),d.setWithCredentials(this.withCredentials);const _=d.loadAsync("basis_transcoder.wasm");this.transcoderPending=Promise.all([c,_]).then(([v,b])=>{const tt=KTX2Loader.BasisWorker,it=["/* constants */","let _EngineFormat = "+JSON.stringify(KTX2Loader.EngineFormat),"let _TranscoderFormat = "+JSON.stringify(KTX2Loader.TranscoderFormat),"let _BasisFormat = "+JSON.stringify(KTX2Loader.BasisFormat),"/* basis_transcoder.js */",v,"/* worker */",tt.substring(tt.indexOf("{")+1,tt.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([it])),this.transcoderBinary=b,this.workerPool.setWorkerCreator(()=>{const nt=new Worker(this.workerSourceURL),lt=this.transcoderBinary.slice(0);return nt.postMessage({type:"init",config:this.workerConfig,transcoderBinary:lt},[lt]),nt})}),_activeLoaders>0&&console.warn("THREE.KTX2Loader: Multiple active KTX2 loaders may cause performance issues. Use a single KTX2Loader instance, or call .dispose() on old instances."),_activeLoaders++}return this.transcoderPending}load(o,c,d,_){if(this.workerConfig===null)throw new Error("THREE.KTX2Loader: Missing initialization with `.detectSupport( renderer )`.");const v=new three_module.Y9S(this.manager);v.setResponseType("arraybuffer"),v.setCrossOrigin(this.crossOrigin),v.setWithCredentials(this.withCredentials),v.load(o,b=>{if(_taskCache.has(b))return _taskCache.get(b).promise.then(c).catch(_);this.createTexture(b).then(tt=>c?c(tt):null).catch(_)},d,_)}_createTextureFrom(o,c){const{faces:d,width:_,height:v,format:b,type:tt,error:it,dfdFlags:nt}=o;if(tt==="error")return Promise.reject(it);let lt;if(c.faceCount===6)lt=new three_module.c5h(d,b,three_module.OUM);else{const ut=d[0].mipmaps;lt=c.layerCount>1?new three_module.iOZ(ut,_,v,c.layerCount,b,three_module.OUM):new three_module.FvD(ut,_,v,b,three_module.OUM)}return lt.minFilter=d[0].mipmaps.length===1?three_module.k6q:three_module.$_I,lt.magFilter=three_module.k6q,lt.generateMipmaps=!1,lt.needsUpdate=!0,lt.colorSpace=parseColorSpace(c),lt.premultiplyAlpha=!!(nt&ktx_parse_module_p),lt}async createTexture(o,c={}){const d=Pi$1(new Uint8Array(o));if(d.vkFormat!==ktx_parse_module_nt)return createRawTexture(d);const _=c,v=this.init().then(()=>this.workerPool.postMessage({type:"transcode",buffer:o,taskConfig:_},[o])).then(b=>this._createTextureFrom(b.data,d));return _taskCache.set(o,{promise:v}),v}dispose(){return this.workerPool.dispose(),this.workerSourceURL&&URL.revokeObjectURL(this.workerSourceURL),_activeLoaders--,this}}KTX2Loader.BasisFormat={ETC1S:0,UASTC_4x4:1},KTX2Loader.TranscoderFormat={ETC1:0,ETC2:1,BC1:2,BC3:3,BC4:4,BC5:5,BC7_M6_OPAQUE_ONLY:6,BC7_M5:7,PVRTC1_4_RGB:8,PVRTC1_4_RGBA:9,ASTC_4x4:10,ATC_RGB:11,ATC_RGBA_INTERPOLATED_ALPHA:12,RGBA32:13,RGB565:14,BGR565:15,RGBA4444:16},KTX2Loader.EngineFormat={RGBAFormat:three_module.GWd,RGBA_ASTC_4x4_Format:three_module.qa3,RGBA_BPTC_Format:three_module.Fn,RGBA_ETC2_EAC_Format:three_module.KDk,RGBA_PVRTC_4BPPV1_Format:three_module.HXV,RGBA_S3TC_DXT5_Format:three_module.BXX,RGB_ETC1_Format:three_module.CVz,RGB_ETC2_Format:three_module.Riy,RGB_PVRTC_4BPPV1_Format:three_module.k6Q,RGB_S3TC_DXT1_Format:three_module.IE4},KTX2Loader.BasisWorker=`function () {

	let config;
	let transcoderPending;
	let BasisModule;

	const EngineFormat = _EngineFormat; // eslint-disable-line no-undef
	const TranscoderFormat = _TranscoderFormat; // eslint-disable-line no-undef
	const BasisFormat = _BasisFormat; // eslint-disable-line no-undef

	self.addEventListener( 'message', function ( e ) {

		const message = e.data;

		switch ( message.type ) {

			case 'init':
				config = message.config;
				init( message.transcoderBinary );
				break;

			case 'transcode':
				transcoderPending.then( () => {

					try {

						const { faces, buffers, width, height, hasAlpha, format, dfdFlags } = transcode( message.buffer );

						self.postMessage( { type: 'transcode', id: message.id, faces, width, height, hasAlpha, format, dfdFlags }, buffers );

					} catch ( error ) {

						console.error( error );

						self.postMessage( { type: 'error', id: message.id, error: error.message } );

					}

				} );
				break;

		}

	} );

	function init( wasmBinary ) {

		transcoderPending = new Promise( ( resolve ) => {

			BasisModule = { wasmBinary, onRuntimeInitialized: resolve };
			BASIS( BasisModule ); // eslint-disable-line no-undef

		} ).then( () => {

			BasisModule.initializeBasis();

			if ( BasisModule.KTX2File === undefined ) {

				console.warn( 'THREE.KTX2Loader: Please update Basis Universal transcoder.' );

			}

		} );

	}

	function transcode( buffer ) {

		const ktx2File = new BasisModule.KTX2File( new Uint8Array( buffer ) );

		function cleanup() {

			ktx2File.close();
			ktx2File.delete();

		}

		if ( ! ktx2File.isValid() ) {

			cleanup();
			throw new Error( 'THREE.KTX2Loader:	Invalid or unsupported .ktx2 file' );

		}

		const basisFormat = ktx2File.isUASTC() ? BasisFormat.UASTC_4x4 : BasisFormat.ETC1S;
		const width = ktx2File.getWidth();
		const height = ktx2File.getHeight();
		const layerCount = ktx2File.getLayers() || 1;
		const levelCount = ktx2File.getLevels();
		const faceCount = ktx2File.getFaces();
		const hasAlpha = ktx2File.getHasAlpha();
		const dfdFlags = ktx2File.getDFDFlags();

		const { transcoderFormat, engineFormat } = getTranscoderFormat( basisFormat, width, height, hasAlpha );

		if ( ! width || ! height || ! levelCount ) {

			cleanup();
			throw new Error( 'THREE.KTX2Loader:	Invalid texture' );

		}

		if ( ! ktx2File.startTranscoding() ) {

			cleanup();
			throw new Error( 'THREE.KTX2Loader: .startTranscoding failed' );

		}

		const faces = [];
		const buffers = [];

		for ( let face = 0; face < faceCount; face ++ ) {

			const mipmaps = [];

			for ( let mip = 0; mip < levelCount; mip ++ ) {

				const layerMips = [];

				let mipWidth, mipHeight;

				for ( let layer = 0; layer < layerCount; layer ++ ) {

					const levelInfo = ktx2File.getImageLevelInfo( mip, layer, face );

					if ( face === 0 && mip === 0 && layer === 0 && ( levelInfo.origWidth % 4 !== 0 || levelInfo.origHeight % 4 !== 0 ) ) {

						console.warn( 'THREE.KTX2Loader: ETC1S and UASTC textures should use multiple-of-four dimensions.' );

					}

					if ( levelCount > 1 ) {

						mipWidth = levelInfo.origWidth;
						mipHeight = levelInfo.origHeight;

					} else {

						// Handles non-multiple-of-four dimensions in textures without mipmaps. Textures with
						// mipmaps must use multiple-of-four dimensions, for some texture formats and APIs.
						// See mrdoob/three.js#25908.
						mipWidth = levelInfo.width;
						mipHeight = levelInfo.height;

					}

					const dst = new Uint8Array( ktx2File.getImageTranscodedSizeInBytes( mip, layer, 0, transcoderFormat ) );
					const status = ktx2File.transcodeImage( dst, mip, layer, face, transcoderFormat, 0, - 1, - 1 );

					if ( ! status ) {

						cleanup();
						throw new Error( 'THREE.KTX2Loader: .transcodeImage failed.' );

					}

					layerMips.push( dst );

				}

				const mipData = concat( layerMips );

				mipmaps.push( { data: mipData, width: mipWidth, height: mipHeight } );
				buffers.push( mipData.buffer );

			}

			faces.push( { mipmaps, width, height, format: engineFormat } );

		}

		cleanup();

		return { faces, buffers, width, height, hasAlpha, format: engineFormat, dfdFlags };

	}

	//

	// Optimal choice of a transcoder target format depends on the Basis format (ETC1S or UASTC),
	// device capabilities, and texture dimensions. The list below ranks the formats separately
	// for ETC1S and UASTC.
	//
	// In some cases, transcoding UASTC to RGBA32 might be preferred for higher quality (at
	// significant memory cost) compared to ETC1/2, BC1/3, and PVRTC. The transcoder currently
	// chooses RGBA32 only as a last resort and does not expose that option to the caller.
	const FORMAT_OPTIONS = [
		{
			if: 'astcSupported',
			basisFormat: [ BasisFormat.UASTC_4x4 ],
			transcoderFormat: [ TranscoderFormat.ASTC_4x4, TranscoderFormat.ASTC_4x4 ],
			engineFormat: [ EngineFormat.RGBA_ASTC_4x4_Format, EngineFormat.RGBA_ASTC_4x4_Format ],
			priorityETC1S: Infinity,
			priorityUASTC: 1,
			needsPowerOfTwo: false,
		},
		{
			if: 'bptcSupported',
			basisFormat: [ BasisFormat.ETC1S, BasisFormat.UASTC_4x4 ],
			transcoderFormat: [ TranscoderFormat.BC7_M5, TranscoderFormat.BC7_M5 ],
			engineFormat: [ EngineFormat.RGBA_BPTC_Format, EngineFormat.RGBA_BPTC_Format ],
			priorityETC1S: 3,
			priorityUASTC: 2,
			needsPowerOfTwo: false,
		},
		{
			if: 'dxtSupported',
			basisFormat: [ BasisFormat.ETC1S, BasisFormat.UASTC_4x4 ],
			transcoderFormat: [ TranscoderFormat.BC1, TranscoderFormat.BC3 ],
			engineFormat: [ EngineFormat.RGB_S3TC_DXT1_Format, EngineFormat.RGBA_S3TC_DXT5_Format ],
			priorityETC1S: 4,
			priorityUASTC: 5,
			needsPowerOfTwo: false,
		},
		{
			if: 'etc2Supported',
			basisFormat: [ BasisFormat.ETC1S, BasisFormat.UASTC_4x4 ],
			transcoderFormat: [ TranscoderFormat.ETC1, TranscoderFormat.ETC2 ],
			engineFormat: [ EngineFormat.RGB_ETC2_Format, EngineFormat.RGBA_ETC2_EAC_Format ],
			priorityETC1S: 1,
			priorityUASTC: 3,
			needsPowerOfTwo: false,
		},
		{
			if: 'etc1Supported',
			basisFormat: [ BasisFormat.ETC1S, BasisFormat.UASTC_4x4 ],
			transcoderFormat: [ TranscoderFormat.ETC1 ],
			engineFormat: [ EngineFormat.RGB_ETC1_Format ],
			priorityETC1S: 2,
			priorityUASTC: 4,
			needsPowerOfTwo: false,
		},
		{
			if: 'pvrtcSupported',
			basisFormat: [ BasisFormat.ETC1S, BasisFormat.UASTC_4x4 ],
			transcoderFormat: [ TranscoderFormat.PVRTC1_4_RGB, TranscoderFormat.PVRTC1_4_RGBA ],
			engineFormat: [ EngineFormat.RGB_PVRTC_4BPPV1_Format, EngineFormat.RGBA_PVRTC_4BPPV1_Format ],
			priorityETC1S: 5,
			priorityUASTC: 6,
			needsPowerOfTwo: true,
		},
	];

	const ETC1S_OPTIONS = FORMAT_OPTIONS.sort( function ( a, b ) {

		return a.priorityETC1S - b.priorityETC1S;

	} );
	const UASTC_OPTIONS = FORMAT_OPTIONS.sort( function ( a, b ) {

		return a.priorityUASTC - b.priorityUASTC;

	} );

	function getTranscoderFormat( basisFormat, width, height, hasAlpha ) {

		let transcoderFormat;
		let engineFormat;

		const options = basisFormat === BasisFormat.ETC1S ? ETC1S_OPTIONS : UASTC_OPTIONS;

		for ( let i = 0; i < options.length; i ++ ) {

			const opt = options[ i ];

			if ( ! config[ opt.if ] ) continue;
			if ( ! opt.basisFormat.includes( basisFormat ) ) continue;
			if ( hasAlpha && opt.transcoderFormat.length < 2 ) continue;
			if ( opt.needsPowerOfTwo && ! ( isPowerOfTwo( width ) && isPowerOfTwo( height ) ) ) continue;

			transcoderFormat = opt.transcoderFormat[ hasAlpha ? 1 : 0 ];
			engineFormat = opt.engineFormat[ hasAlpha ? 1 : 0 ];

			return { transcoderFormat, engineFormat };

		}

		console.warn( 'THREE.KTX2Loader: No suitable compressed texture format found. Decoding to RGBA32.' );

		transcoderFormat = TranscoderFormat.RGBA32;
		engineFormat = EngineFormat.RGBAFormat;

		return { transcoderFormat, engineFormat };

	}

	function isPowerOfTwo( value ) {

		if ( value <= 2 ) return true;

		return ( value & ( value - 1 ) ) === 0 && value !== 0;

	}

	/** Concatenates N byte arrays. */
	function concat( arrays ) {

		if ( arrays.length === 1 ) return arrays[ 0 ];

		let totalByteLength = 0;

		for ( let i = 0; i < arrays.length; i ++ ) {

			const array = arrays[ i ];
			totalByteLength += array.byteLength;

		}

		const result = new Uint8Array( totalByteLength );

		let byteOffset = 0;

		for ( let i = 0; i < arrays.length; i ++ ) {

			const array = arrays[ i ];
			result.set( array, byteOffset );

			byteOffset += array.byteLength;

		}

		return result;

	}

}`;const UNCOMPRESSED_FORMATS=new Set([three_module.GWd,three_module.paN,three_module.VT0]),FORMAT_MAP={[ktx_parse_module_Ae]:three_module.GWd,[ktx_parse_module_pe]:three_module.GWd,[Ot]:three_module.GWd,[Ft]:three_module.GWd,[ktx_parse_module_de]:three_module.paN,[ktx_parse_module_se]:three_module.paN,[yt]:three_module.paN,[dt]:three_module.paN,[ktx_parse_module_xe]:three_module.VT0,[$t]:three_module.VT0,[gt]:three_module.VT0,[ktx_parse_module_ct]:three_module.VT0,[In]:three_module.Qrf,[Sn]:three_module.Qrf},TYPE_MAP={[ktx_parse_module_Ae]:three_module.RQf,[ktx_parse_module_pe]:three_module.ix0,[Ot]:three_module.OUM,[Ft]:three_module.OUM,[ktx_parse_module_de]:three_module.RQf,[ktx_parse_module_se]:three_module.ix0,[yt]:three_module.OUM,[dt]:three_module.OUM,[ktx_parse_module_xe]:three_module.RQf,[$t]:three_module.ix0,[gt]:three_module.OUM,[ktx_parse_module_ct]:three_module.OUM,[In]:three_module.OUM,[Sn]:three_module.OUM};async function createRawTexture(h){const{vkFormat:o}=h;if(FORMAT_MAP[o]===void 0)throw new Error("THREE.KTX2Loader: Unsupported vkFormat.");let c;h.supercompressionScheme===n$2&&(_zstd||(_zstd=new Promise(async v=>{const b=new zstddec_module_Q;await b.init(),v(b)})),c=await _zstd);const d=[];for(let v=0;v<h.levels.length;v++){const b=Math.max(1,h.pixelWidth>>v),tt=Math.max(1,h.pixelHeight>>v),it=h.pixelDepth?Math.max(1,h.pixelDepth>>v):0,nt=h.levels[v];let lt,ut;if(h.supercompressionScheme===ktx_parse_module_t)lt=nt.levelData;else{if(h.supercompressionScheme!==n$2)throw new Error("THREE.KTX2Loader: Unsupported supercompressionScheme.");lt=c.decode(nt.levelData,nt.uncompressedByteLength)}ut=TYPE_MAP[o]===three_module.RQf?new Float32Array(lt.buffer,lt.byteOffset,lt.byteLength/Float32Array.BYTES_PER_ELEMENT):TYPE_MAP[o]===three_module.ix0?new Uint16Array(lt.buffer,lt.byteOffset,lt.byteLength/Uint16Array.BYTES_PER_ELEMENT):lt,d.push({data:ut,width:b,height:tt,depth:it})}let _;if(UNCOMPRESSED_FORMATS.has(FORMAT_MAP[o]))_=h.pixelDepth===0?new three_module.GYF(d[0].data,h.pixelWidth,h.pixelHeight):new three_module.dYF(d[0].data,h.pixelWidth,h.pixelHeight,h.pixelDepth);else{if(h.pixelDepth>0)throw new Error("THREE.KTX2Loader: Unsupported pixelDepth.");_=new three_module.FvD(d,h.pixelWidth,h.pixelHeight)}return _.mipmaps=d,_.type=TYPE_MAP[o],_.format=FORMAT_MAP[o],_.colorSpace=parseColorSpace(h),_.needsUpdate=!0,Promise.resolve(_)}function parseColorSpace(h){const o=h.dataFormatDescriptor[0];return o.colorPrimaries===ktx_parse_module_F?o.transferFunction===ktx_parse_module_x?three_module.er$:three_module.Zr2:o.colorPrimaries===ktx_parse_module_X?o.transferFunction===ktx_parse_module_x?three_module.V5c:three_module.qIQ:(o.colorPrimaries===ktx_parse_module_E||console.warn(`THREE.KTX2Loader: Unsupported color primaries, "${o.colorPrimaries}"`),three_module.jf0)}const KHR_TEXTURE_BASISU="KHR_texture_basisu";class KTX2LoadPlugin extends I$2{constructor(){super(...arguments),this.dependencies=[AssetManagerPlugin]}async onAdded(o){var c,d,_,v,b,tt;this._importer||(this._importer=new Importer(class extends KTX2Loader{constructor(it){super(it),this.setTranscoderPath(KTX2LoadPlugin.TRANSCODER_LIBRARY_PATH).detectSupport(o.renderer.rendererObject)}async createTexture(it,nt){const lt=KTX2LoadPlugin.SAVE_SOURCE_BLOBS?new Uint8Array(it.slice(0)):void 0,ut=await super.createTexture(it,nt);return KTX2LoadPlugin.SAVE_SOURCE_BLOBS&&lt&&(ut.source._sourceImgBuffer=lt,ut.userData.mimeType="image/ktx2",ut.source._canSerialize=!0,ut.toJSON=ht=>serializeTextureInExtras(ut,ht,ut.name,"image/ktx2"),ut.clone=()=>{throw new Error("ktx2 texture cloning not supported")}),ut}},["ktx2"],!1)),(d=(c=o.getManager())===null||c===void 0?void 0:c.importer)===null||d===void 0||d.Importers.push(this._importer),(tt=(b=(v=(_=o.getManager())===null||_===void 0?void 0:_.exporter)===null||v===void 0?void 0:v.getExporter("gltf","glb"))===null||b===void 0?void 0:b.extensions)===null||tt===void 0||tt.push(glTFTextureBasisUExtensionExport)}async onDispose(o){this._importer=void 0}async onRemove(o){var c,d;this._importer&&!((d=(c=o.getManager())===null||c===void 0?void 0:c.importer)===null||d===void 0)&&d.Importers&&o.getManager().importer.Importers.splice(o.getManager().importer.Importers.indexOf(this._importer),1),this._importer=void 0}}KTX2LoadPlugin.PluginType="KTX2LoadPlugin",KTX2LoadPlugin.TRANSCODER_LIBRARY_PATH="https://cdn.jsdelivr.net/gh/BinomialLLC/basis_universal@master/webgl/transcoder/build/",KTX2LoadPlugin.SAVE_SOURCE_BLOBS=!1;const glTFTextureBasisUExtensionExport=h=>({writeTexture:(o,c)=>{if(o.userData.mimeType!=="image/ktx2")return;if(c.source!==void 0&&c.source!==null)return void console.warn("ktx2 export: source already set");const d=o.source._sourceImgBuffer||o.userData.__sourceBuffer;if(!d)return void console.warn("ktx2 export: no source buffer for ktx2");c.extensions=c.extensions||{};const _={},v=new Blob([d],{type:"image/ktx2"});_.source=h.processImageBlob(v,o),c.extensions[KHR_TEXTURE_BASISU]=_,h.extensionsUsed[KHR_TEXTURE_BASISU]=!0}});class DebugPlugin extends I$2{constructor(){super(...arguments),this.dirty=!1,this.counters={},this._generators=new Map,this._preRender=()=>this._showDebug("preRender"),this._postRender=()=>this._showDebug("postRender")}async onAdded(o){this._viewer=o,o.addEventListener("preRender",this._preRender),o.addEventListener("postFrame",this._postRender)}addTexture(o,c,d,_,v,b="postRender",tt=!1){var it;this._generators.has(b)||this._generators.set(b,[]),(it=this._generators.get(b))===null||it===void 0||it.push({key:o,fn:c,rect:d?[...d]:void 0,frag:v||_||tt?new three_module.BKk({vertexShader:CopyShader.vertexShader,uniforms:{tDiffuse:{value:null},opacity:{value:1}},fragmentShader:v??`
        #include <common>
        #include <packing>
        uniform float opacity;
		uniform ${tt?"samplerCube":"sampler2D"} tDiffuse;
		varying vec2 vUv;
		void main() {
			vec4 texel = ${tt?"textureCube( tDiffuse, vec3(cos(vUv.y * PI2) * cos(vUv.x * PI2), sin(vUv.y * PI2), cos(vUv.y * PI2) * sin(vUv.x * PI2)) )":"texture2D( tDiffuse, vUv )"};
			${_??""}
			gl_FragColor = opacity * texel;
		}
            `}):void 0})}removeTexture(o,c="postRender"){var d,_;this._generators.set(c,(_=(d=this._generators.get(c))===null||d===void 0?void 0:d.filter(v=>v.key!==o))!==null&&_!==void 0?_:[])}async onDispose(o){return Promise.resolve(void 0)}async onRemove(o){return o.removeEventListener("preRender",this._preRender),o.removeEventListener("postRender",this._postRender),this._viewer=void 0,Promise.resolve(void 0)}_showDebug(o){var c;const d=this._viewer,_=d==null?void 0:d.renderer;_&&d&&((c=this._generators.get(o))===null||c===void 0||c.forEach(({key:v,fn:b,rect:tt,frag:it})=>{const nt=b(d);if(nt){if(nt.image&&tt){const lt=nt.image.width/nt.image.height;tt[2]<1&&tt[3]<1&&(tt[2]=200),tt[2]<1&&(tt[2]=tt[3]*lt),tt[3]<1&&(tt[3]=tt[2]/lt)}_.blit(nt,void 0,{viewport:tt,clear:!1,material:it})}}))}}DebugPlugin.PluginType="debug";class MTLLoader2 extends three_module.aHM{constructor(o){super(o)}load(o,c,d,_){const v=this,b=this.path===""?three_module.r6x.extractUrlBase(o):this.path,tt=new three_module.Y9S(this.manager);tt.setPath(this.path),tt.setRequestHeader(this.requestHeader),tt.setWithCredentials(this.withCredentials),tt.load(o,function(it){try{c(v.parse(it,b))}catch(nt){_?_(nt):console.error(nt),v.manager.itemError(o)}},d,_)}setMaterialOptions(o){return this.materialOptions=o,this}parse(o,c){const d=o.split(`
`);let _={};const v=/\s+/,b={};for(let it=0;it<d.length;it++){let nt=d[it];if(nt=nt.trim(),nt.length===0||nt.charAt(0)==="#")continue;const lt=nt.indexOf(" ");let ut=lt>=0?nt.substring(0,lt):nt;ut=ut.toLowerCase();let ht=lt>=0?nt.substring(lt+1):"";if(ht=ht.trim(),ut==="newmtl")_={name:ht},b[ht]=_;else if(ut==="ka"||ut==="kd"||ut==="ks"||ut==="ke"){const _t=ht.split(v,3);_[ut]=[parseFloat(_t[0]),parseFloat(_t[1]),parseFloat(_t[2])]}else _[ut]=ht}const tt=new MaterialCreator(this.resourcePath||c,this.materialOptions);return tt.setCrossOrigin(this.crossOrigin),tt.setManager(this.manager),tt.setMaterials(b),tt}}class MaterialCreator{constructor(o="",c={}){this.baseUrl=o,this.options=c,this.materialsInfo={},this.materials={},this.materialsArray=[],this.nameLookup={},this.crossOrigin="anonymous",this.side=this.options.side!==void 0?this.options.side:three_module.hB5,this.wrap=this.options.wrap!==void 0?this.options.wrap:three_module.GJx}setCrossOrigin(o){return this.crossOrigin=o,this}setManager(o){this.manager=o}setMaterials(o){this.materialsInfo=this.convert(o),this.materials={},this.materialsArray=[],this.nameLookup={}}convert(o){if(!this.options)return o;const c={};for(const d in o){const _=o[d],v={};c[d]=v;for(const b in _){let tt=!0,it=_[b];const nt=b.toLowerCase();switch(nt){case"kd":case"ka":case"ks":this.options&&this.options.normalizeRGB&&(it=[it[0]/255,it[1]/255,it[2]/255]),this.options&&this.options.ignoreZeroRGBs&&it[0]===0&&it[1]===0&&it[2]===0&&(tt=!1)}tt&&(v[nt]=it)}}return c}async preload(){for(const o in this.materialsInfo)await this.create(o)}getIndex(o){return this.nameLookup[o]}async getAsArray(){let o=0;for(const c in this.materialsInfo)this.materialsArray[o]=await this.create(c),this.nameLookup[c]=o,o++;return this.materialsArray}async create(o){return this.materials[o]===void 0&&await this.createMaterial_(o),this.materials[o]}async createMaterial_(o){const c=this,d=this.materialsInfo[o],_={name:o,side:this.side};async function v(it,nt){if(_[it])return;const lt=c.getTextureParams(nt,_);return new Promise((ut,ht)=>{let _t=!1,ft=()=>!_t&&(_t=!0)&&ut();const bt=c.loadTexture((xt=c.baseUrl,typeof(St=lt.url)!="string"||St===""?"":/^https?:\/\//i.test(St)?St:xt+St),void 0,wt=>{_[it]=wt,ft()},void 0,ft);var xt,St;setTimeout(ft,50),bt.repeat.copy(lt.scale),bt.offset.copy(lt.offset),bt.wrapS=c.wrap,bt.wrapT=c.wrap,it!=="map"&&it!=="emissiveMap"||(bt.colorSpace=three_module.er$)})}const b=Array.from(Object.keys(d||{}));let tt=b.includes("d")||b.includes("D");for(const it of b){const nt=d[it];let lt;if(nt!=="")switch(it.toLowerCase()){case"kd":_.color=new three_module.Q1f().fromArray(nt).convertSRGBToLinear();break;case"ks":_.specular=new three_module.Q1f().fromArray(nt).convertSRGBToLinear();break;case"ke":_.emissive=new three_module.Q1f().fromArray(nt).convertSRGBToLinear();break;case"map_kd":await v("map",nt);break;case"map_ks":await v("specularMap",nt);break;case"map_ke":await v("emissiveMap",nt);break;case"norm":await v("normalMap",nt);break;case"map_bump":case"bump":await v("bumpMap",nt);break;case"map_d":await v("alphaMap",nt),_.transparent=!0;break;case"ns":_.shininess=parseFloat(nt);break;case"d":lt=parseFloat(nt),lt<1&&(_.opacity=lt,_.transparent=!0);break;case"tr":if(tt)break;lt=parseFloat(nt),this.options&&this.options.invertTrProperty&&(lt=1-lt),lt>0&&(_.opacity=1-lt,_.transparent=!0)}}return this.materials[o]=new three_module.tXL(_),this.materials[o]}getTextureParams(o,c){const d={scale:new three_module.I9Y(1,1),offset:new three_module.I9Y(0,0)},_=o.split(/\s+/);let v;return v=_.indexOf("-bm"),v>=0&&(c.bumpScale=parseFloat(_[v+1]),_.splice(v,2)),v=_.indexOf("-s"),v>=0&&(d.scale.set(parseFloat(_[v+1]),parseFloat(_[v+2])),_.splice(v,4)),v=_.indexOf("-o"),v>=0&&(d.offset.set(parseFloat(_[v+1]),parseFloat(_[v+2])),_.splice(v,4)),d.url=_.join(" ").trim(),d}loadTexture(o,c,d,_,v){const b=this.manager!==void 0?this.manager:three_module.h_9;let tt=b.getHandler(o);tt===null&&(tt=new three_module.Tap(b)),tt.setCrossOrigin&&tt.setCrossOrigin(this.crossOrigin);const it=tt.load(o,d,_,v);return c!==void 0&&(it.mapping=c),it}}const _object_pattern=/^[og]\s*(.+)?/,_material_library_pattern=/^mtllib /,_material_use_pattern=/^usemtl /,_map_use_pattern=/^usemap /,_face_vertex_data_separator_pattern=/\s+/,_vA=new three_module.Pq0,_vB=new three_module.Pq0,_vC=new three_module.Pq0,_ab=new three_module.Pq0,_cb=new three_module.Pq0,_color=new three_module.Q1f;function ParserState(){const h={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materials:{},materialLibraries:[],startObject:function(o,c){if(this.object&&this.object.fromDeclaration===!1)return this.object.name=o,void(this.object.fromDeclaration=c!==!1);const d=this.object&&typeof this.object.currentMaterial=="function"?this.object.currentMaterial():void 0;if(this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0),this.object={name:o||"",fromDeclaration:c!==!1,geometry:{vertices:[],normals:[],colors:[],uvs:[],hasUVIndices:!1},materials:[],smooth:!0,startMaterial:function(_,v){const b=this._finalize(!1);b&&(b.inherited||b.groupCount<=0)&&this.materials.splice(b.index,1);const tt={index:this.materials.length,name:_||"",mtllib:Array.isArray(v)&&v.length>0?v[v.length-1]:"",smooth:b!==void 0?b.smooth:this.smooth,groupStart:b!==void 0?b.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(it){const nt={index:typeof it=="number"?it:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return nt.clone=this.clone.bind(nt),nt}};return this.materials.push(tt),tt},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(_){const v=this.currentMaterial();if(v&&v.groupEnd===-1&&(v.groupEnd=this.geometry.vertices.length/3,v.groupCount=v.groupEnd-v.groupStart,v.inherited=!1),_&&this.materials.length>1)for(let b=this.materials.length-1;b>=0;b--)this.materials[b].groupCount<=0&&this.materials.splice(b,1);return _&&this.materials.length===0&&this.materials.push({name:"",smooth:this.smooth}),v}},d&&d.name&&typeof d.clone=="function"){const _=d.clone(0);_.inherited=!0,this.object.materials.push(_)}this.objects.push(this.object)},finalize:function(){this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0)},parseVertexIndex:function(o,c){const d=parseInt(o,10);return 3*(d>=0?d-1:d+c/3)},parseNormalIndex:function(o,c){const d=parseInt(o,10);return 3*(d>=0?d-1:d+c/3)},parseUVIndex:function(o,c){const d=parseInt(o,10);return 2*(d>=0?d-1:d+c/2)},addVertex:function(o,c,d){const _=this.vertices,v=this.object.geometry.vertices;v.push(_[o+0],_[o+1],_[o+2]),v.push(_[c+0],_[c+1],_[c+2]),v.push(_[d+0],_[d+1],_[d+2])},addVertexPoint:function(o){const c=this.vertices;this.object.geometry.vertices.push(c[o+0],c[o+1],c[o+2])},addVertexLine:function(o){const c=this.vertices;this.object.geometry.vertices.push(c[o+0],c[o+1],c[o+2])},addNormal:function(o,c,d){const _=this.normals,v=this.object.geometry.normals;v.push(_[o+0],_[o+1],_[o+2]),v.push(_[c+0],_[c+1],_[c+2]),v.push(_[d+0],_[d+1],_[d+2])},addFaceNormal:function(o,c,d){const _=this.vertices,v=this.object.geometry.normals;_vA.fromArray(_,o),_vB.fromArray(_,c),_vC.fromArray(_,d),_cb.subVectors(_vC,_vB),_ab.subVectors(_vA,_vB),_cb.cross(_ab),_cb.normalize(),v.push(_cb.x,_cb.y,_cb.z),v.push(_cb.x,_cb.y,_cb.z),v.push(_cb.x,_cb.y,_cb.z)},addColor:function(o,c,d){const _=this.colors,v=this.object.geometry.colors;_[o]!==void 0&&v.push(_[o+0],_[o+1],_[o+2]),_[c]!==void 0&&v.push(_[c+0],_[c+1],_[c+2]),_[d]!==void 0&&v.push(_[d+0],_[d+1],_[d+2])},addUV:function(o,c,d){const _=this.uvs,v=this.object.geometry.uvs;v.push(_[o+0],_[o+1]),v.push(_[c+0],_[c+1]),v.push(_[d+0],_[d+1])},addDefaultUV:function(){const o=this.object.geometry.uvs;o.push(0,0),o.push(0,0),o.push(0,0)},addUVLine:function(o){const c=this.uvs;this.object.geometry.uvs.push(c[o+0],c[o+1])},addFace:function(o,c,d,_,v,b,tt,it,nt){const lt=this.vertices.length;let ut=this.parseVertexIndex(o,lt),ht=this.parseVertexIndex(c,lt),_t=this.parseVertexIndex(d,lt);if(this.addVertex(ut,ht,_t),this.addColor(ut,ht,_t),tt!==void 0&&tt!==""){const ft=this.normals.length;ut=this.parseNormalIndex(tt,ft),ht=this.parseNormalIndex(it,ft),_t=this.parseNormalIndex(nt,ft),this.addNormal(ut,ht,_t)}else this.addFaceNormal(ut,ht,_t);if(_!==void 0&&_!==""){const ft=this.uvs.length;ut=this.parseUVIndex(_,ft),ht=this.parseUVIndex(v,ft),_t=this.parseUVIndex(b,ft),this.addUV(ut,ht,_t),this.object.geometry.hasUVIndices=!0}else this.addDefaultUV()},addPointGeometry:function(o){this.object.geometry.type="Points";const c=this.vertices.length;for(let d=0,_=o.length;d<_;d++){const v=this.parseVertexIndex(o[d],c);this.addVertexPoint(v),this.addColor(v)}},addLineGeometry:function(o,c){this.object.geometry.type="Line";const d=this.vertices.length,_=this.uvs.length;for(let v=0,b=o.length;v<b;v++)this.addVertexLine(this.parseVertexIndex(o[v],d));for(let v=0,b=c.length;v<b;v++)this.addUVLine(this.parseUVIndex(c[v],_))}};return h.startObject("",!1),h}class OBJLoader2 extends three_module.aHM{constructor(o){super(o),this.materials=null}load(o,c,d,_){const v=this,b=new three_module.Y9S(this.manager);b.setPath(this.path),b.setRequestHeader(this.requestHeader),b.setWithCredentials(this.withCredentials),b.load(o,async function(tt){try{c(await v.parse(tt))}catch(it){_?_(it):console.error(it),v.manager.itemError(o)}},d,_)}setMaterials(o){return this.materials=o,this}async parse(o){const c=new ParserState;o.indexOf(`\r
`)!==-1&&(o=o.replace(/\r\n/g,`
`)),o.indexOf(`\\
`)!==-1&&(o=o.replace(/\\\n/g,""));const d=o.split(`
`);let _=[];for(let b=0,tt=d.length;b<tt;b++){const it=d[b].trimStart();if(it.length===0)continue;const nt=it.charAt(0);if(nt!=="#")if(nt==="v"){const lt=it.split(_face_vertex_data_separator_pattern);switch(lt[0]){case"v":c.vertices.push(parseFloat(lt[1]),parseFloat(lt[2]),parseFloat(lt[3])),lt.length>=7?(_color.setRGB(parseFloat(lt[4]),parseFloat(lt[5]),parseFloat(lt[6])).convertSRGBToLinear(),c.colors.push(_color.r,_color.g,_color.b)):c.colors.push(void 0,void 0,void 0);break;case"vn":c.normals.push(parseFloat(lt[1]),parseFloat(lt[2]),parseFloat(lt[3]));break;case"vt":c.uvs.push(parseFloat(lt[1]),parseFloat(lt[2]))}}else if(nt==="f"){const lt=it.slice(1).trim().split(_face_vertex_data_separator_pattern),ut=[];for(let _t=0,ft=lt.length;_t<ft;_t++){const bt=lt[_t];if(bt.length>0){const xt=bt.split("/");ut.push(xt)}}const ht=ut[0];for(let _t=1,ft=ut.length-1;_t<ft;_t++){const bt=ut[_t],xt=ut[_t+1];c.addFace(ht[0],bt[0],xt[0],ht[1],bt[1],xt[1],ht[2],bt[2],xt[2])}}else if(nt==="l"){const lt=it.substring(1).trim().split(" ");let ut=[];const ht=[];if(it.indexOf("/")===-1)ut=lt;else for(let _t=0,ft=lt.length;_t<ft;_t++){const bt=lt[_t].split("/");bt[0]!==""&&ut.push(bt[0]),bt[1]!==""&&ht.push(bt[1])}c.addLineGeometry(ut,ht)}else if(nt==="p"){const lt=it.slice(1).trim().split(" ");c.addPointGeometry(lt)}else if((_=_object_pattern.exec(it))!==null){const lt=(" "+_[0].slice(1).trim()).slice(1);c.startObject(lt)}else if(_material_use_pattern.test(it))c.object.startMaterial(it.substring(7).trim(),c.materialLibraries);else if(_material_library_pattern.test(it)){c.materialLibraries.push(it.substring(7).trim());const lt=it.substring(7).trim(),ut=this.manager.getHandler(lt);if(ut){const ht=await ut.loadAsync(lt).catch(_t=>{console.warn(_t)});ht&&this.setMaterials(ht)}else console.warn("OBJLoader2: Set MTLLoader to loading manager to load materials.")}else if(_map_use_pattern.test(it))console.warn('OBJLoader2: Rendering identifier "usemap" not supported. Textures must be defined in MTL files.');else if(nt==="s"){if(_=it.split(" "),_.length>1){const ut=_[1].trim().toLowerCase();c.object.smooth=ut!=="0"&&ut!=="off"}else c.object.smooth=!0;const lt=c.object.currentMaterial();lt&&(lt.smooth=c.object.smooth)}else{if(it==="\0")continue;console.warn('THREE.OBJLoader: Unexpected line: "'+it+'"')}}c.finalize();const v=new three_module.YJl;if(v.materialLibraries=[].concat(c.materialLibraries),!(c.objects.length===1&&c.objects[0].geometry.vertices.length===0))for(let b=0,tt=c.objects.length;b<tt;b++){const it=c.objects[b],nt=it.geometry,lt=it.materials,ut=nt.type==="Line",ht=nt.type==="Points";let _t=!1;if(nt.vertices.length===0)continue;const ft=new three_module.LoY;ft.setAttribute("position",new three_module.qtW(nt.vertices,3)),nt.normals.length>0&&ft.setAttribute("normal",new three_module.qtW(nt.normals,3)),nt.colors.length>0&&(_t=!0,ft.setAttribute("color",new three_module.qtW(nt.colors,3))),nt.hasUVIndices===!0&&ft.setAttribute("uv",new three_module.qtW(nt.uvs,2));const bt=[];for(let St=0,wt=lt.length;St<wt;St++){const Pt=lt[St],Rt=Pt.name+"_"+Pt.smooth+"_"+_t;let kt=c.materials[Rt];if(this.materials!==null)if(kt=await this.materials.create(Pt.name),!ut||!kt||kt instanceof three_module.mrM){if(ht&&kt&&!(kt instanceof three_module.BH$)){const Gt=new three_module.BH$({size:10,sizeAttenuation:!1});three_module.imn.prototype.copy.call(Gt,kt),Gt.color.copy(kt.color),Gt.map=kt.map,kt=Gt}}else{const Gt=new three_module.mrM;three_module.imn.prototype.copy.call(Gt,kt),Gt.color.copy(kt.color),kt=Gt}kt===void 0&&(kt=ut?new three_module.mrM:ht?new three_module.BH$({size:1,sizeAttenuation:!1}):new three_module.tXL,kt.name=Pt.name,kt.flatShading=!Pt.smooth,kt.vertexColors=_t,c.materials[Rt]=kt),bt.push(kt)}let xt;if(bt.length>1){for(let St=0,wt=lt.length;St<wt;St++){const Pt=lt[St];ft.addGroup(Pt.groupStart,Pt.groupCount,St)}xt=ut?new three_module.DXC(ft,bt):ht?new three_module.ONl(ft,bt):new three_module.eaF(ft,bt)}else xt=ut?new three_module.DXC(ft,bt[0]):ht?new three_module.ONl(ft,bt[0]):new three_module.eaF(ft,bt[0]);xt.name=it.name,v.add(xt)}else if(c.vertices.length>0){const b=new three_module.BH$({size:1,sizeAttenuation:!1}),tt=new three_module.LoY;tt.setAttribute("position",new three_module.qtW(c.vertices,3)),c.colors.length>0&&c.colors[0]!==void 0&&(tt.setAttribute("color",new three_module.qtW(c.colors,3)),b.vertexColors=!0);const it=new three_module.ONl(tt,b);v.add(it)}return v}}class ObjMtlLoadPlugin extends I$2{constructor(){super(...arguments),this.dependencies=[AssetManagerPlugin],this._importer1=new Importer(OBJLoader2,["obj"],!0),this._importer2=new Importer(MTLLoader2,["mtl"],!1)}async onAdded(o){var c,d,_,v;(d=(c=o.getManager())===null||c===void 0?void 0:c.importer)===null||d===void 0||d.Importers.push(this._importer1),(v=(_=o.getManager())===null||_===void 0?void 0:_.importer)===null||v===void 0||v.Importers.push(this._importer2)}async onDispose(o){}async onRemove(o){var c,d;!((d=(c=o.getManager())===null||c===void 0?void 0:c.importer)===null||d===void 0)&&d.Importers&&(o.getManager().importer.Importers.splice(o.getManager().importer.Importers.indexOf(this._importer1),1),o.getManager().importer.Importers.splice(o.getManager().importer.Importers.indexOf(this._importer2),1))}}ObjMtlLoadPlugin.PluginType="ObjMtlLoadPlugin";var durl=function(h){return URL.createObjectURL(new Blob([h],{type:"text/javascript"}))};try{URL.revokeObjectURL(durl(""))}catch(h){durl=function(o){return"data:application/javascript;charset=UTF-8,"+encodeURI(o)}}var fflate_module_u8=Uint8Array,fflate_module_u16=Uint16Array,fflate_module_u32=Uint32Array,fflate_module_fleb=new fflate_module_u8([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),fflate_module_fdeb=new fflate_module_u8([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),fflate_module_clim=new fflate_module_u8([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),fflate_module_freb=function(h,o){for(var c=new fflate_module_u16(31),d=0;d<31;++d)c[d]=o+=1<<h[d-1];var _=new fflate_module_u32(c[30]);for(d=1;d<30;++d)for(var v=c[d];v<c[d+1];++v)_[v]=v-c[d]<<5|d;return[c,_]},fflate_module_a=fflate_module_freb(fflate_module_fleb,2),fflate_module_fl=fflate_module_a[0],fflate_module_revfl=fflate_module_a[1];fflate_module_fl[28]=258,fflate_module_revfl[258]=28;for(var fflate_module_b=fflate_module_freb(fflate_module_fdeb,0),fflate_module_fd=fflate_module_b[0],fflate_module_revfd=fflate_module_b[1],fflate_module_rev=new fflate_module_u16(32768),fflate_module_i=0;fflate_module_i<32768;++fflate_module_i){var fflate_module_x=(43690&fflate_module_i)>>>1|(21845&fflate_module_i)<<1;fflate_module_x=(52428&fflate_module_x)>>>2|(13107&fflate_module_x)<<2,fflate_module_x=(61680&fflate_module_x)>>>4|(3855&fflate_module_x)<<4,fflate_module_rev[fflate_module_i]=((65280&fflate_module_x)>>>8|(255&fflate_module_x)<<8)>>>1}for(var fflate_module_hMap=function(o,c,d){for(var _=o.length,v=0,b=new fflate_module_u16(c);v<_;++v)++b[o[v]-1];var tt,it=new fflate_module_u16(c);for(v=0;v<c;++v)it[v]=it[v-1]+b[v-1]<<1;if(d){tt=new fflate_module_u16(1<<c);var nt=15-c;for(v=0;v<_;++v)if(o[v])for(var lt=v<<4|o[v],ut=c-o[v],ht=it[o[v]-1]++<<ut,_t=ht|(1<<ut)-1;ht<=_t;++ht)tt[fflate_module_rev[ht]>>>nt]=lt}else for(tt=new fflate_module_u16(_),v=0;v<_;++v)o[v]&&(tt[v]=fflate_module_rev[it[o[v]-1]++]>>>15-o[v]);return tt},fflate_module_flt=new fflate_module_u8(288),fflate_module_i=0;fflate_module_i<144;++fflate_module_i)fflate_module_flt[fflate_module_i]=8;for(var fflate_module_i=144;fflate_module_i<256;++fflate_module_i)fflate_module_flt[fflate_module_i]=9;for(var fflate_module_i=256;fflate_module_i<280;++fflate_module_i)fflate_module_flt[fflate_module_i]=7;for(var fflate_module_i=280;fflate_module_i<288;++fflate_module_i)fflate_module_flt[fflate_module_i]=8;for(var fflate_module_fdt=new fflate_module_u8(32),fflate_module_i=0;fflate_module_i<32;++fflate_module_i)fflate_module_fdt[fflate_module_i]=5;var fflate_module_flm=fflate_module_hMap(fflate_module_flt,9,0),fflate_module_flrm=fflate_module_hMap(fflate_module_flt,9,1),fflate_module_fdm=fflate_module_hMap(fflate_module_fdt,5,0),fflate_module_fdrm=fflate_module_hMap(fflate_module_fdt,5,1),fflate_module_max=function(h){for(var o=h[0],c=1;c<h.length;++c)h[c]>o&&(o=h[c]);return o},fflate_module_bits=function(h,o,c){var d=o/8|0;return(h[d]|h[d+1]<<8)>>(7&o)&c},fflate_module_bits16=function(h,o){var c=o/8|0;return(h[c]|h[c+1]<<8|h[c+2]<<16)>>(7&o)},fflate_module_shft=function(h){return(h/8|0)+(7&h&&1)},fflate_module_slc=function(h,o,c){(c==null||c>h.length)&&(c=h.length);var d=new(h instanceof fflate_module_u16?fflate_module_u16:h instanceof fflate_module_u32?fflate_module_u32:fflate_module_u8)(c-o);return d.set(h.subarray(o,c)),d},fflate_module_inflt=function(h,o,c){var d=h.length;if(!d||c&&!c.l&&d<5)return o||new fflate_module_u8(0);var _=!o||c,v=!c||c.i;c||(c={}),o||(o=new fflate_module_u8(3*d));var b=function(dr){var Ir=o.length;if(dr>Ir){var Xr=new fflate_module_u8(Math.max(2*Ir,dr));Xr.set(o),o=Xr}},tt=c.f||0,it=c.p||0,nt=c.b||0,lt=c.l,ut=c.d,ht=c.m,_t=c.n,ft=8*d;do{if(!lt){c.f=tt=fflate_module_bits(h,it,1);var bt=fflate_module_bits(h,it+1,3);if(it+=3,!bt){var xt=h[(Kt=fflate_module_shft(it)+4)-4]|h[Kt-3]<<8,St=Kt+xt;if(St>d){if(v)throw"unexpected EOF";break}_&&b(nt+xt),o.set(h.subarray(Kt,St),nt),c.b=nt+=xt,c.p=it=8*St;continue}if(bt==1)lt=fflate_module_flrm,ut=fflate_module_fdrm,ht=9,_t=5;else{if(bt!=2)throw"invalid block type";var wt=fflate_module_bits(h,it,31)+257,Pt=fflate_module_bits(h,it+10,15)+4,Rt=wt+fflate_module_bits(h,it+5,31)+1;it+=14;for(var kt=new fflate_module_u8(Rt),Gt=new fflate_module_u8(19),Dt=0;Dt<Pt;++Dt)Gt[fflate_module_clim[Dt]]=fflate_module_bits(h,it+3*Dt,7);it+=3*Pt;var It=fflate_module_max(Gt),Nt=(1<<It)-1,Vt=fflate_module_hMap(Gt,It,1);for(Dt=0;Dt<Rt;){var Kt,Yt=Vt[fflate_module_bits(h,it,Nt)];if(it+=15&Yt,(Kt=Yt>>>4)<16)kt[Dt++]=Kt;else{var nr=0,rr=0;for(Kt==16?(rr=3+fflate_module_bits(h,it,3),it+=2,nr=kt[Dt-1]):Kt==17?(rr=3+fflate_module_bits(h,it,7),it+=3):Kt==18&&(rr=11+fflate_module_bits(h,it,127),it+=7);rr--;)kt[Dt++]=nr}}var lr=kt.subarray(0,wt),or=kt.subarray(wt);ht=fflate_module_max(lr),_t=fflate_module_max(or),lt=fflate_module_hMap(lr,ht,1),ut=fflate_module_hMap(or,_t,1)}if(it>ft){if(v)throw"unexpected EOF";break}}_&&b(nt+131072);for(var pr=(1<<ht)-1,hr=(1<<_t)-1,ur=it;;ur=it){var cr=(nr=lt[fflate_module_bits16(h,it)&pr])>>>4;if((it+=15&nr)>ft){if(v)throw"unexpected EOF";break}if(!nr)throw"invalid length/literal";if(cr<256)o[nt++]=cr;else{if(cr==256){ur=it,lt=null;break}var br=cr-254;if(cr>264){var fr=fflate_module_fleb[Dt=cr-257];br=fflate_module_bits(h,it,(1<<fr)-1)+fflate_module_fl[Dt],it+=fr}var kr=ut[fflate_module_bits16(h,it)&hr],gr=kr>>>4;if(!kr)throw"invalid distance";if(it+=15&kr,or=fflate_module_fd[gr],gr>3&&(fr=fflate_module_fdeb[gr],or+=fflate_module_bits16(h,it)&(1<<fr)-1,it+=fr),it>ft){if(v)throw"unexpected EOF";break}_&&b(nt+131072);for(var tr=nt+br;nt<tr;nt+=4)o[nt]=o[nt-or],o[nt+1]=o[nt+1-or],o[nt+2]=o[nt+2-or],o[nt+3]=o[nt+3-or];nt=tr}}c.l=lt,c.p=ur,c.b=nt,lt&&(tt=1,c.m=ht,c.d=ut,c.n=_t)}while(!tt);return nt==o.length?o:fflate_module_slc(o,0,nt)},fflate_module_wbits=function(h,o,c){c<<=7&o;var d=o/8|0;h[d]|=c,h[d+1]|=c>>>8},fflate_module_wbits16=function(h,o,c){c<<=7&o;var d=o/8|0;h[d]|=c,h[d+1]|=c>>>8,h[d+2]|=c>>>16},fflate_module_hTree=function(h,o){for(var c=[],d=0;d<h.length;++d)h[d]&&c.push({s:d,f:h[d]});var _=c.length,v=c.slice();if(!_)return[fflate_module_et,0];if(_==1){var b=new fflate_module_u8(c[0].s+1);return b[c[0].s]=1,[b,1]}c.sort(function(kt,Gt){return kt.f-Gt.f}),c.push({s:-1,f:25001});var tt=c[0],it=c[1],nt=0,lt=1,ut=2;for(c[0]={s:-1,f:tt.f+it.f,l:tt,r:it};lt!=_-1;)tt=c[c[nt].f<c[ut].f?nt++:ut++],it=c[nt!=lt&&c[nt].f<c[ut].f?nt++:ut++],c[lt++]={s:-1,f:tt.f+it.f,l:tt,r:it};var ht=v[0].s;for(d=1;d<_;++d)v[d].s>ht&&(ht=v[d].s);var _t=new fflate_module_u16(ht+1),ft=fflate_module_ln(c[lt-1],_t,0);if(ft>o){d=0;var bt=0,xt=ft-o,St=1<<xt;for(v.sort(function(kt,Gt){return _t[Gt.s]-_t[kt.s]||kt.f-Gt.f});d<_;++d){var wt=v[d].s;if(!(_t[wt]>o))break;bt+=St-(1<<ft-_t[wt]),_t[wt]=o}for(bt>>>=xt;bt>0;){var Pt=v[d].s;_t[Pt]<o?bt-=1<<o-_t[Pt]++-1:++d}for(;d>=0&&bt;--d){var Rt=v[d].s;_t[Rt]==o&&(--_t[Rt],++bt)}ft=o}return[new fflate_module_u8(_t),ft]},fflate_module_ln=function(h,o,c){return h.s==-1?Math.max(fflate_module_ln(h.l,o,c+1),fflate_module_ln(h.r,o,c+1)):o[h.s]=c},fflate_module_lc=function(h){for(var o=h.length;o&&!h[--o];);for(var c=new fflate_module_u16(++o),d=0,_=h[0],v=1,b=function(it){c[d++]=it},tt=1;tt<=o;++tt)if(h[tt]==_&&tt!=o)++v;else{if(!_&&v>2){for(;v>138;v-=138)b(32754);v>2&&(b(v>10?v-11<<5|28690:v-3<<5|12305),v=0)}else if(v>3){for(b(_),--v;v>6;v-=6)b(8304);v>2&&(b(v-3<<5|8208),v=0)}for(;v--;)b(_);v=1,_=h[tt]}return[c.subarray(0,d),o]},fflate_module_clen=function(h,o){for(var c=0,d=0;d<o.length;++d)c+=h[d]*o[d];return c},fflate_module_wfblk=function(h,o,c){var d=c.length,_=fflate_module_shft(o+2);h[_]=255&d,h[_+1]=d>>>8,h[_+2]=255^h[_],h[_+3]=255^h[_+1];for(var v=0;v<d;++v)h[_+v+4]=c[v];return 8*(_+4+d)},fflate_module_wblk=function(h,o,c,d,_,v,b,tt,it,nt,lt){fflate_module_wbits(o,lt++,c),++_[256];for(var ut=fflate_module_hTree(_,15),ht=ut[0],_t=ut[1],ft=fflate_module_hTree(v,15),bt=ft[0],xt=ft[1],St=fflate_module_lc(ht),wt=St[0],Pt=St[1],Rt=fflate_module_lc(bt),kt=Rt[0],Gt=Rt[1],Dt=new fflate_module_u16(19),It=0;It<wt.length;++It)Dt[31&wt[It]]++;for(It=0;It<kt.length;++It)Dt[31&kt[It]]++;for(var Nt=fflate_module_hTree(Dt,7),Vt=Nt[0],Kt=Nt[1],Yt=19;Yt>4&&!Vt[fflate_module_clim[Yt-1]];--Yt);var nr,rr,lr,or,pr=nt+5<<3,hr=fflate_module_clen(_,fflate_module_flt)+fflate_module_clen(v,fflate_module_fdt)+b,ur=fflate_module_clen(_,ht)+fflate_module_clen(v,bt)+b+14+3*Yt+fflate_module_clen(Dt,Vt)+(2*Dt[16]+3*Dt[17]+7*Dt[18]);if(pr<=hr&&pr<=ur)return fflate_module_wfblk(o,lt,h.subarray(it,it+nt));if(fflate_module_wbits(o,lt,1+(ur<hr)),lt+=2,ur<hr){nr=fflate_module_hMap(ht,_t,0),rr=ht,lr=fflate_module_hMap(bt,xt,0),or=bt;var cr=fflate_module_hMap(Vt,Kt,0);for(fflate_module_wbits(o,lt,Pt-257),fflate_module_wbits(o,lt+5,Gt-1),fflate_module_wbits(o,lt+10,Yt-4),lt+=14,It=0;It<Yt;++It)fflate_module_wbits(o,lt+3*It,Vt[fflate_module_clim[It]]);lt+=3*Yt;for(var br=[wt,kt],fr=0;fr<2;++fr){var kr=br[fr];for(It=0;It<kr.length;++It){var gr=31&kr[It];fflate_module_wbits(o,lt,cr[gr]),lt+=Vt[gr],gr>15&&(fflate_module_wbits(o,lt,kr[It]>>>5&127),lt+=kr[It]>>>12)}}}else nr=fflate_module_flm,rr=fflate_module_flt,lr=fflate_module_fdm,or=fflate_module_fdt;for(It=0;It<tt;++It)if(d[It]>255){gr=d[It]>>>18&31,fflate_module_wbits16(o,lt,nr[gr+257]),lt+=rr[gr+257],gr>7&&(fflate_module_wbits(o,lt,d[It]>>>23&31),lt+=fflate_module_fleb[gr]);var tr=31&d[It];fflate_module_wbits16(o,lt,lr[tr]),lt+=or[tr],tr>3&&(fflate_module_wbits16(o,lt,d[It]>>>5&8191),lt+=fflate_module_fdeb[tr])}else fflate_module_wbits16(o,lt,nr[d[It]]),lt+=rr[d[It]];return fflate_module_wbits16(o,lt,nr[256]),lt+rr[256]},fflate_module_deo=new fflate_module_u32([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),fflate_module_et=new fflate_module_u8(0),fflate_module_dflt=function(h,o,c,d,_,v){var b=h.length,tt=new fflate_module_u8(d+b+5*(1+Math.ceil(b/7e3))+_),it=tt.subarray(d,tt.length-_),nt=0;if(!o||b<8)for(var lt=0;lt<=b;lt+=65535){var ut=lt+65535;ut<b?nt=fflate_module_wfblk(it,nt,h.subarray(lt,ut)):(it[lt]=v,nt=fflate_module_wfblk(it,nt,h.subarray(lt,b)))}else{for(var ht=fflate_module_deo[o-1],_t=ht>>>13,ft=8191&ht,bt=(1<<c)-1,xt=new fflate_module_u16(32768),St=new fflate_module_u16(bt+1),wt=Math.ceil(c/3),Pt=2*wt,Rt=function(vn){return(h[vn]^h[vn+1]<<wt^h[vn+2]<<Pt)&bt},kt=new fflate_module_u32(25e3),Gt=new fflate_module_u16(288),Dt=new fflate_module_u16(32),It=0,Nt=0,Vt=(lt=0,0),Kt=0,Yt=0;lt<b;++lt){var nr=Rt(lt),rr=32767&lt,lr=St[nr];if(xt[rr]=lr,St[nr]=rr,Kt<=lt){var or=b-lt;if((It>7e3||Vt>24576)&&or>423){nt=fflate_module_wblk(h,it,0,kt,Gt,Dt,Nt,Vt,Yt,lt-Yt,nt),Vt=It=Nt=0,Yt=lt;for(var pr=0;pr<286;++pr)Gt[pr]=0;for(pr=0;pr<30;++pr)Dt[pr]=0}var hr=2,ur=0,cr=ft,br=rr-lr&32767;if(or>2&&nr==Rt(lt-br))for(var fr=Math.min(_t,or)-1,kr=Math.min(32767,lt),gr=Math.min(258,or);br<=kr&&--cr&&rr!=lr;){if(h[lt+hr]==h[lt+hr-br]){for(var tr=0;tr<gr&&h[lt+tr]==h[lt+tr-br];++tr);if(tr>hr){if(hr=tr,ur=br,tr>fr)break;var dr=Math.min(br,tr-2),Ir=0;for(pr=0;pr<dr;++pr){var Xr=lt-br+pr+32768&32767,Jr=Xr-xt[Xr]+32768&32767;Jr>Ir&&(Ir=Jr,lr=Xr)}}}br+=(rr=lr)-(lr=xt[rr])+32768&32767}if(ur){kt[Vt++]=268435456|fflate_module_revfl[hr]<<18|fflate_module_revfd[ur];var on=31&fflate_module_revfl[hr],Pn=31&fflate_module_revfd[ur];Nt+=fflate_module_fleb[on]+fflate_module_fdeb[Pn],++Gt[257+on],++Dt[Pn],Kt=lt+hr,++It}else kt[Vt++]=h[lt],++Gt[h[lt]]}}nt=fflate_module_wblk(h,it,v,kt,Gt,Dt,Nt,Vt,Yt,lt-Yt,nt)}return fflate_module_slc(tt,0,d+fflate_module_shft(nt)+_)},fflate_module_adler=function(){var h=1,o=0;return{p:function(c){for(var d=h,_=o,v=c.length,b=0;b!=v;){for(var tt=Math.min(b+2655,v);b<tt;++b)_+=d+=c[b];d=(65535&d)+15*(d>>16),_=(65535&_)+15*(_>>16)}h=d,o=_},d:function(){return(255&(h%=65521))<<24|h>>>8<<16|(255&(o%=65521))<<8|o>>>8}}},fflate_module_dopt=function(h,o,c,d,_){return fflate_module_dflt(h,o.level==null?6:o.level,o.mem==null?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(h.length)))):12+o.mem,c,d,!_)},fflate_module_wbytes=function(h,o,c){for(;c;++o)h[o]=c,c>>>=8},fflate_module_zlh=function(h,o){var c=o.level,d=c==0?0:c<6?1:c==9?3:2;h[0]=120,h[1]=d<<6|(d?32-2*d:1)},fflate_module_zlv=function(h){if((15&h[0])!=8||h[0]>>>4>7||(h[0]<<8|h[1])%31)throw"invalid zlib data";if(32&h[1])throw"invalid zlib data: preset dictionaries not supported"};function fflate_module_zlibSync(h,o){o||(o={});var c=fflate_module_adler();c.p(h);var d=fflate_module_dopt(h,o,2,4);return fflate_module_zlh(d,o),fflate_module_wbytes(d,d.length-4,c.d()),d}function fflate_module_unzlibSync(h,o){return fflate_module_inflt((fflate_module_zlv(h),h.subarray(2,-4)),o)}typeof TextEncoder<"u"&&new TextEncoder;var fflate_module_td=typeof TextDecoder<"u"&&new TextDecoder,fflate_module_tds=0;try{fflate_module_td.decode(fflate_module_et,{stream:!0}),fflate_module_tds=1}catch(h){}function findSpan(h,o,c){const d=c.length-h-1;if(o>=c[d])return d-1;if(o<=c[h])return h;let _=h,v=d,b=Math.floor((_+v)/2);for(;o<c[b]||o>=c[b+1];)o<c[b]?v=b:_=b,b=Math.floor((_+v)/2);return b}function calcBasisFunctions(h,o,c,d){const _=[],v=[],b=[];_[0]=1;for(let tt=1;tt<=c;++tt){v[tt]=o-d[h+1-tt],b[tt]=d[h+tt]-o;let it=0;for(let nt=0;nt<tt;++nt){const lt=b[nt+1],ut=v[tt-nt],ht=_[nt]/(lt+ut);_[nt]=it+lt*ht,it=ut*ht}_[tt]=it}return _}function calcBSplinePoint(h,o,c,d){const _=findSpan(h,d,o),v=calcBasisFunctions(_,d,h,o),b=new three_module.IUQ(0,0,0,0);for(let tt=0;tt<=h;++tt){const it=c[_-h+tt],nt=v[tt],lt=it.w*nt;b.x+=it.x*lt,b.y+=it.y*lt,b.z+=it.z*lt,b.w+=it.w*nt}return b}function calcBasisFunctionDerivatives(h,o,c,d,_){const v=[];for(let ut=0;ut<=c;++ut)v[ut]=0;const b=[];for(let ut=0;ut<=d;++ut)b[ut]=v.slice(0);const tt=[];for(let ut=0;ut<=c;++ut)tt[ut]=v.slice(0);tt[0][0]=1;const it=v.slice(0),nt=v.slice(0);for(let ut=1;ut<=c;++ut){it[ut]=o-_[h+1-ut],nt[ut]=_[h+ut]-o;let ht=0;for(let _t=0;_t<ut;++_t){const ft=nt[_t+1],bt=it[ut-_t];tt[ut][_t]=ft+bt;const xt=tt[_t][ut-1]/tt[ut][_t];tt[_t][ut]=ht+ft*xt,ht=bt*xt}tt[ut][ut]=ht}for(let ut=0;ut<=c;++ut)b[0][ut]=tt[ut][c];for(let ut=0;ut<=c;++ut){let ht=0,_t=1;const ft=[];for(let bt=0;bt<=c;++bt)ft[bt]=v.slice(0);ft[0][0]=1;for(let bt=1;bt<=d;++bt){let xt=0;const St=ut-bt,wt=c-bt;ut>=bt&&(ft[_t][0]=ft[ht][0]/tt[wt+1][St],xt=ft[_t][0]*tt[St][wt]);const Pt=ut-1<=wt?bt-1:c-ut;for(let kt=St>=-1?1:-St;kt<=Pt;++kt)ft[_t][kt]=(ft[ht][kt]-ft[ht][kt-1])/tt[wt+1][St+kt],xt+=ft[_t][kt]*tt[St+kt][wt];ut<=wt&&(ft[_t][bt]=-ft[ht][bt-1]/tt[wt+1][ut],xt+=ft[_t][bt]*tt[ut][wt]),b[bt][ut]=xt;const Rt=ht;ht=_t,_t=Rt}}let lt=c;for(let ut=1;ut<=d;++ut){for(let ht=0;ht<=c;++ht)b[ut][ht]*=lt;lt*=c-ut}return b}function calcBSplineDerivatives(h,o,c,d,_){const v=_<h?_:h,b=[],tt=findSpan(h,d,o),it=calcBasisFunctionDerivatives(tt,d,h,v,o),nt=[];for(let lt=0;lt<c.length;++lt){const ut=c[lt].clone(),ht=ut.w;ut.x*=ht,ut.y*=ht,ut.z*=ht,nt[lt]=ut}for(let lt=0;lt<=v;++lt){const ut=nt[tt-h].clone().multiplyScalar(it[lt][0]);for(let ht=1;ht<=h;++ht)ut.add(nt[tt-h+ht].clone().multiplyScalar(it[lt][ht]));b[lt]=ut}for(let lt=v+1;lt<=_+1;++lt)b[lt]=new three_module.IUQ(0,0,0);return b}function calcKoverI(h,o){let c=1;for(let _=2;_<=h;++_)c*=_;let d=1;for(let _=2;_<=o;++_)d*=_;for(let _=2;_<=h-o;++_)d*=_;return c/d}function calcRationalCurveDerivatives(h){const o=h.length,c=[],d=[];for(let v=0;v<o;++v){const b=h[v];c[v]=new three_module.Pq0(b.x,b.y,b.z),d[v]=b.w}const _=[];for(let v=0;v<o;++v){const b=c[v].clone();for(let tt=1;tt<=v;++tt)b.sub(_[v-tt].clone().multiplyScalar(calcKoverI(v,tt)*d[tt]));_[v]=b.divideScalar(d[0])}return _}function calcNURBSDerivatives(h,o,c,d,_){return calcRationalCurveDerivatives(calcBSplineDerivatives(h,o,c,d,_))}class NURBSCurve extends three_module.Ipv{constructor(o,c,d,_,v){super(),this.degree=o,this.knots=c,this.controlPoints=[],this.startKnot=_||0,this.endKnot=v||this.knots.length-1;for(let b=0;b<d.length;++b){const tt=d[b];this.controlPoints[b]=new three_module.IUQ(tt.x,tt.y,tt.z,tt.w)}}getPoint(o,c=new three_module.Pq0){const d=c,_=this.knots[this.startKnot]+o*(this.knots[this.endKnot]-this.knots[this.startKnot]),v=calcBSplinePoint(this.degree,this.knots,this.controlPoints,_);return v.w!==1&&v.divideScalar(v.w),d.set(v.x,v.y,v.z)}getTangent(o,c=new three_module.Pq0){const d=c,_=this.knots[0]+o*(this.knots[this.knots.length-1]-this.knots[0]),v=calcNURBSDerivatives(this.degree,this.knots,this.controlPoints,_,1);return d.copy(v[1]).normalize(),d}}let fbxTree,connections,sceneGraph;class FBXLoader extends three_module.aHM{constructor(o){super(o)}load(o,c,d,_){const v=this,b=v.path===""?three_module.r6x.extractUrlBase(o):v.path,tt=new three_module.Y9S(this.manager);tt.setPath(v.path),tt.setResponseType("arraybuffer"),tt.setRequestHeader(v.requestHeader),tt.setWithCredentials(v.withCredentials),tt.load(o,function(it){try{c(v.parse(it,b))}catch(nt){_?_(nt):console.error(nt),v.manager.itemError(o)}},d,_)}parse(o,c){if(isFbxFormatBinary(o))fbxTree=new BinaryParser().parse(o);else{const v=convertArrayBufferToString(o);if(!isFbxFormatASCII(v))throw new Error("THREE.FBXLoader: Unknown format.");if(getFbxVersion(v)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+getFbxVersion(v));fbxTree=new TextParser().parse(v)}const d=new three_module.Tap(this.manager).setPath(this.resourcePath||c).setCrossOrigin(this.crossOrigin),_=new FBXTreeParser(d,this.manager).parse(fbxTree);return fbxTree=null,connections=null,sceneGraph=null,_}}class FBXTreeParser{constructor(o,c){this.textureLoader=o,this.manager=c}parse(){connections=this.parseConnections();const o=this.parseImages(),c=this.parseTextures(o),d=this.parseMaterials(c),_=this.parseDeformers(),v=new GeometryParser().parse(_);return this.parseScene(_,v,d),sceneGraph}parseConnections(){const o=new Map;return"Connections"in fbxTree&&fbxTree.Connections.connections.forEach(function(c){const d=c[0],_=c[1],v=c[2];o.has(d)||o.set(d,{parents:[],children:[]});const b={ID:_,relationship:v};o.get(d).parents.push(b),o.has(_)||o.set(_,{parents:[],children:[]});const tt={ID:d,relationship:v};o.get(_).children.push(tt)}),o}parseImages(){const o={},c={};if("Video"in fbxTree.Objects){const d=fbxTree.Objects.Video;for(const _ in d){const v=d[_];if(o[parseInt(_)]=v.RelativeFilename||v.Filename,"Content"in v){const b=v.Content instanceof ArrayBuffer&&v.Content.byteLength>0,tt=typeof v.Content=="string"&&v.Content!=="";if(b||tt){const it=this.parseImage(d[_]);c[v.RelativeFilename||v.Filename]=it}}}}for(const d in o){const _=o[d];c[_]!==void 0?o[d]=c[_]:o[d]=o[d].split("\\").pop()}return o}parseImage(o){const c=o.Content,d=o.RelativeFilename||o.Filename,_=d.slice(d.lastIndexOf(".")+1).toLowerCase();let v;switch(_){case"bmp":v="image/bmp";break;case"jpg":case"jpeg":v="image/jpeg";break;case"png":v="image/png";break;case"tif":v="image/tiff";break;case"tga":this.manager.getHandler(".tga")===null&&console.warn("FBXLoader: TGA loader not found, skipping ",d),v="image/tga";break;default:return void console.warn('FBXLoader: Image type "'+_+'" is not supported.')}if(typeof c=="string")return"data:"+v+";base64,"+c;{const b=new Uint8Array(c);return window.URL.createObjectURL(new Blob([b],{type:v}))}}parseTextures(o){const c=new Map;if("Texture"in fbxTree.Objects){const d=fbxTree.Objects.Texture;for(const _ in d){const v=this.parseTexture(d[_],o);c.set(parseInt(_),v)}}return c}parseTexture(o,c){const d=this.loadTexture(o,c);d.ID=o.id,d.name=o.attrName;const _=o.WrapModeU,v=o.WrapModeV,b=_!==void 0?_.value:0,tt=v!==void 0?v.value:0;if(d.wrapS=b===0?three_module.GJx:three_module.ghU,d.wrapT=tt===0?three_module.GJx:three_module.ghU,"Scaling"in o){const it=o.Scaling.value;d.repeat.x=it[0],d.repeat.y=it[1]}if("Translation"in o){const it=o.Translation.value;d.offset.x=it[0],d.offset.y=it[1]}return d}loadTexture(o,c){let d;const _=this.textureLoader.path,v=connections.get(o.id).children;let b;v!==void 0&&v.length>0&&c[v[0].ID]!==void 0&&(d=c[v[0].ID],d.indexOf("blob:")!==0&&d.indexOf("data:")!==0||this.textureLoader.setPath(void 0));const tt=o.FileName.slice(-3).toLowerCase();if(tt==="tga"){const it=this.manager.getHandler(".tga");it===null?(console.warn("FBXLoader: TGA loader not found, creating placeholder texture for",o.RelativeFilename),b=new three_module.gPd):(it.setPath(this.textureLoader.path),b=it.load(d))}else tt==="psd"?(console.warn("FBXLoader: PSD textures are not supported, creating placeholder texture for",o.RelativeFilename),b=new three_module.gPd):b=this.textureLoader.load(d);return this.textureLoader.setPath(_),b}parseMaterials(o){const c=new Map;if("Material"in fbxTree.Objects){const d=fbxTree.Objects.Material;for(const _ in d){const v=this.parseMaterial(d[_],o);v!==null&&c.set(parseInt(_),v)}}return c}parseMaterial(o,c){const d=o.id,_=o.attrName;let v=o.ShadingModel;if(typeof v=="object"&&(v=v.value),!connections.has(d))return null;const b=this.parseParameters(o,c,d);let tt;switch(v.toLowerCase()){case"phong":tt=new three_module.tXL;break;case"lambert":tt=new three_module.G_z;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',v),tt=new three_module.tXL}return tt.setValues(b),tt.name=_,tt}parseParameters(o,c,d){const _={};o.BumpFactor&&(_.bumpScale=o.BumpFactor.value),o.Diffuse?_.color=new three_module.Q1f().fromArray(o.Diffuse.value).convertSRGBToLinear():!o.DiffuseColor||o.DiffuseColor.type!=="Color"&&o.DiffuseColor.type!=="ColorRGB"||(_.color=new three_module.Q1f().fromArray(o.DiffuseColor.value).convertSRGBToLinear()),o.DisplacementFactor&&(_.displacementScale=o.DisplacementFactor.value),o.Emissive?_.emissive=new three_module.Q1f().fromArray(o.Emissive.value).convertSRGBToLinear():!o.EmissiveColor||o.EmissiveColor.type!=="Color"&&o.EmissiveColor.type!=="ColorRGB"||(_.emissive=new three_module.Q1f().fromArray(o.EmissiveColor.value).convertSRGBToLinear()),o.EmissiveFactor&&(_.emissiveIntensity=parseFloat(o.EmissiveFactor.value)),o.Opacity&&(_.opacity=parseFloat(o.Opacity.value)),_.opacity<1&&(_.transparent=!0),o.ReflectionFactor&&(_.reflectivity=o.ReflectionFactor.value),o.Shininess&&(_.shininess=o.Shininess.value),o.Specular?_.specular=new three_module.Q1f().fromArray(o.Specular.value).convertSRGBToLinear():o.SpecularColor&&o.SpecularColor.type==="Color"&&(_.specular=new three_module.Q1f().fromArray(o.SpecularColor.value).convertSRGBToLinear());const v=this;return connections.get(d).children.forEach(function(b){const tt=b.relationship;switch(tt){case"Bump":_.bumpMap=v.getTexture(c,b.ID);break;case"Maya|TEX_ao_map":_.aoMap=v.getTexture(c,b.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":_.map=v.getTexture(c,b.ID),_.map!==void 0&&(_.map.colorSpace=three_module.er$);break;case"DisplacementColor":_.displacementMap=v.getTexture(c,b.ID);break;case"EmissiveColor":_.emissiveMap=v.getTexture(c,b.ID),_.emissiveMap!==void 0&&(_.emissiveMap.colorSpace=three_module.er$);break;case"NormalMap":case"Maya|TEX_normal_map":_.normalMap=v.getTexture(c,b.ID);break;case"ReflectionColor":_.envMap=v.getTexture(c,b.ID),_.envMap!==void 0&&(_.envMap.mapping=three_module.wfO,_.envMap.colorSpace=three_module.er$);break;case"SpecularColor":_.specularMap=v.getTexture(c,b.ID),_.specularMap!==void 0&&(_.specularMap.colorSpace=three_module.er$);break;case"TransparentColor":case"TransparencyFactor":_.alphaMap=v.getTexture(c,b.ID),_.transparent=!0;break;default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",tt)}}),_}getTexture(o,c){return"LayeredTexture"in fbxTree.Objects&&c in fbxTree.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),c=connections.get(c).children[0].ID),o.get(c)}parseDeformers(){const o={},c={};if("Deformer"in fbxTree.Objects){const d=fbxTree.Objects.Deformer;for(const _ in d){const v=d[_],b=connections.get(parseInt(_));if(v.attrType==="Skin"){const tt=this.parseSkeleton(b,d);tt.ID=_,b.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),tt.geometryID=b.parents[0].ID,o[_]=tt}else if(v.attrType==="BlendShape"){const tt={id:_};tt.rawTargets=this.parseMorphTargets(b,d),tt.id=_,b.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),c[_]=tt}}}return{skeletons:o,morphTargets:c}}parseSkeleton(o,c){const d=[];return o.children.forEach(function(_){const v=c[_.ID];if(v.attrType!=="Cluster")return;const b={ID:_.ID,indices:[],weights:[],transformLink:new three_module.kn4().fromArray(v.TransformLink.a)};"Indexes"in v&&(b.indices=v.Indexes.a,b.weights=v.Weights.a),d.push(b)}),{rawBones:d,bones:[]}}parseMorphTargets(o,c){const d=[];for(let _=0;_<o.children.length;_++){const v=o.children[_],b=c[v.ID],tt={name:b.attrName,initialWeight:b.DeformPercent,id:b.id,fullWeights:b.FullWeights.a};if(b.attrType!=="BlendShapeChannel")return;tt.geoID=connections.get(parseInt(v.ID)).children.filter(function(it){return it.relationship===void 0})[0].ID,d.push(tt)}return d}parseScene(o,c,d){sceneGraph=new three_module.YJl;const _=this.parseModels(o.skeletons,c,d),v=fbxTree.Objects.Model,b=this;_.forEach(function(it){const nt=v[it.ID];b.setLookAtProperties(it,nt),connections.get(it.ID).parents.forEach(function(lt){const ut=_.get(lt.ID);ut!==void 0&&ut.add(it)}),it.parent===null&&sceneGraph.add(it)}),this.bindSkeleton(o.skeletons,c,_),this.createAmbientLight(),sceneGraph.traverse(function(it){if(it.userData.transformData){it.parent&&(it.userData.transformData.parentMatrix=it.parent.matrix,it.userData.transformData.parentMatrixWorld=it.parent.matrixWorld);const nt=generateTransform(it.userData.transformData);it.applyMatrix4(nt),it.updateWorldMatrix()}});const tt=new AnimationParser().parse();sceneGraph.children.length===1&&sceneGraph.children[0].isGroup&&(sceneGraph.children[0].animations=tt,sceneGraph=sceneGraph.children[0]),sceneGraph.animations=tt}parseModels(o,c,d){const _=new Map,v=fbxTree.Objects.Model;for(const b in v){const tt=parseInt(b),it=v[b],nt=connections.get(tt);let lt=this.buildSkeleton(nt,o,tt,it.attrName);if(!lt){switch(it.attrType){case"Camera":lt=this.createCamera(nt);break;case"Light":lt=this.createLight(nt);break;case"Mesh":lt=this.createMesh(nt,c,d);break;case"NurbsCurve":lt=this.createCurve(nt,c);break;case"LimbNode":case"Root":lt=new three_module.$Kf;break;default:lt=new three_module.YJl}lt.name=it.attrName?three_module.Nwf.sanitizeNodeName(it.attrName):"",lt.userData.originalName=it.attrName,lt.ID=tt}this.getTransformData(lt,it),_.set(tt,lt)}return _}buildSkeleton(o,c,d,_){let v=null;return o.parents.forEach(function(b){for(const tt in c){const it=c[tt];it.rawBones.forEach(function(nt,lt){if(nt.ID===b.ID){const ut=v;v=new three_module.$Kf,v.matrixWorld.copy(nt.transformLink),v.name=_?three_module.Nwf.sanitizeNodeName(_):"",v.userData.originalName=_,v.ID=d,it.bones[lt]=v,ut!==null&&v.add(ut)}})}}),v}createCamera(o){let c,d;if(o.children.forEach(function(_){const v=fbxTree.Objects.NodeAttribute[_.ID];v!==void 0&&(d=v)}),d===void 0)c=new three_module.B69;else{let _=0;d.CameraProjectionType!==void 0&&d.CameraProjectionType.value===1&&(_=1);let v=1;d.NearPlane!==void 0&&(v=d.NearPlane.value/1e3);let b=1e3;d.FarPlane!==void 0&&(b=d.FarPlane.value/1e3);let tt=window.innerWidth,it=window.innerHeight;d.AspectWidth!==void 0&&d.AspectHeight!==void 0&&(tt=d.AspectWidth.value,it=d.AspectHeight.value);const nt=tt/it;let lt=45;d.FieldOfView!==void 0&&(lt=d.FieldOfView.value);const ut=d.FocalLength?d.FocalLength.value:null;switch(_){case 0:c=new three_module.ubm(lt,nt,v,b),ut!==null&&c.setFocalLength(ut);break;case 1:c=new three_module.qUd(-tt/2,tt/2,it/2,-it/2,v,b);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+_+"."),c=new three_module.B69}}return c}createLight(o){let c,d;if(o.children.forEach(function(_){const v=fbxTree.Objects.NodeAttribute[_.ID];v!==void 0&&(d=v)}),d===void 0)c=new three_module.B69;else{let _;_=d.LightType===void 0?0:d.LightType.value;let v=16777215;d.Color!==void 0&&(v=new three_module.Q1f().fromArray(d.Color.value).convertSRGBToLinear());let b=d.Intensity===void 0?1:d.Intensity.value/100;d.CastLightOnObject!==void 0&&d.CastLightOnObject.value===0&&(b=0);let tt=0;d.FarAttenuationEnd!==void 0&&(tt=d.EnableFarAttenuation!==void 0&&d.EnableFarAttenuation.value===0?0:d.FarAttenuationEnd.value);const it=1;switch(_){case 0:c=new three_module.HiM(v,b,tt,it);break;case 1:c=new three_module.ZyN(v,b);break;case 2:let nt=Math.PI/3;d.InnerAngle!==void 0&&(nt=three_module.cj9.degToRad(d.InnerAngle.value));let lt=0;d.OuterAngle!==void 0&&(lt=three_module.cj9.degToRad(d.OuterAngle.value),lt=Math.max(lt,1)),c=new three_module.nCl(v,b,tt,nt,lt,it);break;default:console.warn("THREE.FBXLoader: Unknown light type "+d.LightType.value+", defaulting to a PointLight."),c=new three_module.HiM(v,b)}d.CastShadows!==void 0&&d.CastShadows.value===1&&(c.castShadow=!0)}return c}createMesh(o,c,d){let _,v=null,b=null;const tt=[];return o.children.forEach(function(it){c.has(it.ID)&&(v=c.get(it.ID)),d.has(it.ID)&&tt.push(d.get(it.ID))}),tt.length>1?b=tt:tt.length>0?b=tt[0]:(b=new three_module.tXL({name:three_module.aHM.DEFAULT_MATERIAL_NAME,color:13421772}),tt.push(b)),"color"in v.attributes&&tt.forEach(function(it){it.vertexColors=!0}),v.FBX_Deformer?(_=new three_module.I46(v,b),_.normalizeSkinWeights()):_=new three_module.eaF(v,b),_}createCurve(o,c){const d=o.children.reduce(function(v,b){return c.has(b.ID)&&(v=c.get(b.ID)),v},null),_=new three_module.mrM({name:three_module.aHM.DEFAULT_MATERIAL_NAME,color:3342591,linewidth:1});return new three_module.N1A(d,_)}getTransformData(o,c){const d={};"InheritType"in c&&(d.inheritType=parseInt(c.InheritType.value)),d.eulerOrder="RotationOrder"in c?getEulerOrder(c.RotationOrder.value):"ZYX","Lcl_Translation"in c&&(d.translation=c.Lcl_Translation.value),"PreRotation"in c&&(d.preRotation=c.PreRotation.value),"Lcl_Rotation"in c&&(d.rotation=c.Lcl_Rotation.value),"PostRotation"in c&&(d.postRotation=c.PostRotation.value),"Lcl_Scaling"in c&&(d.scale=c.Lcl_Scaling.value),"ScalingOffset"in c&&(d.scalingOffset=c.ScalingOffset.value),"ScalingPivot"in c&&(d.scalingPivot=c.ScalingPivot.value),"RotationOffset"in c&&(d.rotationOffset=c.RotationOffset.value),"RotationPivot"in c&&(d.rotationPivot=c.RotationPivot.value),o.userData.transformData=d}setLookAtProperties(o,c){"LookAtProperty"in c&&connections.get(o.ID).children.forEach(function(d){if(d.relationship==="LookAtProperty"){const _=fbxTree.Objects.Model[d.ID];if("Lcl_Translation"in _){const v=_.Lcl_Translation.value;o.target!==void 0?(o.target.position.fromArray(v),sceneGraph.add(o.target)):o.lookAt(new three_module.Pq0().fromArray(v))}}})}bindSkeleton(o,c,d){const _=this.parsePoseNodes();for(const v in o){const b=o[v];connections.get(parseInt(b.ID)).parents.forEach(function(tt){if(c.has(tt.ID)){const it=tt.ID;connections.get(it).parents.forEach(function(nt){d.has(nt.ID)&&d.get(nt.ID).bind(new three_module.EAD(b.bones),_[nt.ID])})}})}}parsePoseNodes(){const o={};if("Pose"in fbxTree.Objects){const c=fbxTree.Objects.Pose;for(const d in c)if(c[d].attrType==="BindPose"&&c[d].NbPoseNodes>0){const _=c[d].PoseNode;Array.isArray(_)?_.forEach(function(v){o[v.Node]=new three_module.kn4().fromArray(v.Matrix.a)}):o[_.Node]=new three_module.kn4().fromArray(_.Matrix.a)}}return o}createAmbientLight(){if("GlobalSettings"in fbxTree&&"AmbientColor"in fbxTree.GlobalSettings){const o=fbxTree.GlobalSettings.AmbientColor.value,c=o[0],d=o[1],_=o[2];if(c!==0||d!==0||_!==0){const v=new three_module.Q1f(c,d,_).convertSRGBToLinear();sceneGraph.add(new three_module.$p8(v,1))}}}}class GeometryParser{constructor(){this.negativeMaterialIndices=!1}parse(o){const c=new Map;if("Geometry"in fbxTree.Objects){const d=fbxTree.Objects.Geometry;for(const _ in d){const v=connections.get(parseInt(_)),b=this.parseGeometry(v,d[_],o);c.set(parseInt(_),b)}}return this.negativeMaterialIndices===!0&&console.warn("THREE.FBXLoader: The FBX file contains invalid (negative) material indices. The asset might not render as expected."),c}parseGeometry(o,c,d){switch(c.attrType){case"Mesh":return this.parseMeshGeometry(o,c,d);case"NurbsCurve":return this.parseNurbsGeometry(c)}}parseMeshGeometry(o,c,d){const _=d.skeletons,v=[],b=o.parents.map(function(ut){return fbxTree.Objects.Model[ut.ID]});if(b.length===0)return;const tt=o.children.reduce(function(ut,ht){return _[ht.ID]!==void 0&&(ut=_[ht.ID]),ut},null);o.children.forEach(function(ut){d.morphTargets[ut.ID]!==void 0&&v.push(d.morphTargets[ut.ID])});const it=b[0],nt={};"RotationOrder"in it&&(nt.eulerOrder=getEulerOrder(it.RotationOrder.value)),"InheritType"in it&&(nt.inheritType=parseInt(it.InheritType.value)),"GeometricTranslation"in it&&(nt.translation=it.GeometricTranslation.value),"GeometricRotation"in it&&(nt.rotation=it.GeometricRotation.value),"GeometricScaling"in it&&(nt.scale=it.GeometricScaling.value);const lt=generateTransform(nt);return this.genGeometry(c,tt,v,lt)}genGeometry(o,c,d,_){const v=new three_module.LoY;o.attrName&&(v.name=o.attrName);const b=this.parseGeoNode(o,c),tt=this.genBuffers(b),it=new three_module.qtW(tt.vertex,3);if(it.applyMatrix4(_),v.setAttribute("position",it),tt.colors.length>0&&v.setAttribute("color",new three_module.qtW(tt.colors,3)),c&&(v.setAttribute("skinIndex",new three_module.A$4(tt.weightsIndices,4)),v.setAttribute("skinWeight",new three_module.qtW(tt.vertexWeights,4)),v.FBX_Deformer=c),tt.normal.length>0){const nt=new three_module.dwI().getNormalMatrix(_),lt=new three_module.qtW(tt.normal,3);lt.applyNormalMatrix(nt),v.setAttribute("normal",lt)}if(tt.uvs.forEach(function(nt,lt){const ut=lt===0?"uv":`uv${lt}`;v.setAttribute(ut,new three_module.qtW(tt.uvs[lt],2))}),b.material&&b.material.mappingType!=="AllSame"){let nt=tt.materialIndex[0],lt=0;if(tt.materialIndex.forEach(function(ut,ht){ut!==nt&&(v.addGroup(lt,ht-lt,nt),nt=ut,lt=ht)}),v.groups.length>0){const ut=v.groups[v.groups.length-1],ht=ut.start+ut.count;ht!==tt.materialIndex.length&&v.addGroup(ht,tt.materialIndex.length-ht,nt)}v.groups.length===0&&v.addGroup(0,tt.materialIndex.length,tt.materialIndex[0])}return this.addMorphTargets(v,o,d,_),v}parseGeoNode(o,c){const d={};if(d.vertexPositions=o.Vertices!==void 0?o.Vertices.a:[],d.vertexIndices=o.PolygonVertexIndex!==void 0?o.PolygonVertexIndex.a:[],o.LayerElementColor&&(d.color=this.parseVertexColors(o.LayerElementColor[0])),o.LayerElementMaterial&&(d.material=this.parseMaterialIndices(o.LayerElementMaterial[0])),o.LayerElementNormal&&(d.normal=this.parseNormals(o.LayerElementNormal[0])),o.LayerElementUV){d.uv=[];let _=0;for(;o.LayerElementUV[_];)o.LayerElementUV[_].UV&&d.uv.push(this.parseUVs(o.LayerElementUV[_])),_++}return d.weightTable={},c!==null&&(d.skeleton=c,c.rawBones.forEach(function(_,v){_.indices.forEach(function(b,tt){d.weightTable[b]===void 0&&(d.weightTable[b]=[]),d.weightTable[b].push({id:v,weight:_.weights[tt]})})})),d}genBuffers(o){const c={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]};let d=0,_=0,v=!1,b=[],tt=[],it=[],nt=[],lt=[],ut=[];const ht=this;return o.vertexIndices.forEach(function(_t,ft){let bt,xt=!1;_t<0&&(_t=~_t,xt=!0);let St=[],wt=[];if(b.push(3*_t,3*_t+1,3*_t+2),o.color){const Pt=getData(ft,d,_t,o.color);it.push(Pt[0],Pt[1],Pt[2])}if(o.skeleton){if(o.weightTable[_t]!==void 0&&o.weightTable[_t].forEach(function(Pt){wt.push(Pt.weight),St.push(Pt.id)}),wt.length>4){v||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),v=!0);const Pt=[0,0,0,0],Rt=[0,0,0,0];wt.forEach(function(kt,Gt){let Dt=kt,It=St[Gt];Rt.forEach(function(Nt,Vt,Kt){if(Dt>Nt){Kt[Vt]=Dt,Dt=Nt;const Yt=Pt[Vt];Pt[Vt]=It,It=Yt}})}),St=Pt,wt=Rt}for(;wt.length<4;)wt.push(0),St.push(0);for(let Pt=0;Pt<4;++Pt)lt.push(wt[Pt]),ut.push(St[Pt])}if(o.normal){const Pt=getData(ft,d,_t,o.normal);tt.push(Pt[0],Pt[1],Pt[2])}o.material&&o.material.mappingType!=="AllSame"&&(bt=getData(ft,d,_t,o.material)[0],bt<0&&(ht.negativeMaterialIndices=!0,bt=0)),o.uv&&o.uv.forEach(function(Pt,Rt){const kt=getData(ft,d,_t,Pt);nt[Rt]===void 0&&(nt[Rt]=[]),nt[Rt].push(kt[0]),nt[Rt].push(kt[1])}),_++,xt&&(_>4&&console.warn("THREE.FBXLoader: Polygons with more than four sides are not supported. Make sure to triangulate the geometry during export."),ht.genFace(c,o,b,bt,tt,it,nt,lt,ut,_),d++,_=0,b=[],tt=[],it=[],nt=[],lt=[],ut=[])}),c}genFace(o,c,d,_,v,b,tt,it,nt,lt){for(let ut=2;ut<lt;ut++)o.vertex.push(c.vertexPositions[d[0]]),o.vertex.push(c.vertexPositions[d[1]]),o.vertex.push(c.vertexPositions[d[2]]),o.vertex.push(c.vertexPositions[d[3*(ut-1)]]),o.vertex.push(c.vertexPositions[d[3*(ut-1)+1]]),o.vertex.push(c.vertexPositions[d[3*(ut-1)+2]]),o.vertex.push(c.vertexPositions[d[3*ut]]),o.vertex.push(c.vertexPositions[d[3*ut+1]]),o.vertex.push(c.vertexPositions[d[3*ut+2]]),c.skeleton&&(o.vertexWeights.push(it[0]),o.vertexWeights.push(it[1]),o.vertexWeights.push(it[2]),o.vertexWeights.push(it[3]),o.vertexWeights.push(it[4*(ut-1)]),o.vertexWeights.push(it[4*(ut-1)+1]),o.vertexWeights.push(it[4*(ut-1)+2]),o.vertexWeights.push(it[4*(ut-1)+3]),o.vertexWeights.push(it[4*ut]),o.vertexWeights.push(it[4*ut+1]),o.vertexWeights.push(it[4*ut+2]),o.vertexWeights.push(it[4*ut+3]),o.weightsIndices.push(nt[0]),o.weightsIndices.push(nt[1]),o.weightsIndices.push(nt[2]),o.weightsIndices.push(nt[3]),o.weightsIndices.push(nt[4*(ut-1)]),o.weightsIndices.push(nt[4*(ut-1)+1]),o.weightsIndices.push(nt[4*(ut-1)+2]),o.weightsIndices.push(nt[4*(ut-1)+3]),o.weightsIndices.push(nt[4*ut]),o.weightsIndices.push(nt[4*ut+1]),o.weightsIndices.push(nt[4*ut+2]),o.weightsIndices.push(nt[4*ut+3])),c.color&&(o.colors.push(b[0]),o.colors.push(b[1]),o.colors.push(b[2]),o.colors.push(b[3*(ut-1)]),o.colors.push(b[3*(ut-1)+1]),o.colors.push(b[3*(ut-1)+2]),o.colors.push(b[3*ut]),o.colors.push(b[3*ut+1]),o.colors.push(b[3*ut+2])),c.material&&c.material.mappingType!=="AllSame"&&(o.materialIndex.push(_),o.materialIndex.push(_),o.materialIndex.push(_)),c.normal&&(o.normal.push(v[0]),o.normal.push(v[1]),o.normal.push(v[2]),o.normal.push(v[3*(ut-1)]),o.normal.push(v[3*(ut-1)+1]),o.normal.push(v[3*(ut-1)+2]),o.normal.push(v[3*ut]),o.normal.push(v[3*ut+1]),o.normal.push(v[3*ut+2])),c.uv&&c.uv.forEach(function(ht,_t){o.uvs[_t]===void 0&&(o.uvs[_t]=[]),o.uvs[_t].push(tt[_t][0]),o.uvs[_t].push(tt[_t][1]),o.uvs[_t].push(tt[_t][2*(ut-1)]),o.uvs[_t].push(tt[_t][2*(ut-1)+1]),o.uvs[_t].push(tt[_t][2*ut]),o.uvs[_t].push(tt[_t][2*ut+1])})}addMorphTargets(o,c,d,_){if(d.length===0)return;o.morphTargetsRelative=!0,o.morphAttributes.position=[];const v=this;d.forEach(function(b){b.rawTargets.forEach(function(tt){const it=fbxTree.Objects.Geometry[tt.geoID];it!==void 0&&v.genMorphGeometry(o,c,it,_,tt.name)})})}genMorphGeometry(o,c,d,_,v){const b=c.PolygonVertexIndex!==void 0?c.PolygonVertexIndex.a:[],tt=d.Vertices!==void 0?d.Vertices.a:[],it=d.Indexes!==void 0?d.Indexes.a:[],nt=3*o.attributes.position.count,lt=new Float32Array(nt);for(let ft=0;ft<it.length;ft++){const bt=3*it[ft];lt[bt]=tt[3*ft],lt[bt+1]=tt[3*ft+1],lt[bt+2]=tt[3*ft+2]}const ut={vertexIndices:b,vertexPositions:lt},ht=this.genBuffers(ut),_t=new three_module.qtW(ht.vertex,3);_t.name=v||d.attrName,_t.applyMatrix4(_),o.morphAttributes.position.push(_t)}parseNormals(o){const c=o.MappingInformationType,d=o.ReferenceInformationType,_=o.Normals.a;let v=[];return d==="IndexToDirect"&&("NormalIndex"in o?v=o.NormalIndex.a:"NormalsIndex"in o&&(v=o.NormalsIndex.a)),{dataSize:3,buffer:_,indices:v,mappingType:c,referenceType:d}}parseUVs(o){const c=o.MappingInformationType,d=o.ReferenceInformationType,_=o.UV.a;let v=[];return d==="IndexToDirect"&&(v=o.UVIndex.a),{dataSize:2,buffer:_,indices:v,mappingType:c,referenceType:d}}parseVertexColors(o){const c=o.MappingInformationType,d=o.ReferenceInformationType,_=o.Colors.a;let v=[];d==="IndexToDirect"&&(v=o.ColorIndex.a);for(let b=0,tt=new three_module.Q1f;b<_.length;b+=4)tt.fromArray(_,b).convertSRGBToLinear().toArray(_,b);return{dataSize:4,buffer:_,indices:v,mappingType:c,referenceType:d}}parseMaterialIndices(o){const c=o.MappingInformationType,d=o.ReferenceInformationType;if(c==="NoMappingInformation")return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:d};const _=o.Materials.a,v=[];for(let b=0;b<_.length;++b)v.push(b);return{dataSize:1,buffer:_,indices:v,mappingType:c,referenceType:d}}parseNurbsGeometry(o){const c=parseInt(o.Order);if(isNaN(c))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",o.Order,o.id),new three_module.LoY;const d=c-1,_=o.KnotVector.a,v=[],b=o.Points.a;for(let lt=0,ut=b.length;lt<ut;lt+=4)v.push(new three_module.IUQ().fromArray(b,lt));let tt,it;if(o.Form==="Closed")v.push(v[0]);else if(o.Form==="Periodic"){tt=d,it=_.length-1-tt;for(let lt=0;lt<d;++lt)v.push(v[lt])}const nt=new NURBSCurve(d,_,v,tt,it).getPoints(12*v.length);return new three_module.LoY().setFromPoints(nt)}}class AnimationParser{parse(){const o=[],c=this.parseClips();if(c!==void 0)for(const d in c){const _=c[d],v=this.addClip(_);o.push(v)}return o}parseClips(){if(fbxTree.Objects.AnimationCurve===void 0)return;const o=this.parseAnimationCurveNodes();this.parseAnimationCurves(o);const c=this.parseAnimationLayers(o);return this.parseAnimStacks(c)}parseAnimationCurveNodes(){const o=fbxTree.Objects.AnimationCurveNode,c=new Map;for(const d in o){const _=o[d];if(_.attrName.match(/S|R|T|DeformPercent/)!==null){const v={id:_.id,attr:_.attrName,curves:{}};c.set(v.id,v)}}return c}parseAnimationCurves(o){const c=fbxTree.Objects.AnimationCurve;for(const d in c){const _={id:c[d].id,times:c[d].KeyTime.a.map(convertFBXTimeToSeconds),values:c[d].KeyValueFloat.a},v=connections.get(_.id);if(v!==void 0){const b=v.parents[0].ID,tt=v.parents[0].relationship;tt.match(/X/)?o.get(b).curves.x=_:tt.match(/Y/)?o.get(b).curves.y=_:tt.match(/Z/)?o.get(b).curves.z=_:tt.match(/DeformPercent/)&&o.has(b)&&(o.get(b).curves.morph=_)}}}parseAnimationLayers(o){const c=fbxTree.Objects.AnimationLayer,d=new Map;for(const _ in c){const v=[],b=connections.get(parseInt(_));b!==void 0&&(b.children.forEach(function(tt,it){if(o.has(tt.ID)){const nt=o.get(tt.ID);if(nt.curves.x!==void 0||nt.curves.y!==void 0||nt.curves.z!==void 0){if(v[it]===void 0){const lt=connections.get(tt.ID).parents.filter(function(ut){return ut.relationship!==void 0})[0].ID;if(lt!==void 0){const ut=fbxTree.Objects.Model[lt.toString()];if(ut===void 0)return void console.warn("THREE.FBXLoader: Encountered a unused curve.",tt);const ht={modelName:ut.attrName?three_module.Nwf.sanitizeNodeName(ut.attrName):"",ID:ut.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};sceneGraph.traverse(function(_t){_t.ID===ut.id&&(ht.transform=_t.matrix,_t.userData.transformData&&(ht.eulerOrder=_t.userData.transformData.eulerOrder))}),ht.transform||(ht.transform=new three_module.kn4),"PreRotation"in ut&&(ht.preRotation=ut.PreRotation.value),"PostRotation"in ut&&(ht.postRotation=ut.PostRotation.value),v[it]=ht}}v[it]&&(v[it][nt.attr]=nt)}else if(nt.curves.morph!==void 0){if(v[it]===void 0){const lt=connections.get(tt.ID).parents.filter(function(xt){return xt.relationship!==void 0})[0].ID,ut=connections.get(lt).parents[0].ID,ht=connections.get(ut).parents[0].ID,_t=connections.get(ht).parents[0].ID,ft=fbxTree.Objects.Model[_t],bt={modelName:ft.attrName?three_module.Nwf.sanitizeNodeName(ft.attrName):"",morphName:fbxTree.Objects.Deformer[lt].attrName};v[it]=bt}v[it][nt.attr]=nt}}}),d.set(parseInt(_),v))}return d}parseAnimStacks(o){const c=fbxTree.Objects.AnimationStack,d={};for(const _ in c){const v=connections.get(parseInt(_)).children;v.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");const b=o.get(v[0].ID);d[_]={name:c[_].attrName,layer:b}}return d}addClip(o){let c=[];const d=this;return o.layer.forEach(function(_){c=c.concat(d.generateTracks(_))}),new three_module.tz3(o.name,-1,c)}generateTracks(o){const c=[];let d=new three_module.Pq0,_=new three_module.PTz,v=new three_module.Pq0;if(o.transform&&o.transform.decompose(d,_,v),d=d.toArray(),_=new three_module.O9p().setFromQuaternion(_,o.eulerOrder).toArray(),v=v.toArray(),o.T!==void 0&&Object.keys(o.T.curves).length>0){const b=this.generateVectorTrack(o.modelName,o.T.curves,d,"position");b!==void 0&&c.push(b)}if(o.R!==void 0&&Object.keys(o.R.curves).length>0){const b=this.generateRotationTrack(o.modelName,o.R.curves,_,o.preRotation,o.postRotation,o.eulerOrder);b!==void 0&&c.push(b)}if(o.S!==void 0&&Object.keys(o.S.curves).length>0){const b=this.generateVectorTrack(o.modelName,o.S.curves,v,"scale");b!==void 0&&c.push(b)}if(o.DeformPercent!==void 0){const b=this.generateMorphTrack(o);b!==void 0&&c.push(b)}return c}generateVectorTrack(o,c,d,_){const v=this.getTimesForAllAxes(c),b=this.getKeyframeTrackValues(v,c,d);return new three_module.RiT(o+"."+_,v,b)}generateRotationTrack(o,c,d,_,v,b){c.x!==void 0&&(this.interpolateRotations(c.x),c.x.values=c.x.values.map(three_module.cj9.degToRad)),c.y!==void 0&&(this.interpolateRotations(c.y),c.y.values=c.y.values.map(three_module.cj9.degToRad)),c.z!==void 0&&(this.interpolateRotations(c.z),c.z.values=c.z.values.map(three_module.cj9.degToRad));const tt=this.getTimesForAllAxes(c),it=this.getKeyframeTrackValues(tt,c,d);_!==void 0&&((_=_.map(three_module.cj9.degToRad)).push(b),_=new three_module.O9p().fromArray(_),_=new three_module.PTz().setFromEuler(_)),v!==void 0&&((v=v.map(three_module.cj9.degToRad)).push(b),v=new three_module.O9p().fromArray(v),v=new three_module.PTz().setFromEuler(v).invert());const nt=new three_module.PTz,lt=new three_module.O9p,ut=[];for(let ht=0;ht<it.length;ht+=3)lt.set(it[ht],it[ht+1],it[ht+2],b),nt.setFromEuler(lt),_!==void 0&&nt.premultiply(_),v!==void 0&&nt.multiply(v),nt.toArray(ut,ht/3*4);return new three_module.MBL(o+".quaternion",tt,ut)}generateMorphTrack(o){const c=o.DeformPercent.curves.morph,d=c.values.map(function(v){return v/100}),_=sceneGraph.getObjectByName(o.modelName).morphTargetDictionary[o.morphName];return new three_module.Hit(o.modelName+".morphTargetInfluences["+_+"]",c.times,d)}getTimesForAllAxes(o){let c=[];if(o.x!==void 0&&(c=c.concat(o.x.times)),o.y!==void 0&&(c=c.concat(o.y.times)),o.z!==void 0&&(c=c.concat(o.z.times)),c=c.sort(function(d,_){return d-_}),c.length>1){let d=1,_=c[0];for(let v=1;v<c.length;v++){const b=c[v];b!==_&&(c[d]=b,_=b,d++)}c=c.slice(0,d)}return c}getKeyframeTrackValues(o,c,d){const _=d,v=[];let b=-1,tt=-1,it=-1;return o.forEach(function(nt){if(c.x&&(b=c.x.times.indexOf(nt)),c.y&&(tt=c.y.times.indexOf(nt)),c.z&&(it=c.z.times.indexOf(nt)),b!==-1){const lt=c.x.values[b];v.push(lt),_[0]=lt}else v.push(_[0]);if(tt!==-1){const lt=c.y.values[tt];v.push(lt),_[1]=lt}else v.push(_[1]);if(it!==-1){const lt=c.z.values[it];v.push(lt),_[2]=lt}else v.push(_[2])}),v}interpolateRotations(o){for(let c=1;c<o.values.length;c++){const d=o.values[c-1],_=o.values[c]-d,v=Math.abs(_);if(v>=180){const b=v/180,tt=_/b;let it=d+tt;const nt=o.times[c-1],lt=(o.times[c]-nt)/b;let ut=nt+lt;const ht=[],_t=[];for(;ut<o.times[c];)ht.push(ut),ut+=lt,_t.push(it),it+=tt;o.times=inject(o.times,c,ht),o.values=inject(o.values,c,_t)}}}}class TextParser{getPrevNode(){return this.nodeStack[this.currentIndent-2]}getCurrentNode(){return this.nodeStack[this.currentIndent-1]}getCurrentProp(){return this.currentProp}pushStack(o){this.nodeStack.push(o),this.currentIndent+=1}popStack(){this.nodeStack.pop(),this.currentIndent-=1}setCurrentProp(o,c){this.currentProp=o,this.currentPropName=c}parse(o){this.currentIndent=0,this.allNodes=new FBXTree,this.nodeStack=[],this.currentProp=[],this.currentPropName="";const c=this,d=o.split(/[\r\n]+/);return d.forEach(function(_,v){const b=_.match(/^[\s\t]*;/),tt=_.match(/^[\s\t]*$/);if(b||tt)return;const it=_.match("^\\t{"+c.currentIndent+"}(\\w+):(.*){",""),nt=_.match("^\\t{"+c.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),lt=_.match("^\\t{"+(c.currentIndent-1)+"}}");it?c.parseNodeBegin(_,it):nt?c.parseNodeProperty(_,nt,d[++v]):lt?c.popStack():_.match(/^[^\s\t}]/)&&c.parseNodePropertyContinued(_)}),this.allNodes}parseNodeBegin(o,c){const d=c[1].trim().replace(/^"/,"").replace(/"$/,""),_=c[2].split(",").map(function(it){return it.trim().replace(/^"/,"").replace(/"$/,"")}),v={name:d},b=this.parseNodeAttr(_),tt=this.getCurrentNode();this.currentIndent===0?this.allNodes.add(d,v):d in tt?(d==="PoseNode"?tt.PoseNode.push(v):tt[d].id!==void 0&&(tt[d]={},tt[d][tt[d].id]=tt[d]),b.id!==""&&(tt[d][b.id]=v)):typeof b.id=="number"?(tt[d]={},tt[d][b.id]=v):d!=="Properties70"&&(tt[d]=d==="PoseNode"?[v]:v),typeof b.id=="number"&&(v.id=b.id),b.name!==""&&(v.attrName=b.name),b.type!==""&&(v.attrType=b.type),this.pushStack(v)}parseNodeAttr(o){let c=o[0];o[0]!==""&&(c=parseInt(o[0]),isNaN(c)&&(c=o[0]));let d="",_="";return o.length>1&&(d=o[1].replace(/^(\w+)::/,""),_=o[2]),{id:c,name:d,type:_}}parseNodeProperty(o,c,d){let _=c[1].replace(/^"/,"").replace(/"$/,"").trim(),v=c[2].replace(/^"/,"").replace(/"$/,"").trim();_==="Content"&&v===","&&(v=d.replace(/"/g,"").replace(/,$/,"").trim());const b=this.getCurrentNode();if(b.name!=="Properties70"){if(_==="C"){const tt=v.split(",").slice(1),it=parseInt(tt[0]),nt=parseInt(tt[1]);let lt=v.split(",").slice(3);lt=lt.map(function(ut){return ut.trim().replace(/^"/,"")}),_="connections",v=[it,nt],append(v,lt),b[_]===void 0&&(b[_]=[])}_==="Node"&&(b.id=v),_ in b&&Array.isArray(b[_])?b[_].push(v):_!=="a"?b[_]=v:b.a=v,this.setCurrentProp(b,_),_==="a"&&v.slice(-1)!==","&&(b.a=parseNumberArray(v))}else this.parseNodeSpecialProperty(o,_,v)}parseNodePropertyContinued(o){const c=this.getCurrentNode();c.a+=o,o.slice(-1)!==","&&(c.a=parseNumberArray(c.a))}parseNodeSpecialProperty(o,c,d){const _=d.split('",').map(function(lt){return lt.trim().replace(/^\"/,"").replace(/\s/,"_")}),v=_[0],b=_[1],tt=_[2],it=_[3];let nt=_[4];switch(b){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":nt=parseFloat(nt);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":nt=parseNumberArray(nt)}this.getPrevNode()[v]={type:b,type2:tt,flag:it,value:nt},this.setCurrentProp(this.getPrevNode(),v)}}class BinaryParser{parse(o){const c=new BinaryReader(o);c.skip(23);const d=c.getUint32();if(d<6400)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+d);const _=new FBXTree;for(;!this.endOfContent(c);){const v=this.parseNode(c,d);v!==null&&_.add(v.name,v)}return _}endOfContent(o){return o.size()%16==0?(o.getOffset()+160+16&-16)>=o.size():o.getOffset()+160+16>=o.size()}parseNode(o,c){const d={},_=c>=7500?o.getUint64():o.getUint32(),v=c>=7500?o.getUint64():o.getUint32();c>=7500?o.getUint64():o.getUint32();const b=o.getUint8(),tt=o.getString(b);if(_===0)return null;const it=[];for(let ht=0;ht<v;ht++)it.push(this.parseProperty(o));const nt=it.length>0?it[0]:"",lt=it.length>1?it[1]:"",ut=it.length>2?it[2]:"";for(d.singleProperty=v===1&&o.getOffset()===_;_>o.getOffset();){const ht=this.parseNode(o,c);ht!==null&&this.parseSubNode(tt,d,ht)}return d.propertyList=it,typeof nt=="number"&&(d.id=nt),lt!==""&&(d.attrName=lt),ut!==""&&(d.attrType=ut),tt!==""&&(d.name=tt),d}parseSubNode(o,c,d){if(d.singleProperty===!0){const _=d.propertyList[0];Array.isArray(_)?(c[d.name]=d,d.a=_):c[d.name]=_}else if(o==="Connections"&&d.name==="C"){const _=[];d.propertyList.forEach(function(v,b){b!==0&&_.push(v)}),c.connections===void 0&&(c.connections=[]),c.connections.push(_)}else if(d.name==="Properties70")Object.keys(d).forEach(function(_){c[_]=d[_]});else if(o==="Properties70"&&d.name==="P"){let _=d.propertyList[0],v=d.propertyList[1];const b=d.propertyList[2],tt=d.propertyList[3];let it;_.indexOf("Lcl ")===0&&(_=_.replace("Lcl ","Lcl_")),v.indexOf("Lcl ")===0&&(v=v.replace("Lcl ","Lcl_")),it=v==="Color"||v==="ColorRGB"||v==="Vector"||v==="Vector3D"||v.indexOf("Lcl_")===0?[d.propertyList[4],d.propertyList[5],d.propertyList[6]]:d.propertyList[4],c[_]={type:v,type2:b,flag:tt,value:it}}else c[d.name]===void 0?typeof d.id=="number"?(c[d.name]={},c[d.name][d.id]=d):c[d.name]=d:d.name==="PoseNode"?(Array.isArray(c[d.name])||(c[d.name]=[c[d.name]]),c[d.name].push(d)):c[d.name][d.id]===void 0&&(c[d.name][d.id]=d)}parseProperty(o){const c=o.getString(1);let d;switch(c){case"C":return o.getBoolean();case"D":return o.getFloat64();case"F":return o.getFloat32();case"I":return o.getInt32();case"L":return o.getInt64();case"R":return d=o.getUint32(),o.getArrayBuffer(d);case"S":return d=o.getUint32(),o.getString(d);case"Y":return o.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":const _=o.getUint32(),v=o.getUint32(),b=o.getUint32();if(v===0)switch(c){case"b":case"c":return o.getBooleanArray(_);case"d":return o.getFloat64Array(_);case"f":return o.getFloat32Array(_);case"i":return o.getInt32Array(_);case"l":return o.getInt64Array(_)}const tt=fflate_module_unzlibSync(new Uint8Array(o.getArrayBuffer(b))),it=new BinaryReader(tt.buffer);switch(c){case"b":case"c":return it.getBooleanArray(_);case"d":return it.getFloat64Array(_);case"f":return it.getFloat32Array(_);case"i":return it.getInt32Array(_);case"l":return it.getInt64Array(_)}break;default:throw new Error("THREE.FBXLoader: Unknown property type "+c)}}}class BinaryReader{constructor(o,c){this.dv=new DataView(o),this.offset=0,this.littleEndian=c===void 0||c,this._textDecoder=new TextDecoder}getOffset(){return this.offset}size(){return this.dv.buffer.byteLength}skip(o){this.offset+=o}getBoolean(){return!(1&~this.getUint8())}getBooleanArray(o){const c=[];for(let d=0;d<o;d++)c.push(this.getBoolean());return c}getUint8(){const o=this.dv.getUint8(this.offset);return this.offset+=1,o}getInt16(){const o=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,o}getInt32(){const o=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,o}getInt32Array(o){const c=[];for(let d=0;d<o;d++)c.push(this.getInt32());return c}getUint32(){const o=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,o}getInt64(){let o,c;return this.littleEndian?(o=this.getUint32(),c=this.getUint32()):(c=this.getUint32(),o=this.getUint32()),2147483648&c?(c=4294967295&~c,o=4294967295&~o,o===4294967295&&(c=c+1&4294967295),o=o+1&4294967295,-(4294967296*c+o)):4294967296*c+o}getInt64Array(o){const c=[];for(let d=0;d<o;d++)c.push(this.getInt64());return c}getUint64(){let o,c;return this.littleEndian?(o=this.getUint32(),c=this.getUint32()):(c=this.getUint32(),o=this.getUint32()),4294967296*c+o}getFloat32(){const o=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,o}getFloat32Array(o){const c=[];for(let d=0;d<o;d++)c.push(this.getFloat32());return c}getFloat64(){const o=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,o}getFloat64Array(o){const c=[];for(let d=0;d<o;d++)c.push(this.getFloat64());return c}getArrayBuffer(o){const c=this.dv.buffer.slice(this.offset,this.offset+o);return this.offset+=o,c}getString(o){const c=this.offset;let d=new Uint8Array(this.dv.buffer,c,o);this.skip(o);const _=d.indexOf(0);return _>=0&&(d=new Uint8Array(this.dv.buffer,c,_)),this._textDecoder.decode(d)}}class FBXTree{add(o,c){this[o]=c}}function isFbxFormatBinary(h){return h.byteLength>=21&&convertArrayBufferToString(h,0,21)==="Kaydara FBX Binary  \0"}function isFbxFormatASCII(h){const o=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"];let c=0;function d(_){const v=h[_-1];return h=h.slice(c+_),c++,v}for(let _=0;_<o.length;++_)if(d(1)===o[_])return!1;return!0}function getFbxVersion(h){const o=h.match(/FBXVersion: (\d+)/);if(o)return parseInt(o[1]);throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function convertFBXTimeToSeconds(h){return h/46186158e3}const dataArray=[];function getData(h,o,c,d){let _;switch(d.mappingType){case"ByPolygonVertex":_=h;break;case"ByPolygon":_=o;break;case"ByVertice":_=c;break;case"AllSame":_=d.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+d.mappingType)}d.referenceType==="IndexToDirect"&&(_=d.indices[_]);const v=_*d.dataSize,b=v+d.dataSize;return slice(dataArray,d.buffer,v,b)}const tempEuler=new three_module.O9p,FBXLoader_tempVec=new three_module.Pq0;function generateTransform(h){const o=new three_module.kn4,c=new three_module.kn4,d=new three_module.kn4,_=new three_module.kn4,v=new three_module.kn4,b=new three_module.kn4,tt=new three_module.kn4,it=new three_module.kn4,nt=new three_module.kn4,lt=new three_module.kn4,ut=new three_module.kn4,ht=new three_module.kn4,_t=h.inheritType?h.inheritType:0;if(h.translation&&o.setPosition(FBXLoader_tempVec.fromArray(h.translation)),h.preRotation){const Vt=h.preRotation.map(three_module.cj9.degToRad);Vt.push(h.eulerOrder||three_module.O9p.DEFAULT_ORDER),c.makeRotationFromEuler(tempEuler.fromArray(Vt))}if(h.rotation){const Vt=h.rotation.map(three_module.cj9.degToRad);Vt.push(h.eulerOrder||three_module.O9p.DEFAULT_ORDER),d.makeRotationFromEuler(tempEuler.fromArray(Vt))}if(h.postRotation){const Vt=h.postRotation.map(three_module.cj9.degToRad);Vt.push(h.eulerOrder||three_module.O9p.DEFAULT_ORDER),_.makeRotationFromEuler(tempEuler.fromArray(Vt)),_.invert()}h.scale&&v.scale(FBXLoader_tempVec.fromArray(h.scale)),h.scalingOffset&&tt.setPosition(FBXLoader_tempVec.fromArray(h.scalingOffset)),h.scalingPivot&&b.setPosition(FBXLoader_tempVec.fromArray(h.scalingPivot)),h.rotationOffset&&it.setPosition(FBXLoader_tempVec.fromArray(h.rotationOffset)),h.rotationPivot&&nt.setPosition(FBXLoader_tempVec.fromArray(h.rotationPivot)),h.parentMatrixWorld&&(ut.copy(h.parentMatrix),lt.copy(h.parentMatrixWorld));const ft=c.clone().multiply(d).multiply(_),bt=new three_module.kn4;bt.extractRotation(lt);const xt=new three_module.kn4;xt.copyPosition(lt);const St=xt.clone().invert().multiply(lt),wt=bt.clone().invert().multiply(St),Pt=v,Rt=new three_module.kn4;if(_t===0)Rt.copy(bt).multiply(ft).multiply(wt).multiply(Pt);else if(_t===1)Rt.copy(bt).multiply(wt).multiply(ft).multiply(Pt);else{const Vt=new three_module.kn4().scale(new three_module.Pq0().setFromMatrixScale(ut)).clone().invert(),Kt=wt.clone().multiply(Vt);Rt.copy(bt).multiply(ft).multiply(Kt).multiply(Pt)}const kt=nt.clone().invert(),Gt=b.clone().invert();let Dt=o.clone().multiply(it).multiply(nt).multiply(c).multiply(d).multiply(_).multiply(kt).multiply(tt).multiply(b).multiply(v).multiply(Gt);const It=new three_module.kn4().copyPosition(Dt),Nt=lt.clone().multiply(It);return ht.copyPosition(Nt),Dt=ht.clone().multiply(Rt),Dt.premultiply(lt.invert()),Dt}function getEulerOrder(h){const o=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return(h=h||0)===6?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),o[0]):o[h]}function parseNumberArray(h){return h.split(",").map(function(o){return parseFloat(o)})}function convertArrayBufferToString(h,o,c){return o===void 0&&(o=0),c===void 0&&(c=h.byteLength),new TextDecoder().decode(new Uint8Array(h,o,c))}function append(h,o){for(let c=0,d=h.length,_=o.length;c<_;c++,d++)h[d]=o[c]}function slice(h,o,c,d){for(let _=c,v=0;_<d;_++,v++)h[v]=o[_];return h}function inject(h,o,c){return h.slice(0,o).concat(c).concat(h.slice(o))}class FBXLoader2 extends FBXLoader{async loadAsync(o,c){const d=three_module.gPd.DEFAULT_IMAGE;three_module.gPd.DEFAULT_IMAGE||(three_module.gPd.DEFAULT_IMAGE=AssetImporter.WHITE_IMAGE_DATA);const _=await super.loadAsync(o,c);return three_module.gPd.DEFAULT_IMAGE=d,_}}class FBXLoadPlugin extends I$2{constructor(){super(...arguments),this.dependencies=[AssetManagerPlugin],this._importer=new Importer(FBXLoader2,["fbx"],!0)}async onAdded(o){var c,d;(d=(c=o.getManager())===null||c===void 0?void 0:c.importer)===null||d===void 0||d.Importers.push(this._importer)}async onDispose(o){}async onRemove(o){var c,d,_,v;!((d=(c=o.getManager())===null||c===void 0?void 0:c.importer)===null||d===void 0)&&d.Importers&&((v=(_=o.getManager())===null||_===void 0?void 0:_.importer)===null||v===void 0||v.Importers.splice(o.getManager().importer.Importers.indexOf(this._importer),1))}}FBXLoadPlugin.PluginType="FBXLoadPlugin";const camera=new three_module.ubm(45,1,.1,1e3);function snapObject(h,o,c,d=7,_=new three_module.Pq0(0,0,1.5)){c=c??h.scene.modelObject;const v=new Box3B().expandByObject(c??o,!0,!0),b=v.getCenter(new three_module.Pq0),tt=v.getSize(new three_module.Pq0);camera.position.copy(b).add(_.clone().multiplyScalar(Math.max(tt.x,tt.y,tt.z))),camera.lookAt(b),o&&o.traverseVisible(lt=>{lt.layers.enable(d)}),d>0?camera.layers.set(d):camera.layers.enableAll();const it=o==null?void 0:o.visible;o&&(o.visible=!0),h.renderer.rendererObject.setRenderTarget(null),h.renderer.rendererObject.render(c,camera);const nt=h.renderer.rendererObject.domElement.toDataURL("image/png");return o&&(o.visible=it,o.traverseVisible(lt=>{lt.layers.disable(d)}),camera.layers.enableAll()),h.setDirty(),nt}class MaterialPreviewGenerator{constructor(o){this.viewer=o,this._lights=[],this.shapes={sphere:new three_module.eaF(new three_module.Gu$(1)),cube:new three_module.eaF(new three_module.iNn(1,1,1)),cylinder:new three_module.eaF(new three_module.Ho_(.5,.5,1))};const c=new three_module.Z58;this._channel=7;const d=new three_module.dth(16777215,4473924,1);d.position.set(0,10,0),d.layers.set(this._channel),c.add(d),this._lights.push(d),this._scene=c}dispose(){[...this._lights].forEach(o=>o.dispose()),Object.values(this.shapes).forEach(o=>{o.geometry&&o.geometry.dispose()})}generate(o,c="sphere"){const d=this.shapes[c]||new three_module.eaF(new three_module.Gu$(1));d.material=o.materialObject,d.geometry.attributes.tangent||d.geometry.computeTangents(),this._scene.add(d),this._scene.environment=this.viewer.scene.environment;const _=d.material.envMapIntensity;typeof _=="number"&&(d.material.envMapIntensity=Math.min(_,.5));const v=snapObject(this.viewer,d,this._scene,this._channel,new three_module.Pq0(0,0,1.5));return typeof _=="number"&&(d.material.envMapIntensity=_),this._scene.remove(d),d.material=void 0,v}}var MaterialConfiguratorBasePlugin_decorate=function(h,o,c,d){var _,v=arguments.length,b=v<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(h,o,c,d);else for(var tt=h.length-1;tt>=0;tt--)(_=h[tt])&&(b=(v<3?_(b):v>3?_(o,c,b):_(o,c))||b);return v>3&&b&&Object.defineProperty(o,c,b),b};class MaterialConfiguratorBasePlugin extends AViewerPlugin{constructor(){super(),this.enabled=!0,this._uiNeedRefresh=!1,this.applyOnLoad=!0,this._refreshUiConfig=()=>{var o,c;this.enabled&&((c=(o=this.uiConfig).uiRefresh)===null||c===void 0||c.call(o))},this.dependencies=[AssetManagerPlugin],this.variations=[],this._selectedMaterial=()=>{var o,c;return((c=(o=this._picking)===null||o===void 0?void 0:o.getSelectedObject())===null||c===void 0?void 0:c.material)||void 0},this.uiConfig={label:"Material Configurator",type:"folder",children:[()=>{var o;return[{type:"input",label:"uuid",property:[this._selectedMaterial(),"uuid"],hidden:()=>!this._selectedMaterial(),disabled:!0},{type:"input",label:"mapping",hidden:()=>!this._selectedMaterial(),property:()=>[this.getSelectedVariation(),"uuid"],onChange:async()=>this.refreshUi()},{type:"input",label:"title",hidden:()=>!this._selectedMaterial(),property:()=>[this.getSelectedVariation(),"title"],onChange:async()=>this.refreshUi()},{type:"dropdown",label:"Preview Type",hidden:()=>!this._selectedMaterial(),property:()=>[this.getSelectedVariation(),"preview"],onChange:async()=>this.refreshUi(),children:["generate:sphere","generate:cube","color","map","emissive",...Object.keys(standardMaterialPropList).filter(c=>c.endsWith("Map"))].map(c=>({label:c,value:c}))},...((o=this.getSelectedVariation())===null||o===void 0?void 0:o.materials.map(c=>c.uiConfig?Object.assign(c.uiConfig,{expanded:!1}):{}))||[],{type:"button",label:"Clear variations",hidden:()=>!this._selectedMaterial(),value:async()=>{const c=this.getSelectedVariation();c&&await this._viewer.confirm("Material configurator: Remove all variations for this material?")&&(c.materials=[]),this.refreshUi()}},{type:"button",label:"Remove completely",hidden:()=>!this._selectedMaterial(),value:async()=>{const c=this.getSelectedVariation();c&&await this._viewer.confirm("Material configurator: Remove this variation?")&&this.removeVariation(c)}},{type:"button",label:"Add Variation",hidden:()=>!this._selectedMaterial(),value:async()=>{var c;const d=this._selectedMaterial();d&&(d.name||await((c=this._viewer)===null||c===void 0?void 0:c.confirm("Material configurator: Material has no name. Use uuid instead?")))&&this.addVariation(d)}},{type:"button",label:"Refresh Ui",value:()=>this.refreshUi()},{type:"button",label:"Apply All",value:()=>{this.variations.forEach(async c=>this.applyVariation(c,c.materials[0].uuid))}}]}]},this.addEventListener("deserialize",this.refreshUi),this.refreshUi=this.refreshUi.bind(this),this._refreshUi=this._refreshUi.bind(this)}async onAdded(o){var c,d;await super.onAdded(o),this._picking=(c=this._viewer)===null||c===void 0?void 0:c.getPluginByType("Picking"),this._previewGenerator=new MaterialPreviewGenerator(this._viewer),(d=this._picking)===null||d===void 0||d.addEventListener("selectedObjectChanged",this._refreshUiConfig),o.addEventListener("preFrame",this._refreshUi)}reapplyAll(){this.variations.forEach(async o=>{var c;return this.applyVariation(o,o.materials[(c=o.selectedIndex)!==null&&c!==void 0?c:0].uuid)})}fromJSON(o,c){return this.variations=[],super.fromJSON(o,c)?(o.applyOnLoad===void 0&&(this.applyOnLoad=!1),this.applyOnLoad&&this.reapplyAll(),this):null}async onRemove(o){var c,d;return(c=this._previewGenerator)===null||c===void 0||c.dispose(),this._previewGenerator=void 0,(d=this._picking)===null||d===void 0||d.removeEventListener("selectedObjectChanged",this._refreshUiConfig),this.removeEventListener("deserialize",this.refreshUi),o.removeEventListener("preFrame",this._refreshUi),this._picking=void 0,super.onRemove(o)}findVariation(o){return o?this.variations.find(c=>c.uuid===o):void 0}getSelectedVariation(){var o,c;return this.findVariation((o=this._selectedMaterial())===null||o===void 0?void 0:o.uuid)||this.findVariation((c=this._selectedMaterial())===null||c===void 0?void 0:c.name)}applyVariation(o,c){var d,_;const v=(_=(d=this._viewer)===null||d===void 0?void 0:d.getManager())===null||_===void 0?void 0:_.materials;if(!v)return!1;const b=typeof c=="string"?o.materials.find(tt=>tt.uuid===c):o.materials[c];return!!b&&(o.selectedIndex=o.materials.indexOf(b),v.applyMaterial(b,o.uuid))}getPreview(o,c,d=!0){if(!this._viewer)return"";const _=o;if(!_)return"";let v="";if(c.startsWith("generate:"))v=this._previewGenerator.generate(_,c.split(":")[1]);else{const b=_[c]||"#ff00ff";v=b.image?Ne$1(b.image,100):"",v.length||(v=Ge$1(b.isColor?b.getHexString():b))}return d&&this._viewer.setDirty(),v}refreshUi(){this.enabled&&this._viewer&&(this._uiNeedRefresh=!0)}async _refreshUi(){return!(!this.enabled||!this._viewer||!this._uiNeedRefresh||(this._uiNeedRefresh=!1,this._refreshUiConfig(),0))}removeVariationForMaterial(o){let c=this.findVariation(o.uuid);!c&&o.name.length>0&&(c=this.findVariation(o.name)),c&&this.removeVariation(c)}removeVariation(o){o&&(this.variations.splice(this.variations.indexOf(o),1),this.refreshUi())}addVariation(o,c,d=!0){var _;const v=d?(_=o==null?void 0:o.clone)===null||_===void 0?void 0:_.call(o):o;if(o&&v){let b=this.findVariation(c??o.uuid);!b&&!c&&o.name.length>0&&(b=this.findVariation(o.name)),b||(b=this.createVariation(o,c)),b.materials.push(v),this.refreshUi()}}createVariation(o,c){return this.variations.push({uuid:c??o.name.length>0?o.name:o.uuid,title:o.name.length>0?o.name:"No Name",preview:"generate:sphere",materials:[]}),this.variations[this.variations.length-1]}}MaterialConfiguratorBasePlugin.PluginType="MaterialConfiguratorPlugin",MaterialConfiguratorBasePlugin_decorate([serialize()],MaterialConfiguratorBasePlugin.prototype,"variations",void 0);class CustomContextGrid{static _initializeStyles(){P$2($`
  .customContextGrid {
    background: #eeeeee55;
    border: 0.5px solid rgba(220, 220, 220, 0.2);
    width: auto;
    height: auto;
    position: absolute;
    display: flex;
    flex-direction: row;
    flex-wrap: wrap;
    z-index: 200;
    padding: 0.35rem 0.35rem;
    border-radius: 0.375rem;
    min-width: 5rem;
    pointer-events: auto;
    box-shadow: 0px 2px 6px rgba(12, 12, 12, 0.2);

    color: #111111;
    font-size: 0.65rem;
    font-family: Inter, "Roboto Mono", "Source Code Pro", Menlo, Courier, monospace;
    backdrop-filter: blur(20px);
  }
  .customContextGridItems {
    background-color: transparent;
    cursor: pointer;
    border-radius: 0.25rem;
    line-height: 1rem;
    font-weight: 500;
    overflow: hidden;
    margin: 0.12rem;
  }

  .customContextGridItems:hover {
    color: white;
    //background-color: #017AFF;
    box-shadow: 0 0 7px 0px rgba(64, 64, 64, 0.3);
  }
  .customContextGridItemImage{
    width: 100%;
    height: 100%;
  }
  .customContextGridHeading{
    width: 100%;
    padding: 5px;
    font-size: 0.85rem;
  }
  .customContextGridParent{
    position: absolute;
    top: 0;
    left: 0;
    width: 270px;
    height: calc(100% - 100px);
    overflow-y: scroll;
    z-index: 100;
    display: flex;
    flex-direction: column;
    margin-bottom: 50px;
    margin-top: 50px;
  }
  /* Hide scrollbar for Chrome, Safari and Opera */
  .customContextGridParent::-webkit-scrollbar {
    display: none;
  }
  /* Hide scrollbar for IE, Edge and Firefox */
  .customContextGridParent {
    -ms-overflow-style: none;  /* IE and Edge */
    scrollbar-width: none;  /* Firefox */
  }

        `,this._container),this._container.style.position="absolute",this._container.style.top="0",this._container.style.left="0",this._container.style.width="270px",this._container.style.height="100%",this._container.style.pointerEvents="none",this._container.style.zIndex="100",this._container.style.overflowY="auto"}static Create(o,c,d,_,v,b,tt){var it;const nt=we$1(),lt=nt?.15:.25,ut=nt?1.5:2.5,ht=ee$1({classList:["customContextGrid"],addToBody:!1,innerHTML:`
            <div class="customContextGridHeading"> ${c} </div>
            `});ht.style.top=v+"px",ht.style.left=_+"px",ht.style.gap=lt+"rem",ht.style.width=(ut+lt)*d-lt+"rem",ht.dataset.tag=o;for(const _t of b){const ft=ee$1({classList:["customContextGridItems"],addToBody:!1,innerHTML:`
            <img src="${_t.image}" class="customContextGridItemImage">
            `});ft.style.width=ut+"rem",ft.style.height=ut+"rem",ht.appendChild(ft),ft.onclick=()=>{var bt;return(bt=_t.onClick)===null||bt===void 0?void 0:bt.call(_t,_t.id)},tt(ft,_t,ht)}return(it=this.Elements)===null||it===void 0||it.push(ht),ht}static RemoveAll(o){if(o){const c=this.Elements.filter(d=>d.dataset.tag===o);for(const d of c)d.remove();this.Elements=this.Elements.filter(d=>d.dataset.tag!==o)}else{for(const c of this.Elements)c.remove();this.Elements=[]}}static RebuildUi(o){if(this.Elements.length===0)return;o||(o=ee$1({addToBody:!0,classList:["customContextGridParent"]}));for(const d of this.Elements)d.remove();this._container.innerHTML="",this._initializeStyles();let c=20;o.appendChild(this._container);for(const d of this.Elements)d.style.top=c+"px",this._container.appendChild(d),c+=d.clientHeight+20}}function getWindow(h){if(h==null)return window;if(h.toString()!=="[object Window]"){var o=h.ownerDocument;return o&&o.defaultView||window}return h}function isElement(h){return h instanceof getWindow(h).Element||h instanceof Element}function isHTMLElement(h){return h instanceof getWindow(h).HTMLElement||h instanceof HTMLElement}function isShadowRoot(h){return typeof ShadowRoot<"u"&&(h instanceof getWindow(h).ShadowRoot||h instanceof ShadowRoot)}CustomContextGrid.Elements=[],CustomContextGrid._container=document.createElement("div");var math_max=Math.max,math_min=Math.min,round=Math.round;function getUAString(){var h=navigator.userAgentData;return h!=null&&h.brands&&Array.isArray(h.brands)?h.brands.map(function(o){return o.brand+"/"+o.version}).join(" "):navigator.userAgent}function isLayoutViewport(){return!/^((?!chrome|android).)*safari/i.test(getUAString())}function getBoundingClientRect(h,o,c){o===void 0&&(o=!1),c===void 0&&(c=!1);var d=h.getBoundingClientRect(),_=1,v=1;o&&isHTMLElement(h)&&(_=h.offsetWidth>0&&round(d.width)/h.offsetWidth||1,v=h.offsetHeight>0&&round(d.height)/h.offsetHeight||1);var b=(isElement(h)?getWindow(h):window).visualViewport,tt=!isLayoutViewport()&&c,it=(d.left+(tt&&b?b.offsetLeft:0))/_,nt=(d.top+(tt&&b?b.offsetTop:0))/v,lt=d.width/_,ut=d.height/v;return{width:lt,height:ut,top:nt,right:it+lt,bottom:nt+ut,left:it,x:it,y:nt}}function getWindowScroll(h){var o=getWindow(h);return{scrollLeft:o.pageXOffset,scrollTop:o.pageYOffset}}function getHTMLElementScroll(h){return{scrollLeft:h.scrollLeft,scrollTop:h.scrollTop}}function getNodeScroll(h){return h!==getWindow(h)&&isHTMLElement(h)?getHTMLElementScroll(h):getWindowScroll(h)}function getNodeName(h){return h?(h.nodeName||"").toLowerCase():null}function getDocumentElement(h){return((isElement(h)?h.ownerDocument:h.document)||window.document).documentElement}function getWindowScrollBarX(h){return getBoundingClientRect(getDocumentElement(h)).left+getWindowScroll(h).scrollLeft}function getComputedStyle$1(h){return getWindow(h).getComputedStyle(h)}function isScrollParent(h){var o=getComputedStyle$1(h),c=o.overflow,d=o.overflowX,_=o.overflowY;return/auto|scroll|overlay|hidden/.test(c+_+d)}function isElementScaled(h){var o=h.getBoundingClientRect(),c=round(o.width)/h.offsetWidth||1,d=round(o.height)/h.offsetHeight||1;return c!==1||d!==1}function getCompositeRect(h,o,c){c===void 0&&(c=!1);var d=isHTMLElement(o),_=isHTMLElement(o)&&isElementScaled(o),v=getDocumentElement(o),b=getBoundingClientRect(h,_,c),tt={scrollLeft:0,scrollTop:0},it={x:0,y:0};return(d||!d&&!c)&&((getNodeName(o)!=="body"||isScrollParent(v))&&(tt=getNodeScroll(o)),isHTMLElement(o)?((it=getBoundingClientRect(o,!0)).x+=o.clientLeft,it.y+=o.clientTop):v&&(it.x=getWindowScrollBarX(v))),{x:b.left+tt.scrollLeft-it.x,y:b.top+tt.scrollTop-it.y,width:b.width,height:b.height}}function getLayoutRect(h){var o=getBoundingClientRect(h),c=h.offsetWidth,d=h.offsetHeight;return Math.abs(o.width-c)<=1&&(c=o.width),Math.abs(o.height-d)<=1&&(d=o.height),{x:h.offsetLeft,y:h.offsetTop,width:c,height:d}}function getParentNode(h){return getNodeName(h)==="html"?h:h.assignedSlot||h.parentNode||(isShadowRoot(h)?h.host:null)||getDocumentElement(h)}function getScrollParent(h){return["html","body","#document"].indexOf(getNodeName(h))>=0?h.ownerDocument.body:isHTMLElement(h)&&isScrollParent(h)?h:getScrollParent(getParentNode(h))}function listScrollParents(h,o){var c;o===void 0&&(o=[]);var d=getScrollParent(h),_=d===((c=h.ownerDocument)==null?void 0:c.body),v=getWindow(d),b=_?[v].concat(v.visualViewport||[],isScrollParent(d)?d:[]):d,tt=o.concat(b);return _?tt:tt.concat(listScrollParents(getParentNode(b)))}function isTableElement(h){return["table","td","th"].indexOf(getNodeName(h))>=0}function getTrueOffsetParent(h){return isHTMLElement(h)&&getComputedStyle$1(h).position!=="fixed"?h.offsetParent:null}function getContainingBlock(h){var o=/firefox/i.test(getUAString());if(/Trident/i.test(getUAString())&&isHTMLElement(h)&&getComputedStyle$1(h).position==="fixed")return null;var c=getParentNode(h);for(isShadowRoot(c)&&(c=c.host);isHTMLElement(c)&&["html","body"].indexOf(getNodeName(c))<0;){var d=getComputedStyle$1(c);if(d.transform!=="none"||d.perspective!=="none"||d.contain==="paint"||["transform","perspective"].indexOf(d.willChange)!==-1||o&&d.willChange==="filter"||o&&d.filter&&d.filter!=="none")return c;c=c.parentNode}return null}function getOffsetParent(h){for(var o=getWindow(h),c=getTrueOffsetParent(h);c&&isTableElement(c)&&getComputedStyle$1(c).position==="static";)c=getTrueOffsetParent(c);return c&&(getNodeName(c)==="html"||getNodeName(c)==="body"&&getComputedStyle$1(c).position==="static")?o:c||getContainingBlock(h)||o}var enums_top="top",bottom="bottom",right="right",left="left",auto$1="auto",basePlacements=[enums_top,bottom,right,left],start="start",end="end",clippingParents="clippingParents",viewport="viewport",popper="popper",reference="reference",variationPlacements=basePlacements.reduce(function(h,o){return h.concat([o+"-"+start,o+"-"+end])},[]),enums_placements=[].concat(basePlacements,[auto$1]).reduce(function(h,o){return h.concat([o,o+"-"+start,o+"-"+end])},[]),beforeRead="beforeRead",enums_read="read",afterRead="afterRead",beforeMain="beforeMain",main$1="main",afterMain="afterMain",beforeWrite="beforeWrite",write="write",afterWrite="afterWrite",modifierPhases=[beforeRead,enums_read,afterRead,beforeMain,main$1,afterMain,beforeWrite,write,afterWrite];function order(h){var o=new Map,c=new Set,d=[];function _(v){c.add(v.name),[].concat(v.requires||[],v.requiresIfExists||[]).forEach(function(b){if(!c.has(b)){var tt=o.get(b);tt&&_(tt)}}),d.push(v)}return h.forEach(function(v){o.set(v.name,v)}),h.forEach(function(v){c.has(v.name)||_(v)}),d}function orderModifiers(h){var o=order(h);return modifierPhases.reduce(function(c,d){return c.concat(o.filter(function(_){return _.phase===d}))},[])}function debounce(h){var o;return function(){return o||(o=new Promise(function(c){Promise.resolve().then(function(){o=void 0,c(h())})})),o}}function mergeByName(h){var o=h.reduce(function(c,d){var _=c[d.name];return c[d.name]=_?Object.assign({},_,d,{options:Object.assign({},_.options,d.options),data:Object.assign({},_.data,d.data)}):d,c},{});return Object.keys(o).map(function(c){return o[c]})}var DEFAULT_OPTIONS={placement:"bottom",modifiers:[],strategy:"absolute"};function areValidElements(){for(var h=arguments.length,o=new Array(h),c=0;c<h;c++)o[c]=arguments[c];return!o.some(function(d){return!(d&&typeof d.getBoundingClientRect=="function")})}function popperGenerator(h){h===void 0&&(h={});var o=h,c=o.defaultModifiers,d=c===void 0?[]:c,_=o.defaultOptions,v=_===void 0?DEFAULT_OPTIONS:_;return function(b,tt,it){it===void 0&&(it=v);var nt={placement:"bottom",orderedModifiers:[],options:Object.assign({},DEFAULT_OPTIONS,v),modifiersData:{},elements:{reference:b,popper:tt},attributes:{},styles:{}},lt=[],ut=!1,ht={state:nt,setOptions:function(ft){var bt=typeof ft=="function"?ft(nt.options):ft;_t(),nt.options=Object.assign({},v,nt.options,bt),nt.scrollParents={reference:isElement(b)?listScrollParents(b):b.contextElement?listScrollParents(b.contextElement):[],popper:listScrollParents(tt)};var xt=orderModifiers(mergeByName([].concat(d,nt.options.modifiers)));return nt.orderedModifiers=xt.filter(function(St){return St.enabled}),nt.orderedModifiers.forEach(function(St){var wt=St.name,Pt=St.options,Rt=Pt===void 0?{}:Pt,kt=St.effect;if(typeof kt=="function"){var Gt=kt({state:nt,name:wt,instance:ht,options:Rt});lt.push(Gt||function(){})}}),ht.update()},forceUpdate:function(){if(!ut){var ft=nt.elements,bt=ft.reference,xt=ft.popper;if(areValidElements(bt,xt)){nt.rects={reference:getCompositeRect(bt,getOffsetParent(xt),nt.options.strategy==="fixed"),popper:getLayoutRect(xt)},nt.reset=!1,nt.placement=nt.options.placement,nt.orderedModifiers.forEach(function(Dt){return nt.modifiersData[Dt.name]=Object.assign({},Dt.data)});for(var St=0;St<nt.orderedModifiers.length;St++)if(nt.reset!==!0){var wt=nt.orderedModifiers[St],Pt=wt.fn,Rt=wt.options,kt=Rt===void 0?{}:Rt,Gt=wt.name;typeof Pt=="function"&&(nt=Pt({state:nt,options:kt,name:Gt,instance:ht})||nt)}else nt.reset=!1,St=-1}}},update:debounce(function(){return new Promise(function(ft){ht.forceUpdate(),ft(nt)})}),destroy:function(){_t(),ut=!0}};if(!areValidElements(b,tt))return ht;function _t(){lt.forEach(function(ft){return ft()}),lt=[]}return ht.setOptions(it).then(function(ft){!ut&&it.onFirstUpdate&&it.onFirstUpdate(ft)}),ht}}var createPopper=popperGenerator(),passive={passive:!0};function effect(h){var o=h.state,c=h.instance,d=h.options,_=d.scroll,v=_===void 0||_,b=d.resize,tt=b===void 0||b,it=getWindow(o.elements.popper),nt=[].concat(o.scrollParents.reference,o.scrollParents.popper);return v&&nt.forEach(function(lt){lt.addEventListener("scroll",c.update,passive)}),tt&&it.addEventListener("resize",c.update,passive),function(){v&&nt.forEach(function(lt){lt.removeEventListener("scroll",c.update,passive)}),tt&&it.removeEventListener("resize",c.update,passive)}}var eventListeners={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect,data:{}};function getBasePlacement(h){return h.split("-")[0]}function getVariation(h){return h.split("-")[1]}function getMainAxisFromPlacement(h){return["top","bottom"].indexOf(h)>=0?"x":"y"}function computeOffsets(h){var o,c=h.reference,d=h.element,_=h.placement,v=_?getBasePlacement(_):null,b=_?getVariation(_):null,tt=c.x+c.width/2-d.width/2,it=c.y+c.height/2-d.height/2;switch(v){case enums_top:o={x:tt,y:c.y-d.height};break;case bottom:o={x:tt,y:c.y+c.height};break;case right:o={x:c.x+c.width,y:it};break;case left:o={x:c.x-d.width,y:it};break;default:o={x:c.x,y:c.y}}var nt=v?getMainAxisFromPlacement(v):null;if(nt!=null){var lt=nt==="y"?"height":"width";switch(b){case start:o[nt]=o[nt]-(c[lt]/2-d[lt]/2);break;case end:o[nt]=o[nt]+(c[lt]/2-d[lt]/2)}}return o}function popperOffsets(h){var o=h.state,c=h.name;o.modifiersData[c]=computeOffsets({reference:o.rects.reference,element:o.rects.popper,strategy:"absolute",placement:o.placement})}var modifiers_popperOffsets={name:"popperOffsets",enabled:!0,phase:"read",fn:popperOffsets,data:{}},unsetSides={top:"auto",right:"auto",bottom:"auto",left:"auto"};function roundOffsetsByDPR(h,o){var c=h.x,d=h.y,_=o.devicePixelRatio||1;return{x:round(c*_)/_||0,y:round(d*_)/_||0}}function mapToStyles(h){var o,c=h.popper,d=h.popperRect,_=h.placement,v=h.variation,b=h.offsets,tt=h.position,it=h.gpuAcceleration,nt=h.adaptive,lt=h.roundOffsets,ut=h.isFixed,ht=b.x,_t=ht===void 0?0:ht,ft=b.y,bt=ft===void 0?0:ft,xt=typeof lt=="function"?lt({x:_t,y:bt}):{x:_t,y:bt};_t=xt.x,bt=xt.y;var St=b.hasOwnProperty("x"),wt=b.hasOwnProperty("y"),Pt=left,Rt=enums_top,kt=window;if(nt){var Gt=getOffsetParent(c),Dt="clientHeight",It="clientWidth";Gt===getWindow(c)&&getComputedStyle$1(Gt=getDocumentElement(c)).position!=="static"&&tt==="absolute"&&(Dt="scrollHeight",It="scrollWidth"),(_===enums_top||(_===left||_===right)&&v===end)&&(Rt=bottom,bt-=(ut&&Gt===kt&&kt.visualViewport?kt.visualViewport.height:Gt[Dt])-d.height,bt*=it?1:-1),_!==left&&(_!==enums_top&&_!==bottom||v!==end)||(Pt=right,_t-=(ut&&Gt===kt&&kt.visualViewport?kt.visualViewport.width:Gt[It])-d.width,_t*=it?1:-1)}var Nt,Vt=Object.assign({position:tt},nt&&unsetSides),Kt=lt===!0?roundOffsetsByDPR({x:_t,y:bt},getWindow(c)):{x:_t,y:bt};return _t=Kt.x,bt=Kt.y,it?Object.assign({},Vt,((Nt={})[Rt]=wt?"0":"",Nt[Pt]=St?"0":"",Nt.transform=(kt.devicePixelRatio||1)<=1?"translate("+_t+"px, "+bt+"px)":"translate3d("+_t+"px, "+bt+"px, 0)",Nt)):Object.assign({},Vt,((o={})[Rt]=wt?bt+"px":"",o[Pt]=St?_t+"px":"",o.transform="",o))}function computeStyles(h){var o=h.state,c=h.options,d=c.gpuAcceleration,_=d===void 0||d,v=c.adaptive,b=v===void 0||v,tt=c.roundOffsets,it=tt===void 0||tt,nt={placement:getBasePlacement(o.placement),variation:getVariation(o.placement),popper:o.elements.popper,popperRect:o.rects.popper,gpuAcceleration:_,isFixed:o.options.strategy==="fixed"};o.modifiersData.popperOffsets!=null&&(o.styles.popper=Object.assign({},o.styles.popper,mapToStyles(Object.assign({},nt,{offsets:o.modifiersData.popperOffsets,position:o.options.strategy,adaptive:b,roundOffsets:it})))),o.modifiersData.arrow!=null&&(o.styles.arrow=Object.assign({},o.styles.arrow,mapToStyles(Object.assign({},nt,{offsets:o.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:it})))),o.attributes.popper=Object.assign({},o.attributes.popper,{"data-popper-placement":o.placement})}var modifiers_computeStyles={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:computeStyles,data:{}};function applyStyles(h){var o=h.state;Object.keys(o.elements).forEach(function(c){var d=o.styles[c]||{},_=o.attributes[c]||{},v=o.elements[c];isHTMLElement(v)&&getNodeName(v)&&(Object.assign(v.style,d),Object.keys(_).forEach(function(b){var tt=_[b];tt===!1?v.removeAttribute(b):v.setAttribute(b,tt===!0?"":tt)}))})}function applyStyles_effect(h){var o=h.state,c={popper:{position:o.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(o.elements.popper.style,c.popper),o.styles=c,o.elements.arrow&&Object.assign(o.elements.arrow.style,c.arrow),function(){Object.keys(o.elements).forEach(function(d){var _=o.elements[d],v=o.attributes[d]||{},b=Object.keys(o.styles.hasOwnProperty(d)?o.styles[d]:c[d]).reduce(function(tt,it){return tt[it]="",tt},{});isHTMLElement(_)&&getNodeName(_)&&(Object.assign(_.style,b),Object.keys(v).forEach(function(tt){_.removeAttribute(tt)}))})}}var modifiers_applyStyles={name:"applyStyles",enabled:!0,phase:"write",fn:applyStyles,effect:applyStyles_effect,requires:["computeStyles"]};function distanceAndSkiddingToXY(h,o,c){var d=getBasePlacement(h),_=[left,enums_top].indexOf(d)>=0?-1:1,v=typeof c=="function"?c(Object.assign({},o,{placement:h})):c,b=v[0],tt=v[1];return b=b||0,tt=(tt||0)*_,[left,right].indexOf(d)>=0?{x:tt,y:b}:{x:b,y:tt}}function offset(h){var o=h.state,c=h.options,d=h.name,_=c.offset,v=_===void 0?[0,0]:_,b=enums_placements.reduce(function(lt,ut){return lt[ut]=distanceAndSkiddingToXY(ut,o.rects,v),lt},{}),tt=b[o.placement],it=tt.x,nt=tt.y;o.modifiersData.popperOffsets!=null&&(o.modifiersData.popperOffsets.x+=it,o.modifiersData.popperOffsets.y+=nt),o.modifiersData[d]=b}var modifiers_offset={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:offset},getOppositePlacement_hash={left:"right",right:"left",bottom:"top",top:"bottom"};function getOppositePlacement(h){return h.replace(/left|right|bottom|top/g,function(o){return getOppositePlacement_hash[o]})}var getOppositeVariationPlacement_hash={start:"end",end:"start"};function getOppositeVariationPlacement(h){return h.replace(/start|end/g,function(o){return getOppositeVariationPlacement_hash[o]})}function getViewportRect(h,o){var c=getWindow(h),d=getDocumentElement(h),_=c.visualViewport,v=d.clientWidth,b=d.clientHeight,tt=0,it=0;if(_){v=_.width,b=_.height;var nt=isLayoutViewport();(nt||!nt&&o==="fixed")&&(tt=_.offsetLeft,it=_.offsetTop)}return{width:v,height:b,x:tt+getWindowScrollBarX(h),y:it}}function getDocumentRect(h){var o,c=getDocumentElement(h),d=getWindowScroll(h),_=(o=h.ownerDocument)==null?void 0:o.body,v=math_max(c.scrollWidth,c.clientWidth,_?_.scrollWidth:0,_?_.clientWidth:0),b=math_max(c.scrollHeight,c.clientHeight,_?_.scrollHeight:0,_?_.clientHeight:0),tt=-d.scrollLeft+getWindowScrollBarX(h),it=-d.scrollTop;return getComputedStyle$1(_||c).direction==="rtl"&&(tt+=math_max(c.clientWidth,_?_.clientWidth:0)-v),{width:v,height:b,x:tt,y:it}}function contains(h,o){var c=o.getRootNode&&o.getRootNode();if(h.contains(o))return!0;if(c&&isShadowRoot(c)){var d=o;do{if(d&&h.isSameNode(d))return!0;d=d.parentNode||d.host}while(d)}return!1}function rectToClientRect(h){return Object.assign({},h,{left:h.x,top:h.y,right:h.x+h.width,bottom:h.y+h.height})}function getInnerBoundingClientRect(h,o){var c=getBoundingClientRect(h,!1,o==="fixed");return c.top=c.top+h.clientTop,c.left=c.left+h.clientLeft,c.bottom=c.top+h.clientHeight,c.right=c.left+h.clientWidth,c.width=h.clientWidth,c.height=h.clientHeight,c.x=c.left,c.y=c.top,c}function getClientRectFromMixedType(h,o,c){return o===viewport?rectToClientRect(getViewportRect(h,c)):isElement(o)?getInnerBoundingClientRect(o,c):rectToClientRect(getDocumentRect(getDocumentElement(h)))}function getClippingParents(h){var o=listScrollParents(getParentNode(h)),c=["absolute","fixed"].indexOf(getComputedStyle$1(h).position)>=0&&isHTMLElement(h)?getOffsetParent(h):h;return isElement(c)?o.filter(function(d){return isElement(d)&&contains(d,c)&&getNodeName(d)!=="body"}):[]}function getClippingRect(h,o,c,d){var _=o==="clippingParents"?getClippingParents(h):[].concat(o),v=[].concat(_,[c]),b=v[0],tt=v.reduce(function(it,nt){var lt=getClientRectFromMixedType(h,nt,d);return it.top=math_max(lt.top,it.top),it.right=math_min(lt.right,it.right),it.bottom=math_min(lt.bottom,it.bottom),it.left=math_max(lt.left,it.left),it},getClientRectFromMixedType(h,b,d));return tt.width=tt.right-tt.left,tt.height=tt.bottom-tt.top,tt.x=tt.left,tt.y=tt.top,tt}function getFreshSideObject(){return{top:0,right:0,bottom:0,left:0}}function mergePaddingObject(h){return Object.assign({},getFreshSideObject(),h)}function expandToHashMap(h,o){return o.reduce(function(c,d){return c[d]=h,c},{})}function detectOverflow(h,o){o===void 0&&(o={});var c=o,d=c.placement,_=d===void 0?h.placement:d,v=c.strategy,b=v===void 0?h.strategy:v,tt=c.boundary,it=tt===void 0?clippingParents:tt,nt=c.rootBoundary,lt=nt===void 0?viewport:nt,ut=c.elementContext,ht=ut===void 0?popper:ut,_t=c.altBoundary,ft=_t!==void 0&&_t,bt=c.padding,xt=bt===void 0?0:bt,St=mergePaddingObject(typeof xt!="number"?xt:expandToHashMap(xt,basePlacements)),wt=ht===popper?reference:popper,Pt=h.rects.popper,Rt=h.elements[ft?wt:ht],kt=getClippingRect(isElement(Rt)?Rt:Rt.contextElement||getDocumentElement(h.elements.popper),it,lt,b),Gt=getBoundingClientRect(h.elements.reference),Dt=computeOffsets({reference:Gt,element:Pt,strategy:"absolute",placement:_}),It=rectToClientRect(Object.assign({},Pt,Dt)),Nt=ht===popper?It:Gt,Vt={top:kt.top-Nt.top+St.top,bottom:Nt.bottom-kt.bottom+St.bottom,left:kt.left-Nt.left+St.left,right:Nt.right-kt.right+St.right},Kt=h.modifiersData.offset;if(ht===popper&&Kt){var Yt=Kt[_];Object.keys(Vt).forEach(function(nr){var rr=[right,bottom].indexOf(nr)>=0?1:-1,lr=[enums_top,bottom].indexOf(nr)>=0?"y":"x";Vt[nr]+=Yt[lr]*rr})}return Vt}function computeAutoPlacement(h,o){o===void 0&&(o={});var c=o,d=c.placement,_=c.boundary,v=c.rootBoundary,b=c.padding,tt=c.flipVariations,it=c.allowedAutoPlacements,nt=it===void 0?enums_placements:it,lt=getVariation(d),ut=lt?tt?variationPlacements:variationPlacements.filter(function(ft){return getVariation(ft)===lt}):basePlacements,ht=ut.filter(function(ft){return nt.indexOf(ft)>=0});ht.length===0&&(ht=ut);var _t=ht.reduce(function(ft,bt){return ft[bt]=detectOverflow(h,{placement:bt,boundary:_,rootBoundary:v,padding:b})[getBasePlacement(bt)],ft},{});return Object.keys(_t).sort(function(ft,bt){return _t[ft]-_t[bt]})}function getExpandedFallbackPlacements(h){if(getBasePlacement(h)===auto$1)return[];var o=getOppositePlacement(h);return[getOppositeVariationPlacement(h),o,getOppositeVariationPlacement(o)]}function flip(h){var o=h.state,c=h.options,d=h.name;if(!o.modifiersData[d]._skip){for(var _=c.mainAxis,v=_===void 0||_,b=c.altAxis,tt=b===void 0||b,it=c.fallbackPlacements,nt=c.padding,lt=c.boundary,ut=c.rootBoundary,ht=c.altBoundary,_t=c.flipVariations,ft=_t===void 0||_t,bt=c.allowedAutoPlacements,xt=o.options.placement,St=getBasePlacement(xt),wt=it||(St!==xt&&ft?getExpandedFallbackPlacements(xt):[getOppositePlacement(xt)]),Pt=[xt].concat(wt).reduce(function(br,fr){return br.concat(getBasePlacement(fr)===auto$1?computeAutoPlacement(o,{placement:fr,boundary:lt,rootBoundary:ut,padding:nt,flipVariations:ft,allowedAutoPlacements:bt}):fr)},[]),Rt=o.rects.reference,kt=o.rects.popper,Gt=new Map,Dt=!0,It=Pt[0],Nt=0;Nt<Pt.length;Nt++){var Vt=Pt[Nt],Kt=getBasePlacement(Vt),Yt=getVariation(Vt)===start,nr=[enums_top,bottom].indexOf(Kt)>=0,rr=nr?"width":"height",lr=detectOverflow(o,{placement:Vt,boundary:lt,rootBoundary:ut,altBoundary:ht,padding:nt}),or=nr?Yt?right:left:Yt?bottom:enums_top;Rt[rr]>kt[rr]&&(or=getOppositePlacement(or));var pr=getOppositePlacement(or),hr=[];if(v&&hr.push(lr[Kt]<=0),tt&&hr.push(lr[or]<=0,lr[pr]<=0),hr.every(function(br){return br})){It=Vt,Dt=!1;break}Gt.set(Vt,hr)}if(Dt)for(var ur=function(br){var fr=Pt.find(function(kr){var gr=Gt.get(kr);if(gr)return gr.slice(0,br).every(function(tr){return tr})});if(fr)return It=fr,"break"},cr=ft?3:1;cr>0&&ur(cr)!=="break";cr--);o.placement!==It&&(o.modifiersData[d]._skip=!0,o.placement=It,o.reset=!0)}}var modifiers_flip={name:"flip",enabled:!0,phase:"main",fn:flip,requiresIfExists:["offset"],data:{_skip:!1}};function getAltAxis(h){return h==="x"?"y":"x"}function within(h,o,c){return math_max(h,math_min(o,c))}function withinMaxClamp(h,o,c){var d=within(h,o,c);return d>c?c:d}function preventOverflow(h){var o=h.state,c=h.options,d=h.name,_=c.mainAxis,v=_===void 0||_,b=c.altAxis,tt=b!==void 0&&b,it=c.boundary,nt=c.rootBoundary,lt=c.altBoundary,ut=c.padding,ht=c.tether,_t=ht===void 0||ht,ft=c.tetherOffset,bt=ft===void 0?0:ft,xt=detectOverflow(o,{boundary:it,rootBoundary:nt,padding:ut,altBoundary:lt}),St=getBasePlacement(o.placement),wt=getVariation(o.placement),Pt=!wt,Rt=getMainAxisFromPlacement(St),kt=getAltAxis(Rt),Gt=o.modifiersData.popperOffsets,Dt=o.rects.reference,It=o.rects.popper,Nt=typeof bt=="function"?bt(Object.assign({},o.rects,{placement:o.placement})):bt,Vt=typeof Nt=="number"?{mainAxis:Nt,altAxis:Nt}:Object.assign({mainAxis:0,altAxis:0},Nt),Kt=o.modifiersData.offset?o.modifiersData.offset[o.placement]:null,Yt={x:0,y:0};if(Gt){if(v){var nr,rr=Rt==="y"?enums_top:left,lr=Rt==="y"?bottom:right,or=Rt==="y"?"height":"width",pr=Gt[Rt],hr=pr+xt[rr],ur=pr-xt[lr],cr=_t?-It[or]/2:0,br=wt===start?Dt[or]:It[or],fr=wt===start?-It[or]:-Dt[or],kr=o.elements.arrow,gr=_t&&kr?getLayoutRect(kr):{width:0,height:0},tr=o.modifiersData["arrow#persistent"]?o.modifiersData["arrow#persistent"].padding:getFreshSideObject(),dr=tr[rr],Ir=tr[lr],Xr=within(0,Dt[or],gr[or]),Jr=Pt?Dt[or]/2-cr-Xr-dr-Vt.mainAxis:br-Xr-dr-Vt.mainAxis,on=Pt?-Dt[or]/2+cr+Xr+Ir+Vt.mainAxis:fr+Xr+Ir+Vt.mainAxis,Pn=o.elements.arrow&&getOffsetParent(o.elements.arrow),vn=Pn?Rt==="y"?Pn.clientTop||0:Pn.clientLeft||0:0,Gn=(nr=Kt==null?void 0:Kt[Rt])!=null?nr:0,ms=pr+on-Gn,ar=within(_t?math_min(hr,pr+Jr-Gn-vn):hr,pr,_t?math_max(ur,ms):ur);Gt[Rt]=ar,Yt[Rt]=ar-pr}if(tt){var vr,Cr=Rt==="x"?enums_top:left,Ur=Rt==="x"?bottom:right,Pr=Gt[kt],Dr=kt==="y"?"height":"width",jr=Pr+xt[Cr],en=Pr-xt[Ur],rn=[enums_top,left].indexOf(St)!==-1,mn=(vr=Kt==null?void 0:Kt[kt])!=null?vr:0,bn=rn?jr:Pr-Dt[Dr]-It[Dr]-mn+Vt.altAxis,Tn=rn?Pr+Dt[Dr]+It[Dr]-mn-Vt.altAxis:en,xn=_t&&rn?withinMaxClamp(bn,Pr,Tn):within(_t?bn:jr,Pr,_t?Tn:en);Gt[kt]=xn,Yt[kt]=xn-Pr}o.modifiersData[d]=Yt}}var modifiers_preventOverflow={name:"preventOverflow",enabled:!0,phase:"main",fn:preventOverflow,requiresIfExists:["offset"]},toPaddingObject=function(h,o){return mergePaddingObject(typeof(h=typeof h=="function"?h(Object.assign({},o.rects,{placement:o.placement})):h)!="number"?h:expandToHashMap(h,basePlacements))};function arrow(h){var o,c=h.state,d=h.name,_=h.options,v=c.elements.arrow,b=c.modifiersData.popperOffsets,tt=getBasePlacement(c.placement),it=getMainAxisFromPlacement(tt),nt=[left,right].indexOf(tt)>=0?"height":"width";if(v&&b){var lt=toPaddingObject(_.padding,c),ut=getLayoutRect(v),ht=it==="y"?enums_top:left,_t=it==="y"?bottom:right,ft=c.rects.reference[nt]+c.rects.reference[it]-b[it]-c.rects.popper[nt],bt=b[it]-c.rects.reference[it],xt=getOffsetParent(v),St=xt?it==="y"?xt.clientHeight||0:xt.clientWidth||0:0,wt=ft/2-bt/2,Pt=lt[ht],Rt=St-ut[nt]-lt[_t],kt=St/2-ut[nt]/2+wt,Gt=within(Pt,kt,Rt),Dt=it;c.modifiersData[d]=((o={})[Dt]=Gt,o.centerOffset=Gt-kt,o)}}function arrow_effect(h){var o=h.state,c=h.options.element,d=c===void 0?"[data-popper-arrow]":c;d!=null&&(typeof d!="string"||(d=o.elements.popper.querySelector(d)))&&contains(o.elements.popper,d)&&(o.elements.arrow=d)}var modifiers_arrow={name:"arrow",enabled:!0,phase:"main",fn:arrow,effect:arrow_effect,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function getSideOffsets(h,o,c){return c===void 0&&(c={x:0,y:0}),{top:h.top-o.height-c.y,right:h.right-o.width+c.x,bottom:h.bottom-o.height+c.y,left:h.left-o.width-c.x}}function isAnySideFullyClipped(h){return[enums_top,right,bottom,left].some(function(o){return h[o]>=0})}function hide(h){var o=h.state,c=h.name,d=o.rects.reference,_=o.rects.popper,v=o.modifiersData.preventOverflow,b=detectOverflow(o,{elementContext:"reference"}),tt=detectOverflow(o,{altBoundary:!0}),it=getSideOffsets(b,d),nt=getSideOffsets(tt,_,v),lt=isAnySideFullyClipped(it),ut=isAnySideFullyClipped(nt);o.modifiersData[c]={referenceClippingOffsets:it,popperEscapeOffsets:nt,isReferenceHidden:lt,hasPopperEscaped:ut},o.attributes.popper=Object.assign({},o.attributes.popper,{"data-popper-reference-hidden":lt,"data-popper-escaped":ut})}var modifiers_hide={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:hide},defaultModifiers=[eventListeners,modifiers_popperOffsets,modifiers_computeStyles,modifiers_applyStyles,modifiers_offset,modifiers_flip,modifiers_preventOverflow,modifiers_arrow,modifiers_hide],popper_createPopper=popperGenerator({defaultModifiers}),BOX_CLASS="tippy-box",CONTENT_CLASS="tippy-content",BACKDROP_CLASS="tippy-backdrop",ARROW_CLASS="tippy-arrow",SVG_ARROW_CLASS="tippy-svg-arrow",TOUCH_OPTIONS={passive:!0,capture:!0},TIPPY_DEFAULT_APPEND_TO=function(){return document.body};function getValueAtIndexOrReturn(h,o,c){if(Array.isArray(h)){var d=h[o];return d??(Array.isArray(c)?c[o]:c)}return h}function isType(h,o){var c={}.toString.call(h);return c.indexOf("[object")===0&&c.indexOf(o+"]")>-1}function invokeWithArgsOrReturn(h,o){return typeof h=="function"?h.apply(void 0,o):h}function tippy_esm_debounce(h,o){return o===0?h:function(d){clearTimeout(c),c=setTimeout(function(){h(d)},o)};var c}function removeProperties(h,o){var c=Object.assign({},h);return o.forEach(function(d){delete c[d]}),c}function splitBySpaces(h){return h.split(/\s+/).filter(Boolean)}function normalizeToArray(h){return[].concat(h)}function pushIfUnique(h,o){h.indexOf(o)===-1&&h.push(o)}function unique(h){return h.filter(function(o,c){return h.indexOf(o)===c})}function tippy_esm_getBasePlacement(h){return h.split("-")[0]}function arrayFrom(h){return[].slice.call(h)}function removeUndefinedProps(h){return Object.keys(h).reduce(function(o,c){return h[c]!==void 0&&(o[c]=h[c]),o},{})}function div(){return document.createElement("div")}function tippy_esm_isElement(h){return["Element","Fragment"].some(function(o){return isType(h,o)})}function isNodeList(h){return isType(h,"NodeList")}function isMouseEvent(h){return isType(h,"MouseEvent")}function isReferenceElement(h){return!(!h||!h._tippy||h._tippy.reference!==h)}function getArrayOfElements(h){return tippy_esm_isElement(h)?[h]:isNodeList(h)?arrayFrom(h):Array.isArray(h)?h:arrayFrom(document.querySelectorAll(h))}function setTransitionDuration(h,o){h.forEach(function(c){c&&(c.style.transitionDuration=o+"ms")})}function setVisibilityState(h,o){h.forEach(function(c){c&&c.setAttribute("data-state",o)})}function getOwnerDocument(h){var o,c=normalizeToArray(h)[0];return c!=null&&(o=c.ownerDocument)!=null&&o.body?c.ownerDocument:document}function isCursorOutsideInteractiveBorder(h,o){var c=o.clientX,d=o.clientY;return h.every(function(_){var v=_.popperRect,b=_.popperState,tt=_.props.interactiveBorder,it=tippy_esm_getBasePlacement(b.placement),nt=b.modifiersData.offset;if(!nt)return!0;var lt=it==="bottom"?nt.top.y:0,ut=it==="top"?nt.bottom.y:0,ht=it==="right"?nt.left.x:0,_t=it==="left"?nt.right.x:0,ft=v.top-d+lt>tt,bt=d-v.bottom-ut>tt,xt=v.left-c+ht>tt,St=c-v.right-_t>tt;return ft||bt||xt||St})}function updateTransitionEndListener(h,o,c){var d=o+"EventListener";["transitionend","webkitTransitionEnd"].forEach(function(_){h[d](_,c)})}function actualContains(h,o){for(var c=o;c;){var d;if(h.contains(c))return!0;c=c.getRootNode==null||(d=c.getRootNode())==null?void 0:d.host}return!1}var currentInput={isTouch:!1},lastMouseMoveTime=0;function onDocumentTouchStart(){currentInput.isTouch||(currentInput.isTouch=!0,window.performance&&document.addEventListener("mousemove",onDocumentMouseMove))}function onDocumentMouseMove(){var h=performance.now();h-lastMouseMoveTime<20&&(currentInput.isTouch=!1,document.removeEventListener("mousemove",onDocumentMouseMove)),lastMouseMoveTime=h}function onWindowBlur(){var h=document.activeElement;if(isReferenceElement(h)){var o=h._tippy;h.blur&&!o.state.isVisible&&h.blur()}}function bindGlobalEventListeners(){document.addEventListener("touchstart",onDocumentTouchStart,TOUCH_OPTIONS),window.addEventListener("blur",onWindowBlur)}var isBrowser$1=typeof window<"u"&&typeof document<"u",isIE11=!!isBrowser$1&&!!window.msCrypto,pluginProps={animateFill:!1,followCursor:!1,inlinePositioning:!1,sticky:!1},renderProps={allowHTML:!1,animation:"fade",arrow:!0,content:"",inertia:!1,maxWidth:350,role:"tooltip",theme:"",zIndex:9999},defaultProps$1=Object.assign({appendTo:TIPPY_DEFAULT_APPEND_TO,aria:{content:"auto",expanded:"auto"},delay:0,duration:[300,250],getReferenceClientRect:null,hideOnClick:!0,ignoreAttributes:!1,interactive:!1,interactiveBorder:2,interactiveDebounce:0,moveTransition:"",offset:[0,10],onAfterUpdate:function(){},onBeforeUpdate:function(){},onCreate:function(){},onDestroy:function(){},onHidden:function(){},onHide:function(){},onMount:function(){},onShow:function(){},onShown:function(){},onTrigger:function(){},onUntrigger:function(){},onClickOutside:function(){},placement:"top",plugins:[],popperOptions:{},render:null,showOnCreate:!1,touch:!0,trigger:"mouseenter focus",triggerTarget:null},pluginProps,renderProps),defaultKeys=Object.keys(defaultProps$1),setDefaultProps=function(h){Object.keys(h).forEach(function(o){defaultProps$1[o]=h[o]})};function getExtendedPassedProps(h){var o=(h.plugins||[]).reduce(function(c,d){var _,v=d.name,b=d.defaultValue;return v&&(c[v]=h[v]!==void 0?h[v]:(_=defaultProps$1[v])!=null?_:b),c},{});return Object.assign({},h,o)}function getDataAttributeProps(h,o){return(o?Object.keys(getExtendedPassedProps(Object.assign({},defaultProps$1,{plugins:o}))):defaultKeys).reduce(function(c,d){var _=(h.getAttribute("data-tippy-"+d)||"").trim();if(!_)return c;if(d==="content")c[d]=_;else try{c[d]=JSON.parse(_)}catch{c[d]=_}return c},{})}function evaluateProps(h,o){var c=Object.assign({},o,{content:invokeWithArgsOrReturn(o.content,[h])},o.ignoreAttributes?{}:getDataAttributeProps(h,o.plugins));return c.aria=Object.assign({},defaultProps$1.aria,c.aria),c.aria={expanded:c.aria.expanded==="auto"?o.interactive:c.aria.expanded,content:c.aria.content==="auto"?o.interactive?null:"describedby":c.aria.content},c}var innerHTML=function(){return"innerHTML"};function dangerouslySetInnerHTML(h,o){h[innerHTML()]=o}function createArrowElement(h){var o=div();return h===!0?o.className=ARROW_CLASS:(o.className=SVG_ARROW_CLASS,tippy_esm_isElement(h)?o.appendChild(h):dangerouslySetInnerHTML(o,h)),o}function setContent(h,o){tippy_esm_isElement(o.content)?(dangerouslySetInnerHTML(h,""),h.appendChild(o.content)):typeof o.content!="function"&&(o.allowHTML?dangerouslySetInnerHTML(h,o.content):h.textContent=o.content)}function getChildren(h){var o=h.firstElementChild,c=arrayFrom(o.children);return{box:o,content:c.find(function(d){return d.classList.contains(CONTENT_CLASS)}),arrow:c.find(function(d){return d.classList.contains(ARROW_CLASS)||d.classList.contains(SVG_ARROW_CLASS)}),backdrop:c.find(function(d){return d.classList.contains(BACKDROP_CLASS)})}}function render(h){var o=div(),c=div();c.className=BOX_CLASS,c.setAttribute("data-state","hidden"),c.setAttribute("tabindex","-1");var d=div();function _(v,b){var tt=getChildren(o),it=tt.box,nt=tt.content,lt=tt.arrow;b.theme?it.setAttribute("data-theme",b.theme):it.removeAttribute("data-theme"),typeof b.animation=="string"?it.setAttribute("data-animation",b.animation):it.removeAttribute("data-animation"),b.inertia?it.setAttribute("data-inertia",""):it.removeAttribute("data-inertia"),it.style.maxWidth=typeof b.maxWidth=="number"?b.maxWidth+"px":b.maxWidth,b.role?it.setAttribute("role",b.role):it.removeAttribute("role"),v.content===b.content&&v.allowHTML===b.allowHTML||setContent(nt,h.props),b.arrow?lt?v.arrow!==b.arrow&&(it.removeChild(lt),it.appendChild(createArrowElement(b.arrow))):it.appendChild(createArrowElement(b.arrow)):lt&&it.removeChild(lt)}return d.className=CONTENT_CLASS,d.setAttribute("data-state","hidden"),setContent(d,h.props),o.appendChild(c),c.appendChild(d),_(h.props,h.props),{popper:o,onUpdate:_}}render.$$tippy=!0;var idCounter=1,mouseMoveListeners=[],mountedInstances=[];function createTippy(h,o){var c,d,_,v,b,tt,it,nt=evaluateProps(h,Object.assign({},defaultProps$1,getExtendedPassedProps(removeUndefinedProps(o)))),lt=!1,ut=!1,ht=!1,_t=!1,ft=[],bt=tippy_esm_debounce(on,nt.interactiveDebounce),xt=idCounter++,St=unique(nt.plugins),wt={id:xt,reference:h,popper:div(),popperInstance:null,props:nt,state:{isEnabled:!0,isVisible:!1,isDestroyed:!1,isMounted:!1,isShown:!1},plugins:St,clearDelayTimeouts:function(){clearTimeout(c),clearTimeout(d),cancelAnimationFrame(_)},setProps:function(Pr){if(!wt.state.isDestroyed){or("onBeforeUpdate",[wt,Pr]),Xr();var Dr=wt.props,jr=evaluateProps(h,Object.assign({},Dr,removeUndefinedProps(Pr),{ignoreAttributes:!0}));wt.props=jr,Ir(),Dr.interactiveDebounce!==jr.interactiveDebounce&&(ur(),bt=tippy_esm_debounce(on,jr.interactiveDebounce)),Dr.triggerTarget&&!jr.triggerTarget?normalizeToArray(Dr.triggerTarget).forEach(function(en){en.removeAttribute("aria-expanded")}):jr.triggerTarget&&h.removeAttribute("aria-expanded"),hr(),lr(),kt&&kt(Dr,jr),wt.popperInstance&&(ms(),vr().forEach(function(en){requestAnimationFrame(en._tippy.popperInstance.forceUpdate)})),or("onAfterUpdate",[wt,Pr])}},setContent:function(Pr){wt.setProps({content:Pr})},show:function(){var Pr=wt.state.isVisible,Dr=wt.state.isDestroyed,jr=!wt.state.isEnabled,en=currentInput.isTouch&&!wt.props.touch,rn=getValueAtIndexOrReturn(wt.props.duration,0,defaultProps$1.duration);if(!(Pr||Dr||jr||en||Kt().hasAttribute("disabled")||(or("onShow",[wt],!1),wt.props.onShow(wt)===!1))){if(wt.state.isVisible=!0,Vt()&&(Rt.style.visibility="visible"),lr(),kr(),wt.state.isMounted||(Rt.style.transition="none"),Vt()){var mn=nr();setTransitionDuration([mn.box,mn.content],0)}var bn,Tn,xn;tt=function(){var fn;if(wt.state.isVisible&&!_t){if(_t=!0,Rt.offsetHeight,Rt.style.transition=wt.props.moveTransition,Vt()&&wt.props.animation){var En=nr(),tn=En.box,wn=En.content;setTransitionDuration([tn,wn],rn),setVisibilityState([tn,wn],"visible")}pr(),hr(),pushIfUnique(mountedInstances,wt),(fn=wt.popperInstance)==null||fn.forceUpdate(),or("onMount",[wt]),wt.props.animation&&Vt()&&function(Vn){tr(Vn,function(){wt.state.isShown=!0,or("onShown",[wt])})}(rn)}},Tn=wt.props.appendTo,xn=Kt(),(bn=wt.props.interactive&&Tn===TIPPY_DEFAULT_APPEND_TO||Tn==="parent"?xn.parentNode:invokeWithArgsOrReturn(Tn,[xn])).contains(Rt)||bn.appendChild(Rt),wt.state.isMounted=!0,ms()}},hide:function(){var Pr=!wt.state.isVisible,Dr=wt.state.isDestroyed,jr=!wt.state.isEnabled,en=getValueAtIndexOrReturn(wt.props.duration,1,defaultProps$1.duration);if(!(Pr||Dr||jr)&&(or("onHide",[wt],!1),wt.props.onHide(wt)!==!1)){if(wt.state.isVisible=!1,wt.state.isShown=!1,_t=!1,lt=!1,Vt()&&(Rt.style.visibility="hidden"),ur(),gr(),lr(!0),Vt()){var rn=nr(),mn=rn.box,bn=rn.content;wt.props.animation&&(setTransitionDuration([mn,bn],en),setVisibilityState([mn,bn],"hidden"))}pr(),hr(),wt.props.animation?Vt()&&function(Tn,xn){tr(Tn,function(){!wt.state.isVisible&&Rt.parentNode&&Rt.parentNode.contains(Rt)&&xn()})}(en,wt.unmount):wt.unmount()}},hideWithInteractivity:function(Pr){Yt().addEventListener("mousemove",bt),pushIfUnique(mouseMoveListeners,bt),bt(Pr)},enable:function(){wt.state.isEnabled=!0},disable:function(){wt.hide(),wt.state.isEnabled=!1},unmount:function(){wt.state.isVisible&&wt.hide(),wt.state.isMounted&&(ar(),vr().forEach(function(Pr){Pr._tippy.unmount()}),Rt.parentNode&&Rt.parentNode.removeChild(Rt),mountedInstances=mountedInstances.filter(function(Pr){return Pr!==wt}),wt.state.isMounted=!1,or("onHidden",[wt]))},destroy:function(){wt.state.isDestroyed||(wt.clearDelayTimeouts(),wt.unmount(),Xr(),delete h._tippy,wt.state.isDestroyed=!0,or("onDestroy",[wt]))}};if(!nt.render)return wt;var Pt=nt.render(wt),Rt=Pt.popper,kt=Pt.onUpdate;Rt.setAttribute("data-tippy-root",""),Rt.id="tippy-"+wt.id,wt.popper=Rt,h._tippy=wt,Rt._tippy=wt;var Gt=St.map(function(Pr){return Pr.fn(wt)}),Dt=h.hasAttribute("aria-expanded");return Ir(),hr(),lr(),or("onCreate",[wt]),nt.showOnCreate&&Cr(),Rt.addEventListener("mouseenter",function(){wt.props.interactive&&wt.state.isVisible&&wt.clearDelayTimeouts()}),Rt.addEventListener("mouseleave",function(){wt.props.interactive&&wt.props.trigger.indexOf("mouseenter")>=0&&Yt().addEventListener("mousemove",bt)}),wt;function It(){var Pr=wt.props.touch;return Array.isArray(Pr)?Pr:[Pr,0]}function Nt(){return It()[0]==="hold"}function Vt(){var Pr;return!((Pr=wt.props.render)==null||!Pr.$$tippy)}function Kt(){return it||h}function Yt(){var Pr=Kt().parentNode;return Pr?getOwnerDocument(Pr):document}function nr(){return getChildren(Rt)}function rr(Pr){return wt.state.isMounted&&!wt.state.isVisible||currentInput.isTouch||v&&v.type==="focus"?0:getValueAtIndexOrReturn(wt.props.delay,Pr?0:1,defaultProps$1.delay)}function lr(Pr){Pr===void 0&&(Pr=!1),Rt.style.pointerEvents=wt.props.interactive&&!Pr?"":"none",Rt.style.zIndex=""+wt.props.zIndex}function or(Pr,Dr,jr){var en;jr===void 0&&(jr=!0),Gt.forEach(function(rn){rn[Pr]&&rn[Pr].apply(rn,Dr)}),jr&&(en=wt.props)[Pr].apply(en,Dr)}function pr(){var Pr=wt.props.aria;if(Pr.content){var Dr="aria-"+Pr.content,jr=Rt.id;normalizeToArray(wt.props.triggerTarget||h).forEach(function(en){var rn=en.getAttribute(Dr);if(wt.state.isVisible)en.setAttribute(Dr,rn?rn+" "+jr:jr);else{var mn=rn&&rn.replace(jr,"").trim();mn?en.setAttribute(Dr,mn):en.removeAttribute(Dr)}})}}function hr(){!Dt&&wt.props.aria.expanded&&normalizeToArray(wt.props.triggerTarget||h).forEach(function(Pr){wt.props.interactive?Pr.setAttribute("aria-expanded",wt.state.isVisible&&Pr===Kt()?"true":"false"):Pr.removeAttribute("aria-expanded")})}function ur(){Yt().removeEventListener("mousemove",bt),mouseMoveListeners=mouseMoveListeners.filter(function(Pr){return Pr!==bt})}function cr(Pr){if(!currentInput.isTouch||!ht&&Pr.type!=="mousedown"){var Dr=Pr.composedPath&&Pr.composedPath()[0]||Pr.target;if(!wt.props.interactive||!actualContains(Rt,Dr)){if(normalizeToArray(wt.props.triggerTarget||h).some(function(jr){return actualContains(jr,Dr)})){if(currentInput.isTouch||wt.state.isVisible&&wt.props.trigger.indexOf("click")>=0)return}else or("onClickOutside",[wt,Pr]);wt.props.hideOnClick===!0&&(wt.clearDelayTimeouts(),wt.hide(),ut=!0,setTimeout(function(){ut=!1}),wt.state.isMounted||gr())}}}function br(){ht=!0}function fr(){ht=!1}function kr(){var Pr=Yt();Pr.addEventListener("mousedown",cr,!0),Pr.addEventListener("touchend",cr,TOUCH_OPTIONS),Pr.addEventListener("touchstart",fr,TOUCH_OPTIONS),Pr.addEventListener("touchmove",br,TOUCH_OPTIONS)}function gr(){var Pr=Yt();Pr.removeEventListener("mousedown",cr,!0),Pr.removeEventListener("touchend",cr,TOUCH_OPTIONS),Pr.removeEventListener("touchstart",fr,TOUCH_OPTIONS),Pr.removeEventListener("touchmove",br,TOUCH_OPTIONS)}function tr(Pr,Dr){var jr=nr().box;function en(rn){rn.target===jr&&(updateTransitionEndListener(jr,"remove",en),Dr())}if(Pr===0)return Dr();updateTransitionEndListener(jr,"remove",b),updateTransitionEndListener(jr,"add",en),b=en}function dr(Pr,Dr,jr){jr===void 0&&(jr=!1),normalizeToArray(wt.props.triggerTarget||h).forEach(function(en){en.addEventListener(Pr,Dr,jr),ft.push({node:en,eventType:Pr,handler:Dr,options:jr})})}function Ir(){Nt()&&(dr("touchstart",Jr,{passive:!0}),dr("touchend",Pn,{passive:!0})),splitBySpaces(wt.props.trigger).forEach(function(Pr){if(Pr!=="manual")switch(dr(Pr,Jr),Pr){case"mouseenter":dr("mouseleave",Pn);break;case"focus":dr(isIE11?"focusout":"blur",vn);break;case"focusin":dr("focusout",vn)}})}function Xr(){ft.forEach(function(Pr){var Dr=Pr.node,jr=Pr.eventType,en=Pr.handler,rn=Pr.options;Dr.removeEventListener(jr,en,rn)}),ft=[]}function Jr(Pr){var Dr,jr=!1;if(wt.state.isEnabled&&!Gn(Pr)&&!ut){var en=((Dr=v)==null?void 0:Dr.type)==="focus";v=Pr,it=Pr.currentTarget,hr(),!wt.state.isVisible&&isMouseEvent(Pr)&&mouseMoveListeners.forEach(function(rn){return rn(Pr)}),Pr.type==="click"&&(wt.props.trigger.indexOf("mouseenter")<0||lt)&&wt.props.hideOnClick!==!1&&wt.state.isVisible?jr=!0:Cr(Pr),Pr.type==="click"&&(lt=!jr),jr&&!en&&Ur(Pr)}}function on(Pr){var Dr=Pr.target,jr=Kt().contains(Dr)||Rt.contains(Dr);if(Pr.type!=="mousemove"||!jr){var en=vr().concat(Rt).map(function(rn){var mn,bn=(mn=rn._tippy.popperInstance)==null?void 0:mn.state;return bn?{popperRect:rn.getBoundingClientRect(),popperState:bn,props:nt}:null}).filter(Boolean);isCursorOutsideInteractiveBorder(en,Pr)&&(ur(),Ur(Pr))}}function Pn(Pr){Gn(Pr)||wt.props.trigger.indexOf("click")>=0&&lt||(wt.props.interactive?wt.hideWithInteractivity(Pr):Ur(Pr))}function vn(Pr){wt.props.trigger.indexOf("focusin")<0&&Pr.target!==Kt()||wt.props.interactive&&Pr.relatedTarget&&Rt.contains(Pr.relatedTarget)||Ur(Pr)}function Gn(Pr){return!!currentInput.isTouch&&Nt()!==Pr.type.indexOf("touch")>=0}function ms(){ar();var Pr=wt.props,Dr=Pr.popperOptions,jr=Pr.placement,en=Pr.offset,rn=Pr.getReferenceClientRect,mn=Pr.moveTransition,bn=Vt()?getChildren(Rt).arrow:null,Tn=rn?{getBoundingClientRect:rn,contextElement:rn.contextElement||Kt()}:h,xn=[{name:"offset",options:{offset:en}},{name:"preventOverflow",options:{padding:{top:2,bottom:2,left:5,right:5}}},{name:"flip",options:{padding:5}},{name:"computeStyles",options:{adaptive:!mn}},{name:"$$tippy",enabled:!0,phase:"beforeWrite",requires:["computeStyles"],fn:function(fn){var En=fn.state;if(Vt()){var tn=nr().box;["placement","reference-hidden","escaped"].forEach(function(wn){wn==="placement"?tn.setAttribute("data-placement",En.placement):En.attributes.popper["data-popper-"+wn]?tn.setAttribute("data-"+wn,""):tn.removeAttribute("data-"+wn)}),En.attributes.popper={}}}}];Vt()&&bn&&xn.push({name:"arrow",options:{element:bn,padding:3}}),xn.push.apply(xn,(Dr==null?void 0:Dr.modifiers)||[]),wt.popperInstance=popper_createPopper(Tn,Rt,Object.assign({},Dr,{placement:jr,onFirstUpdate:tt,modifiers:xn}))}function ar(){wt.popperInstance&&(wt.popperInstance.destroy(),wt.popperInstance=null)}function vr(){return arrayFrom(Rt.querySelectorAll("[data-tippy-root]"))}function Cr(Pr){wt.clearDelayTimeouts(),Pr&&or("onTrigger",[wt,Pr]),kr();var Dr=rr(!0),jr=It(),en=jr[0],rn=jr[1];currentInput.isTouch&&en==="hold"&&rn&&(Dr=rn),Dr?c=setTimeout(function(){wt.show()},Dr):wt.show()}function Ur(Pr){if(wt.clearDelayTimeouts(),or("onUntrigger",[wt,Pr]),wt.state.isVisible){if(!(wt.props.trigger.indexOf("mouseenter")>=0&&wt.props.trigger.indexOf("click")>=0&&["mouseleave","mousemove"].indexOf(Pr.type)>=0&&lt)){var Dr=rr(!1);Dr?d=setTimeout(function(){wt.state.isVisible&&wt.hide()},Dr):_=requestAnimationFrame(function(){wt.hide()})}}else gr()}}function tippy(h,o){o===void 0&&(o={});var c=defaultProps$1.plugins.concat(o.plugins||[]);bindGlobalEventListeners();var d=Object.assign({},o,{plugins:c}),_=getArrayOfElements(h).reduce(function(v,b){var tt=b&&createTippy(b,d);return tt&&v.push(tt),v},[]);return tippy_esm_isElement(h)?_[0]:_}tippy.defaultProps=defaultProps$1,tippy.setDefaultProps=setDefaultProps,tippy.currentInput=currentInput;var applyStylesModifier=Object.assign({},modifiers_applyStyles,{effect:function(h){var o=h.state,c={popper:{position:o.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};Object.assign(o.elements.popper.style,c.popper),o.styles=c,o.elements.arrow&&Object.assign(o.elements.arrow.style,c.arrow)}}),createSingleton=function(h,o){var c;o===void 0&&(o={});var d,_=h,v=[],b=[],tt=o.overrides,it=[],nt=!1;function lt(){b=_.map(function(Pt){return normalizeToArray(Pt.props.triggerTarget||Pt.reference)}).reduce(function(Pt,Rt){return Pt.concat(Rt)},[])}function ut(){v=_.map(function(Pt){return Pt.reference})}function ht(Pt){_.forEach(function(Rt){Pt?Rt.enable():Rt.disable()})}function _t(Pt){return _.map(function(Rt){var kt=Rt.setProps;return Rt.setProps=function(Gt){kt(Gt),Rt.reference===d&&Pt.setProps(Gt)},function(){Rt.setProps=kt}})}function ft(Pt,Rt){var kt=b.indexOf(Rt);if(Rt!==d){d=Rt;var Gt=(tt||[]).concat("content").reduce(function(Dt,It){return Dt[It]=_[kt].props[It],Dt},{});Pt.setProps(Object.assign({},Gt,{getReferenceClientRect:typeof Gt.getReferenceClientRect=="function"?Gt.getReferenceClientRect:function(){var Dt;return(Dt=v[kt])==null?void 0:Dt.getBoundingClientRect()}}))}}ht(!1),ut(),lt();var bt={fn:function(){return{onDestroy:function(){ht(!0)},onHidden:function(){d=null},onClickOutside:function(Pt){Pt.props.showOnCreate&&!nt&&(nt=!0,d=null)},onShow:function(Pt){Pt.props.showOnCreate&&!nt&&(nt=!0,ft(Pt,v[0]))},onTrigger:function(Pt,Rt){ft(Pt,Rt.currentTarget)}}}},xt=tippy(div(),Object.assign({},removeProperties(o,["overrides"]),{plugins:[bt].concat(o.plugins||[]),triggerTarget:b,popperOptions:Object.assign({},o.popperOptions,{modifiers:[].concat(((c=o.popperOptions)==null?void 0:c.modifiers)||[],[applyStylesModifier])})})),St=xt.show;xt.show=function(Pt){if(St(),!d&&Pt==null)return ft(xt,v[0]);if(!d||Pt!=null){if(typeof Pt=="number")return v[Pt]&&ft(xt,v[Pt]);if(_.indexOf(Pt)>=0){var Rt=Pt.reference;return ft(xt,Rt)}return v.indexOf(Pt)>=0?ft(xt,Pt):void 0}},xt.showNext=function(){var Pt=v[0];if(!d)return xt.show(0);var Rt=v.indexOf(d);xt.show(v[Rt+1]||Pt)},xt.showPrevious=function(){var Pt=v[v.length-1];if(!d)return xt.show(Pt);var Rt=v.indexOf(d),kt=v[Rt-1]||Pt;xt.show(kt)};var wt=xt.setProps;return xt.setProps=function(Pt){tt=Pt.overrides||tt,wt(Pt)},xt.setInstances=function(Pt){ht(!0),it.forEach(function(Rt){return Rt()}),_=Pt,ht(!1),ut(),lt(),it=_t(xt),xt.setProps({triggerTarget:b})},it=_t(xt),xt};tippy.setDefaultProps({render});var tippy_esm=tippy;class CustomContextMenu{static _initialize(){this._inited=!0,P$2($`
          #customContextMenu {
            background: #2c2c2e99;
            backdrop-filter: blur(8px);
            border: 0.5px solid rgba(20, 20, 20, 0.3);
            width: auto;
            height: auto;
            position: absolute;
            display: flex;
            flex-direction: column;
            z-index: 9999;
            padding: 0.35rem 0.20rem;
            border-radius: 0.375rem;
            min-width: 6rem;
            pointer-events: auto;
            box-shadow: 0px 2px 10px rgba(12, 12, 12, 0.2);
          }

          .customContextMenuItems {
            color: white;
            font-size: 0.65rem;
            font-family: "Roboto Mono", "Source Code Pro", Menlo, Courier, monospace;
            background-color: transparent;
            cursor: pointer;
            padding: 0.12rem 0.35rem;
            border-radius: 0.25rem;
            line-height: 1rem;
            font-weight: 500;
          }

          .customContextMenuItems:hover {
            color: white;
            background-color: #017AFF;
          }
        `),document.addEventListener("mouseup",o=>{this.Element&&!this.Element.contains(o.target)&&o.button===0&&this.Remove()})}static Create(o,c,d){this._inited||this._initialize(),this.Element&&this.Remove();const _=ee$1({id:"customContextMenu",addToBody:!1});_.style.top=d+"px",_.style.left=c+"px";for(const[v,b]of Object.entries(o)){const tt=ee$1({classList:["customContextMenuItems"],addToBody:!1,innerHTML:v});_.appendChild(tt),tt.onclick=b}return this.Element=_,_}static Remove(){var o;(o=this.Element)===null||o===void 0||o.remove(),this.Element=void 0}}CustomContextMenu.Element=void 0,CustomContextMenu._inited=!1;class MaterialConfiguratorPlugin extends MaterialConfiguratorBasePlugin{constructor(){super(...arguments),this.enableEditContextMenus=!1}async _refreshUi(){var o;if(!await super._refreshUi())return!1;CustomContextGrid.RemoveAll(MaterialConfiguratorPlugin.PluginType);for(const c of this.variations)CustomContextGrid.Create(MaterialConfiguratorPlugin.PluginType,c.title+(this.enableEditContextMenus?" ("+c.uuid+")":""),5,20,0,c.materials.map(d=>{let _;if(c.preview.startsWith("generate:"))_=this._previewGenerator.generate(d,c.preview.split(":")[1]);else{const v=d[c.preview]||"#ff00ff";_=v.image?Ne$1(v.image,100):void 0,_||(_=Ge$1(v!=null&&v.isColor?v.getHexString():v))}return{id:d.uuid,image:_,onClick:v=>this.applyVariation(c,v),tooltip:d.name||d.uuid}}),(d,_,v)=>{tippy_esm(d,{placement:"bottom",content:_.tooltip}),d.oncontextmenu=b=>{if(!this.enableEditContextMenus)return;b.preventDefault(),b.stopPropagation();const tt=CustomContextMenu.Create({Remove:async()=>{var it;await((it=this._viewer)===null||it===void 0?void 0:it.confirm("Remove material: Remove material from this variation list?"))&&(c.materials=c.materials.filter(nt=>nt.uuid!==_.id),this.refreshUi(),CustomContextMenu.Remove())},"Remove All":async()=>{var it;await((it=this._viewer)===null||it===void 0?void 0:it.confirm("Remove all: Remove all materials from this variation list?"))&&(c.materials=[],this.refreshUi(),CustomContextMenu.Remove())}},b.clientX,b.clientY);document.body.appendChild(tt)},v.oncontextmenu=b=>{if(!this.enableEditContextMenus)return;b.preventDefault(),b.stopPropagation();const tt=CustomContextMenu.Create({"Rename mapping":async()=>{var it;const nt=await((it=this._viewer)===null||it===void 0?void 0:it.prompt("Change name: New material name to map to",c.uuid,!0));nt&&(c.uuid=nt,this.refreshUi())},"Rename title":async()=>{var it;const nt=await((it=this._viewer)===null||it===void 0?void 0:it.prompt("Change name: New material name to map to",c.title,!0));nt&&(c.title=nt,this.refreshUi())},"Remove Section":async()=>{var it;await((it=this._viewer)===null||it===void 0?void 0:it.confirm("Remove variations: Remove this category of variations?"))&&(this.removeVariation(c),CustomContextMenu.Remove())}},b.clientX,b.clientY);document.body.appendChild(tt)}});return CustomContextGrid.RebuildUi((o=this._viewer)===null||o===void 0?void 0:o.container),!0}}MaterialConfiguratorPlugin.PluginType="MaterialConfiguratorPlugin";var SwitchNodeBasePlugin_decorate=function(h,o,c,d){var _,v=arguments.length,b=v<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(h,o,c,d);else for(var tt=h.length-1;tt>=0;tt--)(_=h[tt])&&(b=(v<3?_(b):v>3?_(o,c,b):_(o,c))||b);return v>3&&b&&Object.defineProperty(o,c,b),b};class SwitchNodeBasePlugin extends AViewerPlugin{constructor(){super(),this.enabled=!0,this._uiNeedRefresh=!1,this._isVisibleChanged=!1,this._postFrame=()=>{this._uiNeedRefresh&&this._refreshUi()},this._preRender=()=>{if(this._viewer&&this.enabled){for(const o of this.variations){if(!o.name)continue;const c=this._viewer.scene.getObjectByName(o.name);if(!c||c.children.length<1)return;o.selected||(o.selected=c.children[0].name||c.children[0].uuid);for(const d of c.children)d.userData.__oldVisible=d.visible,d.visible=(d.name||d.uuid)===o.selected}this._isVisibleChanged=!0}},this._postRender=()=>{if(this._viewer&&this._isVisibleChanged){for(const o of this.variations){if(!o.name)continue;const c=this._viewer.scene.getObjectByName(o.name);if(!c||c.children.length<1)return;for(const d of c.children){if(d.userData.__oldVisible===void 0)return;d.visible=d.userData.__oldVisible,delete d.userData.__oldVisible}}this._isVisibleChanged=!1}},this.autoSnapIcons=!1,this.dependencies=[AssetManagerPlugin],this.variations=[],this._selectedSwitchNode=()=>{var o;const c=(o=this._picking)===null||o===void 0?void 0:o.getSelectedObject();if(!c)return;const d=this.variations.map(v=>v.name);let _;return c.traverseAncestors(v=>{_||v.name&&d.includes(v.name)&&(_=v)}),_},this.uiConfig={label:"Switch Node",type:"folder",children:[{type:"checkbox",label:"Enabled",property:[this,"enabled"]},()=>[{type:"folder",label:"All nodes",expanded:!0,children:[this.variations.map(o=>({type:"input",label:o.title,property:[o,"name"],onChange:()=>this.refreshUi()}))]},{type:"button",label:"Add Node",value:()=>{this.variations.push({name:"switch_node",selected:"",title:"Switch Node",camView:"front",camDistance:1}),this.refreshUi()}},{type:"button",label:"Refresh UI",value:()=>this.refreshUi()},{type:"input",label:"Selected node title",hidden:()=>!this._selectedSwitchNode(),property:()=>{const o=this._selectedSwitchNode();return o?[this.variations.find(c=>c.name===o.name),"title"]:[]},onChange:()=>this.refreshUi()},{type:"slider",bounds:[.01,2],stepSize:.01,label:"Cam Distance",hidden:()=>!this._selectedSwitchNode(),property:()=>{const o=this._selectedSwitchNode();return o?[this.variations.find(c=>c.name===o.name),"camDistance"]:[]}},{type:"dropdown",label:"Cam View",hidden:()=>!this._selectedSwitchNode(),property:()=>{const o=this._selectedSwitchNode();return o?[this.variations.find(c=>c.name===o.name),"camView"]:[]},onChange:()=>this.refreshUi(),children:["top","bottom","front","back","left","right"].map(o=>({label:o,value:o}))}]]},this.refreshUi=this.refreshUi.bind(this),this._refreshUi=this._refreshUi.bind(this)}async onAdded(o){var c,d;await super.onAdded(o),this._picking=(c=this._viewer)===null||c===void 0?void 0:c.getPluginByType("Picking"),(d=this._picking)===null||d===void 0||d.addEventListener("selectedObjectChanged",this._refreshUi),o.addEventListener("postFrame",this._postFrame),o.addEventListener("preRender",this._preRender),o.addEventListener("postRender",this._postRender),this.addEventListener("deserialize",this.refreshUi)}async onRemove(o){var c;return(c=this._picking)===null||c===void 0||c.removeEventListener("selectedObjectChanged",this._refreshUi),o.removeEventListener("postFrame",this._postFrame),o.removeEventListener("preRender",this._preRender),o.removeEventListener("postRender",this._postRender),this._picking=void 0,super.onRemove(o)}refreshUi(){this.enabled&&(this._uiNeedRefresh=!0)}_refreshUi(){var o,c;return!!this.enabled&&!!this._viewer&&(this._uiNeedRefresh=!1,(c=(o=this.uiConfig).uiRefresh)===null||c===void 0||c.call(o),this.autoSnapIcons&&this.snapIcons(),!0)}snapIcons(){for(const o of this.variations){const c=this._viewer.scene.getObjectByName(o.name);if(c){c.children.length<1&&console.warn("SwitchNode does not have enough children",o);for(const d of c.children){if(d.userData.__icon)return;const _=o.camView,v=new three_module.Pq0((_.includes("right")?1:0)-(_.includes("left")?1:0),(_.includes("top")?1:0)-(_.includes("bottom")?1:0),(_.includes("front")?1:0)-(_.includes("back")?1:0));o.camDistance||(o.camDistance=1);const b=snapObject(this._viewer,d,void 0,7,v.multiplyScalar(.5*o.camDistance));d.userData.__icon=b}}else console.warn("no object found for variation, skipping",o)}}}SwitchNodeBasePlugin_decorate([serialize()],SwitchNodeBasePlugin.prototype,"variations",void 0);class SwitchNodePlugin extends SwitchNodeBasePlugin{_refreshUi(){var o;if(!super._refreshUi())return!1;CustomContextGrid.RemoveAll(SwitchNodePlugin.PluginType);for(const c of this.variations){const d=this._viewer.scene.getObjectByName(c.name);d?(d.children.length<1&&console.warn("SwitchNode does not have enough children",c),CustomContextGrid.Create(SwitchNodePlugin.PluginType,c.title,Math.min(5,d.children.length),20,0,d.children.map(_=>{const v=c.camView,b=new three_module.Pq0((v.includes("right")?1:0)-(v.includes("left")?1:0),(v.includes("top")?1:0)-(v.includes("bottom")?1:0),(v.includes("front")?1:0)-(v.includes("back")?1:0));c.camDistance||(c.camDistance=1);const tt=snapObject(this._viewer,_,void 0,7,b.multiplyScalar(.5*c.camDistance));return{id:_.uuid,image:tt,onClick:()=>{var it;c.selected=_.name||_.uuid,(it=this._viewer)===null||it===void 0||it.scene.setDirty({sceneUpdate:!0,frameFade:!0})},tooltip:_.name||_.uuid}}),(_,v)=>tippy_esm(_,{placement:"bottom",content:v.tooltip}))):console.warn("no object found for variation, skipping",c)}return CustomContextGrid.RebuildUi((o=this._viewer)===null||o===void 0?void 0:o.container),!0}}SwitchNodePlugin.PluginType="SwitchNodePlugin";var MaterialLibraryBasePlugin_decorate=function(h,o,c,d){var _,v=arguments.length,b=v<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(h,o,c,d);else for(var tt=h.length-1;tt>=0;tt--)(_=h[tt])&&(b=(v<3?_(b):v>3?_(o,c,b):_(o,c))||b);return v>3&&b&&Object.defineProperty(o,c,b),b};class MaterialLibraryBasePlugin extends AViewerPlugin{constructor(){super(...arguments),this.enabled=!0,this._uiNeedRefresh=!1,this._refreshUiConfig=()=>{var o,c;this.enabled&&((c=(o=this.uiConfig)===null||o===void 0?void 0:o.uiRefresh)===null||c===void 0||c.call(o,"postFrame",!0))},this.dependencies=[AssetManagerPlugin],this._selectedObject=()=>{var o;return((o=this._picking)===null||o===void 0?void 0:o.getSelectedObject())||void 0},this._selectedMaterial=()=>{var o;return((o=this._selectedObject())===null||o===void 0?void 0:o.material)||void 0}}async onAdded(o){var c,d;await super.onAdded(o),this.refreshUi=this.refreshUi.bind(this),this._refreshUi=this._refreshUi.bind(this),this._picking=(c=this._viewer)===null||c===void 0?void 0:c.getPluginByType("Picking"),this._previewGenerator=new MaterialPreviewGenerator(this._viewer),(d=this._picking)===null||d===void 0||d.addEventListener("selectedObjectChanged",this._refreshUiConfig),o.addEventListener("preFrame",this._refreshUi),this.addEventListener("deserialize",this.refreshUi)}async onRemove(o){var c,d;return(c=this._previewGenerator)===null||c===void 0||c.dispose(),this._previewGenerator=void 0,(d=this._picking)===null||d===void 0||d.removeEventListener("selectedObjectChanged",this._refreshUiConfig),this.removeEventListener("deserialize",this.refreshUi),o.removeEventListener("preFrame",this._refreshUi),this._picking=void 0,super.onRemove(o)}refreshUi(){this.enabled&&(this._uiNeedRefresh=!0)}async _refreshUi(){return this._uiNeedRefresh&&this.enabled&&this._refreshUiConfig(),this._uiNeedRefresh=!1,!1}}MaterialLibraryBasePlugin.PluginType="MaterialLibraryBasePlugin",MaterialLibraryBasePlugin_decorate([uiToggle("Enabled")],MaterialLibraryBasePlugin.prototype,"enabled",void 0);var MaterialLibraryPlugin_decorate=function(h,o,c,d){var _,v=arguments.length,b=v<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(h,o,c,d);else for(var tt=h.length-1;tt>=0;tt--)(_=h[tt])&&(b=(v<3?_(b):v>3?_(o,c,b):_(o,c))||b);return v>3&&b&&Object.defineProperty(o,c,b),b};class MaterialLibraryPlugin extends MaterialLibraryBasePlugin{constructor(){super(...arguments),this.replaceMaterial=!1,this.uiConfig={type:"folder",label:"Material Library",uuid:esm_browser_v4(),children:[...generateUiConfig(this),()=>({type:"dropdown",label:"Apply Material",limitedUi:!0,hidden:()=>!this._selectedObject(),children:[{label:"select one",value:""},[...this._viewer.getPlugin(AssetManagerPlugin).materials.getAllMaterials().map(o=>({label:o.name||o.uuid,value:o.uuid}))||[]]],getValue:()=>{var o;return(o=this._selectedMaterial())===null||o===void 0?void 0:o.uuid},setValue:o=>{var c,d,_,v,b;const tt=(_=(d=(c=this._viewer)===null||c===void 0?void 0:c.getPlugin(AssetManagerPlugin))===null||d===void 0?void 0:d.materials)===null||_===void 0?void 0:_.findMaterial(o);if(tt)if(this.replaceMaterial)(b=(v=this._selectedObject())===null||v===void 0?void 0:v.setMaterial)===null||b===void 0||b.call(v,tt);else{const it=this._selectedMaterial();if(it){const nt=it.name,lt=it.uuid;it.copyProps(tt),it.name=nt,it.uuid=lt,it.userData.uuid&&(it.userData.uuid=lt)}}this._refreshUi()}})]}}async _refreshUi(){var o,c,d;if(!await super._refreshUi())return!1;const _=[MeshStandardMaterial2.TypeSlug,DiamondMaterial.TypeSlug],v=(c=(o=this._viewer)===null||o===void 0?void 0:o.getPlugin(AssetManagerPlugin))===null||c===void 0?void 0:c.materials,b=_.map(tt=>[tt,v==null?void 0:v.getMaterialsOfType(tt)]);CustomContextGrid.RemoveAll(MaterialLibraryPlugin.PluginType);for(const[tt,it]of b)CustomContextGrid.Create(MaterialLibraryPlugin.PluginType,tt,5,20,0,it==null?void 0:it.filter(nt=>!nt.userData.runtimeMaterial).map(nt=>{let lt;const ut="generate:sphere";if(ut.startsWith("generate:"))lt=this._previewGenerator.generate(nt,ut.split(":")[1]);else{const ht=nt[ut]||"#ff00ff";lt=ht.image?Ne$1(ht.image,100):void 0,lt||(lt=Je$1(ht))}return{id:nt.uuid,image:lt,onClick:ht=>{const _t=v==null?void 0:v.findMaterial(ht);if(_t){const ft=_t.userData.__appliedMeshes;if(ft!=null&&ft.size){const bt=ft.keys().next().value;bt==null||bt.dispatchEvent({type:"select",value:bt})}}},tooltip:nt.name||nt.uuid}}),(nt,lt)=>tippy_esm(nt,{placement:"bottom",content:lt.tooltip}));return CustomContextGrid.RebuildUi((d=this._viewer)===null||d===void 0?void 0:d.container),!0}}MaterialLibraryPlugin.PluginType="MaterialLibraryPlugin",MaterialLibraryPlugin_decorate([uiToggle("Replace Material")],MaterialLibraryPlugin.prototype,"replaceMaterial",void 0);var FSShadowMaterial_decorate=function(h,o,c,d){var _,v=arguments.length,b=v<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(h,o,c,d);else for(var tt=h.length-1;tt>=0;tt--)(_=h[tt])&&(b=(v<3?_(b):v>3?_(o,c,b):_(o,c))||b);return v>3&&b&&Object.defineProperty(o,c,b),b};class FSShadowMaterial extends three_module.q2{constructor(){super(...arguments),this.typeSlug="fsShadow",this.assetType="material",this._uniforms={},this.lastFrameTexture=null}get materialObject(){return this}onBeforeCompile(o,c){o.vertexShader=o.vertexShader.replace("#include <project_vertex>",`
#include <project_vertex>
gl_Position = vec4(uv*2.-1., 0, 1.); 
        `),o.vertexShader=o.vertexShader.replace("void main() {",`
varying vec2 vUv;
void main() {
    vUv = uv;
        `),o.fragmentShader=o.fragmentShader.replace("void main() {",`
varying vec2 vUv;
uniform sampler2D tLastThis;
void main() {
        `),o.fragmentShader=o.fragmentShader.replace("gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );",fe$1`
float shadow = getShadowMask();

//shift the color by dither_shift
shadow = clamp(shadow + mix(-1./512., 1./512., rand( gl_FragCoord.xy )), 0., 1.);

float last = unpackRGBAToDepth(texture2D(tLastThis, vUv));
gl_FragColor = packDepthToRGBA(mix(last, shadow, opacity));
//if not useMovingAverage:
//gl_FragColor = packDepthToRGBA(shadow * opacity + last);
        `),Object.assign(o.uniforms,this._uniforms),super.onBeforeCompile(o,c)}customProgramCacheKey(){return super.customProgramCacheKey()}toJSON(o){throw new Error("Method not supported for this material.")}fromJSON(o,c){throw new Error("Method not supported for this material.")}copyProps(o){throw new Error("Method not supported for this material.")}setDirty(o){this.needsUpdate=!0,this.dispatchEvent({...o,type:"materialUpdate"})}}FSShadowMaterial_decorate([uniform({propKey:"tLastThis"})],FSShadowMaterial.prototype,"lastFrameTexture",void 0);var seperableShadowBlur=`#include <packing>
uniform sampler2D colorTexture;uniform vec2 size;uniform vec2 direction;uniform float step;varying vec2 vUv;void main(){float sum=0.;vec2 uvDelta=step*direction/size;sum+=unpackRGBAToDepth(texture2D(colorTexture,vUv-1.*uvDelta))*0.3333;sum+=unpackRGBAToDepth(texture2D(colorTexture,vec2(vUv.x,vUv.y)))*0.3333;sum+=unpackRGBAToDepth(texture2D(colorTexture,vUv+1.*uvDelta))*0.3333;gl_FragColor=packDepthToRGBA(sum);}`,ShadowMapBaker_decorate=function(h,o,c,d){var _,v=arguments.length,b=v<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(h,o,c,d);else for(var tt=h.length-1;tt>=0;tt--)(_=h[tt])&&(b=(v<3?_(b):v>3?_(o,c,b):_(o,c))||b);return v>3&&b&&Object.defineProperty(o,c,b),b};class ShadowMapBaker extends I$2{get attachedMesh(){return this._attachedMesh}set attachedMesh(o){this._attachedMesh!==o&&(this._attachedMesh&&this.cleanupMaterial(),this._attachedMesh=o,this._attachedMesh&&this._updateMaterial())}get target(){return this._target}get light(){return this._light}constructor(o){super(),this.enabled=!0,this._lightLayer=5,this._frameNumber=0,this.maxFrameNumber=400,this.smoothShadow=!1,this.shadowMapType=three_module.bTm,this.groundMapMode="aoMap",this.alphaVignette=!0,this.alphaVignetteAxis="xy",this.shadowAutoUpdate=!0,this._bakeCounter=0,this.maxBakeCount=1/0,this.materialExtension={parsFragmentSnippet:(d,_)=>fe$1`
            uniform float transitionOpacity;
            `,extraUniforms:{transitionOpacity:{value:1}},shaderExtender:(d,_,v)=>{this.groundMapMode==="aoMap"?d.fragmentShader=shaderReplaceString(d.fragmentShader,"#include <aomap_fragment>",shaderReplaceString(three_module.vxI.aomap_fragment,"float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;","float ambientOcclusion = ( mix(1., unpackRGBAToDepth(texture2D( aoMap, vAoMapUv ) ), transitionOpacity) - 1.0) * aoMapIntensity + 1.0;")):this.groundMapMode==="map"?d.fragmentShader=shaderReplaceString(d.fragmentShader,"#include <map_fragment>",shaderReplaceString(three_module.vxI.map_fragment,"diffuseColor *= sampledDiffuseColor","float groundShadow = mix(1., unpackRGBAToDepth(sampledDiffuseColor), transitionOpacity); diffuseColor.rgb *= groundShadow; diffuseColor.a *= max(0., 1.-groundShadow) * transitionOpacity;")):this.groundMapMode==="alphaMap"&&(d.fragmentShader=shaderReplaceString(d.fragmentShader,"#include <alphamap_fragment>",shaderReplaceString(three_module.vxI.alphamap_fragment,"texture2D( alphaMap, vAlphaMapUv ).g","1. - unpackRGBAToDepth( texture2D( alphaMap, vAlphaMapUv ) )",{replaceAll:!0}))),d.fragmentShader=shaderReplaceString(d.fragmentShader,"#include <opaque_fragment>",fe$1`#include <opaque_fragment>
                #ifndef OPAQUE
                    #ifdef USE_AOMAP
                        #if NUM_DIR_LIGHT_SHADOWS > 0
                            // TODO find a better solution
                            float alphaMod = length(reflectedLight.directDiffuse)*4./float(NUM_DIR_LIGHT_SHADOWS);
                        #else
                            float alphaMod = 1.;
                        #endif
                        float t1 = 1. - ambientOcclusion;
                        float t2 = max(1. - alphaMod, 0.);
                        float t = t1 + t2;
                        gl_FragColor.a *= max(t, 0.);
                    #endif
                #endif
            `),this.alphaVignette&&v.capabilities.isWebGL2&&(d.defines.USE_UV="",d.fragmentShader=shaderReplaceString(d.fragmentShader,"#include <opaque_fragment>",fe$1`#include <opaque_fragment>
                    #ifndef OPAQUE
                    float weight = 0.;
                    #ifdef USE_UV // why are we checking for this? this is always supposed to be true
                    weight = 2.*abs(length(0.5 - vUv.${this.alphaVignetteAxis}));
                    #endif
                    #if defined(USE_LIGHTMAP) || defined(USE_AOMAP)
                    weight = 2.*abs(length(0.5 - vAoMapUv.${this.alphaVignetteAxis}));
                    #endif
                    weight = min(1., max(0., weight))-0.5;
                    weight = min(1., max(0., 1.0-2.*weight));
                    weight = pow(weight, 1.5);
                    gl_FragColor.a *= weight;
                    //gl_FragColor.rgb /= max(0.01, weight);
                    gl_FragColor = saturate(gl_FragColor);
                    //gl_FragColor.a = 0.5;
                    #endif
                    `))},computeCacheKey:()=>this.groundMapMode+"."+this.alphaVignette+"."+this.alphaVignetteAxis,onObjectRender:(d,_)=>{_.materialObject.userData.gMapMode!==this.groundMapMode&&(_.materialObject.userData.gMapMode=this.groundMapMode,_.materialObject.needsUpdate=!0)},isCompatible:d=>d.isMeshStandardMaterial2},this._viewer=o;const c=new RandomizedDirectionalLight(16777215,10,{near:1.5,far:20,bias:0,frustumSize:4,width:1024,height:1024,enabled:!0,radius:10,normalBias:0},{direction:new three_module.Pq0(.2,1,.2).normalize(),spread:.9,focus:1,distanceScale:20,minDistanceScale:new three_module.Pq0(10,10,10),normalDirection:new three_module.Pq0(0,1,0)});c.shadow.camera.updateProjectionMatrix(),c.layers.disableAll(),c.layers.set(this._lightLayer),this._light=c,o.scene.addLight(this._light,{addToRoot:!0}),this._shadowMat=new FSShadowMaterial({color:"#ffffff",toneMapped:!1,depthWrite:!1,depthTest:!1,premultipliedAlpha:!1,opacity:1,transparent:!1,blending:three_module.XIg}),this._shadowBlurMat=new ShaderMaterial2({uniforms:{colorTexture:{value:null},step:{value:.1},size:{value:new three_module.I9Y(.5,.5)},direction:{value:new three_module.I9Y(.5,.5)}},vertexShader:defaultVertex,fragmentShader:seperableShadowBlur})}dispose(){this._shadowMat.dispose(),this._target=void 0,this.reset()}cleanupMaterial(){this._updateMaterial(!0)}_groundMapModeChanged(){this._attachedMesh&&(this.cleanupMaterial(),this._updateMaterial(),this.groundMapMode==="alphaMap"?this._attachedMesh.material.transparent=!0:this._attachedMesh.material.transparent=!1),this.reset()}_alphaVignetteChanged(){var o,c,d;(c=(o=this.materialExtension)===null||o===void 0?void 0:o.setDirty)===null||c===void 0||c.call(o),(d=this._viewer)===null||d===void 0||d.setDirty()}fromJSON(o,c){return deserializeObject(o,this,!0,c),this.reset(),this}reset(){this._frameNumber=0}get frameNumber(){return this._frameNumber}autoUpdateShadow(){return!(!this.shadowAutoUpdate||this._bakeCounter>=this.maxBakeCount||!this.updateShadow()||(this._frameNumber===this.maxFrameNumber?this.dispatchEvent({type:"shadowBaked",bakeCount:++this._bakeCounter}):this._frameNumber>0&&this._frameNumber<this.maxFrameNumber&&this.dispatchEvent({type:"shadowBaking",progress:this._frameNumber/this.maxFrameNumber,bakeCount:this._bakeCounter}),0))}updateShadow(){if(!this.enabled)return!1;const o=this._attachedMesh;if(!o||++this._frameNumber>this.maxFrameNumber)return!1;const c=1024;this._target||(this._target=this._viewer.renderer.createTarget({type:three_module.OUM,depthBuffer:!1,size:new three_module.I9Y(c,c),sizeMultiplier:void 0,colorSpace:three_module.jf0,format:three_module.GWd})),this._frameNumber<3?this._light.randomizePosition(0,1,0):this._light.randomizePosition(this._frameNumber),o.castShadow=!1;const d=this._viewer.renderer.rendererObject,_=d.shadowMap,v=_.type,b=_.needsUpdate,tt=_.autoUpdate;_.type=this.shadowMapType,_.needsUpdate=!0,_.autoUpdate=!1;const it=this._viewer.scene,nt=new three_module.zgK;nt.disableAll(),it.modelObject.traverse(ft=>{ft.isLight&&ft!==this._light.lightObject&&(ft.userData.__gp_layers=ft.layers,ft.layers=nt)});const lt=it.activeCamera.cameraObject;if(lt.layers.mask&1<<this._lightLayer)throw"Camera can render pseudo directional light, check layers";lt.layers.enable(this._lightLayer),o.layers.disable(this._lightLayer),setThreeRendererMode(d,{shadowMapRender:!0,backgroundRender:!1,sceneRender:!1},()=>this._viewer.renderer.renderScene(it)),lt.layers.disable(this._lightLayer);const ut=lt.layers.mask;lt.layers.set(this._lightLayer),o.layers.enable(this._lightLayer);const ht=this._viewer.renderer.getTempTarget({type:three_module.OUM,depthBuffer:!1,size:new three_module.I9Y(c,c),colorSpace:three_module.jf0,format:three_module.GWd}),_t=ht.texture.colorSpace;ht.texture.colorSpace=three_module.jf0,this._viewer.renderer.blit(this._target.texture,ht,{clear:!0});{const ft=o.material,bt=o.frustumCulled,xt=d.getRenderTarget(),St=d.getActiveCubeFace(),wt=d.getActiveMipmapLevel();o.material=this._shadowMat,o.frustumCulled=!1,d.setRenderTarget(this._target),this._shadowMat.opacity=Math.max(1/this.maxFrameNumber,1/this._frameNumber),this._shadowMat.lastFrameTexture=ht.texture,this._shadowMat.needsUpdate=!0,setThreeRendererMode(d,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!0,transparentRender:!1,transmissionRender:!1},()=>this._viewer.renderer.renderScene(it)),d.setRenderTarget(xt,St,wt),o.frustumCulled=bt,o.material=ft,this.smoothShadow&&this._applySmoothFilter(this._target,ht)}return ht.texture.colorSpace=_t,this._viewer.renderer.releaseTempTarget(ht),o.layers.disable(this._lightLayer),lt.layers.mask=ut,it.modelObject.traverse(ft=>{ft.isLight&&ft!==this._light.lightObject&&(ft.layers=ft.userData.__gp_layers,delete ft.userData.__gp_layers)}),_.type=v,_.needsUpdate=b,_.autoUpdate=tt,o.castShadow=!0,(this._frameNumber<3||this._frameNumber>Math.min(100,this.maxFrameNumber)&&this._frameNumber%4==0)&&(this._updateMaterial(),this._viewer.setDirty(),o.dispatchEvent({type:"materialUpdate"})),!0}_updateMaterial(o=!1){var c,d,_;this._attachedMesh&&(o?(this._attachedMesh.material.alphaMap===((c=this._target)===null||c===void 0?void 0:c.texture)&&(this._attachedMesh.material.alphaMap=null),this._attachedMesh.material.aoMap===((d=this._target)===null||d===void 0?void 0:d.texture)&&(this._attachedMesh.material.aoMap=null),this._attachedMesh.material.map===((_=this._target)===null||_===void 0?void 0:_.texture)&&(this._attachedMesh.material.map=null)):this._target&&(this.groundMapMode==="alphaMap"&&(this._attachedMesh.material.alphaMap=this._target.texture),this.groundMapMode==="aoMap"&&(this._attachedMesh.material.aoMap=this._target.texture),this.groundMapMode==="map"&&(this._attachedMesh.material.map=this._target.texture)),this._attachedMesh.material&&(this._attachedMesh.material.userData.ALPHA_I_RGBA_PACKING=!o&&this.groundMapMode==="alphaMap",this._attachedMesh.material.alphaTest=o||this.groundMapMode!=="alphaMap"?0:.01,this._attachedMesh.material.needsUpdate=!0))}_applySmoothFilter(o,c){this._shadowBlurMat.uniforms.colorTexture.value=o.texture,this._shadowBlurMat.uniforms.direction.value.set(1,0),this._shadowBlurMat.uniforms.size.value.set(o.width,o.height),this._viewer.renderer.blit(void 0,c,{material:this._shadowBlurMat}),this._shadowBlurMat.uniforms.colorTexture.value=c.texture,this._shadowBlurMat.uniforms.direction.value.set(0,1),this._shadowBlurMat.uniforms.size.value.set(c.width,c.height),this._viewer.renderer.blit(void 0,o,{material:this._shadowBlurMat})}}ShadowMapBaker_decorate([serialize("randomizedLight")],ShadowMapBaker.prototype,"_light",void 0),ShadowMapBaker_decorate([x$1(ShadowMapBaker.prototype.reset),serialize()],ShadowMapBaker.prototype,"maxFrameNumber",void 0),ShadowMapBaker_decorate([x$1(ShadowMapBaker.prototype.reset),serialize()],ShadowMapBaker.prototype,"smoothShadow",void 0),ShadowMapBaker_decorate([serialize(),x$1(ShadowMapBaker.prototype.reset)],ShadowMapBaker.prototype,"shadowMapType",void 0),ShadowMapBaker_decorate([x$1(ShadowMapBaker.prototype._groundMapModeChanged),serialize()],ShadowMapBaker.prototype,"groundMapMode",void 0),ShadowMapBaker_decorate([serialize(),x$1(ShadowMapBaker.prototype._alphaVignetteChanged)],ShadowMapBaker.prototype,"alphaVignette",void 0),ShadowMapBaker_decorate([serialize(),x$1(ShadowMapBaker.prototype._alphaVignetteChanged)],ShadowMapBaker.prototype,"alphaVignetteAxis",void 0),ShadowMapBaker_decorate([serialize()],ShadowMapBaker.prototype,"maxBakeCount",void 0);var reflectorSample=`#ifndef D_sceneBoundingRadius
#define D_sceneBoundingRadius 
uniform float sceneBoundingRadius;
#endif
varying vec4 vRefUv;uniform sampler2D tRefDiffuse;uniform vec2 tRefDiffuseSize;float getSpecularMIPLevel(const in float roughness,const in float maxMIPLevel){float sigma=PI*roughness*roughness/(1.+roughness);float desiredMIPLevel=maxMIPLevel+log2(sigma);return clamp(desiredMIPLevel,0.,maxMIPLevel);}vec4 getReflectionColor(const in float roughness,const in float depthModifier){float mip=getSpecularMIPLevel(roughness+depthModifier,5.);vec4 color=texture2D(tRefDiffuse,vRefUv.xy/vRefUv.w,mip);float blurDist=saturate(2./(1.+pow(abs(vViewPosition.z),0.25)))*mip*32.*color.a;float rnd=PI2*interleavedGradientNoise(vUv.xy,frameCount);vec4 rotationMatrix=vec4(cos(rnd),-sin(rnd),0.,0.);rotationMatrix.z=-rotationMatrix.y;rotationMatrix.w=rotationMatrix.x;vec3 colorSum=color.rgb*color.a;float weightSum=0.001+color.a;vec2 ofs;setPds();
#pragma unroll_loop_start
for(int i=0;i<16;i++){ofs=poisson_disk_samples[UNROLLED_LOOP_INDEX];ofs=vec2(dot(ofs,rotationMatrix.xy),dot(ofs,rotationMatrix.zw));ofs=vRefUv.xy+vRefUv.w*blurDist*ofs/tRefDiffuseSize.xy;color=texture2D(tRefDiffuse,ofs/vRefUv.w,mip);colorSum+=color.rgb*color.a;weightSum+=color.a;}
#pragma unroll_loop_end
return vec4(colorSum/weightSum,1.);}`,Reflector2_decorate=function(h,o,c,d){var _,v=arguments.length,b=v<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(h,o,c,d);else for(var tt=h.length-1;tt>=0;tt--)(_=h[tt])&&(b=(v<3?_(b):v>3?_(o,c,b):_(o,c))||b);return v>3&&b&&Object.defineProperty(o,c,b),b};class Reflector2 extends three_module.eaF{_updateExtension(){var o,c;this.transparentReflectionBackground=this.reflectorModePhysical,(c=(o=this.materialExtension)===null||o===void 0?void 0:o.setDirty)===null||c===void 0||c.call(o)}constructor(o,c,d=0){super(o),this.type="Reflector",this.isReflector2=!0,this.enabled=!0,this.reflectorModePhysical=!0,this.reflectionTargetNeedsUpdate=!0,this.transparentReflectionBackground=!0,this.materialExtension={extraUniforms:{tRefDiffuse:{value:null},tRefDiffuseSize:{value:new three_module.I9Y},refTextureMatrix:{value:null},frameCount:{value:0},sceneBoundingRadius:{value:0}},extraDefines:{USE_UV:""},updaters:[],shaderExtender:(xt,St,wt)=>{if(this.enabled){xt.vertexShader=shaderReplaceString(xt.vertexShader,"void main() {",`void main() {
vRefUv = refTextureMatrix * vec4( position, 1.0 );`);const Pt="#glMarker beforeModulation";xt.fragmentShader=shaderReplaceString(xt.fragmentShader,Pt,`
                    if(roughnessFactor < 0.95) {
                        float d = 0.;//textureProj(tRefDepth, vRefUv).r;
                        // d = min(2., max(0., (d-0.06) * ((7./3.-ior)) * sceneBoundingRadius));
                        vec4 refBaseColor = getReflectionColor(material.roughness, material.roughness * d);
                        // refBaseColor.rgb = vec3(refBaseColor.a);
                        // refBaseColor.a *= 1.0 - clamp(material.roughness * .3, 0., 1.);
                        `+(this.reflectorModePhysical?`
                        #if !defined(SSR_ENABLED) || SSR_ENABLED < 1 
                        vec3 specularColor = EnvironmentBRDF(geometryNormal, geometryViewDir, material.specularColor.rgb, material.specularF90, material.roughness);
                        #endif
                        reflectedLight.indirectSpecular = mix(vec3(reflectedLight.indirectSpecular), saturate(specularColor.rgb * refBaseColor.rgb), refBaseColor.a);
                        `:`
                        reflectedLight.indirectSpecular = saturate(diffuseColor.rgb * refBaseColor.rgb);
                        diffuseColor.a *= refBaseColor.a;
                        `)+`}
`+Pt)}},parsVertexSnippet:()=>this.enabled?`
		uniform mat4 refTextureMatrix;
		varying vec4 vRefUv;
`:"",parsFragmentSnippet:()=>this.enabled?poissonDiskSamples+`
`+randomHelpers+`
`+reflectorSample:"",computeCacheKey:xt=>this.enabled+" "+xt.materialObject.transparent+" "+this.reflectorModePhysical+" ",onObjectRender:(xt,{materialObject:St})=>{St.userData.__lastTransparent!==St.transparent&&(St.needsUpdate=!0,St.userData.__lastTransparent=St.transparent)},isCompatible:xt=>xt.isMeshStandardMaterial2},this.material=void 0,this._renderTarget=c;const _=new three_module.Zcv,v=new three_module.Pq0,b=new three_module.Pq0,tt=new three_module.Pq0,it=new three_module.kn4,nt=new three_module.Pq0(0,0,-1),lt=new three_module.IUQ,ut=new three_module.Pq0,ht=new three_module.Pq0,_t=new three_module.IUQ,ft=new three_module.kn4,bt=new three_module.ubm;three_module.cj9.isPowerOfTwo(c.texture.image.width)&&three_module.cj9.isPowerOfTwo(c.texture.image.height)||(this._renderTarget.texture.generateMipmaps=!1),this.onBeforeRender=(xt,St,wt)=>{if(!this.enabled||!xt.userData.mainRenderPass||!this.reflectionTargetNeedsUpdate)return;const Pt=wt.view?Object.assign({},wt.view):null;if(Pt&&wt.clearViewOffset&&wt.clearViewOffset(),b.setFromMatrixPosition(this.matrixWorld),tt.setFromMatrixPosition(wt.matrixWorld),it.extractRotation(this.matrixWorld),v.set(0,0,1),v.applyMatrix4(it),ut.subVectors(b,tt),ut.dot(v)>0)return;ut.reflect(v).negate(),ut.add(b),it.extractRotation(wt.matrixWorld),nt.set(0,0,-1),nt.applyMatrix4(it),nt.add(tt),ht.subVectors(b,nt),ht.reflect(v).negate(),ht.add(b),bt.position.copy(ut),bt.up.set(0,1,0),bt.up.applyMatrix4(it),bt.up.reflect(v),bt.lookAt(ht),bt.far=2,bt.near=0,bt.updateMatrixWorld(),bt.projectionMatrix.copy(wt.projectionMatrix),ft.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),ft.multiply(bt.projectionMatrix),ft.multiply(bt.matrixWorldInverse),ft.multiply(this.matrixWorld),_.setFromNormalAndCoplanarPoint(v,b),_.applyMatrix4(bt.matrixWorldInverse),lt.set(_.normal.x,_.normal.y,_.normal.z,_.constant);const Rt=bt.projectionMatrix;_t.x=(Math.sign(lt.x)+Rt.elements[8])/Rt.elements[0],_t.y=(Math.sign(lt.y)+Rt.elements[9])/Rt.elements[5],_t.z=-1,_t.w=(1+Rt.elements[10])/Rt.elements[14],lt.multiplyScalar(2/lt.dot(_t)),Rt.elements[2]=lt.x,Rt.elements[6]=lt.y,Rt.elements[10]=lt.z+1-d,Rt.elements[14]=lt.w,this.visible=!1;const kt=xt.getRenderTarget(),Gt=xt.xr.enabled,Dt=xt.shadowMap.autoUpdate;xt.xr.enabled=!1,xt.shadowMap.autoUpdate=!1,xt.setRenderTarget(this._renderTarget),xt.state.buffers.depth.setMask(!0),xt.autoClear===!1&&xt.clear();const It=St.background;this.transparentReflectionBackground&&(St.background=null);const Nt=!this.transparentReflectionBackground;It!=null&&It.isTexture&&Nt&&(It.userData||(It.userData={}),It.userData.flipX=!It.userData.flipX),setThreeRendererMode(xt,{shadowMapRender:!1,backgroundRender:Nt,opaqueRender:!0,transparentRender:!0,transmissionRender:!1,screenSpaceRendering:!1},()=>xt.render(St,bt)),It!=null&&It.isTexture&&Nt&&(It.userData.flipX=!It.userData.flipX||void 0),this.transparentReflectionBackground&&(St.background=It),xt.xr.enabled=Gt,xt.shadowMap.autoUpdate=Dt,xt.setRenderTarget(kt),Pt!=null&&Pt.enabled&&wt.setViewOffset&&wt.setViewOffset(Pt.fullWidth,Pt.fullHeight,Pt.offsetX,Pt.offsetY,Pt.width,Pt.height);const Vt=wt.viewport;Vt!==void 0&&xt.state.viewport(Vt),this.visible=!0,this.reflectionTargetNeedsUpdate=!1},this.textureMatrix=ft,this.materialExtension.extraUniforms.tRefDiffuse.value=this._renderTarget.texture,this.materialExtension.extraUniforms.tRefDiffuseSize.value=new three_module.I9Y(this._renderTarget.width,this._renderTarget.height),this.materialExtension.extraUniforms.refTextureMatrix.value=ft}getRenderTarget(){return this._renderTarget}}Reflector2_decorate([x$1(Reflector2.prototype._updateExtension)],Reflector2.prototype,"enabled",void 0),Reflector2_decorate([x$1(Reflector2.prototype._updateExtension)],Reflector2.prototype,"reflectorModePhysical",void 0),Reflector2.prototype.isReflector=!0;var BaseGroundPlugin_decorate=function(h,o,c,d){var _,v=arguments.length,b=v<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(h,o,c,d);else for(var tt=h.length-1;tt>=0;tt--)(_=h[tt])&&(b=(v<3?_(b):v>3?_(o,c,b):_(o,c))||b);return v>3&&b&&Object.defineProperty(o,c,b),b};class BaseGroundPlugin extends AViewerPlugin{get enabled(){return this.visible}set enabled(o){this.visible=o}get material(){return this._material}get mesh(){return this._iMesh}constructor(o={}){super(),this._transformNeedRefresh=!0,this.dependencies=[AssetManagerPlugin],this.visible=!0,this.size=8,this.yOffset=0,this.renderToDepth=!0,this.tonemapGround=!0,this.limitCameraAboveGround=!1,this.enableRefreshTransform=!0,this._cameraLimitsSet=!1,this._cameraLastMaxPolarAngle=Math.PI,this.useModelBounds=!1,this._refreshMaterial=this._refreshMaterial.bind(this),this._refreshTransform=this._refreshTransform.bind(this),this._refreshCameraLimits=this._refreshCameraLimits.bind(this),this.refreshOptions=this.refreshOptions.bind(this),this._refreshOptions2=this._refreshOptions2.bind(this),this._onSceneUpdate=this._onSceneUpdate.bind(this),this._preRender=this._preRender.bind(this),this._postFrame=this._postFrame.bind(this),this._geometry=new three_module.bdM(1,1,1,1),this._geometry.attributes.uv2=this._geometry.attributes.uv.clone(),this._geometry.attributes.uv2.needsUpdate=!0,this._options={shape:"",up:[0,100,0],autoAdjustTransform:!0},this.setOptions(o)}get autoAdjustTransform(){return this._options.autoAdjustTransform}set autoAdjustTransform(o){this._options.autoAdjustTransform=o,this.refreshTransform()}_createMesh(){return new three_module.eaF(this._geometry)}setGeometry(o){o?this._geometry&&this._geometry.dispose():o=this._geometry,o&&(o.attributes.uv2||(o.attributes.uv2=o.attributes.uv.clone(),o.attributes.uv2.needsUpdate=!0),this._mesh&&(this._mesh.geometry=o))}async onAdded(o){var c,d;await super.onAdded(o),o.getPluginByType("TweakpaneUi")&&console.error("TweakpaneUiPlugin must be added after Ground Plugin"),this._manager=o.getPlugin(AssetManagerPlugin);const _=this._createMesh();_.userData.physicsMass=0,_.userData.isGroundMesh=!0,this._iMesh=await((c=this._manager)===null||c===void 0?void 0:c.addImportedSingle(_,{pseudoCenter:!1,autoScale:!1,addToRoot:!0})),this._mesh=(d=this._iMesh)===null||d===void 0?void 0:d.modelObject,this._mesh&&(this._mesh.userData.userSelectable=!1,this._mesh.castShadow=!0,this._mesh.receiveShadow=!0,this._mesh.name="Ground Plane"),o.scene.addEventListener("sceneUpdate",this._onSceneUpdate),o.scene.addEventListener("addSceneObject",this._onSceneUpdate),o.addEventListener("preRender",this._preRender),o.addEventListener("postFrame",this._postFrame),this.refreshOptions()}_postFrame(){this._transformNeedRefresh&&this._refreshTransform(),this._viewer}_preRender(){this._viewer}async onDispose(o){var c,d,_;return this._removeMaterial(),this._geometry.dispose(),(c=this._material)===null||c===void 0||c.dispose(),(_=(d=this._iMesh)===null||d===void 0?void 0:d.dispose)===null||_===void 0||_.call(d),super.onDispose(o)}async onRemove(o){return this._removeMaterial(),o.scene.removeEventListener("sceneUpdate",this._onSceneUpdate),o.scene.removeEventListener("addSceneObject",this._onSceneUpdate),o.removeEventListener("postFrame",this._postFrame),o.removeEventListener("preRender",this._preRender),this._manager=void 0,super.onRemove(o)}_removeMaterial(){this._material&&(this._material.userData.renderToDepth=this._material.userData.__renderToDepth,this._material.userData.__renderToDepth=void 0,this._material=void 0)}_onSceneUpdate(o){(o==null?void 0:o.geometryChanged)!==!1&&(o==null?void 0:o.updateGround)!==!1&&this.refreshTransform()}refreshTransform(){this.enableRefreshTransform&&(this._transformNeedRefresh=!0)}_refreshOptions2(){this.refreshOptions()}refreshOptions(){this._viewer&&(this._refreshMaterial(),this.refreshTransform(),this._refreshCameraLimits())}_refreshCameraLimits(){var o;const c=(o=this._viewer)===null||o===void 0?void 0:o.scene.activeCamera.controls;c&&(c.maxPolarAngle!==void 0?this.limitCameraAboveGround?(this._cameraLimitsSet||(this._cameraLastMaxPolarAngle=c.maxPolarAngle),c.maxPolarAngle=Math.PI/2,this._cameraLimitsSet=!0):this._cameraLimitsSet&&(c.maxPolarAngle=this._cameraLastMaxPolarAngle,this._cameraLimitsSet=!1):console.warn("refreshCameraLimits only available with orbit controls."))}_refreshTransform(){var o,c,d;if(!this._mesh||!this._viewer)return;let _=!1;if(this.visible!==this._mesh.visible&&(this._mesh.visible=this.visible,_=!0),this.enabled){if(this._options.autoAdjustTransform){this._mesh.userData.bboxVisible=!1;const v=this.useModelBounds?this._viewer.scene.getModelBounds(!0,!0,!0):this._viewer.scene.getBounds(!0,!0,!0);this._mesh.userData.bboxVisible=!0;const b=v.getCenter(new three_module.Pq0).sub(new three_module.Pq0(0,v.getSize(new three_module.Pq0).y/2+this.yOffset,0));_=_||b.clone().sub(this._mesh.position).length()>1e-4,_&&this._mesh.position.copy(b)}_=_||Math.abs(this._mesh.scale.x-this.size)>1e-4,_&&(this._mesh.scale.setScalar(this.size),this._mesh.setRotationFromEuler(new three_module.O9p(-Math.PI/2,0,this._mesh.rotation.z)),this._mesh.matrixWorldNeedsUpdate=!0,(d=(c=this._mesh).setDirty)===null||d===void 0||d.call(c)),this._transformNeedRefresh=!1}else _&&((o=this._viewer)===null||o===void 0||o.scene.setDirty())}_refreshMaterial(){var o,c,d,_,v,b;if(!this._viewer||!this.enabled)return!1;this._manager||console.error("GroundPlugin requires asset manager");const tt=(o=this._material)!==null&&o!==void 0?o:(d=(c=this._manager)===null||c===void 0?void 0:c.materials)===null||d===void 0?void 0:d.findOrCreate("standard",{name:"BaseGroundMaterial",runtimeMaterial:!0,color:16777215,roughness:.75,metalness:.5});tt&&tt.userData.runtimeMaterial;let it=!1;return tt!==this._material&&(this._removeMaterial(),tt&&(this._material=tt),!((_=this._material)===null||_===void 0)&&_.uuid||console.warn("No material found for ground"),this._viewer.scene.setDirty(),this._mesh&&this._material&&(this._material.roughness=.75,this._material.metalness=.5,((b=(v=this._mesh)===null||v===void 0?void 0:v.setMaterial)!==null&&b!==void 0?b:nt=>{this._mesh&&(this._mesh.material=nt.materialObject)})(this._material)),it=!0),this._material&&(this._material.userData.__renderToDepth===void 0&&(this._material.userData.__renderToDepth=this._material.userData.renderToDepth),this._material.userData.renderToDepth!==this.renderToDepth&&(this._material.userData.renderToDepth=this.renderToDepth),this._material.userData.__postTonemap===void 0&&(this._material.userData.__postTonemap=this._material.userData.postTonemap),this._material.userData.postTonemap!==this.tonemapGround&&(this._material.userData.postTonemap=this.tonemapGround),this._material.materialObject.userData.ssaoDisabled=!0,this._material.materialObject.userData.sscsDisabled=!0),this._viewer.setDirty(this),it}setOptions(o){Object.assign(this._options,o),this.refreshOptions()}fromJSON(o,c){return super.fromJSON(o,c)?(this.refreshOptions(),this):null}_extraUiConfig(){return[()=>{var o;return(o=this._material)===null||o===void 0?void 0:o.uiConfig}]}get uiConfig(){return this._uiConfig?this._uiConfig:this._uiConfig={type:"folder",label:"Ground",children:[{label:"Visible",type:"checkbox",property:[this,"visible"],limitedUi:!0},{label:"Size",type:"input",property:[this,"size"],limitedUi:!0},{label:"Render to Depth",type:"checkbox",property:[this,"renderToDepth"]},{label:"Limit Camera",type:"checkbox",property:[this,"limitCameraAboveGround"]},{label:"Tonemap",type:"checkbox",property:[this,"tonemapGround"]},{label:"Height",type:"slider",bounds:[-2,2],property:[this,"yOffset"]},{label:"Auto adjust transform",type:"checkbox",property:[this,"autoAdjustTransform"]},...this._extraUiConfig()]}}}BaseGroundPlugin_decorate([serialize("material")],BaseGroundPlugin.prototype,"_material",void 0),BaseGroundPlugin_decorate([x$1(BaseGroundPlugin.prototype.refreshTransform),serialize()],BaseGroundPlugin.prototype,"visible",void 0),BaseGroundPlugin_decorate([ze$1(BaseGroundPlugin.prototype._onSceneUpdate),serialize()],BaseGroundPlugin.prototype,"size",void 0),BaseGroundPlugin_decorate([ze$1(BaseGroundPlugin.prototype._onSceneUpdate),serialize()],BaseGroundPlugin.prototype,"yOffset",void 0),BaseGroundPlugin_decorate([x$1(BaseGroundPlugin.prototype._refreshOptions2),serialize()],BaseGroundPlugin.prototype,"renderToDepth",void 0),BaseGroundPlugin_decorate([x$1(BaseGroundPlugin.prototype._refreshOptions2),serialize()],BaseGroundPlugin.prototype,"tonemapGround",void 0),BaseGroundPlugin_decorate([x$1(BaseGroundPlugin.prototype._refreshCameraLimits),serialize()],BaseGroundPlugin.prototype,"limitCameraAboveGround",void 0);var GroundPlugin_decorate=function(h,o,c,d){var _,v=arguments.length,b=v<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(h,o,c,d);else for(var tt=h.length-1;tt>=0;tt--)(_=h[tt])&&(b=(v<3?_(b):v>3?_(o,c,b):_(o,c))||b);return v>3&&b&&Object.defineProperty(o,c,b),b};class GroundPlugin extends BaseGroundPlugin{get shadowBaker(){return this._shadowBaker}bakeShadows(){var o;(o=this._shadowBaker)===null||o===void 0||o.reset()}constructor(o={},c=!1){super(o),this.bakedShadows=!0,this.groundReflection=!1,this.physicalReflections=!1,this.autoFrustumSize=!0,this.autoBakeShadows=!0,this._showDebug=c,c&&this.dependencies.push(DebugPlugin),this._onSceneUpdate=this._onSceneUpdate.bind(this)}_createMesh(){const o=new Reflector2(this._geometry,this._viewer.renderer.createTarget({type:three_module.OUM,format:three_module.GWd,colorSpace:three_module.jf0,size:{width:1024,height:1024},generateMipmaps:!0,depthBuffer:!0,minFilter:three_module.$_I,magFilter:three_module.k6q})),c=o.onBeforeRender;return o.onBeforeRender=(...d)=>{var _,v,b,tt,it;let nt=(v=(_=this._viewer)===null||_===void 0?void 0:_.getPluginByType("SSReflection"))===null||v===void 0?void 0:v.passes.ssr.passObject;nt&&!nt.enabled&&(nt=void 0),nt&&(nt.enabled=!1);let lt=(it=(tt=(b=this._viewer)===null||b===void 0?void 0:b.getPluginByType("SSBevelPlugin"))===null||tt===void 0?void 0:tt.pass)===null||it===void 0?void 0:it.passObject;lt&&!lt.enabled&&(lt=void 0),lt&&(lt.enabled=!1),c(...d),nt&&(nt.enabled=!0),lt&&(lt.enabled=!0)},o}async onAdded(o){var c,d;await super.onAdded(o),this._showDebug&&((c=o.getPlugin(DebugPlugin))===null||c===void 0||c.addTexture("bake_ground_1",()=>{var _,v;return(v=(_=this._shadowBaker)===null||_===void 0?void 0:_.light.shadow.map)===null||v===void 0?void 0:v.texture},[100,100,200,200]),(d=o.getPlugin(DebugPlugin))===null||d===void 0||d.addTexture("bake_ground_2",()=>{var _,v;return(v=(_=this._shadowBaker)===null||_===void 0?void 0:_.target)===null||v===void 0?void 0:v.texture},[100,400,400,400],"texel = vec4(vec3(unpackRGBAToDepth(texel)), 1.0);"))}_postFrame(){super._postFrame(),this._viewer&&this.enabled&&this._shadowBaker&&this.bakedShadows&&this._shadowBaker.autoUpdateShadow()}_preRender(){super._preRender(),this._viewer&&(this._mesh.reflectionTargetNeedsUpdate=this._viewer.renderer.frameCount<1)}async onDispose(o){return super.onDispose(o)}async onRemove(o){return super.onRemove(o)}_removeMaterial(){var o,c,d,_;if(this._material){if(this._shadowBaker&&this._material.groundMatExtension&&((c=(o=this._material).unregisterMaterialExtensions)===null||c===void 0||c.call(o,[this._shadowBaker.materialExtension]),delete this._material.groundMatExtension),this._material.reflectorMatExtension){const v=this._mesh.materialExtension;v||console.warn("WebGi GroundPlugin: unable to find the extension to unregister"),(_=(d=this._material).unregisterMaterialExtensions)===null||_===void 0||_.call(d,[v]),delete this._material.reflectorMatExtension}super._removeMaterial()}}_onSceneUpdate(o){var c;super._onSceneUpdate(o),o.geometryChanged!==!1&&this.autoBakeShadows&&((c=this._shadowBaker)===null||c===void 0||c.reset())}refreshOptions(){if(!this._viewer)return;this.bakedShadows&&!this._shadowBaker?(this._shadowBaker=new ShadowMapBaker(this._viewer),this._shadowBaker.attachedMesh=this._mesh):!this.bakedShadows&&this._shadowBaker&&(this._shadowBaker.reset(),this._shadowBaker.cleanupMaterial());const o=this._mesh;o.isReflector2&&(o.enabled=this.groundReflection,o.reflectorModePhysical=this.physicalReflections),super.refreshOptions(),this._viewer.setDirty(this)}_refreshTransform(){if(this.autoFrustumSize){const o=this.shadowBaker;if(o){const c=this.size/2;c!==o.light.shadowParams.frustumSize&&(o.light.shadowParams.frustumSize=c,o.light.updateShadowParams(),o.reset())}}super._refreshTransform()}fromJSON(o,c){return super.fromJSON(o,c)?(o.autoFrustumSize===void 0&&(this.autoFrustumSize=!1),this):null}_refreshMaterial(){var o,c,d,_;if(!this._viewer)return!1;const v=super._refreshMaterial();if(!this._material)return v;if(this.groundReflection&&this._mesh.isReflector2&&!this._material.reflectorMatExtension){const b=this._mesh.materialExtension;b.updaters=[this._viewer.scene,this._viewer.renderer],(c=(o=this._material).registerMaterialExtensions)===null||c===void 0||c.call(o,[b]),this._material.reflectorMatExtension=!0}return this.bakedShadows&&this._shadowBaker&&!this._material.groundMatExtension&&((_=(d=this._material).registerMaterialExtensions)===null||_===void 0||_.call(d,[this._shadowBaker.materialExtension]),this._material.groundMatExtension=!0),this._material.materialObject.userData.ssreflDisabled=this.groundReflection,this._material.materialObject.userData.ssreflNonPhysical=!this.physicalReflections,this._viewer.setDirty(this),v}_extraUiConfig(){var o,c,d,_,v,b,tt,it,nt,lt,ut,ht,_t,ft,bt,xt,St,wt,Pt,Rt,kt,Gt,Dt,It,Nt,Vt,Kt,Yt,nr,rr;return[{label:"Baked Shadows",type:"checkbox",property:[this,"bakedShadows"]},{label:"Shadow Frames",type:"input",hidden:()=>!this._shadowBaker,stepSize:1,bounds:[1,1e3],property:[this._shadowBaker,"maxFrameNumber"]},{label:"Alpha Vignette",type:"checkbox",hidden:()=>!this._material||this._material.transmission<1e-4&&!this._material.transparent,property:[this._shadowBaker,"alphaVignette"],limitedUi:!0,onChange:()=>{var lr,or;return(or=(lr=this._uiConfig)===null||lr===void 0?void 0:lr.uiRefresh)===null||or===void 0?void 0:or.call(lr,"postFrame",!0)}},{label:"Alpha Vignette Axis",type:"dropdown",hidden:()=>{var lr;return!(!((lr=this._shadowBaker)===null||lr===void 0)&&lr.alphaVignette)||!this._material||this._material.transmission<1e-4&&!this._material.transparent},property:[this._shadowBaker,"alphaVignetteAxis"],children:["x","y","xy"].map(lr=>({label:lr,value:lr})),limitedUi:!0},{label:"Planar Reflections",type:"checkbox",property:[this,"groundReflection"]},{label:"Auto Frustum Size",type:"checkbox",property:[this,"autoFrustumSize"]},{label:"Physical Reflections",type:"checkbox",property:[this,"physicalReflections"],limitedUi:!0},{label:"Shadow type",type:"dropdown",hidden:()=>!this._shadowBaker,property:[this._shadowBaker,"groundMapMode"],children:[{label:"aoMap"},{label:"map"},{label:"alphaMap"}],limitedUi:!0},{label:"Smooth Shadow",type:"checkbox",property:[this._shadowBaker,"smoothShadow"]},{label:"Baked shadow type",type:"dropdown",children:[["Basic",three_module.bTm],["PCF",three_module.QP0],["PCFSoft",three_module.Wk7],["VSM",three_module.RyA]].map(lr=>({label:lr[0].toString(),value:lr[1]})),property:[this._shadowBaker,"shadowMapType"]},{type:"folder",label:"Randomized Light",hidden:()=>!this._shadowBaker,limitedUi:!0,children:[{type:"color",label:"Color",property:[(o=this._shadowBaker)===null||o===void 0?void 0:o.light,"color"]},{type:"slider",label:"Intensity",bounds:[0,100],property:[(c=this._shadowBaker)===null||c===void 0?void 0:c.light,"intensity"]},{type:"checkbox",label:"Shadow Enabled",property:[(_=(d=this._shadowBaker)===null||d===void 0?void 0:d.light)===null||_===void 0?void 0:_.shadowParams,"enabled"],onChange:[(b=(v=this._shadowBaker)===null||v===void 0?void 0:v.light)===null||b===void 0?void 0:b.updateShadowParams,this._onSceneUpdate]},{type:"slider",bounds:[0,1],property:[(it=(tt=this._shadowBaker)===null||tt===void 0?void 0:tt.light)===null||it===void 0?void 0:it.randomParams,"focus"],onChange:[this._onSceneUpdate]},{type:"slider",bounds:[0,1],property:[(lt=(nt=this._shadowBaker)===null||nt===void 0?void 0:nt.light)===null||lt===void 0?void 0:lt.randomParams,"spread"],onChange:[this._onSceneUpdate],limitedUi:!0},{type:"slider",bounds:[.01,60],property:[(ht=(ut=this._shadowBaker)===null||ut===void 0?void 0:ut.light)===null||ht===void 0?void 0:ht.randomParams,"distanceScale"],onChange:[(ft=(_t=this._shadowBaker)===null||_t===void 0?void 0:_t.light)===null||ft===void 0?void 0:ft.updateShadowParams,this._onSceneUpdate]},{type:"vec3",bounds:[-1,1],property:[(xt=(bt=this._shadowBaker)===null||bt===void 0?void 0:bt.light)===null||xt===void 0?void 0:xt.randomParams,"direction"],onChange:[this._onSceneUpdate],limitedUi:!0},{type:"vec3",bounds:[-1,1],property:[(wt=(St=this._shadowBaker)===null||St===void 0?void 0:St.light)===null||wt===void 0?void 0:wt.randomParams,"normalDirection"],onChange:[this._onSceneUpdate],limitedUi:!0},{type:"slider",bounds:[.01,10],property:[(Rt=(Pt=this._shadowBaker)===null||Pt===void 0?void 0:Pt.light)===null||Rt===void 0?void 0:Rt.shadowParams,"radius"],onChange:[(Gt=(kt=this._shadowBaker)===null||kt===void 0?void 0:kt.light)===null||Gt===void 0?void 0:Gt.updateShadowParams,this._onSceneUpdate]},{type:"input",property:[(It=(Dt=this._shadowBaker)===null||Dt===void 0?void 0:Dt.light)===null||It===void 0?void 0:It.shadowParams,"frustumSize"],hidden:()=>this.autoFrustumSize,onChange:[(Vt=(Nt=this._shadowBaker)===null||Nt===void 0?void 0:Nt.light)===null||Vt===void 0?void 0:Vt.updateShadowParams,this._onSceneUpdate]},{type:"slider",bounds:[-.1,.1],property:[(Yt=(Kt=this._shadowBaker)===null||Kt===void 0?void 0:Kt.light)===null||Yt===void 0?void 0:Yt.shadowParams,"bias"],onChange:[(rr=(nr=this._shadowBaker)===null||nr===void 0?void 0:nr.light)===null||rr===void 0?void 0:rr.updateShadowParams,this._onSceneUpdate]}]},...super._extraUiConfig()]}}GroundPlugin.PluginType="Ground",GroundPlugin_decorate([x$1(GroundPlugin.prototype.refreshOptions),serialize()],GroundPlugin.prototype,"bakedShadows",void 0),GroundPlugin_decorate([x$1(GroundPlugin.prototype.refreshOptions),serialize()],GroundPlugin.prototype,"groundReflection",void 0),GroundPlugin_decorate([x$1(GroundPlugin.prototype.refreshOptions),serialize()],GroundPlugin.prototype,"physicalReflections",void 0),GroundPlugin_decorate([x$1(GroundPlugin.prototype.refreshOptions),serialize()],GroundPlugin.prototype,"autoFrustumSize",void 0),GroundPlugin_decorate([serialize("shadowBaker")],GroundPlugin.prototype,"_shadowBaker",void 0);class EXRLoader extends three_module.BRH{constructor(o){super(o),this.type=three_module.ix0}parse(o){const c=Math.pow(2.7182818,2.2),d={l:0,c:0,lc:0};function _(ar,vr,Cr,Ur,Pr){for(;Cr<ar;)vr=vr<<8|ur(Ur,Pr),Cr+=8;Cr-=ar,d.l=vr>>Cr&(1<<ar)-1,d.c=vr,d.lc=Cr}const v=new Array(59);function b(ar){return 63&ar}function tt(ar){return ar>>6}const it={c:0,lc:0};function nt(ar,vr,Cr,Ur){ar=ar<<8|ur(Cr,Ur),vr+=8,it.c=ar,it.lc=vr}const lt={c:0,lc:0};function ut(ar,vr,Cr,Ur,Pr,Dr,jr,en,rn){if(ar==vr){Ur<8&&(nt(Cr,Ur,Pr,Dr),Cr=it.c,Ur=it.lc);let mn=Cr>>(Ur-=8);if(mn=new Uint8Array([mn])[0],en.value+mn>rn)return!1;const bn=jr[en.value-1];for(;mn-- >0;)jr[en.value++]=bn}else{if(!(en.value<rn))return!1;jr[en.value++]=ar}lt.c=Cr,lt.lc=Ur}function ht(ar){return 65535&ar}function _t(ar){const vr=ht(ar);return vr>32767?vr-65536:vr}const ft={a:0,b:0};function bt(ar,vr){const Cr=_t(ar),Ur=_t(vr),Pr=Cr+(1&Ur)+(Ur>>1),Dr=Pr,jr=Pr-Ur;ft.a=Dr,ft.b=jr}function xt(ar,vr){const Cr=ht(ar),Ur=ht(vr),Pr=Cr-(Ur>>1)&65535,Dr=Ur+Pr-32768&65535;ft.a=Dr,ft.b=Pr}function St(ar,vr,Cr,Ur,Pr,Dr,jr){const en=jr<16384,rn=Cr>Pr?Pr:Cr;let mn,bn,Tn=1;for(;Tn<=rn;)Tn<<=1;for(Tn>>=1,mn=Tn,Tn>>=1;Tn>=1;){bn=0;const xn=bn+Dr*(Pr-mn),fn=Dr*Tn,En=Dr*mn,tn=Ur*Tn,wn=Ur*mn;let Vn,Hn,Rs,Qn;for(;bn<=xn;bn+=En){let jn=bn;const $n=bn+Ur*(Cr-mn);for(;jn<=$n;jn+=wn){const Kn=jn+tn,zs=jn+fn,js=zs+tn;en?(bt(ar[jn+vr],ar[zs+vr]),Vn=ft.a,Rs=ft.b,bt(ar[Kn+vr],ar[js+vr]),Hn=ft.a,Qn=ft.b,bt(Vn,Hn),ar[jn+vr]=ft.a,ar[Kn+vr]=ft.b,bt(Rs,Qn),ar[zs+vr]=ft.a,ar[js+vr]=ft.b):(xt(ar[jn+vr],ar[zs+vr]),Vn=ft.a,Rs=ft.b,xt(ar[Kn+vr],ar[js+vr]),Hn=ft.a,Qn=ft.b,xt(Vn,Hn),ar[jn+vr]=ft.a,ar[Kn+vr]=ft.b,xt(Rs,Qn),ar[zs+vr]=ft.a,ar[js+vr]=ft.b)}if(Cr&Tn){const Kn=jn+fn;en?bt(ar[jn+vr],ar[Kn+vr]):xt(ar[jn+vr],ar[Kn+vr]),Vn=ft.a,ar[Kn+vr]=ft.b,ar[jn+vr]=Vn}}if(Pr&Tn){let jn=bn;const $n=bn+Ur*(Cr-mn);for(;jn<=$n;jn+=wn){const Kn=jn+tn;en?bt(ar[jn+vr],ar[Kn+vr]):xt(ar[jn+vr],ar[Kn+vr]),Vn=ft.a,ar[Kn+vr]=ft.b,ar[jn+vr]=Vn}}mn=Tn,Tn>>=1}return bn}function wt(ar,vr,Cr,Ur,Pr,Dr){const jr=Cr.value,en=hr(vr,Cr),rn=hr(vr,Cr);Cr.value+=4;const mn=hr(vr,Cr);if(Cr.value+=4,en<0||en>=65537||rn<0||rn>=65537)throw new Error("Something wrong with HUF_ENCSIZE");const bn=new Array(65537),Tn=new Array(16384);if(function(xn){for(let fn=0;fn<16384;fn++)xn[fn]={},xn[fn].len=0,xn[fn].lit=0,xn[fn].p=null}(Tn),function(xn,fn,En,tn,wn,Vn){const Hn=fn;let Rs=0,Qn=0;for(;tn<=wn;tn++){if(Hn.value-fn.value>En)return!1;_(6,Rs,Qn,xn,Hn);const jn=d.l;if(Rs=d.c,Qn=d.lc,Vn[tn]=jn,jn==63){if(Hn.value-fn.value>En)throw new Error("Something wrong with hufUnpackEncTable");_(8,Rs,Qn,xn,Hn);let $n=d.l+6;if(Rs=d.c,Qn=d.lc,tn+$n>wn+1)throw new Error("Something wrong with hufUnpackEncTable");for(;$n--;)Vn[tn++]=0;tn--}else if(jn>=59){let $n=jn-59+2;if(tn+$n>wn+1)throw new Error("Something wrong with hufUnpackEncTable");for(;$n--;)Vn[tn++]=0;tn--}}(function(jn){for(let Kn=0;Kn<=58;++Kn)v[Kn]=0;for(let Kn=0;Kn<65537;++Kn)v[jn[Kn]]+=1;let $n=0;for(let Kn=58;Kn>0;--Kn){const zs=$n+v[Kn]>>1;v[Kn]=$n,$n=zs}for(let Kn=0;Kn<65537;++Kn){const zs=jn[Kn];zs>0&&(jn[Kn]=zs|v[zs]++<<6)}})(Vn)}(ar,Cr,Ur-(Cr.value-jr),en,rn,bn),mn>8*(Ur-(Cr.value-jr)))throw new Error("Something wrong with hufUncompress");(function(xn,fn,En,tn){for(;fn<=En;fn++){const wn=tt(xn[fn]),Vn=b(xn[fn]);if(wn>>Vn)throw new Error("Invalid table entry");if(Vn>14){const Hn=tn[wn>>Vn-14];if(Hn.len)throw new Error("Invalid table entry");if(Hn.lit++,Hn.p){const Rs=Hn.p;Hn.p=new Array(Hn.lit);for(let Qn=0;Qn<Hn.lit-1;++Qn)Hn.p[Qn]=Rs[Qn]}else Hn.p=new Array(1);Hn.p[Hn.lit-1]=fn}else if(Vn){let Hn=0;for(let Rs=1<<14-Vn;Rs>0;Rs--){const Qn=tn[(wn<<14-Vn)+Hn];if(Qn.len||Qn.p)throw new Error("Invalid table entry");Qn.len=Vn,Qn.lit=fn,Hn++}}}})(bn,en,rn,Tn),function(xn,fn,En,tn,wn,Vn,Hn,Rs,Qn){let jn=0,$n=0;const Kn=Hn,zs=Math.trunc(tn.value+(wn+7)/8);for(;tn.value<zs;)for(nt(jn,$n,En,tn),jn=it.c,$n=it.lc;$n>=14;){const qs=fn[jn>>$n-14&16383];if(qs.len)$n-=qs.len,ut(qs.lit,Vn,jn,$n,En,tn,Rs,Qn,Kn),jn=lt.c,$n=lt.lc;else{if(!qs.p)throw new Error("hufDecode issues");let eo;for(eo=0;eo<qs.lit;eo++){const To=b(xn[qs.p[eo]]);for(;$n<To&&tn.value<zs;)nt(jn,$n,En,tn),jn=it.c,$n=it.lc;if($n>=To&&tt(xn[qs.p[eo]])==(jn>>$n-To&(1<<To)-1)){$n-=To,ut(qs.p[eo],Vn,jn,$n,En,tn,Rs,Qn,Kn),jn=lt.c,$n=lt.lc;break}}if(eo==qs.lit)throw new Error("hufDecode issues")}}const js=8-wn&7;for(jn>>=js,$n-=js;$n>0;){const qs=fn[jn<<14-$n&16383];if(!qs.len)throw new Error("hufDecode issues");$n-=qs.len,ut(qs.lit,Vn,jn,$n,En,tn,Rs,Qn,Kn),jn=lt.c,$n=lt.lc}}(bn,Tn,ar,Cr,mn,rn,Dr,Pr,{value:0})}function Pt(ar){for(let vr=1;vr<ar.length;vr++){const Cr=ar[vr-1]+ar[vr]-128;ar[vr]=Cr}}function Rt(ar,vr){let Cr=0,Ur=Math.floor((ar.length+1)/2),Pr=0;const Dr=ar.length-1;for(;!(Pr>Dr||(vr[Pr++]=ar[Cr++],Pr>Dr));)vr[Pr++]=ar[Ur++]}function kt(ar){let vr=ar.byteLength;const Cr=new Array;let Ur=0;const Pr=new DataView(ar);for(;vr>0;){const Dr=Pr.getInt8(Ur++);if(Dr<0){const jr=-Dr;vr-=jr+1;for(let en=0;en<jr;en++)Cr.push(Pr.getUint8(Ur++))}else{const jr=Dr;vr-=2;const en=Pr.getUint8(Ur++);for(let rn=0;rn<jr+1;rn++)Cr.push(en)}}return Cr}function Gt(ar,vr,Cr){let Ur,Pr=1;for(;Pr<64;)Ur=vr[ar.value],Ur==65280?Pr=64:Ur>>8==255?Pr+=255&Ur:(Cr[Pr]=Ur,Pr++),ar.value++}function Dt(ar){const vr=.5*Math.cos(.7853975),Cr=.5*Math.cos(3.14159/16),Ur=.5*Math.cos(3.14159/8),Pr=.5*Math.cos(3*3.14159/16),Dr=.5*Math.cos(.981746875),jr=.5*Math.cos(3*3.14159/8),en=.5*Math.cos(1.374445625),rn=new Array(4),mn=new Array(4),bn=new Array(4),Tn=new Array(4);for(let xn=0;xn<8;++xn){const fn=8*xn;rn[0]=Ur*ar[fn+2],rn[1]=jr*ar[fn+2],rn[2]=Ur*ar[fn+6],rn[3]=jr*ar[fn+6],mn[0]=Cr*ar[fn+1]+Pr*ar[fn+3]+Dr*ar[fn+5]+en*ar[fn+7],mn[1]=Pr*ar[fn+1]-en*ar[fn+3]-Cr*ar[fn+5]-Dr*ar[fn+7],mn[2]=Dr*ar[fn+1]-Cr*ar[fn+3]+en*ar[fn+5]+Pr*ar[fn+7],mn[3]=en*ar[fn+1]-Dr*ar[fn+3]+Pr*ar[fn+5]-Cr*ar[fn+7],bn[0]=vr*(ar[fn+0]+ar[fn+4]),bn[3]=vr*(ar[fn+0]-ar[fn+4]),bn[1]=rn[0]+rn[3],bn[2]=rn[1]-rn[2],Tn[0]=bn[0]+bn[1],Tn[1]=bn[3]+bn[2],Tn[2]=bn[3]-bn[2],Tn[3]=bn[0]-bn[1],ar[fn+0]=Tn[0]+mn[0],ar[fn+1]=Tn[1]+mn[1],ar[fn+2]=Tn[2]+mn[2],ar[fn+3]=Tn[3]+mn[3],ar[fn+4]=Tn[3]-mn[3],ar[fn+5]=Tn[2]-mn[2],ar[fn+6]=Tn[1]-mn[1],ar[fn+7]=Tn[0]-mn[0]}for(let xn=0;xn<8;++xn)rn[0]=Ur*ar[16+xn],rn[1]=jr*ar[16+xn],rn[2]=Ur*ar[48+xn],rn[3]=jr*ar[48+xn],mn[0]=Cr*ar[8+xn]+Pr*ar[24+xn]+Dr*ar[40+xn]+en*ar[56+xn],mn[1]=Pr*ar[8+xn]-en*ar[24+xn]-Cr*ar[40+xn]-Dr*ar[56+xn],mn[2]=Dr*ar[8+xn]-Cr*ar[24+xn]+en*ar[40+xn]+Pr*ar[56+xn],mn[3]=en*ar[8+xn]-Dr*ar[24+xn]+Pr*ar[40+xn]-Cr*ar[56+xn],bn[0]=vr*(ar[xn]+ar[32+xn]),bn[3]=vr*(ar[xn]-ar[32+xn]),bn[1]=rn[0]+rn[3],bn[2]=rn[1]-rn[2],Tn[0]=bn[0]+bn[1],Tn[1]=bn[3]+bn[2],Tn[2]=bn[3]-bn[2],Tn[3]=bn[0]-bn[1],ar[0+xn]=Tn[0]+mn[0],ar[8+xn]=Tn[1]+mn[1],ar[16+xn]=Tn[2]+mn[2],ar[24+xn]=Tn[3]+mn[3],ar[32+xn]=Tn[3]-mn[3],ar[40+xn]=Tn[2]-mn[2],ar[48+xn]=Tn[1]-mn[1],ar[56+xn]=Tn[0]-mn[0]}function It(ar){for(let vr=0;vr<64;++vr){const Cr=ar[0][vr],Ur=ar[1][vr],Pr=ar[2][vr];ar[0][vr]=Cr+1.5747*Pr,ar[1][vr]=Cr-.1873*Ur-.4682*Pr,ar[2][vr]=Cr+1.8556*Ur}}function Nt(ar,vr,Cr){for(let Pr=0;Pr<64;++Pr)vr[Cr+Pr]=three_module.GxU.toHalfFloat((Ur=ar[Pr])<=1?Math.sign(Ur)*Math.pow(Math.abs(Ur),2.2):Math.sign(Ur)*Math.pow(c,Math.abs(Ur)-1));var Ur}function Vt(ar){return new DataView(ar.array.buffer,ar.offset.value,ar.size)}function Kt(ar){const vr=ar.viewer.buffer.slice(ar.offset.value,ar.offset.value+ar.size),Cr=new Uint8Array(kt(vr)),Ur=new Uint8Array(Cr.length);return Pt(Cr),Rt(Cr,Ur),new DataView(Ur.buffer)}function Yt(ar){const vr=fflate_module_unzlibSync(ar.array.slice(ar.offset.value,ar.offset.value+ar.size)),Cr=new Uint8Array(vr.length);return Pt(vr),Rt(vr,Cr),new DataView(Cr.buffer)}function nr(ar){const vr=ar.viewer,Cr={value:ar.offset.value},Ur=new Uint16Array(ar.width*ar.scanlineBlockSize*(ar.channels*ar.type)),Pr=new Uint8Array(8192);let Dr=0;const jr=new Array(ar.channels);for(let En=0;En<ar.channels;En++)jr[En]={},jr[En].start=Dr,jr[En].end=jr[En].start,jr[En].nx=ar.width,jr[En].ny=ar.lines,jr[En].size=ar.type,Dr+=jr[En].nx*jr[En].ny*jr[En].size;const en=tr(vr,Cr),rn=tr(vr,Cr);if(rn>=8192)throw new Error("Something is wrong with PIZ_COMPRESSION BITMAP_SIZE");if(en<=rn)for(let En=0;En<rn-en+1;En++)Pr[En+en]=cr(vr,Cr);const mn=new Uint16Array(65536),bn=function(En,tn){let wn=0;for(let Hn=0;Hn<65536;++Hn)(Hn==0||En[Hn>>3]&1<<(7&Hn))&&(tn[wn++]=Hn);const Vn=wn-1;for(;wn<65536;)tn[wn++]=0;return Vn}(Pr,mn),Tn=hr(vr,Cr);wt(ar.array,vr,Cr,Tn,Ur,Dr);for(let En=0;En<ar.channels;++En){const tn=jr[En];for(let wn=0;wn<jr[En].size;++wn)St(Ur,tn.start+wn,tn.nx,tn.size,tn.ny,tn.nx*tn.size,bn)}(function(En,tn,wn){for(let Vn=0;Vn<wn;++Vn)tn[Vn]=En[tn[Vn]]})(mn,Ur,Dr);let xn=0;const fn=new Uint8Array(Ur.buffer.byteLength);for(let En=0;En<ar.lines;En++)for(let tn=0;tn<ar.channels;tn++){const wn=jr[tn],Vn=wn.nx*wn.size,Hn=new Uint8Array(Ur.buffer,2*wn.end,2*Vn);fn.set(Hn,xn),xn+=2*Vn,wn.end+=Vn}return new DataView(fn.buffer)}function rr(ar){const vr=fflate_module_unzlibSync(ar.array.slice(ar.offset.value,ar.offset.value+ar.size)),Cr=ar.lines*ar.channels*ar.width,Ur=ar.type==1?new Uint16Array(Cr):new Uint32Array(Cr);let Pr=0,Dr=0;const jr=new Array(4);for(let en=0;en<ar.lines;en++)for(let rn=0;rn<ar.channels;rn++){let mn=0;switch(ar.type){case 1:jr[0]=Pr,jr[1]=jr[0]+ar.width,Pr=jr[1]+ar.width;for(let bn=0;bn<ar.width;++bn)mn+=vr[jr[0]++]<<8|vr[jr[1]++],Ur[Dr]=mn,Dr++;break;case 2:jr[0]=Pr,jr[1]=jr[0]+ar.width,jr[2]=jr[1]+ar.width,Pr=jr[2]+ar.width;for(let bn=0;bn<ar.width;++bn)mn+=vr[jr[0]++]<<24|vr[jr[1]++]<<16|vr[jr[2]++]<<8,Ur[Dr]=mn,Dr++}}return new DataView(Ur.buffer)}function lr(ar){const vr=ar.viewer,Cr={value:ar.offset.value},Ur=new Uint8Array(ar.width*ar.lines*(ar.channels*ar.type*2)),Pr={version:br(vr,Cr),unknownUncompressedSize:br(vr,Cr),unknownCompressedSize:br(vr,Cr),acCompressedSize:br(vr,Cr),dcCompressedSize:br(vr,Cr),rleCompressedSize:br(vr,Cr),rleUncompressedSize:br(vr,Cr),rleRawSize:br(vr,Cr),totalAcUncompressedCount:br(vr,Cr),totalDcUncompressedCount:br(vr,Cr),acCompression:br(vr,Cr)};if(Pr.version<2)throw new Error("EXRLoader.parse: "+Pn.compression+" version "+Pr.version+" is unsupported");const Dr=new Array;let jr=tr(vr,Cr)-2;for(;jr>0;){const tn=or(vr.buffer,Cr),wn=cr(vr,Cr),Vn=wn>>2&3,Hn=new Int8Array([(wn>>4)-1])[0],Rs=cr(vr,Cr);Dr.push({name:tn,index:Hn,type:Rs,compression:Vn}),jr-=tn.length+3}const en=Pn.channels,rn=new Array(ar.channels);for(let tn=0;tn<ar.channels;++tn){const wn=rn[tn]={},Vn=en[tn];wn.name=Vn.name,wn.compression=0,wn.decoded=!1,wn.type=Vn.pixelType,wn.pLinear=Vn.pLinear,wn.width=ar.width,wn.height=ar.lines}const mn={idx:new Array(3)};for(let tn=0;tn<ar.channels;++tn){const wn=rn[tn];for(let Vn=0;Vn<Dr.length;++Vn){const Hn=Dr[Vn];wn.name==Hn.name&&(wn.compression=Hn.compression,Hn.index>=0&&(mn.idx[Hn.index]=tn),wn.offset=tn)}}let bn,Tn,xn;if(Pr.acCompressedSize>0)switch(Pr.acCompression){case 0:bn=new Uint16Array(Pr.totalAcUncompressedCount),wt(ar.array,vr,Cr,Pr.acCompressedSize,bn,Pr.totalAcUncompressedCount);break;case 1:const tn=fflate_module_unzlibSync(ar.array.slice(Cr.value,Cr.value+Pr.totalAcUncompressedCount));bn=new Uint16Array(tn.buffer),Cr.value+=Pr.totalAcUncompressedCount}if(Pr.dcCompressedSize>0){const tn={array:ar.array,offset:Cr,size:Pr.dcCompressedSize};Tn=new Uint16Array(Yt(tn).buffer),Cr.value+=Pr.dcCompressedSize}Pr.rleRawSize>0&&(xn=kt(fflate_module_unzlibSync(ar.array.slice(Cr.value,Cr.value+Pr.rleCompressedSize)).buffer),Cr.value+=Pr.rleCompressedSize);let fn=0;const En=new Array(rn.length);for(let tn=0;tn<En.length;++tn)En[tn]=new Array;for(let tn=0;tn<ar.lines;++tn)for(let wn=0;wn<rn.length;++wn)En[wn].push(fn),fn+=rn[wn].width*ar.type*2;(function(tn,wn,Vn,Hn,Rs,Qn){let jn=new DataView(Qn.buffer);const $n=Vn[tn.idx[0]].width,Kn=Vn[tn.idx[0]].height,zs=Math.floor($n/8),js=Math.ceil($n/8),qs=Math.ceil(Kn/8),eo=$n-8*(js-1),To=Kn-8*(qs-1),tp={value:0},po=new Array(3),to=new Array(3),ba=new Array(3),ro=new Array(3),Tl=new Array(3);for(let Es=0;Es<3;++Es)Tl[Es]=wn[tn.idx[Es]],po[Es]=Es<1?0:po[Es-1]+js*qs,to[Es]=new Float32Array(64),ba[Es]=new Uint16Array(64),ro[Es]=new Uint16Array(64*js);for(let Es=0;Es<qs;++Es){let Ml=8;Es==qs-1&&(Ml=To);let ho=8;for(let xs=0;xs<js;++xs){xs==js-1&&(ho=eo);for(let Cs=0;Cs<3;++Cs)ba[Cs].fill(0),ba[Cs][0]=Rs[po[Cs]++],Gt(tp,Hn,ba[Cs]),Rn=ba[Cs],(On=to[Cs])[0]=gr(Rn[0]),On[1]=gr(Rn[1]),On[2]=gr(Rn[5]),On[3]=gr(Rn[6]),On[4]=gr(Rn[14]),On[5]=gr(Rn[15]),On[6]=gr(Rn[27]),On[7]=gr(Rn[28]),On[8]=gr(Rn[2]),On[9]=gr(Rn[4]),On[10]=gr(Rn[7]),On[11]=gr(Rn[13]),On[12]=gr(Rn[16]),On[13]=gr(Rn[26]),On[14]=gr(Rn[29]),On[15]=gr(Rn[42]),On[16]=gr(Rn[3]),On[17]=gr(Rn[8]),On[18]=gr(Rn[12]),On[19]=gr(Rn[17]),On[20]=gr(Rn[25]),On[21]=gr(Rn[30]),On[22]=gr(Rn[41]),On[23]=gr(Rn[43]),On[24]=gr(Rn[9]),On[25]=gr(Rn[11]),On[26]=gr(Rn[18]),On[27]=gr(Rn[24]),On[28]=gr(Rn[31]),On[29]=gr(Rn[40]),On[30]=gr(Rn[44]),On[31]=gr(Rn[53]),On[32]=gr(Rn[10]),On[33]=gr(Rn[19]),On[34]=gr(Rn[23]),On[35]=gr(Rn[32]),On[36]=gr(Rn[39]),On[37]=gr(Rn[45]),On[38]=gr(Rn[52]),On[39]=gr(Rn[54]),On[40]=gr(Rn[20]),On[41]=gr(Rn[22]),On[42]=gr(Rn[33]),On[43]=gr(Rn[38]),On[44]=gr(Rn[46]),On[45]=gr(Rn[51]),On[46]=gr(Rn[55]),On[47]=gr(Rn[60]),On[48]=gr(Rn[21]),On[49]=gr(Rn[34]),On[50]=gr(Rn[37]),On[51]=gr(Rn[47]),On[52]=gr(Rn[50]),On[53]=gr(Rn[56]),On[54]=gr(Rn[59]),On[55]=gr(Rn[61]),On[56]=gr(Rn[35]),On[57]=gr(Rn[36]),On[58]=gr(Rn[48]),On[59]=gr(Rn[49]),On[60]=gr(Rn[57]),On[61]=gr(Rn[58]),On[62]=gr(Rn[62]),On[63]=gr(Rn[63]),Dt(to[Cs]);It(to);for(let Cs=0;Cs<3;++Cs)Nt(to[Cs],ro[Cs],64*xs)}let Qs=0;for(let xs=0;xs<3;++xs){const Cs=Vn[tn.idx[xs]].type;for(let No=8*Es;No<8*Es+Ml;++No){Qs=Tl[xs][No];for(let Mo=0;Mo<zs;++Mo){const bo=64*Mo+8*(7&No);jn.setUint16(Qs+0*Cs,ro[xs][bo+0],!0),jn.setUint16(Qs+2*Cs,ro[xs][bo+1],!0),jn.setUint16(Qs+4*Cs,ro[xs][bo+2],!0),jn.setUint16(Qs+6*Cs,ro[xs][bo+3],!0),jn.setUint16(Qs+8*Cs,ro[xs][bo+4],!0),jn.setUint16(Qs+10*Cs,ro[xs][bo+5],!0),jn.setUint16(Qs+12*Cs,ro[xs][bo+6],!0),jn.setUint16(Qs+14*Cs,ro[xs][bo+7],!0),Qs+=16*Cs}}if(zs!=js)for(let No=8*Es;No<8*Es+Ml;++No){const Mo=Tl[xs][No]+8*zs*2*Cs,bo=64*zs+8*(7&No);for(let _l=0;_l<ho;++_l)jn.setUint16(Mo+2*_l*Cs,ro[xs][bo+_l],!0)}}}var Rn,On;const io=new Uint16Array($n);jn=new DataView(Qn.buffer);for(let Es=0;Es<3;++Es){Vn[tn.idx[Es]].decoded=!0;const Ml=Vn[tn.idx[Es]].type;if(Vn[Es].type==2)for(let ho=0;ho<Kn;++ho){const Qs=Tl[Es][ho];for(let xs=0;xs<$n;++xs)io[xs]=jn.getUint16(Qs+2*xs*Ml,!0);for(let xs=0;xs<$n;++xs)jn.setFloat32(Qs+2*xs*Ml,gr(io[xs]),!0)}}})(mn,En,rn,bn,Tn,Ur);for(let tn=0;tn<rn.length;++tn){const wn=rn[tn];if(!wn.decoded){if(wn.compression!==2)throw new Error("EXRLoader.parse: unsupported channel compression");{let Vn=0,Hn=0;for(let Rs=0;Rs<ar.lines;++Rs){let Qn=En[tn][Vn];for(let jn=0;jn<wn.width;++jn){for(let $n=0;$n<2*wn.type;++$n)Ur[Qn++]=xn[Hn+$n*wn.width*wn.height];Hn++}Vn++}}}}return new DataView(Ur.buffer)}function or(ar,vr){const Cr=new Uint8Array(ar);let Ur=0;for(;Cr[vr.value+Ur]!=0;)Ur+=1;const Pr=new TextDecoder().decode(Cr.slice(vr.value,vr.value+Ur));return vr.value=vr.value+Ur+1,Pr}function pr(ar,vr){const Cr=ar.getInt32(vr.value,!0);return vr.value=vr.value+4,Cr}function hr(ar,vr){const Cr=ar.getUint32(vr.value,!0);return vr.value=vr.value+4,Cr}function ur(ar,vr){const Cr=ar[vr.value];return vr.value=vr.value+1,Cr}function cr(ar,vr){const Cr=ar.getUint8(vr.value);return vr.value=vr.value+1,Cr}const br=function(ar,vr){let Cr;return Cr="getBigInt64"in DataView.prototype?Number(ar.getBigInt64(vr.value,!0)):ar.getUint32(vr.value+4,!0)+Number(ar.getUint32(vr.value,!0)<<32),vr.value+=8,Cr};function fr(ar,vr){const Cr=ar.getFloat32(vr.value,!0);return vr.value+=4,Cr}function kr(ar,vr){return three_module.GxU.toHalfFloat(fr(ar,vr))}function gr(ar){const vr=(31744&ar)>>10,Cr=1023&ar;return(ar>>15?-1:1)*(vr?vr===31?Cr?NaN:1/0:Math.pow(2,vr-15)*(1+Cr/1024):Cr/1024*6103515625e-14)}function tr(ar,vr){const Cr=ar.getUint16(vr.value,!0);return vr.value+=2,Cr}function dr(ar,vr){return gr(tr(ar,vr))}function Ir(ar,vr,Cr,Ur,Pr){return Ur==="string"||Ur==="stringvector"||Ur==="iccProfile"?function(Dr,jr,en){const rn=new TextDecoder().decode(new Uint8Array(Dr).slice(jr.value,jr.value+en));return jr.value=jr.value+en,rn}(vr,Cr,Pr):Ur==="chlist"?function(Dr,jr,en,rn){const mn=en.value,bn=[];for(;en.value<mn+rn-1;){const Tn=or(jr,en),xn=pr(Dr,en),fn=cr(Dr,en);en.value+=3;const En=pr(Dr,en),tn=pr(Dr,en);bn.push({name:Tn,pixelType:xn,pLinear:fn,xSampling:En,ySampling:tn})}return en.value+=1,bn}(ar,vr,Cr,Pr):Ur==="chromaticities"?function(Dr,jr){return{redX:fr(Dr,jr),redY:fr(Dr,jr),greenX:fr(Dr,jr),greenY:fr(Dr,jr),blueX:fr(Dr,jr),blueY:fr(Dr,jr),whiteX:fr(Dr,jr),whiteY:fr(Dr,jr)}}(ar,Cr):Ur==="compression"?function(Dr,jr){return["NO_COMPRESSION","RLE_COMPRESSION","ZIPS_COMPRESSION","ZIP_COMPRESSION","PIZ_COMPRESSION","PXR24_COMPRESSION","B44_COMPRESSION","B44A_COMPRESSION","DWAA_COMPRESSION","DWAB_COMPRESSION"][cr(Dr,jr)]}(ar,Cr):Ur==="box2i"?function(Dr,jr){return{xMin:hr(Dr,jr),yMin:hr(Dr,jr),xMax:hr(Dr,jr),yMax:hr(Dr,jr)}}(ar,Cr):Ur==="lineOrder"?function(Dr,jr){return["INCREASING_Y"][cr(Dr,jr)]}(ar,Cr):Ur==="float"?fr(ar,Cr):Ur==="v2f"?function(Dr,jr){return[fr(Dr,jr),fr(Dr,jr)]}(ar,Cr):Ur==="v3f"?function(Dr,jr){return[fr(Dr,jr),fr(Dr,jr),fr(Dr,jr)]}(ar,Cr):Ur==="int"?pr(ar,Cr):Ur==="rational"?function(Dr,jr){return[pr(Dr,jr),hr(Dr,jr)]}(ar,Cr):Ur==="timecode"?function(Dr,jr){return[hr(Dr,jr),hr(Dr,jr)]}(ar,Cr):Ur==="preview"?(Cr.value+=Pr,"skipped"):void(Cr.value+=Pr)}const Xr=new DataView(o),Jr=new Uint8Array(o),on={value:0},Pn=function(ar,vr,Cr){const Ur={};if(ar.getUint32(0,!0)!=20000630)throw new Error("THREE.EXRLoader: Provided file doesn't appear to be in OpenEXR format.");Ur.version=ar.getUint8(4);const Pr=ar.getUint8(5);Ur.spec={singleTile:!!(2&Pr),longName:!!(4&Pr),deepFormat:!!(8&Pr),multiPart:!!(16&Pr)},Cr.value=8;let Dr=!0;for(;Dr;){const jr=or(vr,Cr);if(jr==0)Dr=!1;else{const en=or(vr,Cr),rn=Ir(ar,vr,Cr,en,hr(ar,Cr));rn===void 0?console.warn(`THREE.EXRLoader: Skipped unknown header attribute type '${en}'.`):Ur[jr]=rn}}if(-5&Pr)throw console.error("THREE.EXRHeader:",Ur),new Error("THREE.EXRLoader: Provided file is currently unsupported.");return Ur}(Xr,o,on),vn=function(ar,vr,Cr,Ur,Pr){const Dr={size:0,viewer:vr,array:Cr,offset:Ur,width:ar.dataWindow.xMax-ar.dataWindow.xMin+1,height:ar.dataWindow.yMax-ar.dataWindow.yMin+1,channels:ar.channels.length,bytesPerLine:null,lines:null,inputSize:null,type:ar.channels[0].pixelType,uncompress:null,getter:null,format:null,colorSpace:three_module.Zr2};switch(ar.compression){case"NO_COMPRESSION":Dr.lines=1,Dr.uncompress=Vt;break;case"RLE_COMPRESSION":Dr.lines=1,Dr.uncompress=Kt;break;case"ZIPS_COMPRESSION":Dr.lines=1,Dr.uncompress=Yt;break;case"ZIP_COMPRESSION":Dr.lines=16,Dr.uncompress=Yt;break;case"PIZ_COMPRESSION":Dr.lines=32,Dr.uncompress=nr;break;case"PXR24_COMPRESSION":Dr.lines=16,Dr.uncompress=rr;break;case"DWAA_COMPRESSION":Dr.lines=32,Dr.uncompress=lr;break;case"DWAB_COMPRESSION":Dr.lines=256,Dr.uncompress=lr;break;default:throw new Error("EXRLoader.parse: "+ar.compression+" is unsupported")}if(Dr.scanlineBlockSize=Dr.lines,Dr.type==1)switch(Pr){case three_module.RQf:Dr.getter=dr,Dr.inputSize=2;break;case three_module.ix0:Dr.getter=tr,Dr.inputSize=2}else{if(Dr.type!=2)throw new Error("EXRLoader.parse: unsupported pixelType "+Dr.type+" for "+ar.compression+".");switch(Pr){case three_module.RQf:Dr.getter=fr,Dr.inputSize=4;break;case three_module.ix0:Dr.getter=kr,Dr.inputSize=4}}Dr.blockCount=(ar.dataWindow.yMax+1)/Dr.scanlineBlockSize;for(let en=0;en<Dr.blockCount;en++)br(vr,Ur);Dr.outputChannels=Dr.channels==3?4:Dr.channels;const jr=Dr.width*Dr.height*Dr.outputChannels;switch(Pr){case three_module.RQf:Dr.byteArray=new Float32Array(jr),Dr.channels<Dr.outputChannels&&Dr.byteArray.fill(1,0,jr);break;case three_module.ix0:Dr.byteArray=new Uint16Array(jr),Dr.channels<Dr.outputChannels&&Dr.byteArray.fill(15360,0,jr);break;default:console.error("THREE.EXRLoader: unsupported type: ",Pr)}return Dr.bytesPerLine=Dr.width*Dr.inputSize*Dr.channels,Dr.outputChannels==4?(Dr.format=three_module.GWd,Dr.colorSpace=three_module.Zr2):(Dr.format=three_module.VT0,Dr.colorSpace=three_module.jf0),Dr}(Pn,Xr,Jr,on,this.type),Gn={value:0},ms={R:0,G:1,B:2,A:3,Y:0};for(let ar=0;ar<vn.height/vn.scanlineBlockSize;ar++){const vr=hr(Xr,on);vn.size=hr(Xr,on),vn.lines=vr+vn.scanlineBlockSize>vn.height?vn.height-vr:vn.scanlineBlockSize;const Cr=vn.size<vn.lines*vn.bytesPerLine?vn.uncompress(vn):Vt(vn);on.value+=vn.size;for(let Ur=0;Ur<vn.scanlineBlockSize;Ur++){const Pr=Ur+ar*vn.scanlineBlockSize;if(Pr>=vn.height)break;for(let Dr=0;Dr<vn.channels;Dr++){const jr=ms[Pn.channels[Dr].name];for(let en=0;en<vn.width;en++){Gn.value=(Ur*(vn.channels*vn.width)+Dr*vn.width+en)*vn.inputSize;const rn=(vn.height-1-Pr)*(vn.width*vn.outputChannels)+en*vn.outputChannels+jr;vn.byteArray[rn]=vn.getter(Cr,Gn)}}}}return{header:Pn,width:vn.width,height:vn.height,data:vn.byteArray,format:vn.format,colorSpace:vn.colorSpace,type:this.type}}setDataType(o){return this.type=o,this}load(o,c,d,_){return super.load(o,function(v,b){v.colorSpace=b.colorSpace,v.minFilter=three_module.k6q,v.magFilter=three_module.k6q,v.generateMipmaps=!1,v.flipY=!1,c&&c(v,b)},d,_)}}class EXRLoadPlugin extends I$2{constructor(){super(...arguments),this.dependencies=[AssetManagerPlugin]}async onAdded(o){var c,d;this._importer||(this._importer=new Importer(class extends EXRLoader{constructor(_){super(_),this.setDataType(getTextureDataType(o.renderer.rendererObject))}},["exr"],!1)),(d=(c=o.getManager())===null||c===void 0?void 0:c.importer)===null||d===void 0||d.Importers.push(this._importer)}async onDispose(o){this._importer=void 0}async onRemove(o){var c,d;this._importer&&!((d=(c=o.getManager())===null||c===void 0?void 0:c.importer)===null||d===void 0)&&d.Importers&&o.getManager().importer.Importers.splice(o.getManager().importer.Importers.indexOf(this._importer),1),this._importer=void 0}}EXRLoadPlugin.PluginType="EXRLoadPlugin";const _3DMLoader_taskCache=new WeakMap;class Rhino3dmLoader extends three_module.aHM{constructor(o){super(o),this.libraryPath="",this.libraryPending=null,this.libraryBinary=null,this.libraryConfig={},this.url="",this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.workerConfig={},this.materials=[],this.warnings=[]}setLibraryPath(o){return this.libraryPath=o,this}setWorkerLimit(o){return this.workerLimit=o,this}load(o,c,d,_){const v=new three_module.Y9S(this.manager);v.setPath(this.path),v.setResponseType("arraybuffer"),v.setRequestHeader(this.requestHeader),this.url=o,v.load(o,b=>{if(_3DMLoader_taskCache.has(b))return _3DMLoader_taskCache.get(b).promise.then(c).catch(_);this.decodeObjects(b,o).then(tt=>{tt.userData.warnings=this.warnings,this.warnings=[],c(tt)}).catch(tt=>_(tt))},d,_)}debug(){console.log("Task load: ",this.workerPool.map(o=>o._taskLoad))}decodeObjects(o,c){let d,_;const v=o.byteLength,b=this._getWorker(v).then(tt=>(d=tt,_=this.workerNextTaskID++,new Promise((it,nt)=>{d._callbacks[_]={resolve:it,reject:nt},d.postMessage({type:"decode",id:_,buffer:o},[o])}))).then(tt=>this._createGeometry(tt.data)).catch(tt=>{throw tt});return b.catch(()=>!0).then(()=>{d&&_&&this._releaseTask(d,_)}),_3DMLoader_taskCache.set(o,{url:c,promise:b}),b}parse(o,c,d){this.decodeObjects(o,"").then(_=>{_.userData.warnings=this.warnings,c(_)}).catch(_=>d(_))}_compareMaterials(o){if(this.materials.includes(o))return o;const c={};c.name=o.name,c.color={},c.color.r=o.color.r,c.color.g=o.color.g,c.color.b=o.color.b,c.type=o.type,c.vertexColors=o.vertexColors;const d=JSON.stringify(c);for(let _=0;_<this.materials.length;_++){const v=this.materials[_],b={};if(b.name=v.name,b.color={},b.color.r=v.color.r,b.color.g=v.color.g,b.color.b=v.color.b,b.type=v.type,b.vertexColors=v.vertexColors,JSON.stringify(b)===d)return v}return this.materials.push(o),o}_createMaterial(o,c){if(o===void 0)return new three_module._4j({color:new three_module.Q1f(1,1,1),metalness:.8,name:three_module.aHM.DEFAULT_MATERIAL_NAME,side:three_module.$EB});const d=new three_module.uSd({color:new three_module.Q1f(o.diffuseColor.r/255,o.diffuseColor.g/255,o.diffuseColor.b/255),emissive:new three_module.Q1f(o.emissionColor.r,o.emissionColor.g,o.emissionColor.b),flatShading:o.disableLighting,ior:o.indexOfRefraction,name:o.name,reflectivity:o.reflectivity,opacity:1-o.transparency,side:three_module.$EB,specularColor:o.specularColor,transparent:o.transparency>0});if(d.userData.id=o.id,o.pbrSupported){const v=o.pbr;d.anisotropy=v.anisotropic,d.anisotropyRotation=v.anisotropicRotation,d.color=new three_module.Q1f(v.baseColor.r,v.baseColor.g,v.baseColor.b),d.clearcoat=v.clearcoat,d.clearcoatRoughness=v.clearcoatRoughness,d.metalness=v.metallic,d.transmission=1-v.opacity,d.roughness=v.roughness,d.sheen=v.sheen,d.specularIntensity=v.specular,d.thickness=v.subsurface}o.pbrSupported&&o.pbr.opacity===0&&o.transparency===1&&(d.opacity=.2,d.transmission=1);const _=new three_module.Tap;for(let v=0;v<o.textures.length;v++){const b=o.textures[v];if(b.image!==null){const tt=_.load(b.image);switch(b.type){case"Bump":d.bumpMap=tt;break;case"Diffuse":case"PBR_BaseColor":d.map=tt;break;case"Emap":d.envMap=tt;break;case"Opacity":d.transmissionMap=tt;break;case"Transparency":case"PBR_Alpha":d.alphaMap=tt,d.transparent=!0;break;case"PBR_AmbientOcclusion":d.aoMap=tt;break;case"PBR_Anisotropic":d.anisotropyMap=tt;break;case"PBR_Clearcoat":d.clearcoatMap=tt;break;case"PBR_ClearcoatBump":d.clearcoatNormalMap=tt;break;case"PBR_ClearcoatRoughness":d.clearcoatRoughnessMap=tt;break;case"PBR_Displacement":d.displacementMap=tt;break;case"PBR_Emission":d.emissiveMap=tt;break;case"PBR_Metallic":d.metalnessMap=tt;break;case"PBR_Roughness":d.roughnessMap=tt;break;case"PBR_Sheen":d.sheenColorMap=tt;break;case"PBR_Specular":d.specularColorMap=tt;break;case"PBR_Subsurface":d.thicknessMap=tt;break;default:this.warnings.push({message:`THREE.3DMLoader: No conversion exists for 3dm ${b.type}.`,type:"no conversion"})}tt.wrapS=b.wrapU===0?three_module.GJx:three_module.ghU,tt.wrapT=b.wrapV===0?three_module.GJx:three_module.ghU,b.repeat&&tt.repeat.set(b.repeat[0],b.repeat[1])}}return c&&new EXRLoader().load(c.image,function(v){v.mapping=THREE.EquirectangularReflectionMapping,d.envMap=v}),d}_createGeometry(o){const c=new three_module.B69,d=[],_=[],v=[];c.userData.layers=o.layers,c.userData.groups=o.groups,c.userData.settings=o.settings,c.userData.settings.renderSettings=o.renderSettings,c.userData.strings=o.strings,c.userData.objectType="File3dm",c.userData.materials=null,c.name=this.url;let b=o.objects;const tt=o.materials;for(let it=0;it<b.length;it++){const nt=b[it],lt=nt.attributes;switch(nt.objectType){case"InstanceDefinition":_.push(nt);break;case"InstanceReference":v.push(nt);break;default:let ut,ht=null;switch(lt.materialSource.name){case"ObjectMaterialSource_MaterialFromLayer":lt.layerIndex>=0&&(ht=o.layers[lt.layerIndex].renderMaterialIndex);break;case"ObjectMaterialSource_MaterialFromObject":ht=lt.materialIndex>=0?lt.materialIndex:null}if(ht>=0){const bt=tt[ht];ut=this._createMaterial(bt,o.renderEnvironment)}else ut=this._createMaterial();ut=this._compareMaterials(ut);const _t=this._createObject(nt,ut);if(_t===void 0)continue;const ft=o.layers[lt.layerIndex];_t.visible=!ft||ft.visible,lt.isInstanceDefinitionObject?d.push(_t):c.add(_t)}}for(let it=0;it<_.length;it++){const nt=_[it];b=[];for(let lt=0;lt<nt.attributes.objectIds.length;lt++){const ut=nt.attributes.objectIds[lt];for(let ht=0;ht<d.length;ht++)ut===d[ht].userData.attributes.id&&b.push(d[ht])}for(let lt=0;lt<v.length;lt++){const ut=v[lt];if(ut.geometry.parentIdefId===nt.attributes.id){const ht=ut.geometry.xform.array,_t=new three_module.kn4;if(_t.set(...ht),b.length===1){const ft=b[0].clone(!0);if(ft.name=ut.attributes.name||ft.name,ft.applyMatrix4(_t),ut.attributes.materialIndex>=0&&ut.attributes.materialIndex!==b[0].userData.attributes.materialIndex){const bt=tt[ut.attributes.materialIndex],xt=this._createMaterial(bt);ft.material=this._compareMaterials(xt)}if(ft.userData.defAttributes=ft.userData.attributes,ft.userData.defObjectType=ft.userData.objectType,ft.userData.attributes={...ft.userData.attributes,...ut.attributes},ft.userData.objectType=ut.objectType,ut.attributes.layerIndex!==void 0){const bt=o.layers[ut.attributes.layerIndex];ft.visible=bt?bt.visible:ft.visible}c.add(ft)}else{console.warn("THREE.Rhino3dmLoader: InstanceReference with multiple/no objects, not all properties will be copied.");const ft=new three_module.B69;ft.applyMatrix4(_t);for(let bt=0;bt<b.length;bt++)ft.add(b[bt].clone(!0));c.add(ft)}}}}return c.userData.materials=this.materials,c.name="",c}_createObject(o,c){const d=new three_module.SUR,_=o.attributes;let v,b,tt,it;switch(o.objectType){case"Point":case"PointSet":v=d.parse(o.geometry),v.attributes.hasOwnProperty("color")?b=new three_module.BH$({vertexColors:!0,sizeAttenuation:!1,size:2}):(tt=_.drawColor,it=new three_module.Q1f(tt.r/255,tt.g/255,tt.b/255),b=new three_module.BH$({color:it,sizeAttenuation:!1,size:2})),b=this._compareMaterials(b);const nt=new three_module.ONl(v,b);return nt.userData.attributes=_,nt.userData.objectType=o.objectType,_.name&&(nt.name=_.name),nt;case"Mesh":case"Extrusion":case"SubD":case"Brep":if(o.geometry===null)return;v=d.parse(o.geometry),c===null&&(c=this._createMaterial(),c=this._compareMaterials(c)),v.attributes.hasOwnProperty("color")&&(c.vertexColors=!0);const lt=new three_module.eaF(v,c);return lt.castShadow=_.castsShadows,lt.receiveShadow=_.receivesShadows,lt.userData.attributes=_,lt.userData.objectType=o.objectType,_.name&&(lt.name=_.name,v.name=_.name),lt;case"Curve":v=d.parse(o.geometry),tt=_.drawColor,it=new three_module.Q1f(tt.r/255,tt.g/255,tt.b/255),b=new three_module.mrM({color:it}),b=this._compareMaterials(b);const ut=new three_module.N1A(v,b);return ut.userData.attributes=_,ut.userData.objectType=o.objectType,_.name&&(ut.name=_.name),ut;case"TextDot":v=o.geometry;const ht=document.createElement("canvas").getContext("2d"),_t=`${v.fontHeight}px ${v.fontFace}`;ht.font=_t;const ft=ht.measureText(v.text).width+10,bt=v.fontHeight+10,xt=window.devicePixelRatio;ht.canvas.width=ft*xt,ht.canvas.height=bt*xt,ht.canvas.style.width=ft+"px",ht.canvas.style.height=bt+"px",ht.setTransform(xt,0,0,xt,0,0),ht.font=_t,ht.textBaseline="middle",ht.textAlign="center",it=_.drawColor,ht.fillStyle=`rgba(${it.r},${it.g},${it.b},${it.a})`,ht.fillRect(0,0,ft,bt),ht.fillStyle="white",ht.fillText(v.text,ft/2,bt/2);const St=new three_module.GOR(ht.canvas);St.minFilter=three_module.k6q,St.generateMipmaps=!1,St.wrapS=three_module.ghU,St.wrapT=three_module.ghU,b=new three_module.RoJ({map:St,depthTest:!1});const wt=new three_module.kxk(b);return wt.position.set(v.point[0],v.point[1],v.point[2]),wt.scale.set(ft/10,bt/10,1),wt.userData.attributes=_,wt.userData.objectType=o.objectType,_.name&&(wt.name=_.name),wt;case"Light":let Pt;switch(v=o.geometry,v.lightStyle.name){case"LightStyle_WorldPoint":Pt=new three_module.HiM,Pt.castShadow=_.castsShadows,Pt.position.set(v.location[0],v.location[1],v.location[2]),Pt.shadow.normalBias=.1;break;case"LightStyle_WorldSpot":Pt=new three_module.nCl,Pt.castShadow=_.castsShadows,Pt.position.set(v.location[0],v.location[1],v.location[2]),Pt.target.position.set(v.direction[0],v.direction[1],v.direction[2]),Pt.angle=v.spotAngleRadians,Pt.shadow.normalBias=.1;break;case"LightStyle_WorldRectangular":Pt=new three_module.ure;const Rt=Math.abs(v.width[2]),kt=Math.abs(v.length[0]);Pt.position.set(v.location[0]-kt/2,v.location[1],v.location[2]-Rt/2),Pt.height=kt,Pt.width=Rt,Pt.lookAt(v.direction[0],v.direction[1],v.direction[2]);break;case"LightStyle_WorldDirectional":Pt=new three_module.ZyN,Pt.castShadow=_.castsShadows,Pt.position.set(v.location[0],v.location[1],v.location[2]),Pt.target.position.set(v.direction[0],v.direction[1],v.direction[2]),Pt.shadow.normalBias=.1}return Pt&&(Pt.intensity=v.intensity,tt=v.diffuse,it=new three_module.Q1f(tt.r/255,tt.g/255,tt.b/255),Pt.color=it,Pt.userData.attributes=_,Pt.userData.objectType=o.objectType),Pt}}_initLibrary(){if(!this.libraryPending){const o=new three_module.Y9S(this.manager);o.setPath(this.libraryPath);const c=new Promise((v,b)=>{o.load("rhino3dm.js",v,void 0,b)}),d=new three_module.Y9S(this.manager);d.setPath(this.libraryPath),d.setResponseType("arraybuffer");const _=new Promise((v,b)=>{d.load("rhino3dm.wasm",v,void 0,b)});this.libraryPending=Promise.all([c,_]).then(([v,b])=>{this.libraryConfig.wasmBinary=b;const tt=DRACOWorkerStr,it=["/* rhino3dm.js */",v,"/* worker */",tt.substring(tt.indexOf("{")+1,tt.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([it]))})}return this.libraryPending}_getWorker(o){return this._initLibrary().then(()=>{if(this.workerPool.length<this.workerLimit){const d=new Worker(this.workerSourceURL);d._callbacks={},d._taskCosts={},d._taskLoad=0,d.postMessage({type:"init",libraryConfig:this.libraryConfig}),d.onmessage=_=>{const v=_.data;switch(v.type){case"warning":this.warnings.push(v.data),console.warn(v.data);break;case"decode":d._callbacks[v.id].resolve(v);break;case"error":d._callbacks[v.id].reject(v);break;default:console.error('THREE.Rhino3dmLoader: Unexpected message, "'+v.type+'"')}},this.workerPool.push(d)}else this.workerPool.sort(function(d,_){return d._taskLoad>_._taskLoad?-1:1});const c=this.workerPool[this.workerPool.length-1];return c._taskLoad+=o,c})}_releaseTask(o,c){o._taskLoad-=o._taskCosts[c],delete o._callbacks[c],delete o._taskCosts[c]}dispose(){for(let o=0;o<this.workerPool.length;++o)this.workerPool[o].terminate();return this.workerPool.length=0,this}}const DRACOWorkerStr=`
function Rhino3dmWorker() {

	let libraryPending;
	let libraryConfig;
	let rhino;
	let taskID;

	onmessage = function ( e ) {

		const message = e.data;

		switch ( message.type ) {

			case 'init':

				libraryConfig = message.libraryConfig;
				const wasmBinary = libraryConfig.wasmBinary;
				let RhinoModule;
				libraryPending = new Promise( function ( resolve ) {

					/* Like Basis Loader */
					RhinoModule = { wasmBinary, onRuntimeInitialized: resolve };

					rhino3dm( RhinoModule ); // eslint-disable-line no-undef

				 } ).then( () => {

					rhino = RhinoModule;

				 } );

				break;

			case 'decode':

				taskID = message.id;
				const buffer = message.buffer;
				libraryPending.then( () => {

					try {

						const data = decodeObjects( rhino, buffer );
						self.postMessage( { type: 'decode', id: message.id, data } );

					} catch ( error ) {

						self.postMessage( { type: 'error', id: message.id, error } );

					}

				} );

				break;

		}

	};

	function decodeObjects( rhino, buffer ) {

		const arr = new Uint8Array( buffer );
		const doc = rhino.File3dm.fromByteArray( arr );

		const objects = [];
		const materials = [];
		const layers = [];
		const views = [];
		const namedViews = [];
		const groups = [];
		const strings = [];

		//Handle objects

		const objs = doc.objects();
		const cnt = objs.count;

		for ( let i = 0; i < cnt; i ++ ) {

			const _object = objs.get( i );

			const object = extractObjectData( _object, doc );

			_object.delete();

			if ( object ) {

				objects.push( object );

			}

		}

		// Handle instance definitions
		// console.log( \`Instance Definitions Count: \${doc.instanceDefinitions().count()}\` );

		for ( let i = 0; i < doc.instanceDefinitions().count; i ++ ) {

			const idef = doc.instanceDefinitions().get( i );
			const idefAttributes = extractProperties( idef );
			idefAttributes.objectIds = idef.getObjectIds();

			objects.push( { geometry: null, attributes: idefAttributes, objectType: 'InstanceDefinition' } );

		}

		// Handle materials

		const textureTypes = [
			// rhino.TextureType.Bitmap,
			rhino.TextureType.Diffuse,
			rhino.TextureType.Bump,
			rhino.TextureType.Transparency,
			rhino.TextureType.Opacity,
			rhino.TextureType.Emap
		];

		const pbrTextureTypes = [
			rhino.TextureType.PBR_BaseColor,
			rhino.TextureType.PBR_Subsurface,
			rhino.TextureType.PBR_SubsurfaceScattering,
			rhino.TextureType.PBR_SubsurfaceScatteringRadius,
			rhino.TextureType.PBR_Metallic,
			rhino.TextureType.PBR_Specular,
			rhino.TextureType.PBR_SpecularTint,
			rhino.TextureType.PBR_Roughness,
			rhino.TextureType.PBR_Anisotropic,
			rhino.TextureType.PBR_Anisotropic_Rotation,
			rhino.TextureType.PBR_Sheen,
			rhino.TextureType.PBR_SheenTint,
			rhino.TextureType.PBR_Clearcoat,
			rhino.TextureType.PBR_ClearcoatBump,
			rhino.TextureType.PBR_ClearcoatRoughness,
			rhino.TextureType.PBR_OpacityIor,
			rhino.TextureType.PBR_OpacityRoughness,
			rhino.TextureType.PBR_Emission,
			rhino.TextureType.PBR_AmbientOcclusion,
			rhino.TextureType.PBR_Displacement
		];

		for ( let i = 0; i < doc.materials().count; i ++ ) {

			const _material = doc.materials().get( i );

			let material = extractProperties( _material );

			const textures = [];

			textures.push( ...extractTextures( _material, textureTypes, doc ) );

			material.pbrSupported = _material.physicallyBased().supported;

			if ( material.pbrSupported ) {

				textures.push( ...extractTextures( _material, pbrTextureTypes, doc ) );
				material.pbr = extractProperties( _material.physicallyBased() );

			}

			material.textures = textures;

			materials.push( material );

			_material.delete();

		}

		// Handle layers

		for ( let i = 0; i < doc.layers().count; i ++ ) {

			const _layer = doc.layers().get( i );
			const layer = extractProperties( _layer );

			layers.push( layer );

			_layer.delete();

		}

		// Handle views

		for ( let i = 0; i < doc.views().count; i ++ ) {

			const _view = doc.views().get( i );
			const view = extractProperties( _view );

			views.push( view );

			_view.delete();

		}

		// Handle named views

		for ( let i = 0; i < doc.namedViews().count; i ++ ) {

			const _namedView = doc.namedViews().get( i );
			const namedView = extractProperties( _namedView );

			namedViews.push( namedView );

			_namedView.delete();

		}

		// Handle groups

		for ( let i = 0; i < doc.groups().count; i ++ ) {

			const _group = doc.groups().get( i );
			const group = extractProperties( _group );

			groups.push( group );

			_group.delete();

		}

		// Handle settings

		const settings = extractProperties( doc.settings() );

		//TODO: Handle other document stuff like dimstyles, instance definitions, bitmaps etc.

		// Handle dimstyles
		// console.log( \`Dimstyle Count: \${doc.dimstyles().count()}\` );

		// Handle bitmaps
		// console.log( \`Bitmap Count: \${doc.bitmaps().count()}\` );

		// Handle strings
		// console.log( \`Document Strings Count: \${doc.strings().count()}\` );
		// Note: doc.strings().documentUserTextCount() counts any doc.strings defined in a section
		// console.log( \`Document User Text Count: \${doc.strings().documentUserTextCount()}\` );

		const strings_count = doc.strings().count;

		for ( let i = 0; i < strings_count; i ++ ) {

			strings.push( doc.strings().get( i ) );

		}

		// Handle Render Environments for Material Environment

		// get the id of the active render environment skylight, which we'll use for environment texture
		const reflectionId = doc.settings().renderSettings().renderEnvironments.reflectionId;

		const rc = doc.renderContent();

		let renderEnvironment = null;

		for( let i = 0; i < rc.count; i++ ) {

			const content = rc.get(i);

			switch( content.kind ) {

				case 'environment':

					const id = content.id;

					// there could be multiple render environments in a 3dm file
					if ( id !== reflectionId ) break;

					const renderTexture = content.findChild( 'texture' );
					const fileName = renderTexture.fileName;

					for ( let j = 0; j < doc.embeddedFiles().count; j ++ ) {

						const _fileName = doc.embeddedFiles().get( j ).fileName;

						if ( fileName === _fileName ) {

							const background = doc.getEmbeddedFileAsBase64( fileName );
							const backgroundImage = 'data:image/png;base64,' + background;
							renderEnvironment = { type: 'renderEnvironment', image: backgroundImage, name: fileName };

						}

					}

					break;

			}

		}

		// Handle Render Settings

		const renderSettings = {
			ambientLight: doc.settings().renderSettings().ambientLight,
			backgroundColorTop: doc.settings().renderSettings().backgroundColorTop,
			backgroundColorBottom: doc.settings().renderSettings().backgroundColorBottom,
			useHiddenLights: doc.settings().renderSettings().useHiddenLights,
			depthCue: doc.settings().renderSettings().depthCue,
			flatShade: doc.settings().renderSettings().flatShade,
			renderBackFaces: doc.settings().renderSettings().renderBackFaces,
			renderPoints: doc.settings().renderSettings().renderPoints,
			renderCurves: doc.settings().renderSettings().renderCurves,
			renderIsoParams: doc.settings().renderSettings().renderIsoParams,
			renderMeshEdges: doc.settings().renderSettings().renderMeshEdges,
			renderAnnotations: doc.settings().renderSettings().renderAnnotations,
			useViewportSize: doc.settings().renderSettings().useViewportSize,
			scaleBackgroundToFit: doc.settings().renderSettings().scaleBackgroundToFit,
			transparentBackground: doc.settings().renderSettings().transparentBackground,
			imageDpi: doc.settings().renderSettings().imageDpi,
			shadowMapLevel: doc.settings().renderSettings().shadowMapLevel,
			namedView: doc.settings().renderSettings().namedView,
			snapShot: doc.settings().renderSettings().snapShot,
			specificViewport: doc.settings().renderSettings().specificViewport,
			groundPlane: extractProperties( doc.settings().renderSettings().groundPlane ),
			safeFrame: extractProperties( doc.settings().renderSettings().safeFrame ),
			dithering: extractProperties( doc.settings().renderSettings().dithering ),
			skylight: extractProperties( doc.settings().renderSettings().skylight ),
			linearWorkflow: extractProperties( doc.settings().renderSettings().linearWorkflow ),
			renderChannels: extractProperties( doc.settings().renderSettings().renderChannels ),
			sun: extractProperties( doc.settings().renderSettings().sun ),
			renderEnvironments: extractProperties( doc.settings().renderSettings().renderEnvironments ),
			postEffects: extractProperties( doc.settings().renderSettings().postEffects ),

		};

		doc.delete();

		return { objects, materials, layers, views, namedViews, groups, strings, settings, renderSettings, renderEnvironment };

	}

	function extractTextures( m, tTypes, d ) {

		const textures = [];

		for ( let i = 0; i < tTypes.length; i ++ ) {

			const _texture = m.getTexture( tTypes[ i ] );
			if ( _texture ) {

				let textureType = tTypes[ i ].constructor.name;
				textureType = textureType.substring( 12, textureType.length );
				const texture = extractTextureData( _texture, textureType, d );
				textures.push( texture );
				_texture.delete();

			}

		}

		return textures;

	}

	function extractTextureData( t, tType, d ) {

		const texture = { type: tType };

		const image = d.getEmbeddedFileAsBase64( t.fileName );

		texture.wrapU = t.wrapU;
		texture.wrapV = t.wrapV;
		texture.wrapW = t.wrapW;
		const uvw = t.uvwTransform.toFloatArray( true );

		texture.repeat = [ uvw[ 0 ], uvw[ 5 ] ];

		if ( image ) {

			texture.image = 'data:image/png;base64,' + image;

		} else {

			self.postMessage( { type: 'warning', id: taskID, data: {
				message: \`THREE.3DMLoader: Image for \${tType} texture not embedded in file.\`,
				type: 'missing resource'
			}

			} );

			texture.image = null;

		}

		return texture;

	}

	function extractObjectData( object, doc ) {

		const _geometry = object.geometry();
		const _attributes = object.attributes();
		let objectType = _geometry.objectType;
		let geometry, attributes, position, data, mesh;

		// skip instance definition objects
		//if( _attributes.isInstanceDefinitionObject ) { continue; }

		// TODO: handle other geometry types
		switch ( objectType ) {

			case rhino.ObjectType.Curve:

				const pts = curveToPoints( _geometry, 100 );

				position = {};
				attributes = {};
				data = {};

				position.itemSize = 3;
				position.type = 'Float32Array';
				position.array = [];

				for ( let j = 0; j < pts.length; j ++ ) {

					position.array.push( pts[ j ][ 0 ] );
					position.array.push( pts[ j ][ 1 ] );
					position.array.push( pts[ j ][ 2 ] );

				}

				attributes.position = position;
				data.attributes = attributes;

				geometry = { data };

				break;

			case rhino.ObjectType.Point:

				const pt = _geometry.location;

				position = {};
				const color = {};
				attributes = {};
				data = {};

				position.itemSize = 3;
				position.type = 'Float32Array';
				position.array = [ pt[ 0 ], pt[ 1 ], pt[ 2 ] ];

				const _color = _attributes.drawColor( doc );

				color.itemSize = 3;
				color.type = 'Float32Array';
				color.array = [ _color.r / 255.0, _color.g / 255.0, _color.b / 255.0 ];

				attributes.position = position;
				attributes.color = color;
				data.attributes = attributes;

				geometry = { data };

				break;

			case rhino.ObjectType.PointSet:
			case rhino.ObjectType.Mesh:

				geometry = _geometry.toThreejsJSON();

				break;

			case rhino.ObjectType.Brep:

				const faces = _geometry.faces();
				mesh = new rhino.Mesh();

				for ( let faceIndex = 0; faceIndex < faces.count; faceIndex ++ ) {

					const face = faces.get( faceIndex );
					const _mesh = face.getMesh( rhino.MeshType.Any );

					if ( _mesh ) {

						mesh.append( _mesh );
						_mesh.delete();

					}

					face.delete();

				}

				if ( mesh.faces().count > 0 ) {

					mesh.compact();
					geometry = mesh.toThreejsJSON();
					faces.delete();

				}

				mesh.delete();

				break;

			case rhino.ObjectType.Extrusion:

				mesh = _geometry.getMesh( rhino.MeshType.Any );

				if ( mesh ) {

					geometry = mesh.toThreejsJSON();
					mesh.delete();

				}

				break;

			case rhino.ObjectType.TextDot:

				geometry = extractProperties( _geometry );

				break;

			case rhino.ObjectType.Light:

				geometry = extractProperties( _geometry );

				if ( geometry.lightStyle.name === 'LightStyle_WorldLinear' ) {

					self.postMessage( { type: 'warning', id: taskID, data: {
						message: \`THREE.3DMLoader: No conversion exists for \${objectType.constructor.name} \${geometry.lightStyle.name}\`,
						type: 'no conversion',
						guid: _attributes.id
					}

					} );

				}

				break;

			case rhino.ObjectType.InstanceReference:

				geometry = extractProperties( _geometry );
				geometry.xform = extractProperties( _geometry.xform );
				geometry.xform.array = _geometry.xform.toFloatArray( true );

				break;

			case rhino.ObjectType.SubD:

				// TODO: precalculate resulting vertices and faces and warn on excessive results
				_geometry.subdivide( 3 );
				mesh = rhino.Mesh.createFromSubDControlNet( _geometry, false );
				if ( mesh ) {

					geometry = mesh.toThreejsJSON();
					mesh.delete();

				}

				break;

				/*
				case rhino.ObjectType.Annotation:
				case rhino.ObjectType.Hatch:
				case rhino.ObjectType.ClipPlane:
				*/

			default:

				self.postMessage( { type: 'warning', id: taskID, data: {
					message: \`THREE.3DMLoader: Conversion not implemented for \${objectType.constructor.name}\`,
					type: 'not implemented',
					guid: _attributes.id
				}

				} );

				break;

		}

		if ( geometry ) {

			attributes = extractProperties( _attributes );
			attributes.geometry = extractProperties( _geometry );

			if ( _attributes.groupCount > 0 ) {

				attributes.groupIds = _attributes.getGroupList();

			}

			if ( _attributes.userStringCount > 0 ) {

				attributes.userStrings = _attributes.getUserStrings();

			}

			if ( _geometry.userStringCount > 0 ) {

				attributes.geometry.userStrings = _geometry.getUserStrings();

			}

			if ( _attributes.decals().count > 0 ) {

				self.postMessage( { type: 'warning', id: taskID, data: {
					message: \`THREE.3DMLoader: No conversion exists for the decals associated with this object.\`,
					type: 'no conversion',
					guid: _attributes.id
				}

				} );

			}

			attributes.drawColor = _attributes.drawColor( doc );

			objectType = objectType.constructor.name;
			objectType = objectType.substring( 11, objectType.length );

			return { geometry, attributes, objectType };

		} else {

			self.postMessage( { type: 'warning', id: taskID, data: {
				message: \`THREE.3DMLoader: \${objectType.constructor.name} has no associated mesh geometry.\`,
				type: 'missing mesh',
				guid: _attributes.id
			}

			} );

		}

	}

	function extractProperties( object ) {

		const result = {};

		for ( const property in object ) {

			const value = object[ property ];

			if ( typeof value !== 'function' ) {

				if ( typeof value === 'object' && value !== null && value.hasOwnProperty( 'constructor' ) ) {

					result[ property ] = { name: value.constructor.name, value: value.value };

				} else if ( typeof value === 'object' && value !== null ) {

					result[ property ] = extractProperties( value );

				} else {

					result[ property ] = value;

				}

			} else {

				// these are functions that could be called to extract more data.
				//console.log( \`\${property}: \${object[ property ].constructor.name}\` );

			}

		}

		return result;

	}

	function curveToPoints( curve, pointLimit ) {

		let pointCount = pointLimit;
		let rc = [];
		const ts = [];

		if ( curve instanceof rhino.LineCurve ) {

			return [ curve.pointAtStart, curve.pointAtEnd ];

		}

		if ( curve instanceof rhino.PolylineCurve ) {

			pointCount = curve.pointCount;
			for ( let i = 0; i < pointCount; i ++ ) {

				rc.push( curve.point( i ) );

			}

			return rc;

		}

		if ( curve instanceof rhino.PolyCurve ) {

			const segmentCount = curve.segmentCount;

			for ( let i = 0; i < segmentCount; i ++ ) {

				const segment = curve.segmentCurve( i );
				const segmentArray = curveToPoints( segment, pointCount );
				rc = rc.concat( segmentArray );
				segment.delete();

			}

			return rc;

		}

		if ( curve instanceof rhino.ArcCurve ) {

			pointCount = Math.floor( curve.angleDegrees / 5 );
			pointCount = pointCount < 2 ? 2 : pointCount;
			// alternative to this hardcoded version: https://stackoverflow.com/a/18499923/2179399

		}

		if ( curve instanceof rhino.NurbsCurve && curve.degree === 1 ) {

			const pLine = curve.tryGetPolyline();

			for ( let i = 0; i < pLine.count; i ++ ) {

				rc.push( pLine.get( i ) );

			}

			pLine.delete();

			return rc;

		}

		const domain = curve.domain;
		const divisions = pointCount - 1.0;

		for ( let j = 0; j < pointCount; j ++ ) {

			const t = domain[ 0 ] + ( j / divisions ) * ( domain[ 1 ] - domain[ 0 ] );

			if ( t === domain[ 0 ] || t === domain[ 1 ] ) {

				ts.push( t );
				continue;

			}

			const tan = curve.tangentAt( t );
			const prevTan = curve.tangentAt( ts.slice( - 1 )[ 0 ] );

			// Duplicated from THREE.Vector3
			// How to pass imports to worker?

			const tS = tan[ 0 ] * tan[ 0 ] + tan[ 1 ] * tan[ 1 ] + tan[ 2 ] * tan[ 2 ];
			const ptS = prevTan[ 0 ] * prevTan[ 0 ] + prevTan[ 1 ] * prevTan[ 1 ] + prevTan[ 2 ] * prevTan[ 2 ];

			const denominator = Math.sqrt( tS * ptS );

			let angle;

			if ( denominator === 0 ) {

				angle = Math.PI / 2;

			} else {

				const theta = ( tan.x * prevTan.x + tan.y * prevTan.y + tan.z * prevTan.z ) / denominator;
				angle = Math.acos( Math.max( - 1, Math.min( 1, theta ) ) );

			}

			if ( angle < 0.1 ) continue;

			ts.push( t );

		}

		rc = ts.map( t => curve.pointAt( t ) );
		return rc;

	}

}
`;var rhino3dm_decorate=function(h,o,c,d){var _,v=arguments.length,b=v<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(h,o,c,d);else for(var tt=h.length-1;tt>=0;tt--)(_=h[tt])&&(b=(v<3?_(b):v>3?_(o,c,b):_(o,c))||b);return v>3&&b&&Object.defineProperty(o,c,b),b};class Rhino3dmLoader2 extends Rhino3dmLoader{constructor(o){super(o),this.materials=[],this.setLibraryPath(Rhino3dmLoader2.LIBRARY_PATH)}_createMaterial(o){return Rhino3dmLoader2.ImportMaterials?super._createMaterial(o):this.materials[0]||new three_module._4j({color:new three_module.Q1f(1,1,1),metalness:.8,name:three_module.aHM.DEFAULT_MATERIAL_NAME,side:three_module.$EB})}async loadAsync(o,c){const d=await super.loadAsync(o,c);d.rotateX(-Math.PI/2),d.userData.materials&&delete d.userData.materials;const _=d.userData.layers;return d.traverse(v=>{var b,tt,it,nt,lt;const ut=(b=v.userData.attributes)===null||b===void 0?void 0:b.castsShadows,ht=(tt=v.userData.attributes)===null||tt===void 0?void 0:tt.receivesShadows;v.castShadow=ut,v.receiveShadow=ht;const _t=(nt=(it=v.userData.attributes)===null||it===void 0?void 0:it.layerIndex)!==null&&nt!==void 0?nt:(lt=v.userData.defAttributes)===null||lt===void 0?void 0:lt.layerIndex,ft=_[_t];ft&&(v.userData.rhinoLayer=ft),v.userData.rhino3dmRoot=d.uuid,Rhino3dmLoader2.LoadUserDataStrings||(v.userData.strings=[]),Rhino3dmLoader2.LoadUserDataWarnings||delete v.userData.warnings,this._hideLineMesh(v),this._useInstancedMesh(v),this._useMaterialSource(v,ft)}),this.materials=[],d}_useMaterialSource(o,c){var d,_,v,b,tt;if(!Rhino3dmLoader2.ImportMaterials)return;const it=o;if(((d=it.material)===null||d===void 0?void 0:d.name)==="default"||Rhino3dmLoader2.ForceLayerMaterials){const nt=((_=it.userData.attributes)===null||_===void 0?void 0:_.materialSource)||((v=it.userData.defAttributes)===null||v===void 0?void 0:v.materialSource),lt=((b=it.userData.attributes)===null||b===void 0?void 0:b.colorSource)||((tt=it.userData.defAttributes)===null||tt===void 0?void 0:tt.colorSource);if(!Rhino3dmLoader2.ForceLayerMaterials&&!nt&&!lt)return;Rhino3dmLoader2.ForceLayerMaterials||(nt==null?void 0:nt.value)===0||(nt==null?void 0:nt.value)===1&&(lt==null?void 0:lt.value)===0?c&&(it.material=this._compareMaterials(this._createMaterial({diffuseColor:c.color,name:c.name,emissionColor:{r:0,g:0,b:0},disableLighting:!1,indexOfRefraction:1.5,reflectivity:1,transparency:0,specularColor:{r:0,g:0,b:0},textures:[]}))):(nt==null?void 0:nt.value)===3||(nt==null?void 0:nt.value)===1&&(lt==null?void 0:lt.value)===3?it.traverseAncestors(ut=>{ut!=null&&ut.material&&(it.material=ut.material)}):nt&&nt.value!==1&&console.warn("Unknown material source",nt,it,it.userData.attributes)}}_useInstancedMesh(o){if(!Rhino3dmLoader2.ReplaceWithInstancedMesh||o.children.length<=0)return;const c=o.children,d=c.map(_=>_.geometry);d.filter((_,v)=>d.indexOf(_)===v).forEach(_=>{var v;const b=c.filter(it=>it.geometry===_),tt=b.length>0?b.filter(it=>it.material===b[0].material):[];if(tt.length>1){const it=new three_module.ZLX(_,tt[0].material,tt.length);it.userData={...tt[0].userData},it.userData.instanceUserData=[],it.userData.attributes=it.userData.defAttributes||it.userData.attributes,it.userData.defAttributes&&delete it.userData.defAttributes,it.name=((v=it.userData.attributes)===null||v===void 0?void 0:v.name)||tt[0].name,tt.forEach((nt,lt)=>{it.setMatrixAt(lt,nt.matrix),o.remove(nt),it.userData.instanceUserData.push(nt.userData)}),o.add(it)}})}_hideLineMesh(o){if(!Rhino3dmLoader2.HideLineMesh&&!Rhino3dmLoader2.HidePointMesh||o.children.length<=0)return;const c=[];o.traverse(d=>{(d&&Rhino3dmLoader2.HideLineMesh&&(d.isLine||d.isLineSegments)||Rhino3dmLoader2.HidePointMesh&&d.isPoints)&&c.push(d)}),c.forEach(d=>{d.userData.visible_3dm=d.visible,d.visible=!1})}}Rhino3dmLoader2.LIBRARY_PATH="https://cdn.jsdelivr.net/npm/rhino3dm@8.9.0/",Rhino3dmLoader2.ImportMaterials=!0,Rhino3dmLoader2.ForceLayerMaterials=!1,Rhino3dmLoader2.ReplaceWithInstancedMesh=!1,Rhino3dmLoader2.HideLineMesh=!1,Rhino3dmLoader2.HidePointMesh=!1,Rhino3dmLoader2.LoadUserDataStrings=!0,Rhino3dmLoader2.LoadUserDataWarnings=!0;let Rhino3dmLoadPlugin=class extends I$2{constructor(){super(...arguments),this.dependencies=[AssetManagerPlugin],this._importer=new Importer(Rhino3dmLoader2,["3dm"],!0),this.importMaterials=!0,this.forceLayerMaterials=!1,this.replaceWithInstancedMesh=!1,this.hideLineMesh=!1,this.hidePointMesh=!0,this.loadUserDataStrings=!0}_refresh(){Rhino3dmLoader2.ImportMaterials=this.importMaterials,Rhino3dmLoader2.ForceLayerMaterials=this.forceLayerMaterials,Rhino3dmLoader2.ReplaceWithInstancedMesh=this.replaceWithInstancedMesh,Rhino3dmLoader2.HideLineMesh=this.hideLineMesh,Rhino3dmLoader2.HidePointMesh=this.hidePointMesh,Rhino3dmLoader2.LoadUserDataStrings=this.loadUserDataStrings,Rhino3dmLoader2.LoadUserDataWarnings=!1}async onAdded(h){var o,c;(c=(o=h.getManager())===null||o===void 0?void 0:o.importer)===null||c===void 0||c.Importers.push(this._importer),this._refresh()}async onDispose(h){}async onRemove(h){var o,c;!((c=(o=h.getManager())===null||o===void 0?void 0:o.importer)===null||c===void 0)&&c.Importers&&h.getManager().importer.Importers.splice(h.getManager().importer.Importers.indexOf(this._importer),1)}};Rhino3dmLoadPlugin.PluginType="Rhino3dmLoadPlugin",rhino3dm_decorate([x$1(Rhino3dmLoadPlugin.prototype._refresh),uiToggle()],Rhino3dmLoadPlugin.prototype,"importMaterials",void 0),rhino3dm_decorate([x$1(Rhino3dmLoadPlugin.prototype._refresh),uiToggle()],Rhino3dmLoadPlugin.prototype,"forceLayerMaterials",void 0),rhino3dm_decorate([x$1(Rhino3dmLoadPlugin.prototype._refresh),uiToggle()],Rhino3dmLoadPlugin.prototype,"replaceWithInstancedMesh",void 0),rhino3dm_decorate([x$1(Rhino3dmLoadPlugin.prototype._refresh),uiToggle()],Rhino3dmLoadPlugin.prototype,"hideLineMesh",void 0),rhino3dm_decorate([x$1(Rhino3dmLoadPlugin.prototype._refresh),uiToggle()],Rhino3dmLoadPlugin.prototype,"hidePointMesh",void 0),rhino3dm_decorate([x$1(Rhino3dmLoadPlugin.prototype._refresh),uiToggle()],Rhino3dmLoadPlugin.prototype,"loadUserDataStrings",void 0),Rhino3dmLoadPlugin=rhino3dm_decorate([uiFolder("Rhino 3dm loader")],Rhino3dmLoadPlugin);class STLLoader extends three_module.aHM{constructor(o){super(o)}load(o,c,d,_){const v=this,b=new three_module.Y9S(this.manager);b.setPath(this.path),b.setResponseType("arraybuffer"),b.setRequestHeader(this.requestHeader),b.setWithCredentials(this.withCredentials),b.load(o,function(tt){try{c(v.parse(tt))}catch(it){_?_(it):console.error(it),v.manager.itemError(o)}},d,_)}parse(o){function c(v,b,tt){for(let it=0,nt=v.length;it<nt;it++)if(v[it]!==b.getUint8(tt+it))return!1;return!0}const d=function(v){if(typeof v=="string"){const b=new Uint8Array(v.length);for(let tt=0;tt<v.length;tt++)b[tt]=255&v.charCodeAt(tt);return b.buffer||b}return v}(o);return function(v){const b=new DataView(v);if(84+50*b.getUint32(80,!0)===b.byteLength)return!0;const tt=[115,111,108,105,100];for(let it=0;it<5;it++)if(c(tt,b,it))return!1;return!0}(d)?function(v){const b=new DataView(v),tt=b.getUint32(80,!0);let it,nt,lt,ut,ht,_t,ft,bt,xt=!1;for(let kt=0;kt<70;kt++)b.getUint32(kt,!1)==1129270351&&b.getUint8(kt+4)==82&&b.getUint8(kt+5)==61&&(xt=!0,ut=new Float32Array(3*tt*3),ht=b.getUint8(kt+6)/255,_t=b.getUint8(kt+7)/255,ft=b.getUint8(kt+8)/255,bt=b.getUint8(kt+9)/255);const St=new three_module.LoY,wt=new Float32Array(3*tt*3),Pt=new Float32Array(3*tt*3),Rt=new three_module.Q1f;for(let kt=0;kt<tt;kt++){const Gt=84+50*kt,Dt=b.getFloat32(Gt,!0),It=b.getFloat32(Gt+4,!0),Nt=b.getFloat32(Gt+8,!0);if(xt){const Vt=b.getUint16(Gt+48,!0);32768&Vt?(it=ht,nt=_t,lt=ft):(it=(31&Vt)/31,nt=(Vt>>5&31)/31,lt=(Vt>>10&31)/31)}for(let Vt=1;Vt<=3;Vt++){const Kt=Gt+12*Vt,Yt=3*kt*3+3*(Vt-1);wt[Yt]=b.getFloat32(Kt,!0),wt[Yt+1]=b.getFloat32(Kt+4,!0),wt[Yt+2]=b.getFloat32(Kt+8,!0),Pt[Yt]=Dt,Pt[Yt+1]=It,Pt[Yt+2]=Nt,xt&&(Rt.set(it,nt,lt).convertSRGBToLinear(),ut[Yt]=Rt.r,ut[Yt+1]=Rt.g,ut[Yt+2]=Rt.b)}}return St.setAttribute("position",new three_module.THS(wt,3)),St.setAttribute("normal",new three_module.THS(Pt,3)),xt&&(St.setAttribute("color",new three_module.THS(ut,3)),St.hasColors=!0,St.alpha=bt),St}(d):function(v){const b=new three_module.LoY,tt=/solid([\s\S]*?)endsolid/g,it=/facet([\s\S]*?)endfacet/g,nt=/solid\s(.+)/;let lt=0;const ut=/[\s]+([+-]?(?:\d*)(?:\.\d*)?(?:[eE][+-]?\d+)?)/.source,ht=new RegExp("vertex"+ut+ut+ut,"g"),_t=new RegExp("normal"+ut+ut+ut,"g"),ft=[],bt=[],xt=[],St=new three_module.Pq0;let wt,Pt=0,Rt=0,kt=0;for(;(wt=tt.exec(v))!==null;){Rt=kt;const Gt=wt[0],Dt=(wt=nt.exec(Gt))!==null?wt[1]:"";for(xt.push(Dt);(wt=it.exec(Gt))!==null;){let Vt=0,Kt=0;const Yt=wt[0];for(;(wt=_t.exec(Yt))!==null;)St.x=parseFloat(wt[1]),St.y=parseFloat(wt[2]),St.z=parseFloat(wt[3]),Kt++;for(;(wt=ht.exec(Yt))!==null;)ft.push(parseFloat(wt[1]),parseFloat(wt[2]),parseFloat(wt[3])),bt.push(St.x,St.y,St.z),Vt++,kt++;Kt!==1&&console.error("THREE.STLLoader: Something isn't right with the normal of face number "+lt),Vt!==3&&console.error("THREE.STLLoader: Something isn't right with the vertices of face number "+lt),lt++}const It=Rt,Nt=kt-Rt;b.userData.groupNames=xt,b.addGroup(It,Nt,Pt),Pt++}return b.setAttribute("position",new three_module.qtW(ft,3)),b.setAttribute("normal",new three_module.qtW(bt,3)),b}(typeof(_=o)!="string"?new TextDecoder().decode(_):_);var _}}class STLLoadPlugin extends I$2{constructor(){super(...arguments),this.dependencies=[AssetManagerPlugin]}async onAdded(o){var c,d;this._importer||(this._importer=new Importer(STLLoader,["stl"],!0)),(d=(c=o.getManager())===null||c===void 0?void 0:c.importer)===null||d===void 0||d.Importers.push(this._importer)}async onDispose(o){this._importer=void 0}async onRemove(o){var c,d;this._importer&&!((d=(c=o.getManager())===null||c===void 0?void 0:c.importer)===null||d===void 0)&&d.Importers&&o.getManager().importer.Importers.splice(o.getManager().importer.Importers.indexOf(this._importer),1),this._importer=void 0}}STLLoadPlugin.PluginType="STLLoadPlugin";class GLTFMeshOptPlugin extends I$2{constructor(){super(...arguments),this.dependencies=[AssetManagerPlugin]}async onAdded(o){const c=document.createElement("script");c.type="module",c.innerHTML=`
import { MeshoptDecoder } from '${GLTFMeshOptPlugin.DECODER_URL}';
window.MeshoptDecoder = MeshoptDecoder
`,document.head.appendChild(c),this._script=c}async onDispose(o){}async onRemove(o){this._script&&(document.head.removeChild(this._script),this._script=void 0)}}GLTFMeshOptPlugin.PluginType="GLTFMeshOptPlugin",GLTFMeshOptPlugin.DECODER_URL="https://unpkg.com/meshoptimizer@0.20.0/meshopt_decoder.module.js";var SnowFallPlugin_decorate=function(h,o,c,d){var _,v=arguments.length,b=v<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(h,o,c,d);else for(var tt=h.length-1;tt>=0;tt--)(_=h[tt])&&(b=(v<3?_(b):v>3?_(o,c,b):_(o,c))||b);return v>3&&b&&Object.defineProperty(o,c,b),b},SnowFallPlugin_1;let SnowFallPlugin=SnowFallPlugin_1=class extends AViewerPlugin{constructor(){super(),this.enabled=!1,this.maxRange=maxRange,this.particleSize=.35,this.particleSpeed=.35,this.minRangeY=1,this.paused=!1,this._needsReset=!0,this._preFrame=()=>{var v,b;if(!this._viewer||!this.enabled)return;const tt=this.maxRange,it=tt/2;if(this._viewer.scene.fog){const ht=this._viewer.scene.activeCamera;this._viewer.scene.fog.near=Math.max(0,ht.near-2),this._viewer.scene.fog.far=ht.far}if(this._viewer.scene.backgroundColor&&((v=this._viewer.scene.fog)===null||v===void 0||v.color.set(this._viewer.scene.backgroundColor)),this.paused)return;const nt=this.particles;nt.material.size=this.particleSize;const lt=nt.geometry.getAttribute("position"),ut=nt.geometry.velocities;if(this._needsReset){for(let ht=0;ht<particleNum;ht++){const _t=Math.random()*tt-it,ft=Math.random()*tt-it,bt=Math.random()*tt-it;lt.setXYZ(ht,_t,ft,bt);const xt=.005*(6*Math.random()-3),St=-.002*(10*Math.random()+3),wt=.005*(6*Math.random()-3);ut[ht].set(xt,St,wt).multiplyScalar(this.particleSpeed)}this._needsReset=!1}for(let ht=0;ht<lt.count;ht++){const _t=ut[ht];if(!_t)return;const ft=g(),bt=.001*Math.sin(.001*ft*_t.x),xt=.001*Math.cos(.0015*ft*_t.z);let St=lt.getX(ht)+bt,wt=lt.getY(ht)+_t.y,Pt=lt.getZ(ht)+xt;St<-it?St=it:St>it&&(St=-it),wt<Math.max(-it,-this.minRangeY)&&(wt=it),Pt<-it?Pt=it:Pt>it&&(Pt=-it),lt.setX(ht,St),lt.setY(ht,wt),lt.setZ(ht,Pt)}lt.needsUpdate=!0,(b=this._viewer)===null||b===void 0||b.setDirty()};const h=new three_module.LoY,o=[];for(let v=0;v<particleNum;v++){const b=Math.random()*maxRange-minRange,tt=Math.random()*maxRange-minRange,it=Math.random()*maxRange-minRange;o.push(b,tt,it)}h.setAttribute("position",new three_module.qtW(o,3));const c=new three_module.BH$({size:.75,color:16777215,vertexColors:!1,map:getTexture(),transparent:!0,fog:!0,depthWrite:!1});c.userData.renderToDepth=!1;const d=[];for(let v=0;v<particleNum;v++){const b=.005*(6*Math.random()-3),tt=-.002*(10*Math.random()+3),it=.005*(6*Math.random()-3),nt=new three_module.Pq0(b,tt,it);d.push(nt)}const _=new three_module.ONl(h,c);_.userData.bboxVisible=!1,_.geometry.velocities=d,this.particles=_}async onAdded(h){await super.onAdded(h),h.addEventListener("preFrame",this._preFrame),this.enabled&&await this.onEnable()}async onEnable(){var h,o;const c=this._viewer;if(!c)return;const d=c.getPlugin(FrameFadePlugin);if(!this.enabled)return this.particles.visible=!1,this.particles.geometry.dispose(),this.particles.material.dispose(),void(d&&d.enable(SnowFallPlugin_1.PluginType));c.scene.fog=new three_module.jUj((h=c.scene.backgroundColor)!==null&&h!==void 0?h:54,0,maxRange);const _=(o=c.scene.getObjectByName("SnowFallPlugin_root"))!==null&&o!==void 0?o:(await c.createObject3D(void 0,!0)).modelObject;_.name="SnowFallPlugin_root",_.clear(),d&&d.disable(SnowFallPlugin_1.PluginType),_.add(this.particles),this.particles.visible=!0,this._needsReset=!0}async onRemove(h){return h.removeEventListener("preFrame",this._preFrame),this.particles.removeFromParent(),super.onRemove(h)}reset(){this._needsReset=!0}};SnowFallPlugin.PluginType="SnowFallPlugin",SnowFallPlugin_decorate([uiToggle(),serialize(),x$1(SnowFallPlugin.prototype.onEnable)],SnowFallPlugin.prototype,"enabled",void 0),SnowFallPlugin_decorate([uiSlider("Bounds size",[1,50]),x$1(SnowFallPlugin.prototype.reset),serialize()],SnowFallPlugin.prototype,"maxRange",void 0),SnowFallPlugin_decorate([uiSlider("Particle size",[.01,2]),serialize()],SnowFallPlugin.prototype,"particleSize",void 0),SnowFallPlugin_decorate([uiSlider("Particle speed",[0,2]),x$1(SnowFallPlugin.prototype.reset),serialize()],SnowFallPlugin.prototype,"particleSpeed",void 0),SnowFallPlugin_decorate([uiSlider("Bottom clamp",[0,30]),serialize()],SnowFallPlugin.prototype,"minRangeY",void 0),SnowFallPlugin_decorate([uiToggle("Paused"),serialize()],SnowFallPlugin.prototype,"paused",void 0),SnowFallPlugin=SnowFallPlugin_1=SnowFallPlugin_decorate([uiFolder("Snow Fall Particles")],SnowFallPlugin);const particleNum=4e3,maxRange=17,minRange=maxRange/2,textureSize=64,drawRadialGradation=(h,o,c,d)=>{h.save();const _=h.createRadialGradient(o,o,0,o,o,o);_.addColorStop(0,"rgba(255,255,255,1.0)"),_.addColorStop(.5,"rgba(255,255,255,0.5)"),_.addColorStop(1,"rgba(255,255,255,0)"),h.fillStyle=_,h.fillRect(0,0,c,d),h.restore()},getTexture=()=>{const h=document.createElement("canvas"),o=h.getContext("2d");if(!o)throw new Error("no context");const c=textureSize;h.width=c,h.height=c,drawRadialGradation(o,c/2,h.width,h.height);const d=new three_module.gPd(h);return d.type=three_module.RQf,d.colorSpace="srgb-linear",d.needsUpdate=!0,d};class SnowFlakes extends three_module.B69{constructor(){super(),this.snowList=[],this.angle=0;const o=new three_module.LoY,c=[],d=new three_module.Tap,_=d.load("https://dl.dropbox.com/s/13ec3ht27adnu1l/snowflake1.png?dl=0"),v=d.load("https://dl.dropbox.com/s/rczse8o8zt5mxe6/snowflake2.png?dl=0"),b=d.load("https://dl.dropbox.com/s/cs17pph4bu096k7/snowflake3.png?dl=0"),tt=d.load("https://dl.dropbox.com/s/plwtcfvokuoz931/snowflake4.png?dl=0"),it=d.load("https://dl.dropbox.com/s/uhh77omqdwqo2z5/snowflake5.png?dl=0"),nt=[];for(let ut=0;ut<10;ut++){const ht=getRandom(0,500),_t=getRandom(0,500),ft=getRandom(0,500);nt.push(ht,_t,ft)}o.setAttribute("position",new three_module.qtW(nt,3));const lt=[["#FFFFFF",v,getRandom(10,10)],["#FFFFFF",b,getRandom(10,15)],["#FFFFFF",_,getRandom(10,15)],["#FFFFFF",it,getRandom(5,10)],["#FFFFFF",tt,getRandom(5,10)]];for(let ut=0;ut<lt.length;ut++){const ht=lt[ut][1],_t=lt[ut][2];c[ut]=new three_module.BH$({size:_t,map:ht,blending:three_module.EZo,depthTest:!1,transparent:!0});const ft=new three_module.ONl(o,c[ut]);ft.rotation.x=360*Math.random(),ft.rotation.y=360*Math.random(),ft.rotation.z=360*Math.random(),ft.vx=0,ft.vy=0,ft.material.opacity=0,this.add(ft),this.snowList.push(ft)}}update(){this.angle+=.001;for(let o=0;o<this.snowList.length;o++)this.snowList[o].material.opacity+=.01,this.snowList[o].vy-=1,this.snowList[o].vx=Math.sin(this.angle)*Math.cos(this.angle)*10,this.snowList[o].vx*=.2,this.snowList[o].vy*=.6,this.snowList[o].position.x+=this.snowList[o].vx,this.snowList[o].position.y+=this.snowList[o].vy,this.snowList[o].position.y<-1e3&&(this.snowList[o].material.opacity+=.1,this.remove(this.snowList[o]),this.snowList.splice(o,1),o-=1);return this.snowList.length}}function getRandom(h,o){return Math.random()*(o-h)+h}var ModelStagePlugin_decorate=function(h,o,c,d){var _,v=arguments.length,b=v<3?o:d===null?d=Object.getOwnPropertyDescriptor(o,c):d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(h,o,c,d);else for(var tt=h.length-1;tt>=0;tt--)(_=h[tt])&&(b=(v<3?_(b):v>3?_(o,c,b):_(o,c))||b);return v>3&&b&&Object.defineProperty(o,c,b),b};let ModelStagePlugin=class extends AViewerPlugin{constructor(){super(...arguments),this.enabled=!0,this.model="",this.dependencies=[AssetManagerPlugin],this._sceneUpdate=h=>{h.hierarchyChanged&&this.refreshTransform()},this._lastPhysicalGroundProps=void 0,this._animationStep=h=>{},this._animationStep2=h=>{this._animationStep(h)},this.groundBelowModel=!1}async promptLoadModel(){if(!this._viewer)return void console.warn("ModelStagePlugin: No viewer");const h=await ge$1(!1,!1);if(!h.length)return;const o=h[0];await this.setModel(o)}async promptLoadModelUrl(){if(!this._viewer)return void console.warn("ModelStagePlugin: No viewer");const h=await this._viewer.prompt("Model Stage Plugin: Enter URL for the 3d model (glb, gltf, obj, fbx, etc)");h&&await this.setModel(h)}async setModel(h){var o,c,d;if(!this._viewer)return void console.warn("ModelStagePlugin: No viewer");const _=this.modelRef,v=h?await this._viewer.load(typeof h=="string"?h:{path:h.name,file:h},{autoCenter:!1,autoScale:!1,addToRoot:!0,importConfig:!1}):void 0;if(!v&&h)return void console.warn("ModelStagePlugin: Unable to load stage model");this.model=h||"",this.modelRef=v,_&&_.modelObject!==((o=this.modelRef)===null||o===void 0?void 0:o.modelObject)&&_.dispose(),this.refreshTransform();const b=this._viewer.getPlugin(LoadingScreenPlugin);return b!=null&&b.visible&&await b.hideWithDelay(),(d=(c=this.uiConfig).uiRefresh)===null||d===void 0||d.call(c,"postRender",!0,1),this.model}refreshTransform(){var h,o,c,d,_,v;const b=this.modelRef;if(!b||!this._viewer)return;const tt=this._viewer.getPluginByType("Ground");if(tt){tt.useModelBounds=this.groundBelowModel;const wt=this._viewer.getPlugin(GroundPlugin);wt&&(this.groundBelowModel?(this._lastPhysicalGroundProps={renderToDepth:wt.renderToDepth,physicalReflections:wt.physicalReflections,groundReflection:wt.groundReflection,material:{transparent:(h=wt.material)===null||h===void 0?void 0:h.transparent}},wt.renderToDepth=!1,wt.physicalReflections=!1,wt.groundReflection=!1,wt.material&&(wt.material.transparent=!0)):this._lastPhysicalGroundProps&&(wt.renderToDepth=this._lastPhysicalGroundProps.renderToDepth,wt.physicalReflections=this._lastPhysicalGroundProps.physicalReflections,wt.groundReflection=this._lastPhysicalGroundProps.groundReflection,wt.material&&this._lastPhysicalGroundProps.material&&(wt.material.transparent=this._lastPhysicalGroundProps.material.transparent),this._lastPhysicalGroundProps=void 0))}const it=this._getPlaceholders(),nt=it[0];if(it.forEach(wt=>wt.visible=!1),!nt)return void console.warn("ModelStagePlugin: No placeholder found");const lt=this._viewer.scene.modelRoot.children[0];if(!lt)return void console.warn("ModelStagePlugin: No object in scene");const ut=new Box3B().expandByObject(lt,!0,!0),ht=new Box3B().expandByObject(nt,!0,!1),_t=ut.getSize(new three_module.Pq0),ft=ht.getSize(new three_module.Pq0),bt=ut.getCenter(new three_module.Pq0),xt=ht.getCenter(new three_module.Pq0),St=Math.max(_t.x/ft.x,_t.y/ft.y,_t.z/ft.z);if(isFinite(St)&&St!==0){b.modelObject.scale.multiplyScalar(St),xt.multiplyScalar(St),b.modelObject.position.add(bt).sub(xt),b.modelObject.position.y+=(ft.y*St-_t.y)/2,(c=(o=b.modelObject).setDirty)===null||c===void 0||c.call(o);for(let wt=1;wt<this._viewer.scene.modelRoot.children.length;wt++){const Pt=it[wt%it.length],Rt=this._viewer.scene.modelRoot.children[wt];Pt.updateMatrixWorld(!0),Rt.updateMatrixWorld(!0);const kt=Pt.getWorldQuaternion(new three_module.PTz);Rt.applyQuaternion(kt),Rt.updateMatrixWorld(!0);const Gt=new Box3B().expandByObject(Pt,!0,!1),Dt=new Box3B().expandByObject(Rt,!0,!0),It=Gt.getSize(new three_module.Pq0),Nt=Dt.getSize(new three_module.Pq0),Vt=Gt.getCenter(new three_module.Pq0),Kt=Dt.getCenter(new three_module.Pq0),Yt=Math.min(It.x/Nt.x,It.y/Nt.y,It.z/Nt.z);isFinite(Yt)&&Yt!==0&&(Rt.scale.multiplyScalar(Yt),Kt.multiplyScalar(Yt),Rt.position.add(Vt).sub(Kt),Rt.position.y+=(Nt.y*Yt-It.y)/2,(_=(d=Rt).setDirty)===null||_===void 0||_.call(d))}if(nt.updateMatrixWorld(!0),b.modelObject.animations.length){let wt=nt.matrixWorld.clone();this._animationStep=()=>{const Pt=nt.matrixWorld.clone(),Rt=wt.invert().premultiply(Pt);lt.applyMatrix4(Rt),wt=Pt}}else this._animationStep=()=>{};if(!this.groundBelowModel){const wt=this._viewer.getPluginByType("Ground");if(!((v=wt==null?void 0:wt.mesh)===null||v===void 0)&&v.modelObject&&wt){const Pt=new Box3B().expandByObject(b.modelObject,!0,!1).getSize(new three_module.Pq0),Rt=Math.max(Pt.x,Pt.z);wt.autoFrustumSize=!1,wt.size=Rt;const kt=wt.shadowBaker;kt&&(kt.light.shadowParams.frustumSize=2*Rt,kt.light.updateShadowParams())}}}}_getPlaceholders(h){var o;const c=[];return(o=h??this.modelRef)===null||o===void 0||o.modelObject.traverse(d=>{d.name.toLowerCase().startsWith("placeholder")&&c.push(d)}),c}async onAdded(h){var o;await super.onAdded(h),h.scene.addEventListener("sceneUpdate",this._sceneUpdate),(o=h.getPlugin(GLTFAnimationPlugin))===null||o===void 0||o.addEventListener("animationStep",this._animationStep2)}async onRemove(h){var o;return this.modelRef&&this.modelRef.dispose(),h.scene.removeEventListener("sceneUpdate",this._sceneUpdate),(o=h.getPlugin(GLTFAnimationPlugin))===null||o===void 0||o.removeEventListener("animationStep",this._animationStep2),super.onRemove(h)}fromJSON(h,o){return h.model!==void 0&&this.setModel(h.model),super.fromJSON(h,o)}loadSampleModel(){console.log("Sample model loading disabled - using local assets only")}togglePlaceholders(){var h;this._getPlaceholders().forEach(o=>{o.material&&(o.material.opacity=Math.min(.75,o.material.opacity||1),o.material.transparent=!0),o.visible=!o.visible}),(h=this._viewer)===null||h===void 0||h.setDirty()}importStageViewerConfig(){var h,o,c;const d=((h=this.modelRef)===null||h===void 0?void 0:h.modelObject).__importedViewerConfig;if(!d||typeof d!="object"||!this._viewer)return;const _=this._viewer.scene.activeCamera.toJSON(),v=this._viewer.serializePluginsIgnored;this._viewer.serializePluginsIgnored=[...v,LoadingScreenPlugin.PluginType,InteractionPromptPlugin.PluginType,"ReliefParallaxMapping","RendererParamsUiPlugin",CameraViewPlugin.PluginType,"MaterialConfiguratorPlugin","SwitchNodePlugin","FrameFade","GLTFAnimationPlugin","ModelStagePlugin",SnowFallPlugin.PluginType],(c=(o=this._viewer)===null||o===void 0?void 0:o.assetManager)===null||c===void 0||c.applyViewerConfig(d,d.resources),this._viewer.serializePluginsIgnored=v,this._viewer.scene.activeCamera.fromJSON(_)}};ModelStagePlugin.PluginType="ModelStagePlugin",ModelStagePlugin_decorate([serialize()],ModelStagePlugin.prototype,"model",void 0),ModelStagePlugin_decorate([uiButton("Prompt Local File")],ModelStagePlugin.prototype,"promptLoadModel",null),ModelStagePlugin_decorate([uiButton("Prompt URL")],ModelStagePlugin.prototype,"promptLoadModelUrl",null),ModelStagePlugin_decorate([uiButton("Refresh Placeholder Transform")],ModelStagePlugin.prototype,"refreshTransform",null),ModelStagePlugin_decorate([serialize(),x$1(ModelStagePlugin.prototype.refreshTransform),uiToggle()],ModelStagePlugin.prototype,"groundBelowModel",void 0),ModelStagePlugin_decorate([uiButton("Load sample model")],ModelStagePlugin.prototype,"loadSampleModel",null),ModelStagePlugin_decorate([uiButton("Toggle Placeholders")],ModelStagePlugin.prototype,"togglePlaceholders",null),ModelStagePlugin_decorate([uiButton("Import Stage Config",h=>({hidden:()=>{var o,c;return!(!((c=(o=h.modelRef)===null||o===void 0?void 0:o.modelObject)===null||c===void 0)&&c.__importedViewerConfig)}}))],ModelStagePlugin.prototype,"importStageViewerConfig",null),ModelStagePlugin=ModelStagePlugin_decorate([uiFolder("Model Stage")],ModelStagePlugin);class CoreViewerApp extends ViewerApp{constructor(o){super(o),this.licenseKey=o.licenseKey}async initialize({caching:o=!0,ground:c=!0,bloom:d=!0,depthTonemap:_=!0,enableDrop:v=!1,importPopup:b=!0,debug:tt=!1,interactionPrompt:it=!0}={}){tt&&await this.addPlugin(DebugPlugin),this.getPlugin(AssetManagerPlugin)||this.addPluginSync(AssetManagerPlugin,void 0,void 0,{storage:o&&window.caches?await caches.open("webgi-cache-storage"):void 0}),await addBasePlugins(this,{ground:c,bloom:d,depthTonemap:_,enableDrop:v,importPopup:b,interactionPrompt:it}),await this.getOrAddPlugin(PresetLibraryPlugin);const nt=await this.getOrAddPlugin(DiamondPlugin);return this.licenseKey&&nt.setKey(this.licenseKey),await this.addPlugin(MaterialConfiguratorPlugin),await this.addPlugin(SwitchNodePlugin),await this.addPlugin(MaterialLibraryPlugin),this}}async function addBasePlugins(h,{ground:o=!0,bloom:c=!0,depthTonemap:d=!0,enableDrop:_=!1,importPopup:v=!1,interactionPrompt:b=!0}={}){await h.getOrAddPlugin(AssetManagerPlugin),v&&await h.getOrAddPlugin(LoadingScreenPlugin),await h.getOrAddPlugin(GBufferPlugin),await h.getOrAddPlugin(FullScreenPlugin),_&&await h.getOrAddPlugin(DropzonePlugin),await h.addPlugin(new ProgressivePlugin(32)),await h.getOrAddPlugin(CombinedPostPlugin),await h.getOrAddPlugin(ChromaticAberrationPlugin),await h.addPlugin(new TonemapPlugin(d||!h.useRgbm)),await h.getOrAddPlugin(LUTPlugin),await h.getOrAddPlugin(VignettePlugin),await h.getOrAddPlugin(FilmicGrainPlugin),await h.getOrAddPlugin(GammaCorrectionPlugin),await h.getOrAddPlugin(SSRPlugin),await h.getOrAddPlugin(SSAOPlugin),await h.getOrAddPlugin(FrameFadePlugin),await h.getOrAddPlugin(GLTFAnimationPlugin),await h.getOrAddPlugin(AnisotropyPlugin),await h.getOrAddPlugin(TriplanarUVMappingPlugin),await h.getOrAddPlugin(ThinFilmLayerPlugin),await h.getOrAddPlugin(FragmentClippingExtensionPlugin),await h.getOrAddPlugin(NoiseBumpMaterialPlugin),await h.getOrAddPlugin(CustomBumpMapPlugin),await h.getOrAddPlugin(ClearcoatTintPlugin),await h.getOrAddPlugin(GLTFKHRMaterialVariantsPlugin),await h.getOrAddPlugin(VelocityBufferPlugin,!1),await h.getOrAddPlugin(TemporalAAPlugin),await h.getOrAddPlugin(CameraViewPlugin),await h.getOrAddPlugin(RandomizedDirectionalLightPlugin,!1),await h.getOrAddPlugin(HDRiGroundPlugin,!1),await h.getOrAddPlugin(DepthOfFieldPlugin,!1),await h.getOrAddPlugin(SSContactShadows,!1),await h.getOrAddPlugin(SSGIPlugin,!1),await h.getOrAddPlugin(NormalBufferPlugin,!1),await h.getOrAddPlugin(SSBevelPlugin,!1),await h.getOrAddPlugin(KTX2LoadPlugin),await h.getOrAddPlugin(ObjMtlLoadPlugin),await h.getOrAddPlugin(FBXLoadPlugin),await h.getOrAddPlugin(Rhino3dmLoadPlugin),await h.getOrAddPlugin(STLLoadPlugin),await h.getOrAddPlugin(EXRLoadPlugin),await h.getOrAddPlugin(GLTFMeshOptPlugin),await h.getOrAddPlugin(ModelStagePlugin),await h.getOrAddPlugin(ParallaxCameraControllerPlugin),c&&await h.getOrAddPlugin(BloomPlugin),o&&await h.getOrAddPlugin(GroundPlugin),b&&await h.getOrAddPlugin(InteractionPromptPlugin),await h.getOrAddPlugin(LayeredMaterialPlugin),h.renderer.refreshPipeline()}var dist_tippy=__webpackgi_require__(774),tippy_exported={};dist_tippy.A&&dist_tippy.A.locals&&(tippy_exported.locals=dist_tippy.A.locals);var tippy_refs=0,tippy_update,tippy_options={};tippy_options.styleTagTransform=styleTagTransform_default(),tippy_options.setAttributes=setAttributesWithoutAttributes_default(),tippy_options.insert=function(h,o){(o.target||document.head).appendChild(h)},tippy_options.domAPI=styleDomAPI_default(),tippy_options.insertStyleElement=insertStyleElement_default(),tippy_exported.use=function(h){return tippy_options.options=h||{},tippy_refs++||(tippy_update=injectStylesIntoStyleTag_default()(dist_tippy.A,tippy_options)),tippy_exported},tippy_exported.unuse=function(){tippy_refs>0&&!--tippy_refs&&(tippy_update(),tippy_update=null)};var tippy_js_dist_tippy=tippy_exported;const placeholderModel="",placeholderEnvironment="";let id$3=0;class WebGiViewerElement extends HTMLElement{constructor(){super(),this._initialized=!1,this._state={src:"",environment:""},this._models={},this._refreshingModels=!1,this._refreshingEnvironment=!1,this._environmentFromSource=null,this.viewerIndex=id$3++,this.canvasId="webgi-viewer-"+this.viewerIndex,window.freeViewers||(window.freeViewers=[]),this.attachShadow({mode:"open"}),this.wrapper=document.createElement("div"),this.wrapper.style.width="100%",this.wrapper.style.height="100%",this.wrapper.style.display="block";const o=window.freeViewers.pop(),c=document.createElement("style");c.textContent=$`
            #${this.canvasId}{
              width: 100%; height: 100%; z-index: 1;
              display: block;
            }
            //.tippy-box[data-theme~='editor']{
            //    margin: 0.25rem !important;
            //    background-color: hsla(230, 10%, 30%, 1.00) !important;
            //    font-size: 0.9rem !important;
            //    color: hsla(230, 5%, 90%, 1.00) !important;
            //}
        `,tippy_js_dist_tippy.use({target:this.wrapper}),tippy_esm.setDefaultProps({duration:300,arrow:!0,appendTo:()=>this.wrapper}),this.shadowRoot.append(c,this.wrapper),this._initialized=!0,this._initialize(o).then(async()=>this.refreshAll())}async refreshAll(){this.viewer&&(this.viewer.renderer.displayCanvasScaling=parseFloat(this.getAttribute("renderScale")||this.getAttribute("renderscale")||this.viewer.renderer.displayCanvasScaling.toString())),await Promise.all([this.refreshModelSource(),this.refreshEnvironment()])}async _initialize(o){o!=null&&o._lastState&&(this._state.src=o._lastState.src||this._state.src,this._state.environment=o._lastState.environment||this._state.environment,delete o._lastState),o!=null&&o.__models&&(this._models={...this._models,...o.__models},delete o.__models),this.canvas=(o==null?void 0:o.canvas)||j(),this.canvas.setAttribute("id",this.canvasId),this.wrapper.append(this.canvas),this.viewer=o??new CoreViewerApp({canvas:this.canvas,useRgbm:this._getAttr("rgbm","true")==="true",useGBufferDepth:this._getAttr("depth-prepass","true")==="true",assetManager:{storage:window.caches?await caches.open("webgi-cache-storage"):void 0}}),this.viewer&&(this.viewer.renderer.displayCanvasScaling=parseFloat(this.getAttribute("renderScale")||this.getAttribute("renderscale")||this.viewer.renderer.displayCanvasScaling.toString())),o||await this.viewer.initialize({debug:this._getAttr("debug","false")==="true",ground:this._getAttr("ground","baked")==="baked",bloom:this._getAttr("bloom","true")==="true",depthTonemap:!0}),this.dispatchEvent(new Event("initialized"))}connectedCallback(){this._initialized&&this.viewer&&(this.viewer.resize(),this.viewer.enabled=!0,this.dispatchEvent(new Event("connected")))}disconnectedCallback(){var o,c;this.viewer&&(this.getAttribute("disposeOnRemove")==="true"||this.getAttribute("disposeonremove")==="true"?((o=this.canvas)===null||o===void 0||o.remove(),this.clearViewer(),this.viewer.dispose(),this.viewer=void 0,this.canvas=void 0,this._initialized=!1):this.getAttribute("autoManageViewers")==="true"||this.getAttribute("automanageviewers")==="true"?((c=this.canvas)===null||c===void 0||c.remove(),this.viewer._lastState={...this._state},this.viewer._lastState.src="",this.clearViewer(),window.freeViewers.push(this.viewer),this.viewer=void 0,this.canvas=void 0,this._initialized=!1):this.viewer.enabled=!1,this.dispatchEvent(new Event("disconnected")))}adoptedCallback(){this.viewer&&(this.viewer.resize(),this.viewer.enabled=!0)}static get observedAttributes(){return["src","environment","renderScale"]}attributeChangedCallback(o,c,d){this.refreshAll()}clearViewer(){var o,c;(o=this.viewer)===null||o===void 0||o.scene.disposeSceneModels(),(c=this.viewer)===null||c===void 0||c.scene.setEnvironment(null),Object.values(this._models).forEach(async d=>d.then(_=>_.forEach(v=>v.dispose&&v.dispose()))),this._models={}}async refreshModelSource(){if(!this.viewer)return;const o=this._getAttr("src",placeholderModel);if(o===this._state.src||this._refreshingModels)return;this._refreshingModels=!0;const c=[o],d=[],_=[],v=this.viewer.scene.environment;this.viewer.scene.environment=null,this._environmentFromSource=null;for(const tt of c)!this._models[tt]&&tt&&(this._models[tt]=this.viewer.getManager().importer.importPath(tt,{autoScale:this._getAttr("auto-scale","true")==="true",autoCenter:this._getAttr("auto-center","true")==="true",processImported:!0,pathOverride:this._getAttr("filename","")||void 0}));const b=this.viewer.scene.environment;b?this._environmentFromSource=b:this.viewer.scene.environment=v;for(const[tt,it]of Object.entries(this._models))c.includes(tt)?d.push(it.then(nt=>[tt,nt])):_.push(it);await Promise.all([Promise.all(d).then(async tt=>Promise.all(tt.map(async it=>(this._models[it[0]]=this.viewer.getManager().importer.processImported(it[1]),this._models[it[0]])))).then(tt=>{for(const it of tt)for(const nt of it)nt&&nt.assetType==="model"&&this.viewer.scene.addSceneObject(nt)}),Promise.all(_).then(tt=>{for(const it of tt)for(const nt of it)nt&&nt.assetType==="model"&&nt.modelObject.removeFromParent()})]),this._state.src=o,this._refreshingModels=!1}async refreshEnvironment(){if(!this.viewer)return;if(!this.hasAttribute("environment"))return void(this._state.environment=null);if(this._environmentFromSource)return void this.viewer.console.warn("Environment is already set by model source, ignoring environment attribute.");const o=this._getAttr("environment",placeholderEnvironment);if(o===this._state.src||this._refreshingEnvironment)return;this._refreshingEnvironment=!0;const c=this.viewer.scene.getEnvironment(),d=o?await this.viewer.getManager().importer.importSinglePath(o):void 0;this._environmentFromSource?this.viewer.console.warn("Environment is already set by model source, ignoring environment attribute."):(d&&d.assetType!=="texture"||await this.viewer.scene.setEnvironment(d),c==null||c.dispose(),this.dispatchEvent(new CustomEvent("environment-loaded",{detail:{src:o}})),this._state.environment=o,this._refreshingEnvironment=!1)}_getAttr(o,c){return this.hasAttribute(o)?this.getAttribute(o):c}addEventListener(o,c,d){super.addEventListener(o,c,d),o==="initialized"&&this._initialized&&this.dispatchEvent(new Event("initialized"))}}window&&window.customElements&&!window.customElements.get("webgi-viewer")&&window.customElements.define("webgi-viewer",WebGiViewerElement);var popup=__webpackgi_require__(636),popup_exported={};popup.A&&popup.A.locals&&(popup_exported.locals=popup.A.locals);var popup_refs=0,popup_update,popup_options={};popup_options.styleTagTransform=styleTagTransform_default(),popup_options.setAttributes=setAttributesWithoutAttributes_default(),popup_options.insert=function(h,o){(o.target||document.head).appendChild(h)},popup_options.domAPI=styleDomAPI_default(),popup_options.insertStyleElement=insertStyleElement_default(),popup_exported.use=function(h){return popup_options.options=h||{},popup_refs++||(popup_update=injectStylesIntoStyleTag_default()(popup.A,popup_options)),popup_exported},popup_exported.unuse=function(){popup_refs>0&&!--popup_refs&&(popup_update(),popup_update=null)};var styles_popup=popup_exported,AssetManagerPopupPlugin_decorate=function(h,o,c,d){var _,v=arguments.length,b=v<3?o:d===null?d=Object.getOwnPropertyDescriptor(o,c):d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(h,o,c,d);else for(var tt=h.length-1;tt>=0;tt--)(_=h[tt])&&(b=(v<3?_(b):v>3?_(o,c,b):_(o,c))||b);return v>3&&b&&Object.defineProperty(o,c,b),b};let AssetManagerBasicPopupPlugin=class extends AAssetManagerProcessStatePlugin{constructor(){super("Popup");const h=ee$1({id:"assetManagerPopupClose",addToBody:!1,innerHTML:"&#10005"});h.addEventListener("click",()=>{this._mainDiv.style.display="none"}),this._mainDiv.appendChild(h)}_updateMainDiv(h){if(!this._contentDiv)return;if(!this.enabled)return void(this._mainDiv.style.display="none");let o="";h.forEach((c,d)=>{o+=`<span class="processState">${c.state}</span>: ${(d||"").split("/").pop()} ${c.progress?" - "+c.progress.toFixed(0)+"%":""}<br>`}),this._contentDiv.innerHTML=o,h.size===0?this._mainDiv.style.display="none":this._mainDiv.style.display="block"}async onAdded(h){styles_popup.use({target:h.container}),await super.onAdded(h)}};AssetManagerBasicPopupPlugin.PluginType="AssetManagerBasicPopupPlugin",AssetManagerBasicPopupPlugin=AssetManagerPopupPlugin_decorate([uiFolder("Asset manager popup")],AssetManagerBasicPopupPlugin);var loadingBar=__webpackgi_require__(223),loadingBar_exported={};loadingBar.A&&loadingBar.A.locals&&(loadingBar_exported.locals=loadingBar.A.locals);var loadingBar_refs=0,loadingBar_update,loadingBar_options={};loadingBar_options.styleTagTransform=styleTagTransform_default(),loadingBar_options.setAttributes=setAttributesWithoutAttributes_default(),loadingBar_options.insert=function(h,o){(o.target||document.head).appendChild(h)},loadingBar_options.domAPI=styleDomAPI_default(),loadingBar_options.insertStyleElement=insertStyleElement_default(),loadingBar_exported.use=function(h){return loadingBar_options.options=h||{},loadingBar_refs++||(loadingBar_update=injectStylesIntoStyleTag_default()(loadingBar.A,loadingBar_options)),loadingBar_exported},loadingBar_exported.unuse=function(){loadingBar_refs>0&&!--loadingBar_refs&&(loadingBar_update(),loadingBar_update=null)};var styles_loadingBar=loadingBar_exported,AssetManagerLoadingBarPlugin_decorate=function(h,o,c,d){var _,v=arguments.length,b=v<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(h,o,c,d);else for(var tt=h.length-1;tt>=0;tt--)(_=h[tt])&&(b=(v<3?_(b):v>3?_(o,c,b):_(o,c))||b);return v>3&&b&&Object.defineProperty(o,c,b),b};let AssetManagerLoadingBarPlugin=class extends AAssetManagerProcessStatePlugin{constructor(h=!0){super("LoadingBar"),this.showText=h,this.hideOnOnlyErrors=!0}_updateMainDiv(h){if(!this._contentDiv)return;if(!this.enabled)return void(this._mainDiv.style.display="none");let o=1,c=1;h.forEach((_,v)=>{var b;o+=(b=_.progress)!==null&&b!==void 0?b:99,c+=100}),this._contentDiv.innerHTML=this.showText?(100*o/c).toFixed(0)+"%":"&nbsp;",this._contentDiv.style.width=(100*o/c).toFixed(0)+"%";const d=[...h.values()].filter(_=>_.state==="error");d.length>0&&d.length===h.size&&this.hideOnOnlyErrors||h.size===0?this._mainDiv.style.display="none":this._mainDiv.style.display="block"}async onAdded(h){styles_loadingBar.use({target:h.container}),await super.onAdded(h)}};AssetManagerLoadingBarPlugin.PluginType="AssetManagerLoadingBarPlugin",AssetManagerLoadingBarPlugin_decorate([uiToggle("Hide on only errors"),serialize()],AssetManagerLoadingBarPlugin.prototype,"hideOnOnlyErrors",void 0),AssetManagerLoadingBarPlugin=AssetManagerLoadingBarPlugin_decorate([uiFolder("Asset manager loading bar")],AssetManagerLoadingBarPlugin);class SimpleAssetList{get basePath(){return this._basePath}get assets(){return this._assets}constructor(o){var c,d,_;this._basePath=(c=o==null?void 0:o.basePath)!==null&&c!==void 0?c:"",this._assets=(_=(d=o==null?void 0:o.assets)===null||d===void 0?void 0:d.map(v=>this._resolveAsset(v)))!==null&&_!==void 0?_:[]}find(o){return this._assets.find(o)??void 0}_resolveAsset(o){return{...o,path:ot([this._basePath,o.path])}}}class SimpleDataSource extends I$2{constructor(...o){super(),this._assets=o}addAssetList(o){this._assets.push(o)}removeAssetList(o){const c=this._assets.indexOf(o);c>=0&&this._assets.splice(c,1)}async findAssetRegex(o){for(const c of this._assets){const d=c.find(_=>{var v,b;return _&&(o.test(_.path)||o.test((b=(v=_.file)===null||v===void 0?void 0:v.name)!==null&&b!==void 0?b:""))});if(d)return d}console.warn("Asset not found:",o)}async findAsset(o){return this.findAssetRegex(o.query)}async findAssetSimple(o,c=!1){return this.findAssetRegex(new RegExp(o,c?"i":""))}}const LineSegments2_start=new three_module.Pq0,LineSegments2_end=new three_module.Pq0,_start4=new three_module.IUQ,_end4=new three_module.IUQ,_ssOrigin=new three_module.IUQ,_ssOrigin3=new three_module.Pq0,_mvMatrix=new three_module.kn4,_line=new three_module.cZY,_closestPoint=new three_module.Pq0,LineSegments2_box=new three_module.NRn,_sphere=new three_module.iyt,_clipToWorldVector=new three_module.IUQ;let LineSegments2_ray,_lineWidth;function getWorldSpaceHalfWidth(h,o,c){return _clipToWorldVector.set(0,0,-o,1).applyMatrix4(h.projectionMatrix),_clipToWorldVector.multiplyScalar(1/_clipToWorldVector.w),_clipToWorldVector.x=_lineWidth/c.width,_clipToWorldVector.y=_lineWidth/c.height,_clipToWorldVector.applyMatrix4(h.projectionMatrixInverse),_clipToWorldVector.multiplyScalar(1/_clipToWorldVector.w),Math.abs(Math.max(_clipToWorldVector.x,_clipToWorldVector.y))}function raycastWorldUnits(h,o){const c=h.matrixWorld,d=h.geometry,_=d.attributes.instanceStart,v=d.attributes.instanceEnd;for(let b=0,tt=Math.min(d.instanceCount,_.count);b<tt;b++){_line.start.fromBufferAttribute(_,b),_line.end.fromBufferAttribute(v,b),_line.applyMatrix4(c);const it=new three_module.Pq0,nt=new three_module.Pq0;LineSegments2_ray.distanceSqToSegment(_line.start,_line.end,nt,it),nt.distanceTo(it)<.5*_lineWidth&&o.push({point:nt,pointOnLine:it,distance:LineSegments2_ray.origin.distanceTo(nt),object:h,face:null,faceIndex:b,uv:null,uv1:null})}}function raycastScreenSpace(h,o,c){const d=o.projectionMatrix,_=h.material.resolution,v=h.matrixWorld,b=h.geometry,tt=b.attributes.instanceStart,it=b.attributes.instanceEnd,nt=Math.min(b.instanceCount,tt.count),lt=-o.near;LineSegments2_ray.at(1,_ssOrigin),_ssOrigin.w=1,_ssOrigin.applyMatrix4(o.matrixWorldInverse),_ssOrigin.applyMatrix4(d),_ssOrigin.multiplyScalar(1/_ssOrigin.w),_ssOrigin.x*=_.x/2,_ssOrigin.y*=_.y/2,_ssOrigin.z=0,_ssOrigin3.copy(_ssOrigin),_mvMatrix.multiplyMatrices(o.matrixWorldInverse,v);for(let ut=0,ht=nt;ut<ht;ut++){if(_start4.fromBufferAttribute(tt,ut),_end4.fromBufferAttribute(it,ut),_start4.w=1,_end4.w=1,_start4.applyMatrix4(_mvMatrix),_end4.applyMatrix4(_mvMatrix),_start4.z>lt&&_end4.z>lt)continue;if(_start4.z>lt){const St=_start4.z-_end4.z,wt=(_start4.z-lt)/St;_start4.lerp(_end4,wt)}else if(_end4.z>lt){const St=_end4.z-_start4.z,wt=(_end4.z-lt)/St;_end4.lerp(_start4,wt)}_start4.applyMatrix4(d),_end4.applyMatrix4(d),_start4.multiplyScalar(1/_start4.w),_end4.multiplyScalar(1/_end4.w),_start4.x*=_.x/2,_start4.y*=_.y/2,_end4.x*=_.x/2,_end4.y*=_.y/2,_line.start.copy(_start4),_line.start.z=0,_line.end.copy(_end4),_line.end.z=0;const _t=_line.closestPointToPointParameter(_ssOrigin3,!0);_line.at(_t,_closestPoint);const ft=three_module.cj9.lerp(_start4.z,_end4.z,_t),bt=ft>=-1&&ft<=1,xt=_ssOrigin3.distanceTo(_closestPoint)<.5*_lineWidth;if(bt&&xt){_line.start.fromBufferAttribute(tt,ut),_line.end.fromBufferAttribute(it,ut),_line.start.applyMatrix4(v),_line.end.applyMatrix4(v);const St=new three_module.Pq0,wt=new three_module.Pq0;LineSegments2_ray.distanceSqToSegment(_line.start,_line.end,wt,St),c.push({point:wt,pointOnLine:St,distance:LineSegments2_ray.origin.distanceTo(wt),object:h,face:null,faceIndex:ut,uv:null,uv1:null})}}}class LineSegments2 extends three_module.eaF{constructor(o=new LineSegmentsGeometry,c=new LineMaterial({color:16777215*Math.random()})){super(o,c),this.isLineSegments2=!0,this.type="LineSegments2"}computeLineDistances(){const o=this.geometry,c=o.attributes.instanceStart,d=o.attributes.instanceEnd,_=new Float32Array(2*c.count);for(let b=0,tt=0,it=c.count;b<it;b++,tt+=2)LineSegments2_start.fromBufferAttribute(c,b),LineSegments2_end.fromBufferAttribute(d,b),_[tt]=tt===0?0:_[tt-1],_[tt+1]=_[tt]+LineSegments2_start.distanceTo(LineSegments2_end);const v=new three_module.LuO(_,2,1);return o.setAttribute("instanceDistanceStart",new three_module.eHs(v,1,0)),o.setAttribute("instanceDistanceEnd",new three_module.eHs(v,1,1)),this}raycast(o,c){const d=this.material.worldUnits,_=o.camera;_!==null||d||console.error('LineSegments2: "Raycaster.camera" needs to be set in order to raycast against LineSegments2 while worldUnits is set to false.');const v=o.params.Line2!==void 0&&o.params.Line2.threshold||0;LineSegments2_ray=o.ray;const b=this.matrixWorld,tt=this.geometry,it=this.material;let nt,lt;_lineWidth=it.linewidth+v,tt.boundingSphere===null&&tt.computeBoundingSphere(),_sphere.copy(tt.boundingSphere).applyMatrix4(b),nt=d?.5*_lineWidth:getWorldSpaceHalfWidth(_,Math.max(_.near,_sphere.distanceToPoint(LineSegments2_ray.origin)),it.resolution),_sphere.radius+=nt,LineSegments2_ray.intersectsSphere(_sphere)!==!1&&(tt.boundingBox===null&&tt.computeBoundingBox(),LineSegments2_box.copy(tt.boundingBox).applyMatrix4(b),lt=d?.5*_lineWidth:getWorldSpaceHalfWidth(_,Math.max(_.near,LineSegments2_box.distanceToPoint(LineSegments2_ray.origin)),it.resolution),LineSegments2_box.expandByScalar(lt),LineSegments2_ray.intersectsBox(LineSegments2_box)!==!1&&(d?raycastWorldUnits(this,c):raycastScreenSpace(this,_,c)))}}class LineGeometry extends LineSegmentsGeometry{constructor(){super(),this.isLineGeometry=!0,this.type="LineGeometry"}setPositions(o){const c=o.length-3,d=new Float32Array(2*c);for(let _=0;_<c;_+=3)d[2*_]=o[_],d[2*_+1]=o[_+1],d[2*_+2]=o[_+2],d[2*_+3]=o[_+3],d[2*_+4]=o[_+4],d[2*_+5]=o[_+5];return super.setPositions(d),this}setColors(o){const c=o.length-3,d=new Float32Array(2*c);for(let _=0;_<c;_+=3)d[2*_]=o[_],d[2*_+1]=o[_+1],d[2*_+2]=o[_+2],d[2*_+3]=o[_+3],d[2*_+4]=o[_+4],d[2*_+5]=o[_+5];return super.setColors(d),this}fromLine(o){const c=o.geometry;return this.setPositions(c.attributes.position.array),this}}class Line2 extends LineSegments2{constructor(o=new LineGeometry,c=new LineMaterial({color:16777215*Math.random()})){super(o,c),this.isLine2=!0,this.type="Line2"}}class KTXLoader extends three_module.YRT{constructor(o){super(o)}parse(o,c){const d=new KhronosTextureContainer(o,1);return{mipmaps:d.mipmaps(c),width:d.pixelWidth,height:d.pixelHeight,format:d.glInternalFormat,isCubemap:d.numberOfFaces===6,mipmapCount:d.numberOfMipmapLevels}}}const HEADER_LEN=64,COMPRESSED_2D=0;class KhronosTextureContainer{constructor(o,c){this.arrayBuffer=o;const d=new Uint8Array(this.arrayBuffer,0,12);if(d[0]!==171||d[1]!==75||d[2]!==84||d[3]!==88||d[4]!==32||d[5]!==49||d[6]!==49||d[7]!==187||d[8]!==13||d[9]!==10||d[10]!==26||d[11]!==10)return void console.error("texture missing KTX identifier");const _=Uint32Array.BYTES_PER_ELEMENT,v=new DataView(this.arrayBuffer,12,13*_),b=v.getUint32(0,!0)===67305985;this.glType=v.getUint32(1*_,b),this.glTypeSize=v.getUint32(2*_,b),this.glFormat=v.getUint32(3*_,b),this.glInternalFormat=v.getUint32(4*_,b),this.glBaseInternalFormat=v.getUint32(5*_,b),this.pixelWidth=v.getUint32(6*_,b),this.pixelHeight=v.getUint32(7*_,b),this.pixelDepth=v.getUint32(8*_,b),this.numberOfArrayElements=v.getUint32(9*_,b),this.numberOfFaces=v.getUint32(10*_,b),this.numberOfMipmapLevels=v.getUint32(11*_,b),this.bytesOfKeyValueData=v.getUint32(12*_,b),this.glType===0?(this.numberOfMipmapLevels=Math.max(1,this.numberOfMipmapLevels),this.pixelHeight!==0&&this.pixelDepth===0?this.numberOfArrayElements===0?this.numberOfFaces===c?this.loadType=COMPRESSED_2D:console.warn("number of faces expected"+c+", but found "+this.numberOfFaces):console.warn("texture arrays not currently supported"):console.warn("only 2D textures currently supported")):console.warn("only compressed formats currently supported")}mipmaps(o){const c=[];let d=HEADER_LEN+this.bytesOfKeyValueData,_=this.pixelWidth,v=this.pixelHeight;const b=o?this.numberOfMipmapLevels:1;for(let tt=0;tt<b;tt++){const it=new Int32Array(this.arrayBuffer,d,1)[0];d+=4;for(let nt=0;nt<this.numberOfFaces;nt++){const lt=new Uint8Array(this.arrayBuffer,d,it);c.push({data:lt,width:_,height:v}),d+=it,d+=3-(it+3)%4}_=Math.max(1,.5*_),v=Math.max(1,.5*v)}return c}}class KTXLoadPlugin extends I$2{constructor(){super(...arguments),this.dependencies=[AssetManagerPlugin]}async onAdded(o){var c,d;this._importer||(this._importer=new Importer(KTXLoader,["ktx"],!1)),(d=(c=o.getManager())===null||c===void 0?void 0:c.importer)===null||d===void 0||d.Importers.push(this._importer)}async onDispose(o){this._importer=void 0}async onRemove(o){var c,d;this._importer&&!((d=(c=o.getManager())===null||c===void 0?void 0:c.importer)===null||d===void 0)&&d.Importers&&o.getManager().importer.Importers.splice(o.getManager().importer.Importers.indexOf(this._importer),1),this._importer=void 0}}KTXLoadPlugin.PluginType="KTXLoadPlugin";class BlobLoader extends three_module.Y9S{constructor(o){super(o),this.responseType="blob"}}class DataUrlLoader extends three_module.Y9S{constructor(o){super(o),this.responseType="blob"}load(o,c,d,_){return super.load(o,v=>{try{c==null||c(q$2(v))}catch(b){_==null||_(b)}},d,_)}}class SimpleJSONExporter{async parseAsync(o,c){var d;return new Blob([JSON.stringify(o,null,(d=c.jsonSpaces)!==null&&d!==void 0?d:2)],{type:"application/json"})}}class SimpleTextExporter{async parseAsync(o,c){return new Blob([o],{type:"text/plain"})}}let _renderer,fullscreenQuadGeometry,fullscreenQuadMaterial,fullscreenQuad;function TextureUtils_decompress(h,o=1/0,c=null){fullscreenQuadGeometry||(fullscreenQuadGeometry=new three_module.bdM(2,2,1,1)),fullscreenQuadMaterial||(fullscreenQuadMaterial=new three_module.BKk({uniforms:{blitTexture:new three_module.nc$(h)},vertexShader:`
            varying vec2 vUv;
            void main(){
                vUv = uv;
                gl_Position = vec4(position.xy * 1.0,0.,.999999);
            }`,fragmentShader:`
            uniform sampler2D blitTexture; 
            varying vec2 vUv;

            void main(){ 
                gl_FragColor = vec4(vUv.xy, 0, 1);
                
                #ifdef IS_SRGB
                gl_FragColor = LinearTosRGB( texture2D( blitTexture, vUv) );
                #else
                gl_FragColor = texture2D( blitTexture, vUv);
                #endif
            }`})),fullscreenQuadMaterial.uniforms.blitTexture.value=h,fullscreenQuadMaterial.defines.IS_SRGB=h.colorSpace==three_module.er$,fullscreenQuadMaterial.needsUpdate=!0,fullscreenQuad||(fullscreenQuad=new three_module.eaF(fullscreenQuadGeometry,fullscreenQuadMaterial),fullscreenQuad.frustrumCulled=!1);const d=new three_module.ubm,_=new three_module.Z58;_.add(fullscreenQuad),c||(c=_renderer=new three_module.JeP({antialias:!1})),c.setSize(Math.min(h.image.width,o),Math.min(h.image.height,o)),c.clear(),c.render(_,d);const v=new three_module.gPd(c.domElement);return v.minFilter=h.minFilter,v.magFilter=h.magFilter,v.wrapS=h.wrapS,v.wrapT=h.wrapT,v.name=h.name,_renderer&&(_renderer.dispose(),_renderer=null),v}const KHR_mesh_quantization_ExtraAttrTypes={POSITION:["byte","byte normalized","unsigned byte","unsigned byte normalized","short","short normalized","unsigned short","unsigned short normalized"],NORMAL:["byte normalized","short normalized"],TANGENT:["byte normalized","short normalized"],TEXCOORD:["byte","byte normalized","unsigned byte","short","short normalized","unsigned short"]};class GLTFExporter{constructor(){this.pluginCallbacks=[],this.register(function(o){return new GLTFLightExtension(o)}),this.register(function(o){return new GLTFExporter_GLTFMaterialsUnlitExtension(o)}),this.register(function(o){return new GLTFExporter_GLTFMaterialsTransmissionExtension(o)}),this.register(function(o){return new GLTFExporter_GLTFMaterialsVolumeExtension(o)}),this.register(function(o){return new GLTFExporter_GLTFMaterialsIorExtension(o)}),this.register(function(o){return new GLTFExporter_GLTFMaterialsSpecularExtension(o)}),this.register(function(o){return new GLTFExporter_GLTFMaterialsClearcoatExtension(o)}),this.register(function(o){return new GLTFExporter_GLTFMaterialsIridescenceExtension(o)}),this.register(function(o){return new GLTFExporter_GLTFMaterialsSheenExtension(o)}),this.register(function(o){return new GLTFExporter_GLTFMaterialsAnisotropyExtension(o)}),this.register(function(o){return new GLTFExporter_GLTFMaterialsEmissiveStrengthExtension(o)})}register(o){return this.pluginCallbacks.indexOf(o)===-1&&this.pluginCallbacks.push(o),this}unregister(o){return this.pluginCallbacks.indexOf(o)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(o),1),this}parse(o,c,d,_,v){const b=v||new GLTFWriter,tt=[];for(let it=0,nt=this.pluginCallbacks.length;it<nt;it++)tt.push(this.pluginCallbacks[it](b));b.setPlugins(tt),b.write(o,c,_).catch(d)}parseAsync(o,c){const d=this;return new Promise(function(_,v){d.parse(o,_,v,c)})}}const GLTFExporter_WEBGL_CONSTANTS={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,ARRAY_BUFFER:34962,ELEMENT_ARRAY_BUFFER:34963,NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,REPEAT:10497},KHR_MESH_QUANTIZATION="KHR_mesh_quantization",THREE_TO_WEBGL={};THREE_TO_WEBGL[three_module.hxR]=GLTFExporter_WEBGL_CONSTANTS.NEAREST,THREE_TO_WEBGL[three_module.pHI]=GLTFExporter_WEBGL_CONSTANTS.NEAREST_MIPMAP_NEAREST,THREE_TO_WEBGL[three_module.Cfg]=GLTFExporter_WEBGL_CONSTANTS.NEAREST_MIPMAP_LINEAR,THREE_TO_WEBGL[three_module.k6q]=GLTFExporter_WEBGL_CONSTANTS.LINEAR,THREE_TO_WEBGL[three_module.kRr]=GLTFExporter_WEBGL_CONSTANTS.LINEAR_MIPMAP_NEAREST,THREE_TO_WEBGL[three_module.$_I]=GLTFExporter_WEBGL_CONSTANTS.LINEAR_MIPMAP_LINEAR,THREE_TO_WEBGL[three_module.ghU]=GLTFExporter_WEBGL_CONSTANTS.CLAMP_TO_EDGE,THREE_TO_WEBGL[three_module.GJx]=GLTFExporter_WEBGL_CONSTANTS.REPEAT,THREE_TO_WEBGL[three_module.kTW]=GLTFExporter_WEBGL_CONSTANTS.MIRRORED_REPEAT;const GLTFExporter_PATH_PROPERTIES={scale:"scale",position:"translation",quaternion:"rotation",morphTargetInfluences:"weights"},DEFAULT_SPECULAR_COLOR=new three_module.Q1f,GLB_HEADER_BYTES=12,GLB_HEADER_MAGIC=1179937895,GLB_VERSION=2,GLB_CHUNK_PREFIX_BYTES=8,GLB_CHUNK_TYPE_JSON=1313821514,GLB_CHUNK_TYPE_BIN=5130562;function equalArray(h,o){return h.length===o.length&&h.every(function(c,d){return c===o[d]})}function stringToArrayBuffer(h){return new TextEncoder().encode(h).buffer}function isIdentityMatrix(h){return equalArray(h.elements,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}function getMinMax(h,o,c){const d={min:new Array(h.itemSize).fill(Number.POSITIVE_INFINITY),max:new Array(h.itemSize).fill(Number.NEGATIVE_INFINITY)};for(let _=o;_<o+c;_++)for(let v=0;v<h.itemSize;v++){let b;h.itemSize>4?b=h.array[_*h.itemSize+v]:(v===0?b=h.getX(_):v===1?b=h.getY(_):v===2?b=h.getZ(_):v===3&&(b=h.getW(_)),h.normalized===!0&&(b=three_module.cj9.normalize(b,h.array))),d.min[v]=Math.min(d.min[v],b),d.max[v]=Math.max(d.max[v],b)}return d}function getPaddedBufferSize(h){return 4*Math.ceil(h/4)}function getPaddedArrayBuffer(h,o=0){const c=getPaddedBufferSize(h.byteLength);if(c!==h.byteLength){const d=new Uint8Array(c);if(d.set(new Uint8Array(h)),o!==0)for(let _=h.byteLength;_<c;_++)d[_]=o;return d.buffer}return h}function getCanvas(){return typeof document>"u"&&typeof OffscreenCanvas<"u"?new OffscreenCanvas(1,1):document.createElement("canvas")}function getToBlobPromise(h,o){if(h.toBlob!==void 0)return new Promise(d=>h.toBlob(d,o));let c;return o==="image/jpeg"?c=.92:o==="image/webp"&&(c=.8),h.convertToBlob({type:o,quality:c})}class GLTFWriter{constructor(){this.plugins=[],this.options={},this.pending=[],this.buffers=[],this.byteOffset=0,this.buffers=[],this.nodeMap=new Map,this.skins=[],this.extensionsUsed={},this.extensionsRequired={},this.uids=new Map,this.uid=0,this.json={asset:{version:"2.0",generator:"THREE.GLTFExporter"}},this.cache={meshes:new Map,attributes:new Map,attributesNormalized:new Map,materials:new Map,textures:new Map,images:new Map}}setPlugins(o){this.plugins=o}async write(o,c,d={}){this.options=Object.assign({binary:!1,trs:!1,onlyVisible:!0,maxTextureSize:1/0,animations:[],includeCustomExtensions:!1,ignoreInvalidMorphTargetTracks:!1,ignoreEmptyTextures:!1},d),this.options.animations.length>0&&(this.options.trs=!0),this.processInput(o),await Promise.all(this.pending);const _=this,v=_.buffers,b=_.json;d=_.options;const tt=_.extensionsUsed,it=_.extensionsRequired,nt=new Blob(v,{type:"application/octet-stream"}),lt=Object.keys(tt),ut=Object.keys(it);if(lt.length>0&&(b.extensionsUsed=lt),ut.length>0&&(b.extensionsRequired=ut),b.buffers&&b.buffers.length>0&&(b.buffers[0].byteLength=nt.size),d.binary===!0){const ht=new FileReader;ht.readAsArrayBuffer(nt),ht.onloadend=function(){const _t=getPaddedArrayBuffer(ht.result),ft=new DataView(new ArrayBuffer(GLB_CHUNK_PREFIX_BYTES));ft.setUint32(0,_t.byteLength,!0),ft.setUint32(4,GLB_CHUNK_TYPE_BIN,!0);const bt=getPaddedArrayBuffer(stringToArrayBuffer(JSON.stringify(b)),32),xt=new DataView(new ArrayBuffer(GLB_CHUNK_PREFIX_BYTES));xt.setUint32(0,bt.byteLength,!0),xt.setUint32(4,GLB_CHUNK_TYPE_JSON,!0);const St=new ArrayBuffer(GLB_HEADER_BYTES),wt=new DataView(St);wt.setUint32(0,GLB_HEADER_MAGIC,!0),wt.setUint32(4,GLB_VERSION,!0);const Pt=GLB_HEADER_BYTES+xt.byteLength+bt.byteLength+ft.byteLength+_t.byteLength;wt.setUint32(8,Pt,!0);const Rt=new Blob([St,xt,bt,ft,_t],{type:"application/octet-stream"}),kt=new FileReader;kt.readAsArrayBuffer(Rt),kt.onloadend=function(){c(kt.result)}}}else if(b.buffers&&b.buffers.length>0){const ht=new FileReader;ht.readAsDataURL(nt),ht.onloadend=function(){const _t=ht.result;b.buffers[0].uri=_t,c(b)}}else c(b)}serializeUserData(o,c){if(Object.keys(o.userData).length===0)return;const d=this.options,_=this.extensionsUsed;try{const v=JSON.parse(JSON.stringify(o.userData));if(d.includeCustomExtensions&&v.gltfExtensions){c.extensions===void 0&&(c.extensions={});for(const b in v.gltfExtensions)c.extensions[b]=v.gltfExtensions[b],_[b]=!0;delete v.gltfExtensions}Object.keys(v).length>0&&(c.extras=v)}catch(v){console.warn("THREE.GLTFExporter: userData of '"+o.name+"' won't be serialized because of JSON.stringify error - "+v.message),console.warn({...o.userData})}}getUID(o,c=!1){if(this.uids.has(o)===!1){const d=new Map;d.set(!0,this.uid++),d.set(!1,this.uid++),this.uids.set(o,d)}return this.uids.get(o).get(c)}isNormalizedNormalAttribute(o){if(this.cache.attributesNormalized.has(o))return!1;const c=new three_module.Pq0;for(let d=0,_=o.count;d<_;d++)if(Math.abs(c.fromBufferAttribute(o,d).length()-1)>5e-4)return!1;return!0}createNormalizedNormalAttribute(o){const c=this.cache;if(c.attributesNormalized.has(o))return c.attributesNormalized.get(o);const d=o.clone(),_=new three_module.Pq0;for(let v=0,b=d.count;v<b;v++)_.fromBufferAttribute(d,v),_.x===0&&_.y===0&&_.z===0?_.setX(1):_.normalize(),d.setXYZ(v,_.x,_.y,_.z);return c.attributesNormalized.set(o,d),d}applyTextureTransform(o,c){let d=!1;const _={};c.offset.x===0&&c.offset.y===0||(_.offset=c.offset.toArray(),d=!0),c.rotation!==0&&(_.rotation=c.rotation,d=!0),c.repeat.x===1&&c.repeat.y===1||(_.scale=c.repeat.toArray(),d=!0),d&&(o.extensions=o.extensions||{},o.extensions.KHR_texture_transform=_,this.extensionsUsed.KHR_texture_transform=!0)}buildMetalRoughTexture(o,c){if(o===c)return o;function d(ht){return ht.colorSpace===three_module.er$?function(_t){return _t<.04045?.0773993808*_t:Math.pow(.9478672986*_t+.0521327014,2.4)}:function(_t){return _t}}console.warn("THREE.GLTFExporter: Merged metalnessMap and roughnessMap textures."),o instanceof three_module.FvD&&(o=TextureUtils_decompress(o)),c instanceof three_module.FvD&&(c=TextureUtils_decompress(c));const _=o?o.image:null,v=c?c.image:null,b=Math.max(_?_.width:0,v?v.width:0),tt=Math.max(_?_.height:0,v?v.height:0),it=getCanvas();it.width=b,it.height=tt;const nt=it.getContext("2d");nt.fillStyle="#00ffff",nt.fillRect(0,0,b,tt);const lt=nt.getImageData(0,0,b,tt);if(_){nt.drawImage(_,0,0,b,tt);const ht=d(o),_t=nt.getImageData(0,0,b,tt).data;for(let ft=2;ft<_t.length;ft+=4)lt.data[ft]=256*ht(_t[ft]/256)}if(v){nt.drawImage(v,0,0,b,tt);const ht=d(c),_t=nt.getImageData(0,0,b,tt).data;for(let ft=1;ft<_t.length;ft+=4)lt.data[ft]=256*ht(_t[ft]/256)}nt.putImageData(lt,0,0);const ut=(o||c).clone();return ut.source=new three_module.kLi(it),ut.colorSpace=three_module.jf0,ut.channel=(o||c).channel,o&&c&&o.channel!==c.channel&&console.warn("THREE.GLTFExporter: UV channels for metalnessMap and roughnessMap textures must match."),ut}processBuffer(o){const c=this.json,d=this.buffers;return c.buffers||(c.buffers=[{byteLength:0}]),d.push(o),0}processBufferView(o,c,d,_,v){const b=this.json;let tt;switch(b.bufferViews||(b.bufferViews=[]),c){case GLTFExporter_WEBGL_CONSTANTS.BYTE:case GLTFExporter_WEBGL_CONSTANTS.UNSIGNED_BYTE:tt=1;break;case GLTFExporter_WEBGL_CONSTANTS.SHORT:case GLTFExporter_WEBGL_CONSTANTS.UNSIGNED_SHORT:tt=2;break;default:tt=4}const it=getPaddedBufferSize(_*o.itemSize*tt),nt=new DataView(new ArrayBuffer(it));let lt=0;for(let ht=d;ht<d+_;ht++)for(let _t=0;_t<o.itemSize;_t++){let ft;o.itemSize>4?ft=o.array[ht*o.itemSize+_t]:(_t===0?ft=o.getX(ht):_t===1?ft=o.getY(ht):_t===2?ft=o.getZ(ht):_t===3&&(ft=o.getW(ht)),o.normalized===!0&&(ft=three_module.cj9.normalize(ft,o.array))),c===GLTFExporter_WEBGL_CONSTANTS.FLOAT?nt.setFloat32(lt,ft,!0):c===GLTFExporter_WEBGL_CONSTANTS.INT?nt.setInt32(lt,ft,!0):c===GLTFExporter_WEBGL_CONSTANTS.UNSIGNED_INT?nt.setUint32(lt,ft,!0):c===GLTFExporter_WEBGL_CONSTANTS.SHORT?nt.setInt16(lt,ft,!0):c===GLTFExporter_WEBGL_CONSTANTS.UNSIGNED_SHORT?nt.setUint16(lt,ft,!0):c===GLTFExporter_WEBGL_CONSTANTS.BYTE?nt.setInt8(lt,ft):c===GLTFExporter_WEBGL_CONSTANTS.UNSIGNED_BYTE&&nt.setUint8(lt,ft),lt+=tt}const ut={buffer:this.processBuffer(nt.buffer),byteOffset:this.byteOffset,byteLength:it};return v!==void 0&&(ut.target=v),v===GLTFExporter_WEBGL_CONSTANTS.ARRAY_BUFFER&&(ut.byteStride=o.itemSize*tt),this.byteOffset+=it,b.bufferViews.push(ut),{id:b.bufferViews.length-1,byteLength:0}}processBufferViewImage(o){const c=this,d=c.json;return d.bufferViews||(d.bufferViews=[]),new Promise(function(_){const v=new FileReader;v.readAsArrayBuffer(o),v.onloadend=function(){const b=getPaddedArrayBuffer(v.result),tt={buffer:c.processBuffer(b),byteOffset:c.byteOffset,byteLength:b.byteLength};c.byteOffset+=b.byteLength,_(d.bufferViews.push(tt)-1)}})}processBufferViewImageBuffer(o){const c=this,d=c.json;d.bufferViews||(d.bufferViews=[]),o=getPaddedArrayBuffer(o);const _={buffer:c.processBuffer(o),byteOffset:c.byteOffset,byteLength:o.byteLength};return c.byteOffset+=o.byteLength,d.bufferViews.push(_)-1}processAccessor(o,c,d,_){const v=this.json;let b;if(o.array.constructor===Float32Array)b=GLTFExporter_WEBGL_CONSTANTS.FLOAT;else if(o.array.constructor===Int32Array)b=GLTFExporter_WEBGL_CONSTANTS.INT;else if(o.array.constructor===Uint32Array)b=GLTFExporter_WEBGL_CONSTANTS.UNSIGNED_INT;else if(o.array.constructor===Int16Array)b=GLTFExporter_WEBGL_CONSTANTS.SHORT;else if(o.array.constructor===Uint16Array)b=GLTFExporter_WEBGL_CONSTANTS.UNSIGNED_SHORT;else if(o.array.constructor===Int8Array)b=GLTFExporter_WEBGL_CONSTANTS.BYTE;else{if(o.array.constructor!==Uint8Array)throw new Error("THREE.GLTFExporter: Unsupported bufferAttribute component type: "+o.array.constructor.name);b=GLTFExporter_WEBGL_CONSTANTS.UNSIGNED_BYTE}if(d===void 0&&(d=0),_===void 0&&(_=o.count),_===0)return null;const tt=getMinMax(o,d,_);let it;c!==void 0&&(it=o===c.index?GLTFExporter_WEBGL_CONSTANTS.ELEMENT_ARRAY_BUFFER:GLTFExporter_WEBGL_CONSTANTS.ARRAY_BUFFER);const nt=this.processBufferView(o,b,d,_,it),lt={bufferView:nt.id,byteOffset:nt.byteOffset,componentType:b,count:_,max:tt.max,min:tt.min,type:{1:"SCALAR",2:"VEC2",3:"VEC3",4:"VEC4",9:"MAT3",16:"MAT4"}[o.itemSize]};return o.normalized===!0&&(lt.normalized=!0),v.accessors||(v.accessors=[]),v.accessors.push(lt)-1}processImage(o,c,d,_="image/png",v=void 0,b=void 0){if(o!==null){const tt=this,it=tt.cache,nt=tt.json,lt=tt.options,ut=tt.pending;it.images.has(o)||it.images.set(o,{});const ht=it.images.get(o),_t=_+":flipY/"+d.toString()+(v||b?";"+v+";"+b:"");if(ht[_t]!==void 0)return ht[_t];nt.images||(nt.images=[]);const ft={mimeType:_},bt=getCanvas();bt.width=Math.min(v||o.width,lt.maxTextureSize),bt.height=Math.min(b||o.height,lt.maxTextureSize);const xt=bt.getContext("2d");if(d===!0&&(xt.translate(0,bt.height),xt.scale(1,-1)),o.data!==void 0){c!==three_module.GWd&&console.error("GLTFExporter: Only RGBAFormat is supported.",c),(o.width>lt.maxTextureSize||o.height>lt.maxTextureSize)&&console.warn("GLTFExporter: Image size is bigger than maxTextureSize",o);const wt=new Uint8ClampedArray(o.height*o.width*4);for(let Pt=0;Pt<wt.length;Pt+=4)wt[Pt+0]=o.data[Pt+0],wt[Pt+1]=o.data[Pt+1],wt[Pt+2]=o.data[Pt+2],wt[Pt+3]=o.data[Pt+3];xt.putImageData(new ImageData(wt,o.width,o.height),0,0)}else xt.drawImage(o,0,0,bt.width,bt.height);lt.binary===!0?ut.push(getToBlobPromise(bt,_).then(wt=>tt.processBufferViewImage(wt)).then(wt=>{ft.bufferView=wt})):bt.toDataURL!==void 0?ft.uri=bt.toDataURL(_):ut.push(getToBlobPromise(bt,_).then(wt=>new FileReader().readAsDataURL(wt)).then(wt=>{ft.uri=wt}));const St=nt.images.push(ft)-1;return ht[_t]=St,St}throw new Error("THREE.GLTFExporter: No valid image data found. Unable to process texture.")}processSampler(o){const c=this.json;c.samplers||(c.samplers=[]);const d={magFilter:THREE_TO_WEBGL[o.magFilter],minFilter:THREE_TO_WEBGL[o.minFilter],wrapS:THREE_TO_WEBGL[o.wrapS],wrapT:THREE_TO_WEBGL[o.wrapT]};return c.samplers.push(d)-1}processTexture(o){const c=this.options,d=this.cache,_=this.json;if(d.textures.has(o))return d.textures.get(o);_.textures||(_.textures=[]),o instanceof three_module.FvD&&!o.source._canSerialize&&(o=TextureUtils_decompress(o,c.maxTextureSize));let v=o.userData.mimeType;v==="image/webp"&&(v="image/png"),v==="image/jpg"&&(v="image/jpeg");const b={sampler:this.processSampler(o),source:!v||["image/jpeg","image/png"].includes(v)?this.processImage(o.image,o.format,o.flipY,v):null};o.name&&(b.name=o.name),this._invokeAll(function(it){it.writeTexture&&it.writeTexture(o,b)}),b.source===null&&console.error("GLTFExporter: Unsupported mime type: "+v+". Cannot export texture.",o);const tt=_.textures.push(b)-1;return d.textures.set(o,tt),tt}processMaterial(o){const c=this.cache,d=this.json;if(c.materials.has(o))return c.materials.get(o);if(o.isShaderMaterial)return console.warn("GLTFExporter: THREE.ShaderMaterial not supported."),null;d.materials||(d.materials=[]);const _={pbrMetallicRoughness:{}};o.isMeshStandardMaterial!==!0&&o.isMeshBasicMaterial!==!0&&console.warn("GLTFExporter: Use MeshStandardMaterial or MeshBasicMaterial for best results.");const v=o.color.toArray().concat([o.opacity]);if(equalArray(v,[1,1,1,1])||(_.pbrMetallicRoughness.baseColorFactor=v),o.isMeshStandardMaterial?(_.pbrMetallicRoughness.metallicFactor=o.metalness,_.pbrMetallicRoughness.roughnessFactor=o.roughness):(_.pbrMetallicRoughness.metallicFactor=.5,_.pbrMetallicRoughness.roughnessFactor=.5),this.checkEmptyMap(o.metalnessMap)||this.checkEmptyMap(o.roughnessMap)){const tt=this.buildMetalRoughTexture(o.metalnessMap,o.roughnessMap),it={index:this.processTexture(tt),channel:tt.channel};this.applyTextureTransform(it,tt),_.pbrMetallicRoughness.metallicRoughnessTexture=it}if(this.checkEmptyMap(o.map)){const tt={index:this.processTexture(o.map),texCoord:o.map.channel};this.applyTextureTransform(tt,o.map),_.pbrMetallicRoughness.baseColorTexture=tt}if(o.emissive){const tt=o.emissive;if(Math.max(tt.r,tt.g,tt.b)>0&&(_.emissiveFactor=o.emissive.toArray()),this.checkEmptyMap(o.emissiveMap)){const it={index:this.processTexture(o.emissiveMap),texCoord:o.emissiveMap.channel};this.applyTextureTransform(it,o.emissiveMap),_.emissiveTexture=it}}if(this.checkEmptyMap(o.normalMap)){const tt={index:this.processTexture(o.normalMap),texCoord:o.normalMap.channel};o.normalScale&&o.normalScale.x!==1&&(tt.scale=o.normalScale.x),this.applyTextureTransform(tt,o.normalMap),_.normalTexture=tt}if(this.checkEmptyMap(o.aoMap)){const tt={index:this.processTexture(o.aoMap),texCoord:o.aoMap.channel};o.aoMapIntensity!==1&&(tt.strength=o.aoMapIntensity),this.applyTextureTransform(tt,o.aoMap),_.occlusionTexture=tt}o.transparent?_.alphaMode="BLEND":o.alphaTest>0&&(_.alphaMode="MASK",_.alphaCutoff=o.alphaTest),o.side===three_module.$EB&&(_.doubleSided=!0),o.name!==""&&(_.name=o.name),this.serializeUserData(o,_),this._invokeAll(function(tt){tt.writeMaterial&&tt.writeMaterial(o,_)});const b=d.materials.push(_)-1;return c.materials.set(o,b),b}processMesh(o){const c=this.cache,d=this.json,_=[o.geometry.uuid];if(Array.isArray(o.material))for(let Pt=0,Rt=o.material.length;Pt<Rt;Pt++)_.push(o.material[Pt].uuid);else _.push(o.material.uuid);const v=_.join(":");if(c.meshes.has(v))return c.meshes.get(v);const b=o.geometry;let tt;tt=o.isLineSegments?GLTFExporter_WEBGL_CONSTANTS.LINES:o.isLineLoop?GLTFExporter_WEBGL_CONSTANTS.LINE_LOOP:o.isLine?GLTFExporter_WEBGL_CONSTANTS.LINE_STRIP:o.isPoints?GLTFExporter_WEBGL_CONSTANTS.POINTS:o.material.wireframe?GLTFExporter_WEBGL_CONSTANTS.LINES:GLTFExporter_WEBGL_CONSTANTS.TRIANGLES;const it={},nt={},lt=[],ut=[],ht={uv:"TEXCOORD_0",uv1:"TEXCOORD_1",color:"COLOR_0",skinWeight:"WEIGHTS_0",skinIndex:"JOINTS_0"},_t=b.getAttribute("normal");_t===void 0||this.isNormalizedNormalAttribute(_t)||(console.warn("THREE.GLTFExporter: Creating normalized normal attribute from the non-normalized one."),b.setAttribute("normal",this.createNormalizedNormalAttribute(_t)));let ft=null;for(let Pt in b.attributes){if(Pt.slice(0,5)==="morph")continue;const Rt=b.attributes[Pt];if(Pt=ht[Pt]||Pt.toUpperCase(),/^(POSITION|NORMAL|TANGENT|TEXCOORD_\d+|COLOR_\d+|JOINTS_\d+|WEIGHTS_\d+)$/.test(Pt)||(Pt="_"+Pt),c.attributes.has(this.getUID(Rt))){nt[Pt]=c.attributes.get(this.getUID(Rt));continue}ft=null;const kt=Rt.array;Pt!=="JOINTS_0"||kt instanceof Uint16Array||kt instanceof Uint8Array||(console.warn('GLTFExporter: Attribute "skinIndex" converted to type UNSIGNED_SHORT.'),ft=new three_module.THS(new Uint16Array(kt),Rt.itemSize,Rt.normalized));const Gt=this.processAccessor(ft||Rt,b);Gt!==null&&(Pt.startsWith("_")||this.detectMeshQuantization(Pt,Rt),nt[Pt]=Gt,c.attributes.set(this.getUID(Rt),Gt))}if(_t!==void 0&&b.setAttribute("normal",_t),Object.keys(nt).length===0)return null;if(o.morphTargetInfluences!==void 0&&o.morphTargetInfluences.length>0){const Pt=[],Rt=[],kt={};if(o.morphTargetDictionary!==void 0)for(const Gt in o.morphTargetDictionary)kt[o.morphTargetDictionary[Gt]]=Gt;for(let Gt=0;Gt<o.morphTargetInfluences.length;++Gt){const Dt={};let It=!1;for(const Nt in b.morphAttributes){if(Nt!=="position"&&Nt!=="normal"){It||(console.warn("GLTFExporter: Only POSITION and NORMAL morph are supported."),It=!0);continue}const Vt=b.morphAttributes[Nt][Gt],Kt=Nt.toUpperCase(),Yt=b.attributes[Nt];if(c.attributes.has(this.getUID(Vt,!0))){Dt[Kt]=c.attributes.get(this.getUID(Vt,!0));continue}const nr=Vt.clone();if(!b.morphTargetsRelative)for(let rr=0,lr=Vt.count;rr<lr;rr++)for(let or=0;or<Vt.itemSize;or++)or===0&&nr.setX(rr,Vt.getX(rr)-Yt.getX(rr)),or===1&&nr.setY(rr,Vt.getY(rr)-Yt.getY(rr)),or===2&&nr.setZ(rr,Vt.getZ(rr)-Yt.getZ(rr)),or===3&&nr.setW(rr,Vt.getW(rr)-Yt.getW(rr));Dt[Kt]=this.processAccessor(nr,b),c.attributes.set(this.getUID(Yt,!0),Dt[Kt])}ut.push(Dt),Pt.push(o.morphTargetInfluences[Gt]),o.morphTargetDictionary!==void 0&&Rt.push(kt[Gt])}it.weights=Pt,Rt.length>0&&(it.extras={},it.extras.targetNames=Rt)}const bt=Array.isArray(o.material);if(bt&&b.groups.length===0)return null;const xt=bt?o.material:[o.material],St=bt?b.groups:[{materialIndex:0,start:void 0,count:void 0}];for(let Pt=0,Rt=St.length;Pt<Rt;Pt++){const kt={mode:tt,attributes:nt};if(this.serializeUserData(b,kt),ut.length>0&&(kt.targets=ut),b.index!==null){let Dt=this.getUID(b.index);St[Pt].start===void 0&&St[Pt].count===void 0||(Dt+=":"+St[Pt].start+":"+St[Pt].count),c.attributes.has(Dt)?kt.indices=c.attributes.get(Dt):(kt.indices=this.processAccessor(b.index,b,St[Pt].start,St[Pt].count),c.attributes.set(Dt,kt.indices)),kt.indices===null&&delete kt.indices}const Gt=this.processMaterial(xt[St[Pt].materialIndex]);Gt!==null&&(kt.material=Gt),lt.push(kt)}it.primitives=lt,d.meshes||(d.meshes=[]),this._invokeAll(function(Pt){Pt.writeMesh&&Pt.writeMesh(o,it)});const wt=d.meshes.push(it)-1;return c.meshes.set(v,wt),wt}detectMeshQuantization(o,c){if(this.extensionsUsed[KHR_MESH_QUANTIZATION])return;let d;switch(c.array.constructor){case Int8Array:d="byte";break;case Uint8Array:d="unsigned byte";break;case Int16Array:d="short";break;case Uint16Array:d="unsigned short";break;default:return}c.normalized&&(d+=" normalized");const _=o.split("_",1)[0];KHR_mesh_quantization_ExtraAttrTypes[_]&&KHR_mesh_quantization_ExtraAttrTypes[_].includes(d)&&(this.extensionsUsed[KHR_MESH_QUANTIZATION]=!0,this.extensionsRequired[KHR_MESH_QUANTIZATION]=!0)}processCamera(o){const c=this.json;c.cameras||(c.cameras=[]);const d=o.isOrthographicCamera,_={type:d?"orthographic":"perspective"};return d?_.orthographic={xmag:2*o.right,ymag:2*o.top,zfar:o.far<=0?.001:o.far,znear:o.near<0?0:o.near}:_.perspective={aspectRatio:o.aspect,yfov:three_module.cj9.degToRad(o.fov),zfar:o.far<=0?.001:o.far,znear:o.near<0?0:o.near},o.name!==""&&(_.name=o.type),c.cameras.push(_)-1}processAnimation(o,c){const d=this.json,_=this.nodeMap;d.animations||(d.animations=[]);try{o=GLTFExporter.Utils.mergeMorphTargetTracks(o.clone(),c)}catch(it){if(console.warn('THREE.GLTFExporter: Could not export animation clip "%s".',o.name),!this.options.ignoreInvalidMorphTargetTracks)throw it;return console.error(it),null}const v=o.tracks,b=[],tt=[];for(let it=0;it<v.length;++it){const nt=v[it],lt=three_module.Nwf.parseTrackName(nt.name);let ut=three_module.Nwf.findNode(c,lt.nodeName);const ht=GLTFExporter_PATH_PROPERTIES[lt.propertyName];if(lt.objectName==="bones"&&(ut=ut.isSkinnedMesh===!0?ut.skeleton.getBoneByName(lt.objectIndex):void 0),!ut||!ht)return console.warn('THREE.GLTFExporter: Could not export animation track "%s".',nt.name),null;const _t=1;let ft,bt=nt.values.length/nt.times.length;ht===GLTFExporter_PATH_PROPERTIES.morphTargetInfluences&&(bt/=ut.morphTargetInfluences.length),nt.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline===!0?(ft="CUBICSPLINE",bt/=3):ft=nt.getInterpolation()===three_module.ljd?"STEP":"LINEAR",tt.push({input:this.processAccessor(new three_module.THS(nt.times,_t)),output:this.processAccessor(new three_module.THS(nt.values,bt)),interpolation:ft}),b.push({sampler:tt.length-1,target:{node:_.get(ut),path:ht}})}return d.animations.push({name:o.name||"clip_"+d.animations.length,samplers:tt,channels:b}),d.animations.length-1}processSkin(o){const c=this.json,d=this.nodeMap,_=c.nodes[d.get(o)],v=o.skeleton;if(v===void 0)return null;const b=o.skeleton.bones[0];if(b===void 0)return null;const tt=[],it=new Float32Array(16*v.bones.length),nt=new three_module.kn4;for(let lt=0;lt<v.bones.length;++lt)tt.push(d.get(v.bones[lt])),nt.copy(v.boneInverses[lt]),nt.multiply(o.bindMatrix).toArray(it,16*lt);return c.skins===void 0&&(c.skins=[]),c.skins.push({inverseBindMatrices:this.processAccessor(new three_module.THS(it,16)),joints:tt,skeleton:d.get(b)}),_.skin=c.skins.length-1}processNode(o){const c=this.json,d=this.options,_=this.nodeMap;c.nodes||(c.nodes=[]);const v={};if(d.trs){const tt=o.quaternion.toArray(),it=o.position.toArray(),nt=o.scale.toArray();equalArray(tt,[0,0,0,1])||(v.rotation=tt),equalArray(it,[0,0,0])||(v.translation=it),equalArray(nt,[1,1,1])||(v.scale=nt)}else o.matrixAutoUpdate&&o.updateMatrix(),isIdentityMatrix(o.matrix)===!1&&(v.matrix=o.matrix.elements);if(o.name!==""&&(v.name=String(o.name)),this.serializeUserData(o,v),o.isMesh||o.isLine||o.isPoints){const tt=this.processMesh(o);tt!==null&&(v.mesh=tt)}else o.isCamera&&(v.camera=this.processCamera(o));if(o.isSkinnedMesh&&this.skins.push(o),o.children.length>0){const tt=[];for(let it=0,nt=o.children.length;it<nt;it++){const lt=o.children[it];if(lt.visible||d.onlyVisible===!1){const ut=this.processNode(lt);ut!==null&&tt.push(ut)}}tt.length>0&&(v.children=tt)}this._invokeAll(function(tt){tt.writeNode&&tt.writeNode(o,v)});const b=c.nodes.push(v)-1;return _.set(o,b),b}processScene(o){const c=this.json,d=this.options;c.scenes||(c.scenes=[],c.scene=0);const _={};o.name!==""&&(_.name=o.name),c.scenes.push(_);const v=[];for(let b=0,tt=o.children.length;b<tt;b++){const it=o.children[b];if(it.visible||d.onlyVisible===!1){const nt=this.processNode(it);nt!==null&&v.push(nt)}}v.length>0&&(_.nodes=v),this.serializeUserData(o,_)}processObjects(o){const c=new three_module.Z58;c.name="AuxScene";for(let d=0;d<o.length;d++)c.children.push(o[d]);this.processScene(c)}processInput(o){const c=this.options;o=o instanceof Array?o:[o],this._invokeAll(function(_){_.beforeParse&&_.beforeParse(o)});const d=[];for(let _=0;_<o.length;_++)o[_]instanceof three_module.Z58?this.processScene(o[_]):d.push(o[_]);d.length>0&&this.processObjects(d);for(let _=0;_<this.skins.length;++_)this.processSkin(this.skins[_]);for(let _=0;_<c.animations.length;++_)this.processAnimation(c.animations[_],o[0]);this._invokeAll(function(_){_.afterParse&&_.afterParse(o)})}_invokeAll(o){for(let c=0,d=this.plugins.length;c<d;c++)o(this.plugins[c])}checkEmptyMap(o){return!(!o||this.options.ignoreEmptyTextures&&!o.image)}}class GLTFLightExtension{constructor(o){this.writer=o,this.name="KHR_lights_punctual"}writeNode(o,c){if(!o.isLight)return;if(!o.isDirectionalLight&&!o.isPointLight&&!o.isSpotLight)return void console.warn("THREE.GLTFExporter: Only directional, point, and spot lights are supported.",o);const d=this.writer,_=d.json,v=d.extensionsUsed,b={};o.name&&(b.name=o.name),b.color=o.color.toArray(),b.intensity=o.intensity,o.isDirectionalLight?b.type="directional":o.isPointLight?(b.type="point",o.distance>0&&(b.range=o.distance)):o.isSpotLight&&(b.type="spot",o.distance>0&&(b.range=o.distance),b.spot={},b.spot.innerConeAngle=(1-o.penumbra)*o.angle,b.spot.outerConeAngle=o.angle),o.decay!==void 0&&o.decay!==2&&console.warn("THREE.GLTFExporter: Light decay may be lost. glTF is physically-based, and expects light.decay=2."),!o.target||o.target.parent===o&&o.target.position.x===0&&o.target.position.y===0&&o.target.position.z===-1||console.warn("THREE.GLTFExporter: Light direction may be lost. For best results, make light.target a child of the light with position 0,0,-1."),v[this.name]||(_.extensions=_.extensions||{},_.extensions[this.name]={lights:[]},v[this.name]=!0);const tt=_.extensions[this.name].lights;tt.push(b),c.extensions=c.extensions||{},c.extensions[this.name]={light:tt.length-1}}}class GLTFExporter_GLTFMaterialsUnlitExtension{constructor(o){this.writer=o,this.name="KHR_materials_unlit"}writeMaterial(o,c){if(!o.isMeshBasicMaterial)return;const d=this.writer.extensionsUsed;c.extensions=c.extensions||{},c.extensions[this.name]={},d[this.name]=!0,c.pbrMetallicRoughness.metallicFactor=0,c.pbrMetallicRoughness.roughnessFactor=.9}}class GLTFExporter_GLTFMaterialsClearcoatExtension{constructor(o){this.writer=o,this.name="KHR_materials_clearcoat"}writeMaterial(o,c){if(!o.isMeshPhysicalMaterial||o.clearcoat===0)return;const d=this.writer,_=d.extensionsUsed,v={};if(v.clearcoatFactor=o.clearcoat,d.checkEmptyMap(o.clearcoatMap)){const b={index:d.processTexture(o.clearcoatMap),texCoord:o.clearcoatMap.channel};d.applyTextureTransform(b,o.clearcoatMap),v.clearcoatTexture=b}if(v.clearcoatRoughnessFactor=o.clearcoatRoughness,d.checkEmptyMap(o.clearcoatRoughnessMap)){const b={index:d.processTexture(o.clearcoatRoughnessMap),texCoord:o.clearcoatRoughnessMap.channel};d.applyTextureTransform(b,o.clearcoatRoughnessMap),v.clearcoatRoughnessTexture=b}if(d.checkEmptyMap(o.clearcoatNormalMap)){const b={index:d.processTexture(o.clearcoatNormalMap),texCoord:o.clearcoatNormalMap.channel};d.applyTextureTransform(b,o.clearcoatNormalMap),v.clearcoatNormalTexture=b}c.extensions=c.extensions||{},c.extensions[this.name]=v,_[this.name]=!0}}class GLTFExporter_GLTFMaterialsIridescenceExtension{constructor(o){this.writer=o,this.name="KHR_materials_iridescence"}writeMaterial(o,c){if(!o.isMeshPhysicalMaterial||o.iridescence===0)return;const d=this.writer,_=d.extensionsUsed,v={};if(v.iridescenceFactor=o.iridescence,d.checkEmptyMap(o.iridescenceMap)){const b={index:d.processTexture(o.iridescenceMap),texCoord:o.iridescenceMap.channel};d.applyTextureTransform(b,o.iridescenceMap),v.iridescenceTexture=b}if(v.iridescenceIor=o.iridescenceIOR,v.iridescenceThicknessMinimum=o.iridescenceThicknessRange[0],v.iridescenceThicknessMaximum=o.iridescenceThicknessRange[1],d.checkEmptyMap(o.iridescenceThicknessMap)){const b={index:d.processTexture(o.iridescenceThicknessMap),texCoord:o.iridescenceThicknessMap.channel};d.applyTextureTransform(b,o.iridescenceThicknessMap),v.iridescenceThicknessTexture=b}c.extensions=c.extensions||{},c.extensions[this.name]=v,_[this.name]=!0}}class GLTFExporter_GLTFMaterialsTransmissionExtension{constructor(o){this.writer=o,this.name="KHR_materials_transmission"}writeMaterial(o,c){if(!o.isMeshPhysicalMaterial||o.transmission===0)return;const d=this.writer,_=d.extensionsUsed,v={};if(v.transmissionFactor=o.transmission,d.checkEmptyMap(o.transmissionMap)){const b={index:d.processTexture(o.transmissionMap),texCoord:o.transmissionMap.channel};d.applyTextureTransform(b,o.transmissionMap),v.transmissionTexture=b}c.extensions=c.extensions||{},c.extensions[this.name]=v,_[this.name]=!0}}class GLTFExporter_GLTFMaterialsVolumeExtension{constructor(o){this.writer=o,this.name="KHR_materials_volume"}writeMaterial(o,c){if(!o.isMeshPhysicalMaterial||o.transmission===0)return;const d=this.writer,_=d.extensionsUsed,v={};if(v.thicknessFactor=o.thickness,d.checkEmptyMap(o.thicknessMap)){const b={index:d.processTexture(o.thicknessMap),texCoord:o.thicknessMap.channel};d.applyTextureTransform(b,o.thicknessMap),v.thicknessTexture=b}v.attenuationDistance=o.attenuationDistance,v.attenuationColor=o.attenuationColor.toArray(),c.extensions=c.extensions||{},c.extensions[this.name]=v,_[this.name]=!0}}class GLTFExporter_GLTFMaterialsIorExtension{constructor(o){this.writer=o,this.name="KHR_materials_ior"}writeMaterial(o,c){if(!o.isMeshPhysicalMaterial||o.ior===1.5)return;const d=this.writer.extensionsUsed,_={};_.ior=o.ior,c.extensions=c.extensions||{},c.extensions[this.name]=_,d[this.name]=!0}}class GLTFExporter_GLTFMaterialsSpecularExtension{constructor(o){this.writer=o,this.name="KHR_materials_specular"}writeMaterial(o,c){if(!o.isMeshPhysicalMaterial||o.specularIntensity===1&&o.specularColor.equals(DEFAULT_SPECULAR_COLOR)&&!o.specularIntensityMap&&!o.specularColorTexture)return;const d=this.writer,_=d.extensionsUsed,v={};if(d.checkEmptyMap(o.specularIntensityMap)){const b={index:d.processTexture(o.specularIntensityMap),texCoord:o.specularIntensityMap.channel};d.applyTextureTransform(b,o.specularIntensityMap),v.specularTexture=b}if(d.checkEmptyMap(o.specularColorMap)){const b={index:d.processTexture(o.specularColorMap),texCoord:o.specularColorMap.channel};d.applyTextureTransform(b,o.specularColorMap),v.specularColorTexture=b}v.specularFactor=o.specularIntensity,v.specularColorFactor=o.specularColor.toArray(),c.extensions=c.extensions||{},c.extensions[this.name]=v,_[this.name]=!0}}class GLTFExporter_GLTFMaterialsSheenExtension{constructor(o){this.writer=o,this.name="KHR_materials_sheen"}writeMaterial(o,c){if(!o.isMeshPhysicalMaterial||o.sheen<.001)return;const d=this.writer,_=d.extensionsUsed,v={};if(d.checkEmptyMap(o.sheenRoughnessMap)){const b={index:d.processTexture(o.sheenRoughnessMap),texCoord:o.sheenRoughnessMap.channel};d.applyTextureTransform(b,o.sheenRoughnessMap),v.sheenRoughnessTexture=b}if(d.checkEmptyMap(o.sheenColorMap)){const b={index:d.processTexture(o.sheenColorMap),texCoord:o.sheenColorMap.channel};d.applyTextureTransform(b,o.sheenColorMap),v.sheenColorTexture=b}v.sheenRoughnessFactor=o.sheenRoughness,v.sheenColorFactor=o.sheenColor.toArray(),c.extensions=c.extensions||{},c.extensions[this.name]=v,c.extras=c.extras||{},c.extras.sheenFactor=o.sheen,_[this.name]=!0}}class GLTFExporter_GLTFMaterialsAnisotropyExtension{constructor(o){this.writer=o,this.name="KHR_materials_anisotropy"}writeMaterial(o,c){if(!o.isMeshPhysicalMaterial||o.anisotropy==0)return;const d=this.writer,_=d.extensionsUsed,v={};if(d.checkEmptyMap(o.anisotropyMap)){const b={index:d.processTexture(o.anisotropyMap)};d.applyTextureTransform(b,o.anisotropyMap),v.anisotropyTexture=b}v.anisotropyStrength=o.anisotropy,v.anisotropyRotation=o.anisotropyRotation,c.extensions=c.extensions||{},c.extensions[this.name]=v,_[this.name]=!0}}class GLTFExporter_GLTFMaterialsEmissiveStrengthExtension{constructor(o){this.writer=o,this.name="KHR_materials_emissive_strength"}writeMaterial(o,c){if(!o.isMeshStandardMaterial||o.emissiveIntensity===1)return;const d=this.writer.extensionsUsed,_={};_.emissiveStrength=o.emissiveIntensity,c.extensions=c.extensions||{},c.extensions[this.name]=_,d[this.name]=!0}}GLTFExporter.Utils={GLTFWriter,insertKeyframe:function(h,o){const c=h.getValueSize(),d=new h.TimeBufferType(h.times.length+1),_=new h.ValueBufferType(h.values.length+c),v=h.createInterpolant(new h.ValueBufferType(c));let b;if(h.times.length===0){d[0]=o;for(let tt=0;tt<c;tt++)_[tt]=0;b=0}else if(o<h.times[0]){if(Math.abs(h.times[0]-o)<.001)return 0;d[0]=o,d.set(h.times,1),_.set(v.evaluate(o),0),_.set(h.values,c),b=0}else if(o>h.times[h.times.length-1]){if(Math.abs(h.times[h.times.length-1]-o)<.001)return h.times.length-1;d[d.length-1]=o,d.set(h.times,0),_.set(h.values,0),_.set(v.evaluate(o),h.values.length),b=d.length-1}else for(let tt=0;tt<h.times.length;tt++){if(Math.abs(h.times[tt]-o)<.001)return tt;if(h.times[tt]<o&&h.times[tt+1]>o){d.set(h.times.slice(0,tt+1),0),d[tt+1]=o,d.set(h.times.slice(tt+1),tt+2),_.set(h.values.slice(0,(tt+1)*c),0),_.set(v.evaluate(o),(tt+1)*c),_.set(h.values.slice((tt+1)*c),(tt+2)*c),b=tt+1;break}}return h.times=d,h.values=_,b},mergeMorphTargetTracks:function(h,o){const c=[],d={},_=h.tracks;for(let v=0;v<_.length;++v){let b=_[v];const tt=three_module.Nwf.parseTrackName(b.name),it=three_module.Nwf.findNode(o,tt.nodeName);if(tt.propertyName!=="morphTargetInfluences"||tt.propertyIndex===void 0){c.push(b);continue}if(b.createInterpolant!==b.InterpolantFactoryMethodDiscrete&&b.createInterpolant!==b.InterpolantFactoryMethodLinear){if(b.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline)throw new Error("THREE.GLTFExporter: Cannot merge tracks with glTF CUBICSPLINE interpolation.");console.warn("THREE.GLTFExporter: Morph target interpolation mode not yet supported. Using LINEAR instead."),b=b.clone(),b.setInterpolation(three_module.PJ3)}const nt=it.morphTargetInfluences.length,lt=it.morphTargetDictionary[tt.propertyIndex];if(lt===void 0)throw new Error("THREE.GLTFExporter: Morph target name not found: "+tt.propertyIndex);let ut;if(d[it.uuid]===void 0){ut=b.clone();const _t=new ut.ValueBufferType(nt*ut.times.length);for(let ft=0;ft<ut.times.length;ft++)_t[ft*nt+lt]=ut.values[ft];ut.name=(tt.nodeName||"")+".morphTargetInfluences",ut.values=_t,d[it.uuid]=ut,c.push(ut);continue}const ht=b.createInterpolant(new b.ValueBufferType(1));ut=d[it.uuid];for(let _t=0;_t<ut.times.length;_t++)ut.values[_t*nt+lt]=ht.evaluate(ut.times[_t]);for(let _t=0;_t<b.times.length;_t++){const ft=this.insertKeyframe(ut,b.times[_t]);ut.values[ft*nt+lt]=b.values[_t]}}return h.tracks=c,h}};class GLTFWriter2 extends GLTFExporter.Utils.GLTFWriter{constructor(){super(...arguments),this._defaultMaterial=new three_module._4j}serializeUserData(o,c){const d=o.userData,_={};d.__disposed&&console.error("Serializing a disposed object",o),Object.entries(d).forEach(([b,tt])=>{(!tt||typeof tt=="function"||tt.isObject3D||tt.isTexture||tt.isMaterial||tt.assetType!=null||b.startsWith("_")||b!=="uuid"&&(iGeometryIgnoredUserData.includes(b)||iModelIgnoredUserData.includes(b)||iMaterialIgnoredUserData.includes(b)))&&(_[b]=tt,delete d[b])});const v=serializeObject(d,!1);Object.entries(_).forEach(([b,tt])=>{d[b]=tt,delete _[b]}),o.userData=v,super.serializeUserData(o,c),o.userData=d}processObjects(o){var c;o.length===1&&!((c=o[0])===null||c===void 0)&&c.userData.rootSceneModelRoot?this.processScene(o[0]):super.processObjects(o)}processMaterial(o){if(this.cache.materials.has(o))return this.cache.materials.get(o);let c=o;c&&!c.isShaderMaterial||(c=this._defaultMaterial);const d=super.processMaterial(c);if(d===null)return console.error("GLTFWriter2: Unexpected error: Failed to process material",o),null;if(!o||c===o)return d;const _=JSON.stringify(this.json.materials[d]),v=JSON.parse(_);this.serializeUserData(o,v),this._invokeAll(tt=>{tt.writeMaterial&&tt.writeMaterial(o,v)});const b=this.json.materials.push(v)-1;return this.cache.materials.set(o,b),b}processImageBlob(o,c){if(!o)return-1;const d=this.cache,_=this.options,v=this.pending,b=this.json,tt=c.image;d.images.has(tt)||d.images.set(tt,{});const it=d.images.get(tt),nt=o.type+":flipY/"+c.flipY.toString();if(it[nt]!==void 0)return it[nt];b.images||(b.images=[]);const lt={mimeType:o.type};_.binary===!0?v.push(new Promise(ht=>{this.processBufferViewImage(o).then(_t=>{lt.bufferView=_t,ht()})})):v.push(q$2(o).then(ht=>{lt.uri=ht}));const ut=b.images.push(lt)-1;return it[nt]=ut,ut}processSampler(o){return super.processSampler(o)}processTexture(o){const c=this.cache,d=this.json;if(c.textures.has(o))return c.textures.get(o);const _=o.source.data,v=o.userData.mimeType;o.userData.rootPath&&!this.options.embedUrlImages&&(o.userData.rootPath.startsWith("http")||o.userData.rootPath.startsWith("data:"))&&(o.source.data&&(!this.options.exporterOptions.embedUrlImagePreviews||o.isDataTexture?o.source.data=null:o.source.data._savePreview=!0),delete o.userData.mimeType);const b=super.processTexture(o),tt=d.textures[b];if(!tt)return console.error("No texture def",b,o),b;const it=d.images?d.images[tt.source]:null;if(it&&(it.extras||(it.extras={}),o.source&&(it.extras.uuid=o.source.uuid),it.extras.t_uuid=o.uuid),o.userData.rootPath&&!this.options.embedUrlImages&&(o.userData.rootPath.startsWith("http")||o.userData.rootPath.startsWith("data:"))){if(o.source.data?delete o.source.data._savePreview:o.source.data=_,o.userData.mimeType=v,!tt)return console.error("textureDef is null",b,o),b;if(tt.source>=0){const nt=this.json.images[tt.source];nt.uri?console.warn("GLTFWriter2: uri already set",nt.uri):(nt.uri=o.userData.rootPath,nt.mimeType=v,nt.extras||(nt.extras={}),nt.extras.flipY=o.flipY,nt.extras.uri=o.userData.rootPath)}else tt.source=this.processImageUri(o.image,o.userData.rootPath,o.flipY,v)}return tt.source<0&&(console.error("textureDef.source cannot be saved",tt,o),delete tt.source),b}processImage(o,c,d,_="image/png"){return o?super.processImage(o,c,d,_,o._savePreview?32:void 0,o._savePreview?32:void 0):-1}processImageUri(o,c,d,_="image/png"){const v=this.cache,b=this.json;v.images.has(o)||v.images.set(o,{});const tt=v.images.get(o),it=_+":flipY/"+d.toString();if(tt[it]!==void 0)return tt[it];b.images||(b.images=[]);const nt={mimeType:_,uri:c,extras:{flipY:d}},lt=b.images.push(nt)-1;return tt[it]=lt,lt}}async function setInnerHTMLWithScripts(h,o){var c;h.innerHTML=o;const d=h.getElementsByTagName("script");for(let _=0;_<d.length;_++){const v=d[_],b=cloneScriptTag(v);let tt=!1;await new Promise(it=>{b.onload=it,b.onerror=()=>{tt=!0,it(void 0)}}),tt||(c=v.parentNode)===null||c===void 0||c.replaceChild(b,v)}}function cloneScriptTag(h,o){(o=o??document.createElement("script")).type=h.type||"text/javascript",o.text=h.text;for(let c=0;c<h.attributes.length;c++){const d=h.attributes[c];o.setAttribute(d.name,d.value)}return o}function dom_getPaddedArrayBuffer(h,o=0){const c=dom_getPaddedBufferSize(h.byteLength);if(c!==h.byteLength){const d=new Uint8Array(c);if(d.set(new Uint8Array(h)),o!==0)for(let _=h.byteLength;_<c;_++)d[_]=o;return d.buffer}return h}function dom_getPaddedBufferSize(h){return 4*Math.ceil(h/4)}ArrayBuffer.prototype.slice||(ArrayBuffer.prototype.slice=function(h,o){const c=new Uint8Array(this);o==null&&(o=c.length);const d=new ArrayBuffer(o-(h||0)),_=new Uint8Array(d);for(let v=0;v<_.length;v++)_[v]=c[v+(h||0)];return d});const dom_GLB_HEADER_BYTES=12,dom_GLB_HEADER_MAGIC=1179937895,dom_GLB_VERSION=2,dom_GLB_CHUNK_PREFIX_BYTES=8,dom_GLB_CHUNK_TYPE_JSON=1313821514,dom_GLB_CHUNK_TYPE_BIN=5130562;function makeGLBFile(h,o){const c=dom_getPaddedArrayBuffer(h),d=new DataView(new ArrayBuffer(dom_GLB_CHUNK_PREFIX_BYTES));d.setUint32(0,c.byteLength,!0),d.setUint32(4,dom_GLB_CHUNK_TYPE_BIN,!0);const _=dom_getPaddedArrayBuffer(new TextEncoder().encode(JSON.stringify(o||{})).buffer,32),v=new DataView(new ArrayBuffer(dom_GLB_CHUNK_PREFIX_BYTES));v.setUint32(0,_.byteLength,!0),v.setUint32(4,dom_GLB_CHUNK_TYPE_JSON,!0);const b=new ArrayBuffer(dom_GLB_HEADER_BYTES),tt=new DataView(b);tt.setUint32(0,dom_GLB_HEADER_MAGIC,!0),tt.setUint32(4,dom_GLB_VERSION,!0);const it=dom_GLB_HEADER_BYTES+v.byteLength+_.byteLength+d.byteLength+c.byteLength;tt.setUint32(8,it,!0);const nt=new Blob([b,v,_,d,c],{type:"application/octet-stream"});return nt.ext="glb",nt}class GLTFExporter2 extends GLTFExporter{register(o){return super.register(o)}async parseAsync(o,c){var d;if(!o)throw new Error("No object to export");const _=o.__isGLTFOutput||!Array.isArray(o)&&!o.isObject3D?o:await new Promise((v,b)=>this.parse(o,v,b,c));if(_&&typeof _=="object"&&!_.byteLength)return new Blob([JSON.stringify(_,(v,b)=>v.startsWith("__")?void 0:b,(d=c.jsonSpaces)!==null&&d!==void 0?d:2)],{type:"model/gltf+json"});if(_){let v=null;return c.encrypt&&(!c.encryptKey&&window.prompt&&(c.encryptKey=window.prompt("GLTFEncryption: Enter encryption key")||""),c.encryptKey?v=makeGLBFile(await Te$1(new Uint8Array(_),c.encryptKey),{asset:{version:"2.0",generator:"WebGiGLBWrapper",encryption:{type:"aesgcm",version:1}}}):console.warn("WebGi GLTF Export: encryption key not provided, skipping encryption")),v||(v=new Blob([_],{type:"model/gltf+binary"})),v}throw new Error("GLTFExporter2.parse() failed")}parse(o,c,d,_={}){var v,b,tt,it,nt,lt,ut;const ht={binary:!1,trs:(v=_.trs)!==null&&v!==void 0&&v,onlyVisible:(b=_.onlyVisible)!==null&&b!==void 0&&b,truncateDrawRange:(tt=_.truncateDrawRange)===null||tt===void 0||tt,externalImagesInExtras:!_.embedUrlImages&&_.externalImagesInExtras||!1,embedUrlImages:(it=_.embedUrlImages)!==null&&it!==void 0&&it,maxTextureSize:(nt=_.maxTextureSize)!==null&&nt!==void 0?nt:1/0,animations:(lt=_.animations)!==null&&lt!==void 0?lt:[],includeCustomExtensions:(ut=_.includeCustomExtensions)===null||ut===void 0||ut,exporterOptions:_,ignoreInvalidMorphTargetTracks:_.ignoreInvalidMorphTargetTracks,ignoreEmptyTextures:_.ignoreEmptyTextures};return _.exportExt==="glb"&&(ht.binary=!0),_.preserveUUIDs!==!1&&(Array.isArray(o)?o:[o]).forEach(_t=>_t.traverse(ft=>{ft.uuid&&(ft.userData.gltfUUID=ft.uuid)})),(Array.isArray(o)?o:[o]).forEach(_t=>_t.traverse(ft=>{if(ft.animations)for(const bt of ft.animations)bt.__gltfExport===!1||ht.animations.includes(bt)||ht.animations.push(...ft.animations)})),super.parse(o,_t=>{_.preserveUUIDs!==!1&&(Array.isArray(o)?o:[o]).forEach(ft=>ft.traverse(bt=>{delete bt.userData.gltfUUID})),c(Object.assign(_t,{__isGLTFOutput:!0}))},d,ht,new GLTFWriter2)}}function processViewer(h,o){const c=h.getPlugin(AssetManagerPlugin).exportViewerConfig();o.json.textures&&o.json.samplers&&o.json.images&&c.resources.textures&&[...Object.entries(c.resources.textures)].forEach(([_,v])=>{o.json.textures.find(b=>{var tt,it,nt,lt,ut;return((tt=b.extras)===null||tt===void 0?void 0:tt.uuid)===_||((nt=(it=o.json.samplers[b.sampler])===null||it===void 0?void 0:it.extras)===null||nt===void 0?void 0:nt.uuid)===_||((ut=(lt=o.json.images[b.source])===null||lt===void 0?void 0:lt.extras)===null||ut===void 0?void 0:ut.t_uuid)===_})&&(v.image&&c.resources.images&&c.resources.images[v.image]&&delete c.resources.images[v.image],c.resources.textures[_]={})}),o.json.materials&&c.resources.materials&&[...Object.entries(c.resources.materials)].forEach(([_,v])=>{o.json.materials.find(b=>{var tt;return((tt=b.extras)===null||tt===void 0?void 0:tt.uuid)===_})&&(c.resources.materials[_]={})});const d=[];Object.values(c.resources).forEach(_=>{_&&Object.values(_).forEach(v=>{v.url&&(v.url.type==="Uint16Array"&&v.url.data?(v.url.data instanceof Uint16Array||(v.url.data=new Uint16Array(v.url.data)),d.push(v.url)):v.url.type==="Uint8Array"&&v.url.data&&(v.url.data instanceof Uint8Array||(v.url.data=new Uint8Array(v.url.data)),d.push(v.url)))})});for(const _ of d){let v="application/octet-stream";if(_.mimeType&&(v=_.mimeType),o.options.exporterOptions.encodeUint16Rgbe&&_.type==="Uint16Array"&&_.width>0&&_.height>0){const nt=halfFloatToRgbe(_.data,4),lt=new ImageData(nt,_.width,_.height),ut=three_module.HgN.getDataURL(lt,!0).split(",")[1],ht=2;v="image/png",_.data=Uint8Array.from(atob(ut),_t=>_t.charCodeAt(0)),_.encoding="rgbe",_.encodingVersion=ht}o.json.images||(o.json.images=[]);const b={mimeType:v},tt=o.json.images.push(b)-1,it=_.data;b.bufferView=o.processBufferViewImageBuffer(it),_.data={image:tt}}return c}function halfFloatToRgbe(h,o=3,c){let d,_,v,b,tt;const it=h.byteLength/(2*o)|0;c=c||new Uint8ClampedArray(4*it);for(let nt=0;nt<it;nt++){d=h[nt*o],_=h[nt*o+1],v=h[nt*o+2],b=Math.max(Math.max(d,_),v);const lt=Math.ceil(Math.log2(b));tt=Math.pow(2,lt-8),c[4*nt]=d/tt|0,c[4*nt+1]=_/tt|0,c[4*nt+2]=v/tt|0,c[4*nt+3]=lt+128}return c}function addGLTFExporter(h,o,c=GLTFExporter2,d){var _;if(!o)return;const v=h.Exporters.findIndex(tt=>tt.ext.includes("gltf")||tt.ext.includes("glb")),b=[];v>=0?(b.push(...(_=h.Exporters[v].extensions)!==null&&_!==void 0?_:[]),h.Exporters.splice(v,1)):(b.push(gltfMaterialExtrasWriter),b.push(gltfObject3DExtrasWriter),b.push(gltfLightExtrasWriter),b.push(tt=>new GLTFMeshGpuInstancingExporter(tt)),b.push(tt=>new GLTFMaterialsBumpMapExtensionExport(tt)),b.push(tt=>new GLTFMaterialsDisplacementMapExtensionExport(tt)),b.push(tt=>new GLTFMaterialsLightMapExtensionExport(tt)),b.push(tt=>new GLTFMaterialsAlphaMapExtensionExport(tt))),h.Exporters.push({ctor:()=>{const tt=new c;return b.forEach(it=>tt.register(it)),tt.register(it=>({afterParse:nt=>{var lt,ut;if(!(!((lt=(nt=Array.isArray(nt)?nt[0]:nt)==null?void 0:nt.userData)===null||lt===void 0)&&lt.rootSceneModelRoot)||((ut=nt==null?void 0:nt.userData)===null||ut===void 0?void 0:ut.__exportViewerConfig)===!1)return;const ht=it.json.scenes[it.json.scene||0];ht.extensions||(ht.extensions={}),ht.extensions[viewerGLTFExtension]=processViewer(o,it),it.extensionsUsed[viewerGLTFExtension]=!0}})),d==null||d(tt),tt},ext:["gltf","glb"],extensions:b})}const gltfLightExtrasWriter=h=>({writeNode:(o,c)=>{if(!(o!=null&&o.isLight))return;c.extensions||(c.extensions={});const d={};o.shadow&&(d.shadow=o.shadow.toJSON()),Object.keys(d).length>0&&(c.extensions[webgiLightExtrasExtension]=d,h.extensionsUsed[webgiLightExtrasExtension]=!0)}}),gltfObject3DExtrasWriter=h=>({writeNode:(o,c)=>{if(!(o!=null&&o.isObject3D))return;c.extensions||(c.extensions={});const d={};o.castShadow!==void 0&&(d.castShadow=o.castShadow),o.receiveShadow!==void 0&&(d.receiveShadow=o.receiveShadow),o.visible===!1&&(d.visible=!1),o.frustumCulled===!1&&(d.frustumCulled=!1),o.renderOrder!==0&&(d.renderOrder=o.renderOrder),o.layers.mask!==1&&(d.layers=o.layers.mask),o.matrixAutoUpdate===!1&&(d.matrixAutoUpdate=!1),Object.keys(d).length>0&&(c.extensions[webgiObject3DExtrasExtension]=d,h.extensionsUsed[webgiObject3DExtrasExtension]=!0)}}),gltfMaterialExtrasWriter=h=>({writeMaterial(o,c){if(!(o!=null&&o.isMaterial))return;c.extensions||(c.extensions={});const d={};o.fog!==void 0&&(d.fog=o.fog),o.flatShading!==void 0&&(d.flatShading=o.flatShading),o.blending!==void 0&&(d.blending=o.blending),o.side!==void 0&&o.side!==three_module.$EB&&(d.side=o.side),o.shadowSide!==void 0&&(d.shadowSide=o.shadowSide),o.depthFunc!==void 0&&(d.depthFunc=o.depthFunc),o.depthTest!==void 0&&(d.depthTest=o.depthTest),o.depthWrite!==void 0&&(d.depthWrite=o.depthWrite),o.colorWrite!==void 0&&(d.colorWrite=o.colorWrite),o.vertexColors!==void 0&&(d.vertexColors=o.vertexColors),o.alphaTest!==void 0&&(d.alphaTest=o.alphaTest),o.alphaHash!==void 0&&(d.alphaHash=o.alphaHash),o.envMapIntensity!==void 0&&(d.envMapIntensity=o.envMapIntensity),o.wireframe!==void 0&&(d.wireframe=o.wireframe),o.wireframeLinewidth!==void 0&&(d.wireframeLinewidth=o.wireframeLinewidth),o.wireframeLinecap!==void 0&&(d.wireframeLinecap=o.wireframeLinecap),o.wireframeLinejoin!==void 0&&(d.wireframeLinejoin=o.wireframeLinejoin),o.rotation!==void 0&&(d.rotation=o.rotation),o.polygonOffset!==void 0&&(d.polygonOffset=o.polygonOffset),o.polygonOffsetFactor!==void 0&&(d.polygonOffsetFactor=o.polygonOffsetFactor),o.polygonOffsetUnits!==void 0&&(d.polygonOffsetUnits=o.polygonOffsetUnits),o.dithering!==void 0&&(d.dithering=o.dithering),o.alphaToCoverage!==void 0&&(d.alphaToCoverage=o.alphaToCoverage),o.premultipliedAlpha!==void 0&&(d.premultipliedAlpha=o.premultipliedAlpha),o.toneMapped!==void 0&&(d.toneMapped=o.toneMapped),o.normalScale!==void 0&&(d.normalScale=[o.normalScale.x,o.normalScale.y]);const _=this.materialExternalResources[o.uuid];_&&Object.entries(_).forEach(([v,b])=>{var tt;v.startsWith("_")||(b!=null&&b.userData&&(b.userData.__embedUrlImagePreviews=(tt=h.options.exporterOptions)===null||tt===void 0?void 0:tt.embedUrlImagePreviews),d[v]=serializeObject(b,!1,this.serializedMeta),b!=null&&b.userData&&delete b.userData.__embedUrlImagePreviews)}),Object.keys(d).length>0&&(c.extensions[webgiMaterialExtrasExtension]=d,h.extensionsUsed[webgiMaterialExtrasExtension]=!0)},materialExternalResources:{},serializedMeta:{images:{},textures:{}},beforeParse(o){if(this.materialExternalResources={},!h.options.externalImagesInExtras)return;const c=[];(Array.isArray(o)?o:[o]).forEach(d=>{d==null||d.traverse(_=>{var v;_&&!((v=_.material)===null||v===void 0)&&v.isMaterial&&c.push(_.material)})}),c.forEach(d=>{d&&(this.materialExternalResources[d.uuid]||(this.materialExternalResources[d.uuid]={}),this.materialExternalResources[d.uuid].__materialRef=d,Object.entries(d).forEach(([_,v])=>{_.startsWith("_")||v&&v.isTexture&&v.userData.rootPath&&(v.userData.rootPath.startsWith("http")||v.userData.rootPath.startsWith("data:"))&&(d[_]=null,this.materialExternalResources[d.uuid][_]=v)}))})},afterParse(o){const c=Object.values(this.materialExternalResources);if(c.length<1)return;c.forEach(_=>{const v=_.__materialRef;v&&(Object.entries(_).forEach(([b,tt])=>{b.startsWith("_")||tt&&(v[b]=tt)}),delete this.materialExternalResources[v.uuid])});const d=h.json.scenes[h.json.scene||0];d.extensions||(d.extensions={}),d.extensions[webgiMaterialExtrasExtension]={resources:this.serializedMeta},h.extensionsUsed[webgiMaterialExtrasExtension]=!0}});class GLTFMaterialsBumpMapExtensionExport{constructor(o){this.writer=o,this.name=GLTFMaterialsBumpMapExtensionName}writeMaterial(o,c){if(!o.isMeshStandardMaterial||o.bumpScale===0)return;const d=this.writer,_=d.extensionsUsed,v={};if(v.bumpScale=o.bumpScale,o.bumpMap&&d.checkEmptyMap(o.bumpMap)){const b={index:d.processTexture(o.bumpMap)};d.applyTextureTransform(b,o.bumpMap),v.bumpTexture=b}c.extensions=c.extensions||{},c.extensions[this.name]=v,_[this.name]=!0}}class GLTFMaterialsDisplacementMapExtensionExport{constructor(o){this.writer=o,this.name=GLTFMaterialsDisplacementMapExtensionName}writeMaterial(o,c){if(!o.isMeshStandardMaterial||o.displacementScale===0)return;const d=this.writer,_=d.extensionsUsed,v={};if(v.displacementScale=o.displacementScale,v.displacementBias=o.displacementBias,o.displacementMap&&d.checkEmptyMap(o.displacementMap)){const b={index:d.processTexture(o.displacementMap)};d.applyTextureTransform(b,o.displacementMap),v.displacementTexture=b}c.extensions=c.extensions||{},c.extensions[this.name]=v,_[this.name]=!0}}class GLTFMaterialsLightMapExtensionExport{constructor(o){this.writer=o,this.name=GLTFMaterialsLightMapExtensionName}writeMaterial(o,c){if(!o.isMeshStandardMaterial||o.lightMapIntensity===0)return;const d=this.writer,_=d.extensionsUsed,v={};if(v.lightMapIntensity=o.lightMapIntensity,o.lightMap&&d.checkEmptyMap(o.lightMap)){const b={index:d.processTexture(o.lightMap)};d.applyTextureTransform(b,o.lightMap),v.lightMapTexture=b}c.extensions=c.extensions||{},c.extensions[this.name]=v,_[this.name]=!0}}class GLTFMaterialsAlphaMapExtensionExport{constructor(o){this.writer=o,this.name=GLTFMaterialsAlphaMapExtensionName}writeMaterial(o,c){if(!o.isMeshStandardMaterial||!o.alphaMap)return;const d=this.writer,_=d.extensionsUsed,v={};if(d.checkEmptyMap(o.alphaMap)){const b={index:d.processTexture(o.alphaMap)};d.applyTextureTransform(b,o.alphaMap),v.alphaTexture=b}c.extensions=c.extensions||{},c.extensions[this.name]=v,_[this.name]=!0}}const textEncoder=new TextEncoder,ZIP_COMPRESSION=3;class EXRExporter{parse(o,c,d){if(!o||!o.isWebGLRenderer&&!o.isDataTexture)throw Error("EXRExporter.parse: Unsupported first parameter, expected instance of WebGLRenderer or DataTexture.");if(o.isWebGLRenderer){const _=o,v=c,b=d;supportedRTT(v);const tt=buildInfoRTT(v,b);return fillData(compressData(reorganizeDataBuffer(getPixelData(_,v,tt),tt),tt),tt)}if(o.isDataTexture){const _=o,v=c;supportedDT(_);const b=buildInfoDT(_,v);return fillData(compressData(reorganizeDataBuffer(_.image.data,b),b),b)}}}function supportedRTT(h){if(!h||!h.isWebGLRenderTarget)throw Error("EXRExporter.parse: Unsupported second parameter, expected instance of WebGLRenderTarget.");if(h.isWebGLCubeRenderTarget||h.isWebGL3DRenderTarget||h.isWebGLArrayRenderTarget)throw Error("EXRExporter.parse: Unsupported render target type, expected instance of WebGLRenderTarget.");if(h.texture.type!==three_module.RQf&&h.texture.type!==three_module.ix0)throw Error("EXRExporter.parse: Unsupported WebGLRenderTarget texture type.");if(h.texture.format!==three_module.GWd)throw Error("EXRExporter.parse: Unsupported WebGLRenderTarget texture format, expected RGBAFormat.")}function supportedDT(h){if(h.type!==three_module.RQf&&h.type!==three_module.ix0)throw Error("EXRExporter.parse: Unsupported DataTexture texture type.");if(h.format!==three_module.GWd)throw Error("EXRExporter.parse: Unsupported DataTexture texture format, expected RGBAFormat.");if(!h.image.data)throw Error("EXRExporter.parse: Invalid DataTexture image data.");if(h.type===three_module.RQf&&h.image.data.constructor.name!=="Float32Array")throw Error("EXRExporter.parse: DataTexture image data doesn't match type, expected 'Float32Array'.");if(h.type===three_module.ix0&&h.image.data.constructor.name!=="Uint16Array")throw Error("EXRExporter.parse: DataTexture image data doesn't match type, expected 'Uint16Array'.")}function buildInfoRTT(h,o={}){const c=h.width,d=h.height,_=h.texture.type,v=h.texture.format,b=(texture.colorSpace,o.compression!==void 0?o.compression:ZIP_COMPRESSION),tt=(o.type!==void 0?o.type:three_module.ix0)===three_module.RQf?2:1,it={0:1,2:1,3:16}[b];return{width:c,height:d,type:_,format:v,compression:b,blockLines:it,dataType:tt,dataSize:2*tt,numBlocks:Math.ceil(d/it),numInputChannels:4,numOutputChannels:4,textureIndex:o.textureIndex||0}}function buildInfoDT(h,o={}){const c=h.image.width,d=h.image.height,_=h.type,v=h.format,b=h.colorSpace,tt=o.compression!==void 0?o.compression:ZIP_COMPRESSION,it=(o.type!==void 0?o.type:three_module.ix0)===three_module.RQf?2:1,nt={0:1,2:1,3:16}[tt];return{width:c,height:d,type:_,format:v,colorSpace:b,compression:tt,blockLines:nt,dataType:it,dataSize:2*it,numBlocks:Math.ceil(d/nt),numInputChannels:4,numOutputChannels:4,flipY:h.isDataTexture&&h.flipY,textureIndex:o.textureIndex||0}}function getPixelData(h,o,c){let d;return d=c.type===three_module.RQf?new Float32Array(c.width*c.height*c.numInputChannels):new Uint16Array(c.width*c.height*c.numInputChannels),h.readRenderTargetPixels(o,0,0,c.width,c.height,d,void 0,c.textureIndex),d}function reorganizeDataBuffer(h,o){const c=o.width,d=o.height,_={r:0,g:0,b:0,a:0},v={value:0},b=o.numOutputChannels==4?1:0,tt=o.type==three_module.RQf?getFloat32:getFloat16,it=o.dataType==1?setFloat16:setFloat32,nt=new Uint8Array(o.width*o.height*o.numOutputChannels*o.dataSize),lt=new DataView(nt.buffer);for(let ut=0;ut<d;++ut)for(let ht=0;ht<c;++ht){const _t=ut*c*4+4*ht,ft=tt(h,_t),bt=tt(h,_t+1),xt=tt(h,_t+2),St=tt(h,_t+3),wt=(o.flipY?ut:d-ut-1)*c*(3+b)*o.dataSize;decodeLinear(_,ft,bt,xt,St),v.value=wt+ht*o.dataSize,it(lt,_.a,v),v.value=wt+b*c*o.dataSize+ht*o.dataSize,it(lt,_.b,v),v.value=wt+(1+b)*c*o.dataSize+ht*o.dataSize,it(lt,_.g,v),v.value=wt+(2+b)*c*o.dataSize+ht*o.dataSize,it(lt,_.r,v)}return nt}function compressData(h,o){let c,d,_=0;const v={data:new Array,totalSize:0},b=o.width*o.numOutputChannels*o.blockLines*o.dataSize;switch(o.compression){case 0:c=compressNONE;break;case 2:case 3:c=compressZIP}o.compression!==0&&(d=new Uint8Array(b));for(let tt=0;tt<o.numBlocks;++tt){const it=c(h.subarray(b*tt,b*(tt+1)),d);_+=it.length,v.data.push({dataChunk:it,size:it.length})}return v.totalSize=_,v}function compressNONE(h){return h}function compressZIP(h,o){let c=0,d=Math.floor((h.length+1)/2),_=0;const v=h.length-1;for(;!(_>v||(o[c++]=h[_++],_>v));)o[d++]=h[_++];let b=o[0];for(let tt=1;tt<o.length;tt++){const it=o[tt]-b+384;b=o[tt],o[tt]=it}return fflate_module_zlibSync(o)}function fillHeader(h,o,c){const d={value:0},_=new DataView(h.buffer);setUint32(_,20000630,d),setUint32(_,2,d),setString(_,"compression",d),setString(_,"compression",d),setUint32(_,1,d),setUint8(_,c.compression,d),setString(_,"screenWindowCenter",d),setString(_,"v2f",d),setUint32(_,8,d),setUint32(_,0,d),setUint32(_,0,d),setString(_,"screenWindowWidth",d),setString(_,"float",d),setUint32(_,4,d),setFloat32(_,1,d),setString(_,"pixelAspectRatio",d),setString(_,"float",d),setUint32(_,4,d),setFloat32(_,1,d),setString(_,"lineOrder",d),setString(_,"lineOrder",d),setUint32(_,1,d),setUint8(_,0,d),setString(_,"dataWindow",d),setString(_,"box2i",d),setUint32(_,16,d),setUint32(_,0,d),setUint32(_,0,d),setUint32(_,c.width-1,d),setUint32(_,c.height-1,d),setString(_,"displayWindow",d),setString(_,"box2i",d),setUint32(_,16,d),setUint32(_,0,d),setUint32(_,0,d),setUint32(_,c.width-1,d),setUint32(_,c.height-1,d),setString(_,"channels",d),setString(_,"chlist",d),setUint32(_,18*c.numOutputChannels+1,d),setString(_,"A",d),setUint32(_,c.dataType,d),d.value+=4,setUint32(_,1,d),setUint32(_,1,d),setString(_,"B",d),setUint32(_,c.dataType,d),d.value+=4,setUint32(_,1,d),setUint32(_,1,d),setString(_,"G",d),setUint32(_,c.dataType,d),d.value+=4,setUint32(_,1,d),setUint32(_,1,d),setString(_,"R",d),setUint32(_,c.dataType,d),d.value+=4,setUint32(_,1,d),setUint32(_,1,d),setUint8(_,0,d),setUint8(_,0,d);let v=d.value+8*c.numBlocks;for(let b=0;b<o.data.length;++b)setUint64(_,v,d),v+=o.data[b].size+8}function fillData(h,o){const c=8*o.numBlocks,d=259+18*o.numOutputChannels,_={value:d+c},v=new Uint8Array(d+c+h.totalSize+8*o.numBlocks),b=new DataView(v.buffer);fillHeader(v,h,o);for(let tt=0;tt<h.data.length;++tt){const it=h.data[tt].dataChunk,nt=h.data[tt].size;setUint32(b,tt*o.blockLines,_),setUint32(b,nt,_),v.set(it,_.value),_.value+=nt}return v}function decodeLinear(h,o,c,d,_){h.r=o,h.g=c,h.b=d,h.a=_}function setUint8(h,o,c){h.setUint8(c.value,o),c.value+=1}function setUint32(h,o,c){h.setUint32(c.value,o,!0),c.value+=4}function setFloat16(h,o,c){h.setUint16(c.value,three_module.GxU.toHalfFloat(o),!0),c.value+=2}function setFloat32(h,o,c){h.setFloat32(c.value,o,!0),c.value+=4}function setUint64(h,o,c){h.setBigUint64(c.value,BigInt(o),!0),c.value+=8}function setString(h,o,c){const d=textEncoder.encode(o+"\0");for(let _=0;_<d.length;++_)setUint8(h,d[_],c)}function decodeFloat16(h){const o=(31744&h)>>10,c=1023&h;return(h>>15?-1:1)*(o?o===31?c?NaN:1/0:Math.pow(2,o-15)*(1+c/1024):c/1024*6103515625e-14)}function getFloat16(h,o){return decodeFloat16(h[o])}function getFloat32(h,o){return h[o]}class EXRExporter2 extends EXRExporter{async parseAsync(o,c){const d=o;if(d.isWebGLRenderTarget&&!o.renderer)throw new Error("No renderManager on renderTarget");if(!d.isWebGLRenderTarget&&!o.isDataTexture)throw new Error("Invalid object type");d.isWebGLMultipleRenderTargets&&c.textureIndex===void 0&&console.warn("No textureIndex specified for WebGLMultipleRenderTargets");const _=d.isWebGLRenderTarget?this.parse(o.renderer.rendererObject,d,c):this.parse(o,c);return new Blob([_],{type:"image/x-exr"})}}class AssetExporter extends I$2{get processors(){return this._processors}getExporter(...o){return this.Exporters.find(c=>c.ext.some(d=>o.includes(d)))}constructor(o,c={}){super(),this._processors=new ObjectProcessorMap,this.Exporters=[{ctor:()=>new SimpleJSONExporter,ext:["json"]},{ctor:()=>new SimpleTextExporter,ext:["txt","text"]},{ctor:()=>new EXRExporter2,ext:["exr"]}],this._cachedParsers=[],addGLTFExporter(this,o)}async exportObject(o,c={}){var d,_;if(!(o!=null&&o.assetType))return void console.error("Object has no asset type");!((d=o==null?void 0:o.userData)===null||d===void 0)&&d.rootSceneModelRoot&&c.viewerConfig===!1&&(o.userData.__exportViewerConfig=!1);const v=[];o.assetType==="model"&&o.modelObject.traverse(tt=>{tt.userData.excludeFromExport&&tt.visible&&(tt.visible=!1,v.push(tt))});const b=await this._exportFile(o,c);return o.assetType==="model"&&v.forEach(tt=>tt.visible=!0),!((_=o==null?void 0:o.userData)===null||_===void 0)&&_.rootSceneModelRoot&&c.viewerConfig===!1&&delete o.userData.__exportViewerConfig,b}async _exportFile(o,c={}){var d,_,v;let b;this.dispatchEvent({type:"exportFile",obj:o,state:"processing"});try{const tt=await this.processBeforeExport(o,c),it=(_=(d=c.exportExt)!==null&&d!==void 0?d:tt==null?void 0:tt.typeExt)!==null&&_!==void 0?_:tt==null?void 0:tt.ext;if(!tt||!it)throw new Error(`Unable to preprocess before export ${it}`);const nt=this._getParser(it);this.dispatchEvent({type:"exportFile",obj:o,state:"exporting"});const lt=await nt.parseAsync(tt.obj,{exportExt:(v=tt.ext)!==null&&v!==void 0?v:it,...c});lt.ext=tt.ext,b=lt}catch(tt){return console.error("AssetExporter: Unable to Export file",o),console.error(tt),void this.dispatchEvent({type:"exportFile",obj:o,state:"error",error:tt})}return this.dispatchEvent({type:"exportFile",obj:o,state:"done"}),b}_createParser(o){const c=this.Exporters.find(_=>_.ext.includes(o));if(!c)throw new Error(`No exporter found for extension ${o}`);const d=c==null?void 0:c.ctor(this);if(!d)throw new Error(`Unable to create parser for extension ${o}`);return this._cachedParsers.push({ext:c.ext,parser:d}),this.dispatchEvent({type:"exporterCreate",exporter:c,parser:d}),d}_getParser(o){var c,d;return(d=(c=this._cachedParsers.find(_=>_.ext.includes(o)))===null||c===void 0?void 0:c.parser)!==null&&d!==void 0?d:this._createParser(o)}async processBeforeExport(o,c={}){if(o.assetType!=null&&o.assetType!=="renderTarget"&&(o=await this._processors.process(o.assetType,o,c)),o.isWebGLRenderTarget)return{obj:o,ext:"exr"};switch(o.assetType){case"light":return void console.error("AssetExporter: light export not implemented");case"model":return{obj:o,ext:"glb"};case"material":return{obj:o.toJSON(),ext:o.typeSlug||"json",typeExt:"json"};case"texture":return{obj:o.toJSON(),ext:"json"};case"renderTarget":return{obj:o,ext:"exr"};default:console.error("AssetExporter: unknown asset type",o.assetType)}}dispose(){var o;(o=this._processors)===null||o===void 0||o.dispose()}}var AssetExporterPlugin_decorate=function(h,o,c,d){var _,v=arguments.length,b=v<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(h,o,c,d);else for(var tt=h.length-1;tt>=0;tt--)(_=h[tt])&&(b=(v<3?_(b):v>3?_(o,c,b):_(o,c))||b);return v>3&&b&&Object.defineProperty(o,c,b),b},EncoderMethod;(function(h){h[h.EDGEBREAKER=1]="EDGEBREAKER",h[h.SEQUENTIAL=0]="SEQUENTIAL"})(EncoderMethod||(EncoderMethod={}));class AssetExporterPlugin extends AViewerPlugin{constructor(o){super(),this.enabled=!0,this.exportOptions={compress:!1,name:"scene",viewerConfig:!0,encodeUint16Rgbe:!1,convertMeshToIndexed:!1,embedUrlImagePreviews:!1,embedUrlImages:!1,dracoOptions:{encodeSpeed:5,method:EncoderMethod.EDGEBREAKER,quantizationVolume:"mesh",quantizationBits:{POSITION:14,NORMAL:10,COLOR:8,TEX_COORD:12,GENERIC:12}},encrypt:!1,encryptKey:"",ignoreInvalidMorphTargetTracks:!0,ignoreEmptyTextures:!0},this.exporter=o,this.exportScene=this.exportScene.bind(this)}async onAdded(o){await super.onAdded(o),this.exporter||(this.exporter=new AssetExporter(o)),this.exporter.processors.add("model",{forAssetType:"model",processAsync:async(c,d)=>{var _;return d.convertMeshToIndexed&&((_=c.modelObject)===null||_===void 0||_.traverse(v=>{if(v.geometry&&!v.geometry.attributes.index)try{const b=toIndexedGeometry(v.geometry);v.setGeometry&&v.setGeometry(b)}catch(b){console.error("AssetExporterPlugin.convertMeshToIndexed: Error converting geometry to indexed",b)}})),c}})}async onRemove(o){return super.onRemove(o)}async exportScene(o){var c,d;return(c=this.exporter)===null||c===void 0?void 0:c.exportObject((d=this._viewer)===null||d===void 0?void 0:d.scene.modelRoot,o||{...this.exportOptions})}async downloadSceneGlb(){const o=await this.exportScene(this.exportOptions);o&&await this._downloadBlob(o,this.exportOptions.name+"."+o.ext)}async _downloadBlob(o,c){var d,_;const v=(d=this._viewer)===null||d===void 0?void 0:d.getPluginByType("FileTransferPlugin");v?await v.exportFile(o,c):(_=this._viewer)===null||_===void 0||_.console.error("FileTransferPlugin required to export/download file")}get uiConfig(){if(this._uiConfig)return this._uiConfig;const o=this._viewer;o.addEventListener("addPlugin",d=>{var _;typeof((_=d.plugin)===null||_===void 0?void 0:_.toJSON)=="function"&&console.error("Add all plugins before setting up the export UI, or use `toJSON: any = null` in the plugin ")});const c=Object.entries(o.plugins).filter(([d,_])=>typeof(_==null?void 0:_.toJSON)=="function"&&(_==null?void 0:_.serializeWithViewer)!==!1).map(([d,_])=>({label:d,type:"checkbox",value:!0}));return this._uiConfig={type:"folder",label:"Asset Export",limitedUi:!0,children:[{type:"input",property:[this.exportOptions,"name"],limitedUi:!0},{type:"folder",label:"GLB Export",limitedUi:!0,children:[{type:"checkbox",label:"DRACO Compress",property:[this.exportOptions,"compress"],limitedUi:!0,onChange:()=>{var d,_;return(_=(d=this._uiConfig)===null||d===void 0?void 0:d.uiRefresh)===null||_===void 0?void 0:_.call(d,"postFrame",!0)}},this.exportOptions.dracoOptions?{type:"folder",hidden:()=>!this.exportOptions.compress,label:"DRACO Options",children:[{type:"slider",label:"Encode Speed",bounds:[1,10],property:[this.exportOptions.dracoOptions,"encodeSpeed"]},{type:"dropdown",label:"Encoder Method",property:[this.exportOptions.dracoOptions,"method"],children:Object.entries(EncoderMethod).map(([d,_])=>({label:d,value:_}))},{type:"dropdown",label:"Quantization Volume",property:[this.exportOptions.dracoOptions,"quantizationVolume"],children:["mesh","scene","bbox"].map(d=>({label:d}))},{type:"folder",label:"Quantization Bits",children:Object.keys(this.exportOptions.dracoOptions.quantizationBits).map(d=>({type:"slider",label:d,bounds:[1,16],stepSize:1,property:[this.exportOptions.dracoOptions.quantizationBits,d]}))}]}:{},{type:"checkbox",label:"Scene Settings",property:[this.exportOptions,"viewerConfig"],limitedUi:!0,onChange:()=>{var d,_;return(_=(d=this._uiConfig)===null||d===void 0?void 0:d.uiRefresh)===null||_===void 0?void 0:_.call(d,"postFrame",!0)}},{type:"checkbox",label:"Embed Image Previews",property:[this.exportOptions,"embedUrlImagePreviews"]},{type:"checkbox",label:"Encrypt",property:[this.exportOptions,"encrypt"],onChange:()=>{var d,_;return(_=(d=this._uiConfig)===null||d===void 0?void 0:d.uiRefresh)===null||_===void 0?void 0:_.call(d,"postFrame",!0)}},{type:"checkbox",label:"Encrypt Password",hidden:()=>!this.exportOptions.encrypt,property:[this.exportOptions,"encryptKey"]},{type:"checkbox",label:"Compress hdr env maps",hidden:()=>!this.exportOptions.viewerConfig,property:[this.exportOptions,"encodeUint16Rgbe"]},{type:"checkbox",label:"Convert to indexed",property:[this.exportOptions,"convertMeshToIndexed"]},{type:"checkbox",label:"Ignore invalid animations",property:[this.exportOptions,"ignoreInvalidMorphTargetTracks"]},{type:"checkbox",label:"Ignore invalid textures",property:[this.exportOptions,"ignoreInvalidTextures"]},{type:"button",label:"Export GLB",limitedUi:!0,value:async()=>this.downloadSceneGlb()}]},{type:"folder",label:"Preset/Config export",children:[{type:"folder",label:"Plugins",children:c},{type:"button",label:"Select none",value:()=>{c.forEach(d=>{var _;d.value=!1,(_=d.uiRefresh)===null||_===void 0||_.call(d)})}},{type:"button",label:"Select all",value:()=>{c.forEach(d=>{var _;d.value=!0,(_=d.uiRefresh)===null||_===void 0||_.call(d)})}},{type:"button",label:"Export Plugins",limitedUi:!0,value:async()=>{const d=new Blob([JSON.stringify(o.getPlugin(AssetManagerPlugin).exportPluginPresets(c.filter(_=>!!_.value).map(_=>Ee$1(_.label)||"")),null,2)],{type:"application/json"});d&&await this._downloadBlob(d,this.exportOptions.name+"."+AssetManagerPlugin.ViewerTypeSlug)}},{type:"button",label:"Export All Viewer Config",limitedUi:!0,value:async()=>{const d=new Blob([JSON.stringify(o.getPlugin(AssetManagerPlugin).exportViewerConfig(!1),null,2)],{type:"application/json"});d&&await this._downloadBlob(d,this.exportOptions.name+"."+AssetManagerPlugin.ViewerTypeSlug)}}]}]}}}AssetExporterPlugin.PluginType="AssetExporterPlugin",AssetExporterPlugin_decorate([serialize()],AssetExporterPlugin.prototype,"exportOptions",void 0);class EventDispatcher{constructor(){this._listeners={}}addEventListener(o,c){const d=this._listeners;return d[o]===void 0&&(d[o]=[]),d[o].indexOf(c)===-1&&d[o].push(c),this}removeEventListener(o,c){const d=this._listeners[o];if(d!==void 0){const _=d.indexOf(c);_!==-1&&d.splice(_,1)}return this}dispatchEvent(o){const c=this._listeners[o.type];if(c!==void 0){const d=c.slice(0);for(let _=0,v=d.length;_<v;_++)d[_].call(this,o)}return this}dispose(){for(const o in this._listeners)delete this._listeners[o]}}class GraphEdge{constructor(o,c,d,_={}){if(this._name=void 0,this._parent=void 0,this._child=void 0,this._attributes=void 0,this._disposed=!1,this._name=o,this._parent=c,this._child=d,this._attributes=_,!c.isOnGraph(d))throw new Error("Cannot connect disconnected graphs.")}getName(){return this._name}getParent(){return this._parent}getChild(){return this._child}setChild(o){return this._child=o,this}getAttributes(){return this._attributes}dispose(){this._disposed||(this._parent._destroyRef(this),this._disposed=!0)}isDisposed(){return this._disposed}}class Graph extends EventDispatcher{constructor(...o){super(...o),this._emptySet=new Set,this._edges=new Set,this._parentEdges=new Map,this._childEdges=new Map}listEdges(){return Array.from(this._edges)}listParentEdges(o){return Array.from(this._childEdges.get(o)||this._emptySet)}listParents(o){const c=new Set;for(const d of this.listParentEdges(o))c.add(d.getParent());return Array.from(c)}listChildEdges(o){return Array.from(this._parentEdges.get(o)||this._emptySet)}listChildren(o){const c=new Set;for(const d of this.listChildEdges(o))c.add(d.getChild());return Array.from(c)}disconnectParents(o,c){for(const d of this.listParentEdges(o))c&&!c(d.getParent())||d.dispose();return this}_createEdge(o,c,d,_){const v=new GraphEdge(o,c,d,_);this._edges.add(v);const b=v.getParent();this._parentEdges.has(b)||this._parentEdges.set(b,new Set),this._parentEdges.get(b).add(v);const tt=v.getChild();return this._childEdges.has(tt)||this._childEdges.set(tt,new Set),this._childEdges.get(tt).add(v),v}_destroyEdge(o){return this._edges.delete(o),this._parentEdges.get(o.getParent()).delete(o),this._childEdges.get(o.getChild()).delete(o),this}}function _extends(){return _extends=Object.assign||function(h){for(var o=1;o<arguments.length;o++){var c=arguments[o];for(var d in c)Object.prototype.hasOwnProperty.call(c,d)&&(h[d]=c[d])}return h},_extends.apply(this,arguments)}class RefList{constructor(o){if(this.list=[],o)for(const c of o)this.list.push(c)}add(o){this.list.push(o)}remove(o){const c=this.list.indexOf(o);c>=0&&this.list.splice(c,1)}removeChild(o){const c=[];for(const d of this.list)d.getChild()===o&&c.push(d);for(const d of c)this.remove(d);return c}listRefsByChild(o){const c=[];for(const d of this.list)d.getChild()===o&&c.push(d);return c}values(){return this.list}}class RefSet{constructor(o){if(this.set=new Set,this.map=new Map,o)for(const c of o)this.add(c)}add(o){const c=o.getChild();this.removeChild(c),this.set.add(o),this.map.set(c,o)}remove(o){this.set.delete(o),this.map.delete(o.getChild())}removeChild(o){const c=this.map.get(o)||null;return c&&this.remove(c),c}getRefByChild(o){return this.map.get(o)||null}values(){return Array.from(this.set)}}class RefMap{constructor(o){this.map={},o&&Object.assign(this.map,o)}set(o,c){this.map[o]=c}delete(o){delete this.map[o]}get(o){return this.map[o]||null}keys(){return Object.keys(this.map)}values(){return Object.values(this.map)}}const $attributes=Symbol("attributes"),$immutableKeys=Symbol("immutableKeys");class GraphNode extends EventDispatcher{constructor(o){super(),this._disposed=!1,this.graph=void 0,this[$attributes]=void 0,this[$immutableKeys]=void 0,this.graph=o,this[$immutableKeys]=new Set,this[$attributes]=this._createAttributes()}getDefaults(){return{}}_createAttributes(){const o=this.getDefaults(),c={};for(const d in o){const _=o[d];if(_ instanceof GraphNode){const v=this.graph._createEdge(d,this,_);this[$immutableKeys].add(d),c[d]=v}else c[d]=_}return c}isOnGraph(o){return this.graph===o.graph}isDisposed(){return this._disposed}dispose(){this._disposed||(this.graph.listChildEdges(this).forEach(o=>o.dispose()),this.graph.disconnectParents(this),this._disposed=!0,this.dispatchEvent({type:"dispose"}))}detach(){return this.graph.disconnectParents(this),this}swap(o,c){for(const d in this[$attributes]){const _=this[$attributes][d];if(_ instanceof GraphEdge){const v=_;v.getChild()===o&&this.setRef(d,c,v.getAttributes())}else if(_ instanceof RefList)for(const v of _.listRefsByChild(o)){const b=v.getAttributes();this.removeRef(d,o),this.addRef(d,c,b)}else if(_ instanceof RefSet){const v=_.getRefByChild(o);if(v){const b=v.getAttributes();this.removeRef(d,o),this.addRef(d,c,b)}}else if(_ instanceof RefMap)for(const v of _.keys()){const b=_.get(v);b.getChild()===o&&this.setRefMap(d,v,c,b.getAttributes())}}return this}get(o){return this[$attributes][o]}set(o,c){return this[$attributes][o]=c,this.dispatchEvent({type:"change",attribute:o})}getRef(o){const c=this[$attributes][o];return c?c.getChild():null}setRef(o,c,d){if(this[$immutableKeys].has(o))throw new Error(`Cannot overwrite immutable attribute, "${o}".`);const _=this[$attributes][o];if(_&&_.dispose(),!c)return this;const v=this.graph._createEdge(o,this,c,d);return this[$attributes][o]=v,this.dispatchEvent({type:"change",attribute:o})}listRefs(o){return this.assertRefList(o).values().map(c=>c.getChild())}addRef(o,c,d){const _=this.graph._createEdge(o,this,c,d);return this.assertRefList(o).add(_),this.dispatchEvent({type:"change",attribute:o})}removeRef(o,c){const d=this.assertRefList(o);if(d instanceof RefList)for(const _ of d.listRefsByChild(c))_.dispose();else{const _=d.getRefByChild(c);_&&_.dispose()}return this}assertRefList(o){const c=this[$attributes][o];if(c instanceof RefList||c instanceof RefSet)return c;throw new Error(`Expected RefList or RefSet for attribute "${o}"`)}listRefMapKeys(o){return this.assertRefMap(o).keys()}listRefMapValues(o){return this.assertRefMap(o).values().map(c=>c.getChild())}getRefMap(o,c){const d=this.assertRefMap(o).get(c);return d?d.getChild():null}setRefMap(o,c,d,_){const v=this.assertRefMap(o),b=v.get(c);if(b&&b.dispose(),!d)return this;_=Object.assign(_||{},{key:c});const tt=this.graph._createEdge(o,this,d,_extends({},_,{key:c}));return v.set(c,tt),this.dispatchEvent({type:"change",attribute:o,key:c})}assertRefMap(o){const c=this[$attributes][o];if(c instanceof RefMap)return c;throw new Error(`Expected RefMap for attribute "${o}"`)}dispatchEvent(o){return super.dispatchEvent(_extends({},o,{target:this})),this.graph.dispatchEvent(_extends({},o,{target:this,type:`node:${o.type}`})),this}_destroyRef(o){const c=o.getName();if(this[$attributes][c]===o)this[$attributes][c]=null,this[$immutableKeys].has(c)&&o.getChild().dispose();else if(this[$attributes][c]instanceof RefList)this[$attributes][c].remove(o);else if(this[$attributes][c]instanceof RefSet)this[$attributes][c].remove(o);else{if(!(this[$attributes][c]instanceof RefMap))return;{const d=this[$attributes][c];for(const _ of d.keys())d.get(_)===o&&d.delete(_)}}this.graph._destroyEdge(o),this.dispatchEvent({type:"change",attribute:c})}}const VERSION="v4.1.1",GLB_BUFFER="@glb.bin";var index_modern_PropertyType,VertexLayout,BufferViewUsage$1,index_modern_TextureChannel,Format;(function(h){h.ACCESSOR="Accessor",h.ANIMATION="Animation",h.ANIMATION_CHANNEL="AnimationChannel",h.ANIMATION_SAMPLER="AnimationSampler",h.BUFFER="Buffer",h.CAMERA="Camera",h.MATERIAL="Material",h.MESH="Mesh",h.PRIMITIVE="Primitive",h.PRIMITIVE_TARGET="PrimitiveTarget",h.NODE="Node",h.ROOT="Root",h.SCENE="Scene",h.SKIN="Skin",h.TEXTURE="Texture",h.TEXTURE_INFO="TextureInfo"})(index_modern_PropertyType||(index_modern_PropertyType={})),function(h){h.INTERLEAVED="interleaved",h.SEPARATE="separate"}(VertexLayout||(VertexLayout={})),function(h){h.ARRAY_BUFFER="ARRAY_BUFFER",h.ELEMENT_ARRAY_BUFFER="ELEMENT_ARRAY_BUFFER",h.INVERSE_BIND_MATRICES="INVERSE_BIND_MATRICES",h.OTHER="OTHER",h.SPARSE="SPARSE"}(BufferViewUsage$1||(BufferViewUsage$1={})),function(h){h[h.R=4096]="R",h[h.G=256]="G",h[h.B=16]="B",h[h.A=1]="A"}(index_modern_TextureChannel||(index_modern_TextureChannel={})),function(h){h.GLTF="GLTF",h.GLB="GLB"}(Format||(Format={}));const index_modern_ComponentTypeToTypedArray={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};var ARRAY_TYPE=typeof Float32Array<"u"?Float32Array:Array,_Logger,Verbosity;function create(){var h=new ARRAY_TYPE(3);return ARRAY_TYPE!=Float32Array&&(h[0]=0,h[1]=0,h[2]=0),h}function index_modern_length(h){var o=h[0],c=h[1],d=h[2];return Math.hypot(o,c,d)}function transformMat4(h,o,c){var d=o[0],_=o[1],v=o[2],b=c[3]*d+c[7]*_+c[11]*v+c[15];return b=b||1,h[0]=(c[0]*d+c[4]*_+c[8]*v+c[12])/b,h[1]=(c[1]*d+c[5]*_+c[9]*v+c[13])/b,h[2]=(c[2]*d+c[6]*_+c[10]*v+c[14])/b,h}function getBounds(h){const o=createBounds(),c=h.propertyType===index_modern_PropertyType.NODE?[h]:h.listChildren();for(const d of c)d.traverse(_=>{const v=_.getMesh();if(!v)return;const b=getMeshBounds(v,_.getWorldMatrix());b.min.every(isFinite)&&b.max.every(isFinite)&&(expandBounds(b.min,o),expandBounds(b.max,o))});return o}function getMeshBounds(h,o){const c=createBounds();for(const d of h.listPrimitives()){const _=d.getAttribute("POSITION"),v=d.getIndices();if(!_)continue;let b=[0,0,0],tt=[0,0,0];for(let it=0,nt=v?v.getCount():_.getCount();it<nt;it++){const lt=v?v.getScalar(it):it;b=_.getElement(lt,b),tt=transformMat4(tt,b,o),expandBounds(tt,c)}}return c}function expandBounds(h,o){for(let c=0;c<3;c++)o.min[c]=Math.min(h[c],o.min[c]),o.max[c]=Math.max(h[c],o.max[c])}function createBounds(){return{min:[1/0,1/0,1/0],max:[-1/0,-1/0,-1/0]}}Math.hypot||(Math.hypot=function(){for(var h=0,o=arguments.length;o--;)h+=arguments[o]*arguments[o];return Math.sqrt(h)}),create();class index_modern_BufferUtils{static createBufferFromDataURI(o){if(typeof Buffer>"u"){const c=atob(o.split(",")[1]),d=new Uint8Array(c.length);for(let _=0;_<c.length;_++)d[_]=c.charCodeAt(_);return d}{const c=o.split(",")[1],d=o.indexOf("base64")>=0;return Buffer.from(c,d?"base64":"utf8")}}static encodeText(o){return new TextEncoder().encode(o)}static decodeText(o){return new TextDecoder().decode(o)}static concat(o){let c=0;for(const v of o)c+=v.byteLength;const d=new Uint8Array(c);let _=0;for(const v of o)d.set(v,_),_+=v.byteLength;return d}static pad(o,c=0){const d=this.padNumber(o.byteLength);if(d===o.byteLength)return o;const _=new Uint8Array(d);if(_.set(o),c!==0)for(let v=o.byteLength;v<d;v++)_[v]=c;return _}static padNumber(o){return 4*Math.ceil(o/4)}static equals(o,c){if(o===c)return!0;if(o.byteLength!==c.byteLength)return!1;let d=o.byteLength;for(;d--;)if(o[d]!==c[d])return!1;return!0}static toView(o,c=0,d=1/0){return new Uint8Array(o.buffer,o.byteOffset+c,Math.min(o.byteLength,d))}static assertView(o){if(o&&!ArrayBuffer.isView(o))throw new Error(`Method requires Uint8Array parameter; received "${typeof o}".`);return o}}class JPEGImageUtils{match(o){return o.length>=3&&o[0]===255&&o[1]===216&&o[2]===255}getSize(o){let c,d,_=new DataView(o.buffer,o.byteOffset+4);for(;_.byteLength;){if(c=_.getUint16(0,!1),validateJPEGBuffer(_,c),d=_.getUint8(c+1),d===192||d===193||d===194)return[_.getUint16(c+7,!1),_.getUint16(c+5,!1)];_=new DataView(o.buffer,_.byteOffset+c+2)}throw new TypeError("Invalid JPG, no size found")}getChannels(o){return 3}}class PNGImageUtils{match(o){return o.length>=8&&o[0]===137&&o[1]===80&&o[2]===78&&o[3]===71&&o[4]===13&&o[5]===10&&o[6]===26&&o[7]===10}getSize(o){const c=new DataView(o.buffer,o.byteOffset);return index_modern_BufferUtils.decodeText(o.slice(12,16))===PNGImageUtils.PNG_FRIED_CHUNK_NAME?[c.getUint32(32,!1),c.getUint32(36,!1)]:[c.getUint32(16,!1),c.getUint32(20,!1)]}getChannels(o){return 4}}PNGImageUtils.PNG_FRIED_CHUNK_NAME="CgBI";class index_modern_ImageUtils{static registerFormat(o,c){this.impls[o]=c}static getMimeType(o){for(const c in this.impls)if(this.impls[c].match(o))return c;return null}static getSize(o,c){return this.impls[c]?this.impls[c].getSize(o):null}static getChannels(o,c){return this.impls[c]?this.impls[c].getChannels(o):null}static getVRAMByteLength(o,c){if(!this.impls[c])return null;if(this.impls[c].getVRAMByteLength)return this.impls[c].getVRAMByteLength(o);let d=0;const _=this.getSize(o,c);if(!_)return null;for(;_[0]>1||_[1]>1;)d+=_[0]*_[1]*4,_[0]=Math.max(Math.floor(_[0]/2),1),_[1]=Math.max(Math.floor(_[1]/2),1);return d+=4,d}static mimeTypeToExtension(o){return o==="image/jpeg"?"jpg":o.split("/").pop()}static extensionToMimeType(o){return o==="jpg"?"image/jpeg":o?`image/${o}`:""}}function validateJPEGBuffer(h,o){if(o>h.byteLength)throw new TypeError("Corrupt JPG, exceeded buffer limits");if(h.getUint8(o)!==255)throw new TypeError("Invalid JPG, marker table corrupted");return h}index_modern_ImageUtils.impls={"image/jpeg":new JPEGImageUtils,"image/png":new PNGImageUtils};class index_modern_FileUtils{static basename(o){const c=o.split(/[\\/]/).pop();return c.substring(0,c.lastIndexOf("."))}static extension(o){if(o.startsWith("data:image/")){const c=o.match(/data:(image\/\w+)/)[1];return index_modern_ImageUtils.mimeTypeToExtension(c)}return o.startsWith("data:model/gltf+json")?"gltf":o.startsWith("data:model/gltf-binary")?"glb":o.startsWith("data:application/")?"bin":o.split(/[\\/]/).pop().split(/[.]/).pop()}}function isObject(h){return Object.prototype.toString.call(h)==="[object Object]"}function isPlainObject(h){if(isObject(h)===!1)return!1;const o=h.constructor;if(o===void 0)return!0;const c=o.prototype;return isObject(c)!==!1&&Object.prototype.hasOwnProperty.call(c,"isPrototypeOf")!==!1}(function(h){h[h.SILENT=4]="SILENT",h[h.ERROR=3]="ERROR",h[h.WARN=2]="WARN",h[h.INFO=1]="INFO",h[h.DEBUG=0]="DEBUG"})(Verbosity||(Verbosity={}));class Logger{constructor(o){this.verbosity=void 0,this.verbosity=o}debug(o){this.verbosity<=Logger.Verbosity.DEBUG&&console.debug(o)}info(o){this.verbosity<=Logger.Verbosity.INFO&&console.info(o)}warn(o){this.verbosity<=Logger.Verbosity.WARN&&console.warn(o)}error(o){this.verbosity<=Logger.Verbosity.ERROR&&console.error(o)}}function determinant(h){var o=h[0],c=h[1],d=h[2],_=h[3],v=h[4],b=h[5],tt=h[6],it=h[7],nt=h[8],lt=h[9],ut=h[10],ht=h[11],_t=h[12],ft=h[13],bt=h[14],xt=h[15];return(o*b-c*v)*(ut*xt-ht*bt)-(o*tt-d*v)*(lt*xt-ht*ft)+(o*it-_*v)*(lt*bt-ut*ft)+(c*tt-d*b)*(nt*xt-ht*_t)-(c*it-_*b)*(nt*bt-ut*_t)+(d*it-_*tt)*(nt*ft-lt*_t)}function multiply(h,o,c){var d=o[0],_=o[1],v=o[2],b=o[3],tt=o[4],it=o[5],nt=o[6],lt=o[7],ut=o[8],ht=o[9],_t=o[10],ft=o[11],bt=o[12],xt=o[13],St=o[14],wt=o[15],Pt=c[0],Rt=c[1],kt=c[2],Gt=c[3];return h[0]=Pt*d+Rt*tt+kt*ut+Gt*bt,h[1]=Pt*_+Rt*it+kt*ht+Gt*xt,h[2]=Pt*v+Rt*nt+kt*_t+Gt*St,h[3]=Pt*b+Rt*lt+kt*ft+Gt*wt,Pt=c[4],Rt=c[5],kt=c[6],Gt=c[7],h[4]=Pt*d+Rt*tt+kt*ut+Gt*bt,h[5]=Pt*_+Rt*it+kt*ht+Gt*xt,h[6]=Pt*v+Rt*nt+kt*_t+Gt*St,h[7]=Pt*b+Rt*lt+kt*ft+Gt*wt,Pt=c[8],Rt=c[9],kt=c[10],Gt=c[11],h[8]=Pt*d+Rt*tt+kt*ut+Gt*bt,h[9]=Pt*_+Rt*it+kt*ht+Gt*xt,h[10]=Pt*v+Rt*nt+kt*_t+Gt*St,h[11]=Pt*b+Rt*lt+kt*ft+Gt*wt,Pt=c[12],Rt=c[13],kt=c[14],Gt=c[15],h[12]=Pt*d+Rt*tt+kt*ut+Gt*bt,h[13]=Pt*_+Rt*it+kt*ht+Gt*xt,h[14]=Pt*v+Rt*nt+kt*_t+Gt*St,h[15]=Pt*b+Rt*lt+kt*ft+Gt*wt,h}function getScaling(h,o){var c=o[0],d=o[1],_=o[2],v=o[4],b=o[5],tt=o[6],it=o[8],nt=o[9],lt=o[10];return h[0]=Math.hypot(c,d,_),h[1]=Math.hypot(v,b,tt),h[2]=Math.hypot(it,nt,lt),h}function getRotation(h,o){var c=new ARRAY_TYPE(3);getScaling(c,o);var d=1/c[0],_=1/c[1],v=1/c[2],b=o[0]*d,tt=o[1]*_,it=o[2]*v,nt=o[4]*d,lt=o[5]*_,ut=o[6]*v,ht=o[8]*d,_t=o[9]*_,ft=o[10]*v,bt=b+lt+ft,xt=0;return bt>0?(xt=2*Math.sqrt(bt+1),h[3]=.25*xt,h[0]=(ut-_t)/xt,h[1]=(ht-it)/xt,h[2]=(tt-nt)/xt):b>lt&&b>ft?(xt=2*Math.sqrt(1+b-lt-ft),h[3]=(ut-_t)/xt,h[0]=.25*xt,h[1]=(tt+nt)/xt,h[2]=(ht+it)/xt):lt>ft?(xt=2*Math.sqrt(1+lt-b-ft),h[3]=(ht-it)/xt,h[0]=(tt+nt)/xt,h[1]=.25*xt,h[2]=(ut+_t)/xt):(xt=2*Math.sqrt(1+ft-b-lt),h[3]=(tt-nt)/xt,h[0]=(ht+it)/xt,h[1]=(ut+_t)/xt,h[2]=.25*xt),h}_Logger=Logger,Logger.Verbosity=Verbosity,Logger.DEFAULT_INSTANCE=new _Logger(_Logger.Verbosity.INFO);class index_modern_MathUtils{static identity(o){return o}static eq(o,c,d=1e-5){if(o.length!==c.length)return!1;for(let _=0;_<o.length;_++)if(Math.abs(o[_]-c[_])>d)return!1;return!0}static clamp(o,c,d){return o<c?c:o>d?d:o}static decodeNormalizedInt(o,c){switch(c){case 5126:return o;case 5123:return o/65535;case 5121:return o/255;case 5122:return Math.max(o/32767,-1);case 5120:return Math.max(o/127,-1);default:throw new Error("Invalid component type.")}}static encodeNormalizedInt(o,c){switch(c){case 5126:return o;case 5123:return Math.round(65535*index_modern_MathUtils.clamp(o,0,1));case 5121:return Math.round(255*index_modern_MathUtils.clamp(o,0,1));case 5122:return Math.round(32767*index_modern_MathUtils.clamp(o,-1,1));case 5120:return Math.round(127*index_modern_MathUtils.clamp(o,-1,1));default:throw new Error("Invalid component type.")}}static decompose(o,c,d,_){let v=index_modern_length([o[0],o[1],o[2]]);const b=index_modern_length([o[4],o[5],o[6]]),tt=index_modern_length([o[8],o[9],o[10]]);determinant(o)<0&&(v=-v),c[0]=o[12],c[1]=o[13],c[2]=o[14];const it=o.slice(),nt=1/v,lt=1/b,ut=1/tt;it[0]*=nt,it[1]*=nt,it[2]*=nt,it[4]*=lt,it[5]*=lt,it[6]*=lt,it[8]*=ut,it[9]*=ut,it[10]*=ut,getRotation(d,it),_[0]=v,_[1]=b,_[2]=tt}static compose(o,c,d,_){const v=_,b=c[0],tt=c[1],it=c[2],nt=c[3],lt=b+b,ut=tt+tt,ht=it+it,_t=b*lt,ft=b*ut,bt=b*ht,xt=tt*ut,St=tt*ht,wt=it*ht,Pt=nt*lt,Rt=nt*ut,kt=nt*ht,Gt=d[0],Dt=d[1],It=d[2];return v[0]=(1-(xt+wt))*Gt,v[1]=(ft+kt)*Gt,v[2]=(bt-Rt)*Gt,v[3]=0,v[4]=(ft-kt)*Dt,v[5]=(1-(_t+wt))*Dt,v[6]=(St+Pt)*Dt,v[7]=0,v[8]=(bt+Rt)*It,v[9]=(St-Pt)*It,v[10]=(1-(_t+xt))*It,v[11]=0,v[12]=o[0],v[13]=o[1],v[14]=o[2],v[15]=1,v}}function equalsRef(h,o){if(!!h!=!!o)return!1;const c=h.getChild(),d=o.getChild();return c===d||c.equals(d)}function equalsRefSet(h,o){if(!!h!=!!o)return!1;const c=h.values(),d=o.values();if(c.length!==d.length)return!1;for(let _=0;_<c.length;_++){const v=c[_],b=d[_];if(v.getChild()!==b.getChild()&&!v.getChild().equals(b.getChild()))return!1}return!0}function equalsRefMap(h,o){if(!!h!=!!o)return!1;const c=h.keys(),d=o.keys();if(c.length!==d.length)return!1;for(const _ of c){const v=h.get(_),b=o.get(_);if(!!v!=!!b)return!1;const tt=v.getChild(),it=b.getChild();if(tt!==it&&!tt.equals(it))return!1}return!0}function equalsArray(h,o){if(h===o)return!0;if(!!h!=!!o||!h||!o||h.length!==o.length)return!1;for(let c=0;c<h.length;c++)if(h[c]!==o[c])return!1;return!0}function equalsObject(h,o){if(h===o)return!0;if(!!h!=!!o)return!1;if(!isPlainObject(h)||!isPlainObject(o))return h===o;const c=h,d=o;let _,v=0,b=0;for(_ in c)v++;for(_ in d)b++;if(v!==b)return!1;for(_ in c){const tt=c[_],it=d[_];if(isArray(tt)&&isArray(it)){if(!equalsArray(tt,it))return!1}else if(isPlainObject(tt)&&isPlainObject(it)){if(!equalsObject(tt,it))return!1}else if(tt!==it)return!1}return!0}function isArray(h){return Array.isArray(h)||ArrayBuffer.isView(h)}const ALPHABET="23456789abdegjkmnpqrvwxyzABDEGJKMNPQRVWXYZ",UNIQUE_RETRIES=999,ID_LENGTH=6,previousIDs=new Set,generateOne=function(){let h="";for(let o=0;o<ID_LENGTH;o++)h+=ALPHABET.charAt(Math.floor(Math.random()*ALPHABET.length));return h},index_modern_uuid=function(){for(let h=0;h<UNIQUE_RETRIES;h++){const o=generateOne();if(!previousIDs.has(o))return previousIDs.add(o),o}return""},NULL_DOMAIN="https://null.example";class HTTPUtils{static dirname(o){const c=o.lastIndexOf("/");return c===-1?"./":o.substring(0,c+1)}static basename(o){return index_modern_FileUtils.basename(new URL(o,NULL_DOMAIN).pathname)}static extension(o){return index_modern_FileUtils.extension(new URL(o,NULL_DOMAIN).pathname)}static resolve(o,c){if(!this.isRelativePath(c))return c;const d=o.split("/"),_=c.split("/");d.pop();for(let v=0;v<_.length;v++)_[v]!=="."&&(_[v]===".."?d.pop():d.push(_[v]));return d.join("/")}static isAbsoluteURL(o){return this.PROTOCOL_REGEXP.test(o)}static isRelativePath(o){return!/^(?:[a-zA-Z]+:)?\//.test(o)}}HTTPUtils.DEFAULT_INIT={},HTTPUtils.PROTOCOL_REGEXP=/^[a-zA-Z]+:\/\//;const COPY_IDENTITY=h=>h,EMPTY_SET=new Set;class Property extends GraphNode{constructor(o,c=""){super(o),this[$attributes].name=c,this.init(),this.dispatchEvent({type:"create"})}getGraph(){return this.graph}getDefaults(){return Object.assign(super.getDefaults(),{name:"",extras:{}})}set(o,c){return Array.isArray(c)&&(c=c.slice()),super.set(o,c)}getName(){return this.get("name")}setName(o){return this.set("name",o)}getExtras(){return this.get("extras")}setExtras(o){return this.set("extras",o)}clone(){return new this.constructor(this.graph).copy(this,COPY_IDENTITY)}copy(o,c=COPY_IDENTITY){for(const d in this[$attributes]){const _=this[$attributes][d];if(_ instanceof GraphEdge)this[$immutableKeys].has(d)||_.dispose();else if(_ instanceof RefList||_ instanceof RefSet)for(const v of _.values())v.dispose();else if(_ instanceof RefMap)for(const v of _.values())v.dispose()}for(const d in o[$attributes]){const _=this[$attributes][d],v=o[$attributes][d];if(v instanceof GraphEdge)this[$immutableKeys].has(d)?_.getChild().copy(c(v.getChild()),c):this.setRef(d,c(v.getChild()),v.getAttributes());else if(v instanceof RefSet||v instanceof RefList)for(const b of v.values())this.addRef(d,c(b.getChild()),b.getAttributes());else if(v instanceof RefMap)for(const b of v.keys()){const tt=v.get(b);this.setRefMap(d,b,c(tt.getChild()),tt.getAttributes())}else isPlainObject(v)?this[$attributes][d]=JSON.parse(JSON.stringify(v)):Array.isArray(v)||v instanceof ArrayBuffer||ArrayBuffer.isView(v)?this[$attributes][d]=v.slice():this[$attributes][d]=v}return this}equals(o,c=EMPTY_SET){if(this===o)return!0;if(this.propertyType!==o.propertyType)return!1;for(const d in this[$attributes]){if(c.has(d))continue;const _=this[$attributes][d],v=o[$attributes][d];if(_ instanceof GraphEdge||v instanceof GraphEdge){if(!equalsRef(_,v))return!1}else if(_ instanceof RefSet||v instanceof RefSet||_ instanceof RefList||v instanceof RefList){if(!equalsRefSet(_,v))return!1}else if(_ instanceof RefMap||v instanceof RefMap){if(!equalsRefMap(_,v))return!1}else if(isPlainObject(_)||isPlainObject(v)){if(!equalsObject(_,v))return!1}else if(isArray(_)||isArray(v)){if(!equalsArray(_,v))return!1}else if(_!==v)return!1}return!0}detach(){return this.graph.disconnectParents(this,o=>o.propertyType!=="Root"),this}listParents(){return this.graph.listParents(this)}}class ExtensibleProperty extends Property{getDefaults(){return Object.assign(super.getDefaults(),{extensions:new RefMap})}getExtension(o){return this.getRefMap("extensions",o)}setExtension(o,c){return c&&c._validateParent(this),this.setRefMap("extensions",o,c)}listExtensions(){return this.listRefMapValues("extensions")}}class index_modern_Accessor extends ExtensibleProperty{init(){this.propertyType=index_modern_PropertyType.ACCESSOR}getDefaults(){return Object.assign(super.getDefaults(),{array:null,type:index_modern_Accessor.Type.SCALAR,componentType:index_modern_Accessor.ComponentType.FLOAT,normalized:!1,sparse:!1,buffer:null})}static getElementSize(o){switch(o){case index_modern_Accessor.Type.SCALAR:return 1;case index_modern_Accessor.Type.VEC2:return 2;case index_modern_Accessor.Type.VEC3:return 3;case index_modern_Accessor.Type.VEC4:case index_modern_Accessor.Type.MAT2:return 4;case index_modern_Accessor.Type.MAT3:return 9;case index_modern_Accessor.Type.MAT4:return 16;default:throw new Error("Unexpected type: "+o)}}static getComponentSize(o){switch(o){case index_modern_Accessor.ComponentType.BYTE:case index_modern_Accessor.ComponentType.UNSIGNED_BYTE:return 1;case index_modern_Accessor.ComponentType.SHORT:case index_modern_Accessor.ComponentType.UNSIGNED_SHORT:return 2;case index_modern_Accessor.ComponentType.UNSIGNED_INT:case index_modern_Accessor.ComponentType.FLOAT:return 4;default:throw new Error("Unexpected component type: "+o)}}getMinNormalized(o){const c=this.getNormalized(),d=this.getElementSize(),_=this.getComponentType();if(this.getMin(o),c)for(let v=0;v<d;v++)o[v]=index_modern_MathUtils.decodeNormalizedInt(o[v],_);return o}getMin(o){const c=this.getArray(),d=this.getCount(),_=this.getElementSize();for(let v=0;v<_;v++)o[v]=1/0;for(let v=0;v<d*_;v+=_)for(let b=0;b<_;b++){const tt=c[v+b];Number.isFinite(tt)&&(o[b]=Math.min(o[b],tt))}return o}getMaxNormalized(o){const c=this.getNormalized(),d=this.getElementSize(),_=this.getComponentType();if(this.getMax(o),c)for(let v=0;v<d;v++)o[v]=index_modern_MathUtils.decodeNormalizedInt(o[v],_);return o}getMax(o){const c=this.get("array"),d=this.getCount(),_=this.getElementSize();for(let v=0;v<_;v++)o[v]=-1/0;for(let v=0;v<d*_;v+=_)for(let b=0;b<_;b++){const tt=c[v+b];Number.isFinite(tt)&&(o[b]=Math.max(o[b],tt))}return o}getCount(){const o=this.get("array");return o?o.length/this.getElementSize():0}getType(){return this.get("type")}setType(o){return this.set("type",o)}getElementSize(){return index_modern_Accessor.getElementSize(this.get("type"))}getComponentSize(){return this.get("array").BYTES_PER_ELEMENT}getComponentType(){return this.get("componentType")}getNormalized(){return this.get("normalized")}setNormalized(o){return this.set("normalized",o)}getScalar(o){const c=this.getElementSize(),d=this.getComponentType(),_=this.getArray();return this.getNormalized()?index_modern_MathUtils.decodeNormalizedInt(_[o*c],d):_[o*c]}setScalar(o,c){const d=this.getElementSize(),_=this.getComponentType(),v=this.getArray();return this.getNormalized()?v[o*d]=index_modern_MathUtils.encodeNormalizedInt(c,_):v[o*d]=c,this}getElement(o,c){const d=this.getNormalized(),_=this.getElementSize(),v=this.getComponentType(),b=this.getArray();for(let tt=0;tt<_;tt++)c[tt]=d?index_modern_MathUtils.decodeNormalizedInt(b[o*_+tt],v):b[o*_+tt];return c}setElement(o,c){const d=this.getNormalized(),_=this.getElementSize(),v=this.getComponentType(),b=this.getArray();for(let tt=0;tt<_;tt++)b[o*_+tt]=d?index_modern_MathUtils.encodeNormalizedInt(c[tt],v):c[tt];return this}getSparse(){return this.get("sparse")}setSparse(o){return this.set("sparse",o)}getBuffer(){return this.getRef("buffer")}setBuffer(o){return this.setRef("buffer",o)}getArray(){return this.get("array")}setArray(o){return this.set("componentType",o?arrayToComponentType(o):index_modern_Accessor.ComponentType.FLOAT),this.set("array",o),this}getByteLength(){const o=this.get("array");return o?o.byteLength:0}}function arrayToComponentType(h){switch(h.constructor){case Float32Array:return index_modern_Accessor.ComponentType.FLOAT;case Uint32Array:return index_modern_Accessor.ComponentType.UNSIGNED_INT;case Uint16Array:return index_modern_Accessor.ComponentType.UNSIGNED_SHORT;case Uint8Array:return index_modern_Accessor.ComponentType.UNSIGNED_BYTE;case Int16Array:return index_modern_Accessor.ComponentType.SHORT;case Int8Array:return index_modern_Accessor.ComponentType.BYTE;default:throw new Error("Unknown accessor componentType.")}}index_modern_Accessor.Type={SCALAR:"SCALAR",VEC2:"VEC2",VEC3:"VEC3",VEC4:"VEC4",MAT2:"MAT2",MAT3:"MAT3",MAT4:"MAT4"},index_modern_Accessor.ComponentType={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,UNSIGNED_INT:5125,FLOAT:5126};class Animation extends ExtensibleProperty{init(){this.propertyType=index_modern_PropertyType.ANIMATION}getDefaults(){return Object.assign(super.getDefaults(),{channels:new RefSet,samplers:new RefSet})}addChannel(o){return this.addRef("channels",o)}removeChannel(o){return this.removeRef("channels",o)}listChannels(){return this.listRefs("channels")}addSampler(o){return this.addRef("samplers",o)}removeSampler(o){return this.removeRef("samplers",o)}listSamplers(){return this.listRefs("samplers")}}class index_modern_AnimationChannel extends ExtensibleProperty{init(){this.propertyType=index_modern_PropertyType.ANIMATION_CHANNEL}getDefaults(){return Object.assign(super.getDefaults(),{targetPath:null,targetNode:null,sampler:null})}getTargetPath(){return this.get("targetPath")}setTargetPath(o){return this.set("targetPath",o)}getTargetNode(){return this.getRef("targetNode")}setTargetNode(o){return this.setRef("targetNode",o)}getSampler(){return this.getRef("sampler")}setSampler(o){return this.setRef("sampler",o)}}index_modern_AnimationChannel.TargetPath={TRANSLATION:"translation",ROTATION:"rotation",SCALE:"scale",WEIGHTS:"weights"};class index_modern_AnimationSampler extends ExtensibleProperty{init(){this.propertyType=index_modern_PropertyType.ANIMATION_SAMPLER}getDefaultAttributes(){return Object.assign(super.getDefaults(),{interpolation:index_modern_AnimationSampler.Interpolation.LINEAR,input:null,output:null})}getInterpolation(){return this.get("interpolation")}setInterpolation(o){return this.set("interpolation",o)}getInput(){return this.getRef("input")}setInput(o){return this.setRef("input",o,{usage:BufferViewUsage$1.OTHER})}getOutput(){return this.getRef("output")}setOutput(o){return this.setRef("output",o,{usage:BufferViewUsage$1.OTHER})}}index_modern_AnimationSampler.Interpolation={LINEAR:"LINEAR",STEP:"STEP",CUBICSPLINE:"CUBICSPLINE"};class Buffer$1 extends ExtensibleProperty{init(){this.propertyType=index_modern_PropertyType.BUFFER}getDefaults(){return Object.assign(super.getDefaults(),{uri:""})}getURI(){return this.get("uri")}setURI(o){return this.set("uri",o)}}class Camera extends ExtensibleProperty{init(){this.propertyType=index_modern_PropertyType.CAMERA}getDefaults(){return Object.assign(super.getDefaults(),{type:Camera.Type.PERSPECTIVE,znear:.1,zfar:100,aspectRatio:null,yfov:2*Math.PI*50/360,xmag:1,ymag:1})}getType(){return this.get("type")}setType(o){return this.set("type",o)}getZNear(){return this.get("znear")}setZNear(o){return this.set("znear",o)}getZFar(){return this.get("zfar")}setZFar(o){return this.set("zfar",o)}getAspectRatio(){return this.get("aspectRatio")}setAspectRatio(o){return this.set("aspectRatio",o)}getYFov(){return this.get("yfov")}setYFov(o){return this.set("yfov",o)}getXMag(){return this.get("xmag")}setXMag(o){return this.set("xmag",o)}getYMag(){return this.get("ymag")}setYMag(o){return this.set("ymag",o)}}Camera.Type={PERSPECTIVE:"perspective",ORTHOGRAPHIC:"orthographic"};class index_modern_ExtensionProperty extends Property{_validateParent(o){if(!this.parentTypes.includes(o.propertyType))throw new Error(`Parent "${o.propertyType}" invalid for child "${this.propertyType}".`)}}index_modern_ExtensionProperty.EXTENSION_NAME=void 0;class index_modern_TextureInfo extends ExtensibleProperty{init(){this.propertyType=index_modern_PropertyType.TEXTURE_INFO}getDefaults(){return Object.assign(super.getDefaults(),{texCoord:0,magFilter:null,minFilter:null,wrapS:index_modern_TextureInfo.WrapMode.REPEAT,wrapT:index_modern_TextureInfo.WrapMode.REPEAT})}getTexCoord(){return this.get("texCoord")}setTexCoord(o){return this.set("texCoord",o)}getMagFilter(){return this.get("magFilter")}setMagFilter(o){return this.set("magFilter",o)}getMinFilter(){return this.get("minFilter")}setMinFilter(o){return this.set("minFilter",o)}getWrapS(){return this.get("wrapS")}setWrapS(o){return this.set("wrapS",o)}getWrapT(){return this.get("wrapT")}setWrapT(o){return this.set("wrapT",o)}}index_modern_TextureInfo.WrapMode={CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,REPEAT:10497},index_modern_TextureInfo.MagFilter={NEAREST:9728,LINEAR:9729},index_modern_TextureInfo.MinFilter={NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987};const{R:index_modern_R,G:index_modern_G,B:index_modern_B,A:index_modern_A}=index_modern_TextureChannel;class index_modern_Material extends ExtensibleProperty{init(){this.propertyType=index_modern_PropertyType.MATERIAL}getDefaults(){return Object.assign(super.getDefaults(),{alphaMode:index_modern_Material.AlphaMode.OPAQUE,alphaCutoff:.5,doubleSided:!1,baseColorFactor:[1,1,1,1],baseColorTexture:null,baseColorTextureInfo:new index_modern_TextureInfo(this.graph,"baseColorTextureInfo"),emissiveFactor:[0,0,0],emissiveTexture:null,emissiveTextureInfo:new index_modern_TextureInfo(this.graph,"emissiveTextureInfo"),normalScale:1,normalTexture:null,normalTextureInfo:new index_modern_TextureInfo(this.graph,"normalTextureInfo"),occlusionStrength:1,occlusionTexture:null,occlusionTextureInfo:new index_modern_TextureInfo(this.graph,"occlusionTextureInfo"),roughnessFactor:1,metallicFactor:1,metallicRoughnessTexture:null,metallicRoughnessTextureInfo:new index_modern_TextureInfo(this.graph,"metallicRoughnessTextureInfo")})}getDoubleSided(){return this.get("doubleSided")}setDoubleSided(o){return this.set("doubleSided",o)}getAlpha(){return this.get("baseColorFactor")[3]}setAlpha(o){const c=this.get("baseColorFactor").slice();return c[3]=o,this.set("baseColorFactor",c)}getAlphaMode(){return this.get("alphaMode")}setAlphaMode(o){return this.set("alphaMode",o)}getAlphaCutoff(){return this.get("alphaCutoff")}setAlphaCutoff(o){return this.set("alphaCutoff",o)}getBaseColorFactor(){return this.get("baseColorFactor")}setBaseColorFactor(o){return this.set("baseColorFactor",o)}getBaseColorTexture(){return this.getRef("baseColorTexture")}getBaseColorTextureInfo(){return this.getRef("baseColorTexture")?this.getRef("baseColorTextureInfo"):null}setBaseColorTexture(o){return this.setRef("baseColorTexture",o,{channels:index_modern_R|index_modern_G|index_modern_B|index_modern_A,isColor:!0})}getEmissiveFactor(){return this.get("emissiveFactor")}setEmissiveFactor(o){return this.set("emissiveFactor",o)}getEmissiveTexture(){return this.getRef("emissiveTexture")}getEmissiveTextureInfo(){return this.getRef("emissiveTexture")?this.getRef("emissiveTextureInfo"):null}setEmissiveTexture(o){return this.setRef("emissiveTexture",o,{channels:index_modern_R|index_modern_G|index_modern_B,isColor:!0})}getNormalScale(){return this.get("normalScale")}setNormalScale(o){return this.set("normalScale",o)}getNormalTexture(){return this.getRef("normalTexture")}getNormalTextureInfo(){return this.getRef("normalTexture")?this.getRef("normalTextureInfo"):null}setNormalTexture(o){return this.setRef("normalTexture",o,{channels:index_modern_R|index_modern_G|index_modern_B})}getOcclusionStrength(){return this.get("occlusionStrength")}setOcclusionStrength(o){return this.set("occlusionStrength",o)}getOcclusionTexture(){return this.getRef("occlusionTexture")}getOcclusionTextureInfo(){return this.getRef("occlusionTexture")?this.getRef("occlusionTextureInfo"):null}setOcclusionTexture(o){return this.setRef("occlusionTexture",o,{channels:index_modern_R})}getRoughnessFactor(){return this.get("roughnessFactor")}setRoughnessFactor(o){return this.set("roughnessFactor",o)}getMetallicFactor(){return this.get("metallicFactor")}setMetallicFactor(o){return this.set("metallicFactor",o)}getMetallicRoughnessTexture(){return this.getRef("metallicRoughnessTexture")}getMetallicRoughnessTextureInfo(){return this.getRef("metallicRoughnessTexture")?this.getRef("metallicRoughnessTextureInfo"):null}setMetallicRoughnessTexture(o){return this.setRef("metallicRoughnessTexture",o,{channels:index_modern_G|index_modern_B})}}index_modern_Material.AlphaMode={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};class index_modern_Mesh extends ExtensibleProperty{init(){this.propertyType=index_modern_PropertyType.MESH}getDefaults(){return Object.assign(super.getDefaults(),{weights:[],primitives:new RefSet})}addPrimitive(o){return this.addRef("primitives",o)}removePrimitive(o){return this.removeRef("primitives",o)}listPrimitives(){return this.listRefs("primitives")}getWeights(){return this.get("weights")}setWeights(o){return this.set("weights",o)}}class index_modern_Node extends ExtensibleProperty{init(){this.propertyType=index_modern_PropertyType.NODE}getDefaults(){return Object.assign(super.getDefaults(),{translation:[0,0,0],rotation:[0,0,0,1],scale:[1,1,1],weights:[],camera:null,mesh:null,skin:null,children:new RefSet})}copy(o,c=COPY_IDENTITY){if(c===COPY_IDENTITY)throw new Error("Node cannot be copied.");return super.copy(o,c)}getTranslation(){return this.get("translation")}getRotation(){return this.get("rotation")}getScale(){return this.get("scale")}setTranslation(o){return this.set("translation",o)}setRotation(o){return this.set("rotation",o)}setScale(o){return this.set("scale",o)}getMatrix(){return index_modern_MathUtils.compose(this.get("translation"),this.get("rotation"),this.get("scale"),[])}setMatrix(o){const c=this.get("translation").slice(),d=this.get("rotation").slice(),_=this.get("scale").slice();return index_modern_MathUtils.decompose(o,c,d,_),this.set("translation",c).set("rotation",d).set("scale",_)}getWorldTranslation(){const o=[0,0,0];return index_modern_MathUtils.decompose(this.getWorldMatrix(),o,[0,0,0,1],[1,1,1]),o}getWorldRotation(){const o=[0,0,0,1];return index_modern_MathUtils.decompose(this.getWorldMatrix(),[0,0,0],o,[1,1,1]),o}getWorldScale(){const o=[1,1,1];return index_modern_MathUtils.decompose(this.getWorldMatrix(),[0,0,0],[0,0,0,1],o),o}getWorldMatrix(){const o=[];for(let _=this;_!=null;_=_.getParentNode())o.push(_);let c;const d=o.pop().getMatrix();for(;c=o.pop();)multiply(d,d,c.getMatrix());return d}addChild(o){const c=o.getParentNode();c&&c.removeChild(o);for(const d of o.listParents())d.propertyType===index_modern_PropertyType.SCENE&&d.removeChild(o);return this.addRef("children",o)}removeChild(o){return this.removeRef("children",o)}listChildren(){return this.listRefs("children")}getParentNode(){for(const o of this.listParents())if(o.propertyType===index_modern_PropertyType.NODE)return o;return null}getMesh(){return this.getRef("mesh")}setMesh(o){return this.setRef("mesh",o)}getCamera(){return this.getRef("camera")}setCamera(o){return this.setRef("camera",o)}getSkin(){return this.getRef("skin")}setSkin(o){return this.setRef("skin",o)}getWeights(){return this.get("weights")}setWeights(o){return this.set("weights",o)}traverse(o){o(this);for(const c of this.listChildren())c.traverse(o);return this}}class index_modern_Primitive extends ExtensibleProperty{init(){this.propertyType=index_modern_PropertyType.PRIMITIVE}getDefaults(){return Object.assign(super.getDefaults(),{mode:index_modern_Primitive.Mode.TRIANGLES,material:null,indices:null,attributes:new RefMap,targets:new RefSet})}getIndices(){return this.getRef("indices")}setIndices(o){return this.setRef("indices",o,{usage:BufferViewUsage$1.ELEMENT_ARRAY_BUFFER})}getAttribute(o){return this.getRefMap("attributes",o)}setAttribute(o,c){return this.setRefMap("attributes",o,c,{usage:BufferViewUsage$1.ARRAY_BUFFER})}listAttributes(){return this.listRefMapValues("attributes")}listSemantics(){return this.listRefMapKeys("attributes")}getMaterial(){return this.getRef("material")}setMaterial(o){return this.setRef("material",o)}getMode(){return this.get("mode")}setMode(o){return this.set("mode",o)}listTargets(){return this.listRefs("targets")}addTarget(o){return this.addRef("targets",o)}removeTarget(o){return this.removeRef("targets",o)}}index_modern_Primitive.Mode={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6};class index_modern_PrimitiveTarget extends Property{init(){this.propertyType=index_modern_PropertyType.PRIMITIVE_TARGET}getDefaults(){return Object.assign(super.getDefaults(),{attributes:new RefMap})}getAttribute(o){return this.getRefMap("attributes",o)}setAttribute(o,c){return this.setRefMap("attributes",o,c,{usage:BufferViewUsage$1.ARRAY_BUFFER})}listAttributes(){return this.listRefMapValues("attributes")}listSemantics(){return this.listRefMapKeys("attributes")}}function index_modern_extends(){return index_modern_extends=Object.assign?Object.assign.bind():function(h){for(var o=1;o<arguments.length;o++){var c=arguments[o];for(var d in c)({}).hasOwnProperty.call(c,d)&&(h[d]=c[d])}return h},index_modern_extends.apply(null,arguments)}class index_modern_Scene extends ExtensibleProperty{init(){this.propertyType=index_modern_PropertyType.SCENE}getDefaults(){return Object.assign(super.getDefaults(),{children:new RefSet})}copy(o,c=COPY_IDENTITY){if(c===COPY_IDENTITY)throw new Error("Scene cannot be copied.");return super.copy(o,c)}addChild(o){const c=o.getParentNode();return c&&c.removeChild(o),this.addRef("children",o)}removeChild(o){return this.removeRef("children",o)}listChildren(){return this.listRefs("children")}traverse(o){for(const c of this.listChildren())c.traverse(o);return this}}class Skin extends ExtensibleProperty{init(){this.propertyType=index_modern_PropertyType.SKIN}getDefaults(){return Object.assign(super.getDefaults(),{skeleton:null,inverseBindMatrices:null,joints:new RefSet})}getSkeleton(){return this.getRef("skeleton")}setSkeleton(o){return this.setRef("skeleton",o)}getInverseBindMatrices(){return this.getRef("inverseBindMatrices")}setInverseBindMatrices(o){return this.setRef("inverseBindMatrices",o,{usage:BufferViewUsage$1.INVERSE_BIND_MATRICES})}addJoint(o){return this.addRef("joints",o)}removeJoint(o){return this.removeRef("joints",o)}listJoints(){return this.listRefs("joints")}}class index_modern_Texture extends ExtensibleProperty{init(){this.propertyType=index_modern_PropertyType.TEXTURE}getDefaults(){return Object.assign(super.getDefaults(),{image:null,mimeType:"",uri:""})}getMimeType(){return this.get("mimeType")||index_modern_ImageUtils.extensionToMimeType(index_modern_FileUtils.extension(this.get("uri")))}setMimeType(o){return this.set("mimeType",o)}getURI(){return this.get("uri")}setURI(o){this.set("uri",o);const c=index_modern_ImageUtils.extensionToMimeType(index_modern_FileUtils.extension(o));return c&&this.set("mimeType",c),this}getImage(){return this.get("image")}setImage(o){return this.set("image",index_modern_BufferUtils.assertView(o))}getSize(){const o=this.get("image");return o?index_modern_ImageUtils.getSize(o,this.getMimeType()):null}}class index_modern_Root extends ExtensibleProperty{init(){this.propertyType=index_modern_PropertyType.ROOT}getDefaults(){return Object.assign(super.getDefaults(),{asset:{generator:`glTF-Transform ${VERSION}`,version:"2.0"},defaultScene:null,accessors:new RefSet,animations:new RefSet,buffers:new RefSet,cameras:new RefSet,materials:new RefSet,meshes:new RefSet,nodes:new RefSet,scenes:new RefSet,skins:new RefSet,textures:new RefSet})}constructor(o){super(o),this._extensions=new Set,o.addEventListener("node:create",c=>{this._addChildOfRoot(c.target)})}clone(){throw new Error("Root cannot be cloned.")}copy(o,c=COPY_IDENTITY){if(c===COPY_IDENTITY)throw new Error("Root cannot be copied.");this.set("asset",index_modern_extends({},o.get("asset"))),this.setName(o.getName()),this.setExtras(index_modern_extends({},o.getExtras())),this.setDefaultScene(o.getDefaultScene()?c(o.getDefaultScene()):null);for(const d of o.listRefMapKeys("extensions")){const _=o.getExtension(d);this.setExtension(d,c(_))}return this}_addChildOfRoot(o){return o instanceof index_modern_Scene?this.addRef("scenes",o):o instanceof index_modern_Node?this.addRef("nodes",o):o instanceof Camera?this.addRef("cameras",o):o instanceof Skin?this.addRef("skins",o):o instanceof index_modern_Mesh?this.addRef("meshes",o):o instanceof index_modern_Material?this.addRef("materials",o):o instanceof index_modern_Texture?this.addRef("textures",o):o instanceof Animation?this.addRef("animations",o):o instanceof index_modern_Accessor?this.addRef("accessors",o):o instanceof Buffer$1&&this.addRef("buffers",o),this}getAsset(){return this.get("asset")}listExtensionsUsed(){return Array.from(this._extensions)}listExtensionsRequired(){return this.listExtensionsUsed().filter(o=>o.isRequired())}_enableExtension(o){return this._extensions.add(o),this}_disableExtension(o){return this._extensions.delete(o),this}listScenes(){return this.listRefs("scenes")}setDefaultScene(o){return this.setRef("defaultScene",o)}getDefaultScene(){return this.getRef("defaultScene")}listNodes(){return this.listRefs("nodes")}listCameras(){return this.listRefs("cameras")}listSkins(){return this.listRefs("skins")}listMeshes(){return this.listRefs("meshes")}listMaterials(){return this.listRefs("materials")}listTextures(){return this.listRefs("textures")}listAnimations(){return this.listRefs("animations")}listAccessors(){return this.listRefs("accessors")}listBuffers(){return this.listRefs("buffers")}}class index_modern_Document{static fromGraph(o){return index_modern_Document._GRAPH_DOCUMENTS.get(o)||null}constructor(){this._graph=new Graph,this._root=new index_modern_Root(this._graph),this._logger=Logger.DEFAULT_INSTANCE,index_modern_Document._GRAPH_DOCUMENTS.set(this._graph,this)}getRoot(){return this._root}getGraph(){return this._graph}getLogger(){return this._logger}setLogger(o){return this._logger=o,this}clone(){throw new Error("Use 'cloneDocument(source)' from '@gltf-transform/functions'.")}merge(o){throw new Error("Use 'mergeDocuments(target, source)' from '@gltf-transform/functions'.")}async transform(...o){const c=o.map(d=>d.name);for(const d of o)await d(this,{stack:c});return this}createExtension(o){const c=o.EXTENSION_NAME;return this.getRoot().listExtensionsUsed().find(d=>d.extensionName===c)||new o(this)}createScene(o=""){return new index_modern_Scene(this._graph,o)}createNode(o=""){return new index_modern_Node(this._graph,o)}createCamera(o=""){return new Camera(this._graph,o)}createSkin(o=""){return new Skin(this._graph,o)}createMesh(o=""){return new index_modern_Mesh(this._graph,o)}createPrimitive(){return new index_modern_Primitive(this._graph)}createPrimitiveTarget(o=""){return new index_modern_PrimitiveTarget(this._graph,o)}createMaterial(o=""){return new index_modern_Material(this._graph,o)}createTexture(o=""){return new index_modern_Texture(this._graph,o)}createAnimation(o=""){return new Animation(this._graph,o)}createAnimationChannel(o=""){return new index_modern_AnimationChannel(this._graph,o)}createAnimationSampler(o=""){return new index_modern_AnimationSampler(this._graph,o)}createAccessor(o="",c=null){return c||(c=this.getRoot().listBuffers()[0]),new index_modern_Accessor(this._graph,o).setBuffer(c)}createBuffer(o=""){return new Buffer$1(this._graph,o)}}index_modern_Document._GRAPH_DOCUMENTS=new WeakMap;class Extension{constructor(o){this.extensionName="",this.prereadTypes=[],this.prewriteTypes=[],this.readDependencies=[],this.writeDependencies=[],this.document=void 0,this.required=!1,this.properties=new Set,this._listener=void 0,this.document=o,o.getRoot()._enableExtension(this),this._listener=d=>{const _=d,v=_.target;v instanceof index_modern_ExtensionProperty&&v.extensionName===this.extensionName&&(_.type==="node:create"&&this._addExtensionProperty(v),_.type==="node:dispose"&&this._removeExtensionProperty(v))};const c=o.getGraph();c.addEventListener("node:create",this._listener),c.addEventListener("node:dispose",this._listener)}dispose(){this.document.getRoot()._disableExtension(this);const o=this.document.getGraph();o.removeEventListener("node:create",this._listener),o.removeEventListener("node:dispose",this._listener);for(const c of this.properties)c.dispose()}static register(){}isRequired(){return this.required}setRequired(o){return this.required=o,this}listProperties(){return Array.from(this.properties)}_addExtensionProperty(o){return this.properties.add(o),this}_removeExtensionProperty(o){return this.properties.delete(o),this}install(o,c){return this}preread(o,c){return this}prewrite(o,c){return this}}Extension.EXTENSION_NAME=void 0;class ReaderContext{constructor(o){this.jsonDoc=void 0,this.buffers=[],this.bufferViews=[],this.bufferViewBuffers=[],this.accessors=[],this.textures=[],this.textureInfos=new Map,this.materials=[],this.meshes=[],this.cameras=[],this.nodes=[],this.skins=[],this.animations=[],this.scenes=[],this.jsonDoc=o}setTextureInfo(o,c){this.textureInfos.set(o,c),c.texCoord!==void 0&&o.setTexCoord(c.texCoord),c.extras!==void 0&&o.setExtras(c.extras);const d=this.jsonDoc.json.textures[c.index];if(d.sampler===void 0)return;const _=this.jsonDoc.json.samplers[d.sampler];_.magFilter!==void 0&&o.setMagFilter(_.magFilter),_.minFilter!==void 0&&o.setMinFilter(_.minFilter),_.wrapS!==void 0&&o.setWrapS(_.wrapS),_.wrapT!==void 0&&o.setWrapT(_.wrapT)}}const index_modern_DEFAULT_OPTIONS={logger:Logger.DEFAULT_INSTANCE,extensions:[],dependencies:{}},SUPPORTED_PREREAD_TYPES=new Set([index_modern_PropertyType.BUFFER,index_modern_PropertyType.TEXTURE,index_modern_PropertyType.MATERIAL,index_modern_PropertyType.MESH,index_modern_PropertyType.PRIMITIVE,index_modern_PropertyType.NODE,index_modern_PropertyType.SCENE]);class GLTFReader{static read(o,c=index_modern_DEFAULT_OPTIONS){const d=index_modern_extends({},index_modern_DEFAULT_OPTIONS,c),{json:_}=o,v=new index_modern_Document().setLogger(d.logger);this.validate(o,d);const b=new ReaderContext(o),tt=_.asset,it=v.getRoot().getAsset();tt.copyright&&(it.copyright=tt.copyright),tt.extras&&(it.extras=tt.extras),_.extras!==void 0&&v.getRoot().setExtras(index_modern_extends({},_.extras));const nt=_.extensionsUsed||[],lt=_.extensionsRequired||[];d.extensions.sort((Dt,It)=>Dt.EXTENSION_NAME>It.EXTENSION_NAME?1:-1);for(const Dt of d.extensions)if(nt.includes(Dt.EXTENSION_NAME)){const It=v.createExtension(Dt).setRequired(lt.includes(Dt.EXTENSION_NAME)),Nt=It.prereadTypes.filter(Vt=>!SUPPORTED_PREREAD_TYPES.has(Vt));Nt.length&&d.logger.warn(`Preread hooks for some types (${Nt.join()}), requested by extension ${It.extensionName}, are unsupported. Please file an issue or a PR.`);for(const Vt of It.readDependencies)It.install(Vt,d.dependencies[Vt])}const ut=_.buffers||[];v.getRoot().listExtensionsUsed().filter(Dt=>Dt.prereadTypes.includes(index_modern_PropertyType.BUFFER)).forEach(Dt=>Dt.preread(b,index_modern_PropertyType.BUFFER)),b.buffers=ut.map(Dt=>{const It=v.createBuffer(Dt.name);return Dt.extras&&It.setExtras(Dt.extras),Dt.uri&&Dt.uri.indexOf("__")!==0&&It.setURI(Dt.uri),It});const ht=_.bufferViews||[];b.bufferViewBuffers=ht.map((Dt,It)=>{if(!b.bufferViews[It]){const Nt=o.json.buffers[Dt.buffer],Vt=Nt.uri?o.resources[Nt.uri]:o.resources[GLB_BUFFER],Kt=Dt.byteOffset||0;b.bufferViews[It]=index_modern_BufferUtils.toView(Vt,Kt,Dt.byteLength)}return b.buffers[Dt.buffer]});const _t=_.accessors||[];b.accessors=_t.map(Dt=>{const It=b.bufferViewBuffers[Dt.bufferView],Nt=v.createAccessor(Dt.name,It).setType(Dt.type);return Dt.extras&&Nt.setExtras(Dt.extras),Dt.normalized!==void 0&&Nt.setNormalized(Dt.normalized),Dt.bufferView===void 0||Nt.setArray(getAccessorArray(Dt,b)),Nt});const ft=_.images||[],bt=_.textures||[];v.getRoot().listExtensionsUsed().filter(Dt=>Dt.prereadTypes.includes(index_modern_PropertyType.TEXTURE)).forEach(Dt=>Dt.preread(b,index_modern_PropertyType.TEXTURE)),b.textures=ft.map(Dt=>{const It=v.createTexture(Dt.name);if(Dt.extras&&It.setExtras(Dt.extras),Dt.bufferView!==void 0){const Nt=_.bufferViews[Dt.bufferView],Vt=o.json.buffers[Nt.buffer],Kt=Vt.uri?o.resources[Vt.uri]:o.resources[GLB_BUFFER],Yt=Nt.byteOffset||0,nr=Nt.byteLength,rr=Kt.slice(Yt,Yt+nr);It.setImage(rr)}else Dt.uri!==void 0&&(It.setImage(o.resources[Dt.uri]),Dt.uri.indexOf("__")!==0&&It.setURI(Dt.uri));if(Dt.mimeType!==void 0)It.setMimeType(Dt.mimeType);else if(Dt.uri){const Nt=index_modern_FileUtils.extension(Dt.uri);It.setMimeType(index_modern_ImageUtils.extensionToMimeType(Nt))}return It}),v.getRoot().listExtensionsUsed().filter(Dt=>Dt.prereadTypes.includes(index_modern_PropertyType.MATERIAL)).forEach(Dt=>Dt.preread(b,index_modern_PropertyType.MATERIAL));const xt=_.materials||[];b.materials=xt.map(Dt=>{const It=v.createMaterial(Dt.name);Dt.extras&&It.setExtras(Dt.extras),Dt.alphaMode!==void 0&&It.setAlphaMode(Dt.alphaMode),Dt.alphaCutoff!==void 0&&It.setAlphaCutoff(Dt.alphaCutoff),Dt.doubleSided!==void 0&&It.setDoubleSided(Dt.doubleSided);const Nt=Dt.pbrMetallicRoughness||{};if(Nt.baseColorFactor!==void 0&&It.setBaseColorFactor(Nt.baseColorFactor),Dt.emissiveFactor!==void 0&&It.setEmissiveFactor(Dt.emissiveFactor),Nt.metallicFactor!==void 0&&It.setMetallicFactor(Nt.metallicFactor),Nt.roughnessFactor!==void 0&&It.setRoughnessFactor(Nt.roughnessFactor),Nt.baseColorTexture!==void 0){const Vt=Nt.baseColorTexture,Kt=b.textures[bt[Vt.index].source];It.setBaseColorTexture(Kt),b.setTextureInfo(It.getBaseColorTextureInfo(),Vt)}if(Dt.emissiveTexture!==void 0){const Vt=Dt.emissiveTexture,Kt=b.textures[bt[Vt.index].source];It.setEmissiveTexture(Kt),b.setTextureInfo(It.getEmissiveTextureInfo(),Vt)}if(Dt.normalTexture!==void 0){const Vt=Dt.normalTexture,Kt=b.textures[bt[Vt.index].source];It.setNormalTexture(Kt),b.setTextureInfo(It.getNormalTextureInfo(),Vt),Dt.normalTexture.scale!==void 0&&It.setNormalScale(Dt.normalTexture.scale)}if(Dt.occlusionTexture!==void 0){const Vt=Dt.occlusionTexture,Kt=b.textures[bt[Vt.index].source];It.setOcclusionTexture(Kt),b.setTextureInfo(It.getOcclusionTextureInfo(),Vt),Dt.occlusionTexture.strength!==void 0&&It.setOcclusionStrength(Dt.occlusionTexture.strength)}if(Nt.metallicRoughnessTexture!==void 0){const Vt=Nt.metallicRoughnessTexture,Kt=b.textures[bt[Vt.index].source];It.setMetallicRoughnessTexture(Kt),b.setTextureInfo(It.getMetallicRoughnessTextureInfo(),Vt)}return It}),v.getRoot().listExtensionsUsed().filter(Dt=>Dt.prereadTypes.includes(index_modern_PropertyType.MESH)).forEach(Dt=>Dt.preread(b,index_modern_PropertyType.MESH));const St=_.meshes||[];v.getRoot().listExtensionsUsed().filter(Dt=>Dt.prereadTypes.includes(index_modern_PropertyType.PRIMITIVE)).forEach(Dt=>Dt.preread(b,index_modern_PropertyType.PRIMITIVE)),b.meshes=St.map(Dt=>{const It=v.createMesh(Dt.name);return Dt.extras&&It.setExtras(Dt.extras),Dt.weights!==void 0&&It.setWeights(Dt.weights),(Dt.primitives||[]).forEach(Nt=>{const Vt=v.createPrimitive();Nt.extras&&Vt.setExtras(Nt.extras),Nt.material!==void 0&&Vt.setMaterial(b.materials[Nt.material]),Nt.mode!==void 0&&Vt.setMode(Nt.mode);for(const[Yt,nr]of Object.entries(Nt.attributes||{}))Vt.setAttribute(Yt,b.accessors[nr]);Nt.indices!==void 0&&Vt.setIndices(b.accessors[Nt.indices]);const Kt=Dt.extras&&Dt.extras.targetNames||[];(Nt.targets||[]).forEach((Yt,nr)=>{const rr=Kt[nr]||nr.toString(),lr=v.createPrimitiveTarget(rr);for(const[or,pr]of Object.entries(Yt))lr.setAttribute(or,b.accessors[pr]);Vt.addTarget(lr)}),It.addPrimitive(Vt)}),It});const wt=_.cameras||[];b.cameras=wt.map(Dt=>{const It=v.createCamera(Dt.name).setType(Dt.type);if(Dt.extras&&It.setExtras(Dt.extras),Dt.type===Camera.Type.PERSPECTIVE){const Nt=Dt.perspective;It.setYFov(Nt.yfov),It.setZNear(Nt.znear),Nt.zfar!==void 0&&It.setZFar(Nt.zfar),Nt.aspectRatio!==void 0&&It.setAspectRatio(Nt.aspectRatio)}else{const Nt=Dt.orthographic;It.setZNear(Nt.znear).setZFar(Nt.zfar).setXMag(Nt.xmag).setYMag(Nt.ymag)}return It});const Pt=_.nodes||[];v.getRoot().listExtensionsUsed().filter(Dt=>Dt.prereadTypes.includes(index_modern_PropertyType.NODE)).forEach(Dt=>Dt.preread(b,index_modern_PropertyType.NODE)),b.nodes=Pt.map(Dt=>{const It=v.createNode(Dt.name);if(Dt.extras&&It.setExtras(Dt.extras),Dt.translation!==void 0&&It.setTranslation(Dt.translation),Dt.rotation!==void 0&&It.setRotation(Dt.rotation),Dt.scale!==void 0&&It.setScale(Dt.scale),Dt.matrix!==void 0){const Nt=[0,0,0],Vt=[0,0,0,1],Kt=[1,1,1];index_modern_MathUtils.decompose(Dt.matrix,Nt,Vt,Kt),It.setTranslation(Nt),It.setRotation(Vt),It.setScale(Kt)}return Dt.weights!==void 0&&It.setWeights(Dt.weights),It});const Rt=_.skins||[];b.skins=Rt.map(Dt=>{const It=v.createSkin(Dt.name);Dt.extras&&It.setExtras(Dt.extras),Dt.inverseBindMatrices!==void 0&&It.setInverseBindMatrices(b.accessors[Dt.inverseBindMatrices]),Dt.skeleton!==void 0&&It.setSkeleton(b.nodes[Dt.skeleton]);for(const Nt of Dt.joints)It.addJoint(b.nodes[Nt]);return It}),Pt.map((Dt,It)=>{const Nt=b.nodes[It];(Dt.children||[]).forEach(Vt=>Nt.addChild(b.nodes[Vt])),Dt.mesh!==void 0&&Nt.setMesh(b.meshes[Dt.mesh]),Dt.camera!==void 0&&Nt.setCamera(b.cameras[Dt.camera]),Dt.skin!==void 0&&Nt.setSkin(b.skins[Dt.skin])});const kt=_.animations||[];b.animations=kt.map(Dt=>{const It=v.createAnimation(Dt.name);Dt.extras&&It.setExtras(Dt.extras);const Nt=(Dt.samplers||[]).map(Vt=>{const Kt=v.createAnimationSampler().setInput(b.accessors[Vt.input]).setOutput(b.accessors[Vt.output]).setInterpolation(Vt.interpolation||index_modern_AnimationSampler.Interpolation.LINEAR);return Vt.extras&&Kt.setExtras(Vt.extras),It.addSampler(Kt),Kt});return(Dt.channels||[]).forEach(Vt=>{const Kt=v.createAnimationChannel().setSampler(Nt[Vt.sampler]).setTargetPath(Vt.target.path);Vt.target.node!==void 0&&Kt.setTargetNode(b.nodes[Vt.target.node]),Vt.extras&&Kt.setExtras(Vt.extras),It.addChannel(Kt)}),It});const Gt=_.scenes||[];return v.getRoot().listExtensionsUsed().filter(Dt=>Dt.prereadTypes.includes(index_modern_PropertyType.SCENE)).forEach(Dt=>Dt.preread(b,index_modern_PropertyType.SCENE)),b.scenes=Gt.map(Dt=>{const It=v.createScene(Dt.name);return Dt.extras&&It.setExtras(Dt.extras),(Dt.nodes||[]).map(Nt=>b.nodes[Nt]).forEach(Nt=>It.addChild(Nt)),It}),_.scene!==void 0&&v.getRoot().setDefaultScene(b.scenes[_.scene]),v.getRoot().listExtensionsUsed().forEach(Dt=>Dt.read(b)),_t.forEach((Dt,It)=>{const Nt=b.accessors[It],Vt=!!Dt.sparse,Kt=!Dt.bufferView&&!Nt.getArray();(Vt||Kt)&&Nt.setSparse(!0).setArray(getSparseArray(Dt,b))}),v}static validate(o,c){const d=o.json;if(d.asset.version!=="2.0")throw new Error(`Unsupported glTF version, "${d.asset.version}".`);if(d.extensionsRequired){for(const _ of d.extensionsRequired)if(!c.extensions.find(v=>v.EXTENSION_NAME===_))throw new Error(`Missing required extension, "${_}".`)}if(d.extensionsUsed)for(const _ of d.extensionsUsed)c.extensions.find(v=>v.EXTENSION_NAME===_)||c.logger.warn(`Missing optional extension, "${_}".`)}}function getInterleavedArray(h,o){const c=o.jsonDoc,d=o.bufferViews[h.bufferView],_=c.json.bufferViews[h.bufferView],v=index_modern_ComponentTypeToTypedArray[h.componentType],b=index_modern_Accessor.getElementSize(h.type),tt=v.BYTES_PER_ELEMENT,it=h.byteOffset||0,nt=new v(h.count*b),lt=new DataView(d.buffer,d.byteOffset,d.byteLength),ut=_.byteStride;for(let ht=0;ht<h.count;ht++)for(let _t=0;_t<b;_t++){const ft=it+ht*ut+_t*tt;let bt;switch(h.componentType){case index_modern_Accessor.ComponentType.FLOAT:bt=lt.getFloat32(ft,!0);break;case index_modern_Accessor.ComponentType.UNSIGNED_INT:bt=lt.getUint32(ft,!0);break;case index_modern_Accessor.ComponentType.UNSIGNED_SHORT:bt=lt.getUint16(ft,!0);break;case index_modern_Accessor.ComponentType.UNSIGNED_BYTE:bt=lt.getUint8(ft);break;case index_modern_Accessor.ComponentType.SHORT:bt=lt.getInt16(ft,!0);break;case index_modern_Accessor.ComponentType.BYTE:bt=lt.getInt8(ft);break;default:throw new Error(`Unexpected componentType "${h.componentType}".`)}nt[ht*b+_t]=bt}return nt}function getAccessorArray(h,o){const c=o.jsonDoc,d=o.bufferViews[h.bufferView],_=c.json.bufferViews[h.bufferView],v=index_modern_ComponentTypeToTypedArray[h.componentType],b=index_modern_Accessor.getElementSize(h.type),tt=v.BYTES_PER_ELEMENT,it=b*tt;if(_.byteStride!==void 0&&_.byteStride!==it)return getInterleavedArray(h,o);const nt=d.byteOffset+(h.byteOffset||0),lt=h.count*b*tt;return new v(d.buffer.slice(nt,nt+lt))}function getSparseArray(h,o){const c=index_modern_ComponentTypeToTypedArray[h.componentType],d=index_modern_Accessor.getElementSize(h.type);let _;_=h.bufferView!==void 0?getAccessorArray(h,o):new c(h.count*d);const v=h.sparse;if(!v)return _;const b=v.count,tt=index_modern_extends({},h,v.indices,{count:b,type:"SCALAR"}),it=index_modern_extends({},h,v.values,{count:b}),nt=getAccessorArray(tt,o),lt=getAccessorArray(it,o);for(let ut=0;ut<tt.count;ut++)for(let ht=0;ht<d;ht++)_[nt[ut]*d+ht]=lt[ut*d+ht];return _}var BufferViewTarget;(function(h){h[h.ARRAY_BUFFER=34962]="ARRAY_BUFFER",h[h.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER"})(BufferViewTarget||(BufferViewTarget={}));class WriterContext{constructor(o,c,d){this._doc=void 0,this.jsonDoc=void 0,this.options=void 0,this.accessorIndexMap=new Map,this.animationIndexMap=new Map,this.bufferIndexMap=new Map,this.cameraIndexMap=new Map,this.skinIndexMap=new Map,this.materialIndexMap=new Map,this.meshIndexMap=new Map,this.nodeIndexMap=new Map,this.imageIndexMap=new Map,this.textureDefIndexMap=new Map,this.textureInfoDefMap=new Map,this.samplerDefIndexMap=new Map,this.sceneIndexMap=new Map,this.imageBufferViews=[],this.otherBufferViews=new Map,this.otherBufferViewsIndexMap=new Map,this.extensionData={},this.bufferURIGenerator=void 0,this.imageURIGenerator=void 0,this.logger=void 0,this._accessorUsageMap=new Map,this.accessorUsageGroupedByParent=new Set(["ARRAY_BUFFER"]),this.accessorParents=new Map,this._doc=o,this.jsonDoc=c,this.options=d;const _=o.getRoot(),v=_.listBuffers().length,b=_.listTextures().length;this.bufferURIGenerator=new UniqueURIGenerator(v>1,()=>d.basename||"buffer"),this.imageURIGenerator=new UniqueURIGenerator(b>1,tt=>getSlot(o,tt)||d.basename||"texture"),this.logger=o.getLogger()}createTextureInfoDef(o,c){const d={magFilter:c.getMagFilter()||void 0,minFilter:c.getMinFilter()||void 0,wrapS:c.getWrapS(),wrapT:c.getWrapT()},_=JSON.stringify(d);this.samplerDefIndexMap.has(_)||(this.samplerDefIndexMap.set(_,this.jsonDoc.json.samplers.length),this.jsonDoc.json.samplers.push(d));const v={source:this.imageIndexMap.get(o),sampler:this.samplerDefIndexMap.get(_)},b=JSON.stringify(v);this.textureDefIndexMap.has(b)||(this.textureDefIndexMap.set(b,this.jsonDoc.json.textures.length),this.jsonDoc.json.textures.push(v));const tt={index:this.textureDefIndexMap.get(b)};return c.getTexCoord()!==0&&(tt.texCoord=c.getTexCoord()),Object.keys(c.getExtras()).length>0&&(tt.extras=c.getExtras()),this.textureInfoDefMap.set(c,tt),tt}createPropertyDef(o){const c={};return o.getName()&&(c.name=o.getName()),Object.keys(o.getExtras()).length>0&&(c.extras=o.getExtras()),c}createAccessorDef(o){const c=this.createPropertyDef(o);return c.type=o.getType(),c.componentType=o.getComponentType(),c.count=o.getCount(),this._doc.getGraph().listParentEdges(o).some(d=>d.getName()==="attributes"&&d.getAttributes().key==="POSITION"||d.getName()==="input")&&(c.max=o.getMax([]).map(Math.fround),c.min=o.getMin([]).map(Math.fround)),o.getNormalized()&&(c.normalized=o.getNormalized()),c}createImageData(o,c,d){if(this.options.format===Format.GLB)this.imageBufferViews.push(c),o.bufferView=this.jsonDoc.json.bufferViews.length,this.jsonDoc.json.bufferViews.push({buffer:0,byteOffset:-1,byteLength:c.byteLength});else{const _=index_modern_ImageUtils.mimeTypeToExtension(d.getMimeType());o.uri=this.imageURIGenerator.createURI(d,_),this.assignResourceURI(o.uri,c,!1)}}assignResourceURI(o,c,d){const _=this.jsonDoc.resources;if(!(o in _))return void(_[o]=c);if(c===_[o])return void this.logger.warn(`Duplicate resource URI, "${o}".`);const v=`Resource URI "${o}" already assigned to different data.`;if(d)throw new Error(v);this.logger.warn(v)}getAccessorUsage(o){const c=this._accessorUsageMap.get(o);if(c)return c;if(o.getSparse())return BufferViewUsage$1.SPARSE;for(const d of this._doc.getGraph().listParentEdges(o)){const{usage:_}=d.getAttributes();if(_)return _;d.getParent().propertyType!==index_modern_PropertyType.ROOT&&this.logger.warn(`Missing attribute ".usage" on edge, "${d.getName()}".`)}return BufferViewUsage$1.OTHER}addAccessorToUsageGroup(o,c){const d=this._accessorUsageMap.get(o);if(d&&d!==c)throw new Error(`Accessor with usage "${d}" cannot be reused as "${c}".`);return this._accessorUsageMap.set(o,c),this}}WriterContext.BufferViewTarget=BufferViewTarget,WriterContext.BufferViewUsage=BufferViewUsage$1,WriterContext.USAGE_TO_TARGET={[BufferViewUsage$1.ARRAY_BUFFER]:BufferViewTarget.ARRAY_BUFFER,[BufferViewUsage$1.ELEMENT_ARRAY_BUFFER]:BufferViewTarget.ELEMENT_ARRAY_BUFFER};class UniqueURIGenerator{constructor(o,c){this.multiple=void 0,this.basename=void 0,this.counter={},this.multiple=o,this.basename=c}createURI(o,c){if(o.getURI())return o.getURI();if(this.multiple){const d=this.basename(o);return this.counter[d]=this.counter[d]||1,`${d}_${this.counter[d]++}.${c}`}return`${this.basename(o)}.${c}`}}function getSlot(h,o){const c=h.getGraph().listParentEdges(o).find(d=>d.getParent()!==h.getRoot());return c?c.getName().replace(/texture$/i,""):""}const{BufferViewUsage}=WriterContext,{UNSIGNED_INT,UNSIGNED_SHORT,UNSIGNED_BYTE}=index_modern_Accessor.ComponentType,SUPPORTED_PREWRITE_TYPES=new Set([index_modern_PropertyType.ACCESSOR,index_modern_PropertyType.BUFFER,index_modern_PropertyType.MATERIAL,index_modern_PropertyType.MESH]);class index_modern_GLTFWriter{static write(o,c){const d=o.getGraph(),_=o.getRoot(),v={asset:index_modern_extends({generator:`glTF-Transform ${VERSION}`},_.getAsset()),extras:index_modern_extends({},_.getExtras())},b={json:v,resources:{}},tt=new WriterContext(o,b,c),it=c.logger||Logger.DEFAULT_INSTANCE,nt=new Set(c.extensions.map(xt=>xt.EXTENSION_NAME)),lt=o.getRoot().listExtensionsUsed().filter(xt=>nt.has(xt.extensionName)).sort((xt,St)=>xt.extensionName>St.extensionName?1:-1),ut=o.getRoot().listExtensionsRequired().filter(xt=>nt.has(xt.extensionName)).sort((xt,St)=>xt.extensionName>St.extensionName?1:-1);lt.length<o.getRoot().listExtensionsUsed().length&&it.warn("Some extensions were not registered for I/O, and will not be written.");for(const xt of lt){const St=xt.prewriteTypes.filter(wt=>!SUPPORTED_PREWRITE_TYPES.has(wt));St.length&&it.warn(`Prewrite hooks for some types (${St.join()}), requested by extension ${xt.extensionName}, are unsupported. Please file an issue or a PR.`);for(const wt of xt.writeDependencies)xt.install(wt,c.dependencies[wt])}function ht(xt,St,wt,Pt){const Rt=[];let kt=0;for(const Dt of xt){const It=tt.createAccessorDef(Dt);It.bufferView=v.bufferViews.length;const Nt=Dt.getArray(),Vt=index_modern_BufferUtils.pad(index_modern_BufferUtils.toView(Nt));It.byteOffset=kt,kt+=Vt.byteLength,Rt.push(Vt),tt.accessorIndexMap.set(Dt,v.accessors.length),v.accessors.push(It)}const Gt={buffer:St,byteOffset:wt,byteLength:index_modern_BufferUtils.concat(Rt).byteLength};return Pt&&(Gt.target=Pt),v.bufferViews.push(Gt),{buffers:Rt,byteLength:kt}}function _t(xt,St,wt){const Pt=xt[0].getCount();let Rt=0;for(const Nt of xt){const Vt=tt.createAccessorDef(Nt);Vt.bufferView=v.bufferViews.length,Vt.byteOffset=Rt;const Kt=Nt.getElementSize(),Yt=Nt.getComponentSize();Rt+=index_modern_BufferUtils.padNumber(Kt*Yt),tt.accessorIndexMap.set(Nt,v.accessors.length),v.accessors.push(Vt)}const kt=Pt*Rt,Gt=new ArrayBuffer(kt),Dt=new DataView(Gt);for(let Nt=0;Nt<Pt;Nt++){let Vt=0;for(const Kt of xt){const Yt=Kt.getElementSize(),nr=Kt.getComponentSize(),rr=Kt.getComponentType(),lr=Kt.getArray();for(let or=0;or<Yt;or++){const pr=Nt*Rt+Vt+or*nr,hr=lr[Nt*Yt+or];switch(rr){case index_modern_Accessor.ComponentType.FLOAT:Dt.setFloat32(pr,hr,!0);break;case index_modern_Accessor.ComponentType.BYTE:Dt.setInt8(pr,hr);break;case index_modern_Accessor.ComponentType.SHORT:Dt.setInt16(pr,hr,!0);break;case index_modern_Accessor.ComponentType.UNSIGNED_BYTE:Dt.setUint8(pr,hr);break;case index_modern_Accessor.ComponentType.UNSIGNED_SHORT:Dt.setUint16(pr,hr,!0);break;case index_modern_Accessor.ComponentType.UNSIGNED_INT:Dt.setUint32(pr,hr,!0);break;default:throw new Error("Unexpected component type: "+rr)}}Vt+=index_modern_BufferUtils.padNumber(Yt*nr)}}const It={buffer:St,byteOffset:wt,byteLength:kt,byteStride:Rt,target:WriterContext.BufferViewTarget.ARRAY_BUFFER};return v.bufferViews.push(It),{byteLength:kt,buffers:[new Uint8Array(Gt)]}}function ft(xt,St,wt){const Pt=[];let Rt=0;const kt=new Map;let Gt=-1/0,Dt=!1;for(const rr of xt){const lr=tt.createAccessorDef(rr);v.accessors.push(lr),tt.accessorIndexMap.set(rr,v.accessors.length-1);const or=[],pr=[],hr=[],ur=new Array(rr.getElementSize()).fill(0);for(let kr=0,gr=rr.getCount();kr<gr;kr++)if(rr.getElement(kr,hr),!index_modern_MathUtils.eq(hr,ur,0)){Gt=Math.max(kr,Gt),or.push(kr);for(let tr=0;tr<hr.length;tr++)pr.push(hr[tr])}const cr=or.length,br={accessorDef:lr,count:cr};if(kt.set(rr,br),cr===0)continue;cr>rr.getCount()/2&&(Dt=!0);const fr=index_modern_ComponentTypeToTypedArray[rr.getComponentType()];br.indices=or,br.values=new fr(pr)}if(!Number.isFinite(Gt))return{buffers:Pt,byteLength:Rt};Dt&&it.warn("Some sparse accessors have >50% non-zero elements, which may increase file size.");const It=Gt<255?Uint8Array:Gt<65535?Uint16Array:Uint32Array,Nt=Gt<255?UNSIGNED_BYTE:Gt<65535?UNSIGNED_SHORT:UNSIGNED_INT,Vt={buffer:St,byteOffset:wt+Rt,byteLength:0};for(const rr of xt){const lr=kt.get(rr);if(lr.count===0)continue;lr.indicesByteOffset=Vt.byteLength;const or=index_modern_BufferUtils.pad(index_modern_BufferUtils.toView(new It(lr.indices)));Pt.push(or),Rt+=or.byteLength,Vt.byteLength+=or.byteLength}v.bufferViews.push(Vt);const Kt=v.bufferViews.length-1,Yt={buffer:St,byteOffset:wt+Rt,byteLength:0};for(const rr of xt){const lr=kt.get(rr);if(lr.count===0)continue;lr.valuesByteOffset=Yt.byteLength;const or=index_modern_BufferUtils.pad(index_modern_BufferUtils.toView(lr.values));Pt.push(or),Rt+=or.byteLength,Yt.byteLength+=or.byteLength}v.bufferViews.push(Yt);const nr=v.bufferViews.length-1;for(const rr of xt){const lr=kt.get(rr);lr.count!==0&&(lr.accessorDef.sparse={count:lr.count,indices:{bufferView:Kt,byteOffset:lr.indicesByteOffset,componentType:Nt},values:{bufferView:nr,byteOffset:lr.valuesByteOffset}})}return{buffers:Pt,byteLength:Rt}}if(v.accessors=[],v.bufferViews=[],v.samplers=[],v.textures=[],v.images=_.listTextures().map((xt,St)=>{const wt=tt.createPropertyDef(xt);xt.getMimeType()&&(wt.mimeType=xt.getMimeType());const Pt=xt.getImage();return Pt&&tt.createImageData(wt,Pt,xt),tt.imageIndexMap.set(xt,St),wt}),lt.filter(xt=>xt.prewriteTypes.includes(index_modern_PropertyType.ACCESSOR)).forEach(xt=>xt.prewrite(tt,index_modern_PropertyType.ACCESSOR)),_.listAccessors().forEach(xt=>{const St=tt.accessorUsageGroupedByParent,wt=tt.accessorParents;if(tt.accessorIndexMap.has(xt))return;const Pt=tt.getAccessorUsage(xt);if(tt.addAccessorToUsageGroup(xt,Pt),St.has(Pt)){const Rt=d.listParents(xt).find(kt=>kt.propertyType!==index_modern_PropertyType.ROOT);wt.set(xt,Rt)}}),lt.filter(xt=>xt.prewriteTypes.includes(index_modern_PropertyType.BUFFER)).forEach(xt=>xt.prewrite(tt,index_modern_PropertyType.BUFFER)),(_.listAccessors().length>0||tt.otherBufferViews.size>0||_.listTextures().length>0&&c.format===Format.GLB)&&_.listBuffers().length===0)throw new Error("Buffer required for Document resources, but none was found.");v.buffers=[],_.listBuffers().forEach((xt,St)=>{const wt=tt.createPropertyDef(xt),Pt=tt.accessorUsageGroupedByParent,Rt=xt.listParents().filter(Yt=>Yt instanceof index_modern_Accessor),kt=new Set(Rt.map(Yt=>tt.accessorParents.get(Yt))),Gt=new Map(Array.from(kt).map((Yt,nr)=>[Yt,nr])),Dt={};for(const Yt of Rt){var It;if(tt.accessorIndexMap.has(Yt))continue;const nr=tt.getAccessorUsage(Yt);let rr=nr;if(Pt.has(nr)){const lr=tt.accessorParents.get(Yt);rr+=`:${Gt.get(lr)}`}Dt[It=rr]||(Dt[It]={usage:nr,accessors:[]}),Dt[rr].accessors.push(Yt)}const Nt=[],Vt=v.buffers.length;let Kt=0;for(const{usage:Yt,accessors:nr}of Object.values(Dt))if(Yt===BufferViewUsage.ARRAY_BUFFER&&c.vertexLayout===VertexLayout.INTERLEAVED){const rr=_t(nr,Vt,Kt);Kt+=rr.byteLength;for(const lr of rr.buffers)Nt.push(lr)}else if(Yt===BufferViewUsage.ARRAY_BUFFER)for(const rr of nr){const lr=_t([rr],Vt,Kt);Kt+=lr.byteLength;for(const or of lr.buffers)Nt.push(or)}else if(Yt===BufferViewUsage.SPARSE){const rr=ft(nr,Vt,Kt);Kt+=rr.byteLength;for(const lr of rr.buffers)Nt.push(lr)}else if(Yt===BufferViewUsage.ELEMENT_ARRAY_BUFFER){const rr=ht(nr,Vt,Kt,WriterContext.BufferViewTarget.ELEMENT_ARRAY_BUFFER);Kt+=rr.byteLength;for(const lr of rr.buffers)Nt.push(lr)}else{const rr=ht(nr,Vt,Kt);Kt+=rr.byteLength;for(const lr of rr.buffers)Nt.push(lr)}if(tt.imageBufferViews.length&&St===0){for(let Yt=0;Yt<tt.imageBufferViews.length;Yt++)if(v.bufferViews[v.images[Yt].bufferView].byteOffset=Kt,Kt+=tt.imageBufferViews[Yt].byteLength,Nt.push(tt.imageBufferViews[Yt]),Kt%8){const nr=8-Kt%8;Kt+=nr,Nt.push(new Uint8Array(nr))}}if(tt.otherBufferViews.has(xt))for(const Yt of tt.otherBufferViews.get(xt))v.bufferViews.push({buffer:Vt,byteOffset:Kt,byteLength:Yt.byteLength}),tt.otherBufferViewsIndexMap.set(Yt,v.bufferViews.length-1),Kt+=Yt.byteLength,Nt.push(Yt);if(Kt){let Yt;c.format===Format.GLB?Yt=GLB_BUFFER:(Yt=tt.bufferURIGenerator.createURI(xt,"bin"),wt.uri=Yt),wt.byteLength=Kt,tt.assignResourceURI(Yt,index_modern_BufferUtils.concat(Nt),!0)}v.buffers.push(wt),tt.bufferIndexMap.set(xt,St)}),_.listAccessors().find(xt=>!xt.getBuffer())&&it.warn("Skipped writing one or more Accessors: no Buffer assigned."),lt.filter(xt=>xt.prewriteTypes.includes(index_modern_PropertyType.MATERIAL)).forEach(xt=>xt.prewrite(tt,index_modern_PropertyType.MATERIAL)),v.materials=_.listMaterials().map((xt,St)=>{const wt=tt.createPropertyDef(xt);if(xt.getAlphaMode()!==index_modern_Material.AlphaMode.OPAQUE&&(wt.alphaMode=xt.getAlphaMode()),xt.getAlphaMode()===index_modern_Material.AlphaMode.MASK&&(wt.alphaCutoff=xt.getAlphaCutoff()),xt.getDoubleSided()&&(wt.doubleSided=!0),wt.pbrMetallicRoughness={},index_modern_MathUtils.eq(xt.getBaseColorFactor(),[1,1,1,1])||(wt.pbrMetallicRoughness.baseColorFactor=xt.getBaseColorFactor()),index_modern_MathUtils.eq(xt.getEmissiveFactor(),[0,0,0])||(wt.emissiveFactor=xt.getEmissiveFactor()),xt.getRoughnessFactor()!==1&&(wt.pbrMetallicRoughness.roughnessFactor=xt.getRoughnessFactor()),xt.getMetallicFactor()!==1&&(wt.pbrMetallicRoughness.metallicFactor=xt.getMetallicFactor()),xt.getBaseColorTexture()){const Pt=xt.getBaseColorTexture(),Rt=xt.getBaseColorTextureInfo();wt.pbrMetallicRoughness.baseColorTexture=tt.createTextureInfoDef(Pt,Rt)}if(xt.getEmissiveTexture()){const Pt=xt.getEmissiveTexture(),Rt=xt.getEmissiveTextureInfo();wt.emissiveTexture=tt.createTextureInfoDef(Pt,Rt)}if(xt.getNormalTexture()){const Pt=xt.getNormalTexture(),Rt=xt.getNormalTextureInfo(),kt=tt.createTextureInfoDef(Pt,Rt);xt.getNormalScale()!==1&&(kt.scale=xt.getNormalScale()),wt.normalTexture=kt}if(xt.getOcclusionTexture()){const Pt=xt.getOcclusionTexture(),Rt=xt.getOcclusionTextureInfo(),kt=tt.createTextureInfoDef(Pt,Rt);xt.getOcclusionStrength()!==1&&(kt.strength=xt.getOcclusionStrength()),wt.occlusionTexture=kt}if(xt.getMetallicRoughnessTexture()){const Pt=xt.getMetallicRoughnessTexture(),Rt=xt.getMetallicRoughnessTextureInfo();wt.pbrMetallicRoughness.metallicRoughnessTexture=tt.createTextureInfoDef(Pt,Rt)}return tt.materialIndexMap.set(xt,St),wt}),lt.filter(xt=>xt.prewriteTypes.includes(index_modern_PropertyType.MESH)).forEach(xt=>xt.prewrite(tt,index_modern_PropertyType.MESH)),v.meshes=_.listMeshes().map((xt,St)=>{const wt=tt.createPropertyDef(xt);let Pt=null;return wt.primitives=xt.listPrimitives().map(Rt=>{const kt={attributes:{}};kt.mode=Rt.getMode();const Gt=Rt.getMaterial();Gt&&(kt.material=tt.materialIndexMap.get(Gt)),Object.keys(Rt.getExtras()).length&&(kt.extras=Rt.getExtras());const Dt=Rt.getIndices();Dt&&(kt.indices=tt.accessorIndexMap.get(Dt));for(const It of Rt.listSemantics())kt.attributes[It]=tt.accessorIndexMap.get(Rt.getAttribute(It));for(const It of Rt.listTargets()){const Nt={};for(const Vt of It.listSemantics())Nt[Vt]=tt.accessorIndexMap.get(It.getAttribute(Vt));kt.targets=kt.targets||[],kt.targets.push(Nt)}return Rt.listTargets().length&&!Pt&&(Pt=Rt.listTargets().map(It=>It.getName())),kt}),xt.getWeights().length&&(wt.weights=xt.getWeights()),Pt&&(wt.extras=wt.extras||{},wt.extras.targetNames=Pt),tt.meshIndexMap.set(xt,St),wt}),v.cameras=_.listCameras().map((xt,St)=>{const wt=tt.createPropertyDef(xt);if(wt.type=xt.getType(),wt.type===Camera.Type.PERSPECTIVE){wt.perspective={znear:xt.getZNear(),zfar:xt.getZFar(),yfov:xt.getYFov()};const Pt=xt.getAspectRatio();Pt!==null&&(wt.perspective.aspectRatio=Pt)}else wt.orthographic={znear:xt.getZNear(),zfar:xt.getZFar(),xmag:xt.getXMag(),ymag:xt.getYMag()};return tt.cameraIndexMap.set(xt,St),wt}),v.nodes=_.listNodes().map((xt,St)=>{const wt=tt.createPropertyDef(xt);return index_modern_MathUtils.eq(xt.getTranslation(),[0,0,0])||(wt.translation=xt.getTranslation()),index_modern_MathUtils.eq(xt.getRotation(),[0,0,0,1])||(wt.rotation=xt.getRotation()),index_modern_MathUtils.eq(xt.getScale(),[1,1,1])||(wt.scale=xt.getScale()),xt.getWeights().length&&(wt.weights=xt.getWeights()),tt.nodeIndexMap.set(xt,St),wt}),v.skins=_.listSkins().map((xt,St)=>{const wt=tt.createPropertyDef(xt),Pt=xt.getInverseBindMatrices();Pt&&(wt.inverseBindMatrices=tt.accessorIndexMap.get(Pt));const Rt=xt.getSkeleton();return Rt&&(wt.skeleton=tt.nodeIndexMap.get(Rt)),wt.joints=xt.listJoints().map(kt=>tt.nodeIndexMap.get(kt)),tt.skinIndexMap.set(xt,St),wt}),_.listNodes().forEach((xt,St)=>{const wt=v.nodes[St],Pt=xt.getMesh();Pt&&(wt.mesh=tt.meshIndexMap.get(Pt));const Rt=xt.getCamera();Rt&&(wt.camera=tt.cameraIndexMap.get(Rt));const kt=xt.getSkin();kt&&(wt.skin=tt.skinIndexMap.get(kt)),xt.listChildren().length>0&&(wt.children=xt.listChildren().map(Gt=>tt.nodeIndexMap.get(Gt)))}),v.animations=_.listAnimations().map((xt,St)=>{const wt=tt.createPropertyDef(xt),Pt=new Map;return wt.samplers=xt.listSamplers().map((Rt,kt)=>{const Gt=tt.createPropertyDef(Rt);return Gt.input=tt.accessorIndexMap.get(Rt.getInput()),Gt.output=tt.accessorIndexMap.get(Rt.getOutput()),Gt.interpolation=Rt.getInterpolation(),Pt.set(Rt,kt),Gt}),wt.channels=xt.listChannels().map(Rt=>{const kt=tt.createPropertyDef(Rt);return kt.sampler=Pt.get(Rt.getSampler()),kt.target={node:tt.nodeIndexMap.get(Rt.getTargetNode()),path:Rt.getTargetPath()},kt}),tt.animationIndexMap.set(xt,St),wt}),v.scenes=_.listScenes().map((xt,St)=>{const wt=tt.createPropertyDef(xt);return wt.nodes=xt.listChildren().map(Pt=>tt.nodeIndexMap.get(Pt)),tt.sceneIndexMap.set(xt,St),wt});const bt=_.getDefaultScene();return bt&&(v.scene=_.listScenes().indexOf(bt)),v.extensionsUsed=lt.map(xt=>xt.extensionName),v.extensionsRequired=ut.map(xt=>xt.extensionName),lt.forEach(xt=>xt.write(tt)),index_modern_clean(v),b}}function index_modern_clean(h){const o=[];for(const c in h){const d=h[c];(Array.isArray(d)&&d.length===0||d===null||d===""||d&&typeof d=="object"&&Object.keys(d).length===0)&&o.push(c)}for(const c of o)delete h[c]}var ChunkType;(function(h){h[h.JSON=1313821514]="JSON",h[h.BIN=5130562]="BIN"})(ChunkType||(ChunkType={}));class PlatformIO{constructor(){this._logger=Logger.DEFAULT_INSTANCE,this._extensions=new Set,this._dependencies={},this._vertexLayout=VertexLayout.INTERLEAVED,this.lastReadBytes=0,this.lastWriteBytes=0}setLogger(o){return this._logger=o,this}registerExtensions(o){for(const c of o)this._extensions.add(c),c.register();return this}registerDependencies(o){return Object.assign(this._dependencies,o),this}setVertexLayout(o){return this._vertexLayout=o,this}async read(o){return await this.readJSON(await this.readAsJSON(o))}async readAsJSON(o){const c=await this.readURI(o,"view");this.lastReadBytes=c.byteLength;const d=isGLB(c)?this._binaryToJSON(c):{json:JSON.parse(index_modern_BufferUtils.decodeText(c)),resources:{}};return await this._readResourcesExternal(d,this.dirname(o)),this._readResourcesInternal(d),d}async readJSON(o){return o=this._copyJSON(o),this._readResourcesInternal(o),GLTFReader.read(o,{extensions:Array.from(this._extensions),dependencies:this._dependencies,logger:this._logger})}async binaryToJSON(o){const c=this._binaryToJSON(index_modern_BufferUtils.assertView(o));this._readResourcesInternal(c);const d=c.json;if(d.buffers&&d.buffers.some(_=>isExternalBuffer(c,_)))throw new Error("Cannot resolve external buffers with binaryToJSON().");if(d.images&&d.images.some(_=>isExternalImage(c,_)))throw new Error("Cannot resolve external images with binaryToJSON().");return c}async readBinary(o){return this.readJSON(await this.binaryToJSON(index_modern_BufferUtils.assertView(o)))}async writeJSON(o,c={}){if(c.format===Format.GLB&&o.getRoot().listBuffers().length>1)throw new Error("GLB must have 01 buffers.");return index_modern_GLTFWriter.write(o,{format:c.format||Format.GLTF,basename:c.basename||"",logger:this._logger,vertexLayout:this._vertexLayout,dependencies:index_modern_extends({},this._dependencies),extensions:Array.from(this._extensions)})}async writeBinary(o){const{json:c,resources:d}=await this.writeJSON(o,{format:Format.GLB}),_=new Uint32Array([1179937895,2,12]),v=JSON.stringify(c),b=index_modern_BufferUtils.pad(index_modern_BufferUtils.encodeText(v),32),tt=index_modern_BufferUtils.toView(new Uint32Array([b.byteLength,1313821514])),it=index_modern_BufferUtils.concat([tt,b]);_[_.length-1]+=it.byteLength;const nt=Object.values(d)[0];if(!nt||!nt.byteLength)return index_modern_BufferUtils.concat([index_modern_BufferUtils.toView(_),it]);const lt=index_modern_BufferUtils.pad(nt,0),ut=index_modern_BufferUtils.toView(new Uint32Array([lt.byteLength,5130562])),ht=index_modern_BufferUtils.concat([ut,lt]);return _[_.length-1]+=ht.byteLength,index_modern_BufferUtils.concat([index_modern_BufferUtils.toView(_),it,ht])}async _readResourcesExternal(o,c){var d=this;const _=[...o.json.images||[],...o.json.buffers||[]].map(async function(v){const b=v.uri;if(!b||b.match(/data:/))return Promise.resolve();o.resources[b]=await d.readURI(d.resolve(c,b),"view"),d.lastReadBytes+=o.resources[b].byteLength});await Promise.all(_)}_readResourcesInternal(o){function c(d){if(d.uri){if(d.uri in o.resources)index_modern_BufferUtils.assertView(o.resources[d.uri]);else if(d.uri.match(/data:/)){const _=`__${index_modern_uuid()}.${index_modern_FileUtils.extension(d.uri)}`;o.resources[_]=index_modern_BufferUtils.createBufferFromDataURI(d.uri),d.uri=_}}}(o.json.images||[]).forEach(d=>{if(d.bufferView===void 0&&d.uri===void 0)throw new Error("Missing resource URI or buffer view.");c(d)}),(o.json.buffers||[]).forEach(c)}_copyJSON(o){const{images:c,buffers:d}=o.json;return o={json:index_modern_extends({},o.json),resources:index_modern_extends({},o.resources)},c&&(o.json.images=c.map(_=>index_modern_extends({},_))),d&&(o.json.buffers=d.map(_=>index_modern_extends({},_))),o}_binaryToJSON(o){if(!isGLB(o))throw new Error("Invalid glTF 2.0 binary.");const c=new Uint32Array(o.buffer,o.byteOffset+12,2);if(c[1]!==ChunkType.JSON)throw new Error("Missing required GLB JSON chunk.");const d=c[0],_=index_modern_BufferUtils.decodeText(index_modern_BufferUtils.toView(o,20,d)),v=JSON.parse(_),b=20+d;if(o.byteLength<=b)return{json:v,resources:{}};const tt=new Uint32Array(o.buffer,o.byteOffset+b,2);if(tt[1]!==ChunkType.BIN)return{json:v,resources:{}};const it=tt[0],nt=index_modern_BufferUtils.toView(o,b+8,it);return{json:v,resources:{[GLB_BUFFER]:nt}}}}function isExternalBuffer(h,o){return o.uri!==void 0&&!(o.uri in h.resources)}function isExternalImage(h,o){return o.uri!==void 0&&!(o.uri in h.resources)&&o.bufferView===void 0}function isGLB(h){if(h.byteLength<3*Uint32Array.BYTES_PER_ELEMENT)return!1;const o=new Uint32Array(h.buffer,h.byteOffset,3);return o[0]===1179937895&&o[1]===2}class WebIO extends PlatformIO{constructor(o=HTTPUtils.DEFAULT_INIT){super(),this._fetchConfig=void 0,this._fetchConfig=o}async readURI(o,c){const d=await fetch(o,this._fetchConfig);switch(c){case"view":return new Uint8Array(await d.arrayBuffer());case"text":return d.text()}}resolve(o,c){return HTTPUtils.resolve(o,c)}dirname(o){return HTTPUtils.dirname(o)}}const KHR_SUPERCOMPRESSION_NONE=0,KHR_DF_KHR_DESCRIPTORTYPE_BASICFORMAT=0,KHR_DF_VENDORID_KHRONOS=0,KHR_DF_VERSION=2,KHR_DF_MODEL_UNSPECIFIED=0,ktx_parse_modern_KHR_DF_MODEL_ETC1S=163,ktx_parse_modern_KHR_DF_MODEL_UASTC=166,KHR_DF_FLAG_ALPHA_STRAIGHT=0,KHR_DF_TRANSFER_SRGB=2,KHR_DF_PRIMARIES_BT709=1,KHR_DF_SAMPLE_DATATYPE_SIGNED=64,VK_FORMAT_UNDEFINED=0;class KTX2Container{constructor(){this.vkFormat=VK_FORMAT_UNDEFINED,this.typeSize=1,this.pixelWidth=0,this.pixelHeight=0,this.pixelDepth=0,this.layerCount=0,this.faceCount=1,this.supercompressionScheme=KHR_SUPERCOMPRESSION_NONE,this.levels=[],this.dataFormatDescriptor=[{vendorId:KHR_DF_VENDORID_KHRONOS,descriptorType:KHR_DF_KHR_DESCRIPTORTYPE_BASICFORMAT,descriptorBlockSize:0,versionNumber:KHR_DF_VERSION,colorModel:KHR_DF_MODEL_UNSPECIFIED,colorPrimaries:KHR_DF_PRIMARIES_BT709,transferFunction:KHR_DF_TRANSFER_SRGB,flags:KHR_DF_FLAG_ALPHA_STRAIGHT,texelBlockDimension:[0,0,0,0],bytesPlane:[0,0,0,0,0,0,0,0],samples:[]}],this.keyValue={},this.globalData=null}}class BufferReader{constructor(o,c,d,_){this._dataView=void 0,this._littleEndian=void 0,this._offset=void 0,this._dataView=new DataView(o.buffer,o.byteOffset+c,d),this._littleEndian=_,this._offset=0}_nextUint8(){const o=this._dataView.getUint8(this._offset);return this._offset+=1,o}_nextUint16(){const o=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,o}_nextUint32(){const o=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,o}_nextUint64(){const o=this._dataView.getUint32(this._offset,this._littleEndian)+4294967296*this._dataView.getUint32(this._offset+4,this._littleEndian);return this._offset+=8,o}_nextInt32(){const o=this._dataView.getInt32(this._offset,this._littleEndian);return this._offset+=4,o}_skip(o){return this._offset+=o,this}_scan(o,c=0){const d=this._offset;let _=0;for(;this._dataView.getUint8(this._offset)!==c&&_<o;)_++,this._offset++;return _<o&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+d,_)}}const KTX2_ID=[171,75,84,88,32,50,48,187,13,10,26,10];function decodeText(h){return typeof TextDecoder<"u"?new TextDecoder().decode(h):Buffer.from(h).toString("utf8")}function ktx_parse_modern_read(h){const o=new Uint8Array(h.buffer,h.byteOffset,KTX2_ID.length);if(o[0]!==KTX2_ID[0]||o[1]!==KTX2_ID[1]||o[2]!==KTX2_ID[2]||o[3]!==KTX2_ID[3]||o[4]!==KTX2_ID[4]||o[5]!==KTX2_ID[5]||o[6]!==KTX2_ID[6]||o[7]!==KTX2_ID[7]||o[8]!==KTX2_ID[8]||o[9]!==KTX2_ID[9]||o[10]!==KTX2_ID[10]||o[11]!==KTX2_ID[11])throw new Error("Missing KTX 2.0 identifier.");const c=new KTX2Container,d=17*Uint32Array.BYTES_PER_ELEMENT,_=new BufferReader(h,KTX2_ID.length,d,!0);c.vkFormat=_._nextUint32(),c.typeSize=_._nextUint32(),c.pixelWidth=_._nextUint32(),c.pixelHeight=_._nextUint32(),c.pixelDepth=_._nextUint32(),c.layerCount=_._nextUint32(),c.faceCount=_._nextUint32();const v=_._nextUint32();c.supercompressionScheme=_._nextUint32();const b=_._nextUint32(),tt=_._nextUint32(),it=_._nextUint32(),nt=_._nextUint32(),lt=_._nextUint64(),ut=_._nextUint64(),ht=3*v*8,_t=new BufferReader(h,KTX2_ID.length+d,ht,!0);for(let hr=0;hr<v;hr++)c.levels.push({levelData:new Uint8Array(h.buffer,h.byteOffset+_t._nextUint64(),_t._nextUint64()),uncompressedByteLength:_t._nextUint64()});const ft=new BufferReader(h,b,tt,!0),bt={vendorId:ft._skip(4)._nextUint16(),descriptorType:ft._nextUint16(),versionNumber:ft._nextUint16(),descriptorBlockSize:ft._nextUint16(),colorModel:ft._nextUint8(),colorPrimaries:ft._nextUint8(),transferFunction:ft._nextUint8(),flags:ft._nextUint8(),texelBlockDimension:[ft._nextUint8(),ft._nextUint8(),ft._nextUint8(),ft._nextUint8()],bytesPlane:[ft._nextUint8(),ft._nextUint8(),ft._nextUint8(),ft._nextUint8(),ft._nextUint8(),ft._nextUint8(),ft._nextUint8(),ft._nextUint8()],samples:[]},xt=(bt.descriptorBlockSize/4-6)/4;for(let hr=0;hr<xt;hr++){const ur={bitOffset:ft._nextUint16(),bitLength:ft._nextUint8(),channelType:ft._nextUint8(),samplePosition:[ft._nextUint8(),ft._nextUint8(),ft._nextUint8(),ft._nextUint8()],sampleLower:-1/0,sampleUpper:1/0};ur.channelType&KHR_DF_SAMPLE_DATATYPE_SIGNED?(ur.sampleLower=ft._nextInt32(),ur.sampleUpper=ft._nextInt32()):(ur.sampleLower=ft._nextUint32(),ur.sampleUpper=ft._nextUint32()),bt.samples[hr]=ur}c.dataFormatDescriptor.length=0,c.dataFormatDescriptor.push(bt);const St=new BufferReader(h,it,nt,!0);for(;St._offset<nt;){const hr=St._nextUint32(),ur=St._scan(hr),cr=decodeText(ur),br=St._scan(hr-ur.byteLength);c.keyValue[cr]=cr.match(/^ktx/i)?decodeText(br):br,St._offset%4&&St._skip(4-St._offset%4)}if(ut<=0)return c;const wt=new BufferReader(h,lt,ut,!0),Pt=wt._nextUint16(),Rt=wt._nextUint16(),kt=wt._nextUint32(),Gt=wt._nextUint32(),Dt=wt._nextUint32(),It=wt._nextUint32(),Nt=[];for(let hr=0;hr<v;hr++)Nt.push({imageFlags:wt._nextUint32(),rgbSliceByteOffset:wt._nextUint32(),rgbSliceByteLength:wt._nextUint32(),alphaSliceByteOffset:wt._nextUint32(),alphaSliceByteLength:wt._nextUint32()});const Vt=lt+wt._offset,Kt=Vt+kt,Yt=Kt+Gt,nr=Yt+Dt,rr=new Uint8Array(h.buffer,h.byteOffset+Vt,kt),lr=new Uint8Array(h.buffer,h.byteOffset+Kt,Gt),or=new Uint8Array(h.buffer,h.byteOffset+Yt,Dt),pr=new Uint8Array(h.buffer,h.byteOffset+nr,It);return c.globalData={endpointCount:Pt,selectorCount:Rt,imageDescs:Nt,endpointsData:rr,selectorsData:lr,tablesData:or,extendedData:pr},c}const EXT_MESH_GPU_INSTANCING="EXT_mesh_gpu_instancing",EXT_MESHOPT_COMPRESSION="EXT_meshopt_compression",EXT_TEXTURE_WEBP="EXT_texture_webp",EXT_TEXTURE_AVIF="EXT_texture_avif",KHR_DRACO_MESH_COMPRESSION="KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL="KHR_lights_punctual",KHR_MATERIALS_ANISOTROPY="KHR_materials_anisotropy",KHR_MATERIALS_CLEARCOAT="KHR_materials_clearcoat",KHR_MATERIALS_DIFFUSE_TRANSMISSION="KHR_materials_diffuse_transmission",KHR_MATERIALS_DISPERSION="KHR_materials_dispersion",KHR_MATERIALS_EMISSIVE_STRENGTH="KHR_materials_emissive_strength",KHR_MATERIALS_IOR="KHR_materials_ior",KHR_MATERIALS_IRIDESCENCE="KHR_materials_iridescence",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS="KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_SHEEN="KHR_materials_sheen",KHR_MATERIALS_SPECULAR="KHR_materials_specular",KHR_MATERIALS_TRANSMISSION="KHR_materials_transmission",KHR_MATERIALS_UNLIT="KHR_materials_unlit",KHR_MATERIALS_VOLUME="KHR_materials_volume",KHR_MATERIALS_VARIANTS="KHR_materials_variants",index_modern_KHR_MESH_QUANTIZATION="KHR_mesh_quantization",index_modern_KHR_TEXTURE_BASISU="KHR_texture_basisu",KHR_TEXTURE_TRANSFORM="KHR_texture_transform",KHR_XMP_JSON_LD="KHR_xmp_json_ld",INSTANCE_ATTRIBUTE="INSTANCE_ATTRIBUTE";class InstancedMesh extends index_modern_ExtensionProperty{init(){this.extensionName=EXT_MESH_GPU_INSTANCING,this.propertyType="InstancedMesh",this.parentTypes=[index_modern_PropertyType.NODE]}getDefaults(){return Object.assign(super.getDefaults(),{attributes:new RefMap})}getAttribute(o){return this.getRefMap("attributes",o)}setAttribute(o,c){return this.setRefMap("attributes",o,c,{usage:INSTANCE_ATTRIBUTE})}listAttributes(){return this.listRefMapValues("attributes")}listSemantics(){return this.listRefMapKeys("attributes")}}InstancedMesh.EXTENSION_NAME=EXT_MESH_GPU_INSTANCING;const NAME$o=EXT_MESH_GPU_INSTANCING;class index_modern_EXTMeshGPUInstancing extends Extension{constructor(...o){super(...o),this.extensionName=NAME$o,this.provideTypes=[index_modern_PropertyType.NODE],this.prewriteTypes=[index_modern_PropertyType.ACCESSOR]}createInstancedMesh(){return new InstancedMesh(this.document.getGraph())}read(o){return(o.jsonDoc.json.nodes||[]).forEach((c,d)=>{if(!c.extensions||!c.extensions[NAME$o])return;const _=c.extensions[NAME$o],v=this.createInstancedMesh();for(const b in _.attributes)v.setAttribute(b,o.accessors[_.attributes[b]]);o.nodes[d].setExtension(NAME$o,v)}),this}prewrite(o){o.accessorUsageGroupedByParent.add(INSTANCE_ATTRIBUTE);for(const c of this.properties)for(const d of c.listAttributes())o.addAccessorToUsageGroup(d,INSTANCE_ATTRIBUTE);return this}write(o){const c=o.jsonDoc;return this.document.getRoot().listNodes().forEach(d=>{const _=d.getExtension(NAME$o);if(_){const v=o.nodeIndexMap.get(d),b=c.json.nodes[v],tt={attributes:{}};_.listSemantics().forEach(it=>{const nt=_.getAttribute(it);tt.attributes[it]=o.accessorIndexMap.get(nt)}),b.extensions=b.extensions||{},b.extensions[NAME$o]=tt}}),this}}function dist_index_modern_extends(){return dist_index_modern_extends=Object.assign?Object.assign.bind():function(h){for(var o=1;o<arguments.length;o++){var c=arguments[o];for(var d in c)({}).hasOwnProperty.call(c,d)&&(h[d]=c[d])}return h},dist_index_modern_extends.apply(null,arguments)}var EncoderMethod$1,MeshoptMode,MeshoptFilter;index_modern_EXTMeshGPUInstancing.EXTENSION_NAME=NAME$o,function(h){h.QUANTIZE="quantize",h.FILTER="filter"}(EncoderMethod$1||(EncoderMethod$1={})),function(h){h.ATTRIBUTES="ATTRIBUTES",h.TRIANGLES="TRIANGLES",h.INDICES="INDICES"}(MeshoptMode||(MeshoptMode={})),function(h){h.NONE="NONE",h.OCTAHEDRAL="OCTAHEDRAL",h.QUATERNION="QUATERNION",h.EXPONENTIAL="EXPONENTIAL"}(MeshoptFilter||(MeshoptFilter={}));const{BYTE,SHORT,FLOAT}=index_modern_Accessor.ComponentType,{encodeNormalizedInt,decodeNormalizedInt}=index_modern_MathUtils;function prepareAccessor(h,o,c,d){const{filter:_,bits:v}=d,b={array:h.getArray(),byteStride:h.getElementSize()*h.getComponentSize(),componentType:h.getComponentType(),normalized:h.getNormalized()};if(c!==MeshoptMode.ATTRIBUTES)return b;if(_!==MeshoptFilter.NONE){let tt=h.getNormalized()?decodeNormalizedIntArray(h):new Float32Array(b.array);switch(_){case MeshoptFilter.EXPONENTIAL:b.byteStride=4*h.getElementSize(),b.componentType=FLOAT,b.normalized=!1,b.array=o.encodeFilterExp(tt,h.getCount(),b.byteStride,v);break;case MeshoptFilter.OCTAHEDRAL:b.byteStride=v>8?8:4,b.componentType=v>8?SHORT:BYTE,b.normalized=!0,tt=h.getElementSize()===3?padNormals(tt):tt,b.array=o.encodeFilterOct(tt,h.getCount(),b.byteStride,v);break;case MeshoptFilter.QUATERNION:b.byteStride=8,b.componentType=SHORT,b.normalized=!0,b.array=o.encodeFilterQuat(tt,h.getCount(),b.byteStride,v);break;default:throw new Error("Invalid filter.")}b.min=h.getMin([]),b.max=h.getMax([]),h.getNormalized()&&(b.min=b.min.map(it=>decodeNormalizedInt(it,h.getComponentType())),b.max=b.max.map(it=>decodeNormalizedInt(it,h.getComponentType()))),b.normalized&&(b.min=b.min.map(it=>encodeNormalizedInt(it,b.componentType)),b.max=b.max.map(it=>encodeNormalizedInt(it,b.componentType)))}else b.byteStride%4&&(b.array=padArrayElements(b.array,h.getElementSize()),b.byteStride=b.array.byteLength/h.getCount());return b}function decodeNormalizedIntArray(h){const o=h.getComponentType(),c=h.getArray(),d=new Float32Array(c.length);for(let _=0;_<c.length;_++)d[_]=decodeNormalizedInt(c[_],o);return d}function padArrayElements(h,o){const c=index_modern_BufferUtils.padNumber(h.BYTES_PER_ELEMENT*o)/h.BYTES_PER_ELEMENT,d=h.length/o,_=new h.constructor(d*c);for(let v=0;v*o<h.length;v++)for(let b=0;b<o;b++)_[v*c+b]=h[v*o+b];return _}function padNormals(h){const o=new Float32Array(4*h.length/3);for(let c=0,d=h.length/3;c<d;c++)o[4*c]=h[3*c],o[4*c+1]=h[3*c+1],o[4*c+2]=h[3*c+2];return o}function getMeshoptMode(h,o){return o===WriterContext.BufferViewUsage.ELEMENT_ARRAY_BUFFER?h.listParents().some(c=>c instanceof index_modern_Primitive&&c.getMode()===index_modern_Primitive.Mode.TRIANGLES)?MeshoptMode.TRIANGLES:MeshoptMode.INDICES:MeshoptMode.ATTRIBUTES}function getMeshoptFilter(h,o){const c=o.getGraph().listParentEdges(h).filter(d=>!(d.getParent()instanceof index_modern_Root));for(const d of c){const _=d.getName(),v=d.getAttributes().key||"",b=d.getParent().propertyType===index_modern_PropertyType.PRIMITIVE_TARGET;if(_==="indices")return{filter:MeshoptFilter.NONE};if(_==="attributes"){if(v==="POSITION")return{filter:MeshoptFilter.NONE};if(v==="TEXCOORD_0")return{filter:MeshoptFilter.NONE};if(v.startsWith("JOINTS_"))return{filter:MeshoptFilter.NONE};if(v.startsWith("WEIGHTS_"))return{filter:MeshoptFilter.NONE};if(v==="NORMAL"||v==="TANGENT")return b?{filter:MeshoptFilter.NONE}:{filter:MeshoptFilter.OCTAHEDRAL,bits:8}}if(_==="output"){const tt=getTargetPath(h);return tt==="rotation"?{filter:MeshoptFilter.QUATERNION,bits:16}:tt==="translation"||tt==="scale"?{filter:MeshoptFilter.EXPONENTIAL,bits:12}:{filter:MeshoptFilter.NONE}}if(_==="input")return{filter:MeshoptFilter.NONE};if(_==="inverseBindMatrices")return{filter:MeshoptFilter.NONE}}return{filter:MeshoptFilter.NONE}}function getTargetPath(h){for(const o of h.listParents())if(o instanceof index_modern_AnimationSampler){for(const c of o.listParents())if(c instanceof index_modern_AnimationChannel)return c.getTargetPath()}return null}function isFallbackBuffer(h){return!(!h.extensions||!h.extensions[EXT_MESHOPT_COMPRESSION])&&!!h.extensions[EXT_MESHOPT_COMPRESSION].fallback}const NAME$n=EXT_MESHOPT_COMPRESSION,DEFAULT_ENCODER_OPTIONS$1={method:EncoderMethod$1.QUANTIZE};class index_modern_EXTMeshoptCompression extends Extension{constructor(...o){super(...o),this.extensionName=NAME$n,this.prereadTypes=[index_modern_PropertyType.BUFFER,index_modern_PropertyType.PRIMITIVE],this.prewriteTypes=[index_modern_PropertyType.BUFFER,index_modern_PropertyType.ACCESSOR],this.readDependencies=["meshopt.decoder"],this.writeDependencies=["meshopt.encoder"],this._decoder=null,this._decoderFallbackBufferMap=new Map,this._encoder=null,this._encoderOptions=DEFAULT_ENCODER_OPTIONS$1,this._encoderFallbackBuffer=null,this._encoderBufferViews={},this._encoderBufferViewData={},this._encoderBufferViewAccessors={}}install(o,c){return o==="meshopt.decoder"&&(this._decoder=c),o==="meshopt.encoder"&&(this._encoder=c),this}setEncoderOptions(o){return this._encoderOptions=dist_index_modern_extends({},DEFAULT_ENCODER_OPTIONS$1,o),this}preread(o,c){if(!this._decoder){if(!this.isRequired())return this;throw new Error(`[${NAME$n}] Please install extension dependency, "meshopt.decoder".`)}if(!this._decoder.supported){if(!this.isRequired())return this;throw new Error(`[${NAME$n}]: Missing WASM support.`)}return c===index_modern_PropertyType.BUFFER?this._prereadBuffers(o):c===index_modern_PropertyType.PRIMITIVE&&this._prereadPrimitives(o),this}_prereadBuffers(o){const c=o.jsonDoc;(c.json.bufferViews||[]).forEach((d,_)=>{if(!d.extensions||!d.extensions[NAME$n])return;const v=d.extensions[NAME$n],b=v.byteOffset||0,tt=v.byteLength||0,it=v.count,nt=v.byteStride,lt=new Uint8Array(it*nt),ut=c.json.buffers[v.buffer],ht=ut.uri?c.resources[ut.uri]:c.resources[GLB_BUFFER],_t=index_modern_BufferUtils.toView(ht,b,tt);this._decoder.decodeGltfBuffer(lt,it,nt,_t,v.mode,v.filter),o.bufferViews[_]=lt})}_prereadPrimitives(o){const c=o.jsonDoc;(c.json.bufferViews||[]).forEach(d=>{if(!d.extensions||!d.extensions[NAME$n])return;const _=d.extensions[NAME$n],v=o.buffers[_.buffer],b=o.buffers[d.buffer];isFallbackBuffer(c.json.buffers[d.buffer])&&this._decoderFallbackBufferMap.set(b,v)})}read(o){if(!this.isRequired())return this;for(const[c,d]of this._decoderFallbackBufferMap){for(const _ of c.listParents())_ instanceof index_modern_Accessor&&_.swap(c,d);c.dispose()}return this}prewrite(o,c){return c===index_modern_PropertyType.ACCESSOR?this._prewriteAccessors(o):c===index_modern_PropertyType.BUFFER&&this._prewriteBuffers(o),this}_prewriteAccessors(o){const c=o.jsonDoc.json,d=this._encoder,_=this._encoderOptions,v=this.document.getGraph(),b=this.document.createBuffer(),tt=this.document.getRoot().listBuffers().indexOf(b);let it=1;const nt=new Map,lt=ut=>{for(const ht of v.listParents(ut)){if(ht.propertyType===index_modern_PropertyType.ROOT)continue;let _t=nt.get(ut);return _t===void 0&&nt.set(ut,_t=it++),_t}return-1};this._encoderFallbackBuffer=b,this._encoderBufferViews={},this._encoderBufferViewData={},this._encoderBufferViewAccessors={};for(const ut of this.document.getRoot().listAccessors()){if(getTargetPath(ut)==="weights"||ut.getSparse())continue;const ht=o.getAccessorUsage(ut),_t=o.accessorUsageGroupedByParent.has(ht)?lt(ut):null,ft=getMeshoptMode(ut,ht),bt=_.method===EncoderMethod$1.FILTER?getMeshoptFilter(ut,this.document):{filter:MeshoptFilter.NONE},xt=prepareAccessor(ut,d,ft,bt),{array:St,byteStride:wt}=xt,Pt=ut.getBuffer();if(!Pt)throw new Error(`${NAME$n}: Missing buffer for accessor.`);const Rt=this.document.getRoot().listBuffers().indexOf(Pt),kt=[ht,_t,ft,bt.filter,wt,Rt].join(":");let Gt=this._encoderBufferViews[kt],Dt=this._encoderBufferViewData[kt],It=this._encoderBufferViewAccessors[kt];Gt&&Dt||(It=this._encoderBufferViewAccessors[kt]=[],Dt=this._encoderBufferViewData[kt]=[],Gt=this._encoderBufferViews[kt]={buffer:tt,target:WriterContext.USAGE_TO_TARGET[ht],byteOffset:0,byteLength:0,byteStride:ht===WriterContext.BufferViewUsage.ARRAY_BUFFER?wt:void 0,extensions:{[NAME$n]:{buffer:Rt,byteOffset:0,byteLength:0,mode:ft,filter:bt.filter!==MeshoptFilter.NONE?bt.filter:void 0,byteStride:wt,count:0}}});const Nt=o.createAccessorDef(ut);Nt.componentType=xt.componentType,Nt.normalized=xt.normalized,Nt.byteOffset=Gt.byteLength,Nt.min&&xt.min&&(Nt.min=xt.min),Nt.max&&xt.max&&(Nt.max=xt.max),o.accessorIndexMap.set(ut,c.accessors.length),c.accessors.push(Nt),It.push(Nt),Dt.push(new Uint8Array(St.buffer,St.byteOffset,St.byteLength)),Gt.byteLength+=St.byteLength,Gt.extensions.EXT_meshopt_compression.count+=ut.getCount()}}_prewriteBuffers(o){const c=this._encoder;for(const d in this._encoderBufferViews){const _=this._encoderBufferViews[d],v=this._encoderBufferViewData[d],b=this.document.getRoot().listBuffers()[_.extensions[NAME$n].buffer],tt=o.otherBufferViews.get(b)||[],{count:it,byteStride:nt,mode:lt}=_.extensions[NAME$n],ut=index_modern_BufferUtils.concat(v),ht=c.encodeGltfBuffer(ut,it,nt,lt),_t=index_modern_BufferUtils.pad(ht);_.extensions[NAME$n].byteLength=ht.byteLength,v.length=0,v.push(_t),tt.push(_t),o.otherBufferViews.set(b,tt)}}write(o){let c=0;for(const b in this._encoderBufferViews){const tt=this._encoderBufferViews[b],it=this._encoderBufferViewData[b][0],nt=o.otherBufferViewsIndexMap.get(it),lt=this._encoderBufferViewAccessors[b];for(const _t of lt)_t.bufferView=nt;const ut=o.jsonDoc.json.bufferViews[nt],ht=ut.byteOffset||0;Object.assign(ut,tt),ut.byteOffset=c,ut.extensions[NAME$n].byteOffset=ht,c+=index_modern_BufferUtils.padNumber(tt.byteLength)}const d=this._encoderFallbackBuffer,_=o.bufferIndexMap.get(d),v=o.jsonDoc.json.buffers[_];return v.byteLength=c,v.extensions={[NAME$n]:{fallback:!0}},d.dispose(),this}}index_modern_EXTMeshoptCompression.EXTENSION_NAME=NAME$n,index_modern_EXTMeshoptCompression.EncoderMethod=EncoderMethod$1;const NAME$m=EXT_TEXTURE_AVIF;class AVIFImageUtils{match(o){return o.length>=12&&index_modern_BufferUtils.decodeText(o.slice(4,12))==="ftypavif"}getSize(o){if(!this.match(o))return null;const c=new DataView(o.buffer,o.byteOffset,o.byteLength);let d=unbox(c,0);if(!d)return null;let _=d.end;for(;d=unbox(c,_);)if(d.type==="meta")_=d.start+4;else if(d.type==="iprp"||d.type==="ipco")_=d.start;else{if(d.type==="ispe")return[c.getUint32(d.start+4),c.getUint32(d.start+8)];if(d.type==="mdat")break;_=d.end}return null}getChannels(o){return 4}}class index_modern_EXTTextureAVIF extends Extension{constructor(...o){super(...o),this.extensionName=NAME$m,this.prereadTypes=[index_modern_PropertyType.TEXTURE]}static register(){index_modern_ImageUtils.registerFormat("image/avif",new AVIFImageUtils)}preread(o){return(o.jsonDoc.json.textures||[]).forEach(c=>{c.extensions&&c.extensions[NAME$m]&&(c.source=c.extensions[NAME$m].source)}),this}read(o){return this}write(o){const c=o.jsonDoc;return this.document.getRoot().listTextures().forEach(d=>{if(d.getMimeType()==="image/avif"){const _=o.imageIndexMap.get(d);(c.json.textures||[]).forEach(v=>{v.source===_&&(v.extensions=v.extensions||{},v.extensions[NAME$m]={source:v.source},delete v.source)})}}),this}}function unbox(h,o){if(h.byteLength<4+o)return null;const c=h.getUint32(o);return h.byteLength<c+o||c<8?null:{type:index_modern_BufferUtils.decodeText(new Uint8Array(h.buffer,h.byteOffset+o+4,4)),start:o+8,end:o+c}}index_modern_EXTTextureAVIF.EXTENSION_NAME=NAME$m;const NAME$l=EXT_TEXTURE_WEBP;class WEBPImageUtils{match(o){return o.length>=12&&o[8]===87&&o[9]===69&&o[10]===66&&o[11]===80}getSize(o){const c=index_modern_BufferUtils.decodeText(o.slice(0,4)),d=index_modern_BufferUtils.decodeText(o.slice(8,12));if(c!=="RIFF"||d!=="WEBP")return null;const _=new DataView(o.buffer,o.byteOffset);let v=12;for(;v<_.byteLength;){const b=index_modern_BufferUtils.decodeText(new Uint8Array([_.getUint8(v),_.getUint8(v+1),_.getUint8(v+2),_.getUint8(v+3)])),tt=_.getUint32(v+4,!0);if(b==="VP8 ")return[16383&_.getInt16(v+14,!0),16383&_.getInt16(v+16,!0)];if(b==="VP8L"){const it=_.getUint8(v+9),nt=_.getUint8(v+10),lt=_.getUint8(v+11);return[1+((63&nt)<<8|it),1+((15&_.getUint8(v+12))<<10|lt<<2|(192&nt)>>6)]}v+=8+tt+tt%2}return null}getChannels(o){return 4}}class index_modern_EXTTextureWebP extends Extension{constructor(...o){super(...o),this.extensionName=NAME$l,this.prereadTypes=[index_modern_PropertyType.TEXTURE]}static register(){index_modern_ImageUtils.registerFormat("image/webp",new WEBPImageUtils)}preread(o){return(o.jsonDoc.json.textures||[]).forEach(c=>{c.extensions&&c.extensions[NAME$l]&&(c.source=c.extensions[NAME$l].source)}),this}read(o){return this}write(o){const c=o.jsonDoc;return this.document.getRoot().listTextures().forEach(d=>{if(d.getMimeType()==="image/webp"){const _=o.imageIndexMap.get(d);(c.json.textures||[]).forEach(v=>{v.source===_&&(v.extensions=v.extensions||{},v.extensions[NAME$l]={source:v.source},delete v.source)})}}),this}}index_modern_EXTTextureWebP.EXTENSION_NAME=NAME$l;const NAME$k=KHR_DRACO_MESH_COMPRESSION;let decoderModule,COMPONENT_ARRAY,DATA_TYPE,encoderModule;function decodeGeometry(h,o){const c=new decoderModule.DecoderBuffer;try{if(c.Init(o,o.length),h.GetEncodedGeometryType(c)!==decoderModule.TRIANGULAR_MESH)throw new Error(`[${NAME$k}] Unknown geometry type.`);const d=new decoderModule.Mesh;if(!h.DecodeBufferToMesh(c,d).ok()||d.ptr===0)throw new Error(`[${NAME$k}] Decoding failure.`);return d}finally{decoderModule.destroy(c)}}function decodeIndex(h,o){const c=3*o.num_faces();let d,_;if(o.num_points()<=65534){const v=c*Uint16Array.BYTES_PER_ELEMENT;d=decoderModule._malloc(v),h.GetTrianglesUInt16Array(o,v,d),_=new Uint16Array(decoderModule.HEAPU16.buffer,d,c).slice()}else{const v=c*Uint32Array.BYTES_PER_ELEMENT;d=decoderModule._malloc(v),h.GetTrianglesUInt32Array(o,v,d),_=new Uint32Array(decoderModule.HEAPU32.buffer,d,c).slice()}return decoderModule._free(d),_}function decodeAttribute(h,o,c,d){const _=DATA_TYPE[d.componentType],v=COMPONENT_ARRAY[d.componentType],b=c.num_components(),tt=o.num_points()*b,it=tt*v.BYTES_PER_ELEMENT,nt=decoderModule._malloc(it);h.GetAttributeDataArrayForAllPoints(o,c,_,it,nt);const lt=new v(decoderModule.HEAPF32.buffer,nt,tt).slice();return decoderModule._free(nt),lt}function initDecoderModule(h){decoderModule=h,COMPONENT_ARRAY={[index_modern_Accessor.ComponentType.FLOAT]:Float32Array,[index_modern_Accessor.ComponentType.UNSIGNED_INT]:Uint32Array,[index_modern_Accessor.ComponentType.UNSIGNED_SHORT]:Uint16Array,[index_modern_Accessor.ComponentType.UNSIGNED_BYTE]:Uint8Array,[index_modern_Accessor.ComponentType.SHORT]:Int16Array,[index_modern_Accessor.ComponentType.BYTE]:Int8Array},DATA_TYPE={[index_modern_Accessor.ComponentType.FLOAT]:decoderModule.DT_FLOAT32,[index_modern_Accessor.ComponentType.UNSIGNED_INT]:decoderModule.DT_UINT32,[index_modern_Accessor.ComponentType.UNSIGNED_SHORT]:decoderModule.DT_UINT16,[index_modern_Accessor.ComponentType.UNSIGNED_BYTE]:decoderModule.DT_UINT8,[index_modern_Accessor.ComponentType.SHORT]:decoderModule.DT_INT16,[index_modern_Accessor.ComponentType.BYTE]:decoderModule.DT_INT8}}var index_modern_EncoderMethod,AttributeEnum;(function(h){h[h.EDGEBREAKER=1]="EDGEBREAKER",h[h.SEQUENTIAL=0]="SEQUENTIAL"})(index_modern_EncoderMethod||(index_modern_EncoderMethod={})),function(h){h.POSITION="POSITION",h.NORMAL="NORMAL",h.COLOR="COLOR",h.TEX_COORD="TEX_COORD",h.GENERIC="GENERIC"}(AttributeEnum||(AttributeEnum={}));const DEFAULT_QUANTIZATION_BITS={[AttributeEnum.POSITION]:14,[AttributeEnum.NORMAL]:10,[AttributeEnum.COLOR]:8,[AttributeEnum.TEX_COORD]:12,[AttributeEnum.GENERIC]:12},DEFAULT_ENCODER_OPTIONS={decodeSpeed:5,encodeSpeed:5,method:index_modern_EncoderMethod.EDGEBREAKER,quantizationBits:DEFAULT_QUANTIZATION_BITS,quantizationVolume:"mesh"};function initEncoderModule(h){encoderModule=h}function encodeGeometry(h,o=DEFAULT_ENCODER_OPTIONS){const c=dist_index_modern_extends({},DEFAULT_ENCODER_OPTIONS,o);c.quantizationBits=dist_index_modern_extends({},DEFAULT_QUANTIZATION_BITS,o.quantizationBits);const d=new encoderModule.MeshBuilder,_=new encoderModule.Mesh,v=new encoderModule.ExpertEncoder(_),b={},tt=new encoderModule.DracoInt8Array,it=h.listTargets().length>0;let nt=!1;for(const bt of h.listSemantics()){const xt=h.getAttribute(bt);if(xt.getSparse()){nt=!0;continue}const St=getAttributeEnum(bt),wt=addAttribute(d,xt.getComponentType(),_,encoderModule[St],xt.getCount(),xt.getElementSize(),xt.getArray());if(wt===-1)throw new Error(`Error compressing "${bt}" attribute.`);if(b[bt]=wt,c.quantizationVolume==="mesh"||bt!=="POSITION")v.SetAttributeQuantization(wt,c.quantizationBits[St]);else{if(typeof c.quantizationVolume!="object")throw new Error("Invalid quantization volume state.");{const{quantizationVolume:Pt}=c,Rt=Math.max(Pt.max[0]-Pt.min[0],Pt.max[1]-Pt.min[1],Pt.max[2]-Pt.min[2]);v.SetAttributeExplicitQuantization(wt,c.quantizationBits[St],xt.getElementSize(),Pt.min,Rt)}}}const lt=h.getIndices();if(!lt)throw new EncodingError("Primitive must have indices.");d.AddFacesToMesh(_,lt.getCount()/3,lt.getArray()),v.SetSpeedOptions(c.encodeSpeed,c.decodeSpeed),v.SetTrackEncodedProperties(!0),c.method===index_modern_EncoderMethod.SEQUENTIAL||it||nt?v.SetEncodingMethod(encoderModule.MESH_SEQUENTIAL_ENCODING):v.SetEncodingMethod(encoderModule.MESH_EDGEBREAKER_ENCODING);const ut=v.EncodeToDracoBuffer(!(it||nt),tt);if(ut<=0)throw new EncodingError("Error applying Draco compression.");const ht=new Uint8Array(ut);for(let bt=0;bt<ut;++bt)ht[bt]=tt.GetValue(bt);const _t=v.GetNumberOfEncodedPoints(),ft=3*v.GetNumberOfEncodedFaces();return encoderModule.destroy(tt),encoderModule.destroy(_),encoderModule.destroy(d),encoderModule.destroy(v),{numVertices:_t,numIndices:ft,data:ht,attributeIDs:b}}function getAttributeEnum(h){return h==="POSITION"?AttributeEnum.POSITION:h==="NORMAL"?AttributeEnum.NORMAL:h.startsWith("COLOR_")?AttributeEnum.COLOR:h.startsWith("TEXCOORD_")?AttributeEnum.TEX_COORD:AttributeEnum.GENERIC}function addAttribute(h,o,c,d,_,v,b){switch(o){case index_modern_Accessor.ComponentType.UNSIGNED_BYTE:return h.AddUInt8Attribute(c,d,_,v,b);case index_modern_Accessor.ComponentType.BYTE:return h.AddInt8Attribute(c,d,_,v,b);case index_modern_Accessor.ComponentType.UNSIGNED_SHORT:return h.AddUInt16Attribute(c,d,_,v,b);case index_modern_Accessor.ComponentType.SHORT:return h.AddInt16Attribute(c,d,_,v,b);case index_modern_Accessor.ComponentType.UNSIGNED_INT:return h.AddUInt32Attribute(c,d,_,v,b);case index_modern_Accessor.ComponentType.FLOAT:return h.AddFloatAttribute(c,d,_,v,b);default:throw new Error(`Unexpected component type, "${o}".`)}}class EncodingError extends Error{}const NAME$j=KHR_DRACO_MESH_COMPRESSION;class index_modern_KHRDracoMeshCompression extends Extension{constructor(...o){super(...o),this.extensionName=NAME$j,this.prereadTypes=[index_modern_PropertyType.PRIMITIVE],this.prewriteTypes=[index_modern_PropertyType.ACCESSOR],this.readDependencies=["draco3d.decoder"],this.writeDependencies=["draco3d.encoder"],this._decoderModule=null,this._encoderModule=null,this._encoderOptions={}}install(o,c){return o==="draco3d.decoder"&&(this._decoderModule=c,initDecoderModule(this._decoderModule)),o==="draco3d.encoder"&&(this._encoderModule=c,initEncoderModule(this._encoderModule)),this}setEncoderOptions(o){return this._encoderOptions=o,this}preread(o){if(!this._decoderModule)throw new Error(`[${NAME$j}] Please install extension dependency, "draco3d.decoder".`);const c=this.document.getLogger(),d=o.jsonDoc,_=new Map;try{const v=d.json.meshes||[];for(const b of v)for(const tt of b.primitives){if(!tt.extensions||!tt.extensions[NAME$j])continue;const it=tt.extensions[NAME$j];let[nt,lt]=_.get(it.bufferView)||[];if(!lt||!nt){const ut=d.json.bufferViews[it.bufferView],ht=d.json.buffers[ut.buffer],_t=ht.uri?d.resources[ht.uri]:d.resources[GLB_BUFFER],ft=ut.byteOffset||0,bt=ut.byteLength,xt=index_modern_BufferUtils.toView(_t,ft,bt);nt=new this._decoderModule.Decoder,lt=decodeGeometry(nt,xt),_.set(it.bufferView,[nt,lt]),c.debug(`[${NAME$j}] Decompressed ${xt.byteLength} bytes.`)}for(const ut in tt.attributes){const ht=o.jsonDoc.json.accessors[tt.attributes[ut]],_t=nt.GetAttributeByUniqueId(lt,it.attributes[ut]),ft=decodeAttribute(nt,lt,_t,ht);o.accessors[tt.attributes[ut]].setArray(ft)}tt.indices!==void 0&&o.accessors[tt.indices].setArray(decodeIndex(nt,lt))}}finally{for(const[v,b]of Array.from(_.values()))this._decoderModule.destroy(v),this._decoderModule.destroy(b)}return this}read(o){return this}prewrite(o,c){if(!this._encoderModule)throw new Error(`[${NAME$j}] Please install extension dependency, "draco3d.encoder".`);const d=this.document.getLogger();d.debug(`[${NAME$j}] Compression options: ${JSON.stringify(this._encoderOptions)}`);const _=listDracoPrimitives(this.document),v=new Map;let b="mesh";this._encoderOptions.quantizationVolume==="scene"&&(this.document.getRoot().listScenes().length!==1?d.warn(`[${NAME$j}]: quantizationVolume=scene requires exactly 1 scene.`):b=getBounds(this.document.getRoot().listScenes().pop()));for(const tt of Array.from(_.keys())){const it=_.get(tt);if(!it)throw new Error("Unexpected primitive.");if(v.has(it)){v.set(it,v.get(it));continue}const nt=tt.getIndices(),lt=o.jsonDoc.json.accessors;let ut;try{ut=encodeGeometry(tt,dist_index_modern_extends({},this._encoderOptions,{quantizationVolume:b}))}catch(ft){if(ft instanceof EncodingError){d.warn(`[${NAME$j}]: ${ft.message} Skipping primitive compression.`);continue}throw ft}v.set(it,ut);const ht=o.createAccessorDef(nt);ht.count=ut.numIndices,o.accessorIndexMap.set(nt,lt.length),lt.push(ht),ut.numVertices>65534&&index_modern_Accessor.getComponentSize(ht.componentType)<=2?ht.componentType=index_modern_Accessor.ComponentType.UNSIGNED_INT:ut.numVertices>254&&index_modern_Accessor.getComponentSize(ht.componentType)<=1&&(ht.componentType=index_modern_Accessor.ComponentType.UNSIGNED_SHORT);for(const ft of tt.listSemantics()){const bt=tt.getAttribute(ft);if(ut.attributeIDs[ft]===void 0)continue;const xt=o.createAccessorDef(bt);xt.count=ut.numVertices,o.accessorIndexMap.set(bt,lt.length),lt.push(xt)}const _t=tt.getAttribute("POSITION").getBuffer()||this.document.getRoot().listBuffers()[0];o.otherBufferViews.has(_t)||o.otherBufferViews.set(_t,[]),o.otherBufferViews.get(_t).push(ut.data)}return d.debug(`[${NAME$j}] Compressed ${_.size} primitives.`),o.extensionData[NAME$j]={primitiveHashMap:_,primitiveEncodingMap:v},this}write(o){const c=o.extensionData[NAME$j];for(const d of this.document.getRoot().listMeshes()){const _=o.jsonDoc.json.meshes[o.meshIndexMap.get(d)];for(let v=0;v<d.listPrimitives().length;v++){const b=d.listPrimitives()[v],tt=_.primitives[v],it=c.primitiveHashMap.get(b);if(!it)continue;const nt=c.primitiveEncodingMap.get(it);nt&&(tt.extensions=tt.extensions||{},tt.extensions[NAME$j]={bufferView:o.otherBufferViewsIndexMap.get(nt.data),attributes:nt.attributeIDs})}}if(!c.primitiveHashMap.size){const d=o.jsonDoc.json;d.extensionsUsed=(d.extensionsUsed||[]).filter(_=>_!==NAME$j),d.extensionsRequired=(d.extensionsRequired||[]).filter(_=>_!==NAME$j)}return this}}function listDracoPrimitives(h){const o=h.getLogger(),c=new Set,d=new Set;let _=0,v=0;for(const ut of h.getRoot().listMeshes())for(const ht of ut.listPrimitives())ht.getIndices()?ht.getMode()!==index_modern_Primitive.Mode.TRIANGLES?(d.add(ht),v++):c.add(ht):(d.add(ht),_++);_>0&&o.warn(`[${NAME$j}] Skipping Draco compression of ${_} non-indexed primitives.`),v>0&&o.warn(`[${NAME$j}] Skipping Draco compression of ${v} non-TRIANGLES primitives.`);const b=h.getRoot().listAccessors(),tt=new Map;for(let ut=0;ut<b.length;ut++)tt.set(b[ut],ut);const it=new Map,nt=new Set,lt=new Map;for(const ut of Array.from(c)){let ht=createHashKey(ut,tt);if(nt.has(ht))lt.set(ut,ht);else{if(it.has(ut.getIndices())){const _t=ut.getIndices(),ft=_t.clone();tt.set(ft,h.getRoot().listAccessors().length-1),ut.swap(_t,ft)}for(const _t of ut.listAttributes())if(it.has(_t)){const ft=_t.clone();tt.set(ft,h.getRoot().listAccessors().length-1),ut.swap(_t,ft)}ht=createHashKey(ut,tt),nt.add(ht),lt.set(ut,ht),it.set(ut.getIndices(),ht);for(const _t of ut.listAttributes())it.set(_t,ht)}}for(const ut of Array.from(it.keys())){const ht=new Set(ut.listParents().map(_t=>_t.propertyType));if(ht.size!==2||!ht.has(index_modern_PropertyType.PRIMITIVE)||!ht.has(index_modern_PropertyType.ROOT))throw new Error(`[${NAME$j}] Compressed accessors must only be used as indices or vertex attributes.`)}for(const ut of Array.from(c)){const ht=lt.get(ut),_t=ut.getIndices();if(it.get(_t)!==ht||ut.listAttributes().some(ft=>it.get(ft)!==ht))throw new Error(`[${NAME$j}] Draco primitives must share all, or no, accessors.`)}for(const ut of Array.from(d)){const ht=ut.getIndices();if(it.has(ht)||ut.listAttributes().some(_t=>it.has(_t)))throw new Error(`[${NAME$j}] Accessor cannot be shared by compressed and uncompressed primitives.`)}return lt}function createHashKey(h,o){const c=[],d=h.getIndices();c.push(o.get(d));for(const _ of h.listAttributes())c.push(o.get(_));return c.sort().join("|")}index_modern_KHRDracoMeshCompression.EXTENSION_NAME=NAME$j,index_modern_KHRDracoMeshCompression.EncoderMethod=index_modern_EncoderMethod;class Light extends index_modern_ExtensionProperty{init(){this.extensionName=KHR_LIGHTS_PUNCTUAL,this.propertyType="Light",this.parentTypes=[index_modern_PropertyType.NODE]}getDefaults(){return Object.assign(super.getDefaults(),{color:[1,1,1],intensity:1,type:Light.Type.POINT,range:null,innerConeAngle:0,outerConeAngle:Math.PI/4})}getColor(){return this.get("color")}setColor(o){return this.set("color",o)}getIntensity(){return this.get("intensity")}setIntensity(o){return this.set("intensity",o)}getType(){return this.get("type")}setType(o){return this.set("type",o)}getRange(){return this.get("range")}setRange(o){return this.set("range",o)}getInnerConeAngle(){return this.get("innerConeAngle")}setInnerConeAngle(o){return this.set("innerConeAngle",o)}getOuterConeAngle(){return this.get("outerConeAngle")}setOuterConeAngle(o){return this.set("outerConeAngle",o)}}Light.EXTENSION_NAME=KHR_LIGHTS_PUNCTUAL,Light.Type={POINT:"point",SPOT:"spot",DIRECTIONAL:"directional"};const NAME$i=KHR_LIGHTS_PUNCTUAL;class KHRLightsPunctual extends Extension{constructor(...o){super(...o),this.extensionName=NAME$i}createLight(o=""){return new Light(this.document.getGraph(),o)}read(o){const c=o.jsonDoc;if(!c.json.extensions||!c.json.extensions[NAME$i])return this;const d=(c.json.extensions[NAME$i].lights||[]).map(_=>{var v,b;const tt=this.createLight().setName(_.name||"").setType(_.type);return _.color!==void 0&&tt.setColor(_.color),_.intensity!==void 0&&tt.setIntensity(_.intensity),_.range!==void 0&&tt.setRange(_.range),((v=_.spot)==null?void 0:v.innerConeAngle)!==void 0&&tt.setInnerConeAngle(_.spot.innerConeAngle),((b=_.spot)==null?void 0:b.outerConeAngle)!==void 0&&tt.setOuterConeAngle(_.spot.outerConeAngle),tt});return c.json.nodes.forEach((_,v)=>{if(!_.extensions||!_.extensions[NAME$i])return;const b=_.extensions[NAME$i];o.nodes[v].setExtension(NAME$i,d[b.light])}),this}write(o){const c=o.jsonDoc;if(this.properties.size===0)return this;const d=[],_=new Map;for(const v of this.properties){const b=v,tt={type:b.getType()};index_modern_MathUtils.eq(b.getColor(),[1,1,1])||(tt.color=b.getColor()),b.getIntensity()!==1&&(tt.intensity=b.getIntensity()),b.getRange()!=null&&(tt.range=b.getRange()),b.getName()&&(tt.name=b.getName()),b.getType()===Light.Type.SPOT&&(tt.spot={innerConeAngle:b.getInnerConeAngle(),outerConeAngle:b.getOuterConeAngle()}),d.push(tt),_.set(b,d.length-1)}return this.document.getRoot().listNodes().forEach(v=>{const b=v.getExtension(NAME$i);if(b){const tt=o.nodeIndexMap.get(v),it=c.json.nodes[tt];it.extensions=it.extensions||{},it.extensions[NAME$i]={light:_.get(b)}}}),c.json.extensions=c.json.extensions||{},c.json.extensions[NAME$i]={lights:d},this}}KHRLightsPunctual.EXTENSION_NAME=NAME$i;const{R:R$7,G:G$7,B:B$5}=index_modern_TextureChannel;class Anisotropy extends index_modern_ExtensionProperty{init(){this.extensionName=KHR_MATERIALS_ANISOTROPY,this.propertyType="Anisotropy",this.parentTypes=[index_modern_PropertyType.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{anisotropyStrength:0,anisotropyRotation:0,anisotropyTexture:null,anisotropyTextureInfo:new index_modern_TextureInfo(this.graph,"anisotropyTextureInfo")})}getAnisotropyStrength(){return this.get("anisotropyStrength")}setAnisotropyStrength(o){return this.set("anisotropyStrength",o)}getAnisotropyRotation(){return this.get("anisotropyRotation")}setAnisotropyRotation(o){return this.set("anisotropyRotation",o)}getAnisotropyTexture(){return this.getRef("anisotropyTexture")}getAnisotropyTextureInfo(){return this.getRef("anisotropyTexture")?this.getRef("anisotropyTextureInfo"):null}setAnisotropyTexture(o){return this.setRef("anisotropyTexture",o,{channels:R$7|G$7|B$5})}}Anisotropy.EXTENSION_NAME=KHR_MATERIALS_ANISOTROPY;const NAME$h=KHR_MATERIALS_ANISOTROPY;class KHRMaterialsAnisotropy extends Extension{constructor(...o){super(...o),this.extensionName=NAME$h,this.prereadTypes=[index_modern_PropertyType.MESH],this.prewriteTypes=[index_modern_PropertyType.MESH]}createAnisotropy(){return new Anisotropy(this.document.getGraph())}read(o){return this}write(o){return this}preread(o){const c=o.jsonDoc,d=c.json.materials||[],_=c.json.textures||[];return d.forEach((v,b)=>{if(v.extensions&&v.extensions[NAME$h]){const tt=this.createAnisotropy();o.materials[b].setExtension(NAME$h,tt);const it=v.extensions[NAME$h];if(it.anisotropyStrength!==void 0&&tt.setAnisotropyStrength(it.anisotropyStrength),it.anisotropyRotation!==void 0&&tt.setAnisotropyRotation(it.anisotropyRotation),it.anisotropyTexture!==void 0){const nt=it.anisotropyTexture,lt=o.textures[_[nt.index].source];tt.setAnisotropyTexture(lt),o.setTextureInfo(tt.getAnisotropyTextureInfo(),nt)}}}),this}prewrite(o){const c=o.jsonDoc;return this.document.getRoot().listMaterials().forEach(d=>{const _=d.getExtension(NAME$h);if(_){const v=o.materialIndexMap.get(d),b=c.json.materials[v];b.extensions=b.extensions||{};const tt=b.extensions[NAME$h]={};if(_.getAnisotropyStrength()>0&&(tt.anisotropyStrength=_.getAnisotropyStrength()),_.getAnisotropyRotation()!==0&&(tt.anisotropyRotation=_.getAnisotropyRotation()),_.getAnisotropyTexture()){const it=_.getAnisotropyTexture(),nt=_.getAnisotropyTextureInfo();tt.anisotropyTexture=o.createTextureInfoDef(it,nt)}}}),this}}KHRMaterialsAnisotropy.EXTENSION_NAME=NAME$h;const{R:R$6,G:G$6,B:B$4}=index_modern_TextureChannel;class Clearcoat extends index_modern_ExtensionProperty{init(){this.extensionName=KHR_MATERIALS_CLEARCOAT,this.propertyType="Clearcoat",this.parentTypes=[index_modern_PropertyType.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{clearcoatFactor:0,clearcoatTexture:null,clearcoatTextureInfo:new index_modern_TextureInfo(this.graph,"clearcoatTextureInfo"),clearcoatRoughnessFactor:0,clearcoatRoughnessTexture:null,clearcoatRoughnessTextureInfo:new index_modern_TextureInfo(this.graph,"clearcoatRoughnessTextureInfo"),clearcoatNormalScale:1,clearcoatNormalTexture:null,clearcoatNormalTextureInfo:new index_modern_TextureInfo(this.graph,"clearcoatNormalTextureInfo")})}getClearcoatFactor(){return this.get("clearcoatFactor")}setClearcoatFactor(o){return this.set("clearcoatFactor",o)}getClearcoatTexture(){return this.getRef("clearcoatTexture")}getClearcoatTextureInfo(){return this.getRef("clearcoatTexture")?this.getRef("clearcoatTextureInfo"):null}setClearcoatTexture(o){return this.setRef("clearcoatTexture",o,{channels:R$6})}getClearcoatRoughnessFactor(){return this.get("clearcoatRoughnessFactor")}setClearcoatRoughnessFactor(o){return this.set("clearcoatRoughnessFactor",o)}getClearcoatRoughnessTexture(){return this.getRef("clearcoatRoughnessTexture")}getClearcoatRoughnessTextureInfo(){return this.getRef("clearcoatRoughnessTexture")?this.getRef("clearcoatRoughnessTextureInfo"):null}setClearcoatRoughnessTexture(o){return this.setRef("clearcoatRoughnessTexture",o,{channels:G$6})}getClearcoatNormalScale(){return this.get("clearcoatNormalScale")}setClearcoatNormalScale(o){return this.set("clearcoatNormalScale",o)}getClearcoatNormalTexture(){return this.getRef("clearcoatNormalTexture")}getClearcoatNormalTextureInfo(){return this.getRef("clearcoatNormalTexture")?this.getRef("clearcoatNormalTextureInfo"):null}setClearcoatNormalTexture(o){return this.setRef("clearcoatNormalTexture",o,{channels:R$6|G$6|B$4})}}Clearcoat.EXTENSION_NAME=KHR_MATERIALS_CLEARCOAT;const NAME$g=KHR_MATERIALS_CLEARCOAT;class KHRMaterialsClearcoat extends Extension{constructor(...o){super(...o),this.extensionName=NAME$g,this.prereadTypes=[index_modern_PropertyType.MESH],this.prewriteTypes=[index_modern_PropertyType.MESH]}createClearcoat(){return new Clearcoat(this.document.getGraph())}read(o){return this}write(o){return this}preread(o){const c=o.jsonDoc,d=c.json.materials||[],_=c.json.textures||[];return d.forEach((v,b)=>{if(v.extensions&&v.extensions[NAME$g]){const tt=this.createClearcoat();o.materials[b].setExtension(NAME$g,tt);const it=v.extensions[NAME$g];if(it.clearcoatFactor!==void 0&&tt.setClearcoatFactor(it.clearcoatFactor),it.clearcoatRoughnessFactor!==void 0&&tt.setClearcoatRoughnessFactor(it.clearcoatRoughnessFactor),it.clearcoatTexture!==void 0){const nt=it.clearcoatTexture,lt=o.textures[_[nt.index].source];tt.setClearcoatTexture(lt),o.setTextureInfo(tt.getClearcoatTextureInfo(),nt)}if(it.clearcoatRoughnessTexture!==void 0){const nt=it.clearcoatRoughnessTexture,lt=o.textures[_[nt.index].source];tt.setClearcoatRoughnessTexture(lt),o.setTextureInfo(tt.getClearcoatRoughnessTextureInfo(),nt)}if(it.clearcoatNormalTexture!==void 0){const nt=it.clearcoatNormalTexture,lt=o.textures[_[nt.index].source];tt.setClearcoatNormalTexture(lt),o.setTextureInfo(tt.getClearcoatNormalTextureInfo(),nt),nt.scale!==void 0&&tt.setClearcoatNormalScale(nt.scale)}}}),this}prewrite(o){const c=o.jsonDoc;return this.document.getRoot().listMaterials().forEach(d=>{const _=d.getExtension(NAME$g);if(_){const v=o.materialIndexMap.get(d),b=c.json.materials[v];b.extensions=b.extensions||{};const tt=b.extensions[NAME$g]={clearcoatFactor:_.getClearcoatFactor(),clearcoatRoughnessFactor:_.getClearcoatRoughnessFactor()};if(_.getClearcoatTexture()){const it=_.getClearcoatTexture(),nt=_.getClearcoatTextureInfo();tt.clearcoatTexture=o.createTextureInfoDef(it,nt)}if(_.getClearcoatRoughnessTexture()){const it=_.getClearcoatRoughnessTexture(),nt=_.getClearcoatRoughnessTextureInfo();tt.clearcoatRoughnessTexture=o.createTextureInfoDef(it,nt)}if(_.getClearcoatNormalTexture()){const it=_.getClearcoatNormalTexture(),nt=_.getClearcoatNormalTextureInfo();tt.clearcoatNormalTexture=o.createTextureInfoDef(it,nt),_.getClearcoatNormalScale()!==1&&(tt.clearcoatNormalTexture.scale=_.getClearcoatNormalScale())}}}),this}}KHRMaterialsClearcoat.EXTENSION_NAME=NAME$g;const{R:R$5,G:G$5,B:B$3,A:A$3}=index_modern_TextureChannel;class DiffuseTransmission extends index_modern_ExtensionProperty{init(){this.extensionName=KHR_MATERIALS_DIFFUSE_TRANSMISSION,this.propertyType="DiffuseTransmission",this.parentTypes=[index_modern_PropertyType.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{diffuseTransmissionFactor:0,diffuseTransmissionTexture:null,diffuseTransmissionTextureInfo:new index_modern_TextureInfo(this.graph,"diffuseTransmissionTextureInfo"),diffuseTransmissionColorFactor:[1,1,1],diffuseTransmissionColorTexture:null,diffuseTransmissionColorTextureInfo:new index_modern_TextureInfo(this.graph,"diffuseTransmissionColorTextureInfo")})}getDiffuseTransmissionFactor(){return this.get("diffuseTransmissionFactor")}setDiffuseTransmissionFactor(o){return this.set("diffuseTransmissionFactor",o)}getDiffuseTransmissionTexture(){return this.getRef("diffuseTransmissionTexture")}getDiffuseTransmissionTextureInfo(){return this.getRef("diffuseTransmissionTexture")?this.getRef("diffuseTransmissionTextureInfo"):null}setDiffuseTransmissionTexture(o){return this.setRef("diffuseTransmissionTexture",o,{channels:A$3})}getDiffuseTransmissionColorFactor(){return this.get("diffuseTransmissionColorFactor")}setDiffuseTransmissionColorFactor(o){return this.set("diffuseTransmissionColorFactor",o)}getDiffuseTransmissionColorTexture(){return this.getRef("diffuseTransmissionColorTexture")}getDiffuseTransmissionColorTextureInfo(){return this.getRef("diffuseTransmissionColorTexture")?this.getRef("diffuseTransmissionColorTextureInfo"):null}setDiffuseTransmissionColorTexture(o){return this.setRef("diffuseTransmissionColorTexture",o,{channels:R$5|G$5|B$3})}}DiffuseTransmission.EXTENSION_NAME=KHR_MATERIALS_DIFFUSE_TRANSMISSION;const NAME$f=KHR_MATERIALS_DIFFUSE_TRANSMISSION;class KHRMaterialsDiffuseTransmission extends Extension{constructor(...o){super(...o),this.extensionName=NAME$f}createDiffuseTransmission(){return new DiffuseTransmission(this.document.getGraph())}read(o){const c=o.jsonDoc,d=c.json.materials||[],_=c.json.textures||[];return d.forEach((v,b)=>{if(v.extensions&&v.extensions[NAME$f]){const tt=this.createDiffuseTransmission();o.materials[b].setExtension(NAME$f,tt);const it=v.extensions[NAME$f];if(it.diffuseTransmissionFactor!==void 0&&tt.setDiffuseTransmissionFactor(it.diffuseTransmissionFactor),it.diffuseTransmissionColorFactor!==void 0&&tt.setDiffuseTransmissionColorFactor(it.diffuseTransmissionColorFactor),it.diffuseTransmissionTexture!==void 0){const nt=it.diffuseTransmissionTexture,lt=o.textures[_[nt.index].source];tt.setDiffuseTransmissionTexture(lt),o.setTextureInfo(tt.getDiffuseTransmissionTextureInfo(),nt)}if(it.diffuseTransmissionColorTexture!==void 0){const nt=it.diffuseTransmissionColorTexture,lt=o.textures[_[nt.index].source];tt.setDiffuseTransmissionColorTexture(lt),o.setTextureInfo(tt.getDiffuseTransmissionColorTextureInfo(),nt)}}}),this}write(o){const c=o.jsonDoc;for(const d of this.document.getRoot().listMaterials()){const _=d.getExtension(NAME$f);if(!_)continue;const v=o.materialIndexMap.get(d),b=c.json.materials[v];b.extensions=b.extensions||{};const tt=b.extensions[NAME$f]={diffuseTransmissionFactor:_.getDiffuseTransmissionFactor(),diffuseTransmissionColorFactor:_.getDiffuseTransmissionColorFactor()};if(_.getDiffuseTransmissionTexture()){const it=_.getDiffuseTransmissionTexture(),nt=_.getDiffuseTransmissionTextureInfo();tt.diffuseTransmissionTexture=o.createTextureInfoDef(it,nt)}if(_.getDiffuseTransmissionColorTexture()){const it=_.getDiffuseTransmissionColorTexture(),nt=_.getDiffuseTransmissionColorTextureInfo();tt.diffuseTransmissionColorTexture=o.createTextureInfoDef(it,nt)}}return this}}KHRMaterialsDiffuseTransmission.EXTENSION_NAME=NAME$f;class Dispersion extends index_modern_ExtensionProperty{init(){this.extensionName=KHR_MATERIALS_DISPERSION,this.propertyType="Dispersion",this.parentTypes=[index_modern_PropertyType.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{dispersion:0})}getDispersion(){return this.get("dispersion")}setDispersion(o){return this.set("dispersion",o)}}Dispersion.EXTENSION_NAME=KHR_MATERIALS_DISPERSION;const NAME$e=KHR_MATERIALS_DISPERSION;class KHRMaterialsDispersion extends Extension{constructor(...o){super(...o),this.extensionName=NAME$e,this.prereadTypes=[index_modern_PropertyType.MESH],this.prewriteTypes=[index_modern_PropertyType.MESH]}createDispersion(){return new Dispersion(this.document.getGraph())}read(o){return this}write(o){return this}preread(o){return(o.jsonDoc.json.materials||[]).forEach((c,d)=>{if(c.extensions&&c.extensions[NAME$e]){const _=this.createDispersion();o.materials[d].setExtension(NAME$e,_);const v=c.extensions[NAME$e];v.dispersion!==void 0&&_.setDispersion(v.dispersion)}}),this}prewrite(o){const c=o.jsonDoc;return this.document.getRoot().listMaterials().forEach(d=>{const _=d.getExtension(NAME$e);if(_){const v=o.materialIndexMap.get(d),b=c.json.materials[v];b.extensions=b.extensions||{},b.extensions[NAME$e]={dispersion:_.getDispersion()}}}),this}}KHRMaterialsDispersion.EXTENSION_NAME=NAME$e;class EmissiveStrength extends index_modern_ExtensionProperty{init(){this.extensionName=KHR_MATERIALS_EMISSIVE_STRENGTH,this.propertyType="EmissiveStrength",this.parentTypes=[index_modern_PropertyType.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{emissiveStrength:1})}getEmissiveStrength(){return this.get("emissiveStrength")}setEmissiveStrength(o){return this.set("emissiveStrength",o)}}EmissiveStrength.EXTENSION_NAME=KHR_MATERIALS_EMISSIVE_STRENGTH;const NAME$d=KHR_MATERIALS_EMISSIVE_STRENGTH;class KHRMaterialsEmissiveStrength extends Extension{constructor(...o){super(...o),this.extensionName=NAME$d,this.prereadTypes=[index_modern_PropertyType.MESH],this.prewriteTypes=[index_modern_PropertyType.MESH]}createEmissiveStrength(){return new EmissiveStrength(this.document.getGraph())}read(o){return this}write(o){return this}preread(o){return(o.jsonDoc.json.materials||[]).forEach((c,d)=>{if(c.extensions&&c.extensions[NAME$d]){const _=this.createEmissiveStrength();o.materials[d].setExtension(NAME$d,_);const v=c.extensions[NAME$d];v.emissiveStrength!==void 0&&_.setEmissiveStrength(v.emissiveStrength)}}),this}prewrite(o){const c=o.jsonDoc;return this.document.getRoot().listMaterials().forEach(d=>{const _=d.getExtension(NAME$d);if(_){const v=o.materialIndexMap.get(d),b=c.json.materials[v];b.extensions=b.extensions||{},b.extensions[NAME$d]={emissiveStrength:_.getEmissiveStrength()}}}),this}}KHRMaterialsEmissiveStrength.EXTENSION_NAME=NAME$d;class IOR extends index_modern_ExtensionProperty{init(){this.extensionName=KHR_MATERIALS_IOR,this.propertyType="IOR",this.parentTypes=[index_modern_PropertyType.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{ior:1.5})}getIOR(){return this.get("ior")}setIOR(o){return this.set("ior",o)}}IOR.EXTENSION_NAME=KHR_MATERIALS_IOR;const NAME$c=KHR_MATERIALS_IOR;class KHRMaterialsIOR extends Extension{constructor(...o){super(...o),this.extensionName=NAME$c,this.prereadTypes=[index_modern_PropertyType.MESH],this.prewriteTypes=[index_modern_PropertyType.MESH]}createIOR(){return new IOR(this.document.getGraph())}read(o){return this}write(o){return this}preread(o){return(o.jsonDoc.json.materials||[]).forEach((c,d)=>{if(c.extensions&&c.extensions[NAME$c]){const _=this.createIOR();o.materials[d].setExtension(NAME$c,_);const v=c.extensions[NAME$c];v.ior!==void 0&&_.setIOR(v.ior)}}),this}prewrite(o){const c=o.jsonDoc;return this.document.getRoot().listMaterials().forEach(d=>{const _=d.getExtension(NAME$c);if(_){const v=o.materialIndexMap.get(d),b=c.json.materials[v];b.extensions=b.extensions||{},b.extensions[NAME$c]={ior:_.getIOR()}}}),this}}KHRMaterialsIOR.EXTENSION_NAME=NAME$c;const{R:R$4,G:G$4}=index_modern_TextureChannel;class Iridescence extends index_modern_ExtensionProperty{init(){this.extensionName=KHR_MATERIALS_IRIDESCENCE,this.propertyType="Iridescence",this.parentTypes=[index_modern_PropertyType.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{iridescenceFactor:0,iridescenceTexture:null,iridescenceTextureInfo:new index_modern_TextureInfo(this.graph,"iridescenceTextureInfo"),iridescenceIOR:1.3,iridescenceThicknessMinimum:100,iridescenceThicknessMaximum:400,iridescenceThicknessTexture:null,iridescenceThicknessTextureInfo:new index_modern_TextureInfo(this.graph,"iridescenceThicknessTextureInfo")})}getIridescenceFactor(){return this.get("iridescenceFactor")}setIridescenceFactor(o){return this.set("iridescenceFactor",o)}getIridescenceTexture(){return this.getRef("iridescenceTexture")}getIridescenceTextureInfo(){return this.getRef("iridescenceTexture")?this.getRef("iridescenceTextureInfo"):null}setIridescenceTexture(o){return this.setRef("iridescenceTexture",o,{channels:R$4})}getIridescenceIOR(){return this.get("iridescenceIOR")}setIridescenceIOR(o){return this.set("iridescenceIOR",o)}getIridescenceThicknessMinimum(){return this.get("iridescenceThicknessMinimum")}setIridescenceThicknessMinimum(o){return this.set("iridescenceThicknessMinimum",o)}getIridescenceThicknessMaximum(){return this.get("iridescenceThicknessMaximum")}setIridescenceThicknessMaximum(o){return this.set("iridescenceThicknessMaximum",o)}getIridescenceThicknessTexture(){return this.getRef("iridescenceThicknessTexture")}getIridescenceThicknessTextureInfo(){return this.getRef("iridescenceThicknessTexture")?this.getRef("iridescenceThicknessTextureInfo"):null}setIridescenceThicknessTexture(o){return this.setRef("iridescenceThicknessTexture",o,{channels:G$4})}}Iridescence.EXTENSION_NAME=KHR_MATERIALS_IRIDESCENCE;const NAME$b=KHR_MATERIALS_IRIDESCENCE;class KHRMaterialsIridescence extends Extension{constructor(...o){super(...o),this.extensionName=NAME$b,this.prereadTypes=[index_modern_PropertyType.MESH],this.prewriteTypes=[index_modern_PropertyType.MESH]}createIridescence(){return new Iridescence(this.document.getGraph())}read(o){return this}write(o){return this}preread(o){const c=o.jsonDoc,d=c.json.materials||[],_=c.json.textures||[];return d.forEach((v,b)=>{if(v.extensions&&v.extensions[NAME$b]){const tt=this.createIridescence();o.materials[b].setExtension(NAME$b,tt);const it=v.extensions[NAME$b];if(it.iridescenceFactor!==void 0&&tt.setIridescenceFactor(it.iridescenceFactor),it.iridescenceIor!==void 0&&tt.setIridescenceIOR(it.iridescenceIor),it.iridescenceThicknessMinimum!==void 0&&tt.setIridescenceThicknessMinimum(it.iridescenceThicknessMinimum),it.iridescenceThicknessMaximum!==void 0&&tt.setIridescenceThicknessMaximum(it.iridescenceThicknessMaximum),it.iridescenceTexture!==void 0){const nt=it.iridescenceTexture,lt=o.textures[_[nt.index].source];tt.setIridescenceTexture(lt),o.setTextureInfo(tt.getIridescenceTextureInfo(),nt)}if(it.iridescenceThicknessTexture!==void 0){const nt=it.iridescenceThicknessTexture,lt=o.textures[_[nt.index].source];tt.setIridescenceThicknessTexture(lt),o.setTextureInfo(tt.getIridescenceThicknessTextureInfo(),nt)}}}),this}prewrite(o){const c=o.jsonDoc;return this.document.getRoot().listMaterials().forEach(d=>{const _=d.getExtension(NAME$b);if(_){const v=o.materialIndexMap.get(d),b=c.json.materials[v];b.extensions=b.extensions||{};const tt=b.extensions[NAME$b]={};if(_.getIridescenceFactor()>0&&(tt.iridescenceFactor=_.getIridescenceFactor()),_.getIridescenceIOR()!==1.3&&(tt.iridescenceIor=_.getIridescenceIOR()),_.getIridescenceThicknessMinimum()!==100&&(tt.iridescenceThicknessMinimum=_.getIridescenceThicknessMinimum()),_.getIridescenceThicknessMaximum()!==400&&(tt.iridescenceThicknessMaximum=_.getIridescenceThicknessMaximum()),_.getIridescenceTexture()){const it=_.getIridescenceTexture(),nt=_.getIridescenceTextureInfo();tt.iridescenceTexture=o.createTextureInfoDef(it,nt)}if(_.getIridescenceThicknessTexture()){const it=_.getIridescenceThicknessTexture(),nt=_.getIridescenceThicknessTextureInfo();tt.iridescenceThicknessTexture=o.createTextureInfoDef(it,nt)}}}),this}}KHRMaterialsIridescence.EXTENSION_NAME=NAME$b;const{R:R$3,G:G$3,B:B$2$1,A:A$2}=index_modern_TextureChannel;class PBRSpecularGlossiness extends index_modern_ExtensionProperty{init(){this.extensionName=KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,this.propertyType="PBRSpecularGlossiness",this.parentTypes=[index_modern_PropertyType.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{diffuseFactor:[1,1,1,1],diffuseTexture:null,diffuseTextureInfo:new index_modern_TextureInfo(this.graph,"diffuseTextureInfo"),specularFactor:[1,1,1],glossinessFactor:1,specularGlossinessTexture:null,specularGlossinessTextureInfo:new index_modern_TextureInfo(this.graph,"specularGlossinessTextureInfo")})}getDiffuseFactor(){return this.get("diffuseFactor")}setDiffuseFactor(o){return this.set("diffuseFactor",o)}getDiffuseTexture(){return this.getRef("diffuseTexture")}getDiffuseTextureInfo(){return this.getRef("diffuseTexture")?this.getRef("diffuseTextureInfo"):null}setDiffuseTexture(o){return this.setRef("diffuseTexture",o,{channels:R$3|G$3|B$2$1|A$2,isColor:!0})}getSpecularFactor(){return this.get("specularFactor")}setSpecularFactor(o){return this.set("specularFactor",o)}getGlossinessFactor(){return this.get("glossinessFactor")}setGlossinessFactor(o){return this.set("glossinessFactor",o)}getSpecularGlossinessTexture(){return this.getRef("specularGlossinessTexture")}getSpecularGlossinessTextureInfo(){return this.getRef("specularGlossinessTexture")?this.getRef("specularGlossinessTextureInfo"):null}setSpecularGlossinessTexture(o){return this.setRef("specularGlossinessTexture",o,{channels:R$3|G$3|B$2$1|A$2})}}PBRSpecularGlossiness.EXTENSION_NAME=KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS;const NAME$a=KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS;class KHRMaterialsPBRSpecularGlossiness extends Extension{constructor(...o){super(...o),this.extensionName=NAME$a,this.prereadTypes=[index_modern_PropertyType.MESH],this.prewriteTypes=[index_modern_PropertyType.MESH]}createPBRSpecularGlossiness(){return new PBRSpecularGlossiness(this.document.getGraph())}read(o){return this}write(o){return this}preread(o){const c=o.jsonDoc,d=c.json.materials||[],_=c.json.textures||[];return d.forEach((v,b)=>{if(v.extensions&&v.extensions[NAME$a]){const tt=this.createPBRSpecularGlossiness();o.materials[b].setExtension(NAME$a,tt);const it=v.extensions[NAME$a];if(it.diffuseFactor!==void 0&&tt.setDiffuseFactor(it.diffuseFactor),it.specularFactor!==void 0&&tt.setSpecularFactor(it.specularFactor),it.glossinessFactor!==void 0&&tt.setGlossinessFactor(it.glossinessFactor),it.diffuseTexture!==void 0){const nt=it.diffuseTexture,lt=o.textures[_[nt.index].source];tt.setDiffuseTexture(lt),o.setTextureInfo(tt.getDiffuseTextureInfo(),nt)}if(it.specularGlossinessTexture!==void 0){const nt=it.specularGlossinessTexture,lt=o.textures[_[nt.index].source];tt.setSpecularGlossinessTexture(lt),o.setTextureInfo(tt.getSpecularGlossinessTextureInfo(),nt)}}}),this}prewrite(o){const c=o.jsonDoc;return this.document.getRoot().listMaterials().forEach(d=>{const _=d.getExtension(NAME$a);if(_){const v=o.materialIndexMap.get(d),b=c.json.materials[v];b.extensions=b.extensions||{};const tt=b.extensions[NAME$a]={diffuseFactor:_.getDiffuseFactor(),specularFactor:_.getSpecularFactor(),glossinessFactor:_.getGlossinessFactor()};if(_.getDiffuseTexture()){const it=_.getDiffuseTexture(),nt=_.getDiffuseTextureInfo();tt.diffuseTexture=o.createTextureInfoDef(it,nt)}if(_.getSpecularGlossinessTexture()){const it=_.getSpecularGlossinessTexture(),nt=_.getSpecularGlossinessTextureInfo();tt.specularGlossinessTexture=o.createTextureInfoDef(it,nt)}}}),this}}KHRMaterialsPBRSpecularGlossiness.EXTENSION_NAME=NAME$a;const{R:R$2$1,G:G$2$1,B:B$1$1,A:A$1$1}=index_modern_TextureChannel;class Sheen extends index_modern_ExtensionProperty{init(){this.extensionName=KHR_MATERIALS_SHEEN,this.propertyType="Sheen",this.parentTypes=[index_modern_PropertyType.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{sheenColorFactor:[0,0,0],sheenColorTexture:null,sheenColorTextureInfo:new index_modern_TextureInfo(this.graph,"sheenColorTextureInfo"),sheenRoughnessFactor:0,sheenRoughnessTexture:null,sheenRoughnessTextureInfo:new index_modern_TextureInfo(this.graph,"sheenRoughnessTextureInfo")})}getSheenColorFactor(){return this.get("sheenColorFactor")}setSheenColorFactor(o){return this.set("sheenColorFactor",o)}getSheenColorTexture(){return this.getRef("sheenColorTexture")}getSheenColorTextureInfo(){return this.getRef("sheenColorTexture")?this.getRef("sheenColorTextureInfo"):null}setSheenColorTexture(o){return this.setRef("sheenColorTexture",o,{channels:R$2$1|G$2$1|B$1$1,isColor:!0})}getSheenRoughnessFactor(){return this.get("sheenRoughnessFactor")}setSheenRoughnessFactor(o){return this.set("sheenRoughnessFactor",o)}getSheenRoughnessTexture(){return this.getRef("sheenRoughnessTexture")}getSheenRoughnessTextureInfo(){return this.getRef("sheenRoughnessTexture")?this.getRef("sheenRoughnessTextureInfo"):null}setSheenRoughnessTexture(o){return this.setRef("sheenRoughnessTexture",o,{channels:A$1$1})}}Sheen.EXTENSION_NAME=KHR_MATERIALS_SHEEN;const NAME$9=KHR_MATERIALS_SHEEN;class KHRMaterialsSheen extends Extension{constructor(...o){super(...o),this.extensionName=NAME$9,this.prereadTypes=[index_modern_PropertyType.MESH],this.prewriteTypes=[index_modern_PropertyType.MESH]}createSheen(){return new Sheen(this.document.getGraph())}read(o){return this}write(o){return this}preread(o){const c=o.jsonDoc,d=c.json.materials||[],_=c.json.textures||[];return d.forEach((v,b)=>{if(v.extensions&&v.extensions[NAME$9]){const tt=this.createSheen();o.materials[b].setExtension(NAME$9,tt);const it=v.extensions[NAME$9];if(it.sheenColorFactor!==void 0&&tt.setSheenColorFactor(it.sheenColorFactor),it.sheenRoughnessFactor!==void 0&&tt.setSheenRoughnessFactor(it.sheenRoughnessFactor),it.sheenColorTexture!==void 0){const nt=it.sheenColorTexture,lt=o.textures[_[nt.index].source];tt.setSheenColorTexture(lt),o.setTextureInfo(tt.getSheenColorTextureInfo(),nt)}if(it.sheenRoughnessTexture!==void 0){const nt=it.sheenRoughnessTexture,lt=o.textures[_[nt.index].source];tt.setSheenRoughnessTexture(lt),o.setTextureInfo(tt.getSheenRoughnessTextureInfo(),nt)}}}),this}prewrite(o){const c=o.jsonDoc;return this.document.getRoot().listMaterials().forEach(d=>{const _=d.getExtension(NAME$9);if(_){const v=o.materialIndexMap.get(d),b=c.json.materials[v];b.extensions=b.extensions||{};const tt=b.extensions[NAME$9]={sheenColorFactor:_.getSheenColorFactor(),sheenRoughnessFactor:_.getSheenRoughnessFactor()};if(_.getSheenColorTexture()){const it=_.getSheenColorTexture(),nt=_.getSheenColorTextureInfo();tt.sheenColorTexture=o.createTextureInfoDef(it,nt)}if(_.getSheenRoughnessTexture()){const it=_.getSheenRoughnessTexture(),nt=_.getSheenRoughnessTextureInfo();tt.sheenRoughnessTexture=o.createTextureInfoDef(it,nt)}}}),this}}KHRMaterialsSheen.EXTENSION_NAME=NAME$9;const{R:R$1$1,G:G$1$1,B:dist_index_modern_B,A:dist_index_modern_A}=index_modern_TextureChannel;class Specular extends index_modern_ExtensionProperty{init(){this.extensionName=KHR_MATERIALS_SPECULAR,this.propertyType="Specular",this.parentTypes=[index_modern_PropertyType.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{specularFactor:1,specularTexture:null,specularTextureInfo:new index_modern_TextureInfo(this.graph,"specularTextureInfo"),specularColorFactor:[1,1,1],specularColorTexture:null,specularColorTextureInfo:new index_modern_TextureInfo(this.graph,"specularColorTextureInfo")})}getSpecularFactor(){return this.get("specularFactor")}setSpecularFactor(o){return this.set("specularFactor",o)}getSpecularColorFactor(){return this.get("specularColorFactor")}setSpecularColorFactor(o){return this.set("specularColorFactor",o)}getSpecularTexture(){return this.getRef("specularTexture")}getSpecularTextureInfo(){return this.getRef("specularTexture")?this.getRef("specularTextureInfo"):null}setSpecularTexture(o){return this.setRef("specularTexture",o,{channels:dist_index_modern_A})}getSpecularColorTexture(){return this.getRef("specularColorTexture")}getSpecularColorTextureInfo(){return this.getRef("specularColorTexture")?this.getRef("specularColorTextureInfo"):null}setSpecularColorTexture(o){return this.setRef("specularColorTexture",o,{channels:R$1$1|G$1$1|dist_index_modern_B,isColor:!0})}}Specular.EXTENSION_NAME=KHR_MATERIALS_SPECULAR;const NAME$8=KHR_MATERIALS_SPECULAR;class KHRMaterialsSpecular extends Extension{constructor(...o){super(...o),this.extensionName=NAME$8,this.prereadTypes=[index_modern_PropertyType.MESH],this.prewriteTypes=[index_modern_PropertyType.MESH]}createSpecular(){return new Specular(this.document.getGraph())}read(o){return this}write(o){return this}preread(o){const c=o.jsonDoc,d=c.json.materials||[],_=c.json.textures||[];return d.forEach((v,b)=>{if(v.extensions&&v.extensions[NAME$8]){const tt=this.createSpecular();o.materials[b].setExtension(NAME$8,tt);const it=v.extensions[NAME$8];if(it.specularFactor!==void 0&&tt.setSpecularFactor(it.specularFactor),it.specularColorFactor!==void 0&&tt.setSpecularColorFactor(it.specularColorFactor),it.specularTexture!==void 0){const nt=it.specularTexture,lt=o.textures[_[nt.index].source];tt.setSpecularTexture(lt),o.setTextureInfo(tt.getSpecularTextureInfo(),nt)}if(it.specularColorTexture!==void 0){const nt=it.specularColorTexture,lt=o.textures[_[nt.index].source];tt.setSpecularColorTexture(lt),o.setTextureInfo(tt.getSpecularColorTextureInfo(),nt)}}}),this}prewrite(o){const c=o.jsonDoc;return this.document.getRoot().listMaterials().forEach(d=>{const _=d.getExtension(NAME$8);if(_){const v=o.materialIndexMap.get(d),b=c.json.materials[v];b.extensions=b.extensions||{};const tt=b.extensions[NAME$8]={};if(_.getSpecularFactor()!==1&&(tt.specularFactor=_.getSpecularFactor()),index_modern_MathUtils.eq(_.getSpecularColorFactor(),[1,1,1])||(tt.specularColorFactor=_.getSpecularColorFactor()),_.getSpecularTexture()){const it=_.getSpecularTexture(),nt=_.getSpecularTextureInfo();tt.specularTexture=o.createTextureInfoDef(it,nt)}if(_.getSpecularColorTexture()){const it=_.getSpecularColorTexture(),nt=_.getSpecularColorTextureInfo();tt.specularColorTexture=o.createTextureInfoDef(it,nt)}}}),this}}KHRMaterialsSpecular.EXTENSION_NAME=NAME$8;const{R:dist_index_modern_R}=index_modern_TextureChannel;class Transmission extends index_modern_ExtensionProperty{init(){this.extensionName=KHR_MATERIALS_TRANSMISSION,this.propertyType="Transmission",this.parentTypes=[index_modern_PropertyType.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{transmissionFactor:0,transmissionTexture:null,transmissionTextureInfo:new index_modern_TextureInfo(this.graph,"transmissionTextureInfo")})}getTransmissionFactor(){return this.get("transmissionFactor")}setTransmissionFactor(o){return this.set("transmissionFactor",o)}getTransmissionTexture(){return this.getRef("transmissionTexture")}getTransmissionTextureInfo(){return this.getRef("transmissionTexture")?this.getRef("transmissionTextureInfo"):null}setTransmissionTexture(o){return this.setRef("transmissionTexture",o,{channels:dist_index_modern_R})}}Transmission.EXTENSION_NAME=KHR_MATERIALS_TRANSMISSION;const NAME$7=KHR_MATERIALS_TRANSMISSION;class KHRMaterialsTransmission extends Extension{constructor(...o){super(...o),this.extensionName=NAME$7,this.prereadTypes=[index_modern_PropertyType.MESH],this.prewriteTypes=[index_modern_PropertyType.MESH]}createTransmission(){return new Transmission(this.document.getGraph())}read(o){return this}write(o){return this}preread(o){const c=o.jsonDoc,d=c.json.materials||[],_=c.json.textures||[];return d.forEach((v,b)=>{if(v.extensions&&v.extensions[NAME$7]){const tt=this.createTransmission();o.materials[b].setExtension(NAME$7,tt);const it=v.extensions[NAME$7];if(it.transmissionFactor!==void 0&&tt.setTransmissionFactor(it.transmissionFactor),it.transmissionTexture!==void 0){const nt=it.transmissionTexture,lt=o.textures[_[nt.index].source];tt.setTransmissionTexture(lt),o.setTextureInfo(tt.getTransmissionTextureInfo(),nt)}}}),this}prewrite(o){const c=o.jsonDoc;return this.document.getRoot().listMaterials().forEach(d=>{const _=d.getExtension(NAME$7);if(_){const v=o.materialIndexMap.get(d),b=c.json.materials[v];b.extensions=b.extensions||{};const tt=b.extensions[NAME$7]={transmissionFactor:_.getTransmissionFactor()};if(_.getTransmissionTexture()){const it=_.getTransmissionTexture(),nt=_.getTransmissionTextureInfo();tt.transmissionTexture=o.createTextureInfoDef(it,nt)}}}),this}}KHRMaterialsTransmission.EXTENSION_NAME=NAME$7;class Unlit extends index_modern_ExtensionProperty{init(){this.extensionName=KHR_MATERIALS_UNLIT,this.propertyType="Unlit",this.parentTypes=[index_modern_PropertyType.MATERIAL]}}Unlit.EXTENSION_NAME=KHR_MATERIALS_UNLIT;const NAME$6=KHR_MATERIALS_UNLIT;class index_modern_KHRMaterialsUnlit extends Extension{constructor(...o){super(...o),this.extensionName=NAME$6,this.prereadTypes=[index_modern_PropertyType.MESH],this.prewriteTypes=[index_modern_PropertyType.MESH]}createUnlit(){return new Unlit(this.document.getGraph())}read(o){return this}write(o){return this}preread(o){return(o.jsonDoc.json.materials||[]).forEach((c,d)=>{c.extensions&&c.extensions[NAME$6]&&o.materials[d].setExtension(NAME$6,this.createUnlit())}),this}prewrite(o){const c=o.jsonDoc;return this.document.getRoot().listMaterials().forEach(d=>{if(d.getExtension(NAME$6)){const _=o.materialIndexMap.get(d),v=c.json.materials[_];v.extensions=v.extensions||{},v.extensions[NAME$6]={}}}),this}}index_modern_KHRMaterialsUnlit.EXTENSION_NAME=NAME$6;class Mapping extends index_modern_ExtensionProperty{init(){this.extensionName=KHR_MATERIALS_VARIANTS,this.propertyType="Mapping",this.parentTypes=["MappingList"]}getDefaults(){return Object.assign(super.getDefaults(),{material:null,variants:new RefSet})}getMaterial(){return this.getRef("material")}setMaterial(o){return this.setRef("material",o)}addVariant(o){return this.addRef("variants",o)}removeVariant(o){return this.removeRef("variants",o)}listVariants(){return this.listRefs("variants")}}Mapping.EXTENSION_NAME=KHR_MATERIALS_VARIANTS;class MappingList extends index_modern_ExtensionProperty{init(){this.extensionName=KHR_MATERIALS_VARIANTS,this.propertyType="MappingList",this.parentTypes=[index_modern_PropertyType.PRIMITIVE]}getDefaults(){return Object.assign(super.getDefaults(),{mappings:new RefSet})}addMapping(o){return this.addRef("mappings",o)}removeMapping(o){return this.removeRef("mappings",o)}listMappings(){return this.listRefs("mappings")}}MappingList.EXTENSION_NAME=KHR_MATERIALS_VARIANTS;class Variant extends index_modern_ExtensionProperty{init(){this.extensionName=KHR_MATERIALS_VARIANTS,this.propertyType="Variant",this.parentTypes=["MappingList"]}}Variant.EXTENSION_NAME=KHR_MATERIALS_VARIANTS;const NAME$5=KHR_MATERIALS_VARIANTS;class KHRMaterialsVariants extends Extension{constructor(...o){super(...o),this.extensionName=NAME$5}createMappingList(){return new MappingList(this.document.getGraph())}createVariant(o=""){return new Variant(this.document.getGraph(),o)}createMapping(){return new Mapping(this.document.getGraph())}listVariants(){return Array.from(this.properties).filter(o=>o instanceof Variant)}read(o){const c=o.jsonDoc;if(!c.json.extensions||!c.json.extensions[NAME$5])return this;const d=(c.json.extensions[NAME$5].variants||[]).map(_=>this.createVariant().setName(_.name||""));return(c.json.meshes||[]).forEach((_,v)=>{const b=o.meshes[v];(_.primitives||[]).forEach((tt,it)=>{if(!tt.extensions||!tt.extensions[NAME$5])return;const nt=this.createMappingList(),lt=tt.extensions[NAME$5];for(const ut of lt.mappings){const ht=this.createMapping();ut.material!==void 0&&ht.setMaterial(o.materials[ut.material]);for(const _t of ut.variants||[])ht.addVariant(d[_t]);nt.addMapping(ht)}b.listPrimitives()[it].setExtension(NAME$5,nt)})}),this}write(o){const c=o.jsonDoc,d=this.listVariants();if(!d.length)return this;const _=[],v=new Map;for(const b of d)v.set(b,_.length),_.push(o.createPropertyDef(b));for(const b of this.document.getRoot().listMeshes()){const tt=o.meshIndexMap.get(b);b.listPrimitives().forEach((it,nt)=>{const lt=it.getExtension(NAME$5);if(!lt)return;const ut=o.jsonDoc.json.meshes[tt].primitives[nt],ht=lt.listMappings().map(_t=>{const ft=o.createPropertyDef(_t),bt=_t.getMaterial();return bt&&(ft.material=o.materialIndexMap.get(bt)),ft.variants=_t.listVariants().map(xt=>v.get(xt)),ft});ut.extensions=ut.extensions||{},ut.extensions[NAME$5]={mappings:ht}})}return c.json.extensions=c.json.extensions||{},c.json.extensions[NAME$5]={variants:_},this}}KHRMaterialsVariants.EXTENSION_NAME=NAME$5;const{G:dist_index_modern_G}=index_modern_TextureChannel;class Volume extends index_modern_ExtensionProperty{init(){this.extensionName=KHR_MATERIALS_VOLUME,this.propertyType="Volume",this.parentTypes=[index_modern_PropertyType.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{thicknessFactor:0,thicknessTexture:null,thicknessTextureInfo:new index_modern_TextureInfo(this.graph,"thicknessTexture"),attenuationDistance:1/0,attenuationColor:[1,1,1]})}getThicknessFactor(){return this.get("thicknessFactor")}setThicknessFactor(o){return this.set("thicknessFactor",o)}getThicknessTexture(){return this.getRef("thicknessTexture")}getThicknessTextureInfo(){return this.getRef("thicknessTexture")?this.getRef("thicknessTextureInfo"):null}setThicknessTexture(o){return this.setRef("thicknessTexture",o,{channels:dist_index_modern_G})}getAttenuationDistance(){return this.get("attenuationDistance")}setAttenuationDistance(o){return this.set("attenuationDistance",o)}getAttenuationColor(){return this.get("attenuationColor")}setAttenuationColor(o){return this.set("attenuationColor",o)}}Volume.EXTENSION_NAME=KHR_MATERIALS_VOLUME;const NAME$4=KHR_MATERIALS_VOLUME;class KHRMaterialsVolume extends Extension{constructor(...o){super(...o),this.extensionName=NAME$4,this.prereadTypes=[index_modern_PropertyType.MESH],this.prewriteTypes=[index_modern_PropertyType.MESH]}createVolume(){return new Volume(this.document.getGraph())}read(o){return this}write(o){return this}preread(o){const c=o.jsonDoc,d=c.json.materials||[],_=c.json.textures||[];return d.forEach((v,b)=>{if(v.extensions&&v.extensions[NAME$4]){const tt=this.createVolume();o.materials[b].setExtension(NAME$4,tt);const it=v.extensions[NAME$4];if(it.thicknessFactor!==void 0&&tt.setThicknessFactor(it.thicknessFactor),it.attenuationDistance!==void 0&&tt.setAttenuationDistance(it.attenuationDistance),it.attenuationColor!==void 0&&tt.setAttenuationColor(it.attenuationColor),it.thicknessTexture!==void 0){const nt=it.thicknessTexture,lt=o.textures[_[nt.index].source];tt.setThicknessTexture(lt),o.setTextureInfo(tt.getThicknessTextureInfo(),nt)}}}),this}prewrite(o){const c=o.jsonDoc;return this.document.getRoot().listMaterials().forEach(d=>{const _=d.getExtension(NAME$4);if(_){const v=o.materialIndexMap.get(d),b=c.json.materials[v];b.extensions=b.extensions||{};const tt=b.extensions[NAME$4]={};if(_.getThicknessFactor()>0&&(tt.thicknessFactor=_.getThicknessFactor()),Number.isFinite(_.getAttenuationDistance())&&(tt.attenuationDistance=_.getAttenuationDistance()),index_modern_MathUtils.eq(_.getAttenuationColor(),[1,1,1])||(tt.attenuationColor=_.getAttenuationColor()),_.getThicknessTexture()){const it=_.getThicknessTexture(),nt=_.getThicknessTextureInfo();tt.thicknessTexture=o.createTextureInfoDef(it,nt)}}}),this}}KHRMaterialsVolume.EXTENSION_NAME=NAME$4;const NAME$3=index_modern_KHR_MESH_QUANTIZATION;class index_modern_KHRMeshQuantization extends Extension{constructor(...o){super(...o),this.extensionName=NAME$3}read(o){return this}write(o){return this}}index_modern_KHRMeshQuantization.EXTENSION_NAME=NAME$3;const NAME$2=index_modern_KHR_TEXTURE_BASISU;class KTX2ImageUtils{match(o){return o[0]===171&&o[1]===75&&o[2]===84&&o[3]===88&&o[4]===32&&o[5]===50&&o[6]===48&&o[7]===187&&o[8]===13&&o[9]===10&&o[10]===26&&o[11]===10}getSize(o){const c=ktx_parse_modern_read(o);return[c.pixelWidth,c.pixelHeight]}getChannels(o){const c=ktx_parse_modern_read(o).dataFormatDescriptor[0];if(c.colorModel===ktx_parse_modern_KHR_DF_MODEL_ETC1S)return c.samples.length!==2||15&~c.samples[1].channelType?3:4;if(c.colorModel===ktx_parse_modern_KHR_DF_MODEL_UASTC)return(15&c.samples[0].channelType)==3?4:3;throw new Error(`Unexpected KTX2 colorModel, "${c.colorModel}".`)}getVRAMByteLength(o){const c=ktx_parse_modern_read(o),d=this.getChannels(o)>3;let _=0;for(let v=0;v<c.levels.length;v++){const b=c.levels[v];b.uncompressedByteLength?_+=b.uncompressedByteLength:_+=Math.max(1,Math.floor(c.pixelWidth/Math.pow(2,v)))/4*(Math.max(1,Math.floor(c.pixelHeight/Math.pow(2,v)))/4)*(d?16:8)}return _}}class KHRTextureBasisu extends Extension{constructor(...o){super(...o),this.extensionName=NAME$2,this.prereadTypes=[index_modern_PropertyType.TEXTURE]}static register(){index_modern_ImageUtils.registerFormat("image/ktx2",new KTX2ImageUtils)}preread(o){return o.jsonDoc.json.textures.forEach(c=>{if(c.extensions&&c.extensions[NAME$2]){const d=c.extensions[NAME$2];c.source=d.source}}),this}read(o){return this}write(o){const c=o.jsonDoc;return this.document.getRoot().listTextures().forEach(d=>{if(d.getMimeType()==="image/ktx2"){const _=o.imageIndexMap.get(d);c.json.textures.forEach(v=>{v.source===_&&(v.extensions=v.extensions||{},v.extensions[NAME$2]={source:v.source},delete v.source)})}}),this}}KHRTextureBasisu.EXTENSION_NAME=NAME$2;class Transform extends index_modern_ExtensionProperty{init(){this.extensionName=KHR_TEXTURE_TRANSFORM,this.propertyType="Transform",this.parentTypes=[index_modern_PropertyType.TEXTURE_INFO]}getDefaults(){return Object.assign(super.getDefaults(),{offset:[0,0],rotation:0,scale:[1,1],texCoord:null})}getOffset(){return this.get("offset")}setOffset(o){return this.set("offset",o)}getRotation(){return this.get("rotation")}setRotation(o){return this.set("rotation",o)}getScale(){return this.get("scale")}setScale(o){return this.set("scale",o)}getTexCoord(){return this.get("texCoord")}setTexCoord(o){return this.set("texCoord",o)}}Transform.EXTENSION_NAME=KHR_TEXTURE_TRANSFORM;const NAME$1=KHR_TEXTURE_TRANSFORM;class KHRTextureTransform extends Extension{constructor(...o){super(...o),this.extensionName=NAME$1}createTransform(){return new Transform(this.document.getGraph())}read(o){for(const[c,d]of Array.from(o.textureInfos.entries())){if(!d.extensions||!d.extensions[NAME$1])continue;const _=this.createTransform(),v=d.extensions[NAME$1];v.offset!==void 0&&_.setOffset(v.offset),v.rotation!==void 0&&_.setRotation(v.rotation),v.scale!==void 0&&_.setScale(v.scale),v.texCoord!==void 0&&_.setTexCoord(v.texCoord),c.setExtension(NAME$1,_)}return this}write(o){const c=Array.from(o.textureInfoDefMap.entries());for(const[d,_]of c){const v=d.getExtension(NAME$1);if(!v)continue;_.extensions=_.extensions||{};const b={},tt=index_modern_MathUtils.eq;tt(v.getOffset(),[0,0])||(b.offset=v.getOffset()),v.getRotation()!==0&&(b.rotation=v.getRotation()),tt(v.getScale(),[1,1])||(b.scale=v.getScale()),v.getTexCoord()!=null&&(b.texCoord=v.getTexCoord()),_.extensions[NAME$1]=b}return this}}KHRTextureTransform.EXTENSION_NAME=NAME$1;const PARENT_TYPES=[index_modern_PropertyType.ROOT,index_modern_PropertyType.SCENE,index_modern_PropertyType.NODE,index_modern_PropertyType.MESH,index_modern_PropertyType.MATERIAL,index_modern_PropertyType.TEXTURE,index_modern_PropertyType.ANIMATION];class Packet extends index_modern_ExtensionProperty{init(){this.extensionName=KHR_XMP_JSON_LD,this.propertyType="Packet",this.parentTypes=PARENT_TYPES}getDefaults(){return Object.assign(super.getDefaults(),{context:{},properties:{}})}getContext(){return this.get("context")}setContext(o){return this.set("context",dist_index_modern_extends({},o))}listProperties(){return Object.keys(this.get("properties"))}getProperty(o){const c=this.get("properties");return o in c?c[o]:null}setProperty(o,c){this._assertContext(o);const d=dist_index_modern_extends({},this.get("properties"));return c?d[o]=c:delete d[o],this.set("properties",d)}toJSONLD(){return dist_index_modern_extends({"@context":copyJSON(this.get("context"))},copyJSON(this.get("properties")))}fromJSONLD(o){const c=(o=copyJSON(o))["@context"];return c&&this.set("context",c),delete o["@context"],this.set("properties",o)}_assertContext(o){if(!(o.split(":")[0]in this.get("context")))throw new Error(`${KHR_XMP_JSON_LD}: Missing context for term, "${o}".`)}}function copyJSON(h){return JSON.parse(JSON.stringify(h))}Packet.EXTENSION_NAME=KHR_XMP_JSON_LD;const NAME=KHR_XMP_JSON_LD;class KHRXMP extends Extension{constructor(...o){super(...o),this.extensionName=NAME}createPacket(){return new Packet(this.document.getGraph())}listPackets(){return Array.from(this.properties)}read(o){var c;const d=(c=o.jsonDoc.json.extensions)==null?void 0:c[NAME];if(!d||!d.packets)return this;const _=o.jsonDoc.json,v=this.document.getRoot(),b=d.packets.map(nt=>this.createPacket().fromJSONLD(nt)),tt=[[_.asset],_.scenes,_.nodes,_.meshes,_.materials,_.images,_.animations],it=[[v],v.listScenes(),v.listNodes(),v.listMeshes(),v.listMaterials(),v.listTextures(),v.listAnimations()];for(let nt=0;nt<tt.length;nt++){const lt=tt[nt]||[];for(let ut=0;ut<lt.length;ut++){const ht=lt[ut];if(ht.extensions&&ht.extensions[NAME]){const _t=ht.extensions[NAME];it[nt][ut].setExtension(NAME,b[_t.packet])}}}return this}write(o){const{json:c}=o.jsonDoc,d=[];for(const _ of this.properties){d.push(_.toJSONLD());for(const v of _.listParents()){let b;switch(v.propertyType){case index_modern_PropertyType.ROOT:b=c.asset;break;case index_modern_PropertyType.SCENE:b=c.scenes[o.sceneIndexMap.get(v)];break;case index_modern_PropertyType.NODE:b=c.nodes[o.nodeIndexMap.get(v)];break;case index_modern_PropertyType.MESH:b=c.meshes[o.meshIndexMap.get(v)];break;case index_modern_PropertyType.MATERIAL:b=c.materials[o.materialIndexMap.get(v)];break;case index_modern_PropertyType.TEXTURE:b=c.images[o.imageIndexMap.get(v)];break;case index_modern_PropertyType.ANIMATION:b=c.animations[o.animationIndexMap.get(v)];break;default:b=null,this.document.getLogger().warn(`[${NAME}]: Unsupported parent property, "${v.propertyType}"`)}b&&(b.extensions=b.extensions||{},b.extensions[NAME]={packet:d.length-1})}}return d.length>0&&(c.extensions=c.extensions||{},c.extensions[NAME]={packets:d}),this}}KHRXMP.EXTENSION_NAME=NAME;const KHRONOS_EXTENSIONS=[index_modern_KHRDracoMeshCompression,KHRLightsPunctual,KHRMaterialsAnisotropy,KHRMaterialsClearcoat,KHRMaterialsDiffuseTransmission,KHRMaterialsDispersion,KHRMaterialsEmissiveStrength,KHRMaterialsIOR,KHRMaterialsIridescence,KHRMaterialsPBRSpecularGlossiness,KHRMaterialsSpecular,KHRMaterialsSheen,KHRMaterialsTransmission,index_modern_KHRMaterialsUnlit,KHRMaterialsVariants,KHRMaterialsVolume,index_modern_KHRMeshQuantization,KHRTextureBasisu,KHRTextureTransform,KHRXMP],ALL_EXTENSIONS=[index_modern_EXTMeshGPUInstancing,index_modern_EXTMeshoptCompression,index_modern_EXTTextureAVIF,index_modern_EXTTextureWebP,...KHRONOS_EXTENSIONS];class GLTFDracoExporter extends GLTFExporter2{constructor(o){super(),this._loadedLibs=!1,o=o||{method:index_modern_KHRDracoMeshCompression.EncoderMethod.EDGEBREAKER,encodeSpeed:5},this._io=new WebIO().registerExtensions(ALL_EXTENSIONS).registerExtensions(ALL_WEBGI_EXTENSIONS),this._encoderOptions=o}preload(){return this._loadLibs(),this}async _loadLibs(){if(this._loadedLibs||!this.loader)return;const o=await Promise.all([this.loader.initEncoder(),this.loader.initDecoder()]);this._io.registerDependencies({"draco3d.encoder":o[0],"draco3d.decoder":o[1]}),this._loadedLibs=!0}async parseAsync(o,{compress:c=!1,dracoOptions:d,..._},v=!1){if(!this.loader)return console.error("GLTFDracoExporter: No DRACOLoader2 instance provided"),super.parseAsync(o,_);await this._loadLibs();const b={..._};c&&(b.externalImagesInExtras=!0);const tt=await new Promise((nt,lt)=>this.parse(o,nt,lt,b)),it=await super.parseAsync(tt,b);if(!c)return it;try{if(!tt)throw new Error("GLTFDracoExporter: gltf is null");let nt=tt;const lt=nt.byteLength||1/0,ut=await(typeof nt!="object"||nt.byteLength?this._io.readBinary(new Uint8Array(nt)):this._io.readJSON({json:nt,resources:{}}));if(ut.createExtension(index_modern_KHRDracoMeshCompression).setRequired(!0).setEncoderOptions({...this._encoderOptions,...d??{}}),b.exportExt==="glb")nt=await this._io.writeBinary(ut),isFinite(lt)&&console.log("DRACO Compression ratio: "+(nt.byteLength/lt).toFixed(5));else{const _t=await this._io.writeJSON(ut);nt=_t.json,Object.values(_t.resources).filter(ft=>ft).length>0&&(console.warn("DRACOExporter: extra resources in resources not supported properly"),nt.resources=_t.resources)}nt.__isGLTFOutput=!0;const ht=await super.parseAsync(nt,b);if(!ht)throw new Error("GLTFDracoExporter: blob is null");return ht.ext="glb",ht.__uncompressed=it,ht}catch(nt){if(v)throw nt;return console.error("Unable to compress glb with DRACO extension"),console.error(nt),it}}addExtension(o){return this._io.registerExtensions([o]),this}createAndAddExtension(o,c){return this.addExtension(createGenericExtensionClass(o,c))}}function addGLTFDracoExporter(h,o,c){return addGLTFExporter(h,o,GLTFDracoExporter,d=>{const _=esm_browser_v4()+".drc",v=d;v.loader=c.registerFile(_),v.loader.setDecoderConfig({type:"js"}),v.loader.preload(!0,!0)})}class GLTFDracoExportPlugin extends AViewerPlugin{constructor(){super(...arguments),this.enabled=!0,this.dependencies=[AssetManagerPlugin,AssetExporterPlugin]}async onAdded(o){await super.onAdded(o);const c=o.getManager().importer,d=o.getManager().exporter;if(!c)throw new Error("GLTFDracoExportPlugin: AssetImporter not found");addGLTFDracoExporter(d,o,c)}}GLTFDracoExportPlugin.PluginType="GLTFDracoExportPlugin";class WebGIViewerExtensionProperty extends index_modern_ExtensionProperty{constructor(){super(...arguments),this.extensionName=viewerGLTFExtension,this.parentTypes=[index_modern_PropertyType.SCENE],this.propertyType="ViewerJSON"}init(){}}class WebGIViewerExtension extends Extension{constructor(){super(...arguments),this.extensionName=viewerGLTFExtension,this._viewerConfig={},this._texturesRef=[],this.required=!0}read(o){var c;return this._viewerConfig={},(c=o.jsonDoc.json.scenes)===null||c===void 0||c.forEach((d,_)=>{if(d.extensions&&d.extensions[viewerGLTFExtension]){const v=new WebGIViewerExtensionProperty(this.document.getGraph());o.scenes[_].setExtension(viewerGLTFExtension,v),this._viewerConfig=d.extensions[viewerGLTFExtension]}}),this}write(o){return this.document.getRoot().listScenes().forEach(c=>{var d;if(c.getExtension(viewerGLTFExtension)){const _=(d=o.jsonDoc.json.scenes)===null||d===void 0?void 0:d[o.jsonDoc.json.scene||0];_&&Object.keys(this._viewerConfig).length>0&&(_.extensions=_.extensions||{},_.extensions[viewerGLTFExtension]=this._viewerConfig,this._texturesRef=[],this._viewerConfig={})}}),this}}WebGIViewerExtension.EXTENSION_NAME=viewerGLTFExtension;class GenericExtensionProperty extends index_modern_ExtensionProperty{addTexture(o,c,d,_=4369){this.setRef(o,d,{channels:_}),this.textures[o]=[c,d]}constructor(o,c,d){super(o,c),this.parentTypes=[index_modern_PropertyType.MATERIAL,index_modern_PropertyType.MESH,index_modern_PropertyType.NODE,index_modern_PropertyType.SCENE],this.propertyType="GenericExtension",this.textures={},this.extensionName=d}init(){}}class GenericExtension extends Extension{constructor(){super(...arguments),this.textureChannels={}}read(o){const c=o.jsonDoc,d=c.json.materials||[],_=c.json.textures||[];return d.forEach((v,b)=>{var tt,it;if(v.extensions&&v.extensions[this.extensionName]){const nt=new GenericExtensionProperty(this.document.getGraph(),"",this.extensionName);o.materials[b].setExtension(this.extensionName,nt);const lt={...v.extensions[this.extensionName]};for(const[ut,ht]of Object.entries(lt))if(typeof(ht==null?void 0:ht.index)=="number"){const _t=ht,ft=(tt=_[_t.index])===null||tt===void 0?void 0:tt.source;if(typeof ft!="number"){console.warn("GLTF Pipeline: source texture not found for texture info",_t);continue}const bt=o.textures[ft],xt=new index_modern_TextureInfo(this.document.getGraph()),St=(it=this.textureChannels[ut])!==null&&it!==void 0?it:4369;nt.addTexture(ut,xt,bt,St),o.setTextureInfo(xt,_t),delete lt[ut]}nt.setExtras(lt)}}),(c.json.meshes||[]).forEach((v,b)=>{if(v.extensions&&v.extensions[this.extensionName]){const tt=new GenericExtensionProperty(this.document.getGraph(),"",this.extensionName);o.meshes[b].setExtension(this.extensionName,tt);const it=v.extensions[this.extensionName];tt.setExtras(it)}}),(c.json.nodes||[]).forEach((v,b)=>{if(v.extensions&&v.extensions[this.extensionName]){const tt=new GenericExtensionProperty(this.document.getGraph(),"",this.extensionName);o.nodes[b].setExtension(this.extensionName,tt);const it=v.extensions[this.extensionName];tt.setExtras(it)}}),(c.json.scenes||[]).forEach((v,b)=>{if(v.extensions&&v.extensions[this.extensionName]){const tt=new GenericExtensionProperty(this.document.getGraph(),"",this.extensionName);o.scenes[b].setExtension(this.extensionName,tt);const it=v.extensions[this.extensionName];tt.setExtras(it)}}),this}write(o){const c=o.jsonDoc;return this.document.getRoot().listMaterials().forEach(d=>{const _=d.getExtension(this.extensionName);if(_){const v=o.materialIndexMap.get(d),b=c.json.materials[v];b.extensions=b.extensions||{};const tt={..._.getExtras()};for(const[it,nt]of Object.entries(_.textures)){const lt=nt[0],ut=nt[1];ut&&(tt[it]=o.createTextureInfoDef(ut,lt))}b.extensions[this.extensionName]=tt}}),this.document.getRoot().listMeshes().forEach(d=>{const _=d.getExtension(this.extensionName);if(_){const v=o.meshIndexMap.get(d),b=c.json.meshes[v];b.extensions=b.extensions||{},b.extensions[this.extensionName]=_.getExtras()}}),this.document.getRoot().listNodes().forEach(d=>{const _=d.getExtension(this.extensionName);if(_){const v=o.nodeIndexMap.get(d),b=c.json.nodes[v];b.extensions=b.extensions||{},b.extensions[this.extensionName]=_.getExtras()}}),this.document.getRoot().listScenes().forEach(d=>{const _=d.getExtension(this.extensionName);if(_){const v=o.jsonDoc.json.scene||0,b=c.json.scenes[v];if(!b)return;b.extensions=b.extensions||{},b.extensions[this.extensionName]=_.getExtras()}}),this}}function stringToChannel(h){let o=0;return h.includes("R")&&(o|=index_modern_TextureChannel.R),h.includes("G")&&(o|=index_modern_TextureChannel.G),h.includes("B")&&(o|=index_modern_TextureChannel.B),h.includes("A")&&(o|=index_modern_TextureChannel.A),o}function createGenericExtensionClass(h,o){var c;return c=class extends GenericExtension{constructor(){super(...arguments),this.extensionName=h,this.textureChannels=o?Object.fromEntries(Object.entries(o).map(([d,_])=>[d,typeof _=="number"?_:stringToChannel(_)])):{}}},c.EXTENSION_NAME=h,c}class BumpMapMaterialExtension extends GenericExtension{constructor(){super(...arguments),this.extensionName=BumpMapMaterialExtension.EXTENSION_NAME,this.textureChannels={bumpTexture:index_modern_TextureChannel.R}}}BumpMapMaterialExtension.EXTENSION_NAME=GLTFMaterialsBumpMapExtensionName;class LightMapMaterialExtension extends GenericExtension{constructor(){super(...arguments),this.extensionName=LightMapMaterialExtension.EXTENSION_NAME,this.textureChannels={lightMapTexture:index_modern_TextureChannel.R|index_modern_TextureChannel.G|index_modern_TextureChannel.B}}}LightMapMaterialExtension.EXTENSION_NAME=GLTFMaterialsLightMapExtensionName;class AlphaMapMaterialExtension extends GenericExtension{constructor(){super(...arguments),this.extensionName=AlphaMapMaterialExtension.EXTENSION_NAME,this.textureChannels={alphaTexture:index_modern_TextureChannel.G}}}AlphaMapMaterialExtension.EXTENSION_NAME=GLTFMaterialsAlphaMapExtensionName;class DisplacementMapMaterialExtension extends GenericExtension{constructor(){super(...arguments),this.extensionName=DisplacementMapMaterialExtension.EXTENSION_NAME,this.textureChannels={displacementTexture:index_modern_TextureChannel.R}}}DisplacementMapMaterialExtension.EXTENSION_NAME=GLTFMaterialsDisplacementMapExtensionName;class DiamondMaterialExtension extends GenericExtension{constructor(){super(...arguments),this.extensionName=DiamondMaterialExtension.EXTENSION_NAME}}DiamondMaterialExtension.EXTENSION_NAME=DiamondPlugin.DIAMOND_GLTF_EXTENSION;class AnimationMarkersExtension extends GenericExtension{constructor(){super(...arguments),this.extensionName=AnimationMarkersExtension.EXTENSION_NAME}}AnimationMarkersExtension.EXTENSION_NAME=GLTFAnimationPlugin.AnimationMarkersExtension;class AnisotropyMaterialExtension extends GenericExtension{constructor(){super(...arguments),this.extensionName=AnisotropyMaterialExtension.EXTENSION_NAME,this.textureChannels={anisotropyDirection:index_modern_TextureChannel.R|index_modern_TextureChannel.G|index_modern_TextureChannel.B}}}AnisotropyMaterialExtension.EXTENSION_NAME=AnisotropyPlugin.ANISOTROPY_GLTF_EXTENSION;class CustomBumpMapMaterialExtension extends GenericExtension{constructor(){super(...arguments),this.extensionName=CustomBumpMapMaterialExtension.EXTENSION_NAME,this.textureChannels={customBumpMap:index_modern_TextureChannel.R|index_modern_TextureChannel.G|index_modern_TextureChannel.B}}}CustomBumpMapMaterialExtension.EXTENSION_NAME=CustomBumpMapPlugin.CUSTOM_BUMP_MAP_GLTF_EXTENSION;class LightExtrasExtension extends GenericExtension{constructor(){super(...arguments),this.extensionName=LightExtrasExtension.EXTENSION_NAME}}LightExtrasExtension.EXTENSION_NAME=webgiLightExtrasExtension;class Object3DExtrasExtension extends GenericExtension{constructor(){super(...arguments),this.extensionName=Object3DExtrasExtension.EXTENSION_NAME}}Object3DExtrasExtension.EXTENSION_NAME=webgiObject3DExtrasExtension;class MaterialExtrasExtension extends GenericExtension{constructor(){super(...arguments),this.extensionName=MaterialExtrasExtension.EXTENSION_NAME}}MaterialExtrasExtension.EXTENSION_NAME=webgiMaterialExtrasExtension;class ClearcoatTintMaterialExtension extends GenericExtension{constructor(){super(...arguments),this.extensionName=ClearcoatTintMaterialExtension.EXTENSION_NAME}}ClearcoatTintMaterialExtension.EXTENSION_NAME=ClearcoatTintPlugin.CLEARCOAT_TINT_GLTF_EXTENSION;class ThinFilmLayerMaterialExtension extends GenericExtension{constructor(){super(...arguments),this.extensionName=ThinFilmLayerMaterialExtension.EXTENSION_NAME}}ThinFilmLayerMaterialExtension.EXTENSION_NAME=ThinFilmLayerPlugin.THIN_FILM_LAYER_GLTF_EXTENSION;class TriplanarMappingMaterialExtension extends GenericExtension{constructor(){super(...arguments),this.extensionName=TriplanarMappingMaterialExtension.EXTENSION_NAME}}TriplanarMappingMaterialExtension.EXTENSION_NAME=TriplanarUVMappingPlugin.TRIPLANAR_GLTF_EXTENSION;class LayeredMaterialExtension extends GenericExtension{constructor(){super(...arguments),this.extensionName=LayeredMaterialExtension.EXTENSION_NAME}}LayeredMaterialExtension.EXTENSION_NAME=LayeredMaterialPlugin.LAYERED_MATERIAL_GLTF_EXTENSION;class SSBevelMaterialExtension extends GenericExtension{constructor(){super(...arguments),this.extensionName=SSBevelMaterialExtension.EXTENSION_NAME}}SSBevelMaterialExtension.EXTENSION_NAME=SSBevelPlugin.SSBEVEL_GLTF_EXTENSION;class NoiseBumpMaterialExtension extends GenericExtension{constructor(){super(...arguments),this.extensionName=NoiseBumpMaterialExtension.EXTENSION_NAME}}NoiseBumpMaterialExtension.EXTENSION_NAME=NoiseBumpMaterialPlugin.NOISE_BUMP_MATERIAL_GLTF_EXTENSION;const ALL_WEBGI_EXTENSIONS=[WebGIViewerExtension,DiamondMaterialExtension,BumpMapMaterialExtension,LightMapMaterialExtension,AlphaMapMaterialExtension,AnimationMarkersExtension,AnisotropyMaterialExtension,CustomBumpMapMaterialExtension,LightExtrasExtension,Object3DExtrasExtension,MaterialExtrasExtension,ClearcoatTintMaterialExtension,ThinFilmLayerMaterialExtension,SSBevelMaterialExtension,TriplanarMappingMaterialExtension,NoiseBumpMaterialExtension,DisplacementMapMaterialExtension,LayeredMaterialExtension];class PMREMGeneratorPlugin extends I$2{constructor(){super(...arguments),this.processor={forAssetType:"texture",process:(o,c)=>o}}async onAdded(o){}async onDispose(o){}async onRemove(o){this._pmrem=void 0}}PMREMGeneratorPlugin.PluginType="PMREMGenerator";const _position=new three_module.Pq0,_quaternion=new three_module.PTz,_scale=new three_module.Pq0;class CSS3DObject extends three_module.B69{constructor(o=document.createElement("div")){super(),this.isCSS3DObject=!0,this.element=o,this.element.style.position="absolute",this.element.style.pointerEvents="auto",this.element.style.userSelect="none",this.element.setAttribute("draggable",!1),this.addEventListener("removed",function(){this.traverse(function(c){c.element instanceof Element&&c.element.parentNode!==null&&c.element.parentNode.removeChild(c.element)})})}copy(o,c){return super.copy(o,c),this.element=o.element.cloneNode(!0),this}}const _matrix=new three_module.kn4,_matrix2=new three_module.kn4;class CSS3DRenderer{constructor(o={}){const c=this;let d,_,v,b;const tt={camera:{fov:0,style:""},objects:new WeakMap},it=o.element!==void 0?o.element:document.createElement("div");it.style.overflow="hidden",this.domElement=it;const nt=document.createElement("div");nt.style.transformOrigin="0 0",nt.style.pointerEvents="none",it.appendChild(nt);const lt=document.createElement("div");function ut(bt){return Math.abs(bt)<1e-10?0:bt}function ht(bt){const xt=bt.elements;return"matrix3d("+ut(xt[0])+","+ut(-xt[1])+","+ut(xt[2])+","+ut(xt[3])+","+ut(xt[4])+","+ut(-xt[5])+","+ut(xt[6])+","+ut(xt[7])+","+ut(xt[8])+","+ut(-xt[9])+","+ut(xt[10])+","+ut(xt[11])+","+ut(xt[12])+","+ut(-xt[13])+","+ut(xt[14])+","+ut(xt[15])+")"}function _t(bt){const xt=bt.elements;return"translate(-50%,-50%)matrix3d("+ut(xt[0])+","+ut(xt[1])+","+ut(xt[2])+","+ut(xt[3])+","+ut(-xt[4])+","+ut(-xt[5])+","+ut(-xt[6])+","+ut(-xt[7])+","+ut(xt[8])+","+ut(xt[9])+","+ut(xt[10])+","+ut(xt[11])+","+ut(xt[12])+","+ut(xt[13])+","+ut(xt[14])+","+ut(xt[15])+")"}function ft(bt,xt,St,wt){if(bt.isCSS3DObject){const Pt=bt.visible===!0&&bt.layers.test(St.layers)===!0;if(bt.element.style.display=Pt===!0?"":"none",Pt===!0){let Rt;bt.onBeforeRender(c,xt,St),bt.isCSS3DSprite?(_matrix.copy(St.matrixWorldInverse),_matrix.transpose(),bt.rotation2D!==0&&_matrix.multiply(_matrix2.makeRotationZ(bt.rotation2D)),bt.matrixWorld.decompose(_position,_quaternion,_scale),_matrix.setPosition(_position),_matrix.scale(_scale),_matrix.elements[3]=0,_matrix.elements[7]=0,_matrix.elements[11]=0,_matrix.elements[15]=1,Rt=_t(_matrix)):Rt=_t(bt.matrixWorld);const kt=bt.element,Gt=tt.objects.get(bt);if(Gt===void 0||Gt.style!==Rt){kt.style.transform=Rt;const Dt={style:Rt};tt.objects.set(bt,Dt)}kt.parentNode!==lt&&lt.appendChild(kt),bt.onAfterRender(c,xt,St)}}for(let Pt=0,Rt=bt.children.length;Pt<Rt;Pt++)ft(bt.children[Pt],xt,St)}lt.style.transformStyle="preserve-3d",nt.appendChild(lt),this.getSize=function(){return{width:d,height:_}},this.render=function(bt,xt){const St=xt.projectionMatrix.elements[5]*b;let wt,Pt;tt.camera.fov!==St&&(nt.style.perspective=xt.isPerspectiveCamera?St+"px":"",tt.camera.fov=St),xt.view&&xt.view.enabled?(nt.style.transform=`translate( ${-xt.view.offsetX*(d/xt.view.width)}px, ${-xt.view.offsetY*(_/xt.view.height)}px )`,nt.style.transform+=`scale( ${xt.view.fullWidth/xt.view.width}, ${xt.view.fullHeight/xt.view.height} )`):nt.style.transform="",bt.matrixWorldAutoUpdate===!0&&bt.updateMatrixWorld(),xt.parent===null&&xt.matrixWorldAutoUpdate===!0&&xt.updateMatrixWorld(),xt.isOrthographicCamera&&(wt=-(xt.right+xt.left)/2,Pt=(xt.top+xt.bottom)/2);const Rt=xt.view&&xt.view.enabled?xt.view.height/xt.view.fullHeight:1,kt=xt.isOrthographicCamera?`scale( ${Rt} )scale(`+St+")translate("+ut(wt)+"px,"+ut(Pt)+"px)"+ht(xt.matrixWorldInverse):`scale( ${Rt} )translateZ(`+St+"px)"+ht(xt.matrixWorldInverse),Gt=kt+"translate("+v+"px,"+b+"px)";tt.camera.style!==Gt&&(lt.style.transform=Gt,tt.camera.style=Gt),ft(bt,bt,xt)},this.setSize=function(bt,xt){d=bt,_=xt,v=d/2,b=_/2,it.style.width=bt+"px",it.style.height=xt+"px",nt.style.width=bt+"px",nt.style.height=xt+"px",lt.style.width=bt+"px",lt.style.height=xt+"px"}}}var CSS3DRendererPlugin_decorate=function(h,o,c,d){var _,v=arguments.length,b=v<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(h,o,c,d);else for(var tt=h.length-1;tt>=0;tt--)(_=h[tt])&&(b=(v<3?_(b):v>3?_(o,c,b):_(o,c))||b);return v>3&&b&&Object.defineProperty(o,c,b),b};let CSS3DRendererPlugin=class extends AViewerPlugin{constructor(h=!0){super(),this._scene=new three_module.Z58,this.overCanvas=!0,this._trackers=[],this.attachIFrameToSelected=async()=>{var o,c,d,_,v;const b=(c=(o=this._viewer)===null||o===void 0?void 0:o.getPlugin(PickingPlugin))===null||c===void 0?void 0:c.getSelectedObject();if(!(b!=null&&b.geometry))return void await((d=this._viewer)===null||d===void 0?void 0:d.alert("No Geometry: Selected object must have a geometry to apply the iframe to"));const tt=await((_=this._viewer)===null||_===void 0?void 0:_.prompt("URL: Enter the url for the webpage. (Make sure its allowed to be embedded in an iframe.)","https://webgi.xyz/",!1))||"https://webgi.pixotronics.com/";if(!tt)return;const it=await((v=this._viewer)===null||v===void 0?void 0:v.prompt("Width: Enter the width for the object.","512",!1))||"512";it&&this.attachIFrame(b,tt,parseInt(it))},this._resizeObserver=new ResizeObserver(()=>{var o;this.enabled&&((o=this._viewer)===null||o===void 0||o.scene.setDirty({sceneUpdate:!0}))}),this.enabled=h,this._refreshCanvasInDOM=this._refreshCanvasInDOM.bind(this),this._refreshEnabled=this._refreshEnabled.bind(this)}_refreshEnabled(){}_refreshCanvasInDOM(){const h=this._viewer;h&&this._renderer&&(h.canvas.remove(),this.overCanvas?this._renderer.domElement.insertAdjacentElement("afterbegin",h.canvas):this._renderer.domElement.appendChild(h.canvas))}_initialize(){if(this._renderer||!this._viewer)return;this._renderer=new CSS3DRenderer;const h=this._viewer.renderer.rendererObject.getSize(new three_module.I9Y);this._renderer.setSize(h.width,h.height);const o=document.createElement("div");o.style.position="absolute",o.style.top="0",o.style.zIndex="0",o.appendChild(this._renderer.domElement),this._viewer.canvas.style.position="absolute",this._viewer.canvas.style.top="0",this._viewer.canvas.style.left="0",this._viewer.canvas.style.zIndex="0",this._viewer.container.appendChild(o),this._refreshCanvasInDOM(),this._viewer.renderer.addEventListener("resize",()=>{if(!this._viewer||!this._renderer)return;const c=this._viewer.renderer.rendererObject.getSize(new three_module.I9Y);this._renderer.setSize(c.width,c.height)})}async onAdded(h){await super.onAdded(h);let o=!0,c=!0;h.addEventListener("postFrame",v=>{var b,tt;o&&this.enabled&&(this._renderer||this._initialize(),this._renderer&&(c&&this._trackers.forEach(it=>{var nt,lt;let ut=!0;const ht=it.modelObj.material.side;if(ht!==three_module.$EB){const _t=new three_module.Pq0(0,0,1).applyQuaternion(it.cssObj.quaternion),ft=(lt=(nt=this._viewer)===null||nt===void 0?void 0:nt.scene.activeCamera)===null||lt===void 0?void 0:lt.cameraObject,bt=_t.dot(ft.getWorldDirection(new three_module.Pq0));ut=ht===three_module.hsX?bt>0:bt<0}it.cssObj.element.style.visibility=ut?"visible":"hidden"}),this._trackers.filter(it=>it.dirty).forEach(it=>this._syncProperties(it)),(b=this._renderer)===null||b===void 0||b.render(this._scene,(tt=h.scene.activeCamera)===null||tt===void 0?void 0:tt.cameraObject),o=!1))}),h.addEventListener("update",v=>{this.enabled&&(o=this._trackers.length>0)}),h.scene.addEventListener("sceneUpdate",v=>{this.enabled&&(this._trackers.forEach(b=>b.dirty=!0),o=this._trackers.length>0)}),h.scene.addEventListener("activeCameraUpdate",v=>{this.enabled&&(o=this._trackers.length>0,c=!0)});let d=!1;const _=new three_module.tBo;h.container.addEventListener("mousemove",v=>{if(!this.enabled||!this._viewer||this.overCanvas)return;const b=this._viewer.canvas.getBoundingClientRect(),tt=(v.clientX-b.x)/b.width*2-1,it=-(v.clientY-b.y)/b.height*2+1;_.setFromCamera({x:tt,y:it},this._viewer.scene.activeCamera.cameraObject);const nt=this._trackers.map(ut=>ut.modelObj),lt=_.intersectObjects(nt,!1);if(console.log(lt),lt.length)return this._viewer.canvas.style.pointerEvents="none",d=!0,void console.log(this._viewer.canvas.style.pointerEvents);d&&(this._viewer.canvas.style.pointerEvents="auto",d=!1)})}attachIFrame(h,o,c){const d=computeGeometrySize(h.modelObject),_=createIFrameCSS3DObject(o,c,c*d.y/d.x,()=>{var v;return(v=h.setDirty)===null||v===void 0?void 0:v.call(h)});return this.attachCSS3DObject(_,h),_}attachCSS3DObject(h,o){var c,d,_,v,b;if(this._trackers.push({cssObj:h,modelObj:o.modelObject,dirty:!0}),h.element&&(this._resizeObserver.observe(h.element),h.element.__isCSS3DObjectElement=!0,console.log(h.element,h.element.__isCSS3DObjectElement)),o.userData.__oldMaterial=o.material,!o.setMaterial)throw"model not processed?";const tt=(c=this._viewer)===null||c===void 0?void 0:c.createMaterial("basic",{opacity:0,color:new three_module.Q1f("black"),blending:three_module.XIg,side:three_module.hB5});if(!tt)throw"cannot create mat";tt.userData.forcedLinearDepth=0,(d=o.setMaterial)===null||d===void 0||d.call(o,tt),computeAverageGeometryNormal(o.modelObject),computeGeometryCenter(o.modelObject),computeGeometrySize(o.modelObject),this._scene.add(h),(v=(_=this.uiConfig)===null||_===void 0?void 0:_.uiRefresh)===null||v===void 0||v.call(_),(b=o.setDirty)===null||b===void 0||b.call(o)}_syncProperties(h){const o=h.modelObj,c=h.cssObj;o.updateMatrixWorld();const d=h.cssObj.element.clientWidth<1.5?0:(h.cssObj.element.clientWidth-1.5)/computeGeometrySize(o).x,_=computeAverageGeometryNormal(o);c.quaternion.setFromUnitVectors(new three_module.Pq0(0,0,1),_),c.position.copy(computeGeometryCenter(o)),c.scale.set(1,1,1).multiplyScalar(1/d),c.updateMatrixWorld(),c.applyMatrix4(o.matrixWorld),h.dirty=!1}async onDispose(h){return this._resizeObserver.disconnect(),super.onDispose(h)}};function createIFrameCSS3DObject(h,o,c,d){const _=document.createElement("div");_.style.width=o.toString()+"px",_.style.height=c.toString()+"px",_.style.backgroundColor="transparent";const v=document.createElement("iframe",{is:"x-frame-bypass"});v.style.width="100%",v.style.height="100%",v.style.border="0px";const b=()=>{var tt,it;try{v.contentWindow.name}catch(nt){(typeof nt=="string"?nt:(it=(tt=nt==null?void 0:nt.toString)===null||tt===void 0?void 0:tt.call(nt))!==null&&it!==void 0?it:"").includes("cross-origin")?console.warn("Trying to load cross-origin scripts, Install chrome extension if not able to load: https://chrome.google.com/webstore/detail/ignore-x-frame-headers/gleekbfjekiniecknbkamfmkohkpodhe"):console.error(nt)}d(),v.removeEventListener("load",b)};return v.addEventListener("load",b),v.src=h,_.appendChild(v),new CSS3DObject(_)}function computeAverageGeometryNormal(h){if(h.geometry.userData.geometryNormal)return h.geometry.userData.geometryNormal;const o=h.geometry.attributes.normal,c=new three_module.Pq0,d=new three_module.Pq0;for(let _=0,v=o.count;_<v;_++)c.fromBufferAttribute(o,_),d.add(c);return d.normalize(),h.geometry.userData.geometryNormal=d,d}function computeGeometryCenter(h){if(h.geometry.userData.geometryCenter)return h.geometry.userData.geometryCenter;const o=h.geometry;if(!o)return new three_module.Pq0(0,0,0);o.boundingBox||o.computeBoundingBox();const c=o.boundingBox.getCenter(new three_module.Pq0);return h.geometry.userData.geometryCenter=c,c}function computeGeometrySize(h,o=new three_module.Pq0(0,0,1)){if(h.geometry.userData.geometrySize)return h.geometry.userData.geometrySize;const c=h.geometry;if(!c)return new three_module.Pq0(0,0,0);const d=c.clone();d.applyMatrix4(new three_module.kn4().makeRotationFromQuaternion(new three_module.PTz().setFromUnitVectors(o,computeAverageGeometryNormal(h)).invert())),d.computeBoundingBox();const _=d.boundingBox.getSize(new three_module.Pq0);return h.geometry.userData.geometrySize=_,d.dispose(),_}CSS3DRendererPlugin.PluginType="CSS3DRenderer",CSS3DRendererPlugin_decorate([uiToggle("Enabled"),x$1(CSS3DRendererPlugin.prototype._refreshEnabled),serialize()],CSS3DRendererPlugin.prototype,"enabled",void 0),CSS3DRendererPlugin_decorate([uiToggle("Over canvas"),x$1(CSS3DRendererPlugin.prototype._refreshCanvasInDOM),serialize()],CSS3DRendererPlugin.prototype,"overCanvas",void 0),CSS3DRendererPlugin_decorate([uiButton("Attach iframe")],CSS3DRendererPlugin.prototype,"attachIFrameToSelected",void 0),CSS3DRendererPlugin=CSS3DRendererPlugin_decorate([uiFolder("CSS3D Renderer")],CSS3DRendererPlugin);var outline=`uniform sampler2D outlineBuffer;uniform vec2 tDiffuseSize;uniform vec3 outlineColor;uniform float outlineThickness;uniform float outlineIntensity;uniform float highlightTransparency;uniform bool enableHighlight;uniform float dpr;float isSelected(vec2 uv){return 1.-texture2D(outlineBuffer,uv).b;}vec4 outline(in vec4 color){vec2 invSize=1./tDiffuseSize;
#if DEBUG_OUTLINE > 0
color=vec4(0.,0.,0.,1.);
#endif
vec3 finalColor=color.rgb;float c=isSelected(vUv);if(c>0.){vec4 uvOffset=1.5*dpr*outlineThickness*vec4(1.,0.,-1.,1.)*vec4(invSize,invSize);float c1=isSelected(vUv+uvOffset.xy);float c2=isSelected(vUv-uvOffset.xy);float c3=isSelected(vUv+uvOffset.yw);float c4=isSelected(vUv-uvOffset.yw);float diff1=(c1-c2)*0.5;float diff2=(c3-c4)*0.5;float d=length(vec2(diff1,diff2));vec4 highlightColor=enableHighlight?vec4(c*outlineColor,(1.-highlightTransparency)*c):vec4(0.);vec4 edgeColor=vec4(outlineColor,1.)*vec4(d);float gbufferDepth=getDepth(vUv);float outlineDepth=unpack16(texture2D(outlineBuffer,vUv).xy);outlineDepth*=outlineDepth;outlineDepth-=0.005;if(gbufferDepth<outlineDepth){highlightColor.rgb=highlightColor.rgb*0.3;edgeColor.rgb=edgeColor.rgb*0.5;}vec4 outColor=edgeColor+highlightColor*(1.-d);finalColor=mix(color.rgb,outlineIntensity*outColor.rgb,outColor.a);}else{finalColor.rgb=color.rgb;}return vec4(finalColor.rgb,color.a);}`;class OutlineRenderPass extends RenderPass{constructor(o,c,d,_=new three_module.Q1f(1,1,1),v=1){super(void 0,void 0,d,_,v),this._getSelectedObjectOrMaterial=o,this.target=c}render(o,c,d,_,v){const b=o.getRenderTarget(),tt=o.getActiveCubeFace(),it=o.getActiveMipmapLevel(),nt=this._getSelectedObjectOrMaterial();if(nt)this._renderSelectedObject(o,nt,c,_,v);else{o.setRenderTarget(this.target);const lt=new three_module.Q1f;o.getClearColor(lt),o.setClearColor(new three_module.Q1f(16777215)),o.clear(!0,!0),o.setClearColor(lt)}o.setRenderTarget(b,tt,it)}_renderSelectedObject(o,c,d,_,v){if(!this.camera)return;const b=(Array.isArray(c)?c:[c]).map(nt=>nt.isMaterial?[...nt.userData.__appliedMeshes.values()]:nt).flat();b.forEach(nt=>nt.traverse(lt=>{lt.layers.enable(6)}));const tt=this.camera.layers.mask;this.camera.layers.set(6);const it=o.userData;it||console.error("threejs is not patched?"),it.transmissionRenderTarget=d,setThreeRendererMode(o,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!0,transparentRender:!0,transmissionRender:!0,mainRenderPass:!1},()=>super.render(o,d,this.target,_,v)),it.transmissionRenderTarget=void 0,b.forEach(nt=>nt.traverse(lt=>{lt.layers.disable(6)})),this.camera.layers.mask=tt}}var outlineDepthVert=`#ifdef USE_ALPHAMAP
#define USE_UV 
#endif
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec3 vViewPosition;void main(){
#include <skinbase_vertex>
#include <begin_vertex>
#include <morphtarget_vertex>
#include <skinning_vertex>
#include <displacementmap_vertex>
#include <project_vertex>
#include <logdepthbuf_vertex>
#include <clipping_planes_vertex>
vViewPosition=-mvPosition.xyz;}`,outlineDepthFrag="uniform vec2 cameraNearFar;varying vec3 vViewPosition;vec2 pack16(float value){float sMax=65535.;int v=int(clamp(value,0.,1.)*sMax+0.5);int digit0=v/256;int digit1=v-digit0*256;return vec2(float(digit0)/255.,float(digit1)/255.);}float linstep(float edge0,float edge1,float value){return clamp((value-edge0)/(edge1-edge0),0.,1.);}void main(){float linearZ=linstep(-cameraNearFar.x,-cameraNearFar.y,-vViewPosition.z);vec2 packedZ=pack16(pow(max(0.,linearZ),0.5));gl_FragColor=vec4(packedZ.x,packedZ.y,0.,0.);}",OutlinePlugin_decorate=function(h,o,c,d){var _,v=arguments.length,b=v<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(h,o,c,d);else for(var tt=h.length-1;tt>=0;tt--)(_=h[tt])&&(b=(v<3?_(b):v>3?_(o,c,b):_(o,c))||b);return v>3&&b&&Object.defineProperty(o,c,b),b};let OutlineExtension=class{constructor(h,o){this.enabled=!0,this.enableHighlight=!1,this.enableDynamicSelection=!0,this.outlineIntensity=2,this.highlightTransparency=.84,this.outlineColor=new three_module.Q1f(15305317),this.debugOutline=!1,this.highlightSelectedMaterials=!1,this.highlightMaterialSameNames=!1,this.transparency=0,this._outlineThickness=2,this.extraUniforms={outlineIntensity:{value:1},tDiffuseSize:{value:new three_module.I9Y(1,1)},outlineThickness:{value:2},highlightTransparency:{value:1},outlineColor:{value:new three_module.Q1f(15305317)},enableHighlight:{value:!0},outlineBuffer:{value:null},dpr:{value:1}},this.extraDefines={DEBUG_OUTLINE:"0"},this.parsFragmentSnippet=(c,d)=>this.enabled?fe$1`
            ${unpackGbuffer}
            ${outline}
        `:"",this._combinedPostPlugin=h.getPlugin(CombinedPostPlugin),this._pickingPlugin=h.getPluginByType("Picking"),this._setDirty=this._setDirty.bind(this),o&&(this.extraUniforms.outlineBuffer.value=o.texture),this._enable()}shaderExtender(h,o,c){this.enabled&&(h.fragmentShader=shaderReplaceString(h.fragmentShader,"#glMarker",` 
            gl_FragColor = outline(gl_FragColor);
            #glMarker
        `))}getUiConfig(){return this.uiConfig}computeCacheKey(h){return this.enabled?"1":"0"}isCompatible(h){return!0}_setDirty(){this._combinedPostPlugin&&this._combinedPostPlugin.reRender(),this.extraDefines&&(this.extraDefines.DEBUG_OUTLINE=this.debugOutline?"1":"0"),this.extraUniforms&&(this.extraUniforms.outlineIntensity.value=this.outlineIntensity,this.extraUniforms.outlineColor.value.copy(this.outlineColor),this.extraUniforms.outlineThickness.value=this._outlineThickness,this.extraUniforms.enableHighlight.value=this.enableHighlight,this.extraUniforms.highlightTransparency.value=this.transparency)}setDirty(){var h;(h=this.__setDirty)===null||h===void 0||h.call(this),this._setDirty()}_enable(){var h;(h=this._pickingPlugin)===null||h===void 0||h.enableWidget(!this.enabled),this._setDirty()}};OutlineExtension.PluginType="Outline",OutlinePlugin_decorate([x$1(OutlineExtension.prototype._enable),uiToggle("Enable"),serialize()],OutlineExtension.prototype,"enabled",void 0),OutlinePlugin_decorate([x$1(OutlineExtension.prototype._setDirty),uiToggle("Highlight"),serialize()],OutlineExtension.prototype,"enableHighlight",void 0),OutlinePlugin_decorate([x$1(OutlineExtension.prototype._setDirty),uiToggle("DynamicSelection"),serialize()],OutlineExtension.prototype,"enableDynamicSelection",void 0),OutlinePlugin_decorate([x$1(OutlineExtension.prototype._setDirty),uiSlider("Intensity",[0,2],.001,{limitedUi:!0}),serialize()],OutlineExtension.prototype,"outlineIntensity",void 0),OutlinePlugin_decorate([x$1(OutlineExtension.prototype._setDirty),uiSlider("Transparency",[0,1],.01,{limitedUi:!0}),serialize()],OutlineExtension.prototype,"highlightTransparency",void 0),OutlinePlugin_decorate([x$1(OutlineExtension.prototype._setDirty),uiColor("Color"),serialize()],OutlineExtension.prototype,"outlineColor",void 0),OutlinePlugin_decorate([x$1(OutlineExtension.prototype._setDirty),uiToggle("Debug")],OutlineExtension.prototype,"debugOutline",void 0),OutlinePlugin_decorate([x$1(OutlineExtension.prototype._setDirty),uiToggle("Highlight Selected Materials")],OutlineExtension.prototype,"highlightSelectedMaterials",void 0),OutlinePlugin_decorate([x$1(OutlineExtension.prototype._setDirty),uiToggle("Highlight Materials (same name)")],OutlineExtension.prototype,"highlightMaterialSameNames",void 0),OutlineExtension=OutlinePlugin_decorate([uiFolder("Outline")],OutlineExtension);class OutlinePlugin extends GenericExtensionPlugin{constructor(){super(),this._state="in",this.mouseInOutAnimationEnabled=!0}generateExtension(o){return new OutlineExtension(o,this._outlineTarget)}async onAdded(o){this._outlineTarget=o.renderer.createTarget({sizeMultiplier:1}),await super.onAdded(o);const c=o==null?void 0:o.getPluginByType("Picking");c||console.error("OutlinePlugin requires PickingPlugin to be added to the viewer"),o.addEventListener("preRender",()=>{this._extension.extraUniforms.dpr.value=o.renderer.displayCanvasScaling});const d=new three_module.BKk({uniforms:{cameraNearFar:{value:new three_module.I9Y(.1,100)}},vertexShader:outlineDepthVert,fragmentShader:outlineDepthFrag,side:three_module.$EB}),_=makeFilter(o,{passId:"outline",after:["gbuffer"],before:["render"],passObject:new OutlineRenderPass(()=>{var v,b;if(!((v=this._extension)===null||v===void 0)&&v.highlightSelectedMaterials){const tt=(b=c==null?void 0:c.getSelectedObject())===null||b===void 0?void 0:b.material;if(this._extension.highlightMaterialSameNames&&tt){const it=Array.isArray(tt)?tt.map(lt=>lt.name):[tt.name],nt=new Set;return it.forEach(lt=>{var ut,ht;const _t=(ht=(ut=o.assetManager)===null||ut===void 0?void 0:ut.materials)===null||ht===void 0?void 0:ht.findMaterialsByName(lt);_t==null||_t.forEach(ft=>nt.add(ft))}),[...nt]}return tt}return c==null?void 0:c.getSelectedObject()},this._outlineTarget,d),update(){o.scene.renderCamera.updateShaderProperties(this.passObject.overrideMaterial),_.passObject.scene=o.scene.modelObject,_.passObject.camera=o.scene.renderCamera.cameraObject}});o.renderer.registerPass(_),c==null||c.addEventListener("selectedObjectChanged",()=>{!this._animationCallBack&&this._extension&&(c!=null&&c.getSelectedObject()?this._extension.enableDynamicSelection?(this._extension.transparency=1,this._animationCallBack=this._startTransparencyAnimation(1,this._extension.highlightTransparency,400)):this._extension.transparency=this._extension.highlightTransparency:this._extension.transparency=1)}),document.addEventListener("mousemove",v=>{if(!this._extension||!this.mouseInOutAnimationEnabled)return;const b=c==null?void 0:c.getSelectedObject();b&&this._extension.enableDynamicSelection?v.target!==o.canvas?this._animationCallBack||this._state!=="in"||(this._animationCallBack=this._startTransparencyAnimation(this._extension.highlightTransparency,1,600),this._state="out"):this._animationCallBack||this._state!=="out"||(this._animationCallBack=this._startTransparencyAnimation(1,this._extension.highlightTransparency,600),this._state="in"):this._extension.transparency=b?this._extension.highlightTransparency:1})}async _startTransparencyAnimation(o,c,d){return animateTarget$1(this._extension,"transparency",{from:o,to:c,duration:d,onComplete:()=>{this._animationCallBack=null}})}}OutlinePlugin.PluginType="Outline";const RADIUS=.2,LINE_WIDTH=.03,MAX_OPACITY=.75,SEGMENTS=12,DELTA_PHI=Math.PI/(2*SEGMENTS),vector2=new three_module.I9Y,addCorner=(h,o,c)=>{let d=o>0?c>0?0:-Math.PI/2:c>0?Math.PI/2:Math.PI;for(let _=0;_<=SEGMENTS;++_)h.push(o+(RADIUS-LINE_WIDTH)*Math.cos(d),c+(RADIUS-LINE_WIDTH)*Math.sin(d),0,o+RADIUS*Math.cos(d),c+RADIUS*Math.sin(d),0),d+=DELTA_PHI},makeARBoxGeometry=(h,o)=>{const c=new three_module.LoY,d=[],_=[],v=h.getSize(new three_module.Pq0),b=v.x/2,tt=(o?v.y:v.z)/2;addCorner(_,b,tt),addCorner(_,-b,tt),addCorner(_,-b,-tt),addCorner(_,b,-tt);const it=_.length/3;for(let lt=0;lt<it-2;lt+=2)d.push(lt,lt+1,lt+3,lt,lt+3,lt+2);const nt=it-2;return d.push(nt,nt+1,1,nt,1,0),c.setAttribute("position",new three_module.qtW(_,3)),c.setIndex(d),c};class ARPlacementBox extends three_module.eaF{constructor(o,c,d=!1){super(makeARBoxGeometry(o,d)),this.boundingSize=new three_module.Pq0,this._raycaster=new three_module.tBo,this._camera=c,this._placeOnWall=d;const _=this.material;_.side=three_module.hB5,_.color=new three_module.Q1f(16711935),_.opacity=0,this.userData.bboxVisible=!1;const v=o.getSize(this.boundingSize),b=v.x/2,tt=(d?v.y:v.z)/2;this.hitPlane=new three_module.eaF(new three_module.bdM(2*(b+RADIUS),2*(tt+RADIUS))),this.hitPlane.visible=!1,this.add(this.hitPlane),o.getCenter(this.position),d?(this.shadowHeight=o.min.z,this.position.z=this.shadowHeight):(this.rotateX(-Math.PI/2),this.shadowHeight=o.min.y,this.position.y=this.shadowHeight),this.offsetHeight=0}getHit(o,c,d){vector2.set(c,-d),this.hitPlane.visible=!0;const _=this._positionAndNormalFromPoint(vector2,this.hitPlane);return this.hitPlane.visible=!1,_==null?null:_.position}getExpandedHit(o,c,d){this.hitPlane.scale.set(1e3,1e3,1e3);const _=this.getHit(o,c,d);return this.hitPlane.scale.set(1,1,1),_}set offsetHeight(o){o-=.001,this._placeOnWall?this.position.z=this.shadowHeight+o:this.position.y=this.shadowHeight+o}get offsetHeight(){return this._placeOnWall?this.position.z-this.shadowHeight:this.position.y-this.shadowHeight}set show(o){this.material.opacity=o?MAX_OPACITY:0}get show(){return this.material.opacity>.01}updateOpacity(o){const c=this.material;this.visible=c.opacity>0}dispose(){var o;const{geometry:c,material:d}=this.hitPlane;c.dispose(),d.dispose(),this.geometry.dispose(),this.material.dispose(),(o=this.parent)===null||o===void 0||o.remove(this)}_positionAndNormalFromPoint(o,c){if(!this._camera)return null;this._raycaster.setFromCamera(o,this._camera);const d=this._raycaster.intersectObject(c,!0);if(d.length===0)return null;const _=d[0];return _.face==null?null:_.uv==null?{position:_.point,normal:_.face.normal,uv:null}:(_.face.normal.applyNormalMatrix(new three_module.dwI().getNormalMatrix(_.object.matrixWorld)),{position:_.point,normal:_.face.normal,uv:_.uv})}}const ROTATION_RATE=1.5,SCALE_SNAP_HIGH=1.3,SCALE_SNAP_LOW=1/SCALE_SNAP_HIGH,MAX_DISTANCE=10,vector3=new three_module.Pq0;class ARTouchInputHelper{constructor(){this.inputSource=null,this.isTranslating=!1,this.isRotating=!1,this.isTwoFingering=!1,this.lastDragPosition=new three_module.Pq0,this.firstRatio=0,this.lastAngle=0,this.goalPosition=new three_module.Pq0,this.goalYaw=0,this.goalScale=1,this.presentedScene=null,this.placementBox=null,this.placeOnWall=!1,this.placementComplete=!1,this.xr=null,this.session=null,this._hitPosition=new three_module.Pq0,this._hitMatrix=new three_module.kn4,this.xDamper=new k$1,this.yDamper=new k$1,this.zDamper=new k$1,this.yawDamper=new k$1,this.scaleDamper=new k$1,this.onSelectStart=o=>{const c=this.transientHitTestSource;if(c==null)return;const d=this.frame.getHitTestResultsForTransientInput(c),_=this.presentedScene,v=this.placementBox;if(d.length===1){this.inputSource=o.inputSource;const{axes:b}=this.inputSource.gamepad||{axes:[0,0]},tt=v.getHit(_,b[0],b[1]);v.show=!0,tt!=null?(this.isTranslating=!0,this.lastDragPosition.copy(tt),this.presentedScene&&(this.presentedScene.visible=!0)):this.placeOnWall||(this.isRotating=!0,this.lastAngle=b[0]*ROTATION_RATE)}else if(d.length===2){v.show=!0,this.isTwoFingering=!0;const{separation:b}=this.fingerPolar(d);this.firstRatio=b/_.scale.x}},this.onSelectEnd=()=>{this.isTranslating=!1,this.isRotating=!1,this.isTwoFingering=!1,this.inputSource=null,this.goalPosition.y+=this.placementBox.offsetHeight*this.presentedScene.scale.x,this.placementBox.show=!1}}async setSession(o,c,d){var _;this.transientHitTestSource=await((_=o.requestHitTestSourceForTransientInput)===null||_===void 0?void 0:_.call(o,{profile:"generic-touchscreen"})),this.presentedScene=c,this.placementBox=d,this.session=o,this.placementComplete=!1,this.goalPosition.copy(c.position),this.goalYaw=c.rotation.y,this.goalScale=c.scale.x,o.addEventListener("selectstart",this.onSelectStart),o.addEventListener("selectend",this.onSelectEnd)}cancel(){this.transientHitTestSource&&(this.transientHitTestSource.cancel(),this.transientHitTestSource=void 0),this.presentedScene=null,this.placeOnWall=!1,this.frame=void 0,this.xr=null,this.placementBox&&(this.placementBox.show=!1,this.placementBox=null),this.session&&(this.session.removeEventListener("selectstart",this.onSelectStart),this.session.removeEventListener("selectend",this.onSelectEnd),this.session=null)}getHitPoint(o){var c;const d=(c=this.xr)===null||c===void 0?void 0:c.getReferenceSpace(),_=d?o.getPose(d):null;return _?(this._hitMatrix.fromArray(_.transform.matrix),this.placeOnWall&&(this.goalYaw=Math.atan2(this._hitMatrix.elements[4],this._hitMatrix.elements[6])),this._hitMatrix.elements[5]>.75!==this.placeOnWall?this._hitPosition.setFromMatrixPosition(this._hitMatrix):null):null}moveScene(o){if(!this.session)return;const c=this.presentedScene,d=c.position,_=c.rotation.y,v=this.placementBox,b=Math.max(v.boundingSize.x,v.boundingSize.y,v.boundingSize.z)/2,tt=this.goalPosition,it=c.scale.x;if(!tt.equals(d)||this.goalScale!==it){let{x:nt,y:lt,z:ut}=d;nt=this.xDamper.update(nt,tt.x,o,b),lt=this.yDamper.update(lt,tt.y,o,b),ut=this.zDamper.update(ut,tt.z,o,b),d.set(nt,lt,ut);const ht=this.scaleDamper.update(it,this.goalScale,o,1);if(c.scale.set(ht,ht,ht),!this.isTranslating){const _t=tt.y-lt;this.placementComplete&&!this.placeOnWall?v.offsetHeight=_t/ht:_t===0&&(this.placementComplete=!0,v.show=!1)}}v.updateOpacity(o),c.rotation.y=this.yawDamper.update(_,this.goalYaw,o,Math.PI)}processInput(o){var c;this.frame=o;const d=this.transientHitTestSource;if(!d||!this.isTranslating&&!this.isTwoFingering&&!this.isRotating)return;const _=o.getHitTestResultsForTransientInput(d),v=this.presentedScene,b=v.scale.x;if(this.isTwoFingering)if(_.length<2)this.isTwoFingering=!1;else{const{separation:tt,deltaYaw:it}=this.fingerPolar(_);if(this.placeOnWall||(this.goalYaw+=it),!v.userData.__scaleDisabled){const nt=tt/this.firstRatio;this.goalScale=nt<SCALE_SNAP_HIGH&&nt>SCALE_SNAP_LOW?1:nt}}else if(_.length!==2)if(this.isRotating&&!((c=this.inputSource)===null||c===void 0)&&c.gamepad){const tt=this.inputSource.gamepad.axes[0]*ROTATION_RATE;this.goalYaw+=tt-this.lastAngle,this.lastAngle=tt}else this.isTranslating&&(console.log("translating"),_.forEach(tt=>{if(tt.inputSource!==this.inputSource)return;let it=null;if(tt.results.length>0&&(it=this.getHitPoint(tt.results[0])),it==null&&(it=this.getTouchLocation()),it!=null){if(this.goalPosition.sub(this.lastDragPosition),!this.placeOnWall){const nt=it.y-this.lastDragPosition.y;if(nt<0){this.placementBox.offsetHeight=nt/b;const lt=vector3.copy(this.xr.getCamera().position),ut=-nt/(lt.y-it.y);lt.multiplyScalar(ut),it.multiplyScalar(1-ut).add(lt)}}this.goalPosition.add(it),this.lastDragPosition.copy(it)}}));else{this.isTranslating=!1,this.isRotating=!1,this.isTwoFingering=!0;const{separation:tt}=this.fingerPolar(_);this.firstRatio=tt/b}}getTouchLocation(){var o,c;const{axes:d}=(o=this.inputSource.gamepad)!==null&&o!==void 0?o:{axes:[0,0]},_=this.placementBox.getExpandedHit(this.presentedScene,d[0],d[1]);return _!=null&&(vector3.copy(_).sub((c=this.xr)===null||c===void 0?void 0:c.getCamera().position),vector3.length()>MAX_DISTANCE)?null:_}fingerPolar(o){var c,d,_,v,b,tt;const it=(_=(d=(c=o[0].inputSource)===null||c===void 0?void 0:c.gamepad)===null||d===void 0?void 0:d.axes)!==null&&_!==void 0?_:[0,0],nt=(tt=(b=(v=o[1].inputSource)===null||v===void 0?void 0:v.gamepad)===null||b===void 0?void 0:b.axes)!==null&&tt!==void 0?tt:[0,0],lt=nt[0]-it[0],ut=nt[1]-it[1],ht=Math.atan2(ut,lt);let _t=this.lastAngle-ht;return _t>Math.PI?_t-=2*Math.PI:_t<-Math.PI&&(_t+=2*Math.PI),this.lastAngle=ht,{separation:Math.sqrt(lt*lt+ut*ut),deltaYaw:_t}}}class SessionLightProbe{constructor(o,c,d,_,v){this.xrLight=o,this.renderer=c,this.lightProbe=d,this.xrWebGLBinding=null,this.estimationStartCallback=v,this.frameCallback=this.onXRFrame.bind(this);const b=c.xr.getSession();if(_&&"XRWebGLBinding"in window){const tt=new three_module.o6l(16);o.environment=tt.texture;const it=c.getContext();switch(b.preferredReflectionFormat){case"srgba8":it.getExtension("EXT_sRGB");break;case"rgba16f":it.getExtension("OES_texture_half_float")}this.xrWebGLBinding=new XRWebGLBinding(b,it),this.lightProbe.addEventListener("reflectionchange",()=>{this.updateReflection()})}b.requestAnimationFrame(this.frameCallback)}updateReflection(){const o=this.renderer.properties.get(this.xrLight.environment);if(o){const c=this.xrWebGLBinding.getReflectionCubeMap(this.lightProbe);c&&(o.__webglTexture=c,this.xrLight.environment.needsPMREMUpdate=!0)}}onXRFrame(o,c){if(!this.xrLight)return;c.session.requestAnimationFrame(this.frameCallback);const d=c.getLightEstimate(this.lightProbe);if(d){this.xrLight.lightProbe.sh.fromArray(d.sphericalHarmonicsCoefficients),this.xrLight.lightProbe.intensity=.3;const _=Math.max(1,Math.max(d.primaryLightIntensity.x,Math.max(d.primaryLightIntensity.y,d.primaryLightIntensity.z)));this.xrLight.directionalLight.color.setRGB(d.primaryLightIntensity.x/_,d.primaryLightIntensity.y/_,d.primaryLightIntensity.z/_),this.xrLight.directionalLight.intensity=_,this.xrLight.directionalLight.position.copy(d.primaryLightDirection),this.estimationStartCallback&&(this.estimationStartCallback(),this.estimationStartCallback=null)}}dispose(){this.xrLight=null,this.renderer=null,this.lightProbe=null,this.xrWebGLBinding=null}}class XREstimatedLight extends three_module.YJl{constructor(o,c=!0){super(),this.lightProbe=new three_module.FZo,this.lightProbe.intensity=0,this.add(this.lightProbe),this.directionalLight=new three_module.ZyN,this.directionalLight.intensity=0,this.add(this.directionalLight),this.environment=null;let d=null,_=!1;o.xr.addEventListener("sessionstart",()=>{const v=o.xr.getSession();"requestLightProbe"in v&&v.requestLightProbe({reflectionFormat:v.preferredReflectionFormat}).then(b=>{d=new SessionLightProbe(this,o,b,c,()=>{_=!0,this.dispatchEvent({type:"estimationstart"})})})}),o.xr.addEventListener("sessionend",()=>{d&&(d.dispose(),d=null),_&&this.dispatchEvent({type:"estimationend"})}),this.dispose=()=>{d&&(d.dispose(),d=null),this.remove(this.lightProbe),this.lightProbe=null,this.remove(this.directionalLight),this.directionalLight=null,this.environment=null}}}var ARPlugin_decorate=function(h,o,c,d){var _,v=arguments.length,b=v<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(h,o,c,d);else for(var tt=h.length-1;tt>=0;tt--)(_=h[tt])&&(b=(v<3?_(b):v>3?_(o,c,b):_(o,c))||b);return v>3&&b&&Object.defineProperty(o,c,b),b},ARPlugin_1;const HIT_ANGLE_DEG=20;let ARPlugin=ARPlugin_1=class extends AViewerPlugin{constructor(){super(...arguments),this.enabled=!0,this._touchInputHelper=new ARTouchInputHelper,this.dependencies=[GBufferPlugin],this.estimateLighting=!1,this.placeOnWall=!1,this.xrResolutionScale=1,this.toJSON=void 0,this.enterAR=()=>{var h;this.enabled&&this._viewer&&(navigator&&navigator.xr?this._xrSession?console.warn("Already in AR"):this._xrManager?(this._xrManager.enabled=!0,(h=this._xrManager)===null||h===void 0||h.setFramebufferScaleFactor(this.xrResolutionScale),navigator.xr.requestSession("immersive-ar",{requiredFeatures:["hit-test"],optionalFeatures:["dom-overlay","light-estimation"],domOverlay:this.domOverlay}).then(this._onSessionStarted)):console.error("XR manager not found"):console.error("XR not supported"))},this.exitAR=()=>{this._xrSession&&this._xrSession.end()},this._preRender=()=>{var h;if(!(this._dirty&&this._viewer&&this._xrManager&&this._xrSession))return;this._viewer.renderer.defaultRenderToScreen=!1,this._xrManager.enabled=!1;const o=this._xrManager.getCamera(),c=((h=o.cameras)===null||h===void 0?void 0:h[0])||o,d=this._viewer.scene.activeCamera;d.cameraObject.projectionMatrix.copy(c.projectionMatrix),d.cameraObject.projectionMatrixInverse.copy(d.cameraObject.projectionMatrix).invert()},this._postRender=()=>{var h,o;if(!this._dirty||!this._viewer||!this._xrSession)return;this._viewer.scene.activeCamera.cameraObject.updateProjectionMatrix();const c=this._viewer.renderer,d=(o=(h=this._xrManager)===null||h===void 0?void 0:h.getCamera())===null||o===void 0?void 0:o.cameras[0].viewport;d?c.rendererObject.setViewport(d):console.warn("no viewport for ar camera"),this._viewer.getPlugin(GBufferPlugin).updateShaderProperties(arCopyPass.material),arCopyPass.uniforms.tTransparentMap.value=this._viewer.renderFilter.passObject.transparentTarget.texture,setThreeRendererMode(c.rendererObject,{sceneRender:!0,opaqueRender:!0,shadowMapRender:!1,backgroundRender:!1,transparentRender:!1,transmissionRender:!1,screenSpaceRendering:!1},()=>{arCopyPass.render(c.rendererObject,null,c.composer.readBuffer,0,!1)}),this._xrManager.enabled=!0,this._viewer.renderer.defaultRenderToScreen=!0},this._frameCount=0,this._isPresenting=!1,this._interactionsDisabled=!1,this._preFrame=({xrFrame:h,deltaTime:o})=>{var c,d;if(this.dirty=!!h&&((c=this._xrManager)===null||c===void 0?void 0:c.isPresenting)||!1,(this._dirty||this._interactionsDisabled)&&(this._viewer.scene.activeCamera.setInteractions(!this._dirty,ARPlugin_1.PluginType),this._viewer.scene.activeCamera.autoLookAtTarget=!this._dirty,this._interactionsDisabled=this._dirty),!this._dirty||!h)return void(this._isPresenting&&this._xrRenderingEnd());if(!this._xrSession)return console.error("no xr session found, shouldn't happen"),void(this.dirty=!1);this._isPresenting||console.log("webxr: AR session init"),this._frameCount++;const _=this._xrManager.getReferenceSpace(),v=h.getViewerPose(_);if(v==null&&this._frameCount,v==null||((d=this._viewer)===null||d===void 0?void 0:d.scene.modelRoot.children.length)===0)return this.dirty=!1,void console.warn("no pose or no model");this._isPresenting||(this._isPresenting=!0,this._frameCount=0,this._savePreXRState(),this._preSetupModel(),this._xrRenderingBegin());const b=this._viewer.scene.activeCamera;this._xrManager.updateCamera(b.cameraObject),b.setDirty(),this.moveToFloor(h),this._touchInputHelper.processInput(h),this._touchInputHelper.moveScene(o),this._updateShadow()},this._preXRState={viewerBg:null,viewerBgColor:void 0,modelScale:new three_module.Pq0(1,1,1),modelPosition:new three_module.Pq0,modelRotation:new three_module.PTz,cameraPosition:new three_module.Pq0(0,0,5),cameraTarget:new three_module.Pq0,cameraUp:new three_module.Pq0(0,1,0),cameraAspect:1,cameraFov:50,cameraZoom:1,cameraNear:.01,cameraFar:100,cameraProjectionMatrix:new three_module.kn4,cameraAutoNearFar:void 0,groundOffset:new three_module.Pq0,groundScale:1,groundRotation:0,groundRenderToDepth:!1,groundShadowBaker:!1,viewport:new three_module.I9Y,environment:void 0,preserveTransparentTarget:!0},this._savePreXRState=()=>{var h;if(!this._viewer)return;this._preXRState.viewport.copy(this._viewer.renderer.renderSize),this._preXRState.viewerBg=this._viewer.scene.background,this._preXRState.viewerBgColor=(h=this._viewer.scene.backgroundColor)===null||h===void 0?void 0:h.getHex();const o=this._viewer.scene.modelRoot,c=this._viewer.scene.activeCamera;o.updateMatrix(),o.updateMatrixWorld(!0),this._preXRState.modelScale.copy(o.scale),this._preXRState.modelPosition.copy(o.position),this._preXRState.modelRotation.copy(o.quaternion),this._preXRState.cameraPosition.copy(c.position),this._preXRState.cameraTarget.copy(c.target),this._preXRState.cameraUp.copy(c.cameraObject.up),c.cameraObject.isPerspectiveCamera&&(this._preXRState.cameraFov=c.cameraObject.fov,this._preXRState.cameraAspect=c.cameraObject.aspect),this._preXRState.cameraZoom=c.cameraObject.zoom,this._preXRState.cameraNear=c.cameraObject.near,this._preXRState.cameraFar=c.cameraObject.far,this._preXRState.cameraAutoNearFar=c.cameraObject.userData.autoNearFar,this._preXRState.cameraProjectionMatrix.copy(c.cameraObject.projectionMatrix);const d=this._viewer.getPluginByType("Ground");d!=null&&d.mesh&&(this._preXRState.groundOffset.subVectors(o.position,d.mesh.modelObject.position),this._preXRState.groundScale=d.mesh.modelObject.scale.x,this._preXRState.groundRotation=d.mesh.modelObject.rotation.z,this._preXRState.groundRenderToDepth=d.renderToDepth,this._preXRState.groundShadowBaker=d.shadowBaker.enabled),this._preXRState.environment||(this._preXRState.environment=this._viewer.scene.getEnvironment()),this._preXRState.preserveTransparentTarget=this._viewer.renderFilter.passObject.preserveTransparentTarget},this._xrRenderingBegin=()=>{if(!this._xrSession||!this._viewer)return;console.log("webxr: AR session start");const h=HIT_ANGLE_DEG*Math.PI/180,o=this.placeOnWall?void 0:new window.XRRay(new DOMPoint(0,0,0),{x:0,y:-Math.sin(h),z:-Math.cos(h)});this._viewer.renderer.useTotalFrameCount=!0,this._viewer.resize(),(async()=>{var c,d;if(this._xrSession){this._touchInputHelper.placeOnWall=this.placeOnWall,await this._touchInputHelper.setSession(this._xrSession,this._viewer.scene.modelRoot,this._placementBox);const _=await this._xrSession.requestReferenceSpace("viewer");this._hitTestSource=await((d=(c=this._xrSession).requestHitTestSource)===null||d===void 0?void 0:d.call(c,{space:_,offsetRay:o}))}})()},this._xrRenderingEnd=()=>{console.log("webxr: AR session end"),this._xrManager&&(this._xrManager.enabled=!1),this._isPresenting=!1,this._frameCount=0,this._xrSession=void 0,this._removePlacementBox(),this._cancelHitSources(),this._viewer&&(this._viewer.renderer.stableNoise=!1),this._restorePreXRState()},this._onSessionStarted=async h=>{h.addEventListener("end",this._onSessionEnded),this.estimateLighting&&(this._xrLight=new XREstimatedLight(this._viewer.renderer.rendererObject),this._xrLight.addEventListener("estimationstart",()=>{this._xrSession&&this._xrLight&&(this._viewer.scene.modelRoot.add(this._xrLight),this._preXRState.environment||(this._preXRState.environment=this._viewer.scene.getEnvironment()),this._viewer.scene.setEnvironment(this._xrLight.environment))})),this._xrManager.setReferenceSpaceType("local"),await this._xrManager.setSession(h),this._xrSession=h},this._onSessionEnded=()=>{this._xrSession&&(this._xrSession.removeEventListener("end",this._onSessionEnded),this._xrLight&&(this._xrLight.removeFromParent(),this._xrLight.dispose(),this._xrLight=void 0))}}async onAdded(h){await super.onAdded(h);const o=h.renderer.rendererObject.xr;if(o.cameraAutoUpdate=!1,this._xrManager=o,this._touchInputHelper.xr=o,!this.domOverlay){const c=document.getElementById("tweakpaneUiContainer");this.domOverlay=c?{root:c}:void 0}if(h.addEventListener("preRender",this._preRender),h.addEventListener("postRender",this._postRender),h.addEventListener("preFrame",this._preFrame),!window.isSecureContext)return h.console.error("XR not supported in insecure context, try https://"),void(this.enabled=!1);navigator&&"xr"in navigator&&navigator.xr?navigator.xr.isSessionSupported("immersive-ar").then(c=>{if(!c)throw new Error("AR not supported")}).catch(c=>{h.console.error("AR not supported:",c),o.enabled=!1,this.enabled=!1}):(o.enabled=!1,this.enabled=!1)}_updateShadow(){var h,o;if(!this._viewer)return;const c=this._viewer.scene.modelRoot,d=(o=(h=this._viewer.getPluginByType("Ground"))===null||h===void 0?void 0:h.mesh)===null||o===void 0?void 0:o.modelObject;d&&(d.rotation.z=this._viewer.scene.modelRoot.rotation.y,d.position.copy(this._preXRState.groundOffset).multiplyScalar(c.modelObject.scale.x).sub(c.modelObject.position).negate(),d.scale.setScalar(c.modelObject.scale.x*this._preXRState.groundScale))}moveToFloor(h){if(!this._dirty||!this._hitTestSource||!this._xrManager)return;const o=h.getHitTestResults(this._hitTestSource);if(!o.length)return;const c=o[0];this._touchInputHelper.placeOnWall=this.placeOnWall;const d=this._touchInputHelper.getHitPoint(c);if(!d)return;this._placementBox.show=!0;const _=this._viewer.scene.modelRoot;this._touchInputHelper.goalPosition.copy(d),_.position.copy(d),this._viewer.scene.modelRoot.visible=!0,this._hitTestSource.cancel(),this._hitTestSource=void 0}_removePlacementBox(){this._placementBox&&(this._placementBox.removeFromParent(),this._placementBox=void 0)}_preSetupModel(){var h,o;const c=this._viewer.scene.modelRoot,d=this._viewer.scene.activeCamera,_=(h=this._xrManager)===null||h===void 0?void 0:h.getCamera(),v=_.cameras[0]||_;this._removePlacementBox();const b=this._viewer.scene.getBounds(!0,!0);b.getSize(new three_module.Pq0).length()>.01&&(this._placementBox=new ARPlacementBox(b,_,this.placeOnWall),c.add(this._placementBox),this._placementBox.show=!1);const tt=_.getWorldDirection(new three_module.Pq0);c.rotation.y=Math.atan2(-tt.x,-tt.z)-0,d.cameraObject.zoom=v.zoom,d.cameraObject.near=v.near,d.cameraObject.far=v.far,d.cameraObject.userData.autoNearFar=!1,d.cameraObject.isPerspectiveCamera?(d.cameraObject.fov=v.fov,d.cameraObject.aspect=v.viewport.width/v.viewport.height):console.warn("Perspective camera required."),d.cameraObject.updateProjectionMatrix();const it=c.userData.arScale||1;c.scale.set(it,it,it),c.position.copy(_.position).add(tt.multiplyScalar(5)),c.visible=!0;const nt=(o=this._viewer)===null||o===void 0?void 0:o.getPluginByType("Ground");nt!=null&&nt.mesh&&(nt.shadowBaker.enabled=!1,nt.renderToDepth=!1)}_restorePreXRState(){var h;if(!this._viewer)return;this._viewer.renderer.rendererObject.setSize(this._preXRState.viewport.x,this._preXRState.viewport.y),this._viewer.resize(),this._viewer.scene.activeCamera.setInteractions(!0,ARPlugin_1.PluginType),this._viewer.scene.activeCamera.autoLookAtTarget=!0,this._viewer.scene.background=this._preXRState.viewerBg,this._preXRState.viewerBgColor!==void 0&&((h=this._viewer.scene.backgroundColor)===null||h===void 0||h.set(this._preXRState.viewerBgColor)),this._preXRState.viewerBg=null;const o=this._viewer.scene.modelRoot;o.scale.copy(this._preXRState.modelScale),o.position.copy(this._preXRState.modelPosition),o.quaternion.copy(this._preXRState.modelRotation),o.updateMatrix(),o.updateMatrixWorld(!0),o.visible=!0;const c=this._viewer.scene.activeCamera;c.position.copy(this._preXRState.cameraPosition),c.target.copy(this._preXRState.cameraTarget),c.cameraObject.up.copy(this._preXRState.cameraUp),c.cameraObject.near=this._preXRState.cameraNear,c.cameraObject.far=this._preXRState.cameraFar,c.cameraObject.userData.autoNearFar=this._preXRState.cameraAutoNearFar,c.cameraObject.isPerspectiveCamera&&(this._preXRState.cameraFov!==void 0&&(c.cameraObject.fov=this._preXRState.cameraFov),this._preXRState.cameraAspect!==void 0&&(c.cameraObject.aspect=this._preXRState.cameraAspect)),c.positionUpdated(!1),c.targetUpdated(!0),c.cameraObject.projectionMatrix.copy(this._preXRState.cameraProjectionMatrix),c.cameraObject.projectionMatrixInverse.copy(this._preXRState.cameraProjectionMatrix).invert(),c.cameraObject.updateMatrixWorld(!0),c.cameraObject.updateProjectionMatrix();const d=this._viewer.getPluginByType("Ground");d!=null&&d.mesh&&(d.mesh.modelObject.position.subVectors(o.position,this._preXRState.groundOffset),d.mesh.modelObject.scale.setScalar(this._preXRState.groundScale),d.mesh.modelObject.rotation.z=this._preXRState.groundRotation,d.renderToDepth=this._preXRState.groundRenderToDepth,d.shadowBaker.enabled=this._preXRState.groundShadowBaker,d.refreshTransform()),this._viewer.scene.setEnvironment(this._preXRState.environment),this._preXRState.environment=void 0,this._viewer.renderFilter.passObject.preserveTransparentTarget=this._preXRState.preserveTransparentTarget}_cancelHitSources(){this._hitTestSource&&(this._hitTestSource.cancel(),this._hitTestSource=void 0),this._touchInputHelper.cancel()}};ARPlugin.PluginType="WEBXR_ARPlugin",ARPlugin_decorate([uiToggle("Light Estimate")],ARPlugin.prototype,"estimateLighting",void 0),ARPlugin_decorate([uiToggle("Place on Wall")],ARPlugin.prototype,"placeOnWall",void 0),ARPlugin_decorate([uiSlider("Resilution scale",[.1,1],.1)],ARPlugin.prototype,"xrResolutionScale",void 0),ARPlugin_decorate([uiButton("Enter AR")],ARPlugin.prototype,"enterAR",void 0),ARPlugin_decorate([uiButton("Exit AR")],ARPlugin.prototype,"exitAR",void 0),ARPlugin=ARPlugin_1=ARPlugin_decorate([uiFolder("WebXR AR")],ARPlugin);const arCopyPass=new ShaderPass2({vertexShader:CopyShader.vertexShader,fragmentShader:`
        ${unpackGbuffer}
        
        uniform float opacity;

		uniform sampler2D tDiffuse;
		uniform sampler2D tTransparentMap;

		varying vec2 vUv;

		void main() {
		
            float depth = getDepth(vUv);
            vec4 texel;
            if(depth>0.9999) {
			    texel = texture2D( tTransparentMap, vUv );
                if(texel.a < 0.01) discard; // background
                // transparent objects with render to depth = false
            }else {
                texel = texture2D( tDiffuse, vUv );
			}
            gl_FragColor = texel;
            
		}
		`,uniforms:{...CopyShader.uniforms,tNormalDepth:{value:null},tTransparentMap:{value:null}}});arCopyPass.renderToScreen=!1,arCopyPass.useExistingRenderTarget=!0,arCopyPass.clear=!1;var VRPluginBasic_decorate=function(h,o,c,d){var _,v=arguments.length,b=v<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(h,o,c,d);else for(var tt=h.length-1;tt>=0;tt--)(_=h[tt])&&(b=(v<3?_(b):v>3?_(o,c,b):_(o,c))||b);return v>3&&b&&Object.defineProperty(o,c,b),b},VRPluginBasic_1;let VRPluginBasic=VRPluginBasic_1=class extends AViewerPlugin{constructor(){super(...arguments),this.enabled=!0,this.dependencies=[GBufferPlugin],this.xrResolutionScale=1,this.toJSON=void 0,this.enterVR=()=>{var h;this.enabled&&this._viewer&&(navigator&&navigator.xr?this._xrSession?console.warn("Already inVR"):this._xrManager?(this._xrManager.enabled=!0,(h=this._xrManager)===null||h===void 0||h.setFramebufferScaleFactor(this.xrResolutionScale),navigator.xr.requestSession("immersive-vr",{optionalFeatures:["local-floor","bounded-floor","hand-tracking","layers"]}).then(this._onSessionStarted)):console.error("XR manager not found"):console.error("XR not supported"))},this.exitVR=()=>{this._xrSession&&this._xrSession.end()},this._currentCameraIndex=0,this._preRender=()=>{var h;if(!(this._dirty&&this._viewer&&this._xrManager&&this._xrSession))return;this._viewer.renderer.defaultRenderToScreen=!1,this._xrManager.enabled=!1;const o=this._xrManager.getCamera(),c=((h=o.cameras)===null||h===void 0?void 0:h[this._currentCameraIndex])||o,d=this._viewer.scene.activeCamera;d.cameraObject.zoom=c.zoom,d.cameraObject.near=c.near,d.cameraObject.far=c.far,d.cameraObject.userData.autoNearFar=!1,d.cameraObject.isPerspectiveCamera?(d.cameraObject.fov=c.fov,d.cameraObject.aspect=c.viewport.width/c.viewport.height):console.warn("Perspective camera required."),d.cameraObject.position.copy(c.position),d.cameraObject.rotation.copy(c.rotation),d.cameraObject.updateMatrix(),d.cameraObject.updateProjectionMatrix(),d.cameraObject.projectionMatrix.copy(c.projectionMatrix),d.cameraObject.projectionMatrixInverse.copy(d.cameraObject.projectionMatrix).invert()},this._currentRt=null,this._postRender=()=>{var h,o,c,d;if(!this._dirty||!this._viewer||!this._xrSession)return;this._viewer.scene.activeCamera.cameraObject.updateProjectionMatrix();const _=this._viewer.renderer,v=(_.rendererObject.getViewport(new three_module.IUQ),(c=(o=(h=this._xrManager)===null||h===void 0?void 0:h.getCamera())===null||o===void 0?void 0:o.cameras)!==null&&c!==void 0?c:[]),b=_.rendererObject.getRenderTarget(),tt=(d=v[this._currentCameraIndex])===null||d===void 0?void 0:d.viewport;tt?b&&_.rendererObject.setViewport(tt):console.warn("no viewport for vr camera index",this._currentCameraIndex),this._viewer.getPlugin(GBufferPlugin).updateShaderProperties(VRPluginBasic_arCopyPass.material),VRPluginBasic_arCopyPass.uniforms.tTransparentMap.value=this._viewer.renderFilter.passObject.transparentTarget.texture,setThreeRendererMode(_.rendererObject,{sceneRender:!0,opaqueRender:!0,shadowMapRender:!1,backgroundRender:!1,transparentRender:!1,transmissionRender:!1,screenSpaceRendering:!1},()=>{VRPluginBasic_arCopyPass.render(_.rendererObject,null,_.composer.readBuffer,0,!1)}),this._xrManager.enabled=!0,this._viewer.renderer.defaultRenderToScreen=!0,b&&_.rendererObject.setViewport(b.viewport),this._currentCameraIndex++,this._currentCameraIndex>=v.length&&(this._currentCameraIndex=0)},this._frameCount=0,this._isPresenting=!1,this._interactionsDisabled=!1,this._preFrame=({xrFrame:h,deltaTime:o})=>{var c,d;if(this.dirty=!!h&&((c=this._xrManager)===null||c===void 0?void 0:c.isPresenting)||!1,(this._dirty||this._interactionsDisabled)&&(this._viewer.scene.activeCamera.setInteractions(!this._dirty,VRPluginBasic_1.PluginType),this._viewer.scene.activeCamera.autoLookAtTarget=!this._dirty,this._interactionsDisabled=this._dirty),!this._dirty||!h)return void(this._isPresenting&&this._xrRenderingEnd());if(!this._xrSession)return console.error("no xr session found, shouldn't happen"),void(this.dirty=!1);this._isPresenting||console.log("webxr: VR session init"),this._frameCount++;const _=this._xrManager.getReferenceSpace(),v=h.getViewerPose(_);if(v==null&&this._frameCount,v==null||((d=this._viewer)===null||d===void 0?void 0:d.scene.modelRoot.children.length)===0)return this.dirty=!1,void console.warn("no pose or no model");this._isPresenting||(this._isPresenting=!0,this._frameCount=0,this._savePreXRState(),this._preSetupModel(),this._xrRenderingBegin());const b=this._viewer.scene.activeCamera;this._xrManager.updateCamera(b.cameraObject),b.setDirty(),this._viewer.rendersPerFrame=v?v.views.length:1,this._updateShadow()},this._preXRState={viewerBg:null,viewerBgColor:void 0,modelScale:new three_module.Pq0(1,1,1),modelPosition:new three_module.Pq0,modelRotation:new three_module.PTz,cameraPosition:new three_module.Pq0(0,0,5),cameraTarget:new three_module.Pq0,cameraUp:new three_module.Pq0(0,1,0),cameraAspect:1,cameraFov:50,cameraZoom:1,cameraNear:.01,cameraFar:100,cameraProjectioMatrix:new three_module.kn4,cameraAutoNearFar:void 0,groundOffset:new three_module.Pq0,groundScale:1,groundRotation:0,groundRenderToDepth:!1,groundShadowBaker:!1,viewport:new three_module.I9Y,environment:void 0,preserveTransparentTarget:!0},this._savePreXRState=()=>{var h;if(!this._viewer)return;this._preXRState.viewport.copy(this._viewer.renderer.renderSize),this._preXRState.viewerBg=this._viewer.scene.background,this._preXRState.viewerBgColor=(h=this._viewer.scene.backgroundColor)===null||h===void 0?void 0:h.getHex();const o=this._viewer.scene.modelRoot,c=this._viewer.scene.activeCamera;o.updateMatrix(),o.updateMatrixWorld(!0),this._preXRState.modelScale.copy(o.scale),this._preXRState.modelPosition.copy(o.position),this._preXRState.modelRotation.copy(o.quaternion),this._preXRState.cameraPosition.copy(c.position),this._preXRState.cameraTarget.copy(c.target),this._preXRState.cameraUp.copy(c.cameraObject.up),c.cameraObject.isPerspectiveCamera&&(this._preXRState.cameraFov=c.cameraObject.fov,this._preXRState.cameraAspect=c.cameraObject.aspect),this._preXRState.cameraZoom=c.cameraObject.zoom,this._preXRState.cameraNear=c.cameraObject.near,this._preXRState.cameraFar=c.cameraObject.far,this._preXRState.cameraAutoNearFar=c.cameraObject.userData.autoNearFar,this._preXRState.cameraProjectioMatrix.copy(c.cameraObject.projectionMatrix);const d=this._viewer.getPluginByType("Ground");d!=null&&d.mesh&&(this._preXRState.groundOffset.subVectors(o.position,d.mesh.modelObject.position),this._preXRState.groundScale=d.mesh.modelObject.scale.x,this._preXRState.groundRotation=d.mesh.modelObject.rotation.z,this._preXRState.groundRenderToDepth=d.renderToDepth,this._preXRState.groundShadowBaker=d.shadowBaker.enabled),this._preXRState.environment||(this._preXRState.environment=this._viewer.scene.environment),this._preXRState.preserveTransparentTarget=this._viewer.renderFilter.passObject.preserveTransparentTarget},this._xrRenderingBegin=()=>{this._xrSession&&this._viewer&&(console.log("webxr: VR session start"),this._viewer.renderer.stableNoise=!0,this._viewer.resize())},this._xrRenderingEnd=()=>{console.log("webxr: VR session end"),this._xrManager&&(this._xrManager.enabled=!1),this._isPresenting=!1,this._frameCount=0,this._xrSession=void 0,this._cancelHitSources(),this._viewer&&(this._viewer.renderer.stableNoise=!1),this._restorePreXRState()},this._onSessionStarted=async h=>{h.addEventListener("end",this._onSessionEnded),this._xrManager.setReferenceSpaceType("local"),await this._xrManager.setSession(h),this._xrSession=h},this._onSessionEnded=()=>{this._xrSession&&this._xrSession.removeEventListener("end",this._onSessionEnded)}}async onAdded(h){await super.onAdded(h);const o=h.renderer.rendererObject.xr;if(o.cameraAutoUpdate=!1,this._xrManager=o,!this.domOverlay){const c=document.getElementById("tweakpaneUiContainer");this.domOverlay=c?{root:c}:void 0}if(h.addEventListener("preRender",this._preRender),h.addEventListener("postRender",this._postRender),h.addEventListener("preFrame",this._preFrame),!window.isSecureContext)return h.console.error("XR not supported in insecure context, try https://"),void(this.enabled=!1);navigator&&"xr"in navigator&&navigator.xr?navigator.xr.isSessionSupported("immersive-vr").then(c=>{if(!c)throw new Error("VR not supported")}).catch(c=>{h.console.error("VR not supported:",c),o.enabled=!1,this.enabled=!1}):(o.enabled=!1,this.enabled=!1)}_updateShadow(){var h,o;if(!this._viewer)return;const c=this._viewer.scene.modelRoot,d=(o=(h=this._viewer.getPluginByType("Ground"))===null||h===void 0?void 0:h.mesh)===null||o===void 0?void 0:o.modelObject;d&&(d.rotation.z=this._viewer.scene.modelRoot.rotation.y,d.position.copy(this._preXRState.groundOffset).multiplyScalar(c.modelObject.scale.x).sub(c.modelObject.position).negate(),d.scale.setScalar(c.modelObject.scale.x*this._preXRState.groundScale))}_preSetupModel(){var h;const o=this._viewer.scene.modelRoot,c=o.userData.arScale||1;o.scale.set(c,c,c),o.visible=!0;const d=(h=this._viewer)===null||h===void 0?void 0:h.getPluginByType("Ground");d!=null&&d.mesh&&(d.shadowBaker.enabled=!1,d.renderToDepth=!1)}_restorePreXRState(){var h;if(!this._viewer)return;this._viewer.renderer.rendererObject.setSize(this._preXRState.viewport.x,this._preXRState.viewport.y),this._viewer.resize(),this._viewer.scene.activeCamera.setInteractions(!0,VRPluginBasic_1.PluginType),this._viewer.scene.activeCamera.autoLookAtTarget=!0,this._viewer.scene.background=this._preXRState.viewerBg,this._preXRState.viewerBgColor!==void 0&&((h=this._viewer.scene.backgroundColor)===null||h===void 0||h.set(this._preXRState.viewerBgColor)),this._preXRState.viewerBg=null;const o=this._viewer.scene.modelRoot;o.scale.copy(this._preXRState.modelScale),o.position.copy(this._preXRState.modelPosition),o.quaternion.copy(this._preXRState.modelRotation),o.updateMatrix(),o.updateMatrixWorld(!0),o.visible=!0;const c=this._viewer.scene.activeCamera;c.position.copy(this._preXRState.cameraPosition),c.target.copy(this._preXRState.cameraTarget),c.cameraObject.up.copy(this._preXRState.cameraUp),c.cameraObject.near=this._preXRState.cameraNear,c.cameraObject.far=this._preXRState.cameraFar,c.cameraObject.userData.autoNearFar=this._preXRState.cameraAutoNearFar,c.cameraObject.isPerspectiveCamera&&(this._preXRState.cameraFov!==void 0&&(c.cameraObject.fov=this._preXRState.cameraFov),this._preXRState.cameraAspect!==void 0&&(c.cameraObject.aspect=this._preXRState.cameraAspect)),c.positionUpdated(!1),c.targetUpdated(!0),c.cameraObject.projectionMatrix.copy(this._preXRState.cameraProjectioMatrix),c.cameraObject.projectionMatrixInverse.copy(this._preXRState.cameraProjectioMatrix).invert(),c.cameraObject.updateMatrixWorld(!0),c.cameraObject.updateProjectionMatrix();const d=this._viewer.getPluginByType("Ground");d!=null&&d.mesh&&(d.mesh.modelObject.position.subVectors(o.position,this._preXRState.groundOffset),d.mesh.modelObject.scale.setScalar(this._preXRState.groundScale),d.mesh.modelObject.rotation.z=this._preXRState.groundRotation,d.renderToDepth=this._preXRState.groundRenderToDepth,d.shadowBaker.enabled=this._preXRState.groundShadowBaker,d.refreshTransform()),this._viewer.scene.environment=this._preXRState.environment,this._preXRState.environment=void 0,this._viewer.renderFilter.passObject.preserveTransparentTarget=this._preXRState.preserveTransparentTarget}_cancelHitSources(){}};VRPluginBasic.PluginType="WEBXR_VRPluginBasic",VRPluginBasic_decorate([uiSlider("Resolution scale",[.1,1],.1)],VRPluginBasic.prototype,"xrResolutionScale",void 0),VRPluginBasic_decorate([uiButton("Enter VR")],VRPluginBasic.prototype,"enterVR",void 0),VRPluginBasic_decorate([uiButton("Exit VR")],VRPluginBasic.prototype,"exitVR",void 0),VRPluginBasic=VRPluginBasic_1=VRPluginBasic_decorate([uiFolder("WebXR VR")],VRPluginBasic);const VRPluginBasic_arCopyPass=new ShaderPass2({vertexShader:CopyShader.vertexShader,fragmentShader:`
        ${unpackGbuffer}
        
        uniform float opacity;

		uniform sampler2D tDiffuse;
		uniform sampler2D tTransparentMap;

		varying vec2 vUv;

		void main() {
		
            float depth = getDepth(vUv);
            vec4 texel;
            if(depth>0.9999) {
			    texel = texture2D( tTransparentMap, vUv );
                if(texel.a < 0.01) discard; // background
                // transparent objects with render to depth = false
            }else {
                texel = texture2D( tDiffuse, vUv );
			}
            gl_FragColor = texel;
            
		}
		`,uniforms:{...CopyShader.uniforms,tNormalDepth:{value:null},tTransparentMap:{value:null}}});VRPluginBasic_arCopyPass.renderToScreen=!1,VRPluginBasic_arCopyPass.useExistingRenderTarget=!0,VRPluginBasic_arCopyPass.clear=!1;class ACanvasRecorder extends I$2{get state(){return this._state}setState(o,c){this._state=o,this.dispatchEvent({type:o,...c})}_setOptions(o){Object.assign(this.options,o)}setOptions(o){this._setOptions(o)}constructor(o,c){super(),this._state="stopped",this._console=console,this._currentRecording=[],this._frameCount=0,this._ondataavailable=d=>{d.data&&d.data.size>0&&this._currentRecording.push(d.data)},this._canvas=o,c==null||c.mimeType,this.options={mimeType:"auto",frameRate:30,stepMode:!1},this._setOptions(c||this.options)}isRecording(){return this._state==="recording"}requestFrame(){return this._state==="recording"&&(this._frameCount++,!0)}dispose(){(this.isRecording()||this._state==="paused")&&this.stop(o=>{this._console.warn("disposed with blob",o),this.dispose()})}}class ImageSequenceRecorder extends ACanvasRecorder{constructor(){super(...arguments),this._currentImages=[],this._onstop=o=>{this._currentImages.length>0&&(this._writeImages([...this._currentImages]),this._currentImages=[]),this.setState("stopped")},this._onerror=o=>{this.setState("error",{error:o}),this._console.error(o)}}start(){if(this.state!=="recording"){if(this.state==="error"&&this._console.warn("Resetting from error state."),this.state==="paused")return this.setState("starting"),void this.setState("recording");this._currentRecording=[],this._currentImages=[],this._frameCount=0,this.setState("starting"),window&&window.showDirectoryPicker&&window.showDirectoryPicker().then(async o=>{const c=await(o==null?void 0:o.getDirectoryHandle("i-"+Math.floor(Date.now()),{create:!0}));this._imgDirectory=c,this._frameCount=0,this.setState("recording")}).catch(o=>{this._onerror({detail:o})})}else this._console.log("Already recording canvas")}requestFrame(){if(!super.requestFrame())return!1;const o=this.options.mimeType;return this._canvas.toBlob(c=>{this._currentImages.push(["frame_"+String(this._frameCount).padStart(5,"0")+(o.includes("png")?".png":".jpg"),c])},o,90),this._currentImages.length>60&&(this._writeImages([...this._currentImages]),this._currentImages=[]),!0}pause(){this.state!=="paused"&&this.state!=="stopped"&&this.setState("paused")}stop(o){this.state!=="stopped"&&(this.state!=="error"?(this._recordingCallback=o,this.setState("stopping"),this._onstop({})):this._console.error("Recorder in error state, cannot stop, call start again."))}async _writeImages(o){if(!this._imgDirectory)return;const c=[];for(const d of o){const _=await this._imgDirectory.getFileHandle(d[0],{create:!0});c.push($e$1(_,d[1]))}await Promise.all(c)}}class CanvasMediaRecorder extends ACanvasRecorder{_setOptions(o){var c,d;super._setOptions(o),this.options.mimeType&&this.options.mimeType!=="auto"||(this.options.mimeType=(c=CanvasMediaRecorder.GetSupportedMimeTypes([],["h264"],!0))!==null&&c!==void 0?c:CanvasMediaRecorder.GetSupportedMimeTypes(void 0,void 0,!0)),this.options.mimeType&&!(!((d=this.options.mimeType)===null||d===void 0)&&d.startsWith("video/"))||window.MediaRecorder||(this._console.warn("MediaRecorder is not supported, switching to png"),this.options.mimeType="image/png"),this.options.mimeType||console.warn(new Error("No supported mimetype found"))}setOptions(o){this._setOptions(o)}constructor(o,c){super(o,c),this._resumeSyncTime=0,this._onstop=d=>{var _;if(this._recorder&&this._currentRecording.length>0){const v=new Blob(this._currentRecording,{type:this.options.mimeType});(_=this._recordingCallback)===null||_===void 0||_.call(this,v)}this._recorder=void 0,this.setState("stopped")},this._onstart=d=>{var _;this._frameCount=0,this.options.stepMode&&((_=this._recorder)===null||_===void 0||_.pause()),this.setState("recording")},this._onresume=d=>{if(this.state!=="paused"&&this.state!=="starting"&&this.state!=="stopped"||this.setState("recording"),!this.options.stepMode)return;const _=()=>{var b;this.state==="recording"&&((b=this._recorder)===null||b===void 0||b.pause())},v=Math.min(this._resumeSyncTime-g(),0)+1e3/this.options.frameRate;v>0?X$2(v).then(_):_()},this._onerror=d=>{this.setState("error",{error:d}),this._console.error(d),this._recorder=void 0}}start(){var o,c,d;if(this.state==="recording")return void this._console.log("Already recording canvas");if(this.state==="error"&&(this._recorder=void 0,this._console.warn("Resetting from error state.")),this._recorder)return this.state==="paused"?(this.setState("starting"),void this._recorder.resume()):void this._console.warn("Canvas recorder unknown state",this.state);const _={mimeType:this.options.mimeType,videoBitsPerSecond:this.options.videoBitsPerSecond};if(this._currentRecording=[],this._frameCount=0,(o=_.mimeType)===null||o===void 0?void 0:o.startsWith("video")){if(!window.MediaRecorder)return this._console.error("MediaRecorder not supported, use image sequence"),void this.setState("error",{error:new Error("MediaRecorder not supported")});{const v=this._canvas.captureStream(this.options.stepMode?0:this.options.frameRate),b=(c=v.getVideoTracks())===null||c===void 0?void 0:c[0];this._track=b,this._recorder=new window.MediaRecorder(v,_),this._recorder.onstop=this._onstop,this._recorder.ondataavailable=this._ondataavailable,this._recorder.onerror=this._onerror,this._recorder.onresume=this._onresume,this._recorder.onstart=this._onstart}}this.setState("starting"),this._recorder&&((d=this._recorder)===null||d===void 0||d.start())}requestFrame(){return!(!this._recorder||!super.requestFrame()||this._track&&this.options.stepMode&&(this._resumeSyncTime=g(),this._track.requestFrame(),this._recorder.resume(),0))}pause(){this.state!=="paused"&&this.state!=="stopped"&&(this.options.stepMode?console.error("Pause not supported in stepMode"):this._recorder&&(this._recorder.pause(),this.setState("paused")))}stop(o){this.state!=="stopped"&&(this.state!=="error"?(this._recordingCallback=o,this.setState("stopping"),this._recorder&&this._recorder.stop()):this._console.error("Recorder in error state, cannot stop, call start again."))}dispose(){this._recorder&&(super.dispose(),this._recorder=void 0)}static GetSupportedMimeTypes(o,c,d=!1){if(!window.MediaRecorder)return d?void 0:[];const _=["webm","ogg","mp4","x-matroska"].filter(tt=>!o||o.length<1||o.includes(tt)),v=["vp9","vp9.0","vp8","vp8.0","avc1","av1","h265","h.265","h264","h.264","opus"].filter(tt=>!c||c.length<1||c.includes(tt)),b=[];return _.forEach(tt=>{const it=`video/${tt}`;v.forEach(nt=>{[`${it};codecs=${nt}`,`${it};codecs:${nt}`,`${it};codecs=${nt.toUpperCase()}`,`${it};codecs:${nt.toUpperCase()}`,`${it}`].forEach(lt=>{MediaRecorder.isTypeSupported(lt)&&b.push(lt)})})}),d?b.length>0?b[0]:void 0:b}}class FFMPEGRecorder extends ACanvasRecorder{constructor(o,c){super(o,c),this._workerRunning=!1,this.ffmpegOptions={imageType:"jpeg",bitrate:"10M",crf:17,pixFmt:"yuv420p",preset:"ultrafast",colorTrc:"bt709",colorSpace:"bt709"},this.worker=new Worker(ct(FFMPEGRecorder.LIBRARY_PATH+"ffmpeg-worker-mp4.js",FFMPEGRecorder.LIBRARY_PATH+"ffmpeg-worker-mp4.wasm")),this.worker.onmessage=d=>{var _;const v=d.data;switch(v.type){case"stdout":case"stderr":if(v.data.indexOf("frame=")===0){const b=parseInt(v.data.split("frame=")[1].split("fps")[0].trim()),tt=this._frameCount,it=Math.round(b/tt*100);this.dispatchEvent({type:"encode-progress",progress:it,frame:b,totalFrames:tt})}console.log(v.data+`
`);break;case"exit":console.log("Process exited with code "+v.data),parseInt(v.data);break;case"done":if(v.data.MEMFS[0].data===void 0)return void console.log("video processing failed");this._workerRunning=!1,(_=this._recordingCallback)===null||_===void 0||_.call(this,new Blob([v.data.MEMFS[0].data],{type:"video/mp4"})),console.timeEnd("ffmpeg-record"),this.setState("stopped")}}}start(){this.state!=="recording"?(this.state==="error"&&console.warn("Resetting from error state."),this.state!=="paused"&&(this._frameCount=0),this.setState("starting"),this.setState("recording")):console.log("Already recording canvas")}stop(o){this.state!=="stopped"&&(this.state!=="error"?(this._recordingCallback=o,this.setState("stopping"),this._lastCanvasCapturePromise?this._lastCanvasCapturePromise.then(()=>this._onStop()):this._onStop()):console.error("FFMPEGRecorder: Recorder in error state, cannot stop, call start again."))}_onStop(){var o,c,d,_;const v=this._canvas.width%2==0?this._canvas.width:this._canvas.width-1;this._workerRunning=!0,console.time("ffmpeg-record");const b=this.options.frameRate.toString(),tt=this.options.frameRate.toString(),it=["-r",b,"-an","-i",`img%06d.${this._mime}`,"-frames:v",this._frameCount.toString(),"-c:v","libx264","-crf",Math.min(28,Math.max(1,(o=this.ffmpegOptions.crf)!==null&&o!==void 0?o:17)).toString(),"-filter:v",`scale=${v}:-2`,"-pix_fmt",(c=this.ffmpegOptions.pixFmt)!==null&&c!==void 0?c:"yuv420p","-b:v",(d=this.ffmpegOptions.bitrate)!==null&&d!==void 0?d:"10M","-preset",(_=this.ffmpegOptions.preset)!==null&&_!==void 0?_:"ultrafast","-r",tt];this.ffmpegOptions.colorSpace&&it.push("-colorspace",this.ffmpegOptions.colorSpace),this.ffmpegOptions.colorTrc&&it.push("-color_trc",this.ffmpegOptions.colorTrc),it.push("out.mp4"),console.log(it),this.worker.postMessage({type:"run",arguments:it})}requestFrame(){return!!super.requestFrame()&&(this.sendBlobToWorker(this._frameCount-1),!0)}get _mime(){var o;let c=(o=this.ffmpegOptions.imageType)!==null&&o!==void 0?o:"jpeg";return c&&["png","jpeg","webp"].includes(c)||(console.warn("FFMPEGRecorder: Unsupported mime type",this.ffmpegOptions.imageType),c="jpeg"),c}sendBlobToWorker(o){this._lastCanvasCapturePromise&&console.warn("FFMPEGRecorder: Previous frame capture not complete",o-1);const c=this._mime;this._lastCanvasCapturePromise=new Promise(d=>{this._canvas.toBlob(_=>{this.worker.postMessage({type:"image",file:{name:`img${o.toString().padStart(6,"0")}.${c}`,data:_}}),this._lastCanvasCapturePromise=void 0,d()},`image/${c}`,90)})}pad(o,c){return(o+="").length>=c?o:new Array(c-o.length+1).join("0")+o}pause(){this.state!=="paused"&&this.state!=="stopped"&&this.setState("paused")}setOptions(o){super.setOptions(o)}}FFMPEGRecorder.LIBRARY_PATH="https://cdn.jsdelivr.net/npm/@repalash/ffmpeg.js@4.2.9005/dist/";var CanvasRecorderPlugin_decorate=function(h,o,c,d){var _,v=arguments.length,b=v<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(h,o,c,d);else for(var tt=h.length-1;tt>=0;tt--)(_=h[tt])&&(b=(v<3?_(b):v>3?_(o,c,b):_(o,c))||b);return v>3&&b&&Object.defineProperty(o,c,b),b};class CanvasRecorderPlugin extends AViewerPlugin{get recorder(){return this._recorder}constructor(){super(),this.enabled=!0,this.convergeMode=!0,this.mimeType="video/mp4",this.videoFrameRate=30,this._recorders={},this._renderToScreenDisabled=!1,this._preRender=()=>{var o,c,d;if(this.convergeMode&&!((o=this._recorder)===null||o===void 0)&&o.isRecording()){const _=this._viewer.renderer.composer.renderToScreen;this._viewer.renderer.composer.renderToScreen=((d=(c=this._viewer)===null||c===void 0?void 0:c.getPluginByType("Progressive"))===null||d===void 0?void 0:d.isConverged())||!1,_&&!this._viewer.renderer.composer.renderToScreen&&(this._renderToScreenDisabled=!0)}},this._postRender=()=>{var o,c,d;if(!((o=this._recorder)===null||o===void 0)&&o.isRecording()&&(!this.convergeMode||!((d=(c=this._viewer)===null||c===void 0?void 0:c.getPluginByType("Progressive"))===null||d===void 0)&&d.isConverged(!0))){const _=()=>{var v;return(v=this._recorder)===null||v===void 0?void 0:v.requestFrame()};this.convergeMode?X$2(1).then(_):_()}this._renderToScreenDisabled&&(this._viewer.renderer.composer.renderToScreen=!0)},this._refreshUi=()=>{var o;(o=this.uiConfig.children)===null||o===void 0||o.map(c=>Ee$1(c)).flat(2).forEach(c=>{var d;return(d=c==null?void 0:c.uiRefresh)===null||d===void 0?void 0:d.call(c)})},this.endPaddingMs=500,this._turntableAnimationAngle=360,this._turntableAnimationDuration=5,this._turntableAnimationEasing="linear",this.uiConfig={type:"folder",label:"Video Export",children:[{type:"slider",label:"Frame Rate",bounds:[1,60],stepSize:1,property:[this,"videoFrameRate"]},{type:"checkbox",property:[this,"convergeMode"],onChange:()=>{var o,c;return(c=(o=this.uiConfig).uiRefresh)===null||c===void 0?void 0:c.call(o,"postFrame",!0)}},{type:"dropdown",label:"Mime type",property:[this,"mimeType"],children:[["Auto Video (x264)","auto"],["PNG sequence","image/png"],["JPEG sequence","image/jpeg"],["WEBP sequence","image/webp"],["MP4 Video (ffmpeg)","video/mp4"]].map(o=>({label:o[0],value:o[1]}))},generateUiFolder("FFmpeg Options (Advanced)",()=>this._recorder.ffmpegOptions,{},"folder",!0),{type:"input",disabled:!0,label:"State",getValue:()=>{var o,c;return(c=(o=this.recorder)===null||o===void 0?void 0:o.state)!==null&&c!==void 0?c:"not initialized"}},{type:"button",label:()=>this.isRecording()?"Stop Recording":"Start Recording",hidden:()=>!this.isRecording()&&this.convergeMode,value:()=>{this.isRecording()?this.stopRecording().then(async o=>{if(o){const c=o.type.split(";")[0].split("/").pop()||"mp4";await this._downloadBlob(o,c)}}):this.startRecording()}},{type:"button",label:"Record Camera Views",hidden:()=>{var o;return this.isRecording()||!(!((o=this._viewer)===null||o===void 0)&&o.getPluginByType("CameraViews"))},value:()=>{var o,c;(c=(o=this._viewer)===null||o===void 0?void 0:o.getPluginByType("CameraViews"))===null||c===void 0||c.recordAllViews()}},{type:"button",label:"Record Camera Views + GLTF Anim",hidden:()=>{var o,c,d;return this.isRecording()||!(!((o=this._viewer)===null||o===void 0)&&o.getPluginByType("CameraViews"))||!(!((d=(c=this._viewer)===null||c===void 0?void 0:c.getPluginByType("GLTFAnimation"))===null||d===void 0)&&d.animations.length)},value:()=>{var o,c,d,_;const v=((c=(o=this._viewer)===null||o===void 0?void 0:o.getPluginByType("GLTFAnimation"))===null||c===void 0?void 0:c.animationState)==="playing";(_=(d=this._viewer)===null||d===void 0?void 0:d.getPluginByType("CameraViews"))===null||_===void 0||_.recordAllViews(()=>{var b,tt;(tt=(b=this._viewer)===null||b===void 0?void 0:b.getPluginByType("GLTFAnimation"))===null||tt===void 0||tt.playAnimation()}).then(()=>{var b,tt;v||(tt=(b=this._viewer)===null||b===void 0?void 0:b.getPluginByType("GLTFAnimation"))===null||tt===void 0||tt.stopAnimation()})}},{type:"button",label:"Record GLTF Anim",hidden:()=>{var o,c;return this.isRecording()||!(!((c=(o=this._viewer)===null||o===void 0?void 0:o.getPluginByType("GLTFAnimation"))===null||c===void 0)&&c.animations.length)},value:async()=>{var o;if(this.isRecording())return;const c=(o=this._viewer)===null||o===void 0?void 0:o.getPluginByType("GLTFAnimation");if(!c)return;let d=!1;c.loopAnimations&&(d=!0),d&&(c.loopAnimations=!1);const _=await this.record(async()=>c.playAnimation());if(d&&(c.loopAnimations=!0),_){const v=_.type.split(";")[0].split("/").pop()||"mp4";await this._downloadBlob(_,v)}}},{type:"number",label:"Turntable animation angle",disabled:()=>this.isRecording(),property:[this,"_turntableAnimationAngle"]},{type:"number",label:"Turntable animation time (sec)",disabled:()=>this.isRecording(),property:[this,"_turntableAnimationDuration"]},{type:"dropdown",label:"Turntable animation ease",children:Object.keys(EasingFunctions).map(o=>({label:o})),disabled:()=>this.isRecording(),property:[this,"_turntableAnimationEasing"]},{type:"button",label:"Record turntable animation",hidden:()=>this.isRecording(),value:async()=>this.download360Recording(this._turntableAnimationDuration,!1,this._turntableAnimationAngle,EasingFunctions[this._turntableAnimationEasing])},{type:"button",label:"Record turntable animation (CCW)",hidden:()=>this.isRecording(),value:async()=>this.download360Recording(this._turntableAnimationDuration,!0,this._turntableAnimationAngle,EasingFunctions[this._turntableAnimationEasing])},{type:"number",label:"After recording wait time (ms)",disabled:()=>this.isRecording(),property:[this,"endPaddingMs"]}]},this.refreshRecorderOptions=this.refreshRecorderOptions.bind(this)}isRecording(){var o,c;return(c=(o=this._recorder)===null||o===void 0?void 0:o.isRecording())!==null&&c!==void 0&&c}refreshRecorderOptions(){var o,c;if(!this._viewer)return;let d="image";this.mimeType==="video/mp4"?d="ffmpeg.js":this.mimeType==="auto"?d="canvas-media":this.mimeType.startsWith("image")&&(d="image"),this._recorder=this._getRecorder(d),this._recorder&&(this._recorder.setOptions({frameRate:this.videoFrameRate,mimeType:this.mimeType,stepMode:this.convergeMode,internalMimeType:this.internalMimeType}),(c=(o=this.uiConfig).uiRefresh)===null||c===void 0||c.call(o,"postFrame",!0))}async onAdded(o){var c;await super.onAdded(o),o.addEventListener("preRender",this._preRender),o.addEventListener("postRender",this._postRender),o.scene.addEventListener("addSceneObject",this._refreshUi),this._recordIndicator=document.createElement("div"),this._recordIndicator.style.width="20px",this._recordIndicator.style.height="20px",this._recordIndicator.style.backgroundColor="red",this._recordIndicator.style.top="10px",this._recordIndicator.style.left="10px",this._recordIndicator.style.position="absolute",this._recordIndicator.style.borderRadius="100%",this._recordIndicator.style.visibility="hidden",(c=o.canvas.parentElement)===null||c===void 0||c.appendChild(this._recordIndicator),this.refreshRecorderOptions()}_stateChange(o){var c,d;this.dirty=o,(c=this._viewer)===null||c===void 0||c.setDirty(),(d=this.uiConfig.children)===null||d===void 0||d.map(_=>Ee$1(_)).flat(2).forEach(_=>{var v;return(v=_==null?void 0:_.uiRefresh)===null||v===void 0?void 0:v.call(_)})}async onRemove(o){var c;return o.removeEventListener("preRender",this._preRender),o.removeEventListener("preRender",this._postRender),o.scene.removeEventListener("addSceneObject",this._refreshUi),(c=this._recorder)===null||c===void 0||c.dispose(),Object.values(this._recorders).forEach(d=>{d==null||d.dispose()}),super.onRemove(o)}async record(o,c){var d,_;if(!this.enabled||!((d=this._recorder)===null||d===void 0)&&d.isRecording())return;const v=(_=this._viewer)===null||_===void 0?void 0:_.getPluginByType("Progressive"),b=v==null?void 0:v.maxFrameCount;v&&this.convergeMode&&(v.maxFrameCount=Math.min(16,b??16)),await new Promise((it,nt)=>{const lt=()=>{this.removeEventListener("start",ut),this.removeEventListener("stop",lt),this.removeEventListener("error",ht)},ut=async()=>{lt(),c==null||c(),await o(),it()},ht=async()=>{lt(),nt()};this.addEventListener("start",ut),this.addEventListener("stop",lt),this.addEventListener("error",ht),this.startRecording()});const tt=await this.stopRecording();return v&&this.convergeMode&&(v.maxFrameCount=b??16),tt}startRecording(){var o;return!!this.enabled&&((o=this.recorder)===null||o===void 0?void 0:o.isRecording())===!1&&(this.recorder.options.stepMode=this.convergeMode,this.recorder.start(),!0)}async stopRecording(){var o,c;if(!((o=this.recorder)===null||o===void 0)&&o.isRecording()&&this._viewer){if(await this._viewer.doOnce("postFrame"),this.convergeMode){const d=(c=this._viewer)===null||c===void 0?void 0:c.getPluginByType("Progressive");if(d)for(let _=0;_<10&&!d.isConverged(!0);_++)await this._viewer.doOnce("postFrame")}return this.endPaddingMs&&await X$2(this.endPaddingMs),new Promise((d,_)=>{var v;return(v=this.recorder)===null||v===void 0?void 0:v.stop(d)})}}async _downloadBlob(o,c){var d,_,v;const b=await((d=this._viewer)===null||d===void 0?void 0:d.prompt("Canvas Recorder: Save file as","recording.mp4",!1)),tt=(_=this._viewer)===null||_===void 0?void 0:_.getPluginByType("FileTransferPlugin");tt?await tt.exportFile(o,b||"recording.mp4"):(v=this._viewer)===null||v===void 0||v.console.error("FileTransferPlugin required to export/download file")}async download360Recording(o=null,c=!1,d=360,_){var v;if(!((v=this.recorder)===null||v===void 0)&&v.isRecording()||!this._viewer)return;const b=o||await this._viewer.prompt("Enter duration in seconds","5",!0);if(b===null)return;const tt=parseFloat(b||"5");if(!isFinite(tt)||tt<=0)return;const it=await this.recordCamera360(tt,c,d,_);if(it){const nt=it.type.split(";")[0].split("/").pop()||"mp4";await this._downloadBlob(it,nt)}}async recordCamera360(o,c=!1,d=360,_){var v;if(!((v=this.recorder)===null||v===void 0)&&v.isRecording()||!this._viewer)return;const b=this._viewer.scene.activeCamera;let tt=b.interactionsEnabled,it=0;for(;!(tt||(this._viewer.setDirty(),await this._viewer.doOnce("postFrame"),it%30==0&&this._viewer.console.warn("CanvasRecorderPlugin: interactions are already disabled by something, waiting..."),tt=b.interactionsEnabled,it>5e3/30));)it++;b.setInteractions(!1,CanvasRecorderPlugin.PluginType);const nt=b.target.clone(),lt=b.position.clone().sub(nt),ut=await this._viewer.getPluginByType("PopmotionPlugin");if(!ut)return void console.error("Popmotion plugin not found");const ht=new three_module.YHV().setFromVector3(lt);b.position.setFromSpherical(ht).add(nt),b.positionUpdated(!0);const _t=b.autoLookAtTarget;b.autoLookAtTarget=!0;const ft=ht.theta,bt=await this.record(async()=>ut.animate({from:ft,to:ft+(c?-1:1)*d*Math.PI/180,duration:1e3*o,ease:_??EasingFunctions.linear,onUpdate:xt=>{ht.theta=xt,b.position.setFromSpherical(ht).add(nt),b.positionUpdated(!0)},onComplete:async()=>{ht.theta=ft,b.position.setFromSpherical(ht).add(nt),b.positionUpdated(!0)}}).promise);return b.autoLookAtTarget=_t,b.position.copy(lt).add(nt),b.positionUpdated(!0),b.setInteractions(!0,CanvasRecorderPlugin.PluginType),bt}_getRecorder(o){if(!this._viewer)throw new Error("No viewer");if(this._recorders[o])return this._recorders[o];let c;return c=o==="canvas-media"?new CanvasMediaRecorder(this._viewer.canvas,{frameRate:this.videoFrameRate,mimeType:this.mimeType}):o==="ffmpeg.js"?new FFMPEGRecorder(this._viewer.canvas,{frameRate:this.videoFrameRate,mimeType:this.mimeType}):new ImageSequenceRecorder(this._viewer.canvas,{frameRate:this.videoFrameRate,mimeType:this.mimeType}),c.addEventListener("starting",()=>this._stateChange(!1)),c.addEventListener("recording",()=>{this._recordIndicator.style.visibility="visible",this._recordIndicator.style.backgroundColor="red",this.dispatchEvent({type:"start"}),this._stateChange(!this.convergeMode)}),c.addEventListener("error",()=>{this.dispatchEvent({type:"error"})}),c.addEventListener("paused",()=>this._stateChange(!1)),c.addEventListener("stopped",()=>{this._recordIndicator.style.visibility="hidden",this.dispatchEvent({type:"stop"}),this._stateChange(!1)}),c.addEventListener("encode-progress",d=>{this.dispatchEvent({...d})}),this._recorders[o]=c,c}}function isSafari(){return navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}CanvasRecorderPlugin.PluginType="CanvasRecorder",CanvasRecorderPlugin_decorate([x$1(CanvasRecorderPlugin.prototype.refreshRecorderOptions),serialize()],CanvasRecorderPlugin.prototype,"convergeMode",void 0),CanvasRecorderPlugin_decorate([x$1(CanvasRecorderPlugin.prototype.refreshRecorderOptions),serialize()],CanvasRecorderPlugin.prototype,"mimeType",void 0),CanvasRecorderPlugin_decorate([x$1(CanvasRecorderPlugin.prototype.refreshRecorderOptions),serialize()],CanvasRecorderPlugin.prototype,"videoFrameRate",void 0),CanvasRecorderPlugin_decorate([uiSlider("End padding (MS)",[0,1e3],1)],CanvasRecorderPlugin.prototype,"endPaddingMs",void 0);class CanvasSnipper{static async GetClonedCanvas(o,{rect:c={x:0,y:0,width:o.width,height:o.height,assumeClientRect:!1,normalized:!1},displayPixelRatio:d=1,scale:_=1}){var v,b,tt;c={...c};const it=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");c.normalized?(c.x=Math.floor(c.x*o.width),c.y=Math.floor(c.y*o.height),c.width=Math.floor(c.width*o.width),c.height=Math.floor(c.height*o.height),c.assumeClientRect&&console.warn("CanvasSnipper: rect.assumeClientRect is ignored when rect is normalized")):c.assumeClientRect&&(c.x=Math.floor(c.x*o.width/(d*o.clientWidth)),c.y=Math.floor(c.y*o.height/(d*o.clientHeight)),c.width=Math.floor(c.width*o.width/(d*o.clientWidth)),c.height=Math.floor(c.height*o.height/(d*o.clientHeight))),it.width=Math.floor(c.width*_*d),it.height=Math.floor(c.height*_*d);const nt=it.getContext("2d");if(!nt)return console.error("snapshot: cannot create context"),it;const lt=o.style.background||((v=o.parentElement)===null||v===void 0?void 0:v.style.background)||"";if(lt.includes("url")){const ut=(b=/url\("(.*)"\)/gi.exec(lt))===null||b===void 0?void 0:b[1];if(ut){const ht=new Image;ht.src=ut,await new Promise((_t,ft)=>{ht.onload=()=>_t(),ht.onerror=()=>ft(),ht.complete&&_t()}),nt.drawImage(ht,Math.floor(ht.width*c.x*d/o.width),Math.floor(ht.height*c.y*d/o.height),Math.floor(ht.width*c.width*d/o.width),Math.floor(ht.height*c.height*d/o.height),0,0,it.width,it.height)}}else nt.fillStyle=o.style.background||((tt=o.parentElement)===null||tt===void 0?void 0:tt.style.backgroundColor)||"#00000000",nt.fillRect(0,0,it.width,it.height);return nt==null||nt.drawImage(o,Math.floor(c.x*d),Math.floor(c.y*d),Math.floor(c.width*d),Math.floor(c.height*d),0,0,it.width,it.height),this.Debug&&(document.body.appendChild(it),it.style.position="absolute",it.style.top="0",it.style.left="0",it.style.borderWidth="2px",it.style.borderColor="#ff00ff",setTimeout(()=>it.remove(),5e3)),it}static async GetDataUrl(o,{mimeType:c="image/png",...d}){const _=isSafari()||d.cloneCanvas||d.rect||d.scale||d.displayPixelRatio;!_&&(d.rect||d.scale||d.displayPixelRatio)&&console.warn("rect, scale and displayPixelRatio are ignored when cloneCanvas is false");const v=_?await this.GetClonedCanvas(o,d):o,b=v.toDataURL(c);return this.Debug||v===o||v.remove(),b}static async GetImage(o,{mimeType:c="image/png",...d}={}){const _=await this.GetDataUrl(o,d);return new Promise((v,b)=>{const tt=new Image;tt.onload=()=>{v(tt)},tt.src=_})}static async GetBlob(o,c={}){const d=isSafari()||c.cloneCanvas||c.rect||c.scale||c.displayPixelRatio;!d&&(c.rect||c.scale||c.displayPixelRatio)&&console.warn("rect, scale and displayPixelRatio are ignored when cloneCanvas is false");const _=d?await this.GetClonedCanvas(o,c):o,v=await new Promise((b,tt)=>{var it;_.toBlob(nt=>{nt?b(nt):tt("Unable to export")},(it=c.mimeType)!==null&&it!==void 0?it:"image/png")});return this.Debug||_===o||_.remove(),v}static async GetFile(o,c="image",d={}){var _,v,b;const tt=c+"."+((v=(_=d.mimeType)===null||_===void 0?void 0:_.split("/")[1])!==null&&v!==void 0?v:"png");return d.getDataUrl?await this.GetDataUrl(o,d):new File([await this.GetBlob(o,d)],tt,{type:(b=d.mimeType)!==null&&b!==void 0?b:"image/png",lastModified:g()})}static async GetTiledFiles(o,c="image",d=2,_=2,v={}){var b,tt,it;const nt=(b=v.rect)!==null&&b!==void 0?b:{x:0,y:0,width:1,height:1,assumeClientRect:!1,normalized:!0},lt=[];for(let ut=0;ut<_;ut++)for(let ht=0;ht<d;ht++){const _t=(it=(tt=v.mimeType)===null||tt===void 0?void 0:tt.split("/")[1])!==null&&it!==void 0?it:"png",ft=await this.GetFile(o,`${c}_${ut}_${ht}.${_t}`,{rect:{x:nt.x+ut*nt.width/_,y:nt.y+ht*nt.height/d,width:nt.width/_,height:nt.height/d,assumeClientRect:nt.assumeClientRect,normalized:nt.normalized}}).catch(bt=>(console.error(`Error exporting file ${ut}, ${ht}`,bt),null));ft&&lt.push(ft)}return lt}}CanvasSnipper.Debug=!1;var CanvasSnipperPlugin_decorate=function(h,o,c,d){var _,v=arguments.length,b=v<3?o:d===null?d=Object.getOwnPropertyDescriptor(o,c):d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(h,o,c,d);else for(var tt=h.length-1;tt>=0;tt--)(_=h[tt])&&(b=(v<3?_(b):v>3?_(o,c,b):_(o,c))||b);return v>3&&b&&Object.defineProperty(o,c,b),b},CanvasSnipperPlugin_1;let CanvasSnipperPlugin=CanvasSnipperPlugin_1=class extends AViewerPlugin{constructor(){super(),this.enabled=!0,this.filename="snapshot",this.progressiveFrames=64,this.tileRows=1,this.tileColumns=1,this.rect=new three_module.IUQ(0,0,1,1),this._downloading=!1,this.downloadSnapshot=this.downloadSnapshot.bind(this)}async getFile(h,o={waitForProgressive:!0}){var c;return await((c=this.viewer)===null||c===void 0?void 0:c.doOnce("postFrame")),await this._getFile(h||this.filename,{...o,getDataUrl:!1})}async getDataUrl(h={}){var o,c;return await((o=this.viewer)===null||o===void 0?void 0:o.doOnce("postFrame")),(c=await this._getFile("",{...h,getDataUrl:!0}))!==null&&c!==void 0?c:""}async _getFile(h,o={}){var c,d,_,v,b,tt,it,nt,lt,ut,ht,_t;const ft=(c=this._viewer)===null||c===void 0?void 0:c.canvas;if(ft){(d=this.viewer)===null||d===void 0||d.scene.activeCamera.setInteractions(!1,CanvasSnipperPlugin_1.PluginType);const bt=this._viewer.renderer.displayCanvasScaling;o.displayPixelRatio!==void 0&&o.displayPixelRatio!==bt&&(this._viewer.renderer.displayCanvasScaling=o.displayPixelRatio);const xt=(_=this._viewer)===null||_===void 0?void 0:_.getPlugin(ProgressivePlugin);let St=(v=o.waitForProgressive)!==null&&v!==void 0?v:!!xt;St&&!xt&&(console.warn("CanvasSnipperPlugin: ProgressivePlugin required to wait for progressive rendering"),St=!1),o.progressiveFrames&&!St&&console.warn("CanvasSnipperPlugin: waitForProgressive must be true to use progressiveFrames");const wt=xt==null?void 0:xt.maxFrameCount;if(St&&xt)for(xt.maxFrameCount=Math.max((b=o.progressiveFrames)!==null&&b!==void 0?b:64,xt.maxFrameCount),(tt=this.viewer)===null||tt===void 0||tt.setDirty(),await((it=this.viewer)===null||it===void 0?void 0:it.doOnce("postFrame"));!xt.isConverged(!0);)await((nt=this.viewer)===null||nt===void 0?void 0:nt.doOnce("postFrame"));let Pt;if(!o.timeout&&St||((lt=this.viewer)===null||lt===void 0||lt.setDirty(),await((ut=this.viewer)===null||ut===void 0?void 0:ut.doOnce("postFrame")),await X$2((ht=o.timeout)!==null&&ht!==void 0?ht:200)),o.displayPixelRatio=1,o.tileRows&&o.tileRows>1||o.tileColumns&&o.tileColumns>1){const Rt=await CanvasSnipper.GetTiledFiles(ft,h,Math.max(1,o.tileRows||1),Math.max(1,o.tileColumns||1),o);if(Array.isArray(Rt))if(Rt.length===1)Pt=Rt[0];else if(Rt.length===0)Pt=void 0;else if(o.getDataUrl)Pt=Rt;else{const kt={};for(const Dt of Rt)kt[Dt.name]=new Uint8Array(await Dt.arrayBuffer());const Gt=zipSync(kt);Pt=new File([Gt],h+".zip",{type:"application/zip",lastModified:Date.now()})}else Pt=Rt}else Pt=await CanvasSnipper.GetFile(ft,h,o);return o.displayPixelRatio=this._viewer.renderer.displayCanvasScaling,this._viewer.renderer.displayCanvasScaling=bt,xt&&wt!==void 0&&(xt.maxFrameCount=wt),(_t=this.viewer)===null||_t===void 0||_t.scene.activeCamera.setInteractions(!0,CanvasSnipperPlugin_1.PluginType),Pt}}async downloadSnapshot(h,o){for(;this._downloading;)console.warn("CanvasSnipperPlugin: Another rendering already in progress, waiting..."),await X$2(200);this._downloading=!0;const c=await this.getFile(h,{progressiveFrames:this.progressiveFrames,waitForProgressive:!0,tileRows:this.tileRows,tileColumns:this.tileColumns,rect:{x:this.rect.x,y:this.rect.y,width:this.rect.z,height:this.rect.w,normalized:!0,assumeClientRect:!1},...o}).catch(d=>{var _;return(_=this._viewer)===null||_===void 0||_.console.error("Error exporting file",d),null});c&&await this._downloadBlob(c,c.name),this._downloading=!1}async _downloadJpeg(){return this.downloadSnapshot(void 0,{mimeType:"image/jpeg"})}async _downloadWebp(){return this.downloadSnapshot(void 0,{mimeType:"image/webp"})}async _downloadBlob(h,o){var c,d;const _=(c=this._viewer)===null||c===void 0?void 0:c.getPluginByType("FileTransferPlugin");_?await _.exportFile(h,o):(d=this._viewer)===null||d===void 0||d.console.error("FileTransferPlugin required to export/download file")}};CanvasSnipperPlugin.PluginType="CanvasSnipper",CanvasSnipperPlugin_decorate([uiInput("Filename"),serialize()],CanvasSnipperPlugin.prototype,"filename",void 0),CanvasSnipperPlugin_decorate([uiInput("Frame Count"),serialize()],CanvasSnipperPlugin.prototype,"progressiveFrames",void 0),CanvasSnipperPlugin_decorate([uiInput("Tile Rows"),serialize()],CanvasSnipperPlugin.prototype,"tileRows",void 0),CanvasSnipperPlugin_decorate([uiInput("Tile Columns"),serialize()],CanvasSnipperPlugin.prototype,"tileColumns",void 0),CanvasSnipperPlugin_decorate([uiVector("Crop Rect (x, y, w, h)",[0,1],.001),serialize()],CanvasSnipperPlugin.prototype,"rect",void 0),CanvasSnipperPlugin_decorate([uiButton("Download .png",{limitedUi:!0})],CanvasSnipperPlugin.prototype,"downloadSnapshot",null),CanvasSnipperPlugin_decorate([uiButton("Download .jpeg")],CanvasSnipperPlugin.prototype,"_downloadJpeg",null),CanvasSnipperPlugin_decorate([uiButton("Download .webp")],CanvasSnipperPlugin.prototype,"_downloadWebp",null),CanvasSnipperPlugin=CanvasSnipperPlugin_1=CanvasSnipperPlugin_decorate([uiFolder("Image Export")],CanvasSnipperPlugin);const HorizontalBlurShader={name:"HorizontalBlurShader",uniforms:{tDiffuse:{value:null},h:{value:1/512}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;
		uniform float h;

		varying vec2 vUv;

		void main() {

			vec4 sum = vec4( 0.0 );

			sum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * h, vUv.y ) ) * 0.051;
			sum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * h, vUv.y ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * h, vUv.y ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * h, vUv.y ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;
			sum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * h, vUv.y ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * h, vUv.y ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * h, vUv.y ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * h, vUv.y ) ) * 0.051;

			gl_FragColor = sum;

		}`},VerticalBlurShader={name:"VerticalBlurShader",uniforms:{tDiffuse:{value:null},v:{value:1/512}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;
		uniform float v;

		varying vec2 vUv;

		void main() {

			vec4 sum = vec4( 0.0 );

			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * v ) ) * 0.051;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * v ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * v ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * v ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * v ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * v ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * v ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * v ) ) * 0.051;

			gl_FragColor = sum;

		}`};var ContactShadowGroundPlugin_decorate=function(h,o,c,d){var _,v=arguments.length,b=v<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(h,o,c,d);else for(var tt=h.length-1;tt>=0;tt--)(_=h[tt])&&(b=(v<3?_(b):v>3?_(o,c,b):_(o,c))||b);return v>3&&b&&Object.defineProperty(o,c,b),b};const horizontalBlurMaterial=new three_module.BKk(HorizontalBlurShader);horizontalBlurMaterial.depthTest=!1;const verticalBlurMaterial=new three_module.BKk(VerticalBlurShader);verticalBlurMaterial.depthTest=!1;class ContactShadowGroundPlugin extends BaseGroundPlugin{constructor(o={},c=!1){super(o),this.contactShadows=!0,this.blurAmount=1,this.shadowScale=1,this.shadowHeight=5,this.shadowCamera=new three_module.qUd(-1,1,1,-1,.001,this.shadowHeight),this._refreshShadowCameraFrustum=this._refreshShadowCameraFrustum.bind(this),this.refreshOptions=this.refreshOptions.bind(this),this._showDebug=c,c&&this.dependencies.push(DebugPlugin)}async onAdded(o){const c=o.renderer.createTarget({type:three_module.OUM,format:three_module.GWd,colorSpace:three_module.jf0,size:{width:512,height:512},generateMipmaps:!1,depthBuffer:!0,minFilter:three_module.k6q,magFilter:three_module.k6q});c.texture.name="groundContactDepthTexture";const d=new three_module.CSG({depthPacking:three_module.Rkk});d.onBeforeCompile=function(v){v.uniforms.opacity.value=1,v.fragmentShader=`
						${v.fragmentShader.replace("gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );","gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), 1.0 );")}
					`};const _=new GBufferRenderPass(c,d,new three_module.Q1f(0,0,0),0);this._depthPass=_,await super.onAdded(o)}_postFrame(){super._postFrame(),this._viewer}_preRender(){if(super._preRender(),!this._viewer||!this._depthPass)return;this._depthPass.scene=this._viewer.scene.modelObject,this._depthPass.camera=this.shadowCamera,this._depthPass.render(this._viewer.renderer.rendererObject,null);const o=this._viewer.renderer.getTempTarget({type:three_module.OUM,format:three_module.GWd,colorSpace:three_module.jf0,size:{width:1024,height:1024},generateMipmaps:!1,depthBuffer:!1,minFilter:three_module.k6q,magFilter:three_module.k6q});this._blurShadow(o),this._blurShadow(o,.4),this._viewer.renderer.releaseTempTarget(o)}_blurShadow(o,c=1){this._viewer&&this._depthPass&&(horizontalBlurMaterial.uniforms.h.value=c*this.blurAmount/256,verticalBlurMaterial.uniforms.v.value=c*this.blurAmount/256,this._viewer.renderer.blit(this._depthPass.target.texture,o,{material:horizontalBlurMaterial,clear:!0}),this._viewer.renderer.blit(o.texture,this._depthPass.target,{material:verticalBlurMaterial,clear:!0}))}async onDispose(o){return super.onDispose(o)}async onRemove(o){var c,d,_;const v=(c=this._depthPass)===null||c===void 0?void 0:c.target;return v&&((d=this._viewer)===null||d===void 0||d.renderer.disposeTarget(v)),(_=this._depthPass)===null||_===void 0||_.dispose(),this._depthPass=void 0,super.onRemove(o)}_refreshTransform(){super._refreshTransform(),this._mesh&&this._viewer&&(this.shadowCamera.position.copy(this._mesh.getWorldPosition(new three_module.Pq0)),this.shadowCamera.setRotationFromEuler(new three_module.O9p(Math.PI/2,0,0)),this.shadowCamera.updateMatrixWorld(),this._refreshShadowCameraFrustum(),this._mesh.scale.y=-this.size)}_refreshShadowCameraFrustum(){this.shadowCamera&&(this.shadowCamera.left=-this.size/(2*this.shadowScale),this.shadowCamera.right=this.size/(2*this.shadowScale),this.shadowCamera.top=this.size/(2*this.shadowScale),this.shadowCamera.bottom=-this.size/(2*this.shadowScale),this.shadowCamera.far=this.shadowHeight,this.shadowCamera.updateProjectionMatrix(),this._setDirty())}_setDirty(){var o;(o=this._viewer)===null||o===void 0||o.setDirty()}_removeMaterial(){this._material&&super._removeMaterial()}refreshOptions(){this._viewer&&super.refreshOptions()}_refreshMaterial(){var o;if(!this._viewer)return!1;const c=super._refreshMaterial();return this._material&&(this._material.alphaMap=((o=this._depthPass)===null||o===void 0?void 0:o.target.texture)||null,c&&(this._material.roughness=1,this._material.metalness=0,this._material.color.set(1118481),this._material.transparent=!0,this._material.materialObject.userData.ssreflDisabled=!0,this._material.materialObject.userData.ssreflNonPhysical=!1)),c}_extraUiConfig(){return[{label:"Contact Shadows",type:"checkbox",property:[this,"contactShadows"]},{label:"Shadow Scale",type:"slider",bounds:[0,2],property:[this,"shadowScale"]},{label:"Shadow Height",type:"slider",bounds:[0,20],property:[this,"shadowHeight"]},{label:"Blur Amount",type:"slider",bounds:[0,10],property:[this,"blurAmount"]},...super._extraUiConfig()]}}function objectBeforeRender(h,o){var c;o&&!((c=o.map)===null||c===void 0)&&c.isTexture&&(o.extraUniformsToUpload||(o.extraUniformsToUpload={}),o.extraUniformsToUpload.uvTransform||(o.extraUniformsToUpload.uvTransform={value:new three_module.dwI}),o.extraUniformsToUpload.uvTransform.value.setUvTransform(o.map.offset.x*o.map.repeat.x*h.userData.cloneRotI/(h.userData.rotationCount||1),o.map.offset.y*o.map.repeat.y*h.userData.cloneRotI/(h.userData.rotationCount||1),o.map.repeat.x,o.map.repeat.y,o.map.rotation,o.map.center.x,o.map.center.y))}function setRotI(h,o,c,d){h.traverse(_=>{_&&(_.userData.cloneRotI=o,_.userData.rotationCount=c,_.userData.rotationAxis=d,_.addEventListener("beforeRender",v=>objectBeforeRender(_,v.material)))})}function rotateDuplicatedMesh(h,o,c,d="x"){var _;if(h.userData.rotationCount>1&&!h.userData.rotationRoot)return h;const v=h.parent;if(!v)throw new Error("No parent");if(h.userData.cloneParent){const tt=h.userData.cloneParent;if(h=v.children.find(it=>tt===it.uuid),!h)return console.error("Couldn't find clone root, cannot rotate. maybe a serialization issue?",tt,v),h}let b=v.children.filter(tt=>{var it;return((it=tt.userData)===null||it===void 0?void 0:it.cloneParent)===h.uuid}).sort((tt,it)=>tt.userData.cloneRotI-it.userData.cloneRotI);if(h.userData.rotationCount===o&&o===b.length&&c===void 0&&h.userData.rotationAxis===d)return h;if(c==null&&(c=(_=h.userData.rotationSkips)!==null&&_!==void 0?_:[]),c!==h.userData.rotationSkips&&(h.userData.rotationSkips=[...c]),setRotI(h,0,o,d),h.userData.rotationRoot=!0,h.visible=!0,o<=b.length){for(let tt=o-1;tt<b.length;tt++)v.remove(b[tt]),b[tt].traverse(it=>it.userData={__disposed:!0});b=b.slice(0,o)}for(let tt=1;tt<o;tt++){const it=tt<=b.length?b[tt-1]:h.clone();it.rotation.copy(h.rotation),it.rotation[d]+=tt/o*Math.PI*2,setRotI(it,tt,o,d),tt>b.length&&v.add(it),it.visible=!c.includes(tt)}return h.visible=!c.includes(0),h}ContactShadowGroundPlugin.PluginType="ContactShadowGroundPlugin",ContactShadowGroundPlugin_decorate([x$1(ContactShadowGroundPlugin.prototype.refreshOptions),serialize()],ContactShadowGroundPlugin.prototype,"contactShadows",void 0),ContactShadowGroundPlugin_decorate([serialize(),x$1(ContactShadowGroundPlugin.prototype._setDirty)],ContactShadowGroundPlugin.prototype,"blurAmount",void 0),ContactShadowGroundPlugin_decorate([serialize(),x$1(ContactShadowGroundPlugin.prototype._refreshShadowCameraFrustum)],ContactShadowGroundPlugin.prototype,"shadowScale",void 0),ContactShadowGroundPlugin_decorate([serialize(),x$1(ContactShadowGroundPlugin.prototype._refreshShadowCameraFrustum)],ContactShadowGroundPlugin.prototype,"shadowHeight",void 0);var ObjectRotationPlugin_decorate=function(h,o,c,d){var _,v=arguments.length,b=v<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(h,o,c,d);else for(var tt=h.length-1;tt>=0;tt--)(_=h[tt])&&(b=(v<3?_(b):v>3?_(o,c,b):_(o,c))||b);return v>3&&b&&Object.defineProperty(o,c,b),b};let ObjectRotationPlugin=class extends AViewerPlugin{async onAdded(h){var o;await super.onAdded(h),(o=h.getPluginByType("Picking"))===null||o===void 0||o.addEventListener("selectedObjectChanged",this._selectedObjectChanged)}constructor(h=!0){super(),this.rotations=1,this.axis="x",this.skips="",this._selectedObjectChanged=this._selectedObjectChanged.bind(this),this.enabled=h}_selectedObjectChanged(){var h,o,c,d,_,v,b,tt,it;if(!this.enabled)return;const nt=(o=(h=this._viewer)===null||h===void 0?void 0:h.getPluginByType("Picking"))===null||o===void 0?void 0:o.getSelectedObject();if(!nt)return void((d=(c=this.uiConfig).uiRefresh)===null||d===void 0||d.call(c,"postFrame",!0));const lt=nt.userData.rotationRoot&&(_=nt.userData.rotationCount)!==null&&_!==void 0?_:1;this.rotations=lt,this.skips=(b=(v=nt.userData.rotationSkips)===null||v===void 0?void 0:v.join(","))!==null&&b!==void 0?b:"",this.axis=nt.userData.rotationAxis||"x",(it=(tt=this.uiConfig).uiRefresh)===null||it===void 0||it.call(tt,"postFrame",!0)}_paramsChanged(){var h,o,c,d,_,v;if(!this.enabled)return;const b=(o=(h=this._viewer)===null||h===void 0?void 0:h.getPluginByType("Picking"))===null||o===void 0?void 0:o.getSelectedObject();if(b){if(this.rotations>1||b.userData.rotationCount){const tt=b.userData.rotationCount,it=rotateDuplicatedMesh(b,this.rotations,this.skips.split(",").map(lt=>parseInt(lt)).filter(lt=>isFinite(lt)),this.axis),nt=it==null?void 0:it.userData.rotationCount;if(nt&&nt!==tt){const lt=[];it==null||it.traverseAncestors(ut=>{lt.push(ut)});for(const ut of lt)if(ut.userData.autoScaled){autoScaleObject3D(ut),(c=this._viewer)===null||c===void 0||c.resetCamera({rootObject:ut,centerOffset:new three_module.Pq0(4,4,4)});break}}b.parent&&!b.userData.__disposed||(_=(d=this._viewer)===null||d===void 0?void 0:d.getPluginByType("Picking"))===null||_===void 0||_.setSelectedObject(it,!0)}(v=this._viewer)===null||v===void 0||v.scene.setDirty({frameFade:!1,sceneUpdate:!0})}}};ObjectRotationPlugin.PluginType="ObjectRotationPlugin",ObjectRotationPlugin_decorate([serialize(),uiToggle("Enabled"),x$1(ObjectRotationPlugin.prototype._paramsChanged)],ObjectRotationPlugin.prototype,"enabled",void 0),ObjectRotationPlugin_decorate([uiSlider("Rotation Count",[1,100],1,h=>({hidden:()=>{var o,c;return!(!((c=(o=h._viewer)===null||o===void 0?void 0:o.getPluginByType("Picking"))===null||c===void 0)&&c.getSelectedObject())||!h.rotations}})),x$1(ObjectRotationPlugin.prototype._paramsChanged)],ObjectRotationPlugin.prototype,"rotations",void 0),ObjectRotationPlugin_decorate([uiDropdown("Axis",["x","y","z"].map(h=>({label:h})),h=>({hidden:()=>{var o,c;return!(!((c=(o=h._viewer)===null||o===void 0?void 0:o.getPluginByType("Picking"))===null||c===void 0)&&c.getSelectedObject())||!h.rotations}})),x$1(ObjectRotationPlugin.prototype._paramsChanged)],ObjectRotationPlugin.prototype,"axis",void 0),ObjectRotationPlugin_decorate([uiInput("Rotation Skips",h=>({hidden:()=>{var o,c;return!(!((c=(o=h._viewer)===null||o===void 0?void 0:o.getPluginByType("Picking"))===null||c===void 0)&&c.getSelectedObject())||!h.rotations}})),x$1(ObjectRotationPlugin.prototype._paramsChanged)],ObjectRotationPlugin.prototype,"skips",void 0),ObjectRotationPlugin=ObjectRotationPlugin_decorate([uiFolder("Object Rotations")],ObjectRotationPlugin);var reliefParallax=`#ifdef USE_BUMPMAP
mat3 mat3_inverse(mat3 A){mat3 M_t=mat3(vec3(A[0][0],A[1][0],A[2][0]),vec3(A[0][1],A[1][1],A[2][1]),vec3(A[0][2],A[1][2],A[2][2]));float det=dot(cross(M_t[0],M_t[1]),M_t[2]);mat3 adjugate=mat3(cross(M_t[1],M_t[2]),cross(M_t[2],M_t[0]),cross(M_t[0],M_t[1]));return adjugate/det;}float CalculateHeight(in vec2 texCoords){float height=texture2D(bumpMap,texCoords).x;return clamp(height,0.,1.);}const vec2 bumpMapSize=vec2(512,512);vec3 CalculateNormal(in vec2 texCoords){
#if defined( TANGENTSPACE_NORMALMAP ) && 0 
vec3 mapN=texture2D(normalMap,texCoords).xyz;mapN.xy*=normalScale;return normalize(mapN);
#else
vec2 texOffs=1./bumpMapSize;
#if PARALLAX_NORMAL_MAP_QUALITY > 0
float hx[9];hx[0]=texture2D(bumpMap,texCoords.st+texOffs*vec2(-1.,-1.)).r;hx[1]=texture2D(bumpMap,texCoords.st+texOffs*vec2(0.,-1.)).r;hx[2]=texture2D(bumpMap,texCoords.st+texOffs*vec2(1.,-1.)).r;hx[3]=texture2D(bumpMap,texCoords.st+texOffs*vec2(-1.,0.)).r;hx[4]=texture2D(bumpMap,texCoords.st).r;hx[5]=texture2D(bumpMap,texCoords.st+texOffs*vec2(1.,0.)).r;hx[6]=texture2D(bumpMap,texCoords.st+texOffs*vec2(-1.,1.)).r;hx[7]=texture2D(bumpMap,texCoords.st+texOffs*vec2(0.,1.)).r;hx[8]=texture2D(bumpMap,texCoords.st+texOffs*vec2(1.,1.)).r;vec2 deltaH=vec2(hx[0]-hx[2]+2.*(hx[3]-hx[5])+hx[6]-hx[8],hx[0]-hx[6]+2.*(hx[1]-hx[7])+hx[2]-hx[8]);
#else
float h_xa=texture2D(bumpMap,texCoords.st+texOffs*vec2(-1.,0.)).r;float h_xb=texture2D(bumpMap,texCoords.st+texOffs*vec2(1.,0.)).r;float h_ya=texture2D(bumpMap,texCoords.st+texOffs*vec2(0.,-1.)).r;float h_yb=texture2D(bumpMap,texCoords.st+texOffs*vec2(0.,1.)).r;vec2 deltaH=vec2(h_xa-h_xb,h_ya-h_yb);
#endif
return normalize(vec3(deltaH/texOffs,1.));
#endif
}vec3 ReliefParallax(in float frontFace,in vec3 texDir3D,in vec2 texCoord){float surf_sign=frontFace;float back_face=step(0.,-surf_sign);vec2 texStep=surf_sign*texDir3D.xy/abs(texDir3D.z);vec2 texC=texCoord.st+surf_sign*texStep+back_face*texStep.xy;float mapHeight=1.;float bumpHeightStep=1./float(PARALLAX_MAP_STEPS);float bestBumpHeight=mapHeight+bumpHeightStep;
#pragma unroll_loop_start
for(int i=0;i<PARALLAX_MAP_STEPS;i++){if(mapHeight<bestBumpHeight){bestBumpHeight-=bumpHeightStep;mapHeight=back_face+surf_sign*CalculateHeight(texC.xy-bestBumpHeight*texStep.xy);}}
#pragma unroll_loop_end
bestBumpHeight+=bumpHeightStep;
#pragma unroll_loop_start
for(int i=0;i<PARALLAX_MAP_B_STEPS;i++){bumpHeightStep*=0.5;bestBumpHeight-=bumpHeightStep;mapHeight=back_face+surf_sign*CalculateHeight(texC.xy-bestBumpHeight*texStep.xy);bestBumpHeight+=(bestBumpHeight<mapHeight)?bumpHeightStep:0.;}
#pragma unroll_loop_end
bestBumpHeight-=bumpHeightStep*clamp((bestBumpHeight-mapHeight)/bumpHeightStep,0.,1.);mapHeight=bestBumpHeight;texC-=mapHeight*texStep;return vec3(texC.xy,mapHeight);}vec3 reliefParallaxPerturbNormal(in float faceDirection,inout vec3 normal){if(abs(bumpScale)<0.001)return vec3(vBumpMapUv,0.);float parallaxHeight;vec2 texCoords=vBumpMapUv;float face_sign=sign(dot(normal,vViewPosition));vec3 N=normalize(normal);vec3 dp1=dFdx(-vViewPosition);vec3 dp2=dFdy(-vViewPosition);vec2 duv1=dFdx(vBumpMapUv);vec2 duv2=dFdy(vBumpMapUv);vec3 dp2perp=cross(dp2,N);vec3 dp1perp=cross(N,dp1);vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;float invmax=inversesqrt(max(dot(T,T),dot(B,B)));mat3 tbnMat=mat3(T*invmax,B*invmax,N*bumpScale);vec3 tangentPos=normalize(mat3_inverse(tbnMat)*-vViewPosition);vec3 parallaxUv=ReliefParallax(face_sign,tangentPos,vBumpMapUv);tbnMat[2]=face_sign*N/bumpScale;normal=normalize(tbnMat*CalculateNormal(parallaxUv.xy).xyz);
#ifdef FLIP_SIDED
normal=-normal;
#endif
return parallaxUv;}
#endif 
`,ParallaxMappingPlugin_decorate=function(h,o,c,d){var _,v=arguments.length,b=v<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(h,o,c,d);else for(var tt=h.length-1;tt>=0;tt--)(_=h[tt])&&(b=(v<3?_(b):v>3?_(o,c,b):_(o,c))||b);return v>3&&b&&Object.defineProperty(o,c,b),b};let ParallaxMappingPlugin=class extends AViewerPlugin{constructor(h=!0){super(),this.enabled=!0,this.debugNormals=!1,this.debugHitHeight=!1,this._defines={PARALLAX_NORMAL_MAP_QUALITY:0},this.stepCount=12,this.binaryStepCount=3,this._bumpMapExtension={shaderExtender:(o,c,d)=>{if(c.materialObject.bumpMap&&this.enabled){o.fragmentShader=o.fragmentShader.replace("#include <normal_fragment_begin>",""),o.fragmentShader=o.fragmentShader.replace("#include <normal_fragment_maps>",""),o.fragmentShader=o.fragmentShader.replace("#include <map_fragment>",`#include <normal_fragment_begin>
#include <normal_fragment_maps>
#include <map_fragment>`);for(const _ of["map_fragment","alphamap_fragment","roughnessmap_fragment","metalnessmap_fragment","emissivemap_fragment","transmission_fragment"])o.fragmentShader=shaderReplaceString(o.fragmentShader,`#include <${_}>`,three_module.vxI[_].replace(/\bv\w+Uv\b/g,"parallaxUv.xy",{replaceAll:!0}));(this.debugNormals||this.debugHitHeight)&&(o.fragmentShader=shaderReplaceString(o.fragmentShader,"texture2D( map, parallaxUv.xy )",this.debugNormals?"vec4(normal, 1.); normal = nonPerturbedNormal":"vec4(parallaxUv.z,0., 0., 1.)")),o.fragmentShader=shaderReplaceString(o.fragmentShader,"#include <normal_fragment_maps>",shaderReplaceString(shaderReplaceString(three_module.vxI.normal_fragment_maps,"#elif defined( USE_NORMALMAP_TANGENTSPACE )","#elif defined( USE_NORMALMAP_TANGENTSPACE ) && !defined( USE_BUMPMAP )"),"normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );","vec3 parallaxUv = reliefParallaxPerturbNormal(faceDirection, normal);"))}},parsFragmentSnippet:()=>this.enabled?(reliefParallax+`
`).replaceAll("PARALLAX_MAP_STEPS",this._defines.PARALLAX_MAP_STEPS).replaceAll("PARALLAX_MAP_B_STEPS",this._defines.PARALLAX_MAP_B_STEPS):"",isCompatible:o=>o.isMeshStandardMaterial2,computeCacheKey:o=>{var c;return this.enabled+" "+((c=o.materialObject.bumpMap)===null||c===void 0?void 0:c.uuid)+" "+this.debugNormals+" "+this.debugHitHeight+"  "},onObjectRender:(o,{materialObject:c},d)=>{if(this.enabled)for(const[_,v]of Object.entries(this._defines)){const b=typeof v=="number"?v:v?1:0;c.defines[_]!==b&&(c.defines[_]=b,c.needsUpdate=!0)}}},this.dependencies=[AssetManagerPlugin],this.enabled=h,this._updateExtension=this._updateExtension.bind(this)}_updateExtension(){var h,o,c;(o=(h=this._bumpMapExtension)===null||h===void 0?void 0:h.setDirty)===null||o===void 0||o.call(h),(c=this._viewer)===null||c===void 0||c.setDirty()}async onAdded(h){var o,c;return(c=(o=h.getPlugin(AssetManagerPlugin))===null||o===void 0?void 0:o.materials)===null||c===void 0||c.registerMaterialExtension(this._bumpMapExtension),super.onAdded(h)}async onRemove(h){var o,c;return(c=(o=h.getPlugin(AssetManagerPlugin))===null||o===void 0?void 0:o.materials)===null||c===void 0||c.unregisterMaterialExtension(this._bumpMapExtension),super.onRemove(h)}};ParallaxMappingPlugin.PluginType="ReliefParallaxMapping",ParallaxMappingPlugin_decorate([x$1(ParallaxMappingPlugin.prototype._updateExtension),serialize(),uiToggle("Enabled")],ParallaxMappingPlugin.prototype,"enabled",void 0),ParallaxMappingPlugin_decorate([x$1(ParallaxMappingPlugin.prototype._updateExtension),uiToggle("Debug Normals")],ParallaxMappingPlugin.prototype,"debugNormals",void 0),ParallaxMappingPlugin_decorate([x$1(ParallaxMappingPlugin.prototype._updateExtension),uiToggle("Debug Hit Height")],ParallaxMappingPlugin.prototype,"debugHitHeight",void 0),ParallaxMappingPlugin_decorate([matDefine("PARALLAX_MAP_STEPS",void 0,!0,ParallaxMappingPlugin.prototype._updateExtension),uiSlider("Step count",[1,32],1),serialize()],ParallaxMappingPlugin.prototype,"stepCount",void 0),ParallaxMappingPlugin_decorate([matDefine("PARALLAX_MAP_B_STEPS",void 0,!0,ParallaxMappingPlugin.prototype._updateExtension),uiSlider("Binary search steps",[1,8],1),serialize()],ParallaxMappingPlugin.prototype,"binaryStepCount",void 0),ParallaxMappingPlugin=ParallaxMappingPlugin_decorate([uiFolder("Parallax Mapping")],ParallaxMappingPlugin);class TubeShapeGeometry extends three_module.LoY{constructor(o,c,d=32,_=64,v=!1,b=new three_module.I9Y(1,1),tt="shape"){super(),this.type="TubeShapeGeometry",this.parameters={path:c,shape:o,shapeSegments:d,tubularSegments:_,closed:v,primary:tt,shapeScale:b.clone()};const it=c.computeFrenetFrames(_,v);this.frames=it;const nt=new three_module.Pq0,lt=new three_module.Pq0,ut=new three_module.Pq0,ht=new three_module.I9Y;let _t=new three_module.Pq0;const ft=[],bt=[],xt=[],St=o.getSpacedPoints(d);for(const Rt of St)Rt.multiply(b);(function(){for(let Rt=0;Rt<_;Rt++)Pt(Rt);Pt(v===!1?_:0),function(){for(let Rt=0;Rt<=_;Rt++)for(let kt=0;kt<=d;kt++)ht.x=Rt/_,ht.y=kt/d,bt.push(ht.x,ht.y)}(),function(){const Rt=tt==="shape",kt=Rt?d:_,Gt=Rt?_:d;for(let Dt=1;Dt<=kt;Dt++)for(let It=1;It<=Gt;It++){const[Nt,Vt]=Rt?[It,Dt]:[Dt,It],Kt=(d+1)*(Nt-1)+(Vt-1),Yt=(d+1)*Nt+(Vt-1),nr=(d+1)*Nt+Vt,rr=(d+1)*(Nt-1)+Vt;xt.push(Kt,Yt,rr),xt.push(Yt,nr,rr)}}()})(),this.setIndex(xt),this.setAttribute("position",new three_module.qtW(ft,3)),this.setAttribute("uv",new three_module.qtW(bt,2)),this.computeVertexNormals();const wt=this.attributes.normal;function Pt(Rt){_t=c.getPointAt(Rt/_,_t);const kt=it.normals[Rt],Gt=it.binormals[Rt];for(let Dt=0;Dt<=d;Dt++){const It=St[Dt%d];lt.set(0,0,0).addScaledVector(kt,It.x).addScaledVector(Gt,It.y),nt.copy(_t).add(lt),ft.push(nt.x,nt.y,nt.z)}}(function(){for(let kt=1;kt<d;kt++){const Gt=kt+_*(d+1);lt.fromBufferAttribute(wt,kt),ut.fromBufferAttribute(wt,Gt),lt.add(ut).normalize(),wt.setXYZ(kt,lt.x,lt.y,lt.z),wt.setXYZ(Gt,lt.x,lt.y,lt.z)}for(let kt=1;kt<_;kt++){const Gt=kt*(d+1),Dt=Gt+d;lt.fromBufferAttribute(wt,Gt),ut.fromBufferAttribute(wt,Dt),lt.add(ut).normalize(),wt.setXYZ(Gt,lt.x,lt.y,lt.z),wt.setXYZ(Dt,lt.x,lt.y,lt.z)}lt.fromBufferAttribute(wt,0),ut.fromBufferAttribute(wt,d),lt.add(ut);const Rt=_*(d+1);ut.fromBufferAttribute(wt,Rt),lt.add(ut),ut.fromBufferAttribute(wt,Rt+d),lt.add(ut),lt.normalize(),wt.setXYZ(0,lt.x,lt.y,lt.z),wt.setXYZ(d,lt.x,lt.y,lt.z),wt.setXYZ(Rt,lt.x,lt.y,lt.z),wt.setXYZ(Rt+d,lt.x,lt.y,lt.z),wt.needsUpdate=!0})()}createSplits(o){this.clearGroups();const c=this.parameters.primary==="shape"?this.parameters.shapeSegments:this.parameters.tubularSegments,d=this.index.count,_=[...o,1].sort((tt,it)=>tt-it);let v=0,b=0;for(const tt of _){const it=Math.round(c*tt)*d/c;this.addGroup(v,it-v,b++),v=it}return this.groups.length}toJSON(){const o=super.toJSON();return o.path=this.parameters.path.toJSON(),o.shape=this.parameters.shape.toJSON(),o}}var ShapeTubeExtrudePlugin_decorate=function(h,o,c,d){var _,v=arguments.length,b=v<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(h,o,c,d);else for(var tt=h.length-1;tt>=0;tt--)(_=h[tt])&&(b=(v<3?_(b):v>3?_(o,c,b):_(o,c))||b);return v>3&&b&&Object.defineProperty(o,c,b),b},ShapeTubeExtrudePlugin_1;let ShapeTubeExtrudePlugin=ShapeTubeExtrudePlugin_1=class extends AViewerPlugin{constructor(){super(...arguments),this.enabled=!0,this.shapeSegments=32,this.tubularSegments=32,this.shapeScale=new three_module.I9Y(1,1),this.materialSplits="0.3, 0.6",this.horizontalSplits=!0,this.extrudeCirceTube=async()=>{var h,o;const c=(o=(h=this._viewer)===null||h===void 0?void 0:h.getPlugin(PickingPlugin))===null||o===void 0?void 0:o.getSelectedObject();if(!c)return;let d=this._viewer.prompt("Radius: Radius for the circle","1",!0);if(!d)return;d=parseFloat(d);const _=new EllipseCurve3D(0,0,d,d,0,2*Math.PI,!0,0);await this.extrudeObject(c,_)}}async onAdded(h){await super.onAdded(h)}static CreateCurve(h,o){var c,d;if(h==="circle")return new EllipseCurve3D(0,0,(c=o.radius)!==null&&c!==void 0?c:1,(d=o.radius)!==null&&d!==void 0?d:1,0,2*Math.PI,!0,0);throw new Error("Unknown curve type")}async extrudeObject(h,o,c=this.shapeSegments,d=this.tubularSegments,_=this.shapeScale,v=this.materialSplits.split(",").map(tt=>parseFloat(tt.trim())),b=this.horizontalSplits){var tt,it,nt,lt,ut,ht,_t,ft;if(h.userData.isExtrudedTube,h.userData._extrudeSource){const Rt=h.userData._extrudeSource;if(h=(tt=h.parent)===null||tt===void 0?void 0:tt.children.find(kt=>Rt===kt.uuid),!h)return void console.warn("Could not find extrude source with uuid",Rt)}if(h.userData.extrudedObject){const Rt=h.userData.extrudedObject,kt=(it=h.parent)===null||it===void 0?void 0:it.children.find(Gt=>Rt===Gt.uuid);kt&&(kt.removeFromParent(),kt.geometry.dispose(),kt.geometry=null,kt.material=null),delete h.userData.extrudedObject}const bt=h.geometry;if(!bt)return void((nt=this._viewer)===null||nt===void 0||nt.alert("Extrude: No geometry to extrude"));const xt=[h.material];let St;try{const Rt=ShapeTubeExtrudePlugin_1.ConvertGeometryToFlatShape(bt);St=new TubeShapeGeometry(Rt,o,c,d,!0,_,b?"shape":"path"),St.computeBoundingBox(),St.createSplits(v)}catch(Rt){return void((lt=this._viewer)===null||lt===void 0||lt.alert(typeof Rt=="string"?Rt:Rt==null?void 0:Rt.message))}xt[0].color.set(16777215);for(let Rt=xt.length;Rt<St.groups.length;Rt++){const kt=xt[0].clone();xt.push(kt),kt.color.set(16777215*Math.random())}const wt=new three_module.eaF(St,xt);wt.userData._extrudeSource=h.uuid,wt.userData.isExtrudedTube=!0,h.visible=!1,h.userData.bboxVisible=!1,wt.name=h.name+"_extruded";const Pt=await((_t=(ht=(ut=this._viewer)===null||ut===void 0?void 0:ut.getManager())===null||ht===void 0?void 0:ht.importer)===null||_t===void 0?void 0:_t.processImportedSingle(wt,{autoCenter:!1,autoScale:!1}));Pt&&((ft=h.parent)===null||ft===void 0||ft.add(Pt.modelObject),h.userData.extrudedObject=Pt.modelObject.uuid,Pt.dispatchEvent({type:"select",ui:!0,value:Pt}))}static ExtrudeShape(h,o,c,d,_,v,b,tt){const it=new TubeShapeGeometry(h,d,o,c,!0,new three_module.I9Y(_,v),tt?"shape":"path");it.computeBoundingBox(),it.createSplits(b);const nt=new three_module.eaF(it,[]);return nt.userData.isExtrudedTube=!0,nt}static ConvertGeometryToFlatShape(h,o=!0){if(h.userData.__planarShape)return h.userData.__planarShape;let c=h.attributes.position;if(!c)throw"no position attribute";if(c.count>500)throw"too large to extrude";const d=h;c=d.attributes.position,d.boundingBox||d.computeBoundingBox();const _=d.boundingBox.getSize(new three_module.Pq0),v=_.x<.001?"x":_.y<.001?"y":_.z<.001?"z":null;if(!v)throw"geometry is not axis aligned not planar";let b=[];for(let it=0;it<c.count;it++){const nt=new three_module.I9Y;v==="x"?nt.set(c.getY(it),c.getZ(it)):v==="y"?nt.set(c.getX(it),c.getZ(it)):nt.set(c.getX(it),c.getY(it)),b.push(nt)}if(o){let it=0;for(let nt=0;nt<b.length;nt++)(b[nt].x<b[it].x||b[nt].x===b[it].x&&b[nt].y<b[it].y)&&(it=nt);it!==0&&(b=b.slice(it).concat(b.slice(0,it)))}const tt=new three_module.ypk(b);return h.userData.__planarShape=tt,tt}};ShapeTubeExtrudePlugin.PluginType="ShapeTubeExtrudePlugin",ShapeTubeExtrudePlugin_decorate([uiToggle("Enabled")],ShapeTubeExtrudePlugin.prototype,"enabled",void 0),ShapeTubeExtrudePlugin_decorate([uiSlider("Shape Segments (X)",[1,100],1,h=>({hidden:()=>{var o,c;return!(!((c=(o=h._viewer)===null||o===void 0?void 0:o.getPlugin(PickingPlugin))===null||c===void 0)&&c.getSelectedObject())}}))],ShapeTubeExtrudePlugin.prototype,"shapeSegments",void 0),ShapeTubeExtrudePlugin_decorate([uiSlider("Tube Segments (Y)",[1,100],1,h=>({hidden:()=>{var o,c;return!(!((c=(o=h._viewer)===null||o===void 0?void 0:o.getPlugin(PickingPlugin))===null||c===void 0)&&c.getSelectedObject())}}))],ShapeTubeExtrudePlugin.prototype,"tubularSegments",void 0),ShapeTubeExtrudePlugin_decorate([uiVector("Shape scale",[.01,10],.01,h=>({hidden:()=>{var o,c;return!(!((c=(o=h._viewer)===null||o===void 0?void 0:o.getPlugin(PickingPlugin))===null||c===void 0)&&c.getSelectedObject())}}))],ShapeTubeExtrudePlugin.prototype,"shapeScale",void 0),ShapeTubeExtrudePlugin_decorate([uiInput("Material Splits",h=>({hidden:()=>{var o,c;return!(!((c=(o=h._viewer)===null||o===void 0?void 0:o.getPlugin(PickingPlugin))===null||c===void 0)&&c.getSelectedObject())}}))],ShapeTubeExtrudePlugin.prototype,"materialSplits",void 0),ShapeTubeExtrudePlugin_decorate([uiToggle("Horizontal Splits",h=>({hidden:()=>{var o,c;return!(!((c=(o=h._viewer)===null||o===void 0?void 0:o.getPlugin(PickingPlugin))===null||c===void 0)&&c.getSelectedObject())}}))],ShapeTubeExtrudePlugin.prototype,"horizontalSplits",void 0),ShapeTubeExtrudePlugin_decorate([uiButton("Extrude Circle Tube",h=>({hidden:()=>{var o,c;return!(!((c=(o=h._viewer)===null||o===void 0?void 0:o.getPlugin(PickingPlugin))===null||c===void 0)&&c.getSelectedObject())}}))],ShapeTubeExtrudePlugin.prototype,"extrudeCirceTube",void 0),ShapeTubeExtrudePlugin=ShapeTubeExtrudePlugin_1=ShapeTubeExtrudePlugin_decorate([uiFolder("Extrude Tube Shapes")],ShapeTubeExtrudePlugin);class EllipseCurve3D extends three_module.S20{getPoint(o,c){return super.getPoint(o,c||new three_module.Pq0)}}class PopmotionPlugin extends AViewerPlugin{constructor(o=!0){super(),this.enabled=!0,this.toJSON=void 0,this.fromJSON=void 0,this._lastFrameTime=0,this._updaters=[],this.dependencies=[],this._fadeDisabled=!1,this.disableFrameFade=!0,this._postFrame=()=>{var c,d;if(!this._viewer)return;if(!this.enabled||Object.keys(this.animations).length<1)return this._lastFrameTime=0,void(this._fadeDisabled&&((c=this._viewer.getPluginByType("FrameFade"))===null||c===void 0||c.enable(PopmotionPlugin.PluginType),this._fadeDisabled=!1));const _=g()/1e3;this._lastFrameTime<1&&(this._lastFrameTime=_-1/60);let v=_-this._lastFrameTime;this._lastFrameTime=_;const b=(d=this._viewer.getPluginByType("Progressive"))===null||d===void 0?void 0:d.postFrameConvergedRecordingDelta();if(b&&b>0&&(v=b),b!==0&&(v*=1e3,!(v<=.001)&&(this._updaters.forEach(tt=>{let it=v;tt.time+it<0&&(it=-tt.time),tt.time+=it,Math.abs(it)>.001&&tt.u(it)}),!this._fadeDisabled&&this.disableFrameFade))){const tt=this._viewer.getPluginByType("FrameFade");tt&&(tt.disable(PopmotionPlugin.PluginType),this._fadeDisabled=!0)}},this.defaultDriver=c=>({start:()=>this._updaters.push({u:c,time:0}),stop:()=>this._updaters.splice(this._updaters.findIndex(d=>d.u===c),1)}),this.animations={},this.enabled=o,this._postFrame=this._postFrame.bind(this)}async onAdded(o){await super.onAdded(o),o.addEventListener("postFrame",this._postFrame)}async onRemove(o){return o.removeEventListener("postFrame",this._postFrame),super.onRemove(o)}animate(o){const c=esm_browser_v4(),d={id:c,options:o,stop:()=>{var _,v,b;!((_=this.animations[c])===null||_===void 0)&&_._stop?(b=(v=this.animations[c])===null||v===void 0?void 0:v._stop)===null||b===void 0||b.call(v):console.warn("Animation not started")}};return this.animations[c]=d,d.promise=new Promise((_,v)=>{const b={driver:this.defaultDriver,...o,onComplete:async()=>{var it;try{await((it=o.onComplete)===null||it===void 0?void 0:it.call(o))}catch(nt){return void v(nt)}_()},onStop:async()=>{var it;try{await((it=o.onStop)===null||it===void 0?void 0:it.call(o))}catch(nt){return void v(nt)}_()}},tt=animate(b);this.animations[c]._stop=tt.stop,this.animations[c].options=b}).then(()=>(delete this.animations[c],c)),this.animations[c]}async animateAsync(o){return this.animate(o).promise}}PopmotionPlugin.PluginType="PopmotionPlugin";var SimpleTextPlugin_decorate=function(h,o,c,d){var _,v=arguments.length,b=v<3?o:d===null?d=Object.getOwnPropertyDescriptor(o,c):d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(h,o,c,d);else for(var tt=h.length-1;tt>=0;tt--)(_=h[tt])&&(b=(v<3?_(b):v>3?_(o,c,b):_(o,c))||b);return v>3&&b&&Object.defineProperty(o,c,b),b},TextSVGOptions_1,SimpleTextPlugin_1;const onOpsChange=h=>({onChange:o=>{o.last&&h.onChange()}});let TextSVGOptions=TextSVGOptions_1=class{constructor(){this.text="Custom Text",this.fontSize=100,this.width=1024,this.height=1024,this.xOffset=0,this.yOffset=0,this.boxWidth=1024,this.boxHeight=1024,this.textAnchor="middle",this.fontFamily="",this.fontPath="",this.maskText=!1,this.innerShadow=!1,this.textColor="#000000",this.bgFillColor="#ffffff",this.svgBackground="#ffffff",this.onChange=()=>{}}set(h){Object.assign(this,h)}reset(){const h=this.onChange;Object.assign(this,new TextSVGOptions_1),this.onChange=h}toJSON(){return{text:this.text,fontFamily:this.fontFamily,fontPath:this.fontPath,svgBackground:this.svgBackground,width:this.width,height:this.height,xOffset:this.xOffset,yOffset:this.yOffset,boxWidth:this.boxWidth,boxHeight:this.boxHeight,fontSize:this.fontSize,maskText:this.maskText,innerShadow:this.innerShadow,bgFillColor:this.bgFillColor,textColor:this.textColor,textAnchor:this.textAnchor}}};SimpleTextPlugin_decorate([uiInput("Text",onOpsChange)],TextSVGOptions.prototype,"text",void 0),SimpleTextPlugin_decorate([uiSlider("Font Size",[2,400],1,onOpsChange)],TextSVGOptions.prototype,"fontSize",void 0),SimpleTextPlugin_decorate([uiSlider("Width",[2,4096],1,onOpsChange)],TextSVGOptions.prototype,"width",void 0),SimpleTextPlugin_decorate([uiSlider("Height",[2,4096],1,onOpsChange)],TextSVGOptions.prototype,"height",void 0),SimpleTextPlugin_decorate([uiSlider("X Offset",[-1024,1024],1,onOpsChange)],TextSVGOptions.prototype,"xOffset",void 0),SimpleTextPlugin_decorate([uiSlider("Y Offset",[-1024,1024],1,onOpsChange)],TextSVGOptions.prototype,"yOffset",void 0),SimpleTextPlugin_decorate([uiSlider("V-Width",[2,4096],1,onOpsChange)],TextSVGOptions.prototype,"boxWidth",void 0),SimpleTextPlugin_decorate([uiSlider("V-Height",[2,4096],1,onOpsChange)],TextSVGOptions.prototype,"boxHeight",void 0),SimpleTextPlugin_decorate([uiDropdown("Text Anchor",["start","middle","end"].map(h=>({label:h})),onOpsChange)],TextSVGOptions.prototype,"textAnchor",void 0),SimpleTextPlugin_decorate([uiInput("Font",onOpsChange)],TextSVGOptions.prototype,"fontFamily",void 0),SimpleTextPlugin_decorate([uiInput("Font Url",onOpsChange)],TextSVGOptions.prototype,"fontPath",void 0),SimpleTextPlugin_decorate([uiToggle("Mask Text",onOpsChange)],TextSVGOptions.prototype,"maskText",void 0),SimpleTextPlugin_decorate([uiToggle("Inner Shadow",onOpsChange)],TextSVGOptions.prototype,"innerShadow",void 0),SimpleTextPlugin_decorate([uiColor("Text Color",onOpsChange)],TextSVGOptions.prototype,"textColor",void 0),SimpleTextPlugin_decorate([uiColor("BG Fill",onOpsChange)],TextSVGOptions.prototype,"bgFillColor",void 0),SimpleTextPlugin_decorate([uiColor("SVG BG",onOpsChange)],TextSVGOptions.prototype,"svgBackground",void 0),TextSVGOptions=TextSVGOptions_1=SimpleTextPlugin_decorate([uiFolder("Text SVG Options")],TextSVGOptions);const fontFormatExtensionMap={woff:"woff",woff2:"woff2",ttf:"truetype",otf:"opentype",eot:"embedded-opentype"},inputHiddenParams=h=>({hidden:()=>{const o=h.getSelected();return!o||!o.userData[SimpleTextPlugin.PluginType]}});let SimpleTextPlugin=SimpleTextPlugin_1=class extends AViewerPlugin{async onAdded(h){var o;await super.onAdded(h),(o=h.getPluginByType("Picking"))===null||o===void 0||o.addEventListener("selectedObjectChanged",this._selectedObjectChanged)}constructor(){super(),this.enabled=!0,this.getSelected=()=>{var h,o;return(o=(h=this._viewer)===null||h===void 0?void 0:h.getPluginByType("Picking"))===null||o===void 0?void 0:o.getSelectedObject()},this.options=new TextSVGOptions,this.applyToMap=!0,this.applyToBumpMap=!1,this.applyToAlphaMap=!0,this.inverseAlphaMap=!1,this._lastMeta=void 0,this.fonts={roboto:"https://fonts.gstatic.com/s/roboto/v30/KFOmCnqEu92Fr1Mu4mxKKTU1Kg.woff2"},this._assetLoadOptions=void 0,this._selectedObjectChanged=this._selectedObjectChanged.bind(this),this.addTextToSelected=this.addTextToSelected.bind(this),this._paramsChanged=this._paramsChanged.bind(this),this.options.onChange=this._paramsChanged}_selectedObjectChanged(){var h,o,c,d,_,v;if(!this.enabled)return;const b=this.getSelected();if(!b)return void((o=(h=this.uiConfig).uiRefresh)===null||o===void 0||o.call(h,"postFrame",!0));const tt=b.userData[SimpleTextPlugin_1.PluginType];if(!tt)return this.options.reset(),this._lastMeta=void 0,void((d=(c=this.uiConfig).uiRefresh)===null||d===void 0||d.call(c,"postFrame",!0));this._lastMeta!==tt&&(this.options.set(tt),this._lastMeta=tt),(v=(_=this.uiConfig).uiRefresh)===null||v===void 0||v.call(_,"postFrame",!0)}_paramsChanged(){if(!this.enabled)return;const h=this.getSelected();h&&h.isMesh&&h.userData[SimpleTextPlugin_1.PluginType]&&this.updateText(h,this.options.toJSON())}async addTextToSelected(){var h;const o=this.getSelected();o&&o.isMesh?o.material?(o.userData[SimpleTextPlugin_1.PluginType]||!o.material.map||await((h=this._viewer)===null||h===void 0?void 0:h.confirm("Add Text: This mesh already has a texture. Adding text will replace the texture. Continue?")))&&await this.addText(o):console.error("no material on mesh"):console.error("no mesh is selected")}async addText(h,o){return this.updateText(h,Object.assign(this.options.toJSON(),o))}async updateText(h,o){var c,d;if(!h.isMesh)return;if(!h.material)return void console.error("updateText: no material on mesh");let _=h.userData[SimpleTextPlugin_1.PluginType];_||(h.userData[SimpleTextPlugin_1.PluginType]=_={}),Object.assign(_,o);const v=h.material;v.map&&(v.map._isSimpleTextTexture&&v.map.dispose(),v.map=void 0),v.alphaMap&&(v.alphaMap._isSimpleTextTexture&&v.alphaMap.dispose(),v.alphaMap=void 0),v.bumpMap&&(v.bumpMap._isSimpleTextTexture&&v.bumpMap.dispose(),v.bumpMap=void 0);const b=await this.makeTextSvg(_);this.applyToMap&&(v.map=b),this.applyToAlphaMap&&(v.alphaMap=b,v.transparent=!0),this.applyToBumpMap&&(v.bumpMap=b),v.userData.inverseAlphaMap=this.inverseAlphaMap,v.setDirty(),v.needsUpdate=!0,(d=(c=this.uiConfig).uiRefresh)===null||d===void 0||d.call(c,"postFrame",!0)}async makeTextSvg(h){const o=h.fontFamily||"Arial",c=h.fontPath||this.fonts[o]||"";let d=h.style;if(c.length>0){const b=c.split("?")[0].split(".").pop()||"woff";d+=`
`+(c.length>0?`
            @font-face {
                font-family: ${o};
                src: url(${c}) format(${fontFormatExtensionMap[b]||b});
            }`:"")}let _=buildTextSvg({...h,fontFamily:o,style:d});_=await Ze$1(_,async b=>this._getAssetData(b)),_=B$2(_);const v=await this._viewer.getManager().importer.importSinglePath(_,{generateMipmaps:!1,minFilter:three_module.k6q});return v._isSimpleTextTexture=!0,v.flipY=!1,v.needsUpdate=!0,v}async _getAssetData(h){var o,c;if(h.startsWith("http://www.w3.org"))return h;const d=(c=(o=this._viewer)===null||o===void 0?void 0:o.getManager())===null||c===void 0?void 0:c.importer;if(!d)throw new Error("no importer");this._assetLoadOptions=this._assetLoadOptions||{fileHandler:new DataUrlLoader(d.loadingManager),processImported:!1};try{return await d.importPath(h,this._assetLoadOptions)}catch(_){return console.error(_),""}}};function buildTextSvg({text:h="Custom Text",svgBackground:o="#ffffff",xOffset:c=0,yOffset:d=0,width:_=1024,height:v=1024,boxWidth:b=1024,boxHeight:tt=1024,fontFamily:it="",fontSize:nt=32,maskText:lt=!0,innerShadow:ut=!0,bgFillColor:ht="#000000",textColor:_t="#ffffff",textAnchor:ft="middle",style:bt=""}){return`
<svg style="background-color:${o}" width="${_}" height="${v}" viewBox="0 0 ${b} ${tt}"
 xmlns="http://www.w3.org/2000/svg"
 xmlns:xlink="http://www.w3.org/1999/xlink">
     <defs>
        <style>
        ${bt}
        </style>
    </defs>

    <g style="overflow:hidden; text-anchor: ${ft}; font-size: ${nt}px; font-family: ${it||"Arial"}">
        <defs>

`+(lt?`
<mask id="textMask">
<text style="fill:white; font-size: ${nt}px;" x="${c+b/2}" y="${tt/2+d+nt/4}" > ${h} </text>
</mask>
`:"")+`

`+(ut?`
<filter id="innerShadow" x="-20%" y="-20%" width="140%" height="140%">
<feGaussianBlur in="SourceGraphic" stdDeviation="0.5" result="blur"/>
<feOffset in="blur" dx="1.5" dy="1.5"/>
</filter>
`:"")+`

        </defs>

`+(lt?`
        <g mask="url(#textMask)">
`:"")+`

        <rect x="0" y="0" width="${b}" height="${tt}" style="fill:${ht}"/>
        <text style="${ut?"filter: url(#innerShadow);":""} fill:${_t};" x="${c+b/2}" y="${tt/2+d+nt/4}"> ${h} </text>

`+(lt?`
        </g>
`:"")+`

    </g>
</svg>
`}SimpleTextPlugin.PluginType="SimpleTextPlugin",SimpleTextPlugin_decorate([uiConfig(void 0,{params:inputHiddenParams})],SimpleTextPlugin.prototype,"options",void 0),SimpleTextPlugin_decorate([uiToggle("Apply Map",inputHiddenParams),x$1(SimpleTextPlugin.prototype._paramsChanged),serialize()],SimpleTextPlugin.prototype,"applyToMap",void 0),SimpleTextPlugin_decorate([uiToggle("Apply Bump Map",inputHiddenParams),x$1(SimpleTextPlugin.prototype._paramsChanged),serialize()],SimpleTextPlugin.prototype,"applyToBumpMap",void 0),SimpleTextPlugin_decorate([uiToggle("Apply Alpha Map",inputHiddenParams),x$1(SimpleTextPlugin.prototype._paramsChanged),serialize()],SimpleTextPlugin.prototype,"applyToAlphaMap",void 0),SimpleTextPlugin_decorate([uiToggle("Invert Alpha Map",inputHiddenParams),x$1(SimpleTextPlugin.prototype._paramsChanged),serialize()],SimpleTextPlugin.prototype,"inverseAlphaMap",void 0),SimpleTextPlugin_decorate([uiButton("Add Text",h=>({hidden:()=>!h.getSelected()}))],SimpleTextPlugin.prototype,"addTextToSelected",null),SimpleTextPlugin=SimpleTextPlugin_1=SimpleTextPlugin_decorate([uiFolder("Simple Text")],SimpleTextPlugin);var SceneLoopPlugin_decorate=function(h,o,c,d){var _,v=arguments.length,b=v<3?o:d===null?d=Object.getOwnPropertyDescriptor(o,c):d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(h,o,c,d);else for(var tt=h.length-1;tt>=0;tt--)(_=h[tt])&&(b=(v<3?_(b):v>3?_(o,c,b):_(o,c))||b);return v>3&&b&&Object.defineProperty(o,c,b),b};let SceneLoopPlugin=class extends AViewerPlugin{constructor(){super(),this.enabled=!0,this.dependencies=[AssetManagerPlugin],this.scenes=[],this.assets={},this.toJSON=void 0,this._isPlaying=!1,this._isPlayingLoop=!1,this._options={},this.minSceneTime=2e3,this.loadScenes=this.loadScenes.bind(this),this.play=this.play.bind(this),this.stop=this.stop.bind(this),this.downloadScenes=this.downloadScenes.bind(this),this.promptLoadScenes=this.promptLoadScenes.bind(this)}get loadedScenes(){return this.scenes.length}async promptLoadScenes(){const h=await ge$1(!0,!1,"model/gltf");await this.loadScenes(h)}async loadScenes(h){var o,c;const d=await Promise.all(h.map(async _=>await _.arrayBuffer()));for(let _=0;_<h.length;_++){const v=h[_];this.scenes.push({[v.name]:new Uint8Array(d[_])}),this.assets[v.name]={path:v.name,file:v}}(c=(o=this.uiConfig)===null||o===void 0?void 0:o.uiRefresh)===null||c===void 0||c.call(o)}async play(){var h,o;if(!this._viewer||this._isPlaying||this._isPlayingLoop)return;this._isPlaying=!0,this._isPlayingLoop=!0;const c=(h=this._viewer.getPluginByType("AssetManagerBasicPopupPlugin"))!==null&&h!==void 0?h:this._viewer.getPluginByType("LoadingScreenPlugin");c==null||c.enabled,c&&(c.enabled=!1);const d=this._viewer.getPluginByType("FrameFade"),_=this._viewer.getPluginByType("GLTFAnimation"),v=this._viewer.getPluginByType("CameraViews");for(;this._isPlaying;)for(const b of this.scenes){if(!this._isPlaying)break;const tt=Object.keys(b);_==null||_.stopAnimation(!1),await(v==null?void 0:v.stopAllAnimations()),this._viewer.scene.removeSceneModels(),this._viewer.renderEnabled=!1;for(const nt of tt){let lt=this.assets[nt];lt||(lt={path:nt,file:new File([b[nt]],nt)},this.assets[nt]=lt),await((o=this._viewer.getManager())===null||o===void 0?void 0:o.addAssetSingle(lt,this._options))}if(!this._isPlaying)break;this._viewer.renderEnabled=!0,c&&(c.enabled=!1),d&&(d.enabled=!0,await d.startTransition(1e3));const it=[X$2(this.minSceneTime)];_&&it.push(_.playAnimation()),v&&it.push(v.animateAllViews()),await Promise.all(it)}this._isPlayingLoop=!1}stop(){this._isPlaying=!1}async downloadScenes(){const h={};for(const c of this.scenes)for(const d of Object.keys(c)){const _=h[d]?d+"_":d;h[_]=c[_]}const o=zipSync(h);N$2(new Blob([o],{type:"application/zip"}),"scenes.glbloop")}async onAdded(h){var o,c;await super.onAdded(h);const d=this;(c=(o=h.getManager())===null||o===void 0?void 0:o.importer)===null||c===void 0||c.Importers.push(new Importer(class extends ZipLoader{load(_,v,b,tt){super.load(_,it=>{d.loadScenes([...it.values()]),v==null||v(null),X$2(100).then(d.play)},b,tt)}},["glbloop"],!0))}};SceneLoopPlugin.PluginType="SceneLoopPlugin",SceneLoopPlugin_decorate([uiMonitor("Loaded scenes")],SceneLoopPlugin.prototype,"loadedScenes",null),SceneLoopPlugin_decorate([uiButton("Load Scenes")],SceneLoopPlugin.prototype,"promptLoadScenes",null),SceneLoopPlugin_decorate([uiMonitor("Playing")],SceneLoopPlugin.prototype,"_isPlaying",void 0),SceneLoopPlugin_decorate([uiInput("Min Scene Time")],SceneLoopPlugin.prototype,"minSceneTime",void 0),SceneLoopPlugin_decorate([uiButton("Play")],SceneLoopPlugin.prototype,"play",null),SceneLoopPlugin_decorate([uiButton("Stop")],SceneLoopPlugin.prototype,"stop",null),SceneLoopPlugin_decorate([uiButton("Download Scenes")],SceneLoopPlugin.prototype,"downloadScenes",null),SceneLoopPlugin=SceneLoopPlugin_decorate([uiFolder("Scene Loop")],SceneLoopPlugin);class NBuf3{constructor(o){this.top=0,this.array=new Float32Array(o)}write(o){this.array[this.top++]=o.x,this.array[this.top++]=o.y,this.array[this.top++]=o.z}}class NBuf2{constructor(o){this.top=0,this.array=new Float32Array(o)}write(o){this.array[this.top++]=o.x,this.array[this.top++]=o.y}}class Node_Node{constructor(o){this.plane=null,this.front=null,this.back=null,this.polygons=[],o&&this.build(o)}clone(){const o=new Node_Node;return o.plane=this.plane&&this.plane.clone(),o.front=this.front&&this.front.clone(),o.back=this.back&&this.back.clone(),o.polygons=this.polygons.map(c=>c.clone()),o}invert(){for(let c=0;c<this.polygons.length;c++)this.polygons[c].flip();this.plane&&this.plane.flip(),this.front&&this.front.invert(),this.back&&this.back.invert();const o=this.front;this.front=this.back,this.back=o}clipPolygons(o){if(!this.plane)return o.slice();let c=new Array,d=new Array;for(let _=0;_<o.length;_++)this.plane.splitPolygon(o[_],c,d,c,d);return this.front&&(c=this.front.clipPolygons(c)),d=this.back?this.back.clipPolygons(d):[],c.concat(d)}clipTo(o){this.polygons=o.clipPolygons(this.polygons),this.front&&this.front.clipTo(o),this.back&&this.back.clipTo(o)}allPolygons(){let o=this.polygons.slice();return this.front&&(o=o.concat(this.front.allPolygons())),this.back&&(o=o.concat(this.back.allPolygons())),o}build(o){if(!o.length)return;this.plane||(this.plane=o[0].plane.clone());const c=[],d=[];for(let _=0;_<o.length;_++)this.plane.splitPolygon(o[_],this.polygons,this.polygons,c,d);c.length&&(this.front||(this.front=new Node_Node),this.front.build(c)),d.length&&(this.back||(this.back=new Node_Node),this.back.build(d))}}class Vector{constructor(o=0,c=0,d=0){this.x=o,this.y=c,this.z=d}copy(o){return this.x=o.x,this.y=o.y,this.z=o.z,this}clone(){return new Vector(this.x,this.y,this.z)}negate(){return this.x*=-1,this.y*=-1,this.z*=-1,this}add(o){return this.x+=o.x,this.y+=o.y,this.z+=o.z,this}sub(o){return this.x-=o.x,this.y-=o.y,this.z-=o.z,this}times(o){return this.x*=o,this.y*=o,this.z*=o,this}dividedBy(o){return this.x/=o,this.y/=o,this.z/=o,this}lerp(o,c){return this.add(new Vector().copy(o).sub(this).times(c))}unit(){return this.dividedBy(this.length())}length(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2)+Math.pow(this.z,2))}normalize(){return this.unit()}cross(o){const c=this.clone(),d=c.x,_=c.y,v=c.z,b=o.x,tt=o.y,it=o.z;return this.x=_*it-v*tt,this.y=v*b-d*it,this.z=d*tt-_*b,this}dot(o){return this.x*o.x+this.y*o.y+this.z*o.z}toVector3(){return new three_module.Pq0(this.x,this.y,this.z)}}class Plane{constructor(o,c){this.normal=o,this.w=c,this.normal=o,this.w=c}clone(){return new Plane(this.normal.clone(),this.w)}flip(){this.normal.negate(),this.w=-this.w}splitPolygon(o,c,d,_,v){let b=0;const tt=[];for(let it=0;it<o.vertices.length;it++){const nt=this.normal.dot(o.vertices[it].pos)-this.w,lt=nt<-Plane.EPSILON?2:nt>Plane.EPSILON?1:0;b|=lt,tt.push(lt)}switch(b){case 0:(this.normal.dot(o.plane.normal)>0?c:d).push(o);break;case 1:_.push(o);break;case 2:v.push(o);break;case 3:{const it=[],nt=[];for(let lt=0;lt<o.vertices.length;lt++){const ut=(lt+1)%o.vertices.length,ht=tt[lt],_t=tt[ut],ft=o.vertices[lt],bt=o.vertices[ut];if(ht!=2&&it.push(ft),ht!=1&&nt.push(ht!=2?ft.clone():ft),(ht|_t)==3){const xt=(this.w-this.normal.dot(ft.pos))/this.normal.dot(new Vector().copy(bt.pos).sub(ft.pos)),St=ft.interpolate(bt,xt);it.push(St),nt.push(St.clone())}}it.length>=3&&_.push(new Polygon(it,o.shared)),nt.length>=3&&v.push(new Polygon(nt,o.shared));break}}}static fromPoints(o,c,d){const _=new Vector().copy(c).sub(o).cross(new Vector().copy(d).sub(o)).normalize();return new Plane(_.clone(),_.dot(o))}}Plane.EPSILON=1e-5;class Polygon{constructor(o,c){this.vertices=o,this.shared=c,this.plane=Plane.fromPoints(o[0].pos,o[1].pos,o[2].pos)}clone(){return new Polygon(this.vertices.map(o=>o.clone()),this.shared)}flip(){this.vertices.reverse().map(o=>o.flip()),this.plane.flip()}}class Vertex{constructor(o,c,d,_){this.pos=new Vector().copy(o),this.normal=new Vector().copy(c),this.uv=new Vector().copy(d),this.uv.z=0,_&&(this.color=new Vector().copy(_))}clone(){return new Vertex(this.pos,this.normal,this.uv,this.color)}flip(){this.normal.negate()}interpolate(o,c){return new Vertex(this.pos.clone().lerp(o.pos,c),this.normal.clone().lerp(o.normal,c),this.uv.clone().lerp(o.uv,c),this.color&&o.color&&this.color.clone().lerp(o.color,c))}}class CSG{constructor(){this.polygons=new Array}static fromPolygons(o){const c=new CSG;return c.polygons=o,c}static fromGeometry(o,c){let d=[];const _=o.attributes.position,v=o.attributes.normal,b=o.attributes.uv,tt=o.attributes.color,it=o.groups;let nt;if(o.index)nt=o.index.array;else{nt=new Array(_.array.length/_.itemSize|0);for(let ut=0;ut<nt.length;ut++)nt[ut]=ut}const lt=nt.length/3|0;d=new Array(lt);for(let ut=0,ht=0,_t=nt.length;ut<_t;ut+=3,ht++){const ft=new Array(3);for(let bt=0;bt<3;bt++){const xt=nt[ut+bt],St=3*xt,wt=2*xt,Pt=_.array[St],Rt=_.array[St+1],kt=_.array[St+2],Gt=v.array[St],Dt=v.array[St+1],It=v.array[St+2],Nt=b==null?void 0:b.array[wt],Vt=b==null?void 0:b.array[wt+1];ft[bt]=new Vertex(new Vector(Pt,Rt,kt),new Vector(Gt,Dt,It),new Vector(Nt,Vt,0),tt&&new Vector(tt.array[wt],tt.array[wt+1],tt.array[wt+2]))}if(c===void 0&&it&&it.length>0)for(const bt of it)ut>=bt.start&&ut<bt.start+bt.count&&(d[ht]=new Polygon(ft,bt.materialIndex));else d[ht]=new Polygon(ft,c)}return CSG.fromPolygons(d.filter(ut=>!isNaN(ut.plane.normal.x)))}static toGeometry(o,c){let d=0;const _=o.polygons;for(const _t of _)d+=_t.vertices.length-2;const v=new three_module.LoY,b=new NBuf3(3*d*3),tt=new NBuf3(3*d*3),it=new NBuf2(2*d*3);let nt;const lt=[],ut=[];for(const _t of _){const ft=_t.vertices,bt=ft.length;_t.shared!==void 0&&(lt[_t.shared]||(lt[_t.shared]=[])),bt&&ft[0].color!==void 0&&(nt||(nt=new NBuf3(3*d*3)));for(let xt=3;xt<=bt;xt++)(_t.shared===void 0?ut:lt[_t.shared]).push(b.top/3,b.top/3+1,b.top/3+2),b.write(ft[0].pos),b.write(ft[xt-2].pos),b.write(ft[xt-1].pos),tt.write(ft[0].normal),tt.write(ft[xt-2].normal),tt.write(ft[xt-1].normal),it&&(it.write(ft[0].uv),it.write(ft[xt-2].uv),it.write(ft[xt-1].uv)),nt&&(nt.write(ft[0].color),nt.write(ft[xt-2].color),nt.write(ft[xt-1].color))}v.setAttribute("position",new three_module.THS(b.array,3)),v.setAttribute("normal",new three_module.THS(tt.array,3)),it&&v.setAttribute("uv",new three_module.THS(it.array,2)),nt&&v.setAttribute("color",new three_module.THS(nt.array,3));for(let _t=0;_t<lt.length;_t++)lt[_t]===void 0&&(lt[_t]=[]);if(lt.length){let _t=[],ft=0;for(let bt=0;bt<lt.length;bt++)v.addGroup(ft,lt[bt].length,bt),ft+=lt[bt].length,_t=_t.concat(lt[bt]);v.addGroup(ft,ut.length,lt.length),_t=_t.concat(ut),v.setIndex(_t)}const ht=new three_module.kn4().copy(c).invert();return v.applyMatrix4(ht),v.computeBoundingSphere(),v.computeBoundingBox(),v}static fromMesh(o,c){const d=CSG.fromGeometry(o.geometry,c),_=new three_module.Pq0,v=new three_module.dwI;v.getNormalMatrix(o.matrix);for(let b=0;b<d.polygons.length;b++){const tt=d.polygons[b];for(let it=0;it<tt.vertices.length;it++){const nt=tt.vertices[it];nt.pos.copy(_.copy(nt.pos.toVector3()).applyMatrix4(o.matrix)),nt.normal.copy(_.copy(nt.normal.toVector3()).applyMatrix3(v))}}return d}static toMesh(o,c,d){const _=CSG.toGeometry(o,c),v=new three_module.eaF(_,d);return v.matrix.copy(c),v.matrix.decompose(v.position,v.quaternion,v.scale),v.rotation.setFromQuaternion(v.quaternion),v.updateMatrixWorld(),v.castShadow=v.receiveShadow=!0,v}static union(o,c){const d=CSG.fromMesh(o),_=CSG.fromMesh(c);return CSG.toMesh(d.union(_),o.matrix,o.material)}static subtract(o,c){const d=CSG.fromMesh(o),_=CSG.fromMesh(c);return CSG.toMesh(d.subtract(_),o.matrix,o.material)}static intersect(o,c){const d=CSG.fromMesh(o),_=CSG.fromMesh(c);return CSG.toMesh(d.intersect(_),o.matrix,o.material)}clone(){const o=new CSG;return o.polygons=this.polygons.map(c=>c.clone()).filter(c=>Number.isFinite(c.plane.w)),o}toPolygons(){return this.polygons}union(o){const c=new Node_Node(this.clone().polygons),d=new Node_Node(o.clone().polygons);return c.clipTo(d),d.clipTo(c),d.invert(),d.clipTo(c),d.invert(),c.build(d.allPolygons()),CSG.fromPolygons(c.allPolygons())}subtract(o){const c=new Node_Node(this.clone().polygons),d=new Node_Node(o.clone().polygons);return c.invert(),c.clipTo(d),d.clipTo(c),d.invert(),d.clipTo(c),d.invert(),c.build(d.allPolygons()),c.invert(),CSG.fromPolygons(c.allPolygons())}intersect(o){const c=new Node_Node(this.clone().polygons),d=new Node_Node(o.clone().polygons);return c.invert(),d.clipTo(c),d.invert(),c.clipTo(d),d.clipTo(c),c.build(d.allPolygons()),c.invert(),CSG.fromPolygons(c.allPolygons())}inverse(){const o=this.clone();for(const c of o.polygons)c.flip();return o}toMesh(o,c){return CSG.toMesh(this,o,c)}toGeometry(o){return CSG.toGeometry(this,o)}}var CSGPluginBase_decorate=function(h,o,c,d){var _,v=arguments.length,b=v<3?o:d===null?d=Object.getOwnPropertyDescriptor(o,c):d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(h,o,c,d);else for(var tt=h.length-1;tt>=0;tt--)(_=h[tt])&&(b=(v<3?_(b):v>3?_(o,c,b):_(o,c))||b);return v>3&&b&&Object.defineProperty(o,c,b),b};const csgOperations=["union","subtract","intersect"];class CSGPluginBase extends AViewerPlugin{constructor(){super(),this.enabled=!0,this.toJSON=void 0,this.dependencies=[PickingPlugin],this.rootMesh=new three_module.eaF,this.showResult=!1,this.csgSelectedEnabled=!1,this.csgSelectedOperation="union",this._csgNeedsUpdate=!1,this._csgVisible=!1,this._sceneUpdate=this._sceneUpdate.bind(this),this._preFrame=this._preFrame.bind(this),this.makeSelectedCSGBrush=this.makeSelectedCSGBrush.bind(this),this.refreshCSG=this.refreshCSG.bind(this),this._selectedObjectChanged=this._selectedObjectChanged.bind(this),this._updateSelectedProperties=this._updateSelectedProperties.bind(this),this.downloadObject=this.downloadObject.bind(this),this.exportObject=this.exportObject.bind(this)}async onAdded(o){var c;await super.onAdded(o),this.rootObject=await o.createObject3D(),this.rootObject.modelObject.add(this.rootMesh),o.scene.addEventListener("sceneUpdate",this._sceneUpdate),o.addEventListener("preFrame",this._preFrame),(c=o.getPlugin(PickingPlugin))===null||c===void 0||c.addEventListener("selectedObjectChanged",this._selectedObjectChanged)}async makeSelectedCSGBrush(){var o,c;const d=(c=(o=this._viewer)===null||o===void 0?void 0:o.getPlugin(PickingPlugin))===null||c===void 0?void 0:c.getSelectedObject();d&&d.geometry&&(d.userData._isCSGMesh||(d.userData.csgBrush||(d.userData.csgBrush={enabled:!0,operation:"union"}),this._selectedObjectChanged()))}refreshCSG(){this._sceneUpdate()}async downloadObject(){const o=await this.exportObject();o&&N$2(o,"csg."+o.ext)}async exportObject(){var o,c;const d=(c=(o=this._viewer)===null||o===void 0?void 0:o.getPluginByType("AssetExporterPlugin"))===null||c===void 0?void 0:c.exporter;if(!d||!this.rootObject)return;const _=this.rootMesh.visible;this.rootMesh.visible=!0;const v=await d.exportObject(this.rootObject.modelObject,{});return this.rootMesh.visible=_,v}_updateSelectedProperties(){var o,c;const d=(c=(o=this._viewer)===null||o===void 0?void 0:o.getPlugin(PickingPlugin))===null||c===void 0?void 0:c.getSelectedObject();d&&d.userData.csgBrush&&(d.userData.csgBrush.enabled=this.csgSelectedEnabled,d.userData.csgBrush.operation=this.csgSelectedOperation)}_selectedObjectChanged(){var o,c,d,_,v,b,tt,it;const nt=(c=(o=this._viewer)===null||o===void 0?void 0:o.getPlugin(PickingPlugin))===null||c===void 0?void 0:c.getSelectedObject();nt&&(this.csgSelectedEnabled=(_=(d=nt.userData.csgBrush)===null||d===void 0?void 0:d.enabled)!==null&&_!==void 0&&_,this.csgSelectedOperation=(b=(v=nt.userData.csgBrush)===null||v===void 0?void 0:v.operation)!==null&&b!==void 0?b:"union"),(it=(tt=this.uiConfig)===null||tt===void 0?void 0:tt.uiRefresh)===null||it===void 0||it.call(tt,"postFrame",!0)}_preFrame(){var o,c,d;if(!this.rootObject||!this._csgNeedsUpdate&&this._csgVisible===this.showResult)return;const _=this._findCSGMeshes();this._csgNeedsUpdate&&(this._csgNeedsUpdate=!1,(o=this.rootObject)===null||o===void 0||o.modelObject.updateMatrixWorld(!0),((c=this.rootMesh.userData.dispose)!==null&&c!==void 0?c:this.rootMesh.removeFromParent)(),this.rootMesh=this._buildCSGMesh(_)),this.rootMesh&&!this.rootMesh.parent&&((d=this.rootObject)===null||d===void 0||d.modelObject.add(this.rootMesh)),this.showResult?(_.forEach(v=>{v[0].visible=!1}),this.rootObject.visible=!0,this._csgVisible=!0,this.rootObject.setDirty()):(_.forEach(v=>{v[0].visible=!0}),this.rootObject.visible=!1,this._csgVisible=!1,this.rootObject.setDirty())}_findCSGMeshes(){var o;const c=[];return(o=this._viewer)===null||o===void 0||o.scene.traverse(d=>{var _;d.isMesh&&d.geometry&&!((_=d.userData.csgBrush)===null||_===void 0)&&_.enabled&&c.push([d,d.userData.csgBrush.operation])}),c}_sceneUpdate(o){var c,d;!((d=(c=o==null?void 0:o.object)===null||c===void 0?void 0:c.userData)===null||d===void 0)&&d._isCSGMesh||(this._csgNeedsUpdate=!0)}}CSGPluginBase_decorate([uiToggle("Show Result",h=>({onChange:()=>{var o;return(o=h._viewer)===null||o===void 0?void 0:o.setDirty()}}))],CSGPluginBase.prototype,"showResult",void 0),CSGPluginBase_decorate([uiButton("Make CSG Brush",h=>({hidden:()=>{var o,c;const d=(c=(o=h._viewer)===null||o===void 0?void 0:o.getPlugin(PickingPlugin))===null||c===void 0?void 0:c.getSelectedObject();return!(d!=null&&d.userData)||!!d.userData.csgBrush||d.userData._isCSGMesh}}))],CSGPluginBase.prototype,"makeSelectedCSGBrush",null),CSGPluginBase_decorate([uiToggle("Enabled",h=>({hidden:()=>{var o,c;const d=(c=(o=h._viewer)===null||o===void 0?void 0:o.getPlugin(PickingPlugin))===null||c===void 0?void 0:c.getSelectedObject();return!d||!d.userData.csgBrush},onChange:h._updateSelectedProperties}))],CSGPluginBase.prototype,"csgSelectedEnabled",void 0),CSGPluginBase_decorate([uiDropdown("Operation",csgOperations.map(h=>({label:h})),h=>({hidden:()=>{var o,c;const d=(c=(o=h._viewer)===null||o===void 0?void 0:o.getPlugin(PickingPlugin))===null||c===void 0?void 0:c.getSelectedObject();return!d||!d.userData.csgBrush},onChange:h._updateSelectedProperties}))],CSGPluginBase.prototype,"csgSelectedOperation",void 0),CSGPluginBase_decorate([uiButton("Refresh CSG")],CSGPluginBase.prototype,"refreshCSG",null),CSGPluginBase_decorate([uiButton("Export Result",h=>({hidden:()=>{var o;return!(!((o=h._viewer)===null||o===void 0)&&o.getPluginByType("AssetExporterPlugin"))}}))],CSGPluginBase.prototype,"downloadObject",null);var CSGPluginBSP_decorate=function(h,o,c,d){var _,v=arguments.length,b=v<3?o:d===null?d=Object.getOwnPropertyDescriptor(o,c):d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(h,o,c,d);else for(var tt=h.length-1;tt>=0;tt--)(_=h[tt])&&(b=(v<3?_(b):v>3?_(o,c,b):_(o,c))||b);return v>3&&b&&Object.defineProperty(o,c,b),b};function buildCSGMeshBSP(h,o){let c=new CSG;const d=h.map(v=>v[0].material).flatMap(v=>v);h.forEach(([v,b])=>{if(!csgOperations.includes(b))return void console.error(`Unknown operation ${b}`);v.updateMatrix(),v.updateMatrixWorld();const tt=v.matrix;v.matrix=v.matrixWorld;let it=0;it=Array.isArray(v.material)?void 0:d.indexOf(v.material),c=c[b](CSG.fromMesh(v,it)),v.matrix=tt});const _=c.toMesh(o??new three_module.kn4().identity(),d);return _.userData._isCSGMesh=!0,_.geometry.groups=_.geometry.groups.filter(v=>v.count>0),_}let CSGPluginBSP=class extends CSGPluginBase{_buildCSGMesh(h){return buildCSGMeshBSP(h)}};CSGPluginBSP.PluginType="CSGPluginBSP",CSGPluginBSP=CSGPluginBSP_decorate([uiFolder("CSG Plugin (BSP)")],CSGPluginBSP);const ADDITION=0,SUBTRACTION=1,REVERSE_SUBTRACTION=2,INTERSECTION=3,DIFFERENCE=4,HOLLOW_SUBTRACTION=5,HOLLOW_INTERSECTION=6;class SeparatingAxisBounds{constructor(){this.min=1/0,this.max=-1/0}setFromPointsField(o,c){let d=1/0,_=-1/0;for(let v=0,b=o.length;v<b;v++){const tt=o[v][c];d=tt<d?tt:d,_=tt>_?tt:_}this.min=d,this.max=_}setFromPoints(o,c){let d=1/0,_=-1/0;for(let v=0,b=c.length;v<b;v++){const tt=c[v],it=o.dot(tt);d=it<d?it:d,_=it>_?it:_}this.min=d,this.max=_}isSeparated(o){return this.min>o.max||o.min>this.max}}SeparatingAxisBounds.prototype.setFromBox=function(){const h=new three_module.Pq0;return function(o,c){const d=c.min,_=c.max;let v=1/0,b=-1/0;for(let tt=0;tt<=1;tt++)for(let it=0;it<=1;it++)for(let nt=0;nt<=1;nt++){h.x=d.x*tt+_.x*(1-tt),h.y=d.y*it+_.y*(1-it),h.z=d.z*nt+_.z*(1-nt);const lt=o.dot(h);v=Math.min(lt,v),b=Math.max(lt,b)}this.min=v,this.max=b}}();const closestPointLineToLine=function(){const h=new three_module.Pq0,o=new three_module.Pq0,c=new three_module.Pq0;return function(d,_,v){const b=d.start,tt=h,it=_.start,nt=o;c.subVectors(b,it),h.subVectors(d.end,d.start),o.subVectors(_.end,_.start);const lt=c.dot(nt),ut=nt.dot(tt),ht=nt.dot(nt),_t=c.dot(tt),ft=tt.dot(tt)*ht-ut*ut;let bt,xt;bt=ft!==0?(lt*ut-_t*ht)/ft:0,xt=(lt+bt*ut)/ht,v.x=bt,v.y=xt}}(),closestPointsSegmentToSegment=function(){const h=new three_module.I9Y,o=new three_module.Pq0,c=new three_module.Pq0;return function(d,_,v,b){closestPointLineToLine(d,_,h);let tt=h.x,it=h.y;if(tt>=0&&tt<=1&&it>=0&&it<=1)return d.at(tt,v),void _.at(it,b);if(tt>=0&&tt<=1)return it<0?_.at(0,b):_.at(1,b),void d.closestPointToPoint(b,!0,v);if(it>=0&&it<=1)return tt<0?d.at(0,v):d.at(1,v),void _.closestPointToPoint(v,!0,b);{let nt,lt;nt=tt<0?d.start:d.end,lt=it<0?_.start:_.end;const ut=o,ht=c;return d.closestPointToPoint(lt,!0,o),_.closestPointToPoint(nt,!0,c),ut.distanceToSquared(lt)<=ht.distanceToSquared(nt)?(v.copy(ut),void b.copy(lt)):(v.copy(nt),void b.copy(ht))}}}(),sphereIntersectTriangle=function(){const h=new three_module.Pq0,o=new three_module.Pq0,c=new three_module.Zcv,d=new three_module.cZY;return function(_,v){const{radius:b,center:tt}=_,{a:it,b:nt,c:lt}=v;if(d.start=it,d.end=nt,d.closestPointToPoint(tt,!0,h).distanceTo(tt)<=b||(d.start=it,d.end=lt,d.closestPointToPoint(tt,!0,h).distanceTo(tt)<=b)||(d.start=nt,d.end=lt,d.closestPointToPoint(tt,!0,h).distanceTo(tt)<=b))return!0;const ut=v.getPlane(c);if(Math.abs(ut.distanceToPoint(tt))<=b){const ht=ut.projectPoint(tt,o);if(v.containsPoint(ht))return!0}return!1}}(),ZERO_EPSILON=1e-15;function isNearZero(h){return Math.abs(h)<ZERO_EPSILON}class ExtendedTriangle extends three_module.lMl{constructor(...o){super(...o),this.isExtendedTriangle=!0,this.satAxes=new Array(4).fill().map(()=>new three_module.Pq0),this.satBounds=new Array(4).fill().map(()=>new SeparatingAxisBounds),this.points=[this.a,this.b,this.c],this.sphere=new three_module.iyt,this.plane=new three_module.Zcv,this.needsUpdate=!0}intersectsSphere(o){return sphereIntersectTriangle(o,this)}update(){const o=this.a,c=this.b,d=this.c,_=this.points,v=this.satAxes,b=this.satBounds,tt=v[0],it=b[0];this.getNormal(tt),it.setFromPoints(tt,_);const nt=v[1],lt=b[1];nt.subVectors(o,c),lt.setFromPoints(nt,_);const ut=v[2],ht=b[2];ut.subVectors(c,d),ht.setFromPoints(ut,_);const _t=v[3],ft=b[3];_t.subVectors(d,o),ft.setFromPoints(_t,_),this.sphere.setFromPoints(this.points),this.plane.setFromNormalAndCoplanarPoint(tt,o),this.needsUpdate=!1}}ExtendedTriangle.prototype.closestPointToSegment=function(){const h=new three_module.Pq0,o=new three_module.Pq0,c=new three_module.cZY;return function(d,_=null,v=null){const{start:b,end:tt}=d,it=this.points;let nt,lt=1/0;for(let ut=0;ut<3;ut++){const ht=(ut+1)%3;c.start.copy(it[ut]),c.end.copy(it[ht]),closestPointsSegmentToSegment(c,d,h,o),nt=h.distanceToSquared(o),nt<lt&&(lt=nt,_&&_.copy(h),v&&v.copy(o))}return this.closestPointToPoint(b,h),nt=b.distanceToSquared(h),nt<lt&&(lt=nt,_&&_.copy(h),v&&v.copy(b)),this.closestPointToPoint(tt,h),nt=tt.distanceToSquared(h),nt<lt&&(lt=nt,_&&_.copy(h),v&&v.copy(tt)),Math.sqrt(lt)}}(),ExtendedTriangle.prototype.intersectsTriangle=function(){const h=new ExtendedTriangle,o=new Array(3),c=new Array(3),d=new SeparatingAxisBounds,_=new SeparatingAxisBounds,v=new three_module.Pq0,b=new three_module.Pq0,tt=new three_module.Pq0,it=new three_module.Pq0,nt=new three_module.Pq0,lt=new three_module.cZY,ut=new three_module.cZY,ht=new three_module.cZY,_t=new three_module.Pq0;function ft(bt,xt,St){const wt=bt.points;let Pt=0,Rt=-1;for(let kt=0;kt<3;kt++){const{start:Gt,end:Dt}=lt;Gt.copy(wt[kt]),Dt.copy(wt[(kt+1)%3]),lt.delta(b);const It=isNearZero(xt.distanceToPoint(Gt));if(isNearZero(xt.normal.dot(b))&&It){St.copy(lt),Pt=2;break}const Nt=xt.intersectLine(lt,_t);if(!Nt&&It&&_t.copy(Gt),(Nt||It)&&!isNearZero(_t.distanceTo(Dt))){if(Pt<=1)(Pt===1?St.start:St.end).copy(_t),It&&(Rt=Pt);else if(Pt>=2){(Rt===1?St.start:St.end).copy(_t),Pt=2;break}if(Pt++,Pt===2&&Rt===-1)break}}return Pt}return function(bt,xt=null,St=!1){this.needsUpdate&&this.update(),bt.isExtendedTriangle?bt.needsUpdate&&bt.update():(h.copy(bt),h.update(),bt=h);const wt=this.plane,Pt=bt.plane;if(Math.abs(wt.normal.dot(Pt.normal))>1-1e-10){const Rt=this.satBounds,kt=this.satAxes;c[0]=bt.a,c[1]=bt.b,c[2]=bt.c;for(let It=0;It<4;It++){const Nt=Rt[It],Vt=kt[It];if(d.setFromPoints(Vt,c),Nt.isSeparated(d))return!1}const Gt=bt.satBounds,Dt=bt.satAxes;o[0]=this.a,o[1]=this.b,o[2]=this.c;for(let It=0;It<4;It++){const Nt=Gt[It],Vt=Dt[It];if(d.setFromPoints(Vt,o),Nt.isSeparated(d))return!1}for(let It=0;It<4;It++){const Nt=kt[It];for(let Vt=0;Vt<4;Vt++){const Kt=Dt[Vt];if(v.crossVectors(Nt,Kt),d.setFromPoints(v,o),_.setFromPoints(v,c),d.isSeparated(_))return!1}}return xt&&(St||console.warn("ExtendedTriangle.intersectsTriangle: Triangles are coplanar which does not support an output edge. Setting edge to 0, 0, 0."),xt.start.set(0,0,0),xt.end.set(0,0,0)),!0}{const Rt=ft(this,Pt,ut);if(Rt===1&&bt.containsPoint(ut.end))return xt&&(xt.start.copy(ut.end),xt.end.copy(ut.end)),!0;if(Rt!==2)return!1;const kt=ft(bt,wt,ht);if(kt===1&&this.containsPoint(ht.end))return xt&&(xt.start.copy(ht.end),xt.end.copy(ht.end)),!0;if(kt!==2)return!1;if(ut.delta(tt),ht.delta(it),tt.dot(it)<0){let Vt=ht.start;ht.start=ht.end,ht.end=Vt}const Gt=ut.start.dot(tt),Dt=ut.end.dot(tt),It=ht.start.dot(tt),Nt=ht.end.dot(tt);return(Gt===Nt||It===Dt||Dt<It!=Gt<Nt)&&(xt&&(nt.subVectors(ut.start,ht.start),nt.dot(tt)>0?xt.start.copy(ut.start):xt.start.copy(ht.start),nt.subVectors(ut.end,ht.end),nt.dot(tt)<0?xt.end.copy(ut.end):xt.end.copy(ht.end)),!0)}}}(),ExtendedTriangle.prototype.distanceToPoint=function(){const h=new three_module.Pq0;return function(o){return this.closestPointToPoint(o,h),o.distanceTo(h)}}(),ExtendedTriangle.prototype.distanceToTriangle=function(){const h=new three_module.Pq0,o=new three_module.Pq0,c=["a","b","c"],d=new three_module.cZY,_=new three_module.cZY;return function(v,b=null,tt=null){const it=b||tt?d:null;if(this.intersectsTriangle(v,it))return(b||tt)&&(b&&it.getCenter(b),tt&&it.getCenter(tt)),0;let nt=1/0;for(let lt=0;lt<3;lt++){let ut;const ht=c[lt],_t=v[ht];this.closestPointToPoint(_t,h),ut=_t.distanceToSquared(h),ut<nt&&(nt=ut,b&&b.copy(h),tt&&tt.copy(_t));const ft=this[ht];v.closestPointToPoint(ft,h),ut=ft.distanceToSquared(h),ut<nt&&(nt=ut,b&&b.copy(ft),tt&&tt.copy(h))}for(let lt=0;lt<3;lt++){const ut=c[lt],ht=c[(lt+1)%3];d.set(this[ut],this[ht]);for(let _t=0;_t<3;_t++){const ft=c[_t],bt=c[(_t+1)%3];_.set(v[ft],v[bt]),closestPointsSegmentToSegment(d,_,h,o);const xt=h.distanceToSquared(o);xt<nt&&(nt=xt,b&&b.copy(h),tt&&tt.copy(o))}}return Math.sqrt(nt)}}();const EPSILON=1e-14,_AB=new three_module.Pq0,_AC=new three_module.Pq0,_CB=new three_module.Pq0;function isTriDegenerate(h,o=EPSILON){_AB.subVectors(h.b,h.a),_AC.subVectors(h.c,h.a),_CB.subVectors(h.b,h.c);const c=_AB.angleTo(_AC),d=_AB.angleTo(_CB),_=Math.PI-c-d;return Math.abs(c)<o||Math.abs(d)<o||Math.abs(_)<o||h.a.distanceToSquared(h.b)<o||h.a.distanceToSquared(h.c)<o||h.b.distanceToSquared(h.c)<o}const TriangleSplitter_EPSILON=1e-10,COPLANAR_EPSILON=1e-10,PARALLEL_EPSILON=1e-10,_edge=new three_module.cZY,_foundEdge=new three_module.cZY,_vec=new three_module.Pq0,_triangleNormal=new three_module.Pq0,_planeNormal=new three_module.Pq0,TriangleSplitter_plane=new three_module.Zcv,_splittingTriangle=new ExtendedTriangle;class TrianglePool{constructor(){this._pool=[],this._index=0}getTriangle(){return this._index>=this._pool.length&&this._pool.push(new three_module.lMl),this._pool[this._index++]}clear(){this._index=0}reset(){this._pool.length=0,this._index=0}}class TriangleSplitter{constructor(){this.trianglePool=new TrianglePool,this.triangles=[],this.normal=new three_module.Pq0,this.coplanarTriangleUsed=!1}initialize(o){this.reset();const{triangles:c,trianglePool:d,normal:_}=this;if(Array.isArray(o))for(let v=0,b=o.length;v<b;v++){const tt=o[v];if(v===0)tt.getNormal(_);else if(Math.abs(1-tt.getNormal(_vec).dot(_))>TriangleSplitter_EPSILON)throw new Error("Triangle Splitter: Cannot initialize with triangles that have different normals.");const it=d.getTriangle();it.copy(tt),c.push(it)}else{o.getNormal(_);const v=d.getTriangle();v.copy(o),c.push(v)}}splitByTriangle(o){const{normal:c,triangles:d}=this;if(o.getNormal(_triangleNormal).normalize(),Math.abs(1-Math.abs(_triangleNormal.dot(c)))<PARALLEL_EPSILON){this.coplanarTriangleUsed=!0;for(let v=0,b=d.length;v<b;v++)d[v].coplanarCount=0;const _=[o.a,o.b,o.c];for(let v=0;v<3;v++){const b=(v+1)%3,tt=_[v],it=_[b];_vec.subVectors(it,tt).normalize(),_planeNormal.crossVectors(_triangleNormal,_vec),TriangleSplitter_plane.setFromNormalAndCoplanarPoint(_planeNormal,tt),this.splitByPlane(TriangleSplitter_plane,o)}}else o.getPlane(TriangleSplitter_plane),this.splitByPlane(TriangleSplitter_plane,o)}splitByPlane(o,c){const{triangles:d,trianglePool:_}=this;_splittingTriangle.copy(c),_splittingTriangle.needsUpdate=!0;for(let v=0,b=d.length;v<b;v++){const tt=d[v];if(!_splittingTriangle.intersectsTriangle(tt,_edge,!0))continue;const{a:it,b:nt,c:lt}=tt;let ut=0,ht=-1,_t=!1,ft=[],bt=[];const xt=[it,nt,lt];for(let St=0;St<3;St++){const wt=(St+1)%3;_edge.start.copy(xt[St]),_edge.end.copy(xt[wt]);const Pt=o.distanceToPoint(_edge.start),Rt=o.distanceToPoint(_edge.end);if(Math.abs(Pt)<COPLANAR_EPSILON&&Math.abs(Rt)<COPLANAR_EPSILON){_t=!0;break}if(Pt>0?ft.push(St):bt.push(St),Math.abs(Pt)<COPLANAR_EPSILON)continue;let kt=!!o.intersectLine(_edge,_vec);!kt&&Math.abs(Rt)<COPLANAR_EPSILON&&(_vec.copy(_edge.end),kt=!0),!kt||_vec.distanceTo(_edge.start)<TriangleSplitter_EPSILON||(_vec.distanceTo(_edge.end)<TriangleSplitter_EPSILON&&(ht=St),ut===0?_foundEdge.start.copy(_vec):_foundEdge.end.copy(_vec),ut++)}if(!_t&&ut===2&&_foundEdge.distance()>COPLANAR_EPSILON)if(ht!==-1){ht=(ht+1)%3;let St=0;St===ht&&(St=(St+1)%3);let wt=St+1;wt===ht&&(wt=(wt+1)%3);const Pt=_.getTriangle();Pt.a.copy(xt[wt]),Pt.b.copy(_foundEdge.end),Pt.c.copy(_foundEdge.start),isTriDegenerate(Pt)||d.push(Pt),tt.a.copy(xt[St]),tt.b.copy(_foundEdge.start),tt.c.copy(_foundEdge.end),isTriDegenerate(tt)&&(d.splice(v,1),v--,b--)}else{const St=ft.length>=2?bt[0]:ft[0];if(St===0){let Gt=_foundEdge.start;_foundEdge.start=_foundEdge.end,_foundEdge.end=Gt}const wt=(St+1)%3,Pt=(St+2)%3,Rt=_.getTriangle(),kt=_.getTriangle();xt[wt].distanceToSquared(_foundEdge.start)<xt[Pt].distanceToSquared(_foundEdge.end)?(Rt.a.copy(xt[wt]),Rt.b.copy(_foundEdge.start),Rt.c.copy(_foundEdge.end),kt.a.copy(xt[wt]),kt.b.copy(xt[Pt]),kt.c.copy(_foundEdge.start)):(Rt.a.copy(xt[Pt]),Rt.b.copy(_foundEdge.start),Rt.c.copy(_foundEdge.end),kt.a.copy(xt[wt]),kt.b.copy(xt[Pt]),kt.c.copy(_foundEdge.end)),tt.a.copy(xt[St]),tt.b.copy(_foundEdge.end),tt.c.copy(_foundEdge.start),isTriDegenerate(Rt)||d.push(Rt),isTriDegenerate(kt)||d.push(kt),isTriDegenerate(tt)&&(d.splice(v,1),v--,b--)}else ut===3&&console.warn("TriangleClipper: Coplanar clip not handled")}}reset(){this.triangles.length=0,this.trianglePool.clear(),this.coplanarTriangleUsed=!1}}function areSharedArrayBuffersSupported(){return typeof SharedArrayBuffer<"u"}function convertToSharedArrayBuffer(h){if(h.buffer instanceof SharedArrayBuffer)return h;const o=h.constructor,c=h.buffer,d=new SharedArrayBuffer(c.byteLength),_=new Uint8Array(c);return new Uint8Array(d).set(_,0),new o(d)}function getIndexArray(h,o=ArrayBuffer){return h>65535?new Uint32Array(new o(4*h)):new Uint16Array(new o(2*h))}function ensureIndex(h,o){if(!h.index){const c=h.attributes.position.count,d=getIndexArray(c,o.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer);h.setIndex(new three_module.THS(d,1));for(let _=0;_<c;_++)d[_]=_}}function getVertexCount(h){return h.index?h.index.count:h.attributes.position.count}function getTriCount(h){return getVertexCount(h)/3}function ceilToFourByteStride(h){return 4+(h=~~h)-h%4}class TypeBackedArray{constructor(o,c=500){this.expansionFactor=1.5,this.type=o,this.length=0,this.array=null,this.setSize(c)}setType(o){if(this.length!==0)throw new Error("TypeBackedArray: Cannot change the type while there is used data in the buffer.");const c=this.array.buffer;this.array=new o(c),this.type=o}setSize(o){if(this.array&&o===this.array.length)return;const c=this.type,d=new c(new(areSharedArrayBuffersSupported()?SharedArrayBuffer:ArrayBuffer)(ceilToFourByteStride(o*c.BYTES_PER_ELEMENT)));this.array&&d.set(this.array,0),this.array=d}expand(){const{array:o,expansionFactor:c}=this;this.setSize(o.length*c)}push(...o){let{array:c,length:d}=this;d+o.length>c.length&&(this.expand(),c=this.array);for(let _=0,v=o.length;_<v;_++)c[d+_]=o[_];this.length+=o.length}clear(){this.length=0}}class TypedAttributeData{constructor(){this.groupAttributes=[{}],this.groupCount=0}getType(o){return this.groupAttributes[0][o].type}getItemSize(o){return this.groupAttributes[0][o].itemSize}getNormalized(o){return this.groupAttributes[0][o].normalized}getCount(o){if(this.groupCount<=o)return 0;const c=this.getGroupAttrArray("position",o);return c.length/c.itemSize}getTotalLength(o){const{groupCount:c,groupAttributes:d}=this;let _=0;for(let v=0;v<c;v++)_+=d[v][o].length;return _}getGroupAttrSet(o=0){const{groupAttributes:c}=this;if(c[o])return this.groupCount=Math.max(this.groupCount,o+1),c[o];const d=c[0];for(this.groupCount=Math.max(this.groupCount,o+1);o>=c.length;){const _={};c.push(_);for(const v in d){const b=d[v],tt=new TypeBackedArray(b.type);tt.itemSize=b.itemSize,tt.normalized=b.normalized,_[v]=tt}}return c[o]}getGroupAttrArray(o,c=0){const{groupAttributes:d}=this;if(!d[0][o])throw new Error(`TypedAttributeData: Attribute with "${o}" has not been initialized`);return this.getGroupAttrSet(c)[o]}initializeArray(o,c,d,_){const{groupAttributes:v}=this,b=v[0][o];if(b){if(b.type!==c)for(let tt=0,it=v.length;tt<it;tt++){const nt=v[tt][o];nt.setType(c),nt.itemSize=d,nt.normalized=_}}else for(let tt=0,it=v.length;tt<it;tt++){const nt=new TypeBackedArray(c);nt.itemSize=d,nt.normalized=_,v[tt][o]=nt}}clear(){this.groupCount=0;const{groupAttributes:o}=this;o.forEach(c=>{for(const d in c)c[d].clear()})}delete(o){this.groupAttributes.forEach(c=>{delete c[o]})}reset(){this.groupAttributes=[],this.groupCount=0}}class IntersectionMap{constructor(){this.intersectionSet={},this.ids=[]}add(o,c){const{intersectionSet:d,ids:_}=this;d[o]||(d[o]=[],_.push(o)),d[o].push(c)}}const operationsUtils_ray=new three_module.RlV,operationsUtils_matrix=new three_module.kn4,_tri=new three_module.lMl,_vec3=new three_module.Pq0,_vec4a=new three_module.IUQ,_vec4b=new three_module.IUQ,_vec4c=new three_module.IUQ,_vec4_0=new three_module.IUQ,_vec4_1=new three_module.IUQ,_vec4_2=new three_module.IUQ,operationsUtils_edge=new three_module.cZY,_normal=new three_module.Pq0,JITTER_EPSILON=1e-8,OFFSET_EPSILON=1e-15,BACK_SIDE=-1,FRONT_SIDE=1,COPLANAR_OPPOSITE=-2,COPLANAR_ALIGNED=2,INVERT_TRI=0,ADD_TRI=1,SKIP_TRI=2,FLOATING_COPLANAR_EPSILON=1e-14;let _debugContext=null;function setDebugContext(h){_debugContext=h}function getHitSide(h,o){h.getMidpoint(operationsUtils_ray.origin),h.getNormal(operationsUtils_ray.direction);const c=o.raycastFirst(operationsUtils_ray,three_module.$EB);return c&&operationsUtils_ray.direction.dot(c.face.normal)>0?BACK_SIDE:FRONT_SIDE}function getHitSideWithCoplanarCheck(h,o){function c(){return Math.random()-.5}h.getNormal(_normal),operationsUtils_ray.direction.copy(_normal),h.getMidpoint(operationsUtils_ray.origin);let d=0,_=1/0;for(let v=0;v<3;v++){operationsUtils_ray.direction.x+=c()*JITTER_EPSILON,operationsUtils_ray.direction.y+=c()*JITTER_EPSILON,operationsUtils_ray.direction.z+=c()*JITTER_EPSILON,operationsUtils_ray.direction.multiplyScalar(-1);const b=o.raycastFirst(operationsUtils_ray,three_module.$EB);if(b&&operationsUtils_ray.direction.dot(b.face.normal)>0&&d++,b!==null&&(_=Math.min(_,b.distance)),_<=OFFSET_EPSILON)return b.face.normal.dot(_normal)>0?COPLANAR_ALIGNED:COPLANAR_OPPOSITE;if(d/3>.5||(v-d+1)/3>.5)break}return d/3>.5?BACK_SIDE:FRONT_SIDE}function collectIntersectingTriangles(h,o){const c=new IntersectionMap,d=new IntersectionMap;return operationsUtils_matrix.copy(h.matrixWorld).invert().multiply(o.matrixWorld),h.geometry.boundsTree.bvhcast(o.geometry.boundsTree,operationsUtils_matrix,{intersectsTriangles(_,v,b,tt){if(!isTriDegenerate(_)&&!isTriDegenerate(v)){let it=_.intersectsTriangle(v,operationsUtils_edge,!0);if(!it){const nt=_.plane,lt=v.plane,ut=nt.normal,ht=lt.normal;ut.dot(ht)===1&&Math.abs(nt.constant-lt.constant)<FLOATING_COPLANAR_EPSILON&&(it=!0)}if(it){let nt=h.geometry.boundsTree.resolveTriangleIndex(b),lt=o.geometry.boundsTree.resolveTriangleIndex(tt);c.add(nt,lt),d.add(lt,nt),_debugContext&&(_debugContext.addEdge(operationsUtils_edge),_debugContext.addIntersectingTriangles(b,_,tt,v))}}return!1}}),{aIntersections:c,bIntersections:d}}function appendAttributeFromTriangle(h,o,c,d,_,v,b=!1){const tt=c.attributes,it=c.index,nt=3*h,lt=it.getX(nt+0),ut=it.getX(nt+1),ht=it.getX(nt+2);for(const _t in v){const ft=tt[_t],bt=v[_t];if(!(_t in tt))throw new Error(`CSG Operations: Attribute ${_t} not available on geometry.`);const xt=ft.itemSize;_t==="position"?(_tri.a.fromBufferAttribute(ft,lt).applyMatrix4(d),_tri.b.fromBufferAttribute(ft,ut).applyMatrix4(d),_tri.c.fromBufferAttribute(ft,ht).applyMatrix4(d),pushBarycoordInterpolatedValues(_tri.a,_tri.b,_tri.c,o,3,bt,b)):_t==="normal"?(_tri.a.fromBufferAttribute(ft,lt).applyNormalMatrix(_),_tri.b.fromBufferAttribute(ft,ut).applyNormalMatrix(_),_tri.c.fromBufferAttribute(ft,ht).applyNormalMatrix(_),b&&(_tri.a.multiplyScalar(-1),_tri.b.multiplyScalar(-1),_tri.c.multiplyScalar(-1)),pushBarycoordInterpolatedValues(_tri.a,_tri.b,_tri.c,o,3,bt,b,!0)):(_vec4a.fromBufferAttribute(ft,lt),_vec4b.fromBufferAttribute(ft,ut),_vec4c.fromBufferAttribute(ft,ht),pushBarycoordInterpolatedValues(_vec4a,_vec4b,_vec4c,o,xt,bt,b))}}function appendAttributesFromIndices(h,o,c,d,_,v,b,tt=!1){appendAttributeFromIndex(h,d,_,v,b,tt),appendAttributeFromIndex(tt?c:o,d,_,v,b,tt),appendAttributeFromIndex(tt?o:c,d,_,v,b,tt)}function getOperationAction(h,o,c=!1){switch(h){case ADDITION:if(o===FRONT_SIDE||o===COPLANAR_ALIGNED&&!c)return ADD_TRI;break;case SUBTRACTION:if(c){if(o===BACK_SIDE)return INVERT_TRI}else if(o===FRONT_SIDE||o===COPLANAR_OPPOSITE)return ADD_TRI;break;case REVERSE_SUBTRACTION:if(c){if(o===FRONT_SIDE||o===COPLANAR_OPPOSITE)return ADD_TRI}else if(o===BACK_SIDE)return INVERT_TRI;break;case DIFFERENCE:if(o===BACK_SIDE)return INVERT_TRI;if(o===FRONT_SIDE)return ADD_TRI;break;case INTERSECTION:if(o===BACK_SIDE||o===COPLANAR_ALIGNED&&!c)return ADD_TRI;break;case HOLLOW_SUBTRACTION:if(!c&&(o===FRONT_SIDE||o===COPLANAR_OPPOSITE))return ADD_TRI;break;case HOLLOW_INTERSECTION:if(!c&&(o===BACK_SIDE||o===COPLANAR_ALIGNED))return ADD_TRI;break;default:throw new Error(`Unrecognized CSG operation enum "${h}".`)}return SKIP_TRI}function pushBarycoordInterpolatedValues(h,o,c,d,_,v,b=!1,tt=!1){const it=nt=>{v.push(nt.x),_>1&&v.push(nt.y),_>2&&v.push(nt.z),_>3&&v.push(nt.w)};_vec4_0.set(0,0,0,0).addScaledVector(h,d.a.x).addScaledVector(o,d.a.y).addScaledVector(c,d.a.z),_vec4_1.set(0,0,0,0).addScaledVector(h,d.b.x).addScaledVector(o,d.b.y).addScaledVector(c,d.b.z),_vec4_2.set(0,0,0,0).addScaledVector(h,d.c.x).addScaledVector(o,d.c.y).addScaledVector(c,d.c.z),tt&&(_vec4_0.normalize(),_vec4_1.normalize(),_vec4_2.normalize()),it(_vec4_0),b?(it(_vec4_2),it(_vec4_1)):(it(_vec4_1),it(_vec4_2))}function appendAttributeFromIndex(h,o,c,d,_,v=!1){for(const b in _){const tt=o[b],it=_[b];if(!(b in o))throw new Error(`CSG Operations: Attribute ${b} no available on geometry.`);const nt=tt.itemSize;b==="position"?(_vec3.fromBufferAttribute(tt,h).applyMatrix4(c),it.push(_vec3.x,_vec3.y,_vec3.z)):b==="normal"?(_vec3.fromBufferAttribute(tt,h).applyNormalMatrix(d),v&&_vec3.multiplyScalar(-1),it.push(_vec3.x,_vec3.y,_vec3.z)):(it.push(tt.getX(h)),nt>1&&it.push(tt.getY(h)),nt>2&&it.push(tt.getZ(h)),nt>3&&it.push(tt.getW(h)))}}class TriangleIntersectData{constructor(o){this.triangle=new three_module.lMl().copy(o),this.intersects={}}addTriangle(o,c){this.intersects[o]=new three_module.lMl().copy(c)}getIntersectArray(){const o=[],{intersects:c}=this;for(const d in c)o.push(c[d]);return o}}class TriangleIntersectionSets{constructor(){this.data={}}addTriangleIntersection(o,c,d,_){const{data:v}=this;v[o]||(v[o]=new TriangleIntersectData(c)),v[o].addTriangle(d,_)}getTrianglesAsArray(o=null){const{data:c}=this,d=[];if(o!==null)o in c&&d.push(c[o].triangle);else for(const _ in c)d.push(c[_].triangle);return d}getTriangleIndices(){return Object.keys(this.data).map(o=>parseInt(o))}getIntersectionIndices(o){const{data:c}=this;return c[o]?Object.keys(c[o].intersects).map(d=>parseInt(d)):[]}getIntersectionsAsArray(o=null,c=null){const{data:d}=this,_=new Set,v=[],b=tt=>{if(d[tt])if(c!==null)d[tt].intersects[c]&&v.push(d[tt].intersects[c]);else{const it=d[tt].intersects;for(const nt in it)_.has(nt)||(_.add(nt),v.push(it[nt]))}};if(o!==null)b(o);else for(const tt in d)b(tt);return v}reset(){this.data={}}}class OperationDebugData{constructor(){this.enabled=!1,this.triangleIntersectsA=new TriangleIntersectionSets,this.triangleIntersectsB=new TriangleIntersectionSets,this.intersectionEdges=[]}addIntersectingTriangles(o,c,d,_){const{triangleIntersectsA:v,triangleIntersectsB:b}=this;v.addTriangleIntersection(o,c,d,_),b.addTriangleIntersection(d,_,o,c)}addEdge(o){this.intersectionEdges.push(o.clone())}reset(){this.triangleIntersectsA.reset(),this.triangleIntersectsB.reset(),this.intersectionEdges=[]}init(){this.enabled&&(this.reset(),setDebugContext(this))}complete(){this.enabled&&setDebugContext(null)}}const operations_matrix=new three_module.kn4,_normalMatrix=new three_module.dwI,_triA=new three_module.lMl,_triB=new three_module.lMl,operations_tri=new three_module.lMl,_barycoordTri=new three_module.lMl,_attr=[],_actions=[];function getFirstIdFromSet(h){for(const o of h)return o}function performOperation(h,o,c,d,_,v={}){const{useGroups:b=!0}=v,{aIntersections:tt,bIntersections:it}=collectIntersectingTriangles(h,o);let nt;return nt=b?0:-1,performSplitTriangleOperations(h,o,tt,c,!1,d,_,nt),performWholeTriangleOperations(h,o,tt,c,!1,_,nt),c.findIndex(lt=>lt!==HOLLOW_INTERSECTION&&lt!==HOLLOW_SUBTRACTION)!==-1&&(nt=b?h.geometry.groups.length||1:-1,performSplitTriangleOperations(o,h,it,c,!0,d,_,nt),performWholeTriangleOperations(o,h,it,c,!0,_,nt)),_attr.length=0,_actions.length=0,{groups:[],materials:null}}function performSplitTriangleOperations(h,o,c,d,_,v,b,tt=0){const it=h.matrixWorld.determinant()<0;operations_matrix.copy(o.matrixWorld).invert().multiply(h.matrixWorld),_normalMatrix.getNormalMatrix(h.matrixWorld).multiplyScalar(it?-1:1);const nt=h.geometry.groupIndices,lt=h.geometry.index,ut=h.geometry.attributes.position,ht=o.geometry.boundsTree,_t=o.geometry.index,ft=o.geometry.attributes.position,bt=c.ids,xt=c.intersectionSet;for(let St=0,wt=bt.length;St<wt;St++){const Pt=bt[St],Rt=tt===-1?0:nt[Pt]+tt,kt=3*Pt,Gt=lt.getX(kt+0),Dt=lt.getX(kt+1),It=lt.getX(kt+2);_triA.a.fromBufferAttribute(ut,Gt).applyMatrix4(operations_matrix),_triA.b.fromBufferAttribute(ut,Dt).applyMatrix4(operations_matrix),_triA.c.fromBufferAttribute(ut,It).applyMatrix4(operations_matrix),v.reset(),v.initialize(_triA);const Nt=xt[Pt];for(let Kt=0,Yt=Nt.length;Kt<Yt;Kt++){const nr=3*Nt[Kt],rr=_t.getX(nr+0),lr=_t.getX(nr+1),or=_t.getX(nr+2);_triB.a.fromBufferAttribute(ft,rr),_triB.b.fromBufferAttribute(ft,lr),_triB.c.fromBufferAttribute(ft,or),v.splitByTriangle(_triB)}const Vt=v.triangles;for(let Kt=0,Yt=Vt.length;Kt<Yt;Kt++){const nr=Vt[Kt],rr=v.coplanarTriangleUsed?getHitSideWithCoplanarCheck(nr,ht):getHitSide(nr,ht);_attr.length=0,_actions.length=0;for(let lr=0,or=d.length;lr<or;lr++){const pr=getOperationAction(d[lr],rr,_);pr!==SKIP_TRI&&(_actions.push(pr),_attr.push(b[lr].getGroupAttrSet(Rt)))}if(_attr.length!==0){_triA.getBarycoord(nr.a,_barycoordTri.a),_triA.getBarycoord(nr.b,_barycoordTri.b),_triA.getBarycoord(nr.c,_barycoordTri.c);for(let lr=0,or=_attr.length;lr<or;lr++){const pr=_attr[lr],hr=_actions[lr]===INVERT_TRI;appendAttributeFromTriangle(Pt,_barycoordTri,h.geometry,h.matrixWorld,_normalMatrix,pr,it!==hr)}}}}return bt.length}function performWholeTriangleOperations(h,o,c,d,_,v,b=0){const tt=h.matrixWorld.determinant()<0;operations_matrix.copy(o.matrixWorld).invert().multiply(h.matrixWorld),_normalMatrix.getNormalMatrix(h.matrixWorld).multiplyScalar(tt?-1:1);const it=o.geometry.boundsTree,nt=h.geometry.groupIndices,lt=h.geometry.index,ut=h.geometry.attributes,ht=ut.position,_t=[],ft=h.geometry.halfEdges,bt=new Set;for(let xt=0,St=getTriCount(h.geometry);xt<St;xt++)xt in c.intersectionSet||bt.add(xt);for(;bt.size>0;){const xt=getFirstIdFromSet(bt);bt.delete(xt),_t.push(xt);const St=3*xt,wt=lt.getX(St+0),Pt=lt.getX(St+1),Rt=lt.getX(St+2);operations_tri.a.fromBufferAttribute(ht,wt).applyMatrix4(operations_matrix),operations_tri.b.fromBufferAttribute(ht,Pt).applyMatrix4(operations_matrix),operations_tri.c.fromBufferAttribute(ht,Rt).applyMatrix4(operations_matrix);const kt=getHitSide(operations_tri,it);_actions.length=0,_attr.length=0;for(let Gt=0,Dt=d.length;Gt<Dt;Gt++){const It=getOperationAction(d[Gt],kt,_);It!==SKIP_TRI&&(_actions.push(It),_attr.push(v[Gt]))}for(;_t.length>0;){const Gt=_t.pop();for(let Dt=0;Dt<3;Dt++){const It=ft.getSiblingTriangleIndex(Gt,Dt);It!==-1&&bt.has(It)&&(_t.push(It),bt.delete(It))}if(_attr.length!==0){const Dt=3*Gt,It=lt.getX(Dt+0),Nt=lt.getX(Dt+1),Vt=lt.getX(Dt+2),Kt=b===-1?0:nt[Gt]+b;if(operations_tri.a.fromBufferAttribute(ht,It),operations_tri.b.fromBufferAttribute(ht,Nt),operations_tri.c.fromBufferAttribute(ht,Vt),!isTriDegenerate(operations_tri))for(let Yt=0,nr=_attr.length;Yt<nr;Yt++){const rr=_actions[Yt],lr=_attr[Yt].getGroupAttrSet(Kt),or=rr===INVERT_TRI;appendAttributesFromIndices(It,Nt,Vt,ut,h.matrixWorld,_normalMatrix,lr,or!==tt)}}}}}const CENTER=0,AVERAGE=1,SAH=2,CONTAINED=2,TRIANGLE_INTERSECT_COST=1.25,TRAVERSAL_COST=1,BYTES_PER_NODE=32,IS_LEAFNODE_FLAG=65535,FLOAT32_EPSILON=Math.pow(2,-24),SKIP_GENERATION=Symbol("SKIP_GENERATION");function geometryUtils_getVertexCount(h){return h.index?h.index.count:h.attributes.position.count}function geometryUtils_getTriCount(h){return geometryUtils_getVertexCount(h)/3}function geometryUtils_getIndexArray(h,o=ArrayBuffer){return h>65535?new Uint32Array(new o(4*h)):new Uint16Array(new o(2*h))}function geometryUtils_ensureIndex(h,o){if(!h.index){const c=h.attributes.position.count,d=geometryUtils_getIndexArray(c,o.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer);h.setIndex(new three_module.THS(d,1));for(let _=0;_<c;_++)d[_]=_}}function getFullGeometryRange(h){const o=geometryUtils_getTriCount(h),c=h.drawRange,d=c.start/3,_=(c.start+c.count)/3,v=Math.max(0,d),b=Math.min(o,_)-v;return[{offset:Math.floor(v),count:Math.floor(b)}]}function getRootIndexRanges(h){if(!h.groups||!h.groups.length)return getFullGeometryRange(h);const o=[],c=new Set,d=h.drawRange,_=d.start/3,v=(d.start+d.count)/3;for(const tt of h.groups){const it=tt.start/3,nt=(tt.start+tt.count)/3;c.add(Math.max(_,it)),c.add(Math.min(v,nt))}const b=Array.from(c.values()).sort((tt,it)=>tt-it);for(let tt=0;tt<b.length-1;tt++){const it=b[tt],nt=b[tt+1];o.push({offset:Math.floor(it),count:Math.floor(nt-it)})}return o}function hasGroupGaps(h){if(h.groups.length===0)return!1;const o=geometryUtils_getTriCount(h),c=getRootIndexRanges(h).sort((v,b)=>v.offset-b.offset),d=c[c.length-1];d.count=Math.min(o-d.offset,d.count);let _=0;return c.forEach(({count:v})=>_+=v),o!==_}function arrayToBox(h,o,c){return c.min.x=o[h],c.min.y=o[h+1],c.min.z=o[h+2],c.max.x=o[h+3],c.max.y=o[h+4],c.max.z=o[h+5],c}function makeEmptyBounds(h){h[0]=h[1]=h[2]=1/0,h[3]=h[4]=h[5]=-1/0}function getLongestEdgeIndex(h){let o=-1,c=-1/0;for(let d=0;d<3;d++){const _=h[d+3]-h[d];_>c&&(c=_,o=d)}return o}function copyBounds(h,o){o.set(h)}function unionBounds(h,o,c){let d,_;for(let v=0;v<3;v++){const b=v+3;d=h[v],_=o[v],c[v]=d<_?d:_,d=h[b],_=o[b],c[b]=d>_?d:_}}function expandByTriangleBounds(h,o,c){for(let d=0;d<3;d++){const _=o[h+2*d],v=o[h+2*d+1],b=_-v,tt=_+v;b<c[d]&&(c[d]=b),tt>c[d+3]&&(c[d+3]=tt)}}function computeSurfaceArea(h){const o=h[3]-h[0],c=h[4]-h[1],d=h[5]-h[2];return 2*(o*c+c*d+d*o)}function computeBoundsUtils_getBounds(h,o,c,d,_=null){let v=1/0,b=1/0,tt=1/0,it=-1/0,nt=-1/0,lt=-1/0,ut=1/0,ht=1/0,_t=1/0,ft=-1/0,bt=-1/0,xt=-1/0;const St=_!==null;for(let wt=6*o,Pt=6*(o+c);wt<Pt;wt+=6){const Rt=h[wt+0],kt=h[wt+1],Gt=Rt-kt,Dt=Rt+kt;Gt<v&&(v=Gt),Dt>it&&(it=Dt),St&&Rt<ut&&(ut=Rt),St&&Rt>ft&&(ft=Rt);const It=h[wt+2],Nt=h[wt+3],Vt=It-Nt,Kt=It+Nt;Vt<b&&(b=Vt),Kt>nt&&(nt=Kt),St&&It<ht&&(ht=It),St&&It>bt&&(bt=It);const Yt=h[wt+4],nr=h[wt+5],rr=Yt-nr,lr=Yt+nr;rr<tt&&(tt=rr),lr>lt&&(lt=lr),St&&Yt<_t&&(_t=Yt),St&&Yt>xt&&(xt=Yt)}d[0]=v,d[1]=b,d[2]=tt,d[3]=it,d[4]=nt,d[5]=lt,St&&(_[0]=ut,_[1]=ht,_[2]=_t,_[3]=ft,_[4]=bt,_[5]=xt)}function getCentroidBounds(h,o,c,d){let _=1/0,v=1/0,b=1/0,tt=-1/0,it=-1/0,nt=-1/0;for(let lt=6*o,ut=6*(o+c);lt<ut;lt+=6){const ht=h[lt+0];ht<_&&(_=ht),ht>tt&&(tt=ht);const _t=h[lt+2];_t<v&&(v=_t),_t>it&&(it=_t);const ft=h[lt+4];ft<b&&(b=ft),ft>nt&&(nt=ft)}d[0]=_,d[1]=v,d[2]=b,d[3]=tt,d[4]=it,d[5]=nt}function computeTriangleBounds(h,o){makeEmptyBounds(o);const c=h.attributes.position,d=h.index?h.index.array:null,_=geometryUtils_getTriCount(h),v=new Float32Array(6*_),b=c.normalized,tt=c.array,it=c.offset||0;let nt=3;c.isInterleavedBufferAttribute&&(nt=c.data.stride);const lt=["getX","getY","getZ"];for(let ut=0;ut<_;ut++){const ht=3*ut,_t=6*ut;let ft=ht+0,bt=ht+1,xt=ht+2;d&&(ft=d[ft],bt=d[bt],xt=d[xt]),b||(ft=ft*nt+it,bt=bt*nt+it,xt=xt*nt+it);for(let St=0;St<3;St++){let wt,Pt,Rt;b?(wt=c[lt[St]](ft),Pt=c[lt[St]](bt),Rt=c[lt[St]](xt)):(wt=tt[ft+St],Pt=tt[bt+St],Rt=tt[xt+St]);let kt=wt;Pt<kt&&(kt=Pt),Rt<kt&&(kt=Rt);let Gt=wt;Pt>Gt&&(Gt=Pt),Rt>Gt&&(Gt=Rt);const Dt=(Gt-kt)/2,It=2*St;v[_t+It+0]=kt+Dt,v[_t+It+1]=Dt+(Math.abs(kt)+Dt)*FLOAT32_EPSILON,kt<o[St]&&(o[St]=kt),Gt>o[St+3]&&(o[St+3]=Gt)}}return v}const BIN_COUNT=32,binsSort=(h,o)=>h.candidate-o.candidate,sahBins=new Array(BIN_COUNT).fill().map(()=>({count:0,bounds:new Float32Array(6),rightCacheBounds:new Float32Array(6),leftCacheBounds:new Float32Array(6),candidate:0})),leftBounds=new Float32Array(6);function getOptimalSplit(h,o,c,d,_,v){let b=-1,tt=0;if(v===CENTER)b=getLongestEdgeIndex(o),b!==-1&&(tt=(o[b]+o[b+3])/2);else if(v===AVERAGE)b=getLongestEdgeIndex(h),b!==-1&&(tt=getAverage(c,d,_,b));else if(v===SAH){const it=computeSurfaceArea(h);let nt=TRIANGLE_INTERSECT_COST*_;const lt=6*d,ut=6*(d+_);for(let ht=0;ht<3;ht++){const _t=o[ht],ft=(o[ht+3]-_t)/BIN_COUNT;if(_<BIN_COUNT/4){const bt=[...sahBins];bt.length=_;let xt=0;for(let wt=lt;wt<ut;wt+=6,xt++){const Pt=bt[xt];Pt.candidate=c[wt+2*ht],Pt.count=0;const{bounds:Rt,leftCacheBounds:kt,rightCacheBounds:Gt}=Pt;for(let Dt=0;Dt<3;Dt++)Gt[Dt]=1/0,Gt[Dt+3]=-1/0,kt[Dt]=1/0,kt[Dt+3]=-1/0,Rt[Dt]=1/0,Rt[Dt+3]=-1/0;expandByTriangleBounds(wt,c,Rt)}bt.sort(binsSort);let St=_;for(let wt=0;wt<St;wt++){const Pt=bt[wt];for(;wt+1<St&&bt[wt+1].candidate===Pt.candidate;)bt.splice(wt+1,1),St--}for(let wt=lt;wt<ut;wt+=6){const Pt=c[wt+2*ht];for(let Rt=0;Rt<St;Rt++){const kt=bt[Rt];Pt>=kt.candidate?expandByTriangleBounds(wt,c,kt.rightCacheBounds):(expandByTriangleBounds(wt,c,kt.leftCacheBounds),kt.count++)}}for(let wt=0;wt<St;wt++){const Pt=bt[wt],Rt=Pt.count,kt=_-Pt.count,Gt=Pt.leftCacheBounds,Dt=Pt.rightCacheBounds;let It=0;Rt!==0&&(It=computeSurfaceArea(Gt)/it);let Nt=0;kt!==0&&(Nt=computeSurfaceArea(Dt)/it);const Vt=TRAVERSAL_COST+TRIANGLE_INTERSECT_COST*(It*Rt+Nt*kt);Vt<nt&&(b=ht,nt=Vt,tt=Pt.candidate)}}else{for(let St=0;St<BIN_COUNT;St++){const wt=sahBins[St];wt.count=0,wt.candidate=_t+ft+St*ft;const Pt=wt.bounds;for(let Rt=0;Rt<3;Rt++)Pt[Rt]=1/0,Pt[Rt+3]=-1/0}for(let St=lt;St<ut;St+=6){let wt=~~((c[St+2*ht]-_t)/ft);wt>=BIN_COUNT&&(wt=BIN_COUNT-1);const Pt=sahBins[wt];Pt.count++,expandByTriangleBounds(St,c,Pt.bounds)}const bt=sahBins[BIN_COUNT-1];copyBounds(bt.bounds,bt.rightCacheBounds);for(let St=BIN_COUNT-2;St>=0;St--){const wt=sahBins[St],Pt=sahBins[St+1];unionBounds(wt.bounds,Pt.rightCacheBounds,wt.rightCacheBounds)}let xt=0;for(let St=0;St<BIN_COUNT-1;St++){const wt=sahBins[St],Pt=wt.count,Rt=wt.bounds,kt=sahBins[St+1].rightCacheBounds;Pt!==0&&(xt===0?copyBounds(Rt,leftBounds):unionBounds(Rt,leftBounds,leftBounds)),xt+=Pt;let Gt=0,Dt=0;xt!==0&&(Gt=computeSurfaceArea(leftBounds)/it);const It=_-xt;It!==0&&(Dt=computeSurfaceArea(kt)/it);const Nt=TRAVERSAL_COST+TRIANGLE_INTERSECT_COST*(Gt*xt+Dt*It);Nt<nt&&(b=ht,nt=Nt,tt=wt.candidate)}}}}else console.warn(`MeshBVH: Invalid build strategy value ${v} used.`);return{axis:b,pos:tt}}function getAverage(h,o,c,d){let _=0;for(let v=o,b=o+c;v<b;v++)_+=h[6*v+2*d];return _/c}class MeshBVHNode{constructor(){}}function partition(h,o,c,d,_,v){let b=d,tt=d+_-1;const it=v.pos,nt=2*v.axis;for(;;){for(;b<=tt&&c[6*b+nt]<it;)b++;for(;b<=tt&&c[6*tt+nt]>=it;)tt--;if(!(b<tt))return b;for(let lt=0;lt<3;lt++){let ut=o[3*b+lt];o[3*b+lt]=o[3*tt+lt],o[3*tt+lt]=ut}for(let lt=0;lt<6;lt++){let ut=c[6*b+lt];c[6*b+lt]=c[6*tt+lt],c[6*tt+lt]=ut}b++,tt--}}function partition_indirect(h,o,c,d,_,v){let b=d,tt=d+_-1;const it=v.pos,nt=2*v.axis;for(;;){for(;b<=tt&&c[6*b+nt]<it;)b++;for(;b<=tt&&c[6*tt+nt]>=it;)tt--;if(!(b<tt))return b;{let lt=h[b];h[b]=h[tt],h[tt]=lt;for(let ut=0;ut<6;ut++){let ht=c[6*b+ut];c[6*b+ut]=c[6*tt+ut],c[6*tt+ut]=ht}b++,tt--}}}function generateIndirectBuffer(h,o){const c=(h.index?h.index.count:h.attributes.position.count)/3,d=c>65536,_=d?4:2,v=o?new SharedArrayBuffer(c*_):new ArrayBuffer(c*_),b=d?new Uint32Array(v):new Uint16Array(v);for(let tt=0,it=b.length;tt<it;tt++)b[tt]=tt;return b}function buildTree(h,o){const c=h.geometry,d=c.index?c.index.array:null,_=o.maxDepth,v=o.verbose,b=o.maxLeafTris,tt=o.strategy,it=o.onProgress,nt=geometryUtils_getTriCount(c),lt=h._indirectBuffer;let ut=!1;const ht=new Float32Array(6),_t=new Float32Array(6),ft=computeTriangleBounds(c,ht),bt=o.indirect?partition_indirect:partition,xt=[],St=o.indirect?getFullGeometryRange(c):getRootIndexRanges(c);if(St.length===1){const Rt=St[0],kt=new MeshBVHNode;kt.boundingData=ht,getCentroidBounds(ft,Rt.offset,Rt.count,_t),Pt(kt,Rt.offset,Rt.count,_t),xt.push(kt)}else for(let Rt of St){const kt=new MeshBVHNode;kt.boundingData=new Float32Array(6),computeBoundsUtils_getBounds(ft,Rt.offset,Rt.count,kt.boundingData,_t),Pt(kt,Rt.offset,Rt.count,_t),xt.push(kt)}return xt;function wt(Rt){it&&it(Rt/nt)}function Pt(Rt,kt,Gt,Dt=null,It=0){if(!ut&&It>=_&&(ut=!0,v&&(console.warn(`MeshBVH: Max depth of ${_} reached when generating BVH. Consider increasing maxDepth.`),console.warn(c))),Gt<=b||It>=_)return wt(kt+Gt),Rt.offset=kt,Rt.count=Gt,Rt;const Nt=getOptimalSplit(Rt.boundingData,Dt,ft,kt,Gt,tt);if(Nt.axis===-1)return wt(kt+Gt),Rt.offset=kt,Rt.count=Gt,Rt;const Vt=bt(lt,d,ft,kt,Gt,Nt);if(Vt===kt||Vt===kt+Gt)wt(kt+Gt),Rt.offset=kt,Rt.count=Gt;else{Rt.splitAxis=Nt.axis;const Kt=new MeshBVHNode,Yt=kt,nr=Vt-kt;Rt.left=Kt,Kt.boundingData=new Float32Array(6),computeBoundsUtils_getBounds(ft,Yt,nr,Kt.boundingData,_t),Pt(Kt,Yt,nr,_t,It+1);const rr=new MeshBVHNode,lr=Vt,or=Gt-nr;Rt.right=rr,rr.boundingData=new Float32Array(6),computeBoundsUtils_getBounds(ft,lr,or,rr.boundingData,_t),Pt(rr,lr,or,_t,It+1)}return Rt}}function buildPackedTree(h,o){const c=h.geometry;o.indirect&&(h._indirectBuffer=generateIndirectBuffer(c,o.useSharedArrayBuffer),hasGroupGaps(c)&&!o.verbose&&console.warn('MeshBVH: Provided geometry contains groups that do not fully span the vertex contents while using the "indirect" option. BVH may incorrectly report intersections on unrendered portions of the geometry.')),h._indirectBuffer||geometryUtils_ensureIndex(c,o);const d=buildTree(h,o);let _,v,b;const tt=[],it=o.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;for(let ut=0;ut<d.length;ut++){const ht=d[ut];let _t=nt(ht);const ft=new it(BYTES_PER_NODE*_t);_=new Float32Array(ft),v=new Uint32Array(ft),b=new Uint16Array(ft),lt(0,ht),tt.push(ft)}return void(h._roots=tt);function nt(ut){return ut.count?1:1+nt(ut.left)+nt(ut.right)}function lt(ut,ht){const _t=ut/4,ft=ut/2,bt=!!ht.count,xt=ht.boundingData;for(let St=0;St<6;St++)_[_t+St]=xt[St];if(bt){const St=ht.offset,wt=ht.count;return v[_t+6]=St,b[ft+14]=wt,b[ft+15]=IS_LEAFNODE_FLAG,ut+BYTES_PER_NODE}{const St=ht.left,wt=ht.right,Pt=ht.splitAxis;let Rt;if(Rt=lt(ut+BYTES_PER_NODE,St),Rt/4>Math.pow(2,32))throw new Error("MeshBVH: Cannot store child pointer greater than 32 bits.");return v[_t+6]=Rt/4,Rt=lt(Rt,wt),v[_t+7]=Pt,Rt}}}class OrientedBox{constructor(o,c,d){this.isOrientedBox=!0,this.min=new three_module.Pq0,this.max=new three_module.Pq0,this.matrix=new three_module.kn4,this.invMatrix=new three_module.kn4,this.points=new Array(8).fill().map(()=>new three_module.Pq0),this.satAxes=new Array(3).fill().map(()=>new three_module.Pq0),this.satBounds=new Array(3).fill().map(()=>new SeparatingAxisBounds),this.alignedSatBounds=new Array(3).fill().map(()=>new SeparatingAxisBounds),this.needsUpdate=!1,o&&this.min.copy(o),c&&this.max.copy(c),d&&this.matrix.copy(d)}set(o,c,d){this.min.copy(o),this.max.copy(c),this.matrix.copy(d),this.needsUpdate=!0}copy(o){this.min.copy(o.min),this.max.copy(o.max),this.matrix.copy(o.matrix),this.needsUpdate=!0}}OrientedBox.prototype.update=function(){const h=this.matrix,o=this.min,c=this.max,d=this.points;for(let it=0;it<=1;it++)for(let nt=0;nt<=1;nt++)for(let lt=0;lt<=1;lt++){const ut=d[1*it|2*nt|4*lt];ut.x=it?c.x:o.x,ut.y=nt?c.y:o.y,ut.z=lt?c.z:o.z,ut.applyMatrix4(h)}const _=this.satBounds,v=this.satAxes,b=d[0];for(let it=0;it<3;it++){const nt=v[it],lt=_[it],ut=d[1<<it];nt.subVectors(b,ut),lt.setFromPoints(nt,d)}const tt=this.alignedSatBounds;tt[0].setFromPointsField(d,"x"),tt[1].setFromPointsField(d,"y"),tt[2].setFromPointsField(d,"z"),this.invMatrix.copy(this.matrix).invert(),this.needsUpdate=!1},OrientedBox.prototype.intersectsBox=function(){const h=new SeparatingAxisBounds;return function(o){this.needsUpdate&&this.update();const c=o.min,d=o.max,_=this.satBounds,v=this.satAxes,b=this.alignedSatBounds;if(h.min=c.x,h.max=d.x,b[0].isSeparated(h)||(h.min=c.y,h.max=d.y,b[1].isSeparated(h))||(h.min=c.z,h.max=d.z,b[2].isSeparated(h)))return!1;for(let tt=0;tt<3;tt++){const it=v[tt],nt=_[tt];if(h.setFromBox(it,o),nt.isSeparated(h))return!1}return!0}}(),OrientedBox.prototype.intersectsTriangle=function(){const h=new ExtendedTriangle,o=new Array(3),c=new SeparatingAxisBounds,d=new SeparatingAxisBounds,_=new three_module.Pq0;return function(v){this.needsUpdate&&this.update(),v.isExtendedTriangle?v.needsUpdate&&v.update():(h.copy(v),h.update(),v=h);const b=this.satBounds,tt=this.satAxes;o[0]=v.a,o[1]=v.b,o[2]=v.c;for(let ut=0;ut<3;ut++){const ht=b[ut],_t=tt[ut];if(c.setFromPoints(_t,o),ht.isSeparated(c))return!1}const it=v.satBounds,nt=v.satAxes,lt=this.points;for(let ut=0;ut<3;ut++){const ht=it[ut],_t=nt[ut];if(c.setFromPoints(_t,lt),ht.isSeparated(c))return!1}for(let ut=0;ut<3;ut++){const ht=tt[ut];for(let _t=0;_t<4;_t++){const ft=nt[_t];if(_.crossVectors(ht,ft),c.setFromPoints(_,o),d.setFromPoints(_,lt),c.isSeparated(d))return!1}}return!0}}(),OrientedBox.prototype.closestPointToPoint=function(h,o){return this.needsUpdate&&this.update(),o.copy(h).applyMatrix4(this.invMatrix).clamp(this.min,this.max).applyMatrix4(this.matrix),o},OrientedBox.prototype.distanceToPoint=function(){const h=new three_module.Pq0;return function(o){return this.closestPointToPoint(o,h),o.distanceTo(h)}}(),OrientedBox.prototype.distanceToBox=function(){const h=["x","y","z"],o=new Array(12).fill().map(()=>new three_module.cZY),c=new Array(12).fill().map(()=>new three_module.cZY),d=new three_module.Pq0,_=new three_module.Pq0;return function(v,b=0,tt=null,it=null){if(this.needsUpdate&&this.update(),this.intersectsBox(v))return(tt||it)&&(v.getCenter(_),this.closestPointToPoint(_,d),v.closestPointToPoint(d,_),tt&&tt.copy(d),it&&it.copy(_)),0;const nt=b*b,lt=v.min,ut=v.max,ht=this.points;let _t=1/0;for(let bt=0;bt<8;bt++){const xt=ht[bt];_.copy(xt).clamp(lt,ut);const St=xt.distanceToSquared(_);if(St<_t&&(_t=St,tt&&tt.copy(xt),it&&it.copy(_),St<nt))return Math.sqrt(St)}let ft=0;for(let bt=0;bt<3;bt++)for(let xt=0;xt<=1;xt++)for(let St=0;St<=1;St++){const wt=(bt+1)%3,Pt=(bt+2)%3,Rt=1<<bt|xt<<wt|St<<Pt,kt=ht[xt<<wt|St<<Pt],Gt=ht[Rt];o[ft].set(kt,Gt);const Dt=h[bt],It=h[wt],Nt=h[Pt],Vt=c[ft],Kt=Vt.start,Yt=Vt.end;Kt[Dt]=lt[Dt],Kt[It]=xt?lt[It]:ut[It],Kt[Nt]=St?lt[Nt]:ut[It],Yt[Dt]=ut[Dt],Yt[It]=xt?lt[It]:ut[It],Yt[Nt]=St?lt[Nt]:ut[It],ft++}for(let bt=0;bt<=1;bt++)for(let xt=0;xt<=1;xt++)for(let St=0;St<=1;St++){_.x=bt?ut.x:lt.x,_.y=xt?ut.y:lt.y,_.z=St?ut.z:lt.z,this.closestPointToPoint(_,d);const wt=_.distanceToSquared(d);if(wt<_t&&(_t=wt,tt&&tt.copy(d),it&&it.copy(_),wt<nt))return Math.sqrt(wt)}for(let bt=0;bt<12;bt++){const xt=o[bt];for(let St=0;St<12;St++){const wt=c[St];closestPointsSegmentToSegment(xt,wt,d,_);const Pt=d.distanceToSquared(_);if(Pt<_t&&(_t=Pt,tt&&tt.copy(d),it&&it.copy(_),Pt<nt))return Math.sqrt(Pt)}}return Math.sqrt(_t)}}();class PrimitivePool{constructor(o){this._getNewPrimitive=o,this._primitives=[]}getPrimitive(){const o=this._primitives;return o.length===0?this._getNewPrimitive():o.pop()}releasePrimitive(o){this._primitives.push(o)}}class ExtendedTrianglePoolBase extends PrimitivePool{constructor(){super(()=>new ExtendedTriangle)}}const ExtendedTrianglePool=new ExtendedTrianglePoolBase;function IS_LEAF(h,o){return o[h+15]===65535}function OFFSET(h,o){return o[h+6]}function COUNT(h,o){return o[h+14]}function LEFT_NODE(h){return h+8}function RIGHT_NODE(h,o){return o[h+6]}function SPLIT_AXIS(h,o){return o[h+7]}class _BufferStack{constructor(){this.float32Array=null,this.uint16Array=null,this.uint32Array=null;const o=[];let c=null;this.setBuffer=d=>{c&&o.push(c),c=d,this.float32Array=new Float32Array(d),this.uint16Array=new Uint16Array(d),this.uint32Array=new Uint32Array(d)},this.clearBuffer=()=>{c=null,this.float32Array=null,this.uint16Array=null,this.uint32Array=null,o.length!==0&&this.setBuffer(o.pop())}}}const BufferStack=new _BufferStack;let _box1,_box2;const boxStack=[],boxPool=new PrimitivePool(()=>new three_module.NRn);function shapecast(h,o,c,d,_,v){_box1=boxPool.getPrimitive(),_box2=boxPool.getPrimitive(),boxStack.push(_box1,_box2),BufferStack.setBuffer(h._roots[o]);const b=shapecastTraverse(0,h.geometry,c,d,_,v);BufferStack.clearBuffer(),boxPool.releasePrimitive(_box1),boxPool.releasePrimitive(_box2),boxStack.pop(),boxStack.pop();const tt=boxStack.length;return tt>0&&(_box2=boxStack[tt-1],_box1=boxStack[tt-2]),b}function shapecastTraverse(h,o,c,d,_=null,v=0,b=0){const{float32Array:tt,uint16Array:it,uint32Array:nt}=BufferStack;let lt=2*h;if(IS_LEAF(lt,it)){const ut=OFFSET(h,nt),ht=COUNT(lt,it);return arrayToBox(h,tt,_box1),d(ut,ht,!1,b,v+h,_box1)}{let ut=function(Nt){const{uint16Array:Vt,uint32Array:Kt}=BufferStack;let Yt=2*Nt;for(;!IS_LEAF(Yt,Vt);)Yt=2*(Nt=LEFT_NODE(Nt));return OFFSET(Nt,Kt)},ht=function(Nt){const{uint16Array:Vt,uint32Array:Kt}=BufferStack;let Yt=2*Nt;for(;!IS_LEAF(Yt,Vt);)Yt=2*(Nt=RIGHT_NODE(Nt,Kt));return OFFSET(Nt,Kt)+COUNT(Yt,Vt)};const _t=LEFT_NODE(h),ft=RIGHT_NODE(h,nt);let bt,xt,St,wt,Pt=_t,Rt=ft;if(_&&(St=_box1,wt=_box2,arrayToBox(Pt,tt,St),arrayToBox(Rt,tt,wt),bt=_(St),xt=_(wt),xt<bt)){Pt=ft,Rt=_t;const Nt=bt;bt=xt,xt=Nt,St=wt}St||(St=_box1,arrayToBox(Pt,tt,St));const kt=c(St,IS_LEAF(2*Pt,it),bt,b+1,v+Pt);let Gt;if(kt===CONTAINED){const Nt=ut(Pt);Gt=d(Nt,ht(Pt)-Nt,!0,b+1,v+Pt,St)}else Gt=kt&&shapecastTraverse(Pt,o,c,d,_,v,b+1);if(Gt)return!0;wt=_box2,arrayToBox(Rt,tt,wt);const Dt=c(wt,IS_LEAF(2*Rt,it),xt,b+1,v+Rt);let It;if(Dt===CONTAINED){const Nt=ut(Rt);It=d(Nt,ht(Rt)-Nt,!0,b+1,v+Rt,wt)}else It=Dt&&shapecastTraverse(Rt,o,c,d,_,v,b+1);return!!It}}const temp=new three_module.Pq0,temp1=new three_module.Pq0;function closestPointToPoint(h,o,c={},d=0,_=1/0){const v=d*d,b=_*_;let tt=1/0,it=null;if(h.shapecast({boundsTraverseOrder:lt=>(temp.copy(o).clamp(lt.min,lt.max),temp.distanceToSquared(o)),intersectsBounds:(lt,ut,ht)=>ht<tt&&ht<b,intersectsTriangle:(lt,ut)=>{lt.closestPointToPoint(o,temp);const ht=o.distanceToSquared(temp);return ht<tt&&(temp1.copy(temp),tt=ht,it=ut),ht<v}}),tt===1/0)return null;const nt=Math.sqrt(tt);return c.point?c.point.copy(temp1):c.point=temp1.clone(),c.distance=nt,c.faceIndex=it,c}const ThreeRayIntersectUtilities_vA=new three_module.Pq0,ThreeRayIntersectUtilities_vB=new three_module.Pq0,ThreeRayIntersectUtilities_vC=new three_module.Pq0,_uvA=new three_module.I9Y,_uvB=new three_module.I9Y,_uvC=new three_module.I9Y,_normalA=new three_module.Pq0,_normalB=new three_module.Pq0,_normalC=new three_module.Pq0,_intersectionPoint=new three_module.Pq0;function checkIntersection(h,o,c,d,_,v){let b;return b=v===three_module.hsX?h.intersectTriangle(d,c,o,!0,_):h.intersectTriangle(o,c,d,v!==three_module.$EB,_),b===null?null:{distance:h.origin.distanceTo(_),point:_.clone()}}function checkBufferGeometryIntersection(h,o,c,d,_,v,b,tt,it){ThreeRayIntersectUtilities_vA.fromBufferAttribute(o,v),ThreeRayIntersectUtilities_vB.fromBufferAttribute(o,b),ThreeRayIntersectUtilities_vC.fromBufferAttribute(o,tt);const nt=checkIntersection(h,ThreeRayIntersectUtilities_vA,ThreeRayIntersectUtilities_vB,ThreeRayIntersectUtilities_vC,_intersectionPoint,it);if(nt){d&&(_uvA.fromBufferAttribute(d,v),_uvB.fromBufferAttribute(d,b),_uvC.fromBufferAttribute(d,tt),nt.uv=three_module.lMl.getInterpolation(_intersectionPoint,ThreeRayIntersectUtilities_vA,ThreeRayIntersectUtilities_vB,ThreeRayIntersectUtilities_vC,_uvA,_uvB,_uvC,new three_module.I9Y)),_&&(_uvA.fromBufferAttribute(_,v),_uvB.fromBufferAttribute(_,b),_uvC.fromBufferAttribute(_,tt),nt.uv1=three_module.lMl.getInterpolation(_intersectionPoint,ThreeRayIntersectUtilities_vA,ThreeRayIntersectUtilities_vB,ThreeRayIntersectUtilities_vC,_uvA,_uvB,_uvC,new three_module.I9Y)),c&&(_normalA.fromBufferAttribute(c,v),_normalB.fromBufferAttribute(c,b),_normalC.fromBufferAttribute(c,tt),nt.normal=three_module.lMl.getInterpolation(_intersectionPoint,ThreeRayIntersectUtilities_vA,ThreeRayIntersectUtilities_vB,ThreeRayIntersectUtilities_vC,_normalA,_normalB,_normalC,new three_module.Pq0),nt.normal.dot(h.direction)>0&&nt.normal.multiplyScalar(-1));const lt={a:v,b,c:tt,normal:new three_module.Pq0,materialIndex:0};three_module.lMl.getNormal(ThreeRayIntersectUtilities_vA,ThreeRayIntersectUtilities_vB,ThreeRayIntersectUtilities_vC,lt.normal),nt.face=lt,nt.faceIndex=v}return nt}function intersectTri(h,o,c,d,_){const v=3*d;let b=v+0,tt=v+1,it=v+2;const nt=h.index;h.index&&(b=nt.getX(b),tt=nt.getX(tt),it=nt.getX(it));const{position:lt,normal:ut,uv:ht,uv1:_t}=h.attributes,ft=checkBufferGeometryIntersection(c,lt,ut,ht,_t,b,tt,it,o);return ft?(ft.faceIndex=d,_&&_.push(ft),ft):null}function setTriangle(h,o,c,d){const _=h.a,v=h.b,b=h.c;let tt=o,it=o+1,nt=o+2;c&&(tt=c.getX(tt),it=c.getX(it),nt=c.getX(nt)),_.x=d.getX(tt),_.y=d.getY(tt),_.z=d.getZ(tt),v.x=d.getX(it),v.y=d.getY(it),v.z=d.getZ(it),b.x=d.getX(nt),b.y=d.getY(nt),b.z=d.getZ(nt)}new three_module.Pq0;new three_module.Pq0;new three_module.Pq0;new three_module.I9Y;new three_module.I9Y;new three_module.I9Y;function intersectTris(h,o,c,d,_,v){const{geometry:b,_indirectBuffer:tt}=h;for(let it=d,nt=d+_;it<nt;it++)intersectTri(b,o,c,it,v)}function intersectClosestTri(h,o,c,d,_){const{geometry:v,_indirectBuffer:b}=h;let tt=1/0,it=null;for(let nt=d,lt=d+_;nt<lt;nt++){let ut;ut=intersectTri(v,o,c,nt),ut&&ut.distance<tt&&(it=ut,tt=ut.distance)}return it}function iterateOverTriangles(h,o,c,d,_,v,b){const{geometry:tt}=c,{index:it}=tt,nt=tt.attributes.position;for(let lt=h,ut=o+h;lt<ut;lt++){let ht;if(ht=lt,setTriangle(b,3*ht,it,nt),b.needsUpdate=!0,d(b,ht,_,v))return!0}return!1}function refit(h,o=null){o&&Array.isArray(o)&&(o=new Set(o));const c=h.geometry,d=c.index?c.index.array:null,_=c.attributes.position;let v,b,tt,it,nt=0;const lt=h._roots;for(let ht=0,_t=lt.length;ht<_t;ht++)v=lt[ht],b=new Uint32Array(v),tt=new Uint16Array(v),it=new Float32Array(v),ut(0,nt),nt+=v.byteLength;function ut(ht,_t,ft=!1){const bt=2*ht;if(tt[bt+15]===IS_LEAFNODE_FLAG){const xt=b[ht+6];let St=1/0,wt=1/0,Pt=1/0,Rt=-1/0,kt=-1/0,Gt=-1/0;for(let Dt=3*xt,It=3*(xt+tt[bt+14]);Dt<It;Dt++){let Nt=d[Dt];const Vt=_.getX(Nt),Kt=_.getY(Nt),Yt=_.getZ(Nt);Vt<St&&(St=Vt),Vt>Rt&&(Rt=Vt),Kt<wt&&(wt=Kt),Kt>kt&&(kt=Kt),Yt<Pt&&(Pt=Yt),Yt>Gt&&(Gt=Yt)}return(it[ht+0]!==St||it[ht+1]!==wt||it[ht+2]!==Pt||it[ht+3]!==Rt||it[ht+4]!==kt||it[ht+5]!==Gt)&&(it[ht+0]=St,it[ht+1]=wt,it[ht+2]=Pt,it[ht+3]=Rt,it[ht+4]=kt,it[ht+5]=Gt,!0)}{const xt=ht+8,St=b[ht+6],wt=xt+_t,Pt=St+_t;let Rt=ft,kt=!1,Gt=!1;o?Rt||(kt=o.has(wt),Gt=o.has(Pt),Rt=!kt&&!Gt):(kt=!0,Gt=!0);const Dt=Rt||Gt;let It=!1;(Rt||kt)&&(It=ut(xt,_t,Rt));let Nt=!1;Dt&&(Nt=ut(St,_t,Rt));const Vt=It||Nt;if(Vt)for(let Kt=0;Kt<3;Kt++){const Yt=xt+Kt,nr=St+Kt,rr=it[Yt],lr=it[Yt+3],or=it[nr],pr=it[nr+3];it[ht+Kt]=rr<or?rr:or,it[ht+Kt+3]=lr>pr?lr:pr}return Vt}}}const _boundingBox=new three_module.NRn;function intersectRay(h,o,c,d){return arrayToBox(h,o,_boundingBox),c.intersectBox(_boundingBox,d)}const _boxIntersection=new three_module.Pq0;function raycast(h,o,c,d,_){BufferStack.setBuffer(h._roots[o]),_raycast(0,h,c,d,_),BufferStack.clearBuffer()}function _raycast(h,o,c,d,_){const{float32Array:v,uint16Array:b,uint32Array:tt}=BufferStack,it=2*h;if(IS_LEAF(it,b))intersectTris(o,c,d,OFFSET(h,tt),COUNT(it,b),_);else{const nt=LEFT_NODE(h);intersectRay(nt,v,d,_boxIntersection)&&_raycast(nt,o,c,d,_);const lt=RIGHT_NODE(h,tt);intersectRay(lt,v,d,_boxIntersection)&&_raycast(lt,o,c,d,_)}}const raycastFirst_generated_boxIntersection=new three_module.Pq0,_xyzFields=["x","y","z"];function raycastFirst(h,o,c,d){BufferStack.setBuffer(h._roots[o]);const _=_raycastFirst(0,h,c,d);return BufferStack.clearBuffer(),_}function _raycastFirst(h,o,c,d){const{float32Array:_,uint16Array:v,uint32Array:b}=BufferStack;let tt=2*h;if(IS_LEAF(tt,v))return intersectClosestTri(o,c,d,OFFSET(h,b),COUNT(tt,v));{const it=SPLIT_AXIS(h,b),nt=_xyzFields[it],lt=d.direction[nt]>=0;let ut,ht;lt?(ut=LEFT_NODE(h),ht=RIGHT_NODE(h,b)):(ut=RIGHT_NODE(h,b),ht=LEFT_NODE(h));const _t=intersectRay(ut,_,d,raycastFirst_generated_boxIntersection)?_raycastFirst(ut,o,c,d):null;if(_t){const bt=_t.point[nt];if(lt?bt<=_[ht+it]:bt>=_[ht+it+3])return _t}const ft=intersectRay(ht,_,d,raycastFirst_generated_boxIntersection)?_raycastFirst(ht,o,c,d):null;return _t&&ft?_t.distance<=ft.distance?_t:ft:_t||ft||null}}const boundingBox=new three_module.NRn,triangle=new ExtendedTriangle,triangle2=new ExtendedTriangle,invertedMat=new three_module.kn4,obb=new OrientedBox,obb2=new OrientedBox;function intersectsGeometry(h,o,c,d){BufferStack.setBuffer(h._roots[o]);const _=_intersectsGeometry(0,h,c,d);return BufferStack.clearBuffer(),_}function _intersectsGeometry(h,o,c,d,_=null){const{float32Array:v,uint16Array:b,uint32Array:tt}=BufferStack;let it=2*h;if(_===null&&(c.boundingBox||c.computeBoundingBox(),obb.set(c.boundingBox.min,c.boundingBox.max,d),_=obb),!IS_LEAF(it,b)){const nt=h+8,lt=tt[h+6];return arrayToBox(nt,v,boundingBox),_.intersectsBox(boundingBox)&&_intersectsGeometry(nt,o,c,d,_)?!0:(arrayToBox(lt,v,boundingBox),!(!_.intersectsBox(boundingBox)||!_intersectsGeometry(lt,o,c,d,_)))}{const nt=o.geometry,lt=nt.index,ut=nt.attributes.position,ht=c.index,_t=c.attributes.position,ft=OFFSET(h,tt),bt=COUNT(it,b);if(invertedMat.copy(d).invert(),c.boundsTree)return arrayToBox(h,v,obb2),obb2.matrix.copy(invertedMat),obb2.needsUpdate=!0,c.boundsTree.shapecast({intersectsBounds:xt=>obb2.intersectsBox(xt),intersectsTriangle:xt=>{xt.a.applyMatrix4(d),xt.b.applyMatrix4(d),xt.c.applyMatrix4(d),xt.needsUpdate=!0;for(let St=3*ft,wt=3*(bt+ft);St<wt;St+=3)if(setTriangle(triangle2,St,lt,ut),triangle2.needsUpdate=!0,xt.intersectsTriangle(triangle2))return!0;return!1}});for(let xt=3*ft,St=3*(bt+ft);xt<St;xt+=3){setTriangle(triangle,xt,lt,ut),triangle.a.applyMatrix4(invertedMat),triangle.b.applyMatrix4(invertedMat),triangle.c.applyMatrix4(invertedMat),triangle.needsUpdate=!0;for(let wt=0,Pt=ht.count;wt<Pt;wt+=3)if(setTriangle(triangle2,wt,ht,_t),triangle2.needsUpdate=!0,triangle.intersectsTriangle(triangle2))return!0}}}const tempMatrix=new three_module.kn4,closestPointToGeometry_generated_obb=new OrientedBox,closestPointToGeometry_generated_obb2=new OrientedBox,closestPointToGeometry_generated_temp1=new three_module.Pq0,temp2=new three_module.Pq0,temp3=new three_module.Pq0,temp4=new three_module.Pq0;function closestPointToGeometry(h,o,c,d={},_={},v=0,b=1/0){o.boundingBox||o.computeBoundingBox(),closestPointToGeometry_generated_obb.set(o.boundingBox.min,o.boundingBox.max,c),closestPointToGeometry_generated_obb.needsUpdate=!0;const tt=h.geometry,it=tt.attributes.position,nt=tt.index,lt=o.attributes.position,ut=o.index,ht=ExtendedTrianglePool.getPrimitive(),_t=ExtendedTrianglePool.getPrimitive();let ft=closestPointToGeometry_generated_temp1,bt=temp2,xt=null,St=null;_&&(xt=temp3,St=temp4);let wt=1/0,Pt=null,Rt=null;return tempMatrix.copy(c).invert(),closestPointToGeometry_generated_obb2.matrix.copy(tempMatrix),h.shapecast({boundsTraverseOrder:kt=>closestPointToGeometry_generated_obb.distanceToBox(kt),intersectsBounds:(kt,Gt,Dt)=>Dt<wt&&Dt<b&&(Gt&&(closestPointToGeometry_generated_obb2.min.copy(kt.min),closestPointToGeometry_generated_obb2.max.copy(kt.max),closestPointToGeometry_generated_obb2.needsUpdate=!0),!0),intersectsRange:(kt,Gt)=>{if(o.boundsTree)return o.boundsTree.shapecast({boundsTraverseOrder:Dt=>closestPointToGeometry_generated_obb2.distanceToBox(Dt),intersectsBounds:(Dt,It,Nt)=>Nt<wt&&Nt<b,intersectsRange:(Dt,It)=>{for(let Nt=Dt,Vt=Dt+It;Nt<Vt;Nt++){setTriangle(_t,3*Nt,ut,lt),_t.a.applyMatrix4(c),_t.b.applyMatrix4(c),_t.c.applyMatrix4(c),_t.needsUpdate=!0;for(let Kt=kt,Yt=kt+Gt;Kt<Yt;Kt++){setTriangle(ht,3*Kt,nt,it),ht.needsUpdate=!0;const nr=ht.distanceToTriangle(_t,ft,xt);if(nr<wt&&(bt.copy(ft),St&&St.copy(xt),wt=nr,Pt=Kt,Rt=Nt),nr<v)return!0}}}});for(let Dt=0,It=geometryUtils_getTriCount(o);Dt<It;Dt++){setTriangle(_t,3*Dt,ut,lt),_t.a.applyMatrix4(c),_t.b.applyMatrix4(c),_t.c.applyMatrix4(c),_t.needsUpdate=!0;for(let Nt=kt,Vt=kt+Gt;Nt<Vt;Nt++){setTriangle(ht,3*Nt,nt,it),ht.needsUpdate=!0;const Kt=ht.distanceToTriangle(_t,ft,xt);if(Kt<wt&&(bt.copy(ft),St&&St.copy(xt),wt=Kt,Pt=Nt,Rt=Dt),Kt<v)return!0}}}}),ExtendedTrianglePool.releasePrimitive(ht),ExtendedTrianglePool.releasePrimitive(_t),wt===1/0?null:(d.point?d.point.copy(bt):d.point=bt.clone(),d.distance=wt,d.faceIndex=Pt,_&&(_.point?_.point.copy(St):_.point=St.clone(),_.point.applyMatrix4(tempMatrix),bt.applyMatrix4(tempMatrix),_.distance=bt.sub(_.point).length(),_.faceIndex=Rt),d)}function intersectTris_indirect(h,o,c,d,_,v){const{geometry:b,_indirectBuffer:tt}=h;for(let it=d,nt=d+_;it<nt;it++)intersectTri(b,o,c,tt?tt[it]:it,v)}function intersectClosestTri_indirect(h,o,c,d,_){const{geometry:v,_indirectBuffer:b}=h;let tt=1/0,it=null;for(let nt=d,lt=d+_;nt<lt;nt++){let ut;ut=intersectTri(v,o,c,b?b[nt]:nt),ut&&ut.distance<tt&&(it=ut,tt=ut.distance)}return it}function iterateOverTriangles_indirect(h,o,c,d,_,v,b){const{geometry:tt}=c,{index:it}=tt,nt=tt.attributes.position;for(let lt=h,ut=o+h;lt<ut;lt++){let ht;if(ht=c.resolveTriangleIndex(lt),setTriangle(b,3*ht,it,nt),b.needsUpdate=!0,d(b,ht,_,v))return!0}return!1}function refit_indirect(h,o=null){o&&Array.isArray(o)&&(o=new Set(o));const c=h.geometry,d=c.index?c.index.array:null,_=c.attributes.position;let v,b,tt,it,nt=0;const lt=h._roots;for(let ht=0,_t=lt.length;ht<_t;ht++)v=lt[ht],b=new Uint32Array(v),tt=new Uint16Array(v),it=new Float32Array(v),ut(0,nt),nt+=v.byteLength;function ut(ht,_t,ft=!1){const bt=2*ht;if(tt[bt+15]===IS_LEAFNODE_FLAG){const xt=b[ht+6];let St=1/0,wt=1/0,Pt=1/0,Rt=-1/0,kt=-1/0,Gt=-1/0;for(let Dt=xt,It=xt+tt[bt+14];Dt<It;Dt++){const Nt=3*h.resolveTriangleIndex(Dt);for(let Vt=0;Vt<3;Vt++){let Kt=Nt+Vt;Kt=d?d[Kt]:Kt;const Yt=_.getX(Kt),nr=_.getY(Kt),rr=_.getZ(Kt);Yt<St&&(St=Yt),Yt>Rt&&(Rt=Yt),nr<wt&&(wt=nr),nr>kt&&(kt=nr),rr<Pt&&(Pt=rr),rr>Gt&&(Gt=rr)}}return(it[ht+0]!==St||it[ht+1]!==wt||it[ht+2]!==Pt||it[ht+3]!==Rt||it[ht+4]!==kt||it[ht+5]!==Gt)&&(it[ht+0]=St,it[ht+1]=wt,it[ht+2]=Pt,it[ht+3]=Rt,it[ht+4]=kt,it[ht+5]=Gt,!0)}{const xt=ht+8,St=b[ht+6],wt=xt+_t,Pt=St+_t;let Rt=ft,kt=!1,Gt=!1;o?Rt||(kt=o.has(wt),Gt=o.has(Pt),Rt=!kt&&!Gt):(kt=!0,Gt=!0);const Dt=Rt||Gt;let It=!1;(Rt||kt)&&(It=ut(xt,_t,Rt));let Nt=!1;Dt&&(Nt=ut(St,_t,Rt));const Vt=It||Nt;if(Vt)for(let Kt=0;Kt<3;Kt++){const Yt=xt+Kt,nr=St+Kt,rr=it[Yt],lr=it[Yt+3],or=it[nr],pr=it[nr+3];it[ht+Kt]=rr<or?rr:or,it[ht+Kt+3]=lr>pr?lr:pr}return Vt}}}const raycast_indirect_generated_boxIntersection=new three_module.Pq0;function raycast_indirect(h,o,c,d,_){BufferStack.setBuffer(h._roots[o]),raycast_indirect_generated_raycast(0,h,c,d,_),BufferStack.clearBuffer()}function raycast_indirect_generated_raycast(h,o,c,d,_){const{float32Array:v,uint16Array:b,uint32Array:tt}=BufferStack,it=2*h;if(IS_LEAF(it,b))intersectTris_indirect(o,c,d,OFFSET(h,tt),COUNT(it,b),_);else{const nt=LEFT_NODE(h);intersectRay(nt,v,d,raycast_indirect_generated_boxIntersection)&&raycast_indirect_generated_raycast(nt,o,c,d,_);const lt=RIGHT_NODE(h,tt);intersectRay(lt,v,d,raycast_indirect_generated_boxIntersection)&&raycast_indirect_generated_raycast(lt,o,c,d,_)}}const raycastFirst_indirect_generated_boxIntersection=new three_module.Pq0,raycastFirst_indirect_generated_xyzFields=["x","y","z"];function raycastFirst_indirect(h,o,c,d){BufferStack.setBuffer(h._roots[o]);const _=raycastFirst_indirect_generated_raycastFirst(0,h,c,d);return BufferStack.clearBuffer(),_}function raycastFirst_indirect_generated_raycastFirst(h,o,c,d){const{float32Array:_,uint16Array:v,uint32Array:b}=BufferStack;let tt=2*h;if(IS_LEAF(tt,v))return intersectClosestTri_indirect(o,c,d,OFFSET(h,b),COUNT(tt,v));{const it=SPLIT_AXIS(h,b),nt=raycastFirst_indirect_generated_xyzFields[it],lt=d.direction[nt]>=0;let ut,ht;lt?(ut=LEFT_NODE(h),ht=RIGHT_NODE(h,b)):(ut=RIGHT_NODE(h,b),ht=LEFT_NODE(h));const _t=intersectRay(ut,_,d,raycastFirst_indirect_generated_boxIntersection)?raycastFirst_indirect_generated_raycastFirst(ut,o,c,d):null;if(_t){const bt=_t.point[nt];if(lt?bt<=_[ht+it]:bt>=_[ht+it+3])return _t}const ft=intersectRay(ht,_,d,raycastFirst_indirect_generated_boxIntersection)?raycastFirst_indirect_generated_raycastFirst(ht,o,c,d):null;return _t&&ft?_t.distance<=ft.distance?_t:ft:_t||ft||null}}const intersectsGeometry_indirect_generated_boundingBox=new three_module.NRn,intersectsGeometry_indirect_generated_triangle=new ExtendedTriangle,intersectsGeometry_indirect_generated_triangle2=new ExtendedTriangle,intersectsGeometry_indirect_generated_invertedMat=new three_module.kn4,intersectsGeometry_indirect_generated_obb=new OrientedBox,intersectsGeometry_indirect_generated_obb2=new OrientedBox;function intersectsGeometry_indirect(h,o,c,d){BufferStack.setBuffer(h._roots[o]);const _=intersectsGeometry_indirect_generated_intersectsGeometry(0,h,c,d);return BufferStack.clearBuffer(),_}function intersectsGeometry_indirect_generated_intersectsGeometry(h,o,c,d,_=null){const{float32Array:v,uint16Array:b,uint32Array:tt}=BufferStack;let it=2*h;if(_===null&&(c.boundingBox||c.computeBoundingBox(),intersectsGeometry_indirect_generated_obb.set(c.boundingBox.min,c.boundingBox.max,d),_=intersectsGeometry_indirect_generated_obb),!IS_LEAF(it,b)){const nt=h+8,lt=tt[h+6];return arrayToBox(nt,v,intersectsGeometry_indirect_generated_boundingBox),_.intersectsBox(intersectsGeometry_indirect_generated_boundingBox)&&intersectsGeometry_indirect_generated_intersectsGeometry(nt,o,c,d,_)?!0:(arrayToBox(lt,v,intersectsGeometry_indirect_generated_boundingBox),!(!_.intersectsBox(intersectsGeometry_indirect_generated_boundingBox)||!intersectsGeometry_indirect_generated_intersectsGeometry(lt,o,c,d,_)))}{const nt=o.geometry,lt=nt.index,ut=nt.attributes.position,ht=c.index,_t=c.attributes.position,ft=OFFSET(h,tt),bt=COUNT(it,b);if(intersectsGeometry_indirect_generated_invertedMat.copy(d).invert(),c.boundsTree)return arrayToBox(h,v,intersectsGeometry_indirect_generated_obb2),intersectsGeometry_indirect_generated_obb2.matrix.copy(intersectsGeometry_indirect_generated_invertedMat),intersectsGeometry_indirect_generated_obb2.needsUpdate=!0,c.boundsTree.shapecast({intersectsBounds:xt=>intersectsGeometry_indirect_generated_obb2.intersectsBox(xt),intersectsTriangle:xt=>{xt.a.applyMatrix4(d),xt.b.applyMatrix4(d),xt.c.applyMatrix4(d),xt.needsUpdate=!0;for(let St=ft,wt=bt+ft;St<wt;St++)if(setTriangle(intersectsGeometry_indirect_generated_triangle2,3*o.resolveTriangleIndex(St),lt,ut),intersectsGeometry_indirect_generated_triangle2.needsUpdate=!0,xt.intersectsTriangle(intersectsGeometry_indirect_generated_triangle2))return!0;return!1}});for(let xt=ft,St=bt+ft;xt<St;xt++){const wt=o.resolveTriangleIndex(xt);setTriangle(intersectsGeometry_indirect_generated_triangle,3*wt,lt,ut),intersectsGeometry_indirect_generated_triangle.a.applyMatrix4(intersectsGeometry_indirect_generated_invertedMat),intersectsGeometry_indirect_generated_triangle.b.applyMatrix4(intersectsGeometry_indirect_generated_invertedMat),intersectsGeometry_indirect_generated_triangle.c.applyMatrix4(intersectsGeometry_indirect_generated_invertedMat),intersectsGeometry_indirect_generated_triangle.needsUpdate=!0;for(let Pt=0,Rt=ht.count;Pt<Rt;Pt+=3)if(setTriangle(intersectsGeometry_indirect_generated_triangle2,Pt,ht,_t),intersectsGeometry_indirect_generated_triangle2.needsUpdate=!0,intersectsGeometry_indirect_generated_triangle.intersectsTriangle(intersectsGeometry_indirect_generated_triangle2))return!0}}}const closestPointToGeometry_indirect_generated_tempMatrix=new three_module.kn4,closestPointToGeometry_indirect_generated_obb=new OrientedBox,closestPointToGeometry_indirect_generated_obb2=new OrientedBox,closestPointToGeometry_indirect_generated_temp1=new three_module.Pq0,closestPointToGeometry_indirect_generated_temp2=new three_module.Pq0,closestPointToGeometry_indirect_generated_temp3=new three_module.Pq0,closestPointToGeometry_indirect_generated_temp4=new three_module.Pq0;function closestPointToGeometry_indirect(h,o,c,d={},_={},v=0,b=1/0){o.boundingBox||o.computeBoundingBox(),closestPointToGeometry_indirect_generated_obb.set(o.boundingBox.min,o.boundingBox.max,c),closestPointToGeometry_indirect_generated_obb.needsUpdate=!0;const tt=h.geometry,it=tt.attributes.position,nt=tt.index,lt=o.attributes.position,ut=o.index,ht=ExtendedTrianglePool.getPrimitive(),_t=ExtendedTrianglePool.getPrimitive();let ft=closestPointToGeometry_indirect_generated_temp1,bt=closestPointToGeometry_indirect_generated_temp2,xt=null,St=null;_&&(xt=closestPointToGeometry_indirect_generated_temp3,St=closestPointToGeometry_indirect_generated_temp4);let wt=1/0,Pt=null,Rt=null;return closestPointToGeometry_indirect_generated_tempMatrix.copy(c).invert(),closestPointToGeometry_indirect_generated_obb2.matrix.copy(closestPointToGeometry_indirect_generated_tempMatrix),h.shapecast({boundsTraverseOrder:kt=>closestPointToGeometry_indirect_generated_obb.distanceToBox(kt),intersectsBounds:(kt,Gt,Dt)=>Dt<wt&&Dt<b&&(Gt&&(closestPointToGeometry_indirect_generated_obb2.min.copy(kt.min),closestPointToGeometry_indirect_generated_obb2.max.copy(kt.max),closestPointToGeometry_indirect_generated_obb2.needsUpdate=!0),!0),intersectsRange:(kt,Gt)=>{if(o.boundsTree){const Dt=o.boundsTree;return Dt.shapecast({boundsTraverseOrder:It=>closestPointToGeometry_indirect_generated_obb2.distanceToBox(It),intersectsBounds:(It,Nt,Vt)=>Vt<wt&&Vt<b,intersectsRange:(It,Nt)=>{for(let Vt=It,Kt=It+Nt;Vt<Kt;Vt++){const Yt=Dt.resolveTriangleIndex(Vt);setTriangle(_t,3*Yt,ut,lt),_t.a.applyMatrix4(c),_t.b.applyMatrix4(c),_t.c.applyMatrix4(c),_t.needsUpdate=!0;for(let nr=kt,rr=kt+Gt;nr<rr;nr++){const lr=h.resolveTriangleIndex(nr);setTriangle(ht,3*lr,nt,it),ht.needsUpdate=!0;const or=ht.distanceToTriangle(_t,ft,xt);if(or<wt&&(bt.copy(ft),St&&St.copy(xt),wt=or,Pt=nr,Rt=Vt),or<v)return!0}}}})}for(let Dt=0,It=geometryUtils_getTriCount(o);Dt<It;Dt++){setTriangle(_t,3*Dt,ut,lt),_t.a.applyMatrix4(c),_t.b.applyMatrix4(c),_t.c.applyMatrix4(c),_t.needsUpdate=!0;for(let Nt=kt,Vt=kt+Gt;Nt<Vt;Nt++){const Kt=h.resolveTriangleIndex(Nt);setTriangle(ht,3*Kt,nt,it),ht.needsUpdate=!0;const Yt=ht.distanceToTriangle(_t,ft,xt);if(Yt<wt&&(bt.copy(ft),St&&St.copy(xt),wt=Yt,Pt=Nt,Rt=Dt),Yt<v)return!0}}}}),ExtendedTrianglePool.releasePrimitive(ht),ExtendedTrianglePool.releasePrimitive(_t),wt===1/0?null:(d.point?d.point.copy(bt):d.point=bt.clone(),d.distance=wt,d.faceIndex=Pt,_&&(_.point?_.point.copy(St):_.point=St.clone(),_.point.applyMatrix4(closestPointToGeometry_indirect_generated_tempMatrix),bt.applyMatrix4(closestPointToGeometry_indirect_generated_tempMatrix),_.distance=bt.sub(_.point).length(),_.faceIndex=Rt),d)}function isSharedArrayBufferSupported(){return typeof SharedArrayBuffer<"u"}const _bufferStack1=new BufferStack.constructor,_bufferStack2=new BufferStack.constructor,_boxPool=new PrimitivePool(()=>new three_module.NRn),_leftBox1=new three_module.NRn,_rightBox1=new three_module.NRn,_leftBox2=new three_module.NRn,_rightBox2=new three_module.NRn;let _active=!1;function bvhcast(h,o,c,d){if(_active)throw new Error("MeshBVH: Recursive calls to bvhcast not supported.");_active=!0;const _=h._roots,v=o._roots;let b,tt=0,it=0;const nt=new three_module.kn4().copy(c).invert();for(let lt=0,ut=_.length;lt<ut;lt++){_bufferStack1.setBuffer(_[lt]),it=0;const ht=_boxPool.getPrimitive();arrayToBox(0,_bufferStack1.float32Array,ht),ht.applyMatrix4(nt);for(let _t=0,ft=v.length;_t<ft&&(_bufferStack2.setBuffer(v[lt]),b=_traverse(0,0,c,nt,d,tt,it,0,0,ht),_bufferStack2.clearBuffer(),it+=v[_t].length,!b);_t++);if(_boxPool.releasePrimitive(ht),_bufferStack1.clearBuffer(),tt+=_[lt].length,b)break}return _active=!1,b}function _traverse(h,o,c,d,_,v=0,b=0,tt=0,it=0,nt=null,lt=!1){let ut,ht;lt?(ut=_bufferStack2,ht=_bufferStack1):(ut=_bufferStack1,ht=_bufferStack2);const _t=ut.float32Array,ft=ut.uint32Array,bt=ut.uint16Array,xt=ht.float32Array,St=ht.uint32Array,wt=ht.uint16Array,Pt=2*o,Rt=IS_LEAF(2*h,bt),kt=IS_LEAF(Pt,wt);let Gt=!1;if(kt&&Rt)Gt=lt?_(OFFSET(o,St),COUNT(2*o,wt),OFFSET(h,ft),COUNT(2*h,bt),it,b+o,tt,v+h):_(OFFSET(h,ft),COUNT(2*h,bt),OFFSET(o,St),COUNT(2*o,wt),tt,v+h,it,b+o);else if(kt){const Dt=_boxPool.getPrimitive();arrayToBox(o,xt,Dt),Dt.applyMatrix4(c);const It=LEFT_NODE(h),Nt=RIGHT_NODE(h,ft);arrayToBox(It,_t,_leftBox1),arrayToBox(Nt,_t,_rightBox1);const Vt=Dt.intersectsBox(_leftBox1),Kt=Dt.intersectsBox(_rightBox1);Gt=Vt&&_traverse(o,It,d,c,_,b,v,it,tt+1,Dt,!lt)||Kt&&_traverse(o,Nt,d,c,_,b,v,it,tt+1,Dt,!lt),_boxPool.releasePrimitive(Dt)}else{const Dt=LEFT_NODE(o),It=RIGHT_NODE(o,St);arrayToBox(Dt,xt,_leftBox2),arrayToBox(It,xt,_rightBox2);const Nt=nt.intersectsBox(_leftBox2),Vt=nt.intersectsBox(_rightBox2);if(Nt&&Vt)Gt=_traverse(h,Dt,c,d,_,v,b,tt,it+1,nt,lt)||_traverse(h,It,c,d,_,v,b,tt,it+1,nt,lt);else if(Nt)if(Rt)Gt=_traverse(h,Dt,c,d,_,v,b,tt,it+1,nt,lt);else{const Kt=_boxPool.getPrimitive();Kt.copy(_leftBox2).applyMatrix4(c);const Yt=LEFT_NODE(h),nr=RIGHT_NODE(h,ft);arrayToBox(Yt,_t,_leftBox1),arrayToBox(nr,_t,_rightBox1);const rr=Kt.intersectsBox(_leftBox1),lr=Kt.intersectsBox(_rightBox1);Gt=rr&&_traverse(Dt,Yt,d,c,_,b,v,it,tt+1,Kt,!lt)||lr&&_traverse(Dt,nr,d,c,_,b,v,it,tt+1,Kt,!lt),_boxPool.releasePrimitive(Kt)}else if(Vt)if(Rt)Gt=_traverse(h,It,c,d,_,v,b,tt,it+1,nt,lt);else{const Kt=_boxPool.getPrimitive();Kt.copy(_rightBox2).applyMatrix4(c);const Yt=LEFT_NODE(h),nr=RIGHT_NODE(h,ft);arrayToBox(Yt,_t,_leftBox1),arrayToBox(nr,_t,_rightBox1);const rr=Kt.intersectsBox(_leftBox1),lr=Kt.intersectsBox(_rightBox1);Gt=rr&&_traverse(It,Yt,d,c,_,b,v,it,tt+1,Kt,!lt)||lr&&_traverse(It,nr,d,c,_,b,v,it,tt+1,Kt,!lt),_boxPool.releasePrimitive(Kt)}}return Gt}const MeshBVH_obb=new OrientedBox,tempBox=new three_module.NRn;class MeshBVH{static serialize(o,c={}){c={cloneBuffers:!0,...c};const d=o.geometry,_=o._roots,v=o._indirectBuffer,b=d.getIndex();let tt;return tt=c.cloneBuffers?{roots:_.map(it=>it.slice()),index:b.array.slice(),indirectBuffer:v?v.slice():null}:{roots:_,index:b.array,indirectBuffer:v},tt}static deserialize(o,c,d={}){d={setIndex:!0,indirect:!!o.indirectBuffer,...d};const{index:_,roots:v,indirectBuffer:b}=o,tt=new MeshBVH(c,{...d,[SKIP_GENERATION]:!0});if(tt._roots=v,tt._indirectBuffer=b||null,d.setIndex){const it=c.getIndex();if(it===null){const nt=new three_module.THS(o.index,1,!1);c.setIndex(nt)}else it.array!==_&&(it.array.set(_),it.needsUpdate=!0)}return tt}get indirect(){return!!this._indirectBuffer}constructor(o,c={}){if(!o.isBufferGeometry)throw new Error("MeshBVH: Only BufferGeometries are supported.");if(o.index&&o.index.isInterleavedBufferAttribute)throw new Error("MeshBVH: InterleavedBufferAttribute is not supported for the index attribute.");if((c=Object.assign({strategy:CENTER,maxDepth:40,maxLeafTris:10,verbose:!0,useSharedArrayBuffer:!1,setBoundingBox:!0,onProgress:null,indirect:!1,[SKIP_GENERATION]:!1},c)).useSharedArrayBuffer&&!isSharedArrayBufferSupported())throw new Error("MeshBVH: SharedArrayBuffer is not available.");this.geometry=o,this._roots=null,this._indirectBuffer=null,c[SKIP_GENERATION]||(buildPackedTree(this,c),!o.boundingBox&&c.setBoundingBox&&(o.boundingBox=this.getBoundingBox(new three_module.NRn)));const{_indirectBuffer:d}=this;this.resolveTriangleIndex=c.indirect?_=>d[_]:_=>_}refit(o=null){return(this.indirect?refit_indirect:refit)(this,o)}traverse(o,c=0){const d=this._roots[c],_=new Uint32Array(d),v=new Uint16Array(d);(function b(tt,it=0){const nt=2*tt,lt=v[nt+15]===IS_LEAFNODE_FLAG;if(lt){const ut=_[tt+6],ht=v[nt+14];o(it,lt,new Float32Array(d,4*tt,6),ut,ht)}else{const ut=tt+BYTES_PER_NODE/4,ht=_[tt+6],_t=_[tt+7];o(it,lt,new Float32Array(d,4*tt,6),_t)||(b(ut,it+1),b(ht,it+1))}})(0)}raycast(o,c=three_module.hB5){const d=this._roots,_=this.geometry,v=[],b=c.isMaterial,tt=Array.isArray(c),it=_.groups,nt=b?c.side:c,lt=this.indirect?raycast_indirect:raycast;for(let ut=0,ht=d.length;ut<ht;ut++){const _t=tt?c[it[ut].materialIndex].side:nt,ft=v.length;if(lt(this,ut,_t,o,v),tt){const bt=it[ut].materialIndex;for(let xt=ft,St=v.length;xt<St;xt++)v[xt].face.materialIndex=bt}}return v}raycastFirst(o,c=three_module.hB5){const d=this._roots,_=this.geometry,v=c.isMaterial,b=Array.isArray(c);let tt=null;const it=_.groups,nt=v?c.side:c,lt=this.indirect?raycastFirst_indirect:raycastFirst;for(let ut=0,ht=d.length;ut<ht;ut++){const _t=lt(this,ut,b?c[it[ut].materialIndex].side:nt,o);_t!=null&&(tt==null||_t.distance<tt.distance)&&(tt=_t,b&&(_t.face.materialIndex=it[ut].materialIndex))}return tt}intersectsGeometry(o,c){let d=!1;const _=this._roots,v=this.indirect?intersectsGeometry_indirect:intersectsGeometry;for(let b=0,tt=_.length;b<tt&&(d=v(this,b,o,c),!d);b++);return d}shapecast(o){const c=ExtendedTrianglePool.getPrimitive(),d=this.indirect?iterateOverTriangles_indirect:iterateOverTriangles;let{boundsTraverseOrder:_,intersectsBounds:v,intersectsRange:b,intersectsTriangle:tt}=o;if(b&&tt){const ut=b;b=(ht,_t,ft,bt,xt)=>!!ut(ht,_t,ft,bt,xt)||d(ht,_t,this,tt,ft,bt,c)}else b||(b=tt?(ut,ht,_t,ft)=>d(ut,ht,this,tt,_t,ft,c):(ut,ht,_t)=>_t);let it=!1,nt=0;const lt=this._roots;for(let ut=0,ht=lt.length;ut<ht;ut++){const _t=lt[ut];if(it=shapecast(this,ut,v,b,_,nt),it)break;nt+=_t.byteLength}return ExtendedTrianglePool.releasePrimitive(c),it}bvhcast(o,c,d){let{intersectsRanges:_,intersectsTriangles:v}=d;const b=ExtendedTrianglePool.getPrimitive(),tt=this.geometry.index,it=this.geometry.attributes.position,nt=this.indirect?ft=>{const bt=this.resolveTriangleIndex(ft);setTriangle(b,3*bt,tt,it)}:ft=>{setTriangle(b,3*ft,tt,it)},lt=ExtendedTrianglePool.getPrimitive(),ut=o.geometry.index,ht=o.geometry.attributes.position,_t=o.indirect?ft=>{const bt=o.resolveTriangleIndex(ft);setTriangle(lt,3*bt,ut,ht)}:ft=>{setTriangle(lt,3*ft,ut,ht)};if(v){const ft=(bt,xt,St,wt,Pt,Rt,kt,Gt)=>{for(let Dt=St,It=St+wt;Dt<It;Dt++){_t(Dt),lt.a.applyMatrix4(c),lt.b.applyMatrix4(c),lt.c.applyMatrix4(c),lt.needsUpdate=!0;for(let Nt=bt,Vt=bt+xt;Nt<Vt;Nt++)if(nt(Nt),b.needsUpdate=!0,v(b,lt,Nt,Dt,Pt,Rt,kt,Gt))return!0}return!1};if(_){const bt=_;_=function(xt,St,wt,Pt,Rt,kt,Gt,Dt){return!!bt(xt,St,wt,Pt,Rt,kt,Gt,Dt)||ft(xt,St,wt,Pt,Rt,kt,Gt,Dt)}}else _=ft}return bvhcast(this,o,c,_)}intersectsBox(o,c){return MeshBVH_obb.set(o.min,o.max,c),MeshBVH_obb.needsUpdate=!0,this.shapecast({intersectsBounds:d=>MeshBVH_obb.intersectsBox(d),intersectsTriangle:d=>MeshBVH_obb.intersectsTriangle(d)})}intersectsSphere(o){return this.shapecast({intersectsBounds:c=>o.intersectsBox(c),intersectsTriangle:c=>c.intersectsSphere(o)})}closestPointToGeometry(o,c,d={},_={},v=0,b=1/0){return(this.indirect?closestPointToGeometry_indirect:closestPointToGeometry)(this,o,c,d,_,v,b)}closestPointToPoint(o,c={},d=0,_=1/0){return closestPointToPoint(this,o,c,d,_)}getBoundingBox(o){return o.makeEmpty(),this._roots.forEach(c=>{arrayToBox(0,new Float32Array(c),tempBox),o.union(tempBox)}),o}}const HASH_WIDTH=1e-6,HASH_HALF_WIDTH=.5*HASH_WIDTH,HASH_MULTIPLIER=Math.pow(10,-Math.log10(HASH_WIDTH)),HASH_ADDITION=HASH_HALF_WIDTH*HASH_MULTIPLIER;function hashNumber(h){return~~(h*HASH_MULTIPLIER+HASH_ADDITION)}function hashVertex2(h){return`${hashNumber(h.x)},${hashNumber(h.y)}`}function hashVertex3(h){return`${hashNumber(h.x)},${hashNumber(h.y)},${hashNumber(h.z)}`}function hashVertex4(h){return`${hashNumber(h.x)},${hashNumber(h.y)},${hashNumber(h.z)},${hashNumber(h.w)}`}function toNormalizedRay(h,o,c){c.direction.subVectors(o,h).normalize();const d=h.dot(c.direction);return c.origin.copy(h).addScaledVector(c.direction,-d),c}const DEGENERATE_EPSILON=1e-8,_tempVec=new three_module.Pq0;function toTriIndex(h){return~~(h/3)}function toEdgeIndex(h){return h%3}function sortEdgeFunc(h,o){return h.start-o.start}function getProjectedDistance(h,o){return _tempVec.subVectors(o,h.origin).dot(h.direction)}function matchEdges(h,o,c,d=DEGENERATE_EPSILON){h.sort(sortEdgeFunc),o.sort(sortEdgeFunc);for(let tt=0;tt<h.length;tt++){const it=h[tt];for(let nt=0;nt<o.length;nt++){const lt=o[nt];if(!(lt.start>it.end)){if(it.end<lt.start||lt.end<it.start)continue;if(it.start<=lt.start&&it.end>=lt.end)v(lt.end,it.end)||h.splice(tt+1,0,{start:lt.end,end:it.end,index:it.index}),it.end=lt.start,lt.start=0,lt.end=0;else if(it.start>=lt.start&&it.end<=lt.end)v(it.end,lt.end)||o.splice(nt+1,0,{start:it.end,end:lt.end,index:lt.index}),lt.end=it.start,it.start=0,it.end=0;else if(it.start<=lt.start&&it.end<=lt.end){const ut=it.end;it.end=lt.start,lt.start=ut}else{if(!(it.start>=lt.start&&it.end>=lt.end))throw new Error;{const ut=lt.end;lt.end=it.start,it.start=ut}}}if(c.has(it.index)||c.set(it.index,[]),c.has(lt.index)||c.set(lt.index,[]),c.get(it.index).push(lt.index),c.get(lt.index).push(it.index),b(lt)&&(o.splice(nt,1),nt--),b(it)){h.splice(tt,1),tt--;break}}}function _(tt){for(let it=0;it<tt.length;it++)b(tt[it])&&(tt.splice(it,1),it--)}function v(tt,it){return Math.abs(it-tt)<d}function b(tt){return Math.abs(tt.end-tt.start)<d}_(h),_(o)}const DIST_EPSILON=1e-5,ANGLE_EPSILON=1e-4;class RaySet{constructor(){this._rays=[]}addRay(o){this._rays.push(o)}findClosestRay(o){const c=this._rays,d=o.clone();d.direction.multiplyScalar(-1);let _=1/0,v=null;for(let it=0,nt=c.length;it<nt;it++){const lt=c[it];if(b(lt,o)&&b(lt,d))continue;const ut=tt(lt,o),ht=tt(lt,d),_t=Math.min(ut,ht);_t<_&&(_=_t,v=lt)}return v;function b(it,nt){const lt=it.origin.distanceTo(nt.origin)>DIST_EPSILON;return it.direction.angleTo(nt.direction)>ANGLE_EPSILON||lt}function tt(it,nt){const lt=it.origin.distanceTo(nt.origin),ut=it.direction.angleTo(nt.direction);return lt/DIST_EPSILON+ut/ANGLE_EPSILON}}}const _v0=new three_module.Pq0,_v1=new three_module.Pq0,computeDisjointEdges_ray=new three_module.RlV;function computeDisjointEdges(h,o,c){const d=h.attributes,_=h.index,v=d.position,b=new Map,tt=new Map,it=Array.from(o),nt=new RaySet;for(let lt=0,ut=it.length;lt<ut;lt++){const ht=it[lt],_t=toTriIndex(ht),ft=toEdgeIndex(ht);let bt,xt=3*_t+ft,St=3*_t+(ft+1)%3;_&&(xt=_.getX(xt),St=_.getX(St)),_v0.fromBufferAttribute(v,xt),_v1.fromBufferAttribute(v,St),toNormalizedRay(_v0,_v1,computeDisjointEdges_ray);let wt=nt.findClosestRay(computeDisjointEdges_ray);wt===null&&(wt=computeDisjointEdges_ray.clone(),nt.addRay(wt)),tt.has(wt)||tt.set(wt,{forward:[],reverse:[],ray:wt}),bt=tt.get(wt);let Pt=getProjectedDistance(wt,_v0),Rt=getProjectedDistance(wt,_v1);Pt>Rt&&([Pt,Rt]=[Rt,Pt]),computeDisjointEdges_ray.direction.dot(wt.direction)<0?bt.reverse.push({start:Pt,end:Rt,index:ht}):bt.forward.push({start:Pt,end:Rt,index:ht})}return tt.forEach(({forward:lt,reverse:ut},ht)=>{matchEdges(lt,ut,b,c),lt.length===0&&ut.length===0&&tt.delete(ht)}),{disjointConnectivityMap:b,fragmentMap:tt}}const _vec2=new three_module.I9Y,HalfEdgeMap_vec3=new three_module.Pq0,_vec4=new three_module.IUQ,_hashes=["","",""];class HalfEdgeMap{constructor(o=null){this.data=null,this.disjointConnections=null,this.unmatchedDisjointEdges=null,this.unmatchedEdges=-1,this.matchedEdges=-1,this.useDrawRange=!0,this.useAllAttributes=!1,this.matchDisjointEdges=!1,this.degenerateEpsilon=1e-8,o&&this.updateFrom(o)}getSiblingTriangleIndex(o,c){const d=this.data[3*o+c];return d===-1?-1:~~(d/3)}getSiblingEdgeIndex(o,c){const d=this.data[3*o+c];return d===-1?-1:d%3}getDisjointSiblingTriangleIndices(o,c){const d=3*o+c,_=this.disjointConnections.get(d);return _?_.map(v=>~~(v/3)):[]}getDisjointSiblingEdgeIndices(o,c){const d=3*o+c,_=this.disjointConnections.get(d);return _?_.map(v=>v%3):[]}isFullyConnected(){return this.unmatchedEdges===0}updateFrom(o){const{useAllAttributes:c,useDrawRange:d,matchDisjointEdges:_,degenerateEpsilon:v}=this,b=c?function(wt){let Pt="";for(let Rt=0,kt=nt.length;Rt<kt;Rt++){const Gt=it[nt[Rt]];let Dt;switch(Gt.itemSize){case 1:Dt=hashNumber(Gt.getX(wt));break;case 2:Dt=hashVertex2(_vec2.fromBufferAttribute(Gt,wt));break;case 3:Dt=hashVertex3(HalfEdgeMap_vec3.fromBufferAttribute(Gt,wt));break;case 4:Dt=hashVertex4(_vec4.fromBufferAttribute(Gt,wt))}Pt!==""&&(Pt+="|"),Pt+=Dt}return Pt}:function(wt){return HalfEdgeMap_vec3.fromBufferAttribute(ut,wt),hashVertex3(HalfEdgeMap_vec3)},tt=new Map,{attributes:it}=o,nt=c?Object.keys(it):null,lt=o.index,ut=it.position;let ht=getTriCount(o);const _t=ht;let ft=0;d&&(ft=o.drawRange.start,o.drawRange.count!==1/0&&(ht=~~(o.drawRange.count/3)));let bt=this.data;(!bt||bt.length<3*_t)&&(bt=new Int32Array(3*_t)),bt.fill(-1);let xt=0,St=new Set;for(let wt=ft,Pt=3*ht+ft;wt<Pt;wt+=3){const Rt=wt;for(let kt=0;kt<3;kt++){let Gt=Rt+kt;lt&&(Gt=lt.getX(Gt)),_hashes[kt]=b(Gt)}for(let kt=0;kt<3;kt++){const Gt=(kt+1)%3,Dt=_hashes[kt],It=_hashes[Gt],Nt=`${It}_${Dt}`;if(tt.has(Nt)){const Vt=Rt+kt,Kt=tt.get(Nt);bt[Vt]=Kt,bt[Kt]=Vt,tt.delete(Nt),xt+=2,St.delete(Kt)}else{const Vt=`${Dt}_${It}`,Kt=Rt+kt;tt.set(Vt,Kt),St.add(Kt)}}}if(_){const{fragmentMap:wt,disjointConnectivityMap:Pt}=computeDisjointEdges(o,St,v);St.clear(),wt.forEach(({forward:Rt,reverse:kt})=>{Rt.forEach(({index:Gt})=>St.add(Gt)),kt.forEach(({index:Gt})=>St.add(Gt))}),this.unmatchedDisjointEdges=wt,this.disjointConnections=Pt,xt=3*ht-St.size}this.matchedEdges=xt,this.unmatchedEdges=St.size,this.data=bt}}class Brush extends three_module.eaF{constructor(...o){super(...o),this.isBrush=!0,this._previousMatrix=new three_module.kn4,this._previousMatrix.elements.fill(0)}markUpdated(){this._previousMatrix.copy(this.matrix)}isDirty(){const{matrix:o,_previousMatrix:c}=this,d=o.elements,_=c.elements;for(let v=0;v<16;v++)if(d[v]!==_[v])return!0;return!1}prepareGeometry(){const o=this.geometry,c=o.attributes,d=areSharedArrayBuffersSupported();if(d)for(const _ in c){const v=c[_];if(v.isInterleavedBufferAttribute)throw new Error("Brush: InterleavedBufferAttributes are not supported.");v.array=convertToSharedArrayBuffer(v.array)}if(o.boundsTree||(ensureIndex(o,{useSharedArrayBuffer:d}),o.boundsTree=new MeshBVH(o,{maxLeafTris:3,indirect:!0,useSharedArrayBuffer:d})),o.halfEdges||(o.halfEdges=new HalfEdgeMap(o)),!o.groupIndices){const _=getTriCount(o),v=new Uint16Array(_),b=o.groups;for(let tt=0,it=b.length;tt<it;tt++){const{start:nt,count:lt}=b[tt];for(let ut=nt/3,ht=(nt+lt)/3;ut<ht;ut++)v[ut]=tt}o.groupIndices=v}}disposeCacheData(){const{geometry:o}=this;o.halfEdges=null,o.boundsTree=null,o.groupIndices=null}}function joinGroups(h){for(let o=0;o<h.length-1;o++){const c=h[o],d=h[o+1];if(c.materialIndex===d.materialIndex){const _=c.start,v=d.start+d.count;d.start=_,d.count=v-_,h.splice(o,1),o--}}}function prepareAttributesData(h,o,c,d){c.clear();const _=h.attributes;for(let v=0,b=d.length;v<b;v++){const tt=d[v],it=_[tt];c.initializeArray(tt,it.array.constructor,it.itemSize,it.normalized)}for(const v in c.attributes)d.includes(v)||c.delete(v);for(const v in o.attributes)d.includes(v)||(o.deleteAttribute(v),o.dispose())}function assignBufferData(h,o,c){let d=!1,_=-1;const v=h.attributes,b=o.groupAttributes[0];for(const it in b){const nt=o.getTotalLength(it),lt=o.getType(it),ut=o.getItemSize(it),ht=o.getNormalized(it);let _t=v[it];(!_t||_t.array.length<nt)&&(_t=new three_module.THS(new lt(nt),ut,ht),h.setAttribute(it,_t),d=!0);let ft=0;for(let bt=0,xt=Math.min(c.length,o.groupCount);bt<xt;bt++){const St=c[bt].index,{array:wt,type:Pt,length:Rt}=o.groupAttributes[St][it],kt=new Pt(wt.buffer,0,Rt);_t.array.set(kt,ft),ft+=kt.length}_t.needsUpdate=!0,_=nt/_t.itemSize}if(h.index){const it=h.index.array;if(it.length<_)h.index=null,d=!0;else for(let nt=0,lt=it.length;nt<lt;nt++)it[nt]=nt}let tt=0;h.clearGroups();for(let it=0,nt=Math.min(c.length,o.groupCount);it<nt;it++){const{index:lt,materialIndex:ut}=c[it],ht=o.getCount(lt);ht!==0&&(h.addGroup(tt,ht,ut),tt+=ht)}h.setDrawRange(0,_),h.boundsTree=null,d&&h.dispose()}function getMaterialList(h,o){let c=o;return Array.isArray(o)||(c=[],h.forEach(d=>{c[d.materialIndex]=o})),c}class Evaluator{constructor(){this.triangleSplitter=new TriangleSplitter,this.attributeData=[],this.attributes=["position","uv","normal"],this.useGroups=!0,this.consolidateGroups=!0,this.debug=new OperationDebugData}getGroupRanges(o){return this.useGroups&&o.groups.length!==0?o.groups.map(c=>({...c})):[{start:0,count:1/0,materialIndex:0}]}evaluate(o,c,d,_=new Brush){let v=!0;if(Array.isArray(d)||(d=[d]),Array.isArray(_)||(_=[_],v=!1),_.length!==d.length)throw new Error("Evaluator: operations and target array passed as different sizes.");o.prepareGeometry(),c.prepareGeometry();const{triangleSplitter:b,attributeData:tt,attributes:it,useGroups:nt,consolidateGroups:lt,debug:ut}=this;for(;tt.length<_.length;)tt.push(new TypedAttributeData);_.forEach((St,wt)=>{prepareAttributesData(o.geometry,St.geometry,tt[wt],it)}),ut.init(),performOperation(o,c,d,b,tt,{useGroups:nt}),ut.complete();const ht=this.getGroupRanges(o.geometry),_t=getMaterialList(ht,o.material),ft=this.getGroupRanges(c.geometry),bt=getMaterialList(ft,c.material);ft.forEach(St=>St.materialIndex+=_t.length);let xt=[...ht,...ft].map((St,wt)=>({...St,index:wt}));if(nt){const St=[..._t,...bt];lt&&(xt=xt.map(Pt=>{const Rt=St[Pt.materialIndex];return Pt.materialIndex=St.indexOf(Rt),Pt}).sort((Pt,Rt)=>Pt.materialIndex-Rt.materialIndex));const wt=[];for(let Pt=0,Rt=St.length;Pt<Rt;Pt++){let kt=!1;for(let Gt=0,Dt=xt.length;Gt<Dt;Gt++){const It=xt[Gt];It.materialIndex===Pt&&(kt=!0,It.materialIndex=wt.length)}kt&&wt.push(St[Pt])}_.forEach(Pt=>{Pt.material=wt})}else xt=[{start:0,count:1/0,index:0,materialIndex:0}],_.forEach(St=>{St.material=_t[0]});return _.forEach((St,wt)=>{const Pt=St.geometry;assignBufferData(Pt,tt[wt],xt),lt&&joinGroups(Pt.groups)}),v?_:_[0]}evaluateHierarchy(o,c=new Brush){o.updateMatrixWorld(!0);const d=(v,b)=>{const tt=v.children;for(let it=0,nt=tt.length;it<nt;it++){const lt=tt[it];lt.isOperationGroup?d(lt,b):b(lt)}},_=v=>{const b=v.children;let tt=!1;for(let nt=0,lt=b.length;nt<lt;nt++){const ut=b[nt];tt=_(ut)||tt}const it=v.isDirty();if(it&&v.markUpdated(),tt&&!v.isOperationGroup){let nt;return d(v,lt=>{nt=nt?this.evaluate(nt,lt,lt.operation):this.evaluate(v,lt,lt.operation)}),v._cachedGeometry=nt.geometry,v._cachedMaterials=nt.material,!0}return tt||it};return _(o),c.geometry=o._cachedGeometry,c.material=o._cachedMaterials,c}reset(){this.triangleSplitter.reset()}}var CSGPluginBVH_decorate=function(h,o,c,d){var _,v=arguments.length,b=v<3?o:d===null?d=Object.getOwnPropertyDescriptor(o,c):d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(h,o,c,d);else for(var tt=h.length-1;tt>=0;tt--)(_=h[tt])&&(b=(v<3?_(b):v>3?_(o,c,b):_(o,c))||b);return v>3&&b&&Object.defineProperty(o,c,b),b};const operations={union:ADDITION,subtract:SUBTRACTION,intersect:INTERSECTION,difference:DIFFERENCE};function buildCSGMeshBVH(h,o){const c=new Evaluator;c.useGroups=!0,c.attributes=["position","normal","uv"],h.forEach(v=>{for(const b of[...c.attributes])v[0].geometry.getAttribute(b)||c.attributes.splice(c.attributes.indexOf(b),1)});let d=new Brush(new three_module.bdM(.01,.01,2,2));h.forEach(([v,b])=>{if(!Object.keys(operations).includes(b))return void console.error(`Unknown operation ${b}`);v.updateMatrix(),v.updateMatrixWorld();const tt=new Brush;tt.geometry=v.geometry,tt.material=v.material,v.matrixWorld.decompose(tt.position,tt.quaternion,tt.scale),tt.updateMatrix(),tt.updateMatrixWorld(),d=c.evaluate(d,tt,operations[b])});const _=d;return _.userData._isCSGMesh=!0,_}let CSGPluginBVH=class extends CSGPluginBase{_buildCSGMesh(h){return buildCSGMeshBVH(h)}};CSGPluginBVH.PluginType="CSGPluginBVH",CSGPluginBVH=CSGPluginBVH_decorate([uiFolder("CSG Plugin (BVH)")],CSGPluginBVH);class ACameraControlsPlugin extends AViewerPlugin{constructor(){super(...arguments),this.enabled=!0,this.toJSON=void 0,this._cameraChanged=o=>{var c,d,_,v;(d=(c=o.lastCamera)===null||c===void 0?void 0:c.removeControlsCtor)===null||d===void 0||d.call(c,this.controlsKey),(v=(_=o.camera)===null||_===void 0?void 0:_.setControlsCtor)===null||v===void 0||v.call(_,this.controlsKey,this._controlsCtor)}}async onAdded(o){await super.onAdded(o),this._cameraChanged({camera:o.scene.activeCamera}),o.scene.addEventListener("activeCameraChange",this._cameraChanged)}async onRemove(o){return this._cameraChanged({lastCamera:o.scene.activeCamera}),o.scene.removeEventListener("activeCameraChange",this._cameraChanged),super.onRemove(o)}}var DeviceOrientationControl_decorate=function(h,o,c,d){var _,v=arguments.length,b=v<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(h,o,c,d);else for(var tt=h.length-1;tt>=0;tt--)(_=h[tt])&&(b=(v<3?_(b):v>3?_(o,c,b):_(o,c))||b);return v>3&&b&&Object.defineProperty(o,c,b),b};const _zee=new three_module.Pq0(0,0,1),_euler=new three_module.O9p,_q0=new three_module.PTz,_q1=new three_module.PTz(-Math.sqrt(.5),0,0,Math.sqrt(.5)),_q2=new three_module.PTz,DeviceOrientationControl_changeEvent={type:"change"},EPS=1e-6;let DeviceOrientationControls2=class extends three_module.Qev{constructor(h){super(),this.enabled=!1,this.lastOrder="XYZ",this.dampingFactor=.05,this.lastQuaternion=new three_module.PTz,this.onDeviceOrientationChangeEvent=o=>{this.deviceOrientation=o},this.onScreenOrientationChangeEvent=()=>{this.screenOrientation=screen.orientation},this._initQuaternion=new three_module.PTz,this._initQuaternionInvert=new three_module.PTz,this._initQuaternionDest=new three_module.PTz,this._lastTime=-1,window.isSecureContext===!1&&console.error("DeviceOrientationControls2: DeviceOrientationEvent is only available in secure contexts (https)"),this.object=h,this.lastOrder=this.object.rotation.order,this.object.rotation.reorder("YXZ"),this.connect()}connect(){this.onScreenOrientationChangeEvent(),window.DeviceOrientationEvent!==void 0&&typeof window.DeviceOrientationEvent.requestPermission=="function"?window.DeviceOrientationEvent.requestPermission().then(h=>{h=="granted"&&(window.addEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.addEventListener("deviceorientation",this.onDeviceOrientationChangeEvent))}).catch(h=>{console.error("DeviceOrientationControls2: Unable to use DeviceOrientation API:",h)}):(window.addEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.addEventListener("deviceorientation",this.onDeviceOrientationChangeEvent)),this.enabled=!0,this._initQuaternion.copy(this.object.quaternion),this._initQuaternionInvert.copy(this.object.quaternion).invert()}disconnect(){window.removeEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.removeEventListener("deviceorientation",this.onDeviceOrientationChangeEvent),this._initQuaternion.identity(),this._initQuaternionInvert.identity(),this._initQuaternionDest=new three_module.PTz,this.object.rotation.reorder(this.lastOrder),this.lastOrder="XYZ",this.enabled=!1}update(){if(!this.enabled)return;const h=this.deviceOrientation;if(h){const o=h.alpha!==null?three_module.cj9.degToRad(h.alpha):0,c=h.beta!==null?three_module.cj9.degToRad(h.beta):0,d=h.gamma!==null?three_module.cj9.degToRad(h.gamma):0,_=this.screenOrientation?three_module.cj9.degToRad(this.screenOrientation.angle):0;this.setObjectQuaternion(o,c,d,_),8*(1-this.lastQuaternion.dot(this.object.quaternion))>EPS&&(this.lastQuaternion.copy(this.object.quaternion),this.dispatchEvent(DeviceOrientationControl_changeEvent))}}dispose(){this.disconnect()}setObjectQuaternion(h,o,c,d){const _=g()/1e3;_euler.set(o,h,-c,"YXZ"),_q2.setFromEuler(_euler),_q2.multiply(_q1),_q2.multiply(_q0.setFromAxisAngle(_zee,-d)),this._initQuaternionDest.__init||(this._initQuaternionDest.copy(_q2).invert(),this._initQuaternionDest.__init=!0),_q2.premultiply(this._initQuaternionDest),this.object.quaternion.slerp(_q2,this.dampingFactor/(Math.min(1,_-this._lastTime)/(1/60))),this._lastTime=_}};DeviceOrientationControl_decorate([serialize(),uiSlider("Damping",[0,1],.01)],DeviceOrientationControls2.prototype,"dampingFactor",void 0),DeviceOrientationControls2=DeviceOrientationControl_decorate([uiPanel("Device Orientation Controls")],DeviceOrientationControls2);class DeviceOrientationControlsPlugin extends ACameraControlsPlugin{constructor(){super(...arguments),this.controlsKey="deviceOrientation",this._controlsCtor=(o,c)=>new DeviceOrientationControls2(o)}}DeviceOrientationControlsPlugin.PluginType="DeviceOrientationControlsPlugin";var FirstPersonControls2_decorate=function(h,o,c,d){var _,v=arguments.length,b=v<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(h,o,c,d);else for(var tt=h.length-1;tt>=0;tt--)(_=h[tt])&&(b=(v<3?_(b):v>3?_(o,c,b):_(o,c))||b);return v>3&&b&&Object.defineProperty(o,c,b),b};const _lookDirection=new three_module.Pq0,_spherical=new three_module.YHV,_target=new three_module.Pq0,FirstPersonControls2_changeEvent={type:"change"};let FirstPersonControls2=class extends three_module.Qev{constructor(h,o){super(),this.enabled=!0,this.enableKeys=!0,this.movementSpeed=1,this.lookSpeed=.005,this.lookVertical=!0,this.autoForward=!1,this.activeLook=!0,this.heightSpeed=!1,this.heightCoef=1,this.heightMin=0,this.heightMax=1,this.constrainVertical=!1,this.verticalMin=0,this.verticalMax=Math.PI,this.mouseDragOn=!1,this.autoSpeedFactor=0,this.pointerX=0,this.pointerY=0,this.moveForward=!1,this.moveBackward=!1,this.moveLeft=!1,this.moveRight=!1,this.moveUp=!1,this.moveDown=!1,this.viewHalfX=0,this.viewHalfY=0,this.lat=0,this.lon=0,this.targetPosition=new three_module.Pq0,this._lastTime=-1,this.object=h,this.domElement=o,this.onPointerMove=this.onPointerMove.bind(this),this.onPointerDown=this.onPointerDown.bind(this),this.onPointerUp=this.onPointerUp.bind(this),this.onKeyDown=this.onKeyDown.bind(this),this.onKeyUp=this.onKeyUp.bind(this),this.onContextMenu=this.onContextMenu.bind(this),this.domElement.addEventListener("contextmenu",this.onContextMenu),this.domElement.addEventListener("pointermove",this.onPointerMove),this.domElement.addEventListener("pointerdown",this.onPointerDown),this.domElement.addEventListener("pointerup",this.onPointerUp),window.addEventListener("keydown",this.onKeyDown),window.addEventListener("keyup",this.onKeyUp),this.handleResize(),this.setOrientation()}setOrientation(){const h=this.object.quaternion;_lookDirection.set(0,0,-1).applyQuaternion(h),_spherical.setFromVector3(_lookDirection),this.lat=90-three_module.cj9.radToDeg(_spherical.phi),this.lon=three_module.cj9.radToDeg(_spherical.theta)}handleResize(){this.domElement===document?(this.viewHalfX=window.innerWidth/2,this.viewHalfY=window.innerHeight/2):(this.viewHalfX=this.domElement.offsetWidth/2,this.viewHalfY=this.domElement.offsetHeight/2)}onPointerDown(h){if(this.domElement!==document&&this.domElement.focus(),this.activeLook)switch(h.button){case 0:this.moveForward=!0;break;case 2:this.moveBackward=!0}this.mouseDragOn=!0}onPointerUp(h){if(this.activeLook)switch(h.button){case 0:this.moveForward=!1;break;case 2:this.moveBackward=!1}this.mouseDragOn=!1}onPointerMove(h){this.domElement===document?(this.pointerX=h.pageX-this.viewHalfX,this.pointerY=h.pageY-this.viewHalfY):(this.pointerX=h.pageX-this.domElement.offsetLeft-this.viewHalfX,this.pointerY=h.pageY-this.domElement.offsetTop-this.viewHalfY)}onKeyDown(h){if(this.enableKeys)switch(h.code){case"ArrowUp":case"KeyW":this.moveForward=!0;break;case"ArrowLeft":case"KeyA":this.moveLeft=!0;break;case"ArrowDown":case"KeyS":this.moveBackward=!0;break;case"ArrowRight":case"KeyD":this.moveRight=!0;break;case"KeyR":this.moveUp=!0;break;case"KeyF":this.moveDown=!0}}onKeyUp(h){if(this.enableKeys)switch(h.code){case"ArrowUp":case"KeyW":this.moveForward=!1;break;case"ArrowLeft":case"KeyA":this.moveLeft=!1;break;case"ArrowDown":case"KeyS":this.moveBackward=!1;break;case"ArrowRight":case"KeyD":this.moveRight=!1;break;case"KeyR":this.moveUp=!1;break;case"KeyF":this.moveDown=!1}}lookAt(h,o,c){return h.isVector3?_target.copy(h):o===void 0||c===void 0?console.error("FirstPersonControls2.lookAt: y and z parameters are required"):_target.set(h,o,c),this.object.lookAt(_target),this.setOrientation(),this}update(){const h=g(),o=(this._lastTime<0?16:Math.min(h-this._lastTime,1e3))/1e3;if(this._lastTime=h,!this.enabled)return;if(this.heightSpeed){const it=three_module.cj9.clamp(this.object.position.y,this.heightMin,this.heightMax)-this.heightMin;this.autoSpeedFactor=o*(it*this.heightCoef)}else this.autoSpeedFactor=0;const c=o*this.movementSpeed;(this.moveForward||this.autoForward&&!this.moveBackward)&&this.object.translateZ(-(c+this.autoSpeedFactor)),this.moveBackward&&this.object.translateZ(c),this.moveLeft&&this.object.translateX(-c),this.moveRight&&this.object.translateX(c),this.moveUp&&this.object.translateY(c),this.moveDown&&this.object.translateY(-c);let d=o*this.lookSpeed;this.activeLook||(d=0);let _=1;this.constrainVertical&&(_=Math.PI/(this.verticalMax-this.verticalMin)),this.lon-=this.pointerX*d,this.lookVertical&&(this.lat-=this.pointerY*d*_),this.lat=Math.max(-85,Math.min(85,this.lat));let v=three_module.cj9.degToRad(90-this.lat);const b=three_module.cj9.degToRad(this.lon);this.constrainVertical&&(v=three_module.cj9.mapLinear(v,0,Math.PI,this.verticalMin,this.verticalMax));const tt=this.object.position;this.targetPosition.setFromSphericalCoords(1,v,b).add(tt),this.object.lookAt(this.targetPosition),this.dispatchEvent(FirstPersonControls2_changeEvent)}dispose(){this.domElement.removeEventListener("contextmenu",this.onContextMenu),this.domElement.removeEventListener("pointerdown",this.onPointerDown),this.domElement.removeEventListener("pointermove",this.onPointerMove),this.domElement.removeEventListener("pointerup",this.onPointerUp),window.removeEventListener("keydown",this.onKeyDown),window.removeEventListener("keyup",this.onKeyUp)}onContextMenu(h){this.enableKeys&&h.preventDefault()}};FirstPersonControls2_decorate([serialize(),uiToggle()],FirstPersonControls2.prototype,"enabled",void 0),FirstPersonControls2_decorate([serialize(),uiToggle()],FirstPersonControls2.prototype,"enableKeys",void 0),FirstPersonControls2_decorate([serialize(),uiInput()],FirstPersonControls2.prototype,"movementSpeed",void 0),FirstPersonControls2_decorate([serialize(),uiInput()],FirstPersonControls2.prototype,"lookSpeed",void 0),FirstPersonControls2_decorate([serialize(),uiToggle()],FirstPersonControls2.prototype,"lookVertical",void 0),FirstPersonControls2_decorate([serialize(),uiToggle()],FirstPersonControls2.prototype,"autoForward",void 0),FirstPersonControls2_decorate([serialize(),uiToggle()],FirstPersonControls2.prototype,"activeLook",void 0),FirstPersonControls2_decorate([serialize(),uiToggle()],FirstPersonControls2.prototype,"heightSpeed",void 0),FirstPersonControls2_decorate([serialize(),uiInput()],FirstPersonControls2.prototype,"heightCoef",void 0),FirstPersonControls2_decorate([serialize(),uiInput()],FirstPersonControls2.prototype,"heightMin",void 0),FirstPersonControls2_decorate([serialize(),uiInput()],FirstPersonControls2.prototype,"heightMax",void 0),FirstPersonControls2_decorate([serialize(),uiToggle()],FirstPersonControls2.prototype,"constrainVertical",void 0),FirstPersonControls2_decorate([serialize(),uiInput()],FirstPersonControls2.prototype,"verticalMin",void 0),FirstPersonControls2_decorate([serialize(),uiInput()],FirstPersonControls2.prototype,"verticalMax",void 0),FirstPersonControls2_decorate([serialize(),uiToggle()],FirstPersonControls2.prototype,"mouseDragOn",void 0),FirstPersonControls2=FirstPersonControls2_decorate([uiFolder("First Person Controls")],FirstPersonControls2);class FirstPersonControlsPlugin extends ACameraControlsPlugin{constructor(){super(...arguments),this.controlsKey="firstPerson",this._controlsCtor=(o,c)=>new FirstPersonControls2(o,c)}}FirstPersonControlsPlugin.PluginType="FirstPersonControlsPlugin";var PointerLockControls2_decorate=function(h,o,c,d){var _,v=arguments.length,b=v<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(h,o,c,d);else for(var tt=h.length-1;tt>=0;tt--)(_=h[tt])&&(b=(v<3?_(b):v>3?_(o,c,b):_(o,c))||b);return v>3&&b&&Object.defineProperty(o,c,b),b};const PointerLockControls2_euler=new three_module.O9p(0,0,0,"YXZ"),PointerLockControls2_vector=new three_module.Pq0,PointerLockControls2_changeEvent={type:"change"},_lockEvent={type:"lock"},_unlockEvent={type:"unlock"},_PI_2=Math.PI/2;let PointerLockControls2=class extends three_module.Qev{constructor(h,o){super(),this.isLocked=!1,this.enabled=!0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.pointerSpeed=1,this.autoLockOnClick=!0,this._movementX=0,this._movementY=0,this._forwardDirection=new three_module.Pq0(0,0,-1),this.domElement=o,this.object=h,this.onElementClick=this.onElementClick.bind(this),this.onMouseMove=this.onMouseMove.bind(this),this.onPointerlockChange=this.onPointerlockChange.bind(this),this.onPointerlockError=this.onPointerlockError.bind(this),this.connect()}onElementClick(h){this.isLocked||this.autoLockOnClick&&(h.preventDefault(),this.lock())}onMouseMove(h){this.isLocked&&(this._movementX+=h.movementX||h.mozMovementX||h.webkitMovementX||0,this._movementY+=h.movementY||h.mozMovementY||h.webkitMovementY||0)}onPointerlockChange(){this.domElement.ownerDocument.pointerLockElement===this.domElement?(this.dispatchEvent(_lockEvent),this.isLocked=!0):(this.dispatchEvent(_unlockEvent),this.isLocked=!1)}onPointerlockError(){console.error("THREE.PointerLockControls: Unable to use Pointer Lock API")}connect(){this.domElement.ownerDocument.addEventListener("mousemove",this.onMouseMove),this.domElement.ownerDocument.addEventListener("pointerlockchange",this.onPointerlockChange),this.domElement.ownerDocument.addEventListener("pointerlockerror",this.onPointerlockError),this.domElement.addEventListener("click",this.onElementClick)}disconnect(){this.domElement.ownerDocument.removeEventListener("mousemove",this.onMouseMove),this.domElement.ownerDocument.removeEventListener("pointerlockchange",this.onPointerlockChange),this.domElement.ownerDocument.removeEventListener("pointerlockerror",this.onPointerlockError),this.domElement.removeEventListener("click",this.onElementClick)}dispose(){this.disconnect()}getDirection(h){return h.copy(this._forwardDirection).applyQuaternion(this.object.quaternion)}moveForward(h){PointerLockControls2_vector.setFromMatrixColumn(this.object.matrix,0),PointerLockControls2_vector.crossVectors(this.object.up,PointerLockControls2_vector),this.object.position.addScaledVector(PointerLockControls2_vector,h)}moveRight(h){PointerLockControls2_vector.setFromMatrixColumn(this.object.matrix,0),this.object.position.addScaledVector(PointerLockControls2_vector,h)}lock(){this.domElement.requestPointerLock()}unlock(){this.domElement.ownerDocument.exitPointerLock()}update(){Math.abs(this._movementX)<1e-4&&Math.abs(this._movementY)<1e-4||(PointerLockControls2_euler.setFromQuaternion(this.object.quaternion),PointerLockControls2_euler.y-=.002*this._movementX*this.pointerSpeed,PointerLockControls2_euler.x-=.002*this._movementY*this.pointerSpeed,this._movementX=0,this._movementY=0,PointerLockControls2_euler.x=Math.max(_PI_2-this.maxPolarAngle,Math.min(_PI_2-this.minPolarAngle,PointerLockControls2_euler.x)),this.object.quaternion.setFromEuler(PointerLockControls2_euler),this.dispatchEvent(PointerLockControls2_changeEvent))}};PointerLockControls2_decorate([uiToggle(),serialize()],PointerLockControls2.prototype,"enabled",void 0),PointerLockControls2_decorate([uiInput(),serialize()],PointerLockControls2.prototype,"minPolarAngle",void 0),PointerLockControls2_decorate([uiInput(),serialize()],PointerLockControls2.prototype,"maxPolarAngle",void 0),PointerLockControls2_decorate([uiInput(),serialize()],PointerLockControls2.prototype,"pointerSpeed",void 0),PointerLockControls2_decorate([uiToggle(),serialize()],PointerLockControls2.prototype,"autoLockOnClick",void 0),PointerLockControls2=PointerLockControls2_decorate([uiPanel("Pointer Lock Controls")],PointerLockControls2);class PointerLockControlsPlugin extends ACameraControlsPlugin{constructor(){super(...arguments),this.controlsKey="pointerLock",this._controlsCtor=(o,c)=>new PointerLockControls2(o,c.ownerDocument?c:c.documentElement)}}PointerLockControlsPlugin.PluginType="PointerLockControlsPlugin";const TrackballControls_changeEvent={type:"change"},TrackballControls_startEvent={type:"start"},TrackballControls_endEvent={type:"end"};class TrackballControls extends three_module.Qev{constructor(o,c){super();const d=this,_=-1;this.object=o,this.domElement=c,this.domElement.style.touchAction="none",this.enabled=!0,this.screen={left:0,top:0,width:0,height:0},this.rotateSpeed=1,this.zoomSpeed=1.2,this.panSpeed=.3,this.noRotate=!1,this.noZoom=!1,this.noPan=!1,this.staticMoving=!1,this.dynamicDampingFactor=.2,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.keys=["KeyA","KeyS","KeyD"],this.mouseButtons={LEFT:three_module.kBv.ROTATE,MIDDLE:three_module.kBv.DOLLY,RIGHT:three_module.kBv.PAN},this.target=new three_module.Pq0;const v=1e-6,b=new three_module.Pq0;let tt=1,it=_,nt=_,lt=0,ut=0,ht=0;const _t=new three_module.Pq0,ft=new three_module.I9Y,bt=new three_module.I9Y,xt=new three_module.Pq0,St=new three_module.I9Y,wt=new three_module.I9Y,Pt=new three_module.I9Y,Rt=new three_module.I9Y,kt=[],Gt={};this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.up0=this.object.up.clone(),this.zoom0=this.object.zoom,this.handleResize=function(){const ur=d.domElement.getBoundingClientRect(),cr=d.domElement.ownerDocument.documentElement;d.screen.left=ur.left+window.pageXOffset-cr.clientLeft,d.screen.top=ur.top+window.pageYOffset-cr.clientTop,d.screen.width=ur.width,d.screen.height=ur.height};const Dt=function(){const ur=new three_module.I9Y;return function(cr,br){return ur.set((cr-d.screen.left)/d.screen.width,(br-d.screen.top)/d.screen.height),ur}}(),It=function(){const ur=new three_module.I9Y;return function(cr,br){return ur.set((cr-.5*d.screen.width-d.screen.left)/(.5*d.screen.width),(d.screen.height+2*(d.screen.top-br))/d.screen.width),ur}}();function Nt(ur){d.enabled!==!1&&(kt.length===0&&(d.domElement.setPointerCapture(ur.pointerId),d.domElement.addEventListener("pointermove",Vt),d.domElement.addEventListener("pointerup",Kt)),function(cr){kt.push(cr)}(ur),ur.pointerType==="touch"?function(cr){if(hr(cr),kt.length===1)it=3,bt.copy(It(kt[0].pageX,kt[0].pageY)),ft.copy(bt);else{it=4;const br=kt[0].pageX-kt[1].pageX,fr=kt[0].pageY-kt[1].pageY;ut=lt=Math.sqrt(br*br+fr*fr);const kr=(kt[0].pageX+kt[1].pageX)/2,gr=(kt[0].pageY+kt[1].pageY)/2;Pt.copy(Dt(kr,gr)),Rt.copy(Pt)}d.dispatchEvent(TrackballControls_startEvent)}(ur):function(cr){if(it===_)switch(cr.button){case d.mouseButtons.LEFT:it=0;break;case d.mouseButtons.MIDDLE:it=1;break;case d.mouseButtons.RIGHT:it=2}const br=nt!==_?nt:it;br!==0||d.noRotate?br!==1||d.noZoom?br!==2||d.noPan||(Pt.copy(Dt(cr.pageX,cr.pageY)),Rt.copy(Pt)):(St.copy(Dt(cr.pageX,cr.pageY)),wt.copy(St)):(bt.copy(It(cr.pageX,cr.pageY)),ft.copy(bt)),d.dispatchEvent(TrackballControls_startEvent)}(ur))}function Vt(ur){d.enabled!==!1&&(ur.pointerType==="touch"?function(cr){if(hr(cr),kt.length===1)ft.copy(bt),bt.copy(It(cr.pageX,cr.pageY));else{const br=function(dr){const Ir=dr.pointerId===kt[0].pointerId?kt[1]:kt[0];return Gt[Ir.pointerId]}(cr),fr=cr.pageX-br.x,kr=cr.pageY-br.y;ut=Math.sqrt(fr*fr+kr*kr);const gr=(cr.pageX+br.x)/2,tr=(cr.pageY+br.y)/2;Rt.copy(Dt(gr,tr))}}(ur):function(cr){const br=nt!==_?nt:it;br!==0||d.noRotate?br!==1||d.noZoom?br!==2||d.noPan||Rt.copy(Dt(cr.pageX,cr.pageY)):wt.copy(Dt(cr.pageX,cr.pageY)):(ft.copy(bt),bt.copy(It(cr.pageX,cr.pageY)))}(ur))}function Kt(ur){d.enabled!==!1&&(ur.pointerType==="touch"?function(cr){switch(kt.length){case 0:it=_;break;case 1:it=3,bt.copy(It(cr.pageX,cr.pageY)),ft.copy(bt);break;case 2:it=4;for(let br=0;br<kt.length;br++)if(kt[br].pointerId!==cr.pointerId){const fr=Gt[kt[br].pointerId];bt.copy(It(fr.x,fr.y)),ft.copy(bt);break}}d.dispatchEvent(TrackballControls_endEvent)}(ur):(it=_,d.dispatchEvent(TrackballControls_endEvent)),pr(ur),kt.length===0&&(d.domElement.releasePointerCapture(ur.pointerId),d.domElement.removeEventListener("pointermove",Vt),d.domElement.removeEventListener("pointerup",Kt)))}function Yt(ur){pr(ur)}function nr(ur){d.enabled!==!1&&(window.removeEventListener("keydown",nr),nt===_&&(ur.code!==d.keys[0]||d.noRotate?ur.code!==d.keys[1]||d.noZoom?ur.code!==d.keys[2]||d.noPan||(nt=2):nt=1:nt=0))}function rr(){d.enabled!==!1&&(nt=_,window.addEventListener("keydown",nr))}function lr(ur){if(d.enabled!==!1&&d.noZoom!==!0){switch(ur.preventDefault(),ur.deltaMode){case 2:St.y-=.025*ur.deltaY;break;case 1:St.y-=.01*ur.deltaY;break;default:St.y-=25e-5*ur.deltaY}d.dispatchEvent(TrackballControls_startEvent),d.dispatchEvent(TrackballControls_endEvent)}}function or(ur){d.enabled!==!1&&ur.preventDefault()}function pr(ur){delete Gt[ur.pointerId];for(let cr=0;cr<kt.length;cr++)if(kt[cr].pointerId==ur.pointerId)return void kt.splice(cr,1)}function hr(ur){let cr=Gt[ur.pointerId];cr===void 0&&(cr=new three_module.I9Y,Gt[ur.pointerId]=cr),cr.set(ur.pageX,ur.pageY)}this.rotateCamera=function(){const ur=new three_module.Pq0,cr=new three_module.PTz,br=new three_module.Pq0,fr=new three_module.Pq0,kr=new three_module.Pq0,gr=new three_module.Pq0;return function(){gr.set(bt.x-ft.x,bt.y-ft.y,0);let tr=gr.length();tr?(_t.copy(d.object.position).sub(d.target),br.copy(_t).normalize(),fr.copy(d.object.up).normalize(),kr.crossVectors(fr,br).normalize(),fr.setLength(bt.y-ft.y),kr.setLength(bt.x-ft.x),gr.copy(fr.add(kr)),ur.crossVectors(gr,_t).normalize(),tr*=d.rotateSpeed,cr.setFromAxisAngle(ur,tr),_t.applyQuaternion(cr),d.object.up.applyQuaternion(cr),xt.copy(ur),ht=tr):!d.staticMoving&&ht&&(ht*=Math.sqrt(1-d.dynamicDampingFactor),_t.copy(d.object.position).sub(d.target),cr.setFromAxisAngle(xt,ht),_t.applyQuaternion(cr),d.object.up.applyQuaternion(cr)),ft.copy(bt)}}(),this.zoomCamera=function(){let ur;it===4?(ur=lt/ut,lt=ut,d.object.isPerspectiveCamera?_t.multiplyScalar(ur):d.object.isOrthographicCamera?(d.object.zoom=three_module.cj9.clamp(d.object.zoom/ur,d.minZoom,d.maxZoom),tt!==d.object.zoom&&d.object.updateProjectionMatrix()):console.warn("THREE.TrackballControls: Unsupported camera type")):(ur=1+(wt.y-St.y)*d.zoomSpeed,ur!==1&&ur>0&&(d.object.isPerspectiveCamera?_t.multiplyScalar(ur):d.object.isOrthographicCamera?(d.object.zoom=three_module.cj9.clamp(d.object.zoom/ur,d.minZoom,d.maxZoom),tt!==d.object.zoom&&d.object.updateProjectionMatrix()):console.warn("THREE.TrackballControls: Unsupported camera type")),d.staticMoving?St.copy(wt):St.y+=(wt.y-St.y)*this.dynamicDampingFactor)},this.panCamera=function(){const ur=new three_module.I9Y,cr=new three_module.Pq0,br=new three_module.Pq0;return function(){if(ur.copy(Rt).sub(Pt),ur.lengthSq()){if(d.object.isOrthographicCamera){const fr=(d.object.right-d.object.left)/d.object.zoom/d.domElement.clientWidth,kr=(d.object.top-d.object.bottom)/d.object.zoom/d.domElement.clientWidth;ur.x*=fr,ur.y*=kr}ur.multiplyScalar(_t.length()*d.panSpeed),br.copy(_t).cross(d.object.up).setLength(ur.x),br.add(cr.copy(d.object.up).setLength(ur.y)),d.object.position.add(br),d.target.add(br),d.staticMoving?Pt.copy(Rt):Pt.add(ur.subVectors(Rt,Pt).multiplyScalar(d.dynamicDampingFactor))}}}(),this.checkDistances=function(){d.noZoom&&d.noPan||(_t.lengthSq()>d.maxDistance*d.maxDistance&&(d.object.position.addVectors(d.target,_t.setLength(d.maxDistance)),St.copy(wt)),_t.lengthSq()<d.minDistance*d.minDistance&&(d.object.position.addVectors(d.target,_t.setLength(d.minDistance)),St.copy(wt)))},this.update=function(){_t.subVectors(d.object.position,d.target),d.noRotate||d.rotateCamera(),d.noZoom||d.zoomCamera(),d.noPan||d.panCamera(),d.object.position.addVectors(d.target,_t),d.object.isPerspectiveCamera?(d.checkDistances(),d.object.lookAt(d.target),b.distanceToSquared(d.object.position)>v&&(d.dispatchEvent(TrackballControls_changeEvent),b.copy(d.object.position))):d.object.isOrthographicCamera?(d.object.lookAt(d.target),(b.distanceToSquared(d.object.position)>v||tt!==d.object.zoom)&&(d.dispatchEvent(TrackballControls_changeEvent),b.copy(d.object.position),tt=d.object.zoom)):console.warn("THREE.TrackballControls: Unsupported camera type")},this.reset=function(){it=_,nt=_,d.target.copy(d.target0),d.object.position.copy(d.position0),d.object.up.copy(d.up0),d.object.zoom=d.zoom0,d.object.updateProjectionMatrix(),_t.subVectors(d.object.position,d.target),d.object.lookAt(d.target),d.dispatchEvent(TrackballControls_changeEvent),b.copy(d.object.position),tt=d.object.zoom},this.dispose=function(){d.domElement.removeEventListener("contextmenu",or),d.domElement.removeEventListener("pointerdown",Nt),d.domElement.removeEventListener("pointercancel",Yt),d.domElement.removeEventListener("wheel",lr),d.domElement.removeEventListener("pointermove",Vt),d.domElement.removeEventListener("pointerup",Kt),window.removeEventListener("keydown",nr),window.removeEventListener("keyup",rr)},this.domElement.addEventListener("contextmenu",or),this.domElement.addEventListener("pointerdown",Nt),this.domElement.addEventListener("pointercancel",Yt),this.domElement.addEventListener("wheel",lr,{passive:!1}),window.addEventListener("keydown",nr),window.addEventListener("keyup",rr),this.handleResize(),this.update()}}var TrackballControls2_decorate=function(h,o,c,d){var _,v=arguments.length,b=v<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(h,o,c,d);else for(var tt=h.length-1;tt>=0;tt--)(_=h[tt])&&(b=(v<3?_(b):v>3?_(o,c,b):_(o,c))||b);return v>3&&b&&Object.defineProperty(o,c,b),b};let TrackballControls2=class extends TrackballControls{constructor(h,o){super(h,o),this.type="TrackballControls",this.enabled=!0,this.rotateSpeed=1,this.zoomSpeed=1.2,this.panSpeed=.3,this.noRotate=!1,this.noZoom=!1,this.noPan=!1,this.noRoll=!1,this.staticMoving=!1,this.dynamicDampingFactor=.2,this.minDistance=0,this.maxDistance=999999,this.minZoom=0,this.maxZoom=999999,this.object=h}};TrackballControls2_decorate([serialize()],TrackballControls2.prototype,"type",void 0),TrackballControls2_decorate([uiToggle()],TrackballControls2.prototype,"enabled",void 0),TrackballControls2_decorate([uiInput(),serialize()],TrackballControls2.prototype,"rotateSpeed",void 0),TrackballControls2_decorate([uiInput(),serialize()],TrackballControls2.prototype,"zoomSpeed",void 0),TrackballControls2_decorate([uiInput(),serialize()],TrackballControls2.prototype,"panSpeed",void 0),TrackballControls2_decorate([uiToggle(),serialize()],TrackballControls2.prototype,"noRotate",void 0),TrackballControls2_decorate([uiToggle(),serialize()],TrackballControls2.prototype,"noZoom",void 0),TrackballControls2_decorate([uiToggle(),serialize()],TrackballControls2.prototype,"noPan",void 0),TrackballControls2_decorate([uiToggle(),serialize()],TrackballControls2.prototype,"noRoll",void 0),TrackballControls2_decorate([uiToggle(),serialize()],TrackballControls2.prototype,"staticMoving",void 0),TrackballControls2_decorate([uiInput(),serialize()],TrackballControls2.prototype,"dynamicDampingFactor",void 0),TrackballControls2_decorate([uiInput(),serialize()],TrackballControls2.prototype,"minDistance",void 0),TrackballControls2_decorate([uiInput(),serialize()],TrackballControls2.prototype,"maxDistance",void 0),TrackballControls2_decorate([uiInput(),serialize()],TrackballControls2.prototype,"minZoom",void 0),TrackballControls2_decorate([uiInput(),serialize()],TrackballControls2.prototype,"maxZoom",void 0),TrackballControls2=TrackballControls2_decorate([uiPanel("Track Ball")],TrackballControls2);class TrackballControlsPlugin extends ACameraControlsPlugin{constructor(){super(...arguments),this.controlsKey="trackball",this._controlsCtor=(o,c)=>new TrackballControls2(o,c.ownerDocument?c:c.documentElement)}}TrackballControlsPlugin.PluginType="TrackballControlsPlugin";var SimplifyModifierPlugin_decorate=function(h,o,c,d){var _,v=arguments.length,b=v<3?o:d===null?d=Object.getOwnPropertyDescriptor(o,c):d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(h,o,c,d);else for(var tt=h.length-1;tt>=0;tt--)(_=h[tt])&&(b=(v<3?_(b):v>3?_(o,c,b):_(o,c))||b);return v>3&&b&&Object.defineProperty(o,c,b),b};class SimplifyModifierPlugin extends AViewerPlugin{constructor(){super(),this.enabled=!0,this.toJSON=void 0,this.simplifyFactor=.5}get initialized(){return!0}async initialize(){}async onAdded(o){await super.onAdded(o),this._pickingPlugin=o.getPlugin(PickingPlugin)}simplifyGeometries(o,c){var d;if(!o){const v=(d=this._pickingPlugin)===null||d===void 0?void 0:d.getSelectedObject(),b=[];if(v==null||v.traverse(tt=>{tt.geometry&&!b.includes(tt.geometry)&&b.push(tt.geometry)}),!(o=b)||!o.length)return}Array.isArray(o)||(o=[o]);const _=[];for(const v of o)_.push(this.simplifyGeometry(v,c));return _}simplifyGeometry(o,{factor:c,count:d,replace:_=!0,disposeOnReplace:v=!1}={}){var b,tt,it;if(!o){const St=(b=this._pickingPlugin)===null||b===void 0?void 0:b.getSelectedObject();if(!(o=St==null?void 0:St.geometry))return}if(!o.attributes.position)return(tt=this._viewer)===null||tt===void 0||tt.console.error("SimplifyModifierPlugin: Geometry does not have position attribute",o),o;c=c||this.simplifyFactor,d=d||o.attributes.position.count*c,o.boundingBox||o.computeBoundingBox();const nt=this._simplify(o,d);nt.computeBoundingBox(),nt.computeBoundingSphere(),nt.computeVertexNormals();const lt=nt.boundingBox,ut=lt.getSize(new three_module.Pq0);if(!isFinite(ut.x)||!isFinite(ut.y)||!isFinite(ut.z))return(it=this._viewer)===null||it===void 0||it.console.error("SimplifyModifierPlugin: Unable to simplify",o,nt,ut),o;const ht=o.boundingBox,_t=ht.getSize(new three_module.Pq0),ft=ut.clone().sub(_t),bt=ft.clone().divide(_t);if(bt.lengthSq()>.001&&console.warn("Simplify",o,nt,lt,ht,ut,_t,ft,bt),!_)return nt;const xt=o.userData.__appliedMeshes;if(!xt)return console.error("No meshes found for geometry, cannot replace",o),nt;for(const St of xt)St.setGeometry?St.setGeometry(nt):St.geometry=nt;return v&&o.dispose(!0),nt}async simplifyAll(o,c){var d;if(!o&&this._viewer&&(o=this._viewer.scene.modelRoot),!o)return void console.error("SimplifyModifierPlugin: No root found");if(!this.initialized&&(await this.initialize(),!this.initialized))return void((d=this._viewer)===null||d===void 0||d.console.error("SimplifyModifierPlugin cannot be initialized"));const _=[];if(o.modelObject.traverse(v=>{v.geometry&&!_.includes(v.geometry)&&_.push(v.geometry)}),_.length)return this.simplifyGeometries(_,c);console.error("SimplifyModifierPlugin: No geometries found")}async simplifySelected(){var o;if(!this._viewer)return;if(!this.initialized&&(await this.initialize(),!this.initialized))return void await this._viewer.alert("Simplify: SimplifyModifierPlugin cannot be initialized");const c=(o=this._pickingPlugin)===null||o===void 0?void 0:o.getSelectedObject();if(!c)return void await this._viewer.alert("Simplify: Nothing Selected");let d=!1;c.geometry?c.children.length===0&&(d=!0):d=!0,d||await this._viewer.confirm("Simplify: Simplify all in hierarchy?")&&(d=!0),d?this.simplifyGeometries():this.simplifyGeometry(c.geometry)}}SimplifyModifierPlugin.PluginType="SimplifyModifierPlugin",SimplifyModifierPlugin_decorate([uiSlider("Simplify Factor",[0,1])],SimplifyModifierPlugin.prototype,"simplifyFactor",void 0),SimplifyModifierPlugin_decorate([uiButton("Simplify All",{sendArgs:!1})],SimplifyModifierPlugin.prototype,"simplifyAll",null),SimplifyModifierPlugin_decorate([uiButton("Simplify Selected")],SimplifyModifierPlugin.prototype,"simplifySelected",null);var MeshOptSimplifyModifierPlugin_decorate=function(h,o,c,d){var _,v=arguments.length,b=v<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(h,o,c,d);else for(var tt=h.length-1;tt>=0;tt--)(_=h[tt])&&(b=(v<3?_(b):v>3?_(o,c,b):_(o,c))||b);return v>3&&b&&Object.defineProperty(o,c,b),b},MeshOptSimplifyModifierPlugin_1;let MeshOptSimplifyModifierPlugin=MeshOptSimplifyModifierPlugin_1=class extends SimplifyModifierPlugin{constructor(h=!0,o=document.head){super(),this.rootNode=o,this._initializing=void 0,this.errorThreshold=.5,this.lockBorder=!1,h&&this.initialize()}get initialized(){return!!window.MeshoptSimplifier}async initialize(){if(this.initialized)return;if(this._initializing)return await this._initializing;const h=document.createElement("script");h.type="module";const o=Math.random().toString(36).substring(7);return h.innerHTML=`
import { MeshoptSimplifier } from '${MeshOptSimplifyModifierPlugin_1.SIMPLIFIER_URL}';
MeshoptSimplifier.ready.then(() => {
window.MeshoptSimplifier = MeshoptSimplifier;
window.dispatchEvent(new CustomEvent('${o}'))
});
`,this._initializing=new Promise(c=>{window.addEventListener(o,()=>c(),{once:!0}),this.rootNode.appendChild(h),this._script=h}),await this._initializing}dispose(){this._script&&(this._script.remove(),delete window.MeshoptSimplifier),this._script=void 0}_simplify(h,o){if(!this.initialized)throw new Error("MeshOptSimplifyModifierPlugin not initialized");const c=(h=h.index?h.clone():toIndexedGeometry(h)).index.array,d=h.attributes.position.array,_=o/h.attributes.position.count,v=3*Math.floor(_*c.length/3),[b,tt]=window.MeshoptSimplifier.simplify(c,d,3,v,this.errorThreshold,this.lockBorder?["LockBorder"]:[]);return console.log("srcCount",c.length/3,"destCount",b.length/3),tt&&console.log("Simplify error",tt),h.setIndex(new three_module.THS(new Uint32Array(b),1)),h}};MeshOptSimplifyModifierPlugin.PluginType="MeshOptSimplifyModifierPlugin",MeshOptSimplifyModifierPlugin.SIMPLIFIER_URL="https://unpkg.com/meshoptimizer@0.20.0/meshopt_simplifier.module.js",MeshOptSimplifyModifierPlugin_decorate([uiInput()],MeshOptSimplifyModifierPlugin.prototype,"errorThreshold",void 0),MeshOptSimplifyModifierPlugin_decorate([uiToggle()],MeshOptSimplifyModifierPlugin.prototype,"lockBorder",void 0),MeshOptSimplifyModifierPlugin=MeshOptSimplifyModifierPlugin_1=MeshOptSimplifyModifierPlugin_decorate([uiFolder("Simplify Modifier (meshopt)")],MeshOptSimplifyModifierPlugin);class CustomAnimationHelper{constructor(){this._animations=[],this._playingAnimations=new Set,this._clock=new three_module.zD7}loadModel(o){this._model=o,this.mixer=new three_module.Iw4(o),o&&(this._animations=[...o.animations])}get getMixer(){return this.mixer}get getAnimationClips(){return this._animations}async playAllAnimations(o){var c;const d=[];(c=this._animations)===null||c===void 0||c.forEach(_=>{d.push(this.playClip(_,o))}),await Promise.all(d)}async reverseAllAnimation(o){var c;const d=[];(c=this._animations)===null||c===void 0||c.forEach(_=>{d.push(this.playClip(_,o,1,!0))}),await Promise.all(d)}async playClip(o,c,d=1,_=!1,v=!1){if(!this.mixer)return;const b=this.mixer.clipAction(o);return this._playingAnimations.has(b)&&this.mixer.dispatchEvent({type:"canceled",action:b}),v&&(this.mixer.setTime(0),this.mixer.stopAllAction()),_?(b.paused=!1,b.timeScale=-d):(b.reset(),b.timeScale=d),b.loop=c?three_module.aMy:three_module.G3T,b.clampWhenFinished=!0,new Promise(tt=>{const it=async nt=>{nt.action===b&&(this.mixer.removeEventListener("finished",it),this.mixer.removeEventListener("canceled",it),this._playingAnimations.delete(b),tt())};this.mixer.addEventListener("finished",it),this.mixer.addEventListener("canceled",it),this._playingAnimations.add(b),b.play()})}playClipByName(o,c,d=1,_=!1){let v;this._animations.forEach(b=>{b.name===o&&(v=b)}),v&&this.playClip(v,c,d,_)}update(){const o=this._clock.getDelta();return this._playingAnimations.size>0&&(this.mixer.update(o),!0)}}class CustomAnimationHelperPlugin extends AViewerPlugin{constructor(){super(),this.helperIdentities=new Map}async onAdded(o){var c;await super.onAdded(o),(c=this._viewer)===null||c===void 0||c.addEventListener("postFrame",()=>{this.helperIdentities.forEach(d=>{var _;d.update()&&((_=this._viewer)===null||_===void 0||_.setDirty())})})}createHelper(o,c){var d;if(this.helperIdentities.has(o))(d=this._viewer)===null||d===void 0||d.console.warn("Helper with this id already exists");else{const _=new CustomAnimationHelper;_.loadModel(c),this.helperIdentities.set(o,_)}}getAnimationClips(o){if(this.helperIdentities.has(o))return this.helperIdentities.get(o).getAnimationClips}async playClip(o,c,d,_=1,v=!1,b=!1){this.helperIdentities.has(o)&&await this.helperIdentities.get(o).playClip(c,d,_,v,b)}async playAllAnimations(o,c){this.helperIdentities.has(o)&&await this.helperIdentities.get(o).playAllAnimations(c)}async playAllAnimationsInReverse(o,c){this.helperIdentities.has(o)&&await this.helperIdentities.get(o).reverseAllAnimation(c)}async playAnimationByName(o,c,d,_=1,v=!1){this.helperIdentities.has(o)&&await this.helperIdentities.get(o).playClipByName(c,d,_,v)}}CustomAnimationHelperPlugin.PluginType="AnimationHelperPlugin";class FileTransferPlugin extends AViewerPlugin{constructor(){super(...arguments),this.enabled=!0,this.toJSON=void 0,this.defaultActions={exportFile:async(o,c,d)=>{N$2(o,c)}},this.actions={...this.defaultActions}}async exportFile(o,c){c=c||o.name||"file_export",this.dispatchEvent({type:"transferFile",path:c,state:"exporting"}),await this.actions.exportFile(o,c,({state:d,progress:_})=>{this.dispatchEvent({type:"transferFile",path:c,state:d??"exporting",progress:_})}),this.dispatchEvent({type:"transferFile",path:c,state:"done"})}}FileTransferPlugin.PluginType="FileTransferPlugin";var CameraViewControlPlugin_decorate=function(h,o,c,d){var _,v=arguments.length,b=v<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(h,o,c,d);else for(var tt=h.length-1;tt>=0;tt--)(_=h[tt])&&(b=(v<3?_(b):v>3?_(o,c,b):_(o,c))||b);return v>3&&b&&Object.defineProperty(o,c,b),b};class CameraViewControlPlugin extends AViewerPlugin{_onEnabledChanged1(){this._onEnabledChanged()}_onEnabledChanged(){this._viewer&&(this._viewer.scene.activeCamera.interactionsEnabled=!this.enabled);const o=this._cameraViews.length;this._oldState=o<2?0:three_module.cj9.clamp(this._currentState,0,o-1.001),this.enabled&&this._animateCameraToView(),this.dispatchEvent({type:"enableChanged",enabled:this.enabled})}constructor(o=!0){super(),this.enabled=!0,this.animEase="easeInOutSine",this.interpolateMode="spherical",this.enableDamping=!0,this.damping=.04,this.initAnimationTime=1,this.dependencies=[CameraViewPlugin],this._currentState=0,this._oldState=0,this._overrideTime=0,this._preFrame1=c=>{this._preFrame(c)},this.enabled=o,this._onEnabledChanged1=this._onEnabledChanged1.bind(this)}get _cameraViews(){var o,c,d;return(d=(c=(o=this._viewer)===null||o===void 0?void 0:o.getPlugin(CameraViewPlugin))===null||c===void 0?void 0:c.camViews)!==null&&d!==void 0?d:[]}setState(o){this._currentState=o}async onAdded(o){await super.onAdded(o),this.enabled&&this._onEnabledChanged(),o.addEventListener("preFrame",this._preFrame1)}async onRemove(o){return o.removeEventListener("preFrame",this._preFrame1),this.enabled=!1,super.onRemove(o)}_preFrame(o){var c;if(!this.enabled)return;const d=this._cameraViews;if(d.length<=1||!this._overrideStartView&&Math.abs(this._currentState-this._oldState)<.001)return;this.enableDamping?this._oldState=three_module.cj9.lerp(this._oldState,this._currentState,this.damping):this._oldState=this._currentState,this._oldState=three_module.cj9.clamp(this._oldState,0,d.length-1.001);const _=Math.floor(this._oldState),v=this._overrideStartView||d[_],b=this._overrideEndView||d[_+1];let tt,it=this._overrideStartView?this._overrideTime:this._oldState-_;it=EasingFunctions[this.animEase](it),tt=this.interpolateMode==="spherical"?this._lerpViewsSpherical(v,b,it):this._lerpViewsLinear(v,b,it);const nt=(c=this._viewer)===null||c===void 0?void 0:c.scene.activeCamera;nt&&(nt.position.copy(tt[0]),nt.target.copy(tt[1]),nt.positionTargetUpdated(!0)),this._overrideStartView&&(this._overrideTime+=o.deltaTime/1e3,this._overrideTime>=this.initAnimationTime&&(this._overrideTime=0,this._overrideStartView=void 0,this._overrideEndView=void 0))}_lerpViewsLinear(o,c,d){const _=new three_module.Pq0,v=new three_module.Pq0;return v.lerpVectors(o.position,c.position,d),_.lerpVectors(o.target,c.target,d),[v,_]}_lerpViewsSpherical(o,c,d){const _=o.target.clone(),v=new three_module.Pq0,b=new three_module.Pq0,tt=sphericalFromObject(o,o.target),it=sphericalFromObject(c,c.target),nt=new three_module.YHV;return nt.phi=lerpAngle(tt.phi,it.phi,d),nt.theta=lerpAngle(tt.theta,it.theta,d),nt.radius=three_module.cj9.lerp(tt.radius,it.radius,d),v.copy(_).lerp(c.target,d),b.setFromSpherical(nt),b.add(v),[b,v]}_animateCameraToView(){const o=this._cameraViews;if(!this._viewer||o.length<2||!this.enabled)return;this._overrideStartView=new CameraView(this._viewer.scene.activeCamera.position,this._viewer.scene.activeCamera.target);const c=Math.floor(this._oldState),d=this._oldState-c;let _;_=this.interpolateMode==="spherical"?this._lerpViewsSpherical(o[c],o[c+1],d):this._lerpViewsLinear(o[c],o[c+1],d),this._overrideEndView=new CameraView(_[0],_[1]),this._overrideTime=0}}CameraViewControlPlugin.PluginType="CameraViewControlPlugin",CameraViewControlPlugin_decorate([uiToggle("Enabled"),x$1(CameraViewControlPlugin.prototype._onEnabledChanged1),serialize()],CameraViewControlPlugin.prototype,"enabled",void 0),CameraViewControlPlugin_decorate([serialize(),uiDropdown("Ease",Object.keys(EasingFunctions).map(h=>({label:h})))],CameraViewControlPlugin.prototype,"animEase",void 0),CameraViewControlPlugin_decorate([serialize(),uiDropdown("Interpolation",["spherical","linear"].map(h=>({label:h})))],CameraViewControlPlugin.prototype,"interpolateMode",void 0),CameraViewControlPlugin_decorate([uiToggle("Enable Damping"),serialize()],CameraViewControlPlugin.prototype,"enableDamping",void 0),CameraViewControlPlugin_decorate([uiSlider("Damping",[.01,1],.001),serialize()],CameraViewControlPlugin.prototype,"damping",void 0),CameraViewControlPlugin_decorate([uiSlider("Init Anim Time",[.01,5],.001),serialize()],CameraViewControlPlugin.prototype,"initAnimationTime",void 0);class ScrollableCameraViewPlugin extends CameraViewControlPlugin{constructor(o=document.body,c=!0){super(c),this.wrapper=document.createElement("div"),this.toJSON=void 0,this.uiConfig={type:"folder",label:"Scrollable Camera Views",children:[...generateUiConfig(this)]},typeof o=="string"?(this.parent=document.getElementById(o),this.parent||(console.error("parent doesn't exist"),this.parent=document.body)):this.parent=o}_preFrame(o){var c;if(this.enabled&&!(this._cameraViews.length<=1))try{const d=this._findActiveView(),_=this._getScroll(d);this.setState(_+d),super._preFrame(o)}catch(d){return void(((c=this._viewer)===null||c===void 0?void 0:c.getPluginByType("Debug"))&&console.error(d))}}_getScroll(o){var c,d;if(o>=this._cameraViews.length-1)return 0;const _=(c=this.parent.querySelector(this._cameraViews[o].name))!==null&&c!==void 0?c:this.parent.getElementsByTagName("section")[o],v=(d=this.parent.querySelector(this._cameraViews[o+1].name))!==null&&d!==void 0?d:this.parent.getElementsByTagName("section")[o+1],b=this.parent.getBoundingClientRect();if(!_||!v)return 0;const tt=_.getBoundingClientRect(),it=v.getBoundingClientRect(),nt=this.parent===document.body?0:b.top;return three_module.cj9.clamp((nt-tt.top)/Math.max(it.top-tt.top,1e-4),0,1)}_findActiveView(){var o,c;for(let d=this._cameraViews.length-1;d>=0;d--){const _=(o=this.parent.querySelector(this._cameraViews[d].name))!==null&&o!==void 0?o:this.parent.getElementsByTagName("section")[d],v=this.parent.getBoundingClientRect();if(_){if(_.getBoundingClientRect().top<(this.parent===document.body?0:v.top))return d}else!((c=this._cameraViews[d].name)===null||c===void 0)&&c.startsWith("#")&&console.error("section with id "+this._cameraViews[d].name+" doesn't exist!")}return 0}}ScrollableCameraViewPlugin.PluginType="ScrollableCameraViewPlugin";var ScrollableCameraViewPreviewPlugin_decorate=function(h,o,c,d){var _,v=arguments.length,b=v<3?o:d===null?d=Object.getOwnPropertyDescriptor(o,c):d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(h,o,c,d);else for(var tt=h.length-1;tt>=0;tt--)(_=h[tt])&&(b=(v<3?_(b):v>3?_(o,c,b):_(o,c))||b);return v>3&&b&&Object.defineProperty(o,c,b),b};let ScrollableCameraViewPreviewPlugin=class extends ScrollableCameraViewPlugin{generateCode(){var h;const o=document.createElement("div");o.style.position="absolute",o.style.top="0",o.style.width="100%",o.style.height="100%",o.style.display="flex",o.style.flexDirection="column",o.style.justifyContent="center",o.style.alignItems="center",o.style.zIndex="200";const c=document.createElement("textarea");c.rows=20,c.style.border="3px solid #27223a",c.style.borderRadius="5px",c.style.width="30%",c.style.padding="5px",c.style.zIndex="1000";const d=document.createElement("div");d.textContent="X",d.style.color="red",d.style.width="20px",d.style.height="20px",d.style.padding="2",d.style.textAlign="center",d.style.backgroundColor="white",d.style.borderRadius="100%",d.style.border="2px solid #27223a",d.style.cursor="pointer",d.addEventListener("click",()=>{var v;(v=this._viewer)===null||v===void 0||v.container.removeChild(o)});const _=document.createElement("div");_.textContent="Update",_.style.marginTop="10px",_.style.color="white",_.style.padding="4px 10px 4px 10px",_.style.justifyContent="center",_.style.alignItems="center",_.style.backgroundColor="green",_.style.borderRadius="10px",_.style.border="2px solid #fff",_.style.cursor="pointer",_.addEventListener("click",()=>{var v,b;const tt=this.parent.innerHTML;this.parent.innerHTML=c.value;let it=0;for(;it<this._cameraViews.length;it++){let nt;try{nt=(v=this.parent.querySelector(this._cameraViews[it].name))!==null&&v!==void 0?v:this.parent.getElementsByTagName("section")[it]}catch{nt=null}if(!nt&&it<2){alert("you need to add 2 sections at least");break}if(!nt){const lt=((b=this._cameraViews[it].name)===null||b===void 0||b.startsWith("#"),this._cameraViews[it].name.replace(/^#/,""));c.value+=lt,c.value=this._format(c.value)}}it<2?this.parent.innerHTML=tt:setInnerHTMLWithScripts(this.parent,c.value)}),o.appendChild(d),o.appendChild(c),o.appendChild(_),c.value=this._format(this.parent.innerHTML),(h=this._viewer)===null||h===void 0||h.container.appendChild(o)}_onEnabledChanged(){super._onEnabledChanged(),this._togglePreview()}_togglePreview(){this.wrapper&&(this.wrapper.style.zIndex=this.canvasUp?"-100":"100",this.wrapper.style.visibility=this.enabled?"visible":"hidden",this._viewer&&(this._viewer.canvas.style.pointerEvents=this.enabled&&this.canvasUp?"none":"auto"))}constructor(h=document.body,o=!1){super(h,o),this.canvasUp=!1,this._togglePreview=this._togglePreview.bind(this),this.generateCode=this.generateCode.bind(this)}async onAdded(h){var o,c,d,_,v,b;this.parent=this.wrapper,await super.onAdded(h),this._addWrapper(),this._togglePreview(),this.deserialize=this.deserialize.bind(this),this.addView=this.addView.bind(this),this.deleteView=this.deleteView.bind(this),(c=(o=this._viewer)===null||o===void 0?void 0:o.getPlugin(CameraViewPlugin))===null||c===void 0||c.addEventListener("viewDelete",this.deleteView),(_=(d=this._viewer)===null||d===void 0?void 0:d.getPlugin(CameraViewPlugin))===null||_===void 0||_.addEventListener("deserialize",this.deserialize),(b=(v=this._viewer)===null||v===void 0?void 0:v.getPlugin(CameraViewPlugin))===null||b===void 0||b.addEventListener("viewAdd",this.addView)}deserialize(h){this._cameraViews.forEach(o=>{this._createSection(o.name)})}_addWrapper(){var h;this.wrapper.style.width="100%",this.wrapper.style.height="100%",this.wrapper.style.zIndex="-100",this.wrapper.style.position="absolute",this.wrapper.style.top="0",this.wrapper.id="parentWrapper",this.wrapper.style.borderRadius="10px",this.wrapper.style.overflowY="scroll",this.wrapper.style.overflowX="hidden",(h=this._viewer)===null||h===void 0||h.container.appendChild(this.wrapper)}_createSection(h){const o=document.createElement("section");o.style.width="100%",o.style.height="100%",o.style.opacity="50%",o.style.backgroundColor="black",o.style.zIndex="100",o.style.top="0",o.textContent=h,o.style.color="white",o.style.fontSize="100px",o.style.display="flex",o.style.alignItems="center",o.style.justifyContent="center",o.id=h,this.parent.appendChild(o)}addView(h){this._cameraViews.forEach((o,c)=>{var d,_;let v;try{v=(d=this.parent.querySelector(o.name))!==null&&d!==void 0?d:this.parent.getElementsByTagName("section")[c]}catch{v=null}if(!v){const b=`<section id="${!((_=o.name)===null||_===void 0)&&_.startsWith("#")?o.name.replace(/^#/,""):""}" style="width: 100%; height: 100%; opacity: 0.5; background-color: black; z-index: 100; top: 0px; color: white; font-size: 100px; display: flex; align-items: center; justify-content: center;">
                    ${o.name}
                    </section>`;this.parent.innerHTML+=b}})}deleteView(h){var o;try{const c=(o=this.parent.querySelector(h.view.name))!==null&&o!==void 0?o:this.parent.getElementsByTagName("section").namedItem(h.view.name);c==null||c.remove()}catch{return}}_format(h){let o="",c="";return h.split(/>\s*</).forEach(function(d){d.match(/^\/\w/)&&(c=c.substring(1)),o+=c+"<"+d+`>\r
`,d.match(/^<?\w[^>]*[^/]$/)&&!d.startsWith("input")&&(c+="	")}),o.substring(1,o.length-3)}};ScrollableCameraViewPreviewPlugin_decorate([uiButton("Show/Edit Code")],ScrollableCameraViewPreviewPlugin.prototype,"generateCode",null),ScrollableCameraViewPreviewPlugin_decorate([uiToggle("Canvas on top"),x$1(ScrollableCameraViewPreviewPlugin.prototype._togglePreview)],ScrollableCameraViewPreviewPlugin.prototype,"canvasUp",void 0),ScrollableCameraViewPreviewPlugin=ScrollableCameraViewPreviewPlugin_decorate([uiFolder("Scrollable Camera View Preview (Dev)")],ScrollableCameraViewPreviewPlugin);var build_e={d:(h,o)=>{for(var c in o)build_e.o(o,c)&&!build_e.o(h,c)&&Object.defineProperty(h,c,{enumerable:!0,get:o[c]})},o:(h,o)=>Object.prototype.hasOwnProperty.call(h,o)},build_t={};build_e.d(build_t,{e:()=>build_R});var build_n=function(h,o,c,d){return new(c||(c=Promise))(function(_,v){function b(nt){try{it(d.next(nt))}catch(lt){v(lt)}}function tt(nt){try{it(d.throw(nt))}catch(lt){v(lt)}}function it(nt){var lt;nt.done?_(nt.value):(lt=nt.value,lt instanceof c?lt:new c(function(ut){ut(lt)})).then(b,tt)}it((d=d.apply(h,[])).next())})};class build_r{constructor(o,c={resolution:2048},d={},_=!1,v=!1,b=!1){this.THREE=o,this.packOptions=c,this.chartOptions=d,this.useNormals=_,this.timeUnwrap=v,this.logProgress=b,this._libraryLoaded=!1,this._isUnwrapping=!1,this.xAtlas=this._createXAtlas()}loadLibrary(o,c,d){return build_n(this,void 0,void 0,function*(){if(!this._libraryLoaded){for(yield new Promise((_,v)=>{try{this.xAtlas.init(_,o,c,d)}catch(b){v(b)}});!this.xAtlas.api||!(yield this.xAtlas.api.loaded);)yield new Promise(_=>setTimeout(_,100));this._libraryLoaded=!0}})}packAtlas(o,c="uv2",d="uv"){return build_n(this,void 0,void 0,function*(){if(!this._libraryLoaded)throw new Error("xatlas-three: library not loaded");if(!o)throw new Error("xatlas-three: nodeList argument not provided");if(o.length<1)throw new Error("xatlas-three: nodeList must have non-zero length");const _=this.chartOptions.useInputMeshUvs;for(;this._isUnwrapping;)console.log("xatlas-three: unwrapping another mesh, waiting 100 ms"),yield new Promise(nt=>setTimeout(nt,100));this._isUnwrapping=!0,yield this.xAtlas.api.setProgressLogging(this.logProgress),yield this.xAtlas.api.createAtlas();let v=[],b="";for(let nt of o){let{uuid:lt,index:ut,attributes:ht}=nt;const _t=nt.userData.worldScale||1;v.push(lt),ut&&ht.position&&ht.position.itemSize===3?(b="Mesh"+v.length+" added to atlas: "+lt,this.timeUnwrap&&console.time(b),yield this.xAtlas.api.addMesh(ut.array,ht.position.array,ht.normal?ht.normal.array:void 0,ht.uv?ht.uv.array:void 0,lt,this.useNormals,_,_t),this.timeUnwrap&&console.timeEnd(b)):console.warn("xatlas-three: Geometry not supported: ",nt)}b="Generated atlas with "+v.length+" meshes",this.timeUnwrap&&console.time(b);const tt=yield this.xAtlas.api.generateAtlas(this.chartOptions,this.packOptions,!0);this.timeUnwrap&&console.timeEnd(b);let it=[];for(let nt of tt.meshes){let lt=o.find(_t=>_t.uuid===nt.mesh);if(!lt){console.error("xatlas-three: Geometry not found: ",nt.mesh);continue}nt.vertex.vertices&&lt.setAttribute("position",new this.THREE.BufferAttribute(nt.vertex.vertices,3,!1)),nt.vertex.normals&&lt.setAttribute("normal",new this.THREE.BufferAttribute(nt.vertex.normals,3,!0)),nt.vertex.coords1&&lt.setAttribute(c,new this.THREE.BufferAttribute(nt.vertex.coords1,2,!1)),nt.vertex.coords&&c!==d&&lt.setAttribute(d,new this.THREE.BufferAttribute(nt.vertex.coords,2,!1)),nt.index&&lt.setIndex(new this.THREE.BufferAttribute(nt.index,1,!1)),nt.subMeshes&&(lt.userData.xAtlasSubMeshes=structuredClone(nt.subMeshes));const ut=nt.oldIndexes,ht=lt.attributes;for(const _t in ht){if(_t==="position"||_t==="normal"||_t===c||_t===d)continue;const ft=ht[_t],bt=ft.array.constructor,xt=ft.itemSize,St=ft.array,wt=new bt(ut.length*xt),Pt=new this.THREE.BufferAttribute(wt,xt,ft.normalized);Pt.gpuType=ft.gpuType;for(let Rt=0,kt=ut.length;Rt<kt;Rt++){const Gt=ut[Rt];for(let Dt=0;Dt<xt;Dt++)wt[Rt*xt+Dt]=St[Gt*xt+Dt]}lt.setAttribute(_t,Pt)}it.push(lt)}return yield this.xAtlas.api.destroyAtlas(),this._isUnwrapping=!1,{width:tt.width,height:tt.height,atlasCount:tt.atlasCount,meshCount:tt.meshCount,texelsPerUnit:tt.texelsPerUnit,geometries:it,meshes:tt.meshes}})}unwrapGeometry(o,c="uv",d="uv2"){return build_n(this,void 0,void 0,function*(){return this.packAtlas([o],c,d)})}}class build_s{}const build_i=Symbol("Comlink.proxy"),build_a=Symbol("Comlink.endpoint"),build_o=Symbol("Comlink.releaseProxy"),build_l=Symbol("Comlink.finalizer"),build_u=Symbol("Comlink.thrown"),build_c=h=>typeof h=="object"&&h!==null||typeof h=="function",build_h=new Map([["proxy",{canHandle:h=>build_c(h)&&h[build_i],serialize(h){const{port1:o,port2:c}=new MessageChannel;return build_p(h,o),[c,[c]]},deserialize:h=>(h.start(),build_f(h))}],["throw",{canHandle:h=>build_c(h)&&build_u in h,serialize({value:h}){let o;return o=h instanceof Error?{isError:!0,value:{message:h.message,name:h.name,stack:h.stack}}:{isError:!1,value:h},[o,[]]},deserialize(h){throw h.isError?Object.assign(new Error(h.value.message),h.value):h.value}}]]);function build_p(h,o=globalThis,c=["*"]){o.addEventListener("message",function d(_){if(!_||!_.data)return;if(!function(lt,ut){for(const ht of lt)if(ut===ht||ht==="*"||ht instanceof RegExp&&ht.test(ut))return!0;return!1}(c,_.origin))return void console.warn(`Invalid origin '${_.origin}' for comlink proxy`);const{id:v,type:b,path:tt}=Object.assign({path:[]},_.data),it=(_.data.argumentList||[]).map(build_L);let nt;try{const lt=tt.slice(0,-1).reduce((ht,_t)=>ht[_t],h),ut=tt.reduce((ht,_t)=>ht[_t],h);switch(b){case"GET":nt=ut;break;case"SET":lt[tt.slice(-1)[0]]=build_L(_.data.value),nt=!0;break;case"APPLY":nt=ut.apply(lt,it);break;case"CONSTRUCT":nt=build_x(new ut(...it));break;case"ENDPOINT":{const{port1:ht,port2:_t}=new MessageChannel;build_p(h,_t),nt=function(ft,bt){return build_E.set(ft,bt),ft}(ht,[ht])}break;case"RELEASE":nt=void 0;break;default:return}}catch(lt){nt={value:lt,[build_u]:0}}Promise.resolve(nt).catch(lt=>({value:lt,[build_u]:0})).then(lt=>{const[ut,ht]=build_A(lt);o.postMessage(Object.assign(Object.assign({},ut),{id:v}),ht),b==="RELEASE"&&(o.removeEventListener("message",d),build_d(o),build_l in h&&typeof h[build_l]=="function"&&h[build_l]())}).catch(lt=>{const[ut,ht]=build_A({value:new TypeError("Unserializable return value"),[build_u]:0});o.postMessage(Object.assign(Object.assign({},ut),{id:v}),ht)})}),o.start&&o.start()}function build_d(h){(function(o){return o.constructor.name==="MessagePort"})(h)&&h.close()}function build_f(h,o){return build_v(h,[],o)}function build_m(h){if(h)throw new Error("Proxy has been released and is not useable")}function build_g(h){return build_P(h,{type:"RELEASE"}).then(()=>{build_d(h)})}const build_y=new WeakMap,build_w="FinalizationRegistry"in globalThis&&new FinalizationRegistry(h=>{const o=(build_y.get(h)||0)-1;build_y.set(h,o),o===0&&build_g(h)});function build_v(h,o=[],c=function(){}){let d=!1;const _=new Proxy(c,{get(v,b){if(build_m(d),b===build_o)return()=>{(function(tt){build_w&&build_w.unregister(tt)})(_),build_g(h),d=!0};if(b==="then"){if(o.length===0)return{then:()=>_};const tt=build_P(h,{type:"GET",path:o.map(it=>it.toString())}).then(build_L);return tt.then.bind(tt)}return build_v(h,[...o,b])},set(v,b,tt){build_m(d);const[it,nt]=build_A(tt);return build_P(h,{type:"SET",path:[...o,b].map(lt=>lt.toString()),value:it},nt).then(build_L)},apply(v,b,tt){build_m(d);const it=o[o.length-1];if(it===build_a)return build_P(h,{type:"ENDPOINT"}).then(build_L);if(it==="bind")return build_v(h,o.slice(0,-1));const[nt,lt]=build_b(tt);return build_P(h,{type:"APPLY",path:o.map(ut=>ut.toString()),argumentList:nt},lt).then(build_L)},construct(v,b){build_m(d);const[tt,it]=build_b(b);return build_P(h,{type:"CONSTRUCT",path:o.map(nt=>nt.toString()),argumentList:tt},it).then(build_L)}});return function(v,b){const tt=(build_y.get(b)||0)+1;build_y.set(b,tt),build_w&&build_w.register(v,b,v)}(_,h),_}function build_b(h){const o=h.map(build_A);return[o.map(d=>d[0]),(c=o.map(d=>d[1]),Array.prototype.concat.apply([],c))];var c}const build_E=new WeakMap;function build_x(h){return Object.assign(h,{[build_i]:!0})}function build_A(h){for(const[o,c]of build_h)if(c.canHandle(h)){const[d,_]=c.serialize(h);return[{type:"HANDLER",name:o,value:d},_]}return[{type:"RAW",value:h},build_E.get(h)||[]]}function build_L(h){switch(h.type){case"HANDLER":return build_h.get(h.name).deserialize(h.value);case"RAW":return h.value}}function build_P(h,o,c){return new Promise(d=>{const _=new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-");h.addEventListener("message",function v(b){b.data&&b.data.id&&b.data.id===_&&(h.removeEventListener("message",v),d(b.data))}),h.start&&h.start(),h.postMessage(Object.assign({id:_},o),c)})}class build_T extends build_s{init(o,c,d,_){if(!this.api){if(!_)throw new Error("workerFilePath is required");(()=>{var v,b,tt;v=this,tt=function*(){const it=yield fetch(_).then(ut=>ut.blob()),nt=URL.createObjectURL(it),lt=new Worker(nt,{type:"module"});this.api=yield new(build_f(lt))(build_x(()=>{o(),URL.revokeObjectURL(nt)}),build_x((ut,ht)=>ut==="xatlas.wasm"?d:ut+ht),build_x(c))},new((b=void 0)||(b=Promise))(function(it,nt){function lt(_t){try{ht(tt.next(_t))}catch(ft){nt(ft)}}function ut(_t){try{ht(tt.throw(_t))}catch(ft){nt(ft)}}function ht(_t){var ft;_t.done?it(_t.value):(ft=_t.value,ft instanceof b?ft:new b(function(bt){bt(ft)})).then(lt,ut)}ht((tt=tt.apply(v,[])).next())})})()}}}class build_R extends build_r{_createXAtlas(){return new build_T}}var build_k=build_t.e,XAtlasPlugin_decorate=function(h,o,c,d){var _,v=arguments.length,b=v<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(h,o,c,d);else for(var tt=h.length-1;tt>=0;tt--)(_=h[tt])&&(b=(v<3?_(b):v>3?_(o,c,b):_(o,c))||b);return v>3&&b&&Object.defineProperty(o,c,b),b},XAtlasPlugin_1;let UChartOptions=class{constructor(){this.fixWinding=!1,this.maxBoundaryLength=0,this.maxChartArea=0,this.maxCost=2,this.maxIterations=1,this.normalDeviationWeight=2,this.normalSeamWeight=4,this.roundnessWeight=.009999999776482582,this.straightnessWeight=6,this.textureSeamWeight=.5,this.useInputMeshUvs=!1}};XAtlasPlugin_decorate([serialize()],UChartOptions.prototype,"fixWinding",void 0),XAtlasPlugin_decorate([serialize()],UChartOptions.prototype,"maxBoundaryLength",void 0),XAtlasPlugin_decorate([serialize()],UChartOptions.prototype,"maxChartArea",void 0),XAtlasPlugin_decorate([serialize()],UChartOptions.prototype,"maxCost",void 0),XAtlasPlugin_decorate([serialize()],UChartOptions.prototype,"maxIterations",void 0),XAtlasPlugin_decorate([serialize()],UChartOptions.prototype,"normalDeviationWeight",void 0),XAtlasPlugin_decorate([serialize()],UChartOptions.prototype,"normalSeamWeight",void 0),XAtlasPlugin_decorate([serialize()],UChartOptions.prototype,"roundnessWeight",void 0),XAtlasPlugin_decorate([serialize()],UChartOptions.prototype,"straightnessWeight",void 0),XAtlasPlugin_decorate([serialize()],UChartOptions.prototype,"textureSeamWeight",void 0),XAtlasPlugin_decorate([serialize()],UChartOptions.prototype,"useInputMeshUvs",void 0),UChartOptions=XAtlasPlugin_decorate([uiFolder("Chart Options"),serializable("UChartOptions")],UChartOptions);let UPackOptions=class{constructor(){this.bilinear=!0,this.blockAlign=!1,this.bruteForce=!1,this.createImage=!1,this.maxChartSize=0,this.padding=0,this.resolution=0,this.rotateCharts=!0,this.rotateChartsToAxis=!0,this.texelsPerUnit=0}};XAtlasPlugin_decorate([serialize()],UPackOptions.prototype,"bilinear",void 0),XAtlasPlugin_decorate([serialize()],UPackOptions.prototype,"blockAlign",void 0),XAtlasPlugin_decorate([serialize()],UPackOptions.prototype,"bruteForce",void 0),XAtlasPlugin_decorate([serialize()],UPackOptions.prototype,"createImage",void 0),XAtlasPlugin_decorate([serialize()],UPackOptions.prototype,"maxChartSize",void 0),XAtlasPlugin_decorate([serialize()],UPackOptions.prototype,"padding",void 0),XAtlasPlugin_decorate([serialize()],UPackOptions.prototype,"resolution",void 0),XAtlasPlugin_decorate([serialize()],UPackOptions.prototype,"rotateCharts",void 0),XAtlasPlugin_decorate([serialize()],UPackOptions.prototype,"rotateChartsToAxis",void 0),XAtlasPlugin_decorate([serialize()],UPackOptions.prototype,"texelsPerUnit",void 0),UPackOptions=XAtlasPlugin_decorate([uiFolder("Pack Options"),serializable("UPackOptions")],UPackOptions);let XAtlasPlugin=XAtlasPlugin_1=class extends AViewerPlugin{constructor(h=!1){super(),this.enabled=!0,this.useNormals=!0,this.chartOptions=new UChartOptions,this.packOptions=new UPackOptions,this._loaded=!1,this._unwrapProgress=(o,c)=>{console.log("Unwrapping",o,c)},this.unwrapSelected=async()=>{var o,c,d,_,v;const b=(c=(o=this._viewer)===null||o===void 0?void 0:o.getPlugin(PickingPlugin))===null||c===void 0?void 0:c.getSelectedObject();if(b)if(b.geometry){if(b.geometry.attributes.uv&&!await((v=this._viewer)===null||v===void 0?void 0:v.confirm("Unwrap: Geometry already has UVs. Overwrite?")))return;await this.unwrapGeometry(b.geometry)}else(_=this._viewer)===null||_===void 0||_.alert("Unwrap: Selected object has no geometry");else(d=this._viewer)===null||d===void 0||d.alert("Unwrap: No object selected")},h&&this.loadLibrary()}async loadLibrary(){if(this._unwrapper)for(;!this._loaded;)await X$2(100);else this._unwrapper=new build_k({BufferAttribute:three_module.THS},this.packOptions,this.chartOptions,this.useNormals),await this._unwrapper.loadLibrary(this._unwrapProgress,XAtlasPlugin_1.LIBRARY_PATH+"xatlas.wasm",XAtlasPlugin_1.LIBRARY_PATH+"xatlas.js"),console.log("xatlas loaded"),this._loaded=!0}async unwrapGeometry(h,o="uv",c="uv"){var d;await this.loadLibrary(),await((d=this._unwrapper)===null||d===void 0?void 0:d.unwrapGeometry(h,o,c))}async packAtlas(h,o=!0,c="uv2",d="uv"){var _;await this.loadLibrary(),Array.isArray(h)||(h=[h]);const v=[];o?h.forEach(b=>b.traverse(tt=>{tt.geometry&&v.push(tt.geometry)})):h.forEach(b=>{b.geometry&&v.push(b.geometry)}),await((_=this._unwrapper)===null||_===void 0?void 0:_.packAtlas(v,c,d))}_useNormalsChanged(){this._unwrapper&&(this._unwrapper.useNormals=this.useNormals)}};XAtlasPlugin.PluginType="XAtlasPlugin",XAtlasPlugin.LIBRARY_PATH="https://cdn.jsdelivr.net/npm/xatlasjs@0.1.0/dist/",XAtlasPlugin_decorate([x$1(XAtlasPlugin.prototype._useNormalsChanged),serialize()],XAtlasPlugin.prototype,"useNormals",void 0),XAtlasPlugin_decorate([serialize()],XAtlasPlugin.prototype,"chartOptions",void 0),XAtlasPlugin_decorate([serialize()],XAtlasPlugin.prototype,"packOptions",void 0),XAtlasPlugin_decorate([uiButton("Unwrap Selected Geometry")],XAtlasPlugin.prototype,"unwrapSelected",void 0),XAtlasPlugin=XAtlasPlugin_1=XAtlasPlugin_decorate([uiFolder("UV Unwrapping (xAtlas)")],XAtlasPlugin);class VariationConfiguratorPlugin extends AViewerPlugin{constructor(){super(...arguments),this.dependencies=[AssetManagerPlugin],this.enabled=!0,this.serializeWithViewer=!1,this.baseUrl="",this.variations={objects:[],materials:[]},this.autoDispose=!0,this._ty=["objects","materials"],this._extForType={objects:["glb","fbx","obj","gltf","stl","3dm","json","vjson"],materials:["pmat","dmat"],images:["png","jpg","jpeg","gif","bmp","webp","svg"]},this.utils={getName:o=>o.name||o.prefix.replace(/^\//,"").replace(/\/$/,"").replaceAll("/","_"),getTitle:o=>o.title||this.utils.getName(o),getIcon:(o,c)=>{let d=o.icon;return(d&&/^(\w+)\(([^)]*)\)/.exec(d)||/^#([A-Fa-f\d]+)$/.exec(d))&&(d=Je$1(d)),d&&d.startsWith("http")&&d.startsWith("data:")||(d=this.utils.pathToIcon(this.baseUrl+c+"/"+o.prefix+(d||""))),d},getItemIcon:(o,c,d)=>{const _=o.iconFiles[c];if(_)return URL.createObjectURL(_);let v=o.icons[c];return(v&&/^(\w+)\(([^)]*)\)/.exec(v)||/^#([A-Fa-f\d]+)$/.exec(v))&&(v=Je$1(v)),v||(v=this.utils.pathToIcon(o.items[c])),!v||v.startsWith("http")||v.startsWith("data:")||(v=this.baseUrl+d+"/"+o.prefix+v),v},getItemTitle:(o,c)=>o.titles[c]||this.utils.pathToTitle(o.items[c]),getItemPath:(o,c,d)=>o.items[c].startsWith("http")?o.items[c]:`${this.baseUrl}${d}/${o.prefix}${o.items[c]}`,pathToTitle:o=>o.split("/").pop().replace(/\.[^.]*$/,""),pathToIcon:o=>o.replace(/\/$/,"").replace(/\.[^/.]+$/,"")+".webp"},this.toJSON=void 0}_getVariationId(o){return this.utils.getName(o)}async applyVariation(o,c,d,_=!1){var v,b;if(!this._viewer)return;const tt=this._getVariationId(o);typeof c=="number"&&(c=o.items[c]);const it=o.items.indexOf(c);if(it===-1)return void this._viewer.console.warn(`Item ${c} not found`);const nt=o.itemFiles[it],lt=o.selected;if(!_&&lt===it)return;o.selected=it;const ut=this._viewer.getManager(),ht=this.utils.getItemPath(o,it,d);if(d==="objects"){let _t=this._viewer.scene.findObjectsByName(tt).map(wt=>wt.modelObject);_t.length===0&&(_t=[(await this._viewer.createObject3D()).modelObject],_t[0].name=tt),this._viewer.renderEnabled=!1;for(const wt of _t)[...wt.children].forEach(Pt=>Pt.dispose&&this.autoDispose?Pt.dispose():Pt.removeFromParent());const ft=await this._loadObject(ht,nt);if(!ft.length)return void(ht.endsWith("json")||this._viewer.console.warn(`Object ${ht} not found`));let bt=!1;for(const wt of _t){[...wt.children].forEach(Pt=>Pt.dispose&&this.autoDispose?Pt.dispose():Pt.removeFromParent());for(const Pt of ft)bt?wt.add(Pt.modelObject.clone()):wt.add(Pt.modelObject);bt=!0}const xt=[],St=this.variations.materials.filter(wt=>wt&&typeof wt.selected=="number");for(const wt of St)xt.push(this.applyVariation(wt,wt.selected,"materials",!0));await Promise.all(xt),this._viewer.renderEnabled=!0}if(d==="materials"){const _t=await this._loadMaterial(ht,nt);if(!_t)return void this._viewer.console.warn(`Material ${ht} not found`);_t.userData.__isVariation=!0;const ft=this._viewer.scene.findObjectsByName(tt),bt=xt=>{var St,wt,Pt,Rt;xt.material&&!((St=o.data)===null||St===void 0)&&St.matType&&(Array.isArray(xt.material)?xt.material.length!==0&&((wt=o.data)===null||wt===void 0?void 0:wt.matType)!==xt.material[0].typeSlug:((Pt=o.data)===null||Pt===void 0?void 0:Pt.matType)!==xt.material.typeSlug)||(Rt=xt==null?void 0:xt.setMaterial)===null||Rt===void 0||Rt.call(xt,_t)};for(const xt of ft)!((v=o.data)===null||v===void 0)&&v.traverse?xt.traverse(bt):bt(xt);(b=ut.materials)===null||b===void 0||b.applyMaterial(_t,tt)}}clearVariations(){const o=this.variations.objects;if(this.variations.materials,this.variations={objects:[],materials:[]},this._viewer)for(const c of o){const d=this._getVariationId(c),_=this._viewer.scene.findObjectsByName(d);for(const v of _)[...v.children].forEach(b=>{var tt;return((tt=b.dispose)!==null&&tt!==void 0?tt:b.removeFromParent)()})}}async _loadMaterial(o,c){var d,_,v;return(v=(_=(d=this._viewer)===null||d===void 0?void 0:d.getManager())===null||_===void 0?void 0:_.importer)===null||v===void 0?void 0:v.importSinglePath(o,{importedFile:c})}async _loadObject(o,c){var d,_,v;return(v=(_=(d=this._viewer)===null||d===void 0?void 0:d.getManager())===null||_===void 0?void 0:_.importer)===null||v===void 0?void 0:v.importPath(o,{importedFile:c,reimportDisposed:!0})}importConfig(o,c){var d,_;typeof o=="string"&&(o=JSON.parse(o)),o.baseUrl!==void 0&&(this.baseUrl=o.baseUrl),!c&&o.folder&&(c=typeof o.folder=="object"?o.folder:typeof o.folder=="string"?unzipSync(strToU8(o.folder)):unzipSync(o.folder));for(const v of this._ty)if(o[v])for(const b of o[v]){const tt={items:b.items,prefix:b.prefix,name:b.name,title:b.title||"",icon:b.icon||"",icons:(d=b.icons)!==null&&d!==void 0?d:b.items.map(()=>""),titles:(_=b.titles)!==null&&_!==void 0?_:b.items.map(()=>""),itemFiles:[],iconFiles:[],data:{...b.data}};if(c)for(let it=0;it<b.items.length;it++){const nt=b.items[it],lt=c[v+"/"+b.prefix+nt];tt.itemFiles[it]=lt?new File([lt],nt):void 0;const ut=b.icons[it];if(!ut)continue;const ht=c[v+"/"+b.prefix+ut];tt.iconFiles[it]=ht?new File([ht],ut):void 0}this.variations[v].push(tt)}}async importPath(o){var c,d;if(o.endsWith(".json")){const _=await((d=(c=this._viewer)===null||c===void 0?void 0:c.getManager().importer)===null||d===void 0?void 0:d.importSinglePath(o,{processImported:!1})),v=o.split("?")[0];return this.baseUrl||(this.baseUrl=v.substring(0,v.lastIndexOf("/")+1)),this.importConfig(_)}o.endsWith(".zip")?alert("not implemented"):alert("not supported")}getMaterials(o){var c;return((c=this.variations.materials.find(d=>this.utils.getName(d)===o))===null||c===void 0?void 0:c.items)||[]}getObjects(o){var c;return((c=this.variations.objects.find(d=>this.utils.getName(d)===o))===null||c===void 0?void 0:c.items)||[]}getMaterialVariations(){return this.variations.materials.map(o=>this.utils.getName(o))}getObjectVariations(){return this.variations.objects.map(o=>this.utils.getName(o))}async onRemove(o){return super.onRemove(o)}fromJSON(o){return super.fromJSON(o)?(this.importConfig(o),this):null}async _exportConfiguratorState(){var o;let c={objects:{},materials:{}};const d={objects:[],materials:[],type:VariationConfiguratorPlugin.PluginType};this.baseUrl&&(d.baseUrl=this.baseUrl);let _=!1;for(const v of this._ty)for(const b of this.variations[v]){const tt={...b};tt.data={...tt.data},delete tt.itemFiles,delete tt.iconFiles,d[v].push(tt);const it=b.prefix.replace(/^\//,""),nt=it.trimEnd().endsWith("/")?"":it.split("/").pop()||"",lt=it.replace(nt,"").trimEnd().replace(/\/$/,""),ut={};let ht=!1;for(let bt=0;bt<b.items.length;bt++){const xt=b.items[bt],St=b.itemFiles[bt],wt=b.iconFiles[bt],Pt=b.icons[bt];St?(ut[nt+xt]=new Uint8Array(await St.arrayBuffer()),wt&&!Pt&&((o=this._viewer)===null||o===void 0||o.console.error("Icon file without icon name")),wt&&Pt&&(ut[nt+Pt]=new Uint8Array(await wt.arrayBuffer())),ht=!0):wt&&alert("Icon file without model/material file not supported")}if(!ht)continue;_=!0;const _t=lt.split("/");let ft=c[v];for(const bt of _t){ft[bt]||(ft[bt]={});const xt=ft[bt];if(typeof xt!="object")throw new Error("Invalid prefix: "+b.prefix);ft=xt}Object.assign(ft,ut)}return _||(c=void 0),{folder:c,config:d}}}VariationConfiguratorPlugin.PluginType="VariationConfiguratorPlugin";class VariationConfiguratorGridUiPlugin extends VariationConfiguratorPlugin{constructor(){super(),this._uiNeedRefresh=!1,this._refreshUi=this._refreshUi.bind(this)}async onAdded(o){await super.onAdded(o),o.addEventListener("preFrame",this._refreshUi)}async onRemove(o){return o.removeEventListener("preFrame",this._refreshUi),super.onRemove(o)}refreshUi(){this.enabled&&(this._uiNeedRefresh=!0)}async _refreshUi(){if(!this.enabled||!this._viewer||!this._uiNeedRefresh)return!1;this._uiNeedRefresh=!1,CustomContextGrid.RemoveAll(VariationConfiguratorGridUiPlugin.PluginType);for(const o of["objects","materials"])for(const c of this.variations[o])CustomContextGrid.Create(VariationConfiguratorGridUiPlugin.PluginType,this.utils.getTitle(c),5,20,0,c.items.map((d,_)=>({id:d,image:this.utils.getItemIcon(c,_,o),onClick:async v=>this.applyVariation(c,v,o,!1),tooltip:this.utils.getItemTitle(c,_)})),(d,_)=>tippy_esm(d,{placement:"bottom",content:_.tooltip}));return CustomContextGrid.RebuildUi(this._viewer.container),!0}}VariationConfiguratorGridUiPlugin.PluginType="VariationConfiguratorPlugin";class VariationConfiguratorEditorUiPlugin extends VariationConfiguratorGridUiPlugin{constructor(){super(...arguments),this._uiExpandedState={},this.uiConfig={type:"folder",label:"Configurator",children:[{type:"input",label:"Base URL",property:[this,"baseUrl"]},...this._ty.map(o=>({type:"folder",expanded:this._uiExpandedState["__/"+o],onExpand:()=>this._uiExpandedState["__/"+o]=!0,onCollapse:()=>this._uiExpandedState["__/"+o]=!1,label:o,children:[()=>this.variations[o].map(c=>({type:"folder",expanded:this._uiExpandedState[c.name],onExpand:()=>this._uiExpandedState[c.name]=!0,onCollapse:()=>this._uiExpandedState[c.name]=!1,label:()=>this.utils.getName(c),children:[{type:"input",placeholder:()=>this.utils.getName(c),property:[c,"name"]},{type:"input",property:[c,"prefix"]},{type:"input",placeholder:()=>this.utils.pathToTitle(this.utils.getName(c)),property:[c,"title"]},{type:"input",placeholder:()=>this.utils.pathToIcon(this.baseUrl+c.prefix),property:[c,"icon"]},{type:"folder",label:"items",children:c.items.map((d,_)=>({type:"folder",label:()=>c.items[_],children:[{type:"input",label:"File/URL",isMonitor:!c.itemFiles[_],getValue:()=>c.items[_],setValue:v=>{c.items[_]=v}},{type:"input",label:"Icon/Image",placeholder:this.utils.pathToIcon(c.items[_]),getValue:()=>c.icons[_],setValue:v=>{c.icons[_]=v}},{type:"input",label:"Title",placeholder:this.utils.pathToTitle(c.items[_]),getValue:()=>c.titles[_],setValue:v=>{c.titles[_]=v}},{type:"button",label:"Apply",value:async()=>this.applyVariation(c,_,o)},c.itemFiles[_]?[{type:"button",label:"Remove",value:()=>{c.items.splice(_,1),c.itemFiles.splice(_,1),this.refreshUi()}},{type:"button",label:"Replace",value:async()=>{const v=await ge$1(!1,!1);v.length!==0&&(c.itemFiles[_]=v[0],c.items[_]=v[0].name,this.refreshUi())}},{type:"button",label:"Download",value:async()=>{const v=c.itemFiles[_];N$2(v,v.name)}}]:{}]}))},{type:"button",label:"Add item (local)",value:async()=>{var d,_,v;const b=await ge$1(!0,!1);if(b.length!==0){for(const tt of b){if(!this._extForType[o].includes((d=tt.name.split(".").pop())!==null&&d!==void 0?d:"")){await((_=this._viewer)===null||_===void 0?void 0:_.alert(`Invalid file: ${tt.name} is not a valid ${o} file`));continue}if(c.items.includes(tt.name)){await((v=this._viewer)===null||v===void 0?void 0:v.alert(`Already exists: Item with name ${tt.name} already exists`));continue}const it=c.items.push(tt.name)-1;c.icons[it]="",c.titles[it]="",c.itemFiles[it]=tt}this.refreshUi()}}},{type:"button",label:"Add item (url)",value:async()=>{var d,_,v,b,tt;const it=await((d=this._viewer)===null||d===void 0?void 0:d.prompt("URL: Enter the url of the object/material"));if(!it)return;if(!it.startsWith("http")&&!this.baseUrl.startsWith("http"))return void await((_=this._viewer)===null||_===void 0?void 0:_.alert(`Invalid url: ${it} should be a valid HTTP(S) url. If you are passing a relative path, set the baseURL first`));if(!this._extForType[o].includes((v=it.split(".").pop())!==null&&v!==void 0?v:""))return void await((b=this._viewer)===null||b===void 0?void 0:b.alert(`Invalid url: ${it} should be of a material ending with mat`));c.items.includes(it)&&await((tt=this._viewer)===null||tt===void 0?void 0:tt.alert(`Already exists: Item with url ${it} already exists`)),c.items.push(it);const nt=c.items.length-1;c.icons[nt]="",c.titles[nt]="",this.refreshUi()}},{type:"button",label:()=>"Remove "+this.utils.getName(c),value:async()=>{var d;await((d=this._viewer)===null||d===void 0?void 0:d.confirm(`Delete Group: Are you sure you want to remove ${this.utils.getName(c)}?`))&&(this.variations[o].splice(this.variations[o].indexOf(c),1),this.refreshUi())}}]})),{type:"button",label:`Add ${o} group (empty)`,value:async()=>{var c;const d=await((c=this._viewer)===null||c===void 0?void 0:c.prompt("Name: Enter the name of the object/material"));d&&(this.variations[o].push({items:[],itemFiles:[],icons:[],iconFiles:[],titles:[],prefix:d+"/",name:d,icon:"",title:""}),this.refreshUi())}},{type:"button",label:`Add ${o} group (local folder)`,value:async()=>{var c,d,_,v;const b=await ge$1(!1,!0);if(b.length===0)return;const tt=[],it=[],nt=[],lt=[];for(const bt of b){if(bt.name.startsWith("."))continue;const xt=(c=bt.name.split(".").pop())!==null&&c!==void 0?c:"";xt?this._extForType[o].includes(xt)?(tt.push(bt.webkitRelativePath.replace(/^\//,"")),it.push(bt)):this._extForType.images.includes(xt)?(nt.push(bt.webkitRelativePath.replace(/^\//,"")),lt.push(bt)):await((_=this._viewer)===null||_===void 0?void 0:_.alert(`Invalid file: ${bt.name} is not a valid ${o} file`)):await((d=this._viewer)===null||d===void 0?void 0:d.alert(`Invalid file: ${bt.name} has no extension`))}const ut=he$1(tt),ht=this.utils.getName({prefix:ut});let _t=await((v=this._viewer)===null||v===void 0?void 0:v.prompt("Name: Enter the name of the object/material",ht,!0));if(_t===null)return;_t=_t||ht;const ft=tt.map(bt=>{var xt;const St=bt.replace(ut,""),wt=(xt=St.split(".").pop())!==null&&xt!==void 0?xt:"",Pt=St.replace("."+wt,"")+".",Rt=nt.findIndex(kt=>kt.replace(ut,"").startsWith(Pt));return Rt<0?["",void 0]:[nt[Rt].replace(ut,""),lt[Rt]||void 0]});this.variations[o].push({items:tt.map(bt=>bt.replace(ut,"")),icons:ft.map(bt=>bt[0]),iconFiles:ft.map(bt=>bt[1]),titles:tt.map(()=>""),itemFiles:it,prefix:ut,name:_t,icon:"",title:""}),this.refreshUi()}}]})),{type:"button",label:"Download JSON/Zip",value:async()=>{var o,c;try{const{folder:d,config:_}=await this._exportConfiguratorState(),v=JSON.stringify(_,null,4);if(d){d["config.json"]=strToU8(v);const b=await zipSync(d);N$2(new Blob([b],{type:"application/zip"}),"configurator.zip")}else N$2(new Blob([v],{type:"application/json"}),"config.json")}catch(d){return(o=this._viewer)===null||o===void 0||o.console.error(d),void await((c=this._viewer)===null||c===void 0?void 0:c.alert("Error: "+((d==null?void 0:d.message)||d)))}}},{type:"button",label:"Load JSON/Zip",value:async()=>{var o,c,d;const _=await ge$1(!1,!1,"application/zip,application/json");if(_.length===0)return;const v=_[0];if(v.name.endsWith(".zip")){const b=unzipSync(new Uint8Array(await v.arrayBuffer()));if(!b["config.json"])return void await((o=this._viewer)===null||o===void 0?void 0:o.alert("Invalid zip: config.json not found"));const tt=JSON.parse(strFromU8(b["config.json"]));this.importConfig(tt,b)}else{if(!v.name.endsWith(".json"))return void await((c=this._viewer)===null||c===void 0?void 0:c.alert("Invalid file: "+v.name));{const b=JSON.parse(await v.text());this.importConfig(b)}}await((d=this._viewer)===null||d===void 0?void 0:d.alert("Imported successfully")),this.refreshUi()}},{type:"button",label:"Import Path",value:async()=>{var o,c;const d=await((o=this._viewer)===null||o===void 0?void 0:o.prompt("URL: Enter the url of the json file."));d&&(await this.importPath(d),await((c=this._viewer)===null||c===void 0?void 0:c.alert("Imported successfully")),this.refreshUi())}},{type:"button",label:"Refresh UI",value:()=>{this.refreshUi()}},{type:"button",label:"Clear All",value:async()=>{var o;await((o=this._viewer)===null||o===void 0?void 0:o.confirm("Clear: Are you sure you want to clear the configuration ?"))&&(this.variations.objects=[],this.variations.materials=[],this.refreshUi())}}]}}_refreshUiConfig(){var o,c;(c=(o=this.uiConfig)===null||o===void 0?void 0:o.uiRefresh)===null||c===void 0||c.call(o,"postFrame",!0)}refreshUi(){this._refreshUiConfig(),super.refreshUi()}async _loadObject(o,c){const d=await super._loadObject(o,c);for(const _ of d)(_.modelObject||_).userData.excludeFromExport=!0;return d}}VariationConfiguratorEditorUiPlugin.PluginType="VariationConfiguratorPlugin";class TransformAnimationPlugin extends AViewerPlugin{constructor(){super(),this.toJSON=void 0,this.enabled=!0,this._addSceneObject=o=>{const c=o.object;c!=null&&c.traverse&&c.traverse(d=>{var _,v;if(d.isWidget)return;d.userData[TransformAnimationPlugin.PluginType]===void 0&&(d.userData[TransformAnimationPlugin.PluginType]={transforms:[]});const b={type:"folder",label:"Transform Animation",children:[{type:"button",label:"Add Current Transform",value:()=>{var tt;this.addTransform(d),(tt=b==null?void 0:b.uiRefresh)===null||tt===void 0||tt.call(b)}},()=>{var tt;return(tt=d.userData[TransformAnimationPlugin.PluginType])===null||tt===void 0?void 0:tt.transforms.map((it,nt)=>({type:"folder",label:`Transform ${nt}`,children:[{type:"vec3",label:"Position",property:[it,"position"]},{type:"vec3",label:"Quaternion",property:[it,"quaternion"]},{type:"vec3",label:"Scale",property:[it,"scale"]},{type:"button",label:"Set",value:()=>{this.setTransform(d,it)}},{type:"button",label:"Animate",value:()=>{this.animateTransform(d,it)}}]}))}]};(v=(_=d.uiConfig)===null||_===void 0?void 0:_.children)===null||v===void 0||v.push(b)})}}async onAdded(o){await super.onAdded(o),o.scene.addEventListener("addSceneObject",this._addSceneObject)}async onRemove(o){return o.scene.removeEventListener("addSceneObject",this._addSceneObject),super.onRemove(o)}addTransform(o){o.userData[TransformAnimationPlugin.PluginType].transforms.push({position:o.position.clone(),quaternion:o.quaternion.clone(),scale:o.scale.clone()})}setTransform(o,c){var d,_,v,b;o.position.copy(c.position),o.quaternion.copy(c.quaternion),o.scale.copy(c.scale),(_=(d=o.userData).setDirty)===null||_===void 0||_.call(d),(b=(v=o.uiConfig)===null||v===void 0?void 0:v.uiRefresh)===null||b===void 0||b.call(v)}animateTransform(o,c,d=2e3){var _,v;const b=(_=this._viewer)===null||_===void 0?void 0:_.getPluginByType("PopmotionPlugin");b||(v=this._viewer)===null||v===void 0||v.console.error("PopmotionPlugin required for animation");const tt=typeof c=="number"?o.userData[TransformAnimationPlugin.PluginType].transforms[c]:c,it=new three_module.Pq0,nt=new three_module.PTz,lt=new three_module.Pq0,ut=o.position.clone(),ht=o.quaternion.clone(),_t=o.scale.clone(),ft=tt.position,bt=tt.quaternion,xt=tt.scale;return b==null?void 0:b.animate({from:0,to:1,duration:d,onUpdate:St=>{var wt,Pt;it.lerpVectors(ut,ft,St),nt.slerpQuaternions(ht,bt,St),lt.lerpVectors(_t,xt,St),o.position.copy(it),o.quaternion.copy(nt),o.scale.copy(lt),(wt=this._viewer)===null||wt===void 0||wt.setDirty(),(Pt=this._viewer)===null||Pt===void 0||Pt.renderer.resetShadows()},onStop:()=>{var St,wt,Pt,Rt;o.position.copy(tt.position),o.quaternion.copy(tt.quaternion),o.scale.copy(tt.scale),(wt=(St=o.userData).setDirty)===null||wt===void 0||wt.call(St),(Rt=(Pt=o.uiConfig)===null||Pt===void 0?void 0:Pt.uiRefresh)===null||Rt===void 0||Rt.call(Pt)}})}}TransformAnimationPlugin.PluginType="TransformAnimationPlugin";var VirtualCamerasPlugin_decorate=function(h,o,c,d){var _,v=arguments.length,b=v<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(h,o,c,d);else for(var tt=h.length-1;tt>=0;tt--)(_=h[tt])&&(b=(v<3?_(b):v>3?_(o,c,b):_(o,c))||b);return v>3&&b&&Object.defineProperty(o,c,b),b};let VirtualCamerasPlugin=class extends AViewerPlugin{constructor(h=!0){super(),this.enabled=!0,this.toJSON=void 0,this.cameras=[],this._preRender=()=>{if(this.enabled&&this._viewer)for(const o of this.cameras){if(!o.enabled)continue;const c=this._viewer,d=o.camera;try{this.dispatchEvent({type:"preRenderCamera",camera:o}),c.scene.renderCamera=d,c.renderer.render(!1);const _=c.renderer.composer.readBuffer;this.dispatchEvent({type:"preBlitCamera",camera:o,readBuffer:_}),c.renderer.blit(_.texture,o.target),this.dispatchEvent({type:"postRenderCamera",camera:o})}catch(_){console.error(_),o.enabled=!1}}},this.enabled=h}async onAdded(h){await super.onAdded(h),h.addEventListener("preRender",this._preRender)}addCamera(h){if(!this._viewer)throw"Plugin not added to viewer";const o={camera:h,target:this._viewer.renderer.composerTarget.clone(!0),enabled:!0};return this.cameras.push(o),o}};function updateAttribute(h,o,c,d,_){const v=h.getAttribute(o),b=d.length/c;return v&&v.count===b?(v.set(d),v.needsUpdate=!0):h.setAttribute(o,new three_module.qtW(d,c)),v}function updateIndices(h,o){const c=h.index;c&&c.count===o.length?(c.set(o),c.needsUpdate=!0):h.setIndex(o)}function updateUi(h,o){var c,d,_;if(!h.uiConfig)return;let v=(c=h.uiConfig.children)===null||c===void 0?void 0:c.find(b=>{var tt;return(tt=b.tags)===null||tt===void 0?void 0:tt.includes("generatedGeometry")});v||(v={type:"folder",label:"Generation Params",tags:["generatedGeometry"],children:[]},(d=h.uiConfig.children)===null||d===void 0||d.push(v)),h.userData.__generationParamsUiType!==h.userData.generationParams.type&&(v.children=o(),h.userData.__generationParamsUiType=h.userData.generationParams.type,(_=v.uiRefresh)===null||_===void 0||_.call(v,"postFrame",!0))}VirtualCamerasPlugin.PluginType="VirtualCamerasPlugin",VirtualCamerasPlugin_decorate([uiToggle()],VirtualCamerasPlugin.prototype,"enabled",void 0),VirtualCamerasPlugin=VirtualCamerasPlugin_decorate([uiFolder("Virtual Cameras")],VirtualCamerasPlugin);class AGeometryGenerator{constructor(o){this.type=o}createUiConfig(o){const c=generateUiConfig(o.userData.generationParams).filter(d=>{var _;return((_=Ee$1(d.property))===null||_===void 0?void 0:_[1])!=="type"});return c.forEach(d=>{d.onChange=()=>this.generate(o)}),c}generate(o,c={}){const d=o??new three_module.LoY;if(d.userData.generationParams||(d.userData.generationParams={type:this.type}),d.userData.generationParams.type=this.type,c.type)return console.error("Cannot set type parameter here, use the plugin instead"),d;const _={...this.defaultParams,...d.userData.generationParams,...c},{indices:v,vertices:b,normals:tt,uvs:it,groups:nt}=this._generateData(_);if(updateIndices(d,v),updateAttribute(d,"position",3,b),updateAttribute(d,"normal",3,tt),updateAttribute(d,"uv",2,it),nt){d.clearGroups();for(const lt of nt)d.addGroup(lt.start,lt.count,lt.materialIndex)}return d.computeBoundingBox(),d.computeBoundingSphere(),Object.assign(d.userData.generationParams,_),updateUi(d,()=>this.createUiConfig(d)),d.dispatchEvent({type:"geometryUpdate"}),d}}class SphereGeometryGenerator extends AGeometryGenerator{constructor(){super(...arguments),this.defaultParams={radius:1,widthSegments:32,heightSegments:16,phiStart:0,phiLength:2*Math.PI,thetaStart:0,thetaLength:Math.PI}}_generateData(o){const{radius:c,phiStart:d,phiLength:_,thetaStart:v,thetaLength:b}=o;let{widthSegments:tt,heightSegments:it}=o;tt=Math.max(3,Math.floor(tt)),it=Math.max(2,Math.floor(it));const nt=Math.min(v+b,Math.PI);let lt=0;const ut=[],ht=new three_module.Pq0,_t=new three_module.Pq0,ft=[],bt=[],xt=[],St=[];for(let wt=0;wt<=it;wt++){const Pt=[],Rt=wt/it;let kt=0;wt===0&&v===0?kt=.5/tt:wt===it&&nt===Math.PI&&(kt=-.5/tt);for(let Gt=0;Gt<=tt;Gt++){const Dt=Gt/tt;ht.x=-c*Math.cos(d+Dt*_)*Math.sin(v+Rt*b),ht.y=c*Math.cos(v+Rt*b),ht.z=c*Math.sin(d+Dt*_)*Math.sin(v+Rt*b),bt.push(ht.x,ht.y,ht.z),_t.copy(ht).normalize(),xt.push(_t.x,_t.y,_t.z),St.push(Dt+kt,1-Rt),Pt.push(lt++)}ut.push(Pt)}for(let wt=0;wt<it;wt++)for(let Pt=0;Pt<tt;Pt++){const Rt=ut[wt][Pt+1],kt=ut[wt][Pt],Gt=ut[wt+1][Pt],Dt=ut[wt+1][Pt+1];(wt!==0||v>0)&&ft.push(Rt,kt,Dt),(wt!==it-1||nt<Math.PI)&&ft.push(kt,Gt,Dt)}return{indices:ft,vertices:bt,normals:xt,uvs:St}}}class PlaneGeometryGenerator extends AGeometryGenerator{constructor(){super(...arguments),this.defaultParams={width:1,height:1,widthSegments:2,heightSegments:2}}_generateData(o){const c=o.width/2,d=o.height/2,_=Math.floor(o.widthSegments),v=Math.floor(o.heightSegments),b=_+1,tt=v+1,it=o.width/_,nt=o.height/v,lt=[],ut=[],ht=[],_t=[];for(let ft=0;ft<tt;ft++){const bt=ft*nt-d;for(let xt=0;xt<b;xt++){const St=xt*it-c;ut.push(St,-bt,0),ht.push(0,0,1),_t.push(xt/_),_t.push(1-ft/v)}}for(let ft=0;ft<v;ft++)for(let bt=0;bt<_;bt++){const xt=bt+b*ft,St=bt+b*(ft+1),wt=bt+1+b*(ft+1),Pt=bt+1+b*ft;lt.push(xt,St,Pt),lt.push(St,wt,Pt)}return{indices:lt,vertices:ut,normals:ht,uvs:_t}}}class CircleGeometryGenerator extends AGeometryGenerator{constructor(){super(...arguments),this.defaultParams={radius:1,segments:32,thetaStart:0,thetaLength:2*Math.PI}}_generateData(o){const{radius:c,thetaStart:d,thetaLength:_}=o,v=Math.max(3,o.segments),b=[],tt=[],it=[],nt=[],lt=new three_module.Pq0,ut=new three_module.I9Y;tt.push(0,0,0),it.push(0,0,1),nt.push(.5,.5);for(let ht=0,_t=3;ht<=v;ht++,_t+=3){const ft=d+ht/v*_;lt.x=c*Math.cos(ft),lt.y=c*Math.sin(ft),tt.push(lt.x,lt.y,lt.z),it.push(0,0,1),ut.x=(tt[_t]/c+1)/2,ut.y=(tt[_t+1]/c+1)/2,nt.push(ut.x,ut.y)}for(let ht=1;ht<=v;ht++)b.push(ht,ht+1,0);return{indices:b,vertices:tt,normals:it,uvs:nt}}}class TorusGeometryGenerator extends AGeometryGenerator{constructor(){super(...arguments),this.defaultParams={radius:1,tube:.4,radialSegments:12,tubularSegments:48,arc:2*Math.PI}}_generateData(o){const{radius:c,tube:d,arc:_}=o;let{radialSegments:v,tubularSegments:b}=o;v=Math.floor(v),b=Math.floor(b);const tt=[],it=[],nt=[],lt=[],ut=new three_module.Pq0,ht=new three_module.Pq0,_t=new three_module.Pq0;for(let ft=0;ft<=v;ft++)for(let bt=0;bt<=b;bt++){const xt=bt/b*_,St=ft/v*Math.PI*2;ht.x=(c+d*Math.cos(St))*Math.cos(xt),ht.y=(c+d*Math.cos(St))*Math.sin(xt),ht.z=d*Math.sin(St),it.push(ht.x,ht.y,ht.z),ut.x=c*Math.cos(xt),ut.y=c*Math.sin(xt),_t.subVectors(ht,ut).normalize(),nt.push(_t.x,_t.y,_t.z),lt.push(bt/b),lt.push(ft/v)}for(let ft=1;ft<=v;ft++)for(let bt=1;bt<=b;bt++){const xt=(b+1)*ft+bt-1,St=(b+1)*(ft-1)+bt-1,wt=(b+1)*(ft-1)+bt,Pt=(b+1)*ft+bt;tt.push(xt,St,Pt),tt.push(St,wt,Pt)}return{indices:tt,vertices:it,normals:nt,uvs:lt}}}class CylinderGeometryGenerator extends AGeometryGenerator{constructor(){super(...arguments),this.defaultParams={radiusTop:1,radiusBottom:1,height:1,radialSegments:32,heightSegments:1,openEnded:!1,thetaStart:0,thetaLength:2*Math.PI}}_generateTorso(o){const{radiusTop:c,radiusBottom:d,height:_,radialSegments:v,heightSegments:b,thetaStart:tt,thetaLength:it,indexArray:nt,indices:lt,groups:ut,vertices:ht,normals:_t,uvs:ft,groupStart:bt,halfHeight:xt}=o,St=new three_module.Pq0,wt=new three_module.Pq0;let Pt=0;const Rt=(d-c)/_;for(let kt=0;kt<=b;kt++){const Gt=[],Dt=kt/b,It=Dt*(d-c)+c;for(let Nt=0;Nt<=v;Nt++){const Vt=Nt/v,Kt=Vt*it+tt,Yt=Math.sin(Kt),nr=Math.cos(Kt);wt.x=It*Yt,wt.y=-Dt*_+xt,wt.z=It*nr,ht.push(wt.x,wt.y,wt.z),St.set(Yt,Rt,nr).normalize(),_t.push(St.x,St.y,St.z),ft.push(Vt,1-Dt),Gt.push(o.index++)}nt.push(Gt)}for(let kt=0;kt<v;kt++)for(let Gt=0;Gt<b;Gt++){const Dt=nt[Gt][kt],It=nt[Gt+1][kt],Nt=nt[Gt+1][kt+1],Vt=nt[Gt][kt+1];lt.push(Dt,It,Vt),lt.push(It,Nt,Vt),Pt+=6}ut.push({start:bt,count:Pt,materialIndex:0}),o.groupStart+=Pt}_generateCap(o,c){const{radiusTop:d,radiusBottom:_,radialSegments:v,thetaStart:b,thetaLength:tt,indices:it,groups:nt,vertices:lt,normals:ut,uvs:ht,groupStart:_t,halfHeight:ft}=o,bt=o.index,xt=new three_module.I9Y,St=new three_module.Pq0;let wt=0;const Pt=c===!0?d:_,Rt=c===!0?1:-1;for(let Gt=1;Gt<=v;Gt++)lt.push(0,ft*Rt,0),ut.push(0,Rt,0),ht.push(.5,.5),o.index++;const kt=o.index;for(let Gt=0;Gt<=v;Gt++){const Dt=Gt/v*tt+b,It=Math.cos(Dt),Nt=Math.sin(Dt);St.x=Pt*Nt,St.y=ft*Rt,St.z=Pt*It,lt.push(St.x,St.y,St.z),ut.push(0,Rt,0),xt.x=.5*It+.5,xt.y=.5*Nt*Rt+.5,ht.push(xt.x,xt.y),o.index++}for(let Gt=0;Gt<v;Gt++){const Dt=bt+Gt,It=kt+Gt;c===!0?it.push(It,It+1,Dt):it.push(It+1,It,Dt),wt+=3}nt.push({start:_t,count:wt,materialIndex:c===!0?1:2}),o.groupStart+=wt}_generateData(o){let{radialSegments:c,heightSegments:d}=o;c=Math.floor(c),d=Math.floor(d);const _={indices:[],vertices:[],normals:[],uvs:[],numberOfVertices:0,groupStart:0,groups:[],index:0,indexArray:[],halfHeight:o.height/2,...o,radialSegments:c,heightSegments:d};return this._generateTorso(_),o.openEnded===!1&&(o.radiusTop>0&&this._generateCap(_,!0),o.radiusBottom>0&&this._generateCap(_,!1)),_}}class BoxGeometryGenerator extends AGeometryGenerator{constructor(){super(...arguments),this.defaultParams={width:1,height:1,depth:1,widthSegments:1,heightSegments:1,depthSegments:1}}_buildPlane(o,c,d,_,v,b,tt,it,nt,lt,ut,ht){const{indices:_t,vertices:ft,normals:bt,uvs:xt,numberOfVertices:St,groupStart:wt,groups:Pt}=o,Rt=tt/lt,kt=it/ut,Gt=tt/2,Dt=it/2,It=nt/2,Nt=lt+1,Vt=ut+1;let Kt=0,Yt=0;const nr=new three_module.Pq0;for(let rr=0;rr<Vt;rr++){const lr=rr*kt-Dt;for(let or=0;or<Nt;or++){const pr=or*Rt-Gt;nr[c]=pr*v,nr[d]=lr*b,nr[_]=It,ft.push(nr.x,nr.y,nr.z),nr[c]=0,nr[d]=0,nr[_]=nt>0?1:-1,bt.push(nr.x,nr.y,nr.z),xt.push(or/lt),xt.push(1-rr/ut),Kt+=1}}for(let rr=0;rr<ut;rr++)for(let lr=0;lr<lt;lr++){const or=St+lr+Nt*rr,pr=St+lr+Nt*(rr+1),hr=St+(lr+1)+Nt*(rr+1),ur=St+(lr+1)+Nt*rr;_t.push(or,pr,ur),_t.push(pr,hr,ur),Yt+=6}Pt.push({start:wt,count:Yt,materialIndex:ht}),o.groupStart+=Yt,o.numberOfVertices+=Kt}_generateData(o){const{width:c,height:d,depth:_}=o;let{widthSegments:v,heightSegments:b,depthSegments:tt}=o;v=Math.floor(v),b=Math.floor(b),tt=Math.floor(tt);const it={indices:[],vertices:[],normals:[],uvs:[],numberOfVertices:0,groupStart:0,groups:[]};return this._buildPlane(it,"z","y","x",-1,-1,_,d,c,tt,b,0),this._buildPlane(it,"z","y","x",1,-1,_,d,-c,tt,b,1),this._buildPlane(it,"x","z","y",1,1,c,_,d,v,tt,2),this._buildPlane(it,"x","z","y",1,-1,c,_,-d,v,tt,3),this._buildPlane(it,"x","y","z",1,-1,c,d,_,v,b,4),this._buildPlane(it,"x","y","z",-1,-1,c,d,-_,v,b,5),it}}class GeometryGeneratorPlugin extends AViewerPlugin{constructor(){super(...arguments),this.enabled=!0,this.toJSON=void 0,this.generators={plane:new PlaneGeometryGenerator("plane"),sphere:new SphereGeometryGenerator("sphere"),box:new BoxGeometryGenerator("box"),circle:new CircleGeometryGenerator("circle"),torus:new TorusGeometryGenerator("torus"),cylinder:new CylinderGeometryGenerator("cylinder")},this._sceneUpdate=o=>{var c;if(o.hierarchyChanged){const d=o.object||((c=this._viewer)===null||c===void 0?void 0:c.scene.modelRoot);d&&d.traverse(_=>{var v,b,tt;const it=(tt=(b=(v=_.geometry)===null||v===void 0?void 0:v.userData)===null||b===void 0?void 0:b.generationParams)===null||tt===void 0?void 0:tt.type;it&&updateUi(_.geometry,()=>{var nt;const lt=this.generators[it];return lt!=null&&lt.createUiConfig&&(nt=lt.createUiConfig(_.geometry))!==null&&nt!==void 0?nt:[]})})}},this.uiConfig={type:"folder",label:"Generate Geometry",children:[()=>Object.keys(this.generators).map(o=>({type:"button",label:"Generate "+o,value:async()=>{(await this.generateObject(o)).name=o}}))]}}async generateObject(o){var c,d;const _=this.generators[o];if(!_)throw new Error("Unknown generator type: "+o);const v=await((d=(c=this._viewer)===null||c===void 0?void 0:c.getManager())===null||d===void 0?void 0:d.addImportedSingle(new three_module.eaF(new three_module.LoY,new MeshStandardMaterial2({color:16711680})),{autoScale:!1,autoCenter:!1}));return _.generate(v.modelObject.geometry),v.name=o,v.geometry.name="Generated "+o,v.modelObject}async onAdded(o){await super.onAdded(o),o.scene.addEventListener("sceneUpdate",this._sceneUpdate)}}GeometryGeneratorPlugin.PluginType="GeometryGeneratorPlugin";var MaterialPresetPlugin_decorate=function(h,o,c,d){var _,v=arguments.length,b=v<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(h,o,c,d);else for(var tt=h.length-1;tt>=0;tt--)(_=h[tt])&&(b=(v<3?_(b):v>3?_(o,c,b):_(o,c))||b);return v>3&&b&&Object.defineProperty(o,c,b),b};let MaterialPresetPlugin$1=class extends AViewerPlugin{constructor(){super(...arguments),this.serializeWithViewer=!1,this.enabled=!0,this.mapping=[],this.presets={},this.getMaterialPresetByName=h=>this.presets&&this.presets.length!=0?this.presets[h.type].find(o=>o.path.split("/").pop()==h.name):null,this.applyOnLoad=!0,this.replaceMaterial=!0}async onAdded(h){await super.onAdded(h)}loadPresets(h,o){this.presets=h,this.basePath=o,this.dispatchEvent({type:"loadPresets"})}async fromJSON(h,o){return h&&h.materials&&!h.mapping&&(h.mapping=h.materials,delete h.materials),super.fromJSON(h,o)?(this.applyOnLoad&&await this.applyAll(),this):null}async applyAll(){var h;const o=[];for(const c of this.mapping)o.push(this._apply(c.name,c.path,(h=c.regex)===null||h===void 0||h));await Promise.all(o)}async _apply(h,o,c=!0){var d,_,v,b,tt;const it=(d=this._viewer)===null||d===void 0?void 0:d.getManager();if(!o||!h||!it)return;o=(_=(o=(o!=null&&o.startsWith("https://")?"":this.basePath||"")+o)==null?void 0:o.replace)===null||_===void 0?void 0:_.call(o,/(https?:\/\/)|(\/)+/g,(ut,ht)=>ht||"/");let nt=await((v=it.importer)===null||v===void 0?void 0:v.importSinglePath(o));if(!nt)return void console.warn("MaterialPresetPlugin: Material not found",o);this.replaceMaterial&&(nt=nt.clone?nt.clone():nt),nt.name=h;const lt=new Set;(tt=(b=this._viewer)===null||b===void 0?void 0:b.scene)===null||tt===void 0||tt.traverse(ut=>{ut.material&&(c?ut.material.name.match("^"+h+"$"):ut.material.name===h)&&lt.add(ut)}),lt.forEach(ut=>{var ht,_t,ft;if(this.replaceMaterial||!ut.material){const bt=((ht=ut.material)===null||ht===void 0?void 0:ht.name)||ut.name;(_t=ut==null?void 0:ut.setMaterial)===null||_t===void 0||_t.call(ut,nt),ut.material.name=bt}else{const bt=Array.isArray(ut.material)?ut.material:[ut.material];for(const xt of bt)(ft=it.materials)===null||ft===void 0||ft.copyMaterialProps(xt,nt)}})}async addMapping(h,o,c=!0){if(!h||!o)return;const d=this.mapping.findIndex(_=>_.name===h);return d!==-1?this.mapping[d]={name:h,path:o}:this.mapping.push({name:h,path:o}),c?this._apply(h,o):void 0}};MaterialPresetPlugin$1.PluginType="MaterialPresetPlugin",MaterialPresetPlugin_decorate([serialize()],MaterialPresetPlugin$1.prototype,"mapping",void 0);var TransfrSharePlugin_decorate=function(h,o,c,d){var _,v=arguments.length,b=v<3?o:d===null?d=Object.getOwnPropertyDescriptor(o,c):d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(h,o,c,d);else for(var tt=h.length-1;tt>=0;tt--)(_=h[tt])&&(b=(v<3?_(b):v>3?_(o,c,b):_(o,c))||b);return v>3&&b&&Object.defineProperty(o,c,b),b};let TransfrSharePlugin=class extends AViewerPlugin{constructor(){super(...arguments),this.toJSON=null,this.enabled=!0,this.dependencies=[AssetExporterPlugin],this._exporting=!1}async exportObject(h){var o,c;const d=(o=this._viewer)===null||o===void 0?void 0:o.getPlugin(AssetExporterPlugin);if(!d)throw new Error("AssetExporterPlugin not found");return h?(c=d.exporter)===null||c===void 0?void 0:c.exportObject(h,{format:"glb"}):d.exportScene(d.exportOptions)}async getLink(h){var o;const c=await this.exportObject(h);if(!c)throw new Error("Failed to export object or scene");const d=await fetch("https://bee.transfr.one/model.glb",{method:"PUT",body:c});if(d.status!==200)throw new Error("Failed to upload file");const _=(o=await d.text())===null||o===void 0?void 0:o.trim();console.log(_);try{new URL(_)}catch{throw new Error("Invalid URL "+_)}return _}async shareLink(h,o="m"){var c;if(this._exporting)return;this._exporting=!0;let d=await this.getLink().catch(_=>{var v,b;return(v=this._viewer)===null||v===void 0||v.console.error(_),(b=this._viewer)===null||b===void 0||b.alert(`Error: Failed to share scene: 
`+_.message),null});if(d){if(h){const v=typeof h=="string"?new URL(h):h;v.searchParams.set(o??"m",d),d=v.href}let _=!1;try{window&&window.navigator&&navigator.clipboard&&(await navigator.clipboard.writeText(d),_=!0)}catch(v){console.error("Failed to copy link",v)}(c=this._viewer)===null||c===void 0||c.alert("Link"+(_?" Copied: ":": "+d)+`

Note: File will be deleted in 7 days`)}return this._exporting=!1,d}async shareEditorLink(){const h=new URL(window.location.href);return this.shareLink(h)}async shareViewerLink(){const h=new URL(window.location.href);return h.pathname=h.pathname.replace(/editor\.html$/,"viewer.html"),this.shareLink(h)}};TransfrSharePlugin.PluginType="TransfrSharePlugin",TransfrSharePlugin_decorate([uiButton("Share editor link")],TransfrSharePlugin.prototype,"shareEditorLink",null),TransfrSharePlugin_decorate([uiButton("Share viewer link")],TransfrSharePlugin.prototype,"shareViewerLink",null),TransfrSharePlugin=TransfrSharePlugin_decorate([uiFolder("Share Link")],TransfrSharePlugin);var ndarray_ndarray=__webpackgi_require__(881),ndarray_ops=__webpackgi_require__(49);function getPixelsInternal(h,o){if(!(h instanceof Uint8Array))throw new Error("[ndarray-pixels] Input must be Uint8Array or Buffer.");const c=new Blob([h],{type:o}),d=URL.createObjectURL(c);return new Promise((_,v)=>{const b=new Image;b.crossOrigin="anonymous",b.onload=function(){URL.revokeObjectURL(d);const tt=new OffscreenCanvas(b.width,b.height).getContext("2d");tt.drawImage(b,0,0);const it=tt.getImageData(0,0,b.width,b.height);_(ndarray_ndarray(new Uint8Array(it.data),[b.width,b.height,4],[4,4*b.width,1],0))},b.onerror=tt=>{URL.revokeObjectURL(d),v(tt)},b.src=d})}function putPixelData(h,o,c=-1){if(h.shape.length===4)return putPixelData(h.pick(c),o,0);if(h.shape.length===3)if(h.shape[2]===3)ndarray_ops.assign(ndarray_ndarray(o,[h.shape[0],h.shape[1],3],[4,4*h.shape[0],1]),h),ndarray_ops.assigns(ndarray_ndarray(o,[h.shape[0]*h.shape[1]],[4],3),255);else if(h.shape[2]===4)ndarray_ops.assign(ndarray_ndarray(o,[h.shape[0],h.shape[1],4],[4,4*h.shape[0],1]),h);else{if(h.shape[2]!==1)throw new Error("[ndarray-pixels] Incompatible array shape.");ndarray_ops.assign(ndarray_ndarray(o,[h.shape[0],h.shape[1],3],[4,4*h.shape[0],1]),ndarray_ndarray(h.data,[h.shape[0],h.shape[1],3],[h.stride[0],h.stride[1],0],h.offset)),ndarray_ops.assigns(ndarray_ndarray(o,[h.shape[0]*h.shape[1]],[4],3),255)}else{if(h.shape.length!==2)throw new Error("[ndarray-pixels] Incompatible array shape.");ndarray_ops.assign(ndarray_ndarray(o,[h.shape[0],h.shape[1],3],[4,4*h.shape[0],1]),ndarray_ndarray(h.data,[h.shape[0],h.shape[1],3],[h.stride[0],h.stride[1],0],h.offset)),ndarray_ops.assigns(ndarray_ndarray(o,[h.shape[0]*h.shape[1]],[4],3),255)}return o}async function savePixelsInternal(h,o){const c=new OffscreenCanvas(h.shape[0],h.shape[1]),d=c.getContext("2d"),_=d.getImageData(0,0,c.width,c.height);return putPixelData(h,_.data),d.putImageData(_,0,0),streamCanvas(c,o)}async function streamCanvas(h,o){const c=await h.convertToBlob(o),d=await c.arrayBuffer();return new Uint8Array(d)}async function ndarray_pixels_browser_modern_getPixels(h,o){return getPixelsInternal(h,o)}async function ndarray_pixels_browser_modern_savePixels(h,o){let c;return c={type:o,quality:void 0},savePixelsInternal(h,c)}function functions_modern_extends(){return functions_modern_extends=Object.assign?Object.assign.bind():function(h){for(var o=1;o<arguments.length;o++){var c=arguments[o];for(var d in c)({}).hasOwnProperty.call(c,d)&&(h[d]=c[d])}return h},functions_modern_extends.apply(null,arguments)}index_modern_Primitive.Mode;function createTransform(h,o){return Object.defineProperty(o,"name",{value:h}),o}async function rewriteTexture(h,o,c){if(!h)return null;const d=h.getImage();if(!d)return null;const _=await ndarray_pixels_browser_modern_getPixels(d,h.getMimeType());for(let b=0;b<_.shape[0];++b)for(let tt=0;tt<_.shape[1];++tt)c(_,b,tt);const v=await ndarray_pixels_browser_modern_savePixels(_,"image/png");return o.setImage(v).setMimeType("image/png")}var functions_modern_ARRAY_TYPE=typeof Float32Array<"u"?Float32Array:Array;function create$1(){var h=new functions_modern_ARRAY_TYPE(3);return functions_modern_ARRAY_TYPE!=Float32Array&&(h[0]=0,h[1]=0,h[2]=0),h}Math.hypot||(Math.hypot=function(){for(var h=0,o=arguments.length;o--;)h+=arguments[o]*arguments[o];return Math.sqrt(h)});create$1();index_modern_PropertyType.ACCESSOR,index_modern_PropertyType.MESH,index_modern_PropertyType.TEXTURE,index_modern_PropertyType.MATERIAL,index_modern_PropertyType.SKIN;function functions_modern_create(){var h=new functions_modern_ARRAY_TYPE(4);return functions_modern_ARRAY_TYPE!=Float32Array&&(h[0]=0,h[1]=0,h[2]=0,h[3]=0),h}functions_modern_create();index_modern_PropertyType.NODE,index_modern_PropertyType.SKIN,index_modern_PropertyType.MESH,index_modern_PropertyType.CAMERA,index_modern_PropertyType.PRIMITIVE,index_modern_PropertyType.PRIMITIVE_TARGET,index_modern_PropertyType.ANIMATION,index_modern_PropertyType.MATERIAL,index_modern_PropertyType.TEXTURE,index_modern_PropertyType.ACCESSOR,index_modern_PropertyType.BUFFER;var VertexCountMethod;(function(h){h.RENDER="render",h.RENDER_CACHED="render-cached",h.UPLOAD="upload",h.UPLOAD_NAIVE="upload-naive",h.DISTINCT="distinct",h.DISTINCT_POSITION="distinct-position",h.UNUSED="unused"})(VertexCountMethod||(VertexCountMethod={}));index_modern_Accessor.ComponentType;index_modern_Primitive.Mode;index_modern_Primitive.Mode;index_modern_AnimationChannel.TargetPath;const QUANTIZE_DEFAULTS={pattern:/.*/,quantizationVolume:"mesh",quantizePosition:14,quantizeNormal:10,quantizeTexcoord:12,quantizeColor:8,quantizeWeight:8,quantizeGeneric:12,normalizeWeights:!0,cleanup:!0};functions_modern_extends({level:"high"},QUANTIZE_DEFAULTS);const functions_modern_NAME$d="metalRough",METALROUGH_DEFAULTS={};function metalRough(h=METALROUGH_DEFAULTS){return createTransform(functions_modern_NAME$d,async o=>{const c=o.getLogger();if(!o.getRoot().listExtensionsUsed().map(tt=>tt.extensionName).includes("KHR_materials_pbrSpecularGlossiness"))return void c.warn(`${functions_modern_NAME$d}: KHR_materials_pbrSpecularGlossiness not found on document.`);const d=o.createExtension(KHRMaterialsIOR),_=o.createExtension(KHRMaterialsSpecular),v=o.createExtension(KHRMaterialsPBRSpecularGlossiness),b=new Set;for(const tt of o.getRoot().listMaterials()){const it=tt.getExtension("KHR_materials_pbrSpecularGlossiness");if(!it)continue;const nt=_.createSpecular().setSpecularFactor(1).setSpecularColorFactor(it.getSpecularFactor());b.add(it.getSpecularGlossinessTexture()),b.add(tt.getBaseColorTexture()),b.add(tt.getMetallicRoughnessTexture()),tt.setBaseColorFactor(it.getDiffuseFactor()).setMetallicFactor(0).setRoughnessFactor(1).setExtension("KHR_materials_ior",d.createIOR().setIOR(1e3)).setExtension("KHR_materials_specular",nt);const lt=it.getDiffuseTexture();lt&&(tt.setBaseColorTexture(lt),tt.getBaseColorTextureInfo().copy(it.getDiffuseTextureInfo()));const ut=it.getSpecularGlossinessTexture();if(ut){const ht=it.getSpecularGlossinessTextureInfo(),_t=o.createTexture();await rewriteTexture(ut,_t,(xt,St,wt)=>{xt.set(St,wt,3,255)}),nt.setSpecularTexture(_t),nt.setSpecularColorTexture(_t),nt.getSpecularTextureInfo().copy(ht),nt.getSpecularColorTextureInfo().copy(ht);const ft=it.getGlossinessFactor(),bt=o.createTexture();await rewriteTexture(ut,bt,(xt,St,wt)=>{const Pt=255-Math.round(xt.get(St,wt,3)*ft);xt.set(St,wt,0,0),xt.set(St,wt,1,Pt),xt.set(St,wt,2,0),xt.set(St,wt,3,255)}),tt.setMetallicRoughnessTexture(bt),tt.getMetallicRoughnessTextureInfo().copy(ht)}else nt.setSpecularColorFactor(it.getSpecularFactor()),tt.setRoughnessFactor(1-it.getGlossinessFactor());tt.setExtension("KHR_materials_pbrSpecularGlossiness",null)}v.dispose();for(const tt of b)tt&&tt.listParents().length===1&&tt.dispose();c.debug(`${functions_modern_NAME$d}: Complete.`)})}var InterpolationInternal;(function(h){h[h.STEP=0]="STEP",h[h.LERP=1]="LERP",h[h.SLERP=2]="SLERP"})(InterpolationInternal||(InterpolationInternal={}));Promise.resolve();index_modern_Primitive.Mode;var TextureResizeFilter;(function(h){h.LANCZOS3="lanczos3",h.LANCZOS2="lanczos2"})(TextureResizeFilter||(TextureResizeFilter={}));TextureResizeFilter.LANCZOS3;const gltfKhrPbrSpecularGlossinessConverter=h=>o=>({name:"KHR_materials_pbrSpecularGlossiness",beforeRoot:async()=>{var c,d;try{if(!o.json.extensionsUsed.includes("KHR_materials_pbrSpecularGlossiness")||h&&!await h("Convert KHR_materials_pbrSpecularGlossiness to KHR_materials_pbrMetallicRoughness?"))return;const _=o.json,v=new WebIO().registerExtensions(ALL_EXTENSIONS).registerExtensions(ALL_WEBGI_EXTENSIONS);if(o.extensions.KHR_draco_mesh_compression){const nt=o.extensions.KHR_draco_mesh_compression.dracoLoader;if(!nt.isDRACOLoader2)return void console.error("DRACOLoader2 required for gltfKhrPbrSpecularGlossinessConverter");const lt=await nt.initDecoder();v.registerDependencies({"draco3d.decoder":lt})}const b=await v.readJSON({json:_,resources:{"@glb.bin":new Uint8Array((c=o.extensions.KHR_binary_glTF)===null||c===void 0?void 0:c.body)}});await b.transform(metalRough()),o.extensions.KHR_draco_mesh_compression&&((d=b.getRoot().listExtensionsUsed().find(nt=>nt.extensionName==="KHR_draco_mesh_compression"))===null||d===void 0||d.dispose());const tt=await v.writeBinary(b),it=new GLTFBinaryExtension(tt.buffer);o.extensions.KHR_binary_glTF=it,o.json=JSON.parse(it.content)}catch(_){return void console.error(_)}}});class GLTFSpecGlossinessConverterPlugin extends AViewerPlugin{_loaderCreate({loader:o}){o.isGLTFLoader2&&o.register(gltfKhrPbrSpecularGlossinessConverter(async c=>{var d,_;return!!this.enabled&&(!this.confirm||(_=(d=this._viewer)===null||d===void 0?void 0:d.confirm(this.confirmMessage||c))===null||_===void 0||_)}))}constructor(){super(),this.enabled=!0,this.toJSON=void 0,this.dependencies=[AssetManagerPlugin],this.confirm=!0,this.confirmMessage="GLTF Load: This file includes specular glossiness materials, do you want to convert it to metallic roughness before load?",this._loaderCreate=this._loaderCreate.bind(this)}async onAdded(o){var c;await super.onAdded(o);const d=o.getPlugin(AssetManagerPlugin);(c=d==null?void 0:d.importer)===null||c===void 0||c.addEventListener("loaderCreate",this._loaderCreate)}async onRemove(o){var c,d;return(d=(c=o.getPlugin(AssetManagerPlugin))===null||c===void 0?void 0:c.importer)===null||d===void 0||d.removeEventListener("loaderCreate",this._loaderCreate),super.onRemove(o)}}GLTFSpecGlossinessConverterPlugin.PluginType="GLTFSpecGlossinessConverterPlugin";var RainbowDiamondPlugin_decorate=function(h,o,c,d){var _,v=arguments.length,b=v<3?o:d===null?d=Object.getOwnPropertyDescriptor(o,c):d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(h,o,c,d);else for(var tt=h.length-1;tt>=0;tt--)(_=h[tt])&&(b=(v<3?_(b):v>3?_(o,c,b):_(o,c))||b);return v>3&&b&&Object.defineProperty(o,c,b),b};let RainbowDiamondPlugin=class extends AViewerPlugin{constructor(){super(...arguments),this.enabled=!0,this.toJSON=void 0,this.prefix="",this.count=50,this.loops=1,this.color=new three_module.Q1f().setHSL(0,.8,.5)}colorItems(){if(!this._viewer)return;const h=this._viewer.scene.modelRoot;let o=0;const c=this.color.getHSL({h:0,s:0,l:0});h.traverse(d=>{const _=d.material&&d.material.isDiamondMaterial,v=_&&d.name.startsWith(this.prefix);if(_&&console.log("Found Diamond, name = ",d.name,", coloring = ",v),v){let b=d.name.replace(this.prefix,"");b=parseFloat(b)/this.count;const tt=new three_module.Q1f().setHSL((this.loops*b+c.h)%1,c.s,c.l);d.material=d.material.userData.isColoredClone?d.material:d.material.clone(),d.material.color.set(tt),d.material.boostFactors.set(1,1,1),d.material.userData.isColoredClone=!0,o++}}),console.log("total",o),this._viewer.setDirty()}};RainbowDiamondPlugin.PluginType="RainbowDiamondPlugin",RainbowDiamondPlugin_decorate([uiInput("Object name prefix")],RainbowDiamondPlugin.prototype,"prefix",void 0),RainbowDiamondPlugin_decorate([uiInput("Count")],RainbowDiamondPlugin.prototype,"count",void 0),RainbowDiamondPlugin_decorate([uiInput("Loops")],RainbowDiamondPlugin.prototype,"loops",void 0),RainbowDiamondPlugin_decorate([uiColor("First Color")],RainbowDiamondPlugin.prototype,"color",void 0),RainbowDiamondPlugin_decorate([uiButton("Color All Items")],RainbowDiamondPlugin.prototype,"colorItems",null),RainbowDiamondPlugin=RainbowDiamondPlugin_decorate([uiFolder("Rainbow Diamond Coloring")],RainbowDiamondPlugin);class BeringRingAnimation extends AViewerPlugin{constructor(){super(...arguments),this.enabled=!0,this.toJSON=null,this.ringSlots=[],this.dependencies=[AssetManagerPlugin,PopmotionPlugin],this._animating=!1,this._runningAnimations=[],this.uiConfig={type:"folder",label:"Bering Animation",children:[{label:"Play Animation",type:"button",value:()=>{this.startRingAnimation(!1)}},{label:"Record Animation",type:"button",value:async()=>{var o;const c=(o=this._viewer)===null||o===void 0?void 0:o.getPluginByType("CanvasRecorder");if(!c||c.isRecording())return;this.animating&&this.stopRingAnimation(!1),await X$2(500);const d=await c.record(async()=>{console.log("start"),await this.startRingAnimation(!1),console.log("finish")});d&&(console.log("recorded",d),N$2(d,"animation.mp4"))}}]}}get animating(){return this._animating}set animating(o){var c,d;if(this._animating===o)return;this._animating=o;const _=(c=this._viewer)===null||c===void 0?void 0:c.getPlugin(FrameFadePlugin);_&&(o?_.disable("bering"):_.enable("bering"));const v=(d=this._viewer)===null||d===void 0?void 0:d.getPlugin(TemporalAAPlugin);v&&(v.enabled=!o)}async onAdded(o){await super.onAdded(o),o.scene.addEventListener("addSceneObject",c=>{var d,_,v,b,tt;if(!(!((_=(d=c.options)===null||d===void 0?void 0:d.allImported)===null||_===void 0)&&_.length)||!c.object||!c.object.__importedViewerConfig&&!(!((v=c.object.modelObject)===null||v===void 0)&&v.__importedViewerConfig)||!(!((b=c.options)===null||b===void 0)&&b.allImported))return;let it=0;const nt=(tt=c.options)===null||tt===void 0?void 0:tt.allImported.filter(lt=>!!(lt&&lt.modelObject&&lt.name.endsWith("bmod"))).reverse();nt.forEach(lt=>{this.loadRingBMod(lt,lt.name,it,nt.length-1),it++})})}loadRingBMod(o,c,d,_){var v,b,tt;if(!c)return;if(!(!((v=this._viewer)===null||v===void 0)&&v.getPlugin(AssetManagerPlugin)))throw new Error("no asset manager");this._runningAnimations&&this.stopRingAnimation(),c.endsWith(".bmod")||(c+=".bmod");const it=o==null?void 0:o.modelObject;if(!it||!o)throw new Error("no model");it.userData.__ringSlot=d,this.ringSlots[d]=o;const nt=[];it.traverse(ut=>{ut.userData.rotationCount>1&&nt.push(ut)}),new Box3B().expandByObjects(nt,!0,!0),c.toLowerCase().includes("x3")||c.toLowerCase().includes("x4");const lt=parseInt(c.split("-").pop().toLowerCase().replace("x","").replace(".bmod",""))+1;return it.userData.__ringWidth=lt,it.userData.__ringTotalSlots=_,(tt=(b=this._viewer)===null||b===void 0?void 0:b.scene)===null||tt===void 0||tt.setDirty({sceneUpdate:!0,frameFade:!1}),o}clearAllSlots(){this.ringSlots.forEach(o=>{o.modelObject.removeFromParent()}),this.ringSlots=[]}stopRingAnimation(o=!0){var c,d;if(this._runningAnimations.length!==0){for(const _ of this._runningAnimations)_.stop();this._runningAnimations=[],o&&((d=(c=this._viewer)===null||c===void 0?void 0:c.getPlugin(FrameFadePlugin))===null||d===void 0||d.startTransition(1200))}}async startRingAnimation(o=!0){if(this.animating||!this._viewer)return;this.stopRingAnimation(),this.animating=!0;let c=0;const d=[];await new Promise(_=>{var v,b,tt;if(!this._viewer)return;const it=()=>{c+=1,c<d.length||_()},nt=2500,lt=this._viewer.getPlugin(PopmotionPlugin),ut=this.ringSlots[0];if(ut){const ht=ut.modelObject,_t={left:[],right:[],rem:[]};ht.traverse(xt=>{const St=(xt==null?void 0:xt.name.trim().toLowerCase().replace(/[0-9]/g,""))||"";St.endsWith("-s")?_t.left.push(xt):St.endsWith("-l")?_t.right.push(xt):St.startsWith("testlogo")&&_t.rem.push(xt)});const ft=[];for(const xt of _t.left){const St=((v=xt.parent)===null||v===void 0?void 0:v.children)||[];ft.push(...St)}for(const xt of _t.right){const St=((b=xt.parent)===null||b===void 0?void 0:b.children)||[];ft.push(...St)}for(const xt of ft)_t.left.includes(xt)||_t.right.includes(xt)||_t.rem.includes(xt)||_t.rem.push(xt);for(const xt of _t.rem)new Box3B().expandByObject(xt,!1,!0).getCenter(new three_module.Pq0).x<=0?_t.left.push(xt):_t.right.push(xt);for(const xt of[..._t.left,..._t.right])xt.userData.__initX=xt.position.x,xt.userData.__initRotX=xt.rotation.x;const bt=(tt=this._viewer)===null||tt===void 0?void 0:tt.getPluginByType("Ground");if(_t.left.length>0&&_t.right.length>0){const xt=wt=>Pt=>{var Rt,kt,Gt;for(const Dt of _t[wt])Dt.position.x=Pt+Dt.userData.__initX;(kt=(Rt=this._viewer)===null||Rt===void 0?void 0:Rt.scene)===null||kt===void 0||kt.setDirty({sceneUpdate:!1,frameFade:!1}),o&&((Gt=bt==null?void 0:bt.shadowBaker)===null||Gt===void 0||Gt.reset())},St=wt=>Pt=>{var Rt,kt;for(const Gt of _t[wt])Gt.rotation.x=Pt+Gt.userData.__initRotX;(kt=(Rt=this._viewer)===null||Rt===void 0?void 0:Rt.scene)===null||kt===void 0||kt.setDirty({sceneUpdate:!1,frameFade:!1})};d.push(lt.animate({from:0,to:-.75,onUpdate:xt("left"),onStop:()=>{xt("left")(0),it()},onComplete:it,duration:nt,ease:EasingFunctions.easeInOut,repeat:1,repeatDelay:250,repeatType:"mirror"})),d.push(lt.animate({from:0,to:.75,onUpdate:xt("right"),onStop:()=>{xt("right")(0),it()},onComplete:it,duration:nt,ease:EasingFunctions.easeInOut,repeat:1,repeatDelay:250,repeatType:"mirror"})),d.push(lt.animate({from:0,to:1.5*-Math.PI,onUpdate:St("left"),onStop:()=>{St("left")(0),it()},onComplete:it,duration:1250,ease:EasingFunctions.easeInOut,repeat:1,repeatDelay:2750,repeatType:"mirror"}))}}this.ringSlots.forEach(ht=>{if(ut===ht)return;const _t=ht.modelObject.userData.__ringSlot,ft=ht.modelObject.userData.__ringTotalSlots,bt=ht.modelObject.userData.__ringWidth,xt=ht.modelObject.position.x;d.push(lt.animate({from:xt,to:xt+.75-1.5*(1-(_t+1)/(ft+1+(2-bt))),onUpdate:St=>{var wt,Pt;ht.modelObject.position.x=St,(Pt=(wt=this._viewer)===null||wt===void 0?void 0:wt.scene)===null||Pt===void 0||Pt.setDirty({sceneUpdate:!1,frameFade:!1})},onStop:()=>{ht.modelObject.position.x=xt,it()},onComplete:it,duration:nt,ease:EasingFunctions.easeInOut,repeat:1,repeatDelay:250,repeatType:"mirror"}))}),d.length>0?this._runningAnimations=d:(this.animating=!1,_())}),this.animating=!1;for(const _ of this._runningAnimations)_.stop();this._runningAnimations=[],console.log("animation end")}}BeringRingAnimation.PluginType="BeringRingAnimation";class Mat3{constructor(o){o===void 0&&(o=[0,0,0,0,0,0,0,0,0]),this.elements=o}identity(){const o=this.elements;o[0]=1,o[1]=0,o[2]=0,o[3]=0,o[4]=1,o[5]=0,o[6]=0,o[7]=0,o[8]=1}setZero(){const o=this.elements;o[0]=0,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=0,o[6]=0,o[7]=0,o[8]=0}setTrace(o){const c=this.elements;c[0]=o.x,c[4]=o.y,c[8]=o.z}getTrace(o){o===void 0&&(o=new Vec3);const c=this.elements;return o.x=c[0],o.y=c[4],o.z=c[8],o}vmult(o,c){c===void 0&&(c=new Vec3);const d=this.elements,_=o.x,v=o.y,b=o.z;return c.x=d[0]*_+d[1]*v+d[2]*b,c.y=d[3]*_+d[4]*v+d[5]*b,c.z=d[6]*_+d[7]*v+d[8]*b,c}smult(o){for(let c=0;c<this.elements.length;c++)this.elements[c]*=o}mmult(o,c){c===void 0&&(c=new Mat3);const d=this.elements,_=o.elements,v=c.elements,b=d[0],tt=d[1],it=d[2],nt=d[3],lt=d[4],ut=d[5],ht=d[6],_t=d[7],ft=d[8],bt=_[0],xt=_[1],St=_[2],wt=_[3],Pt=_[4],Rt=_[5],kt=_[6],Gt=_[7],Dt=_[8];return v[0]=b*bt+tt*wt+it*kt,v[1]=b*xt+tt*Pt+it*Gt,v[2]=b*St+tt*Rt+it*Dt,v[3]=nt*bt+lt*wt+ut*kt,v[4]=nt*xt+lt*Pt+ut*Gt,v[5]=nt*St+lt*Rt+ut*Dt,v[6]=ht*bt+_t*wt+ft*kt,v[7]=ht*xt+_t*Pt+ft*Gt,v[8]=ht*St+_t*Rt+ft*Dt,c}scale(o,c){c===void 0&&(c=new Mat3);const d=this.elements,_=c.elements;for(let v=0;v!==3;v++)_[3*v+0]=o.x*d[3*v+0],_[3*v+1]=o.y*d[3*v+1],_[3*v+2]=o.z*d[3*v+2];return c}solve(o,c){c===void 0&&(c=new Vec3);const d=[];let _,v;for(_=0;_<12;_++)d.push(0);for(_=0;_<3;_++)for(v=0;v<3;v++)d[_+4*v]=this.elements[_+3*v];d[3]=o.x,d[7]=o.y,d[11]=o.z;let b=3;const tt=b;let it,nt;do{if(_=tt-b,d[_+4*_]===0){for(v=_+1;v<tt;v++)if(d[_+4*v]!==0){it=4;do nt=4-it,d[nt+4*_]+=d[nt+4*v];while(--it);break}}if(d[_+4*_]!==0)for(v=_+1;v<tt;v++){const lt=d[_+4*v]/d[_+4*_];it=4;do nt=4-it,d[nt+4*v]=nt<=_?0:d[nt+4*v]-d[nt+4*_]*lt;while(--it)}}while(--b);if(c.z=d[11]/d[10],c.y=(d[7]-d[6]*c.z)/d[5],c.x=(d[3]-d[2]*c.z-d[1]*c.y)/d[0],isNaN(c.x)||isNaN(c.y)||isNaN(c.z)||c.x===1/0||c.y===1/0||c.z===1/0)throw`Could not solve equation! Got x=[${c.toString()}], b=[${o.toString()}], A=[${this.toString()}]`;return c}e(o,c,d){if(d===void 0)return this.elements[c+3*o];this.elements[c+3*o]=d}copy(o){for(let c=0;c<o.elements.length;c++)this.elements[c]=o.elements[c];return this}toString(){let o="";for(let c=0;c<9;c++)o+=this.elements[c]+",";return o}reverse(o){o===void 0&&(o=new Mat3);const c=reverse_eqns;let d,_;for(d=0;d<3;d++)for(_=0;_<3;_++)c[d+6*_]=this.elements[d+3*_];c[3]=1,c[9]=0,c[15]=0,c[4]=0,c[10]=1,c[16]=0,c[5]=0,c[11]=0,c[17]=1;let v=3;const b=v;let tt,it;do{if(d=b-v,c[d+6*d]===0){for(_=d+1;_<b;_++)if(c[d+6*_]!==0){tt=6;do it=6-tt,c[it+6*d]+=c[it+6*_];while(--tt);break}}if(c[d+6*d]!==0)for(_=d+1;_<b;_++){const nt=c[d+6*_]/c[d+6*d];tt=6;do it=6-tt,c[it+6*_]=it<=d?0:c[it+6*_]-c[it+6*d]*nt;while(--tt)}}while(--v);d=2;do{_=d-1;do{const nt=c[d+6*_]/c[d+6*d];tt=6;do it=6-tt,c[it+6*_]=c[it+6*_]-c[it+6*d]*nt;while(--tt)}while(_--)}while(--d);d=2;do{const nt=1/c[d+6*d];tt=6;do it=6-tt,c[it+6*d]=c[it+6*d]*nt;while(--tt)}while(d--);d=2;do{_=2;do{if(it=c[3+_+6*d],isNaN(it)||it===1/0)throw`Could not reverse! A=[${this.toString()}]`;o.e(d,_,it)}while(_--)}while(d--);return o}setRotationFromQuaternion(o){const c=o.x,d=o.y,_=o.z,v=o.w,b=c+c,tt=d+d,it=_+_,nt=c*b,lt=c*tt,ut=c*it,ht=d*tt,_t=d*it,ft=_*it,bt=v*b,xt=v*tt,St=v*it,wt=this.elements;return wt[0]=1-(ht+ft),wt[1]=lt-St,wt[2]=ut+xt,wt[3]=lt+St,wt[4]=1-(nt+ft),wt[5]=_t-bt,wt[6]=ut-xt,wt[7]=_t+bt,wt[8]=1-(nt+ht),this}transpose(o){o===void 0&&(o=new Mat3);const c=this.elements,d=o.elements;let _;return d[0]=c[0],d[4]=c[4],d[8]=c[8],_=c[1],d[1]=c[3],d[3]=_,_=c[2],d[2]=c[6],d[6]=_,_=c[5],d[5]=c[7],d[7]=_,o}}const reverse_eqns=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];class Vec3{constructor(o,c,d){o===void 0&&(o=0),c===void 0&&(c=0),d===void 0&&(d=0),this.x=o,this.y=c,this.z=d}cross(o,c){c===void 0&&(c=new Vec3);const d=o.x,_=o.y,v=o.z,b=this.x,tt=this.y,it=this.z;return c.x=tt*v-it*_,c.y=it*d-b*v,c.z=b*_-tt*d,c}set(o,c,d){return this.x=o,this.y=c,this.z=d,this}setZero(){this.x=this.y=this.z=0}vadd(o,c){if(!c)return new Vec3(this.x+o.x,this.y+o.y,this.z+o.z);c.x=o.x+this.x,c.y=o.y+this.y,c.z=o.z+this.z}vsub(o,c){if(!c)return new Vec3(this.x-o.x,this.y-o.y,this.z-o.z);c.x=this.x-o.x,c.y=this.y-o.y,c.z=this.z-o.z}crossmat(){return new Mat3([0,-this.z,this.y,this.z,0,-this.x,-this.y,this.x,0])}normalize(){const o=this.x,c=this.y,d=this.z,_=Math.sqrt(o*o+c*c+d*d);if(_>0){const v=1/_;this.x*=v,this.y*=v,this.z*=v}else this.x=0,this.y=0,this.z=0;return _}unit(o){o===void 0&&(o=new Vec3);const c=this.x,d=this.y,_=this.z;let v=Math.sqrt(c*c+d*d+_*_);return v>0?(v=1/v,o.x=c*v,o.y=d*v,o.z=_*v):(o.x=1,o.y=0,o.z=0),o}length(){const o=this.x,c=this.y,d=this.z;return Math.sqrt(o*o+c*c+d*d)}lengthSquared(){return this.dot(this)}distanceTo(o){const c=this.x,d=this.y,_=this.z,v=o.x,b=o.y,tt=o.z;return Math.sqrt((v-c)*(v-c)+(b-d)*(b-d)+(tt-_)*(tt-_))}distanceSquared(o){const c=this.x,d=this.y,_=this.z,v=o.x,b=o.y,tt=o.z;return(v-c)*(v-c)+(b-d)*(b-d)+(tt-_)*(tt-_)}scale(o,c){c===void 0&&(c=new Vec3);const d=this.x,_=this.y,v=this.z;return c.x=o*d,c.y=o*_,c.z=o*v,c}vmul(o,c){return c===void 0&&(c=new Vec3),c.x=o.x*this.x,c.y=o.y*this.y,c.z=o.z*this.z,c}addScaledVector(o,c,d){return d===void 0&&(d=new Vec3),d.x=this.x+o*c.x,d.y=this.y+o*c.y,d.z=this.z+o*c.z,d}dot(o){return this.x*o.x+this.y*o.y+this.z*o.z}isZero(){return this.x===0&&this.y===0&&this.z===0}negate(o){return o===void 0&&(o=new Vec3),o.x=-this.x,o.y=-this.y,o.z=-this.z,o}tangents(o,c){const d=this.length();if(d>0){const _=Vec3_tangents_n,v=1/d;_.set(this.x*v,this.y*v,this.z*v);const b=Vec3_tangents_randVec;Math.abs(_.x)<.9?(b.set(1,0,0),_.cross(b,o)):(b.set(0,1,0),_.cross(b,o)),_.cross(o,c)}else o.set(1,0,0),c.set(0,1,0)}toString(){return`${this.x},${this.y},${this.z}`}toArray(){return[this.x,this.y,this.z]}copy(o){return this.x=o.x,this.y=o.y,this.z=o.z,this}lerp(o,c,d){const _=this.x,v=this.y,b=this.z;d.x=_+(o.x-_)*c,d.y=v+(o.y-v)*c,d.z=b+(o.z-b)*c}almostEquals(o,c){return c===void 0&&(c=1e-6),!(Math.abs(this.x-o.x)>c||Math.abs(this.y-o.y)>c||Math.abs(this.z-o.z)>c)}almostZero(o){return o===void 0&&(o=1e-6),!(Math.abs(this.x)>o||Math.abs(this.y)>o||Math.abs(this.z)>o)}isAntiparallelTo(o,c){return this.negate(antip_neg),antip_neg.almostEquals(o,c)}clone(){return new Vec3(this.x,this.y,this.z)}}Vec3.ZERO=new Vec3(0,0,0),Vec3.UNIT_X=new Vec3(1,0,0),Vec3.UNIT_Y=new Vec3(0,1,0),Vec3.UNIT_Z=new Vec3(0,0,1);const Vec3_tangents_n=new Vec3,Vec3_tangents_randVec=new Vec3,antip_neg=new Vec3;class AABB{constructor(o){o===void 0&&(o={}),this.lowerBound=new Vec3,this.upperBound=new Vec3,o.lowerBound&&this.lowerBound.copy(o.lowerBound),o.upperBound&&this.upperBound.copy(o.upperBound)}setFromPoints(o,c,d,_){const v=this.lowerBound,b=this.upperBound,tt=d;v.copy(o[0]),tt&&tt.vmult(v,v),b.copy(v);for(let it=1;it<o.length;it++){let nt=o[it];tt&&(tt.vmult(nt,tmp$1),nt=tmp$1),nt.x>b.x&&(b.x=nt.x),nt.x<v.x&&(v.x=nt.x),nt.y>b.y&&(b.y=nt.y),nt.y<v.y&&(v.y=nt.y),nt.z>b.z&&(b.z=nt.z),nt.z<v.z&&(v.z=nt.z)}return c&&(c.vadd(v,v),c.vadd(b,b)),_&&(v.x-=_,v.y-=_,v.z-=_,b.x+=_,b.y+=_,b.z+=_),this}copy(o){return this.lowerBound.copy(o.lowerBound),this.upperBound.copy(o.upperBound),this}clone(){return new AABB().copy(this)}extend(o){this.lowerBound.x=Math.min(this.lowerBound.x,o.lowerBound.x),this.upperBound.x=Math.max(this.upperBound.x,o.upperBound.x),this.lowerBound.y=Math.min(this.lowerBound.y,o.lowerBound.y),this.upperBound.y=Math.max(this.upperBound.y,o.upperBound.y),this.lowerBound.z=Math.min(this.lowerBound.z,o.lowerBound.z),this.upperBound.z=Math.max(this.upperBound.z,o.upperBound.z)}overlaps(o){const c=this.lowerBound,d=this.upperBound,_=o.lowerBound,v=o.upperBound,b=_.x<=d.x&&d.x<=v.x||c.x<=v.x&&v.x<=d.x,tt=_.y<=d.y&&d.y<=v.y||c.y<=v.y&&v.y<=d.y,it=_.z<=d.z&&d.z<=v.z||c.z<=v.z&&v.z<=d.z;return b&&tt&&it}volume(){const o=this.lowerBound,c=this.upperBound;return(c.x-o.x)*(c.y-o.y)*(c.z-o.z)}contains(o){const c=this.lowerBound,d=this.upperBound,_=o.lowerBound,v=o.upperBound;return c.x<=_.x&&d.x>=v.x&&c.y<=_.y&&d.y>=v.y&&c.z<=_.z&&d.z>=v.z}getCorners(o,c,d,_,v,b,tt,it){const nt=this.lowerBound,lt=this.upperBound;o.copy(nt),c.set(lt.x,nt.y,nt.z),d.set(lt.x,lt.y,nt.z),_.set(nt.x,lt.y,lt.z),v.set(lt.x,nt.y,lt.z),b.set(nt.x,lt.y,nt.z),tt.set(nt.x,nt.y,lt.z),it.copy(lt)}toLocalFrame(o,c){const d=transformIntoFrame_corners,_=d[0],v=d[1],b=d[2],tt=d[3],it=d[4],nt=d[5],lt=d[6],ut=d[7];this.getCorners(_,v,b,tt,it,nt,lt,ut);for(let ht=0;ht!==8;ht++){const _t=d[ht];o.pointToLocal(_t,_t)}return c.setFromPoints(d)}toWorldFrame(o,c){const d=transformIntoFrame_corners,_=d[0],v=d[1],b=d[2],tt=d[3],it=d[4],nt=d[5],lt=d[6],ut=d[7];this.getCorners(_,v,b,tt,it,nt,lt,ut);for(let ht=0;ht!==8;ht++){const _t=d[ht];o.pointToWorld(_t,_t)}return c.setFromPoints(d)}overlapsRay(o){const{direction:c,from:d}=o,_=1/c.x,v=1/c.y,b=1/c.z,tt=(this.lowerBound.x-d.x)*_,it=(this.upperBound.x-d.x)*_,nt=(this.lowerBound.y-d.y)*v,lt=(this.upperBound.y-d.y)*v,ut=(this.lowerBound.z-d.z)*b,ht=(this.upperBound.z-d.z)*b,_t=Math.max(Math.max(Math.min(tt,it),Math.min(nt,lt)),Math.min(ut,ht)),ft=Math.min(Math.min(Math.max(tt,it),Math.max(nt,lt)),Math.max(ut,ht));return!(ft<0||_t>ft)}}const tmp$1=new Vec3,transformIntoFrame_corners=[new Vec3,new Vec3,new Vec3,new Vec3,new Vec3,new Vec3,new Vec3,new Vec3];class ArrayCollisionMatrix{constructor(){this.matrix=[]}get(o,c){let{index:d}=o,{index:_}=c;if(_>d){const v=_;_=d,d=v}return this.matrix[(d*(d+1)>>1)+_-1]}set(o,c,d){let{index:_}=o,{index:v}=c;if(v>_){const b=v;v=_,_=b}this.matrix[(_*(_+1)>>1)+v-1]=d?1:0}reset(){for(let o=0,c=this.matrix.length;o!==c;o++)this.matrix[o]=0}setNumObjects(o){this.matrix.length=o*(o-1)>>1}}class EventTarget{addEventListener(o,c){this._listeners===void 0&&(this._listeners={});const d=this._listeners;return d[o]===void 0&&(d[o]=[]),d[o].includes(c)||d[o].push(c),this}hasEventListener(o,c){if(this._listeners===void 0)return!1;const d=this._listeners;return!(d[o]===void 0||!d[o].includes(c))}hasAnyEventListener(o){return this._listeners!==void 0&&this._listeners[o]!==void 0}removeEventListener(o,c){if(this._listeners===void 0)return this;const d=this._listeners;if(d[o]===void 0)return this;const _=d[o].indexOf(c);return _!==-1&&d[o].splice(_,1),this}dispatchEvent(o){if(this._listeners===void 0)return this;const c=this._listeners[o.type];if(c!==void 0){o.target=this;for(let d=0,_=c.length;d<_;d++)c[d].call(this,o)}return this}}class Quaternion{constructor(o,c,d,_){o===void 0&&(o=0),c===void 0&&(c=0),d===void 0&&(d=0),_===void 0&&(_=1),this.x=o,this.y=c,this.z=d,this.w=_}set(o,c,d,_){return this.x=o,this.y=c,this.z=d,this.w=_,this}toString(){return`${this.x},${this.y},${this.z},${this.w}`}toArray(){return[this.x,this.y,this.z,this.w]}setFromAxisAngle(o,c){const d=Math.sin(.5*c);return this.x=o.x*d,this.y=o.y*d,this.z=o.z*d,this.w=Math.cos(.5*c),this}toAxisAngle(o){o===void 0&&(o=new Vec3),this.normalize();const c=2*Math.acos(this.w),d=Math.sqrt(1-this.w*this.w);return d<.001?(o.x=this.x,o.y=this.y,o.z=this.z):(o.x=this.x/d,o.y=this.y/d,o.z=this.z/d),[o,c]}setFromVectors(o,c){if(o.isAntiparallelTo(c)){const d=sfv_t1,_=sfv_t2;o.tangents(d,_),this.setFromAxisAngle(d,Math.PI)}else{const d=o.cross(c);this.x=d.x,this.y=d.y,this.z=d.z,this.w=Math.sqrt(o.length()**2*c.length()**2)+o.dot(c),this.normalize()}return this}mult(o,c){c===void 0&&(c=new Quaternion);const d=this.x,_=this.y,v=this.z,b=this.w,tt=o.x,it=o.y,nt=o.z,lt=o.w;return c.x=d*lt+b*tt+_*nt-v*it,c.y=_*lt+b*it+v*tt-d*nt,c.z=v*lt+b*nt+d*it-_*tt,c.w=b*lt-d*tt-_*it-v*nt,c}inverse(o){o===void 0&&(o=new Quaternion);const c=this.x,d=this.y,_=this.z,v=this.w;this.conjugate(o);const b=1/(c*c+d*d+_*_+v*v);return o.x*=b,o.y*=b,o.z*=b,o.w*=b,o}conjugate(o){return o===void 0&&(o=new Quaternion),o.x=-this.x,o.y=-this.y,o.z=-this.z,o.w=this.w,o}normalize(){let o=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return o===0?(this.x=0,this.y=0,this.z=0,this.w=0):(o=1/o,this.x*=o,this.y*=o,this.z*=o,this.w*=o),this}normalizeFast(){const o=(3-(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w))/2;return o===0?(this.x=0,this.y=0,this.z=0,this.w=0):(this.x*=o,this.y*=o,this.z*=o,this.w*=o),this}vmult(o,c){c===void 0&&(c=new Vec3);const d=o.x,_=o.y,v=o.z,b=this.x,tt=this.y,it=this.z,nt=this.w,lt=nt*d+tt*v-it*_,ut=nt*_+it*d-b*v,ht=nt*v+b*_-tt*d,_t=-b*d-tt*_-it*v;return c.x=lt*nt+_t*-b+ut*-it-ht*-tt,c.y=ut*nt+_t*-tt+ht*-b-lt*-it,c.z=ht*nt+_t*-it+lt*-tt-ut*-b,c}copy(o){return this.x=o.x,this.y=o.y,this.z=o.z,this.w=o.w,this}toEuler(o,c){let d,_,v;c===void 0&&(c="YZX");const b=this.x,tt=this.y,it=this.z,nt=this.w;if(c!=="YZX")throw new Error(`Euler order ${c} not supported yet.`);{const lt=b*tt+it*nt;if(lt>.499&&(d=2*Math.atan2(b,nt),_=Math.PI/2,v=0),lt<-.499&&(d=-2*Math.atan2(b,nt),_=-Math.PI/2,v=0),d===void 0){const ut=b*b,ht=tt*tt,_t=it*it;d=Math.atan2(2*tt*nt-2*b*it,1-2*ht-2*_t),_=Math.asin(2*lt),v=Math.atan2(2*b*nt-2*tt*it,1-2*ut-2*_t)}}o.y=d,o.z=_,o.x=v}setFromEuler(o,c,d,_){_===void 0&&(_="XYZ");const v=Math.cos(o/2),b=Math.cos(c/2),tt=Math.cos(d/2),it=Math.sin(o/2),nt=Math.sin(c/2),lt=Math.sin(d/2);return _==="XYZ"?(this.x=it*b*tt+v*nt*lt,this.y=v*nt*tt-it*b*lt,this.z=v*b*lt+it*nt*tt,this.w=v*b*tt-it*nt*lt):_==="YXZ"?(this.x=it*b*tt+v*nt*lt,this.y=v*nt*tt-it*b*lt,this.z=v*b*lt-it*nt*tt,this.w=v*b*tt+it*nt*lt):_==="ZXY"?(this.x=it*b*tt-v*nt*lt,this.y=v*nt*tt+it*b*lt,this.z=v*b*lt+it*nt*tt,this.w=v*b*tt-it*nt*lt):_==="ZYX"?(this.x=it*b*tt-v*nt*lt,this.y=v*nt*tt+it*b*lt,this.z=v*b*lt-it*nt*tt,this.w=v*b*tt+it*nt*lt):_==="YZX"?(this.x=it*b*tt+v*nt*lt,this.y=v*nt*tt+it*b*lt,this.z=v*b*lt-it*nt*tt,this.w=v*b*tt-it*nt*lt):_==="XZY"&&(this.x=it*b*tt-v*nt*lt,this.y=v*nt*tt-it*b*lt,this.z=v*b*lt+it*nt*tt,this.w=v*b*tt+it*nt*lt),this}clone(){return new Quaternion(this.x,this.y,this.z,this.w)}slerp(o,c,d){d===void 0&&(d=new Quaternion);const _=this.x,v=this.y,b=this.z,tt=this.w;let it,nt,lt,ut,ht,_t=o.x,ft=o.y,bt=o.z,xt=o.w;return nt=_*_t+v*ft+b*bt+tt*xt,nt<0&&(nt=-nt,_t=-_t,ft=-ft,bt=-bt,xt=-xt),1-nt>1e-6?(it=Math.acos(nt),lt=Math.sin(it),ut=Math.sin((1-c)*it)/lt,ht=Math.sin(c*it)/lt):(ut=1-c,ht=c),d.x=ut*_+ht*_t,d.y=ut*v+ht*ft,d.z=ut*b+ht*bt,d.w=ut*tt+ht*xt,d}integrate(o,c,d,_){_===void 0&&(_=new Quaternion);const v=o.x*d.x,b=o.y*d.y,tt=o.z*d.z,it=this.x,nt=this.y,lt=this.z,ut=this.w,ht=.5*c;return _.x+=ht*(v*ut+b*lt-tt*nt),_.y+=ht*(b*ut+tt*it-v*lt),_.z+=ht*(tt*ut+v*nt-b*it),_.w+=ht*(-v*it-b*nt-tt*lt),_}}const sfv_t1=new Vec3,sfv_t2=new Vec3,SHAPE_TYPES={SPHERE:1,PLANE:2,BOX:4,COMPOUND:8,CONVEXPOLYHEDRON:16,HEIGHTFIELD:32,PARTICLE:64,CYLINDER:128,TRIMESH:256};class Shape{constructor(o){o===void 0&&(o={}),this.id=Shape.idCounter++,this.type=o.type||0,this.boundingSphereRadius=0,this.collisionResponse=!o.collisionResponse||o.collisionResponse,this.collisionFilterGroup=o.collisionFilterGroup!==void 0?o.collisionFilterGroup:1,this.collisionFilterMask=o.collisionFilterMask!==void 0?o.collisionFilterMask:-1,this.material=o.material?o.material:null,this.body=null}updateBoundingSphereRadius(){throw`computeBoundingSphereRadius() not implemented for shape type ${this.type}`}volume(){throw`volume() not implemented for shape type ${this.type}`}calculateLocalInertia(o,c){throw`calculateLocalInertia() not implemented for shape type ${this.type}`}calculateWorldAABB(o,c,d,_){throw`calculateWorldAABB() not implemented for shape type ${this.type}`}}Shape.idCounter=0,Shape.types=SHAPE_TYPES;class cannon_es_Transform{constructor(o){o===void 0&&(o={}),this.position=new Vec3,this.quaternion=new Quaternion,o.position&&this.position.copy(o.position),o.quaternion&&this.quaternion.copy(o.quaternion)}pointToLocal(o,c){return cannon_es_Transform.pointToLocalFrame(this.position,this.quaternion,o,c)}pointToWorld(o,c){return cannon_es_Transform.pointToWorldFrame(this.position,this.quaternion,o,c)}vectorToWorldFrame(o,c){return c===void 0&&(c=new Vec3),this.quaternion.vmult(o,c),c}static pointToLocalFrame(o,c,d,_){return _===void 0&&(_=new Vec3),d.vsub(o,_),c.conjugate(tmpQuat$1),tmpQuat$1.vmult(_,_),_}static pointToWorldFrame(o,c,d,_){return _===void 0&&(_=new Vec3),c.vmult(d,_),_.vadd(o,_),_}static vectorToWorldFrame(o,c,d){return d===void 0&&(d=new Vec3),o.vmult(c,d),d}static vectorToLocalFrame(o,c,d,_){return _===void 0&&(_=new Vec3),c.w*=-1,c.vmult(d,_),c.w*=-1,_}}const tmpQuat$1=new Quaternion;class ConvexPolyhedron extends Shape{constructor(o){o===void 0&&(o={});const{vertices:c=[],faces:d=[],normals:_=[],axes:v,boundingSphereRadius:b}=o;super({type:Shape.types.CONVEXPOLYHEDRON}),this.vertices=c,this.faces=d,this.faceNormals=_,this.faceNormals.length===0&&this.computeNormals(),b?this.boundingSphereRadius=b:this.updateBoundingSphereRadius(),this.worldVertices=[],this.worldVerticesNeedsUpdate=!0,this.worldFaceNormals=[],this.worldFaceNormalsNeedsUpdate=!0,this.uniqueAxes=v?v.slice():null,this.uniqueEdges=[],this.computeEdges()}computeEdges(){const o=this.faces,c=this.vertices,d=this.uniqueEdges;d.length=0;const _=new Vec3;for(let v=0;v!==o.length;v++){const b=o[v],tt=b.length;for(let it=0;it!==tt;it++){const nt=(it+1)%tt;c[b[it]].vsub(c[b[nt]],_),_.normalize();let lt=!1;for(let ut=0;ut!==d.length;ut++)if(d[ut].almostEquals(_)||d[ut].almostEquals(_)){lt=!0;break}lt||d.push(_.clone())}}}computeNormals(){this.faceNormals.length=this.faces.length;for(let o=0;o<this.faces.length;o++){for(let _=0;_<this.faces[o].length;_++)if(!this.vertices[this.faces[o][_]])throw new Error(`Vertex ${this.faces[o][_]} not found!`);const c=this.faceNormals[o]||new Vec3;this.getFaceNormal(o,c),c.negate(c),this.faceNormals[o]=c;const d=this.vertices[this.faces[o][0]];if(c.dot(d)<0){console.error(`.faceNormals[${o}] = Vec3(${c.toString()}) looks like it points into the shape? The vertices follow. Make sure they are ordered CCW around the normal, using the right hand rule.`);for(let _=0;_<this.faces[o].length;_++)console.warn(`.vertices[${this.faces[o][_]}] = Vec3(${this.vertices[this.faces[o][_]].toString()})`)}}}getFaceNormal(o,c){const d=this.faces[o],_=this.vertices[d[0]],v=this.vertices[d[1]],b=this.vertices[d[2]];ConvexPolyhedron.computeNormal(_,v,b,c)}static computeNormal(o,c,d,_){const v=new Vec3,b=new Vec3;c.vsub(o,b),d.vsub(c,v),v.cross(b,_),_.isZero()||_.normalize()}clipAgainstHull(o,c,d,_,v,b,tt,it,nt){const lt=new Vec3;let ut=-1,ht=-Number.MAX_VALUE;for(let ft=0;ft<d.faces.length;ft++){lt.copy(d.faceNormals[ft]),v.vmult(lt,lt);const bt=lt.dot(b);bt>ht&&(ht=bt,ut=ft)}const _t=[];for(let ft=0;ft<d.faces[ut].length;ft++){const bt=d.vertices[d.faces[ut][ft]],xt=new Vec3;xt.copy(bt),v.vmult(xt,xt),_.vadd(xt,xt),_t.push(xt)}ut>=0&&this.clipFaceAgainstHull(b,o,c,_t,tt,it,nt)}findSeparatingAxis(o,c,d,_,v,b,tt,it){const nt=new Vec3,lt=new Vec3,ut=new Vec3,ht=new Vec3,_t=new Vec3,ft=new Vec3;let bt=Number.MAX_VALUE;const xt=this;if(xt.uniqueAxes)for(let St=0;St!==xt.uniqueAxes.length;St++){d.vmult(xt.uniqueAxes[St],nt);const wt=xt.testSepAxis(nt,o,c,d,_,v);if(wt===!1)return!1;wt<bt&&(bt=wt,b.copy(nt))}else{const St=tt?tt.length:xt.faces.length;for(let wt=0;wt<St;wt++){const Pt=tt?tt[wt]:wt;nt.copy(xt.faceNormals[Pt]),d.vmult(nt,nt);const Rt=xt.testSepAxis(nt,o,c,d,_,v);if(Rt===!1)return!1;Rt<bt&&(bt=Rt,b.copy(nt))}}if(o.uniqueAxes)for(let St=0;St!==o.uniqueAxes.length;St++){v.vmult(o.uniqueAxes[St],lt);const wt=xt.testSepAxis(lt,o,c,d,_,v);if(wt===!1)return!1;wt<bt&&(bt=wt,b.copy(lt))}else{const St=it?it.length:o.faces.length;for(let wt=0;wt<St;wt++){const Pt=it?it[wt]:wt;lt.copy(o.faceNormals[Pt]),v.vmult(lt,lt);const Rt=xt.testSepAxis(lt,o,c,d,_,v);if(Rt===!1)return!1;Rt<bt&&(bt=Rt,b.copy(lt))}}for(let St=0;St!==xt.uniqueEdges.length;St++){d.vmult(xt.uniqueEdges[St],ht);for(let wt=0;wt!==o.uniqueEdges.length;wt++)if(v.vmult(o.uniqueEdges[wt],_t),ht.cross(_t,ft),!ft.almostZero()){ft.normalize();const Pt=xt.testSepAxis(ft,o,c,d,_,v);if(Pt===!1)return!1;Pt<bt&&(bt=Pt,b.copy(ft))}}return _.vsub(c,ut),ut.dot(b)>0&&b.negate(b),!0}testSepAxis(o,c,d,_,v,b){ConvexPolyhedron.project(this,o,d,_,maxminA),ConvexPolyhedron.project(c,o,v,b,maxminB);const tt=maxminA[0],it=maxminA[1],nt=maxminB[0],lt=maxminB[1];if(tt<lt||nt<it)return!1;const ut=tt-lt,ht=nt-it;return ut<ht?ut:ht}calculateLocalInertia(o,c){const d=new Vec3,_=new Vec3;this.computeLocalAABB(_,d);const v=d.x-_.x,b=d.y-_.y,tt=d.z-_.z;c.x=1/12*o*(2*b*2*b+2*tt*2*tt),c.y=1/12*o*(2*v*2*v+2*tt*2*tt),c.z=1/12*o*(2*b*2*b+2*v*2*v)}getPlaneConstantOfFace(o){const c=this.faces[o],d=this.faceNormals[o],_=this.vertices[c[0]];return-d.dot(_)}clipFaceAgainstHull(o,c,d,_,v,b,tt){const it=new Vec3,nt=new Vec3,lt=new Vec3,ut=new Vec3,ht=new Vec3,_t=new Vec3,ft=new Vec3,bt=new Vec3,xt=this,St=_,wt=[];let Pt=-1,Rt=Number.MAX_VALUE;for(let Nt=0;Nt<xt.faces.length;Nt++){it.copy(xt.faceNormals[Nt]),d.vmult(it,it);const Vt=it.dot(o);Vt<Rt&&(Rt=Vt,Pt=Nt)}if(Pt<0)return;const kt=xt.faces[Pt];kt.connectedFaces=[];for(let Nt=0;Nt<xt.faces.length;Nt++)for(let Vt=0;Vt<xt.faces[Nt].length;Vt++)kt.indexOf(xt.faces[Nt][Vt])!==-1&&Nt!==Pt&&kt.connectedFaces.indexOf(Nt)===-1&&kt.connectedFaces.push(Nt);const Gt=kt.length;for(let Nt=0;Nt<Gt;Nt++){const Vt=xt.vertices[kt[Nt]],Kt=xt.vertices[kt[(Nt+1)%Gt]];Vt.vsub(Kt,nt),lt.copy(nt),d.vmult(lt,lt),c.vadd(lt,lt),ut.copy(this.faceNormals[Pt]),d.vmult(ut,ut),c.vadd(ut,ut),lt.cross(ut,ht),ht.negate(ht),_t.copy(Vt),d.vmult(_t,_t),c.vadd(_t,_t);const Yt=kt.connectedFaces[Nt];ft.copy(this.faceNormals[Yt]);const nr=this.getPlaneConstantOfFace(Yt);bt.copy(ft),d.vmult(bt,bt);const rr=nr-bt.dot(c);for(this.clipFaceAgainstPlane(St,wt,bt,rr);St.length;)St.shift();for(;wt.length;)St.push(wt.shift())}ft.copy(this.faceNormals[Pt]);const Dt=this.getPlaneConstantOfFace(Pt);bt.copy(ft),d.vmult(bt,bt);const It=Dt-bt.dot(c);for(let Nt=0;Nt<St.length;Nt++){let Vt=bt.dot(St[Nt])+It;if(Vt<=v&&(console.log(`clamped: depth=${Vt} to minDist=${v}`),Vt=v),Vt<=b){const Kt=St[Nt];if(Vt<=1e-6){const Yt={point:Kt,normal:bt,depth:Vt};tt.push(Yt)}}}}clipFaceAgainstPlane(o,c,d,_){let v,b;const tt=o.length;if(tt<2)return c;let it=o[o.length-1],nt=o[0];v=d.dot(it)+_;for(let lt=0;lt<tt;lt++){if(nt=o[lt],b=d.dot(nt)+_,v<0)if(b<0){const ut=new Vec3;ut.copy(nt),c.push(ut)}else{const ut=new Vec3;it.lerp(nt,v/(v-b),ut),c.push(ut)}else if(b<0){const ut=new Vec3;it.lerp(nt,v/(v-b),ut),c.push(ut),c.push(nt)}it=nt,v=b}return c}computeWorldVertices(o,c){for(;this.worldVertices.length<this.vertices.length;)this.worldVertices.push(new Vec3);const d=this.vertices,_=this.worldVertices;for(let v=0;v!==this.vertices.length;v++)c.vmult(d[v],_[v]),o.vadd(_[v],_[v]);this.worldVerticesNeedsUpdate=!1}computeLocalAABB(o,c){const d=this.vertices;o.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),c.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let _=0;_<this.vertices.length;_++){const v=d[_];v.x<o.x?o.x=v.x:v.x>c.x&&(c.x=v.x),v.y<o.y?o.y=v.y:v.y>c.y&&(c.y=v.y),v.z<o.z?o.z=v.z:v.z>c.z&&(c.z=v.z)}}computeWorldFaceNormals(o){const c=this.faceNormals.length;for(;this.worldFaceNormals.length<c;)this.worldFaceNormals.push(new Vec3);const d=this.faceNormals,_=this.worldFaceNormals;for(let v=0;v!==c;v++)o.vmult(d[v],_[v]);this.worldFaceNormalsNeedsUpdate=!1}updateBoundingSphereRadius(){let o=0;const c=this.vertices;for(let d=0;d!==c.length;d++){const _=c[d].lengthSquared();_>o&&(o=_)}this.boundingSphereRadius=Math.sqrt(o)}calculateWorldAABB(o,c,d,_){const v=this.vertices;let b,tt,it,nt,lt,ut,ht=new Vec3;for(let _t=0;_t<v.length;_t++){ht.copy(v[_t]),c.vmult(ht,ht),o.vadd(ht,ht);const ft=ht;(b===void 0||ft.x<b)&&(b=ft.x),(nt===void 0||ft.x>nt)&&(nt=ft.x),(tt===void 0||ft.y<tt)&&(tt=ft.y),(lt===void 0||ft.y>lt)&&(lt=ft.y),(it===void 0||ft.z<it)&&(it=ft.z),(ut===void 0||ft.z>ut)&&(ut=ft.z)}d.set(b,tt,it),_.set(nt,lt,ut)}volume(){return 4*Math.PI*this.boundingSphereRadius/3}getAveragePointLocal(o){o===void 0&&(o=new Vec3);const c=this.vertices;for(let d=0;d<c.length;d++)o.vadd(c[d],o);return o.scale(1/c.length,o),o}transformAllPoints(o,c){const d=this.vertices.length,_=this.vertices;if(c){for(let v=0;v<d;v++){const b=_[v];c.vmult(b,b)}for(let v=0;v<this.faceNormals.length;v++){const b=this.faceNormals[v];c.vmult(b,b)}}if(o)for(let v=0;v<d;v++){const b=_[v];b.vadd(o,b)}}pointIsInside(o){const c=this.vertices,d=this.faces,_=this.faceNormals,v=new Vec3;this.getAveragePointLocal(v);for(let b=0;b<this.faces.length;b++){let tt=_[b];const it=c[d[b][0]],nt=new Vec3;o.vsub(it,nt);const lt=tt.dot(nt),ut=new Vec3;v.vsub(it,ut);const ht=tt.dot(ut);if(lt<0&&ht>0||lt>0&&ht<0)return!1}return-1}static project(o,c,d,_,v){const b=o.vertices.length,tt=project_localAxis;let it=0,nt=0;const lt=project_localOrigin,ut=o.vertices;lt.setZero(),cannon_es_Transform.vectorToLocalFrame(d,_,c,tt),cannon_es_Transform.pointToLocalFrame(d,_,lt,lt);const ht=lt.dot(tt);nt=it=ut[0].dot(tt);for(let _t=1;_t<b;_t++){const ft=ut[_t].dot(tt);ft>it&&(it=ft),ft<nt&&(nt=ft)}if(nt-=ht,it-=ht,nt>it){const _t=nt;nt=it,it=_t}v[0]=it,v[1]=nt}}const maxminA=[],maxminB=[];new Vec3;const project_localAxis=new Vec3,project_localOrigin=new Vec3;class Box extends Shape{constructor(o){super({type:Shape.types.BOX}),this.halfExtents=o,this.convexPolyhedronRepresentation=null,this.updateConvexPolyhedronRepresentation(),this.updateBoundingSphereRadius()}updateConvexPolyhedronRepresentation(){const o=this.halfExtents.x,c=this.halfExtents.y,d=this.halfExtents.z,_=Vec3,v=[new _(-o,-c,-d),new _(o,-c,-d),new _(o,c,-d),new _(-o,c,-d),new _(-o,-c,d),new _(o,-c,d),new _(o,c,d),new _(-o,c,d)],b=[new _(0,0,1),new _(0,1,0),new _(1,0,0)],tt=new ConvexPolyhedron({vertices:v,faces:[[3,2,1,0],[4,5,6,7],[5,4,0,1],[2,3,7,6],[0,4,7,3],[1,2,6,5]],axes:b});this.convexPolyhedronRepresentation=tt,tt.material=this.material}calculateLocalInertia(o,c){return c===void 0&&(c=new Vec3),Box.calculateInertia(this.halfExtents,o,c),c}static calculateInertia(o,c,d){const _=o;d.x=1/12*c*(2*_.y*2*_.y+2*_.z*2*_.z),d.y=1/12*c*(2*_.x*2*_.x+2*_.z*2*_.z),d.z=1/12*c*(2*_.y*2*_.y+2*_.x*2*_.x)}getSideNormals(o,c){const d=o,_=this.halfExtents;if(d[0].set(_.x,0,0),d[1].set(0,_.y,0),d[2].set(0,0,_.z),d[3].set(-_.x,0,0),d[4].set(0,-_.y,0),d[5].set(0,0,-_.z),c!==void 0)for(let v=0;v!==d.length;v++)c.vmult(d[v],d[v]);return d}volume(){return 8*this.halfExtents.x*this.halfExtents.y*this.halfExtents.z}updateBoundingSphereRadius(){this.boundingSphereRadius=this.halfExtents.length()}forEachWorldCorner(o,c,d){const _=this.halfExtents,v=[[_.x,_.y,_.z],[-_.x,_.y,_.z],[-_.x,-_.y,_.z],[-_.x,-_.y,-_.z],[_.x,-_.y,-_.z],[_.x,_.y,-_.z],[-_.x,_.y,-_.z],[_.x,-_.y,_.z]];for(let b=0;b<v.length;b++)worldCornerTempPos.set(v[b][0],v[b][1],v[b][2]),c.vmult(worldCornerTempPos,worldCornerTempPos),o.vadd(worldCornerTempPos,worldCornerTempPos),d(worldCornerTempPos.x,worldCornerTempPos.y,worldCornerTempPos.z)}calculateWorldAABB(o,c,d,_){const v=this.halfExtents;worldCornersTemp[0].set(v.x,v.y,v.z),worldCornersTemp[1].set(-v.x,v.y,v.z),worldCornersTemp[2].set(-v.x,-v.y,v.z),worldCornersTemp[3].set(-v.x,-v.y,-v.z),worldCornersTemp[4].set(v.x,-v.y,-v.z),worldCornersTemp[5].set(v.x,v.y,-v.z),worldCornersTemp[6].set(-v.x,v.y,-v.z),worldCornersTemp[7].set(v.x,-v.y,v.z);const b=worldCornersTemp[0];c.vmult(b,b),o.vadd(b,b),_.copy(b),d.copy(b);for(let tt=1;tt<8;tt++){const it=worldCornersTemp[tt];c.vmult(it,it),o.vadd(it,it);const nt=it.x,lt=it.y,ut=it.z;nt>_.x&&(_.x=nt),lt>_.y&&(_.y=lt),ut>_.z&&(_.z=ut),nt<d.x&&(d.x=nt),lt<d.y&&(d.y=lt),ut<d.z&&(d.z=ut)}}}const worldCornerTempPos=new Vec3,worldCornersTemp=[new Vec3,new Vec3,new Vec3,new Vec3,new Vec3,new Vec3,new Vec3,new Vec3],BODY_TYPES={DYNAMIC:1,STATIC:2,KINEMATIC:4},BODY_SLEEP_STATES={AWAKE:0,SLEEPY:1,SLEEPING:2};class Body extends EventTarget{constructor(o){o===void 0&&(o={}),super(),this.id=Body.idCounter++,this.index=-1,this.world=null,this.vlambda=new Vec3,this.collisionFilterGroup=typeof o.collisionFilterGroup=="number"?o.collisionFilterGroup:1,this.collisionFilterMask=typeof o.collisionFilterMask=="number"?o.collisionFilterMask:-1,this.collisionResponse=typeof o.collisionResponse!="boolean"||o.collisionResponse,this.position=new Vec3,this.previousPosition=new Vec3,this.interpolatedPosition=new Vec3,this.initPosition=new Vec3,o.position&&(this.position.copy(o.position),this.previousPosition.copy(o.position),this.interpolatedPosition.copy(o.position),this.initPosition.copy(o.position)),this.velocity=new Vec3,o.velocity&&this.velocity.copy(o.velocity),this.initVelocity=new Vec3,this.force=new Vec3;const c=typeof o.mass=="number"?o.mass:0;this.mass=c,this.invMass=c>0?1/c:0,this.material=o.material||null,this.linearDamping=typeof o.linearDamping=="number"?o.linearDamping:.01,this.type=c<=0?Body.STATIC:Body.DYNAMIC,typeof o.type==typeof Body.STATIC&&(this.type=o.type),this.allowSleep=o.allowSleep===void 0||o.allowSleep,this.sleepState=Body.AWAKE,this.sleepSpeedLimit=o.sleepSpeedLimit!==void 0?o.sleepSpeedLimit:.1,this.sleepTimeLimit=o.sleepTimeLimit!==void 0?o.sleepTimeLimit:1,this.timeLastSleepy=0,this.wakeUpAfterNarrowphase=!1,this.torque=new Vec3,this.quaternion=new Quaternion,this.initQuaternion=new Quaternion,this.previousQuaternion=new Quaternion,this.interpolatedQuaternion=new Quaternion,o.quaternion&&(this.quaternion.copy(o.quaternion),this.initQuaternion.copy(o.quaternion),this.previousQuaternion.copy(o.quaternion),this.interpolatedQuaternion.copy(o.quaternion)),this.angularVelocity=new Vec3,o.angularVelocity&&this.angularVelocity.copy(o.angularVelocity),this.initAngularVelocity=new Vec3,this.shapes=[],this.shapeOffsets=[],this.shapeOrientations=[],this.inertia=new Vec3,this.invInertia=new Vec3,this.invInertiaWorld=new Mat3,this.invMassSolve=0,this.invInertiaSolve=new Vec3,this.invInertiaWorldSolve=new Mat3,this.fixedRotation=o.fixedRotation!==void 0&&o.fixedRotation,this.angularDamping=o.angularDamping!==void 0?o.angularDamping:.01,this.linearFactor=new Vec3(1,1,1),o.linearFactor&&this.linearFactor.copy(o.linearFactor),this.angularFactor=new Vec3(1,1,1),o.angularFactor&&this.angularFactor.copy(o.angularFactor),this.aabb=new AABB,this.aabbNeedsUpdate=!0,this.boundingRadius=0,this.wlambda=new Vec3,this.isTrigger=!!o.isTrigger,o.shape&&this.addShape(o.shape),this.updateMassProperties()}wakeUp(){const o=this.sleepState;this.sleepState=Body.AWAKE,this.wakeUpAfterNarrowphase=!1,o===Body.SLEEPING&&this.dispatchEvent(Body.wakeupEvent)}sleep(){this.sleepState=Body.SLEEPING,this.velocity.set(0,0,0),this.angularVelocity.set(0,0,0),this.wakeUpAfterNarrowphase=!1}sleepTick(o){if(this.allowSleep){const c=this.sleepState,d=this.velocity.lengthSquared()+this.angularVelocity.lengthSquared(),_=this.sleepSpeedLimit**2;c===Body.AWAKE&&d<_?(this.sleepState=Body.SLEEPY,this.timeLastSleepy=o,this.dispatchEvent(Body.sleepyEvent)):c===Body.SLEEPY&&d>_?this.wakeUp():c===Body.SLEEPY&&o-this.timeLastSleepy>this.sleepTimeLimit&&(this.sleep(),this.dispatchEvent(Body.sleepEvent))}}updateSolveMassProperties(){this.sleepState===Body.SLEEPING||this.type===Body.KINEMATIC?(this.invMassSolve=0,this.invInertiaSolve.setZero(),this.invInertiaWorldSolve.setZero()):(this.invMassSolve=this.invMass,this.invInertiaSolve.copy(this.invInertia),this.invInertiaWorldSolve.copy(this.invInertiaWorld))}pointToLocalFrame(o,c){return c===void 0&&(c=new Vec3),o.vsub(this.position,c),this.quaternion.conjugate().vmult(c,c),c}vectorToLocalFrame(o,c){return c===void 0&&(c=new Vec3),this.quaternion.conjugate().vmult(o,c),c}pointToWorldFrame(o,c){return c===void 0&&(c=new Vec3),this.quaternion.vmult(o,c),c.vadd(this.position,c),c}vectorToWorldFrame(o,c){return c===void 0&&(c=new Vec3),this.quaternion.vmult(o,c),c}addShape(o,c,d){const _=new Vec3,v=new Quaternion;return c&&_.copy(c),d&&v.copy(d),this.shapes.push(o),this.shapeOffsets.push(_),this.shapeOrientations.push(v),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0,o.body=this,this}removeShape(o){const c=this.shapes.indexOf(o);return c===-1?(console.warn("Shape does not belong to the body"),this):(this.shapes.splice(c,1),this.shapeOffsets.splice(c,1),this.shapeOrientations.splice(c,1),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0,o.body=null,this)}updateBoundingRadius(){const o=this.shapes,c=this.shapeOffsets,d=o.length;let _=0;for(let v=0;v!==d;v++){const b=o[v];b.updateBoundingSphereRadius();const tt=c[v].length(),it=b.boundingSphereRadius;tt+it>_&&(_=tt+it)}this.boundingRadius=_}updateAABB(){const o=this.shapes,c=this.shapeOffsets,d=this.shapeOrientations,_=o.length,v=tmpVec,b=tmpQuat,tt=this.quaternion,it=this.aabb,nt=updateAABB_shapeAABB;for(let lt=0;lt!==_;lt++){const ut=o[lt];tt.vmult(c[lt],v),v.vadd(this.position,v),tt.mult(d[lt],b),ut.calculateWorldAABB(v,b,nt.lowerBound,nt.upperBound),lt===0?it.copy(nt):it.extend(nt)}this.aabbNeedsUpdate=!1}updateInertiaWorld(o){const c=this.invInertia;if(c.x!==c.y||c.y!==c.z||o){const d=uiw_m1,_=uiw_m2;d.setRotationFromQuaternion(this.quaternion),d.transpose(_),d.scale(c,d),d.mmult(_,this.invInertiaWorld)}}applyForce(o,c){if(c===void 0&&(c=new Vec3),this.type!==Body.DYNAMIC)return;this.sleepState===Body.SLEEPING&&this.wakeUp();const d=Body_applyForce_rotForce;c.cross(o,d),this.force.vadd(o,this.force),this.torque.vadd(d,this.torque)}applyLocalForce(o,c){if(c===void 0&&(c=new Vec3),this.type!==Body.DYNAMIC)return;const d=Body_applyLocalForce_worldForce,_=Body_applyLocalForce_relativePointWorld;this.vectorToWorldFrame(o,d),this.vectorToWorldFrame(c,_),this.applyForce(d,_)}applyTorque(o){this.type===Body.DYNAMIC&&(this.sleepState===Body.SLEEPING&&this.wakeUp(),this.torque.vadd(o,this.torque))}applyImpulse(o,c){if(c===void 0&&(c=new Vec3),this.type!==Body.DYNAMIC)return;this.sleepState===Body.SLEEPING&&this.wakeUp();const d=c,_=Body_applyImpulse_velo;_.copy(o),_.scale(this.invMass,_),this.velocity.vadd(_,this.velocity);const v=Body_applyImpulse_rotVelo;d.cross(o,v),this.invInertiaWorld.vmult(v,v),this.angularVelocity.vadd(v,this.angularVelocity)}applyLocalImpulse(o,c){if(c===void 0&&(c=new Vec3),this.type!==Body.DYNAMIC)return;const d=Body_applyLocalImpulse_worldImpulse,_=Body_applyLocalImpulse_relativePoint;this.vectorToWorldFrame(o,d),this.vectorToWorldFrame(c,_),this.applyImpulse(d,_)}updateMassProperties(){const o=Body_updateMassProperties_halfExtents;this.invMass=this.mass>0?1/this.mass:0;const c=this.inertia,d=this.fixedRotation;this.updateAABB(),o.set((this.aabb.upperBound.x-this.aabb.lowerBound.x)/2,(this.aabb.upperBound.y-this.aabb.lowerBound.y)/2,(this.aabb.upperBound.z-this.aabb.lowerBound.z)/2),Box.calculateInertia(o,this.mass,c),this.invInertia.set(c.x>0&&!d?1/c.x:0,c.y>0&&!d?1/c.y:0,c.z>0&&!d?1/c.z:0),this.updateInertiaWorld(!0)}getVelocityAtWorldPoint(o,c){const d=new Vec3;return o.vsub(this.position,d),this.angularVelocity.cross(d,c),this.velocity.vadd(c,c),c}integrate(o,c,d){if(this.previousPosition.copy(this.position),this.previousQuaternion.copy(this.quaternion),this.type!==Body.DYNAMIC&&this.type!==Body.KINEMATIC||this.sleepState===Body.SLEEPING)return;const _=this.velocity,v=this.angularVelocity,b=this.position,tt=this.force,it=this.torque,nt=this.quaternion,lt=this.invMass,ut=this.invInertiaWorld,ht=this.linearFactor,_t=lt*o;_.x+=tt.x*_t*ht.x,_.y+=tt.y*_t*ht.y,_.z+=tt.z*_t*ht.z;const ft=ut.elements,bt=this.angularFactor,xt=it.x*bt.x,St=it.y*bt.y,wt=it.z*bt.z;v.x+=o*(ft[0]*xt+ft[1]*St+ft[2]*wt),v.y+=o*(ft[3]*xt+ft[4]*St+ft[5]*wt),v.z+=o*(ft[6]*xt+ft[7]*St+ft[8]*wt),b.x+=_.x*o,b.y+=_.y*o,b.z+=_.z*o,nt.integrate(this.angularVelocity,o,this.angularFactor,nt),c&&(d?nt.normalizeFast():nt.normalize()),this.aabbNeedsUpdate=!0,this.updateInertiaWorld()}}Body.idCounter=0,Body.COLLIDE_EVENT_NAME="collide",Body.DYNAMIC=BODY_TYPES.DYNAMIC,Body.STATIC=BODY_TYPES.STATIC,Body.KINEMATIC=BODY_TYPES.KINEMATIC,Body.AWAKE=BODY_SLEEP_STATES.AWAKE,Body.SLEEPY=BODY_SLEEP_STATES.SLEEPY,Body.SLEEPING=BODY_SLEEP_STATES.SLEEPING,Body.wakeupEvent={type:"wakeup"},Body.sleepyEvent={type:"sleepy"},Body.sleepEvent={type:"sleep"};const tmpVec=new Vec3,tmpQuat=new Quaternion,updateAABB_shapeAABB=new AABB,uiw_m1=new Mat3,uiw_m2=new Mat3;new Mat3;const Body_applyForce_rotForce=new Vec3,Body_applyLocalForce_worldForce=new Vec3,Body_applyLocalForce_relativePointWorld=new Vec3,Body_applyImpulse_velo=new Vec3,Body_applyImpulse_rotVelo=new Vec3,Body_applyLocalImpulse_worldImpulse=new Vec3,Body_applyLocalImpulse_relativePoint=new Vec3,Body_updateMassProperties_halfExtents=new Vec3;class Broadphase{constructor(){this.world=null,this.useBoundingBoxes=!1,this.dirty=!0}collisionPairs(o,c,d){throw new Error("collisionPairs not implemented for this BroadPhase class!")}needBroadphaseCollision(o,c){return!(!(o.collisionFilterGroup&c.collisionFilterMask&&c.collisionFilterGroup&o.collisionFilterMask)||(o.type&Body.STATIC||o.sleepState===Body.SLEEPING)&&(c.type&Body.STATIC||c.sleepState===Body.SLEEPING))}intersectionTest(o,c,d,_){this.useBoundingBoxes?this.doBoundingBoxBroadphase(o,c,d,_):this.doBoundingSphereBroadphase(o,c,d,_)}doBoundingSphereBroadphase(o,c,d,_){const v=Broadphase_collisionPairs_r;c.position.vsub(o.position,v);const b=(o.boundingRadius+c.boundingRadius)**2;v.lengthSquared()<b&&(d.push(o),_.push(c))}doBoundingBoxBroadphase(o,c,d,_){o.aabbNeedsUpdate&&o.updateAABB(),c.aabbNeedsUpdate&&c.updateAABB(),o.aabb.overlaps(c.aabb)&&(d.push(o),_.push(c))}makePairsUnique(o,c){const d=Broadphase_makePairsUnique_temp,_=Broadphase_makePairsUnique_p1,v=Broadphase_makePairsUnique_p2,b=o.length;for(let tt=0;tt!==b;tt++)_[tt]=o[tt],v[tt]=c[tt];o.length=0,c.length=0;for(let tt=0;tt!==b;tt++){const it=_[tt].id,nt=v[tt].id,lt=it<nt?`${it},${nt}`:`${nt},${it}`;d[lt]=tt,d.keys.push(lt)}for(let tt=0;tt!==d.keys.length;tt++){const it=d.keys.pop(),nt=d[it];o.push(_[nt]),c.push(v[nt]),delete d[it]}}setWorld(o){}static boundingSphereCheck(o,c){const d=new Vec3;o.position.vsub(c.position,d);const _=o.shapes[0],v=c.shapes[0];return Math.pow(_.boundingSphereRadius+v.boundingSphereRadius,2)>d.lengthSquared()}aabbQuery(o,c,d){return console.warn(".aabbQuery is not implemented in this Broadphase subclass."),[]}}const Broadphase_collisionPairs_r=new Vec3;new Vec3,new Quaternion,new Vec3;const Broadphase_makePairsUnique_temp={keys:[]},Broadphase_makePairsUnique_p1=[],Broadphase_makePairsUnique_p2=[];new Vec3;new Vec3;new Vec3;class NaiveBroadphase extends Broadphase{constructor(){super()}collisionPairs(o,c,d){const _=o.bodies,v=_.length;let b,tt;for(let it=0;it!==v;it++)for(let nt=0;nt!==it;nt++)b=_[it],tt=_[nt],this.needBroadphaseCollision(b,tt)&&this.intersectionTest(b,tt,c,d)}aabbQuery(o,c,d){d===void 0&&(d=[]);for(let _=0;_<o.bodies.length;_++){const v=o.bodies[_];v.aabbNeedsUpdate&&v.updateAABB(),v.aabb.overlaps(c)&&d.push(v)}return d}}class RaycastResult{constructor(){this.rayFromWorld=new Vec3,this.rayToWorld=new Vec3,this.hitNormalWorld=new Vec3,this.hitPointWorld=new Vec3,this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}reset(){this.rayFromWorld.setZero(),this.rayToWorld.setZero(),this.hitNormalWorld.setZero(),this.hitPointWorld.setZero(),this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}abort(){this.shouldStop=!0}set(o,c,d,_,v,b,tt){this.rayFromWorld.copy(o),this.rayToWorld.copy(c),this.hitNormalWorld.copy(d),this.hitPointWorld.copy(_),this.shape=v,this.body=b,this.distance=tt}}let _Shape$types$SPHERE,_Shape$types$PLANE,_Shape$types$BOX,_Shape$types$CYLINDER,_Shape$types$CONVEXPO,_Shape$types$HEIGHTFI,_Shape$types$TRIMESH;const RAY_MODES={CLOSEST:1,ANY:2,ALL:4};_Shape$types$SPHERE=Shape.types.SPHERE,_Shape$types$PLANE=Shape.types.PLANE,_Shape$types$BOX=Shape.types.BOX,_Shape$types$CYLINDER=Shape.types.CYLINDER,_Shape$types$CONVEXPO=Shape.types.CONVEXPOLYHEDRON,_Shape$types$HEIGHTFI=Shape.types.HEIGHTFIELD,_Shape$types$TRIMESH=Shape.types.TRIMESH;class Ray{get[_Shape$types$SPHERE](){return this._intersectSphere}get[_Shape$types$PLANE](){return this._intersectPlane}get[_Shape$types$BOX](){return this._intersectBox}get[_Shape$types$CYLINDER](){return this._intersectConvex}get[_Shape$types$CONVEXPO](){return this._intersectConvex}get[_Shape$types$HEIGHTFI](){return this._intersectHeightfield}get[_Shape$types$TRIMESH](){return this._intersectTrimesh}constructor(o,c){o===void 0&&(o=new Vec3),c===void 0&&(c=new Vec3),this.from=o.clone(),this.to=c.clone(),this.direction=new Vec3,this.precision=1e-4,this.checkCollisionResponse=!0,this.skipBackfaces=!1,this.collisionFilterMask=-1,this.collisionFilterGroup=-1,this.mode=Ray.ANY,this.result=new RaycastResult,this.hasHit=!1,this.callback=d=>{}}intersectWorld(o,c){return this.mode=c.mode||Ray.ANY,this.result=c.result||new RaycastResult,this.skipBackfaces=!!c.skipBackfaces,this.collisionFilterMask=c.collisionFilterMask!==void 0?c.collisionFilterMask:-1,this.collisionFilterGroup=c.collisionFilterGroup!==void 0?c.collisionFilterGroup:-1,this.checkCollisionResponse=c.checkCollisionResponse===void 0||c.checkCollisionResponse,c.from&&this.from.copy(c.from),c.to&&this.to.copy(c.to),this.callback=c.callback||(()=>{}),this.hasHit=!1,this.result.reset(),this.updateDirection(),this.getAABB(tmpAABB$1),tmpArray.length=0,o.broadphase.aabbQuery(o,tmpAABB$1,tmpArray),this.intersectBodies(tmpArray),this.hasHit}intersectBody(o,c){c&&(this.result=c,this.updateDirection());const d=this.checkCollisionResponse;if(d&&!o.collisionResponse||!(this.collisionFilterGroup&o.collisionFilterMask&&o.collisionFilterGroup&this.collisionFilterMask))return;const _=intersectBody_xi,v=intersectBody_qi;for(let b=0,tt=o.shapes.length;b<tt;b++){const it=o.shapes[b];if((!d||it.collisionResponse)&&(o.quaternion.mult(o.shapeOrientations[b],v),o.quaternion.vmult(o.shapeOffsets[b],_),_.vadd(o.position,_),this.intersectShape(it,v,_,o),this.result.shouldStop))break}}intersectBodies(o,c){c&&(this.result=c,this.updateDirection());for(let d=0,_=o.length;!this.result.shouldStop&&d<_;d++)this.intersectBody(o[d])}updateDirection(){this.to.vsub(this.from,this.direction),this.direction.normalize()}intersectShape(o,c,d,_){if(distanceFromIntersection(this.from,this.direction,d)>o.boundingSphereRadius)return;const v=this[o.type];v&&v.call(this,o,c,d,_,o)}_intersectBox(o,c,d,_,v){return this._intersectConvex(o.convexPolyhedronRepresentation,c,d,_,v)}_intersectPlane(o,c,d,_,v){const b=this.from,tt=this.to,it=this.direction,nt=new Vec3(0,0,1);c.vmult(nt,nt);const lt=new Vec3;b.vsub(d,lt);const ut=lt.dot(nt);if(tt.vsub(d,lt),ut*lt.dot(nt)>0||b.distanceTo(tt)<ut)return;const ht=nt.dot(it);if(Math.abs(ht)<this.precision)return;const _t=new Vec3,ft=new Vec3,bt=new Vec3;b.vsub(d,_t);const xt=-nt.dot(_t)/ht;it.scale(xt,ft),b.vadd(ft,bt),this.reportIntersection(nt,bt,v,_,-1)}getAABB(o){const{lowerBound:c,upperBound:d}=o,_=this.to,v=this.from;c.x=Math.min(_.x,v.x),c.y=Math.min(_.y,v.y),c.z=Math.min(_.z,v.z),d.x=Math.max(_.x,v.x),d.y=Math.max(_.y,v.y),d.z=Math.max(_.z,v.z)}_intersectHeightfield(o,c,d,_,v){o.data,o.elementSize;const b=intersectHeightfield_localRay;b.from.copy(this.from),b.to.copy(this.to),cannon_es_Transform.pointToLocalFrame(d,c,b.from,b.from),cannon_es_Transform.pointToLocalFrame(d,c,b.to,b.to),b.updateDirection();const tt=intersectHeightfield_index;let it,nt,lt,ut;it=nt=0,lt=ut=o.data.length-1;const ht=new AABB;b.getAABB(ht),o.getIndexOfPosition(ht.lowerBound.x,ht.lowerBound.y,tt,!0),it=Math.max(it,tt[0]),nt=Math.max(nt,tt[1]),o.getIndexOfPosition(ht.upperBound.x,ht.upperBound.y,tt,!0),lt=Math.min(lt,tt[0]+1),ut=Math.min(ut,tt[1]+1);for(let _t=it;_t<lt;_t++)for(let ft=nt;ft<ut;ft++){if(this.result.shouldStop)return;if(o.getAabbAtIndex(_t,ft,ht),ht.overlapsRay(b)){if(o.getConvexTrianglePillar(_t,ft,!1),cannon_es_Transform.pointToWorldFrame(d,c,o.pillarOffset,worldPillarOffset),this._intersectConvex(o.pillarConvex,c,worldPillarOffset,_,v,intersectConvexOptions),this.result.shouldStop)return;o.getConvexTrianglePillar(_t,ft,!0),cannon_es_Transform.pointToWorldFrame(d,c,o.pillarOffset,worldPillarOffset),this._intersectConvex(o.pillarConvex,c,worldPillarOffset,_,v,intersectConvexOptions)}}}_intersectSphere(o,c,d,_,v){const b=this.from,tt=this.to,it=o.radius,nt=(tt.x-b.x)**2+(tt.y-b.y)**2+(tt.z-b.z)**2,lt=2*((tt.x-b.x)*(b.x-d.x)+(tt.y-b.y)*(b.y-d.y)+(tt.z-b.z)*(b.z-d.z)),ut=lt**2-4*nt*((b.x-d.x)**2+(b.y-d.y)**2+(b.z-d.z)**2-it**2),ht=Ray_intersectSphere_intersectionPoint,_t=Ray_intersectSphere_normal;if(!(ut<0))if(ut===0)b.lerp(tt,ut,ht),ht.vsub(d,_t),_t.normalize(),this.reportIntersection(_t,ht,v,_,-1);else{const ft=(-lt-Math.sqrt(ut))/(2*nt),bt=(-lt+Math.sqrt(ut))/(2*nt);if(ft>=0&&ft<=1&&(b.lerp(tt,ft,ht),ht.vsub(d,_t),_t.normalize(),this.reportIntersection(_t,ht,v,_,-1)),this.result.shouldStop)return;bt>=0&&bt<=1&&(b.lerp(tt,bt,ht),ht.vsub(d,_t),_t.normalize(),this.reportIntersection(_t,ht,v,_,-1))}}_intersectConvex(o,c,d,_,v,b){const tt=intersectConvex_normal,it=intersectConvex_vector,nt=b&&b.faceList||null,lt=o.faces,ut=o.vertices,ht=o.faceNormals,_t=this.direction,ft=this.from,bt=this.to,xt=ft.distanceTo(bt),St=nt?nt.length:lt.length,wt=this.result;for(let Pt=0;!wt.shouldStop&&Pt<St;Pt++){const Rt=nt?nt[Pt]:Pt,kt=lt[Rt],Gt=ht[Rt],Dt=c,It=d;it.copy(ut[kt[0]]),Dt.vmult(it,it),it.vadd(It,it),it.vsub(ft,it),Dt.vmult(Gt,tt);const Nt=_t.dot(tt);if(Math.abs(Nt)<this.precision)continue;const Vt=tt.dot(it)/Nt;if(!(Vt<0)){_t.scale(Vt,intersectPoint),intersectPoint.vadd(ft,intersectPoint),cannon_es_a.copy(ut[kt[0]]),Dt.vmult(cannon_es_a,cannon_es_a),It.vadd(cannon_es_a,cannon_es_a);for(let Kt=1;!wt.shouldStop&&Kt<kt.length-1;Kt++){cannon_es_b.copy(ut[kt[Kt]]),cannon_es_c.copy(ut[kt[Kt+1]]),Dt.vmult(cannon_es_b,cannon_es_b),Dt.vmult(cannon_es_c,cannon_es_c),It.vadd(cannon_es_b,cannon_es_b),It.vadd(cannon_es_c,cannon_es_c);const Yt=intersectPoint.distanceTo(ft);!Ray.pointInTriangle(intersectPoint,cannon_es_a,cannon_es_b,cannon_es_c)&&!Ray.pointInTriangle(intersectPoint,cannon_es_b,cannon_es_a,cannon_es_c)||Yt>xt||this.reportIntersection(tt,intersectPoint,v,_,Rt)}}}}_intersectTrimesh(o,c,d,_,v,b){const tt=intersectTrimesh_normal,it=intersectTrimesh_triangles,nt=intersectTrimesh_treeTransform,lt=intersectConvex_vector,ut=intersectTrimesh_localDirection,ht=intersectTrimesh_localFrom,_t=intersectTrimesh_localTo,ft=intersectTrimesh_worldIntersectPoint,bt=intersectTrimesh_worldNormal,xt=o.indices;o.vertices;const St=this.from,wt=this.to,Pt=this.direction;nt.position.copy(d),nt.quaternion.copy(c),cannon_es_Transform.vectorToLocalFrame(d,c,Pt,ut),cannon_es_Transform.pointToLocalFrame(d,c,St,ht),cannon_es_Transform.pointToLocalFrame(d,c,wt,_t),_t.x*=o.scale.x,_t.y*=o.scale.y,_t.z*=o.scale.z,ht.x*=o.scale.x,ht.y*=o.scale.y,ht.z*=o.scale.z,_t.vsub(ht,ut),ut.normalize();const Rt=ht.distanceSquared(_t);o.tree.rayQuery(this,nt,it);for(let kt=0,Gt=it.length;!this.result.shouldStop&&kt!==Gt;kt++){const Dt=it[kt];o.getNormal(Dt,tt),o.getVertex(xt[3*Dt],cannon_es_a),cannon_es_a.vsub(ht,lt);const It=ut.dot(tt),Nt=tt.dot(lt)/It;if(Nt<0)continue;ut.scale(Nt,intersectPoint),intersectPoint.vadd(ht,intersectPoint),o.getVertex(xt[3*Dt+1],cannon_es_b),o.getVertex(xt[3*Dt+2],cannon_es_c);const Vt=intersectPoint.distanceSquared(ht);!Ray.pointInTriangle(intersectPoint,cannon_es_b,cannon_es_a,cannon_es_c)&&!Ray.pointInTriangle(intersectPoint,cannon_es_a,cannon_es_b,cannon_es_c)||Vt>Rt||(cannon_es_Transform.vectorToWorldFrame(c,tt,bt),cannon_es_Transform.pointToWorldFrame(d,c,intersectPoint,ft),this.reportIntersection(bt,ft,v,_,Dt))}it.length=0}reportIntersection(o,c,d,_,v){const b=this.from,tt=this.to,it=b.distanceTo(c),nt=this.result;if(!(this.skipBackfaces&&o.dot(this.direction)>0))switch(nt.hitFaceIndex=v!==void 0?v:-1,this.mode){case Ray.ALL:this.hasHit=!0,nt.set(b,tt,o,c,d,_,it),nt.hasHit=!0,this.callback(nt);break;case Ray.CLOSEST:(it<nt.distance||!nt.hasHit)&&(this.hasHit=!0,nt.hasHit=!0,nt.set(b,tt,o,c,d,_,it));break;case Ray.ANY:this.hasHit=!0,nt.hasHit=!0,nt.set(b,tt,o,c,d,_,it),nt.shouldStop=!0}}static pointInTriangle(o,c,d,_){_.vsub(c,v0),d.vsub(c,v1),o.vsub(c,v2);const v=v0.dot(v0),b=v0.dot(v1),tt=v0.dot(v2),it=v1.dot(v1),nt=v1.dot(v2);let lt,ut;return(lt=it*tt-b*nt)>=0&&(ut=v*nt-b*tt)>=0&&lt+ut<v*it-b*b}}Ray.CLOSEST=RAY_MODES.CLOSEST,Ray.ANY=RAY_MODES.ANY,Ray.ALL=RAY_MODES.ALL;const tmpAABB$1=new AABB,tmpArray=[],v1=new Vec3,v2=new Vec3,intersectBody_xi=new Vec3,intersectBody_qi=new Quaternion,intersectPoint=new Vec3,cannon_es_a=new Vec3,cannon_es_b=new Vec3,cannon_es_c=new Vec3;new Vec3,new RaycastResult;const intersectConvexOptions={faceList:[0]},worldPillarOffset=new Vec3,intersectHeightfield_localRay=new Ray,intersectHeightfield_index=[],Ray_intersectSphere_intersectionPoint=new Vec3,Ray_intersectSphere_normal=new Vec3,intersectConvex_normal=new Vec3;new Vec3;new Vec3;const intersectConvex_vector=new Vec3,intersectTrimesh_normal=new Vec3,intersectTrimesh_localDirection=new Vec3,intersectTrimesh_localFrom=new Vec3,intersectTrimesh_localTo=new Vec3,intersectTrimesh_worldNormal=new Vec3,intersectTrimesh_worldIntersectPoint=new Vec3;new AABB;const intersectTrimesh_triangles=[],intersectTrimesh_treeTransform=new cannon_es_Transform,v0=new Vec3,intersect=new Vec3;function distanceFromIntersection(h,o,c){c.vsub(h,v0);const d=v0.dot(o);return o.scale(d,intersect),intersect.vadd(h,intersect),c.distanceTo(intersect)}class Utils{static defaults(o,c){o===void 0&&(o={});for(let d in c)d in o||(o[d]=c[d]);return o}}class Constraint{constructor(o,c,d){d===void 0&&(d={}),d=Utils.defaults(d,{collideConnected:!0,wakeUpBodies:!0}),this.equations=[],this.bodyA=o,this.bodyB=c,this.id=Constraint.idCounter++,this.collideConnected=d.collideConnected,d.wakeUpBodies&&(o&&o.wakeUp(),c&&c.wakeUp())}update(){throw new Error("method update() not implmemented in this Constraint subclass!")}enable(){const o=this.equations;for(let c=0;c<o.length;c++)o[c].enabled=!0}disable(){const o=this.equations;for(let c=0;c<o.length;c++)o[c].enabled=!1}}Constraint.idCounter=0;class JacobianElement{constructor(){this.spatial=new Vec3,this.rotational=new Vec3}multiplyElement(o){return o.spatial.dot(this.spatial)+o.rotational.dot(this.rotational)}multiplyVectors(o,c){return o.dot(this.spatial)+c.dot(this.rotational)}}class Equation{constructor(o,c,d,_){d===void 0&&(d=-1e6),_===void 0&&(_=1e6),this.id=Equation.idCounter++,this.minForce=d,this.maxForce=_,this.bi=o,this.bj=c,this.a=0,this.b=0,this.eps=0,this.jacobianElementA=new JacobianElement,this.jacobianElementB=new JacobianElement,this.enabled=!0,this.multiplier=0,this.setSpookParams(1e7,4,1/60)}setSpookParams(o,c,d){const _=c,v=o,b=d;this.a=4/(b*(1+4*_)),this.b=4*_/(1+4*_),this.eps=4/(b*b*v*(1+4*_))}computeB(o,c,d){const _=this.computeGW();return-this.computeGq()*o-_*c-this.computeGiMf()*d}computeGq(){const o=this.jacobianElementA,c=this.jacobianElementB,d=this.bi,_=this.bj,v=d.position,b=_.position;return o.spatial.dot(v)+c.spatial.dot(b)}computeGW(){const o=this.jacobianElementA,c=this.jacobianElementB,d=this.bi,_=this.bj,v=d.velocity,b=_.velocity,tt=d.angularVelocity,it=_.angularVelocity;return o.multiplyVectors(v,tt)+c.multiplyVectors(b,it)}computeGWlambda(){const o=this.jacobianElementA,c=this.jacobianElementB,d=this.bi,_=this.bj,v=d.vlambda,b=_.vlambda,tt=d.wlambda,it=_.wlambda;return o.multiplyVectors(v,tt)+c.multiplyVectors(b,it)}computeGiMf(){const o=this.jacobianElementA,c=this.jacobianElementB,d=this.bi,_=this.bj,v=d.force,b=d.torque,tt=_.force,it=_.torque,nt=d.invMassSolve,lt=_.invMassSolve;return v.scale(nt,iMfi),tt.scale(lt,iMfj),d.invInertiaWorldSolve.vmult(b,invIi_vmult_taui),_.invInertiaWorldSolve.vmult(it,invIj_vmult_tauj),o.multiplyVectors(iMfi,invIi_vmult_taui)+c.multiplyVectors(iMfj,invIj_vmult_tauj)}computeGiMGt(){const o=this.jacobianElementA,c=this.jacobianElementB,d=this.bi,_=this.bj,v=d.invMassSolve,b=_.invMassSolve,tt=d.invInertiaWorldSolve,it=_.invInertiaWorldSolve;let nt=v+b;return tt.vmult(o.rotational,tmp),nt+=tmp.dot(o.rotational),it.vmult(c.rotational,tmp),nt+=tmp.dot(c.rotational),nt}addToWlambda(o){const c=this.jacobianElementA,d=this.jacobianElementB,_=this.bi,v=this.bj,b=addToWlambda_temp;_.vlambda.addScaledVector(_.invMassSolve*o,c.spatial,_.vlambda),v.vlambda.addScaledVector(v.invMassSolve*o,d.spatial,v.vlambda),_.invInertiaWorldSolve.vmult(c.rotational,b),_.wlambda.addScaledVector(o,b,_.wlambda),v.invInertiaWorldSolve.vmult(d.rotational,b),v.wlambda.addScaledVector(o,b,v.wlambda)}computeC(){return this.computeGiMGt()+this.eps}}Equation.idCounter=0;const iMfi=new Vec3,iMfj=new Vec3,invIi_vmult_taui=new Vec3,invIj_vmult_tauj=new Vec3,tmp=new Vec3,addToWlambda_temp=new Vec3;class ContactEquation extends Equation{constructor(o,c,d){d===void 0&&(d=1e6),super(o,c,0,d),this.restitution=0,this.ri=new Vec3,this.rj=new Vec3,this.ni=new Vec3}computeB(o){const c=this.a,d=this.b,_=this.bi,v=this.bj,b=this.ri,tt=this.rj,it=ContactEquation_computeB_temp1,nt=ContactEquation_computeB_temp2,lt=_.velocity,ut=_.angularVelocity;_.force,_.torque;const ht=v.velocity,_t=v.angularVelocity;v.force,v.torque;const ft=ContactEquation_computeB_temp3,bt=this.jacobianElementA,xt=this.jacobianElementB,St=this.ni;b.cross(St,it),tt.cross(St,nt),St.negate(bt.spatial),it.negate(bt.rotational),xt.spatial.copy(St),xt.rotational.copy(nt),ft.copy(v.position),ft.vadd(tt,ft),ft.vsub(_.position,ft),ft.vsub(b,ft);const wt=St.dot(ft),Pt=this.restitution+1;return-wt*c-(Pt*ht.dot(St)-Pt*lt.dot(St)+_t.dot(nt)-ut.dot(it))*d-o*this.computeGiMf()}getImpactVelocityAlongNormal(){const o=ContactEquation_getImpactVelocityAlongNormal_vi,c=ContactEquation_getImpactVelocityAlongNormal_vj,d=ContactEquation_getImpactVelocityAlongNormal_xi,_=ContactEquation_getImpactVelocityAlongNormal_xj,v=ContactEquation_getImpactVelocityAlongNormal_relVel;return this.bi.position.vadd(this.ri,d),this.bj.position.vadd(this.rj,_),this.bi.getVelocityAtWorldPoint(d,o),this.bj.getVelocityAtWorldPoint(_,c),o.vsub(c,v),this.ni.dot(v)}}const ContactEquation_computeB_temp1=new Vec3,ContactEquation_computeB_temp2=new Vec3,ContactEquation_computeB_temp3=new Vec3,ContactEquation_getImpactVelocityAlongNormal_vi=new Vec3,ContactEquation_getImpactVelocityAlongNormal_vj=new Vec3,ContactEquation_getImpactVelocityAlongNormal_xi=new Vec3,ContactEquation_getImpactVelocityAlongNormal_xj=new Vec3,ContactEquation_getImpactVelocityAlongNormal_relVel=new Vec3;class PointToPointConstraint extends Constraint{constructor(o,c,d,_,v){c===void 0&&(c=new Vec3),_===void 0&&(_=new Vec3),v===void 0&&(v=1e6),super(o,d),this.pivotA=c.clone(),this.pivotB=_.clone();const b=this.equationX=new ContactEquation(o,d),tt=this.equationY=new ContactEquation(o,d),it=this.equationZ=new ContactEquation(o,d);this.equations.push(b,tt,it),b.minForce=tt.minForce=it.minForce=-v,b.maxForce=tt.maxForce=it.maxForce=v,b.ni.set(1,0,0),tt.ni.set(0,1,0),it.ni.set(0,0,1)}update(){const o=this.bodyA,c=this.bodyB,d=this.equationX,_=this.equationY,v=this.equationZ;o.quaternion.vmult(this.pivotA,d.ri),c.quaternion.vmult(this.pivotB,d.rj),_.ri.copy(d.ri),_.rj.copy(d.rj),v.ri.copy(d.ri),v.rj.copy(d.rj)}}new Vec3;new Vec3;new Vec3;new Vec3;new Vec3,new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;class FrictionEquation extends Equation{constructor(o,c,d){super(o,c,-d,d),this.ri=new Vec3,this.rj=new Vec3,this.t=new Vec3}computeB(o){this.a;const c=this.b;this.bi,this.bj;const d=this.ri,_=this.rj,v=FrictionEquation_computeB_temp1,b=FrictionEquation_computeB_temp2,tt=this.t;d.cross(tt,v),_.cross(tt,b);const it=this.jacobianElementA,nt=this.jacobianElementB;return tt.negate(it.spatial),v.negate(it.rotational),nt.spatial.copy(tt),nt.rotational.copy(b),-this.computeGW()*c-o*this.computeGiMf()}}const FrictionEquation_computeB_temp1=new Vec3,FrictionEquation_computeB_temp2=new Vec3;class ContactMaterial{constructor(o,c,d){d=Utils.defaults(d,{friction:.3,restitution:.3,contactEquationStiffness:1e7,contactEquationRelaxation:3,frictionEquationStiffness:1e7,frictionEquationRelaxation:3}),this.id=ContactMaterial.idCounter++,this.materials=[o,c],this.friction=d.friction,this.restitution=d.restitution,this.contactEquationStiffness=d.contactEquationStiffness,this.contactEquationRelaxation=d.contactEquationRelaxation,this.frictionEquationStiffness=d.frictionEquationStiffness,this.frictionEquationRelaxation=d.frictionEquationRelaxation}}ContactMaterial.idCounter=0;class cannon_es_Material{constructor(o){o===void 0&&(o={});let c="";typeof o=="string"&&(c=o,o={}),this.name=c,this.id=cannon_es_Material.idCounter++,this.friction=o.friction!==void 0?o.friction:-1,this.restitution=o.restitution!==void 0?o.restitution:-1}}cannon_es_Material.idCounter=0;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3,new Vec3,new Vec3;new Vec3;new Vec3;new Vec3;new Ray,new Vec3;new Vec3;new Vec3;new Vec3(1,0,0),new Vec3(0,1,0),new Vec3(0,0,1);new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;class Sphere extends Shape{constructor(o){if(super({type:Shape.types.SPHERE}),this.radius=o!==void 0?o:1,this.radius<0)throw new Error("The sphere radius cannot be negative.");this.updateBoundingSphereRadius()}calculateLocalInertia(o,c){c===void 0&&(c=new Vec3);const d=2*o*this.radius*this.radius/5;return c.x=d,c.y=d,c.z=d,c}volume(){return 4*Math.PI*Math.pow(this.radius,3)/3}updateBoundingSphereRadius(){this.boundingSphereRadius=this.radius}calculateWorldAABB(o,c,d,_){const v=this.radius,b=["x","y","z"];for(let tt=0;tt<b.length;tt++){const it=b[tt];d[it]=o[it]-v,_[it]=o[it]+v}}}new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;class Cylinder extends ConvexPolyhedron{constructor(o,c,d,_){if(o===void 0&&(o=1),c===void 0&&(c=1),d===void 0&&(d=1),_===void 0&&(_=8),o<0)throw new Error("The cylinder radiusTop cannot be negative.");if(c<0)throw new Error("The cylinder radiusBottom cannot be negative.");const v=_,b=[],tt=[],it=[],nt=[],lt=[],ut=Math.cos,ht=Math.sin;b.push(new Vec3(-c*ht(0),.5*-d,c*ut(0))),nt.push(0),b.push(new Vec3(-o*ht(0),.5*d,o*ut(0))),lt.push(1);for(let ft=0;ft<v;ft++){const bt=2*Math.PI/v*(ft+1),xt=2*Math.PI/v*(ft+.5);ft<v-1?(b.push(new Vec3(-c*ht(bt),.5*-d,c*ut(bt))),nt.push(2*ft+2),b.push(new Vec3(-o*ht(bt),.5*d,o*ut(bt))),lt.push(2*ft+3),it.push([2*ft,2*ft+1,2*ft+3,2*ft+2])):it.push([2*ft,2*ft+1,1,0]),(v%2==1||ft<v/2)&&tt.push(new Vec3(-ht(xt),0,ut(xt)))}it.push(nt),tt.push(new Vec3(0,1,0));const _t=[];for(let ft=0;ft<lt.length;ft++)_t.push(lt[lt.length-ft-1]);it.push(_t),super({vertices:b,faces:it,axes:tt}),this.type=Shape.types.CYLINDER,this.radiusTop=o,this.radiusBottom=c,this.height=d,this.numSegments=_}}class cannon_es_Plane extends Shape{constructor(){super({type:Shape.types.PLANE}),this.worldNormal=new Vec3,this.worldNormalNeedsUpdate=!0,this.boundingSphereRadius=Number.MAX_VALUE}computeWorldNormal(o){const c=this.worldNormal;c.set(0,0,1),o.vmult(c,c),this.worldNormalNeedsUpdate=!1}calculateLocalInertia(o,c){return c===void 0&&(c=new Vec3),c}volume(){return Number.MAX_VALUE}calculateWorldAABB(o,c,d,_){tempNormal.set(0,0,1),c.vmult(tempNormal,tempNormal);const v=Number.MAX_VALUE;d.set(-v,-v,-v),_.set(v,v,v),tempNormal.x===1?_.x=o.x:tempNormal.x===-1&&(d.x=o.x),tempNormal.y===1?_.y=o.y:tempNormal.y===-1&&(d.y=o.y),tempNormal.z===1?_.z=o.z:tempNormal.z===-1&&(d.z=o.z)}updateBoundingSphereRadius(){this.boundingSphereRadius=Number.MAX_VALUE}}const tempNormal=new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;class OctreeNode{constructor(o){o===void 0&&(o={}),this.root=o.root||null,this.aabb=o.aabb?o.aabb.clone():new AABB,this.data=[],this.children=[]}reset(){this.children.length=this.data.length=0}insert(o,c,d){d===void 0&&(d=0);const _=this.data;if(!this.aabb.contains(o))return!1;const v=this.children;if(d<(this.maxDepth||this.root.maxDepth)){let b=!1;v.length||(this.subdivide(),b=!0);for(let tt=0;tt!==8;tt++)if(v[tt].insert(o,c,d+1))return!0;b&&(v.length=0)}return _.push(c),!0}subdivide(){const o=this.aabb,c=o.lowerBound,d=o.upperBound,_=this.children;_.push(new OctreeNode({aabb:new AABB({lowerBound:new Vec3(0,0,0)})}),new OctreeNode({aabb:new AABB({lowerBound:new Vec3(1,0,0)})}),new OctreeNode({aabb:new AABB({lowerBound:new Vec3(1,1,0)})}),new OctreeNode({aabb:new AABB({lowerBound:new Vec3(1,1,1)})}),new OctreeNode({aabb:new AABB({lowerBound:new Vec3(0,1,1)})}),new OctreeNode({aabb:new AABB({lowerBound:new Vec3(0,0,1)})}),new OctreeNode({aabb:new AABB({lowerBound:new Vec3(1,0,1)})}),new OctreeNode({aabb:new AABB({lowerBound:new Vec3(0,1,0)})})),d.vsub(c,halfDiagonal),halfDiagonal.scale(.5,halfDiagonal);const v=this.root||this;for(let b=0;b!==8;b++){const tt=_[b];tt.root=v;const it=tt.aabb.lowerBound;it.x*=halfDiagonal.x,it.y*=halfDiagonal.y,it.z*=halfDiagonal.z,it.vadd(c,it),it.vadd(halfDiagonal,tt.aabb.upperBound)}}aabbQuery(o,c){this.data,this.children;const d=[this];for(;d.length;){const _=d.pop();_.aabb.overlaps(o)&&Array.prototype.push.apply(c,_.data),Array.prototype.push.apply(d,_.children)}return c}rayQuery(o,c,d){return o.getAABB(tmpAABB),tmpAABB.toLocalFrame(c,tmpAABB),this.aabbQuery(tmpAABB,d),d}removeEmptyNodes(){for(let o=this.children.length-1;o>=0;o--)this.children[o].removeEmptyNodes(),this.children[o].children.length||this.children[o].data.length||this.children.splice(o,1)}}class Octree extends OctreeNode{constructor(o,c){c===void 0&&(c={}),super({root:null,aabb:o}),this.maxDepth=c.maxDepth!==void 0?c.maxDepth:8}}const halfDiagonal=new Vec3,tmpAABB=new AABB;class Trimesh extends Shape{constructor(o,c){super({type:Shape.types.TRIMESH}),this.vertices=new Float32Array(o),this.indices=new Int16Array(c),this.normals=new Float32Array(c.length),this.aabb=new AABB,this.edges=null,this.scale=new Vec3(1,1,1),this.tree=new Octree,this.updateEdges(),this.updateNormals(),this.updateAABB(),this.updateBoundingSphereRadius(),this.updateTree()}updateTree(){const o=this.tree;o.reset(),o.aabb.copy(this.aabb);const c=this.scale;o.aabb.lowerBound.x*=1/c.x,o.aabb.lowerBound.y*=1/c.y,o.aabb.lowerBound.z*=1/c.z,o.aabb.upperBound.x*=1/c.x,o.aabb.upperBound.y*=1/c.y,o.aabb.upperBound.z*=1/c.z;const d=new AABB,_=new Vec3,v=new Vec3,b=new Vec3,tt=[_,v,b];for(let it=0;it<this.indices.length/3;it++){const nt=3*it;this._getUnscaledVertex(this.indices[nt],_),this._getUnscaledVertex(this.indices[nt+1],v),this._getUnscaledVertex(this.indices[nt+2],b),d.setFromPoints(tt),o.insert(d,it)}o.removeEmptyNodes()}getTrianglesInAABB(o,c){unscaledAABB.copy(o);const d=this.scale,_=d.x,v=d.y,b=d.z,tt=unscaledAABB.lowerBound,it=unscaledAABB.upperBound;return tt.x/=_,tt.y/=v,tt.z/=b,it.x/=_,it.y/=v,it.z/=b,this.tree.aabbQuery(unscaledAABB,c)}setScale(o){const c=this.scale.x===this.scale.y&&this.scale.y===this.scale.z,d=o.x===o.y&&o.y===o.z;c&&d||this.updateNormals(),this.scale.copy(o),this.updateAABB(),this.updateBoundingSphereRadius()}updateNormals(){const o=computeNormals_n,c=this.normals;for(let d=0;d<this.indices.length/3;d++){const _=3*d,v=this.indices[_],b=this.indices[_+1],tt=this.indices[_+2];this.getVertex(v,va$1),this.getVertex(b,vb$1),this.getVertex(tt,vc$1),Trimesh.computeNormal(vb$1,va$1,vc$1,o),c[_]=o.x,c[_+1]=o.y,c[_+2]=o.z}}updateEdges(){const o={},c=(_,v)=>{o[_<v?`${_}_${v}`:`${v}_${_}`]=!0};for(let _=0;_<this.indices.length/3;_++){const v=3*_,b=this.indices[v],tt=this.indices[v+1],it=this.indices[v+2];c(b,tt),c(tt,it),c(it,b)}const d=Object.keys(o);this.edges=new Int16Array(2*d.length);for(let _=0;_<d.length;_++){const v=d[_].split("_");this.edges[2*_]=parseInt(v[0],10),this.edges[2*_+1]=parseInt(v[1],10)}}getEdgeVertex(o,c,d){const _=this.edges[2*o+(c?1:0)];this.getVertex(_,d)}getEdgeVector(o,c){const d=getEdgeVector_va,_=getEdgeVector_vb;this.getEdgeVertex(o,0,d),this.getEdgeVertex(o,1,_),_.vsub(d,c)}static computeNormal(o,c,d,_){c.vsub(o,ab$1),d.vsub(c,cannon_es_cb),cannon_es_cb.cross(ab$1,_),_.isZero()||_.normalize()}getVertex(o,c){const d=this.scale;return this._getUnscaledVertex(o,c),c.x*=d.x,c.y*=d.y,c.z*=d.z,c}_getUnscaledVertex(o,c){const d=3*o,_=this.vertices;return c.set(_[d],_[d+1],_[d+2])}getWorldVertex(o,c,d,_){return this.getVertex(o,_),cannon_es_Transform.pointToWorldFrame(c,d,_,_),_}getTriangleVertices(o,c,d,_){const v=3*o;this.getVertex(this.indices[v],c),this.getVertex(this.indices[v+1],d),this.getVertex(this.indices[v+2],_)}getNormal(o,c){const d=3*o;return c.set(this.normals[d],this.normals[d+1],this.normals[d+2])}calculateLocalInertia(o,c){this.computeLocalAABB(cli_aabb);const d=cli_aabb.upperBound.x-cli_aabb.lowerBound.x,_=cli_aabb.upperBound.y-cli_aabb.lowerBound.y,v=cli_aabb.upperBound.z-cli_aabb.lowerBound.z;return c.set(1/12*o*(2*_*2*_+2*v*2*v),1/12*o*(2*d*2*d+2*v*2*v),1/12*o*(2*_*2*_+2*d*2*d))}computeLocalAABB(o){const c=o.lowerBound,d=o.upperBound,_=this.vertices.length;this.vertices;const v=computeLocalAABB_worldVert;this.getVertex(0,v),c.copy(v),d.copy(v);for(let b=0;b!==_;b++)this.getVertex(b,v),v.x<c.x?c.x=v.x:v.x>d.x&&(d.x=v.x),v.y<c.y?c.y=v.y:v.y>d.y&&(d.y=v.y),v.z<c.z?c.z=v.z:v.z>d.z&&(d.z=v.z)}updateAABB(){this.computeLocalAABB(this.aabb)}updateBoundingSphereRadius(){let o=0;const c=this.vertices,d=new Vec3;for(let _=0,v=c.length/3;_!==v;_++){this.getVertex(_,d);const b=d.lengthSquared();b>o&&(o=b)}this.boundingSphereRadius=Math.sqrt(o)}calculateWorldAABB(o,c,d,_){const v=calculateWorldAABB_frame,b=calculateWorldAABB_aabb;v.position=o,v.quaternion=c,this.aabb.toWorldFrame(v,b),d.copy(b.lowerBound),_.copy(b.upperBound)}volume(){return 4*Math.PI*this.boundingSphereRadius/3}static createTorus(o,c,d,_,v){o===void 0&&(o=1),c===void 0&&(c=.5),d===void 0&&(d=8),_===void 0&&(_=6),v===void 0&&(v=2*Math.PI);const b=[],tt=[];for(let it=0;it<=d;it++)for(let nt=0;nt<=_;nt++){const lt=nt/_*v,ut=it/d*Math.PI*2,ht=(o+c*Math.cos(ut))*Math.cos(lt),_t=(o+c*Math.cos(ut))*Math.sin(lt),ft=c*Math.sin(ut);b.push(ht,_t,ft)}for(let it=1;it<=d;it++)for(let nt=1;nt<=_;nt++){const lt=(_+1)*it+nt-1,ut=(_+1)*(it-1)+nt-1,ht=(_+1)*(it-1)+nt,_t=(_+1)*it+nt;tt.push(lt,ut,_t),tt.push(ut,ht,_t)}return new Trimesh(b,tt)}}const computeNormals_n=new Vec3,unscaledAABB=new AABB,getEdgeVector_va=new Vec3,getEdgeVector_vb=new Vec3,cannon_es_cb=new Vec3,ab$1=new Vec3,va$1=new Vec3,vb$1=new Vec3,vc$1=new Vec3,cli_aabb=new AABB,computeLocalAABB_worldVert=new Vec3,calculateWorldAABB_frame=new cannon_es_Transform,calculateWorldAABB_aabb=new AABB;class Solver{constructor(){this.equations=[]}solve(o,c){return 0}addEquation(o){!o.enabled||o.bi.isTrigger||o.bj.isTrigger||this.equations.push(o)}removeEquation(o){const c=this.equations,d=c.indexOf(o);d!==-1&&c.splice(d,1)}removeAllEquations(){this.equations.length=0}}class GSSolver extends Solver{constructor(){super(),this.iterations=10,this.tolerance=1e-7}solve(o,c){let d=0;const _=this.iterations,v=this.tolerance*this.tolerance,b=this.equations,tt=b.length,it=c.bodies,nt=it.length,lt=o;let ut,ht,_t,ft,bt,xt;if(tt!==0)for(let Rt=0;Rt!==nt;Rt++)it[Rt].updateSolveMassProperties();const St=GSSolver_solve_invCs,wt=GSSolver_solve_Bs,Pt=GSSolver_solve_lambda;St.length=tt,wt.length=tt,Pt.length=tt;for(let Rt=0;Rt!==tt;Rt++){const kt=b[Rt];Pt[Rt]=0,wt[Rt]=kt.computeB(lt),St[Rt]=1/kt.computeC()}if(tt!==0){for(let Gt=0;Gt!==nt;Gt++){const Dt=it[Gt],It=Dt.vlambda,Nt=Dt.wlambda;It.set(0,0,0),Nt.set(0,0,0)}for(d=0;d!==_;d++){ft=0;for(let Gt=0;Gt!==tt;Gt++){const Dt=b[Gt];ut=wt[Gt],ht=St[Gt],xt=Pt[Gt],bt=Dt.computeGWlambda(),_t=ht*(ut-bt-Dt.eps*xt),xt+_t<Dt.minForce?_t=Dt.minForce-xt:xt+_t>Dt.maxForce&&(_t=Dt.maxForce-xt),Pt[Gt]+=_t,ft+=_t>0?_t:-_t,Dt.addToWlambda(_t)}if(ft*ft<v)break}for(let Gt=0;Gt!==nt;Gt++){const Dt=it[Gt],It=Dt.velocity,Nt=Dt.angularVelocity;Dt.vlambda.vmul(Dt.linearFactor,Dt.vlambda),It.vadd(Dt.vlambda,It),Dt.wlambda.vmul(Dt.angularFactor,Dt.wlambda),Nt.vadd(Dt.wlambda,Nt)}let Rt=b.length;const kt=1/lt;for(;Rt--;)b[Rt].multiplier=Pt[Rt]*kt}return d}}const GSSolver_solve_lambda=[],GSSolver_solve_invCs=[],GSSolver_solve_Bs=[];Body.STATIC;class Pool{constructor(){this.objects=[],this.type=Object}release(){const o=arguments.length;for(let c=0;c!==o;c++)this.objects.push(c<0||arguments.length<=c?void 0:arguments[c]);return this}get(){return this.objects.length===0?this.constructObject():this.objects.pop()}constructObject(){throw new Error("constructObject() not implemented in this Pool subclass yet!")}resize(o){const c=this.objects;for(;c.length>o;)c.pop();for(;c.length<o;)c.push(this.constructObject());return this}}class Vec3Pool extends Pool{constructor(){super(...arguments),this.type=Vec3}constructObject(){return new Vec3}}const COLLISION_TYPES={sphereSphere:Shape.types.SPHERE,spherePlane:Shape.types.SPHERE|Shape.types.PLANE,boxBox:Shape.types.BOX|Shape.types.BOX,sphereBox:Shape.types.SPHERE|Shape.types.BOX,planeBox:Shape.types.PLANE|Shape.types.BOX,convexConvex:Shape.types.CONVEXPOLYHEDRON,sphereConvex:Shape.types.SPHERE|Shape.types.CONVEXPOLYHEDRON,planeConvex:Shape.types.PLANE|Shape.types.CONVEXPOLYHEDRON,boxConvex:Shape.types.BOX|Shape.types.CONVEXPOLYHEDRON,sphereHeightfield:Shape.types.SPHERE|Shape.types.HEIGHTFIELD,boxHeightfield:Shape.types.BOX|Shape.types.HEIGHTFIELD,convexHeightfield:Shape.types.CONVEXPOLYHEDRON|Shape.types.HEIGHTFIELD,sphereParticle:Shape.types.PARTICLE|Shape.types.SPHERE,planeParticle:Shape.types.PLANE|Shape.types.PARTICLE,boxParticle:Shape.types.BOX|Shape.types.PARTICLE,convexParticle:Shape.types.PARTICLE|Shape.types.CONVEXPOLYHEDRON,cylinderCylinder:Shape.types.CYLINDER,sphereCylinder:Shape.types.SPHERE|Shape.types.CYLINDER,planeCylinder:Shape.types.PLANE|Shape.types.CYLINDER,boxCylinder:Shape.types.BOX|Shape.types.CYLINDER,convexCylinder:Shape.types.CONVEXPOLYHEDRON|Shape.types.CYLINDER,heightfieldCylinder:Shape.types.HEIGHTFIELD|Shape.types.CYLINDER,particleCylinder:Shape.types.PARTICLE|Shape.types.CYLINDER,sphereTrimesh:Shape.types.SPHERE|Shape.types.TRIMESH,planeTrimesh:Shape.types.PLANE|Shape.types.TRIMESH};class Narrowphase{get[COLLISION_TYPES.sphereSphere](){return this.sphereSphere}get[COLLISION_TYPES.spherePlane](){return this.spherePlane}get[COLLISION_TYPES.boxBox](){return this.boxBox}get[COLLISION_TYPES.sphereBox](){return this.sphereBox}get[COLLISION_TYPES.planeBox](){return this.planeBox}get[COLLISION_TYPES.convexConvex](){return this.convexConvex}get[COLLISION_TYPES.sphereConvex](){return this.sphereConvex}get[COLLISION_TYPES.planeConvex](){return this.planeConvex}get[COLLISION_TYPES.boxConvex](){return this.boxConvex}get[COLLISION_TYPES.sphereHeightfield](){return this.sphereHeightfield}get[COLLISION_TYPES.boxHeightfield](){return this.boxHeightfield}get[COLLISION_TYPES.convexHeightfield](){return this.convexHeightfield}get[COLLISION_TYPES.sphereParticle](){return this.sphereParticle}get[COLLISION_TYPES.planeParticle](){return this.planeParticle}get[COLLISION_TYPES.boxParticle](){return this.boxParticle}get[COLLISION_TYPES.convexParticle](){return this.convexParticle}get[COLLISION_TYPES.cylinderCylinder](){return this.convexConvex}get[COLLISION_TYPES.sphereCylinder](){return this.sphereConvex}get[COLLISION_TYPES.planeCylinder](){return this.planeConvex}get[COLLISION_TYPES.boxCylinder](){return this.boxConvex}get[COLLISION_TYPES.convexCylinder](){return this.convexConvex}get[COLLISION_TYPES.heightfieldCylinder](){return this.heightfieldCylinder}get[COLLISION_TYPES.particleCylinder](){return this.particleCylinder}get[COLLISION_TYPES.sphereTrimesh](){return this.sphereTrimesh}get[COLLISION_TYPES.planeTrimesh](){return this.planeTrimesh}constructor(o){this.contactPointPool=[],this.frictionEquationPool=[],this.result=[],this.frictionResult=[],this.v3pool=new Vec3Pool,this.world=o,this.currentContactMaterial=o.defaultContactMaterial,this.enableFrictionReduction=!1}createContactEquation(o,c,d,_,v,b){let tt;this.contactPointPool.length?(tt=this.contactPointPool.pop(),tt.bi=o,tt.bj=c):tt=new ContactEquation(o,c),tt.enabled=o.collisionResponse&&c.collisionResponse&&d.collisionResponse&&_.collisionResponse;const it=this.currentContactMaterial;tt.restitution=it.restitution,tt.setSpookParams(it.contactEquationStiffness,it.contactEquationRelaxation,this.world.dt);const nt=d.material||o.material,lt=_.material||c.material;return nt&&lt&&nt.restitution>=0&&lt.restitution>=0&&(tt.restitution=nt.restitution*lt.restitution),tt.si=v||d,tt.sj=b||_,tt}createFrictionEquationsFromContact(o,c){const d=o.bi,_=o.bj,v=o.si,b=o.sj,tt=this.world,it=this.currentContactMaterial;let nt=it.friction;const lt=v.material||d.material,ut=b.material||_.material;if(lt&&ut&&lt.friction>=0&&ut.friction>=0&&(nt=lt.friction*ut.friction),nt>0){const ht=nt*tt.gravity.length();let _t=d.invMass+_.invMass;_t>0&&(_t=1/_t);const ft=this.frictionEquationPool,bt=ft.length?ft.pop():new FrictionEquation(d,_,ht*_t),xt=ft.length?ft.pop():new FrictionEquation(d,_,ht*_t);return bt.bi=xt.bi=d,bt.bj=xt.bj=_,bt.minForce=xt.minForce=-ht*_t,bt.maxForce=xt.maxForce=ht*_t,bt.ri.copy(o.ri),bt.rj.copy(o.rj),xt.ri.copy(o.ri),xt.rj.copy(o.rj),o.ni.tangents(bt.t,xt.t),bt.setSpookParams(it.frictionEquationStiffness,it.frictionEquationRelaxation,tt.dt),xt.setSpookParams(it.frictionEquationStiffness,it.frictionEquationRelaxation,tt.dt),bt.enabled=xt.enabled=o.enabled,c.push(bt,xt),!0}return!1}createFrictionFromAverage(o){let c=this.result[this.result.length-1];if(!this.createFrictionEquationsFromContact(c,this.frictionResult)||o===1)return;const d=this.frictionResult[this.frictionResult.length-2],_=this.frictionResult[this.frictionResult.length-1];averageNormal.setZero(),averageContactPointA.setZero(),averageContactPointB.setZero();const v=c.bi;c.bj;for(let tt=0;tt!==o;tt++)c=this.result[this.result.length-1-tt],c.bi!==v?(averageNormal.vadd(c.ni,averageNormal),averageContactPointA.vadd(c.ri,averageContactPointA),averageContactPointB.vadd(c.rj,averageContactPointB)):(averageNormal.vsub(c.ni,averageNormal),averageContactPointA.vadd(c.rj,averageContactPointA),averageContactPointB.vadd(c.ri,averageContactPointB));const b=1/o;averageContactPointA.scale(b,d.ri),averageContactPointB.scale(b,d.rj),_.ri.copy(d.ri),_.rj.copy(d.rj),averageNormal.normalize(),averageNormal.tangents(d.t,_.t)}getContacts(o,c,d,_,v,b,tt){this.contactPointPool=v,this.frictionEquationPool=tt,this.result=_,this.frictionResult=b;const it=tmpQuat1,nt=tmpQuat2,lt=tmpVec1,ut=tmpVec2;for(let ht=0,_t=o.length;ht!==_t;ht++){const ft=o[ht],bt=c[ht];let xt=null;ft.material&&bt.material&&(xt=d.getContactMaterial(ft.material,bt.material)||null);const St=ft.type&Body.KINEMATIC&&bt.type&Body.STATIC||ft.type&Body.STATIC&&bt.type&Body.KINEMATIC||ft.type&Body.KINEMATIC&&bt.type&Body.KINEMATIC;for(let wt=0;wt<ft.shapes.length;wt++){ft.quaternion.mult(ft.shapeOrientations[wt],it),ft.quaternion.vmult(ft.shapeOffsets[wt],lt),lt.vadd(ft.position,lt);const Pt=ft.shapes[wt];for(let Rt=0;Rt<bt.shapes.length;Rt++){bt.quaternion.mult(bt.shapeOrientations[Rt],nt),bt.quaternion.vmult(bt.shapeOffsets[Rt],ut),ut.vadd(bt.position,ut);const kt=bt.shapes[Rt];if(!(Pt.collisionFilterMask&kt.collisionFilterGroup&&kt.collisionFilterMask&Pt.collisionFilterGroup)||lt.distanceTo(ut)>Pt.boundingSphereRadius+kt.boundingSphereRadius)continue;let Gt=null;Pt.material&&kt.material&&(Gt=d.getContactMaterial(Pt.material,kt.material)||null),this.currentContactMaterial=Gt||xt||d.defaultContactMaterial;const Dt=this[Pt.type|kt.type];if(Dt){let It=!1;It=Pt.type<kt.type?Dt.call(this,Pt,kt,lt,ut,it,nt,ft,bt,Pt,kt,St):Dt.call(this,kt,Pt,ut,lt,nt,it,bt,ft,Pt,kt,St),It&&St&&(d.shapeOverlapKeeper.set(Pt.id,kt.id),d.bodyOverlapKeeper.set(ft.id,bt.id))}}}}}sphereSphere(o,c,d,_,v,b,tt,it,nt,lt,ut){if(ut)return d.distanceSquared(_)<(o.radius+c.radius)**2;const ht=this.createContactEquation(tt,it,o,c,nt,lt);_.vsub(d,ht.ni),ht.ni.normalize(),ht.ri.copy(ht.ni),ht.rj.copy(ht.ni),ht.ri.scale(o.radius,ht.ri),ht.rj.scale(-c.radius,ht.rj),ht.ri.vadd(d,ht.ri),ht.ri.vsub(tt.position,ht.ri),ht.rj.vadd(_,ht.rj),ht.rj.vsub(it.position,ht.rj),this.result.push(ht),this.createFrictionEquationsFromContact(ht,this.frictionResult)}spherePlane(o,c,d,_,v,b,tt,it,nt,lt,ut){const ht=this.createContactEquation(tt,it,o,c,nt,lt);if(ht.ni.set(0,0,1),b.vmult(ht.ni,ht.ni),ht.ni.negate(ht.ni),ht.ni.normalize(),ht.ni.scale(o.radius,ht.ri),d.vsub(_,point_on_plane_to_sphere),ht.ni.scale(ht.ni.dot(point_on_plane_to_sphere),plane_to_sphere_ortho),point_on_plane_to_sphere.vsub(plane_to_sphere_ortho,ht.rj),-point_on_plane_to_sphere.dot(ht.ni)<=o.radius){if(ut)return!0;const _t=ht.ri,ft=ht.rj;_t.vadd(d,_t),_t.vsub(tt.position,_t),ft.vadd(_,ft),ft.vsub(it.position,ft),this.result.push(ht),this.createFrictionEquationsFromContact(ht,this.frictionResult)}}boxBox(o,c,d,_,v,b,tt,it,nt,lt,ut){return o.convexPolyhedronRepresentation.material=o.material,c.convexPolyhedronRepresentation.material=c.material,o.convexPolyhedronRepresentation.collisionResponse=o.collisionResponse,c.convexPolyhedronRepresentation.collisionResponse=c.collisionResponse,this.convexConvex(o.convexPolyhedronRepresentation,c.convexPolyhedronRepresentation,d,_,v,b,tt,it,o,c,ut)}sphereBox(o,c,d,_,v,b,tt,it,nt,lt,ut){const ht=this.v3pool,_t=sphereBox_sides;d.vsub(_,box_to_sphere),c.getSideNormals(_t,b);const ft=o.radius;let bt=!1;const xt=sphereBox_side_ns,St=sphereBox_side_ns1,wt=sphereBox_side_ns2;let Pt=null,Rt=0,kt=0,Gt=0,Dt=null;for(let or=0,pr=_t.length;or!==pr&&bt===!1;or++){const hr=sphereBox_ns;hr.copy(_t[or]);const ur=hr.length();hr.normalize();const cr=box_to_sphere.dot(hr);if(cr<ur+ft&&cr>0){const br=sphereBox_ns1,fr=sphereBox_ns2;br.copy(_t[(or+1)%3]),fr.copy(_t[(or+2)%3]);const kr=br.length(),gr=fr.length();br.normalize(),fr.normalize();const tr=box_to_sphere.dot(br),dr=box_to_sphere.dot(fr);if(tr<kr&&tr>-kr&&dr<gr&&dr>-gr){const Ir=Math.abs(cr-ur-ft);if((Dt===null||Ir<Dt)&&(Dt=Ir,kt=tr,Gt=dr,Pt=ur,xt.copy(hr),St.copy(br),wt.copy(fr),Rt++,ut))return!0}}}if(Rt){bt=!0;const or=this.createContactEquation(tt,it,o,c,nt,lt);xt.scale(-ft,or.ri),or.ni.copy(xt),or.ni.negate(or.ni),xt.scale(Pt,xt),St.scale(kt,St),xt.vadd(St,xt),wt.scale(Gt,wt),xt.vadd(wt,or.rj),or.ri.vadd(d,or.ri),or.ri.vsub(tt.position,or.ri),or.rj.vadd(_,or.rj),or.rj.vsub(it.position,or.rj),this.result.push(or),this.createFrictionEquationsFromContact(or,this.frictionResult)}let It=ht.get();const Nt=sphereBox_sphere_to_corner;for(let or=0;or!==2&&!bt;or++)for(let pr=0;pr!==2&&!bt;pr++)for(let hr=0;hr!==2&&!bt;hr++)if(It.set(0,0,0),or?It.vadd(_t[0],It):It.vsub(_t[0],It),pr?It.vadd(_t[1],It):It.vsub(_t[1],It),hr?It.vadd(_t[2],It):It.vsub(_t[2],It),_.vadd(It,Nt),Nt.vsub(d,Nt),Nt.lengthSquared()<ft*ft){if(ut)return!0;bt=!0;const ur=this.createContactEquation(tt,it,o,c,nt,lt);ur.ri.copy(Nt),ur.ri.normalize(),ur.ni.copy(ur.ri),ur.ri.scale(ft,ur.ri),ur.rj.copy(It),ur.ri.vadd(d,ur.ri),ur.ri.vsub(tt.position,ur.ri),ur.rj.vadd(_,ur.rj),ur.rj.vsub(it.position,ur.rj),this.result.push(ur),this.createFrictionEquationsFromContact(ur,this.frictionResult)}ht.release(It),It=null;const Vt=ht.get(),Kt=ht.get(),Yt=ht.get(),nr=ht.get(),rr=ht.get(),lr=_t.length;for(let or=0;or!==lr&&!bt;or++)for(let pr=0;pr!==lr&&!bt;pr++)if(or%3!=pr%3){_t[pr].cross(_t[or],Vt),Vt.normalize(),_t[or].vadd(_t[pr],Kt),Yt.copy(d),Yt.vsub(Kt,Yt),Yt.vsub(_,Yt);const hr=Yt.dot(Vt);Vt.scale(hr,nr);let ur=0;for(;ur===or%3||ur===pr%3;)ur++;rr.copy(d),rr.vsub(nr,rr),rr.vsub(Kt,rr),rr.vsub(_,rr);const cr=Math.abs(hr),br=rr.length();if(cr<_t[ur].length()&&br<ft){if(ut)return!0;bt=!0;const fr=this.createContactEquation(tt,it,o,c,nt,lt);Kt.vadd(nr,fr.rj),fr.rj.copy(fr.rj),rr.negate(fr.ni),fr.ni.normalize(),fr.ri.copy(fr.rj),fr.ri.vadd(_,fr.ri),fr.ri.vsub(d,fr.ri),fr.ri.normalize(),fr.ri.scale(ft,fr.ri),fr.ri.vadd(d,fr.ri),fr.ri.vsub(tt.position,fr.ri),fr.rj.vadd(_,fr.rj),fr.rj.vsub(it.position,fr.rj),this.result.push(fr),this.createFrictionEquationsFromContact(fr,this.frictionResult)}}ht.release(Vt,Kt,Yt,nr,rr)}planeBox(o,c,d,_,v,b,tt,it,nt,lt,ut){return c.convexPolyhedronRepresentation.material=c.material,c.convexPolyhedronRepresentation.collisionResponse=c.collisionResponse,c.convexPolyhedronRepresentation.id=c.id,this.planeConvex(o,c.convexPolyhedronRepresentation,d,_,v,b,tt,it,o,c,ut)}convexConvex(o,c,d,_,v,b,tt,it,nt,lt,ut,ht,_t){const ft=convexConvex_sepAxis;if(!(d.distanceTo(_)>o.boundingSphereRadius+c.boundingSphereRadius)&&o.findSeparatingAxis(c,d,v,_,b,ft,ht,_t)){const bt=[],xt=convexConvex_q;o.clipAgainstHull(d,v,c,_,b,ft,-100,100,bt);let St=0;for(let wt=0;wt!==bt.length;wt++){if(ut)return!0;const Pt=this.createContactEquation(tt,it,o,c,nt,lt),Rt=Pt.ri,kt=Pt.rj;ft.negate(Pt.ni),bt[wt].normal.negate(xt),xt.scale(bt[wt].depth,xt),bt[wt].point.vadd(xt,Rt),kt.copy(bt[wt].point),Rt.vsub(d,Rt),kt.vsub(_,kt),Rt.vadd(d,Rt),Rt.vsub(tt.position,Rt),kt.vadd(_,kt),kt.vsub(it.position,kt),this.result.push(Pt),St++,this.enableFrictionReduction||this.createFrictionEquationsFromContact(Pt,this.frictionResult)}this.enableFrictionReduction&&St&&this.createFrictionFromAverage(St)}}sphereConvex(o,c,d,_,v,b,tt,it,nt,lt,ut){const ht=this.v3pool;d.vsub(_,convex_to_sphere);const _t=c.faceNormals,ft=c.faces,bt=c.vertices,xt=o.radius;let St=!1;for(let wt=0;wt!==bt.length;wt++){const Pt=bt[wt],Rt=sphereConvex_worldCorner;b.vmult(Pt,Rt),_.vadd(Rt,Rt);const kt=sphereConvex_sphereToCorner;if(Rt.vsub(d,kt),kt.lengthSquared()<xt*xt){if(ut)return!0;St=!0;const Gt=this.createContactEquation(tt,it,o,c,nt,lt);return Gt.ri.copy(kt),Gt.ri.normalize(),Gt.ni.copy(Gt.ri),Gt.ri.scale(xt,Gt.ri),Rt.vsub(_,Gt.rj),Gt.ri.vadd(d,Gt.ri),Gt.ri.vsub(tt.position,Gt.ri),Gt.rj.vadd(_,Gt.rj),Gt.rj.vsub(it.position,Gt.rj),this.result.push(Gt),void this.createFrictionEquationsFromContact(Gt,this.frictionResult)}}for(let wt=0,Pt=ft.length;wt!==Pt&&St===!1;wt++){const Rt=_t[wt],kt=ft[wt],Gt=sphereConvex_worldNormal;b.vmult(Rt,Gt);const Dt=sphereConvex_worldPoint;b.vmult(bt[kt[0]],Dt),Dt.vadd(_,Dt);const It=sphereConvex_worldSpherePointClosestToPlane;Gt.scale(-xt,It),d.vadd(It,It);const Nt=sphereConvex_penetrationVec;It.vsub(Dt,Nt);const Vt=Nt.dot(Gt),Kt=sphereConvex_sphereToWorldPoint;if(d.vsub(Dt,Kt),Vt<0&&Kt.dot(Gt)>0){const Yt=[];for(let nr=0,rr=kt.length;nr!==rr;nr++){const lr=ht.get();b.vmult(bt[kt[nr]],lr),_.vadd(lr,lr),Yt.push(lr)}if(pointInPolygon(Yt,Gt,d)){if(ut)return!0;St=!0;const nr=this.createContactEquation(tt,it,o,c,nt,lt);Gt.scale(-xt,nr.ri),Gt.negate(nr.ni);const rr=ht.get();Gt.scale(-Vt,rr);const lr=ht.get();Gt.scale(-xt,lr),d.vsub(_,nr.rj),nr.rj.vadd(lr,nr.rj),nr.rj.vadd(rr,nr.rj),nr.rj.vadd(_,nr.rj),nr.rj.vsub(it.position,nr.rj),nr.ri.vadd(d,nr.ri),nr.ri.vsub(tt.position,nr.ri),ht.release(rr),ht.release(lr),this.result.push(nr),this.createFrictionEquationsFromContact(nr,this.frictionResult);for(let or=0,pr=Yt.length;or!==pr;or++)ht.release(Yt[or]);return}for(let nr=0;nr!==kt.length;nr++){const rr=ht.get(),lr=ht.get();b.vmult(bt[kt[(nr+1)%kt.length]],rr),b.vmult(bt[kt[(nr+2)%kt.length]],lr),_.vadd(rr,rr),_.vadd(lr,lr);const or=sphereConvex_edge;lr.vsub(rr,or);const pr=sphereConvex_edgeUnit;or.unit(pr);const hr=ht.get(),ur=ht.get();d.vsub(rr,ur);const cr=ur.dot(pr);pr.scale(cr,hr),hr.vadd(rr,hr);const br=ht.get();if(hr.vsub(d,br),cr>0&&cr*cr<or.lengthSquared()&&br.lengthSquared()<xt*xt){if(ut)return!0;const fr=this.createContactEquation(tt,it,o,c,nt,lt);hr.vsub(_,fr.rj),hr.vsub(d,fr.ni),fr.ni.normalize(),fr.ni.scale(xt,fr.ri),fr.rj.vadd(_,fr.rj),fr.rj.vsub(it.position,fr.rj),fr.ri.vadd(d,fr.ri),fr.ri.vsub(tt.position,fr.ri),this.result.push(fr),this.createFrictionEquationsFromContact(fr,this.frictionResult);for(let kr=0,gr=Yt.length;kr!==gr;kr++)ht.release(Yt[kr]);return ht.release(rr),ht.release(lr),ht.release(hr),ht.release(br),void ht.release(ur)}ht.release(rr),ht.release(lr),ht.release(hr),ht.release(br),ht.release(ur)}for(let nr=0,rr=Yt.length;nr!==rr;nr++)ht.release(Yt[nr])}}}planeConvex(o,c,d,_,v,b,tt,it,nt,lt,ut){const ht=planeConvex_v,_t=planeConvex_normal;_t.set(0,0,1),v.vmult(_t,_t);let ft=0;const bt=planeConvex_relpos;for(let xt=0;xt!==c.vertices.length;xt++)if(ht.copy(c.vertices[xt]),b.vmult(ht,ht),_.vadd(ht,ht),ht.vsub(d,bt),_t.dot(bt)<=0){if(ut)return!0;const St=this.createContactEquation(tt,it,o,c,nt,lt),wt=planeConvex_projected;_t.scale(_t.dot(bt),wt),ht.vsub(wt,wt),wt.vsub(d,St.ri),St.ni.copy(_t),ht.vsub(_,St.rj),St.ri.vadd(d,St.ri),St.ri.vsub(tt.position,St.ri),St.rj.vadd(_,St.rj),St.rj.vsub(it.position,St.rj),this.result.push(St),ft++,this.enableFrictionReduction||this.createFrictionEquationsFromContact(St,this.frictionResult)}this.enableFrictionReduction&&ft&&this.createFrictionFromAverage(ft)}boxConvex(o,c,d,_,v,b,tt,it,nt,lt,ut){return o.convexPolyhedronRepresentation.material=o.material,o.convexPolyhedronRepresentation.collisionResponse=o.collisionResponse,this.convexConvex(o.convexPolyhedronRepresentation,c,d,_,v,b,tt,it,o,c,ut)}sphereHeightfield(o,c,d,_,v,b,tt,it,nt,lt,ut){const ht=c.data,_t=o.radius,ft=c.elementSize,bt=sphereHeightfield_tmp2,xt=sphereHeightfield_tmp1;cannon_es_Transform.pointToLocalFrame(_,b,d,xt);let St=Math.floor((xt.x-_t)/ft)-1,wt=Math.ceil((xt.x+_t)/ft)+1,Pt=Math.floor((xt.y-_t)/ft)-1,Rt=Math.ceil((xt.y+_t)/ft)+1;if(wt<0||Rt<0||St>ht.length||Pt>ht[0].length)return;St<0&&(St=0),wt<0&&(wt=0),Pt<0&&(Pt=0),Rt<0&&(Rt=0),St>=ht.length&&(St=ht.length-1),wt>=ht.length&&(wt=ht.length-1),Rt>=ht[0].length&&(Rt=ht[0].length-1),Pt>=ht[0].length&&(Pt=ht[0].length-1);const kt=[];c.getRectMinMax(St,Pt,wt,Rt,kt);const Gt=kt[0],Dt=kt[1];if(xt.z-_t>Dt||xt.z+_t<Gt)return;const It=this.result;for(let Nt=St;Nt<wt;Nt++)for(let Vt=Pt;Vt<Rt;Vt++){const Kt=It.length;let Yt=!1;if(c.getConvexTrianglePillar(Nt,Vt,!1),cannon_es_Transform.pointToWorldFrame(_,b,c.pillarOffset,bt),d.distanceTo(bt)<c.pillarConvex.boundingSphereRadius+o.boundingSphereRadius&&(Yt=this.sphereConvex(o,c.pillarConvex,d,bt,v,b,tt,it,o,c,ut)),ut&&Yt||(c.getConvexTrianglePillar(Nt,Vt,!0),cannon_es_Transform.pointToWorldFrame(_,b,c.pillarOffset,bt),d.distanceTo(bt)<c.pillarConvex.boundingSphereRadius+o.boundingSphereRadius&&(Yt=this.sphereConvex(o,c.pillarConvex,d,bt,v,b,tt,it,o,c,ut)),ut&&Yt))return!0;if(It.length-Kt>2)return}}boxHeightfield(o,c,d,_,v,b,tt,it,nt,lt,ut){return o.convexPolyhedronRepresentation.material=o.material,o.convexPolyhedronRepresentation.collisionResponse=o.collisionResponse,this.convexHeightfield(o.convexPolyhedronRepresentation,c,d,_,v,b,tt,it,o,c,ut)}convexHeightfield(o,c,d,_,v,b,tt,it,nt,lt,ut){const ht=c.data,_t=c.elementSize,ft=o.boundingSphereRadius,bt=convexHeightfield_tmp2,xt=convexHeightfield_faceList,St=convexHeightfield_tmp1;cannon_es_Transform.pointToLocalFrame(_,b,d,St);let wt=Math.floor((St.x-ft)/_t)-1,Pt=Math.ceil((St.x+ft)/_t)+1,Rt=Math.floor((St.y-ft)/_t)-1,kt=Math.ceil((St.y+ft)/_t)+1;if(Pt<0||kt<0||wt>ht.length||Rt>ht[0].length)return;wt<0&&(wt=0),Pt<0&&(Pt=0),Rt<0&&(Rt=0),kt<0&&(kt=0),wt>=ht.length&&(wt=ht.length-1),Pt>=ht.length&&(Pt=ht.length-1),kt>=ht[0].length&&(kt=ht[0].length-1),Rt>=ht[0].length&&(Rt=ht[0].length-1);const Gt=[];c.getRectMinMax(wt,Rt,Pt,kt,Gt);const Dt=Gt[0],It=Gt[1];if(!(St.z-ft>It||St.z+ft<Dt))for(let Nt=wt;Nt<Pt;Nt++)for(let Vt=Rt;Vt<kt;Vt++){let Kt=!1;if(c.getConvexTrianglePillar(Nt,Vt,!1),cannon_es_Transform.pointToWorldFrame(_,b,c.pillarOffset,bt),d.distanceTo(bt)<c.pillarConvex.boundingSphereRadius+o.boundingSphereRadius&&(Kt=this.convexConvex(o,c.pillarConvex,d,bt,v,b,tt,it,null,null,ut,xt,null)),ut&&Kt||(c.getConvexTrianglePillar(Nt,Vt,!0),cannon_es_Transform.pointToWorldFrame(_,b,c.pillarOffset,bt),d.distanceTo(bt)<c.pillarConvex.boundingSphereRadius+o.boundingSphereRadius&&(Kt=this.convexConvex(o,c.pillarConvex,d,bt,v,b,tt,it,null,null,ut,xt,null)),ut&&Kt))return!0}}sphereParticle(o,c,d,_,v,b,tt,it,nt,lt,ut){const ht=particleSphere_normal;if(ht.set(0,0,1),_.vsub(d,ht),ht.lengthSquared()<=o.radius*o.radius){if(ut)return!0;const _t=this.createContactEquation(it,tt,c,o,nt,lt);ht.normalize(),_t.rj.copy(ht),_t.rj.scale(o.radius,_t.rj),_t.ni.copy(ht),_t.ni.negate(_t.ni),_t.ri.set(0,0,0),this.result.push(_t),this.createFrictionEquationsFromContact(_t,this.frictionResult)}}planeParticle(o,c,d,_,v,b,tt,it,nt,lt,ut){const ht=particlePlane_normal;ht.set(0,0,1),tt.quaternion.vmult(ht,ht);const _t=particlePlane_relpos;if(_.vsub(tt.position,_t),ht.dot(_t)<=0){if(ut)return!0;const ft=this.createContactEquation(it,tt,c,o,nt,lt);ft.ni.copy(ht),ft.ni.negate(ft.ni),ft.ri.set(0,0,0);const bt=particlePlane_projected;ht.scale(ht.dot(_),bt),_.vsub(bt,bt),ft.rj.copy(bt),this.result.push(ft),this.createFrictionEquationsFromContact(ft,this.frictionResult)}}boxParticle(o,c,d,_,v,b,tt,it,nt,lt,ut){return o.convexPolyhedronRepresentation.material=o.material,o.convexPolyhedronRepresentation.collisionResponse=o.collisionResponse,this.convexParticle(o.convexPolyhedronRepresentation,c,d,_,v,b,tt,it,o,c,ut)}convexParticle(o,c,d,_,v,b,tt,it,nt,lt,ut){let ht=-1;const _t=convexParticle_penetratedFaceNormal,ft=convexParticle_worldPenetrationVec;let bt=null;const xt=convexParticle_local;if(xt.copy(_),xt.vsub(d,xt),v.conjugate(cqj),cqj.vmult(xt,xt),o.pointIsInside(xt)){o.worldVerticesNeedsUpdate&&o.computeWorldVertices(d,v),o.worldFaceNormalsNeedsUpdate&&o.computeWorldFaceNormals(v);for(let St=0,wt=o.faces.length;St!==wt;St++){const Pt=[o.worldVertices[o.faces[St][0]]],Rt=o.worldFaceNormals[St];_.vsub(Pt[0],convexParticle_vertexToParticle);const kt=-Rt.dot(convexParticle_vertexToParticle);if(bt===null||Math.abs(kt)<Math.abs(bt)){if(ut)return!0;bt=kt,ht=St,_t.copy(Rt)}}if(ht!==-1){const St=this.createContactEquation(it,tt,c,o,nt,lt);_t.scale(bt,ft),ft.vadd(_,ft),ft.vsub(d,ft),St.rj.copy(ft),_t.negate(St.ni),St.ri.set(0,0,0);const wt=St.ri,Pt=St.rj;wt.vadd(_,wt),wt.vsub(it.position,wt),Pt.vadd(d,Pt),Pt.vsub(tt.position,Pt),this.result.push(St),this.createFrictionEquationsFromContact(St,this.frictionResult)}else console.warn("Point found inside convex, but did not find penetrating face!")}}heightfieldCylinder(o,c,d,_,v,b,tt,it,nt,lt,ut){return this.convexHeightfield(c,o,_,d,b,v,it,tt,nt,lt,ut)}particleCylinder(o,c,d,_,v,b,tt,it,nt,lt,ut){return this.convexParticle(c,o,_,d,b,v,it,tt,nt,lt,ut)}sphereTrimesh(o,c,d,_,v,b,tt,it,nt,lt,ut){const ht=sphereTrimesh_edgeVertexA,_t=sphereTrimesh_edgeVertexB,ft=sphereTrimesh_edgeVector,bt=sphereTrimesh_edgeVectorUnit,xt=sphereTrimesh_localSpherePos,St=sphereTrimesh_tmp,wt=sphereTrimesh_localSphereAABB,Pt=sphereTrimesh_v2,Rt=sphereTrimesh_relpos,kt=sphereTrimesh_triangles;cannon_es_Transform.pointToLocalFrame(_,b,d,xt);const Gt=o.radius;wt.lowerBound.set(xt.x-Gt,xt.y-Gt,xt.z-Gt),wt.upperBound.set(xt.x+Gt,xt.y+Gt,xt.z+Gt),c.getTrianglesInAABB(wt,kt);const Dt=sphereTrimesh_v,It=o.radius*o.radius;for(let nr=0;nr<kt.length;nr++)for(let rr=0;rr<3;rr++)if(c.getVertex(c.indices[3*kt[nr]+rr],Dt),Dt.vsub(xt,Rt),Rt.lengthSquared()<=It){if(Pt.copy(Dt),cannon_es_Transform.pointToWorldFrame(_,b,Pt,Dt),Dt.vsub(d,Rt),ut)return!0;let lr=this.createContactEquation(tt,it,o,c,nt,lt);lr.ni.copy(Rt),lr.ni.normalize(),lr.ri.copy(lr.ni),lr.ri.scale(o.radius,lr.ri),lr.ri.vadd(d,lr.ri),lr.ri.vsub(tt.position,lr.ri),lr.rj.copy(Dt),lr.rj.vsub(it.position,lr.rj),this.result.push(lr),this.createFrictionEquationsFromContact(lr,this.frictionResult)}for(let nr=0;nr<kt.length;nr++)for(let rr=0;rr<3;rr++){c.getVertex(c.indices[3*kt[nr]+rr],ht),c.getVertex(c.indices[3*kt[nr]+(rr+1)%3],_t),_t.vsub(ht,ft),xt.vsub(_t,St);const lr=St.dot(ft);xt.vsub(ht,St);let or=St.dot(ft);if(or>0&&lr<0&&(xt.vsub(ht,St),bt.copy(ft),bt.normalize(),or=St.dot(bt),bt.scale(or,St),St.vadd(ht,St),St.distanceTo(xt)<o.radius)){if(ut)return!0;const pr=this.createContactEquation(tt,it,o,c,nt,lt);St.vsub(xt,pr.ni),pr.ni.normalize(),pr.ni.scale(o.radius,pr.ri),pr.ri.vadd(d,pr.ri),pr.ri.vsub(tt.position,pr.ri),cannon_es_Transform.pointToWorldFrame(_,b,St,St),St.vsub(it.position,pr.rj),cannon_es_Transform.vectorToWorldFrame(b,pr.ni,pr.ni),cannon_es_Transform.vectorToWorldFrame(b,pr.ri,pr.ri),this.result.push(pr),this.createFrictionEquationsFromContact(pr,this.frictionResult)}}const Nt=sphereTrimesh_va,Vt=sphereTrimesh_vb,Kt=sphereTrimesh_vc,Yt=sphereTrimesh_normal;for(let nr=0,rr=kt.length;nr!==rr;nr++){c.getTriangleVertices(kt[nr],Nt,Vt,Kt),c.getNormal(kt[nr],Yt),xt.vsub(Nt,St);let lr=St.dot(Yt);if(Yt.scale(lr,St),xt.vsub(St,St),lr=St.distanceTo(xt),Ray.pointInTriangle(St,Nt,Vt,Kt)&&lr<o.radius){if(ut)return!0;let or=this.createContactEquation(tt,it,o,c,nt,lt);St.vsub(xt,or.ni),or.ni.normalize(),or.ni.scale(o.radius,or.ri),or.ri.vadd(d,or.ri),or.ri.vsub(tt.position,or.ri),cannon_es_Transform.pointToWorldFrame(_,b,St,St),St.vsub(it.position,or.rj),cannon_es_Transform.vectorToWorldFrame(b,or.ni,or.ni),cannon_es_Transform.vectorToWorldFrame(b,or.ri,or.ri),this.result.push(or),this.createFrictionEquationsFromContact(or,this.frictionResult)}}kt.length=0}planeTrimesh(o,c,d,_,v,b,tt,it,nt,lt,ut){const ht=new Vec3,_t=planeTrimesh_normal;_t.set(0,0,1),v.vmult(_t,_t);for(let ft=0;ft<c.vertices.length/3;ft++){c.getVertex(ft,ht);const bt=new Vec3;bt.copy(ht),cannon_es_Transform.pointToWorldFrame(_,b,bt,ht);const xt=planeTrimesh_relpos;if(ht.vsub(d,xt),_t.dot(xt)<=0){if(ut)return!0;const St=this.createContactEquation(tt,it,o,c,nt,lt);St.ni.copy(_t);const wt=planeTrimesh_projected;_t.scale(xt.dot(_t),wt),ht.vsub(wt,wt),St.ri.copy(wt),St.ri.vsub(tt.position,St.ri),St.rj.copy(ht),St.rj.vsub(it.position,St.rj),this.result.push(St),this.createFrictionEquationsFromContact(St,this.frictionResult)}}}}const averageNormal=new Vec3,averageContactPointA=new Vec3,averageContactPointB=new Vec3,tmpVec1=new Vec3,tmpVec2=new Vec3,tmpQuat1=new Quaternion,tmpQuat2=new Quaternion,planeTrimesh_normal=new Vec3,planeTrimesh_relpos=new Vec3,planeTrimesh_projected=new Vec3,sphereTrimesh_normal=new Vec3,sphereTrimesh_relpos=new Vec3;new Vec3;const sphereTrimesh_v=new Vec3,sphereTrimesh_v2=new Vec3,sphereTrimesh_edgeVertexA=new Vec3,sphereTrimesh_edgeVertexB=new Vec3,sphereTrimesh_edgeVector=new Vec3,sphereTrimesh_edgeVectorUnit=new Vec3,sphereTrimesh_localSpherePos=new Vec3,sphereTrimesh_tmp=new Vec3,sphereTrimesh_va=new Vec3,sphereTrimesh_vb=new Vec3,sphereTrimesh_vc=new Vec3,sphereTrimesh_localSphereAABB=new AABB,sphereTrimesh_triangles=[],point_on_plane_to_sphere=new Vec3,plane_to_sphere_ortho=new Vec3,pointInPolygon_edge=new Vec3,pointInPolygon_edge_x_normal=new Vec3,pointInPolygon_vtp=new Vec3;function pointInPolygon(h,o,c){let d=null;const _=h.length;for(let v=0;v!==_;v++){const b=h[v],tt=pointInPolygon_edge;h[(v+1)%_].vsub(b,tt);const it=pointInPolygon_edge_x_normal;tt.cross(o,it);const nt=pointInPolygon_vtp;c.vsub(b,nt);const lt=it.dot(nt);if(!(d===null||lt>0&&d===!0||lt<=0&&d===!1))return!1;d===null&&(d=lt>0)}return!0}const box_to_sphere=new Vec3,sphereBox_ns=new Vec3,sphereBox_ns1=new Vec3,sphereBox_ns2=new Vec3,sphereBox_sides=[new Vec3,new Vec3,new Vec3,new Vec3,new Vec3,new Vec3],sphereBox_sphere_to_corner=new Vec3,sphereBox_side_ns=new Vec3,sphereBox_side_ns1=new Vec3,sphereBox_side_ns2=new Vec3,convex_to_sphere=new Vec3,sphereConvex_edge=new Vec3,sphereConvex_edgeUnit=new Vec3,sphereConvex_sphereToCorner=new Vec3,sphereConvex_worldCorner=new Vec3,sphereConvex_worldNormal=new Vec3,sphereConvex_worldPoint=new Vec3,sphereConvex_worldSpherePointClosestToPlane=new Vec3,sphereConvex_penetrationVec=new Vec3,sphereConvex_sphereToWorldPoint=new Vec3;new Vec3,new Vec3;const planeConvex_v=new Vec3,planeConvex_normal=new Vec3,planeConvex_relpos=new Vec3,planeConvex_projected=new Vec3,convexConvex_sepAxis=new Vec3,convexConvex_q=new Vec3,particlePlane_normal=new Vec3,particlePlane_relpos=new Vec3,particlePlane_projected=new Vec3,particleSphere_normal=new Vec3,cqj=new Quaternion,convexParticle_local=new Vec3;new Vec3;const convexParticle_penetratedFaceNormal=new Vec3,convexParticle_vertexToParticle=new Vec3,convexParticle_worldPenetrationVec=new Vec3,convexHeightfield_tmp1=new Vec3,convexHeightfield_tmp2=new Vec3,convexHeightfield_faceList=[0],sphereHeightfield_tmp1=new Vec3,sphereHeightfield_tmp2=new Vec3;class OverlapKeeper{constructor(){this.current=[],this.previous=[]}getKey(o,c){if(c<o){const d=c;c=o,o=d}return o<<16|c}set(o,c){const d=this.getKey(o,c),_=this.current;let v=0;for(;d>_[v];)v++;if(d!==_[v]){for(let b=_.length-1;b>=v;b--)_[b+1]=_[b];_[v]=d}}tick(){const o=this.current;this.current=this.previous,this.previous=o,this.current.length=0}getDiff(o,c){const d=this.current,_=this.previous,v=d.length,b=_.length;let tt=0;for(let it=0;it<v;it++){let nt=!1;const lt=d[it];for(;lt>_[tt];)tt++;nt=lt===_[tt],nt||unpackAndPush(o,lt)}tt=0;for(let it=0;it<b;it++){let nt=!1;const lt=_[it];for(;lt>d[tt];)tt++;nt=d[tt]===lt,nt||unpackAndPush(c,lt)}}}function unpackAndPush(h,o){h.push((4294901760&o)>>16,65535&o)}const getKey=(h,o)=>h<o?`${h}-${o}`:`${o}-${h}`;class TupleDictionary{constructor(){this.data={keys:[]}}get(o,c){const d=getKey(o,c);return this.data[d]}set(o,c,d){const _=getKey(o,c);this.get(o,c)||this.data.keys.push(_),this.data[_]=d}delete(o,c){const d=getKey(o,c),_=this.data.keys.indexOf(d);_!==-1&&this.data.keys.splice(_,1),delete this.data[d]}reset(){const o=this.data,c=o.keys;for(;c.length>0;)delete o[c.pop()]}}class World extends EventTarget{constructor(o){o===void 0&&(o={}),super(),this.dt=-1,this.allowSleep=!!o.allowSleep,this.contacts=[],this.frictionEquations=[],this.quatNormalizeSkip=o.quatNormalizeSkip!==void 0?o.quatNormalizeSkip:0,this.quatNormalizeFast=o.quatNormalizeFast!==void 0&&o.quatNormalizeFast,this.time=0,this.stepnumber=0,this.default_dt=1/60,this.nextId=0,this.gravity=new Vec3,o.gravity&&this.gravity.copy(o.gravity),this.broadphase=o.broadphase!==void 0?o.broadphase:new NaiveBroadphase,this.bodies=[],this.hasActiveBodies=!1,this.solver=o.solver!==void 0?o.solver:new GSSolver,this.constraints=[],this.narrowphase=new Narrowphase(this),this.collisionMatrix=new ArrayCollisionMatrix,this.collisionMatrixPrevious=new ArrayCollisionMatrix,this.bodyOverlapKeeper=new OverlapKeeper,this.shapeOverlapKeeper=new OverlapKeeper,this.contactmaterials=[],this.contactMaterialTable=new TupleDictionary,this.defaultMaterial=new cannon_es_Material("default"),this.defaultContactMaterial=new ContactMaterial(this.defaultMaterial,this.defaultMaterial,{friction:.3,restitution:0}),this.doProfiling=!1,this.profile={solve:0,makeContactConstraints:0,broadphase:0,integrate:0,narrowphase:0},this.accumulator=0,this.subsystems=[],this.addBodyEvent={type:"addBody",body:null},this.removeBodyEvent={type:"removeBody",body:null},this.idToBodyMap={},this.broadphase.setWorld(this)}getContactMaterial(o,c){return this.contactMaterialTable.get(o.id,c.id)}collisionMatrixTick(){const o=this.collisionMatrixPrevious;this.collisionMatrixPrevious=this.collisionMatrix,this.collisionMatrix=o,this.collisionMatrix.reset(),this.bodyOverlapKeeper.tick(),this.shapeOverlapKeeper.tick()}addConstraint(o){this.constraints.push(o)}removeConstraint(o){const c=this.constraints.indexOf(o);c!==-1&&this.constraints.splice(c,1)}rayTest(o,c,d){d instanceof RaycastResult?this.raycastClosest(o,c,{skipBackfaces:!0},d):this.raycastAll(o,c,{skipBackfaces:!0},d)}raycastAll(o,c,d,_){return d===void 0&&(d={}),d.mode=Ray.ALL,d.from=o,d.to=c,d.callback=_,tmpRay.intersectWorld(this,d)}raycastAny(o,c,d,_){return d===void 0&&(d={}),d.mode=Ray.ANY,d.from=o,d.to=c,d.result=_,tmpRay.intersectWorld(this,d)}raycastClosest(o,c,d,_){return d===void 0&&(d={}),d.mode=Ray.CLOSEST,d.from=o,d.to=c,d.result=_,tmpRay.intersectWorld(this,d)}addBody(o){this.bodies.includes(o)||(o.index=this.bodies.length,this.bodies.push(o),o.world=this,o.initPosition.copy(o.position),o.initVelocity.copy(o.velocity),o.timeLastSleepy=this.time,o instanceof Body&&(o.initAngularVelocity.copy(o.angularVelocity),o.initQuaternion.copy(o.quaternion)),this.collisionMatrix.setNumObjects(this.bodies.length),this.addBodyEvent.body=o,this.idToBodyMap[o.id]=o,this.dispatchEvent(this.addBodyEvent))}removeBody(o){o.world=null;const c=this.bodies.length-1,d=this.bodies,_=d.indexOf(o);if(_!==-1){d.splice(_,1);for(let v=0;v!==d.length;v++)d[v].index=v;this.collisionMatrix.setNumObjects(c),this.removeBodyEvent.body=o,delete this.idToBodyMap[o.id],this.dispatchEvent(this.removeBodyEvent)}}getBodyById(o){return this.idToBodyMap[o]}getShapeById(o){const c=this.bodies;for(let d=0;d<c.length;d++){const _=c[d].shapes;for(let v=0;v<_.length;v++){const b=_[v];if(b.id===o)return b}}return null}addContactMaterial(o){this.contactmaterials.push(o),this.contactMaterialTable.set(o.materials[0].id,o.materials[1].id,o)}removeContactMaterial(o){const c=this.contactmaterials.indexOf(o);c!==-1&&(this.contactmaterials.splice(c,1),this.contactMaterialTable.delete(o.materials[0].id,o.materials[1].id))}fixedStep(o,c){o===void 0&&(o=1/60),c===void 0&&(c=10);const d=cannon_es_performance.now()/1e3;if(this.lastCallTime){const _=d-this.lastCallTime;this.step(o,_,c)}else this.step(o,void 0,c);this.lastCallTime=d}step(o,c,d){if(d===void 0&&(d=10),c===void 0)this.internalStep(o),this.time+=o;else{this.accumulator+=c;const _=cannon_es_performance.now();let v=0;for(;this.accumulator>=o&&v<d&&(this.internalStep(o),this.accumulator-=o,v++,!(cannon_es_performance.now()-_>1e3*o)););this.accumulator=this.accumulator%o;const b=this.accumulator/o;for(let tt=0;tt!==this.bodies.length;tt++){const it=this.bodies[tt];it.previousPosition.lerp(it.position,b,it.interpolatedPosition),it.previousQuaternion.slerp(it.quaternion,b,it.interpolatedQuaternion),it.previousQuaternion.normalize()}this.time+=c}}internalStep(o){this.dt=o;const c=this.contacts,d=World_step_p1,_=World_step_p2,v=this.bodies.length,b=this.bodies,tt=this.solver,it=this.gravity,nt=this.doProfiling,lt=this.profile,ut=Body.DYNAMIC;let ht=-1/0;const _t=this.constraints,ft=World_step_frictionEquationPool;it.length();const bt=it.x,xt=it.y,St=it.z;let wt=0;for(nt&&(ht=cannon_es_performance.now()),wt=0;wt!==v;wt++){const Yt=b[wt];if(Yt.type===ut){const nr=Yt.force,rr=Yt.mass;nr.x+=rr*bt,nr.y+=rr*xt,nr.z+=rr*St}}for(let Yt=0,nr=this.subsystems.length;Yt!==nr;Yt++)this.subsystems[Yt].update();nt&&(ht=cannon_es_performance.now()),d.length=0,_.length=0,this.broadphase.collisionPairs(this,d,_),nt&&(lt.broadphase=cannon_es_performance.now()-ht);let Pt=_t.length;for(wt=0;wt!==Pt;wt++){const Yt=_t[wt];if(!Yt.collideConnected)for(let nr=d.length-1;nr>=0;nr-=1)(Yt.bodyA===d[nr]&&Yt.bodyB===_[nr]||Yt.bodyB===d[nr]&&Yt.bodyA===_[nr])&&(d.splice(nr,1),_.splice(nr,1))}this.collisionMatrixTick(),nt&&(ht=cannon_es_performance.now());const Rt=World_step_oldContacts,kt=c.length;for(wt=0;wt!==kt;wt++)Rt.push(c[wt]);c.length=0;const Gt=this.frictionEquations.length;for(wt=0;wt!==Gt;wt++)ft.push(this.frictionEquations[wt]);for(this.frictionEquations.length=0,this.narrowphase.getContacts(d,_,this,c,Rt,this.frictionEquations,ft),nt&&(lt.narrowphase=cannon_es_performance.now()-ht),nt&&(ht=cannon_es_performance.now()),wt=0;wt<this.frictionEquations.length;wt++)tt.addEquation(this.frictionEquations[wt]);const Dt=c.length;for(let Yt=0;Yt!==Dt;Yt++){const nr=c[Yt],rr=nr.bi,lr=nr.bj,or=nr.si,pr=nr.sj;let hr;hr=rr.material&&lr.material&&this.getContactMaterial(rr.material,lr.material)||this.defaultContactMaterial,hr.friction,rr.material&&lr.material&&(rr.material.friction>=0&&lr.material.friction>=0&&(rr.material.friction,lr.material.friction),rr.material.restitution>=0&&lr.material.restitution>=0&&(nr.restitution=rr.material.restitution*lr.material.restitution)),tt.addEquation(nr),rr.allowSleep&&rr.type===Body.DYNAMIC&&rr.sleepState===Body.SLEEPING&&lr.sleepState===Body.AWAKE&&lr.type!==Body.STATIC&&lr.velocity.lengthSquared()+lr.angularVelocity.lengthSquared()>=2*lr.sleepSpeedLimit**2&&(rr.wakeUpAfterNarrowphase=!0),lr.allowSleep&&lr.type===Body.DYNAMIC&&lr.sleepState===Body.SLEEPING&&rr.sleepState===Body.AWAKE&&rr.type!==Body.STATIC&&rr.velocity.lengthSquared()+rr.angularVelocity.lengthSquared()>=2*rr.sleepSpeedLimit**2&&(lr.wakeUpAfterNarrowphase=!0),this.collisionMatrix.set(rr,lr,!0),this.collisionMatrixPrevious.get(rr,lr)||(World_step_collideEvent.body=lr,World_step_collideEvent.contact=nr,rr.dispatchEvent(World_step_collideEvent),World_step_collideEvent.body=rr,lr.dispatchEvent(World_step_collideEvent)),this.bodyOverlapKeeper.set(rr.id,lr.id),this.shapeOverlapKeeper.set(or.id,pr.id)}for(this.emitContactEvents(),nt&&(lt.makeContactConstraints=cannon_es_performance.now()-ht,ht=cannon_es_performance.now()),wt=0;wt!==v;wt++){const Yt=b[wt];Yt.wakeUpAfterNarrowphase&&(Yt.wakeUp(),Yt.wakeUpAfterNarrowphase=!1)}for(Pt=_t.length,wt=0;wt!==Pt;wt++){const Yt=_t[wt];Yt.update();for(let nr=0,rr=Yt.equations.length;nr!==rr;nr++){const lr=Yt.equations[nr];tt.addEquation(lr)}}tt.solve(o,this),nt&&(lt.solve=cannon_es_performance.now()-ht),tt.removeAllEquations();const It=Math.pow;for(wt=0;wt!==v;wt++){const Yt=b[wt];if(Yt.type&ut){const nr=It(1-Yt.linearDamping,o),rr=Yt.velocity;rr.scale(nr,rr);const lr=Yt.angularVelocity;if(lr){const or=It(1-Yt.angularDamping,o);lr.scale(or,lr)}}}this.dispatchEvent(World_step_preStepEvent),nt&&(ht=cannon_es_performance.now());const Nt=this.stepnumber%(this.quatNormalizeSkip+1)==0,Vt=this.quatNormalizeFast;for(wt=0;wt!==v;wt++)b[wt].integrate(o,Nt,Vt);this.clearForces(),this.broadphase.dirty=!0,nt&&(lt.integrate=cannon_es_performance.now()-ht),this.stepnumber+=1,this.dispatchEvent(World_step_postStepEvent);let Kt=!0;if(this.allowSleep)for(Kt=!1,wt=0;wt!==v;wt++){const Yt=b[wt];Yt.sleepTick(this.time),Yt.sleepState!==Body.SLEEPING&&(Kt=!0)}this.hasActiveBodies=Kt}emitContactEvents(){const o=this.hasAnyEventListener("beginContact"),c=this.hasAnyEventListener("endContact");if((o||c)&&this.bodyOverlapKeeper.getDiff(additions,removals),o){for(let v=0,b=additions.length;v<b;v+=2)beginContactEvent.bodyA=this.getBodyById(additions[v]),beginContactEvent.bodyB=this.getBodyById(additions[v+1]),this.dispatchEvent(beginContactEvent);beginContactEvent.bodyA=beginContactEvent.bodyB=null}if(c){for(let v=0,b=removals.length;v<b;v+=2)endContactEvent.bodyA=this.getBodyById(removals[v]),endContactEvent.bodyB=this.getBodyById(removals[v+1]),this.dispatchEvent(endContactEvent);endContactEvent.bodyA=endContactEvent.bodyB=null}additions.length=removals.length=0;const d=this.hasAnyEventListener("beginShapeContact"),_=this.hasAnyEventListener("endShapeContact");if((d||_)&&this.shapeOverlapKeeper.getDiff(additions,removals),d){for(let v=0,b=additions.length;v<b;v+=2){const tt=this.getShapeById(additions[v]),it=this.getShapeById(additions[v+1]);beginShapeContactEvent.shapeA=tt,beginShapeContactEvent.shapeB=it,tt&&(beginShapeContactEvent.bodyA=tt.body),it&&(beginShapeContactEvent.bodyB=it.body),this.dispatchEvent(beginShapeContactEvent)}beginShapeContactEvent.bodyA=beginShapeContactEvent.bodyB=beginShapeContactEvent.shapeA=beginShapeContactEvent.shapeB=null}if(_){for(let v=0,b=removals.length;v<b;v+=2){const tt=this.getShapeById(removals[v]),it=this.getShapeById(removals[v+1]);endShapeContactEvent.shapeA=tt,endShapeContactEvent.shapeB=it,tt&&(endShapeContactEvent.bodyA=tt.body),it&&(endShapeContactEvent.bodyB=it.body),this.dispatchEvent(endShapeContactEvent)}endShapeContactEvent.bodyA=endShapeContactEvent.bodyB=endShapeContactEvent.shapeA=endShapeContactEvent.shapeB=null}}clearForces(){const o=this.bodies,c=o.length;for(let d=0;d!==c;d++){const _=o[d];_.force,_.torque,_.force.set(0,0,0),_.torque.set(0,0,0)}}}new AABB;const tmpRay=new Ray,cannon_es_performance=globalThis.performance||{};if(!cannon_es_performance.now){let h=Date.now();cannon_es_performance.timing&&cannon_es_performance.timing.navigationStart&&(h=cannon_es_performance.timing.navigationStart),cannon_es_performance.now=()=>Date.now()-h}new Vec3;const World_step_postStepEvent={type:"postStep"},World_step_preStepEvent={type:"preStep"},World_step_collideEvent={type:Body.COLLIDE_EVENT_NAME,body:null,contact:null},World_step_oldContacts=[],World_step_frictionEquationPool=[],World_step_p1=[],World_step_p2=[],additions=[],removals=[],beginContactEvent={type:"beginContact",bodyA:null,bodyB:null},endContactEvent={type:"endContact",bodyA:null,bodyB:null},beginShapeContactEvent={type:"beginShapeContact",bodyA:null,bodyB:null,shapeA:null,shapeB:null},endShapeContactEvent={type:"endShapeContact",bodyA:null,bodyB:null,shapeA:null,shapeB:null};var ConvexHull=function(){var h,o,c,d=new three_module.Pq0;function _(){this.tolerance=-1,this.faces=[],this.newFaces=[],this.assigned=new it,this.unassigned=new it,this.vertices=[]}function v(){this.normal=new three_module.Pq0,this.midpoint=new three_module.Pq0,this.area=0,this.constant=0,this.outside=null,this.mark=0,this.edge=null}function b(nt,lt){this.vertex=nt,this.prev=null,this.next=null,this.twin=null,this.face=lt}function tt(nt,lt){this.point=nt,this.index=lt,this.prev=null,this.next=null,this.face=null}function it(){this.head=null,this.tail=null}return Object.assign(_.prototype,{toJSON:function(){const nt=this.faces.map(ft=>ft.toArray()),lt=Array.from(new Set(nt.flat())).sort(),ut=[];for(let ft=0;ft<lt.length;ft++)ut.push(this.vertices[lt[ft]].point.x,this.vertices[lt[ft]].point.y,this.vertices[lt[ft]].point.z);const ht=new Map;for(let ft=0;ft<lt.length;ft++)ht.set(lt[ft],ft);const _t=[];for(let ft=0;ft<nt.length;ft++)_t.push([ht.get(nt[ft][0]),ht.get(nt[ft][1]),ht.get(nt[ft][2])]);return[ut,_t]},setFromPoints:function(nt){Array.isArray(nt)!==!0&&console.error("THREE.ConvexHull: Points parameter is not an array."),nt.length<4&&console.error("THREE.ConvexHull: The algorithm needs at least four points."),this.makeEmpty();for(var lt=0,ut=nt.length;lt<ut;lt++)this.vertices.push(new tt(nt[lt],lt));return this.compute(),this},setFromObject:function(nt){var lt=[];return nt.updateMatrixWorld(!0),nt.traverse(function(ut){var ht,_t,ft,bt=ut.geometry;if(bt!==void 0&&(bt.isGeometry&&(bt=bt.toBufferGeometry?bt.toBufferGeometry():new BufferGeometry().fromGeometry(bt)),bt.isBufferGeometry)){var xt=bt.attributes.position;if(xt!==void 0)for(ht=0,_t=xt.count;ht<_t;ht++)(ft=new three_module.Pq0).fromBufferAttribute(xt,ht).applyMatrix4(ut.matrixWorld),lt.push(ft)}}),this.setFromPoints(lt)},containsPoint:function(nt){for(var lt=this.faces,ut=0,ht=lt.length;ut<ht;ut++)if(lt[ut].distanceToPoint(nt)>this.tolerance)return!1;return!0},intersectRay:function(nt,lt){for(var ut=this.faces,ht=-1/0,_t=1/0,ft=0,bt=ut.length;ft<bt;ft++){var xt=ut[ft],St=xt.distanceToPoint(nt.origin),wt=xt.normal.dot(nt.direction);if(St>0&&wt>=0)return null;var Pt=wt!==0?-St/wt:0;if(!(Pt<=0)&&(wt>0?_t=Math.min(Pt,_t):ht=Math.max(Pt,ht),ht>_t))return null}return ht!==-1/0?nt.at(ht,lt):nt.at(_t,lt),lt},intersectsRay:function(nt){return this.intersectRay(nt,d)!==null},makeEmpty:function(){return this.faces=[],this.vertices=[],this},addVertexToFace:function(nt,lt){return nt.face=lt,lt.outside===null?this.assigned.append(nt):this.assigned.insertBefore(lt.outside,nt),lt.outside=nt,this},removeVertexFromFace:function(nt,lt){return nt===lt.outside&&(nt.next!==null&&nt.next.face===lt?lt.outside=nt.next:lt.outside=null),this.assigned.remove(nt),this},removeAllVerticesFromFace:function(nt){if(nt.outside!==null){for(var lt=nt.outside,ut=nt.outside;ut.next!==null&&ut.next.face===nt;)ut=ut.next;return this.assigned.removeSubList(lt,ut),lt.prev=ut.next=null,nt.outside=null,lt}},deleteFaceVertices:function(nt,lt){var ut=this.removeAllVerticesFromFace(nt);if(ut!==void 0)if(lt===void 0)this.unassigned.appendChain(ut);else{var ht=ut;do{var _t=ht.next;lt.distanceToPoint(ht.point)>this.tolerance?this.addVertexToFace(ht,lt):this.unassigned.append(ht),ht=_t}while(ht!==null)}return this},resolveUnassignedPoints:function(nt){if(this.unassigned.isEmpty()===!1){var lt=this.unassigned.first();do{for(var ut=lt.next,ht=this.tolerance,_t=null,ft=0;ft<nt.length;ft++){var bt=nt[ft];if(bt.mark===0){var xt=bt.distanceToPoint(lt.point);if(xt>ht&&(ht=xt,_t=bt),ht>1e3*this.tolerance)break}}_t!==null&&this.addVertexToFace(lt,_t),lt=ut}while(lt!==null)}return this},computeExtremes:function(){var nt,lt,ut,ht=new three_module.Pq0,_t=new three_module.Pq0,ft=[],bt=[];for(nt=0;nt<3;nt++)ft[nt]=bt[nt]=this.vertices[0];for(ht.copy(this.vertices[0].point),_t.copy(this.vertices[0].point),nt=0,lt=this.vertices.length;nt<lt;nt++){var xt=this.vertices[nt],St=xt.point;for(ut=0;ut<3;ut++)St.getComponent(ut)<ht.getComponent(ut)&&(ht.setComponent(ut,St.getComponent(ut)),ft[ut]=xt);for(ut=0;ut<3;ut++)St.getComponent(ut)>_t.getComponent(ut)&&(_t.setComponent(ut,St.getComponent(ut)),bt[ut]=xt)}return this.tolerance=3*Number.EPSILON*(Math.max(Math.abs(ht.x),Math.abs(_t.x))+Math.max(Math.abs(ht.y),Math.abs(_t.y))+Math.max(Math.abs(ht.z),Math.abs(_t.z))),{min:ft,max:bt}},computeInitialHull:function(){h===void 0&&(h=new three_module.cZY,o=new three_module.Zcv,c=new three_module.Pq0);var nt,lt,ut,ht,_t,ft,bt,xt,St,wt=this.vertices,Pt=this.computeExtremes(),Rt=Pt.min,kt=Pt.max,Gt=0,Dt=0;for(ft=0;ft<3;ft++)(St=kt[ft].point.getComponent(ft)-Rt[ft].point.getComponent(ft))>Gt&&(Gt=St,Dt=ft);for(lt=Rt[Dt],ut=kt[Dt],Gt=0,h.set(lt.point,ut.point),ft=0,bt=this.vertices.length;ft<bt;ft++)(nt=wt[ft])!==lt&&nt!==ut&&(h.closestPointToPoint(nt.point,!0,c),(St=c.distanceToSquared(nt.point))>Gt&&(Gt=St,ht=nt));for(Gt=-1,o.setFromCoplanarPoints(lt.point,ut.point,ht.point),ft=0,bt=this.vertices.length;ft<bt;ft++)(nt=wt[ft])!==lt&&nt!==ut&&nt!==ht&&(St=Math.abs(o.distanceToPoint(nt.point)))>Gt&&(Gt=St,_t=nt);var It=[];if(o.distanceToPoint(_t.point)<0)for(It.push(v.create(lt,ut,ht),v.create(_t,ut,lt),v.create(_t,ht,ut),v.create(_t,lt,ht)),ft=0;ft<3;ft++)xt=(ft+1)%3,It[ft+1].getEdge(2).setTwin(It[0].getEdge(xt)),It[ft+1].getEdge(1).setTwin(It[xt+1].getEdge(0));else for(It.push(v.create(lt,ht,ut),v.create(_t,lt,ut),v.create(_t,ut,ht),v.create(_t,ht,lt)),ft=0;ft<3;ft++)xt=(ft+1)%3,It[ft+1].getEdge(2).setTwin(It[0].getEdge((3-ft)%3)),It[ft+1].getEdge(0).setTwin(It[xt+1].getEdge(1));for(ft=0;ft<4;ft++)this.faces.push(It[ft]);for(ft=0,bt=wt.length;ft<bt;ft++)if((nt=wt[ft])!==lt&&nt!==ut&&nt!==ht&&nt!==_t){Gt=this.tolerance;var Nt=null;for(xt=0;xt<4;xt++)(St=this.faces[xt].distanceToPoint(nt.point))>Gt&&(Gt=St,Nt=this.faces[xt]);Nt!==null&&this.addVertexToFace(nt,Nt)}return this},reindexFaces:function(){for(var nt=[],lt=0;lt<this.faces.length;lt++){var ut=this.faces[lt];ut.mark===0&&nt.push(ut)}return this.faces=nt,this},nextVertexToAdd:function(){if(this.assigned.isEmpty()===!1){var nt,lt=0,ut=this.assigned.first().face,ht=ut.outside;do{var _t=ut.distanceToPoint(ht.point);_t>lt&&(lt=_t,nt=ht),ht=ht.next}while(ht!==null&&ht.face===ut);return nt}},computeHorizon:function(nt,lt,ut,ht){var _t;this.deleteFaceVertices(ut),ut.mark=1,_t=lt===null?lt=ut.getEdge(0):lt.next;do{var ft=_t.twin,bt=ft.face;bt.mark===0&&(bt.distanceToPoint(nt)>this.tolerance?this.computeHorizon(nt,ft,bt,ht):ht.push(_t)),_t=_t.next}while(_t!==lt);return this},addAdjoiningFace:function(nt,lt){var ut=v.create(nt,lt.tail(),lt.head());return this.faces.push(ut),ut.getEdge(-1).setTwin(lt.twin),ut.getEdge(0)},addNewFaces:function(nt,lt){this.newFaces=[];for(var ut=null,ht=null,_t=0;_t<lt.length;_t++){var ft=lt[_t],bt=this.addAdjoiningFace(nt,ft);ut===null?ut=bt:bt.next.setTwin(ht),this.newFaces.push(bt.face),ht=bt}return ut.next.setTwin(ht),this},addVertexToHull:function(nt){var lt=[];return this.unassigned.clear(),this.removeVertexFromFace(nt,nt.face),this.computeHorizon(nt.point,null,nt.face,lt),this.addNewFaces(nt,lt),this.resolveUnassignedPoints(this.newFaces),this},cleanup:function(){return this.assigned.clear(),this.unassigned.clear(),this.newFaces=[],this},compute:function(){var nt;for(this.computeInitialHull();(nt=this.nextVertexToAdd())!==void 0;)this.addVertexToHull(nt);return this.reindexFaces(),this.cleanup(),this}}),Object.assign(v,{create:function(nt,lt,ut){var ht=new v,_t=new b(nt,ht),ft=new b(lt,ht),bt=new b(ut,ht);return _t.next=bt.prev=ft,ft.next=_t.prev=bt,bt.next=ft.prev=_t,ht.edge=_t,ht.compute()}}),Object.assign(v.prototype,{toArray:function(){const nt=[];let lt=this.edge;do nt.push(lt.head().index),lt=lt.next;while(lt!==this.edge);return nt},getEdge:function(nt){for(var lt=this.edge;nt>0;)lt=lt.next,nt--;for(;nt<0;)lt=lt.prev,nt++;return lt},compute:function(){var nt;return function(){nt===void 0&&(nt=new three_module.lMl);var lt=this.edge.tail(),ut=this.edge.head(),ht=this.edge.next.head();return nt.set(lt.point,ut.point,ht.point),nt.getNormal(this.normal),nt.getMidpoint(this.midpoint),this.area=nt.getArea(),this.constant=this.normal.dot(this.midpoint),this}}(),distanceToPoint:function(nt){return this.normal.dot(nt)-this.constant}}),Object.assign(b.prototype,{head:function(){return this.vertex},tail:function(){return this.prev?this.prev.vertex:null},length:function(){var nt=this.head(),lt=this.tail();return lt!==null?lt.point.distanceTo(nt.point):-1},lengthSquared:function(){var nt=this.head(),lt=this.tail();return lt!==null?lt.point.distanceToSquared(nt.point):-1},setTwin:function(nt){return this.twin=nt,nt.twin=this,this}}),Object.assign(it.prototype,{first:function(){return this.head},last:function(){return this.tail},clear:function(){return this.head=this.tail=null,this},insertBefore:function(nt,lt){return lt.prev=nt.prev,lt.next=nt,lt.prev===null?this.head=lt:lt.prev.next=lt,nt.prev=lt,this},insertAfter:function(nt,lt){return lt.prev=nt,lt.next=nt.next,lt.next===null?this.tail=lt:lt.next.prev=lt,nt.next=lt,this},append:function(nt){return this.head===null?this.head=nt:this.tail.next=nt,nt.prev=this.tail,nt.next=null,this.tail=nt,this},appendChain:function(nt){for(this.head===null?this.head=nt:this.tail.next=nt,nt.prev=this.tail;nt.next!==null;)nt=nt.next;return this.tail=nt,this},remove:function(nt){return nt.prev===null?this.head=nt.next:nt.prev.next=nt.next,nt.next===null?this.tail=nt.prev:nt.next.prev=nt.prev,this},removeSubList:function(nt,lt){return nt.prev===null?this.head=lt.next:nt.prev.next=lt.next,lt.next===null?this.tail=nt.prev:lt.next.prev=nt.prev,this},isEmpty:function(){return this.head===null}}),_}();const three_to_cannon_modern_v1=new three_module.Pq0,_v2=new three_module.Pq0,three_to_cannon_modern_q1=new three_module.PTz;function getGeometry(h){const o=getMeshes(h);if(o.length===0)return null;if(o.length===1)return normalizeGeometry(o[0]);let c;const d=[];for(;c=o.pop();)d.push(simplifyGeometry(normalizeGeometry(c)));return three_to_cannon_modern_mergeBufferGeometries(d)}function normalizeGeometry(h){let o=h.geometry;return o=o.toBufferGeometry?o.toBufferGeometry():o.clone(),h.updateMatrixWorld(),h.matrixWorld.decompose(three_to_cannon_modern_v1,three_to_cannon_modern_q1,_v2),o.scale(_v2.x,_v2.y,_v2.z),o}function three_to_cannon_modern_mergeBufferGeometries(h){let o=0;for(let _=0;_<h.length;_++){const v=h[_].attributes.position;v&&v.itemSize===3&&(o+=v.count)}const c=new Float32Array(3*o);let d=0;for(let _=0;_<h.length;_++){const v=h[_].attributes.position;if(v&&v.itemSize===3)for(let b=0;b<v.count;b++)c[d++]=v.getX(b),c[d++]=v.getY(b),c[d++]=v.getZ(b)}return new three_module.LoY().setAttribute("position",new three_module.THS(c,3))}function getVertices(h){const o=h.attributes.position,c=new Float32Array(3*o.count);for(let d=0;d<o.count;d++)c[3*d]=o.getX(d),c[3*d+1]=o.getY(d),c[3*d+2]=o.getZ(d);return c}function getMeshes(h){const o=[];return h.traverse(function(c){c.isMesh&&o.push(c)}),o}function getComponent(h,o){switch(o){case"x":return h.x;case"y":return h.y;case"z":return h.z}throw new Error(`Unexpected component ${o}`)}function simplifyGeometry(h,o=1e-4){o=Math.max(o,Number.EPSILON);const c={},d=h.getIndex(),_=h.getAttribute("position"),v=d?d.count:_.count;let b=0;const tt=[],it=[],nt=Math.log10(1/o),lt=Math.pow(10,nt);for(let _t=0;_t<v;_t++){const ft=d?d.getX(_t):_t;let bt="";bt+=~~(_.getX(ft)*lt)+",",bt+=~~(_.getY(ft)*lt)+",",bt+=~~(_.getZ(ft)*lt)+",",bt in c?tt.push(c[bt]):(it.push(_.getX(ft)),it.push(_.getY(ft)),it.push(_.getZ(ft)),c[bt]=b,tt.push(b),b++)}const ut=new three_module.THS(new Float32Array(it),_.itemSize,_.normalized),ht=new three_module.LoY;return ht.setAttribute("position",ut),ht.setIndex(tt),ht}const PI_2=Math.PI/2;var ShapeType;(function(h){h.BOX="Box",h.CYLINDER="Cylinder",h.SPHERE="Sphere",h.HULL="ConvexPolyhedron",h.MESH="Trimesh"})(ShapeType||(ShapeType={}));const getShapeParameters=function(h,o={}){let c;if(o.type===ShapeType.BOX)return getBoundingBoxParameters(h);if(o.type===ShapeType.CYLINDER)return getBoundingCylinderParameters(h,o);if(o.type===ShapeType.SPHERE)return getBoundingSphereParameters(h,o);if(o.type===ShapeType.HULL)return getConvexPolyhedronParameters(h);if(o.type===ShapeType.MESH)return c=getGeometry(h),c?getTrimeshParameters(c):null;if(o.type)throw new Error(`[CANNON.getShapeParameters] Invalid type "${o.type}".`);if(c=getGeometry(h),!c)return null;switch(c.type){case"BoxGeometry":case"BoxBufferGeometry":return getBoxParameters(c);case"CylinderGeometry":case"CylinderBufferGeometry":return getCylinderParameters(c);case"PlaneGeometry":case"PlaneBufferGeometry":return getPlaneParameters(c);case"SphereGeometry":case"SphereBufferGeometry":return getSphereParameters(c);case"TubeGeometry":case"BufferGeometry":return getBoundingBoxParameters(h);default:return console.warn('Unrecognized geometry: "%s". Using bounding box as shape.',c.type),getBoxParameters(c)}},threeToCannon=function(h,o={}){const c=getShapeParameters(h,o);if(!c)return null;const{type:d,params:_,offset:v,orientation:b}=c;let tt;return tt=d===ShapeType.BOX?createBox$1(_):d===ShapeType.CYLINDER?createCylinder(_):d===ShapeType.SPHERE?createSphere(_):d===ShapeType.HULL?createConvexPolyhedron(_):createTrimesh(_),{shape:tt,offset:v,orientation:b}};function createBox$1(h){const{x:o,y:c,z:d}=h;return new Box(new Vec3(o,c,d))}function createCylinder(h){const{radiusTop:o,radiusBottom:c,height:d,segments:_}=h,v=new Cylinder(o,c,d,_);return v.radiusTop=c,v.radiusBottom=c,v.height=d,v.numSegments=_,v}function createSphere(h){return new Sphere(h.radius)}function createConvexPolyhedron(h){const{faces:o,vertices:c}=h,d=[];for(let _=0;_<c.length;_+=3)d.push(new Vec3(c[_],c[_+1],c[_+2]));return new ConvexPolyhedron({faces:o,vertices:d})}function createTrimesh(h){const{vertices:o,indices:c}=h;return new Trimesh(o,c)}function getBoxParameters(h){if(!getVertices(h).length)return null;h.computeBoundingBox();const o=h.boundingBox;return{type:ShapeType.BOX,params:{x:(o.max.x-o.min.x)/2,y:(o.max.y-o.min.y)/2,z:(o.max.z-o.min.z)/2}}}function getBoundingBoxParameters(h){const o=h.clone();o.quaternion.set(0,0,0,1),o.updateMatrixWorld();const c=new three_module.NRn().setFromObject(o);if(!isFinite(c.min.lengthSq()))return null;const d=c.translate(o.position.negate()).getCenter(new three_module.Pq0);return{type:ShapeType.BOX,params:{x:(c.max.x-c.min.x)/2,y:(c.max.y-c.min.y)/2,z:(c.max.z-c.min.z)/2},offset:d.lengthSq()?new Vec3(d.x,d.y,d.z):void 0}}function getConvexPolyhedronParameters(h){const o=getGeometry(h);if(!o)return null;const c=1e-4;for(let v=0;v<o.attributes.position.count;v++)o.attributes.position.setXYZ(v,o.attributes.position.getX(v)+(Math.random()-.5)*c,o.attributes.position.getY(v)+(Math.random()-.5)*c,o.attributes.position.getZ(v)+(Math.random()-.5)*c);const[d,_]=new ConvexHull().setFromObject(new three_module.eaF(o)).toJSON();return{type:ShapeType.HULL,params:{vertices:new Float32Array(d),faces:_}}}function getCylinderParameters(h){const o=h.parameters;return{type:ShapeType.CYLINDER,params:{radiusTop:o.radiusTop,radiusBottom:o.radiusBottom,height:o.height,segments:o.radialSegments},orientation:new Quaternion().setFromEuler(three_module.cj9.degToRad(-90),0,0,"XYZ").normalize()}}function getBoundingCylinderParameters(h,o){const c=["x","y","z"],d=o.cylinderAxis||"y",_=c.splice(c.indexOf(d),1)&&c,v=new three_module.NRn().setFromObject(h);if(!isFinite(v.min.lengthSq()))return null;const b=v.max[d]-v.min[d],tt=.5*Math.max(getComponent(v.max,_[0])-getComponent(v.min,_[0]),getComponent(v.max,_[1])-getComponent(v.min,_[1])),it=d==="y"?PI_2:0,nt=d==="z"?PI_2:0;return{type:ShapeType.CYLINDER,params:{radiusTop:tt,radiusBottom:tt,height:b,segments:12},orientation:new Quaternion().setFromEuler(it,nt,0,"XYZ").normalize()}}function getPlaneParameters(h){h.computeBoundingBox();const o=h.boundingBox;return{type:ShapeType.BOX,params:{x:(o.max.x-o.min.x)/2||.1,y:(o.max.y-o.min.y)/2||.1,z:(o.max.z-o.min.z)/2||.1}}}function getSphereParameters(h){return{type:ShapeType.SPHERE,params:{radius:h.parameters.radius}}}function getBoundingSphereParameters(h,o){if(o.sphereRadius)return{type:ShapeType.SPHERE,params:{radius:o.sphereRadius}};const c=getGeometry(h);return c?(c.computeBoundingSphere(),{type:ShapeType.SPHERE,params:{radius:c.boundingSphere.radius}}):null}function getTrimeshParameters(h){const o=getVertices(h);if(!o.length)return null;const c=new Uint32Array(o.length);for(let d=0;d<o.length;d++)c[d]=d;return{type:ShapeType.MESH,params:{vertices:o,indices:c}}}var CannonPhysicsPlugin_decorate=function(h,o,c,d){var _,v=arguments.length,b=v<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(h,o,c,d);else for(var tt=h.length-1;tt>=0;tt--)(_=h[tt])&&(b=(v<3?_(b):v>3?_(o,c,b):_(o,c))||b);return v>3&&b&&Object.defineProperty(o,c,b),b},CannonPhysicsPlugin_1;let CannonPhysicsPlugin=CannonPhysicsPlugin_1=class extends AViewerPlugin{constructor(h=!1){super(),this._world=new World,this.enabled=!0,this.nextSteps=0,this.stepPhysics={stepCount:100,delta:.1,step:()=>{this.nextSteps=this.stepPhysics.stepCount}},this.makeRootBodies=()=>{var _;(_=this._viewer)===null||_===void 0||_.scene.modelRoot.children.forEach(v=>{this.makeBody(v)})},this._bodyMeshMap=new Map,this._movementPlane=new three_module.eaF(new three_module.bdM(100,100),new three_module.V9B({color:65280,side:three_module.$EB})),this.enabled=h,this._world.gravity.set(0,-9.81,0);const o=new cannon_es_Plane,c=new Body({mass:0,position:new Vec3(0,-2,0)});c.addShape(o),c.quaternion.setFromEuler(-Math.PI/2,0,0),this._ground=c,this._world.addBody(c);const d=new Sphere(.1);this._jointBody=new Body({mass:0}),this._jointBody.addShape(d),this._jointBody.collisionFilterGroup=0,this._jointBody.collisionFilterMask=0,this._world.addBody(this._jointBody)}async onAdded(h){await super.onAdded(h);const o=new three_module.Pq0,c=new three_module.Pq0,d=new three_module.Pq0,_=new three_module.PTz,v=new three_module.PTz,b=new three_module.kn4,tt=new three_module.kn4;let it=!1,nt=!1;function lt(ut){const ht=h.canvas.getBoundingClientRect(),_t=new three_module.I9Y;return _t.x=(ut.clientX-ht.x)/ht.width*2-1,_t.y=-(ut.clientY-ht.y)/ht.height*2+1,_t}h.addEventListener("preFrame",()=>{const ut=h.getPlugin(GroundPlugin),ht=h.getPlugin(FrameFadePlugin);if(!this.enabled){if(!(this.nextSteps>0))return ut&&it&&(ut.enableRefreshTransform=!0,it=!1),ht&&nt&&(ht.enable(CannonPhysicsPlugin_1.PluginType),nt=!1),void(this._dirty=!1);this.enabled=!0}if(ut&&ut.enableRefreshTransform&&!it&&(ut.enableRefreshTransform=!1,it=!0),ht&&!nt&&ht.disable(CannonPhysicsPlugin_1.PluginType),this.nextSteps>0)for(let ft=0;ft<this.stepPhysics.stepCount;ft++)this._world.step(this.stepPhysics.delta);else this._world.fixedStep();this._dirty=!1;let _t=!1;for(const ft of this._world.bodies){if(ft.mass===0)continue;const bt=this._bodyMeshMap.get(ft);if(bt&&(bt.updateMatrixWorld(),bt.getWorldPosition(c),bt.getWorldQuaternion(v),bt.getWorldScale(d),c.manhattanDistanceTo(o.copy(ft.position))>0&&(_t=!0),v.angleTo(_.copy(ft.quaternion))>0&&(_t=!0),_t)){if(b.compose(o,_,d),!bt.parent)throw new Error("no parent");tt.copy(bt.parent.matrixWorld).invert(),tt.multiply(b),tt.decompose(o,_,d),bt.position.copy(o),bt.quaternion.copy(_)}}this._dirty=_t,h.setDirty(),h.renderer.resetShadows(),ut==null||ut.bakeShadows(),this.nextSteps>0&&(this.enabled=!1,this.nextSteps=0)}),h.scene.addEventListener("update",ut=>{this._bodyMeshMap.forEach((ht,_t)=>{_t.velocity.set(0,0,0),_t.angularVelocity.set(0,0,0)})}),h.scene.addEventListener("addSceneObject",ut=>{var ht;const _t=(ht=ut.object)===null||ht===void 0?void 0:ht.modelObject;_t&&_t.traverse(ft=>{const bt=ft.uiConfig;bt&&Array.isArray(bt.children)&&!ft.isWidget&&(bt.children.push({type:"folder",label:"Physics",children:[{type:"button",label:"Make Body",value:()=>this.makeBody(ft)},{type:"number",label:"Mass",hidden:()=>!ft._physicsBody,getValue:()=>{var xt,St;return(St=(xt=ft._physicsBody)===null||xt===void 0?void 0:xt.mass)!==null&&St!==void 0?St:0},setValue:xt=>{ft._physicsBody&&(ft._physicsBody.mass=xt)}}]}),ft.userData.physicsMass!==void 0&&this.makeBody(ft))})}),h.canvas.addEventListener("pointerdown",ut=>{if(!this.enabled||!ut.isPrimary)return;h.getPlugin(PickingPlugin)&&(h.getPlugin(PickingPlugin).enabled=!1);const ht=lt(ut),_t=new three_module.tBo;_t.setFromCamera(ht,h.scene.activeCamera.cameraObject);const ft=_t.intersectObjects([...this._bodyMeshMap.values()],!0);if(!ft.length)return;let bt,xt=null,St=ft[0];for(const Rt of ft){for(xt=Rt.object,St=Rt;!(xt==null||xt.visible&&xt.material);)xt=xt.parent;if(xt)break}if(!xt)return;for(;xt.parent&&!bt;){for(const[Rt,kt]of this._bodyMeshMap.entries())if(kt===xt){Rt.mass>0&&(bt=Rt);break}xt=xt.parent}if(!bt)return;h.scene.activeCamera.setInteractions(!1,CannonPhysicsPlugin_1.PluginType),this._movementPlane.position.copy(St.point),this._movementPlane.lookAt(h.scene.activeCamera.cameraObject.getWorldPosition(new three_module.Pq0));const wt=new Vec3().copy(St.point).vsub(bt.position),Pt=bt.quaternion.inverse().vmult(wt);this._jointBody.position.copy(St.point),this._jointConstraint=new PointToPointConstraint(bt,Pt,this._jointBody,new Vec3(0,0,0)),this._world.addConstraint(this._jointConstraint)}),h.canvas.addEventListener("pointermove",ut=>{if(!this.enabled||!ut.isPrimary||!this._jointConstraint)return;const ht=lt(ut),_t=new three_module.tBo;_t.setFromCamera(ht,h.scene.activeCamera.cameraObject);const ft=_t.intersectObject(this._movementPlane);if(!ft.length)return;const bt=ft[0];this._jointBody.position.copy(bt.point),this._jointConstraint.update()}),h.canvas.addEventListener("pointerup",ut=>{this.enabled&&ut.isPrimary&&(h.getPlugin(PickingPlugin)&&(h.getPlugin(PickingPlugin).enabled=!0),h.scene.activeCamera.setInteractions(!0,CannonPhysicsPlugin_1.PluginType),this._jointConstraint&&(this._world.removeConstraint(this._jointConstraint),this._jointConstraint=void 0))})}makeBody(h){if(h.isLight||h._physicsBody)return;const o=[];let c=0;if(h.updateMatrixWorld(),h.traverse(it=>{var nt;const lt=it;if(!lt.isMesh||!lt.material||!lt.visible)return;if(lt._physicsShape)return void o.push(lt._physicsShape);if(c+=(nt=lt.userData.physicsMass)!==null&&nt!==void 0?nt:1,lt.addEventListener("objectUpdate",()=>{lt.userData.physicsMass===0&&(this._ground.position.y=lt.position.y,this._bodyMeshMap.forEach((ht,_t)=>{_t.velocity.set(0,0,0),_t.angularVelocity.set(0,0,0),_t.force.set(0,0,0),_t.torque.set(0,0,0)}))}),lt.userData.physicsMass===0)return;const ut=threeToCannon(lt,{type:ShapeType.HULL});ut?(o.push([ut.shape,lt]),lt._physicsShape=ut.shape):console.warn("Failed to convert mesh to cannon shape",lt)}),!o.length)return;const d=new Body({mass:c,angularVelocity:new Vec3(0,0,0),velocity:new Vec3(0,0,0)}),_=new three_module.Pq0,v=new three_module.PTz,b=new three_module.Pq0,tt=new three_module.kn4;for(const[it,nt]of o)nt!==h?(nt.updateMatrixWorld(),tt.copy(h.matrixWorld).invert(),tt.multiply(nt.matrixWorld),tt.decompose(_,v,b),d.addShape(it,new Vec3(..._.toArray()),new Quaternion(...v.toArray()))):d.addShape(it);d.position.set(...h.getWorldPosition(_).toArray()),d.quaternion.set(...h.getWorldQuaternion(v).toArray()),d.angularVelocity.set(0,0,0),d.velocity.set(0,0,0),h.addEventListener("objectUpdate",()=>{d.position.set(...h.getWorldPosition(_).toArray()),d.quaternion.set(...h.getWorldQuaternion(v).toArray()),d.angularVelocity.set(0,0,0),d.velocity.set(0,0,0)}),this._world.addBody(d),this._bodyMeshMap.set(d,h),h._physicsBody=d,h.setDirty({sceneUpdate:!0,updateGround:!1,frameFade:!1,refreshUi:!0})}};CannonPhysicsPlugin.PluginType="CannonPhysics",CannonPhysicsPlugin_decorate([uiToggle("Enabled",h=>({onChange:()=>{}})),serialize()],CannonPhysicsPlugin.prototype,"enabled",void 0),CannonPhysicsPlugin_decorate([uiConfig()],CannonPhysicsPlugin.prototype,"stepPhysics",void 0),CannonPhysicsPlugin_decorate([uiButton("Make Root Bodies")],CannonPhysicsPlugin.prototype,"makeRootBodies",void 0),CannonPhysicsPlugin=CannonPhysicsPlugin_1=CannonPhysicsPlugin_decorate([uiFolder("Physics (dev)")],CannonPhysicsPlugin);class SimplexNoise{constructor(o=Math){this.grad3=[[1,1,0],[-1,1,0],[1,-1,0],[-1,-1,0],[1,0,1],[-1,0,1],[1,0,-1],[-1,0,-1],[0,1,1],[0,-1,1],[0,1,-1],[0,-1,-1]],this.grad4=[[0,1,1,1],[0,1,1,-1],[0,1,-1,1],[0,1,-1,-1],[0,-1,1,1],[0,-1,1,-1],[0,-1,-1,1],[0,-1,-1,-1],[1,0,1,1],[1,0,1,-1],[1,0,-1,1],[1,0,-1,-1],[-1,0,1,1],[-1,0,1,-1],[-1,0,-1,1],[-1,0,-1,-1],[1,1,0,1],[1,1,0,-1],[1,-1,0,1],[1,-1,0,-1],[-1,1,0,1],[-1,1,0,-1],[-1,-1,0,1],[-1,-1,0,-1],[1,1,1,0],[1,1,-1,0],[1,-1,1,0],[1,-1,-1,0],[-1,1,1,0],[-1,1,-1,0],[-1,-1,1,0],[-1,-1,-1,0]],this.p=[];for(let c=0;c<256;c++)this.p[c]=Math.floor(256*o.random());this.perm=[];for(let c=0;c<512;c++)this.perm[c]=this.p[255&c];this.simplex=[[0,1,2,3],[0,1,3,2],[0,0,0,0],[0,2,3,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,3,0],[0,2,1,3],[0,0,0,0],[0,3,1,2],[0,3,2,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,3,2,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,0,3],[0,0,0,0],[1,3,0,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,3,0,1],[2,3,1,0],[1,0,2,3],[1,0,3,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,3,1],[0,0,0,0],[2,1,3,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,1,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,0,1,2],[3,0,2,1],[0,0,0,0],[3,1,2,0],[2,1,0,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,1,0,2],[0,0,0,0],[3,2,0,1],[3,2,1,0]]}dot(o,c,d){return o[0]*c+o[1]*d}dot3(o,c,d,_){return o[0]*c+o[1]*d+o[2]*_}dot4(o,c,d,_,v){return o[0]*c+o[1]*d+o[2]*_+o[3]*v}noise(o,c){let d,_,v;const b=(o+c)*(.5*(Math.sqrt(3)-1)),tt=Math.floor(o+b),it=Math.floor(c+b),nt=(3-Math.sqrt(3))/6,lt=(tt+it)*nt,ut=o-(tt-lt),ht=c-(it-lt);let _t,ft;ut>ht?(_t=1,ft=0):(_t=0,ft=1);const bt=ut-_t+nt,xt=ht-ft+nt,St=ut-1+2*nt,wt=ht-1+2*nt,Pt=255&tt,Rt=255&it,kt=this.perm[Pt+this.perm[Rt]]%12,Gt=this.perm[Pt+_t+this.perm[Rt+ft]]%12,Dt=this.perm[Pt+1+this.perm[Rt+1]]%12;let It=.5-ut*ut-ht*ht;It<0?d=0:(It*=It,d=It*It*this.dot(this.grad3[kt],ut,ht));let Nt=.5-bt*bt-xt*xt;Nt<0?_=0:(Nt*=Nt,_=Nt*Nt*this.dot(this.grad3[Gt],bt,xt));let Vt=.5-St*St-wt*wt;return Vt<0?v=0:(Vt*=Vt,v=Vt*Vt*this.dot(this.grad3[Dt],St,wt)),70*(d+_+v)}noise3d(o,c,d){let _,v,b,tt;const it=(o+c+d)*.3333333333333333,nt=Math.floor(o+it),lt=Math.floor(c+it),ut=Math.floor(d+it),ht=1/6,_t=(nt+lt+ut)*ht,ft=o-(nt-_t),bt=c-(lt-_t),xt=d-(ut-_t);let St,wt,Pt,Rt,kt,Gt;ft>=bt?bt>=xt?(St=1,wt=0,Pt=0,Rt=1,kt=1,Gt=0):ft>=xt?(St=1,wt=0,Pt=0,Rt=1,kt=0,Gt=1):(St=0,wt=0,Pt=1,Rt=1,kt=0,Gt=1):bt<xt?(St=0,wt=0,Pt=1,Rt=0,kt=1,Gt=1):ft<xt?(St=0,wt=1,Pt=0,Rt=0,kt=1,Gt=1):(St=0,wt=1,Pt=0,Rt=1,kt=1,Gt=0);const Dt=ft-St+ht,It=bt-wt+ht,Nt=xt-Pt+ht,Vt=ft-Rt+2*ht,Kt=bt-kt+2*ht,Yt=xt-Gt+2*ht,nr=ft-1+.5,rr=bt-1+.5,lr=xt-1+.5,or=255&nt,pr=255&lt,hr=255&ut,ur=this.perm[or+this.perm[pr+this.perm[hr]]]%12,cr=this.perm[or+St+this.perm[pr+wt+this.perm[hr+Pt]]]%12,br=this.perm[or+Rt+this.perm[pr+kt+this.perm[hr+Gt]]]%12,fr=this.perm[or+1+this.perm[pr+1+this.perm[hr+1]]]%12;let kr=.6-ft*ft-bt*bt-xt*xt;kr<0?_=0:(kr*=kr,_=kr*kr*this.dot3(this.grad3[ur],ft,bt,xt));let gr=.6-Dt*Dt-It*It-Nt*Nt;gr<0?v=0:(gr*=gr,v=gr*gr*this.dot3(this.grad3[cr],Dt,It,Nt));let tr=.6-Vt*Vt-Kt*Kt-Yt*Yt;tr<0?b=0:(tr*=tr,b=tr*tr*this.dot3(this.grad3[br],Vt,Kt,Yt));let dr=.6-nr*nr-rr*rr-lr*lr;return dr<0?tt=0:(dr*=dr,tt=dr*dr*this.dot3(this.grad3[fr],nr,rr,lr)),32*(_+v+b+tt)}noise4d(o,c,d,_){const v=this.grad4,b=this.simplex,tt=this.perm,it=(Math.sqrt(5)-1)/4,nt=(5-Math.sqrt(5))/20;let lt,ut,ht,_t,ft;const bt=(o+c+d+_)*it,xt=Math.floor(o+bt),St=Math.floor(c+bt),wt=Math.floor(d+bt),Pt=Math.floor(_+bt),Rt=(xt+St+wt+Pt)*nt,kt=o-(xt-Rt),Gt=c-(St-Rt),Dt=d-(wt-Rt),It=_-(Pt-Rt),Nt=(kt>Gt?32:0)+(kt>Dt?16:0)+(Gt>Dt?8:0)+(kt>It?4:0)+(Gt>It?2:0)+(Dt>It?1:0),Vt=b[Nt][0]>=3?1:0,Kt=b[Nt][1]>=3?1:0,Yt=b[Nt][2]>=3?1:0,nr=b[Nt][3]>=3?1:0,rr=b[Nt][0]>=2?1:0,lr=b[Nt][1]>=2?1:0,or=b[Nt][2]>=2?1:0,pr=b[Nt][3]>=2?1:0,hr=b[Nt][0]>=1?1:0,ur=b[Nt][1]>=1?1:0,cr=b[Nt][2]>=1?1:0,br=b[Nt][3]>=1?1:0,fr=kt-Vt+nt,kr=Gt-Kt+nt,gr=Dt-Yt+nt,tr=It-nr+nt,dr=kt-rr+2*nt,Ir=Gt-lr+2*nt,Xr=Dt-or+2*nt,Jr=It-pr+2*nt,on=kt-hr+3*nt,Pn=Gt-ur+3*nt,vn=Dt-cr+3*nt,Gn=It-br+3*nt,ms=kt-1+4*nt,ar=Gt-1+4*nt,vr=Dt-1+4*nt,Cr=It-1+4*nt,Ur=255&xt,Pr=255&St,Dr=255&wt,jr=255&Pt,en=tt[Ur+tt[Pr+tt[Dr+tt[jr]]]]%32,rn=tt[Ur+Vt+tt[Pr+Kt+tt[Dr+Yt+tt[jr+nr]]]]%32,mn=tt[Ur+rr+tt[Pr+lr+tt[Dr+or+tt[jr+pr]]]]%32,bn=tt[Ur+hr+tt[Pr+ur+tt[Dr+cr+tt[jr+br]]]]%32,Tn=tt[Ur+1+tt[Pr+1+tt[Dr+1+tt[jr+1]]]]%32;let xn=.6-kt*kt-Gt*Gt-Dt*Dt-It*It;xn<0?lt=0:(xn*=xn,lt=xn*xn*this.dot4(v[en],kt,Gt,Dt,It));let fn=.6-fr*fr-kr*kr-gr*gr-tr*tr;fn<0?ut=0:(fn*=fn,ut=fn*fn*this.dot4(v[rn],fr,kr,gr,tr));let En=.6-dr*dr-Ir*Ir-Xr*Xr-Jr*Jr;En<0?ht=0:(En*=En,ht=En*En*this.dot4(v[mn],dr,Ir,Xr,Jr));let tn=.6-on*on-Pn*Pn-vn*vn-Gn*Gn;tn<0?_t=0:(tn*=tn,_t=tn*tn*this.dot4(v[bn],on,Pn,vn,Gn));let wn=.6-ms*ms-ar*ar-vr*vr-Cr*Cr;return wn<0?ft=0:(wn*=wn,ft=wn*wn*this.dot4(v[Tn],ms,ar,vr,Cr)),27*(lt+ut+ht+_t+ft)}}var WaveGroundPlugin_decorate=function(h,o,c,d){var _,v=arguments.length,b=v<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(h,o,c,d);else for(var tt=h.length-1;tt>=0;tt--)(_=h[tt])&&(b=(v<3?_(b):v>3?_(o,c,b):_(o,c))||b);return v>3&&b&&Object.defineProperty(o,c,b),b},WaveGroundPlugin_1;let WaveGroundPlugin=WaveGroundPlugin_1=class extends AViewerPlugin{constructor(){super(),this.enabled=!1,this.noiseScale=1.8,this.amplitude=.5,this.paused=!1,this._preFrame=()=>{var d;this._viewer&&this.enabled&&(this.paused||(this._makeRoughGround(this._planeMesh.geometry,this.noiseScale,this.amplitude),(d=this._viewer)===null||d===void 0||d.setDirty()))},this._noise=new SimplexNoise;const h=new three_module.bdM(1,1,100,100),o=new MeshStandardMaterial2({color:16777215,side:three_module.$EB}),c=new three_module.eaF(h,o);c.receiveShadow=!0,c.rotation.x=-.5*Math.PI,c.position.x=0,c.position.y=-1,c.position.z=0,c.scale.setScalar(10),this._planeMesh=c,this.planeMesh=c}async onAdded(h){await super.onAdded(h),h.addEventListener("preFrame",this._preFrame),this.enabled&&await this.onEnable()}async onEnable(){var h,o;const c=this._viewer;if(!c)return;const d=c.getPluginByType("Ground"),_=c.getPlugin(FrameFadePlugin);if(!this.enabled)return this._planeMesh.visible=!1,_&&_.enable(WaveGroundPlugin_1.PluginType),(h=this._viewer)===null||h===void 0||h.setDirty(),void(d&&d.mesh&&d.setGeometry(void 0));if(_&&_.disable(WaveGroundPlugin_1.PluginType),d&&d.mesh)d.setGeometry(this._planeMesh.geometry),d.material&&(d.material.side=three_module.$EB,d.material.fog=!0),this.planeMesh=d.mesh.modelObject;else{const v=(o=c.scene.getObjectByName("WaveGroundPlugin_root"))!==null&&o!==void 0?o:(await c.createObject3D(void 0,!0)).modelObject;v.name="WaveGroundPlugin_root",v.clear(),this.planeMesh=this._planeMesh,v.add(this.planeMesh)}this.planeMesh.visible=!0}async onRemove(h){return h.removeEventListener("preFrame",this._preFrame),this.planeMesh=this._planeMesh,this._planeMesh.geometry.dispose(),this._planeMesh.removeFromParent(),super.onRemove(h)}_makeRoughGround(h,o=1,c=1){const d=Date.now(),_=30*o,v=.01*c,b=h.attributes.position,tt=b.count;for(let it=0;it<tt;it++){const nt=b.getX(it),lt=b.getY(it),ut=b.getZ(it),ht=5*this._noise.noise3d(nt*_*.1+3e-4*d,lt*_*.1+3e-4*d,ut*_*.1+3e-4*d)*v+4*this._noise.noise3d(nt*_*.2+12e-5*d,lt*_*.2+15e-5*d,ut*_*.2+15e-5*d)*v+4*this._noise.noise3d(nt*_*.09+15e-5*d,lt*_*.12+9e-5*d,ut*_*.15+15e-5*d)*v;b.setZ(it,ht/3)}b.needsUpdate=!0,h.computeVertexNormals()}};WaveGroundPlugin.PluginType="WaveGroundPlugin",WaveGroundPlugin_decorate([uiToggle(),serialize(),x$1(WaveGroundPlugin.prototype.onEnable)],WaveGroundPlugin.prototype,"enabled",void 0),WaveGroundPlugin_decorate([uiSlider("Noise scale",[0,2]),serialize()],WaveGroundPlugin.prototype,"noiseScale",void 0),WaveGroundPlugin_decorate([uiSlider("Amplitude",[0,2]),serialize()],WaveGroundPlugin.prototype,"amplitude",void 0),WaveGroundPlugin_decorate([uiToggle("Paused"),serialize()],WaveGroundPlugin.prototype,"paused",void 0),WaveGroundPlugin=WaveGroundPlugin_1=WaveGroundPlugin_decorate([uiFolder("Wave Ground")],WaveGroundPlugin);const Visible=0,Deleted=1,ConvexHull_v1=new three_module.Pq0,_line3=new three_module.cZY,ConvexHull_plane=new three_module.Zcv,ConvexHull_closestPoint=new three_module.Pq0,_triangle=new three_module.lMl;class ConvexHull_ConvexHull{constructor(){this.tolerance=-1,this.faces=[],this.newFaces=[],this.assigned=new VertexList,this.unassigned=new VertexList,this.vertices=[]}setFromPoints(o){if(o.length>=4){this.makeEmpty();for(let c=0,d=o.length;c<d;c++)this.vertices.push(new VertexNode(o[c]));this.compute()}return this}setFromObject(o){const c=[];return o.updateMatrixWorld(!0),o.traverse(function(d){const _=d.geometry;if(_!==void 0){const v=_.attributes.position;if(v!==void 0)for(let b=0,tt=v.count;b<tt;b++){const it=new three_module.Pq0;it.fromBufferAttribute(v,b).applyMatrix4(d.matrixWorld),c.push(it)}}}),this.setFromPoints(c)}containsPoint(o){const c=this.faces;for(let d=0,_=c.length;d<_;d++)if(c[d].distanceToPoint(o)>this.tolerance)return!1;return!0}intersectRay(o,c){const d=this.faces;let _=-1/0,v=1/0;for(let b=0,tt=d.length;b<tt;b++){const it=d[b],nt=it.distanceToPoint(o.origin),lt=it.normal.dot(o.direction);if(nt>0&&lt>=0)return null;const ut=lt!==0?-nt/lt:0;if(!(ut<=0)&&(lt>0?v=Math.min(ut,v):_=Math.max(ut,_),_>v))return null}return _!==-1/0?o.at(_,c):o.at(v,c),c}intersectsRay(o){return this.intersectRay(o,ConvexHull_v1)!==null}makeEmpty(){return this.faces=[],this.vertices=[],this}addVertexToFace(o,c){return o.face=c,c.outside===null?this.assigned.append(o):this.assigned.insertBefore(c.outside,o),c.outside=o,this}removeVertexFromFace(o,c){return o===c.outside&&(o.next!==null&&o.next.face===c?c.outside=o.next:c.outside=null),this.assigned.remove(o),this}removeAllVerticesFromFace(o){if(o.outside!==null){const c=o.outside;let d=o.outside;for(;d.next!==null&&d.next.face===o;)d=d.next;return this.assigned.removeSubList(c,d),c.prev=d.next=null,o.outside=null,c}}deleteFaceVertices(o,c){const d=this.removeAllVerticesFromFace(o);if(d!==void 0)if(c===void 0)this.unassigned.appendChain(d);else{let _=d;do{const v=_.next;c.distanceToPoint(_.point)>this.tolerance?this.addVertexToFace(_,c):this.unassigned.append(_),_=v}while(_!==null)}return this}resolveUnassignedPoints(o){if(this.unassigned.isEmpty()===!1){let c=this.unassigned.first();do{const d=c.next;let _=this.tolerance,v=null;for(let b=0;b<o.length;b++){const tt=o[b];if(tt.mark===Visible){const it=tt.distanceToPoint(c.point);if(it>_&&(_=it,v=tt),_>1e3*this.tolerance)break}}v!==null&&this.addVertexToFace(c,v),c=d}while(c!==null)}return this}computeExtremes(){const o=new three_module.Pq0,c=new three_module.Pq0,d=[],_=[];for(let v=0;v<3;v++)d[v]=_[v]=this.vertices[0];o.copy(this.vertices[0].point),c.copy(this.vertices[0].point);for(let v=0,b=this.vertices.length;v<b;v++){const tt=this.vertices[v],it=tt.point;for(let nt=0;nt<3;nt++)it.getComponent(nt)<o.getComponent(nt)&&(o.setComponent(nt,it.getComponent(nt)),d[nt]=tt);for(let nt=0;nt<3;nt++)it.getComponent(nt)>c.getComponent(nt)&&(c.setComponent(nt,it.getComponent(nt)),_[nt]=tt)}return this.tolerance=3*Number.EPSILON*(Math.max(Math.abs(o.x),Math.abs(c.x))+Math.max(Math.abs(o.y),Math.abs(c.y))+Math.max(Math.abs(o.z),Math.abs(c.z))),{min:d,max:_}}computeInitialHull(){const o=this.vertices,c=this.computeExtremes(),d=c.min,_=c.max;let v=0,b=0;for(let ht=0;ht<3;ht++){const _t=_[ht].point.getComponent(ht)-d[ht].point.getComponent(ht);_t>v&&(v=_t,b=ht)}const tt=d[b],it=_[b];let nt,lt;v=0,_line3.set(tt.point,it.point);for(let ht=0,_t=this.vertices.length;ht<_t;ht++){const ft=o[ht];if(ft!==tt&&ft!==it){_line3.closestPointToPoint(ft.point,!0,ConvexHull_closestPoint);const bt=ConvexHull_closestPoint.distanceToSquared(ft.point);bt>v&&(v=bt,nt=ft)}}v=-1,ConvexHull_plane.setFromCoplanarPoints(tt.point,it.point,nt.point);for(let ht=0,_t=this.vertices.length;ht<_t;ht++){const ft=o[ht];if(ft!==tt&&ft!==it&&ft!==nt){const bt=Math.abs(ConvexHull_plane.distanceToPoint(ft.point));bt>v&&(v=bt,lt=ft)}}const ut=[];if(ConvexHull_plane.distanceToPoint(lt.point)<0){ut.push(Face.create(tt,it,nt),Face.create(lt,it,tt),Face.create(lt,nt,it),Face.create(lt,tt,nt));for(let ht=0;ht<3;ht++){const _t=(ht+1)%3;ut[ht+1].getEdge(2).setTwin(ut[0].getEdge(_t)),ut[ht+1].getEdge(1).setTwin(ut[_t+1].getEdge(0))}}else{ut.push(Face.create(tt,nt,it),Face.create(lt,tt,it),Face.create(lt,it,nt),Face.create(lt,nt,tt));for(let ht=0;ht<3;ht++){const _t=(ht+1)%3;ut[ht+1].getEdge(2).setTwin(ut[0].getEdge((3-ht)%3)),ut[ht+1].getEdge(0).setTwin(ut[_t+1].getEdge(1))}}for(let ht=0;ht<4;ht++)this.faces.push(ut[ht]);for(let ht=0,_t=o.length;ht<_t;ht++){const ft=o[ht];if(ft!==tt&&ft!==it&&ft!==nt&&ft!==lt){v=this.tolerance;let bt=null;for(let xt=0;xt<4;xt++){const St=this.faces[xt].distanceToPoint(ft.point);St>v&&(v=St,bt=this.faces[xt])}bt!==null&&this.addVertexToFace(ft,bt)}}return this}reindexFaces(){const o=[];for(let c=0;c<this.faces.length;c++){const d=this.faces[c];d.mark===Visible&&o.push(d)}return this.faces=o,this}nextVertexToAdd(){if(this.assigned.isEmpty()===!1){let o,c=0;const d=this.assigned.first().face;let _=d.outside;do{const v=d.distanceToPoint(_.point);v>c&&(c=v,o=_),_=_.next}while(_!==null&&_.face===d);return o}}computeHorizon(o,c,d,_){let v;this.deleteFaceVertices(d),d.mark=Deleted,v=c===null?c=d.getEdge(0):c.next;do{const b=v.twin,tt=b.face;tt.mark===Visible&&(tt.distanceToPoint(o)>this.tolerance?this.computeHorizon(o,b,tt,_):_.push(v)),v=v.next}while(v!==c);return this}addAdjoiningFace(o,c){const d=Face.create(o,c.tail(),c.head());return this.faces.push(d),d.getEdge(-1).setTwin(c.twin),d.getEdge(0)}addNewFaces(o,c){this.newFaces=[];let d=null,_=null;for(let v=0;v<c.length;v++){const b=c[v],tt=this.addAdjoiningFace(o,b);d===null?d=tt:tt.next.setTwin(_),this.newFaces.push(tt.face),_=tt}return d.next.setTwin(_),this}addVertexToHull(o){const c=[];return this.unassigned.clear(),this.removeVertexFromFace(o,o.face),this.computeHorizon(o.point,null,o.face,c),this.addNewFaces(o,c),this.resolveUnassignedPoints(this.newFaces),this}cleanup(){return this.assigned.clear(),this.unassigned.clear(),this.newFaces=[],this}compute(){let o;for(this.computeInitialHull();(o=this.nextVertexToAdd())!==void 0;)this.addVertexToHull(o);return this.reindexFaces(),this.cleanup(),this}}class Face{constructor(){this.normal=new three_module.Pq0,this.midpoint=new three_module.Pq0,this.area=0,this.constant=0,this.outside=null,this.mark=Visible,this.edge=null}static create(o,c,d){const _=new Face,v=new HalfEdge(o,_),b=new HalfEdge(c,_),tt=new HalfEdge(d,_);return v.next=tt.prev=b,b.next=v.prev=tt,tt.next=b.prev=v,_.edge=v,_.compute()}getEdge(o){let c=this.edge;for(;o>0;)c=c.next,o--;for(;o<0;)c=c.prev,o++;return c}compute(){const o=this.edge.tail(),c=this.edge.head(),d=this.edge.next.head();return _triangle.set(o.point,c.point,d.point),_triangle.getNormal(this.normal),_triangle.getMidpoint(this.midpoint),this.area=_triangle.getArea(),this.constant=this.normal.dot(this.midpoint),this}distanceToPoint(o){return this.normal.dot(o)-this.constant}}class HalfEdge{constructor(o,c){this.vertex=o,this.prev=null,this.next=null,this.twin=null,this.face=c}head(){return this.vertex}tail(){return this.prev?this.prev.vertex:null}length(){const o=this.head(),c=this.tail();return c!==null?c.point.distanceTo(o.point):-1}lengthSquared(){const o=this.head(),c=this.tail();return c!==null?c.point.distanceToSquared(o.point):-1}setTwin(o){return this.twin=o,o.twin=this,this}}class VertexNode{constructor(o){this.point=o,this.prev=null,this.next=null,this.face=null}}class VertexList{constructor(){this.head=null,this.tail=null}first(){return this.head}last(){return this.tail}clear(){return this.head=this.tail=null,this}insertBefore(o,c){return c.prev=o.prev,c.next=o,c.prev===null?this.head=c:c.prev.next=c,o.prev=c,this}insertAfter(o,c){return c.prev=o,c.next=o.next,c.next===null?this.tail=c:c.next.prev=c,o.next=c,this}append(o){return this.head===null?this.head=o:this.tail.next=o,o.prev=this.tail,o.next=null,this.tail=o,this}appendChain(o){for(this.head===null?this.head=o:this.tail.next=o,o.prev=this.tail;o.next!==null;)o=o.next;return this.tail=o,this}remove(o){return o.prev===null?this.head=o.next:o.prev.next=o.next,o.next===null?this.tail=o.prev:o.next.prev=o.prev,this}removeSubList(o,c){return o.prev===null?this.head=c.next:o.prev.next=c.next,c.next===null?this.tail=o.prev:c.next.prev=o.prev,this}isEmpty(){return this.head===null}}class ConvexGeometry extends three_module.LoY{constructor(o=[]){super();const c=[],d=[],_=new ConvexHull_ConvexHull().setFromPoints(o).faces;for(let v=0;v<_.length;v++){const b=_[v];let tt=b.edge;do{const it=tt.head().point;c.push(it.x,it.y,it.z),d.push(b.normal.x,b.normal.y,b.normal.z),tt=tt.next}while(tt!==b.edge)}this.setAttribute("position",new three_module.qtW(c,3)),this.setAttribute("normal",new three_module.qtW(d,3))}}var PosePlugin_decorate=function(h,o,c,d){var _,v=arguments.length,b=v<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(h,o,c,d);else for(var tt=h.length-1;tt>=0;tt--)(_=h[tt])&&(b=(v<3?_(b):v>3?_(o,c,b):_(o,c))||b);return v>3&&b&&Object.defineProperty(o,c,b),b};let PosePlugin=class extends AViewerPlugin{constructor(){super(),this._debug=!1,this.enabled=!0,this.toJSON=void 0,this.autoUpdateGround=!0}computeStablePoses(h){var o,c;const d=new ConvexHull_ConvexHull().setFromObject(h),_=this._computeCOM(d),v=new three_module.Pq0,b=new three_module.Pq0,tt=new three_module.Pq0,it=new three_module.Pq0,nt=[];for(const lt of d.faces){this._getFaceData(lt,v,b,tt,it);const ut=new three_module.Pq0().copy(v),ht=this._project(_,v,b,tt,it),_t=this._constructRotationTransform(_,ht,it),ft=new three_module.kn4().copy(_t).invert(),bt=new three_module.Pq0().copy(_);bt.applyMatrix4(ft),v.applyMatrix4(ft),b.applyMatrix4(ft),tt.applyMatrix4(ft);const xt=new three_module.I9Y(bt.x,bt.y),St=new three_module.I9Y(v.x,v.y),wt=new three_module.I9Y(b.x,b.y),Pt=new three_module.I9Y(tt.x,tt.y),Rt=this._pointInTriangle(xt,St,wt,Pt);if(Rt>0){const kt=this._triArea(v,b,tt),Gt=this._getMaxEdgeData(v,b,tt),Dt=this._constructRotationTransform(_,ht,it,Gt.edgeVector);nt.push({distance:Rt,faceNormal:it,area:kt,face:lt,maxEdgeLength:Gt.maxEdgeLength,xform:Dt,edgePoint:ut})}}return nt.sort((lt,ut)=>ut.maxEdgeLength-lt.maxEdgeLength),this._debug&&this._createDebugMeshes(_,d),h._stablePoses=nt,h._poseIndex=-1,(c=(o=h.uiConfig)===null||o===void 0?void 0:o.uiRefresh)===null||c===void 0||c.call(o,"postFrame",!0),nt}setMostStablePose(h){return this.setPose(h,0)}setVerticalPose(h){if(h._stablePoses||this.computeStablePoses(h),h._stablePoses)return this.setPose(h,h._stablePoses.length-1)}setNextPose(h){var o;return this.setPose(h,((o=h._poseIndex)!==null&&o!==void 0?o:-1)+1)}setPreviousPose(h){return this.setPose(h,(h._poseIndex||0)-1)}setOriginalPose(h){delete h._poseIndex,h._stablePoses||this.computeStablePoses(h),h._stablePoses&&this._syncPose(h,!0)}clearPoses(h){var o,c,d,_,v;delete h._stablePoses,delete h._poseIndex,delete h._originalXform,(_=(d=(c=(o=this._viewer)===null||o===void 0?void 0:o.getPlugin(PickingPlugin))===null||c===void 0?void 0:c.uiConfig)===null||d===void 0?void 0:d.uiRefresh)===null||_===void 0||_.call(d,"postFrame",!0),(v=this._viewer)===null||v===void 0||v.setDirty()}setPose(h,o){var c;if(h._stablePoses||this.computeStablePoses(h),!h._stablePoses)return;const d=(c=h._poseIndex)!==null&&c!==void 0?c:-1;return o<0&&(o=h._stablePoses.length-1),o>h._stablePoses.length-1&&(o=0),o!==d?(h._poseIndex=o,this._syncPose(h),()=>d<0?this.setOriginalPose(h):this.setPose(h,d)):void 0}async onAdded(h){await super.onAdded(h),h.scene.addEventListener("addSceneObject",o=>{var c;const d=(c=o.object)===null||c===void 0?void 0:c.modelObject;if(!d)return;const _=d.uiConfig;_&&Array.isArray(_.children)&&_.children.push({type:"folder",label:"Poses",children:[{type:"button",label:"Compute Poses",hidden:()=>!!d._stablePoses,value:()=>this.computeStablePoses(d)},{type:"button",label:"Original Pose",hidden:()=>!d._stablePoses,value:()=>this.setOriginalPose(d)},{type:"button",label:"Stable Pose",hidden:()=>!d._stablePoses,value:()=>this.setMostStablePose(d)},{type:"button",label:"Vertical Pose",hidden:()=>!d._stablePoses,value:()=>this.setVerticalPose(d)},{type:"button",label:"Next Pose",hidden:()=>!d._stablePoses,value:()=>this.setNextPose(d)},{type:"button",label:"Previous Pose",hidden:()=>!d._stablePoses,value:()=>this.setPreviousPose(d)},{type:"button",label:"Clear Poses",hidden:()=>!d._stablePoses,value:()=>this.clearPoses(d)}]})})}_getMaxEdgeData(h,o,c){const d=h.distanceTo(o),_=o.distanceTo(c),v=c.distanceTo(h);let b=d;const tt=new three_module.Pq0;return d>_?d>v?(b=d,tt.copy(o).sub(h).normalize()):(b=v,tt.copy(h).sub(c).normalize()):_>v?(b=_,tt.copy(c).sub(o).normalize()):(b=v,tt.copy(h).sub(c).normalize()),{maxEdgeLength:b,edgeVector:tt,edgePoint:new three_module.Pq0().copy(h)}}_getFaceData(h,o,c,d,_){let v=h.edge,b=v.head().point;o.set(b.x,b.y,b.z),v=v.next,b=v.head().point,c.set(b.x,b.y,b.z),v=v.next,b=v.head().point,d.set(b.x,b.y,b.z),_==null||_.copy(h.normal)}_computeCOM(h){const o=new three_module.Pq0,c=new three_module.Pq0,d=new three_module.Pq0,_=new three_module.Pq0,v=new three_module.Pq0;let b=0;for(const tt of h.faces){this._getFaceData(tt,c,d,_),v.set(0,0,0),v.add(c).add(d).add(_).multiplyScalar(1/3),d.sub(c),_.sub(c);const it=.5*d.cross(_).length();b+=it,v.multiplyScalar(it),o.add(v)}return o.multiplyScalar(1/b),o}_sign(h,o,c){return(h.x-c.x)*(o.y-c.y)-(o.x-c.x)*(h.y-c.y)}_shortestDistance(h,o,c){const d=new three_module.I9Y(o.y-c.y,c.x-o.x).normalize(),_=new three_module.I9Y().copy(o).sub(h);return Math.abs(_.dot(d))}_pointInTriangle(h,o,c,d){const _=this._sign(h,o,c),v=this._sign(h,c,d),b=this._sign(h,d,o);if(!(_<0||v<0||b<0)||!(_>0||v>0||b>0)){const tt=this._shortestDistance(h,o,c),it=this._shortestDistance(h,c,d),nt=this._shortestDistance(h,d,o);return Math.min(Math.min(tt,it),nt)}return-1}_project(h,o,c,d,_){const v=new three_module.Pq0().copy(_),b=new three_module.Pq0().copy(o).sub(h).dot(v);b<0&&v.negate();const tt=Math.abs(b);return new three_module.Pq0().copy(h).addScaledVector(v,tt)}_constructRotationTransform(h,o,c,d){const _=new three_module.Pq0().copy(c),v=new three_module.Pq0().copy(o).sub(h).dot(_);v>0&&_.negate();const b=new three_module.Pq0().copy(o).addScaledVector(_,Math.abs(v)),tt=d===void 0?new three_module.Pq0(1,1,0):d;return new three_module.kn4().lookAt(o,b,tt)}_triArea(h,o,c){const d=new three_module.Pq0().copy(o).sub(h),_=new three_module.Pq0().copy(c).sub(h);return .5*d.cross(_).length()}_createTriangleMesh(){const h=new three_module.LoY,o=new three_module.V9B({color:16711680,side:three_module.$EB});return new three_module.eaF(h,o)}_updateTriangleMesh(h){var o;this._triMesh.geometry.setAttribute("position",new three_module.THS(h,3)),(o=this._viewer)===null||o===void 0||o.setDirty()}_syncPose(h,o=!1){var c,d,_,v,b,tt,it,nt;if(h._stablePoses===void 0||h._stablePoses.length==0)return;const lt=new three_module.kn4;if(!o){lt.lookAt(new three_module.Pq0,new three_module.Pq0(0,1,0),new three_module.Pq0(0,0,1));const ht=h._stablePoses[h._poseIndex||0].xform,_t=new three_module.kn4().copy(ht).invert();lt.multiply(_t)}if(h._originalXform){const ht=new three_module.Pq0,_t=new three_module.PTz,ft=new three_module.Pq0;h._originalXform.decompose(ht,_t,ft),h.position.copy(ht),h.quaternion.copy(_t),h.scale.copy(ft)}else h._originalXform=new three_module.kn4().copy(h.matrix);h.applyMatrix4(lt);const ut=(c=this._viewer)===null||c===void 0?void 0:c.getPlugin(GroundPlugin);if(this.autoUpdateGround)(d=this._viewer)===null||d===void 0||d.scene.setDirty({sceneUpdate:!0}),ut.enableRefreshTransform=!0;else if(!o){const ht=h._stablePoses[h._poseIndex||0].edgePoint,_t=new three_module.Pq0().copy(ht);_t.applyMatrix4(lt);const ft=_t.y-ut.shadowBaker.attachedMesh.position.y;h.position.y-=ft}(_=this._viewer)===null||_===void 0||_.setDirty(),(v=this._viewer)===null||v===void 0||v.renderer.resetShadows(),ut==null||ut.bakeShadows(),(nt=(tt=(b=this._viewer)===null||b===void 0?void 0:b.getPlugin(PickingPlugin))===null||tt===void 0?void 0:(it=tt.uiConfig).uiRefresh)===null||nt===void 0||nt.call(it,"postFrame",!0)}async _createDebugMeshes(h,o){var c;const d=[];for(const lt of o.vertices)d.push(new three_module.Pq0(lt.point.x,lt.point.y,lt.point.z));const _=new ConvexGeometry(d),v=new three_module.XJ7(_),b=new three_module.DXC(v);b.material.opacity=.25,b.material.transparent=!0,this._triMesh=this._createTriangleMesh();const tt=new three_module.Gu$(.025),it=new three_module.eaF(tt,new three_module.uSd({color:16776960}));it.position.copy(h);const nt=(await((c=this._viewer)===null||c===void 0?void 0:c.createObject3D(void 0,!0))).modelObject;return nt.add(this._triMesh),nt.add(b),nt.add(it),nt}};PosePlugin.PluginType="PosePlugin",PosePlugin_decorate([uiToggle()],PosePlugin.prototype,"autoUpdateGround",void 0),PosePlugin=PosePlugin_decorate([uiFolder("Pose Plugin")],PosePlugin);var tweakpane_image_plugin=__webpackgi_require__(282),tweakpane=__webpackgi_require__(578);const tweakpaneCheckParent=(h,o)=>o.controller_.rackController.rack===h.controller_.parent,tweakPaneMoveToParentIndex=(h,o,c)=>{var d,_;const v=h.controller_,b=(_=(d=v.parent)===null||d===void 0?void 0:d.children)===null||_===void 0?void 0:_.indexOf(v);return!(tweakpaneCheckParent(h,o)&&b===c||(o.add(h,c),0))},tpFolderGenerator=(h,o,c,d)=>{var _,v,b,tt,it;let nt=o.uiRef;nt!=null&&nt.controller_.viewProps.get("disposed")&&(nt=void 0);const lt=nt==null?void 0:nt.expanded;if(!nt){const xt=h.addFolder({title:""});nt=xt,nt.on("fold",St=>{var wt,Pt,Rt,kt;let Gt=xt.expanded;S$2(o,"expanded",Gt,!0),Gt=(wt=Ee$1(o.expanded))!==null&&wt!==void 0?wt:Gt,Gt!==xt.expanded&&(xt.expanded=Gt),(Pt=o.uiRefresh)===null||Pt===void 0||Pt.call(o,"postFrame",!0,10),Gt?(Rt=o.onExpand)===null||Rt===void 0||Rt.call(o,o):(kt=o.onCollapse)===null||kt===void 0||kt.call(o,o)})}if(!nt)return nt;nt.expanded=(v=(_=Ee$1(o.expanded))!==null&&_!==void 0?_:lt)!==null&&v!==void 0&&v;const ut=((b=o.children)!==null&&b!==void 0?b:[]).map(xt=>xt&&Ee$1(xt)).flat(2).filter(xt=>xt);let ht=0;for(const xt of ut){if(Array.isArray(xt)||typeof xt!="object"){console.error("child is not an object",xt);continue}let St=xt.uiRef;St&&St.controller_.viewProps.get("disposed")&&(xt.uiRef=void 0,xt.uiRefresh=void 0),St=xt.uiRef,St||(c.appendUiObject({uiConfig:xt},nt),St=xt.uiRef),St&&tweakPaneMoveToParentIndex(St,nt,ht++)&&c.appendUiObject({uiConfig:xt},nt)}let _t=nt.children;for(;_t.length>ht;){const xt=_t[_t.length-1];nt.remove(xt),xt.dispose(),_t=nt.children}nt.controller_.props.set("title",(tt=Ee$1(o.label))!==null&&tt!==void 0?tt:"");const ft=nt.controller_.view.containerElement,bt=Ee$1(o.domChildren,[]);if((bt==null?void 0:bt.length)!==void 0){const xt=[];for(let St=0;St<ft.children.length;St++){const wt=ft.children[St];!((it=wt.dataset)===null||it===void 0)&&it.tpCustomDOM&&xt.push(wt)}for(const St of xt)ft.removeChild(St);for(const St of bt)St.parentElement!==ft&&(ft.appendChild(St),St.dataset.tpCustomDOM="true");nt.controller_.foldable.cleanUpTransition()}return nt},tpButtonInputGenerator=(h,o,c,d)=>{var _,v;const[b,tt]=(_=o.property)!==null&&_!==void 0?_:[void 0,void 0],it=(v=Ee$1(o.label))!==null&&v!==void 0?v:tt;let nt=o.uiRef;return nt!=null&&nt.controller_.viewProps.get("disposed")&&(nt=void 0),nt||(nt=h.addButton({title:""}),nt.on("click",async()=>{const lt=[];o.prompt&&lt.push(await c.prompt(...o.prompt));let ut=b&&tt?b[tt]:void 0,ht=b;if(ut||(ut=o.value,ht=o),typeof ut=="function"){const _t=()=>{var ft;c.removeEventListener("postFrame",_t);const bt=ut.call(ht??o,...lt);typeof bt=="function"&&((ft=c.undoManager)===null||ft===void 0||ft.record({undo:()=>{var xt;bt.call(ht??o,...lt),(xt=o.uiRefresh)===null||xt===void 0||xt.call(o,void 0,!1)},redo:()=>{var xt;ut.call(ht??o,...lt),(xt=o.uiRefresh)===null||xt===void 0||xt.call(o,void 0,!1)}}))};c.addEventListener("postFrame",_t)}else console.warn("uiconfig.js: Invalid action type for button")})),nt&&(nt.title=(it??"click me")+""),nt},tpDropdownInputGenerator=(h,o,c,d)=>{var _;const v=Object.fromEntries(((_=Ee$1(o.children))!==null&&_!==void 0?_:[]).map(b=>Ee$1(b)).flat(2).filter(b=>b).map(b=>{var tt;const it=Ee$1(b.label);return[it,(tt=b.value)!==null&&tt!==void 0?tt:it]}));return tpInputGenerator(h,o,c,{options:v,...d??{}})},tpSliderInputGenerator=(h,o,c,d)=>{var _,v;const b=Ee$1(o.bounds),tt=((_=b==null?void 0:b.length)!==null&&_!==void 0?_:0)>=2?b[1]:1,it=((v=b==null?void 0:b.length)!==null&&v!==void 0?v:0)>=1?b[0]:0,nt=o.stepSize||void 0;return tpInputGenerator(h,o,c,{min:it,max:tt,step:nt,...d??{}})},tpVecInputGenerator=(h,o,c,d)=>{var _,v,b;const tt=Ee$1(o.bounds);if(!tt||tt.length<1)return tpInputGenerator(h,o,c,{...d??{}});const it=((_=tt.length)!==null&&_!==void 0?_:0)>=2?tt[1]:1,nt=((v=tt.length)!==null&&v!==void 0?v:0)>=1?tt[0]:0,lt={min:nt,max:it,step:(b=o.stepSize)!==null&&b!==void 0?b:(it-nt)/100},ut={x:lt,y:lt};o.type!=="vec3"&&o.type!=="vec4"||(ut.z=lt),o.type==="vec4"&&(ut.w=lt);const ht=o.property;if(o.value===void 0&&ht&&ht[0]&&typeof ht[0]=="object"&&ht[0][ht[1]]&&Array.isArray(ht[0][ht[1]])){const[_t,ft]=ht,bt=_t[ft],xt=bt.length,St=new(xt===2?three_module.I9Y:xt===3?three_module.Pq0:three_module.IUQ)().fromArray(bt);o.value=St,o.property=void 0,o.onChange=[()=>{_t[ft]=St.toArray()},...Array.isArray(o.onChange)?o.onChange:[o.onChange]].filter(wt=>wt),o.label===void 0&&(o.label=ft)}return tpInputGenerator(h,o,c,{...ut,...d??{}})},tpColorInputGenerator=(h,o,c,d)=>{var _;const v=o.property;if(o.value===void 0&&v&&typeof v[0]=="object"&&!((_=v[0][v[1]])===null||_===void 0)&&_.isColor){const[b,tt]=v,it=three_module.er$;Object.defineProperty(o,"value",{get:()=>{const nt=b[tt];return nt?new three_module.Q1f(nt).getHex(it):0},set:nt=>{const lt=b[tt],ut=new three_module.Q1f().setHex(nt,it);lt.isColor?lt.copy(ut):typeof lt=="number"?b[tt]=ut.getHex():typeof lt=="string"&&(b[tt]="#"+ut.getHexString()),typeof(b==null?void 0:b.setDirty)=="function"&&b.setDirty()}}),o.property=void 0,o.onChange=[...Array.isArray(o.onChange)?o.onChange:[o.onChange]].filter(nt=>nt),o.label===void 0&&(o.label=tt+"")}return(d=d??{}).view="color",Ee$1(o.inlinePicker)&&(d.picker="inline"),tpInputGenerator(h,o,c,d)},tpInputGenerator=(h,o,c,d)=>{var _,v,b,tt,it,nt,lt;let ut=Ee$1(o.property);if((o.getValue||o.setValue)&&ut&&console.error("specify either property or value, or getValue and setValue",o),ut)o.value&&console.warn("uiconfig.js: Both property and value are defined, value will be ignored",o);else if((Object.hasOwn?Object.hasOwn(o,"value"):o.hasOwnProperty("value"))||o.value!==void 0||!o.getValue&&!o.setValue||(Object.defineProperty(o,"value",{get:()=>{var bt;return(bt=o.getValue)===null||bt===void 0?void 0:bt.call(o)},set:bt=>{var xt;return(xt=o.setValue)===null||xt===void 0?void 0:xt.call(o,bt)}}),ut=[o,"value"]),ut||o.value===void 0||(ut=[o,"value"]),!ut)return void console.error("cannot determine property",o);d=d??{};const ht={label:(_=Ee$1(o.label))!==null&&_!==void 0?_:ut[1],...d};let _t=o.uiRef;_t!=null&&_t.controller_.viewProps.get("disposed")&&(_t=void 0);let ft=!1;if(!_t&&typeof ut[0]=="object"&&ut[0]){const[bt,xt]=ut;try{if(o.isMonitor)_t=h.addMonitor(bt,xt,ht);else{const St={tar:bt,key:xt,__v:cloneVar(bt[xt])};St.lastUndoVal=cloneVar(St.__v),Object.defineProperty(St,xt,{get:()=>St.__v,set:Rt=>{St.__v=Rt}});const wt=Rt=>{var kt;[o.onChange].flat().forEach(Gt=>typeof Gt=="function"&&(Gt==null?void 0:Gt(Rt))),typeof((kt=St.tar)===null||kt===void 0?void 0:kt.setDirty)=="function"&&St.tar.setDirty(Rt)},Pt=Rt=>{var kt,Gt;const Dt=St.tar[St.key];let It=St.__v;const Nt=compare(Dt,It);if((!Nt||Rt.last)&&(Nt||(copyVal(St.tar,St.key,It),wt(Rt)),Rt.last)){let Vt=St.lastUndoVal,Kt=!1;if(typeof It=="string"&&It.length>1e5&&(Kt=!0),typeof Vt=="string"&&Vt.length>1e5&&(Kt=!0),!(Kt||It instanceof HTMLImageElement)){const Yt=compare(Vt,It);!((kt=c.undoManager)===null||kt===void 0)&&kt.options.debug&&console.log("onchange",Vt,It,Yt),Yt||(It=cloneVar(It),Vt=cloneVar(Vt),(Gt=c.undoManager)===null||Gt===void 0||Gt.record({undo:()=>{var nr;copyVal(St.tar,St.key,Vt),wt({...Rt,value:Vt}),(nr=o.uiRefresh)===null||nr===void 0||nr.call(o,void 0,!1)},redo:()=>{var nr;copyVal(St.tar,St.key,It),wt(Rt),(nr=o.uiRefresh)===null||nr===void 0||nr.call(o,void 0,!1)}}),copyVal(St,"lastUndoVal",It))}}};_t=h.addInput(St,xt,ht).on("change",Pt),_t.__proxy1=St,ft=!0}}catch(St){if(!St.message.startsWith("No matching controller for"))throw St;_t=void 0}}if(_t){for(const[bt,xt]of Object.entries(ht)){const St=_t.controller_;let wt=St.props.value(bt);if(wt!==void 0)wt.rawValue!==xt&&_t.controller_.props.set(bt,xt);else{const Pt=St.valueController;wt=(b=(v=Pt.props)===null||v===void 0?void 0:v.value)===null||b===void 0?void 0:b.call(v,bt);let Rt=xt;const kt=wt==null?void 0:wt.rawValue;let Gt=!1;bt==="options"&&typeof Rt=="object"&&!Array.isArray(Rt)&&Array.isArray(kt)&&(Rt=Object.entries(Rt).map(([Dt,It])=>({text:Dt,value:It})),Gt=!0),wt===void 0||kt===Rt||Gt&&_t.__lastOptions===xt||(Pt.props.set(bt,Rt),Gt&&((it=(tt=Pt.view)===null||tt===void 0?void 0:tt.update_)===null||it===void 0||it.call(tt),_t.__lastOptions=xt))}}if(o.type==="slider"&&(ht.min!==void 0&&_t.controller_.valueController.sliderController.props.set("minValue",ht.min),ht.max!==void 0&&_t.controller_.valueController.sliderController.props.set("maxValue",ht.max)),(nt=(_t==null?void 0:_t.controller_.valueController.view).inputElement)===null||nt===void 0||nt.setAttribute("placeholder",(lt=Ee$1(o.placeholder))!==null&&lt!==void 0?lt:""),_t.__proxy1&&!ft){const bt=_t.__proxy1,[xt,St]=ut;bt.tar=xt,bt.key=St;const wt=xt[St];copyVal(bt,"__v",wt),copyVal(bt,"lastUndoVal",wt)}_t.refresh()}return _t};function compare(h,o){return typeof h==typeof o&&(typeof h=="object"||Array.isArray(h)?Array.isArray(h)?h.length===o.length&&h.every((c,d)=>compare(c,o[d])):typeof h.equals=="function"?!!h.equals(o):h.toArray&&o.toArray?compare(h.toArray(),o.toArray()):h===o:h===o)}function cloneVar(h){return typeof h=="object"&&h?Array.isArray(h)?[...h]:h.isObject3D||h.isMaterial?h:typeof h.clone=="function"?h.clone():h:h}function copyVal(h,o,c){typeof c.copy=="function"&&h[o]?h[o].copy(c):h[o]=cloneVar(c)}class TweakpaneWrapper extends I$2{constructor(o=!1,c=!1,d=!1,_=!0,v=document.body){super(),this._refreshQueue={preRender:[],postRender:[],preFrame:[],postFrame:[]},this._lastModeTime={preRender:0,postRender:0,preFrame:0,postFrame:0},this._typeGenerators={panel:tpFolderGenerator,folder:tpFolderGenerator,input:tpInputGenerator,number:tpInputGenerator,slider:tpSliderInputGenerator,dropdown:tpDropdownInputGenerator,checkbox:tpInputGenerator,color:tpColorInputGenerator,vec:tpVecInputGenerator,vec2:tpVecInputGenerator,vec3:tpVecInputGenerator,vec4:tpVecInputGenerator,button:tpButtonInputGenerator,monitor:(tt,it,nt,lt)=>(it.isMonitor=!0,tpInputGenerator(tt,it,nt,lt)),dummy:(tt,it,nt,lt)=>tpInputGenerator(tt,it,nt,lt)},this.undoManager=new Q$2({bindHotKeys:!0,limit:100,debug:!1}),this.alert=this.alert.bind(this),this.confirm=this.confirm.bind(this),this.prompt=this.prompt.bind(this),this._expand=o,this._limitedOptions=d;const b=this._createUiContainer();v.appendChild(b),this._container=v,this._pane=new tweakpane.Pane({title:"Configuration",container:b}),this._pane.expanded=this._expand,_&&(this.addEventListener("postFrame",()=>this.refreshQueue("postFrame")),setTimeout(()=>{this.dispatchEvent({type:"postFrame"})},32))}refreshQueue(o){const c=this._refreshQueue[o],d=[],_=g(),v=_-this._lastModeTime[o];c.forEach(b=>{b[2]>.001?(b[2]-=v,d.push(b)):this._refreshUiObject(b[0],b[1],b[2])}),this._refreshQueue[o]=d,this._lastModeTime[o]=_}addToRefreshQueue(o,c){var d;const _=(d=c[0])===null||d===void 0?void 0:d.uiConfig,v=_==null?void 0:_.uuid,b=this._refreshQueue[o],tt=b.find(it=>it[3]===v);tt?tt[2]=Math.max(tt[2],c[2]):b.push([...c,v]),this._refreshQueue[o]=b}dispose(){var o;(o=this._pane)===null||o===void 0||o.dispose(),this._pane=void 0}appendUiObject(o,c){o&&this._appendUiObject(o,c)}appendChild(o){this.appendUiObject({uiConfig:o})}_appendUiObject(o,c){var d,_,v,b;const{uiConfig:tt}=o??{};if(tt&&(!this._limitedOptions||tt.limitedUi)&&(c=c??this._pane,tt.type)){tt.uuid||(tt.uuid=esm_browser_v4()),tt.uiRef&&tt.uiRefType!==tt.type&&this.removeUiConfig(tt);const it=(_=(d=this._typeGenerators)[tt.type])===null||_===void 0?void 0:_.call(d,c,tt,this);it&&(it.hidden=(v=Ee$1(tt.hidden))!==null&&v!==void 0&&v,it.disabled=(b=Ee$1(tt.disabled))!==null&&b!==void 0&&b),tt.uiRef=it,tt.uiRefType=it?tt.type:void 0,tt.uiRefresh=(nt="postFrame",lt=!1,ut=0)=>{var ht;return this._uiObjectRefresh(nt,(ht=o==null?void 0:o.uiConfig)!==null&&ht!==void 0?ht:tt,c,lt,ut)},it==null||it.controller_.viewProps.handleDispose(()=>{tt.uiRef=void 0,tt.uiRefType=void 0,tt.uiRefresh=void 0})}}removeUiObject(o){this.removeUiConfig(o==null?void 0:o.uiConfig)}removeUiConfig(o){var c,d;o&&o.uiRef&&((d=(c=o.uiRef).dispose)===null||d===void 0||d.call(c),o.uiRef=void 0,o.uiRefType=void 0,o.uiRefresh=void 0)}_uiObjectRefresh(o,c,d,_,v){(_?flattenUiConfig(c,d):[{uiConfig:c,parentFolder:d}]).forEach(b=>{const tt=[{uiConfig:b.uiConfig},b.parentFolder,v];o==="immediate"?this._refreshUiObject(...tt):this.addToRefreshQueue(o,tt)})}_refreshUiObject(o,c,d=0){this._appendUiObject(o,c),d>1e-4&&console.error("no support for immediate delay")}_createUiContainer(){const o=ee$1({id:"tweakpaneUiContainer",addToBody:!1});return P$2($`
          :root{
            --tweakpane-ui-container-width: 300px;
          }
          @media only screen and (min-width: 1500px) {
            :root{
              --tweakpane-ui-container-width: 300px;
            }
          }
          @media only screen and (min-width: 2500px) {
            :root{
              --tweakpane-ui-container-width: 500px;
            }
          }
          #tweakpaneUiContainer {
            position: fixed;
            top: 0px;
            padding-right: 4px;
            padding-bottom: 10px;
            right: 10px;
            width: var(--tweakpane-ui-container-width);
            height: auto;
            overflow-y: scroll;
            z-index: 100;
            pointer-events: auto;
            max-height: calc(100% - 6rem);
            border-radius: 0.5rem;
            font-family: Inter, ui-sans-serif, system-ui, -apple-system, "system-ui", "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
          }
        `),o}async alert(o){return alert(o)}async confirm(o){return confirm(o)}async prompt(o,c,d=!0){return prompt(o,c)}}function flattenUiConfig(h,o,c){return c=c??[],h&&h.uiRef&&(c.push({uiConfig:h,parentFolder:o}),typeof h.children=="function"||[...h.children||[]].forEach(d=>{typeof d!="function"&&d&&(Array.isArray(d)?d.forEach(_=>c=flattenUiConfig(_,h.uiRef,c)):c=flattenUiConfig(d,h.uiRef,c))})),c}const tpImageInputGenerator=h=>(o,c,d,_)=>{let v=c.property||c.__property;const b="placeholder";c.value===void 0&&(c.getValue||c.setValue)&&(Object.defineProperty(c,"_value",{get:()=>{var nt;return(nt=c.getValue)===null||nt===void 0?void 0:nt.call(c)},set:nt=>{var lt;return(lt=c.setValue)===null||lt===void 0?void 0:lt.call(c,nt)}}),v=[c,"_value"]);const[tt,it]=v&&typeof v[0]=="object"?v:[c,"value"];if((!(Object.hasOwn?Object.hasOwn(c,"value"):c.hasOwnProperty("value"))||c.value===void 0)&&v&&typeof v[0]=="object"){const nt=Xe$1("Render Target"),lt=Xe$1("Data Texture"),ut=Xe$1("CUBE Texture"),ht=Xe$1("Compressed Texture"),_t={},ft={};Object.defineProperty(c,"value",{get:()=>{var bt;let xt,St=tt[it];if(St!=null&&St.get&&(St=St.get()),!St)return b;if(St.isCompressedTexture&&St.image&&!St.image.tp_src&&(St.image.tp_src=ht),St.isTexture?(St.image&&!St.image.tp_src&&(St.image instanceof ImageBitmap||St.image instanceof HTMLImageElement||St.image instanceof HTMLVideoElement)?St.image.tp_src=Ne$1(St.image,160):St.image&&St.isRenderTargetTexture&&!St.image.tp_src?St.__target&&(St.tp_src=h.renderer.renderTargetToDataUrl(St.__target,void 0,void 0,Array.isArray(St.__target.texture)?St.__target.texture.indexOf(St):void 0)):St.image&&!St.image.tp_src&&(St.image.tp_src=textureToCanvas(St,160,!1).toDataURL("image/png",90)),!St.isRenderTargetTexture||St.image.tp_src||St.tp_src||(St.image.tp_src=nt),St.isDataTexture&&St.image&&!St.image.tp_src&&(St.image.tp_src=lt),St.image&&(xt=St.image.tp_src_uuid,xt=xt?_t[xt]:void 0,xt||(xt=St.image.tp_src||St.image.src)),St.tp_src&&(xt=St.tp_src)):typeof St=="string"?xt=St:St.domainMin?(xt=St.texture,St.texture.image&&!St.texture.image.tp_src&&(St.texture.image.tp_src=ut),St.texture.image&&(xt=St.texture.image.tp_src_uuid,xt=xt?_t[xt]:void 0,xt||(xt=St.texture.image.tp_src||St.texture.image.src))):St&&console.error("unknown value",St),xt||(xt=b),St.image&&!St.image.tp_src_uuid){const wt=esm_browser_v4();St.image.tp_src_uuid=wt,ft[xt]=wt}return typeof xt=="string"&&(xt=(bt=_t[xt])!==null&&bt!==void 0?bt:xt),xt},set:bt=>{var xt,St,wt,Pt,Rt,kt,Gt,Dt,It,Nt,Vt,Kt,Yt;const nr=tt[it],rr=or=>{var pr;tt[it]=or,or!=null&&or.isTexture&&(or.flipY=or.isDataTexture?or.flipY:(pr=nr==null?void 0:nr.flipY)===null||pr===void 0||pr)};if(typeof bt=="string")return void(typeof nr=="string"&&rr(bt));if(!bt)return void(c.value=b);if(bt.isPlaceholder)return void(nr&&(rr(typeof nr=="string"?"":null),typeof(tt==null?void 0:tt.setDirty)=="function"&&tt.setDirty()));let lr=bt.tp_src_uuid;if(lr||(lr=(xt=bt.src)!==null&&xt!==void 0?xt:bt.tp_src,lr=(St=ft[lr])!==null&&St!==void 0?St:lr,delete ft[lr],bt.tp_src_uuid=lr),lr&&(_t[lr]=bt),typeof nr!="string"){if(!((nr==null?void 0:nr.image)===bt||((wt=nr==null?void 0:nr.image)===null||wt===void 0?void 0:wt.src)===bt.src||((Pt=nr==null?void 0:nr.image)===null||Pt===void 0?void 0:Pt.tp_src)===bt.tp_src&&bt.tp_src!=null||((Rt=nr==null?void 0:nr.image)===null||Rt===void 0?void 0:Rt.tp_src)===bt.src&&bt.src!=null||((kt=nr==null?void 0:nr.image)===null||kt===void 0?void 0:kt.src)===bt.tp_src&&bt.tp_src!=null))if(bt instanceof File){const or=h==null?void 0:h.getPlugin(AssetManagerPlugin);if(!or)throw"Viewer or AssetManagerPlugin not found";(Gt=or.importer)===null||Gt===void 0||Gt.importSingle({file:bt,path:bt.src}).then(pr=>{var hr,ur,cr,br;if(pr){pr.isDataTexture&&(pr.needsUpdate=!0);const fr=(cr=(ur=(hr=bt.src)===null||hr===void 0?void 0:hr.split("?"))===null||ur===void 0?void 0:ur[0])===null||cr===void 0?void 0:cr.split(".").pop();pr.userData&&(pr.userData.mimeType||(pr.userData.mimeType="image/"+(["jpg","jpeg"].includes(fr)?"jpeg":"png"))),rr(pr),[c.onChange].flat().forEach(kr=>typeof kr=="function"&&(kr==null?void 0:kr())),typeof(tt==null?void 0:tt.setDirty)=="function"&&tt.setDirty(),(br=c.uiRefresh)===null||br===void 0||br.call(c,"postFrame",!1)}})}else{if(SVGTextureLoader.USE_CANVAS_TEXTURE&&(!((Dt=bt.src)===null||Dt===void 0)&&Dt.endsWith(".svg")||!((It=bt.src)===null||It===void 0)&&It.startsWith("data:image/svg"))){const ur=document.createElement("canvas");SVGTextureLoader.CopyImageToCanvas(ur,bt),bt=ur}const or=new three_module.gPd(bt);or.assetType="texture",or.needsUpdate=!0;const pr=(Kt=(Vt=(Nt=bt.src)===null||Nt===void 0?void 0:Nt.split("?"))===null||Vt===void 0?void 0:Vt[0])===null||Kt===void 0?void 0:Kt.split(".").pop();or.userData.mimeType||(or.userData.mimeType="image/"+(["jpg","jpeg"].includes(pr)?"jpeg":"png"));const hr=["normalMap","aoMap","emissiveMap","roughnessMap","metalnessMap","displacementMap","bumpMap","alphaMap"].includes(it);or.colorSpace=hr?three_module.Zr2:three_module.er$,or.wrapS=three_module.GJx,or.wrapT=three_module.GJx,rr(or),[c.onChange].flat().forEach(ur=>typeof ur=="function"&&(ur==null?void 0:ur())),typeof(tt==null?void 0:tt.setDirty)=="function"&&tt.setDirty(),(Yt=c.uiRefresh)===null||Yt===void 0||Yt.call(c,"postFrame",!1)}}else rr(lr)}}),c.__property=c.property,c.property=void 0,c.label===void 0&&(c.label=it)}return(_=_??{}).extensions=[".jpg",".png",".svg",".hdr",".exr",".jpeg",".bmp",".gif",".webp",".cube","ktx2"],_.imageFit===void 0&&(_.imageFit="contain"),_.clickCallback===void 0&&(_.clickCallback=(nt,lt)=>{var ut;const ht=nt==null?void 0:nt.target,_t=ht==null?void 0:ht.getBoundingClientRect();if(!_t)return void lt.click();const ft=c.uiRef.controller_.valueController.value.rawValue,bt=ft===b||ft!=null&&ft.isPlaceholder?{}:{"remove image":()=>{var St;c.uiRef.controller_.valueController.value.setRawValue("");const wt=typeof tt[it]=="string";tt[it]=wt?"":null,[c.onChange].flat().forEach(Pt=>typeof Pt=="function"&&(Pt==null?void 0:Pt())),typeof(tt==null?void 0:tt.setDirty)=="function"&&tt.setDirty(),(St=c.uiRefresh)===null||St===void 0||St.call(c,"postFrame",!1),CustomContextMenu.Remove()},"download image":async()=>{var St,wt,Pt;CustomContextMenu.Remove();const Rt=tt[it];if(!Rt)return;const kt=(St=Rt==null?void 0:Rt.image)!==null&&St!==void 0?St:c.uiRef.controller_.valueController.value.rawValue;let Gt=Rt.__rootBlob?Rt.__rootBlob.objectUrl||URL.createObjectURL(Rt.__rootBlob):((wt=Rt.userData)===null||wt===void 0?void 0:wt.rootPath)||(kt==null?void 0:kt.src);kt&&(kt instanceof ImageBitmap||kt instanceof HTMLImageElement||kt instanceof HTMLVideoElement)&&!Gt&&(Gt=Ne$1(kt));let Dt=Rt.__rootBlob?Rt.__rootBlob.name||"image."+(Rt.__rootBlob.ext||"png"):null;if(!Gt&&Rt.isRenderTargetTexture){const Nt=Rt.__target;if(Rt.type===three_module.OUM)Gt=h.renderer.renderTargetToDataUrl(Nt,"image/png",90,Array.isArray(Rt.__target.texture)?Rt.__target.texture.indexOf(Rt):void 0),Dt="renderTarget.png";else{const Vt=new EXRExporter2().parse(h.renderer.rendererObject,Nt,{textureIndex:Array.isArray(Rt.__target.texture)?Rt.__target.texture.indexOf(Rt):void 0}),Kt=new Blob([Vt],{type:"image/x-exr"});if(!Kt)return void console.error("cannot export render target",kt,tt[it],tt,it,c);Dt="renderTarget.exr",Gt=URL.createObjectURL(Kt)}}if(!Gt&&Rt.isDataTexture){const Nt=new EXRExporter2().parse(void 0,Rt),Vt=new Blob([Nt],{type:"image/x-exr"});if(!Vt)return void console.error("cannot export data texture",kt,tt[it],tt,it,c);Dt="dataTexture.exr",Gt=URL.createObjectURL(Vt)}if(!Gt)return void console.error("cannot export image",kt,tt[it],tt,it,c);const It=document.createElement("a");document.body.appendChild(It),It.style.display="none",It.href=Gt,It.download=Dt||(Gt.startsWith("data:")?"image.png":(Pt=Gt.split("/").pop())!==null&&Pt!==void 0?Pt:"image.png"),It.target="_blank",It.click(),document.body.removeChild(It)}},xt=CustomContextMenu.Create({...bt,"set/replace image":()=>{lt.click(),CustomContextMenu.Remove()},"from url":async()=>{var St,wt;let Pt="";if(Pt=await d.prompt("Load texture: Enter Image/Texture URL",Pt,!0),!Pt||!Pt.startsWith("http")&&!Pt.startsWith("data:image"))return Pt!==null&&await d.alert("Loading Image: Invalid URL"),void CustomContextMenu.Remove();Pt=Pt.trim();const Rt=tt[it];if(typeof Rt=="string")tt[it]=Pt,[c.onChange].flat().forEach(kt=>typeof kt=="function"&&(kt==null?void 0:kt())),typeof(tt==null?void 0:tt.setDirty)=="function"&&tt.setDirty(),(St=c.uiRefresh)===null||St===void 0||St.call(c,"postFrame",!1);else{const kt=h==null?void 0:h.getPlugin(AssetManagerPlugin);if(!kt)throw"Viewer or AssetManagerPlugin not found";(wt=kt.importer)===null||wt===void 0||wt.importSinglePath(Pt).then(Gt=>{var Dt;if(Gt){Gt.isDataTexture?Gt.needsUpdate=!0:Gt&&(Rt==null?void 0:Rt.flipY)!==void 0&&(Gt.flipY=Rt.flipY);const It=["normalMap","aoMap","emissiveMap","roughnessMap","metalnessMap","displacementMap","bumpMap","alphaMap"].includes(it);Gt.colorSpace=It?three_module.Zr2:three_module.er$,tt[it]=Gt,[c.onChange].flat().forEach(Nt=>typeof Nt=="function"&&(Nt==null?void 0:Nt())),typeof(tt==null?void 0:tt.setDirty)=="function"&&tt.setDirty(),(Dt=c.uiRefresh)===null||Dt===void 0||Dt.call(c,"postFrame",!1)}else console.warn("uiconfig-tweakpane: Failed to load texture",Pt)})}CustomContextMenu.Remove()},cancel:()=>{CustomContextMenu.Remove()}},2,_t.height+8);(ut=ht.parentElement)===null||ut===void 0||ut.appendChild(xt),_t.y>.7*document.body.clientHeight&&(xt.style.top="auto",xt.style.bottom=_t.height+8+"px")}),_.view="input-image",tpInputGenerator(o,c,d,_)};var tpTheme=__webpackgi_require__(367),tpTheme_exported={};tpTheme.A&&tpTheme.A.locals&&(tpTheme_exported.locals=tpTheme.A.locals);var tpTheme_refs=0,tpTheme_update,tpTheme_options={};tpTheme_options.styleTagTransform=styleTagTransform_default(),tpTheme_options.setAttributes=setAttributesWithoutAttributes_default(),tpTheme_options.insert=function(h,o){(o.target||document.head).appendChild(h)},tpTheme_options.domAPI=styleDomAPI_default(),tpTheme_options.insertStyleElement=insertStyleElement_default(),tpTheme_exported.use=function(h){return tpTheme_options.options=h||{},tpTheme_refs++||(tpTheme_update=injectStylesIntoStyleTag_default()(tpTheme.A,tpTheme_options)),tpTheme_exported},tpTheme_exported.unuse=function(){tpTheme_refs>0&&!--tpTheme_refs&&(tpTheme_update(),tpTheme_update=null)};var ui_tpTheme=tpTheme_exported,TweakpaneUiPlugin_decorate=function(h,o,c,d){var _,v=arguments.length,b=v<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(h,o,c,d);else for(var tt=h.length-1;tt>=0;tt--)(_=h[tt])&&(b=(v<3?_(b):v>3?_(o,c,b):_(o,c))||b);return v>3&&b&&Object.defineProperty(o,c,b),b};class TweakpaneUiPlugin extends TweakpaneWrapper{constructor(o=!1,c=!1,d=!1,_,v){var b,tt;super(o,c,d,!1,(b=_??document.getElementById("tweakpaneMainPanelSlot"))!==null&&b!==void 0?b:document.body),this.dependencies=[AssetManagerPlugin],this._preRender=()=>this.refreshQueue("preRender"),this._postRender=()=>this.refreshQueue("postRender"),this._postFrame=it=>{this.dispatchEvent(it),this.refreshQueue("postFrame")},this._preFrame=()=>this.refreshQueue("preFrame"),this._plugins=[],this._pane.registerPlugin(tweakpane_image_plugin),ui_tpTheme.use({target:this._container}),this.colorMode=(tt=v??(localStorage?localStorage.getItem("tpTheme"):"blue"))!==null&&tt!==void 0?tt:"blue"}async onAdded(o){this._viewer=o,this._typeGenerators.image=tpImageInputGenerator(this._viewer),o.addEventListener("preRender",this._preRender),o.addEventListener("postRender",this._postRender),o.addEventListener("preFrame",this._preFrame),o.addEventListener("postFrame",this._postFrame)}async onDispose(o){this.dispose()}async onRemove(o){this._viewer=void 0,o.removeEventListener("preRender",this._preRender),o.removeEventListener("postRender",this._postRender),o.removeEventListener("preFrame",this._preFrame),o.removeEventListener("postFrame",this._postFrame),this.dispose()}setupPluginUi(o){var c;const d=(c=this._viewer)===null||c===void 0?void 0:c.getPlugin(o);if(!d)return void console.warn("plugin not found:",o);this._plugins.push(d),d.uiConfig&&(d.uiConfig.limitedUi=!0),d.uiConfig&&d.uiConfig.hidden===void 0&&(d.uiConfig.hidden=!1),this._appendUiObject(d);const _=d.uiConfig;if(_!=null&&_.uiRef&&d.toJSON){const v=typeof d.toJSON=="function"?d.toJSON():null;d.resetDefaults=async()=>{var it,nt;await((it=d.fromJSON)===null||it===void 0?void 0:it.call(d,v)),(nt=_.uiRefresh)===null||nt===void 0||nt.call(_,"postFrame",!0)};const b=_.uiRef.controller_.view.element,tt=ee$1({innerHTML:"&#8942;",classList:["pluginOptionsButton"],elementTag:"button"});tt.onclick=it=>{const nt={};typeof d.toJSON=="function"&&(nt["download preset"]=async()=>{var ut,ht;const _t=(ht=(ut=this._viewer)===null||ut===void 0?void 0:ut.getPlugin(AssetManagerPlugin))===null||ht===void 0?void 0:ht.exportPluginPreset(d);await N$2(new Blob([JSON.stringify(_t,null,2)],{type:"application/json"}),"preset."+d.constructor.PluginType+".json"),CustomContextMenu.Remove()}),typeof d.fromJSON=="function"&&(nt["upload preset"]=async()=>{var ut,ht,_t;CustomContextMenu.Remove();const ft=await ge$1(!1,!1);if(ft.length===0)return;const bt=ft[0],xt=await bt.text(),St=JSON.parse(xt);await((ht=(ut=this._viewer)===null||ut===void 0?void 0:ut.getPlugin(AssetManagerPlugin))===null||ht===void 0?void 0:ht.importPluginPreset(St,d)),(_t=_.uiRefresh)===null||_t===void 0||_t.call(_,"postFrame",!0)},v&&(nt["reset defaults"]=async()=>{var ut,ht;CustomContextMenu.Remove(),await((ht=(ut=d).resetDefaults)===null||ht===void 0?void 0:ht.call(ut))}));const lt=CustomContextMenu.Create(nt,b.clientWidth-120,12);b.append(lt),it.preventDefault()},b.appendChild(tt)}return _}setupPlugins(...o){o.forEach(c=>this.setupPluginUi(c))}refreshPluginsEnabled(){this._plugins.forEach(o=>{var c;const d=o.uiConfig;d&&(Ee$1(d.hidden)!==!0?(c=d.uiRefresh)===null||c===void 0||c.call(d,"postFrame",!0):d.uiRef&&(d.uiRef.hidden=!0))})}async alert(o){return this._viewer?this._viewer.alert(o):super.alert(o)}async confirm(o){return this._viewer?this._viewer.confirm(o):super.confirm(o)}async prompt(o,c,d=!0){return this._viewer?this._viewer.prompt(o,c,d):super.prompt(o,c,d)}_colorModeChanged(){document.body.classList.remove("tpTheme-black","tpTheme-white","tpTheme-blue"),document.body.classList.add("tpTheme-"+this.colorMode),localStorage&&localStorage.setItem("tpTheme",this.colorMode)}}TweakpaneUiPlugin.PluginType="TweakpaneUi",TweakpaneUiPlugin_decorate([x$1(TweakpaneUiPlugin.prototype._colorModeChanged)],TweakpaneUiPlugin.prototype,"colorMode",void 0);class SimpleBackgroundEnvUiPlugin extends AViewerPlugin{constructor(){super(...arguments),this.enabled=!0,this.toJSON=void 0,this._savedBg=!1,this.lastBgVal=null,this.uiConfig={label:"Background / Environment",type:"folder",expanded:!1,limitedUi:!0,children:[{label:"Color",type:"color",inlinePicker:!0,property:[this,"sceneBackgroundColor"],limitedUi:!0},()=>({label:"Image",property:[this,"sceneBackground"],type:"image",limitedUi:!0}),{label:"EnvMap BG",type:"checkbox",property:[this,"envmapBg"]},()=>({type:"slider",label:"BG Intensity",getValue:()=>{var o,c;return(c=(o=this._viewer)===null||o===void 0?void 0:o.scene.backgroundIntensity)!==null&&c!==void 0?c:1},setValue:o=>{this._viewer&&(this._viewer.scene.backgroundIntensity=o)},bounds:[0,16]}),{label:"Set Transparent BG",type:"button",hidden:()=>!this._viewer||this._viewer.useRgbm,value:()=>{this._viewer&&(this._viewer.scene.background=null,this._viewer.scene.backgroundColor=null)}},()=>({label:"Environment",getValue:()=>{var o;return((o=this._viewer)===null||o===void 0?void 0:o.scene.environment)||null},setValue:o=>{this._viewer&&(this._viewer.scene.environment=o)},type:"image",limitedUi:!0}),{type:"slider",label:"Env Rotation",getValue:()=>{var o,c,d;return(d=(c=(o=this._viewer)===null||o===void 0?void 0:o.scene.environment)===null||c===void 0?void 0:c.rotation)!==null&&d!==void 0?d:0},setValue:o=>{var c,d;const _=(c=this._viewer)===null||c===void 0?void 0:c.scene.environment;_&&(_.rotation=o,(d=this._viewer)===null||d===void 0||d.scene.setDirty())},bounds:[0,2*Math.PI],limitedUi:!0},{type:"slider",label:"Env Intensity",getValue:()=>{var o,c;return(c=(o=this._viewer)===null||o===void 0?void 0:o.scene.envMapIntensity)!==null&&c!==void 0?c:1},setValue:o=>{var c;!((c=this._viewer)===null||c===void 0)&&c.scene&&(this._viewer.scene.envMapIntensity=o)},bounds:[0,4],limitedUi:!0},()=>({label:"Environment1",getValue:()=>{var o;return((o=this._viewer)===null||o===void 0?void 0:o.scene.textureSlots.environment1)||null},setValue:o=>{this._viewer&&(o.mapping===three_module.UTZ&&(o.mapping=three_module.wfO,o.needsUpdate=!0),this._viewer.scene.textureSlots.environment1=o)},type:"image"}),{type:"slider",label:"Env1 Rotation",hidden:()=>{var o;return!(!((o=this._viewer)===null||o===void 0)&&o.scene.textureSlots.environment1)},getValue:()=>{var o,c,d;return(d=(c=(o=this._viewer)===null||o===void 0?void 0:o.scene.textureSlots.environment1)===null||c===void 0?void 0:c.rotation)!==null&&d!==void 0?d:0},setValue:o=>{var c,d;const _=(c=this._viewer)===null||c===void 0?void 0:c.scene.textureSlots.environment1;_&&(_.rotation=o,(d=this._viewer)===null||d===void 0||d.scene.setDirty())},bounds:[0,2*Math.PI]},{type:"checkbox",label:"Fixed Env Direction",getValue:()=>{var o,c;return(c=(o=this._viewer)===null||o===void 0?void 0:o.scene.fixedEnvMapDirection)!==null&&c!==void 0&&c},setValue:o=>{this._viewer&&(this._viewer.scene.fixedEnvMapDirection=o)}}]}}get sceneBackgroundColor(){var o,c;const d=(c=(o=this._viewer)===null||o===void 0?void 0:o.scene.backgroundColor)===null||c===void 0?void 0:c.getHex(three_module.er$);return d!==void 0&&(this._savedBg=!0),d||0}set sceneBackgroundColor(o){this._viewer&&this._savedBg&&(this._viewer.scene.backgroundColor||(this._viewer.scene.backgroundColor=new three_module.Q1f),this._viewer.scene.backgroundColor.setHex(o),this._viewer.scene.setDirty())}get sceneBackground(){var o;const c=(o=this._viewer)===null||o===void 0?void 0:o.scene.background;return c&&(c.isTexture||c.assetType==="texture")?c:null}set sceneBackground(o){this._viewer&&(this._viewer.scene.background=o)}get envmapBg(){var o,c,d;return((o=this._viewer)===null||o===void 0?void 0:o.scene.background)==="environment"||((c=this._viewer)===null||c===void 0?void 0:c.scene.background)===((d=this._viewer)===null||d===void 0?void 0:d.scene.environment)}set envmapBg(o){if(this._viewer)if(o){const c=this._viewer.scene.background;c&&c!==this._viewer.scene.environment&&c!=="environment"&&(this.lastBgVal=c),this._viewer.scene.background="environment"}else this._viewer.scene.background!==this._viewer.scene.environment&&this._viewer.scene.background!=="environment"||(this._viewer.scene.background=this.lastBgVal)}async onAdded(o){await super.onAdded(o),this.lastBgVal=o.scene.background,o.scene.addEventListener("backgroundChanged",()=>{var c,d;(d=(c=this.uiConfig).uiRefresh)===null||d===void 0||d.call(c,"postFrame",!0)}),o.scene.addEventListener("environmentChanged",()=>{var c,d;(d=(c=this.uiConfig).uiRefresh)===null||d===void 0||d.call(c,"postFrame",!0)})}}SimpleBackgroundEnvUiPlugin.PluginType="SimpleBackgroundEnvUiPlugin1";class SimpleViewerUi extends AViewerPlugin{constructor(){super(),this.enabled=!0,this.toJSON=void 0,this._uiConfig={type:"folder",label:"Scene",children:[],onExpand:()=>{var o,c;(c=(o=this._uiConfig).uiRefresh)===null||c===void 0||c.call(o,"postFrame",!0)}},this._clearSceneButton={type:"button",label:"Clear Scene",value:()=>{var o;(o=this._viewer)===null||o===void 0||o.scene.disposeSceneModels()}},this._sceneUpdate=this._sceneUpdate.bind(this)}async onAdded(o){await super.onAdded(o),o.scene.addEventListener("sceneUpdate",this._sceneUpdate)}async onRemove(o){return o.scene.removeEventListener("sceneUpdate",this._sceneUpdate),super.onRemove(o)}setDirty(){var o;(o=this._viewer)===null||o===void 0||o.setDirty()}get uiConfig(){return this._viewer?(this._uiConfig.children=[this._clearSceneButton],this._uiConfig):this._uiConfig}_sceneUpdate(){}}SimpleViewerUi.PluginType="SimpleUi";var tree=__webpackgi_require__(530),tree_default=__webpackgi_require__.n(tree),treejs=tree_default();class HierarchyUiPlugin extends AViewerPlugin{constructor(o=!0){super(),this.enabled=!0,this.toJSON=void 0,this.treeView=void 0,this.hierarchyDiv=ee$1({innerHTML:"",id:"tpHierarchyContainer",addToBody:!1}),this._resetting=!1,this._uiConfig={type:"folder",label:"Hierarchy",children:[]},this._buildData=(c,d)=>(c.push({text:d.name||"unnamed",id:d.uuid,children:d.children.reduce(this._buildData,[])}),c),this._findVisible=(c,d)=>(d.visible&&(d.children.length<1?c.push(d.uuid):c.push(...d.children.reduce(this._findVisible,[]))),c),this._setVisible=c=>{var d;(d=this._viewer)===null||d===void 0||d.doOnce("postFrame",()=>{var _,v,b;const tt=(_=this._viewer)===null||_===void 0?void 0:_.scene.modelRoot;if(!tt||c==null)return;const it=new Set;tt.traverse(nt=>{nt!==tt&&(nt.visible=c.includes(nt.uuid),nt.visible&&nt.traverseAncestors(lt=>it.add(lt)))}),it.forEach(nt=>nt.visible=!0),(b=(v=this._viewer)===null||v===void 0?void 0:v.scene)===null||b===void 0||b.setDirty({sceneUpdate:!0,fromHierarchyPlugin:!0,updateGround:!1})})},this.enabled=o,this.reset=this.reset.bind(this),P$2($`
#tpHierarchyContainer{
  width: 100%;
  height: auto;
  background-color: transparent;
  color: var(--tp-container-foreground-color, hsl(230, 7%, 75%));
  margin-top: 0;
}
.treejs .treejs-switcher:before {
    border-top: 6px solid var(--tp-container-foreground-color, hsl(230, 7%, 75%)) !important;
}
        `)}_reset(o){var c;if(o!=null&&o.fromHierarchyPlugin||o&&!o.hierarchyChanged)return;for(;this.hierarchyDiv.firstChild;)this.hierarchyDiv.firstChild.remove();const d=(c=this._viewer)===null||c===void 0?void 0:c.scene.modelRoot;if(!d)return;const _=d.children.reduce(this._buildData,[]),v=d.children.reduce(this._findVisible,[]);let b=!1;return new Promise((tt,it)=>{this.treeView=new treejs(this.hierarchyDiv,{closeDepth:1,data:_,loaded:function(){this.values=v,tt()},onChange:()=>{b?X$2(200).then(()=>{this.treeView&&this._setVisible(this.treeView.values)}):b=!0},onItemLabelClick:nt=>{var lt;const ut=(lt=this._viewer)===null||lt===void 0?void 0:lt.scene.modelRoot.modelObject.getObjectByProperty("uuid",nt);ut&&d.visible&&ut.dispatchEvent({type:"select",value:ut,ui:!0})}})})}async onAdded(o){await super.onAdded(o),o.scene.addEventListener("sceneUpdate",this.reset),await this.reset()}async reset(o){this._resetting||(this._resetting=!0,await X$2(500),await this._reset(o),this._resetting=!1)}async onRemove(o){return o.scene.removeEventListener("sceneUpdate",this.reset),super.onRemove(o)}async onDispose(o){return super.onDispose(o)}get uiConfig(){return this._uiConfig.domChildren||(this._uiConfig.domChildren=[this.hierarchyDiv]),this._uiConfig}}HierarchyUiPlugin.PluginType="HierarchyUiPlugin";class LightsUiPlugin extends AViewerPlugin{constructor(){super(),this.toJSON=void 0,this.enabled=!0,this.uiConfig={type:"folder",label:"Lights",children:[{type:"button",label:"Add Directional Light",value:()=>{if(!this._viewer)return;const o=new DirectionalLight2;o.position.set(0,0,0),o.target.position.set(0,0,-1).normalize(),o.intensity=2,o.shadow.mapSize.set(1024,1024),this._viewer.scene.addLight(o)}},{type:"button",label:"Add Ambient Light",value:()=>{if(!this._viewer)return;const o=new AmbientLight2;o.intensity=.4,this._viewer.scene.addLight(o)}},{type:"button",label:"Add Point Light",value:()=>{if(!this._viewer)return;const o=new PointLight2;o.position.set(3,3,3),o.shadow.mapSize.set(1024,1024),o.intensity=2,this._viewer.scene.addLight(o)}},{type:"button",label:"Add Spot Light",value:()=>{if(!this._viewer)return;const o=new SpotLight2;o.position.set(3,3,3),o.shadow.mapSize.set(1024,1024),o.intensity=2,o.lookAt(0,0,0),this._viewer.scene.addLight(o)}}],limitedUi:!0},this.dependencies=[AssetManagerPlugin],this._sceneUpdate=o=>{var c,d,_;if(!o.hierarchyChanged)return;const v=[];(c=this._viewer)===null||c===void 0||c.traverseSceneObjects(b=>{if(!b.lightObject)return;const tt=b.uiConfig;tt&&!v.includes(tt)&&v.push(tt)}),[...this.uiConfig.children].forEach(b=>{(b==null?void 0:b.type)==="button"||v.includes(b)||this.uiConfig.children.splice(this.uiConfig.children.indexOf(b),1)}),v.forEach(b=>{this.uiConfig.children.includes(b)||this.uiConfig.children.push(b)}),(_=(d=this.uiConfig).uiRefresh)===null||_===void 0||_.call(d,"postFrame",!0)}}async onAdded(o){await super.onAdded(o),o.scene.addEventListener("sceneUpdate",this._sceneUpdate)}async onRemove(o){return o.scene.removeEventListener("sceneUpdate",this._sceneUpdate),super.onRemove(o)}}LightsUiPlugin.PluginType="SimpleLightsUi";class SceneCamerasUiPlugin extends AViewerPlugin{constructor(){super(),this.toJSON=void 0,this.enabled=!0,this.uiConfig={type:"folder",label:"Cameras (Loaded)",children:[{type:"button",label:"Add Camera",value:()=>{var o;if(!this._viewer)return;const c=this._viewer.createCamera(new three_module.ubm(45,1,.5,20));this._viewer.scene.modelRoot.add(c.cameraObject),c.setCameraOptions({controlsMode:"orbit"}),c.position.set(2,2,2),c.target.set(0,0,0),c.positionUpdated(!0),c.cameraObject.lookAt(0,0,0),c.setDirty();const d=this._viewer.getPluginByType("VirtualCamerasPlugin");if(d){const _=d.addCamera(c),v=(o=this._viewer)===null||o===void 0?void 0:o.getPluginByType("debug");v&&v.addTexture("camera frame",()=>_.target.texture,[40,310,300,200])}}}],limitedUi:!0},this.dependencies=[AssetManagerPlugin],this._sceneUpdate=o=>{var c,d,_;if(!o.hierarchyChanged)return;const v=[];(c=this._viewer)===null||c===void 0||c.traverseSceneObjects(b=>{if(!b.cameraObject)return;const tt=b.uiConfig;tt&&!v.includes(tt)&&v.push(tt)}),[...this.uiConfig.children].forEach(b=>{(b==null?void 0:b.type)==="button"||v.includes(b)||this.uiConfig.children.splice(this.uiConfig.children.indexOf(b),1)}),v.forEach(b=>{this.uiConfig.children.includes(b)||this.uiConfig.children.push(b)}),(_=(d=this.uiConfig).uiRefresh)===null||_===void 0||_.call(d,"postFrame",!0)}}async onAdded(o){await super.onAdded(o),o.scene.addEventListener("sceneUpdate",this._sceneUpdate)}async onRemove(o){return o.scene.removeEventListener("sceneUpdate",this._sceneUpdate),super.onRemove(o)}}SceneCamerasUiPlugin.PluginType="SimpleSceneCamerasUi";var RendererUiPlugin_decorate=function(h,o,c,d){var _,v=arguments.length,b=v<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(h,o,c,d);else for(var tt=h.length-1;tt>=0;tt--)(_=h[tt])&&(b=(v<3?_(b):v>3?_(o,c,b):_(o,c))||b);return v>3&&b&&Object.defineProperty(o,c,b),b},RendererUiPlugin_1;let RendererUiPlugin=RendererUiPlugin_1=class extends AViewerPlugin{constructor(){super(),this.enabled=!0,this._serializeVersion=1,this.mode="full",this.width=0,this.height=0,this.scale=1,this._sizeChanged=this._sizeChanged.bind(this),this._refresh=this._refresh.bind(this),this.refreshSize=this.refreshSize.bind(this)}refreshSize(){var h;this.enabled&&(this._sizeChanged(),(h=this._viewer)===null||h===void 0||h.setDirty())}_sizeChanged(h=!0){if(!this._viewer||!this.enabled)return;if(this.mode==="full")return this._viewer.setSize({}),this._setScale(this.scale),void this._refresh();const o={width:Math.floor(this.width),height:Math.floor(this.height)},c=this._viewer.container.getBoundingClientRect(),d={width:Math.floor(c.width),height:Math.floor(c.height)};let _=1;if(o.width>d.width){const v=o.width;o.width=d.width;const b=o.width/v;if(o.height=Math.floor(o.height*b),_/=b,_>RendererUiPlugin_1.MaxCanvasScale)return this.width=d.width*RendererUiPlugin_1.MaxCanvasScale,console.log("loop",this.width,d.width,_),void this._sizeChanged()}if(o.height>d.height){const v=o.height;o.height=d.height;const b=o.height/v;if(o.width=Math.floor(o.width*b),_/=b,_>RendererUiPlugin_1.MaxCanvasScale)return this.height=d.height*RendererUiPlugin_1.MaxCanvasScale,console.log("loop",this.width,d.width,this.height,d.height,_),void this._sizeChanged()}(o.width>=d.width||o.width<1)&&delete o.width,(o.height>=d.height||o.height<1)&&delete o.height,this._viewer.setSize(o),this._setScale(_),h&&(this.scale=_),this._refresh()}_setScale(h){this._viewer&&(this._viewer.renderer.displayCanvasScaling=h)}_scaleChanged(){if(!this._viewer)return;const h=this.scale;if(Math.abs(h-this._viewer.renderer.displayCanvasScaling)<.01)return;if(this.mode==="full")return void this._sizeChanged();const o=this.width/this.height,c=this._viewer.container.getBoundingClientRect(),d=Math.floor(c.width*h),_=Math.floor(d/o);this.width=d,this.height=_,this._sizeChanged(!1)}async onAdded(h){await super.onAdded(h);const o=h.canvas.clientWidth,c=h.canvas.clientHeight,d=h.renderer.displayCanvasScaling;this.width=o,this.height=c,this.scale=d,h.renderer.addEventListener("resize",this.refreshSize),this.addEventListener("deserialize",this.refreshSize),this._refresh()}async onRemove(h){return this.removeEventListener("deserialize",this.refreshSize),h.renderer.removeEventListener("resize",this.refreshSize),super.onRemove(h)}_refresh(){var h,o;(o=(h=this.uiConfig)===null||h===void 0?void 0:h.uiRefresh)===null||o===void 0||o.call(h,"postFrame",!0)}fromJSON(h,o){if(!h.mode)if(h.width||h.height){const c=this._viewer.container.getBoundingClientRect();h.width||(h.width=c.width),h.height||(h.height=c.height),h.scale&&(h.width*=h.scale,h.height*=h.scale,delete h.scale),h.width=Math.round(h.width),h.height=Math.round(h.height),h.mode="custom"}else h.mode="full";return super.fromJSON(h,o)}toJSON(h){const o=super.toJSON(h);return o.mode==="full"&&(delete o.width,delete o.height),o.mode==="custom"&&delete o.scale,o}};RendererUiPlugin.PluginType="RendererParamsUiPlugin",RendererUiPlugin.MaxCanvasScale=5,RendererUiPlugin_decorate([serialize("version")],RendererUiPlugin.prototype,"_serializeVersion",void 0),RendererUiPlugin_decorate([serialize(),uiDropdown("Mode",["full","custom"].map(h=>({label:h}))),ze$1(RendererUiPlugin.prototype._sizeChanged)],RendererUiPlugin.prototype,"mode",void 0),RendererUiPlugin_decorate([serialize(),uiSlider("Width",void 0,1,h=>({onChange:()=>h._sizeChanged(),hidden:()=>h.mode==="full",bounds:()=>{var o;return[10,Math.pow(2,Math.ceil(Math.log2(((o=h._viewer)===null||o===void 0?void 0:o.container.getBoundingClientRect().width)||1024)+2))]}}))],RendererUiPlugin.prototype,"width",void 0),RendererUiPlugin_decorate([serialize(),uiSlider("Height",void 0,1,h=>({onChange:()=>h._sizeChanged(),hidden:()=>h.mode==="full",bounds:()=>{var o;return[10,Math.pow(2,Math.ceil(Math.log2(((o=h._viewer)===null||o===void 0?void 0:o.container.getBoundingClientRect().height)||1024)+2))]}}))],RendererUiPlugin.prototype,"height",void 0),RendererUiPlugin_decorate([serialize(),x$1(RendererUiPlugin.prototype._scaleChanged),uiSlider("Scale",[.25,RendererUiPlugin.MaxCanvasScale],.001,h=>({disabled:()=>h.mode==="custom"}))],RendererUiPlugin.prototype,"scale",void 0),RendererUiPlugin=RendererUiPlugin_1=RendererUiPlugin_decorate([uiFolder("Renderer")],RendererUiPlugin);class CameraUiPlugin extends AViewerPlugin{async onAdded(o){await super.onAdded(o),o.scene.addEventListener("activeCameraChange",this._refresh),o.scene.addEventListener("sceneUpdate",this._refresh)}async onRemove(o){return o.scene.removeEventListener("activeCameraChange",this._refresh),o.scene.removeEventListener("sceneUpdate",this._refresh),super.onRemove(o)}constructor(){super(),this.enabled=!0,this.serializeWithViewer=!1,this._refresh=this._refresh.bind(this)}toJSON(o){var c;const d=super.toJSON(o);return d.activeCamera=(c=this._viewer)===null||c===void 0?void 0:c.scene.activeCamera.toJSON(),d}fromJSON(o,c){var d;return o.activeCamera&&((d=this._viewer)===null||d===void 0||d.scene.activeCamera.fromJSON(o.activeCamera),delete(o={...o}).activeCamera),super.fromJSON(o,c)}_refresh(){var o,c;this._viewer&&((c=(o=this.uiConfig).uiRefresh)===null||c===void 0||c.call(o,"postFrame",!0))}get uiConfig(){var o;return((o=this._viewer)===null||o===void 0?void 0:o.scene.activeCamera.uiConfig)||{}}}CameraUiPlugin.PluginType="CameraUiPlugin";let Button={create:h=>{let o="button"+(h.type?" "+h.type:""),c=utility.createDiv(o,h.text);return c.addEventListener("click",h.onClick),c}};var js_button=Button;let Utility={createElement:(h,o,c,d)=>{let _=document.createElement(h);if(o&&(_.className=o),c&&(_.innerHTML=c),d)for(let v in d)_.setAttribute(v,d[v]);return _},createDiv:(h,o,c)=>Utility.createElement("div",h,o,c),createDomTree:h=>{if(!h||!h.hasOwnProperty("dom"))return h;let o=h.dom;if(h.children)for(let c in h.children)h.children[c]&&o.appendChild(Utility.createDomTree(h.children[c]));return o},removeElement:h=>{h!=null&&h.parentNode.removeChild(h)},appendToBody:h=>{document.body.appendChild(h)},makeIconHTML:h=>{let o="";return h=="ok"&&(o="#tick"),h=="error"&&(o="#cancel"),h=="info"&&(o="#info-button"),h=="caution"&&(o="#danger"),h=="min"&&(o="#line"),h=="close"&&(o="#close"),`<svg class="icon ${h}"><use xlink:href="${o}" /></svg>`},makeNftContent:h=>{let o=null;if(h.type){let c=null;c=typeof h.content=="string"?Utility.createDiv("inner-content",h.content):Utility.createDomTree({dom:Utility.createDiv("inner-content"),children:[h.content]}),o=h.type=="text"?Utility.createDomTree({dom:Utility.createDiv("content text"),children:[c]}):Utility.createDomTree({dom:Utility.createDiv("content"),children:[Utility.createDiv("state",Utility.makeIconHTML(h.type)),c]})}else typeof h.content=="string"&&(o=Utility.createDiv("content",h.content));return o},standardizeButtons:(h,o)=>{let c=[];if(o.buttons===void 0)return o.type!="caution"&&o.type!="info"||c.push({key:27,text:"Cancel",onClick:h.close.bind(h,"cancel")}),c.push({key:13,text:"OK",type:"main",onClick:h.close.bind(h,"ok")}),c;c=o.buttons,c.constructor!==Array&&(c=[c]);for(let d in c)!c[d].onClick&&(c[d].onClick=h.close.bind(h,c[d].id));return c},makeButtons:h=>{let o=[];if(h)for(let c in h)o.push(js_button.create({text:h[c].text?h[c].text:"OK",type:h[c].normal?null:"main",onClick:h[c].onClick}));return Utility.createDomTree({dom:Utility.createDiv("button-wrapper"),children:o})},bindButtonKeyEvents:h=>{let o=c=>{for(let d in h)if(h[d].key===c.keyCode)return void h[d].onClick()};return window.addEventListener("keydown",o),o},unbindButtonKeyEvents:h=>{window.removeEventListener("keydown",h)}};var utility=Utility,animator=__webpackgi_require__(333);let frames_frames={"wwise-overlay-in-1":{opacity:"0"},"wwise-overlay-in-2":{opacity:"1"},"wwise-overlay-out-1":{opacity:"0"},"wwise-pop-in-1":{transform:"scale(0.5, 0.5)","margin-top":"50px",opacity:".5"},"wwise-pop-in-2":{transform:"scale(1, 1)","margin-top":"0",opacity:"1"},"wwise-pop-in-3":{transform:"scale(1.05, 1.05)"},"wwise-pop-in-4":{transform:"scale(1, 1)"},"wwise-pop-out-1":{transform:"scale(0.25, 0.25)","margin-top":"50px",opacity:"0"},"wwise-flip-in-1":{transform:"rotateX(60deg) scaleX(.5)",opacity:".2"},"wwise-flip-in-2":{transform:"none",opacity:"1"},"wwise-flip-out-1":{transform:"rotateX(60deg) scaleX(.5)",opacity:"0"},"wwise-top-in-1":{transform:"translateY(-30vh)",opacity:".5"},"wwise-top-in-2":{transform:"none",opacity:"1"},"wwise-top-out-1":{transform:"translateY(-30vh)",opacity:"0"},"wwise-bottom-in-1":{transform:"translateY(30vh)",opacity:".5"},"wwise-bottom-in-2":{transform:"none",opacity:"1"},"wwise-bottom-out-1":{transform:"translateY(30vh)",opacity:"0"},"wwise-left-in-1":{transform:"translateX(-30vw)",opacity:".5"},"wwise-left-in-2":{transform:"none",opacity:"1"},"wwise-left-out-1":{transform:"translateX(-30vw)",opacity:"0"},"wwise-right-in-1":{transform:"translateX(30vw)",opacity:".5"},"wwise-right-in-2":{transform:"none",opacity:"1"},"wwise-right-out-1":{transform:"translateX(30vw)",opacity:"0"},"wwise-min-in-1":{"margin-top":"0",transform:"rotateX(-60deg) scale(0.2, 1.8) translateY(80vh)",opacity:".2"},"wwise-min-in-2":{transform:"none",opacity:"1"},"wwise-min-out-1":{"margin-top":"30vh",transform:"rotateX(-60deg) scale(0.05, 2) translateY(30vh)",opacity:"0"}};var js_frames=frames_frames;let animation_Animation={};animation_Animation.overlay_in=[new animator.Frame(js_frames["wwise-overlay-in-1"],0),new animator.Frame(js_frames["wwise-overlay-in-2"],400)],animation_Animation.overlay_out=[new animator.Frame(js_frames["wwise-overlay-out-1"],300)],animation_Animation.pop_in=[new animator.Frame(js_frames["wwise-pop-in-1"],0),new animator.Frame(js_frames["wwise-pop-in-2"],{duration:200,"timing-function":"ease-in"}),new animator.Frame(js_frames["wwise-pop-in-3"],{duration:100,"timing-function":"linear"}),new animator.Frame(js_frames["wwise-pop-in-4"],{duration:100,"timing-function":"linear"})],animation_Animation.pop_out=[new animator.Frame(js_frames["wwise-pop-out-1"],{duration:250,"timing-function":"ease-in"})],animation_Animation.flip_in=[new animator.Frame(js_frames["wwise-flip-in-1"],0),new animator.Frame(js_frames["wwise-flip-in-2"],500)],animation_Animation.flip_out=[new animator.Frame(js_frames["wwise-flip-out-1"],400)],animation_Animation.min_in=[new animator.Frame(js_frames["wwise-min-in-1"],0),new animator.Frame(js_frames["wwise-min-in-2"],350)],animation_Animation.min_out=[new animator.Frame(js_frames["wwise-min-out-1"],400)];let dirs=["top","bottom","left","right"];for(let h in dirs){let o=dirs[h];animation_Animation[o+"_in"]=[new animator.Frame(js_frames["wwise-"+o+"-in-1"],0),new animator.Frame(js_frames["wwise-"+o+"-in-2"],{duration:400,"timing-function":"ease-out"})],animation_Animation[o+"_out"]=[new animator.Frame(js_frames["wwise-"+o+"-out-1"],{duration:400,"timing-function":"ease-in"})]}var js_animation=animation_Animation;let defaultOptions={animation:"pop",topbar:{showClose:!0,showMin:!1},keepOverlay:!1,position:"center",overlay:!1,clickOverlayToClose:!0,removeBackground:!1,noRadius:!1,zIndex:null};class Window{static create(o,c){let d=o.getElementsByClassName("title")[0];d&&(d=d.innerHTML);let _=o.getElementsByClassName("content")[0];return _&&(_=_.innerHTML),utility.removeElement(o),c.title=d,c.content=_,new Window(c)}constructor(o){this.options=JSON.parse(JSON.stringify(defaultOptions));for(let it in o)o[it]!=null&&(this.options[it]=o[it]);let c=this.options.position;if(c.indexOf(" ")==-1&&(c=="left"||c=="right"?c+=" center":c=c=="top"||c=="bottom"?"center "+c:c+" "+c),this.options.position=c,this.options.overlay){let it=document.getElementsByClassName("wwise-overlay");it.length?(this.overlay=it[0],this.hasOverlay=!0):(this.overlay=utility.createDiv("wwise-overlay"),this.options.zIndex&&(this.overlay.style.zIndex=this.options.zIndex)),this.overlayClickHandler=this.close.bind(this,void 0)}else this.options.clickOverlayToClose=!1;let d="content";if(this.options.topbar){let it=[];this.options.topbar.showMin&&(it.push(utility.createDiv(null,utility.makeIconHTML("min"))),it[it.length-1].addEventListener("click",this.min.bind(this))),this.options.topbar.showClose&&(it.push(utility.createDiv(null,utility.makeIconHTML("close"))),it[it.length-1].addEventListener("click",this.close.bind(this,void 0)));let nt=null;nt=typeof this.options.title=="string"?utility.createDiv("title",this.options.title):utility.createDomTree({dom:utility.createDiv("title"),children:[this.options.title]}),this.topbar=utility.createDomTree({dom:utility.createDiv("topbar"),children:[{dom:utility.createDiv("control"),children:it.map(lt=>({dom:lt}))},{dom:nt},{dom:utility.createDiv("clear")}]})}else d+=" no-topbar";typeof this.options.content=="string"?this.content=utility.createDomTree({dom:utility.createDiv(d,this.options.content)}):this.content=utility.createDomTree({dom:utility.createDiv(d),children:[this.options.content]}),this.options.removeBackground&&(this.content.style.background="initial"),this.window=utility.createDomTree({dom:utility.createDiv("wwise"+(this.options.noRadius?" no-radius":"")),children:[this.topbar,this.content]});let _=utility.createDiv("wwise-wrapper");this.options.zIndex&&(_.style.zIndex=this.options.zIndex),this.wrapper=utility.createDomTree({dom:_,children:[this.window]}),this.dom=utility.createDomTree({dom:utility.createDiv(),children:[this.wrapper]});let v=this.options.position.split(" "),b=-50,tt=-50;if(v[0]=="left"?(b=0,this.wrapper.classList.add("left")):v[0]=="right"?(b=-100,this.wrapper.classList.add("right")):v[0]=="center"?this.wrapper.classList.add("h-center"):this.wrapper.style.left=v[0],v[1]=="top"?(tt=0,this.wrapper.classList.add("top")):v[1]=="bottom"?(tt=-100,this.wrapper.classList.add("bottom")):v[1]=="center"?this.wrapper.classList.add("v-center"):this.wrapper.style.top=c[1],this.window.style.transform=`translate(${b}%, ${tt}%)`,this.options.style)for(let it in this.options.style)this.window.style[it]=this.options.style[it];this.options.margin&&(this.wrapper.style.margin=this.options.margin),this.options.draggable&&this.draggable()}open(o){if(this.opened)return;this.promise=new Promise(d=>{this.promiseResolve=d}),this.appendDoms(),this.opened=!0,this.options.clickOverlayToClose&&(this.overlay.addEventListener("click",this.overlayClickHandler),this.overlay.addEventListener("touchstart",this.overlayClickHandler));let c=o?"min":this.options.animation;if(c){c!="min"&&c!="flip"||this.dom.classList.add("wwise-perspective");let d=[new animator.Queue(this.wrapper,js_animation[c+"_in"],{instant:!0,applyOnEnd:!0}).getPromise()];return this.options.overlay&&!this.hasOverlay&&d.push(new animator.Queue(this.overlay,js_animation.overlay_in,{instant:!0,applyOnEnd:!0}).getPromise()),Promise.all(d).then(()=>{this.dom.classList.remove("wwise-perspective")})}return Promise.resolve()}close(o){if(!this.opened)return;this.opened=!1;let c=o?"min":this.options.animation;if(this.overlay&&(this.overlay.removeEventListener("click",this.overlayClickHandler),this.overlay.removeEventListener("touchstart",this.overlayClickHandler)),c){c!="min"&&c!="flip"||this.dom.classList.add("wwise-perspective");let d=[new animator.Queue(this.wrapper,js_animation[c+"_out"],{instant:!0,applyOnEnd:!0}).getPromise()];return this.options.overlay&&!this.options.keepOverlay&&d.push(new animator.Queue(this.overlay,js_animation.overlay_out,{instant:!0,applyOnEnd:!0}).getPromise()),Promise.all(d).then(()=>{this.removeDoms(),this.dom.classList.remove("wwise-perspective"),this.promiseResolve()})}return this.removeDoms(),this.promiseResolve(),Promise.resolve()}min(){return this.close(!0)}resume(){return this.open(!0)}getPromise(){return this.promise}appendDoms(){this.options.overlay&&!this.hasOverlay&&(utility.appendToBody(this.overlay),document.body.classList.add("wwise-no-scroll"),this.overlay.addEventListener("touchstart",o=>{o.preventDefault()})),utility.appendToBody(this.dom)}removeDoms(){utility.removeElement(this.dom),!this.options.keepOverlay&&this.overlay&&(utility.removeElement(this.overlay),document.body.classList.remove("wwise-no-scroll"))}draggable(o=!0){this.topbar&&(o?(this.draggableMouseMoveHandler=this.handleDraggableMouseMove.bind(this),this.draggableMouseDownHandler=this.handleDraggableMouseDown.bind(this),this.draggableMouseUpHandler=this.handleDraggableMouseUp.bind(this),this.draggableMouseOutHandler=this.handleDraggableMouseOut.bind(this),window.addEventListener("mousemove",this.draggableMouseMoveHandler),window.addEventListener("mouseout",this.draggableMouseOutHandler),this.topbar.addEventListener("mousedown",this.draggableMouseDownHandler),window.addEventListener("mouseup",this.draggableMouseUpHandler)):(window.removeEventListener("mousemove",this.draggableMouseMoveHandler),window.removeEventListener("mouseout",this.draggableMouseOutHandler),this.topbar.removeEventListener("mousedown",this.draggableMouseDownHandler),window.removeEventListener("mouseup",this.draggableMouseUpHandler)))}handleDraggableMouseMove(o){if(this.inDragging){let c={x:o.clientX-this.dragPrev.x,y:o.clientY-this.dragPrev.y},d=window.getComputedStyle(this.wrapper),_=this.options.draggable,v=parseFloat(d.left),b=parseFloat(d.top);if(d.left.indexOf("%")!=-1){v=d.left,v=v.substr(0,v.length-1),v=parseInt(v);let tt=window,it=document,nt=it.documentElement,lt=it.getElementsByTagName("body")[0];v=v*(tt.innerWidth||nt.clientWidth||lt.clientWidth)/100}if(d.top.indexOf("%")!=-1){b=d.top,b=b.substr(0,b.length-1),b=parseInt(b);let tt=window,it=document,nt=it.documentElement,lt=it.getElementsByTagName("body")[0];b=b*(tt.innerHeight||nt.clientHeight||lt.clientHeight)/100}_!=1&&_!="horizontal"||(this.wrapper.style.left=v+c.x+"px"),_!=1&&_!="vertical"||(this.wrapper.style.top=b+c.y+"px"),this.dragPrev={x:o.clientX,y:o.clientY}}}handleDraggableMouseDown(o){this.inDragging=!0,this.dragPrev={x:o.clientX,y:o.clientY}}handleDraggableMouseUp(o){this.inDragging=!1}handleDraggableMouseOut(o){let c=o.relatedTarget;c&&c.nodeName!="HTML"||(this.inDragging=!1)}}var js_window=Window;class Modal{constructor(o){let c=this.options=o;!c.type&&(c.type="ok");let d={topbar:!1};d.content=this.constructContent({type:c.type,title:c.title,text:c.text,content:c.content,buttons:c.buttons}),d.overlay=!0,d.keepOverlay=c.keepOverlay,d.clickOverlayToClose=!1,d.animation=c.animation,d.zIndex=c.zIndex,this.wwise=new js_window(d)}constructContent(o){let c=utility.createDiv("modal"),d=utility.createDomTree({dom:utility.createDiv("main "+o.type),children:[utility.createDiv(null,utility.makeIconHTML(o.type)),utility.createDiv("title",o.title),utility.createDiv("text",o.text)]});this.buttonArr=utility.standardizeButtons(this,o);let _=utility.makeButtons(this.buttonArr),v=null;o.content&&(v=typeof o.content=="string"?utility.createDiv(null,o.content):o.content);let b=null;return _.innerHTML&&(b=utility.createDomTree({dom:utility.createDiv("operation "+o.type),children:[_]})),v||b||d.classList.add("no-op"),utility.createDomTree({dom:c,children:[d,v,b]})}open(){if(this.wwise.opened)return;let o=this.wwise.open();return this.value=void 0,this.promise=new Promise(c=>{this.promiseResolve=c}),this.wwise.getPromise().then(this.handlePromiseResolve.bind(this)),this.keyHandler=utility.bindButtonKeyEvents(this.buttonArr),this.options.closeAfter&&window.setTimeout(()=>{this.close("timer")},this.options.closeAfter),o}close(o){if(this.wwise.opened)return this.value=o,utility.unbindButtonKeyEvents(this.keyHandler),this.wwise.close()}getPromise(){return this.promise}handlePromiseResolve(){this.promiseResolve(this.value)}}var js_modal=Modal;let input_defaultOptions={showCancel:!1,okText:"OK",cancelText:"Cancel",placeholder:"",validator:null},defaultWwiseOptions={type:"info",keepOverlay:!1,title:"Input",text:"",zIndex:null};class Input{constructor(o){this.options=JSON.parse(JSON.stringify(input_defaultOptions));for(let v in o)o[v]!=null&&(this.options[v]=o[v]);let c=this.options,d=JSON.parse(JSON.stringify(defaultWwiseOptions));for(let v in d)c.hasOwnProperty(v)&&(d[v]=c[v]);let _=[];c.showCancel&&_.push({key:27,text:c.cancelText,normal:!0,onClick:this.handleCancel.bind(this)}),_.push({key:13,text:c.okText,onClick:this.handleOk.bind(this)}),d.buttons=_,this.input=utility.createElement("input","input",null,{placeholder:c.placeholder}),this.error=utility.createDiv("error"),d.content=utility.createDomTree({dom:utility.createDiv("input-wrapper"),children:[this.input,this.error]}),this.modal=new js_modal(d)}handleCancel(){this.close().then(this.promiseReject.bind(this))}handleOk(){this.options.validator?this.options.validator(this.input.value).then(()=>{this.close().then(this.promiseResolve.bind(this,this.input.value))},o=>{this.error.innerText=o}):this.close().then(this.promiseResolve.bind(this,this.input.value))}open(){if(this.modal.wwise.opened)return;let o=this.modal.open();return this.input.value="",this.error.innerText="",this.input.focus(),this.promise=new Promise((c,d)=>{this.promiseResolve=c,this.promiseReject=d}),o}close(){if(this.modal.wwise.opened)return this.modal.close()}getPromise(){return this.promise}}var input=Input,windowise=__webpackgi_require__(160),windowise_exported={};windowise.A&&windowise.A.locals&&(windowise_exported.locals=windowise.A.locals);var windowise_refs=0,windowise_update,windowise_options={};windowise_options.styleTagTransform=styleTagTransform_default(),windowise_options.setAttributes=setAttributesWithoutAttributes_default(),windowise_options.insert=function(h,o){(o.target||document.head).appendChild(h)},windowise_options.domAPI=styleDomAPI_default(),windowise_options.insertStyleElement=insertStyleElement_default(),windowise_exported.use=function(h){return windowise_options.options=h||{},windowise_refs++||(windowise_update=injectStylesIntoStyleTag_default()(windowise.A,windowise_options)),windowise_exported},windowise_exported.unuse=function(){windowise_refs>0&&!--windowise_refs&&(windowise_update(),windowise_update=null)};var ui_windowise=windowise_exported;class WindowiseDialogPlugin extends AViewerPlugin{constructor(){super(...arguments),this.enabled=!0,this.toJSON=void 0,this._previousMappings={}}async onAdded(o){await super.onAdded(o),this._previousMappings={alert:o.alert,confirm:o.confirm,prompt:o.prompt},utility.appendToBody=c=>{c.style.zIndex="350",o.container.appendChild(c)},utility.makeIconHTML=c=>"",ui_windowise.use({target:o.container}),o.alert=async c=>{const d=c==null?void 0:c.split(":")[0],_=new js_modal({type:"info",title:d??"&ndsp;",text:(c==null?void 0:c.replace(d+":","").replace(/(\r?\n)/gm,"<br>"))||"",buttons:[{key:13,text:"OK",type:"main",id:"ok"}],animation:"overlay"});return _.open(),_.getPromise()},o.confirm=async c=>{const d=c==null?void 0:c.split(":")[0],_=new js_modal({type:"info",title:d??"&ndsp;",text:(c==null?void 0:c.replace(d||"","").replace(":",""))||"",buttons:[{id:"no",key:27,text:"No",normal:!0},{id:"yes",key:13,text:"Yes"}],animation:"overlay"});return _.open(),await _.getPromise()==="yes"},o.prompt=async(c,d,_=!0)=>{const v=c==null?void 0:c.split(":")[0],b=new input({type:"info",title:v??"&ndsp;",placeholder:d??"",showCancel:_,animation:"overlay",text:(c==null?void 0:c.replace(v||"","").replace(":",""))||""});return b.open(),await b.getPromise().catch(async()=>null)}}async onRemove(o){return o.alert=this._previousMappings.alert,o.confirm=this._previousMappings.confirm,o.prompt=this._previousMappings.prompt,super.onRemove(o)}}WindowiseDialogPlugin.PluginType="WindowiseDialogPlugin";var editorModes=__webpackgi_require__(757),editorModes_exported={};editorModes.A&&editorModes.A.locals&&(editorModes_exported.locals=editorModes.A.locals);var editorModes_refs=0,editorModes_update,editorModes_options={};editorModes_options.styleTagTransform=styleTagTransform_default(),editorModes_options.setAttributes=setAttributesWithoutAttributes_default(),editorModes_options.insert=function(h,o){(o.target||document.head).appendChild(h)},editorModes_options.domAPI=styleDomAPI_default(),editorModes_options.insertStyleElement=insertStyleElement_default(),editorModes_exported.use=function(h){return editorModes_options.options=h||{},editorModes_refs++||(editorModes_update=injectStylesIntoStyleTag_default()(editorModes.A,editorModes_options)),editorModes_exported},editorModes_exported.unuse=function(){editorModes_refs>0&&!--editorModes_refs&&(editorModes_update(),editorModes_update=null)};var ui_editorModes=editorModes_exported;function setupModesStyles(){ui_editorModes.use(),tippy_js_dist_tippy.use()}async function setupModesUi(h,o=void 0,c=[]){var d,_;tippy_esm.setDefaultProps({theme:"editor",duration:300,arrow:!0,appendTo:()=>h.container});const v=ee$1({classList:["mode-buttons-container","button-bar"],addToBody:!0}),b=ee$1({innerHTML:"",id:"webgi-logo",addToBody:!1});rt("logo-img")&&(b.style.backgroundImage=`url(${rt("logo-img")})`),b.onclick=()=>{window.open(rt("logo-link")||"https://webgi.xyz","_blank")};const tt=`<svg xmlns="http://www.w3.org/2000/svg" style="width:100%; height:100%;" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path stroke-linecap="round" stroke-linejoin="round" d="M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4" />
</svg>`;h.container.appendChild(b),tippy_esm(b,{placement:"right",content:"Powered by WebGi SDK"});const it=ee$1({innerHTML:tt,id:"fsToggle",classList:["round-button"],addToBody:!1});it.dataset.tippyContent="Full-Screen",(d=h.getPlugin(FullScreenPlugin))===null||d===void 0||d.addEventListener("enter",()=>{it.innerHTML=`<svg xmlns="http://www.w3.org/2000/svg" style="width:100%; height:100%;" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path d="M9 19L9 15M9 15L5 15M9 15L4 20M15 15L20 20M15 15V19M15 15H19M15 5V9M15 9L19 9M15 9L20 4M9 5L9 9M9 9L5 9M9 9L4 4" stroke-linecap="round" stroke-linejoin="round"/>
</svg>`,it.dataset.tippyContent="Exit Full-Screen"}),(_=h.getPlugin(FullScreenPlugin))===null||_===void 0||_.addEventListener("exit",()=>{it.innerHTML=tt,it.dataset.tippyContent="Full-Screen"}),it.onclick=()=>{var St;(St=h.getPlugin(FullScreenPlugin))===null||St===void 0||St.toggle(h.container)},h.container.appendChild(it),tippy_esm(it,{placement:"left"});const nt=ee$1({classList:["button-bar","util-buttons-container"],addToBody:!1});h.container.appendChild(nt);const lt=[{id:"reset-settings",icon:`<svg xmlns="http://www.w3.org/2000/svg" style="width:100%; height:100%;" fill="currentColor" viewBox="0 0 24 24">
 <path fill="currentColor" d="M19 8L15 12H18C18 15.31 15.31 18 12 18C11 18 10.03 17.75 9.2 17.3L7.74 18.76C8.97 19.54 10.43 20 12 20C16.42 20 20 16.42 20 12H23M6 12C6 8.69 8.69 6 12 6C13 6 13.97 6.25 14.8 6.7L16.26 5.24C15.03 4.46 13.57 4 12 4C7.58 4 4 7.58 4 12H1L5 16L9 12M14 12C14 13.11 13.11 14 12 14S10 13.11 10 12 10.9 10 12 10 14 10.9 14 12Z" />
</svg>`,tooltip:"Reset All Settings",onclick:async()=>{var St;if(!await h.confirm("Reset settings: Are you sure you want to reset all plugin settings?"))return;const wt=bt.map(Pt=>h.getPlugin(Pt));for(const Pt of wt)await((St=Pt==null?void 0:Pt.resetDefaults)===null||St===void 0?void 0:St.call(Pt))}},{id:"clear-scene",icon:`<svg xmlns="http://www.w3.org/2000/svg" style="width:100%; height:100%;" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
 <path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
</svg>`,tooltip:"Clear Scene",onclick:async()=>{await h.confirm("Clear scene: Are you sure you want to clear the scene?")&&h.scene.disposeSceneModels()}},{id:"fit-scene",icon:`<svg xmlns="http://www.w3.org/2000/svg" style="width:100%; height:100%;" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1">
    <path fill="currentColor" d="M17 12C17 7.55 11.62 5.31 8.46 8.46C5.31 11.61 7.55 17 12 17C14.76 17 17 14.76 17 12M12 15C9.33 15 8 11.77 9.88 9.88C11.77 8 15 9.33 15 12C15 13.66 13.66 15 12 15M5 15H3V19C3 20.1 3.9 21 5 21H9V19H5M5 5H9V3H5C3.9 3 3 3.9 3 5V9H5M19 3H15V5H19V9H21V5C21 3.9 20.1 3 19 3M19 19H15V21H19C20.1 21 21 20.1 21 19V15H19" />
</svg>`,tooltip:"Fit Object/Scene",onclick:async()=>{var St;await h.fitToView((St=h.getPlugin(PickingPlugin))===null||St===void 0?void 0:St.getSelectedObject())}},{id:"loop-cam-views",icon:`<svg xmlns="http://www.w3.org/2000/svg" style="width:100%; height:100%;" fill="currentColor" viewBox="0 0 24 24">
 <path fill="currentColor" d="M19 8L15 12H18C18 15.31 15.31 18 12 18C11 18 10.03 17.75 9.2 17.3L7.74 18.76C8.97 19.54 10.43 20 12 20C16.42 20 20 16.42 20 12H23M6 12C6 8.69 8.69 6 12 6C13 6 13.97 6.25 14.8 6.7L16.26 5.24C15.03 4.46 13.57 4 12 4C7.58 4 4 7.58 4 12H1L5 16L9 12M14 12C14 13.11 13.11 14 12 14S10 13.11 10 12 10.9 10 12 10 14 10.9 14 12Z" />
</svg>`,tooltip:"Loop Camera Views",toggle:!0,onclick:async()=>{h.getPlugin(CameraViewPlugin)&&(h.getPlugin(CameraViewPlugin).viewLooping=!h.getPlugin(CameraViewPlugin).viewLooping)}},{id:"play-gltf",icon:`<svg xmlns="http://www.w3.org/2000/svg" style="width:100%; height:100%;" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path stroke-linecap="round" stroke-linejoin="round" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z" />
  <path stroke-linecap="round" stroke-linejoin="round" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
</svg>`,tooltip:"GLTF Animations",toggle:!0,onclick:async()=>{var St;(St=h.getPlugin(GLTFAnimationPlugin))===null||St===void 0||St.playPauseAnimation()}},{id:"auto-rotate-cc",icon:`<svg xmlns="http://www.w3.org/2000/svg" style="width:100%; height:100%;" fill="currentColor" viewBox="0 0 24 24">
 <path fill="currentColor" d="M10,12L14,16L10,20V16.9C5.44,16.44 2,14.42 2,12C2,9.58 5.44,7.56 10,7.1V9.09C6.55,9.43 4,10.6 4,12C4,13.4 6.55,14.57 10,14.91V12M20,12C20,10.6 17.45,9.43 14,9.09V7.1C18.56,7.56 22,9.58 22,12C22,14.16 19.26,16 15.42,16.7L16.12,16L14.92,14.79C17.89,14.36 20,13.27 20,12M11,2H13V13L11,11V2M11,22V21L13,19V22H11Z" />
</svg>`,tooltip:"Auto rotate",toggle:!0,onclick:async()=>{const St=h.scene.activeCamera.controls;St&&St.autoRotate!==void 0&&(St.autoRotate=!St.autoRotate)}},{id:"snapshot",icon:`<svg xmlns="http://www.w3.org/2000/svg" style="width:100%; height:100%;" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path stroke-linecap="round" stroke-linejoin="round" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z" />
  <path stroke-linecap="round" stroke-linejoin="round" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z" />
</svg>`,tooltip:"Capture Snapshot",onclick:async()=>{const St=h.getPlugin(CanvasSnipperPlugin);St?await St.downloadSnapshot():h.console.error("CanvasSnipperPlugin not added")}},{id:"glb-export",icon:`<svg xmlns="http://www.w3.org/2000/svg" style="width:100%; height:100%;" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path stroke-linecap="round" stroke-linejoin="round" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
</svg>`,tooltip:"Export GLB",onclick:async()=>{const St=h.getPlugin(AssetExporterPlugin);St?await(St==null?void 0:St.downloadSceneGlb()):h.console.error("AssetExporterPlugin not added")}}];for(const St of lt){const wt=ee$1({innerHTML:St.icon,id:St.id,classList:["button-bar-button","util-button"],addToBody:!1});wt.dataset.tippyContent=St.tooltip,wt.onclick=()=>{St.toggle&&wt.classList.toggle("button-bar-selected-box"),St.onclick()},nt.appendChild(wt)}createSingleton(tippy_esm(".util-button"),{moveTransition:"transform 0.2s ease-out",placement:"top"});const ut=h.getPlugin(PickingPlugin),ht=h.getPlugin(InteractionPromptPlugin);for(const[St,wt]of Object.entries(o??{})){const Pt=c.find(Rt=>Rt.title===St);Pt?Pt.plugins.push(...wt):c.push({title:St,plugins:[...wt]})}let _t=c[2],ft=[];const bt=c.reduce((St,wt)=>St.concat(wt.plugins),[]);function xt(St,wt=!0){var Pt;_t=St,ut&&(ut.enabled=!0),ht&&(["Plugins"].includes(_t.title)?ht.enable("modesUi"):ht.disable("modesUi")),ft=[];for(const Rt of bt){const kt=h.getPlugin(Rt);if(!(kt!=null&&kt.uiConfig))continue;const Gt=St.plugins.includes(Rt);S$2(kt.uiConfig,"hidden",!Gt,!0),Gt&&ft.push(kt)}for(const Rt of c)(Pt=Rt.div)===null||Pt===void 0||Pt.classList[_t!==Rt?"remove":"add"]("mode-button-selected","button-bar-selected");h.getPlugin(TweakpaneUiPlugin).refreshPluginsEnabled(),wt&&window.dispatchEvent(new CustomEvent("webgi_editorModeChanged",{detail:{mode:St}}))}for(const St of c){const wt=ee$1({innerHTML:St.title,classList:["mode-button","button-bar-button"]});wt.onclick=()=>{xt(St)},St.div=wt,v.appendChild(wt)}xt(c[0]),window.webgi_setEditorMode=xt,window.webgi_editorModes=c,ut==null||ut.addEventListener("selectedObjectChanged",()=>{ut!=null&&ut.getSelectedObject()&&!["Picking","Modifiers","Configurators"].includes(_t.title)&&xt(c.find(St=>St.plugins.includes(PickingPlugin)))})}class ExtrasUiPlugin extends AViewerPlugin{constructor(){super(...arguments),this.enabled=!0,this.toJSON=void 0,this.showColorScheme=!0,this.uiConfig={type:"folder",label:"Extras",limitedUi:!1,children:[()=>this.showColorScheme?{label:"Color Scheme",type:"dropdown",children:["black","white","blue"].map(o=>({label:o})),getValue:()=>{var o,c;return(c=(o=this._viewer)===null||o===void 0?void 0:o.getPluginByType("TweakpaneUi"))===null||c===void 0?void 0:c.colorMode},setValue:o=>{var c;const d=(c=this._viewer)===null||c===void 0?void 0:c.getPluginByType("TweakpaneUi");d&&(d.colorMode=o)}}:void 0,()=>({label:"Shadow type",type:"dropdown",children:[["Basic",three_module.bTm],["PCF",three_module.QP0],["PCFSoft",three_module.Wk7],["VSM",three_module.RyA]].map(o=>({label:o[0],value:o[1]})),getValue:()=>{var o;return(o=this._viewer)===null||o===void 0?void 0:o.renderer.rendererObject.shadowMap.type},setValue:o=>{var c;(c=this._viewer)===null||c===void 0||c.doOnce("postFrame",()=>{this._viewer&&(this._viewer.renderer.rendererObject.shadowMap.type=o,this._viewer.renderer.resetShadows(),this._viewer.renderer.reset(),this._viewer.scene.setDirty({sceneUpdate:!0,frameFade:!1}),this._viewer.setDirty())})}}),()=>{var o;return{label:(!((o=this._viewer)===null||o===void 0)&&o.useRgbm?"Disable":"Enable")+" RGBM",type:"button",value:async()=>{var c,d;await((c=this._viewer)===null||c===void 0?void 0:c.confirm("Edit Extras: This will reload the webpage. Are you sure?"))&&st("rgbm",!((d=this._viewer)===null||d===void 0)&&d.useRgbm?"no":"yes",!0)}}},()=>{var o;return{label:(!((o=this._viewer)===null||o===void 0)&&o.isAntialiased?"Disable":"Enable")+" MSAA",type:"button",value:async()=>{var c,d;await((c=this._viewer)===null||c===void 0?void 0:c.confirm("Edit Extras: This will reload the webpage. Are you sure?"))&&st("msaa",!((d=this._viewer)===null||d===void 0)&&d.isAntialiased?"no":"yes",!0)}}},()=>{var o;return{label:(!((o=this._viewer)===null||o===void 0)&&o.useGBufferDepth?"Disable":"Enable")+" Depth(z) Prepass",type:"button",value:async()=>{var c,d;await((c=this._viewer)===null||c===void 0?void 0:c.confirm("Edit Extras: This will reload the webpage. Are you sure?"))&&st("depthPrepass",!((d=this._viewer)===null||d===void 0)&&d.useGBufferDepth?"no":"yes",!0)}}},()=>{var o;return{label:(!((o=this._viewer)===null||o===void 0)&&o.getPluginByType("debug")?"Disable":"Enable")+" Debug",type:"button",value:async()=>{var c,d;await((c=this._viewer)===null||c===void 0?void 0:c.confirm("Edit Extras: This will reload the webpage. Are you sure?"))&&st("debug",!((d=this._viewer)===null||d===void 0)&&d.getPluginByType("debug")?null:"true",!0)}}},{label:"Clear local storage",type:"button",value:async()=>{var o;await((o=this._viewer)===null||o===void 0?void 0:o.confirm("Edit Extras: This will clear all local storage. Are you sure?"))&&localStorage.clear()}},{label:"Clear caches",type:"button",value:async()=>{var o,c;const d=(c=(o=this._viewer)===null||o===void 0?void 0:o.getPlugin(AssetManagerPlugin))===null||c===void 0?void 0:c.storage;if(d instanceof Storage)d.clear();else if(d instanceof Cache){const _=await d.keys();await Promise.all(_.map(async v=>d.delete(v)))}localStorage.clear()}},{label:"Auto GPU instance all",type:"button",value:()=>{var o;const c=new Set;(o=this._viewer)===null||o===void 0||o.scene.modelRoot.traverse(d=>d.geometry&&c.add(d.geometry)),c.forEach(d=>autoGPUInstanceMeshes(d))}},{label:"Auto Center All Geometries",type:"button",value:()=>{var o;const c=new Set;(o=this._viewer)===null||o===void 0||o.scene.modelRoot.traverse(d=>d.geometry&&c.add(d.geometry)),c.forEach(d=>{const _=new three_module.Pq0;d.center(_),_.negate();const v=d.userData.__appliedMeshes;v||console.error("No meshes found for geometry",d),v==null||v.forEach(b=>{b.updateMatrix(),b.position.copy(_).applyMatrix4(b.matrix),b.setDirty&&b.setDirty()})})}}]}}}ExtrasUiPlugin.PluginType="ExtrasUiPlugin1";var AHelperWidget_decorate=function(h,o,c,d){var _,v=arguments.length,b=v<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(h,o,c,d);else for(var tt=h.length-1;tt>=0;tt--)(_=h[tt])&&(b=(v<3?_(b):v>3?_(o,c,b):_(o,c))||b);return v>3&&b&&Object.defineProperty(o,c,b),b};class AHelperWidget extends three_module.B69{constructor(o){super(),this.modelObject=this,this.assetType="widget",this.visible=!0,this.uiConfig=generateUiFolder("Widget",this),this.object=o,this.object.updateMatrixWorld(),this.object.updateProjectionMatrix&&this.object.updateProjectionMatrix(),this.matrix=o.matrixWorld,this.matrixAutoUpdate=!1,this._objectUpdate=this._objectUpdate.bind(this),this.attach(o),this.traverse(c=>{c.userData.__keepShadowDef=!0,c.castShadow=!1,c.receiveShadow=!1})}dispose(){this.detach()}_objectUpdate(){this.object&&this.update()}attach(o){var c,d;return this.object&&this.detach(),this.object=o,this.object&&(this.update(),this.object.addEventListener("objectUpdate",this._objectUpdate),this.object.addEventListener("dispose",this.dispose),this.uiConfig&&((d=(c=this.object.uiConfig)===null||c===void 0?void 0:c.children)===null||d===void 0||d.push(this.uiConfig)),this.visible=!0),this}detach(){var o,c,d,_;if(this.object){if(this.object.removeEventListener("objectUpdate",this._objectUpdate),this.object.removeEventListener("dispose",this.dispose),this.uiConfig){const v=(c=(o=this.object.uiConfig)===null||o===void 0?void 0:o.children)===null||c===void 0?void 0:c.indexOf(this.uiConfig);v!==void 0&&v>=0&&((_=(d=this.object.uiConfig)===null||d===void 0?void 0:d.children)===null||_===void 0||_.splice(v,1))}this.object=void 0,this.visible=!1}return this}}AHelperWidget_decorate([uiToggle()],AHelperWidget.prototype,"visible",void 0);class ALightHelperWidget extends AHelperWidget{constructor(o){super(o),this.light=o,this.traverse(c=>{c.userData.__keepShadowDef=!0,c.castShadow=!1,c.receiveShadow=!1})}}var DirectionalLightHelper2_decorate=function(h,o,c,d){var _,v=arguments.length,b=v<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(h,o,c,d);else for(var tt=h.length-1;tt>=0;tt--)(_=h[tt])&&(b=(v<3?_(b):v>3?_(o,c,b):_(o,c))||b);return v>3&&b&&Object.defineProperty(o,c,b),b};class DirectionalLightHelper2 extends ALightHelperWidget{constructor(o,c,d){super(o),this.lineWidth=5,this.size=.5,this._v1=new three_module.Pq0,this._v2=new three_module.Pq0,this._v3=new three_module.Pq0,this.color=d,c!==void 0&&(this.size=c);let _=new LineGeometry;this.material=new LineMaterial({color:16711680,linewidth:.005,vertexColors:!1,dashed:!1,alphaToCoverage:!0,toneMapped:!1,transparent:!0,depthTest:!1,depthWrite:!1}),this.lightPlane=new Line2(_,this.material),this.add(this.lightPlane),_=new LineGeometry,_.setPositions([0,0,0,0,0,1]),this.targetLine=new Line2(_,this.material),this.add(this.targetLine),this.update(),this.traverse(v=>{v.userData.__keepShadowDef=!0,v.castShadow=!1,v.receiveShadow=!1})}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose(),super.dispose()}update(){var o;this.light&&this.lightPlane&&(this._v1.setFromMatrixPosition(this.light.matrixWorld),this._v2.setFromMatrixPosition(this.light.target.matrixWorld),this._v3.subVectors(this._v2,this._v1),this.lightPlane.geometry.setPositions([-this.size,this.size,0,this.size,this.size,0,this.size,-this.size,0,-this.size,-this.size,0,-this.size,this.size,0]),this.lightPlane.lookAt(this._v2),this.lightPlane.material=this.material,this.targetLine.material=this.material,this.material.color.set((o=this.color)!==null&&o!==void 0?o:this.light.color),this.material.linewidth=.001*this.lineWidth,this.targetLine.lookAt(this._v2),this.targetLine.scale.z=this.light.intensity/3)}static Check(o){return o.isDirectionalLight}static Create(o){return new DirectionalLightHelper2(o)}}DirectionalLightHelper2_decorate([x$1(DirectionalLightHelper2.prototype.update)],DirectionalLightHelper2.prototype,"material",void 0),DirectionalLightHelper2_decorate([x$1(DirectionalLightHelper2.prototype.update),uiSlider(void 0,[.1,20],.01)],DirectionalLightHelper2.prototype,"lineWidth",void 0),DirectionalLightHelper2_decorate([x$1(DirectionalLightHelper2.prototype.update),uiSlider(void 0,[.01,10],.01)],DirectionalLightHelper2.prototype,"size",void 0);var PointLightHelper2_decorate=function(h,o,c,d){var _,v=arguments.length,b=v<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(h,o,c,d);else for(var tt=h.length-1;tt>=0;tt--)(_=h[tt])&&(b=(v<3?_(b):v>3?_(o,c,b):_(o,c))||b);return v>3&&b&&Object.defineProperty(o,c,b),b};class PointLightHelper2 extends ALightHelperWidget{constructor(o,c,d){super(o),this.lineWidth=5,this.size=.5,this.color=d,c!==void 0&&(this.size=c);const _=new WireframeGeometry2(new three_module.Gu$(.5,4,2));this.material=new LineMaterial({color:16711680,linewidth:.005,vertexColors:!1,dashed:!1,alphaToCoverage:!0,toneMapped:!1,transparent:!0,depthTest:!1,depthWrite:!1}),this.lightSphere=new Wireframe(_,this.material),this.lightSphere.computeLineDistances(),this.add(this.lightSphere),this.update(),this.traverse(v=>{v.userData.__keepShadowDef=!0,v.castShadow=!1,v.receiveShadow=!1})}dispose(){this.lightSphere.geometry.dispose(),this.lightSphere.material.dispose(),super.dispose()}update(){var o;this.light&&this.lightSphere&&(this.material.color.set((o=this.color)!==null&&o!==void 0?o:this.light.color),this.material.linewidth=.001*this.lineWidth,this.lightSphere.scale.setScalar(this.size))}static Check(o){return o.isPointLight}static Create(o){return new PointLightHelper2(o)}}PointLightHelper2_decorate([x$1(PointLightHelper2.prototype.update)],PointLightHelper2.prototype,"material",void 0),PointLightHelper2_decorate([x$1(PointLightHelper2.prototype.update),uiSlider(void 0,[.1,20],.01)],PointLightHelper2.prototype,"lineWidth",void 0),PointLightHelper2_decorate([x$1(PointLightHelper2.prototype.update),uiSlider(void 0,[.01,10],.01)],PointLightHelper2.prototype,"size",void 0);var SpotLightHelper2_decorate=function(h,o,c,d){var _,v=arguments.length,b=v<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(h,o,c,d);else for(var tt=h.length-1;tt>=0;tt--)(_=h[tt])&&(b=(v<3?_(b):v>3?_(o,c,b):_(o,c))||b);return v>3&&b&&Object.defineProperty(o,c,b),b};class SpotLightHelper2 extends ALightHelperWidget{constructor(o,c,d){super(o),this.lineWidth=5,this._v1=new three_module.Pq0,this.color=d;let _=new LineSegmentsGeometry;const v=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let b=0,tt=1,it=32;b<it;b++,tt++){const nt=b/it*Math.PI*2,lt=tt/it*Math.PI*2;v.push(Math.cos(nt),Math.sin(nt),1,Math.cos(lt),Math.sin(lt),1)}_.setPositions(v),this.material=new LineMaterial({color:16711680,linewidth:.005,vertexColors:!1,dashed:!1,alphaToCoverage:!0,toneMapped:!1,transparent:!0,depthTest:!1,depthWrite:!1}),this.cone=new LineSegments2(_,this.material),this.add(this.cone),_=new LineGeometry,_.setPositions([0,0,0,0,0,1]),this.update(),this.traverse(b=>{b.userData.__keepShadowDef=!0,b.castShadow=!1,b.receiveShadow=!1})}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose(),super.dispose()}update(){var o;if(!this.light||!this.cone)return;this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1);const c=this.light.distance?this.light.distance:1e3,d=c*Math.tan(this.light.angle);this.cone.scale.set(d,d,c),this._v1.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(this._v1),this.material.color.set((o=this.color)!==null&&o!==void 0?o:this.light.color),this.material.linewidth=.001*this.lineWidth}static Check(o){return o.isSpotLight}static Create(o){return new SpotLightHelper2(o)}}SpotLightHelper2_decorate([x$1(SpotLightHelper2.prototype.update)],SpotLightHelper2.prototype,"material",void 0),SpotLightHelper2_decorate([x$1(SpotLightHelper2.prototype.update),uiSlider(void 0,[.1,20],.01)],SpotLightHelper2.prototype,"lineWidth",void 0);class ACameraHelperWidget extends AHelperWidget{constructor(o){super(o),this.camera=o,this.traverse(c=>{c.userData.__keepShadowDef=!0,c.castShadow=!1,c.receiveShadow=!1})}}class CameraHelper2 extends ACameraHelperWidget{constructor(o){super(o),this._vector=new three_module.Pq0,this._camera=new three_module.i7d;const c=new LineSegmentsGeometry,d=new LineMaterial({color:16777215,linewidth:.005,vertexColors:!0,dashed:!1,alphaToCoverage:!0,toneMapped:!1,transparent:!0,depthTest:!1,depthWrite:!1}),{vertices:_,colors:v,pointMap:b}=generateVertices();c.setPositions(_),c.setColors(v),this.line=new LineSegments2(c,d),this.line.frustumCulled=!1,this.add(this.line),this.pointMap=b,this.update();const tt=new three_module.Q1f(16755200),it=new three_module.Q1f(16711680),nt=new three_module.Q1f(43775),lt=new three_module.Q1f(16777215),ut=new three_module.Q1f(3355443);this.setColors(tt,it,nt,lt,ut)}setColors(o,c,d,_,v){const b=this.line.geometry,tt=b.getAttribute("instanceColorStart"),it=b.getAttribute("instanceColorEnd");function nt(lt,ut){tt.setXYZ(lt/2,ut.r,ut.g,ut.b),it.setXYZ(lt/2,ut.r,ut.g,ut.b)}nt(0,o),nt(2,o),nt(4,o),nt(6,o),nt(8,o),nt(10,o),nt(12,o),nt(14,o),nt(16,o),nt(18,o),nt(20,o),nt(22,o),nt(24,c),nt(26,c),nt(28,c),nt(30,c),nt(32,d),nt(34,d),nt(36,d),nt(38,_),nt(40,v),nt(42,v),nt(44,v),nt(46,v),nt(48,v),tt.needsUpdate=!0,it.needsUpdate=!0}update(){if(!this.camera)return;const o=this.line.geometry,c=this.pointMap,{_camera:d,_vector:_}=this;d.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),setPoint("c",c,o,d,0,0,-1,_),setPoint("t",c,o,d,0,0,1,_),setPoint("n1",c,o,d,-1,-1,-1,_),setPoint("n2",c,o,d,1,-1,-1,_),setPoint("n3",c,o,d,-1,1,-1,_),setPoint("n4",c,o,d,1,1,-1,_),setPoint("f1",c,o,d,-1,-1,1,_),setPoint("f2",c,o,d,1,-1,1,_),setPoint("f3",c,o,d,-1,1,1,_),setPoint("f4",c,o,d,1,1,1,_),setPoint("u1",c,o,d,.7,1.1,-1,_),setPoint("u2",c,o,d,-.7,1.1,-1,_),setPoint("u3",c,o,d,0,2,-1,_),setPoint("cf1",c,o,d,-1,0,1,_),setPoint("cf2",c,o,d,1,0,1,_),setPoint("cf3",c,o,d,0,-1,1,_),setPoint("cf4",c,o,d,0,1,1,_),setPoint("cn1",c,o,d,-1,0,-1,_),setPoint("cn2",c,o,d,1,0,-1,_),setPoint("cn3",c,o,d,0,-1,-1,_),setPoint("cn4",c,o,d,0,1,-1,_),o.getAttribute("instanceStart").needsUpdate=!0,o.getAttribute("instanceEnd").needsUpdate=!0,o.computeBoundingBox(),o.computeBoundingSphere()}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),super.dispose()}static Check(o){return o.isCamera}static Create(o){return new CameraHelper2(o)}}function setPoint(h,o,c,d,_,v,b,tt){tt.set(_,v,b).unproject(d);const it=o[h];if(it!==void 0){const nt=c.getAttribute("instanceStart"),lt=c.getAttribute("instanceEnd");for(let ut=0,ht=it.length;ut<ht;ut++){const _t=Math.floor(it[ut]/2);(it[ut]%2==0?nt:lt).setXYZ(_t,tt.x,tt.y,tt.z)}}}function generateVertices(){const h=[],o=[],c={};function d(v,b){_(v),_(b)}function _(v){h.push(0,0,0),o.push(0,0,0),c[v]===void 0&&(c[v]=[]),c[v].push(h.length/3-1)}return d("n1","n2"),d("n2","n4"),d("n4","n3"),d("n3","n1"),d("f1","f2"),d("f2","f4"),d("f4","f3"),d("f3","f1"),d("n1","f1"),d("n2","f2"),d("n3","f3"),d("n4","f4"),d("p","n1"),d("p","n2"),d("p","n3"),d("p","n4"),d("u1","u2"),d("u2","u3"),d("u3","u1"),d("c","t"),d("p","c"),d("cn1","cn2"),d("cn3","cn4"),d("cf1","cf2"),d("cf3","cf4"),{vertices:h,colors:o,pointMap:c}}var Object3DWidgetsPlugin_decorate=function(h,o,c,d){var _,v=arguments.length,b=v<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(h,o,c,d);else for(var tt=h.length-1;tt>=0;tt--)(_=h[tt])&&(b=(v<3?_(b):v>3?_(o,c,b):_(o,c))||b);return v>3&&b&&Object.defineProperty(o,c,b),b};class Object3DWidgetsPlugin extends AViewerPlugin{setDirty(){var o,c;(o=this.widgets)===null||o===void 0||o.forEach(d=>d.visible=this.enabled),(c=this._viewer)===null||c===void 0||c.setDirty()}constructor(o=!0){super(),this.enabled=!0,this.helpers=[DirectionalLightHelper2,SpotLightHelper2,PointLightHelper2,CameraHelper2],this.toJSON=null,this._addSceneObject=c=>{const d=c.object;this._createWidgets(d==null?void 0:d.modelObject)},this.widgets=[],this.uiConfig={type:"folder",label:"Widgets",children:[{type:"checkbox",label:"Visible",property:[this,"enabled"]},{type:"button",label:"Refresh",value:()=>this.refresh()}]},this.enabled=o}async onAdded(o){await super.onAdded(o),o.scene.addEventListener("addSceneObject",this._addSceneObject)}async onRemove(o){return o.scene.removeEventListener("addSceneObject",this._addSceneObject),this.widgets.forEach(c=>c.dispose&&c.dispose()),this.widgets=[],super.onRemove(o)}refresh(){var o;this._createWidgets((o=this._viewer)===null||o===void 0?void 0:o.scene.modelRoot)}_createWidgets(o){o==null||o.traverse(c=>{const d=this.widgets.find(_=>_.object===c);if(d)return void(d.update&&d.update());this.helpers.filter(_=>_.Check(c)).forEach(_=>{var v;const b=_.Create(c);b.visible=this.enabled,this.widgets.push(b),(v=this._viewer)===null||v===void 0||v.scene.addWidget(b)})})}}Object3DWidgetsPlugin.PluginType="WidgetsPlugin",Object3DWidgetsPlugin_decorate([x$1(Object3DWidgetsPlugin.prototype.setDirty)],Object3DWidgetsPlugin.prototype,"enabled",void 0);var popper_lite_defaultModifiers=[eventListeners,modifiers_popperOffsets,modifiers_computeStyles,modifiers_applyStyles],popper_lite_createPopper=popperGenerator({defaultModifiers:popper_lite_defaultModifiers}),object_hash=__webpackgi_require__(516),object_hash_default=__webpackgi_require__.n(object_hash);function removeDuplicateGeometries(h){const o=[];h.traverse(_=>{_.geometry&&o.push(_)});const c={},d={};o.forEach(_=>{var v;if(!c[_.geometry.uuid]){const it=_.geometry.toJSON().data,nt=it?object_hash_default()({a:it.attributes||{},b:it.index||[]}):"";c[_.geometry.uuid]=nt}const b=c[_.geometry.uuid],tt=(v=d[b])!==null&&v!==void 0?v:d[b]=[];tt.includes(_)||tt.push(_)}),Object.values(d).forEach(_=>{if(_.length<2)return;const v=_[0].geometry;_.forEach((b,tt)=>{tt<1||(b.geometry.dispose(),b.geometry=v)})})}const offset2=new three_module.Pq0,targetDeltaX=new three_module.Pq0,targetDeltaY=new three_module.Pq0,targetDeltaZ=new three_module.Pq0,targetDelta=new three_module.Pq0,panOffset2=new three_module.Pq0;let scaleOffset=1;const upVec=new three_module.Pq0(0,1,0);class OrbitControls2 extends OrbitControls{constructor(o,c){super(o,c),this.throttleUpdate=60,this.targetOffset=new three_module.Pq0(0,0,0);const d=this.update;this.update=()=>this._update(d)}_update(o){this.target.add(this.targetOffset),offset2.copy(this.object.position).sub(this.target),scaleOffset=offset2.length(),panOffset2.copy(this.target);const c=o();return panOffset2.sub(this.target),offset2.copy(this.object.position).sub(this.target),scaleOffset/=offset2.length(),this.target.add(panOffset2),this.object.position.copy(this.target).add(offset2),offset2.normalize(),targetDeltaX.crossVectors(upVec,offset2).normalize(),targetDeltaY.crossVectors(offset2,targetDeltaX).normalize(),targetDeltaZ.crossVectors(targetDeltaX,targetDeltaY).normalize().negate(),targetDeltaX.length()>.1&&this.object.up.crossVectors(offset2.clone().normalize(),targetDeltaX),this.enablePan&&(targetDelta.set(0,0,0).addScaledVector(targetDeltaX,panOffset2.x).addScaledVector(targetDeltaY,panOffset2.y).addScaledVector(targetDeltaZ,panOffset2.z),this.targetOffset.add(targetDelta),this.targetOffset.multiplyScalar(1/scaleOffset)),targetDelta.set(0,0,0).addScaledVector(targetDeltaX,-this.targetOffset.x).addScaledVector(targetDeltaY,-this.targetOffset.y).addScaledVector(targetDeltaZ,-this.targetOffset.z),this.object.lookAt(targetDelta.add(this.target)),this.object.updateMatrixWorld(),this.object.isCamera&&this.object.updateProjectionMatrix(),this.target.sub(this.targetOffset),c}}const _raycaster=new three_module.tBo,_tempVector=new three_module.Pq0,_tempVector2=new three_module.Pq0,_tempQuaternion=new three_module.PTz,_unit={X:new three_module.Pq0(1,0,0),Y:new three_module.Pq0(0,1,0),Z:new three_module.Pq0(0,0,1)},TransformControls_changeEvent={type:"change"},_mouseDownEvent={type:"mouseDown"},_mouseUpEvent={type:"mouseUp",mode:null},_objectChangeEvent={type:"objectChange"};class TransformControls extends three_module.B69{constructor(o,c){super(),c===void 0&&(console.warn('THREE.TransformControls: The second parameter "domElement" is now mandatory.'),c=document),this.isTransformControls=!0,this.visible=!1,this.domElement=c,this.domElement.style.touchAction="none";const d=new TransformControlsGizmo;this._gizmo=d,this.add(d);const _=new TransformControlsPlane;this._plane=_,this.add(_);const v=this;function b(St,wt){let Pt=wt;Object.defineProperty(v,St,{get:function(){return Pt!==void 0?Pt:wt},set:function(Rt){Pt!==Rt&&(Pt=Rt,_[St]=Rt,d[St]=Rt,v.dispatchEvent({type:St+"-changed",value:Rt}),v.dispatchEvent(TransformControls_changeEvent))}}),v[St]=wt,_[St]=wt,d[St]=wt}b("camera",o),b("object",void 0),b("enabled",!0),b("axis",null),b("mode","translate"),b("translationSnap",null),b("rotationSnap",null),b("scaleSnap",null),b("space","world"),b("size",1),b("dragging",!1),b("showX",!0),b("showY",!0),b("showZ",!0);const tt=new three_module.Pq0,it=new three_module.Pq0,nt=new three_module.PTz,lt=new three_module.PTz,ut=new three_module.Pq0,ht=new three_module.PTz,_t=new three_module.Pq0,ft=new three_module.Pq0,bt=new three_module.Pq0,xt=new three_module.Pq0;b("worldPosition",tt),b("worldPositionStart",it),b("worldQuaternion",nt),b("worldQuaternionStart",lt),b("cameraPosition",ut),b("cameraQuaternion",ht),b("pointStart",_t),b("pointEnd",ft),b("rotationAxis",bt),b("rotationAngle",0),b("eye",xt),this._offset=new three_module.Pq0,this._startNorm=new three_module.Pq0,this._endNorm=new three_module.Pq0,this._cameraScale=new three_module.Pq0,this._parentPosition=new three_module.Pq0,this._parentQuaternion=new three_module.PTz,this._parentQuaternionInv=new three_module.PTz,this._parentScale=new three_module.Pq0,this._worldScaleStart=new three_module.Pq0,this._worldQuaternionInv=new three_module.PTz,this._worldScale=new three_module.Pq0,this._positionStart=new three_module.Pq0,this._quaternionStart=new three_module.PTz,this._scaleStart=new three_module.Pq0,this._getPointer=getPointer.bind(this),this._onPointerDown=onPointerDown.bind(this),this._onPointerHover=onPointerHover.bind(this),this._onPointerMove=onPointerMove.bind(this),this._onPointerUp=onPointerUp.bind(this),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointermove",this._onPointerHover),this.domElement.addEventListener("pointerup",this._onPointerUp)}updateMatrixWorld(){this.object!==void 0&&(this.object.updateMatrixWorld(),this.object.parent===null?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):this.object.parent.matrixWorld.decompose(this._parentPosition,this._parentQuaternion,this._parentScale),this.object.matrixWorld.decompose(this.worldPosition,this.worldQuaternion,this._worldScale),this._parentQuaternionInv.copy(this._parentQuaternion).invert(),this._worldQuaternionInv.copy(this.worldQuaternion).invert()),this.camera.updateMatrixWorld(),this.camera.matrixWorld.decompose(this.cameraPosition,this.cameraQuaternion,this._cameraScale),this.camera.isOrthographicCamera?this.camera.getWorldDirection(this.eye).negate():this.eye.copy(this.cameraPosition).sub(this.worldPosition).normalize(),super.updateMatrixWorld(this)}pointerHover(o){if(this.object===void 0||this.dragging===!0||o.buttons)return;_raycaster.setFromCamera(o,this.camera);const c=intersectObjectWithRay(this._gizmo.picker[this.mode],_raycaster);this.axis=c?c.object.name:null}pointerDown(o){if(this.object!==void 0&&this.dragging!==!0&&o.button===0&&this.axis!==null){_raycaster.setFromCamera(o,this.camera);const c=intersectObjectWithRay(this._plane,_raycaster,!0);c&&(this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),this._positionStart.copy(this.object.position),this._quaternionStart.copy(this.object.quaternion),this._scaleStart.copy(this.object.scale),this.object.matrixWorld.decompose(this.worldPositionStart,this.worldQuaternionStart,this._worldScaleStart),this.pointStart.copy(c.point).sub(this.worldPositionStart)),this.dragging=!0,_mouseDownEvent.mode=this.mode,this.dispatchEvent(_mouseDownEvent)}}pointerMove(o){const c=this.axis,d=this.mode,_=this.object;let v=this.space;if(d==="scale"?v="local":c!=="E"&&c!=="XYZE"&&c!=="XYZ"||(v="world"),_===void 0||c===null||this.dragging===!1||o.button!==-1)return;_raycaster.setFromCamera(o,this.camera);const b=intersectObjectWithRay(this._plane,_raycaster,!0);if(b){if(this.pointEnd.copy(b.point).sub(this.worldPositionStart),d==="translate")this._offset.copy(this.pointEnd).sub(this.pointStart),v==="local"&&c!=="XYZ"&&this._offset.applyQuaternion(this._worldQuaternionInv),c.indexOf("X")===-1&&(this._offset.x=0),c.indexOf("Y")===-1&&(this._offset.y=0),c.indexOf("Z")===-1&&(this._offset.z=0),v==="local"&&c!=="XYZ"?this._offset.applyQuaternion(this._quaternionStart).divide(this._parentScale):this._offset.applyQuaternion(this._parentQuaternionInv).divide(this._parentScale),_.position.copy(this._offset).add(this._positionStart),this.translationSnap&&(v==="local"&&(_.position.applyQuaternion(_tempQuaternion.copy(this._quaternionStart).invert()),c.search("X")!==-1&&(_.position.x=Math.round(_.position.x/this.translationSnap)*this.translationSnap),c.search("Y")!==-1&&(_.position.y=Math.round(_.position.y/this.translationSnap)*this.translationSnap),c.search("Z")!==-1&&(_.position.z=Math.round(_.position.z/this.translationSnap)*this.translationSnap),_.position.applyQuaternion(this._quaternionStart)),v==="world"&&(_.parent&&_.position.add(_tempVector.setFromMatrixPosition(_.parent.matrixWorld)),c.search("X")!==-1&&(_.position.x=Math.round(_.position.x/this.translationSnap)*this.translationSnap),c.search("Y")!==-1&&(_.position.y=Math.round(_.position.y/this.translationSnap)*this.translationSnap),c.search("Z")!==-1&&(_.position.z=Math.round(_.position.z/this.translationSnap)*this.translationSnap),_.parent&&_.position.sub(_tempVector.setFromMatrixPosition(_.parent.matrixWorld))));else if(d==="scale"){if(c.search("XYZ")!==-1){let tt=this.pointEnd.length()/this.pointStart.length();this.pointEnd.dot(this.pointStart)<0&&(tt*=-1),_tempVector2.set(tt,tt,tt)}else _tempVector.copy(this.pointStart),_tempVector2.copy(this.pointEnd),_tempVector.applyQuaternion(this._worldQuaternionInv),_tempVector2.applyQuaternion(this._worldQuaternionInv),_tempVector2.divide(_tempVector),c.search("X")===-1&&(_tempVector2.x=1),c.search("Y")===-1&&(_tempVector2.y=1),c.search("Z")===-1&&(_tempVector2.z=1);_.scale.copy(this._scaleStart).multiply(_tempVector2),this.scaleSnap&&(c.search("X")!==-1&&(_.scale.x=Math.round(_.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),c.search("Y")!==-1&&(_.scale.y=Math.round(_.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),c.search("Z")!==-1&&(_.scale.z=Math.round(_.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if(d==="rotate"){this._offset.copy(this.pointEnd).sub(this.pointStart);const tt=20/this.worldPosition.distanceTo(_tempVector.setFromMatrixPosition(this.camera.matrixWorld));let it=!1;c==="XYZE"?(this.rotationAxis.copy(this._offset).cross(this.eye).normalize(),this.rotationAngle=this._offset.dot(_tempVector.copy(this.rotationAxis).cross(this.eye))*tt):c!=="X"&&c!=="Y"&&c!=="Z"||(this.rotationAxis.copy(_unit[c]),_tempVector.copy(_unit[c]),v==="local"&&_tempVector.applyQuaternion(this.worldQuaternion),_tempVector.cross(this.eye),_tempVector.length()===0?it=!0:this.rotationAngle=this._offset.dot(_tempVector.normalize())*tt),(c==="E"||it)&&(this.rotationAxis.copy(this.eye),this.rotationAngle=this.pointEnd.angleTo(this.pointStart),this._startNorm.copy(this.pointStart).normalize(),this._endNorm.copy(this.pointEnd).normalize(),this.rotationAngle*=this._endNorm.cross(this._startNorm).dot(this.eye)<0?1:-1),this.rotationSnap&&(this.rotationAngle=Math.round(this.rotationAngle/this.rotationSnap)*this.rotationSnap),v==="local"&&c!=="E"&&c!=="XYZE"?(_.quaternion.copy(this._quaternionStart),_.quaternion.multiply(_tempQuaternion.setFromAxisAngle(this.rotationAxis,this.rotationAngle)).normalize()):(this.rotationAxis.applyQuaternion(this._parentQuaternionInv),_.quaternion.copy(_tempQuaternion.setFromAxisAngle(this.rotationAxis,this.rotationAngle)),_.quaternion.multiply(this._quaternionStart).normalize())}this.dispatchEvent(TransformControls_changeEvent),this.dispatchEvent(_objectChangeEvent)}}pointerUp(o){o.button===0&&(this.dragging&&this.axis!==null&&(_mouseUpEvent.mode=this.mode,this.dispatchEvent(_mouseUpEvent)),this.dragging=!1,this.axis=null)}dispose(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerHover),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.traverse(function(o){o.geometry&&o.geometry.dispose(),o.material&&o.material.dispose()})}attach(o){return this.object=o,this.visible=!0,this}detach(){return this.object=void 0,this.visible=!1,this.axis=null,this}reset(){this.enabled&&this.dragging&&(this.object.position.copy(this._positionStart),this.object.quaternion.copy(this._quaternionStart),this.object.scale.copy(this._scaleStart),this.dispatchEvent(TransformControls_changeEvent),this.dispatchEvent(_objectChangeEvent),this.pointStart.copy(this.pointEnd))}getRaycaster(){return _raycaster}getMode(){return this.mode}setMode(o){this.mode=o}setTranslationSnap(o){this.translationSnap=o}setRotationSnap(o){this.rotationSnap=o}setScaleSnap(o){this.scaleSnap=o}setSize(o){this.size=o}setSpace(o){this.space=o}}function getPointer(h){if(this.domElement.ownerDocument.pointerLockElement)return{x:0,y:0,button:h.button,buttons:h.buttons};{const o=this.domElement.getBoundingClientRect();return{x:(h.clientX-o.left)/o.width*2-1,y:-(h.clientY-o.top)/o.height*2+1,button:h.button,buttons:h.buttons}}}function onPointerHover(h){if(this.enabled)switch(h.pointerType){case"mouse":case"pen":this.pointerHover(this._getPointer(h))}}function onPointerDown(h){this.enabled&&(document.pointerLockElement||this.domElement.setPointerCapture(h.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.pointerHover(this._getPointer(h)),this.pointerDown(this._getPointer(h)))}function onPointerMove(h){this.enabled&&this.pointerMove(this._getPointer(h))}function onPointerUp(h){this.enabled&&(this.domElement.releasePointerCapture(h.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.pointerUp(this._getPointer(h)))}function intersectObjectWithRay(h,o,c){const d=o.intersectObject(h,!0);for(let _=0;_<d.length;_++)if(d[_].object.visible||c)return d[_];return!1}TransformControls.ObjectConstructors={MeshBasicMaterial:three_module.V9B,LineBasicMaterial:three_module.mrM};const _tempEuler=new three_module.O9p,_alignVector=new three_module.Pq0(0,1,0),_zeroVector=new three_module.Pq0(0,0,0),_lookAtMatrix=new three_module.kn4,_tempQuaternion2=new three_module.PTz,_identityQuaternion=new three_module.PTz,_dirVector=new three_module.Pq0,_tempMatrix=new three_module.kn4,_unitX=new three_module.Pq0(1,0,0),_unitY=new three_module.Pq0(0,1,0),_unitZ=new three_module.Pq0(0,0,1),TransformControls_v1=new three_module.Pq0,TransformControls_v2=new three_module.Pq0,_v3=new three_module.Pq0;class TransformControlsGizmo extends three_module.B69{constructor(){super(),this.isTransformControlsGizmo=!0,this.type="TransformControlsGizmo";const o=new TransformControls.ObjectConstructors.MeshBasicMaterial({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),c=new TransformControls.ObjectConstructors.LineBasicMaterial({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),d=o.clone();d.opacity=.15;const _=c.clone();_.opacity=1;const v=o.clone();v.color.setHex(15663205),v.opacity=.95;const b=o.clone();b.color.setHex(2014720),b.opacity=.95;const tt=o.clone();tt.color.setHex(37885),tt.opacity=.95;const it=o.clone();it.color.setHex(16618689),it.__color=v.color.getHex();const nt=o.clone();nt.color.setHex(12516474),nt.__color=b.color.getHex();const lt=o.clone();lt.color.setHex(11397372),lt.__color=tt.color.getHex();const ut=o.clone();ut.color.setHex(15663205),ut.opacity=.75;const ht=o.clone();ht.color.setHex(2014720),ht.opacity=.75;const _t=o.clone();_t.color.setHex(37885),_t.opacity=.75;const ft=o.clone();ft.color.setHex(12893629),ft.opacity=.75;const bt=o.clone();bt.color.setHex(16777051),bt.opacity=.25;const xt=o.clone();xt.color.setHex(7895160),xt.opacity=.75;const St=new three_module.Ho_(0,.04,.1,12);St.translate(0,.05,0);const wt=new three_module.iNn(.08,.08,.08);wt.translate(0,.04,0);const Pt=new three_module.LoY;Pt.setAttribute("position",new three_module.qtW([0,0,0,1,0,0],3));const Rt=new three_module.Ho_(.0075,.0075,.5,3);function kt(pr,hr){const ur=new three_module.O3Y(pr,.0075,3,64,hr*Math.PI*2);return ur.rotateY(Math.PI/2),ur.rotateX(Math.PI/2),ur}function Gt(pr,hr){const ur=new three_module.O3Y(pr,.1,4,24,hr*Math.PI*2);return ur.rotateY(Math.PI/2),ur.rotateX(Math.PI/2),ur}Rt.translate(0,.25,0);const Dt={X:[[new three_module.eaF(St,it),[.5,0,0],[0,0,-Math.PI/2]],[new three_module.eaF(Rt,v),[0,0,0],[0,0,-Math.PI/2]]],Y:[[new three_module.eaF(St,nt),[0,.5,0]],[new three_module.eaF(Rt,b)]],Z:[[new three_module.eaF(St,lt),[0,0,.5],[Math.PI/2,0,0]],[new three_module.eaF(Rt,tt),null,[Math.PI/2,0,0]]],XYZ:[[new three_module.eaF(new three_module.Ufg(.1,2),ft.clone()),[0,0,0]]],XY:[[new three_module.eaF(new three_module.iNn(.2,.2,.01),_t.clone()),[.2,.2,0]]],YZ:[[new three_module.eaF(new three_module.iNn(.2,.2,.01),ut.clone()),[0,.2,.2],[0,Math.PI/2,0]]],XZ:[[new three_module.eaF(new three_module.iNn(.2,.2,.01),ht.clone()),[.2,0,.2],[-Math.PI/2,0,0]]]},It={X:[[new three_module.eaF(new three_module.Ho_(.2,0,.6,4),d),[.3,0,0],[0,0,-Math.PI/2]]],Y:[[new three_module.eaF(new three_module.Ho_(.2,0,.6,4),d),[0,.3,0]]],Z:[[new three_module.eaF(new three_module.Ho_(.2,0,.6,4),d),[0,0,.3],[Math.PI/2,0,0]]],XYZ:[[new three_module.eaF(new three_module.Ufg(.2,0),d)]],XY:[[new three_module.eaF(new three_module.iNn(.25,.25,.01),d),[.2,.2,0]]],YZ:[[new three_module.eaF(new three_module.iNn(.25,.25,.01),d),[0,.2,.2],[0,Math.PI/2,0]]],XZ:[[new three_module.eaF(new three_module.iNn(.25,.25,.01),d),[.2,0,.2],[-Math.PI/2,0,0]]]},Nt={START:[[new three_module.eaF(new three_module.Ufg(.01,2),_),null,null,null,"helper"]],END:[[new three_module.eaF(new three_module.Ufg(.01,2),_),null,null,null,"helper"]],DELTA:[[new three_module.N1A(function(){const pr=new three_module.LoY;return pr.setAttribute("position",new three_module.qtW([0,0,0,1,1,1],3)),pr}(),_),null,null,null,"helper"]],X:[[new three_module.N1A(Pt,_.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new three_module.N1A(Pt,_.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new three_module.N1A(Pt,_.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},Vt={XYZE:[[new three_module.eaF(new three_module.Gu$(.1,10,8),ft)],[new three_module.eaF(kt(.5,1),xt),null,[0,Math.PI/2,0]]],X:[[new three_module.eaF(kt(.5,.5),v)],[new three_module.eaF(Rt,v),[0,0,0],[0,0,-Math.PI/2]],[new three_module.eaF(St.clone().translate(.5,0,0),it),[0,0,0],[-Math.PI/2,-Math.PI/2,-Math.PI/2]]],Y:[[new three_module.eaF(kt(.5,.5),b),null,[0,0,-Math.PI/2]],[new three_module.eaF(Rt,b)],[new three_module.eaF(St.clone().rotateZ(-Math.PI/2).translate(0,.5,0),nt),[0,0,0],[Math.PI/2,0,0]]],Z:[[new three_module.eaF(kt(.5,.5),tt),null,[0,Math.PI/2,0]],[new three_module.eaF(Rt,tt),null,[Math.PI/2,0,0]],[new three_module.eaF(St.clone().rotateZ(-Math.PI).translate(0,0,.5),lt),[0,0,0],[0,Math.PI/2,0]]]},Kt={AXIS:[[new three_module.N1A(Pt,_.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},Yt={XYZE:[[new three_module.eaF(new three_module.Gu$(.25,10,8),d)]],X:[[new three_module.eaF(Gt(.5,.5),d)]],Y:[[new three_module.eaF(Gt(.5,.5),d),[0,0,0],[0,0,-Math.PI/2]]],Z:[[new three_module.eaF(Gt(.5,.5),d),[0,0,0],[0,Math.PI/2,0]]]},nr={X:[[new three_module.eaF(wt,it),[.5,0,0],[0,0,-Math.PI/2]],[new three_module.eaF(Rt,v),[0,0,0],[0,0,-Math.PI/2]]],Y:[[new three_module.eaF(wt,nt),[0,.5,0]],[new three_module.eaF(Rt,b)]],Z:[[new three_module.eaF(wt,lt),[0,0,.5],[Math.PI/2,0,0]],[new three_module.eaF(Rt,tt),[0,0,0],[Math.PI/2,0,0]]],XY:[[new three_module.eaF(new three_module.iNn(.15,.15,.01),_t),[.15,.15,0]]],YZ:[[new three_module.eaF(new three_module.iNn(.15,.15,.01),ut),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new three_module.eaF(new three_module.iNn(.15,.15,.01),ht),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new three_module.eaF(new three_module.iNn(.1,.1,.1),ft.clone())]]},rr={X:[[new three_module.eaF(new three_module.Ho_(.2,0,.6,4),d),[.3,0,0],[0,0,-Math.PI/2]],[new three_module.eaF(new three_module.Ho_(.2,0,.6,4),d),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new three_module.eaF(new three_module.Ho_(.2,0,.6,4),d),[0,.3,0]],[new three_module.eaF(new three_module.Ho_(.2,0,.6,4),d),[0,-.3,0],[0,0,Math.PI]]],Z:[[new three_module.eaF(new three_module.Ho_(.2,0,.6,4),d),[0,0,.3],[Math.PI/2,0,0]],[new three_module.eaF(new three_module.Ho_(.2,0,.6,4),d),[0,0,-.3],[-Math.PI/2,0,0]]],XY:[[new three_module.eaF(new three_module.iNn(.2,.2,.01),d),[.15,.15,0]]],YZ:[[new three_module.eaF(new three_module.iNn(.2,.2,.01),d),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new three_module.eaF(new three_module.iNn(.2,.2,.01),d),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new three_module.eaF(new three_module.iNn(.2,.2,.2),d),[0,0,0]]]},lr={X:[[new three_module.N1A(Pt,_.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new three_module.N1A(Pt,_.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new three_module.N1A(Pt,_.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]};function or(pr){const hr=new three_module.B69;for(const ur in pr)for(let cr=pr[ur].length;cr--;){const br=pr[ur][cr][0].clone(),fr=pr[ur][cr][1],kr=pr[ur][cr][2],gr=pr[ur][cr][3],tr=pr[ur][cr][4];br.name=ur,br.tag=tr,fr&&br.position.set(fr[0],fr[1],fr[2]),kr&&br.rotation.set(kr[0],kr[1],kr[2]),gr&&br.scale.set(gr[0],gr[1],gr[2]),br.updateMatrix();const dr=br.geometry.clone();dr.applyMatrix4(br.matrix),br.geometry=dr,br.renderOrder=1/0,br.position.set(0,0,0),br.rotation.set(0,0,0),br.scale.set(1,1,1),hr.add(br)}return hr}this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=or(Dt)),this.add(this.gizmo.rotate=or(Vt)),this.add(this.gizmo.scale=or(nr)),this.add(this.picker.translate=or(It)),this.add(this.picker.rotate=or(Yt)),this.add(this.picker.scale=or(rr)),this.add(this.helper.translate=or(Nt)),this.add(this.helper.rotate=or(Kt)),this.add(this.helper.scale=or(lr)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1}updateMatrixWorld(o){const c=(this.mode==="scale"?"local":this.space)==="local"?this.worldQuaternion:_identityQuaternion;this.gizmo.translate.visible=this.mode==="translate",this.gizmo.rotate.visible=this.mode==="rotate",this.gizmo.scale.visible=this.mode==="scale",this.helper.translate.visible=this.mode==="translate",this.helper.rotate.visible=this.mode==="rotate",this.helper.scale.visible=this.mode==="scale";let d=[];d=d.concat(this.picker[this.mode].children),d=d.concat(this.gizmo[this.mode].children),d=d.concat(this.helper[this.mode].children);for(let _=0;_<d.length;_++){const v=d[_];let b;v.visible=!0,v.rotation.set(0,0,0),v.position.copy(this.worldPosition),b=this.camera.isOrthographicCamera?(this.camera.top-this.camera.bottom)/this.camera.zoom:this.worldPosition.distanceTo(this.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),v.scale.set(1,1,1).multiplyScalar(b*this.size/4),v.tag!=="helper"?(v.quaternion.copy(c),this.mode==="translate"||this.mode==="scale"?(v.name==="X"&&Math.abs(_alignVector.copy(_unitX).applyQuaternion(c).dot(this.eye))>.99&&(v.scale.set(1e-10,1e-10,1e-10),v.visible=!1),v.name==="Y"&&Math.abs(_alignVector.copy(_unitY).applyQuaternion(c).dot(this.eye))>.99&&(v.scale.set(1e-10,1e-10,1e-10),v.visible=!1),v.name==="Z"&&Math.abs(_alignVector.copy(_unitZ).applyQuaternion(c).dot(this.eye))>.99&&(v.scale.set(1e-10,1e-10,1e-10),v.visible=!1),v.name==="XY"&&Math.abs(_alignVector.copy(_unitZ).applyQuaternion(c).dot(this.eye))<.2&&(v.scale.set(1e-10,1e-10,1e-10),v.visible=!1),v.name==="YZ"&&Math.abs(_alignVector.copy(_unitX).applyQuaternion(c).dot(this.eye))<.2&&(v.scale.set(1e-10,1e-10,1e-10),v.visible=!1),v.name==="XZ"&&Math.abs(_alignVector.copy(_unitY).applyQuaternion(c).dot(this.eye))<.2&&(v.scale.set(1e-10,1e-10,1e-10),v.visible=!1)):this.mode==="rotate"&&(_tempQuaternion2.copy(c),_alignVector.copy(this.eye).applyQuaternion(_tempQuaternion.copy(c).invert()),v.name.search("E")!==-1&&v.quaternion.setFromRotationMatrix(_lookAtMatrix.lookAt(this.eye,_zeroVector,_unitY)),v.name==="X"&&(_tempQuaternion.setFromAxisAngle(_unitX,Math.atan2(-_alignVector.y,_alignVector.z)),_tempQuaternion.multiplyQuaternions(_tempQuaternion2,_tempQuaternion),v.quaternion.copy(_tempQuaternion)),v.name==="Y"&&(_tempQuaternion.setFromAxisAngle(_unitY,Math.atan2(_alignVector.x,_alignVector.z)),_tempQuaternion.multiplyQuaternions(_tempQuaternion2,_tempQuaternion),v.quaternion.copy(_tempQuaternion)),v.name==="Z"&&(_tempQuaternion.setFromAxisAngle(_unitZ,Math.atan2(_alignVector.y,_alignVector.x)),_tempQuaternion.multiplyQuaternions(_tempQuaternion2,_tempQuaternion),v.quaternion.copy(_tempQuaternion))),v.visible=v.visible&&(v.name.indexOf("X")===-1||this.showX),v.visible=v.visible&&(v.name.indexOf("Y")===-1||this.showY),v.visible=v.visible&&(v.name.indexOf("Z")===-1||this.showZ),v.visible=v.visible&&(v.name.indexOf("E")===-1||this.showX&&this.showY&&this.showZ),v.material._color=v.material._color||v.material.color.clone(),v.material._opacity=v.material._opacity||v.material.opacity,v.material.color.copy(v.material._color),v.material.opacity=v.material._opacity,this.enabled&&this.axis&&(v.name===this.axis||this.axis.split("").some(function(tt){return v.name===tt}))&&(v.material.__color&&v.material.color.setHex(v.material.__color),v.material.opacity=1)):(v.visible=!1,v.name==="AXIS"?(v.visible=!!this.axis,this.axis==="X"&&(_tempQuaternion.setFromEuler(_tempEuler.set(0,0,0)),v.quaternion.copy(c).multiply(_tempQuaternion),Math.abs(_alignVector.copy(_unitX).applyQuaternion(c).dot(this.eye))>.9&&(v.visible=!1)),this.axis==="Y"&&(_tempQuaternion.setFromEuler(_tempEuler.set(0,0,Math.PI/2)),v.quaternion.copy(c).multiply(_tempQuaternion),Math.abs(_alignVector.copy(_unitY).applyQuaternion(c).dot(this.eye))>.9&&(v.visible=!1)),this.axis==="Z"&&(_tempQuaternion.setFromEuler(_tempEuler.set(0,Math.PI/2,0)),v.quaternion.copy(c).multiply(_tempQuaternion),Math.abs(_alignVector.copy(_unitZ).applyQuaternion(c).dot(this.eye))>.9&&(v.visible=!1)),this.axis==="XYZE"&&(_tempQuaternion.setFromEuler(_tempEuler.set(0,Math.PI/2,0)),_alignVector.copy(this.rotationAxis),v.quaternion.setFromRotationMatrix(_lookAtMatrix.lookAt(_zeroVector,_alignVector,_unitY)),v.quaternion.multiply(_tempQuaternion),v.visible=this.dragging),this.axis==="E"&&(v.visible=!1)):v.name==="START"?(v.position.copy(this.worldPositionStart),v.visible=this.dragging):v.name==="END"?(v.position.copy(this.worldPosition),v.visible=this.dragging):v.name==="DELTA"?(v.position.copy(this.worldPositionStart),v.quaternion.copy(this.worldQuaternionStart),_tempVector.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),_tempVector.applyQuaternion(this.worldQuaternionStart.clone().invert()),v.scale.copy(_tempVector),v.visible=this.dragging):(v.quaternion.copy(c),this.dragging?v.position.copy(this.worldPositionStart):v.position.copy(this.worldPosition),this.axis&&(v.visible=this.axis.search(v.name)!==-1)))}super.updateMatrixWorld(o)}}class TransformControlsPlane extends three_module.eaF{constructor(){super(new three_module.bdM(1e5,1e5,2,2),new TransformControls.ObjectConstructors.MeshBasicMaterial({visible:!1,wireframe:!0,side:three_module.$EB,transparent:!0,opacity:.1,toneMapped:!1})),this.isTransformControlsPlane=!0,this.type="TransformControlsPlane"}updateMatrixWorld(o){let c=this.space;switch(this.position.copy(this.worldPosition),this.mode==="scale"&&(c="local"),TransformControls_v1.copy(_unitX).applyQuaternion(c==="local"?this.worldQuaternion:_identityQuaternion),TransformControls_v2.copy(_unitY).applyQuaternion(c==="local"?this.worldQuaternion:_identityQuaternion),_v3.copy(_unitZ).applyQuaternion(c==="local"?this.worldQuaternion:_identityQuaternion),_alignVector.copy(TransformControls_v2),this.mode){case"translate":case"scale":switch(this.axis){case"X":_alignVector.copy(this.eye).cross(TransformControls_v1),_dirVector.copy(TransformControls_v1).cross(_alignVector);break;case"Y":_alignVector.copy(this.eye).cross(TransformControls_v2),_dirVector.copy(TransformControls_v2).cross(_alignVector);break;case"Z":_alignVector.copy(this.eye).cross(_v3),_dirVector.copy(_v3).cross(_alignVector);break;case"XY":_dirVector.copy(_v3);break;case"YZ":_dirVector.copy(TransformControls_v1);break;case"XZ":_alignVector.copy(_v3),_dirVector.copy(TransformControls_v2);break;case"XYZ":case"E":_dirVector.set(0,0,0)}break;default:_dirVector.set(0,0,0)}_dirVector.length()===0?this.quaternion.copy(this.cameraQuaternion):(_tempMatrix.lookAt(_tempVector.set(0,0,0),_dirVector,_alignVector),this.quaternion.setFromRotationMatrix(_tempMatrix)),super.updateMatrixWorld(o)}}var TransformControls2_decorate=function(h,o,c,d){var _,v=arguments.length,b=v<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(h,o,c,d);else for(var tt=h.length-1;tt>=0;tt--)(_=h[tt])&&(b=(v<3?_(b):v>3?_(o,c,b):_(o,c))||b);return v>3&&b&&Object.defineProperty(o,c,b),b};let TransformControls2=class extends TransformControls{setDirty(h){this.dispatchEvent({...h,type:"objectUpdate",object:this})}refreshUi(){var h,o;(o=(h=this.uiConfig)===null||h===void 0?void 0:h.uiRefresh)===null||o===void 0||o.call(h,"postFrame",!0,1)}_keyDownListener(h){if(this.enabled&&this.object&&!h.metaKey&&!h.ctrlKey){switch(h.code){case"KeyQ":this.space=this.space==="local"?"world":"local";break;case"ShiftLeft":this.translationSnap=.5,this.rotationSnap=three_module.cj9.degToRad(15),this.scaleSnap=.25;break;case"KeyW":this.mode="translate";break;case"KeyE":this.mode="rotate";break;case"KeyR":this.mode="scale";break;case"Equal":case"NumpadAdd":case"Plus":this.size=this.size+.1;break;case"Minus":case"NumpadSubtract":case"Underscore":this.size=Math.max(this.size-.1,.1);break;case"KeyX":this.showX=!this.showX;break;case"KeyY":this.showY=!this.showY;break;case"KeyZ":this.showZ=!this.showZ;break;case"Space":this.enabled=!this.enabled;break;default:return}this.setDirty({refreshScene:!0,frameFade:!0})}}_keyUpListener(h){this.enabled&&(h.code==="ShiftLeft"&&(this.translationSnap=null,this.rotationSnap=null,this.scaleSnap=null),this.object&&h.code)}constructor(h,o){super(h,o),this.isWidget=!0,setupIModel(this),this.visible=!1,this.userData.bboxVisible=!1,this.size=2,this.addEventListener("objectChange",()=>{var c;(c=this.object)===null||c===void 0||c.setDirty({fadeFrame:!1})}),this.addEventListener("change",()=>{this.setDirty({fadeFrame:!1})}),this._keyUpListener=this._keyUpListener.bind(this),this._keyDownListener=this._keyDownListener.bind(this),window.addEventListener("keydown",this._keyDownListener),window.addEventListener("keyup",this._keyUpListener)}dispose(){window.removeEventListener("keydown",this._keyDownListener),window.removeEventListener("keyup",this._keyUpListener),super.dispose()}get modelObject(){return this}};TransformControls2_decorate([uiDropdown("Mode",["translate","rotate","scale"].map(h=>({label:h})))],TransformControls2.prototype,"mode",void 0),TransformControls2_decorate([uiDropdown("Space",["world","local"].map(h=>({label:h})))],TransformControls2.prototype,"space",void 0),TransformControls2_decorate([uiSlider("Size",[.1,10],.1)],TransformControls2.prototype,"size",void 0),TransformControls2_decorate([uiToggle("Show X")],TransformControls2.prototype,"showX",void 0),TransformControls2_decorate([uiToggle("Show Y")],TransformControls2.prototype,"showY",void 0),TransformControls2_decorate([uiToggle("Show Z")],TransformControls2.prototype,"showZ",void 0),TransformControls2=TransformControls2_decorate([uiFolder("Transform Controls")],TransformControls2);class CanvasRecorder extends I$2{_setOptions(o){var c,d;Object.assign(this._options,o),this._options.mimeType&&this._options.mimeType!=="auto"||(this._options.mimeType=(c=CanvasRecorder.GetSupportedMimeTypes([],["h264"],!0))!==null&&c!==void 0?c:CanvasRecorder.GetSupportedMimeTypes(void 0,void 0,!0)),this._options.mimeType&&!(!((d=this._options.mimeType)===null||d===void 0)&&d.startsWith("video/"))||window.MediaRecorder||(this._console.warn("MediaRecorder is not supported, switching to png"),this._options.mimeType="image/png"),this._options.mimeType||console.warn(new Error("No supported mimetype found"))}setOptions(o){this._setOptions(o)}constructor(o,c){super(),this._state="stopped",this._console=console,this._currentRecording=[],this._currentImages=[],this.stepMode=!1,this._resumeSyncTime=0,this._frameCount=0,this._onstop=_=>{var v;if(this._state="stopped",this._recorder&&this._currentRecording.length>0){const b=new Blob(this._currentRecording,{type:this._options.mimeType});(v=this._recordingCallback)===null||v===void 0||v.call(this,b)}else this._currentImages.length>0&&(this._writeImages([...this._currentImages]),this._currentImages=[]);this._recorder=void 0,this.dispatchEvent({type:"stop"})},this._onstart=_=>{var v;this._state="recording",this._frameCount=0,this.dispatchEvent({type:"start"}),this.stepMode&&((v=this._recorder)===null||v===void 0||v.pause())},this._onresume=_=>{if(!this.stepMode)return;const v=()=>{var tt;this._state==="recording"&&((tt=this._recorder)===null||tt===void 0||tt.pause())},b=Math.min(this._resumeSyncTime-g(),0)+1e3/this._options.frameRate;b>0?X$2(b).then(v):v()},this._onpause=_=>{},this._ondataavailable=_=>{_.data&&_.data.size>0&&this._currentRecording.push(_.data)},this._onerror=_=>{this._state="error",this._console.error(_),this.dispatchEvent({type:"error",error:_}),this._recorder=void 0},this._canvas=o;const d=c==null?void 0:c.mimeType;this._options={mimeType:d||"auto",frameRate:30,stepMode:!1},this._setOptions(c||this._options)}isRecording(){return this._state==="recording"}start(){var o,c,d;if(this._state==="recording")return void this._console.log("Already recording canvas");if(this._state==="error"&&(this._recorder=void 0,this._console.warn("Resetting from error state.")),this._recorder)return this._state==="paused"?(this.dispatchEvent({type:"starting"}),void this._recorder.resume()):void this._console.warn("Canvas recorder unknown state",this._state);if(this._state==="paused")return this.dispatchEvent({type:"starting"}),void(this._state="recording");const _={mimeType:this._options.mimeType,videoBitsPerSecond:this._options.videoBitsPerSecond};if(this._currentRecording=[],this._currentImages=[],this._frameCount=0,(o=_.mimeType)===null||o===void 0?void 0:o.startsWith("video")){if(!window.MediaRecorder)return this._console.error("MediaRecorder not supported, use image sequence"),void(this._state="error");{const v=this._canvas.captureStream(this.stepMode?0:this._options.frameRate),b=(c=v.getVideoTracks())===null||c===void 0?void 0:c[0];this._track=b,this._recorder=new window.MediaRecorder(v,_),this._recorder.onstop=this._onstop,this._recorder.ondataavailable=this._ondataavailable,this._recorder.onerror=this._onerror,this._recorder.onresume=this._onresume,this._recorder.onstart=this._onstart}}this.dispatchEvent({type:"starting"}),this._recorder?(this._state="recording",(d=this._recorder)===null||d===void 0||d.start()):window&&window.showDirectoryPicker&&window.showDirectoryPicker().then(async v=>{const b=await(v==null?void 0:v.getDirectoryHandle("i-"+Math.floor(Date.now()),{create:!0}));this._imgDirectory=b,this._state="recording",this._onstart({})}).catch(v=>{this._onerror({detail:v})})}async requestFrame(){if(this._state!=="recording")return;this._frameCount++;const o=this._options.mimeType;if(!this._recorder&&o.startsWith("image/")){const c=this._canvas.toDataURL(o,90);this._currentImages.push(["frame_"+String(this._frameCount).padStart(5,"0")+(o.includes("png")?".png":".jpg"),c]),this._currentImages.length>60&&(this._writeImages([...this._currentImages]),this._currentImages=[])}this._recorder&&this._track&&this.stepMode&&(this._resumeSyncTime=g(),this._track.requestFrame(),this._recorder.resume())}pause(){this._state!=="paused"&&this._state!=="stopped"&&(this._recorder?this._recorder.pause():this._state="paused")}stop(o){this._state!=="stopped"&&(this._state!=="error"?(this._recordingCallback=o,this.dispatchEvent({type:"stopping"}),this._recorder?this._recorder.stop():this._onstop({})):this._console.error("Recorder in error state, cannot stop, call start again."))}get state(){return this._state}dispose(){this._recorder&&this._state!=="error"?this.stop(o=>{this._console.warn("disposed with blob",o),this.dispose()}):this._recorder=void 0}async _writeImages(o){if(!this._imgDirectory)return;const c=await Promise.all(o.map(async([_,v])=>await(await fetch(v)).blob())),d=[];for(let _=0;_<o.length;_++){const v=await this._imgDirectory.getFileHandle(o[_][0],{create:!0});d.push($e$1(v,c[_]))}await Promise.all(d)}static GetSupportedMimeTypes(o,c,d=!1){if(!window.MediaRecorder)return d?void 0:[];const _=["webm","ogg","mp4","x-matroska"].filter(tt=>!o||o.length<1||o.includes(tt)),v=["vp9","vp9.0","vp8","vp8.0","avc1","av1","h265","h.265","h264","h.264","opus"].filter(tt=>!c||c.length<1||c.includes(tt)),b=[];return _.forEach(tt=>{const it=`video/${tt}`;v.forEach(nt=>{[`${it};codecs=${nt}`,`${it};codecs:${nt}`,`${it};codecs=${nt.toUpperCase()}`,`${it};codecs:${nt.toUpperCase()}`,`${it}`].forEach(lt=>{MediaRecorder.isTypeSupported(lt)&&b.push(lt)})})}),d?b.length>0?b[0]:void 0:b}}class SphereSelectionWidget extends SelectionWidget{constructor(){super(),this.boundingScaleMultiplier=1.2,this._initGeometry(new three_module.WBB(1,0))}}function deepAccessObject(h,o,c=!1){for(typeof h=="string"&&(h=h.split("."));h.length>0;){if(!o)return o;const d=h.splice(0,1)[0];if(!(d.length<1))if(Array.isArray(o))o=o[parseInt(d)];else{if(typeof o!="object"||!(d in o)){if(c)throw new Error("invalid access, check "+d+" in "+o);return}o=o[d]}}return o}function extractAnimationKey(h,o,c){var d,_;let v=Array.from(((d=h.access)!==null&&d!==void 0?d:"").split(".")),b=(_=h.targetObject)!==null&&_!==void 0?_:o;const tt=v.pop();if(!tt||tt.length===0)return{key:void 0,tar:b};if((c=c??(o==null?void 0:o._animGetters))&&v[0]in c){const it=c[v[0]](v);it?(b=it.tar,v=v.slice(it.i+1)):b=it}return b=deepAccessObject(v,b),b&&!(tt in b)?(console.error("invalid key",tt,b,o,h),{key:void 0,tar:b}):{key:tt,tar:b}}async function animateObject(h,o,c){var d,_,v,b;const{key:tt,tar:it}=extractAnimationKey(o,h),nt=o.animSet?[animateSet(h,o.animSet,c,(d=o.animSetParallel)!==null&&d!==void 0&&d)]:[];if(tt&&it){const lt=(b=o.updater)!==null&&b!==void 0?b:[],ut=async()=>animateTarget$1(it,tt,{from:o.from,to:o.to,ease:typeof o.ease=="string"?EasingFunctions[o.ease]:o.ease,duration:o.duration,...o.options,onUpdate:ht=>{var _t,ft;(ft=(_t=o.options).onUpdate)===null||ft===void 0||ft.call(_t,ht),lt.forEach(bt=>{var xt;return(xt=c[bt])===null||xt===void 0?void 0:xt.call(c)})}},void 0,!1);o.delay?nt.push(X$2(o.delay).then(ut)):nt.push(ut())}else(o.duration||o.delay)&&nt.push(X$2(((_=o.delay)!==null&&_!==void 0?_:0)+((v=o.duration)!==null&&v!==void 0?v:0)));return nt.length===1?nt[0]:Promise.all(nt)}async function animationObject_animate(h,o,c){return typeof o.animate=="function"?o.animate():animateObject(h,o,c)}async function animateSet(h,o,c,d=!1){if(d)return Promise.all(o.map(async _=>animationObject_animate(h,_,c)));for(const _ of o)await animationObject_animate(h,_,c)}const encoder=new TextEncoder,HOST_SERVICES={appstream2:"appstream",cloudhsmv2:"cloudhsm",email:"ses",marketplace:"aws-marketplace",mobile:"AWSMobileHubService",pinpoint:"mobiletargeting",queue:"sqs","git-codecommit":"codecommit","mturk-requester-sandbox":"mturk-requester","personalize-runtime":"personalize"},UNSIGNABLE_HEADERS=new Set(["authorization","content-type","content-length","user-agent","presigned-expires","expect","x-amzn-trace-id","range","connection"]);class AwsClient{constructor({accessKeyId:o,secretAccessKey:c,sessionToken:d,service:_,region:v,cache:b,retries:tt,initRetryMs:it}){if(o==null)throw new TypeError("accessKeyId is a required option");if(c==null)throw new TypeError("secretAccessKey is a required option");this.accessKeyId=o,this.secretAccessKey=c,this.sessionToken=d,this.service=_,this.region=v,this.cache=b||new Map,this.retries=tt??10,this.initRetryMs=it||50}async sign(o,c){if(o instanceof Request){const{method:v,url:b,headers:tt,body:it}=o;(c=Object.assign({method:v,url:b,headers:tt},c)).body==null&&tt.has("Content-Type")&&(c.body=it!=null&&tt.has("X-Amz-Content-Sha256")?it:await o.clone().arrayBuffer()),o=b}const d=new AwsV4Signer(Object.assign({url:o.toString()},c,this,c&&c.aws)),_=Object.assign({},c,await d.sign());delete _.aws;try{return new Request(_.url.toString(),_)}catch(v){if(v instanceof TypeError)return new Request(_.url.toString(),Object.assign({duplex:"half"},_));throw v}}async fetch(o,c){for(let d=0;d<=this.retries;d++){const _=fetch(await this.sign(o,c));if(d===this.retries)return _;const v=await _;if(v.status<500&&v.status!==429)return v;await new Promise(b=>setTimeout(b,Math.random()*this.initRetryMs*Math.pow(2,d)))}throw new Error("An unknown error occurred, ensure retries is not negative")}}class AwsV4Signer{constructor({method:o,url:c,headers:d,body:_,accessKeyId:v,secretAccessKey:b,sessionToken:tt,service:it,region:nt,cache:lt,datetime:ut,signQuery:ht,appendSessionToken:_t,allHeaders:ft,singleEncode:bt}){if(c==null)throw new TypeError("url is a required option");if(v==null)throw new TypeError("accessKeyId is a required option");if(b==null)throw new TypeError("secretAccessKey is a required option");let xt,St;this.method=o||(_?"POST":"GET"),this.url=new URL(c),this.headers=new Headers(d||{}),this.body=_,this.accessKeyId=v,this.secretAccessKey=b,this.sessionToken=tt,it&&nt||([xt,St]=guessServiceRegion(this.url,this.headers)),this.service=it||xt||"",this.region=nt||St||"us-east-1",this.cache=lt||new Map,this.datetime=ut||new Date().toISOString().replace(/[:-]|\.\d{3}/g,""),this.signQuery=ht,this.appendSessionToken=_t||this.service==="iotdevicegateway",this.headers.delete("Host"),this.service!=="s3"||this.signQuery||this.headers.has("X-Amz-Content-Sha256")||this.headers.set("X-Amz-Content-Sha256","UNSIGNED-PAYLOAD");const wt=this.signQuery?this.url.searchParams:this.headers;if(wt.set("X-Amz-Date",this.datetime),this.sessionToken&&!this.appendSessionToken&&wt.set("X-Amz-Security-Token",this.sessionToken),this.signableHeaders=["host",...this.headers.keys()].filter(Rt=>ft||!UNSIGNABLE_HEADERS.has(Rt)).sort(),this.signedHeaders=this.signableHeaders.join(";"),this.canonicalHeaders=this.signableHeaders.map(Rt=>Rt+":"+(Rt==="host"?this.url.host:(this.headers.get(Rt)||"").replace(/\s+/g," "))).join(`
`),this.credentialString=[this.datetime.slice(0,8),this.region,this.service,"aws4_request"].join("/"),this.signQuery&&(this.service!=="s3"||wt.has("X-Amz-Expires")||wt.set("X-Amz-Expires","86400"),wt.set("X-Amz-Algorithm","AWS4-HMAC-SHA256"),wt.set("X-Amz-Credential",this.accessKeyId+"/"+this.credentialString),wt.set("X-Amz-SignedHeaders",this.signedHeaders)),this.service==="s3")try{this.encodedPath=decodeURIComponent(this.url.pathname.replace(/\+/g," "))}catch{this.encodedPath=this.url.pathname}else this.encodedPath=this.url.pathname.replace(/\/+/g,"/");bt||(this.encodedPath=encodeURIComponent(this.encodedPath).replace(/%2F/g,"/")),this.encodedPath=encodeRfc3986(this.encodedPath);const Pt=new Set;this.encodedSearch=[...this.url.searchParams].filter(([Rt])=>{if(!Rt)return!1;if(this.service==="s3"){if(Pt.has(Rt))return!1;Pt.add(Rt)}return!0}).map(Rt=>Rt.map(kt=>encodeRfc3986(encodeURIComponent(kt)))).sort(([Rt,kt],[Gt,Dt])=>Rt<Gt?-1:Rt>Gt?1:kt<Dt?-1:kt>Dt?1:0).map(Rt=>Rt.join("=")).join("&")}async sign(){return this.signQuery?(this.url.searchParams.set("X-Amz-Signature",await this.signature()),this.sessionToken&&this.appendSessionToken&&this.url.searchParams.set("X-Amz-Security-Token",this.sessionToken)):this.headers.set("Authorization",await this.authHeader()),{method:this.method,url:this.url,headers:this.headers,body:this.body}}async authHeader(){return["AWS4-HMAC-SHA256 Credential="+this.accessKeyId+"/"+this.credentialString,"SignedHeaders="+this.signedHeaders,"Signature="+await this.signature()].join(", ")}async signature(){const o=this.datetime.slice(0,8),c=[this.secretAccessKey,o,this.region,this.service].join();let d=this.cache.get(c);if(!d){const _=await hmac("AWS4"+this.secretAccessKey,o),v=await hmac(_,this.region),b=await hmac(v,this.service);d=await hmac(b,"aws4_request"),this.cache.set(c,d)}return buf2hex(await hmac(d,await this.stringToSign()))}async stringToSign(){return["AWS4-HMAC-SHA256",this.datetime,this.credentialString,buf2hex(await aws4fetch_esm_hash(await this.canonicalString()))].join(`
`)}async canonicalString(){return[this.method.toUpperCase(),this.encodedPath,this.encodedSearch,this.canonicalHeaders+`
`,this.signedHeaders,await this.hexBodyHash()].join(`
`)}async hexBodyHash(){let o=this.headers.get("X-Amz-Content-Sha256")||(this.service==="s3"&&this.signQuery?"UNSIGNED-PAYLOAD":null);if(o==null){if(this.body&&typeof this.body!="string"&&!("byteLength"in this.body))throw new Error("body must be a string, ArrayBuffer or ArrayBufferView, unless you include the X-Amz-Content-Sha256 header");o=buf2hex(await aws4fetch_esm_hash(this.body||""))}return o}}async function hmac(h,o){const c=await crypto.subtle.importKey("raw",typeof h=="string"?encoder.encode(h):h,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]);return crypto.subtle.sign("HMAC",c,encoder.encode(o))}async function aws4fetch_esm_hash(h){return crypto.subtle.digest("SHA-256",typeof h=="string"?encoder.encode(h):h)}const HEX_CHARS=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function buf2hex(h){const o=new Uint8Array(h);let c="";for(let d=0;d<o.length;d++){const _=o[d];c+=HEX_CHARS[_>>>4&15],c+=HEX_CHARS[15&_]}return c}function encodeRfc3986(h){return h.replace(/[!'()*]/g,o=>"%"+o.charCodeAt(0).toString(16).toUpperCase())}function guessServiceRegion(h,o){const{hostname:c,pathname:d}=h;if(c.endsWith(".on.aws")){const tt=c.match(/^[^.]{1,63}\.lambda-url\.([^.]{1,63})\.on\.aws$/);return tt!=null?["lambda",tt[1]||""]:["",""]}if(c.endsWith(".r2.cloudflarestorage.com"))return["s3","auto"];if(c.endsWith(".backblazeb2.com")){const tt=c.match(/^(?:[^.]{1,63}\.)?s3\.([^.]{1,63})\.backblazeb2\.com$/);return tt!=null?["s3",tt[1]||""]:["",""]}const _=c.replace("dualstack.","").match(/([^.]{1,63})\.(?:([^.]{0,63})\.)?amazonaws\.com(?:\.cn)?$/);let v=_&&_[1]||"",b=_&&_[2];if(b==="us-gov")b="us-gov-west-1";else if(b==="s3"||b==="s3-accelerate")b="us-east-1",v="s3";else if(v==="iot")v=c.startsWith("iot.")?"execute-api":c.startsWith("data.jobs.iot.")?"iot-jobs-data":d==="/mqtt"?"iotdevicegateway":"iotdata";else if(v==="autoscaling"){const tt=(o.get("X-Amz-Target")||"").split(".")[0];tt==="AnyScaleFrontendService"?v="application-autoscaling":tt==="AnyScaleScalingPlannerFrontendService"&&(v="autoscaling-plans")}else b==null&&v.startsWith("s3-")?(b=v.slice(3).replace(/^fips-|^external-1/,""),v="s3"):v.endsWith("-fips")?v=v.slice(0,-5):b&&/-\d$/.test(v)&&!/-\d$/.test(b)&&([v,b]=[b,v]);return[HOST_SERVICES[v]||v,b||""]}var AWSClientPlugin_decorate=function(h,o,c,d){var _,v=arguments.length,b=v<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(h,o,c,d);else for(var tt=h.length-1;tt>=0;tt--)(_=h[tt])&&(b=(v<3?_(b):v>3?_(o,c,b):_(o,c))||b);return v>3&&b&&Object.defineProperty(o,c,b),b},AWSClientPlugin_1;let AWSClientPlugin=AWSClientPlugin_1=class extends AViewerPlugin{constructor(){super(),this.enabled=!0,this._connected=!1,this.dependencies=[FileTransferPlugin],this.accessKeyId="",this.accessKeySecret="",this.endpointURL="",this.pathPrefix="webgi",this.serializeSettings=!1,this.toggleConnection=()=>{this._connected?this.disconnect():this.connect()},this.serializeWithViewer=!1,this.fetchFunction=fetch}connect(){this._connected&&this.disconnect(),this._client=new AwsClient({accessKeyId:this.accessKeyId,secretAccessKey:this.accessKeySecret}),this._connected=!0,this.refreshUi()}refreshUi(){var h,o;(o=(h=this.uiConfig)===null||h===void 0?void 0:h.uiRefresh)===null||o===void 0||o.call(h,"postFrame",!0)}disconnect(){this._client=void 0,this._connected=!1,this.refreshUi()}get connected(){return this._connected}get client(){return this._client}toJSON(h){return this.serializeSettings?super.toJSON(h):{type:this.constructor.PluginType}}async onAdded(h){await super.onAdded(h);const o=h.getPlugin(FileTransferPlugin);o.actions.exportFile=async(c,d,_)=>{if(!this._connected)return void await o.defaultActions.exportFile(c,d);const v=ot([this.endpointURL,this.pathPrefix,d]),b=await this.fetch(v,{method:"PUT",body:c},_);if(!b.ok)return h.console.error("Error uploading file",b),void await o.defaultActions.exportFile(c,d);this.dispatchEvent({type:"fileUpload",name:d,blob:c,response:b,path:v}),h.console.log("File uploaded",b)}}async fetch(h,o,c){if(!this._client)throw new Error("Not connected");for(let d=0;d<=this._client.retries;d++){const _=await sign2(this._client,h,o);let v=_.url.toString();AWSClientPlugin_1.USE_PROXY&&v&&!v.includes(AWSClientPlugin_1.PROXY_URL)&&(v=AWSClientPlugin_1.PROXY_URL.replace("{path}",v));const b=(0,this.fetchFunction)(v,_);if(d===this._client.retries)return b;const tt=await b;if(tt.status<500&&tt.status!==429)return tt;await X$2(Math.random()*this._client.initRetryMs*Math.pow(2,d))}throw new Error("An unknown error occurred, ensure retries is not negative")}};async function sign2(h,o,c){if(o instanceof Request){const{method:v,url:b,headers:tt,body:it}=o;(c=Object.assign({method:v,url:b,headers:tt},c)).body==null&&tt.has("Content-Type")&&(c.body=it!=null&&tt.has("X-Amz-Content-Sha256")?it:await o.clone().arrayBuffer()),o=b,console.warn("WebGi AWSClientPlugin: There could be a bug in chrome with cloning Request objects, see https://bugs.chromium.org/p/chromium/issues/detail?id=1360943")}const d=new AwsV4Signer(Object.assign({url:o},c,h,c&&c.aws)),_=Object.assign({},c,await d.sign());return delete _.aws,_}AWSClientPlugin.PluginType="AWSClientPlugin1",AWSClientPlugin.USE_PROXY=!1,AWSClientPlugin.PROXY_URL="https://r2-s3-api.repalash.com/{path}",AWSClientPlugin_decorate([serialize(),uiInput("Access Key ID",h=>({disabled:()=>!h.enabled||h._connected}))],AWSClientPlugin.prototype,"accessKeyId",void 0),AWSClientPlugin_decorate([serialize(),uiInput("Access Key Secret",h=>({disabled:()=>!h.enabled||h._connected}))],AWSClientPlugin.prototype,"accessKeySecret",void 0),AWSClientPlugin_decorate([serialize(),uiInput("Endpoint URL",h=>({disabled:()=>!h.enabled||h._connected}))],AWSClientPlugin.prototype,"endpointURL",void 0),AWSClientPlugin_decorate([serialize(),uiInput("Path Prefix",h=>({disabled:()=>!h.enabled}))],AWSClientPlugin.prototype,"pathPrefix",void 0),AWSClientPlugin_decorate([serialize(),uiToggle("Remember",h=>({disabled:()=>!h.enabled||h._connected}))],AWSClientPlugin.prototype,"serializeSettings",void 0),AWSClientPlugin_decorate([uiButton(void 0,h=>({label:()=>h._connected?"Disconnect":"Connect"}))],AWSClientPlugin.prototype,"toggleConnection",void 0),AWSClientPlugin=AWSClientPlugin_1=AWSClientPlugin_decorate([uiFolder("S3 Connection")],AWSClientPlugin);const supportsRequestStreams=(()=>{let h=!1,o=!1;const c=typeof globalThis.ReadableStream=="function",d=typeof globalThis.Request=="function";return c&&d&&(o=new globalThis.Request("https://empty.invalid",{body:new globalThis.ReadableStream,method:"POST",get duplex(){return h=!0,"half"}}).headers.has("Content-Type")),h&&!o})(),defaultPresets={Background:new SimpleAssetList({basePath:"https://demo-assets.pixotronics.com/pixo/presets/background",assets:["gradient-radial-dark-blue.svg","gradient-radial-grey.svg","gradient-radial-red.svg","gradient-radial-aqua.svg","gradient-radial-green.svg","gradient-radial-white.svg","gradient-radial-coral.svg","gradient-radial-fuchsia.svg","gradient-radial-blue.svg","gradient-radial-black.svg","gradient-radial-light-blue.svg","gradient-radial-gray.svg","gradient-radial-beige.svg","gradient-radial-antrasit.svg","gradient-linear-light-blue.svg","gradient-linear-gray.svg","gradient-linear-beige.svg","gradient-linear-antrasit.svg","bg-1.jpg","bg-2.png"].map(h=>({path:h}))}).assets,Environment:new SimpleAssetList({basePath:"https://demo-assets.pixotronics.com/pixo/presets/environment",assets:["env-metal-1.hdr","env-metal-2.hdr","env-metal-3.hdr","env-metal-4.hdr","env-metal-5.hdr","env-metal-6.hdr","env-metal-7.hdr","env-metal-8.hdr","env-metal-9.hdr","env-metal-10.hdr","env-metal-11.hdr","env-metal-12.hdr","env-metal-13.hdr","env-metal-14.exr","env-metal-gem-1.hdr","env-metal-gem-2.hdr","env-gem-1.hdr","env-gem-2.hdr","env-gem-3.exr","env-gem-4.exr","alps_field_1k.hdr","paul_lobe_haus_1k.hdr","derelict_highway_midday_1k.hdr","neon_photostudio_1k.hdr","studio_small_08_1k.hdr","evening_meadow_1k.hdr","st_peters_square_night_1k.hdr","studio_small_07_1k.hdr","moonless_golf_1k.hdr","satara_night_1k.hdr","venice_sunset_1k.hdr","umhlanga_sunrise_1k.hdr","studio_country_hall_1k.hdr"].map(h=>({path:h}))}).assets,GemEnvironment:new SimpleAssetList({basePath:"https://demo-assets.pixotronics.com/pixo/presets/environment",assets:["env-gem-1.hdr","env-gem-2.hdr","env-gem-3.exr","env-gem-4.exr","env-metal-gem-1.hdr","env-metal-gem-2.hdr"].map(h=>({path:h}))}).assets,GemEnvironment2:new SimpleAssetList({basePath:"https://demo-assets.pixotronics.com/pixo/presets/environment",assets:["env-gem-1.hdr","env-gem-2.hdr","env-gem-3.exr","env-gem-4.exr","env-metal-gem-1.hdr","env-metal-gem-2.hdr"].map(h=>({path:h}))}).assets,GemEnvironment3:new SimpleAssetList({basePath:"https://demo-assets.pixotronics.com/pixo/presets/environment",assets:["env-gem-1.hdr","env-gem-2.hdr","env-gem-3.exr","env-gem-4.exr","env-metal-gem-1.hdr","env-metal-gem-2.hdr"].map(h=>({path:h}))}).assets,Ground:new SimpleAssetList({basePath:"https://demo-assets.pixotronics.com/pixo/presets/ground",assets:["ground-1.json","ground-2.json","ground-3.json","g-1.json","g-2.json","g-3.json","g-4.json","g-5.json"].map(h=>({path:h}))}).assets,CameraViews:new SimpleAssetList({basePath:"https://demo-assets.pixotronics.com/pixo/presets/views",assets:["views-1.json","views-2.json"].map(h=>({path:h}))}).assets,MaterialConfiguration:new SimpleAssetList({basePath:"https://demo-assets.pixotronics.com/pixo/presets/material-conf",assets:["gold-ceramic.json","gold.json","metal-diamond.json"].map(h=>({path:h}))}).assets,MaterialLibraries:new SimpleAssetList({basePath:"https://demo-assets.pixotronics.com/pixo/presets/material-lib",assets:["metal.zip","gem.zip"].map(h=>({path:h}))}).assets};function velocityPerSecond$1(h,o){return o?h*(1e3/o):0}function inertia$1(h){var o,c=h.from,d=c===void 0?0:c,_=h.velocity,v=_===void 0?0:_,b=h.min,tt=h.max,it=h.power,nt=it===void 0?.8:it,lt=h.timeConstant,ut=lt===void 0?750:lt,ht=h.bounceStiffness,_t=ht===void 0?500:ht,ft=h.bounceDamping,bt=ft===void 0?10:ft,xt=h.restDelta,St=xt===void 0?1:xt,wt=h.modifyTarget,Pt=h.driver,Rt=h.onUpdate,kt=h.onComplete,Gt=h.onStop;function Dt(or){return b!==void 0&&or<b||tt!==void 0&&or>tt}function It(or){return b===void 0?tt:tt===void 0||Math.abs(b-or)<Math.abs(tt-or)?b:tt}function Nt(or){o==null||o.stop(),o=animate(__assign(__assign({},or),{driver:Pt,onUpdate:function(pr){var hr;Rt==null||Rt(pr),(hr=or.onUpdate)===null||hr===void 0||hr.call(or,pr)},onComplete:kt,onStop:Gt}))}function Vt(or){Nt(__assign({type:"spring",stiffness:_t,damping:bt,restDelta:St},or))}if(Dt(d))Vt({from:d,velocity:v,to:It(d)});else{var Kt=nt*v+d;wt!==void 0&&(Kt=wt(Kt));var Yt,nr,rr=It(Kt),lr=rr===b?-1:1;Nt({type:"decay",from:d,velocity:v,timeConstant:ut,power:nt,restDelta:St,modifyTarget:wt,onUpdate:Dt(Kt)?function(or){Yt=nr,nr=or,v=velocityPerSecond$1(or-Yt,getFrameData().delta),(lr===1&&or>rr||lr===-1&&or<rr)&&Vt({from:or,to:rr,velocity:v})}:void 0})}return{stop:function(){return o==null?void 0:o.stop()}}}var radiansToDegrees=function(h){return 180*h/Math.PI},angle=function(h,o){return o===void 0&&(o=zeroPoint),radiansToDegrees(Math.atan2(o.y-h.y,o.x-h.x))},applyOffset=function(h,o){var c=!0;return o===void 0&&(o=h,c=!1),function(d){return c?d-h+o:(h=d,c=!0,o)}},identity=function(h){return h},createAttractor=function(h){return h===void 0&&(h=identity),function(o,c,d){var _=c-d,v=-(0-o+1)*(0-h(Math.abs(_)));return _<=0?c+v:c-v}},attract=createAttractor(),attractExpo=createAttractor(Math.sqrt),degreesToRadians=function(h){return h*Math.PI/180},isPoint=function(h){return h.hasOwnProperty("x")&&h.hasOwnProperty("y")},isPoint3D=function(h){return isPoint(h)&&h.hasOwnProperty("z")},distance1D=function(h,o){return Math.abs(h-o)};function distance$1(h,o){if(isNum(h)&&isNum(o))return distance1D(h,o);if(isPoint(h)&&isPoint(o)){var c=distance1D(h.x,o.x),d=distance1D(h.y,o.y),_=isPoint3D(h)&&isPoint3D(o)?distance1D(h.z,o.z):0;return Math.sqrt(Math.pow(c,2)+Math.pow(d,2)+Math.pow(_,2))}}var pointFromVector=function(h,o,c){return o=degreesToRadians(o),{x:c*Math.cos(o)+h.x,y:c*Math.sin(o)+h.y}},toDecimal=function(h,o){return o===void 0&&(o=2),o=Math.pow(10,o),Math.round(h*o)/o},smoothFrame=function(h,o,c,d){return d===void 0&&(d=0),toDecimal(h+c*(o-h)/Math.max(d,c))},smooth=function(h){h===void 0&&(h=50);var o=0,c=0;return function(d){var _=getFrameData().timestamp,v=_!==c?_-c:0,b=v?smoothFrame(o,d,v,h):o;return c=_,o=b,b}},snap=function(h){if(typeof h=="number")return function(d){return Math.round(d/h)*h};var o=0,c=h.length;return function(d){var _=Math.abs(h[0]-d);for(o=1;o<c;o++){var v=h[o],b=Math.abs(v-d);if(b===0)return v;if(b>_)return h[o-1];if(o===c-1)return v;_=b}}};function velocityPerFrame(h,o){return h/(1e3/o)}var wrap=function(h,o,c){var d=o-h;return((c-h)%d+d)%d+h},cubic_bezier_a=function(h,o){return 1-3*o+3*h},cubic_bezier_b=function(h,o){return 3*o-6*h},cubic_bezier_c=function(h){return 3*h},calcBezier$1=function(h,o,c){return((cubic_bezier_a(o,c)*h+cubic_bezier_b(o,c))*h+cubic_bezier_c(o))*h},getSlope=function(h,o,c){return 3*cubic_bezier_a(o,c)*h*h+2*cubic_bezier_b(o,c)*h+cubic_bezier_c(o)},subdivisionPrecision$1=1e-7,subdivisionMaxIterations$1=10;function binarySubdivide$1(h,o,c,d,_){var v,b,tt=0;do(v=calcBezier$1(b=o+(c-o)/2,d,_)-h)>0?c=b:o=b;while(Math.abs(v)>subdivisionPrecision$1&&++tt<subdivisionMaxIterations$1);return b}var newtonIterations=8,newtonMinSlope=.001;function newtonRaphsonIterate(h,o,c,d){for(var _=0;_<newtonIterations;++_){var v=getSlope(o,c,d);if(v===0)return o;o-=(calcBezier$1(o,c,d)-h)/v}return o}var kSplineTableSize=11,kSampleStepSize=1/(kSplineTableSize-1);function cubicBezier$1(h,o,c,d){if(h===o&&c===d)return linear;for(var _=new Float32Array(kSplineTableSize),v=0;v<kSplineTableSize;++v)_[v]=calcBezier$1(v*kSampleStepSize,h,c);return function(b){return b===0||b===1?b:calcBezier$1(function(tt){for(var it=0,nt=1,lt=kSplineTableSize-1;nt!==lt&&_[nt]<=tt;++nt)it+=kSampleStepSize;--nt;var ut=it+(tt-_[nt])/(_[nt+1]-_[nt])*kSampleStepSize,ht=getSlope(ut,h,c);return ht>=newtonMinSlope?newtonRaphsonIterate(tt,ut,h,c):ht===0?ut:binarySubdivide$1(tt,it,it+kSampleStepSize,h,c)}(b),o,d)}}var steps_steps=function(h,o){return o===void 0&&(o="end"),function(c){var d=(c=o==="end"?Math.min(c,.999):Math.max(c,.001))*h,_=o==="end"?Math.floor(d):Math.ceil(d);return clamp$1(0,1,_/h)}};const _lut=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];function generateUUID(){const h=4294967295*Math.random()|0,o=4294967295*Math.random()|0,c=4294967295*Math.random()|0,d=4294967295*Math.random()|0;return(_lut[255&h]+_lut[h>>8&255]+_lut[h>>16&255]+_lut[h>>24&255]+"-"+_lut[255&o]+_lut[o>>8&255]+"-"+_lut[o>>16&15|64]+_lut[o>>24&255]+"-"+_lut[63&c|128]+_lut[c>>8&255]+"-"+_lut[c>>16&255]+_lut[c>>24&255]+_lut[255&d]+_lut[d>>8&255]+_lut[d>>16&255]+_lut[d>>24&255]).toLowerCase()}var AnimationObjectPlugin_decorate=function(h,o,c,d){var _,v=arguments.length,b=v<3?o:d===null?d=Object.getOwnPropertyDescriptor(o,c):d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(h,o,c,d);else for(var tt=h.length-1;tt>=0;tt--)(_=h[tt])&&(b=(v<3?_(b):v>3?_(o,c,b):_(o,c))||b);return v>3&&b&&Object.defineProperty(o,c,b),b},AnimationObject_1;class AnimationObjectPlugin extends AViewerPlugin{constructor(){super(...arguments),this.enabled=!0,this.animation=new AnimationObject(()=>this._viewer),this.uiConfig=this.animation.uiConfig}async onAdded(o){function c(d){let _="",v=1;for(;v<d.length&&(_+=d[v],d[v].endsWith("\\"));v++)_=_.slice(0,-1),_+=".";return[_,v]}await super.onAdded(o),o._animGetters={objects:d=>{if(d.length<2||!o)return;const[_,v]=c(d);return{tar:o.scene.getObjectByName(_),i:v}},materials:d=>{var _,v,b;if(d.length<2||!o)return;const[tt,it]=c(d);return{tar:(b=(v=(_=o.assetManager)===null||_===void 0?void 0:_.materials)===null||v===void 0?void 0:v.findMaterialsByName(tt))===null||b===void 0?void 0:b[0],i:it}}}}}AnimationObjectPlugin.PluginType="AnimationObjectPlugin",AnimationObjectPlugin_decorate([serialize(),uiConfig()],AnimationObjectPlugin.prototype,"animation",void 0);let AnimationObject=AnimationObject_1=class{constructor(h){this.target=h,this.uuid=generateUUID(),this.name="",this.access="",this.options={},this.duration=1e3,this.delay=0,this.repeat=1,this.repeatType="mirror",this.ease="easeInOutSine",this.updater=[],this.updateScene=!1,this.updateCamera=!1,this.updateViewer=!1,this.animSetParallel=!1,this.animSet=[],this.uiConfig=generateUiFolder("Animation Object",this,void 0,"folder",!0)}_onAccessChanged(){const h=Ee$1(this.target),{key:o,tar:c}=extractAnimationKey(this,h);if(this.from=void 0,this.to=void 0,!o||!c)return void this.refreshUi();const d=c[o];if(d==null)return void this.refreshUi();const _=()=>{if(!d)return d;if(d.isColor)return"#"+d.getHexString();const v=typeof d.clone=="function"?d.clone():typeof d=="object"?{...d}:d;return console.log(v),v};this.from=_(),this.to=_(),this.refreshUi()}refreshUi(){var h,o;(o=(h=this.uiConfig)===null||h===void 0?void 0:h.uiRefresh)===null||o===void 0||o.call(h,"postFrame",!0,1)}add(h){this.animSet.push(h),h.parent=this,this.refreshUi()}remove(h){const o=this.animSet.indexOf(h);o>=0&&(this.animSet.splice(o,1),h.parent=void 0,this.refreshUi())}async animate(h=!1){typeof h!="boolean"&&(h=!1);const o=Ee$1(this.target);if(!o)return void console.warn("AnimationObject: No viewer");h&&(this.options.to=this.from,this.options.from=this.to),this.options.repeatType=this.repeatType,this.options.repeat=this.repeat,this.updater=[],this.updateScene&&this.updater.push("scene"),this.updateCamera&&this.updater.push("camera"),this.updateViewer&&this.updater.push("viewer"),this.animSet.forEach(c=>c.target=this.target),await animateObject(o,this,{viewer:()=>o.setDirty(),renderer:()=>o.renderer.reset(),scene:()=>{o.scene.setDirty()},camera:()=>o.scene.activeCamera.setDirty()}),delete this.options.to,delete this.options.from}async animateReverse(){await this.animate(!0)}async removeFromParent2(){const h=Ee$1(this.target);this.parent&&h&&await h.confirm(`Delete: Are you sure you want to delete the animation ${this.name}?`)&&this.removeFromParent()}removeFromParent(){this.parent&&this.parent.remove(this)}addAnimation(){this.add(new AnimationObject_1(this.target))}};AnimationObjectPlugin_decorate([serialize(),uiInput()],AnimationObject.prototype,"name",void 0),AnimationObjectPlugin_decorate([serialize(),uiInput(),x$1(AnimationObject.prototype._onAccessChanged)],AnimationObject.prototype,"access",void 0),AnimationObjectPlugin_decorate([uiConfig(),serialize()],AnimationObject.prototype,"from",void 0),AnimationObjectPlugin_decorate([uiConfig(),serialize()],AnimationObject.prototype,"to",void 0),AnimationObjectPlugin_decorate([serialize()],AnimationObject.prototype,"options",void 0),AnimationObjectPlugin_decorate([serialize(),uiSlider(void 0,[0,1e4],1,h=>({hidden:()=>h.from===void 0}))],AnimationObject.prototype,"duration",void 0),AnimationObjectPlugin_decorate([serialize(),uiSlider(void 0,[0,1e4],1,h=>({hidden:()=>h.from===void 0}))],AnimationObject.prototype,"delay",void 0),AnimationObjectPlugin_decorate([serialize(),uiSlider(void 0,[0,10],1,h=>({hidden:()=>h.from===void 0}))],AnimationObject.prototype,"repeat",void 0),AnimationObjectPlugin_decorate([serialize(),uiDropdown("repeatType",["loop","reverse","mirror"].map(h=>({label:h})),h=>({hidden:()=>h.from===void 0}))],AnimationObject.prototype,"repeatType",void 0),AnimationObjectPlugin_decorate([serialize(),uiDropdown("ease",Object.keys(EasingFunctions).map(h=>({label:h})),h=>({hidden:()=>h.from===void 0}))],AnimationObject.prototype,"ease",void 0),AnimationObjectPlugin_decorate([serialize(),uiToggle(void 0,h=>({hidden:()=>h.from===void 0}))],AnimationObject.prototype,"updateScene",void 0),AnimationObjectPlugin_decorate([serialize(),uiToggle(void 0,h=>({hidden:()=>h.from===void 0}))],AnimationObject.prototype,"updateCamera",void 0),AnimationObjectPlugin_decorate([serialize(),uiToggle(void 0,h=>({hidden:()=>h.from===void 0}))],AnimationObject.prototype,"updateViewer",void 0),AnimationObjectPlugin_decorate([uiButton("Animate")],AnimationObject.prototype,"animate",null),AnimationObjectPlugin_decorate([uiButton("Animate Reverse")],AnimationObject.prototype,"animateReverse",null),AnimationObjectPlugin_decorate([uiButton("Delete")],AnimationObject.prototype,"removeFromParent2",null),AnimationObjectPlugin_decorate([serialize(),uiToggle()],AnimationObject.prototype,"animSetParallel",void 0),AnimationObjectPlugin_decorate([serialize(),uiConfig()],AnimationObject.prototype,"animSet",void 0),AnimationObjectPlugin_decorate([uiButton("Add Animation")],AnimationObject.prototype,"addAnimation",null),AnimationObject=AnimationObject_1=AnimationObjectPlugin_decorate([serializable("AnimationObject")],AnimationObject);var GradientSvgPlugin_decorate=function(h,o,c,d){var _,v=arguments.length,b=v<3?o:d===null?d=Object.getOwnPropertyDescriptor(o,c):d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(h,o,c,d);else for(var tt=h.length-1;tt>=0;tt--)(_=h[tt])&&(b=(v<3?_(b):v>3?_(o,c,b):_(o,c))||b);return v>3&&b&&Object.defineProperty(o,c,b),b};let GradientSvgPlugin=class extends AViewerPlugin{constructor(h=!0){super(),this.enabled=!0,this.dependencies=[],this.options={id:generateUUID(),type:"linear",gradientUnits:"objectBoundingBox",linearOptions:{angle:45,x1:0,y1:0,x2:1,y2:1},radialOptions:{cx:.5,cy:.5,r:.5,fx:.5,fy:.5,spreadMethod:"pad"}},this.type="linear",this.gradientUnits="objectBoundingBox",this.position1=new three_module.I9Y(0,0),this.position2=new three_module.I9Y(1,1),this.angle=0,this.radius=.5,this.center=new three_module.I9Y(.5,.5),this.focus=new three_module.I9Y(.5,.5),this.spreadMethod="pad",this._svgGradient=new SvgGradient,this._needsUpdate=!1,this.colors=[new three_module.Q1f(1,1,1),new three_module.Q1f(1,0,0)],this.color1=this.colors[0],this.color2=this.colors[1],this.applyToBackground=!1,this.autoRefresh=!0,this.enabled=h}_refreshOptions(){var h,o,c,d,_,v,b,tt;this.options.type=this.type,this.options.gradientUnits=this.gradientUnits,this.options.linearOptions={angle:this.angle,x1:(h=this.position1)===null||h===void 0?void 0:h.x,y1:(o=this.position1)===null||o===void 0?void 0:o.y,x2:(c=this.position2)===null||c===void 0?void 0:c.x,y2:(d=this.position2)===null||d===void 0?void 0:d.y},this.options.radialOptions={cx:(_=this.center)===null||_===void 0?void 0:_.x,cy:(v=this.center)===null||v===void 0?void 0:v.y,r:this.radius,fx:(b=this.focus)===null||b===void 0?void 0:b.x,fy:(tt=this.focus)===null||tt===void 0?void 0:tt.y,spreadMethod:this.spreadMethod},this.setDirty()}setDirty(){this._needsUpdate=!0}addColor(){this.colors.push(new three_module.Q1f),this.setDirty()}refreshSvg(){if((!this.applyToBackground||this._viewer)&&(this._refreshOptions(),this._needsUpdate=!1,this._svgElement=this._svgGradient.get(this.colors,this.options),this.applyToBackground)){const h=`
            <svg xmlns="http://www.w3.org/2000/svg" width="100" height="100">
            <defs>
            ${this._svgElement.outerHTML}
            </defs>
            <rect width="100%" height="100%" fill="url(#${this.options.id})"/>
            </svg>
            `,o=B$2(h),c=new Image;c.src=o;const d=new three_module.gPd(c);c.onload=()=>{this._svgTexture===d&&(this._svgTexture.needsUpdate=!0,this._viewer.scene.background=this._svgTexture,this._viewer.setDirty())},this._svgTexture&&this._svgTexture.dispose(),this._svgTexture=d}}async onAdded(h){await super.onAdded(h),h.addEventListener("postFrame",()=>{this.enabled&&this._needsUpdate&&this.autoRefresh&&this.refreshSvg()})}};GradientSvgPlugin.PluginType="GradientSvgPlugin",GradientSvgPlugin_decorate([uiToggle()],GradientSvgPlugin.prototype,"enabled",void 0),GradientSvgPlugin_decorate([serialize(),uiDropdown("type",["linear","radial"].map(h=>({label:h}))),x$1(GradientSvgPlugin.prototype._refreshOptions)],GradientSvgPlugin.prototype,"type",void 0),GradientSvgPlugin_decorate([serialize(),x$1(GradientSvgPlugin.prototype._refreshOptions)],GradientSvgPlugin.prototype,"gradientUnits",void 0),GradientSvgPlugin_decorate([serialize(),uiVector("position1",[0,1],.01,h=>({hidden:()=>h.type!=="linear",onChange:()=>h._refreshOptions()})),x$1(GradientSvgPlugin.prototype._refreshOptions)],GradientSvgPlugin.prototype,"position1",void 0),GradientSvgPlugin_decorate([serialize(),uiVector("position2",[0,1],.01,h=>({hidden:()=>h.type!=="linear",onChange:()=>h._refreshOptions()})),x$1(GradientSvgPlugin.prototype._refreshOptions)],GradientSvgPlugin.prototype,"position2",void 0),GradientSvgPlugin_decorate([serialize(),uiSlider("angle",[0,360],1,h=>({hidden:()=>h.type!=="linear"})),x$1(GradientSvgPlugin.prototype._refreshOptions)],GradientSvgPlugin.prototype,"angle",void 0),GradientSvgPlugin_decorate([serialize(),uiSlider("radius",[0,1],.01,h=>({hidden:()=>h.type!=="radial"})),x$1(GradientSvgPlugin.prototype._refreshOptions)],GradientSvgPlugin.prototype,"radius",void 0),GradientSvgPlugin_decorate([serialize(),uiVector("center",[0,1],.01,h=>({hidden:()=>h.type!=="radial",onChange:()=>h._refreshOptions()})),x$1(GradientSvgPlugin.prototype._refreshOptions)],GradientSvgPlugin.prototype,"center",void 0),GradientSvgPlugin_decorate([serialize(),uiVector("focus",[0,1],.01,h=>({hidden:()=>h.type!=="radial",onChange:()=>h._refreshOptions()})),x$1(GradientSvgPlugin.prototype._refreshOptions)],GradientSvgPlugin.prototype,"focus",void 0),GradientSvgPlugin_decorate([serialize(),x$1(GradientSvgPlugin.prototype._refreshOptions)],GradientSvgPlugin.prototype,"spreadMethod",void 0),GradientSvgPlugin_decorate([serialize()],GradientSvgPlugin.prototype,"colors",void 0),GradientSvgPlugin_decorate([uiColor(void 0,h=>({onChange:()=>h.setDirty()})),x$1(GradientSvgPlugin.prototype.setDirty)],GradientSvgPlugin.prototype,"color1",void 0),GradientSvgPlugin_decorate([uiColor(void 0,h=>({onChange:()=>h.setDirty()})),x$1(GradientSvgPlugin.prototype.setDirty)],GradientSvgPlugin.prototype,"color2",void 0),GradientSvgPlugin_decorate([serialize(),uiToggle(),x$1(GradientSvgPlugin.prototype.setDirty)],GradientSvgPlugin.prototype,"applyToBackground",void 0),GradientSvgPlugin_decorate([uiButton()],GradientSvgPlugin.prototype,"refreshSvg",null),GradientSvgPlugin_decorate([serialize()],GradientSvgPlugin.prototype,"autoRefresh",void 0),GradientSvgPlugin=GradientSvgPlugin_decorate([uiFolder("Gradient SVG")],GradientSvgPlugin);class SvgGradient{constructor(){}get(o,c){return this.colors=o,this.options=c,this.createGradient()}createSvgElement(o){return document.createElementNS("http://www.w3.org/2000/svg",o)}createColorStop(o,c,d){const _=this.createSvgElement("stop");return _.setAttribute("offset",c/d*100+"%"),_.setAttribute("stop-color",o),_}colorsToStops(){const o=this.colors;return o.map((c,d)=>{const _=c.getStyle();return this.createColorStop(_,d,o.length)})}createGradientElement(){const o=this.options,c=this.createSvgElement(`${o.type}Gradient`),d=/((id)|([c|f|x|y|r][x|y|1|2]?)|(gradientUnits))/,_=o[`${o.type}Options`],v={id:o.id,type:o.type,gradientUnits:o.gradientUnits,..._};return Object.entries(v).filter(b=>d.test(b[0])).forEach(b=>{b[0]!=="type"&&c.setAttribute(b[0],b[1])}),v.angle&&c.setAttribute("gradientTransform",`rotate(${v.angle})`),c}createGradient(){const o=this.createGradientElement();return this.colorsToStops().forEach(c=>o.appendChild(c)),o}}var TransformControlsPlugin_decorate=function(h,o,c,d){var _,v=arguments.length,b=v<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(h,o,c,d);else for(var tt=h.length-1;tt>=0;tt--)(_=h[tt])&&(b=(v<3?_(b):v>3?_(o,c,b):_(o,c))||b);return v>3&&b&&Object.defineProperty(o,c,b),b};class TransformControlsPlugin extends AViewerPlugin{setDirty(){var o,c;if(!this._viewer)return;const d=this._viewer.getPlugin(PickingPlugin),_=this.enabled;_&&d.widgetEnabled?(d.enableWidget(!1),this._pickingWidgetDisabled=!0):!_&&this._pickingWidgetDisabled&&(d.enableWidget(!0),this._pickingWidgetDisabled=!1),this.transformControls&&(_&&d.getSelectedObject()?this.transformControls.attach(d.getSelectedObject()):this.transformControls.detach()),this._viewer.setDirty(),(c=(o=this.uiConfig)===null||o===void 0?void 0:o.uiRefresh)===null||c===void 0||c.call(o,"postFrame",!0,1)}constructor(o=!0){super(),this.uiConfig={type:"folder",label:"Transform Controls",children:[...generateUiConfig(this),()=>{var c;return(c=this.transformControls)===null||c===void 0?void 0:c.uiConfig}]},this.enabled=!0,this._pickingWidgetDisabled=!1,this.toJSON=void 0,this.dependencies=[PickingPlugin],this._isInteracting=!1,this._transformState={obj:null,position:new three_module.Pq0,rotation:new three_module.O9p,scale:new three_module.Pq0},this._activeCameraChange=()=>{this.transformControls&&this._viewer&&(this.transformControls.camera=this._viewer.scene.activeCamera.cameraObject)},TransformControls.ObjectConstructors.MeshBasicMaterial=MeshBasicMaterial2,this.enabled=o}get undoManager(){var o,c;return(c=(o=this._viewer)===null||o===void 0?void 0:o.getPlugin(TweakpaneUiPlugin))===null||c===void 0?void 0:c.undoManager}async onAdded(o){await super.onAdded(o),this.setDirty(),this.transformControls=new TransformControls2(o.scene.activeCamera.cameraObject,o.canvas),this._activeCameraChange=this._activeCameraChange.bind(this),o.scene.addEventListener("activeCameraChange",this._activeCameraChange),this.transformControls.addEventListener("dragging-changed",c=>{if(!(this!=null&&this._viewer))return;const d=this._viewer.scene.activeCamera.controls;typeof(d==null?void 0:d.stopDamping)=="function"&&d!=null&&d.enabled&&d.stopDamping(),this._viewer.scene.activeCamera.setInteractions(!c.value,TransformControlsPlugin.PluginType)}),this.transformControls.addEventListener("axis-changed",c=>{if(!(this!=null&&this._viewer))return;this._isInteracting=!!c.value;const d=this._viewer.scene.activeCamera.controls;typeof(d==null?void 0:d.stopDamping)=="function"&&d!=null&&d.enabled&&d.stopDamping(),this._viewer.setDirty()}),o.scene.addSceneObject(this.transformControls,{addToRoot:!0}),o.getPlugin(PickingPlugin).addEventListener("selectedObjectChanged",c=>{this.transformControls&&(this.enabled?c.object?this.transformControls.attach(c.object):this.transformControls.detach():this.transformControls.object&&this.transformControls.detach())}),this.transformControls.addEventListener("mouseDown",()=>{if(!this.transformControls)return;const c=this.transformControls.object;c&&(this._transformState.obj=c,this._transformState.position=c.position.clone(),this._transformState.rotation=c.rotation.clone(),this._transformState.scale=c.scale.clone())}),this.transformControls.addEventListener("mouseUp",()=>{if(!this.transformControls)return;const c=this.transformControls.object;if(!c||this._transformState.obj!==c||!this.undoManager)return;const d={translate:"position",rotate:"rotation",scale:"scale"}[this.transformControls.getMode()];if(!d||this._transformState[d].equals(c[d]))return;const _={last:this._transformState[d].clone(),current:c[d].clone(),set:v=>{var b,tt;c[d].copy(v),c.updateMatrixWorld(!0),(b=this.transformControls)===null||b===void 0||b.dispatchEvent({type:"change"}),(tt=this.transformControls)===null||tt===void 0||tt.dispatchEvent({type:"objectChange"})},undo:()=>_.set(_.last),redo:()=>_.set(_.current)};this.undoManager.record(_)})}async onRemove(o){o.scene.removeEventListener("activeCameraChange",this._activeCameraChange),this.transformControls&&(this.transformControls.detach(),o.scene.remove(this.transformControls),this.transformControls.dispose()),this.transformControls=void 0,await super.onRemove(o)}}TransformControlsPlugin.PluginType="TransformControlsPlugin",TransformControlsPlugin_decorate([uiToggle(),x$1(TransformControlsPlugin.prototype.setDirty)],TransformControlsPlugin.prototype,"enabled",void 0);var WatchHandsPlugin_decorate=function(h,o,c,d){var _,v=arguments.length,b=v<3?o:d===null?d=Object.getOwnPropertyDescriptor(o,c):d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(h,o,c,d);else for(var tt=h.length-1;tt>=0;tt--)(_=h[tt])&&(b=(v<3?_(b):v>3?_(o,c,b):_(o,c))||b);return v>3&&b&&Object.defineProperty(o,c,b),b};let WatchHandsPlugin=class extends AViewerPlugin{constructor(){super(...arguments),this.enabled=!0,this.dependencies=[],this.axis="y",this.invertAxis=!1,this.analog=!0,this.hourOffset=0,this.minuteOffset=0,this.secondOffset=0,this.hour=".*hour.*",this.minute=".*minute.*",this.second=".*second.*",this.regex=!0,this.hands=[],this._lastEnabled=!0,this._preFrame=()=>{var h,o,c,d;if(!this.enabled){if(this._lastEnabled){if(this._lastEnabled=!1,!this.hands.length)return;for(const nt of this.hands)nt.object.rotation.fromArray(nt.object.userData.initRotation),nt.object.updateMatrixWorld();(h=this._viewer)===null||h===void 0||h.renderer.resetShadows(),(o=this._viewer)===null||o===void 0||o.setDirty()}return}if(this._lastEnabled=!0,!this.hands.length)return;const _=new Date,v=this.invertAxis?-1:1,b=v*(_.getSeconds()+(this.analog?_.getMilliseconds()/1e3:0)-this.secondOffset)*(2*Math.PI)/60,tt=v*(_.getMinutes()-this.minuteOffset)*(2*Math.PI)/60+b/60,it=v*(_.getHours()-this.hourOffset)*(2*Math.PI)/12+tt/12;if(this.hands.find(nt=>nt.type==="second"&&Math.abs(b-nt.object.rotation[this.axis])>.001)){for(const nt of this.hands)nt.type==="second"&&(nt.object.rotation[this.axis]=b),nt.type==="minute"&&(nt.object.rotation[this.axis]=tt),nt.type==="hour"&&(nt.object.rotation[this.axis]=it);(c=this._viewer)===null||c===void 0||c.renderer.resetShadows(),(d=this._viewer)===null||d===void 0||d.setDirty()}},this._addSceneObject=async h=>{const o=h.object;o&&o.modelObject&&this.refresh()}}async onAdded(h){await super.onAdded(h),h.scene.addEventListener("addSceneObject",this._addSceneObject),h.addEventListener("preFrame",this._preFrame)}async onRemove(h){await super.onRemove(h),h.scene.removeEventListener("addSceneObject",this._addSceneObject),h.removeEventListener("preFrame",this._preFrame)}refresh(){var h;this.hands=[],(h=this.viewer)===null||h===void 0||h.scene.modelRoot.traverse(o=>{let c=!1;o.traverseAncestors(d=>{c||this.hands.find(_=>_.object===d)&&(c=!0)}),c||(o.name.match(this.regex?new RegExp(this.hour):this.hour)&&(o.userData.initRotation||(o.userData.initRotation=o.rotation.toArray()),this.hands.push({type:"hour",object:o})),o.name.match(this.regex?new RegExp(this.minute):this.minute)&&(o.userData.initRotation||(o.userData.initRotation=o.rotation.toArray()),this.hands.push({type:"minute",object:o})),o.name.match(this.regex?new RegExp(this.second):this.second)&&(o.userData.initRotation||(o.userData.initRotation=o.rotation.toArray()),this.hands.push({type:"second",object:o})))})}};WatchHandsPlugin.PluginType="WatchHandsPlugin",WatchHandsPlugin_decorate([uiToggle(),serialize()],WatchHandsPlugin.prototype,"enabled",void 0),WatchHandsPlugin_decorate([uiDropdown(void 0,["x","y","z"].map(h=>({label:h}))),serialize()],WatchHandsPlugin.prototype,"axis",void 0),WatchHandsPlugin_decorate([uiToggle(),serialize()],WatchHandsPlugin.prototype,"invertAxis",void 0),WatchHandsPlugin_decorate([uiToggle(),serialize()],WatchHandsPlugin.prototype,"analog",void 0),WatchHandsPlugin_decorate([uiSlider(void 0,[0,12],.001),serialize()],WatchHandsPlugin.prototype,"hourOffset",void 0),WatchHandsPlugin_decorate([uiSlider(void 0,[0,60],.001),serialize()],WatchHandsPlugin.prototype,"minuteOffset",void 0),WatchHandsPlugin_decorate([uiSlider(void 0,[0,60],.001),serialize()],WatchHandsPlugin.prototype,"secondOffset",void 0),WatchHandsPlugin_decorate([uiInput(),serialize()],WatchHandsPlugin.prototype,"hour",void 0),WatchHandsPlugin_decorate([uiInput(),serialize()],WatchHandsPlugin.prototype,"minute",void 0),WatchHandsPlugin_decorate([uiInput(),serialize()],WatchHandsPlugin.prototype,"second",void 0),WatchHandsPlugin_decorate([uiToggle(),x$1("refresh"),serialize()],WatchHandsPlugin.prototype,"regex",void 0),WatchHandsPlugin_decorate([uiButton()],WatchHandsPlugin.prototype,"refresh",null),WatchHandsPlugin=WatchHandsPlugin_decorate([uiFolder("Watch Hands Time")],WatchHandsPlugin);class CoreEditorApp extends ViewerApp{get editorInitialized(){return this._editorInitialized}constructor(o){super(o),this._editorInitialized=!1,this.defaultModes=[{title:"Viewer",plugins:[RendererUiPlugin,CameraUiPlugin,PresetLibraryPlugin,DropzonePlugin]},{title:"Picking",plugins:[HierarchyUiPlugin,PickingPlugin,TransformControlsPlugin,DiamondPlugin,MaterialLibraryPlugin,XAtlasPlugin,Object3DWidgetsPlugin]},{title:"Scene",plugins:[SimpleBackgroundEnvUiPlugin,GroundPlugin,SimpleViewerUi,LightsUiPlugin,SceneCamerasUiPlugin,RandomizedDirectionalLightPlugin,HDRiGroundPlugin,ContactShadowGroundPlugin,GeometryGeneratorPlugin,GradientSvgPlugin]},{title:"Anti-aliasing",plugins:[ProgressivePlugin,TemporalAAPlugin,VelocityBufferPlugin]},{title:"Post Processing",plugins:[TonemapPlugin,OutlinePlugin,LUTPlugin,ChromaticAberrationPlugin,FilmicGrainPlugin,VignettePlugin,SSRPlugin,SSAOPlugin,BloomPlugin,DepthOfFieldPlugin,SSGIPlugin,SSContactShadows,SSBevelPlugin]},{title:"Export",plugins:[AssetExporterPlugin,CanvasSnipperPlugin,CanvasRecorderPlugin,AWSClientPlugin,TransfrSharePlugin]},{title:"Animations",plugins:[GLTFAnimationPlugin,CameraViewPlugin,AnimationObjectPlugin,ScrollableCameraViewPreviewPlugin,CannonPhysicsPlugin,PosePlugin]},{title:"Modifiers",plugins:[ObjectRotationPlugin,ShapeTubeExtrudePlugin,SimpleTextPlugin,ParallaxMappingPlugin,CSGPluginBSP,CSGPluginBVH,ParallaxCameraControllerPlugin,MeshOptSimplifyModifierPlugin]},{title:"Configurators",plugins:[SwitchNodePlugin,MaterialConfiguratorPlugin,GLTFKHRMaterialVariantsPlugin,VariationConfiguratorEditorUiPlugin]},{title:"Plugins",plugins:[InteractionPromptPlugin,AnisotropyPlugin,FullScreenPlugin,CustomBumpMapPlugin,FrameFadePlugin,ClearcoatTintPlugin,ThinFilmLayerPlugin,FragmentClippingExtensionPlugin,NormalBufferPlugin,NoiseBumpMaterialPlugin,LoadingScreenPlugin,CSS3DRendererPlugin,Rhino3dmLoadPlugin,ModelStagePlugin,WatchHandsPlugin]},{title:"Extras",plugins:[ExtrasUiPlugin,SnowFallPlugin,WaveGroundPlugin,VRPluginBasic,VirtualCamerasPlugin,RainbowDiamondPlugin,BeringRingAnimation]}],setupModesStyles();const c=this.scene.activeCamera.controls;c&&(c.autoPushTarget2=!0)}async setupUi(o,c){await setupModesUi(this,o,c??this.defaultModes),this._editorInitialized=!0}}async function addEditorPlugins(h,{debug:o=!1,ground:c=!0,bloom:d=!0,depthTonemap:_=!0,importPopup:v=!0,caching:b=!0,presetLibrary:tt=!0,switchNode:it=!0,materialConfigurator:nt=!0}){h.enabled=!1,KTX2LoadPlugin.SAVE_SOURCE_BLOBS=!0,o&&await h.addPlugin(DebugPlugin),h.getPlugin(AssetManagerPlugin)||await h.addPlugin(AssetManagerPlugin,void 0,void 0,{storage:b&&window.caches?await window.caches.open("webgi-cache-storage"):void 0}),await h.addPlugin(AssetExporterPlugin),await h.addPlugin(GLTFDracoExportPlugin),await h.addPlugin(GLTFSpecGlossinessConverterPlugin),await h.addPlugin(FileTransferPlugin),v&&((await h.addPlugin(LoadingScreenPlugin)).isEditor=!0),await h.addPlugin(WindowiseDialogPlugin),await h.addPlugin(VirtualCamerasPlugin,!1),await h.getOrAddPlugin(KTXLoadPlugin),await h.addPlugin(PopmotionPlugin),await h.getOrAddPlugin(DropzonePlugin),await h.addPlugin(CannonPhysicsPlugin),await h.addPlugin(TransformAnimationPlugin),await h.addPlugin(PickingPlugin,BoxSelectionWidget,!1,!0),await h.addPlugin(TransformControlsPlugin,!1),await addBasePlugins(h,{ground:c,bloom:d,depthTonemap:_}),(await h.getOrAddPlugin(FrameFadePlugin)).isEditor=!0,tt&&await h.getOrAddPlugin(PresetLibraryPlugin),await h.getOrAddPlugin(DiamondPlugin),await h.addPlugin(OutlinePlugin),await h.addPlugin(ParallaxMappingPlugin,!1),await h.addPlugin(DeviceOrientationControlsPlugin),await h.addPlugin(FirstPersonControlsPlugin),await h.addPlugin(PointerLockControlsPlugin),await h.addPlugin(TrackballControlsPlugin),await h.addPlugin(CSS3DRendererPlugin,!1),await h.addPlugin(new ObjectRotationPlugin(!1)),await h.addPlugin(ShapeTubeExtrudePlugin),await h.addPlugin(SimpleTextPlugin),nt&&((await h.addPlugin(MaterialConfiguratorPlugin)).enableEditContextMenus=!0),it&&await h.addPlugin(SwitchNodePlugin),await h.addPlugin(VariationConfiguratorEditorUiPlugin),await h.addPlugin(MaterialLibraryPlugin),await h.addPlugin(CanvasRecorderPlugin),await h.addPlugin(CanvasSnipperPlugin),await h.addPlugin(HierarchyUiPlugin),await h.addPlugin(SimpleViewerUi),await h.addPlugin(LightsUiPlugin),await h.addPlugin(SceneCamerasUiPlugin),await h.addPlugin(RendererUiPlugin),await h.addPlugin(CameraUiPlugin),await h.addPlugin(SimpleBackgroundEnvUiPlugin),await h.addPlugin(Object3DWidgetsPlugin,!1),await h.addPlugin(GeometryGeneratorPlugin),await h.addPlugin(XAtlasPlugin),await h.addPlugin(ScrollableCameraViewPreviewPlugin,h.container,!1),await h.addPlugin(AWSClientPlugin),await h.addPlugin(RainbowDiamondPlugin),await h.addPlugin(TransfrSharePlugin),await h.addPlugin(GradientSvgPlugin),await h.addPlugin(AnimationObjectPlugin),await h.addPlugin(MeshOptSimplifyModifierPlugin),await h.addPlugin(SnowFallPlugin),await h.addPlugin(WaveGroundPlugin),await h.addPlugin(PosePlugin),await h.addPlugin(WatchHandsPlugin);const lt=await h.addPlugin(new TweakpaneUiPlugin(!we$1()));return h.renderer.refreshPipeline(),h.scene.addEventListener("textureAdded",ut=>{ut.texture&&h.setEnvironmentMap(ut.texture)}),lt.setupPluginUi(FullScreenPlugin),lt.setupPluginUi(RendererUiPlugin),lt.setupPluginUi(CameraUiPlugin),lt.setupPluginUi(LoadingScreenPlugin),lt.setupPluginUi(DropzonePlugin),lt.setupPluginUi(SimpleBackgroundEnvUiPlugin),lt.setupPluginUi(AssetExporterPlugin),lt.setupPluginUi(GLTFAnimationPlugin),lt.setupPluginUi(RandomizedDirectionalLightPlugin),it&&lt.setupPluginUi(SwitchNodePlugin),nt&&lt.setupPluginUi(MaterialConfiguratorPlugin),lt.setupPluginUi(CannonPhysicsPlugin),lt.setupPluginUi(HierarchyUiPlugin),lt.setupPluginUi(MaterialLibraryPlugin),lt.setupPluginUi(DiamondPlugin),lt.setupPluginUi(TransformControlsPlugin),lt.setupPluginUi(PickingPlugin),c&&h.getPlugin(GroundPlugin)&&lt.setupPluginUi(GroundPlugin),c&&h.getPlugin(ContactShadowGroundPlugin)&&lt.setupPluginUi(ContactShadowGroundPlugin),lt.setupPluginUi(SSRPlugin),lt.setupPluginUi(CameraViewPlugin),lt.setupPluginUi(CanvasRecorderPlugin),lt.setupPluginUi(TonemapPlugin),lt.setupPluginUi(OutlinePlugin),lt.setupPluginUi(ChromaticAberrationPlugin),lt.setupPluginUi(FilmicGrainPlugin),lt.setupPluginUi(LUTPlugin),lt.setupPluginUi(VignettePlugin),lt.setupPluginUi(DepthOfFieldPlugin),lt.setupPluginUi(SSAOPlugin),lt.setupPluginUi(NormalBufferPlugin),lt.setupPluginUi(SSBevelPlugin),lt.setupPluginUi(SimpleViewerUi),lt.setupPluginUi(ObjectRotationPlugin),lt.setupPluginUi(ShapeTubeExtrudePlugin),lt.setupPluginUi(ProgressivePlugin),lt.setupPluginUi(GradientSvgPlugin),lt.setupPluginUi(AnimationObjectPlugin),lt.setupPluginUi(LightsUiPlugin),lt.setupPluginUi(SceneCamerasUiPlugin),lt.setupPluginUi(ThinFilmLayerPlugin),lt.setupPluginUi(FragmentClippingExtensionPlugin),lt.setupPluginUi(NoiseBumpMaterialPlugin),d&&lt.setupPluginUi(BloomPlugin),lt.setupPluginUi(CanvasSnipperPlugin),lt.setupPluginUi(AnisotropyPlugin),lt.setupPluginUi(TemporalAAPlugin),lt.setupPluginUi(HDRiGroundPlugin),lt.setupPluginUi(SSGIPlugin),lt.setupPluginUi(SSContactShadows),lt.setupPluginUi(SimpleTextPlugin),lt.setupPluginUi(FrameFadePlugin),lt.setupPluginUi(VelocityBufferPlugin),lt.setupPluginUi(ModelStagePlugin),tt&&lt.setupPluginUi(PresetLibraryPlugin),lt.setupPluginUi(GLTFKHRMaterialVariantsPlugin),lt.setupPluginUi(CustomBumpMapPlugin),lt.setupPluginUi(ParallaxMappingPlugin),lt.setupPluginUi(CSS3DRendererPlugin),lt.setupPluginUi(AWSClientPlugin),lt.setupPluginUi(ScrollableCameraViewPreviewPlugin),lt.setupPluginUi(XAtlasPlugin),lt.setupPluginUi(VariationConfiguratorEditorUiPlugin),lt.setupPluginUi(ParallaxCameraControllerPlugin),lt.setupPluginUi(Object3DWidgetsPlugin),lt.setupPluginUi(Rhino3dmLoadPlugin),lt.setupPluginUi(VirtualCamerasPlugin),lt.setupPluginUi(GeometryGeneratorPlugin),lt.setupPluginUi(InteractionPromptPlugin),lt.setupPluginUi(RainbowDiamondPlugin),lt.setupPluginUi(TransfrSharePlugin),lt.setupPluginUi(MeshOptSimplifyModifierPlugin),lt.setupPluginUi(SnowFallPlugin),lt.setupPluginUi(WaveGroundPlugin),lt.setupPluginUi(PosePlugin),lt.setupPluginUi(WatchHandsPlugin),h.enabled=!0,h}async function setupSandboxWebGiEditor(h,{debug:o=!1,ground:c=!0,bloom:d=!0,depthTonemap:_=!0,importPopup:v=!0,caching:b=!0}){const tt=new ViewerApp(h);return await addEditorPlugins(tt,{debug:o,ground:c,bloom:d,depthTonemap:_,importPopup:v,caching:b}),tt}async function setupCoreWebGiViewer(h,{debug:o=!1,ground:c=!0,bloom:d=!0,depthTonemap:_=!0,importPopup:v=!1,enableDrop:b=!1,caching:tt=!0}={}){const it=new ViewerApp(h);return o&&await it.addPlugin(DebugPlugin),it.getPlugin(AssetManagerPlugin)||it.addPluginSync(AssetManagerPlugin,void 0,void 0,{storage:tt&&window.caches?await caches.open("webgi-cache-storage"):void 0}),await it.addPlugin(AssetManagerLoadingBarPlugin,!0),await addBasePlugins(it,{ground:c,bloom:d,depthTonemap:_,enableDrop:b,importPopup:v}),await it.getOrAddPlugin(DiamondPlugin),it}var __webpackgi_exports__AAssetManagerProcessStatePlugin=__webpackgi_exports__.CZu,__webpackgi_exports__ACESFilmicToneMapping=__webpackgi_exports__.FV,__webpackgi_exports__ACameraControlsPlugin=__webpackgi_exports__.oK2,__webpackgi_exports__ACanvasRecorder=__webpackgi_exports__.SLH,__webpackgi_exports__ALL_WEBGI_EXTENSIONS=__webpackgi_exports__.yo9,__webpackgi_exports__AMaterialManager=__webpackgi_exports__.YJd,__webpackgi_exports__ARPlacementBox=__webpackgi_exports__.qnC,__webpackgi_exports__ARPlugin=__webpackgi_exports__.TtJ,__webpackgi_exports__ARTouchInputHelper=__webpackgi_exports__.rUH,__webpackgi_exports__AShaderMaterial2=__webpackgi_exports__.oAs,__webpackgi_exports__AViewerPlugin=__webpackgi_exports__.$fV,__webpackgi_exports__AWSClientPlugin=__webpackgi_exports__.upe,__webpackgi_exports__AddBlendPass=__webpackgi_exports__.yPJ,__webpackgi_exports__AddEquation=__webpackgi_exports__.gO9,__webpackgi_exports__AddOperation=__webpackgi_exports__.XrR,__webpackgi_exports__AdditiveAnimationBlendMode=__webpackgi_exports__.DAe,__webpackgi_exports__AdditiveBlending=__webpackgi_exports__.EZo,__webpackgi_exports__AlphaFormat=__webpackgi_exports__.wrO,__webpackgi_exports__AlwaysCompare=__webpackgi_exports__.FFZ,__webpackgi_exports__AlwaysDepth=__webpackgi_exports__.lGu,__webpackgi_exports__AlwaysStencilFunc=__webpackgi_exports__.sKt,__webpackgi_exports__AmbientLight=__webpackgi_exports__.$p8,__webpackgi_exports__AmbientLight2=__webpackgi_exports__.nJr,__webpackgi_exports__AnimationAction=__webpackgi_exports__.pPE,__webpackgi_exports__AnimationClip=__webpackgi_exports__.tz3,__webpackgi_exports__AnimationLoader=__webpackgi_exports__.kEx,__webpackgi_exports__AnimationMixer=__webpackgi_exports__.Iw4,__webpackgi_exports__AnimationObjectGroup=__webpackgi_exports__.P5j,__webpackgi_exports__AnimationUtils=__webpackgi_exports__.AKb,__webpackgi_exports__AnisotropyPlugin=__webpackgi_exports__.GXy,__webpackgi_exports__ArcCurve=__webpackgi_exports__.ibB,__webpackgi_exports__ArrayCamera=__webpackgi_exports__.nZQ,__webpackgi_exports__ArrowHelper=__webpackgi_exports__.E0M,__webpackgi_exports__AssetExporter=__webpackgi_exports__.GLG,__webpackgi_exports__AssetExporterPlugin=__webpackgi_exports__.$VP,__webpackgi_exports__AssetImporter=__webpackgi_exports__.NeI,__webpackgi_exports__AssetManagerBasicPopupPlugin=__webpackgi_exports__.rzc,__webpackgi_exports__AssetManagerLoadingBarPlugin=__webpackgi_exports__.Kiu,__webpackgi_exports__AssetManagerPlugin=__webpackgi_exports__.XDT,__webpackgi_exports__AsyncCompress=__webpackgi_exports__.XiN,__webpackgi_exports__AsyncDecompress=__webpackgi_exports__._I9,__webpackgi_exports__AsyncDeflate=__webpackgi_exports__.ShE,__webpackgi_exports__AsyncGunzip=__webpackgi_exports__.OXP,__webpackgi_exports__AsyncGzip=__webpackgi_exports__.JZ8,__webpackgi_exports__AsyncInflate=__webpackgi_exports__.gS4,__webpackgi_exports__AsyncUnzipInflate=__webpackgi_exports__.eFx,__webpackgi_exports__AsyncUnzlib=__webpackgi_exports__.peq,__webpackgi_exports__AsyncZipDeflate=__webpackgi_exports__.hw0,__webpackgi_exports__AsyncZlib=__webpackgi_exports__._DG,__webpackgi_exports__Audio=__webpackgi_exports__.fP5,__webpackgi_exports__AudioAnalyser=__webpackgi_exports__.CwR,__webpackgi_exports__AudioContext=__webpackgi_exports__.UtX,__webpackgi_exports__AudioListener=__webpackgi_exports__.Pf$,__webpackgi_exports__AudioLoader=__webpackgi_exports__.Am1,__webpackgi_exports__AxesHelper=__webpackgi_exports__.IzY,__webpackgi_exports__BackSide=__webpackgi_exports__.hsX,__webpackgi_exports__BackgroundPresetGroup=__webpackgi_exports__.XFr,__webpackgi_exports__BaseGroundPlugin=__webpackgi_exports__.Eh1,__webpackgi_exports__BaseRenderer=__webpackgi_exports__.RJS,__webpackgi_exports__BasicDepthPacking=__webpackgi_exports__.Rkk,__webpackgi_exports__BasicShadowMap=__webpackgi_exports__.bTm,__webpackgi_exports__BeringRingAnimation=__webpackgi_exports__.Otl,__webpackgi_exports__BlobLoader=__webpackgi_exports__.pOj,__webpackgi_exports__BloomPlugin=__webpackgi_exports__.jg0,__webpackgi_exports__Bone=__webpackgi_exports__.$Kf,__webpackgi_exports__BooleanKeyframeTrack=__webpackgi_exports__.YOZ,__webpackgi_exports__Box2=__webpackgi_exports__.UtB,__webpackgi_exports__Box3=__webpackgi_exports__.NRn,__webpackgi_exports__Box3B=__webpackgi_exports__.DYt,__webpackgi_exports__Box3Helper=__webpackgi_exports__.BND,__webpackgi_exports__BoxGeometry=__webpackgi_exports__.iNn,__webpackgi_exports__BoxHelper=__webpackgi_exports__.IWo,__webpackgi_exports__BoxSelectionWidget=__webpackgi_exports__.SYd,__webpackgi_exports__BufferAttribute=__webpackgi_exports__.THS,__webpackgi_exports__BufferGeometry=__webpackgi_exports__.LoY,__webpackgi_exports__BufferGeometryLoader=__webpackgi_exports__.SUR,__webpackgi_exports__ByteType=__webpackgi_exports__.tJf,__webpackgi_exports__CSGPluginBSP=__webpackgi_exports__.Y3u,__webpackgi_exports__CSGPluginBVH=__webpackgi_exports__.poD,__webpackgi_exports__CSGPluginBase=__webpackgi_exports__.gaG,__webpackgi_exports__CSS3DRendererPlugin=__webpackgi_exports__.z0x,__webpackgi_exports__Cache=__webpackgi_exports__.l2R,__webpackgi_exports__Camera=__webpackgi_exports__.i7d,__webpackgi_exports__CameraController=__webpackgi_exports__.mL7,__webpackgi_exports__CameraHelper=__webpackgi_exports__.WTh,__webpackgi_exports__CameraUiPlugin=__webpackgi_exports__.l5h,__webpackgi_exports__CameraView=__webpackgi_exports__.hzv,__webpackgi_exports__CameraViewControlPlugin=__webpackgi_exports__.f_U,__webpackgi_exports__CameraViewPlugin=__webpackgi_exports__.sxt,__webpackgi_exports__CannonPhysicsPlugin=__webpackgi_exports__.af0,__webpackgi_exports__CanvasMediaRecorder=__webpackgi_exports__.Phj,__webpackgi_exports__CanvasRecorder=__webpackgi_exports__.p5D,__webpackgi_exports__CanvasRecorderPlugin=__webpackgi_exports__.CS6,__webpackgi_exports__CanvasSnipper=__webpackgi_exports__.aKT,__webpackgi_exports__CanvasSnipperPlugin=__webpackgi_exports__.RzO,__webpackgi_exports__CanvasTexture=__webpackgi_exports__.GOR,__webpackgi_exports__CapsuleGeometry=__webpackgi_exports__.qU7,__webpackgi_exports__CatmullRomCurve3=__webpackgi_exports__.B6O,__webpackgi_exports__ChromaticAberrationPlugin=__webpackgi_exports__.z1d,__webpackgi_exports__CineonToneMapping=__webpackgi_exports__.nNL,__webpackgi_exports__CircleGeometry=__webpackgi_exports__.tcD,__webpackgi_exports__ClampToEdgeWrapping=__webpackgi_exports__.ghU,__webpackgi_exports__ClearcoatTintPlugin=__webpackgi_exports__.Dk8,__webpackgi_exports__Clock=__webpackgi_exports__.zD7,__webpackgi_exports__Color=__webpackgi_exports__.Q1f,__webpackgi_exports__ColorKeyframeTrack=__webpackgi_exports__.T6I,__webpackgi_exports__ColorManagement=__webpackgi_exports__.ppV,__webpackgi_exports__CombinedPostPlugin=__webpackgi_exports__.FvD,__webpackgi_exports__Compress=__webpackgi_exports__.n3b,__webpackgi_exports__CompressedArrayTexture=__webpackgi_exports__.iOZ,__webpackgi_exports__CompressedCubeTexture=__webpackgi_exports__.c5h,__webpackgi_exports__CompressedTexture=__webpackgi_exports__.YSM,__webpackgi_exports__CompressedTextureLoader=__webpackgi_exports__.YRT,__webpackgi_exports__ConeGeometry=__webpackgi_exports__.qFE,__webpackgi_exports__ContactShadowGroundPlugin=__webpackgi_exports__.fCM,__webpackgi_exports__CoreEditorApp=__webpackgi_exports__.afc,__webpackgi_exports__CoreViewerApp=__webpackgi_exports__.hLJ,__webpackgi_exports__CubeCamera=__webpackgi_exports__.F1T,__webpackgi_exports__CubeNormalsCaptureHelper=__webpackgi_exports__.SXA,__webpackgi_exports__CubeReflectionMapping=__webpackgi_exports__.hy7,__webpackgi_exports__CubeRefractionMapping=__webpackgi_exports__.xFO,__webpackgi_exports__CubeTexture=__webpackgi_exports__.b4q,__webpackgi_exports__CubeTextureLoader=__webpackgi_exports__.ScU,__webpackgi_exports__CubeUVReflectionMapping=__webpackgi_exports__.Om,__webpackgi_exports__CubicBezierCurve=__webpackgi_exports__.Z0B,__webpackgi_exports__CubicBezierCurve3=__webpackgi_exports__.s0K,__webpackgi_exports__CubicInterpolant=__webpackgi_exports__.Pdi,__webpackgi_exports__CullFaceBack=__webpackgi_exports__.Vb5,__webpackgi_exports__CullFaceFront=__webpackgi_exports__.Jnc,__webpackgi_exports__CullFaceFrontBack=__webpackgi_exports__.ywQ,__webpackgi_exports__CullFaceNone=__webpackgi_exports__.WNZ,__webpackgi_exports__Curve=__webpackgi_exports__.Ipv,__webpackgi_exports__CurvePath=__webpackgi_exports__.jGm,__webpackgi_exports__CustomAnimationHelper=__webpackgi_exports__.Ogy,__webpackgi_exports__CustomAnimationHelperPlugin=__webpackgi_exports__.xLk,__webpackgi_exports__CustomBlending=__webpackgi_exports__.bCz,__webpackgi_exports__CustomBumpMapPlugin=__webpackgi_exports__.bGG,__webpackgi_exports__CustomToneMapping=__webpackgi_exports__.g7M,__webpackgi_exports__CylinderGeometry=__webpackgi_exports__.Ho_,__webpackgi_exports__Cylindrical=__webpackgi_exports__.hjs,__webpackgi_exports__DRACOLoader2=__webpackgi_exports__.Zn9,__webpackgi_exports__Damper=__webpackgi_exports__.AHf,__webpackgi_exports__Data3DTexture=__webpackgi_exports__.dYF,__webpackgi_exports__DataArrayTexture=__webpackgi_exports__.rFo,__webpackgi_exports__DataTexture=__webpackgi_exports__.GYF,__webpackgi_exports__DataTextureLoader=__webpackgi_exports__.BRH,__webpackgi_exports__DataUrlLoader=__webpackgi_exports__.psi,__webpackgi_exports__DataUtils=__webpackgi_exports__.GxU,__webpackgi_exports__DebugPlugin=__webpackgi_exports__.n2t,__webpackgi_exports__DecodeUTF8=__webpackgi_exports__.yuL,__webpackgi_exports__Decompress=__webpackgi_exports__.YMq,__webpackgi_exports__DecrementStencilOp=__webpackgi_exports__.ROr,__webpackgi_exports__DecrementWrapStencilOp=__webpackgi_exports__.fJr,__webpackgi_exports__DefaultLoadingManager=__webpackgi_exports__.h_9,__webpackgi_exports__Deflate=__webpackgi_exports__.Gyi,__webpackgi_exports__DepthFormat=__webpackgi_exports__.zdS,__webpackgi_exports__DepthOfFieldPass=__webpackgi_exports__.WCV,__webpackgi_exports__DepthOfFieldPlugin=__webpackgi_exports__._Vf,__webpackgi_exports__DepthStencilFormat=__webpackgi_exports__.dcC,__webpackgi_exports__DepthTexture=__webpackgi_exports__.VCu,__webpackgi_exports__DeviceOrientationControls2=__webpackgi_exports__.n1S,__webpackgi_exports__DeviceOrientationControlsPlugin=__webpackgi_exports__.sOF,__webpackgi_exports__DiamondMaterial=__webpackgi_exports__.aFP,__webpackgi_exports__DiamondPlugin=__webpackgi_exports__.GMU,__webpackgi_exports__DirectionalLight=__webpackgi_exports__.ZyN,__webpackgi_exports__DirectionalLight2=__webpackgi_exports__.rFg,__webpackgi_exports__DirectionalLightHelper=__webpackgi_exports__.PFK,__webpackgi_exports__DiscreteInterpolant=__webpackgi_exports__.Yhb,__webpackgi_exports__DisplayP3ColorSpace=__webpackgi_exports__.V5c,__webpackgi_exports__DodecahedronGeometry=__webpackgi_exports__.nEu,__webpackgi_exports__DoubleSide=__webpackgi_exports__.$EB,__webpackgi_exports__Dropzone=__webpackgi_exports__.mRE,__webpackgi_exports__DropzonePlugin=__webpackgi_exports__.hSt,__webpackgi_exports__DstAlphaFactor=__webpackgi_exports__.hdd,__webpackgi_exports__DstColorFactor=__webpackgi_exports__.wn6,__webpackgi_exports__DynamicCopyUsage=__webpackgi_exports__.MOq,__webpackgi_exports__DynamicDrawUsage=__webpackgi_exports__.Vnu,__webpackgi_exports__DynamicReadUsage=__webpackgi_exports__.hIf,__webpackgi_exports__EXRExporter2=__webpackgi_exports__.d5G,__webpackgi_exports__EXRLoadPlugin=__webpackgi_exports__.vr8,__webpackgi_exports__EasingFunctions=__webpackgi_exports__.JCs,__webpackgi_exports__EdgesGeometry=__webpackgi_exports__.TDQ,__webpackgi_exports__EffectComposer2=__webpackgi_exports__.WYq,__webpackgi_exports__EllipseCurve=__webpackgi_exports__.S20,__webpackgi_exports__EllipseCurve3D=__webpackgi_exports__.LWT,__webpackgi_exports__EncodeUTF8=__webpackgi_exports__.MJ1,__webpackgi_exports__EncoderMethod=__webpackgi_exports__.KDW,__webpackgi_exports__EnvironmentPresetGroup=__webpackgi_exports__.SQT,__webpackgi_exports__EqualCompare=__webpackgi_exports__.kO0,__webpackgi_exports__EqualDepth=__webpackgi_exports__.U3G,__webpackgi_exports__EqualStencilFunc=__webpackgi_exports__.jsO,__webpackgi_exports__EquirectangularReflectionMapping=__webpackgi_exports__.wfO,__webpackgi_exports__EquirectangularRefractionMapping=__webpackgi_exports__.uV5,__webpackgi_exports__Euler=__webpackgi_exports__.O9p,__webpackgi_exports__EventDispatcher=__webpackgi_exports__.Qev,__webpackgi_exports__ExtrasUiPlugin=__webpackgi_exports__.j8I,__webpackgi_exports__ExtrudeGeometry=__webpackgi_exports__.QCA,__webpackgi_exports__FBXLoadPlugin=__webpackgi_exports__.ol2,__webpackgi_exports__FFMPEGRecorder=__webpackgi_exports__.y74,__webpackgi_exports__FSShadowMaterial=__webpackgi_exports__.lT0,__webpackgi_exports__FileLoader=__webpackgi_exports__.Y9S,__webpackgi_exports__FileTransferPlugin=__webpackgi_exports__.ryq,__webpackgi_exports__FilmicGrainPlugin=__webpackgi_exports__.xcV,__webpackgi_exports__FirstPersonControls2=__webpackgi_exports__.OMG,__webpackgi_exports__FirstPersonControlsPlugin=__webpackgi_exports__.Vkg,__webpackgi_exports__Float16BufferAttribute=__webpackgi_exports__.Oax,__webpackgi_exports__Float32BufferAttribute=__webpackgi_exports__.qtW,__webpackgi_exports__Float64BufferAttribute=__webpackgi_exports__.V58,__webpackgi_exports__FloatType=__webpackgi_exports__.RQf,__webpackgi_exports__Fog=__webpackgi_exports__.jUj,__webpackgi_exports__FogExp2=__webpackgi_exports__.cRK,__webpackgi_exports__FragmentClippingExtensionPlugin=__webpackgi_exports__.ziY,__webpackgi_exports__FragmentClippingMode=__webpackgi_exports__.kzd,__webpackgi_exports__FrameFadePlugin=__webpackgi_exports__.VNy,__webpackgi_exports__FramebufferTexture=__webpackgi_exports__.Pem,__webpackgi_exports__FrontSide=__webpackgi_exports__.hB5,__webpackgi_exports__Frustum=__webpackgi_exports__.PPD,__webpackgi_exports__FullScreenPlugin=__webpackgi_exports__.BH6,__webpackgi_exports__GBufferPlugin=__webpackgi_exports__.HSI,__webpackgi_exports__GLBufferAttribute=__webpackgi_exports__.oh6,__webpackgi_exports__GLSL1=__webpackgi_exports__.Wyr,__webpackgi_exports__GLSL3=__webpackgi_exports__.Wdf,__webpackgi_exports__GLTFAnimationPlugin=__webpackgi_exports__.P3V,__webpackgi_exports__GLTFDracoExportPlugin=__webpackgi_exports__.s0N,__webpackgi_exports__GLTFDracoExporter=__webpackgi_exports__._Js,__webpackgi_exports__GLTFExporter2=__webpackgi_exports__.xQA,__webpackgi_exports__GLTFExporterMaterialsVariantsExtensionExport=__webpackgi_exports__.Yeh,__webpackgi_exports__GLTFKHRMaterialVariantsPlugin=__webpackgi_exports__.N30,__webpackgi_exports__GLTFLoader2=__webpackgi_exports__.P44,__webpackgi_exports__GLTFMaterialsVariantsExtensionImport=__webpackgi_exports__.MdZ,__webpackgi_exports__GLTFMeshGpuInstancingExporter=__webpackgi_exports__.Cc9,__webpackgi_exports__GLTFMeshOptPlugin=__webpackgi_exports__.HjZ,__webpackgi_exports__GLTFSpecGlossinessConverterPlugin=__webpackgi_exports__.UX5,__webpackgi_exports__GLTFWriter2=__webpackgi_exports__.fGP,__webpackgi_exports__GammaCorrectionExtension=__webpackgi_exports__.T03,__webpackgi_exports__GammaCorrectionPlugin=__webpackgi_exports__.fPK,__webpackgi_exports__GemEnvironmentPresetGroup=__webpackgi_exports__.XpU,__webpackgi_exports__GenericBlendTexturePass=__webpackgi_exports__.hUz,__webpackgi_exports__GenericFilterPlugin=__webpackgi_exports__.pbu,__webpackgi_exports__GeometryGeneratorPlugin=__webpackgi_exports__.jhn,__webpackgi_exports__GreaterCompare=__webpackgi_exports__.eoi,__webpackgi_exports__GreaterDepth=__webpackgi_exports__.K52,__webpackgi_exports__GreaterEqualCompare=__webpackgi_exports__.gWB,__webpackgi_exports__GreaterEqualDepth=__webpackgi_exports__.Gwm,__webpackgi_exports__GreaterEqualStencilFunc=__webpackgi_exports__.TMh,__webpackgi_exports__GreaterStencilFunc=__webpackgi_exports__.RcT,__webpackgi_exports__GridHelper=__webpackgi_exports__.fTw,__webpackgi_exports__GroundPlugin=__webpackgi_exports__.Hx_,__webpackgi_exports__Group=__webpackgi_exports__.YJl,__webpackgi_exports__Gunzip=__webpackgi_exports__.asK,__webpackgi_exports__GyroInputDevice=__webpackgi_exports__._qo,__webpackgi_exports__Gzip=__webpackgi_exports__.Ne,__webpackgi_exports__HDRiGroundPlugin=__webpackgi_exports__.Guc,__webpackgi_exports__HalfFloatType=__webpackgi_exports__.ix0,__webpackgi_exports__HemisphereLight=__webpackgi_exports__.dth,__webpackgi_exports__HemisphereLightHelper=__webpackgi_exports__.R1W,__webpackgi_exports__HierarchyUiPlugin=__webpackgi_exports__.tcR,__webpackgi_exports__IcosahedronGeometry=__webpackgi_exports__.WBB,__webpackgi_exports__ImageBitmapLoader=__webpackgi_exports__.Kzg,__webpackgi_exports__ImageLoader=__webpackgi_exports__.$NF,__webpackgi_exports__ImageSequenceRecorder=__webpackgi_exports__.NuM,__webpackgi_exports__ImageUtils=__webpackgi_exports__.HgN,__webpackgi_exports__Importer=__webpackgi_exports__.l9C,__webpackgi_exports__IncrementStencilOp=__webpackgi_exports__.HLH,__webpackgi_exports__IncrementWrapStencilOp=__webpackgi_exports__.Ru$,__webpackgi_exports__Inflate=__webpackgi_exports__.ELl,__webpackgi_exports__InstancedBufferAttribute=__webpackgi_exports__.uWO,__webpackgi_exports__InstancedBufferGeometry=__webpackgi_exports__.CmU,__webpackgi_exports__InstancedInterleavedBuffer=__webpackgi_exports__.LuO,__webpackgi_exports__InstancedMesh=__webpackgi_exports__.ZLX,__webpackgi_exports__Int16BufferAttribute=__webpackgi_exports__.Hrb,__webpackgi_exports__Int32BufferAttribute=__webpackgi_exports__.vmz,__webpackgi_exports__Int8BufferAttribute=__webpackgi_exports__.wvS,__webpackgi_exports__IntType=__webpackgi_exports__.Yuy,__webpackgi_exports__InteractionPromptPlugin=__webpackgi_exports__.K5h,__webpackgi_exports__InterleavedBuffer=__webpackgi_exports__.eB$,__webpackgi_exports__InterleavedBufferAttribute=__webpackgi_exports__.eHs,__webpackgi_exports__Interpolant=__webpackgi_exports__.lGw,__webpackgi_exports__InterpolateDiscrete=__webpackgi_exports__.ljd,__webpackgi_exports__InterpolateLinear=__webpackgi_exports__.PJ3,__webpackgi_exports__InterpolateSmooth=__webpackgi_exports__.EQC,__webpackgi_exports__InvertStencilOp=__webpackgi_exports__.oVO,__webpackgi_exports__KHR_TEXTURE_BASISU=__webpackgi_exports__.Yj4,__webpackgi_exports__KTX2LoadPlugin=__webpackgi_exports__.ZPL,__webpackgi_exports__KTXLoadPlugin=__webpackgi_exports__.$16,__webpackgi_exports__KeepStencilOp=__webpackgi_exports__.VVr,__webpackgi_exports__KeyframeTrack=__webpackgi_exports__.UJ6,__webpackgi_exports__LOD=__webpackgi_exports__.UpK,__webpackgi_exports__LUTPlugin=__webpackgi_exports__.ZYb,__webpackgi_exports__LatheGeometry=__webpackgi_exports__.nzx,__webpackgi_exports__LayeredMaterialPlugin=__webpackgi_exports__.DLJ,__webpackgi_exports__Layers=__webpackgi_exports__.zgK,__webpackgi_exports__LessCompare=__webpackgi_exports__.vim,__webpackgi_exports__LessDepth=__webpackgi_exports__.brA,__webpackgi_exports__LessEqualCompare=__webpackgi_exports__.TiK,__webpackgi_exports__LessEqualDepth=__webpackgi_exports__.xSv,__webpackgi_exports__LessEqualStencilFunc=__webpackgi_exports__.CR7,__webpackgi_exports__LessStencilFunc=__webpackgi_exports__.kYr,__webpackgi_exports__Light=__webpackgi_exports__.veJ,__webpackgi_exports__LightProbe=__webpackgi_exports__.FZo,__webpackgi_exports__LightsUiPlugin=__webpackgi_exports__.Dvx,__webpackgi_exports__Line=__webpackgi_exports__.N1A,__webpackgi_exports__Line2=__webpackgi_exports__.XkL,__webpackgi_exports__Line3=__webpackgi_exports__.cZY,__webpackgi_exports__LineBasicMaterial=__webpackgi_exports__.mrM,__webpackgi_exports__LineCurve=__webpackgi_exports__.GZZ,__webpackgi_exports__LineCurve3=__webpackgi_exports__.VnP,__webpackgi_exports__LineDashedMaterial=__webpackgi_exports__.Fvt,__webpackgi_exports__LineGeometry=__webpackgi_exports__.vK6,__webpackgi_exports__LineLoop=__webpackgi_exports__.FCc,__webpackgi_exports__LineMaterial=__webpackgi_exports__.GV4,__webpackgi_exports__LineSegments=__webpackgi_exports__.DXC,__webpackgi_exports__LineSegments2=__webpackgi_exports__.bFd,__webpackgi_exports__LineSegmentsGeometry=__webpackgi_exports__.n31,__webpackgi_exports__LinearDisplayP3ColorSpace=__webpackgi_exports__.qIQ,__webpackgi_exports__LinearEncoding=__webpackgi_exports__.tgE,__webpackgi_exports__LinearFilter=__webpackgi_exports__.k6q,__webpackgi_exports__LinearInterpolant=__webpackgi_exports__.ezk,__webpackgi_exports__LinearMipMapLinearFilter=__webpackgi_exports__.NZq,__webpackgi_exports__LinearMipMapNearestFilter=__webpackgi_exports__.iUH,__webpackgi_exports__LinearMipmapLinearFilter=__webpackgi_exports__.$_I,__webpackgi_exports__LinearMipmapNearestFilter=__webpackgi_exports__.kRr,__webpackgi_exports__LinearSRGBColorSpace=__webpackgi_exports__.Zr2,__webpackgi_exports__LinearToneMapping=__webpackgi_exports__.kyO,__webpackgi_exports__LinearTransfer=__webpackgi_exports__.VxR,__webpackgi_exports__Loader=__webpackgi_exports__.aHM,__webpackgi_exports__LoaderUtils=__webpackgi_exports__.r6x,__webpackgi_exports__LoadingManager=__webpackgi_exports__.KPJ,__webpackgi_exports__LoadingScreenPlugin=__webpackgi_exports__.O0Q,__webpackgi_exports__LoopOnce=__webpackgi_exports__.G3T,__webpackgi_exports__LoopPingPong=__webpackgi_exports__.lc7,__webpackgi_exports__LoopRepeat=__webpackgi_exports__.aMy,__webpackgi_exports__LuminanceAlphaFormat=__webpackgi_exports__.CMB,__webpackgi_exports__LuminanceFormat=__webpackgi_exports__.Kzv,__webpackgi_exports__MOUSE=__webpackgi_exports__.kBv,__webpackgi_exports__MTLLoader2=__webpackgi_exports__.T6P,__webpackgi_exports__Material=__webpackgi_exports__.imn,__webpackgi_exports__MaterialConfiguratorBasePlugin=__webpackgi_exports__.Bhh,__webpackgi_exports__MaterialConfiguratorPlugin=__webpackgi_exports__.q$N,__webpackgi_exports__MaterialExtender=__webpackgi_exports__.pzC,__webpackgi_exports__MaterialLibPresetGroupPresetGroup=__webpackgi_exports__.xbg,__webpackgi_exports__MaterialLibraryBasePlugin=__webpackgi_exports__.LTv,__webpackgi_exports__MaterialLibraryPlugin=__webpackgi_exports__.usO,__webpackgi_exports__MaterialLoader=__webpackgi_exports__.jut,__webpackgi_exports__MaterialManager=__webpackgi_exports__.Jxy,__webpackgi_exports__MaterialPresetPlugin=__webpackgi_exports__.Kmw,__webpackgi_exports__MaterialPreviewGenerator=__webpackgi_exports__.jR8,__webpackgi_exports__MathUtils=__webpackgi_exports__.cj9,__webpackgi_exports__Matrix3=__webpackgi_exports__.dwI,__webpackgi_exports__Matrix4=__webpackgi_exports__.kn4,__webpackgi_exports__MaxEquation=__webpackgi_exports__.$ei,__webpackgi_exports__Mesh=__webpackgi_exports__.eaF,__webpackgi_exports__MeshBasicMaterial=__webpackgi_exports__.V9B,__webpackgi_exports__MeshBasicMaterial2=__webpackgi_exports__.NLY,__webpackgi_exports__MeshDepthMaterial=__webpackgi_exports__.CSG,__webpackgi_exports__MeshDistanceMaterial=__webpackgi_exports__.aVO,__webpackgi_exports__MeshLambertMaterial=__webpackgi_exports__.G_z,__webpackgi_exports__MeshMatcapMaterial=__webpackgi_exports__.FNr,__webpackgi_exports__MeshNormalMaterial=__webpackgi_exports__.qBx,__webpackgi_exports__MeshOptSimplifyModifierPlugin=__webpackgi_exports__.onB,__webpackgi_exports__MeshPhongMaterial=__webpackgi_exports__.tXL,__webpackgi_exports__MeshPhysicalMaterial=__webpackgi_exports__.uSd,__webpackgi_exports__MeshStandardMaterial=__webpackgi_exports__._4j,__webpackgi_exports__MeshStandardMaterial2=__webpackgi_exports__.gCR,__webpackgi_exports__MeshToonMaterial=__webpackgi_exports__.Df,__webpackgi_exports__MinEquation=__webpackgi_exports__.znC,__webpackgi_exports__MirroredRepeatWrapping=__webpackgi_exports__.kTW,__webpackgi_exports__MixOperation=__webpackgi_exports__.KRh,__webpackgi_exports__ModelStagePlugin=__webpackgi_exports__.$iG,__webpackgi_exports__ModelStagePresetGroup=__webpackgi_exports__.eti,__webpackgi_exports__MouseInputDevice=__webpackgi_exports__.Um5,__webpackgi_exports__MultiFilterPlugin=__webpackgi_exports__.tF0,__webpackgi_exports__MultiplyBlending=__webpackgi_exports__.EdD,__webpackgi_exports__MultiplyOperation=__webpackgi_exports__.caT,__webpackgi_exports__NearestFilter=__webpackgi_exports__.hxR,__webpackgi_exports__NearestMipMapLinearFilter=__webpackgi_exports__.a$r,__webpackgi_exports__NearestMipMapNearestFilter=__webpackgi_exports__.$O9,__webpackgi_exports__NearestMipmapLinearFilter=__webpackgi_exports__.Cfg,__webpackgi_exports__NearestMipmapNearestFilter=__webpackgi_exports__.pHI,__webpackgi_exports__NeverCompare=__webpackgi_exports__.amv,__webpackgi_exports__NeverDepth=__webpackgi_exports__.eHc,__webpackgi_exports__NeverStencilFunc=__webpackgi_exports__.HPb,__webpackgi_exports__NoBlending=__webpackgi_exports__.XIg,__webpackgi_exports__NoColorSpace=__webpackgi_exports__.jf0,__webpackgi_exports__NoToneMapping=__webpackgi_exports__.y_p,__webpackgi_exports__NoiseBumpMaterialPlugin=__webpackgi_exports__.dFv,__webpackgi_exports__NormalAnimationBlendMode=__webpackgi_exports__.Ke9,__webpackgi_exports__NormalBlending=__webpackgi_exports__.NTi,__webpackgi_exports__NormalBufferPlugin=__webpackgi_exports__.nqf,__webpackgi_exports__NormalCaptureMaterial=__webpackgi_exports__.hws,__webpackgi_exports__NotEqualCompare=__webpackgi_exports__.jzd,__webpackgi_exports__NotEqualDepth=__webpackgi_exports__.bw0,__webpackgi_exports__NotEqualStencilFunc=__webpackgi_exports__.klZ,__webpackgi_exports__NumberKeyframeTrack=__webpackgi_exports__.Hit,__webpackgi_exports__OBJLoader2=__webpackgi_exports__.DJz,__webpackgi_exports__ObjMtlLoadPlugin=__webpackgi_exports__.UwE,__webpackgi_exports__Object3D=__webpackgi_exports__.B69,__webpackgi_exports__Object3DModel=__webpackgi_exports__.QA8,__webpackgi_exports__Object3DWidgetsPlugin=__webpackgi_exports__.$xz,__webpackgi_exports__ObjectLoader=__webpackgi_exports__.XTe,__webpackgi_exports__ObjectLoader2=__webpackgi_exports__.zjB,__webpackgi_exports__ObjectPicker=__webpackgi_exports__.sHL,__webpackgi_exports__ObjectProcessorMap=__webpackgi_exports__.Upe,__webpackgi_exports__ObjectRotationPlugin=__webpackgi_exports__.nEH,__webpackgi_exports__ObjectSpaceNormalMap=__webpackgi_exports__.vyJ,__webpackgi_exports__OctahedronGeometry=__webpackgi_exports__.Ufg,__webpackgi_exports__OneFactor=__webpackgi_exports__.qad,__webpackgi_exports__OneMinusDstAlphaFactor=__webpackgi_exports__.Nt7,__webpackgi_exports__OneMinusDstColorFactor=__webpackgi_exports__.aEY,__webpackgi_exports__OneMinusSrcAlphaFactor=__webpackgi_exports__.OuU,__webpackgi_exports__OneMinusSrcColorFactor=__webpackgi_exports__.LiQ,__webpackgi_exports__OrbitControls2=__webpackgi_exports__.xYO,__webpackgi_exports__OrbitControls3=__webpackgi_exports__.c07,__webpackgi_exports__OrthographicCamera=__webpackgi_exports__.qUd,__webpackgi_exports__OutlinePlugin=__webpackgi_exports__.I_i,__webpackgi_exports__P3Primaries=__webpackgi_exports__.wqq,__webpackgi_exports__PCFShadowMap=__webpackgi_exports__.QP0,__webpackgi_exports__PCFSoftShadowMap=__webpackgi_exports__.Wk7,__webpackgi_exports__PMREMGenerator=__webpackgi_exports__.BdL,__webpackgi_exports__PMREMGeneratorPlugin=__webpackgi_exports__.Q7O,__webpackgi_exports__ParallaxCameraControllerPlugin=__webpackgi_exports__.uxM,__webpackgi_exports__ParallaxMappingPlugin=__webpackgi_exports__.N9C,__webpackgi_exports__Path=__webpackgi_exports__.wAk,__webpackgi_exports__PerspectiveCamera=__webpackgi_exports__.ubm,__webpackgi_exports__PickingPlugin=__webpackgi_exports__.PG6,__webpackgi_exports__Plane=__webpackgi_exports__.Zcv,__webpackgi_exports__PlaneGeometry=__webpackgi_exports__.bdM,__webpackgi_exports__PlaneHelper=__webpackgi_exports__.ZM4,__webpackgi_exports__PluginPresetGroup=__webpackgi_exports__._EQ,__webpackgi_exports__PointLight=__webpackgi_exports__.HiM,__webpackgi_exports__PointLight2=__webpackgi_exports__.RXx,__webpackgi_exports__PointLightHelper=__webpackgi_exports__.F1l,__webpackgi_exports__PointerDragHelper=__webpackgi_exports__.W_W,__webpackgi_exports__PointerLockControls2=__webpackgi_exports__.FnS,__webpackgi_exports__PointerLockControlsPlugin=__webpackgi_exports__.oPt,__webpackgi_exports__Points=__webpackgi_exports__.ONl,__webpackgi_exports__PointsMaterial=__webpackgi_exports__.BH$,__webpackgi_exports__PolarGridHelper=__webpackgi_exports__.hzE,__webpackgi_exports__PolyhedronGeometry=__webpackgi_exports__.pFK,__webpackgi_exports__PopmotionPlugin=__webpackgi_exports__.j9d,__webpackgi_exports__PosePlugin=__webpackgi_exports__.DeC,__webpackgi_exports__PositionalAudio=__webpackgi_exports__.xZx,__webpackgi_exports__PresetGroup=__webpackgi_exports__.ZaL,__webpackgi_exports__PresetLibraryPlugin=__webpackgi_exports__.UwN,__webpackgi_exports__ProgressivePlugin=__webpackgi_exports__.hzf,__webpackgi_exports__PropertyBinding=__webpackgi_exports__.Nwf,__webpackgi_exports__PropertyMixer=__webpackgi_exports__.N2s,__webpackgi_exports__QuadraticBezierCurve=__webpackgi_exports__.dAo,__webpackgi_exports__QuadraticBezierCurve3=__webpackgi_exports__.CV9,__webpackgi_exports__Quaternion=__webpackgi_exports__.PTz,__webpackgi_exports__QuaternionKeyframeTrack=__webpackgi_exports__.MBL,__webpackgi_exports__QuaternionLinearInterpolant=__webpackgi_exports__.GBG,__webpackgi_exports__RED_GREEN_RGTC2_Format=__webpackgi_exports__.HO_,__webpackgi_exports__RED_RGTC1_Format=__webpackgi_exports__.Kef,__webpackgi_exports__REVISION=__webpackgi_exports__.sPf,__webpackgi_exports__RGBADepthPacking=__webpackgi_exports__.N5j,__webpackgi_exports__RGBAFormat=__webpackgi_exports__.GWd,__webpackgi_exports__RGBAIntegerFormat=__webpackgi_exports__.c90,__webpackgi_exports__RGBA_ASTC_10x10_Format=__webpackgi_exports__.y3Z,__webpackgi_exports__RGBA_ASTC_10x5_Format=__webpackgi_exports__.uB5,__webpackgi_exports__RGBA_ASTC_10x6_Format=__webpackgi_exports__.lyL,__webpackgi_exports__RGBA_ASTC_10x8_Format=__webpackgi_exports__.bC7,__webpackgi_exports__RGBA_ASTC_12x10_Format=__webpackgi_exports__.ojs,__webpackgi_exports__RGBA_ASTC_12x12_Format=__webpackgi_exports__.S$4,__webpackgi_exports__RGBA_ASTC_4x4_Format=__webpackgi_exports__.qa3,__webpackgi_exports__RGBA_ASTC_5x4_Format=__webpackgi_exports__.B_h,__webpackgi_exports__RGBA_ASTC_5x5_Format=__webpackgi_exports__.czI,__webpackgi_exports__RGBA_ASTC_6x5_Format=__webpackgi_exports__.rSH,__webpackgi_exports__RGBA_ASTC_6x6_Format=__webpackgi_exports__.Qrf,__webpackgi_exports__RGBA_ASTC_8x5_Format=__webpackgi_exports__.psI,__webpackgi_exports__RGBA_ASTC_8x6_Format=__webpackgi_exports__.a5J,__webpackgi_exports__RGBA_ASTC_8x8_Format=__webpackgi_exports__._QJ,__webpackgi_exports__RGBA_BPTC_Format=__webpackgi_exports__.Fn,__webpackgi_exports__RGBA_ETC2_EAC_Format=__webpackgi_exports__.KDk,__webpackgi_exports__RGBA_PVRTC_2BPPV1_Format=__webpackgi_exports__.pBf,__webpackgi_exports__RGBA_PVRTC_4BPPV1_Format=__webpackgi_exports__.HXV,__webpackgi_exports__RGBA_S3TC_DXT1_Format=__webpackgi_exports__.Nz6,__webpackgi_exports__RGBA_S3TC_DXT3_Format=__webpackgi_exports__.jR7,__webpackgi_exports__RGBA_S3TC_DXT5_Format=__webpackgi_exports__.BXX,__webpackgi_exports__RGBM16ColorSpace=__webpackgi_exports__.DAr,__webpackgi_exports__RGBM16ColorSpace_=__webpackgi_exports__.uC4,__webpackgi_exports__RGB_BPTC_SIGNED_Format=__webpackgi_exports__.H23,__webpackgi_exports__RGB_BPTC_UNSIGNED_Format=__webpackgi_exports__.W9U,__webpackgi_exports__RGB_ETC1_Format=__webpackgi_exports__.CVz,__webpackgi_exports__RGB_ETC2_Format=__webpackgi_exports__.Riy,__webpackgi_exports__RGB_PVRTC_2BPPV1_Format=__webpackgi_exports__.kTp,__webpackgi_exports__RGB_PVRTC_4BPPV1_Format=__webpackgi_exports__.k6Q,__webpackgi_exports__RGB_S3TC_DXT1_Format=__webpackgi_exports__.IE4,__webpackgi_exports__RGFormat=__webpackgi_exports__.paN,__webpackgi_exports__RGIntegerFormat=__webpackgi_exports__.TkQ,__webpackgi_exports__RainbowDiamondPlugin=__webpackgi_exports__.qa1,__webpackgi_exports__RandomizedDirectionalLight=__webpackgi_exports__.EZL,__webpackgi_exports__RandomizedDirectionalLightPlugin=__webpackgi_exports__.fMJ,__webpackgi_exports__RawShaderMaterial=__webpackgi_exports__.D$Q,__webpackgi_exports__Ray=__webpackgi_exports__.RlV,__webpackgi_exports__Raycaster=__webpackgi_exports__.tBo,__webpackgi_exports__Rec709Primaries=__webpackgi_exports__.z5,__webpackgi_exports__RectAreaLight=__webpackgi_exports__.ure,__webpackgi_exports__RedFormat=__webpackgi_exports__.VT0,__webpackgi_exports__RedIntegerFormat=__webpackgi_exports__.ZQM,__webpackgi_exports__Reflector2=__webpackgi_exports__.TyI,__webpackgi_exports__ReinhardToneMapping=__webpackgi_exports__.Mjd,__webpackgi_exports__RenderTarget=__webpackgi_exports__.O0B,__webpackgi_exports__RendererUiPlugin=__webpackgi_exports__.FZz,__webpackgi_exports__RepeatWrapping=__webpackgi_exports__.GJx,__webpackgi_exports__ReplaceStencilOp=__webpackgi_exports__.kG0,__webpackgi_exports__ReverseSubtractEquation=__webpackgi_exports__.nST,__webpackgi_exports__Rhino3dmLoadPlugin=__webpackgi_exports__.AUf,__webpackgi_exports__Rhino3dmLoader2=__webpackgi_exports__.oXQ,__webpackgi_exports__RingGeometry=__webpackgi_exports__.rKP,__webpackgi_exports__RootScene=__webpackgi_exports__.vMJ,__webpackgi_exports__SIGNED_RED_GREEN_RGTC2_Format=__webpackgi_exports__.CWW,__webpackgi_exports__SIGNED_RED_RGTC1_Format=__webpackgi_exports__.XG_,__webpackgi_exports__SRGBColorSpace=__webpackgi_exports__.er$,__webpackgi_exports__SRGBTransfer=__webpackgi_exports__.KLL,__webpackgi_exports__SSAOPlugin=__webpackgi_exports__.ye,__webpackgi_exports__SSBevelPass=__webpackgi_exports__.czS,__webpackgi_exports__SSBevelPlugin=__webpackgi_exports__.UG9,__webpackgi_exports__SSContactShadows=__webpackgi_exports__.aJo,__webpackgi_exports__SSGIPlugin=__webpackgi_exports__.uC9,__webpackgi_exports__SSRPlugin=__webpackgi_exports__.k9M,__webpackgi_exports__STLLoadPlugin=__webpackgi_exports__.fRH,__webpackgi_exports__Scene=__webpackgi_exports__.Z58,__webpackgi_exports__SceneCamerasUiPlugin=__webpackgi_exports__._I4,__webpackgi_exports__SceneLoopPlugin=__webpackgi_exports__.Sr,__webpackgi_exports__ScrollableCameraViewPlugin=__webpackgi_exports__.zx2,__webpackgi_exports__ScrollableCameraViewPreviewPlugin=__webpackgi_exports__.r1V,__webpackgi_exports__SelectionWidget=__webpackgi_exports__.tI0,__webpackgi_exports__ShaderChunk=__webpackgi_exports__.vxI,__webpackgi_exports__ShaderLib=__webpackgi_exports__.zkh,__webpackgi_exports__ShaderMaterial=__webpackgi_exports__.BKk,__webpackgi_exports__ShaderMaterial2=__webpackgi_exports__.rNP,__webpackgi_exports__ShaderMaterialEncodingSupport=__webpackgi_exports__.DkA,__webpackgi_exports__ShaderPass2=__webpackgi_exports__.rpH,__webpackgi_exports__ShadowMapBaker=__webpackgi_exports__.Q4F,__webpackgi_exports__ShadowMaterial=__webpackgi_exports__.q2,__webpackgi_exports__Shape=__webpackgi_exports__.ypk,__webpackgi_exports__ShapeGeometry=__webpackgi_exports__.MSw,__webpackgi_exports__ShapePath=__webpackgi_exports__.Ld9,__webpackgi_exports__ShapeTubeExtrudePlugin=__webpackgi_exports__.YOp,__webpackgi_exports__ShapeUtils=__webpackgi_exports__.xJ6,__webpackgi_exports__ShortType=__webpackgi_exports__.fBL,__webpackgi_exports__SimpleAssetList=__webpackgi_exports__.XTN,__webpackgi_exports__SimpleBackgroundEnvUiPlugin=__webpackgi_exports__.ZXl,__webpackgi_exports__SimpleDataSource=__webpackgi_exports__.O9e,__webpackgi_exports__SimpleEventDispatcher=__webpackgi_exports__.ILd,__webpackgi_exports__SimpleJSONExporter=__webpackgi_exports__.SQN,__webpackgi_exports__SimpleJSONLoader=__webpackgi_exports__.GDD,__webpackgi_exports__SimpleTextExporter=__webpackgi_exports__.HVh,__webpackgi_exports__SimpleTextPlugin=__webpackgi_exports__.X46,__webpackgi_exports__SimpleViewerUi=__webpackgi_exports__.hdr,__webpackgi_exports__SimplifyModifierPlugin=__webpackgi_exports__.CSJ,__webpackgi_exports__Skeleton=__webpackgi_exports__.EAD,__webpackgi_exports__SkeletonHelper=__webpackgi_exports__._xc,__webpackgi_exports__SkinnedMesh=__webpackgi_exports__.I46,__webpackgi_exports__SnowFallPlugin=__webpackgi_exports__.CSm,__webpackgi_exports__Source=__webpackgi_exports__.kLi,__webpackgi_exports__Sphere=__webpackgi_exports__.iyt,__webpackgi_exports__SphereGeometry=__webpackgi_exports__.Gu$,__webpackgi_exports__SphereSelectionWidget=__webpackgi_exports__.s6s,__webpackgi_exports__Spherical=__webpackgi_exports__.YHV,__webpackgi_exports__SphericalHarmonics3=__webpackgi_exports__.xOk,__webpackgi_exports__SplineCurve=__webpackgi_exports__.xfg,__webpackgi_exports__SpotLight=__webpackgi_exports__.nCl,__webpackgi_exports__SpotLight2=__webpackgi_exports__.Hs2,__webpackgi_exports__SpotLightHelper=__webpackgi_exports__.Fpm,__webpackgi_exports__Sprite=__webpackgi_exports__.kxk,__webpackgi_exports__SpriteMaterial=__webpackgi_exports__.RoJ,__webpackgi_exports__SrcAlphaFactor=__webpackgi_exports__.ie2,__webpackgi_exports__SrcAlphaSaturateFactor=__webpackgi_exports__.hgQ,__webpackgi_exports__SrcColorFactor=__webpackgi_exports__.f4X,__webpackgi_exports__StaticCopyUsage=__webpackgi_exports__.Hrq,__webpackgi_exports__StaticDrawUsage=__webpackgi_exports__.agE,__webpackgi_exports__StaticReadUsage=__webpackgi_exports__.uXQ,__webpackgi_exports__StereoCamera=__webpackgi_exports__.keZ,__webpackgi_exports__StreamCopyUsage=__webpackgi_exports__.rOG,__webpackgi_exports__StreamDrawUsage=__webpackgi_exports__.Ktl,__webpackgi_exports__StreamReadUsage=__webpackgi_exports__.uov,__webpackgi_exports__StringKeyframeTrack=__webpackgi_exports__.hZF,__webpackgi_exports__SubtractEquation=__webpackgi_exports__.FXf,__webpackgi_exports__SubtractiveBlending=__webpackgi_exports__.Kwu,__webpackgi_exports__SwitchNodeBasePlugin=__webpackgi_exports__.hv1,__webpackgi_exports__SwitchNodePlugin=__webpackgi_exports__.AqU,__webpackgi_exports__TOUCH=__webpackgi_exports__.wtR,__webpackgi_exports__TYPED_ARRAYS=__webpackgi_exports__.cGs,__webpackgi_exports__TangentSpaceNormalMap=__webpackgi_exports__.bI3,__webpackgi_exports__TemporalAAPlugin=__webpackgi_exports__.afA,__webpackgi_exports__TetrahedronGeometry=__webpackgi_exports__.Zpd,__webpackgi_exports__TextSVGOptions=__webpackgi_exports__.gO_,__webpackgi_exports__Texture=__webpackgi_exports__.gPd,__webpackgi_exports__TextureLoader=__webpackgi_exports__.Tap,__webpackgi_exports__ThinFilmLayerPlugin=__webpackgi_exports__.k4W,__webpackgi_exports__ThreeMaterialLoader=__webpackgi_exports__.ndu,__webpackgi_exports__TonemapPlugin=__webpackgi_exports__.el_,__webpackgi_exports__TorusGeometry=__webpackgi_exports__.O3Y,__webpackgi_exports__TorusKnotGeometry=__webpackgi_exports__.UPV,__webpackgi_exports__TrackballControlsPlugin=__webpackgi_exports__.iu6,__webpackgi_exports__TransformAnimationPlugin=__webpackgi_exports__.Ijk,__webpackgi_exports__TransformControls=__webpackgi_exports__.ZU6,__webpackgi_exports__TransformControls2=__webpackgi_exports__.XXP,__webpackgi_exports__TransformControlsGizmo=__webpackgi_exports__.RQH,__webpackgi_exports__TransformControlsPlane=__webpackgi_exports__.tUF,__webpackgi_exports__TransfrSharePlugin=__webpackgi_exports__.Tww,__webpackgi_exports__Triangle=__webpackgi_exports__.lMl,__webpackgi_exports__TriangleFanDrawMode=__webpackgi_exports__.rYR,__webpackgi_exports__TriangleStripDrawMode=__webpackgi_exports__.O49,__webpackgi_exports__TrianglesDrawMode=__webpackgi_exports__.RJ4,__webpackgi_exports__TriplanarUVMappingPlugin=__webpackgi_exports__.CXS,__webpackgi_exports__TubeGeometry=__webpackgi_exports__.j6,__webpackgi_exports__TubeShapeGeometry=__webpackgi_exports__.G8g,__webpackgi_exports__TweakpaneUiPlugin=__webpackgi_exports__.SOP,__webpackgi_exports__TweakpaneWrapper=__webpackgi_exports__.e2_,__webpackgi_exports__TwoPassDoubleSide=__webpackgi_exports__.GTy,__webpackgi_exports__UChartOptions=__webpackgi_exports__.cOZ,__webpackgi_exports__UPackOptions=__webpackgi_exports__.XxD,__webpackgi_exports__UVMapping=__webpackgi_exports__.UTZ,__webpackgi_exports__Uint16BufferAttribute=__webpackgi_exports__.A$4,__webpackgi_exports__Uint32BufferAttribute=__webpackgi_exports__.MW4,__webpackgi_exports__Uint8BufferAttribute=__webpackgi_exports__.baL,__webpackgi_exports__Uint8ClampedBufferAttribute=__webpackgi_exports__.fc6,__webpackgi_exports__Uncharted2Tonemapping=__webpackgi_exports__.t7h,__webpackgi_exports__Uniform=__webpackgi_exports__.nc$,__webpackgi_exports__UniformsGroup=__webpackgi_exports__.dzP,__webpackgi_exports__UniformsLib=__webpackgi_exports__.fCn,__webpackgi_exports__UniformsUtils=__webpackgi_exports__.LlO,__webpackgi_exports__UnsignedByteType=__webpackgi_exports__.OUM,__webpackgi_exports__UnsignedInt248Type=__webpackgi_exports__.V3x,__webpackgi_exports__UnsignedIntType=__webpackgi_exports__.bkx,__webpackgi_exports__UnsignedShort4444Type=__webpackgi_exports__.Wew,__webpackgi_exports__UnsignedShort5551Type=__webpackgi_exports__.gJ2,__webpackgi_exports__UnsignedShortType=__webpackgi_exports__.cHt,__webpackgi_exports__Unzip=__webpackgi_exports__.HJp,__webpackgi_exports__UnzipInflate=__webpackgi_exports__.mMi,__webpackgi_exports__UnzipPassThrough=__webpackgi_exports__.XLH,__webpackgi_exports__Unzlib=__webpackgi_exports__.TWi,__webpackgi_exports__VJSONPresetGroup=__webpackgi_exports__.DcJ,__webpackgi_exports__VRPluginBasic=__webpackgi_exports__.Kmx,__webpackgi_exports__VSMShadowMap=__webpackgi_exports__.RyA,__webpackgi_exports__VariationConfiguratorEditorUiPlugin=__webpackgi_exports__.NPD,__webpackgi_exports__VariationConfiguratorGridUiPlugin=__webpackgi_exports__.Gpr,__webpackgi_exports__VariationConfiguratorPlugin=__webpackgi_exports__.mKI,__webpackgi_exports__Vector2=__webpackgi_exports__.I9Y,__webpackgi_exports__Vector3=__webpackgi_exports__.Pq0,__webpackgi_exports__Vector4=__webpackgi_exports__.IUQ,__webpackgi_exports__VectorKeyframeTrack=__webpackgi_exports__.RiT,__webpackgi_exports__VelocityBufferPlugin=__webpackgi_exports__.Xkr,__webpackgi_exports__VideoTexture=__webpackgi_exports__.Nv2,__webpackgi_exports__ViewerApp=__webpackgi_exports__.EW5,__webpackgi_exports__ViewerState=__webpackgi_exports__.oJ0,__webpackgi_exports__VignettePlugin=__webpackgi_exports__.Q1b,__webpackgi_exports__VirtualCamerasPlugin=__webpackgi_exports__.jK_,__webpackgi_exports__WaveGroundPlugin=__webpackgi_exports__.gTm,__webpackgi_exports__WebGL1Renderer=__webpackgi_exports__.S3G,__webpackgi_exports__WebGL3DRenderTarget=__webpackgi_exports__.ALV,__webpackgi_exports__WebGLArrayRenderTarget=__webpackgi_exports__.y9J,__webpackgi_exports__WebGLCoordinateSystem=__webpackgi_exports__.TdN,__webpackgi_exports__WebGLCubeRenderTarget=__webpackgi_exports__.o6l,__webpackgi_exports__WebGLMultipleRenderTargets=__webpackgi_exports__.AT1,__webpackgi_exports__WebGLRenderTarget=__webpackgi_exports__.nWS,__webpackgi_exports__WebGLRenderer=__webpackgi_exports__.JeP,__webpackgi_exports__WebGLUtils=__webpackgi_exports__.hfX,__webpackgi_exports__WebGPUCoordinateSystem=__webpackgi_exports__.i7u,__webpackgi_exports__WebGiViewerElement=__webpackgi_exports__.b5D,__webpackgi_exports__WindowiseDialogPlugin=__webpackgi_exports__.Z1R,__webpackgi_exports__Wireframe=__webpackgi_exports__.pWZ,__webpackgi_exports__WireframeGeometry=__webpackgi_exports__.XJ7,__webpackgi_exports__WireframeGeometry2=__webpackgi_exports__.r3D,__webpackgi_exports__WrapAroundEnding=__webpackgi_exports__.dhZ,__webpackgi_exports__XAtlasPlugin=__webpackgi_exports__.$Tl,__webpackgi_exports__ZeroCurvatureEnding=__webpackgi_exports__.rQf,__webpackgi_exports__ZeroFactor=__webpackgi_exports__.ojh,__webpackgi_exports__ZeroSlopeEnding=__webpackgi_exports__.h2z,__webpackgi_exports__ZeroStencilOp=__webpackgi_exports__.kqe,__webpackgi_exports__Zip=__webpackgi_exports__.qQr,__webpackgi_exports__ZipDeflate=__webpackgi_exports__.D8L,__webpackgi_exports__ZipLoader=__webpackgi_exports__.p9O,__webpackgi_exports__ZipPassThrough=__webpackgi_exports__.uZB,__webpackgi_exports__Zlib=__webpackgi_exports__.KK,__webpackgi_exports___SRGBAFormat=__webpackgi_exports__.Ua6,__webpackgi_exports__absMax=__webpackgi_exports__.TYE,__webpackgi_exports__addBasePlugins=__webpackgi_exports__.rQr,__webpackgi_exports__addBloomData=__webpackgi_exports__.$00,__webpackgi_exports__addDracoLoader=__webpackgi_exports__.ued,__webpackgi_exports__addEditorPlugins=__webpackgi_exports__.p$A,__webpackgi_exports__addGLTFExporter=__webpackgi_exports__.m2A,__webpackgi_exports__addGLTFLoader=__webpackgi_exports__.MqB,__webpackgi_exports__addLUTData=__webpackgi_exports__.Dv6,__webpackgi_exports__addRGBELoader=__webpackgi_exports__.f9i,__webpackgi_exports__addSSBevel=__webpackgi_exports__.qHA,__webpackgi_exports__aesGcmDecrypt=__webpackgi_exports__.sQz,__webpackgi_exports__aesGcmEncrypt=__webpackgi_exports__.G52,__webpackgi_exports__afterMain=__webpackgi_exports__.EP1,__webpackgi_exports__afterRead=__webpackgi_exports__.v5N,__webpackgi_exports__afterWrite=__webpackgi_exports__.SET,__webpackgi_exports__angle=__webpackgi_exports__.g7h,__webpackgi_exports__animate=__webpackgi_exports__.i0Z,__webpackgi_exports__animateAsync=__webpackgi_exports__.GcL,__webpackgi_exports__animateObject=__webpackgi_exports__.z67,__webpackgi_exports__animateSet=__webpackgi_exports__.im4,__webpackgi_exports__animateTarget=__webpackgi_exports__.$bx,__webpackgi_exports__anticipate=__webpackgi_exports__.btx,__webpackgi_exports__applyOffset=__webpackgi_exports__.M7c,__webpackgi_exports__applyStyles=__webpackgi_exports__.ZMO,__webpackgi_exports__arrayBufferToBase64=__webpackgi_exports__.YiG,__webpackgi_exports__arrow=__webpackgi_exports__.UE8,__webpackgi_exports__attract=__webpackgi_exports__.uHr,__webpackgi_exports__attractExpo=__webpackgi_exports__.YYK,__webpackgi_exports__auto=__webpackgi_exports__.qZL,__webpackgi_exports__autoCenterObject3D=__webpackgi_exports__.XMb,__webpackgi_exports__autoGPUInstanceMeshes=__webpackgi_exports__.utC,__webpackgi_exports__autoScaleObject3D=__webpackgi_exports__.uO_,__webpackgi_exports__backIn=__webpackgi_exports__.dgX,__webpackgi_exports__backInOut=__webpackgi_exports__.ZZ5,__webpackgi_exports__backOut=__webpackgi_exports__.Szj,__webpackgi_exports__base64ToArrayBuffer=__webpackgi_exports__.Ms4,__webpackgi_exports__basePlacements=__webpackgi_exports__.OMj,__webpackgi_exports__basicMaterialPropList=__webpackgi_exports__.D7g,__webpackgi_exports__beforeMain=__webpackgi_exports__.LG_,__webpackgi_exports__beforeRead=__webpackgi_exports__.cis,__webpackgi_exports__beforeWrite=__webpackgi_exports__.pAB,__webpackgi_exports__blobToDataURL=__webpackgi_exports__.y80,__webpackgi_exports__bottom=__webpackgi_exports__.sQg,__webpackgi_exports__bounceIn=__webpackgi_exports__.ipZ,__webpackgi_exports__bounceInOut=__webpackgi_exports__.wmn,__webpackgi_exports__bounceOut=__webpackgi_exports__.Tel,__webpackgi_exports__buildCSGMeshBSP=__webpackgi_exports__.Q5,__webpackgi_exports__buildCSGMeshBVH=__webpackgi_exports__.b1j,__webpackgi_exports__cLinearToRGBM=__webpackgi_exports__.wzf,__webpackgi_exports__cRGBMToLinear=__webpackgi_exports__.Cq_,__webpackgi_exports__circIn=__webpackgi_exports__.poN,__webpackgi_exports__circInOut=__webpackgi_exports__.tnX,__webpackgi_exports__circOut=__webpackgi_exports__.yT,__webpackgi_exports__clamp=__webpackgi_exports__.qE8,__webpackgi_exports__clippingParents=__webpackgi_exports__.WYS,__webpackgi_exports__colorToDataUrl=__webpackgi_exports__.Cp1,__webpackgi_exports__combineDofShader=__webpackgi_exports__.mz1,__webpackgi_exports__compress=__webpackgi_exports__.Bc,__webpackgi_exports__compressSync=__webpackgi_exports__.oSR,__webpackgi_exports__computeAverageGeometryNormal=__webpackgi_exports__.KJu,__webpackgi_exports__computeEigenVectors=__webpackgi_exports__.G1I,__webpackgi_exports__computeGeometryCenter=__webpackgi_exports__.dXm,__webpackgi_exports__computeGeometrySize=__webpackgi_exports__.lRj,__webpackgi_exports__computeMikkTSpaceTangents=__webpackgi_exports__.WL9,__webpackgi_exports__computeMorphedAttributes=__webpackgi_exports__.OkM,__webpackgi_exports__computeOffsetMatrix=__webpackgi_exports__.kRU,__webpackgi_exports__computeScreenSpaceBoundingBox=__webpackgi_exports__.Xpo,__webpackgi_exports__computeStyles=__webpackgi_exports__.KCp,__webpackgi_exports__copyMaterialUserData=__webpackgi_exports__.a17,__webpackgi_exports__copyObject3DUserData=__webpackgi_exports__.prl,__webpackgi_exports__copyProps=__webpackgi_exports__.ij0,__webpackgi_exports__copyTextureUserData=__webpackgi_exports__.MjE,__webpackgi_exports__createAnticipate=__webpackgi_exports__.bhJ,__webpackgi_exports__createAttractor=__webpackgi_exports__.nMR,__webpackgi_exports__createBackIn=__webpackgi_exports__.p4x,__webpackgi_exports__createCanvasElement=__webpackgi_exports__.lPF,__webpackgi_exports__createDiv=__webpackgi_exports__.SwP,__webpackgi_exports__createExpoIn=__webpackgi_exports__.U2C,__webpackgi_exports__createGenericExtensionClass=__webpackgi_exports__.FOd,__webpackgi_exports__createIFrameCSS3DObject=__webpackgi_exports__.WOM,__webpackgi_exports__createImage=__webpackgi_exports__.mFw,__webpackgi_exports__createPopper=__webpackgi_exports__.n4h,__webpackgi_exports__createPopperBase=__webpackgi_exports__.eRo,__webpackgi_exports__createPopperLite=__webpackgi_exports__.LsR,__webpackgi_exports__createRenderTargetKey=__webpackgi_exports__.tJ,__webpackgi_exports__createScriptFromURL=__webpackgi_exports__.bES,__webpackgi_exports__createStyles=__webpackgi_exports__.rU,__webpackgi_exports__csgOperations=__webpackgi_exports__.omb,__webpackgi_exports__css=__webpackgi_exports__.AHW,__webpackgi_exports__cubicBezier=__webpackgi_exports__.AKs,__webpackgi_exports__dataTextureFromColor=__webpackgi_exports__.VxZ,__webpackgi_exports__dataTextureFromVec4=__webpackgi_exports__.GRd,__webpackgi_exports__decay=__webpackgi_exports__.TVt,__webpackgi_exports__decompress=__webpackgi_exports__.mFv,__webpackgi_exports__decompressSync=__webpackgi_exports__.RqU,__webpackgi_exports__deepAccessObject=__webpackgi_exports__.UKN,__webpackgi_exports__deepCloneAttribute=__webpackgi_exports__.mmZ,__webpackgi_exports__defaultPresets=__webpackgi_exports__.Ikv,__webpackgi_exports__deflate=__webpackgi_exports__.Kcl,__webpackgi_exports__deflateSync=__webpackgi_exports__.pdh,__webpackgi_exports__degreesToRadians=__webpackgi_exports__.tRv,__webpackgi_exports__deinterleaveAttribute=__webpackgi_exports__.nNY,__webpackgi_exports__deinterleaveGeometry=__webpackgi_exports__.LK7,__webpackgi_exports__deserializeObject=__webpackgi_exports__.$q,__webpackgi_exports__deserializers=__webpackgi_exports__.vem,__webpackgi_exports__detectOverflow=__webpackgi_exports__.__B,__webpackgi_exports__diamondMaterialPropList=__webpackgi_exports__.BF2,__webpackgi_exports__distance=__webpackgi_exports__.IoC,__webpackgi_exports__downloadBlob=__webpackgi_exports__.WNF,__webpackgi_exports__downloadFile=__webpackgi_exports__.PE3,__webpackgi_exports__easeIn=__webpackgi_exports__.a6C,__webpackgi_exports__easeInOut=__webpackgi_exports__.am_,__webpackgi_exports__easeOut=__webpackgi_exports__.vTE,__webpackgi_exports__embedUrlRefs=__webpackgi_exports__.VAT,__webpackgi_exports__end=__webpackgi_exports__._N2,__webpackgi_exports__envMapBackground=__webpackgi_exports__.oib,__webpackgi_exports__escapeRegExp=__webpackgi_exports__.NtM,__webpackgi_exports__estimateBytesUsed=__webpackgi_exports__.ru_,__webpackgi_exports__eventListeners=__webpackgi_exports__.GcD,__webpackgi_exports__extractAnimationKey=__webpackgi_exports__.pJG,__webpackgi_exports__flattenUiConfig=__webpackgi_exports__.vxL,__webpackgi_exports__flip=__webpackgi_exports__.UUz,__webpackgi_exports__fontFormatExtensionMap=__webpackgi_exports__.mlk,__webpackgi_exports__generateUiConfig=__webpackgi_exports__.SVi,__webpackgi_exports__generateUiFolder=__webpackgi_exports__.QXJ,__webpackgi_exports__getFileHandle=__webpackgi_exports__.D01,__webpackgi_exports__getFilenameFromPath=__webpackgi_exports__.$7C,__webpackgi_exports__getKeyByValue=__webpackgi_exports__.cdn,__webpackgi_exports__getNewFileHandle=__webpackgi_exports__.vGk,__webpackgi_exports__getOrCall=__webpackgi_exports__.GPz,__webpackgi_exports__getPropertyDescriptor=__webpackgi_exports__.NxN,__webpackgi_exports__getTexelDecoding=__webpackgi_exports__.o7j,__webpackgi_exports__getTexelDecodingFunction=__webpackgi_exports__.yqR,__webpackgi_exports__getTextureDataType=__webpackgi_exports__.U_j,__webpackgi_exports__getTypedArray=__webpackgi_exports__.mB_,__webpackgi_exports__getUrlQueryParam=__webpackgi_exports__.d6c,__webpackgi_exports__glbEncryptionPreparser=__webpackgi_exports__.zhG,__webpackgi_exports__glsl=__webpackgi_exports__.HJb,__webpackgi_exports__gltfExporterMaterialsVariantsExtensionExport=__webpackgi_exports__.e5R,__webpackgi_exports__gunzip=__webpackgi_exports__.kdR,__webpackgi_exports__gunzipSync=__webpackgi_exports__.D85,__webpackgi_exports__gzip=__webpackgi_exports__.ZIX,__webpackgi_exports__gzipSync=__webpackgi_exports__.u3y,__webpackgi_exports__hide=__webpackgi_exports__.jDu,__webpackgi_exports__html=__webpackgi_exports__.qyt,__webpackgi_exports__htmlToCanvas=__webpackgi_exports__.Dtr,__webpackgi_exports__htmlToPng=__webpackgi_exports__.WKP,__webpackgi_exports__htmlToSvg=__webpackgi_exports__.fJV,__webpackgi_exports__iGeometryIgnoredUserData=__webpackgi_exports__.tC7,__webpackgi_exports__iMaterialIgnoredUserData=__webpackgi_exports__.Uan,__webpackgi_exports__iModelIgnoredUserData=__webpackgi_exports__.Uct,__webpackgi_exports__iTextureIgnoredUserData=__webpackgi_exports__.K_U,__webpackgi_exports__imageBitmapToBase64=__webpackgi_exports__.BFA,__webpackgi_exports__imageDataToCanvas=__webpackgi_exports__.BHX,__webpackgi_exports__imageToCanvas=__webpackgi_exports__.Pee,__webpackgi_exports__imageUrlToImageData=__webpackgi_exports__.$If,__webpackgi_exports__includesAll=__webpackgi_exports__.RFY,__webpackgi_exports__inertia=__webpackgi_exports__.Buv,__webpackgi_exports__inflate=__webpackgi_exports__.UDz,__webpackgi_exports__inflateSync=__webpackgi_exports__.HMP,__webpackgi_exports__interleaveAttributes=__webpackgi_exports__.Zg4,__webpackgi_exports__interpolate=__webpackgi_exports__.GWP,__webpackgi_exports__isAnimatableType=__webpackgi_exports__.r58,__webpackgi_exports__isPoint=__webpackgi_exports__.fTC,__webpackgi_exports__isPoint3D=__webpackgi_exports__.YWz,__webpackgi_exports__isPropertyWritable=__webpackgi_exports__.eAs,__webpackgi_exports__keyframes=__webpackgi_exports__.i7C,__webpackgi_exports__khrMaterialsVariantsGLTF=__webpackgi_exports__.jFo,__webpackgi_exports__left=__webpackgi_exports__.kbd,__webpackgi_exports__lerpAngle=__webpackgi_exports__.nU8,__webpackgi_exports__lerpAngle2=__webpackgi_exports__.NFx,__webpackgi_exports__linear=__webpackgi_exports__.sns,__webpackgi_exports__longestCommonPrefix=__webpackgi_exports__.S2G,__webpackgi_exports__main=__webpackgi_exports__.iW4,__webpackgi_exports__makeColorSvg=__webpackgi_exports__.Se$,__webpackgi_exports__makeColorSvgCircle=__webpackgi_exports__.Sop,__webpackgi_exports__makeFilter=__webpackgi_exports__.HNH,__webpackgi_exports__makeSamplerUi=__webpackgi_exports__.jGz,__webpackgi_exports__makeSetterFor=__webpackgi_exports__.ll7,__webpackgi_exports__makeTextSvg=__webpackgi_exports__.SrG,__webpackgi_exports__matDefine=__webpackgi_exports__.UGD,__webpackgi_exports__mergeAttributes=__webpackgi_exports__.KVf,__webpackgi_exports__mergeBufferAttributes=__webpackgi_exports__.gDN,__webpackgi_exports__mergeBufferGeometries=__webpackgi_exports__.h0o,__webpackgi_exports__mergeGeometries=__webpackgi_exports__.pPQ,__webpackgi_exports__mergeGroups=__webpackgi_exports__.hLo,__webpackgi_exports__mergeVertices=__webpackgi_exports__.ecu,__webpackgi_exports__mirrorEasing=__webpackgi_exports__.mhB,__webpackgi_exports__mix=__webpackgi_exports__.jhA,__webpackgi_exports__mixColor=__webpackgi_exports__.iou,__webpackgi_exports__mixComplex=__webpackgi_exports__.JL8,__webpackgi_exports__mobileAndTabletCheck=__webpackgi_exports__.G8Z,__webpackgi_exports__modifierPhases=__webpackgi_exports__.GMB,__webpackgi_exports__now=__webpackgi_exports__.tB5,__webpackgi_exports__objectHasOwn=__webpackgi_exports__.GnX,__webpackgi_exports__offset=__webpackgi_exports__.cYW,__webpackgi_exports__onChange=__webpackgi_exports__.k9K,__webpackgi_exports__onChange2=__webpackgi_exports__.CTC,__webpackgi_exports__onChange3=__webpackgi_exports__.JW6,__webpackgi_exports__parseFileExtension=__webpackgi_exports__.p7C,__webpackgi_exports__patchShaderEncodingSupport=__webpackgi_exports__.OId,__webpackgi_exports__pathJoin=__webpackgi_exports__.CN_,__webpackgi_exports__physicalMaterialPropList=__webpackgi_exports__.uaX,__webpackgi_exports__pipe=__webpackgi_exports__.FsL,__webpackgi_exports__pivotToBBoxCenter=__webpackgi_exports__.gtD,__webpackgi_exports__pivotToPoint=__webpackgi_exports__.wbL,__webpackgi_exports__placements=__webpackgi_exports__.DDu,__webpackgi_exports__pointFromVector=__webpackgi_exports__.O$W,__webpackgi_exports__popper=__webpackgi_exports__.xfb,__webpackgi_exports__popperGenerator=__webpackgi_exports__.UD3,__webpackgi_exports__popperOffsets=__webpackgi_exports__.ZoD,__webpackgi_exports__prettyScrollbar=__webpackgi_exports__.hQ_,__webpackgi_exports__preventOverflow=__webpackgi_exports__.V7C,__webpackgi_exports__processViewer=__webpackgi_exports__.Sow,__webpackgi_exports__progress=__webpackgi_exports__.qB0,__webpackgi_exports__radiansToDegrees=__webpackgi_exports__.nv6,__webpackgi_exports__read=__webpackgi_exports__.LF4,__webpackgi_exports__readFile=__webpackgi_exports__.TAg,__webpackgi_exports__reference=__webpackgi_exports__.irg,__webpackgi_exports__remoteWorkerURL=__webpackgi_exports__.Ei4,__webpackgi_exports__removeDuplicateGeometries=__webpackgi_exports__.Grb,__webpackgi_exports__replaceAll=__webpackgi_exports__.yhl,__webpackgi_exports__reverseEasing=__webpackgi_exports__.Gmo,__webpackgi_exports__right=__webpackgi_exports__.pGT,__webpackgi_exports__rotateDuplicatedMesh=__webpackgi_exports__.Gsh,__webpackgi_exports__sRGBEncoding=__webpackgi_exports__.S2Q,__webpackgi_exports__safeSetProperty=__webpackgi_exports__.pUp,__webpackgi_exports__serializable=__webpackgi_exports__.sU3,__webpackgi_exports__serialize=__webpackgi_exports__.lKg,__webpackgi_exports__serializeObject=__webpackgi_exports__.gwL,__webpackgi_exports__serializeTextureInExtras=__webpackgi_exports__.EBS,__webpackgi_exports__serializers=__webpackgi_exports__.YCG,__webpackgi_exports__setMeshGeometry=__webpackgi_exports__.gC,__webpackgi_exports__setMeshMaterial=__webpackgi_exports__.R5k,__webpackgi_exports__setThreeRendererMode=__webpackgi_exports__.zB$,__webpackgi_exports__setUrlQueryParam=__webpackgi_exports__.dGw,__webpackgi_exports__setupCoreWebGiViewer=__webpackgi_exports__.tNl,__webpackgi_exports__setupIModel=__webpackgi_exports__.AAd,__webpackgi_exports__setupModesStyles=__webpackgi_exports__.YFt,__webpackgi_exports__setupModesUi=__webpackgi_exports__.IRk,__webpackgi_exports__setupObject3dModel=__webpackgi_exports__.ZVX,__webpackgi_exports__setupSandboxWebGiEditor=__webpackgi_exports__.cTN,__webpackgi_exports__shaderReplaceString=__webpackgi_exports__.PlU,__webpackgi_exports__sign2=__webpackgi_exports__.Mi5,__webpackgi_exports__slerp=__webpackgi_exports__.nuN,__webpackgi_exports__smooth=__webpackgi_exports__.Jp2,__webpackgi_exports__smoothFrame=__webpackgi_exports__.oDA,__webpackgi_exports__snap=__webpackgi_exports__.n$K,__webpackgi_exports__snapObject=__webpackgi_exports__.w4b,__webpackgi_exports__sphericalFromObject=__webpackgi_exports__.JVv,__webpackgi_exports__spring=__webpackgi_exports__.ozl,__webpackgi_exports__standardMaterialPropList=__webpackgi_exports__.asH,__webpackgi_exports__start=__webpackgi_exports__.niF,__webpackgi_exports__steps=__webpackgi_exports__.CiD,__webpackgi_exports__strFromU8=__webpackgi_exports__.heq,__webpackgi_exports__strToU8=__webpackgi_exports__._uk,__webpackgi_exports__supportsRequestStreams=__webpackgi_exports__.xrZ,__webpackgi_exports__svgToCanvas=__webpackgi_exports__.aUi,__webpackgi_exports__svgToPng=__webpackgi_exports__.Tmf,__webpackgi_exports__svgUrl=__webpackgi_exports__.AYr,__webpackgi_exports__texImageToCanvas=__webpackgi_exports__.SVO,__webpackgi_exports__textureDataToImageData=__webpackgi_exports__.mBH,__webpackgi_exports__textureToCanvas=__webpackgi_exports__.z73,__webpackgi_exports__textureToDataUrl=__webpackgi_exports__.cyN,__webpackgi_exports__timeout=__webpackgi_exports__.wRz,__webpackgi_exports__toCreasedNormals=__webpackgi_exports__.pbX,__webpackgi_exports__toDecimal=__webpackgi_exports__.nIf,__webpackgi_exports__toIndexedGeometry=__webpackgi_exports__.RY5,__webpackgi_exports__toTitleCase=__webpackgi_exports__.SnO,__webpackgi_exports__toTrianglesDrawMode=__webpackgi_exports__._cJ,__webpackgi_exports__top=__webpackgi_exports__.Mny,__webpackgi_exports__uiButton=__webpackgi_exports__.X0G,__webpackgi_exports__uiColor=__webpackgi_exports__.mBY,__webpackgi_exports__uiConfig=__webpackgi_exports__.rpQ,__webpackgi_exports__uiDropdown=__webpackgi_exports__.exO,__webpackgi_exports__uiFolder=__webpackgi_exports__.rsv,__webpackgi_exports__uiImage=__webpackgi_exports__.gpt,__webpackgi_exports__uiInput=__webpackgi_exports__.hEL,__webpackgi_exports__uiMonitor=__webpackgi_exports__.LIx,__webpackgi_exports__uiPanel=__webpackgi_exports__.Z5F,__webpackgi_exports__uiSlider=__webpackgi_exports__.Eiw,__webpackgi_exports__uiToggle=__webpackgi_exports__.Jx6,__webpackgi_exports__uiVector=__webpackgi_exports__.q00,__webpackgi_exports__uniform=__webpackgi_exports__.PiW,__webpackgi_exports__unzip=__webpackgi_exports__.$15,__webpackgi_exports__unzipSync=__webpackgi_exports__.AOo,__webpackgi_exports__unzlib=__webpackgi_exports__.VTi,__webpackgi_exports__unzlibSync=__webpackgi_exports__.a8Y,__webpackgi_exports__uploadFile=__webpackgi_exports__.QMY,__webpackgi_exports__vLinearToRGBM=__webpackgi_exports__.d5o,__webpackgi_exports__vRGBMToLinear=__webpackgi_exports__.Fxe,__webpackgi_exports__valueToUiType=__webpackgi_exports__.Nan,__webpackgi_exports__variationPlacements=__webpackgi_exports__.Ols,__webpackgi_exports__velocityPerFrame=__webpackgi_exports__.Ovn,__webpackgi_exports__velocityPerSecond=__webpackgi_exports__.fjO,__webpackgi_exports__verifyPermission=__webpackgi_exports__.pZl,__webpackgi_exports__viewport=__webpackgi_exports__.R9T,__webpackgi_exports__wrap=__webpackgi_exports__.LV7,__webpackgi_exports__write=__webpackgi_exports__.M98,__webpackgi_exports__writeFile=__webpackgi_exports__._h9,__webpackgi_exports__zip=__webpackgi_exports__.yU6,__webpackgi_exports__zipSync=__webpackgi_exports__.LaF,__webpackgi_exports__zlib=__webpackgi_exports__.w58,__webpackgi_exports__zlibSync=__webpackgi_exports__.$ax;const WEBGI=Object.freeze(Object.defineProperty({__proto__:null,AAssetManagerProcessStatePlugin:__webpackgi_exports__AAssetManagerProcessStatePlugin,ACESFilmicToneMapping:__webpackgi_exports__ACESFilmicToneMapping,ACameraControlsPlugin:__webpackgi_exports__ACameraControlsPlugin,ACanvasRecorder:__webpackgi_exports__ACanvasRecorder,ALL_WEBGI_EXTENSIONS:__webpackgi_exports__ALL_WEBGI_EXTENSIONS,AMaterialManager:__webpackgi_exports__AMaterialManager,ARPlacementBox:__webpackgi_exports__ARPlacementBox,ARPlugin:__webpackgi_exports__ARPlugin,ARTouchInputHelper:__webpackgi_exports__ARTouchInputHelper,AShaderMaterial2:__webpackgi_exports__AShaderMaterial2,AViewerPlugin:__webpackgi_exports__AViewerPlugin,AWSClientPlugin:__webpackgi_exports__AWSClientPlugin,AddBlendPass:__webpackgi_exports__AddBlendPass,AddEquation:__webpackgi_exports__AddEquation,AddOperation:__webpackgi_exports__AddOperation,AdditiveAnimationBlendMode:__webpackgi_exports__AdditiveAnimationBlendMode,AdditiveBlending:__webpackgi_exports__AdditiveBlending,AlphaFormat:__webpackgi_exports__AlphaFormat,AlwaysCompare:__webpackgi_exports__AlwaysCompare,AlwaysDepth:__webpackgi_exports__AlwaysDepth,AlwaysStencilFunc:__webpackgi_exports__AlwaysStencilFunc,AmbientLight:__webpackgi_exports__AmbientLight,AmbientLight2:__webpackgi_exports__AmbientLight2,AnimationAction:__webpackgi_exports__AnimationAction,AnimationClip:__webpackgi_exports__AnimationClip,AnimationLoader:__webpackgi_exports__AnimationLoader,AnimationMixer:__webpackgi_exports__AnimationMixer,AnimationObjectGroup:__webpackgi_exports__AnimationObjectGroup,AnimationUtils:__webpackgi_exports__AnimationUtils,AnisotropyPlugin:__webpackgi_exports__AnisotropyPlugin,ArcCurve:__webpackgi_exports__ArcCurve,ArrayCamera:__webpackgi_exports__ArrayCamera,ArrowHelper:__webpackgi_exports__ArrowHelper,AssetExporter:__webpackgi_exports__AssetExporter,AssetExporterPlugin:__webpackgi_exports__AssetExporterPlugin,AssetImporter:__webpackgi_exports__AssetImporter,AssetManagerBasicPopupPlugin:__webpackgi_exports__AssetManagerBasicPopupPlugin,AssetManagerLoadingBarPlugin:__webpackgi_exports__AssetManagerLoadingBarPlugin,AssetManagerPlugin:__webpackgi_exports__AssetManagerPlugin,AsyncCompress:__webpackgi_exports__AsyncCompress,AsyncDecompress:__webpackgi_exports__AsyncDecompress,AsyncDeflate:__webpackgi_exports__AsyncDeflate,AsyncGunzip:__webpackgi_exports__AsyncGunzip,AsyncGzip:__webpackgi_exports__AsyncGzip,AsyncInflate:__webpackgi_exports__AsyncInflate,AsyncUnzipInflate:__webpackgi_exports__AsyncUnzipInflate,AsyncUnzlib:__webpackgi_exports__AsyncUnzlib,AsyncZipDeflate:__webpackgi_exports__AsyncZipDeflate,AsyncZlib:__webpackgi_exports__AsyncZlib,Audio:__webpackgi_exports__Audio,AudioAnalyser:__webpackgi_exports__AudioAnalyser,AudioContext:__webpackgi_exports__AudioContext,AudioListener:__webpackgi_exports__AudioListener,AudioLoader:__webpackgi_exports__AudioLoader,AxesHelper:__webpackgi_exports__AxesHelper,BackSide:__webpackgi_exports__BackSide,BackgroundPresetGroup:__webpackgi_exports__BackgroundPresetGroup,BaseGroundPlugin:__webpackgi_exports__BaseGroundPlugin,BaseRenderer:__webpackgi_exports__BaseRenderer,BasicDepthPacking:__webpackgi_exports__BasicDepthPacking,BasicShadowMap:__webpackgi_exports__BasicShadowMap,BeringRingAnimation:__webpackgi_exports__BeringRingAnimation,BlobLoader:__webpackgi_exports__BlobLoader,BloomPlugin:__webpackgi_exports__BloomPlugin,Bone:__webpackgi_exports__Bone,BooleanKeyframeTrack:__webpackgi_exports__BooleanKeyframeTrack,Box2:__webpackgi_exports__Box2,Box3:__webpackgi_exports__Box3,Box3B:__webpackgi_exports__Box3B,Box3Helper:__webpackgi_exports__Box3Helper,BoxGeometry:__webpackgi_exports__BoxGeometry,BoxHelper:__webpackgi_exports__BoxHelper,BoxSelectionWidget:__webpackgi_exports__BoxSelectionWidget,BufferAttribute:__webpackgi_exports__BufferAttribute,BufferGeometry:__webpackgi_exports__BufferGeometry,BufferGeometryLoader:__webpackgi_exports__BufferGeometryLoader,ByteType:__webpackgi_exports__ByteType,CSGPluginBSP:__webpackgi_exports__CSGPluginBSP,CSGPluginBVH:__webpackgi_exports__CSGPluginBVH,CSGPluginBase:__webpackgi_exports__CSGPluginBase,CSS3DRendererPlugin:__webpackgi_exports__CSS3DRendererPlugin,Cache:__webpackgi_exports__Cache,Camera:__webpackgi_exports__Camera,CameraController:__webpackgi_exports__CameraController,CameraHelper:__webpackgi_exports__CameraHelper,CameraUiPlugin:__webpackgi_exports__CameraUiPlugin,CameraView:__webpackgi_exports__CameraView,CameraViewControlPlugin:__webpackgi_exports__CameraViewControlPlugin,CameraViewPlugin:__webpackgi_exports__CameraViewPlugin,CannonPhysicsPlugin:__webpackgi_exports__CannonPhysicsPlugin,CanvasMediaRecorder:__webpackgi_exports__CanvasMediaRecorder,CanvasRecorder:__webpackgi_exports__CanvasRecorder,CanvasRecorderPlugin:__webpackgi_exports__CanvasRecorderPlugin,CanvasSnipper:__webpackgi_exports__CanvasSnipper,CanvasSnipperPlugin:__webpackgi_exports__CanvasSnipperPlugin,CanvasTexture:__webpackgi_exports__CanvasTexture,CapsuleGeometry:__webpackgi_exports__CapsuleGeometry,CatmullRomCurve3:__webpackgi_exports__CatmullRomCurve3,ChromaticAberrationPlugin:__webpackgi_exports__ChromaticAberrationPlugin,CineonToneMapping:__webpackgi_exports__CineonToneMapping,CircleGeometry:__webpackgi_exports__CircleGeometry,ClampToEdgeWrapping:__webpackgi_exports__ClampToEdgeWrapping,ClearcoatTintPlugin:__webpackgi_exports__ClearcoatTintPlugin,Clock:__webpackgi_exports__Clock,Color:__webpackgi_exports__Color,ColorKeyframeTrack:__webpackgi_exports__ColorKeyframeTrack,ColorManagement:__webpackgi_exports__ColorManagement,CombinedPostPlugin:__webpackgi_exports__CombinedPostPlugin,Compress:__webpackgi_exports__Compress,CompressedArrayTexture:__webpackgi_exports__CompressedArrayTexture,CompressedCubeTexture:__webpackgi_exports__CompressedCubeTexture,CompressedTexture:__webpackgi_exports__CompressedTexture,CompressedTextureLoader:__webpackgi_exports__CompressedTextureLoader,ConeGeometry:__webpackgi_exports__ConeGeometry,ContactShadowGroundPlugin:__webpackgi_exports__ContactShadowGroundPlugin,CoreEditorApp:__webpackgi_exports__CoreEditorApp,CoreViewerApp:__webpackgi_exports__CoreViewerApp,CubeCamera:__webpackgi_exports__CubeCamera,CubeNormalsCaptureHelper:__webpackgi_exports__CubeNormalsCaptureHelper,CubeReflectionMapping:__webpackgi_exports__CubeReflectionMapping,CubeRefractionMapping:__webpackgi_exports__CubeRefractionMapping,CubeTexture:__webpackgi_exports__CubeTexture,CubeTextureLoader:__webpackgi_exports__CubeTextureLoader,CubeUVReflectionMapping:__webpackgi_exports__CubeUVReflectionMapping,CubicBezierCurve:__webpackgi_exports__CubicBezierCurve,CubicBezierCurve3:__webpackgi_exports__CubicBezierCurve3,CubicInterpolant:__webpackgi_exports__CubicInterpolant,CullFaceBack:__webpackgi_exports__CullFaceBack,CullFaceFront:__webpackgi_exports__CullFaceFront,CullFaceFrontBack:__webpackgi_exports__CullFaceFrontBack,CullFaceNone:__webpackgi_exports__CullFaceNone,Curve:__webpackgi_exports__Curve,CurvePath:__webpackgi_exports__CurvePath,CustomAnimationHelper:__webpackgi_exports__CustomAnimationHelper,CustomAnimationHelperPlugin:__webpackgi_exports__CustomAnimationHelperPlugin,CustomBlending:__webpackgi_exports__CustomBlending,CustomBumpMapPlugin:__webpackgi_exports__CustomBumpMapPlugin,CustomToneMapping:__webpackgi_exports__CustomToneMapping,CylinderGeometry:__webpackgi_exports__CylinderGeometry,Cylindrical:__webpackgi_exports__Cylindrical,DRACOLoader2:__webpackgi_exports__DRACOLoader2,Damper:__webpackgi_exports__Damper,Data3DTexture:__webpackgi_exports__Data3DTexture,DataArrayTexture:__webpackgi_exports__DataArrayTexture,DataTexture:__webpackgi_exports__DataTexture,DataTextureLoader:__webpackgi_exports__DataTextureLoader,DataUrlLoader:__webpackgi_exports__DataUrlLoader,DataUtils:__webpackgi_exports__DataUtils,DebugPlugin:__webpackgi_exports__DebugPlugin,DecodeUTF8:__webpackgi_exports__DecodeUTF8,Decompress:__webpackgi_exports__Decompress,DecrementStencilOp:__webpackgi_exports__DecrementStencilOp,DecrementWrapStencilOp:__webpackgi_exports__DecrementWrapStencilOp,DefaultLoadingManager:__webpackgi_exports__DefaultLoadingManager,Deflate:__webpackgi_exports__Deflate,DepthFormat:__webpackgi_exports__DepthFormat,DepthOfFieldPass:__webpackgi_exports__DepthOfFieldPass,DepthOfFieldPlugin:__webpackgi_exports__DepthOfFieldPlugin,DepthStencilFormat:__webpackgi_exports__DepthStencilFormat,DepthTexture:__webpackgi_exports__DepthTexture,DeviceOrientationControls2:__webpackgi_exports__DeviceOrientationControls2,DeviceOrientationControlsPlugin:__webpackgi_exports__DeviceOrientationControlsPlugin,DiamondMaterial:__webpackgi_exports__DiamondMaterial,DiamondPlugin:__webpackgi_exports__DiamondPlugin,DirectionalLight:__webpackgi_exports__DirectionalLight,DirectionalLight2:__webpackgi_exports__DirectionalLight2,DirectionalLightHelper:__webpackgi_exports__DirectionalLightHelper,DiscreteInterpolant:__webpackgi_exports__DiscreteInterpolant,DisplayP3ColorSpace:__webpackgi_exports__DisplayP3ColorSpace,DodecahedronGeometry:__webpackgi_exports__DodecahedronGeometry,DoubleSide:__webpackgi_exports__DoubleSide,Dropzone:__webpackgi_exports__Dropzone,DropzonePlugin:__webpackgi_exports__DropzonePlugin,DstAlphaFactor:__webpackgi_exports__DstAlphaFactor,DstColorFactor:__webpackgi_exports__DstColorFactor,DynamicCopyUsage:__webpackgi_exports__DynamicCopyUsage,DynamicDrawUsage:__webpackgi_exports__DynamicDrawUsage,DynamicReadUsage:__webpackgi_exports__DynamicReadUsage,EXRExporter2:__webpackgi_exports__EXRExporter2,EXRLoadPlugin:__webpackgi_exports__EXRLoadPlugin,EasingFunctions:__webpackgi_exports__EasingFunctions,EdgesGeometry:__webpackgi_exports__EdgesGeometry,EffectComposer2:__webpackgi_exports__EffectComposer2,EllipseCurve:__webpackgi_exports__EllipseCurve,EllipseCurve3D:__webpackgi_exports__EllipseCurve3D,EncodeUTF8:__webpackgi_exports__EncodeUTF8,EncoderMethod:__webpackgi_exports__EncoderMethod,EnvironmentPresetGroup:__webpackgi_exports__EnvironmentPresetGroup,EqualCompare:__webpackgi_exports__EqualCompare,EqualDepth:__webpackgi_exports__EqualDepth,EqualStencilFunc:__webpackgi_exports__EqualStencilFunc,EquirectangularReflectionMapping:__webpackgi_exports__EquirectangularReflectionMapping,EquirectangularRefractionMapping:__webpackgi_exports__EquirectangularRefractionMapping,Euler:__webpackgi_exports__Euler,EventDispatcher:__webpackgi_exports__EventDispatcher,ExtrasUiPlugin:__webpackgi_exports__ExtrasUiPlugin,ExtrudeGeometry:__webpackgi_exports__ExtrudeGeometry,FBXLoadPlugin:__webpackgi_exports__FBXLoadPlugin,FFMPEGRecorder:__webpackgi_exports__FFMPEGRecorder,FSShadowMaterial:__webpackgi_exports__FSShadowMaterial,FileLoader:__webpackgi_exports__FileLoader,FileTransferPlugin:__webpackgi_exports__FileTransferPlugin,FilmicGrainPlugin:__webpackgi_exports__FilmicGrainPlugin,FirstPersonControls2:__webpackgi_exports__FirstPersonControls2,FirstPersonControlsPlugin:__webpackgi_exports__FirstPersonControlsPlugin,Float16BufferAttribute:__webpackgi_exports__Float16BufferAttribute,Float32BufferAttribute:__webpackgi_exports__Float32BufferAttribute,Float64BufferAttribute:__webpackgi_exports__Float64BufferAttribute,FloatType:__webpackgi_exports__FloatType,Fog:__webpackgi_exports__Fog,FogExp2:__webpackgi_exports__FogExp2,FragmentClippingExtensionPlugin:__webpackgi_exports__FragmentClippingExtensionPlugin,FragmentClippingMode:__webpackgi_exports__FragmentClippingMode,FrameFadePlugin:__webpackgi_exports__FrameFadePlugin,FramebufferTexture:__webpackgi_exports__FramebufferTexture,FrontSide:__webpackgi_exports__FrontSide,Frustum:__webpackgi_exports__Frustum,FullScreenPlugin:__webpackgi_exports__FullScreenPlugin,GBufferPlugin:__webpackgi_exports__GBufferPlugin,GLBufferAttribute:__webpackgi_exports__GLBufferAttribute,GLSL1:__webpackgi_exports__GLSL1,GLSL3:__webpackgi_exports__GLSL3,GLTFAnimationPlugin:__webpackgi_exports__GLTFAnimationPlugin,GLTFDracoExportPlugin:__webpackgi_exports__GLTFDracoExportPlugin,GLTFDracoExporter:__webpackgi_exports__GLTFDracoExporter,GLTFExporter2:__webpackgi_exports__GLTFExporter2,GLTFExporterMaterialsVariantsExtensionExport:__webpackgi_exports__GLTFExporterMaterialsVariantsExtensionExport,GLTFKHRMaterialVariantsPlugin:__webpackgi_exports__GLTFKHRMaterialVariantsPlugin,GLTFLoader2:__webpackgi_exports__GLTFLoader2,GLTFMaterialsVariantsExtensionImport:__webpackgi_exports__GLTFMaterialsVariantsExtensionImport,GLTFMeshGpuInstancingExporter:__webpackgi_exports__GLTFMeshGpuInstancingExporter,GLTFMeshOptPlugin:__webpackgi_exports__GLTFMeshOptPlugin,GLTFSpecGlossinessConverterPlugin:__webpackgi_exports__GLTFSpecGlossinessConverterPlugin,GLTFWriter2:__webpackgi_exports__GLTFWriter2,GammaCorrectionExtension:__webpackgi_exports__GammaCorrectionExtension,GammaCorrectionPlugin:__webpackgi_exports__GammaCorrectionPlugin,GemEnvironmentPresetGroup:__webpackgi_exports__GemEnvironmentPresetGroup,GenericBlendTexturePass:__webpackgi_exports__GenericBlendTexturePass,GenericFilterPlugin:__webpackgi_exports__GenericFilterPlugin,GeometryGeneratorPlugin:__webpackgi_exports__GeometryGeneratorPlugin,GreaterCompare:__webpackgi_exports__GreaterCompare,GreaterDepth:__webpackgi_exports__GreaterDepth,GreaterEqualCompare:__webpackgi_exports__GreaterEqualCompare,GreaterEqualDepth:__webpackgi_exports__GreaterEqualDepth,GreaterEqualStencilFunc:__webpackgi_exports__GreaterEqualStencilFunc,GreaterStencilFunc:__webpackgi_exports__GreaterStencilFunc,GridHelper:__webpackgi_exports__GridHelper,GroundPlugin:__webpackgi_exports__GroundPlugin,Group:__webpackgi_exports__Group,Gunzip:__webpackgi_exports__Gunzip,GyroInputDevice:__webpackgi_exports__GyroInputDevice,Gzip:__webpackgi_exports__Gzip,HDRiGroundPlugin:__webpackgi_exports__HDRiGroundPlugin,HalfFloatType:__webpackgi_exports__HalfFloatType,HemisphereLight:__webpackgi_exports__HemisphereLight,HemisphereLightHelper:__webpackgi_exports__HemisphereLightHelper,HierarchyUiPlugin:__webpackgi_exports__HierarchyUiPlugin,IcosahedronGeometry:__webpackgi_exports__IcosahedronGeometry,ImageBitmapLoader:__webpackgi_exports__ImageBitmapLoader,ImageLoader:__webpackgi_exports__ImageLoader,ImageSequenceRecorder:__webpackgi_exports__ImageSequenceRecorder,ImageUtils:__webpackgi_exports__ImageUtils,Importer:__webpackgi_exports__Importer,IncrementStencilOp:__webpackgi_exports__IncrementStencilOp,IncrementWrapStencilOp:__webpackgi_exports__IncrementWrapStencilOp,Inflate:__webpackgi_exports__Inflate,InstancedBufferAttribute:__webpackgi_exports__InstancedBufferAttribute,InstancedBufferGeometry:__webpackgi_exports__InstancedBufferGeometry,InstancedInterleavedBuffer:__webpackgi_exports__InstancedInterleavedBuffer,InstancedMesh:__webpackgi_exports__InstancedMesh,Int16BufferAttribute:__webpackgi_exports__Int16BufferAttribute,Int32BufferAttribute:__webpackgi_exports__Int32BufferAttribute,Int8BufferAttribute:__webpackgi_exports__Int8BufferAttribute,IntType:__webpackgi_exports__IntType,InteractionPromptPlugin:__webpackgi_exports__InteractionPromptPlugin,InterleavedBuffer:__webpackgi_exports__InterleavedBuffer,InterleavedBufferAttribute:__webpackgi_exports__InterleavedBufferAttribute,Interpolant:__webpackgi_exports__Interpolant,InterpolateDiscrete:__webpackgi_exports__InterpolateDiscrete,InterpolateLinear:__webpackgi_exports__InterpolateLinear,InterpolateSmooth:__webpackgi_exports__InterpolateSmooth,InvertStencilOp:__webpackgi_exports__InvertStencilOp,KHR_TEXTURE_BASISU:__webpackgi_exports__KHR_TEXTURE_BASISU,KTX2LoadPlugin:__webpackgi_exports__KTX2LoadPlugin,KTXLoadPlugin:__webpackgi_exports__KTXLoadPlugin,KeepStencilOp:__webpackgi_exports__KeepStencilOp,KeyframeTrack:__webpackgi_exports__KeyframeTrack,LOD:__webpackgi_exports__LOD,LUTPlugin:__webpackgi_exports__LUTPlugin,LatheGeometry:__webpackgi_exports__LatheGeometry,LayeredMaterialPlugin:__webpackgi_exports__LayeredMaterialPlugin,Layers:__webpackgi_exports__Layers,LessCompare:__webpackgi_exports__LessCompare,LessDepth:__webpackgi_exports__LessDepth,LessEqualCompare:__webpackgi_exports__LessEqualCompare,LessEqualDepth:__webpackgi_exports__LessEqualDepth,LessEqualStencilFunc:__webpackgi_exports__LessEqualStencilFunc,LessStencilFunc:__webpackgi_exports__LessStencilFunc,Light:__webpackgi_exports__Light,LightProbe:__webpackgi_exports__LightProbe,LightsUiPlugin:__webpackgi_exports__LightsUiPlugin,Line:__webpackgi_exports__Line,Line2:__webpackgi_exports__Line2,Line3:__webpackgi_exports__Line3,LineBasicMaterial:__webpackgi_exports__LineBasicMaterial,LineCurve:__webpackgi_exports__LineCurve,LineCurve3:__webpackgi_exports__LineCurve3,LineDashedMaterial:__webpackgi_exports__LineDashedMaterial,LineGeometry:__webpackgi_exports__LineGeometry,LineLoop:__webpackgi_exports__LineLoop,LineMaterial:__webpackgi_exports__LineMaterial,LineSegments:__webpackgi_exports__LineSegments,LineSegments2:__webpackgi_exports__LineSegments2,LineSegmentsGeometry:__webpackgi_exports__LineSegmentsGeometry,LinearDisplayP3ColorSpace:__webpackgi_exports__LinearDisplayP3ColorSpace,LinearEncoding:__webpackgi_exports__LinearEncoding,LinearFilter:__webpackgi_exports__LinearFilter,LinearInterpolant:__webpackgi_exports__LinearInterpolant,LinearMipMapLinearFilter:__webpackgi_exports__LinearMipMapLinearFilter,LinearMipMapNearestFilter:__webpackgi_exports__LinearMipMapNearestFilter,LinearMipmapLinearFilter:__webpackgi_exports__LinearMipmapLinearFilter,LinearMipmapNearestFilter:__webpackgi_exports__LinearMipmapNearestFilter,LinearSRGBColorSpace:__webpackgi_exports__LinearSRGBColorSpace,LinearToneMapping:__webpackgi_exports__LinearToneMapping,LinearTransfer:__webpackgi_exports__LinearTransfer,Loader:__webpackgi_exports__Loader,LoaderUtils:__webpackgi_exports__LoaderUtils,LoadingManager:__webpackgi_exports__LoadingManager,LoadingScreenPlugin:__webpackgi_exports__LoadingScreenPlugin,LoopOnce:__webpackgi_exports__LoopOnce,LoopPingPong:__webpackgi_exports__LoopPingPong,LoopRepeat:__webpackgi_exports__LoopRepeat,LuminanceAlphaFormat:__webpackgi_exports__LuminanceAlphaFormat,LuminanceFormat:__webpackgi_exports__LuminanceFormat,MOUSE:__webpackgi_exports__MOUSE,MTLLoader2:__webpackgi_exports__MTLLoader2,Material:__webpackgi_exports__Material,MaterialConfiguratorBasePlugin:__webpackgi_exports__MaterialConfiguratorBasePlugin,MaterialConfiguratorPlugin:__webpackgi_exports__MaterialConfiguratorPlugin,MaterialExtender:__webpackgi_exports__MaterialExtender,MaterialLibPresetGroupPresetGroup:__webpackgi_exports__MaterialLibPresetGroupPresetGroup,MaterialLibraryBasePlugin:__webpackgi_exports__MaterialLibraryBasePlugin,MaterialLibraryPlugin:__webpackgi_exports__MaterialLibraryPlugin,MaterialLoader:__webpackgi_exports__MaterialLoader,MaterialManager:__webpackgi_exports__MaterialManager,MaterialPresetPlugin:__webpackgi_exports__MaterialPresetPlugin,MaterialPreviewGenerator:__webpackgi_exports__MaterialPreviewGenerator,MathUtils:__webpackgi_exports__MathUtils,Matrix3:__webpackgi_exports__Matrix3,Matrix4:__webpackgi_exports__Matrix4,MaxEquation:__webpackgi_exports__MaxEquation,Mesh:__webpackgi_exports__Mesh,MeshBasicMaterial:__webpackgi_exports__MeshBasicMaterial,MeshBasicMaterial2:__webpackgi_exports__MeshBasicMaterial2,MeshDepthMaterial:__webpackgi_exports__MeshDepthMaterial,MeshDistanceMaterial:__webpackgi_exports__MeshDistanceMaterial,MeshLambertMaterial:__webpackgi_exports__MeshLambertMaterial,MeshMatcapMaterial:__webpackgi_exports__MeshMatcapMaterial,MeshNormalMaterial:__webpackgi_exports__MeshNormalMaterial,MeshOptSimplifyModifierPlugin:__webpackgi_exports__MeshOptSimplifyModifierPlugin,MeshPhongMaterial:__webpackgi_exports__MeshPhongMaterial,MeshPhysicalMaterial:__webpackgi_exports__MeshPhysicalMaterial,MeshStandardMaterial:__webpackgi_exports__MeshStandardMaterial,MeshStandardMaterial2:__webpackgi_exports__MeshStandardMaterial2,MeshToonMaterial:__webpackgi_exports__MeshToonMaterial,MinEquation:__webpackgi_exports__MinEquation,MirroredRepeatWrapping:__webpackgi_exports__MirroredRepeatWrapping,MixOperation:__webpackgi_exports__MixOperation,ModelStagePlugin:__webpackgi_exports__ModelStagePlugin,ModelStagePresetGroup:__webpackgi_exports__ModelStagePresetGroup,MouseInputDevice:__webpackgi_exports__MouseInputDevice,MultiFilterPlugin:__webpackgi_exports__MultiFilterPlugin,MultiplyBlending:__webpackgi_exports__MultiplyBlending,MultiplyOperation:__webpackgi_exports__MultiplyOperation,NearestFilter:__webpackgi_exports__NearestFilter,NearestMipMapLinearFilter:__webpackgi_exports__NearestMipMapLinearFilter,NearestMipMapNearestFilter:__webpackgi_exports__NearestMipMapNearestFilter,NearestMipmapLinearFilter:__webpackgi_exports__NearestMipmapLinearFilter,NearestMipmapNearestFilter:__webpackgi_exports__NearestMipmapNearestFilter,NeverCompare:__webpackgi_exports__NeverCompare,NeverDepth:__webpackgi_exports__NeverDepth,NeverStencilFunc:__webpackgi_exports__NeverStencilFunc,NoBlending:__webpackgi_exports__NoBlending,NoColorSpace:__webpackgi_exports__NoColorSpace,NoToneMapping:__webpackgi_exports__NoToneMapping,NoiseBumpMaterialPlugin:__webpackgi_exports__NoiseBumpMaterialPlugin,NormalAnimationBlendMode:__webpackgi_exports__NormalAnimationBlendMode,NormalBlending:__webpackgi_exports__NormalBlending,NormalBufferPlugin:__webpackgi_exports__NormalBufferPlugin,NormalCaptureMaterial:__webpackgi_exports__NormalCaptureMaterial,NotEqualCompare:__webpackgi_exports__NotEqualCompare,NotEqualDepth:__webpackgi_exports__NotEqualDepth,NotEqualStencilFunc:__webpackgi_exports__NotEqualStencilFunc,NumberKeyframeTrack:__webpackgi_exports__NumberKeyframeTrack,OBJLoader2:__webpackgi_exports__OBJLoader2,ObjMtlLoadPlugin:__webpackgi_exports__ObjMtlLoadPlugin,Object3D:__webpackgi_exports__Object3D,Object3DModel:__webpackgi_exports__Object3DModel,Object3DWidgetsPlugin:__webpackgi_exports__Object3DWidgetsPlugin,ObjectLoader:__webpackgi_exports__ObjectLoader,ObjectLoader2:__webpackgi_exports__ObjectLoader2,ObjectPicker:__webpackgi_exports__ObjectPicker,ObjectProcessorMap:__webpackgi_exports__ObjectProcessorMap,ObjectRotationPlugin:__webpackgi_exports__ObjectRotationPlugin,ObjectSpaceNormalMap:__webpackgi_exports__ObjectSpaceNormalMap,OctahedronGeometry:__webpackgi_exports__OctahedronGeometry,OneFactor:__webpackgi_exports__OneFactor,OneMinusDstAlphaFactor:__webpackgi_exports__OneMinusDstAlphaFactor,OneMinusDstColorFactor:__webpackgi_exports__OneMinusDstColorFactor,OneMinusSrcAlphaFactor:__webpackgi_exports__OneMinusSrcAlphaFactor,OneMinusSrcColorFactor:__webpackgi_exports__OneMinusSrcColorFactor,OrbitControls2:__webpackgi_exports__OrbitControls2,OrbitControls3:__webpackgi_exports__OrbitControls3,OrthographicCamera:__webpackgi_exports__OrthographicCamera,OutlinePlugin:__webpackgi_exports__OutlinePlugin,P3Primaries:__webpackgi_exports__P3Primaries,PCFShadowMap:__webpackgi_exports__PCFShadowMap,PCFSoftShadowMap:__webpackgi_exports__PCFSoftShadowMap,PMREMGenerator:__webpackgi_exports__PMREMGenerator,PMREMGeneratorPlugin:__webpackgi_exports__PMREMGeneratorPlugin,ParallaxCameraControllerPlugin:__webpackgi_exports__ParallaxCameraControllerPlugin,ParallaxMappingPlugin:__webpackgi_exports__ParallaxMappingPlugin,Path:__webpackgi_exports__Path,PerspectiveCamera:__webpackgi_exports__PerspectiveCamera,PickingPlugin:__webpackgi_exports__PickingPlugin,Plane:__webpackgi_exports__Plane,PlaneGeometry:__webpackgi_exports__PlaneGeometry,PlaneHelper:__webpackgi_exports__PlaneHelper,PluginPresetGroup:__webpackgi_exports__PluginPresetGroup,PointLight:__webpackgi_exports__PointLight,PointLight2:__webpackgi_exports__PointLight2,PointLightHelper:__webpackgi_exports__PointLightHelper,PointerDragHelper:__webpackgi_exports__PointerDragHelper,PointerLockControls2:__webpackgi_exports__PointerLockControls2,PointerLockControlsPlugin:__webpackgi_exports__PointerLockControlsPlugin,Points:__webpackgi_exports__Points,PointsMaterial:__webpackgi_exports__PointsMaterial,PolarGridHelper:__webpackgi_exports__PolarGridHelper,PolyhedronGeometry:__webpackgi_exports__PolyhedronGeometry,PopmotionPlugin:__webpackgi_exports__PopmotionPlugin,PosePlugin:__webpackgi_exports__PosePlugin,PositionalAudio:__webpackgi_exports__PositionalAudio,PresetGroup:__webpackgi_exports__PresetGroup,PresetLibraryPlugin:__webpackgi_exports__PresetLibraryPlugin,ProgressivePlugin:__webpackgi_exports__ProgressivePlugin,PropertyBinding:__webpackgi_exports__PropertyBinding,PropertyMixer:__webpackgi_exports__PropertyMixer,QuadraticBezierCurve:__webpackgi_exports__QuadraticBezierCurve,QuadraticBezierCurve3:__webpackgi_exports__QuadraticBezierCurve3,Quaternion:__webpackgi_exports__Quaternion,QuaternionKeyframeTrack:__webpackgi_exports__QuaternionKeyframeTrack,QuaternionLinearInterpolant:__webpackgi_exports__QuaternionLinearInterpolant,RED_GREEN_RGTC2_Format:__webpackgi_exports__RED_GREEN_RGTC2_Format,RED_RGTC1_Format:__webpackgi_exports__RED_RGTC1_Format,REVISION:__webpackgi_exports__REVISION,RGBADepthPacking:__webpackgi_exports__RGBADepthPacking,RGBAFormat:__webpackgi_exports__RGBAFormat,RGBAIntegerFormat:__webpackgi_exports__RGBAIntegerFormat,RGBA_ASTC_10x10_Format:__webpackgi_exports__RGBA_ASTC_10x10_Format,RGBA_ASTC_10x5_Format:__webpackgi_exports__RGBA_ASTC_10x5_Format,RGBA_ASTC_10x6_Format:__webpackgi_exports__RGBA_ASTC_10x6_Format,RGBA_ASTC_10x8_Format:__webpackgi_exports__RGBA_ASTC_10x8_Format,RGBA_ASTC_12x10_Format:__webpackgi_exports__RGBA_ASTC_12x10_Format,RGBA_ASTC_12x12_Format:__webpackgi_exports__RGBA_ASTC_12x12_Format,RGBA_ASTC_4x4_Format:__webpackgi_exports__RGBA_ASTC_4x4_Format,RGBA_ASTC_5x4_Format:__webpackgi_exports__RGBA_ASTC_5x4_Format,RGBA_ASTC_5x5_Format:__webpackgi_exports__RGBA_ASTC_5x5_Format,RGBA_ASTC_6x5_Format:__webpackgi_exports__RGBA_ASTC_6x5_Format,RGBA_ASTC_6x6_Format:__webpackgi_exports__RGBA_ASTC_6x6_Format,RGBA_ASTC_8x5_Format:__webpackgi_exports__RGBA_ASTC_8x5_Format,RGBA_ASTC_8x6_Format:__webpackgi_exports__RGBA_ASTC_8x6_Format,RGBA_ASTC_8x8_Format:__webpackgi_exports__RGBA_ASTC_8x8_Format,RGBA_BPTC_Format:__webpackgi_exports__RGBA_BPTC_Format,RGBA_ETC2_EAC_Format:__webpackgi_exports__RGBA_ETC2_EAC_Format,RGBA_PVRTC_2BPPV1_Format:__webpackgi_exports__RGBA_PVRTC_2BPPV1_Format,RGBA_PVRTC_4BPPV1_Format:__webpackgi_exports__RGBA_PVRTC_4BPPV1_Format,RGBA_S3TC_DXT1_Format:__webpackgi_exports__RGBA_S3TC_DXT1_Format,RGBA_S3TC_DXT3_Format:__webpackgi_exports__RGBA_S3TC_DXT3_Format,RGBA_S3TC_DXT5_Format:__webpackgi_exports__RGBA_S3TC_DXT5_Format,RGBM16ColorSpace:__webpackgi_exports__RGBM16ColorSpace,RGBM16ColorSpace_:__webpackgi_exports__RGBM16ColorSpace_,RGB_BPTC_SIGNED_Format:__webpackgi_exports__RGB_BPTC_SIGNED_Format,RGB_BPTC_UNSIGNED_Format:__webpackgi_exports__RGB_BPTC_UNSIGNED_Format,RGB_ETC1_Format:__webpackgi_exports__RGB_ETC1_Format,RGB_ETC2_Format:__webpackgi_exports__RGB_ETC2_Format,RGB_PVRTC_2BPPV1_Format:__webpackgi_exports__RGB_PVRTC_2BPPV1_Format,RGB_PVRTC_4BPPV1_Format:__webpackgi_exports__RGB_PVRTC_4BPPV1_Format,RGB_S3TC_DXT1_Format:__webpackgi_exports__RGB_S3TC_DXT1_Format,RGFormat:__webpackgi_exports__RGFormat,RGIntegerFormat:__webpackgi_exports__RGIntegerFormat,RainbowDiamondPlugin:__webpackgi_exports__RainbowDiamondPlugin,RandomizedDirectionalLight:__webpackgi_exports__RandomizedDirectionalLight,RandomizedDirectionalLightPlugin:__webpackgi_exports__RandomizedDirectionalLightPlugin,RawShaderMaterial:__webpackgi_exports__RawShaderMaterial,Ray:__webpackgi_exports__Ray,Raycaster:__webpackgi_exports__Raycaster,Rec709Primaries:__webpackgi_exports__Rec709Primaries,RectAreaLight:__webpackgi_exports__RectAreaLight,RedFormat:__webpackgi_exports__RedFormat,RedIntegerFormat:__webpackgi_exports__RedIntegerFormat,Reflector2:__webpackgi_exports__Reflector2,ReinhardToneMapping:__webpackgi_exports__ReinhardToneMapping,RenderTarget:__webpackgi_exports__RenderTarget,RendererUiPlugin:__webpackgi_exports__RendererUiPlugin,RepeatWrapping:__webpackgi_exports__RepeatWrapping,ReplaceStencilOp:__webpackgi_exports__ReplaceStencilOp,ReverseSubtractEquation:__webpackgi_exports__ReverseSubtractEquation,Rhino3dmLoadPlugin:__webpackgi_exports__Rhino3dmLoadPlugin,Rhino3dmLoader2:__webpackgi_exports__Rhino3dmLoader2,RingGeometry:__webpackgi_exports__RingGeometry,RootScene:__webpackgi_exports__RootScene,SIGNED_RED_GREEN_RGTC2_Format:__webpackgi_exports__SIGNED_RED_GREEN_RGTC2_Format,SIGNED_RED_RGTC1_Format:__webpackgi_exports__SIGNED_RED_RGTC1_Format,SRGBColorSpace:__webpackgi_exports__SRGBColorSpace,SRGBTransfer:__webpackgi_exports__SRGBTransfer,SSAOPlugin:__webpackgi_exports__SSAOPlugin,SSBevelPass:__webpackgi_exports__SSBevelPass,SSBevelPlugin:__webpackgi_exports__SSBevelPlugin,SSContactShadows:__webpackgi_exports__SSContactShadows,SSGIPlugin:__webpackgi_exports__SSGIPlugin,SSRPlugin:__webpackgi_exports__SSRPlugin,STLLoadPlugin:__webpackgi_exports__STLLoadPlugin,Scene:__webpackgi_exports__Scene,SceneCamerasUiPlugin:__webpackgi_exports__SceneCamerasUiPlugin,SceneLoopPlugin:__webpackgi_exports__SceneLoopPlugin,ScrollableCameraViewPlugin:__webpackgi_exports__ScrollableCameraViewPlugin,ScrollableCameraViewPreviewPlugin:__webpackgi_exports__ScrollableCameraViewPreviewPlugin,SelectionWidget:__webpackgi_exports__SelectionWidget,ShaderChunk:__webpackgi_exports__ShaderChunk,ShaderLib:__webpackgi_exports__ShaderLib,ShaderMaterial:__webpackgi_exports__ShaderMaterial,ShaderMaterial2:__webpackgi_exports__ShaderMaterial2,ShaderMaterialEncodingSupport:__webpackgi_exports__ShaderMaterialEncodingSupport,ShaderPass2:__webpackgi_exports__ShaderPass2,ShadowMapBaker:__webpackgi_exports__ShadowMapBaker,ShadowMaterial:__webpackgi_exports__ShadowMaterial,Shape:__webpackgi_exports__Shape,ShapeGeometry:__webpackgi_exports__ShapeGeometry,ShapePath:__webpackgi_exports__ShapePath,ShapeTubeExtrudePlugin:__webpackgi_exports__ShapeTubeExtrudePlugin,ShapeUtils:__webpackgi_exports__ShapeUtils,ShortType:__webpackgi_exports__ShortType,SimpleAssetList:__webpackgi_exports__SimpleAssetList,SimpleBackgroundEnvUiPlugin:__webpackgi_exports__SimpleBackgroundEnvUiPlugin,SimpleDataSource:__webpackgi_exports__SimpleDataSource,SimpleEventDispatcher:__webpackgi_exports__SimpleEventDispatcher,SimpleJSONExporter:__webpackgi_exports__SimpleJSONExporter,SimpleJSONLoader:__webpackgi_exports__SimpleJSONLoader,SimpleTextExporter:__webpackgi_exports__SimpleTextExporter,SimpleTextPlugin:__webpackgi_exports__SimpleTextPlugin,SimpleViewerUi:__webpackgi_exports__SimpleViewerUi,SimplifyModifierPlugin:__webpackgi_exports__SimplifyModifierPlugin,Skeleton:__webpackgi_exports__Skeleton,SkeletonHelper:__webpackgi_exports__SkeletonHelper,SkinnedMesh:__webpackgi_exports__SkinnedMesh,SnowFallPlugin:__webpackgi_exports__SnowFallPlugin,Source:__webpackgi_exports__Source,Sphere:__webpackgi_exports__Sphere,SphereGeometry:__webpackgi_exports__SphereGeometry,SphereSelectionWidget:__webpackgi_exports__SphereSelectionWidget,Spherical:__webpackgi_exports__Spherical,SphericalHarmonics3:__webpackgi_exports__SphericalHarmonics3,SplineCurve:__webpackgi_exports__SplineCurve,SpotLight:__webpackgi_exports__SpotLight,SpotLight2:__webpackgi_exports__SpotLight2,SpotLightHelper:__webpackgi_exports__SpotLightHelper,Sprite:__webpackgi_exports__Sprite,SpriteMaterial:__webpackgi_exports__SpriteMaterial,SrcAlphaFactor:__webpackgi_exports__SrcAlphaFactor,SrcAlphaSaturateFactor:__webpackgi_exports__SrcAlphaSaturateFactor,SrcColorFactor:__webpackgi_exports__SrcColorFactor,StaticCopyUsage:__webpackgi_exports__StaticCopyUsage,StaticDrawUsage:__webpackgi_exports__StaticDrawUsage,StaticReadUsage:__webpackgi_exports__StaticReadUsage,StereoCamera:__webpackgi_exports__StereoCamera,StreamCopyUsage:__webpackgi_exports__StreamCopyUsage,StreamDrawUsage:__webpackgi_exports__StreamDrawUsage,StreamReadUsage:__webpackgi_exports__StreamReadUsage,StringKeyframeTrack:__webpackgi_exports__StringKeyframeTrack,SubtractEquation:__webpackgi_exports__SubtractEquation,SubtractiveBlending:__webpackgi_exports__SubtractiveBlending,SwitchNodeBasePlugin:__webpackgi_exports__SwitchNodeBasePlugin,SwitchNodePlugin:__webpackgi_exports__SwitchNodePlugin,TOUCH:__webpackgi_exports__TOUCH,TYPED_ARRAYS:__webpackgi_exports__TYPED_ARRAYS,TangentSpaceNormalMap:__webpackgi_exports__TangentSpaceNormalMap,TemporalAAPlugin:__webpackgi_exports__TemporalAAPlugin,TetrahedronGeometry:__webpackgi_exports__TetrahedronGeometry,TextSVGOptions:__webpackgi_exports__TextSVGOptions,Texture:__webpackgi_exports__Texture,TextureLoader:__webpackgi_exports__TextureLoader,ThinFilmLayerPlugin:__webpackgi_exports__ThinFilmLayerPlugin,ThreeMaterialLoader:__webpackgi_exports__ThreeMaterialLoader,TonemapPlugin:__webpackgi_exports__TonemapPlugin,TorusGeometry:__webpackgi_exports__TorusGeometry,TorusKnotGeometry:__webpackgi_exports__TorusKnotGeometry,TrackballControlsPlugin:__webpackgi_exports__TrackballControlsPlugin,TransformAnimationPlugin:__webpackgi_exports__TransformAnimationPlugin,TransformControls:__webpackgi_exports__TransformControls,TransformControls2:__webpackgi_exports__TransformControls2,TransformControlsGizmo:__webpackgi_exports__TransformControlsGizmo,TransformControlsPlane:__webpackgi_exports__TransformControlsPlane,TransfrSharePlugin:__webpackgi_exports__TransfrSharePlugin,Triangle:__webpackgi_exports__Triangle,TriangleFanDrawMode:__webpackgi_exports__TriangleFanDrawMode,TriangleStripDrawMode:__webpackgi_exports__TriangleStripDrawMode,TrianglesDrawMode:__webpackgi_exports__TrianglesDrawMode,TriplanarUVMappingPlugin:__webpackgi_exports__TriplanarUVMappingPlugin,TubeGeometry:__webpackgi_exports__TubeGeometry,TubeShapeGeometry:__webpackgi_exports__TubeShapeGeometry,TweakpaneUiPlugin:__webpackgi_exports__TweakpaneUiPlugin,TweakpaneWrapper:__webpackgi_exports__TweakpaneWrapper,TwoPassDoubleSide:__webpackgi_exports__TwoPassDoubleSide,UChartOptions:__webpackgi_exports__UChartOptions,UPackOptions:__webpackgi_exports__UPackOptions,UVMapping:__webpackgi_exports__UVMapping,Uint16BufferAttribute:__webpackgi_exports__Uint16BufferAttribute,Uint32BufferAttribute:__webpackgi_exports__Uint32BufferAttribute,Uint8BufferAttribute:__webpackgi_exports__Uint8BufferAttribute,Uint8ClampedBufferAttribute:__webpackgi_exports__Uint8ClampedBufferAttribute,Uncharted2Tonemapping:__webpackgi_exports__Uncharted2Tonemapping,Uniform:__webpackgi_exports__Uniform,UniformsGroup:__webpackgi_exports__UniformsGroup,UniformsLib:__webpackgi_exports__UniformsLib,UniformsUtils:__webpackgi_exports__UniformsUtils,UnsignedByteType:__webpackgi_exports__UnsignedByteType,UnsignedInt248Type:__webpackgi_exports__UnsignedInt248Type,UnsignedIntType:__webpackgi_exports__UnsignedIntType,UnsignedShort4444Type:__webpackgi_exports__UnsignedShort4444Type,UnsignedShort5551Type:__webpackgi_exports__UnsignedShort5551Type,UnsignedShortType:__webpackgi_exports__UnsignedShortType,Unzip:__webpackgi_exports__Unzip,UnzipInflate:__webpackgi_exports__UnzipInflate,UnzipPassThrough:__webpackgi_exports__UnzipPassThrough,Unzlib:__webpackgi_exports__Unzlib,VJSONPresetGroup:__webpackgi_exports__VJSONPresetGroup,VRPluginBasic:__webpackgi_exports__VRPluginBasic,VSMShadowMap:__webpackgi_exports__VSMShadowMap,VariationConfiguratorEditorUiPlugin:__webpackgi_exports__VariationConfiguratorEditorUiPlugin,VariationConfiguratorGridUiPlugin:__webpackgi_exports__VariationConfiguratorGridUiPlugin,VariationConfiguratorPlugin:__webpackgi_exports__VariationConfiguratorPlugin,Vector2:__webpackgi_exports__Vector2,Vector3:__webpackgi_exports__Vector3,Vector4:__webpackgi_exports__Vector4,VectorKeyframeTrack:__webpackgi_exports__VectorKeyframeTrack,VelocityBufferPlugin:__webpackgi_exports__VelocityBufferPlugin,VideoTexture:__webpackgi_exports__VideoTexture,ViewerApp:__webpackgi_exports__ViewerApp,ViewerState:__webpackgi_exports__ViewerState,VignettePlugin:__webpackgi_exports__VignettePlugin,VirtualCamerasPlugin:__webpackgi_exports__VirtualCamerasPlugin,WaveGroundPlugin:__webpackgi_exports__WaveGroundPlugin,WebGL1Renderer:__webpackgi_exports__WebGL1Renderer,WebGL3DRenderTarget:__webpackgi_exports__WebGL3DRenderTarget,WebGLArrayRenderTarget:__webpackgi_exports__WebGLArrayRenderTarget,WebGLCoordinateSystem:__webpackgi_exports__WebGLCoordinateSystem,WebGLCubeRenderTarget:__webpackgi_exports__WebGLCubeRenderTarget,WebGLMultipleRenderTargets:__webpackgi_exports__WebGLMultipleRenderTargets,WebGLRenderTarget:__webpackgi_exports__WebGLRenderTarget,WebGLRenderer:__webpackgi_exports__WebGLRenderer,WebGLUtils:__webpackgi_exports__WebGLUtils,WebGPUCoordinateSystem:__webpackgi_exports__WebGPUCoordinateSystem,WebGiViewerElement:__webpackgi_exports__WebGiViewerElement,WindowiseDialogPlugin:__webpackgi_exports__WindowiseDialogPlugin,Wireframe:__webpackgi_exports__Wireframe,WireframeGeometry:__webpackgi_exports__WireframeGeometry,WireframeGeometry2:__webpackgi_exports__WireframeGeometry2,WrapAroundEnding:__webpackgi_exports__WrapAroundEnding,XAtlasPlugin:__webpackgi_exports__XAtlasPlugin,ZeroCurvatureEnding:__webpackgi_exports__ZeroCurvatureEnding,ZeroFactor:__webpackgi_exports__ZeroFactor,ZeroSlopeEnding:__webpackgi_exports__ZeroSlopeEnding,ZeroStencilOp:__webpackgi_exports__ZeroStencilOp,Zip:__webpackgi_exports__Zip,ZipDeflate:__webpackgi_exports__ZipDeflate,ZipLoader:__webpackgi_exports__ZipLoader,ZipPassThrough:__webpackgi_exports__ZipPassThrough,Zlib:__webpackgi_exports__Zlib,_SRGBAFormat:__webpackgi_exports___SRGBAFormat,absMax:__webpackgi_exports__absMax,addBasePlugins:__webpackgi_exports__addBasePlugins,addBloomData:__webpackgi_exports__addBloomData,addDracoLoader:__webpackgi_exports__addDracoLoader,addEditorPlugins:__webpackgi_exports__addEditorPlugins,addGLTFExporter:__webpackgi_exports__addGLTFExporter,addGLTFLoader:__webpackgi_exports__addGLTFLoader,addLUTData:__webpackgi_exports__addLUTData,addRGBELoader:__webpackgi_exports__addRGBELoader,addSSBevel:__webpackgi_exports__addSSBevel,aesGcmDecrypt:__webpackgi_exports__aesGcmDecrypt,aesGcmEncrypt:__webpackgi_exports__aesGcmEncrypt,afterMain:__webpackgi_exports__afterMain,afterRead:__webpackgi_exports__afterRead,afterWrite:__webpackgi_exports__afterWrite,angle:__webpackgi_exports__angle,animate:__webpackgi_exports__animate,animateAsync:__webpackgi_exports__animateAsync,animateObject:__webpackgi_exports__animateObject,animateSet:__webpackgi_exports__animateSet,animateTarget:__webpackgi_exports__animateTarget,anticipate:__webpackgi_exports__anticipate,applyOffset:__webpackgi_exports__applyOffset,applyStyles:__webpackgi_exports__applyStyles,arrayBufferToBase64:__webpackgi_exports__arrayBufferToBase64,arrow:__webpackgi_exports__arrow,attract:__webpackgi_exports__attract,attractExpo:__webpackgi_exports__attractExpo,auto:__webpackgi_exports__auto,autoCenterObject3D:__webpackgi_exports__autoCenterObject3D,autoGPUInstanceMeshes:__webpackgi_exports__autoGPUInstanceMeshes,autoScaleObject3D:__webpackgi_exports__autoScaleObject3D,backIn:__webpackgi_exports__backIn,backInOut:__webpackgi_exports__backInOut,backOut:__webpackgi_exports__backOut,base64ToArrayBuffer:__webpackgi_exports__base64ToArrayBuffer,basePlacements:__webpackgi_exports__basePlacements,basicMaterialPropList:__webpackgi_exports__basicMaterialPropList,beforeMain:__webpackgi_exports__beforeMain,beforeRead:__webpackgi_exports__beforeRead,beforeWrite:__webpackgi_exports__beforeWrite,blobToDataURL:__webpackgi_exports__blobToDataURL,bottom:__webpackgi_exports__bottom,bounceIn:__webpackgi_exports__bounceIn,bounceInOut:__webpackgi_exports__bounceInOut,bounceOut:__webpackgi_exports__bounceOut,buildCSGMeshBSP:__webpackgi_exports__buildCSGMeshBSP,buildCSGMeshBVH:__webpackgi_exports__buildCSGMeshBVH,cLinearToRGBM:__webpackgi_exports__cLinearToRGBM,cRGBMToLinear:__webpackgi_exports__cRGBMToLinear,circIn:__webpackgi_exports__circIn,circInOut:__webpackgi_exports__circInOut,circOut:__webpackgi_exports__circOut,clamp:__webpackgi_exports__clamp,clippingParents:__webpackgi_exports__clippingParents,colorToDataUrl:__webpackgi_exports__colorToDataUrl,combineDofShader:__webpackgi_exports__combineDofShader,compress:__webpackgi_exports__compress,compressSync:__webpackgi_exports__compressSync,computeAverageGeometryNormal:__webpackgi_exports__computeAverageGeometryNormal,computeEigenVectors:__webpackgi_exports__computeEigenVectors,computeGeometryCenter:__webpackgi_exports__computeGeometryCenter,computeGeometrySize:__webpackgi_exports__computeGeometrySize,computeMikkTSpaceTangents:__webpackgi_exports__computeMikkTSpaceTangents,computeMorphedAttributes:__webpackgi_exports__computeMorphedAttributes,computeOffsetMatrix:__webpackgi_exports__computeOffsetMatrix,computeScreenSpaceBoundingBox:__webpackgi_exports__computeScreenSpaceBoundingBox,computeStyles:__webpackgi_exports__computeStyles,copyMaterialUserData:__webpackgi_exports__copyMaterialUserData,copyObject3DUserData:__webpackgi_exports__copyObject3DUserData,copyProps:__webpackgi_exports__copyProps,copyTextureUserData:__webpackgi_exports__copyTextureUserData,createAnticipate:__webpackgi_exports__createAnticipate,createAttractor:__webpackgi_exports__createAttractor,createBackIn:__webpackgi_exports__createBackIn,createCanvasElement:__webpackgi_exports__createCanvasElement,createDiv:__webpackgi_exports__createDiv,createExpoIn:__webpackgi_exports__createExpoIn,createGenericExtensionClass:__webpackgi_exports__createGenericExtensionClass,createIFrameCSS3DObject:__webpackgi_exports__createIFrameCSS3DObject,createImage:__webpackgi_exports__createImage,createPopper:__webpackgi_exports__createPopper,createPopperBase:__webpackgi_exports__createPopperBase,createPopperLite:__webpackgi_exports__createPopperLite,createRenderTargetKey:__webpackgi_exports__createRenderTargetKey,createScriptFromURL:__webpackgi_exports__createScriptFromURL,createStyles:__webpackgi_exports__createStyles,csgOperations:__webpackgi_exports__csgOperations,css:__webpackgi_exports__css,cubicBezier:__webpackgi_exports__cubicBezier,dataTextureFromColor:__webpackgi_exports__dataTextureFromColor,dataTextureFromVec4:__webpackgi_exports__dataTextureFromVec4,decay:__webpackgi_exports__decay,decompress:__webpackgi_exports__decompress,decompressSync:__webpackgi_exports__decompressSync,deepAccessObject:__webpackgi_exports__deepAccessObject,deepCloneAttribute:__webpackgi_exports__deepCloneAttribute,defaultPresets:__webpackgi_exports__defaultPresets,deflate:__webpackgi_exports__deflate,deflateSync:__webpackgi_exports__deflateSync,degreesToRadians:__webpackgi_exports__degreesToRadians,deinterleaveAttribute:__webpackgi_exports__deinterleaveAttribute,deinterleaveGeometry:__webpackgi_exports__deinterleaveGeometry,deserializeObject:__webpackgi_exports__deserializeObject,deserializers:__webpackgi_exports__deserializers,detectOverflow:__webpackgi_exports__detectOverflow,diamondMaterialPropList:__webpackgi_exports__diamondMaterialPropList,distance:__webpackgi_exports__distance,downloadBlob:__webpackgi_exports__downloadBlob,downloadFile:__webpackgi_exports__downloadFile,easeIn:__webpackgi_exports__easeIn,easeInOut:__webpackgi_exports__easeInOut,easeOut:__webpackgi_exports__easeOut,embedUrlRefs:__webpackgi_exports__embedUrlRefs,end:__webpackgi_exports__end,envMapBackground:__webpackgi_exports__envMapBackground,escapeRegExp:__webpackgi_exports__escapeRegExp,estimateBytesUsed:__webpackgi_exports__estimateBytesUsed,eventListeners:__webpackgi_exports__eventListeners,extractAnimationKey:__webpackgi_exports__extractAnimationKey,flattenUiConfig:__webpackgi_exports__flattenUiConfig,flip:__webpackgi_exports__flip,fontFormatExtensionMap:__webpackgi_exports__fontFormatExtensionMap,generateUiConfig:__webpackgi_exports__generateUiConfig,generateUiFolder:__webpackgi_exports__generateUiFolder,getFileHandle:__webpackgi_exports__getFileHandle,getFilenameFromPath:__webpackgi_exports__getFilenameFromPath,getKeyByValue:__webpackgi_exports__getKeyByValue,getNewFileHandle:__webpackgi_exports__getNewFileHandle,getOrCall:__webpackgi_exports__getOrCall,getPropertyDescriptor:__webpackgi_exports__getPropertyDescriptor,getTexelDecoding:__webpackgi_exports__getTexelDecoding,getTexelDecodingFunction:__webpackgi_exports__getTexelDecodingFunction,getTextureDataType:__webpackgi_exports__getTextureDataType,getTypedArray:__webpackgi_exports__getTypedArray,getUrlQueryParam:__webpackgi_exports__getUrlQueryParam,glbEncryptionPreparser:__webpackgi_exports__glbEncryptionPreparser,glsl:__webpackgi_exports__glsl,gltfExporterMaterialsVariantsExtensionExport:__webpackgi_exports__gltfExporterMaterialsVariantsExtensionExport,gunzip:__webpackgi_exports__gunzip,gunzipSync:__webpackgi_exports__gunzipSync,gzip:__webpackgi_exports__gzip,gzipSync:__webpackgi_exports__gzipSync,hide:__webpackgi_exports__hide,html:__webpackgi_exports__html,htmlToCanvas:__webpackgi_exports__htmlToCanvas,htmlToPng:__webpackgi_exports__htmlToPng,htmlToSvg:__webpackgi_exports__htmlToSvg,iGeometryIgnoredUserData:__webpackgi_exports__iGeometryIgnoredUserData,iMaterialIgnoredUserData:__webpackgi_exports__iMaterialIgnoredUserData,iModelIgnoredUserData:__webpackgi_exports__iModelIgnoredUserData,iTextureIgnoredUserData:__webpackgi_exports__iTextureIgnoredUserData,imageBitmapToBase64:__webpackgi_exports__imageBitmapToBase64,imageDataToCanvas:__webpackgi_exports__imageDataToCanvas,imageToCanvas:__webpackgi_exports__imageToCanvas,imageUrlToImageData:__webpackgi_exports__imageUrlToImageData,includesAll:__webpackgi_exports__includesAll,inertia:__webpackgi_exports__inertia,inflate:__webpackgi_exports__inflate,inflateSync:__webpackgi_exports__inflateSync,interleaveAttributes:__webpackgi_exports__interleaveAttributes,interpolate:__webpackgi_exports__interpolate,isAnimatableType:__webpackgi_exports__isAnimatableType,isPoint:__webpackgi_exports__isPoint,isPoint3D:__webpackgi_exports__isPoint3D,isPropertyWritable:__webpackgi_exports__isPropertyWritable,keyframes:__webpackgi_exports__keyframes,khrMaterialsVariantsGLTF:__webpackgi_exports__khrMaterialsVariantsGLTF,left:__webpackgi_exports__left,lerpAngle:__webpackgi_exports__lerpAngle,lerpAngle2:__webpackgi_exports__lerpAngle2,linear:__webpackgi_exports__linear,longestCommonPrefix:__webpackgi_exports__longestCommonPrefix,main:__webpackgi_exports__main,makeColorSvg:__webpackgi_exports__makeColorSvg,makeColorSvgCircle:__webpackgi_exports__makeColorSvgCircle,makeFilter:__webpackgi_exports__makeFilter,makeSamplerUi:__webpackgi_exports__makeSamplerUi,makeSetterFor:__webpackgi_exports__makeSetterFor,makeTextSvg:__webpackgi_exports__makeTextSvg,matDefine:__webpackgi_exports__matDefine,mergeAttributes:__webpackgi_exports__mergeAttributes,mergeBufferAttributes:__webpackgi_exports__mergeBufferAttributes,mergeBufferGeometries:__webpackgi_exports__mergeBufferGeometries,mergeGeometries:__webpackgi_exports__mergeGeometries,mergeGroups:__webpackgi_exports__mergeGroups,mergeVertices:__webpackgi_exports__mergeVertices,mirrorEasing:__webpackgi_exports__mirrorEasing,mix:__webpackgi_exports__mix,mixColor:__webpackgi_exports__mixColor,mixComplex:__webpackgi_exports__mixComplex,mobileAndTabletCheck:__webpackgi_exports__mobileAndTabletCheck,modifierPhases:__webpackgi_exports__modifierPhases,now:__webpackgi_exports__now,objectHasOwn:__webpackgi_exports__objectHasOwn,offset:__webpackgi_exports__offset,onChange:__webpackgi_exports__onChange,onChange2:__webpackgi_exports__onChange2,onChange3:__webpackgi_exports__onChange3,parseFileExtension:__webpackgi_exports__parseFileExtension,patchShaderEncodingSupport:__webpackgi_exports__patchShaderEncodingSupport,pathJoin:__webpackgi_exports__pathJoin,physicalMaterialPropList:__webpackgi_exports__physicalMaterialPropList,pipe:__webpackgi_exports__pipe,pivotToBBoxCenter:__webpackgi_exports__pivotToBBoxCenter,pivotToPoint:__webpackgi_exports__pivotToPoint,placements:__webpackgi_exports__placements,pointFromVector:__webpackgi_exports__pointFromVector,popper:__webpackgi_exports__popper,popperGenerator:__webpackgi_exports__popperGenerator,popperOffsets:__webpackgi_exports__popperOffsets,prettyScrollbar:__webpackgi_exports__prettyScrollbar,preventOverflow:__webpackgi_exports__preventOverflow,processViewer:__webpackgi_exports__processViewer,progress:__webpackgi_exports__progress,radiansToDegrees:__webpackgi_exports__radiansToDegrees,read:__webpackgi_exports__read,readFile:__webpackgi_exports__readFile,reference:__webpackgi_exports__reference,remoteWorkerURL:__webpackgi_exports__remoteWorkerURL,removeDuplicateGeometries:__webpackgi_exports__removeDuplicateGeometries,replaceAll:__webpackgi_exports__replaceAll,reverseEasing:__webpackgi_exports__reverseEasing,right:__webpackgi_exports__right,rotateDuplicatedMesh:__webpackgi_exports__rotateDuplicatedMesh,sRGBEncoding:__webpackgi_exports__sRGBEncoding,safeSetProperty:__webpackgi_exports__safeSetProperty,serializable:__webpackgi_exports__serializable,serialize:__webpackgi_exports__serialize,serializeObject:__webpackgi_exports__serializeObject,serializeTextureInExtras:__webpackgi_exports__serializeTextureInExtras,serializers:__webpackgi_exports__serializers,setMeshGeometry:__webpackgi_exports__setMeshGeometry,setMeshMaterial:__webpackgi_exports__setMeshMaterial,setThreeRendererMode:__webpackgi_exports__setThreeRendererMode,setUrlQueryParam:__webpackgi_exports__setUrlQueryParam,setupCoreWebGiViewer:__webpackgi_exports__setupCoreWebGiViewer,setupIModel:__webpackgi_exports__setupIModel,setupModesStyles:__webpackgi_exports__setupModesStyles,setupModesUi:__webpackgi_exports__setupModesUi,setupObject3dModel:__webpackgi_exports__setupObject3dModel,setupSandboxWebGiEditor:__webpackgi_exports__setupSandboxWebGiEditor,shaderReplaceString:__webpackgi_exports__shaderReplaceString,sign2:__webpackgi_exports__sign2,slerp:__webpackgi_exports__slerp,smooth:__webpackgi_exports__smooth,smoothFrame:__webpackgi_exports__smoothFrame,snap:__webpackgi_exports__snap,snapObject:__webpackgi_exports__snapObject,sphericalFromObject:__webpackgi_exports__sphericalFromObject,spring:__webpackgi_exports__spring,standardMaterialPropList:__webpackgi_exports__standardMaterialPropList,start:__webpackgi_exports__start,steps:__webpackgi_exports__steps,strFromU8:__webpackgi_exports__strFromU8,strToU8:__webpackgi_exports__strToU8,supportsRequestStreams:__webpackgi_exports__supportsRequestStreams,svgToCanvas:__webpackgi_exports__svgToCanvas,svgToPng:__webpackgi_exports__svgToPng,svgUrl:__webpackgi_exports__svgUrl,texImageToCanvas:__webpackgi_exports__texImageToCanvas,textureDataToImageData:__webpackgi_exports__textureDataToImageData,textureToCanvas:__webpackgi_exports__textureToCanvas,textureToDataUrl:__webpackgi_exports__textureToDataUrl,timeout:__webpackgi_exports__timeout,toCreasedNormals:__webpackgi_exports__toCreasedNormals,toDecimal:__webpackgi_exports__toDecimal,toIndexedGeometry:__webpackgi_exports__toIndexedGeometry,toTitleCase:__webpackgi_exports__toTitleCase,toTrianglesDrawMode:__webpackgi_exports__toTrianglesDrawMode,top:__webpackgi_exports__top,uiButton:__webpackgi_exports__uiButton,uiColor:__webpackgi_exports__uiColor,uiConfig:__webpackgi_exports__uiConfig,uiDropdown:__webpackgi_exports__uiDropdown,uiFolder:__webpackgi_exports__uiFolder,uiImage:__webpackgi_exports__uiImage,uiInput:__webpackgi_exports__uiInput,uiMonitor:__webpackgi_exports__uiMonitor,uiPanel:__webpackgi_exports__uiPanel,uiSlider:__webpackgi_exports__uiSlider,uiToggle:__webpackgi_exports__uiToggle,uiVector:__webpackgi_exports__uiVector,uniform:__webpackgi_exports__uniform,unzip:__webpackgi_exports__unzip,unzipSync:__webpackgi_exports__unzipSync,unzlib:__webpackgi_exports__unzlib,unzlibSync:__webpackgi_exports__unzlibSync,uploadFile:__webpackgi_exports__uploadFile,vLinearToRGBM:__webpackgi_exports__vLinearToRGBM,vRGBMToLinear:__webpackgi_exports__vRGBMToLinear,valueToUiType:__webpackgi_exports__valueToUiType,variationPlacements:__webpackgi_exports__variationPlacements,velocityPerFrame:__webpackgi_exports__velocityPerFrame,velocityPerSecond:__webpackgi_exports__velocityPerSecond,verifyPermission:__webpackgi_exports__verifyPermission,viewport:__webpackgi_exports__viewport,wrap:__webpackgi_exports__wrap,write:__webpackgi_exports__write,writeFile:__webpackgi_exports__writeFile,zip:__webpackgi_exports__zip,zipSync:__webpackgi_exports__zipSync,zlib:__webpackgi_exports__zlib,zlibSync:__webpackgi_exports__zlibSync},Symbol.toStringTag,{value:"Module"})),w0=class xw extends __webpackgi_exports__AViewerPlugin{constructor(){super(...arguments),this.enabled=!0,this.materials=[],this.presets={},this.getMaterialPresetByName=o=>!this.presets||this.presets.length==0?null:this.presets[o.type].find(c=>c.path.split("/").pop()==o.name)}async onAdded(o){await super.onAdded(o)}loadPresets(o,c){this.presets=o,this.basePath=c,this.dispatchEvent({type:"deserialize"})}exportPresets(){return{materials:this.materials,type:xw.PluginType}}async fromJSON(o,c){if(!super.fromJSON(o,c))return null;const d=o.materials;if(!d)return null;const _=[];for(const v of d)_.push(this.apply(v.name,v.path));return await Promise.all(_),this.dispatchEvent({type:"deserialize"}),this}async apply(o,c){var d,_,v,b,tt;const it=(d=this._viewer)==null?void 0:d.getManager(),nt=(v=await((_=it==null?void 0:it.importer)==null?void 0:_.importSinglePath(c)))==null?void 0:v.clone();if(!nt)return"Unable to load material";nt.name=o;const lt=new Set;(tt=(b=this._viewer)==null?void 0:b.scene)==null||tt.traverse(ht=>{ht.isMesh&&ht.material.name===o&&lt.add(ht)}),lt.forEach(ht=>{var _t;(_t=ht==null?void 0:ht.setMaterial)==null||_t.call(ht,nt),ht.material.name=o});const ut=this.materials.findIndex(ht=>ht.name===o);ut!==-1?this.materials[ut]={name:o,path:c}:this.materials.push({name:o,path:c})}};w0.PluginType="MaterialPresetPlugin";let MaterialPresetPlugin=w0;var jsxRuntime={exports:{}},reactJsxRuntime_production_min={},react={exports:{}},react_production_min={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var l$1=Symbol.for("react.element"),n$1=Symbol.for("react.portal"),p$2=Symbol.for("react.fragment"),q$1=Symbol.for("react.strict_mode"),r=Symbol.for("react.profiler"),t=Symbol.for("react.provider"),u=Symbol.for("react.context"),v$2=Symbol.for("react.forward_ref"),w=Symbol.for("react.suspense"),x=Symbol.for("react.memo"),y=Symbol.for("react.lazy"),z$1=Symbol.iterator;function A$1(h){return h===null||typeof h!="object"?null:(h=z$1&&h[z$1]||h["@@iterator"],typeof h=="function"?h:null)}var B$1={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},C$1=Object.assign,D$1={};function E$1(h,o,c){this.props=h,this.context=o,this.refs=D$1,this.updater=c||B$1}E$1.prototype.isReactComponent={};E$1.prototype.setState=function(h,o){if(typeof h!="object"&&typeof h!="function"&&h!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,h,o,"setState")};E$1.prototype.forceUpdate=function(h){this.updater.enqueueForceUpdate(this,h,"forceUpdate")};function F(){}F.prototype=E$1.prototype;function G$1(h,o,c){this.props=h,this.context=o,this.refs=D$1,this.updater=c||B$1}var H$1=G$1.prototype=new F;H$1.constructor=G$1;C$1(H$1,E$1.prototype);H$1.isPureReactComponent=!0;var I$1=Array.isArray,J=Object.prototype.hasOwnProperty,K$1={current:null},L$1={key:!0,ref:!0,__self:!0,__source:!0};function M$1(h,o,c){var d,_={},v=null,b=null;if(o!=null)for(d in o.ref!==void 0&&(b=o.ref),o.key!==void 0&&(v=""+o.key),o)J.call(o,d)&&!L$1.hasOwnProperty(d)&&(_[d]=o[d]);var tt=arguments.length-2;if(tt===1)_.children=c;else if(1<tt){for(var it=Array(tt),nt=0;nt<tt;nt++)it[nt]=arguments[nt+2];_.children=it}if(h&&h.defaultProps)for(d in tt=h.defaultProps,tt)_[d]===void 0&&(_[d]=tt[d]);return{$$typeof:l$1,type:h,key:v,ref:b,props:_,_owner:K$1.current}}function N$1(h,o){return{$$typeof:l$1,type:h.type,key:o,ref:h.ref,props:h.props,_owner:h._owner}}function O$1(h){return typeof h=="object"&&h!==null&&h.$$typeof===l$1}function escape$1(h){var o={"=":"=0",":":"=2"};return"$"+h.replace(/[=:]/g,function(c){return o[c]})}var P$1=/\/+/g;function Q$1(h,o){return typeof h=="object"&&h!==null&&h.key!=null?escape$1(""+h.key):o.toString(36)}function R$1(h,o,c,d,_){var v=typeof h;(v==="undefined"||v==="boolean")&&(h=null);var b=!1;if(h===null)b=!0;else switch(v){case"string":case"number":b=!0;break;case"object":switch(h.$$typeof){case l$1:case n$1:b=!0}}if(b)return b=h,_=_(b),h=d===""?"."+Q$1(b,0):d,I$1(_)?(c="",h!=null&&(c=h.replace(P$1,"$&/")+"/"),R$1(_,o,c,"",function(nt){return nt})):_!=null&&(O$1(_)&&(_=N$1(_,c+(!_.key||b&&b.key===_.key?"":(""+_.key).replace(P$1,"$&/")+"/")+h)),o.push(_)),1;if(b=0,d=d===""?".":d+":",I$1(h))for(var tt=0;tt<h.length;tt++){v=h[tt];var it=d+Q$1(v,tt);b+=R$1(v,o,c,it,_)}else if(it=A$1(h),typeof it=="function")for(h=it.call(h),tt=0;!(v=h.next()).done;)v=v.value,it=d+Q$1(v,tt++),b+=R$1(v,o,c,it,_);else if(v==="object")throw o=String(h),Error("Objects are not valid as a React child (found: "+(o==="[object Object]"?"object with keys {"+Object.keys(h).join(", ")+"}":o)+"). If you meant to render a collection of children, use an array instead.");return b}function S$1(h,o,c){if(h==null)return h;var d=[],_=0;return R$1(h,d,"","",function(v){return o.call(c,v,_++)}),d}function T$1(h){if(h._status===-1){var o=h._result;o=o(),o.then(function(c){(h._status===0||h._status===-1)&&(h._status=1,h._result=c)},function(c){(h._status===0||h._status===-1)&&(h._status=2,h._result=c)}),h._status===-1&&(h._status=0,h._result=o)}if(h._status===1)return h._result.default;throw h._result}var U$1={current:null},V$1={transition:null},W$1={ReactCurrentDispatcher:U$1,ReactCurrentBatchConfig:V$1,ReactCurrentOwner:K$1};function X$1(){throw Error("act(...) is not supported in production builds of React.")}react_production_min.Children={map:S$1,forEach:function(h,o,c){S$1(h,function(){o.apply(this,arguments)},c)},count:function(h){var o=0;return S$1(h,function(){o++}),o},toArray:function(h){return S$1(h,function(o){return o})||[]},only:function(h){if(!O$1(h))throw Error("React.Children.only expected to receive a single React element child.");return h}};react_production_min.Component=E$1;react_production_min.Fragment=p$2;react_production_min.Profiler=r;react_production_min.PureComponent=G$1;react_production_min.StrictMode=q$1;react_production_min.Suspense=w;react_production_min.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=W$1;react_production_min.act=X$1;react_production_min.cloneElement=function(h,o,c){if(h==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+h+".");var d=C$1({},h.props),_=h.key,v=h.ref,b=h._owner;if(o!=null){if(o.ref!==void 0&&(v=o.ref,b=K$1.current),o.key!==void 0&&(_=""+o.key),h.type&&h.type.defaultProps)var tt=h.type.defaultProps;for(it in o)J.call(o,it)&&!L$1.hasOwnProperty(it)&&(d[it]=o[it]===void 0&&tt!==void 0?tt[it]:o[it])}var it=arguments.length-2;if(it===1)d.children=c;else if(1<it){tt=Array(it);for(var nt=0;nt<it;nt++)tt[nt]=arguments[nt+2];d.children=tt}return{$$typeof:l$1,type:h.type,key:_,ref:v,props:d,_owner:b}};react_production_min.createContext=function(h){return h={$$typeof:u,_currentValue:h,_currentValue2:h,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},h.Provider={$$typeof:t,_context:h},h.Consumer=h};react_production_min.createElement=M$1;react_production_min.createFactory=function(h){var o=M$1.bind(null,h);return o.type=h,o};react_production_min.createRef=function(){return{current:null}};react_production_min.forwardRef=function(h){return{$$typeof:v$2,render:h}};react_production_min.isValidElement=O$1;react_production_min.lazy=function(h){return{$$typeof:y,_payload:{_status:-1,_result:h},_init:T$1}};react_production_min.memo=function(h,o){return{$$typeof:x,type:h,compare:o===void 0?null:o}};react_production_min.startTransition=function(h){var o=V$1.transition;V$1.transition={};try{h()}finally{V$1.transition=o}};react_production_min.unstable_act=X$1;react_production_min.useCallback=function(h,o){return U$1.current.useCallback(h,o)};react_production_min.useContext=function(h){return U$1.current.useContext(h)};react_production_min.useDebugValue=function(){};react_production_min.useDeferredValue=function(h){return U$1.current.useDeferredValue(h)};react_production_min.useEffect=function(h,o){return U$1.current.useEffect(h,o)};react_production_min.useId=function(){return U$1.current.useId()};react_production_min.useImperativeHandle=function(h,o,c){return U$1.current.useImperativeHandle(h,o,c)};react_production_min.useInsertionEffect=function(h,o){return U$1.current.useInsertionEffect(h,o)};react_production_min.useLayoutEffect=function(h,o){return U$1.current.useLayoutEffect(h,o)};react_production_min.useMemo=function(h,o){return U$1.current.useMemo(h,o)};react_production_min.useReducer=function(h,o,c){return U$1.current.useReducer(h,o,c)};react_production_min.useRef=function(h){return U$1.current.useRef(h)};react_production_min.useState=function(h){return U$1.current.useState(h)};react_production_min.useSyncExternalStore=function(h,o,c){return U$1.current.useSyncExternalStore(h,o,c)};react_production_min.useTransition=function(){return U$1.current.useTransition()};react_production_min.version="18.3.1";react.exports=react_production_min;var reactExports=react.exports;/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var f=reactExports,k=Symbol.for("react.element"),l=Symbol.for("react.fragment"),m$1=Object.prototype.hasOwnProperty,n=f.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,p$1={key:!0,ref:!0,__self:!0,__source:!0};function q(h,o,c){var d,_={},v=null,b=null;c!==void 0&&(v=""+c),o.key!==void 0&&(v=""+o.key),o.ref!==void 0&&(b=o.ref);for(d in o)m$1.call(o,d)&&!p$1.hasOwnProperty(d)&&(_[d]=o[d]);if(h&&h.defaultProps)for(d in o=h.defaultProps,o)_[d]===void 0&&(_[d]=o[d]);return{$$typeof:k,type:h,key:v,ref:b,props:_,_owner:n.current}}reactJsxRuntime_production_min.Fragment=l;reactJsxRuntime_production_min.jsx=q;reactJsxRuntime_production_min.jsxs=q;jsxRuntime.exports=reactJsxRuntime_production_min;var jsxRuntimeExports=jsxRuntime.exports,client={},reactDom={exports:{}},reactDom_production_min={},scheduler={exports:{}},scheduler_production_min={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(h){function o(hr,ur){var cr=hr.length;hr.push(ur);e:for(;0<cr;){var br=cr-1>>>1,fr=hr[br];if(0<_(fr,ur))hr[br]=ur,hr[cr]=fr,cr=br;else break e}}function c(hr){return hr.length===0?null:hr[0]}function d(hr){if(hr.length===0)return null;var ur=hr[0],cr=hr.pop();if(cr!==ur){hr[0]=cr;e:for(var br=0,fr=hr.length,kr=fr>>>1;br<kr;){var gr=2*(br+1)-1,tr=hr[gr],dr=gr+1,Ir=hr[dr];if(0>_(tr,cr))dr<fr&&0>_(Ir,tr)?(hr[br]=Ir,hr[dr]=cr,br=dr):(hr[br]=tr,hr[gr]=cr,br=gr);else if(dr<fr&&0>_(Ir,cr))hr[br]=Ir,hr[dr]=cr,br=dr;else break e}}return ur}function _(hr,ur){var cr=hr.sortIndex-ur.sortIndex;return cr!==0?cr:hr.id-ur.id}if(typeof performance=="object"&&typeof performance.now=="function"){var v=performance;h.unstable_now=function(){return v.now()}}else{var b=Date,tt=b.now();h.unstable_now=function(){return b.now()-tt}}var it=[],nt=[],lt=1,ut=null,ht=3,_t=!1,ft=!1,bt=!1,xt=typeof setTimeout=="function"?setTimeout:null,St=typeof clearTimeout=="function"?clearTimeout:null,wt=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function Pt(hr){for(var ur=c(nt);ur!==null;){if(ur.callback===null)d(nt);else if(ur.startTime<=hr)d(nt),ur.sortIndex=ur.expirationTime,o(it,ur);else break;ur=c(nt)}}function Rt(hr){if(bt=!1,Pt(hr),!ft)if(c(it)!==null)ft=!0,or(kt);else{var ur=c(nt);ur!==null&&pr(Rt,ur.startTime-hr)}}function kt(hr,ur){ft=!1,bt&&(bt=!1,St(It),It=-1),_t=!0;var cr=ht;try{for(Pt(ur),ut=c(it);ut!==null&&(!(ut.expirationTime>ur)||hr&&!Kt());){var br=ut.callback;if(typeof br=="function"){ut.callback=null,ht=ut.priorityLevel;var fr=br(ut.expirationTime<=ur);ur=h.unstable_now(),typeof fr=="function"?ut.callback=fr:ut===c(it)&&d(it),Pt(ur)}else d(it);ut=c(it)}if(ut!==null)var kr=!0;else{var gr=c(nt);gr!==null&&pr(Rt,gr.startTime-ur),kr=!1}return kr}finally{ut=null,ht=cr,_t=!1}}var Gt=!1,Dt=null,It=-1,Nt=5,Vt=-1;function Kt(){return!(h.unstable_now()-Vt<Nt)}function Yt(){if(Dt!==null){var hr=h.unstable_now();Vt=hr;var ur=!0;try{ur=Dt(!0,hr)}finally{ur?nr():(Gt=!1,Dt=null)}}else Gt=!1}var nr;if(typeof wt=="function")nr=function(){wt(Yt)};else if(typeof MessageChannel<"u"){var rr=new MessageChannel,lr=rr.port2;rr.port1.onmessage=Yt,nr=function(){lr.postMessage(null)}}else nr=function(){xt(Yt,0)};function or(hr){Dt=hr,Gt||(Gt=!0,nr())}function pr(hr,ur){It=xt(function(){hr(h.unstable_now())},ur)}h.unstable_IdlePriority=5,h.unstable_ImmediatePriority=1,h.unstable_LowPriority=4,h.unstable_NormalPriority=3,h.unstable_Profiling=null,h.unstable_UserBlockingPriority=2,h.unstable_cancelCallback=function(hr){hr.callback=null},h.unstable_continueExecution=function(){ft||_t||(ft=!0,or(kt))},h.unstable_forceFrameRate=function(hr){0>hr||125<hr?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Nt=0<hr?Math.floor(1e3/hr):5},h.unstable_getCurrentPriorityLevel=function(){return ht},h.unstable_getFirstCallbackNode=function(){return c(it)},h.unstable_next=function(hr){switch(ht){case 1:case 2:case 3:var ur=3;break;default:ur=ht}var cr=ht;ht=ur;try{return hr()}finally{ht=cr}},h.unstable_pauseExecution=function(){},h.unstable_requestPaint=function(){},h.unstable_runWithPriority=function(hr,ur){switch(hr){case 1:case 2:case 3:case 4:case 5:break;default:hr=3}var cr=ht;ht=hr;try{return ur()}finally{ht=cr}},h.unstable_scheduleCallback=function(hr,ur,cr){var br=h.unstable_now();switch(typeof cr=="object"&&cr!==null?(cr=cr.delay,cr=typeof cr=="number"&&0<cr?br+cr:br):cr=br,hr){case 1:var fr=-1;break;case 2:fr=250;break;case 5:fr=1073741823;break;case 4:fr=1e4;break;default:fr=5e3}return fr=cr+fr,hr={id:lt++,callback:ur,priorityLevel:hr,startTime:cr,expirationTime:fr,sortIndex:-1},cr>br?(hr.sortIndex=cr,o(nt,hr),c(it)===null&&hr===c(nt)&&(bt?(St(It),It=-1):bt=!0,pr(Rt,cr-br))):(hr.sortIndex=fr,o(it,hr),ft||_t||(ft=!0,or(kt))),hr},h.unstable_shouldYield=Kt,h.unstable_wrapCallback=function(hr){var ur=ht;return function(){var cr=ht;ht=ur;try{return hr.apply(this,arguments)}finally{ht=cr}}}})(scheduler_production_min);scheduler.exports=scheduler_production_min;var schedulerExports=scheduler.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var aa=reactExports,ca=schedulerExports;function p(h){for(var o="https://reactjs.org/docs/error-decoder.html?invariant="+h,c=1;c<arguments.length;c++)o+="&args[]="+encodeURIComponent(arguments[c]);return"Minified React error #"+h+"; visit "+o+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var da=new Set,ea={};function fa(h,o){ha(h,o),ha(h+"Capture",o)}function ha(h,o){for(ea[h]=o,h=0;h<o.length;h++)da.add(o[h])}var ia=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),ja=Object.prototype.hasOwnProperty,ka=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,la={},ma={};function oa(h){return ja.call(ma,h)?!0:ja.call(la,h)?!1:ka.test(h)?ma[h]=!0:(la[h]=!0,!1)}function pa(h,o,c,d){if(c!==null&&c.type===0)return!1;switch(typeof o){case"function":case"symbol":return!0;case"boolean":return d?!1:c!==null?!c.acceptsBooleans:(h=h.toLowerCase().slice(0,5),h!=="data-"&&h!=="aria-");default:return!1}}function qa(h,o,c,d){if(o===null||typeof o>"u"||pa(h,o,c,d))return!0;if(d)return!1;if(c!==null)switch(c.type){case 3:return!o;case 4:return o===!1;case 5:return isNaN(o);case 6:return isNaN(o)||1>o}return!1}function v$1(h,o,c,d,_,v,b){this.acceptsBooleans=o===2||o===3||o===4,this.attributeName=d,this.attributeNamespace=_,this.mustUseProperty=c,this.propertyName=h,this.type=o,this.sanitizeURL=v,this.removeEmptyString=b}var z={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(h){z[h]=new v$1(h,0,!1,h,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(h){var o=h[0];z[o]=new v$1(o,1,!1,h[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(h){z[h]=new v$1(h,2,!1,h.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(h){z[h]=new v$1(h,2,!1,h,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(h){z[h]=new v$1(h,3,!1,h.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(h){z[h]=new v$1(h,3,!0,h,null,!1,!1)});["capture","download"].forEach(function(h){z[h]=new v$1(h,4,!1,h,null,!1,!1)});["cols","rows","size","span"].forEach(function(h){z[h]=new v$1(h,6,!1,h,null,!1,!1)});["rowSpan","start"].forEach(function(h){z[h]=new v$1(h,5,!1,h.toLowerCase(),null,!1,!1)});var ra=/[\-:]([a-z])/g;function sa(h){return h[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(h){var o=h.replace(ra,sa);z[o]=new v$1(o,1,!1,h,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(h){var o=h.replace(ra,sa);z[o]=new v$1(o,1,!1,h,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(h){var o=h.replace(ra,sa);z[o]=new v$1(o,1,!1,h,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(h){z[h]=new v$1(h,1,!1,h.toLowerCase(),null,!1,!1)});z.xlinkHref=new v$1("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(h){z[h]=new v$1(h,1,!1,h.toLowerCase(),null,!0,!0)});function ta(h,o,c,d){var _=z.hasOwnProperty(o)?z[o]:null;(_!==null?_.type!==0:d||!(2<o.length)||o[0]!=="o"&&o[0]!=="O"||o[1]!=="n"&&o[1]!=="N")&&(qa(o,c,_,d)&&(c=null),d||_===null?oa(o)&&(c===null?h.removeAttribute(o):h.setAttribute(o,""+c)):_.mustUseProperty?h[_.propertyName]=c===null?_.type===3?!1:"":c:(o=_.attributeName,d=_.attributeNamespace,c===null?h.removeAttribute(o):(_=_.type,c=_===3||_===4&&c===!0?"":""+c,d?h.setAttributeNS(d,o,c):h.setAttribute(o,c))))}var ua=aa.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,va=Symbol.for("react.element"),wa=Symbol.for("react.portal"),ya=Symbol.for("react.fragment"),za=Symbol.for("react.strict_mode"),Aa=Symbol.for("react.profiler"),Ba=Symbol.for("react.provider"),Ca=Symbol.for("react.context"),Da=Symbol.for("react.forward_ref"),Ea=Symbol.for("react.suspense"),Fa=Symbol.for("react.suspense_list"),Ga=Symbol.for("react.memo"),Ha=Symbol.for("react.lazy"),Ia=Symbol.for("react.offscreen"),Ja=Symbol.iterator;function Ka(h){return h===null||typeof h!="object"?null:(h=Ja&&h[Ja]||h["@@iterator"],typeof h=="function"?h:null)}var A=Object.assign,La;function Ma(h){if(La===void 0)try{throw Error()}catch(c){var o=c.stack.trim().match(/\n( *(at )?)/);La=o&&o[1]||""}return`
`+La+h}var Na=!1;function Oa(h,o){if(!h||Na)return"";Na=!0;var c=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(o)if(o=function(){throw Error()},Object.defineProperty(o.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(o,[])}catch(nt){var d=nt}Reflect.construct(h,[],o)}else{try{o.call()}catch(nt){d=nt}h.call(o.prototype)}else{try{throw Error()}catch(nt){d=nt}h()}}catch(nt){if(nt&&d&&typeof nt.stack=="string"){for(var _=nt.stack.split(`
`),v=d.stack.split(`
`),b=_.length-1,tt=v.length-1;1<=b&&0<=tt&&_[b]!==v[tt];)tt--;for(;1<=b&&0<=tt;b--,tt--)if(_[b]!==v[tt]){if(b!==1||tt!==1)do if(b--,tt--,0>tt||_[b]!==v[tt]){var it=`
`+_[b].replace(" at new "," at ");return h.displayName&&it.includes("<anonymous>")&&(it=it.replace("<anonymous>",h.displayName)),it}while(1<=b&&0<=tt);break}}}finally{Na=!1,Error.prepareStackTrace=c}return(h=h?h.displayName||h.name:"")?Ma(h):""}function Pa(h){switch(h.tag){case 5:return Ma(h.type);case 16:return Ma("Lazy");case 13:return Ma("Suspense");case 19:return Ma("SuspenseList");case 0:case 2:case 15:return h=Oa(h.type,!1),h;case 11:return h=Oa(h.type.render,!1),h;case 1:return h=Oa(h.type,!0),h;default:return""}}function Qa(h){if(h==null)return null;if(typeof h=="function")return h.displayName||h.name||null;if(typeof h=="string")return h;switch(h){case ya:return"Fragment";case wa:return"Portal";case Aa:return"Profiler";case za:return"StrictMode";case Ea:return"Suspense";case Fa:return"SuspenseList"}if(typeof h=="object")switch(h.$$typeof){case Ca:return(h.displayName||"Context")+".Consumer";case Ba:return(h._context.displayName||"Context")+".Provider";case Da:var o=h.render;return h=h.displayName,h||(h=o.displayName||o.name||"",h=h!==""?"ForwardRef("+h+")":"ForwardRef"),h;case Ga:return o=h.displayName||null,o!==null?o:Qa(h.type)||"Memo";case Ha:o=h._payload,h=h._init;try{return Qa(h(o))}catch{}}return null}function Ra(h){var o=h.type;switch(h.tag){case 24:return"Cache";case 9:return(o.displayName||"Context")+".Consumer";case 10:return(o._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return h=o.render,h=h.displayName||h.name||"",o.displayName||(h!==""?"ForwardRef("+h+")":"ForwardRef");case 7:return"Fragment";case 5:return o;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Qa(o);case 8:return o===za?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof o=="function")return o.displayName||o.name||null;if(typeof o=="string")return o}return null}function Sa(h){switch(typeof h){case"boolean":case"number":case"string":case"undefined":return h;case"object":return h;default:return""}}function Ta(h){var o=h.type;return(h=h.nodeName)&&h.toLowerCase()==="input"&&(o==="checkbox"||o==="radio")}function Ua(h){var o=Ta(h)?"checked":"value",c=Object.getOwnPropertyDescriptor(h.constructor.prototype,o),d=""+h[o];if(!h.hasOwnProperty(o)&&typeof c<"u"&&typeof c.get=="function"&&typeof c.set=="function"){var _=c.get,v=c.set;return Object.defineProperty(h,o,{configurable:!0,get:function(){return _.call(this)},set:function(b){d=""+b,v.call(this,b)}}),Object.defineProperty(h,o,{enumerable:c.enumerable}),{getValue:function(){return d},setValue:function(b){d=""+b},stopTracking:function(){h._valueTracker=null,delete h[o]}}}}function Va(h){h._valueTracker||(h._valueTracker=Ua(h))}function Wa(h){if(!h)return!1;var o=h._valueTracker;if(!o)return!0;var c=o.getValue(),d="";return h&&(d=Ta(h)?h.checked?"true":"false":h.value),h=d,h!==c?(o.setValue(h),!0):!1}function Xa(h){if(h=h||(typeof document<"u"?document:void 0),typeof h>"u")return null;try{return h.activeElement||h.body}catch{return h.body}}function Ya(h,o){var c=o.checked;return A({},o,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:c??h._wrapperState.initialChecked})}function Za(h,o){var c=o.defaultValue==null?"":o.defaultValue,d=o.checked!=null?o.checked:o.defaultChecked;c=Sa(o.value!=null?o.value:c),h._wrapperState={initialChecked:d,initialValue:c,controlled:o.type==="checkbox"||o.type==="radio"?o.checked!=null:o.value!=null}}function ab(h,o){o=o.checked,o!=null&&ta(h,"checked",o,!1)}function bb(h,o){ab(h,o);var c=Sa(o.value),d=o.type;if(c!=null)d==="number"?(c===0&&h.value===""||h.value!=c)&&(h.value=""+c):h.value!==""+c&&(h.value=""+c);else if(d==="submit"||d==="reset"){h.removeAttribute("value");return}o.hasOwnProperty("value")?cb(h,o.type,c):o.hasOwnProperty("defaultValue")&&cb(h,o.type,Sa(o.defaultValue)),o.checked==null&&o.defaultChecked!=null&&(h.defaultChecked=!!o.defaultChecked)}function db(h,o,c){if(o.hasOwnProperty("value")||o.hasOwnProperty("defaultValue")){var d=o.type;if(!(d!=="submit"&&d!=="reset"||o.value!==void 0&&o.value!==null))return;o=""+h._wrapperState.initialValue,c||o===h.value||(h.value=o),h.defaultValue=o}c=h.name,c!==""&&(h.name=""),h.defaultChecked=!!h._wrapperState.initialChecked,c!==""&&(h.name=c)}function cb(h,o,c){(o!=="number"||Xa(h.ownerDocument)!==h)&&(c==null?h.defaultValue=""+h._wrapperState.initialValue:h.defaultValue!==""+c&&(h.defaultValue=""+c))}var eb=Array.isArray;function fb(h,o,c,d){if(h=h.options,o){o={};for(var _=0;_<c.length;_++)o["$"+c[_]]=!0;for(c=0;c<h.length;c++)_=o.hasOwnProperty("$"+h[c].value),h[c].selected!==_&&(h[c].selected=_),_&&d&&(h[c].defaultSelected=!0)}else{for(c=""+Sa(c),o=null,_=0;_<h.length;_++){if(h[_].value===c){h[_].selected=!0,d&&(h[_].defaultSelected=!0);return}o!==null||h[_].disabled||(o=h[_])}o!==null&&(o.selected=!0)}}function gb(h,o){if(o.dangerouslySetInnerHTML!=null)throw Error(p(91));return A({},o,{value:void 0,defaultValue:void 0,children:""+h._wrapperState.initialValue})}function hb(h,o){var c=o.value;if(c==null){if(c=o.children,o=o.defaultValue,c!=null){if(o!=null)throw Error(p(92));if(eb(c)){if(1<c.length)throw Error(p(93));c=c[0]}o=c}o==null&&(o=""),c=o}h._wrapperState={initialValue:Sa(c)}}function ib(h,o){var c=Sa(o.value),d=Sa(o.defaultValue);c!=null&&(c=""+c,c!==h.value&&(h.value=c),o.defaultValue==null&&h.defaultValue!==c&&(h.defaultValue=c)),d!=null&&(h.defaultValue=""+d)}function jb(h){var o=h.textContent;o===h._wrapperState.initialValue&&o!==""&&o!==null&&(h.value=o)}function kb(h){switch(h){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function lb(h,o){return h==null||h==="http://www.w3.org/1999/xhtml"?kb(o):h==="http://www.w3.org/2000/svg"&&o==="foreignObject"?"http://www.w3.org/1999/xhtml":h}var mb,nb=function(h){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(o,c,d,_){MSApp.execUnsafeLocalFunction(function(){return h(o,c,d,_)})}:h}(function(h,o){if(h.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in h)h.innerHTML=o;else{for(mb=mb||document.createElement("div"),mb.innerHTML="<svg>"+o.valueOf().toString()+"</svg>",o=mb.firstChild;h.firstChild;)h.removeChild(h.firstChild);for(;o.firstChild;)h.appendChild(o.firstChild)}});function ob(h,o){if(o){var c=h.firstChild;if(c&&c===h.lastChild&&c.nodeType===3){c.nodeValue=o;return}}h.textContent=o}var pb={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},qb=["Webkit","ms","Moz","O"];Object.keys(pb).forEach(function(h){qb.forEach(function(o){o=o+h.charAt(0).toUpperCase()+h.substring(1),pb[o]=pb[h]})});function rb(h,o,c){return o==null||typeof o=="boolean"||o===""?"":c||typeof o!="number"||o===0||pb.hasOwnProperty(h)&&pb[h]?(""+o).trim():o+"px"}function sb(h,o){h=h.style;for(var c in o)if(o.hasOwnProperty(c)){var d=c.indexOf("--")===0,_=rb(c,o[c],d);c==="float"&&(c="cssFloat"),d?h.setProperty(c,_):h[c]=_}}var tb=A({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ub(h,o){if(o){if(tb[h]&&(o.children!=null||o.dangerouslySetInnerHTML!=null))throw Error(p(137,h));if(o.dangerouslySetInnerHTML!=null){if(o.children!=null)throw Error(p(60));if(typeof o.dangerouslySetInnerHTML!="object"||!("__html"in o.dangerouslySetInnerHTML))throw Error(p(61))}if(o.style!=null&&typeof o.style!="object")throw Error(p(62))}}function vb(h,o){if(h.indexOf("-")===-1)return typeof o.is=="string";switch(h){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var wb=null;function xb(h){return h=h.target||h.srcElement||window,h.correspondingUseElement&&(h=h.correspondingUseElement),h.nodeType===3?h.parentNode:h}var yb=null,zb=null,Ab=null;function Bb(h){if(h=Cb(h)){if(typeof yb!="function")throw Error(p(280));var o=h.stateNode;o&&(o=Db(o),yb(h.stateNode,h.type,o))}}function Eb(h){zb?Ab?Ab.push(h):Ab=[h]:zb=h}function Fb(){if(zb){var h=zb,o=Ab;if(Ab=zb=null,Bb(h),o)for(h=0;h<o.length;h++)Bb(o[h])}}function Gb(h,o){return h(o)}function Hb(){}var Ib=!1;function Jb(h,o,c){if(Ib)return h(o,c);Ib=!0;try{return Gb(h,o,c)}finally{Ib=!1,(zb!==null||Ab!==null)&&(Hb(),Fb())}}function Kb(h,o){var c=h.stateNode;if(c===null)return null;var d=Db(c);if(d===null)return null;c=d[o];e:switch(o){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(d=!d.disabled)||(h=h.type,d=!(h==="button"||h==="input"||h==="select"||h==="textarea")),h=!d;break e;default:h=!1}if(h)return null;if(c&&typeof c!="function")throw Error(p(231,o,typeof c));return c}var Lb=!1;if(ia)try{var Mb={};Object.defineProperty(Mb,"passive",{get:function(){Lb=!0}}),window.addEventListener("test",Mb,Mb),window.removeEventListener("test",Mb,Mb)}catch(h){Lb=!1}function Nb(h,o,c,d,_,v,b,tt,it){var nt=Array.prototype.slice.call(arguments,3);try{o.apply(c,nt)}catch(lt){this.onError(lt)}}var Ob=!1,Pb=null,Qb=!1,Rb=null,Sb={onError:function(h){Ob=!0,Pb=h}};function Tb(h,o,c,d,_,v,b,tt,it){Ob=!1,Pb=null,Nb.apply(Sb,arguments)}function Ub(h,o,c,d,_,v,b,tt,it){if(Tb.apply(this,arguments),Ob){if(Ob){var nt=Pb;Ob=!1,Pb=null}else throw Error(p(198));Qb||(Qb=!0,Rb=nt)}}function Vb(h){var o=h,c=h;if(h.alternate)for(;o.return;)o=o.return;else{h=o;do o=h,o.flags&4098&&(c=o.return),h=o.return;while(h)}return o.tag===3?c:null}function Wb(h){if(h.tag===13){var o=h.memoizedState;if(o===null&&(h=h.alternate,h!==null&&(o=h.memoizedState)),o!==null)return o.dehydrated}return null}function Xb(h){if(Vb(h)!==h)throw Error(p(188))}function Yb(h){var o=h.alternate;if(!o){if(o=Vb(h),o===null)throw Error(p(188));return o!==h?null:h}for(var c=h,d=o;;){var _=c.return;if(_===null)break;var v=_.alternate;if(v===null){if(d=_.return,d!==null){c=d;continue}break}if(_.child===v.child){for(v=_.child;v;){if(v===c)return Xb(_),h;if(v===d)return Xb(_),o;v=v.sibling}throw Error(p(188))}if(c.return!==d.return)c=_,d=v;else{for(var b=!1,tt=_.child;tt;){if(tt===c){b=!0,c=_,d=v;break}if(tt===d){b=!0,d=_,c=v;break}tt=tt.sibling}if(!b){for(tt=v.child;tt;){if(tt===c){b=!0,c=v,d=_;break}if(tt===d){b=!0,d=v,c=_;break}tt=tt.sibling}if(!b)throw Error(p(189))}}if(c.alternate!==d)throw Error(p(190))}if(c.tag!==3)throw Error(p(188));return c.stateNode.current===c?h:o}function Zb(h){return h=Yb(h),h!==null?$b(h):null}function $b(h){if(h.tag===5||h.tag===6)return h;for(h=h.child;h!==null;){var o=$b(h);if(o!==null)return o;h=h.sibling}return null}var ac=ca.unstable_scheduleCallback,bc=ca.unstable_cancelCallback,cc=ca.unstable_shouldYield,dc=ca.unstable_requestPaint,B=ca.unstable_now,ec=ca.unstable_getCurrentPriorityLevel,fc=ca.unstable_ImmediatePriority,gc=ca.unstable_UserBlockingPriority,hc=ca.unstable_NormalPriority,ic=ca.unstable_LowPriority,jc=ca.unstable_IdlePriority,kc=null,lc=null;function mc(h){if(lc&&typeof lc.onCommitFiberRoot=="function")try{lc.onCommitFiberRoot(kc,h,void 0,(h.current.flags&128)===128)}catch{}}var oc=Math.clz32?Math.clz32:nc,pc=Math.log,qc=Math.LN2;function nc(h){return h>>>=0,h===0?32:31-(pc(h)/qc|0)|0}var rc=64,sc=4194304;function tc(h){switch(h&-h){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return h&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return h&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return h}}function uc(h,o){var c=h.pendingLanes;if(c===0)return 0;var d=0,_=h.suspendedLanes,v=h.pingedLanes,b=c&268435455;if(b!==0){var tt=b&~_;tt!==0?d=tc(tt):(v&=b,v!==0&&(d=tc(v)))}else b=c&~_,b!==0?d=tc(b):v!==0&&(d=tc(v));if(d===0)return 0;if(o!==0&&o!==d&&!(o&_)&&(_=d&-d,v=o&-o,_>=v||_===16&&(v&4194240)!==0))return o;if(d&4&&(d|=c&16),o=h.entangledLanes,o!==0)for(h=h.entanglements,o&=d;0<o;)c=31-oc(o),_=1<<c,d|=h[c],o&=~_;return d}function vc(h,o){switch(h){case 1:case 2:case 4:return o+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return o+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function wc(h,o){for(var c=h.suspendedLanes,d=h.pingedLanes,_=h.expirationTimes,v=h.pendingLanes;0<v;){var b=31-oc(v),tt=1<<b,it=_[b];it===-1?(!(tt&c)||tt&d)&&(_[b]=vc(tt,o)):it<=o&&(h.expiredLanes|=tt),v&=~tt}}function xc(h){return h=h.pendingLanes&-1073741825,h!==0?h:h&1073741824?1073741824:0}function yc(){var h=rc;return rc<<=1,!(rc&4194240)&&(rc=64),h}function zc(h){for(var o=[],c=0;31>c;c++)o.push(h);return o}function Ac(h,o,c){h.pendingLanes|=o,o!==536870912&&(h.suspendedLanes=0,h.pingedLanes=0),h=h.eventTimes,o=31-oc(o),h[o]=c}function Bc(h,o){var c=h.pendingLanes&~o;h.pendingLanes=o,h.suspendedLanes=0,h.pingedLanes=0,h.expiredLanes&=o,h.mutableReadLanes&=o,h.entangledLanes&=o,o=h.entanglements;var d=h.eventTimes;for(h=h.expirationTimes;0<c;){var _=31-oc(c),v=1<<_;o[_]=0,d[_]=-1,h[_]=-1,c&=~v}}function Cc(h,o){var c=h.entangledLanes|=o;for(h=h.entanglements;c;){var d=31-oc(c),_=1<<d;_&o|h[d]&o&&(h[d]|=o),c&=~_}}var C=0;function Dc(h){return h&=-h,1<h?4<h?h&268435455?16:536870912:4:1}var Ec,Fc,Gc,Hc,Ic,Jc=!1,Kc=[],Lc=null,Mc=null,Nc=null,Oc=new Map,Pc=new Map,Qc=[],Rc="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Sc(h,o){switch(h){case"focusin":case"focusout":Lc=null;break;case"dragenter":case"dragleave":Mc=null;break;case"mouseover":case"mouseout":Nc=null;break;case"pointerover":case"pointerout":Oc.delete(o.pointerId);break;case"gotpointercapture":case"lostpointercapture":Pc.delete(o.pointerId)}}function Tc(h,o,c,d,_,v){return h===null||h.nativeEvent!==v?(h={blockedOn:o,domEventName:c,eventSystemFlags:d,nativeEvent:v,targetContainers:[_]},o!==null&&(o=Cb(o),o!==null&&Fc(o)),h):(h.eventSystemFlags|=d,o=h.targetContainers,_!==null&&o.indexOf(_)===-1&&o.push(_),h)}function Uc(h,o,c,d,_){switch(o){case"focusin":return Lc=Tc(Lc,h,o,c,d,_),!0;case"dragenter":return Mc=Tc(Mc,h,o,c,d,_),!0;case"mouseover":return Nc=Tc(Nc,h,o,c,d,_),!0;case"pointerover":var v=_.pointerId;return Oc.set(v,Tc(Oc.get(v)||null,h,o,c,d,_)),!0;case"gotpointercapture":return v=_.pointerId,Pc.set(v,Tc(Pc.get(v)||null,h,o,c,d,_)),!0}return!1}function Vc(h){var o=Wc(h.target);if(o!==null){var c=Vb(o);if(c!==null){if(o=c.tag,o===13){if(o=Wb(c),o!==null){h.blockedOn=o,Ic(h.priority,function(){Gc(c)});return}}else if(o===3&&c.stateNode.current.memoizedState.isDehydrated){h.blockedOn=c.tag===3?c.stateNode.containerInfo:null;return}}}h.blockedOn=null}function Xc(h){if(h.blockedOn!==null)return!1;for(var o=h.targetContainers;0<o.length;){var c=Yc(h.domEventName,h.eventSystemFlags,o[0],h.nativeEvent);if(c===null){c=h.nativeEvent;var d=new c.constructor(c.type,c);wb=d,c.target.dispatchEvent(d),wb=null}else return o=Cb(c),o!==null&&Fc(o),h.blockedOn=c,!1;o.shift()}return!0}function Zc(h,o,c){Xc(h)&&c.delete(o)}function $c(){Jc=!1,Lc!==null&&Xc(Lc)&&(Lc=null),Mc!==null&&Xc(Mc)&&(Mc=null),Nc!==null&&Xc(Nc)&&(Nc=null),Oc.forEach(Zc),Pc.forEach(Zc)}function ad(h,o){h.blockedOn===o&&(h.blockedOn=null,Jc||(Jc=!0,ca.unstable_scheduleCallback(ca.unstable_NormalPriority,$c)))}function bd(h){function o(_){return ad(_,h)}if(0<Kc.length){ad(Kc[0],h);for(var c=1;c<Kc.length;c++){var d=Kc[c];d.blockedOn===h&&(d.blockedOn=null)}}for(Lc!==null&&ad(Lc,h),Mc!==null&&ad(Mc,h),Nc!==null&&ad(Nc,h),Oc.forEach(o),Pc.forEach(o),c=0;c<Qc.length;c++)d=Qc[c],d.blockedOn===h&&(d.blockedOn=null);for(;0<Qc.length&&(c=Qc[0],c.blockedOn===null);)Vc(c),c.blockedOn===null&&Qc.shift()}var cd=ua.ReactCurrentBatchConfig,dd=!0;function ed(h,o,c,d){var _=C,v=cd.transition;cd.transition=null;try{C=1,fd(h,o,c,d)}finally{C=_,cd.transition=v}}function gd(h,o,c,d){var _=C,v=cd.transition;cd.transition=null;try{C=4,fd(h,o,c,d)}finally{C=_,cd.transition=v}}function fd(h,o,c,d){if(dd){var _=Yc(h,o,c,d);if(_===null)hd(h,o,d,id$2,c),Sc(h,d);else if(Uc(_,h,o,c,d))d.stopPropagation();else if(Sc(h,d),o&4&&-1<Rc.indexOf(h)){for(;_!==null;){var v=Cb(_);if(v!==null&&Ec(v),v=Yc(h,o,c,d),v===null&&hd(h,o,d,id$2,c),v===_)break;_=v}_!==null&&d.stopPropagation()}else hd(h,o,d,null,c)}}var id$2=null;function Yc(h,o,c,d){if(id$2=null,h=xb(d),h=Wc(h),h!==null)if(o=Vb(h),o===null)h=null;else if(c=o.tag,c===13){if(h=Wb(o),h!==null)return h;h=null}else if(c===3){if(o.stateNode.current.memoizedState.isDehydrated)return o.tag===3?o.stateNode.containerInfo:null;h=null}else o!==h&&(h=null);return id$2=h,null}function jd(h){switch(h){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(ec()){case fc:return 1;case gc:return 4;case hc:case ic:return 16;case jc:return 536870912;default:return 16}default:return 16}}var kd=null,ld=null,md=null;function nd(){if(md)return md;var h,o=ld,c=o.length,d,_="value"in kd?kd.value:kd.textContent,v=_.length;for(h=0;h<c&&o[h]===_[h];h++);var b=c-h;for(d=1;d<=b&&o[c-d]===_[v-d];d++);return md=_.slice(h,1<d?1-d:void 0)}function od(h){var o=h.keyCode;return"charCode"in h?(h=h.charCode,h===0&&o===13&&(h=13)):h=o,h===10&&(h=13),32<=h||h===13?h:0}function pd(){return!0}function qd(){return!1}function rd(h){function o(c,d,_,v,b){this._reactName=c,this._targetInst=_,this.type=d,this.nativeEvent=v,this.target=b,this.currentTarget=null;for(var tt in h)h.hasOwnProperty(tt)&&(c=h[tt],this[tt]=c?c(v):v[tt]);return this.isDefaultPrevented=(v.defaultPrevented!=null?v.defaultPrevented:v.returnValue===!1)?pd:qd,this.isPropagationStopped=qd,this}return A(o.prototype,{preventDefault:function(){this.defaultPrevented=!0;var c=this.nativeEvent;c&&(c.preventDefault?c.preventDefault():typeof c.returnValue!="unknown"&&(c.returnValue=!1),this.isDefaultPrevented=pd)},stopPropagation:function(){var c=this.nativeEvent;c&&(c.stopPropagation?c.stopPropagation():typeof c.cancelBubble!="unknown"&&(c.cancelBubble=!0),this.isPropagationStopped=pd)},persist:function(){},isPersistent:pd}),o}var sd={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(h){return h.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},td=rd(sd),ud=A({},sd,{view:0,detail:0}),vd=rd(ud),wd,xd,yd,Ad=A({},ud,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:zd,button:0,buttons:0,relatedTarget:function(h){return h.relatedTarget===void 0?h.fromElement===h.srcElement?h.toElement:h.fromElement:h.relatedTarget},movementX:function(h){return"movementX"in h?h.movementX:(h!==yd&&(yd&&h.type==="mousemove"?(wd=h.screenX-yd.screenX,xd=h.screenY-yd.screenY):xd=wd=0,yd=h),wd)},movementY:function(h){return"movementY"in h?h.movementY:xd}}),Bd=rd(Ad),Cd=A({},Ad,{dataTransfer:0}),Dd=rd(Cd),Ed=A({},ud,{relatedTarget:0}),Fd=rd(Ed),Gd=A({},sd,{animationName:0,elapsedTime:0,pseudoElement:0}),Hd=rd(Gd),Id=A({},sd,{clipboardData:function(h){return"clipboardData"in h?h.clipboardData:window.clipboardData}}),Jd=rd(Id),Kd=A({},sd,{data:0}),Ld=rd(Kd),Md={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Nd={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Od={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Pd(h){var o=this.nativeEvent;return o.getModifierState?o.getModifierState(h):(h=Od[h])?!!o[h]:!1}function zd(){return Pd}var Qd=A({},ud,{key:function(h){if(h.key){var o=Md[h.key]||h.key;if(o!=="Unidentified")return o}return h.type==="keypress"?(h=od(h),h===13?"Enter":String.fromCharCode(h)):h.type==="keydown"||h.type==="keyup"?Nd[h.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:zd,charCode:function(h){return h.type==="keypress"?od(h):0},keyCode:function(h){return h.type==="keydown"||h.type==="keyup"?h.keyCode:0},which:function(h){return h.type==="keypress"?od(h):h.type==="keydown"||h.type==="keyup"?h.keyCode:0}}),Rd=rd(Qd),Sd=A({},Ad,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Td=rd(Sd),Ud=A({},ud,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:zd}),Vd=rd(Ud),Wd=A({},sd,{propertyName:0,elapsedTime:0,pseudoElement:0}),Xd=rd(Wd),Yd=A({},Ad,{deltaX:function(h){return"deltaX"in h?h.deltaX:"wheelDeltaX"in h?-h.wheelDeltaX:0},deltaY:function(h){return"deltaY"in h?h.deltaY:"wheelDeltaY"in h?-h.wheelDeltaY:"wheelDelta"in h?-h.wheelDelta:0},deltaZ:0,deltaMode:0}),Zd=rd(Yd),$d=[9,13,27,32],ae=ia&&"CompositionEvent"in window,be=null;ia&&"documentMode"in document&&(be=document.documentMode);var ce=ia&&"TextEvent"in window&&!be,de=ia&&(!ae||be&&8<be&&11>=be),ee=" ",fe=!1;function ge(h,o){switch(h){case"keyup":return $d.indexOf(o.keyCode)!==-1;case"keydown":return o.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function he(h){return h=h.detail,typeof h=="object"&&"data"in h?h.data:null}var ie=!1;function je(h,o){switch(h){case"compositionend":return he(o);case"keypress":return o.which!==32?null:(fe=!0,ee);case"textInput":return h=o.data,h===ee&&fe?null:h;default:return null}}function ke(h,o){if(ie)return h==="compositionend"||!ae&&ge(h,o)?(h=nd(),md=ld=kd=null,ie=!1,h):null;switch(h){case"paste":return null;case"keypress":if(!(o.ctrlKey||o.altKey||o.metaKey)||o.ctrlKey&&o.altKey){if(o.char&&1<o.char.length)return o.char;if(o.which)return String.fromCharCode(o.which)}return null;case"compositionend":return de&&o.locale!=="ko"?null:o.data;default:return null}}var le={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function me(h){var o=h&&h.nodeName&&h.nodeName.toLowerCase();return o==="input"?!!le[h.type]:o==="textarea"}function ne(h,o,c,d){Eb(d),o=oe(o,"onChange"),0<o.length&&(c=new td("onChange","change",null,c,d),h.push({event:c,listeners:o}))}var pe=null,qe=null;function re(h){se(h,0)}function te(h){var o=ue(h);if(Wa(o))return h}function ve(h,o){if(h==="change")return o}var we=!1;if(ia){var xe;if(ia){var ye="oninput"in document;if(!ye){var ze=document.createElement("div");ze.setAttribute("oninput","return;"),ye=typeof ze.oninput=="function"}xe=ye}else xe=!1;we=xe&&(!document.documentMode||9<document.documentMode)}function Ae(){pe&&(pe.detachEvent("onpropertychange",Be),qe=pe=null)}function Be(h){if(h.propertyName==="value"&&te(qe)){var o=[];ne(o,qe,h,xb(h)),Jb(re,o)}}function Ce(h,o,c){h==="focusin"?(Ae(),pe=o,qe=c,pe.attachEvent("onpropertychange",Be)):h==="focusout"&&Ae()}function De(h){if(h==="selectionchange"||h==="keyup"||h==="keydown")return te(qe)}function Ee(h,o){if(h==="click")return te(o)}function Fe(h,o){if(h==="input"||h==="change")return te(o)}function Ge(h,o){return h===o&&(h!==0||1/h===1/o)||h!==h&&o!==o}var He=typeof Object.is=="function"?Object.is:Ge;function Ie(h,o){if(He(h,o))return!0;if(typeof h!="object"||h===null||typeof o!="object"||o===null)return!1;var c=Object.keys(h),d=Object.keys(o);if(c.length!==d.length)return!1;for(d=0;d<c.length;d++){var _=c[d];if(!ja.call(o,_)||!He(h[_],o[_]))return!1}return!0}function Je(h){for(;h&&h.firstChild;)h=h.firstChild;return h}function Ke(h,o){var c=Je(h);h=0;for(var d;c;){if(c.nodeType===3){if(d=h+c.textContent.length,h<=o&&d>=o)return{node:c,offset:o-h};h=d}e:{for(;c;){if(c.nextSibling){c=c.nextSibling;break e}c=c.parentNode}c=void 0}c=Je(c)}}function Le(h,o){return h&&o?h===o?!0:h&&h.nodeType===3?!1:o&&o.nodeType===3?Le(h,o.parentNode):"contains"in h?h.contains(o):h.compareDocumentPosition?!!(h.compareDocumentPosition(o)&16):!1:!1}function Me(){for(var h=window,o=Xa();o instanceof h.HTMLIFrameElement;){try{var c=typeof o.contentWindow.location.href=="string"}catch{c=!1}if(c)h=o.contentWindow;else break;o=Xa(h.document)}return o}function Ne(h){var o=h&&h.nodeName&&h.nodeName.toLowerCase();return o&&(o==="input"&&(h.type==="text"||h.type==="search"||h.type==="tel"||h.type==="url"||h.type==="password")||o==="textarea"||h.contentEditable==="true")}function Oe(h){var o=Me(),c=h.focusedElem,d=h.selectionRange;if(o!==c&&c&&c.ownerDocument&&Le(c.ownerDocument.documentElement,c)){if(d!==null&&Ne(c)){if(o=d.start,h=d.end,h===void 0&&(h=o),"selectionStart"in c)c.selectionStart=o,c.selectionEnd=Math.min(h,c.value.length);else if(h=(o=c.ownerDocument||document)&&o.defaultView||window,h.getSelection){h=h.getSelection();var _=c.textContent.length,v=Math.min(d.start,_);d=d.end===void 0?v:Math.min(d.end,_),!h.extend&&v>d&&(_=d,d=v,v=_),_=Ke(c,v);var b=Ke(c,d);_&&b&&(h.rangeCount!==1||h.anchorNode!==_.node||h.anchorOffset!==_.offset||h.focusNode!==b.node||h.focusOffset!==b.offset)&&(o=o.createRange(),o.setStart(_.node,_.offset),h.removeAllRanges(),v>d?(h.addRange(o),h.extend(b.node,b.offset)):(o.setEnd(b.node,b.offset),h.addRange(o)))}}for(o=[],h=c;h=h.parentNode;)h.nodeType===1&&o.push({element:h,left:h.scrollLeft,top:h.scrollTop});for(typeof c.focus=="function"&&c.focus(),c=0;c<o.length;c++)h=o[c],h.element.scrollLeft=h.left,h.element.scrollTop=h.top}}var Pe=ia&&"documentMode"in document&&11>=document.documentMode,Qe=null,Re=null,Se=null,Te=!1;function Ue(h,o,c){var d=c.window===c?c.document:c.nodeType===9?c:c.ownerDocument;Te||Qe==null||Qe!==Xa(d)||(d=Qe,"selectionStart"in d&&Ne(d)?d={start:d.selectionStart,end:d.selectionEnd}:(d=(d.ownerDocument&&d.ownerDocument.defaultView||window).getSelection(),d={anchorNode:d.anchorNode,anchorOffset:d.anchorOffset,focusNode:d.focusNode,focusOffset:d.focusOffset}),Se&&Ie(Se,d)||(Se=d,d=oe(Re,"onSelect"),0<d.length&&(o=new td("onSelect","select",null,o,c),h.push({event:o,listeners:d}),o.target=Qe)))}function Ve(h,o){var c={};return c[h.toLowerCase()]=o.toLowerCase(),c["Webkit"+h]="webkit"+o,c["Moz"+h]="moz"+o,c}var We={animationend:Ve("Animation","AnimationEnd"),animationiteration:Ve("Animation","AnimationIteration"),animationstart:Ve("Animation","AnimationStart"),transitionend:Ve("Transition","TransitionEnd")},Xe={},Ye={};ia&&(Ye=document.createElement("div").style,"AnimationEvent"in window||(delete We.animationend.animation,delete We.animationiteration.animation,delete We.animationstart.animation),"TransitionEvent"in window||delete We.transitionend.transition);function Ze(h){if(Xe[h])return Xe[h];if(!We[h])return h;var o=We[h],c;for(c in o)if(o.hasOwnProperty(c)&&c in Ye)return Xe[h]=o[c];return h}var $e=Ze("animationend"),af=Ze("animationiteration"),bf=Ze("animationstart"),cf=Ze("transitionend"),df=new Map,ef="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function ff(h,o){df.set(h,o),fa(o,[h])}for(var gf=0;gf<ef.length;gf++){var hf=ef[gf],jf=hf.toLowerCase(),kf=hf[0].toUpperCase()+hf.slice(1);ff(jf,"on"+kf)}ff($e,"onAnimationEnd");ff(af,"onAnimationIteration");ff(bf,"onAnimationStart");ff("dblclick","onDoubleClick");ff("focusin","onFocus");ff("focusout","onBlur");ff(cf,"onTransitionEnd");ha("onMouseEnter",["mouseout","mouseover"]);ha("onMouseLeave",["mouseout","mouseover"]);ha("onPointerEnter",["pointerout","pointerover"]);ha("onPointerLeave",["pointerout","pointerover"]);fa("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));fa("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));fa("onBeforeInput",["compositionend","keypress","textInput","paste"]);fa("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));fa("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));fa("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var lf="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),mf=new Set("cancel close invalid load scroll toggle".split(" ").concat(lf));function nf(h,o,c){var d=h.type||"unknown-event";h.currentTarget=c,Ub(d,o,void 0,h),h.currentTarget=null}function se(h,o){o=(o&4)!==0;for(var c=0;c<h.length;c++){var d=h[c],_=d.event;d=d.listeners;e:{var v=void 0;if(o)for(var b=d.length-1;0<=b;b--){var tt=d[b],it=tt.instance,nt=tt.currentTarget;if(tt=tt.listener,it!==v&&_.isPropagationStopped())break e;nf(_,tt,nt),v=it}else for(b=0;b<d.length;b++){if(tt=d[b],it=tt.instance,nt=tt.currentTarget,tt=tt.listener,it!==v&&_.isPropagationStopped())break e;nf(_,tt,nt),v=it}}}if(Qb)throw h=Rb,Qb=!1,Rb=null,h}function D(h,o){var c=o[of];c===void 0&&(c=o[of]=new Set);var d=h+"__bubble";c.has(d)||(pf(o,h,2,!1),c.add(d))}function qf(h,o,c){var d=0;o&&(d|=4),pf(c,h,d,o)}var rf="_reactListening"+Math.random().toString(36).slice(2);function sf(h){if(!h[rf]){h[rf]=!0,da.forEach(function(c){c!=="selectionchange"&&(mf.has(c)||qf(c,!1,h),qf(c,!0,h))});var o=h.nodeType===9?h:h.ownerDocument;o===null||o[rf]||(o[rf]=!0,qf("selectionchange",!1,o))}}function pf(h,o,c,d){switch(jd(o)){case 1:var _=ed;break;case 4:_=gd;break;default:_=fd}c=_.bind(null,o,c,h),_=void 0,!Lb||o!=="touchstart"&&o!=="touchmove"&&o!=="wheel"||(_=!0),d?_!==void 0?h.addEventListener(o,c,{capture:!0,passive:_}):h.addEventListener(o,c,!0):_!==void 0?h.addEventListener(o,c,{passive:_}):h.addEventListener(o,c,!1)}function hd(h,o,c,d,_){var v=d;if(!(o&1)&&!(o&2)&&d!==null)e:for(;;){if(d===null)return;var b=d.tag;if(b===3||b===4){var tt=d.stateNode.containerInfo;if(tt===_||tt.nodeType===8&&tt.parentNode===_)break;if(b===4)for(b=d.return;b!==null;){var it=b.tag;if((it===3||it===4)&&(it=b.stateNode.containerInfo,it===_||it.nodeType===8&&it.parentNode===_))return;b=b.return}for(;tt!==null;){if(b=Wc(tt),b===null)return;if(it=b.tag,it===5||it===6){d=v=b;continue e}tt=tt.parentNode}}d=d.return}Jb(function(){var nt=v,lt=xb(c),ut=[];e:{var ht=df.get(h);if(ht!==void 0){var _t=td,ft=h;switch(h){case"keypress":if(od(c)===0)break e;case"keydown":case"keyup":_t=Rd;break;case"focusin":ft="focus",_t=Fd;break;case"focusout":ft="blur",_t=Fd;break;case"beforeblur":case"afterblur":_t=Fd;break;case"click":if(c.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":_t=Bd;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":_t=Dd;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":_t=Vd;break;case $e:case af:case bf:_t=Hd;break;case cf:_t=Xd;break;case"scroll":_t=vd;break;case"wheel":_t=Zd;break;case"copy":case"cut":case"paste":_t=Jd;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":_t=Td}var bt=(o&4)!==0,xt=!bt&&h==="scroll",St=bt?ht!==null?ht+"Capture":null:ht;bt=[];for(var wt=nt,Pt;wt!==null;){Pt=wt;var Rt=Pt.stateNode;if(Pt.tag===5&&Rt!==null&&(Pt=Rt,St!==null&&(Rt=Kb(wt,St),Rt!=null&&bt.push(tf(wt,Rt,Pt)))),xt)break;wt=wt.return}0<bt.length&&(ht=new _t(ht,ft,null,c,lt),ut.push({event:ht,listeners:bt}))}}if(!(o&7)){e:{if(ht=h==="mouseover"||h==="pointerover",_t=h==="mouseout"||h==="pointerout",ht&&c!==wb&&(ft=c.relatedTarget||c.fromElement)&&(Wc(ft)||ft[uf]))break e;if((_t||ht)&&(ht=lt.window===lt?lt:(ht=lt.ownerDocument)?ht.defaultView||ht.parentWindow:window,_t?(ft=c.relatedTarget||c.toElement,_t=nt,ft=ft?Wc(ft):null,ft!==null&&(xt=Vb(ft),ft!==xt||ft.tag!==5&&ft.tag!==6)&&(ft=null)):(_t=null,ft=nt),_t!==ft)){if(bt=Bd,Rt="onMouseLeave",St="onMouseEnter",wt="mouse",(h==="pointerout"||h==="pointerover")&&(bt=Td,Rt="onPointerLeave",St="onPointerEnter",wt="pointer"),xt=_t==null?ht:ue(_t),Pt=ft==null?ht:ue(ft),ht=new bt(Rt,wt+"leave",_t,c,lt),ht.target=xt,ht.relatedTarget=Pt,Rt=null,Wc(lt)===nt&&(bt=new bt(St,wt+"enter",ft,c,lt),bt.target=Pt,bt.relatedTarget=xt,Rt=bt),xt=Rt,_t&&ft)t:{for(bt=_t,St=ft,wt=0,Pt=bt;Pt;Pt=vf(Pt))wt++;for(Pt=0,Rt=St;Rt;Rt=vf(Rt))Pt++;for(;0<wt-Pt;)bt=vf(bt),wt--;for(;0<Pt-wt;)St=vf(St),Pt--;for(;wt--;){if(bt===St||St!==null&&bt===St.alternate)break t;bt=vf(bt),St=vf(St)}bt=null}else bt=null;_t!==null&&wf(ut,ht,_t,bt,!1),ft!==null&&xt!==null&&wf(ut,xt,ft,bt,!0)}}e:{if(ht=nt?ue(nt):window,_t=ht.nodeName&&ht.nodeName.toLowerCase(),_t==="select"||_t==="input"&&ht.type==="file")var kt=ve;else if(me(ht))if(we)kt=Fe;else{kt=De;var Gt=Ce}else(_t=ht.nodeName)&&_t.toLowerCase()==="input"&&(ht.type==="checkbox"||ht.type==="radio")&&(kt=Ee);if(kt&&(kt=kt(h,nt))){ne(ut,kt,c,lt);break e}Gt&&Gt(h,ht,nt),h==="focusout"&&(Gt=ht._wrapperState)&&Gt.controlled&&ht.type==="number"&&cb(ht,"number",ht.value)}switch(Gt=nt?ue(nt):window,h){case"focusin":(me(Gt)||Gt.contentEditable==="true")&&(Qe=Gt,Re=nt,Se=null);break;case"focusout":Se=Re=Qe=null;break;case"mousedown":Te=!0;break;case"contextmenu":case"mouseup":case"dragend":Te=!1,Ue(ut,c,lt);break;case"selectionchange":if(Pe)break;case"keydown":case"keyup":Ue(ut,c,lt)}var Dt;if(ae)e:{switch(h){case"compositionstart":var It="onCompositionStart";break e;case"compositionend":It="onCompositionEnd";break e;case"compositionupdate":It="onCompositionUpdate";break e}It=void 0}else ie?ge(h,c)&&(It="onCompositionEnd"):h==="keydown"&&c.keyCode===229&&(It="onCompositionStart");It&&(de&&c.locale!=="ko"&&(ie||It!=="onCompositionStart"?It==="onCompositionEnd"&&ie&&(Dt=nd()):(kd=lt,ld="value"in kd?kd.value:kd.textContent,ie=!0)),Gt=oe(nt,It),0<Gt.length&&(It=new Ld(It,h,null,c,lt),ut.push({event:It,listeners:Gt}),Dt?It.data=Dt:(Dt=he(c),Dt!==null&&(It.data=Dt)))),(Dt=ce?je(h,c):ke(h,c))&&(nt=oe(nt,"onBeforeInput"),0<nt.length&&(lt=new Ld("onBeforeInput","beforeinput",null,c,lt),ut.push({event:lt,listeners:nt}),lt.data=Dt))}se(ut,o)})}function tf(h,o,c){return{instance:h,listener:o,currentTarget:c}}function oe(h,o){for(var c=o+"Capture",d=[];h!==null;){var _=h,v=_.stateNode;_.tag===5&&v!==null&&(_=v,v=Kb(h,c),v!=null&&d.unshift(tf(h,v,_)),v=Kb(h,o),v!=null&&d.push(tf(h,v,_))),h=h.return}return d}function vf(h){if(h===null)return null;do h=h.return;while(h&&h.tag!==5);return h||null}function wf(h,o,c,d,_){for(var v=o._reactName,b=[];c!==null&&c!==d;){var tt=c,it=tt.alternate,nt=tt.stateNode;if(it!==null&&it===d)break;tt.tag===5&&nt!==null&&(tt=nt,_?(it=Kb(c,v),it!=null&&b.unshift(tf(c,it,tt))):_||(it=Kb(c,v),it!=null&&b.push(tf(c,it,tt)))),c=c.return}b.length!==0&&h.push({event:o,listeners:b})}var xf=/\r\n?/g,yf=/\u0000|\uFFFD/g;function zf(h){return(typeof h=="string"?h:""+h).replace(xf,`
`).replace(yf,"")}function Af(h,o,c){if(o=zf(o),zf(h)!==o&&c)throw Error(p(425))}function Bf(){}var Cf=null,Df=null;function Ef(h,o){return h==="textarea"||h==="noscript"||typeof o.children=="string"||typeof o.children=="number"||typeof o.dangerouslySetInnerHTML=="object"&&o.dangerouslySetInnerHTML!==null&&o.dangerouslySetInnerHTML.__html!=null}var Ff=typeof setTimeout=="function"?setTimeout:void 0,Gf=typeof clearTimeout=="function"?clearTimeout:void 0,Hf=typeof Promise=="function"?Promise:void 0,Jf=typeof queueMicrotask=="function"?queueMicrotask:typeof Hf<"u"?function(h){return Hf.resolve(null).then(h).catch(If)}:Ff;function If(h){setTimeout(function(){throw h})}function Kf(h,o){var c=o,d=0;do{var _=c.nextSibling;if(h.removeChild(c),_&&_.nodeType===8)if(c=_.data,c==="/$"){if(d===0){h.removeChild(_),bd(o);return}d--}else c!=="$"&&c!=="$?"&&c!=="$!"||d++;c=_}while(c);bd(o)}function Lf(h){for(;h!=null;h=h.nextSibling){var o=h.nodeType;if(o===1||o===3)break;if(o===8){if(o=h.data,o==="$"||o==="$!"||o==="$?")break;if(o==="/$")return null}}return h}function Mf(h){h=h.previousSibling;for(var o=0;h;){if(h.nodeType===8){var c=h.data;if(c==="$"||c==="$!"||c==="$?"){if(o===0)return h;o--}else c==="/$"&&o++}h=h.previousSibling}return null}var Nf=Math.random().toString(36).slice(2),Of="__reactFiber$"+Nf,Pf="__reactProps$"+Nf,uf="__reactContainer$"+Nf,of="__reactEvents$"+Nf,Qf="__reactListeners$"+Nf,Rf="__reactHandles$"+Nf;function Wc(h){var o=h[Of];if(o)return o;for(var c=h.parentNode;c;){if(o=c[uf]||c[Of]){if(c=o.alternate,o.child!==null||c!==null&&c.child!==null)for(h=Mf(h);h!==null;){if(c=h[Of])return c;h=Mf(h)}return o}h=c,c=h.parentNode}return null}function Cb(h){return h=h[Of]||h[uf],!h||h.tag!==5&&h.tag!==6&&h.tag!==13&&h.tag!==3?null:h}function ue(h){if(h.tag===5||h.tag===6)return h.stateNode;throw Error(p(33))}function Db(h){return h[Pf]||null}var Sf=[],Tf=-1;function Uf(h){return{current:h}}function E(h){0>Tf||(h.current=Sf[Tf],Sf[Tf]=null,Tf--)}function G(h,o){Tf++,Sf[Tf]=h.current,h.current=o}var Vf={},H=Uf(Vf),Wf=Uf(!1),Xf=Vf;function Yf(h,o){var c=h.type.contextTypes;if(!c)return Vf;var d=h.stateNode;if(d&&d.__reactInternalMemoizedUnmaskedChildContext===o)return d.__reactInternalMemoizedMaskedChildContext;var _={},v;for(v in c)_[v]=o[v];return d&&(h=h.stateNode,h.__reactInternalMemoizedUnmaskedChildContext=o,h.__reactInternalMemoizedMaskedChildContext=_),_}function Zf(h){return h=h.childContextTypes,h!=null}function $f(){E(Wf),E(H)}function ag(h,o,c){if(H.current!==Vf)throw Error(p(168));G(H,o),G(Wf,c)}function bg(h,o,c){var d=h.stateNode;if(o=o.childContextTypes,typeof d.getChildContext!="function")return c;d=d.getChildContext();for(var _ in d)if(!(_ in o))throw Error(p(108,Ra(h)||"Unknown",_));return A({},c,d)}function cg(h){return h=(h=h.stateNode)&&h.__reactInternalMemoizedMergedChildContext||Vf,Xf=H.current,G(H,h),G(Wf,Wf.current),!0}function dg(h,o,c){var d=h.stateNode;if(!d)throw Error(p(169));c?(h=bg(h,o,Xf),d.__reactInternalMemoizedMergedChildContext=h,E(Wf),E(H),G(H,h)):E(Wf),G(Wf,c)}var eg=null,fg=!1,gg=!1;function hg(h){eg===null?eg=[h]:eg.push(h)}function ig(h){fg=!0,hg(h)}function jg(){if(!gg&&eg!==null){gg=!0;var h=0,o=C;try{var c=eg;for(C=1;h<c.length;h++){var d=c[h];do d=d(!0);while(d!==null)}eg=null,fg=!1}catch(_){throw eg!==null&&(eg=eg.slice(h+1)),ac(fc,jg),_}finally{C=o,gg=!1}}return null}var kg=[],lg=0,mg=null,ng=0,og=[],pg=0,qg=null,rg=1,sg="";function tg(h,o){kg[lg++]=ng,kg[lg++]=mg,mg=h,ng=o}function ug(h,o,c){og[pg++]=rg,og[pg++]=sg,og[pg++]=qg,qg=h;var d=rg;h=sg;var _=32-oc(d)-1;d&=~(1<<_),c+=1;var v=32-oc(o)+_;if(30<v){var b=_-_%5;v=(d&(1<<b)-1).toString(32),d>>=b,_-=b,rg=1<<32-oc(o)+_|c<<_|d,sg=v+h}else rg=1<<v|c<<_|d,sg=h}function vg(h){h.return!==null&&(tg(h,1),ug(h,1,0))}function wg(h){for(;h===mg;)mg=kg[--lg],kg[lg]=null,ng=kg[--lg],kg[lg]=null;for(;h===qg;)qg=og[--pg],og[pg]=null,sg=og[--pg],og[pg]=null,rg=og[--pg],og[pg]=null}var xg=null,yg=null,I=!1,zg=null;function Ag(h,o){var c=Bg(5,null,null,0);c.elementType="DELETED",c.stateNode=o,c.return=h,o=h.deletions,o===null?(h.deletions=[c],h.flags|=16):o.push(c)}function Cg(h,o){switch(h.tag){case 5:var c=h.type;return o=o.nodeType!==1||c.toLowerCase()!==o.nodeName.toLowerCase()?null:o,o!==null?(h.stateNode=o,xg=h,yg=Lf(o.firstChild),!0):!1;case 6:return o=h.pendingProps===""||o.nodeType!==3?null:o,o!==null?(h.stateNode=o,xg=h,yg=null,!0):!1;case 13:return o=o.nodeType!==8?null:o,o!==null?(c=qg!==null?{id:rg,overflow:sg}:null,h.memoizedState={dehydrated:o,treeContext:c,retryLane:1073741824},c=Bg(18,null,null,0),c.stateNode=o,c.return=h,h.child=c,xg=h,yg=null,!0):!1;default:return!1}}function Dg(h){return(h.mode&1)!==0&&(h.flags&128)===0}function Eg(h){if(I){var o=yg;if(o){var c=o;if(!Cg(h,o)){if(Dg(h))throw Error(p(418));o=Lf(c.nextSibling);var d=xg;o&&Cg(h,o)?Ag(d,c):(h.flags=h.flags&-4097|2,I=!1,xg=h)}}else{if(Dg(h))throw Error(p(418));h.flags=h.flags&-4097|2,I=!1,xg=h}}}function Fg(h){for(h=h.return;h!==null&&h.tag!==5&&h.tag!==3&&h.tag!==13;)h=h.return;xg=h}function Gg(h){if(h!==xg)return!1;if(!I)return Fg(h),I=!0,!1;var o;if((o=h.tag!==3)&&!(o=h.tag!==5)&&(o=h.type,o=o!=="head"&&o!=="body"&&!Ef(h.type,h.memoizedProps)),o&&(o=yg)){if(Dg(h))throw Hg(),Error(p(418));for(;o;)Ag(h,o),o=Lf(o.nextSibling)}if(Fg(h),h.tag===13){if(h=h.memoizedState,h=h!==null?h.dehydrated:null,!h)throw Error(p(317));e:{for(h=h.nextSibling,o=0;h;){if(h.nodeType===8){var c=h.data;if(c==="/$"){if(o===0){yg=Lf(h.nextSibling);break e}o--}else c!=="$"&&c!=="$!"&&c!=="$?"||o++}h=h.nextSibling}yg=null}}else yg=xg?Lf(h.stateNode.nextSibling):null;return!0}function Hg(){for(var h=yg;h;)h=Lf(h.nextSibling)}function Ig(){yg=xg=null,I=!1}function Jg(h){zg===null?zg=[h]:zg.push(h)}var Kg=ua.ReactCurrentBatchConfig;function Lg(h,o,c){if(h=c.ref,h!==null&&typeof h!="function"&&typeof h!="object"){if(c._owner){if(c=c._owner,c){if(c.tag!==1)throw Error(p(309));var d=c.stateNode}if(!d)throw Error(p(147,h));var _=d,v=""+h;return o!==null&&o.ref!==null&&typeof o.ref=="function"&&o.ref._stringRef===v?o.ref:(o=function(b){var tt=_.refs;b===null?delete tt[v]:tt[v]=b},o._stringRef=v,o)}if(typeof h!="string")throw Error(p(284));if(!c._owner)throw Error(p(290,h))}return h}function Mg(h,o){throw h=Object.prototype.toString.call(o),Error(p(31,h==="[object Object]"?"object with keys {"+Object.keys(o).join(", ")+"}":h))}function Ng(h){var o=h._init;return o(h._payload)}function Og(h){function o(St,wt){if(h){var Pt=St.deletions;Pt===null?(St.deletions=[wt],St.flags|=16):Pt.push(wt)}}function c(St,wt){if(!h)return null;for(;wt!==null;)o(St,wt),wt=wt.sibling;return null}function d(St,wt){for(St=new Map;wt!==null;)wt.key!==null?St.set(wt.key,wt):St.set(wt.index,wt),wt=wt.sibling;return St}function _(St,wt){return St=Pg(St,wt),St.index=0,St.sibling=null,St}function v(St,wt,Pt){return St.index=Pt,h?(Pt=St.alternate,Pt!==null?(Pt=Pt.index,Pt<wt?(St.flags|=2,wt):Pt):(St.flags|=2,wt)):(St.flags|=1048576,wt)}function b(St){return h&&St.alternate===null&&(St.flags|=2),St}function tt(St,wt,Pt,Rt){return wt===null||wt.tag!==6?(wt=Qg(Pt,St.mode,Rt),wt.return=St,wt):(wt=_(wt,Pt),wt.return=St,wt)}function it(St,wt,Pt,Rt){var kt=Pt.type;return kt===ya?lt(St,wt,Pt.props.children,Rt,Pt.key):wt!==null&&(wt.elementType===kt||typeof kt=="object"&&kt!==null&&kt.$$typeof===Ha&&Ng(kt)===wt.type)?(Rt=_(wt,Pt.props),Rt.ref=Lg(St,wt,Pt),Rt.return=St,Rt):(Rt=Rg(Pt.type,Pt.key,Pt.props,null,St.mode,Rt),Rt.ref=Lg(St,wt,Pt),Rt.return=St,Rt)}function nt(St,wt,Pt,Rt){return wt===null||wt.tag!==4||wt.stateNode.containerInfo!==Pt.containerInfo||wt.stateNode.implementation!==Pt.implementation?(wt=Sg(Pt,St.mode,Rt),wt.return=St,wt):(wt=_(wt,Pt.children||[]),wt.return=St,wt)}function lt(St,wt,Pt,Rt,kt){return wt===null||wt.tag!==7?(wt=Tg(Pt,St.mode,Rt,kt),wt.return=St,wt):(wt=_(wt,Pt),wt.return=St,wt)}function ut(St,wt,Pt){if(typeof wt=="string"&&wt!==""||typeof wt=="number")return wt=Qg(""+wt,St.mode,Pt),wt.return=St,wt;if(typeof wt=="object"&&wt!==null){switch(wt.$$typeof){case va:return Pt=Rg(wt.type,wt.key,wt.props,null,St.mode,Pt),Pt.ref=Lg(St,null,wt),Pt.return=St,Pt;case wa:return wt=Sg(wt,St.mode,Pt),wt.return=St,wt;case Ha:var Rt=wt._init;return ut(St,Rt(wt._payload),Pt)}if(eb(wt)||Ka(wt))return wt=Tg(wt,St.mode,Pt,null),wt.return=St,wt;Mg(St,wt)}return null}function ht(St,wt,Pt,Rt){var kt=wt!==null?wt.key:null;if(typeof Pt=="string"&&Pt!==""||typeof Pt=="number")return kt!==null?null:tt(St,wt,""+Pt,Rt);if(typeof Pt=="object"&&Pt!==null){switch(Pt.$$typeof){case va:return Pt.key===kt?it(St,wt,Pt,Rt):null;case wa:return Pt.key===kt?nt(St,wt,Pt,Rt):null;case Ha:return kt=Pt._init,ht(St,wt,kt(Pt._payload),Rt)}if(eb(Pt)||Ka(Pt))return kt!==null?null:lt(St,wt,Pt,Rt,null);Mg(St,Pt)}return null}function _t(St,wt,Pt,Rt,kt){if(typeof Rt=="string"&&Rt!==""||typeof Rt=="number")return St=St.get(Pt)||null,tt(wt,St,""+Rt,kt);if(typeof Rt=="object"&&Rt!==null){switch(Rt.$$typeof){case va:return St=St.get(Rt.key===null?Pt:Rt.key)||null,it(wt,St,Rt,kt);case wa:return St=St.get(Rt.key===null?Pt:Rt.key)||null,nt(wt,St,Rt,kt);case Ha:var Gt=Rt._init;return _t(St,wt,Pt,Gt(Rt._payload),kt)}if(eb(Rt)||Ka(Rt))return St=St.get(Pt)||null,lt(wt,St,Rt,kt,null);Mg(wt,Rt)}return null}function ft(St,wt,Pt,Rt){for(var kt=null,Gt=null,Dt=wt,It=wt=0,Nt=null;Dt!==null&&It<Pt.length;It++){Dt.index>It?(Nt=Dt,Dt=null):Nt=Dt.sibling;var Vt=ht(St,Dt,Pt[It],Rt);if(Vt===null){Dt===null&&(Dt=Nt);break}h&&Dt&&Vt.alternate===null&&o(St,Dt),wt=v(Vt,wt,It),Gt===null?kt=Vt:Gt.sibling=Vt,Gt=Vt,Dt=Nt}if(It===Pt.length)return c(St,Dt),I&&tg(St,It),kt;if(Dt===null){for(;It<Pt.length;It++)Dt=ut(St,Pt[It],Rt),Dt!==null&&(wt=v(Dt,wt,It),Gt===null?kt=Dt:Gt.sibling=Dt,Gt=Dt);return I&&tg(St,It),kt}for(Dt=d(St,Dt);It<Pt.length;It++)Nt=_t(Dt,St,It,Pt[It],Rt),Nt!==null&&(h&&Nt.alternate!==null&&Dt.delete(Nt.key===null?It:Nt.key),wt=v(Nt,wt,It),Gt===null?kt=Nt:Gt.sibling=Nt,Gt=Nt);return h&&Dt.forEach(function(Kt){return o(St,Kt)}),I&&tg(St,It),kt}function bt(St,wt,Pt,Rt){var kt=Ka(Pt);if(typeof kt!="function")throw Error(p(150));if(Pt=kt.call(Pt),Pt==null)throw Error(p(151));for(var Gt=kt=null,Dt=wt,It=wt=0,Nt=null,Vt=Pt.next();Dt!==null&&!Vt.done;It++,Vt=Pt.next()){Dt.index>It?(Nt=Dt,Dt=null):Nt=Dt.sibling;var Kt=ht(St,Dt,Vt.value,Rt);if(Kt===null){Dt===null&&(Dt=Nt);break}h&&Dt&&Kt.alternate===null&&o(St,Dt),wt=v(Kt,wt,It),Gt===null?kt=Kt:Gt.sibling=Kt,Gt=Kt,Dt=Nt}if(Vt.done)return c(St,Dt),I&&tg(St,It),kt;if(Dt===null){for(;!Vt.done;It++,Vt=Pt.next())Vt=ut(St,Vt.value,Rt),Vt!==null&&(wt=v(Vt,wt,It),Gt===null?kt=Vt:Gt.sibling=Vt,Gt=Vt);return I&&tg(St,It),kt}for(Dt=d(St,Dt);!Vt.done;It++,Vt=Pt.next())Vt=_t(Dt,St,It,Vt.value,Rt),Vt!==null&&(h&&Vt.alternate!==null&&Dt.delete(Vt.key===null?It:Vt.key),wt=v(Vt,wt,It),Gt===null?kt=Vt:Gt.sibling=Vt,Gt=Vt);return h&&Dt.forEach(function(Yt){return o(St,Yt)}),I&&tg(St,It),kt}function xt(St,wt,Pt,Rt){if(typeof Pt=="object"&&Pt!==null&&Pt.type===ya&&Pt.key===null&&(Pt=Pt.props.children),typeof Pt=="object"&&Pt!==null){switch(Pt.$$typeof){case va:e:{for(var kt=Pt.key,Gt=wt;Gt!==null;){if(Gt.key===kt){if(kt=Pt.type,kt===ya){if(Gt.tag===7){c(St,Gt.sibling),wt=_(Gt,Pt.props.children),wt.return=St,St=wt;break e}}else if(Gt.elementType===kt||typeof kt=="object"&&kt!==null&&kt.$$typeof===Ha&&Ng(kt)===Gt.type){c(St,Gt.sibling),wt=_(Gt,Pt.props),wt.ref=Lg(St,Gt,Pt),wt.return=St,St=wt;break e}c(St,Gt);break}else o(St,Gt);Gt=Gt.sibling}Pt.type===ya?(wt=Tg(Pt.props.children,St.mode,Rt,Pt.key),wt.return=St,St=wt):(Rt=Rg(Pt.type,Pt.key,Pt.props,null,St.mode,Rt),Rt.ref=Lg(St,wt,Pt),Rt.return=St,St=Rt)}return b(St);case wa:e:{for(Gt=Pt.key;wt!==null;){if(wt.key===Gt)if(wt.tag===4&&wt.stateNode.containerInfo===Pt.containerInfo&&wt.stateNode.implementation===Pt.implementation){c(St,wt.sibling),wt=_(wt,Pt.children||[]),wt.return=St,St=wt;break e}else{c(St,wt);break}else o(St,wt);wt=wt.sibling}wt=Sg(Pt,St.mode,Rt),wt.return=St,St=wt}return b(St);case Ha:return Gt=Pt._init,xt(St,wt,Gt(Pt._payload),Rt)}if(eb(Pt))return ft(St,wt,Pt,Rt);if(Ka(Pt))return bt(St,wt,Pt,Rt);Mg(St,Pt)}return typeof Pt=="string"&&Pt!==""||typeof Pt=="number"?(Pt=""+Pt,wt!==null&&wt.tag===6?(c(St,wt.sibling),wt=_(wt,Pt),wt.return=St,St=wt):(c(St,wt),wt=Qg(Pt,St.mode,Rt),wt.return=St,St=wt),b(St)):c(St,wt)}return xt}var Ug=Og(!0),Vg=Og(!1),Wg=Uf(null),Xg=null,Yg=null,Zg=null;function $g(){Zg=Yg=Xg=null}function ah(h){var o=Wg.current;E(Wg),h._currentValue=o}function bh(h,o,c){for(;h!==null;){var d=h.alternate;if((h.childLanes&o)!==o?(h.childLanes|=o,d!==null&&(d.childLanes|=o)):d!==null&&(d.childLanes&o)!==o&&(d.childLanes|=o),h===c)break;h=h.return}}function ch(h,o){Xg=h,Zg=Yg=null,h=h.dependencies,h!==null&&h.firstContext!==null&&(h.lanes&o&&(dh=!0),h.firstContext=null)}function eh(h){var o=h._currentValue;if(Zg!==h)if(h={context:h,memoizedValue:o,next:null},Yg===null){if(Xg===null)throw Error(p(308));Yg=h,Xg.dependencies={lanes:0,firstContext:h}}else Yg=Yg.next=h;return o}var fh=null;function gh(h){fh===null?fh=[h]:fh.push(h)}function hh(h,o,c,d){var _=o.interleaved;return _===null?(c.next=c,gh(o)):(c.next=_.next,_.next=c),o.interleaved=c,ih(h,d)}function ih(h,o){h.lanes|=o;var c=h.alternate;for(c!==null&&(c.lanes|=o),c=h,h=h.return;h!==null;)h.childLanes|=o,c=h.alternate,c!==null&&(c.childLanes|=o),c=h,h=h.return;return c.tag===3?c.stateNode:null}var jh=!1;function kh(h){h.updateQueue={baseState:h.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function lh(h,o){h=h.updateQueue,o.updateQueue===h&&(o.updateQueue={baseState:h.baseState,firstBaseUpdate:h.firstBaseUpdate,lastBaseUpdate:h.lastBaseUpdate,shared:h.shared,effects:h.effects})}function mh(h,o){return{eventTime:h,lane:o,tag:0,payload:null,callback:null,next:null}}function nh(h,o,c){var d=h.updateQueue;if(d===null)return null;if(d=d.shared,K&2){var _=d.pending;return _===null?o.next=o:(o.next=_.next,_.next=o),d.pending=o,ih(h,c)}return _=d.interleaved,_===null?(o.next=o,gh(d)):(o.next=_.next,_.next=o),d.interleaved=o,ih(h,c)}function oh(h,o,c){if(o=o.updateQueue,o!==null&&(o=o.shared,(c&4194240)!==0)){var d=o.lanes;d&=h.pendingLanes,c|=d,o.lanes=c,Cc(h,c)}}function ph(h,o){var c=h.updateQueue,d=h.alternate;if(d!==null&&(d=d.updateQueue,c===d)){var _=null,v=null;if(c=c.firstBaseUpdate,c!==null){do{var b={eventTime:c.eventTime,lane:c.lane,tag:c.tag,payload:c.payload,callback:c.callback,next:null};v===null?_=v=b:v=v.next=b,c=c.next}while(c!==null);v===null?_=v=o:v=v.next=o}else _=v=o;c={baseState:d.baseState,firstBaseUpdate:_,lastBaseUpdate:v,shared:d.shared,effects:d.effects},h.updateQueue=c;return}h=c.lastBaseUpdate,h===null?c.firstBaseUpdate=o:h.next=o,c.lastBaseUpdate=o}function qh(h,o,c,d){var _=h.updateQueue;jh=!1;var v=_.firstBaseUpdate,b=_.lastBaseUpdate,tt=_.shared.pending;if(tt!==null){_.shared.pending=null;var it=tt,nt=it.next;it.next=null,b===null?v=nt:b.next=nt,b=it;var lt=h.alternate;lt!==null&&(lt=lt.updateQueue,tt=lt.lastBaseUpdate,tt!==b&&(tt===null?lt.firstBaseUpdate=nt:tt.next=nt,lt.lastBaseUpdate=it))}if(v!==null){var ut=_.baseState;b=0,lt=nt=it=null,tt=v;do{var ht=tt.lane,_t=tt.eventTime;if((d&ht)===ht){lt!==null&&(lt=lt.next={eventTime:_t,lane:0,tag:tt.tag,payload:tt.payload,callback:tt.callback,next:null});e:{var ft=h,bt=tt;switch(ht=o,_t=c,bt.tag){case 1:if(ft=bt.payload,typeof ft=="function"){ut=ft.call(_t,ut,ht);break e}ut=ft;break e;case 3:ft.flags=ft.flags&-65537|128;case 0:if(ft=bt.payload,ht=typeof ft=="function"?ft.call(_t,ut,ht):ft,ht==null)break e;ut=A({},ut,ht);break e;case 2:jh=!0}}tt.callback!==null&&tt.lane!==0&&(h.flags|=64,ht=_.effects,ht===null?_.effects=[tt]:ht.push(tt))}else _t={eventTime:_t,lane:ht,tag:tt.tag,payload:tt.payload,callback:tt.callback,next:null},lt===null?(nt=lt=_t,it=ut):lt=lt.next=_t,b|=ht;if(tt=tt.next,tt===null){if(tt=_.shared.pending,tt===null)break;ht=tt,tt=ht.next,ht.next=null,_.lastBaseUpdate=ht,_.shared.pending=null}}while(!0);if(lt===null&&(it=ut),_.baseState=it,_.firstBaseUpdate=nt,_.lastBaseUpdate=lt,o=_.shared.interleaved,o!==null){_=o;do b|=_.lane,_=_.next;while(_!==o)}else v===null&&(_.shared.lanes=0);rh|=b,h.lanes=b,h.memoizedState=ut}}function sh(h,o,c){if(h=o.effects,o.effects=null,h!==null)for(o=0;o<h.length;o++){var d=h[o],_=d.callback;if(_!==null){if(d.callback=null,d=c,typeof _!="function")throw Error(p(191,_));_.call(d)}}}var th={},uh=Uf(th),vh$1=Uf(th),wh=Uf(th);function xh(h){if(h===th)throw Error(p(174));return h}function yh(h,o){switch(G(wh,o),G(vh$1,h),G(uh,th),h=o.nodeType,h){case 9:case 11:o=(o=o.documentElement)?o.namespaceURI:lb(null,"");break;default:h=h===8?o.parentNode:o,o=h.namespaceURI||null,h=h.tagName,o=lb(o,h)}E(uh),G(uh,o)}function zh(){E(uh),E(vh$1),E(wh)}function Ah(h){xh(wh.current);var o=xh(uh.current),c=lb(o,h.type);o!==c&&(G(vh$1,h),G(uh,c))}function Bh(h){vh$1.current===h&&(E(uh),E(vh$1))}var L=Uf(0);function Ch(h){for(var o=h;o!==null;){if(o.tag===13){var c=o.memoizedState;if(c!==null&&(c=c.dehydrated,c===null||c.data==="$?"||c.data==="$!"))return o}else if(o.tag===19&&o.memoizedProps.revealOrder!==void 0){if(o.flags&128)return o}else if(o.child!==null){o.child.return=o,o=o.child;continue}if(o===h)break;for(;o.sibling===null;){if(o.return===null||o.return===h)return null;o=o.return}o.sibling.return=o.return,o=o.sibling}return null}var Dh=[];function Eh(){for(var h=0;h<Dh.length;h++)Dh[h]._workInProgressVersionPrimary=null;Dh.length=0}var Fh=ua.ReactCurrentDispatcher,Gh=ua.ReactCurrentBatchConfig,Hh=0,M=null,N=null,O=null,Ih=!1,Jh=!1,Kh=0,Lh=0;function P(){throw Error(p(321))}function Mh(h,o){if(o===null)return!1;for(var c=0;c<o.length&&c<h.length;c++)if(!He(h[c],o[c]))return!1;return!0}function Nh(h,o,c,d,_,v){if(Hh=v,M=o,o.memoizedState=null,o.updateQueue=null,o.lanes=0,Fh.current=h===null||h.memoizedState===null?Oh:Ph,h=c(d,_),Jh){v=0;do{if(Jh=!1,Kh=0,25<=v)throw Error(p(301));v+=1,O=N=null,o.updateQueue=null,Fh.current=Qh,h=c(d,_)}while(Jh)}if(Fh.current=Rh,o=N!==null&&N.next!==null,Hh=0,O=N=M=null,Ih=!1,o)throw Error(p(300));return h}function Sh(){var h=Kh!==0;return Kh=0,h}function Th(){var h={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return O===null?M.memoizedState=O=h:O=O.next=h,O}function Uh(){if(N===null){var h=M.alternate;h=h!==null?h.memoizedState:null}else h=N.next;var o=O===null?M.memoizedState:O.next;if(o!==null)O=o,N=h;else{if(h===null)throw Error(p(310));N=h,h={memoizedState:N.memoizedState,baseState:N.baseState,baseQueue:N.baseQueue,queue:N.queue,next:null},O===null?M.memoizedState=O=h:O=O.next=h}return O}function Vh(h,o){return typeof o=="function"?o(h):o}function Wh(h){var o=Uh(),c=o.queue;if(c===null)throw Error(p(311));c.lastRenderedReducer=h;var d=N,_=d.baseQueue,v=c.pending;if(v!==null){if(_!==null){var b=_.next;_.next=v.next,v.next=b}d.baseQueue=_=v,c.pending=null}if(_!==null){v=_.next,d=d.baseState;var tt=b=null,it=null,nt=v;do{var lt=nt.lane;if((Hh&lt)===lt)it!==null&&(it=it.next={lane:0,action:nt.action,hasEagerState:nt.hasEagerState,eagerState:nt.eagerState,next:null}),d=nt.hasEagerState?nt.eagerState:h(d,nt.action);else{var ut={lane:lt,action:nt.action,hasEagerState:nt.hasEagerState,eagerState:nt.eagerState,next:null};it===null?(tt=it=ut,b=d):it=it.next=ut,M.lanes|=lt,rh|=lt}nt=nt.next}while(nt!==null&&nt!==v);it===null?b=d:it.next=tt,He(d,o.memoizedState)||(dh=!0),o.memoizedState=d,o.baseState=b,o.baseQueue=it,c.lastRenderedState=d}if(h=c.interleaved,h!==null){_=h;do v=_.lane,M.lanes|=v,rh|=v,_=_.next;while(_!==h)}else _===null&&(c.lanes=0);return[o.memoizedState,c.dispatch]}function Xh(h){var o=Uh(),c=o.queue;if(c===null)throw Error(p(311));c.lastRenderedReducer=h;var d=c.dispatch,_=c.pending,v=o.memoizedState;if(_!==null){c.pending=null;var b=_=_.next;do v=h(v,b.action),b=b.next;while(b!==_);He(v,o.memoizedState)||(dh=!0),o.memoizedState=v,o.baseQueue===null&&(o.baseState=v),c.lastRenderedState=v}return[v,d]}function Yh(){}function Zh(h,o){var c=M,d=Uh(),_=o(),v=!He(d.memoizedState,_);if(v&&(d.memoizedState=_,dh=!0),d=d.queue,$h(ai.bind(null,c,d,h),[h]),d.getSnapshot!==o||v||O!==null&&O.memoizedState.tag&1){if(c.flags|=2048,bi(9,ci.bind(null,c,d,_,o),void 0,null),Q===null)throw Error(p(349));Hh&30||di(c,o,_)}return _}function di(h,o,c){h.flags|=16384,h={getSnapshot:o,value:c},o=M.updateQueue,o===null?(o={lastEffect:null,stores:null},M.updateQueue=o,o.stores=[h]):(c=o.stores,c===null?o.stores=[h]:c.push(h))}function ci(h,o,c,d){o.value=c,o.getSnapshot=d,ei(o)&&fi(h)}function ai(h,o,c){return c(function(){ei(o)&&fi(h)})}function ei(h){var o=h.getSnapshot;h=h.value;try{var c=o();return!He(h,c)}catch{return!0}}function fi(h){var o=ih(h,1);o!==null&&gi(o,h,1,-1)}function hi(h){var o=Th();return typeof h=="function"&&(h=h()),o.memoizedState=o.baseState=h,h={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Vh,lastRenderedState:h},o.queue=h,h=h.dispatch=ii.bind(null,M,h),[o.memoizedState,h]}function bi(h,o,c,d){return h={tag:h,create:o,destroy:c,deps:d,next:null},o=M.updateQueue,o===null?(o={lastEffect:null,stores:null},M.updateQueue=o,o.lastEffect=h.next=h):(c=o.lastEffect,c===null?o.lastEffect=h.next=h:(d=c.next,c.next=h,h.next=d,o.lastEffect=h)),h}function ji(){return Uh().memoizedState}function ki(h,o,c,d){var _=Th();M.flags|=h,_.memoizedState=bi(1|o,c,void 0,d===void 0?null:d)}function li(h,o,c,d){var _=Uh();d=d===void 0?null:d;var v=void 0;if(N!==null){var b=N.memoizedState;if(v=b.destroy,d!==null&&Mh(d,b.deps)){_.memoizedState=bi(o,c,v,d);return}}M.flags|=h,_.memoizedState=bi(1|o,c,v,d)}function mi(h,o){return ki(8390656,8,h,o)}function $h(h,o){return li(2048,8,h,o)}function ni(h,o){return li(4,2,h,o)}function oi(h,o){return li(4,4,h,o)}function pi(h,o){if(typeof o=="function")return h=h(),o(h),function(){o(null)};if(o!=null)return h=h(),o.current=h,function(){o.current=null}}function qi(h,o,c){return c=c!=null?c.concat([h]):null,li(4,4,pi.bind(null,o,h),c)}function ri(){}function si(h,o){var c=Uh();o=o===void 0?null:o;var d=c.memoizedState;return d!==null&&o!==null&&Mh(o,d[1])?d[0]:(c.memoizedState=[h,o],h)}function ti(h,o){var c=Uh();o=o===void 0?null:o;var d=c.memoizedState;return d!==null&&o!==null&&Mh(o,d[1])?d[0]:(h=h(),c.memoizedState=[h,o],h)}function ui(h,o,c){return Hh&21?(He(c,o)||(c=yc(),M.lanes|=c,rh|=c,h.baseState=!0),o):(h.baseState&&(h.baseState=!1,dh=!0),h.memoizedState=c)}function vi(h,o){var c=C;C=c!==0&&4>c?c:4,h(!0);var d=Gh.transition;Gh.transition={};try{h(!1),o()}finally{C=c,Gh.transition=d}}function wi(){return Uh().memoizedState}function xi(h,o,c){var d=yi(h);if(c={lane:d,action:c,hasEagerState:!1,eagerState:null,next:null},zi(h))Ai(o,c);else if(c=hh(h,o,c,d),c!==null){var _=R();gi(c,h,d,_),Bi(c,o,d)}}function ii(h,o,c){var d=yi(h),_={lane:d,action:c,hasEagerState:!1,eagerState:null,next:null};if(zi(h))Ai(o,_);else{var v=h.alternate;if(h.lanes===0&&(v===null||v.lanes===0)&&(v=o.lastRenderedReducer,v!==null))try{var b=o.lastRenderedState,tt=v(b,c);if(_.hasEagerState=!0,_.eagerState=tt,He(tt,b)){var it=o.interleaved;it===null?(_.next=_,gh(o)):(_.next=it.next,it.next=_),o.interleaved=_;return}}catch{}finally{}c=hh(h,o,_,d),c!==null&&(_=R(),gi(c,h,d,_),Bi(c,o,d))}}function zi(h){var o=h.alternate;return h===M||o!==null&&o===M}function Ai(h,o){Jh=Ih=!0;var c=h.pending;c===null?o.next=o:(o.next=c.next,c.next=o),h.pending=o}function Bi(h,o,c){if(c&4194240){var d=o.lanes;d&=h.pendingLanes,c|=d,o.lanes=c,Cc(h,c)}}var Rh={readContext:eh,useCallback:P,useContext:P,useEffect:P,useImperativeHandle:P,useInsertionEffect:P,useLayoutEffect:P,useMemo:P,useReducer:P,useRef:P,useState:P,useDebugValue:P,useDeferredValue:P,useTransition:P,useMutableSource:P,useSyncExternalStore:P,useId:P,unstable_isNewReconciler:!1},Oh={readContext:eh,useCallback:function(h,o){return Th().memoizedState=[h,o===void 0?null:o],h},useContext:eh,useEffect:mi,useImperativeHandle:function(h,o,c){return c=c!=null?c.concat([h]):null,ki(4194308,4,pi.bind(null,o,h),c)},useLayoutEffect:function(h,o){return ki(4194308,4,h,o)},useInsertionEffect:function(h,o){return ki(4,2,h,o)},useMemo:function(h,o){var c=Th();return o=o===void 0?null:o,h=h(),c.memoizedState=[h,o],h},useReducer:function(h,o,c){var d=Th();return o=c!==void 0?c(o):o,d.memoizedState=d.baseState=o,h={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:h,lastRenderedState:o},d.queue=h,h=h.dispatch=xi.bind(null,M,h),[d.memoizedState,h]},useRef:function(h){var o=Th();return h={current:h},o.memoizedState=h},useState:hi,useDebugValue:ri,useDeferredValue:function(h){return Th().memoizedState=h},useTransition:function(){var h=hi(!1),o=h[0];return h=vi.bind(null,h[1]),Th().memoizedState=h,[o,h]},useMutableSource:function(){},useSyncExternalStore:function(h,o,c){var d=M,_=Th();if(I){if(c===void 0)throw Error(p(407));c=c()}else{if(c=o(),Q===null)throw Error(p(349));Hh&30||di(d,o,c)}_.memoizedState=c;var v={value:c,getSnapshot:o};return _.queue=v,mi(ai.bind(null,d,v,h),[h]),d.flags|=2048,bi(9,ci.bind(null,d,v,c,o),void 0,null),c},useId:function(){var h=Th(),o=Q.identifierPrefix;if(I){var c=sg,d=rg;c=(d&~(1<<32-oc(d)-1)).toString(32)+c,o=":"+o+"R"+c,c=Kh++,0<c&&(o+="H"+c.toString(32)),o+=":"}else c=Lh++,o=":"+o+"r"+c.toString(32)+":";return h.memoizedState=o},unstable_isNewReconciler:!1},Ph={readContext:eh,useCallback:si,useContext:eh,useEffect:$h,useImperativeHandle:qi,useInsertionEffect:ni,useLayoutEffect:oi,useMemo:ti,useReducer:Wh,useRef:ji,useState:function(){return Wh(Vh)},useDebugValue:ri,useDeferredValue:function(h){var o=Uh();return ui(o,N.memoizedState,h)},useTransition:function(){var h=Wh(Vh)[0],o=Uh().memoizedState;return[h,o]},useMutableSource:Yh,useSyncExternalStore:Zh,useId:wi,unstable_isNewReconciler:!1},Qh={readContext:eh,useCallback:si,useContext:eh,useEffect:$h,useImperativeHandle:qi,useInsertionEffect:ni,useLayoutEffect:oi,useMemo:ti,useReducer:Xh,useRef:ji,useState:function(){return Xh(Vh)},useDebugValue:ri,useDeferredValue:function(h){var o=Uh();return N===null?o.memoizedState=h:ui(o,N.memoizedState,h)},useTransition:function(){var h=Xh(Vh)[0],o=Uh().memoizedState;return[h,o]},useMutableSource:Yh,useSyncExternalStore:Zh,useId:wi,unstable_isNewReconciler:!1};function Ci(h,o){if(h&&h.defaultProps){o=A({},o),h=h.defaultProps;for(var c in h)o[c]===void 0&&(o[c]=h[c]);return o}return o}function Di(h,o,c,d){o=h.memoizedState,c=c(d,o),c=c==null?o:A({},o,c),h.memoizedState=c,h.lanes===0&&(h.updateQueue.baseState=c)}var Ei={isMounted:function(h){return(h=h._reactInternals)?Vb(h)===h:!1},enqueueSetState:function(h,o,c){h=h._reactInternals;var d=R(),_=yi(h),v=mh(d,_);v.payload=o,c!=null&&(v.callback=c),o=nh(h,v,_),o!==null&&(gi(o,h,_,d),oh(o,h,_))},enqueueReplaceState:function(h,o,c){h=h._reactInternals;var d=R(),_=yi(h),v=mh(d,_);v.tag=1,v.payload=o,c!=null&&(v.callback=c),o=nh(h,v,_),o!==null&&(gi(o,h,_,d),oh(o,h,_))},enqueueForceUpdate:function(h,o){h=h._reactInternals;var c=R(),d=yi(h),_=mh(c,d);_.tag=2,o!=null&&(_.callback=o),o=nh(h,_,d),o!==null&&(gi(o,h,d,c),oh(o,h,d))}};function Fi(h,o,c,d,_,v,b){return h=h.stateNode,typeof h.shouldComponentUpdate=="function"?h.shouldComponentUpdate(d,v,b):o.prototype&&o.prototype.isPureReactComponent?!Ie(c,d)||!Ie(_,v):!0}function Gi(h,o,c){var d=!1,_=Vf,v=o.contextType;return typeof v=="object"&&v!==null?v=eh(v):(_=Zf(o)?Xf:H.current,d=o.contextTypes,v=(d=d!=null)?Yf(h,_):Vf),o=new o(c,v),h.memoizedState=o.state!==null&&o.state!==void 0?o.state:null,o.updater=Ei,h.stateNode=o,o._reactInternals=h,d&&(h=h.stateNode,h.__reactInternalMemoizedUnmaskedChildContext=_,h.__reactInternalMemoizedMaskedChildContext=v),o}function Hi(h,o,c,d){h=o.state,typeof o.componentWillReceiveProps=="function"&&o.componentWillReceiveProps(c,d),typeof o.UNSAFE_componentWillReceiveProps=="function"&&o.UNSAFE_componentWillReceiveProps(c,d),o.state!==h&&Ei.enqueueReplaceState(o,o.state,null)}function Ii(h,o,c,d){var _=h.stateNode;_.props=c,_.state=h.memoizedState,_.refs={},kh(h);var v=o.contextType;typeof v=="object"&&v!==null?_.context=eh(v):(v=Zf(o)?Xf:H.current,_.context=Yf(h,v)),_.state=h.memoizedState,v=o.getDerivedStateFromProps,typeof v=="function"&&(Di(h,o,v,c),_.state=h.memoizedState),typeof o.getDerivedStateFromProps=="function"||typeof _.getSnapshotBeforeUpdate=="function"||typeof _.UNSAFE_componentWillMount!="function"&&typeof _.componentWillMount!="function"||(o=_.state,typeof _.componentWillMount=="function"&&_.componentWillMount(),typeof _.UNSAFE_componentWillMount=="function"&&_.UNSAFE_componentWillMount(),o!==_.state&&Ei.enqueueReplaceState(_,_.state,null),qh(h,c,_,d),_.state=h.memoizedState),typeof _.componentDidMount=="function"&&(h.flags|=4194308)}function Ji(h,o){try{var c="",d=o;do c+=Pa(d),d=d.return;while(d);var _=c}catch(v){_=`
Error generating stack: `+v.message+`
`+v.stack}return{value:h,source:o,stack:_,digest:null}}function Ki(h,o,c){return{value:h,source:null,stack:c??null,digest:o??null}}function Li(h,o){try{console.error(o.value)}catch(c){setTimeout(function(){throw c})}}var Mi=typeof WeakMap=="function"?WeakMap:Map;function Ni(h,o,c){c=mh(-1,c),c.tag=3,c.payload={element:null};var d=o.value;return c.callback=function(){Oi||(Oi=!0,Pi=d),Li(h,o)},c}function Qi(h,o,c){c=mh(-1,c),c.tag=3;var d=h.type.getDerivedStateFromError;if(typeof d=="function"){var _=o.value;c.payload=function(){return d(_)},c.callback=function(){Li(h,o)}}var v=h.stateNode;return v!==null&&typeof v.componentDidCatch=="function"&&(c.callback=function(){Li(h,o),typeof d!="function"&&(Ri===null?Ri=new Set([this]):Ri.add(this));var b=o.stack;this.componentDidCatch(o.value,{componentStack:b!==null?b:""})}),c}function Si(h,o,c){var d=h.pingCache;if(d===null){d=h.pingCache=new Mi;var _=new Set;d.set(o,_)}else _=d.get(o),_===void 0&&(_=new Set,d.set(o,_));_.has(c)||(_.add(c),h=Ti.bind(null,h,o,c),o.then(h,h))}function Ui(h){do{var o;if((o=h.tag===13)&&(o=h.memoizedState,o=o!==null?o.dehydrated!==null:!0),o)return h;h=h.return}while(h!==null);return null}function Vi(h,o,c,d,_){return h.mode&1?(h.flags|=65536,h.lanes=_,h):(h===o?h.flags|=65536:(h.flags|=128,c.flags|=131072,c.flags&=-52805,c.tag===1&&(c.alternate===null?c.tag=17:(o=mh(-1,1),o.tag=2,nh(c,o,1))),c.lanes|=1),h)}var Wi=ua.ReactCurrentOwner,dh=!1;function Xi(h,o,c,d){o.child=h===null?Vg(o,null,c,d):Ug(o,h.child,c,d)}function Yi(h,o,c,d,_){c=c.render;var v=o.ref;return ch(o,_),d=Nh(h,o,c,d,v,_),c=Sh(),h!==null&&!dh?(o.updateQueue=h.updateQueue,o.flags&=-2053,h.lanes&=~_,Zi(h,o,_)):(I&&c&&vg(o),o.flags|=1,Xi(h,o,d,_),o.child)}function $i(h,o,c,d,_){if(h===null){var v=c.type;return typeof v=="function"&&!aj(v)&&v.defaultProps===void 0&&c.compare===null&&c.defaultProps===void 0?(o.tag=15,o.type=v,bj(h,o,v,d,_)):(h=Rg(c.type,null,d,o,o.mode,_),h.ref=o.ref,h.return=o,o.child=h)}if(v=h.child,!(h.lanes&_)){var b=v.memoizedProps;if(c=c.compare,c=c!==null?c:Ie,c(b,d)&&h.ref===o.ref)return Zi(h,o,_)}return o.flags|=1,h=Pg(v,d),h.ref=o.ref,h.return=o,o.child=h}function bj(h,o,c,d,_){if(h!==null){var v=h.memoizedProps;if(Ie(v,d)&&h.ref===o.ref)if(dh=!1,o.pendingProps=d=v,(h.lanes&_)!==0)h.flags&131072&&(dh=!0);else return o.lanes=h.lanes,Zi(h,o,_)}return cj(h,o,c,d,_)}function dj(h,o,c){var d=o.pendingProps,_=d.children,v=h!==null?h.memoizedState:null;if(d.mode==="hidden")if(!(o.mode&1))o.memoizedState={baseLanes:0,cachePool:null,transitions:null},G(ej,fj),fj|=c;else{if(!(c&1073741824))return h=v!==null?v.baseLanes|c:c,o.lanes=o.childLanes=1073741824,o.memoizedState={baseLanes:h,cachePool:null,transitions:null},o.updateQueue=null,G(ej,fj),fj|=h,null;o.memoizedState={baseLanes:0,cachePool:null,transitions:null},d=v!==null?v.baseLanes:c,G(ej,fj),fj|=d}else v!==null?(d=v.baseLanes|c,o.memoizedState=null):d=c,G(ej,fj),fj|=d;return Xi(h,o,_,c),o.child}function gj(h,o){var c=o.ref;(h===null&&c!==null||h!==null&&h.ref!==c)&&(o.flags|=512,o.flags|=2097152)}function cj(h,o,c,d,_){var v=Zf(c)?Xf:H.current;return v=Yf(o,v),ch(o,_),c=Nh(h,o,c,d,v,_),d=Sh(),h!==null&&!dh?(o.updateQueue=h.updateQueue,o.flags&=-2053,h.lanes&=~_,Zi(h,o,_)):(I&&d&&vg(o),o.flags|=1,Xi(h,o,c,_),o.child)}function hj(h,o,c,d,_){if(Zf(c)){var v=!0;cg(o)}else v=!1;if(ch(o,_),o.stateNode===null)ij(h,o),Gi(o,c,d),Ii(o,c,d,_),d=!0;else if(h===null){var b=o.stateNode,tt=o.memoizedProps;b.props=tt;var it=b.context,nt=c.contextType;typeof nt=="object"&&nt!==null?nt=eh(nt):(nt=Zf(c)?Xf:H.current,nt=Yf(o,nt));var lt=c.getDerivedStateFromProps,ut=typeof lt=="function"||typeof b.getSnapshotBeforeUpdate=="function";ut||typeof b.UNSAFE_componentWillReceiveProps!="function"&&typeof b.componentWillReceiveProps!="function"||(tt!==d||it!==nt)&&Hi(o,b,d,nt),jh=!1;var ht=o.memoizedState;b.state=ht,qh(o,d,b,_),it=o.memoizedState,tt!==d||ht!==it||Wf.current||jh?(typeof lt=="function"&&(Di(o,c,lt,d),it=o.memoizedState),(tt=jh||Fi(o,c,tt,d,ht,it,nt))?(ut||typeof b.UNSAFE_componentWillMount!="function"&&typeof b.componentWillMount!="function"||(typeof b.componentWillMount=="function"&&b.componentWillMount(),typeof b.UNSAFE_componentWillMount=="function"&&b.UNSAFE_componentWillMount()),typeof b.componentDidMount=="function"&&(o.flags|=4194308)):(typeof b.componentDidMount=="function"&&(o.flags|=4194308),o.memoizedProps=d,o.memoizedState=it),b.props=d,b.state=it,b.context=nt,d=tt):(typeof b.componentDidMount=="function"&&(o.flags|=4194308),d=!1)}else{b=o.stateNode,lh(h,o),tt=o.memoizedProps,nt=o.type===o.elementType?tt:Ci(o.type,tt),b.props=nt,ut=o.pendingProps,ht=b.context,it=c.contextType,typeof it=="object"&&it!==null?it=eh(it):(it=Zf(c)?Xf:H.current,it=Yf(o,it));var _t=c.getDerivedStateFromProps;(lt=typeof _t=="function"||typeof b.getSnapshotBeforeUpdate=="function")||typeof b.UNSAFE_componentWillReceiveProps!="function"&&typeof b.componentWillReceiveProps!="function"||(tt!==ut||ht!==it)&&Hi(o,b,d,it),jh=!1,ht=o.memoizedState,b.state=ht,qh(o,d,b,_);var ft=o.memoizedState;tt!==ut||ht!==ft||Wf.current||jh?(typeof _t=="function"&&(Di(o,c,_t,d),ft=o.memoizedState),(nt=jh||Fi(o,c,nt,d,ht,ft,it)||!1)?(lt||typeof b.UNSAFE_componentWillUpdate!="function"&&typeof b.componentWillUpdate!="function"||(typeof b.componentWillUpdate=="function"&&b.componentWillUpdate(d,ft,it),typeof b.UNSAFE_componentWillUpdate=="function"&&b.UNSAFE_componentWillUpdate(d,ft,it)),typeof b.componentDidUpdate=="function"&&(o.flags|=4),typeof b.getSnapshotBeforeUpdate=="function"&&(o.flags|=1024)):(typeof b.componentDidUpdate!="function"||tt===h.memoizedProps&&ht===h.memoizedState||(o.flags|=4),typeof b.getSnapshotBeforeUpdate!="function"||tt===h.memoizedProps&&ht===h.memoizedState||(o.flags|=1024),o.memoizedProps=d,o.memoizedState=ft),b.props=d,b.state=ft,b.context=it,d=nt):(typeof b.componentDidUpdate!="function"||tt===h.memoizedProps&&ht===h.memoizedState||(o.flags|=4),typeof b.getSnapshotBeforeUpdate!="function"||tt===h.memoizedProps&&ht===h.memoizedState||(o.flags|=1024),d=!1)}return jj(h,o,c,d,v,_)}function jj(h,o,c,d,_,v){gj(h,o);var b=(o.flags&128)!==0;if(!d&&!b)return _&&dg(o,c,!1),Zi(h,o,v);d=o.stateNode,Wi.current=o;var tt=b&&typeof c.getDerivedStateFromError!="function"?null:d.render();return o.flags|=1,h!==null&&b?(o.child=Ug(o,h.child,null,v),o.child=Ug(o,null,tt,v)):Xi(h,o,tt,v),o.memoizedState=d.state,_&&dg(o,c,!0),o.child}function kj(h){var o=h.stateNode;o.pendingContext?ag(h,o.pendingContext,o.pendingContext!==o.context):o.context&&ag(h,o.context,!1),yh(h,o.containerInfo)}function lj(h,o,c,d,_){return Ig(),Jg(_),o.flags|=256,Xi(h,o,c,d),o.child}var mj={dehydrated:null,treeContext:null,retryLane:0};function nj(h){return{baseLanes:h,cachePool:null,transitions:null}}function oj(h,o,c){var d=o.pendingProps,_=L.current,v=!1,b=(o.flags&128)!==0,tt;if((tt=b)||(tt=h!==null&&h.memoizedState===null?!1:(_&2)!==0),tt?(v=!0,o.flags&=-129):(h===null||h.memoizedState!==null)&&(_|=1),G(L,_&1),h===null)return Eg(o),h=o.memoizedState,h!==null&&(h=h.dehydrated,h!==null)?(o.mode&1?h.data==="$!"?o.lanes=8:o.lanes=1073741824:o.lanes=1,null):(b=d.children,h=d.fallback,v?(d=o.mode,v=o.child,b={mode:"hidden",children:b},!(d&1)&&v!==null?(v.childLanes=0,v.pendingProps=b):v=pj(b,d,0,null),h=Tg(h,d,c,null),v.return=o,h.return=o,v.sibling=h,o.child=v,o.child.memoizedState=nj(c),o.memoizedState=mj,h):qj(o,b));if(_=h.memoizedState,_!==null&&(tt=_.dehydrated,tt!==null))return rj(h,o,b,d,tt,_,c);if(v){v=d.fallback,b=o.mode,_=h.child,tt=_.sibling;var it={mode:"hidden",children:d.children};return!(b&1)&&o.child!==_?(d=o.child,d.childLanes=0,d.pendingProps=it,o.deletions=null):(d=Pg(_,it),d.subtreeFlags=_.subtreeFlags&14680064),tt!==null?v=Pg(tt,v):(v=Tg(v,b,c,null),v.flags|=2),v.return=o,d.return=o,d.sibling=v,o.child=d,d=v,v=o.child,b=h.child.memoizedState,b=b===null?nj(c):{baseLanes:b.baseLanes|c,cachePool:null,transitions:b.transitions},v.memoizedState=b,v.childLanes=h.childLanes&~c,o.memoizedState=mj,d}return v=h.child,h=v.sibling,d=Pg(v,{mode:"visible",children:d.children}),!(o.mode&1)&&(d.lanes=c),d.return=o,d.sibling=null,h!==null&&(c=o.deletions,c===null?(o.deletions=[h],o.flags|=16):c.push(h)),o.child=d,o.memoizedState=null,d}function qj(h,o){return o=pj({mode:"visible",children:o},h.mode,0,null),o.return=h,h.child=o}function sj(h,o,c,d){return d!==null&&Jg(d),Ug(o,h.child,null,c),h=qj(o,o.pendingProps.children),h.flags|=2,o.memoizedState=null,h}function rj(h,o,c,d,_,v,b){if(c)return o.flags&256?(o.flags&=-257,d=Ki(Error(p(422))),sj(h,o,b,d)):o.memoizedState!==null?(o.child=h.child,o.flags|=128,null):(v=d.fallback,_=o.mode,d=pj({mode:"visible",children:d.children},_,0,null),v=Tg(v,_,b,null),v.flags|=2,d.return=o,v.return=o,d.sibling=v,o.child=d,o.mode&1&&Ug(o,h.child,null,b),o.child.memoizedState=nj(b),o.memoizedState=mj,v);if(!(o.mode&1))return sj(h,o,b,null);if(_.data==="$!"){if(d=_.nextSibling&&_.nextSibling.dataset,d)var tt=d.dgst;return d=tt,v=Error(p(419)),d=Ki(v,d,void 0),sj(h,o,b,d)}if(tt=(b&h.childLanes)!==0,dh||tt){if(d=Q,d!==null){switch(b&-b){case 4:_=2;break;case 16:_=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:_=32;break;case 536870912:_=268435456;break;default:_=0}_=_&(d.suspendedLanes|b)?0:_,_!==0&&_!==v.retryLane&&(v.retryLane=_,ih(h,_),gi(d,h,_,-1))}return tj(),d=Ki(Error(p(421))),sj(h,o,b,d)}return _.data==="$?"?(o.flags|=128,o.child=h.child,o=uj.bind(null,h),_._reactRetry=o,null):(h=v.treeContext,yg=Lf(_.nextSibling),xg=o,I=!0,zg=null,h!==null&&(og[pg++]=rg,og[pg++]=sg,og[pg++]=qg,rg=h.id,sg=h.overflow,qg=o),o=qj(o,d.children),o.flags|=4096,o)}function vj(h,o,c){h.lanes|=o;var d=h.alternate;d!==null&&(d.lanes|=o),bh(h.return,o,c)}function wj(h,o,c,d,_){var v=h.memoizedState;v===null?h.memoizedState={isBackwards:o,rendering:null,renderingStartTime:0,last:d,tail:c,tailMode:_}:(v.isBackwards=o,v.rendering=null,v.renderingStartTime=0,v.last=d,v.tail=c,v.tailMode=_)}function xj(h,o,c){var d=o.pendingProps,_=d.revealOrder,v=d.tail;if(Xi(h,o,d.children,c),d=L.current,d&2)d=d&1|2,o.flags|=128;else{if(h!==null&&h.flags&128)e:for(h=o.child;h!==null;){if(h.tag===13)h.memoizedState!==null&&vj(h,c,o);else if(h.tag===19)vj(h,c,o);else if(h.child!==null){h.child.return=h,h=h.child;continue}if(h===o)break e;for(;h.sibling===null;){if(h.return===null||h.return===o)break e;h=h.return}h.sibling.return=h.return,h=h.sibling}d&=1}if(G(L,d),!(o.mode&1))o.memoizedState=null;else switch(_){case"forwards":for(c=o.child,_=null;c!==null;)h=c.alternate,h!==null&&Ch(h)===null&&(_=c),c=c.sibling;c=_,c===null?(_=o.child,o.child=null):(_=c.sibling,c.sibling=null),wj(o,!1,_,c,v);break;case"backwards":for(c=null,_=o.child,o.child=null;_!==null;){if(h=_.alternate,h!==null&&Ch(h)===null){o.child=_;break}h=_.sibling,_.sibling=c,c=_,_=h}wj(o,!0,c,null,v);break;case"together":wj(o,!1,null,null,void 0);break;default:o.memoizedState=null}return o.child}function ij(h,o){!(o.mode&1)&&h!==null&&(h.alternate=null,o.alternate=null,o.flags|=2)}function Zi(h,o,c){if(h!==null&&(o.dependencies=h.dependencies),rh|=o.lanes,!(c&o.childLanes))return null;if(h!==null&&o.child!==h.child)throw Error(p(153));if(o.child!==null){for(h=o.child,c=Pg(h,h.pendingProps),o.child=c,c.return=o;h.sibling!==null;)h=h.sibling,c=c.sibling=Pg(h,h.pendingProps),c.return=o;c.sibling=null}return o.child}function yj(h,o,c){switch(o.tag){case 3:kj(o),Ig();break;case 5:Ah(o);break;case 1:Zf(o.type)&&cg(o);break;case 4:yh(o,o.stateNode.containerInfo);break;case 10:var d=o.type._context,_=o.memoizedProps.value;G(Wg,d._currentValue),d._currentValue=_;break;case 13:if(d=o.memoizedState,d!==null)return d.dehydrated!==null?(G(L,L.current&1),o.flags|=128,null):c&o.child.childLanes?oj(h,o,c):(G(L,L.current&1),h=Zi(h,o,c),h!==null?h.sibling:null);G(L,L.current&1);break;case 19:if(d=(c&o.childLanes)!==0,h.flags&128){if(d)return xj(h,o,c);o.flags|=128}if(_=o.memoizedState,_!==null&&(_.rendering=null,_.tail=null,_.lastEffect=null),G(L,L.current),d)break;return null;case 22:case 23:return o.lanes=0,dj(h,o,c)}return Zi(h,o,c)}var zj,Aj,Bj,Cj;zj=function(h,o){for(var c=o.child;c!==null;){if(c.tag===5||c.tag===6)h.appendChild(c.stateNode);else if(c.tag!==4&&c.child!==null){c.child.return=c,c=c.child;continue}if(c===o)break;for(;c.sibling===null;){if(c.return===null||c.return===o)return;c=c.return}c.sibling.return=c.return,c=c.sibling}};Aj=function(){};Bj=function(h,o,c,d){var _=h.memoizedProps;if(_!==d){h=o.stateNode,xh(uh.current);var v=null;switch(c){case"input":_=Ya(h,_),d=Ya(h,d),v=[];break;case"select":_=A({},_,{value:void 0}),d=A({},d,{value:void 0}),v=[];break;case"textarea":_=gb(h,_),d=gb(h,d),v=[];break;default:typeof _.onClick!="function"&&typeof d.onClick=="function"&&(h.onclick=Bf)}ub(c,d);var b;c=null;for(nt in _)if(!d.hasOwnProperty(nt)&&_.hasOwnProperty(nt)&&_[nt]!=null)if(nt==="style"){var tt=_[nt];for(b in tt)tt.hasOwnProperty(b)&&(c||(c={}),c[b]="")}else nt!=="dangerouslySetInnerHTML"&&nt!=="children"&&nt!=="suppressContentEditableWarning"&&nt!=="suppressHydrationWarning"&&nt!=="autoFocus"&&(ea.hasOwnProperty(nt)?v||(v=[]):(v=v||[]).push(nt,null));for(nt in d){var it=d[nt];if(tt=_!=null?_[nt]:void 0,d.hasOwnProperty(nt)&&it!==tt&&(it!=null||tt!=null))if(nt==="style")if(tt){for(b in tt)!tt.hasOwnProperty(b)||it&&it.hasOwnProperty(b)||(c||(c={}),c[b]="");for(b in it)it.hasOwnProperty(b)&&tt[b]!==it[b]&&(c||(c={}),c[b]=it[b])}else c||(v||(v=[]),v.push(nt,c)),c=it;else nt==="dangerouslySetInnerHTML"?(it=it?it.__html:void 0,tt=tt?tt.__html:void 0,it!=null&&tt!==it&&(v=v||[]).push(nt,it)):nt==="children"?typeof it!="string"&&typeof it!="number"||(v=v||[]).push(nt,""+it):nt!=="suppressContentEditableWarning"&&nt!=="suppressHydrationWarning"&&(ea.hasOwnProperty(nt)?(it!=null&&nt==="onScroll"&&D("scroll",h),v||tt===it||(v=[])):(v=v||[]).push(nt,it))}c&&(v=v||[]).push("style",c);var nt=v;(o.updateQueue=nt)&&(o.flags|=4)}};Cj=function(h,o,c,d){c!==d&&(o.flags|=4)};function Dj(h,o){if(!I)switch(h.tailMode){case"hidden":o=h.tail;for(var c=null;o!==null;)o.alternate!==null&&(c=o),o=o.sibling;c===null?h.tail=null:c.sibling=null;break;case"collapsed":c=h.tail;for(var d=null;c!==null;)c.alternate!==null&&(d=c),c=c.sibling;d===null?o||h.tail===null?h.tail=null:h.tail.sibling=null:d.sibling=null}}function S(h){var o=h.alternate!==null&&h.alternate.child===h.child,c=0,d=0;if(o)for(var _=h.child;_!==null;)c|=_.lanes|_.childLanes,d|=_.subtreeFlags&14680064,d|=_.flags&14680064,_.return=h,_=_.sibling;else for(_=h.child;_!==null;)c|=_.lanes|_.childLanes,d|=_.subtreeFlags,d|=_.flags,_.return=h,_=_.sibling;return h.subtreeFlags|=d,h.childLanes=c,o}function Ej(h,o,c){var d=o.pendingProps;switch(wg(o),o.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return S(o),null;case 1:return Zf(o.type)&&$f(),S(o),null;case 3:return d=o.stateNode,zh(),E(Wf),E(H),Eh(),d.pendingContext&&(d.context=d.pendingContext,d.pendingContext=null),(h===null||h.child===null)&&(Gg(o)?o.flags|=4:h===null||h.memoizedState.isDehydrated&&!(o.flags&256)||(o.flags|=1024,zg!==null&&(Fj(zg),zg=null))),Aj(h,o),S(o),null;case 5:Bh(o);var _=xh(wh.current);if(c=o.type,h!==null&&o.stateNode!=null)Bj(h,o,c,d,_),h.ref!==o.ref&&(o.flags|=512,o.flags|=2097152);else{if(!d){if(o.stateNode===null)throw Error(p(166));return S(o),null}if(h=xh(uh.current),Gg(o)){d=o.stateNode,c=o.type;var v=o.memoizedProps;switch(d[Of]=o,d[Pf]=v,h=(o.mode&1)!==0,c){case"dialog":D("cancel",d),D("close",d);break;case"iframe":case"object":case"embed":D("load",d);break;case"video":case"audio":for(_=0;_<lf.length;_++)D(lf[_],d);break;case"source":D("error",d);break;case"img":case"image":case"link":D("error",d),D("load",d);break;case"details":D("toggle",d);break;case"input":Za(d,v),D("invalid",d);break;case"select":d._wrapperState={wasMultiple:!!v.multiple},D("invalid",d);break;case"textarea":hb(d,v),D("invalid",d)}ub(c,v),_=null;for(var b in v)if(v.hasOwnProperty(b)){var tt=v[b];b==="children"?typeof tt=="string"?d.textContent!==tt&&(v.suppressHydrationWarning!==!0&&Af(d.textContent,tt,h),_=["children",tt]):typeof tt=="number"&&d.textContent!==""+tt&&(v.suppressHydrationWarning!==!0&&Af(d.textContent,tt,h),_=["children",""+tt]):ea.hasOwnProperty(b)&&tt!=null&&b==="onScroll"&&D("scroll",d)}switch(c){case"input":Va(d),db(d,v,!0);break;case"textarea":Va(d),jb(d);break;case"select":case"option":break;default:typeof v.onClick=="function"&&(d.onclick=Bf)}d=_,o.updateQueue=d,d!==null&&(o.flags|=4)}else{b=_.nodeType===9?_:_.ownerDocument,h==="http://www.w3.org/1999/xhtml"&&(h=kb(c)),h==="http://www.w3.org/1999/xhtml"?c==="script"?(h=b.createElement("div"),h.innerHTML="<script><\/script>",h=h.removeChild(h.firstChild)):typeof d.is=="string"?h=b.createElement(c,{is:d.is}):(h=b.createElement(c),c==="select"&&(b=h,d.multiple?b.multiple=!0:d.size&&(b.size=d.size))):h=b.createElementNS(h,c),h[Of]=o,h[Pf]=d,zj(h,o,!1,!1),o.stateNode=h;e:{switch(b=vb(c,d),c){case"dialog":D("cancel",h),D("close",h),_=d;break;case"iframe":case"object":case"embed":D("load",h),_=d;break;case"video":case"audio":for(_=0;_<lf.length;_++)D(lf[_],h);_=d;break;case"source":D("error",h),_=d;break;case"img":case"image":case"link":D("error",h),D("load",h),_=d;break;case"details":D("toggle",h),_=d;break;case"input":Za(h,d),_=Ya(h,d),D("invalid",h);break;case"option":_=d;break;case"select":h._wrapperState={wasMultiple:!!d.multiple},_=A({},d,{value:void 0}),D("invalid",h);break;case"textarea":hb(h,d),_=gb(h,d),D("invalid",h);break;default:_=d}ub(c,_),tt=_;for(v in tt)if(tt.hasOwnProperty(v)){var it=tt[v];v==="style"?sb(h,it):v==="dangerouslySetInnerHTML"?(it=it?it.__html:void 0,it!=null&&nb(h,it)):v==="children"?typeof it=="string"?(c!=="textarea"||it!=="")&&ob(h,it):typeof it=="number"&&ob(h,""+it):v!=="suppressContentEditableWarning"&&v!=="suppressHydrationWarning"&&v!=="autoFocus"&&(ea.hasOwnProperty(v)?it!=null&&v==="onScroll"&&D("scroll",h):it!=null&&ta(h,v,it,b))}switch(c){case"input":Va(h),db(h,d,!1);break;case"textarea":Va(h),jb(h);break;case"option":d.value!=null&&h.setAttribute("value",""+Sa(d.value));break;case"select":h.multiple=!!d.multiple,v=d.value,v!=null?fb(h,!!d.multiple,v,!1):d.defaultValue!=null&&fb(h,!!d.multiple,d.defaultValue,!0);break;default:typeof _.onClick=="function"&&(h.onclick=Bf)}switch(c){case"button":case"input":case"select":case"textarea":d=!!d.autoFocus;break e;case"img":d=!0;break e;default:d=!1}}d&&(o.flags|=4)}o.ref!==null&&(o.flags|=512,o.flags|=2097152)}return S(o),null;case 6:if(h&&o.stateNode!=null)Cj(h,o,h.memoizedProps,d);else{if(typeof d!="string"&&o.stateNode===null)throw Error(p(166));if(c=xh(wh.current),xh(uh.current),Gg(o)){if(d=o.stateNode,c=o.memoizedProps,d[Of]=o,(v=d.nodeValue!==c)&&(h=xg,h!==null))switch(h.tag){case 3:Af(d.nodeValue,c,(h.mode&1)!==0);break;case 5:h.memoizedProps.suppressHydrationWarning!==!0&&Af(d.nodeValue,c,(h.mode&1)!==0)}v&&(o.flags|=4)}else d=(c.nodeType===9?c:c.ownerDocument).createTextNode(d),d[Of]=o,o.stateNode=d}return S(o),null;case 13:if(E(L),d=o.memoizedState,h===null||h.memoizedState!==null&&h.memoizedState.dehydrated!==null){if(I&&yg!==null&&o.mode&1&&!(o.flags&128))Hg(),Ig(),o.flags|=98560,v=!1;else if(v=Gg(o),d!==null&&d.dehydrated!==null){if(h===null){if(!v)throw Error(p(318));if(v=o.memoizedState,v=v!==null?v.dehydrated:null,!v)throw Error(p(317));v[Of]=o}else Ig(),!(o.flags&128)&&(o.memoizedState=null),o.flags|=4;S(o),v=!1}else zg!==null&&(Fj(zg),zg=null),v=!0;if(!v)return o.flags&65536?o:null}return o.flags&128?(o.lanes=c,o):(d=d!==null,d!==(h!==null&&h.memoizedState!==null)&&d&&(o.child.flags|=8192,o.mode&1&&(h===null||L.current&1?T===0&&(T=3):tj())),o.updateQueue!==null&&(o.flags|=4),S(o),null);case 4:return zh(),Aj(h,o),h===null&&sf(o.stateNode.containerInfo),S(o),null;case 10:return ah(o.type._context),S(o),null;case 17:return Zf(o.type)&&$f(),S(o),null;case 19:if(E(L),v=o.memoizedState,v===null)return S(o),null;if(d=(o.flags&128)!==0,b=v.rendering,b===null)if(d)Dj(v,!1);else{if(T!==0||h!==null&&h.flags&128)for(h=o.child;h!==null;){if(b=Ch(h),b!==null){for(o.flags|=128,Dj(v,!1),d=b.updateQueue,d!==null&&(o.updateQueue=d,o.flags|=4),o.subtreeFlags=0,d=c,c=o.child;c!==null;)v=c,h=d,v.flags&=14680066,b=v.alternate,b===null?(v.childLanes=0,v.lanes=h,v.child=null,v.subtreeFlags=0,v.memoizedProps=null,v.memoizedState=null,v.updateQueue=null,v.dependencies=null,v.stateNode=null):(v.childLanes=b.childLanes,v.lanes=b.lanes,v.child=b.child,v.subtreeFlags=0,v.deletions=null,v.memoizedProps=b.memoizedProps,v.memoizedState=b.memoizedState,v.updateQueue=b.updateQueue,v.type=b.type,h=b.dependencies,v.dependencies=h===null?null:{lanes:h.lanes,firstContext:h.firstContext}),c=c.sibling;return G(L,L.current&1|2),o.child}h=h.sibling}v.tail!==null&&B()>Gj&&(o.flags|=128,d=!0,Dj(v,!1),o.lanes=4194304)}else{if(!d)if(h=Ch(b),h!==null){if(o.flags|=128,d=!0,c=h.updateQueue,c!==null&&(o.updateQueue=c,o.flags|=4),Dj(v,!0),v.tail===null&&v.tailMode==="hidden"&&!b.alternate&&!I)return S(o),null}else 2*B()-v.renderingStartTime>Gj&&c!==1073741824&&(o.flags|=128,d=!0,Dj(v,!1),o.lanes=4194304);v.isBackwards?(b.sibling=o.child,o.child=b):(c=v.last,c!==null?c.sibling=b:o.child=b,v.last=b)}return v.tail!==null?(o=v.tail,v.rendering=o,v.tail=o.sibling,v.renderingStartTime=B(),o.sibling=null,c=L.current,G(L,d?c&1|2:c&1),o):(S(o),null);case 22:case 23:return Hj(),d=o.memoizedState!==null,h!==null&&h.memoizedState!==null!==d&&(o.flags|=8192),d&&o.mode&1?fj&1073741824&&(S(o),o.subtreeFlags&6&&(o.flags|=8192)):S(o),null;case 24:return null;case 25:return null}throw Error(p(156,o.tag))}function Ij(h,o){switch(wg(o),o.tag){case 1:return Zf(o.type)&&$f(),h=o.flags,h&65536?(o.flags=h&-65537|128,o):null;case 3:return zh(),E(Wf),E(H),Eh(),h=o.flags,h&65536&&!(h&128)?(o.flags=h&-65537|128,o):null;case 5:return Bh(o),null;case 13:if(E(L),h=o.memoizedState,h!==null&&h.dehydrated!==null){if(o.alternate===null)throw Error(p(340));Ig()}return h=o.flags,h&65536?(o.flags=h&-65537|128,o):null;case 19:return E(L),null;case 4:return zh(),null;case 10:return ah(o.type._context),null;case 22:case 23:return Hj(),null;case 24:return null;default:return null}}var Jj=!1,U=!1,Kj=typeof WeakSet=="function"?WeakSet:Set,V=null;function Lj(h,o){var c=h.ref;if(c!==null)if(typeof c=="function")try{c(null)}catch(d){W(h,o,d)}else c.current=null}function Mj(h,o,c){try{c()}catch(d){W(h,o,d)}}var Nj=!1;function Oj(h,o){if(Cf=dd,h=Me(),Ne(h)){if("selectionStart"in h)var c={start:h.selectionStart,end:h.selectionEnd};else e:{c=(c=h.ownerDocument)&&c.defaultView||window;var d=c.getSelection&&c.getSelection();if(d&&d.rangeCount!==0){c=d.anchorNode;var _=d.anchorOffset,v=d.focusNode;d=d.focusOffset;try{c.nodeType,v.nodeType}catch{c=null;break e}var b=0,tt=-1,it=-1,nt=0,lt=0,ut=h,ht=null;t:for(;;){for(var _t;ut!==c||_!==0&&ut.nodeType!==3||(tt=b+_),ut!==v||d!==0&&ut.nodeType!==3||(it=b+d),ut.nodeType===3&&(b+=ut.nodeValue.length),(_t=ut.firstChild)!==null;)ht=ut,ut=_t;for(;;){if(ut===h)break t;if(ht===c&&++nt===_&&(tt=b),ht===v&&++lt===d&&(it=b),(_t=ut.nextSibling)!==null)break;ut=ht,ht=ut.parentNode}ut=_t}c=tt===-1||it===-1?null:{start:tt,end:it}}else c=null}c=c||{start:0,end:0}}else c=null;for(Df={focusedElem:h,selectionRange:c},dd=!1,V=o;V!==null;)if(o=V,h=o.child,(o.subtreeFlags&1028)!==0&&h!==null)h.return=o,V=h;else for(;V!==null;){o=V;try{var ft=o.alternate;if(o.flags&1024)switch(o.tag){case 0:case 11:case 15:break;case 1:if(ft!==null){var bt=ft.memoizedProps,xt=ft.memoizedState,St=o.stateNode,wt=St.getSnapshotBeforeUpdate(o.elementType===o.type?bt:Ci(o.type,bt),xt);St.__reactInternalSnapshotBeforeUpdate=wt}break;case 3:var Pt=o.stateNode.containerInfo;Pt.nodeType===1?Pt.textContent="":Pt.nodeType===9&&Pt.documentElement&&Pt.removeChild(Pt.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(p(163))}}catch(Rt){W(o,o.return,Rt)}if(h=o.sibling,h!==null){h.return=o.return,V=h;break}V=o.return}return ft=Nj,Nj=!1,ft}function Pj(h,o,c){var d=o.updateQueue;if(d=d!==null?d.lastEffect:null,d!==null){var _=d=d.next;do{if((_.tag&h)===h){var v=_.destroy;_.destroy=void 0,v!==void 0&&Mj(o,c,v)}_=_.next}while(_!==d)}}function Qj(h,o){if(o=o.updateQueue,o=o!==null?o.lastEffect:null,o!==null){var c=o=o.next;do{if((c.tag&h)===h){var d=c.create;c.destroy=d()}c=c.next}while(c!==o)}}function Rj(h){var o=h.ref;if(o!==null){var c=h.stateNode;switch(h.tag){case 5:h=c;break;default:h=c}typeof o=="function"?o(h):o.current=h}}function Sj(h){var o=h.alternate;o!==null&&(h.alternate=null,Sj(o)),h.child=null,h.deletions=null,h.sibling=null,h.tag===5&&(o=h.stateNode,o!==null&&(delete o[Of],delete o[Pf],delete o[of],delete o[Qf],delete o[Rf])),h.stateNode=null,h.return=null,h.dependencies=null,h.memoizedProps=null,h.memoizedState=null,h.pendingProps=null,h.stateNode=null,h.updateQueue=null}function Tj(h){return h.tag===5||h.tag===3||h.tag===4}function Uj(h){e:for(;;){for(;h.sibling===null;){if(h.return===null||Tj(h.return))return null;h=h.return}for(h.sibling.return=h.return,h=h.sibling;h.tag!==5&&h.tag!==6&&h.tag!==18;){if(h.flags&2||h.child===null||h.tag===4)continue e;h.child.return=h,h=h.child}if(!(h.flags&2))return h.stateNode}}function Vj(h,o,c){var d=h.tag;if(d===5||d===6)h=h.stateNode,o?c.nodeType===8?c.parentNode.insertBefore(h,o):c.insertBefore(h,o):(c.nodeType===8?(o=c.parentNode,o.insertBefore(h,c)):(o=c,o.appendChild(h)),c=c._reactRootContainer,c!=null||o.onclick!==null||(o.onclick=Bf));else if(d!==4&&(h=h.child,h!==null))for(Vj(h,o,c),h=h.sibling;h!==null;)Vj(h,o,c),h=h.sibling}function Wj(h,o,c){var d=h.tag;if(d===5||d===6)h=h.stateNode,o?c.insertBefore(h,o):c.appendChild(h);else if(d!==4&&(h=h.child,h!==null))for(Wj(h,o,c),h=h.sibling;h!==null;)Wj(h,o,c),h=h.sibling}var X=null,Xj=!1;function Yj(h,o,c){for(c=c.child;c!==null;)Zj(h,o,c),c=c.sibling}function Zj(h,o,c){if(lc&&typeof lc.onCommitFiberUnmount=="function")try{lc.onCommitFiberUnmount(kc,c)}catch{}switch(c.tag){case 5:U||Lj(c,o);case 6:var d=X,_=Xj;X=null,Yj(h,o,c),X=d,Xj=_,X!==null&&(Xj?(h=X,c=c.stateNode,h.nodeType===8?h.parentNode.removeChild(c):h.removeChild(c)):X.removeChild(c.stateNode));break;case 18:X!==null&&(Xj?(h=X,c=c.stateNode,h.nodeType===8?Kf(h.parentNode,c):h.nodeType===1&&Kf(h,c),bd(h)):Kf(X,c.stateNode));break;case 4:d=X,_=Xj,X=c.stateNode.containerInfo,Xj=!0,Yj(h,o,c),X=d,Xj=_;break;case 0:case 11:case 14:case 15:if(!U&&(d=c.updateQueue,d!==null&&(d=d.lastEffect,d!==null))){_=d=d.next;do{var v=_,b=v.destroy;v=v.tag,b!==void 0&&(v&2||v&4)&&Mj(c,o,b),_=_.next}while(_!==d)}Yj(h,o,c);break;case 1:if(!U&&(Lj(c,o),d=c.stateNode,typeof d.componentWillUnmount=="function"))try{d.props=c.memoizedProps,d.state=c.memoizedState,d.componentWillUnmount()}catch(tt){W(c,o,tt)}Yj(h,o,c);break;case 21:Yj(h,o,c);break;case 22:c.mode&1?(U=(d=U)||c.memoizedState!==null,Yj(h,o,c),U=d):Yj(h,o,c);break;default:Yj(h,o,c)}}function ak(h){var o=h.updateQueue;if(o!==null){h.updateQueue=null;var c=h.stateNode;c===null&&(c=h.stateNode=new Kj),o.forEach(function(d){var _=bk.bind(null,h,d);c.has(d)||(c.add(d),d.then(_,_))})}}function ck(h,o){var c=o.deletions;if(c!==null)for(var d=0;d<c.length;d++){var _=c[d];try{var v=h,b=o,tt=b;e:for(;tt!==null;){switch(tt.tag){case 5:X=tt.stateNode,Xj=!1;break e;case 3:X=tt.stateNode.containerInfo,Xj=!0;break e;case 4:X=tt.stateNode.containerInfo,Xj=!0;break e}tt=tt.return}if(X===null)throw Error(p(160));Zj(v,b,_),X=null,Xj=!1;var it=_.alternate;it!==null&&(it.return=null),_.return=null}catch(nt){W(_,o,nt)}}if(o.subtreeFlags&12854)for(o=o.child;o!==null;)dk(o,h),o=o.sibling}function dk(h,o){var c=h.alternate,d=h.flags;switch(h.tag){case 0:case 11:case 14:case 15:if(ck(o,h),ek(h),d&4){try{Pj(3,h,h.return),Qj(3,h)}catch(bt){W(h,h.return,bt)}try{Pj(5,h,h.return)}catch(bt){W(h,h.return,bt)}}break;case 1:ck(o,h),ek(h),d&512&&c!==null&&Lj(c,c.return);break;case 5:if(ck(o,h),ek(h),d&512&&c!==null&&Lj(c,c.return),h.flags&32){var _=h.stateNode;try{ob(_,"")}catch(bt){W(h,h.return,bt)}}if(d&4&&(_=h.stateNode,_!=null)){var v=h.memoizedProps,b=c!==null?c.memoizedProps:v,tt=h.type,it=h.updateQueue;if(h.updateQueue=null,it!==null)try{tt==="input"&&v.type==="radio"&&v.name!=null&&ab(_,v),vb(tt,b);var nt=vb(tt,v);for(b=0;b<it.length;b+=2){var lt=it[b],ut=it[b+1];lt==="style"?sb(_,ut):lt==="dangerouslySetInnerHTML"?nb(_,ut):lt==="children"?ob(_,ut):ta(_,lt,ut,nt)}switch(tt){case"input":bb(_,v);break;case"textarea":ib(_,v);break;case"select":var ht=_._wrapperState.wasMultiple;_._wrapperState.wasMultiple=!!v.multiple;var _t=v.value;_t!=null?fb(_,!!v.multiple,_t,!1):ht!==!!v.multiple&&(v.defaultValue!=null?fb(_,!!v.multiple,v.defaultValue,!0):fb(_,!!v.multiple,v.multiple?[]:"",!1))}_[Pf]=v}catch(bt){W(h,h.return,bt)}}break;case 6:if(ck(o,h),ek(h),d&4){if(h.stateNode===null)throw Error(p(162));_=h.stateNode,v=h.memoizedProps;try{_.nodeValue=v}catch(bt){W(h,h.return,bt)}}break;case 3:if(ck(o,h),ek(h),d&4&&c!==null&&c.memoizedState.isDehydrated)try{bd(o.containerInfo)}catch(bt){W(h,h.return,bt)}break;case 4:ck(o,h),ek(h);break;case 13:ck(o,h),ek(h),_=h.child,_.flags&8192&&(v=_.memoizedState!==null,_.stateNode.isHidden=v,!v||_.alternate!==null&&_.alternate.memoizedState!==null||(fk=B())),d&4&&ak(h);break;case 22:if(lt=c!==null&&c.memoizedState!==null,h.mode&1?(U=(nt=U)||lt,ck(o,h),U=nt):ck(o,h),ek(h),d&8192){if(nt=h.memoizedState!==null,(h.stateNode.isHidden=nt)&&!lt&&h.mode&1)for(V=h,lt=h.child;lt!==null;){for(ut=V=lt;V!==null;){switch(ht=V,_t=ht.child,ht.tag){case 0:case 11:case 14:case 15:Pj(4,ht,ht.return);break;case 1:Lj(ht,ht.return);var ft=ht.stateNode;if(typeof ft.componentWillUnmount=="function"){d=ht,c=ht.return;try{o=d,ft.props=o.memoizedProps,ft.state=o.memoizedState,ft.componentWillUnmount()}catch(bt){W(d,c,bt)}}break;case 5:Lj(ht,ht.return);break;case 22:if(ht.memoizedState!==null){gk(ut);continue}}_t!==null?(_t.return=ht,V=_t):gk(ut)}lt=lt.sibling}e:for(lt=null,ut=h;;){if(ut.tag===5){if(lt===null){lt=ut;try{_=ut.stateNode,nt?(v=_.style,typeof v.setProperty=="function"?v.setProperty("display","none","important"):v.display="none"):(tt=ut.stateNode,it=ut.memoizedProps.style,b=it!=null&&it.hasOwnProperty("display")?it.display:null,tt.style.display=rb("display",b))}catch(bt){W(h,h.return,bt)}}}else if(ut.tag===6){if(lt===null)try{ut.stateNode.nodeValue=nt?"":ut.memoizedProps}catch(bt){W(h,h.return,bt)}}else if((ut.tag!==22&&ut.tag!==23||ut.memoizedState===null||ut===h)&&ut.child!==null){ut.child.return=ut,ut=ut.child;continue}if(ut===h)break e;for(;ut.sibling===null;){if(ut.return===null||ut.return===h)break e;lt===ut&&(lt=null),ut=ut.return}lt===ut&&(lt=null),ut.sibling.return=ut.return,ut=ut.sibling}}break;case 19:ck(o,h),ek(h),d&4&&ak(h);break;case 21:break;default:ck(o,h),ek(h)}}function ek(h){var o=h.flags;if(o&2){try{e:{for(var c=h.return;c!==null;){if(Tj(c)){var d=c;break e}c=c.return}throw Error(p(160))}switch(d.tag){case 5:var _=d.stateNode;d.flags&32&&(ob(_,""),d.flags&=-33);var v=Uj(h);Wj(h,v,_);break;case 3:case 4:var b=d.stateNode.containerInfo,tt=Uj(h);Vj(h,tt,b);break;default:throw Error(p(161))}}catch(it){W(h,h.return,it)}h.flags&=-3}o&4096&&(h.flags&=-4097)}function hk(h,o,c){V=h,ik(h)}function ik(h,o,c){for(var d=(h.mode&1)!==0;V!==null;){var _=V,v=_.child;if(_.tag===22&&d){var b=_.memoizedState!==null||Jj;if(!b){var tt=_.alternate,it=tt!==null&&tt.memoizedState!==null||U;tt=Jj;var nt=U;if(Jj=b,(U=it)&&!nt)for(V=_;V!==null;)b=V,it=b.child,b.tag===22&&b.memoizedState!==null?jk(_):it!==null?(it.return=b,V=it):jk(_);for(;v!==null;)V=v,ik(v),v=v.sibling;V=_,Jj=tt,U=nt}kk(h)}else _.subtreeFlags&8772&&v!==null?(v.return=_,V=v):kk(h)}}function kk(h){for(;V!==null;){var o=V;if(o.flags&8772){var c=o.alternate;try{if(o.flags&8772)switch(o.tag){case 0:case 11:case 15:U||Qj(5,o);break;case 1:var d=o.stateNode;if(o.flags&4&&!U)if(c===null)d.componentDidMount();else{var _=o.elementType===o.type?c.memoizedProps:Ci(o.type,c.memoizedProps);d.componentDidUpdate(_,c.memoizedState,d.__reactInternalSnapshotBeforeUpdate)}var v=o.updateQueue;v!==null&&sh(o,v,d);break;case 3:var b=o.updateQueue;if(b!==null){if(c=null,o.child!==null)switch(o.child.tag){case 5:c=o.child.stateNode;break;case 1:c=o.child.stateNode}sh(o,b,c)}break;case 5:var tt=o.stateNode;if(c===null&&o.flags&4){c=tt;var it=o.memoizedProps;switch(o.type){case"button":case"input":case"select":case"textarea":it.autoFocus&&c.focus();break;case"img":it.src&&(c.src=it.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(o.memoizedState===null){var nt=o.alternate;if(nt!==null){var lt=nt.memoizedState;if(lt!==null){var ut=lt.dehydrated;ut!==null&&bd(ut)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(p(163))}U||o.flags&512&&Rj(o)}catch(ht){W(o,o.return,ht)}}if(o===h){V=null;break}if(c=o.sibling,c!==null){c.return=o.return,V=c;break}V=o.return}}function gk(h){for(;V!==null;){var o=V;if(o===h){V=null;break}var c=o.sibling;if(c!==null){c.return=o.return,V=c;break}V=o.return}}function jk(h){for(;V!==null;){var o=V;try{switch(o.tag){case 0:case 11:case 15:var c=o.return;try{Qj(4,o)}catch(it){W(o,c,it)}break;case 1:var d=o.stateNode;if(typeof d.componentDidMount=="function"){var _=o.return;try{d.componentDidMount()}catch(it){W(o,_,it)}}var v=o.return;try{Rj(o)}catch(it){W(o,v,it)}break;case 5:var b=o.return;try{Rj(o)}catch(it){W(o,b,it)}}}catch(it){W(o,o.return,it)}if(o===h){V=null;break}var tt=o.sibling;if(tt!==null){tt.return=o.return,V=tt;break}V=o.return}}var lk=Math.ceil,mk=ua.ReactCurrentDispatcher,nk=ua.ReactCurrentOwner,ok=ua.ReactCurrentBatchConfig,K=0,Q=null,Y=null,Z=0,fj=0,ej=Uf(0),T=0,pk=null,rh=0,qk=0,rk=0,sk=null,tk=null,fk=0,Gj=1/0,uk=null,Oi=!1,Pi=null,Ri=null,vk=!1,wk=null,xk=0,yk=0,zk=null,Ak=-1,Bk=0;function R(){return K&6?B():Ak!==-1?Ak:Ak=B()}function yi(h){return h.mode&1?K&2&&Z!==0?Z&-Z:Kg.transition!==null?(Bk===0&&(Bk=yc()),Bk):(h=C,h!==0||(h=window.event,h=h===void 0?16:jd(h.type)),h):1}function gi(h,o,c,d){if(50<yk)throw yk=0,zk=null,Error(p(185));Ac(h,c,d),(!(K&2)||h!==Q)&&(h===Q&&(!(K&2)&&(qk|=c),T===4&&Ck(h,Z)),Dk(h,d),c===1&&K===0&&!(o.mode&1)&&(Gj=B()+500,fg&&jg()))}function Dk(h,o){var c=h.callbackNode;wc(h,o);var d=uc(h,h===Q?Z:0);if(d===0)c!==null&&bc(c),h.callbackNode=null,h.callbackPriority=0;else if(o=d&-d,h.callbackPriority!==o){if(c!=null&&bc(c),o===1)h.tag===0?ig(Ek.bind(null,h)):hg(Ek.bind(null,h)),Jf(function(){!(K&6)&&jg()}),c=null;else{switch(Dc(d)){case 1:c=fc;break;case 4:c=gc;break;case 16:c=hc;break;case 536870912:c=jc;break;default:c=hc}c=Fk(c,Gk.bind(null,h))}h.callbackPriority=o,h.callbackNode=c}}function Gk(h,o){if(Ak=-1,Bk=0,K&6)throw Error(p(327));var c=h.callbackNode;if(Hk()&&h.callbackNode!==c)return null;var d=uc(h,h===Q?Z:0);if(d===0)return null;if(d&30||d&h.expiredLanes||o)o=Ik(h,d);else{o=d;var _=K;K|=2;var v=Jk();(Q!==h||Z!==o)&&(uk=null,Gj=B()+500,Kk(h,o));do try{Lk();break}catch(tt){Mk(h,tt)}while(!0);$g(),mk.current=v,K=_,Y!==null?o=0:(Q=null,Z=0,o=T)}if(o!==0){if(o===2&&(_=xc(h),_!==0&&(d=_,o=Nk(h,_))),o===1)throw c=pk,Kk(h,0),Ck(h,d),Dk(h,B()),c;if(o===6)Ck(h,d);else{if(_=h.current.alternate,!(d&30)&&!Ok(_)&&(o=Ik(h,d),o===2&&(v=xc(h),v!==0&&(d=v,o=Nk(h,v))),o===1))throw c=pk,Kk(h,0),Ck(h,d),Dk(h,B()),c;switch(h.finishedWork=_,h.finishedLanes=d,o){case 0:case 1:throw Error(p(345));case 2:Pk(h,tk,uk);break;case 3:if(Ck(h,d),(d&130023424)===d&&(o=fk+500-B(),10<o)){if(uc(h,0)!==0)break;if(_=h.suspendedLanes,(_&d)!==d){R(),h.pingedLanes|=h.suspendedLanes&_;break}h.timeoutHandle=Ff(Pk.bind(null,h,tk,uk),o);break}Pk(h,tk,uk);break;case 4:if(Ck(h,d),(d&4194240)===d)break;for(o=h.eventTimes,_=-1;0<d;){var b=31-oc(d);v=1<<b,b=o[b],b>_&&(_=b),d&=~v}if(d=_,d=B()-d,d=(120>d?120:480>d?480:1080>d?1080:1920>d?1920:3e3>d?3e3:4320>d?4320:1960*lk(d/1960))-d,10<d){h.timeoutHandle=Ff(Pk.bind(null,h,tk,uk),d);break}Pk(h,tk,uk);break;case 5:Pk(h,tk,uk);break;default:throw Error(p(329))}}}return Dk(h,B()),h.callbackNode===c?Gk.bind(null,h):null}function Nk(h,o){var c=sk;return h.current.memoizedState.isDehydrated&&(Kk(h,o).flags|=256),h=Ik(h,o),h!==2&&(o=tk,tk=c,o!==null&&Fj(o)),h}function Fj(h){tk===null?tk=h:tk.push.apply(tk,h)}function Ok(h){for(var o=h;;){if(o.flags&16384){var c=o.updateQueue;if(c!==null&&(c=c.stores,c!==null))for(var d=0;d<c.length;d++){var _=c[d],v=_.getSnapshot;_=_.value;try{if(!He(v(),_))return!1}catch{return!1}}}if(c=o.child,o.subtreeFlags&16384&&c!==null)c.return=o,o=c;else{if(o===h)break;for(;o.sibling===null;){if(o.return===null||o.return===h)return!0;o=o.return}o.sibling.return=o.return,o=o.sibling}}return!0}function Ck(h,o){for(o&=~rk,o&=~qk,h.suspendedLanes|=o,h.pingedLanes&=~o,h=h.expirationTimes;0<o;){var c=31-oc(o),d=1<<c;h[c]=-1,o&=~d}}function Ek(h){if(K&6)throw Error(p(327));Hk();var o=uc(h,0);if(!(o&1))return Dk(h,B()),null;var c=Ik(h,o);if(h.tag!==0&&c===2){var d=xc(h);d!==0&&(o=d,c=Nk(h,d))}if(c===1)throw c=pk,Kk(h,0),Ck(h,o),Dk(h,B()),c;if(c===6)throw Error(p(345));return h.finishedWork=h.current.alternate,h.finishedLanes=o,Pk(h,tk,uk),Dk(h,B()),null}function Qk(h,o){var c=K;K|=1;try{return h(o)}finally{K=c,K===0&&(Gj=B()+500,fg&&jg())}}function Rk(h){wk!==null&&wk.tag===0&&!(K&6)&&Hk();var o=K;K|=1;var c=ok.transition,d=C;try{if(ok.transition=null,C=1,h)return h()}finally{C=d,ok.transition=c,K=o,!(K&6)&&jg()}}function Hj(){fj=ej.current,E(ej)}function Kk(h,o){h.finishedWork=null,h.finishedLanes=0;var c=h.timeoutHandle;if(c!==-1&&(h.timeoutHandle=-1,Gf(c)),Y!==null)for(c=Y.return;c!==null;){var d=c;switch(wg(d),d.tag){case 1:d=d.type.childContextTypes,d!=null&&$f();break;case 3:zh(),E(Wf),E(H),Eh();break;case 5:Bh(d);break;case 4:zh();break;case 13:E(L);break;case 19:E(L);break;case 10:ah(d.type._context);break;case 22:case 23:Hj()}c=c.return}if(Q=h,Y=h=Pg(h.current,null),Z=fj=o,T=0,pk=null,rk=qk=rh=0,tk=sk=null,fh!==null){for(o=0;o<fh.length;o++)if(c=fh[o],d=c.interleaved,d!==null){c.interleaved=null;var _=d.next,v=c.pending;if(v!==null){var b=v.next;v.next=_,d.next=b}c.pending=d}fh=null}return h}function Mk(h,o){do{var c=Y;try{if($g(),Fh.current=Rh,Ih){for(var d=M.memoizedState;d!==null;){var _=d.queue;_!==null&&(_.pending=null),d=d.next}Ih=!1}if(Hh=0,O=N=M=null,Jh=!1,Kh=0,nk.current=null,c===null||c.return===null){T=1,pk=o,Y=null;break}e:{var v=h,b=c.return,tt=c,it=o;if(o=Z,tt.flags|=32768,it!==null&&typeof it=="object"&&typeof it.then=="function"){var nt=it,lt=tt,ut=lt.tag;if(!(lt.mode&1)&&(ut===0||ut===11||ut===15)){var ht=lt.alternate;ht?(lt.updateQueue=ht.updateQueue,lt.memoizedState=ht.memoizedState,lt.lanes=ht.lanes):(lt.updateQueue=null,lt.memoizedState=null)}var _t=Ui(b);if(_t!==null){_t.flags&=-257,Vi(_t,b,tt,v,o),_t.mode&1&&Si(v,nt,o),o=_t,it=nt;var ft=o.updateQueue;if(ft===null){var bt=new Set;bt.add(it),o.updateQueue=bt}else ft.add(it);break e}else{if(!(o&1)){Si(v,nt,o),tj();break e}it=Error(p(426))}}else if(I&&tt.mode&1){var xt=Ui(b);if(xt!==null){!(xt.flags&65536)&&(xt.flags|=256),Vi(xt,b,tt,v,o),Jg(Ji(it,tt));break e}}v=it=Ji(it,tt),T!==4&&(T=2),sk===null?sk=[v]:sk.push(v),v=b;do{switch(v.tag){case 3:v.flags|=65536,o&=-o,v.lanes|=o;var St=Ni(v,it,o);ph(v,St);break e;case 1:tt=it;var wt=v.type,Pt=v.stateNode;if(!(v.flags&128)&&(typeof wt.getDerivedStateFromError=="function"||Pt!==null&&typeof Pt.componentDidCatch=="function"&&(Ri===null||!Ri.has(Pt)))){v.flags|=65536,o&=-o,v.lanes|=o;var Rt=Qi(v,tt,o);ph(v,Rt);break e}}v=v.return}while(v!==null)}Sk(c)}catch(kt){o=kt,Y===c&&c!==null&&(Y=c=c.return);continue}break}while(!0)}function Jk(){var h=mk.current;return mk.current=Rh,h===null?Rh:h}function tj(){(T===0||T===3||T===2)&&(T=4),Q===null||!(rh&268435455)&&!(qk&268435455)||Ck(Q,Z)}function Ik(h,o){var c=K;K|=2;var d=Jk();(Q!==h||Z!==o)&&(uk=null,Kk(h,o));do try{Tk();break}catch(_){Mk(h,_)}while(!0);if($g(),K=c,mk.current=d,Y!==null)throw Error(p(261));return Q=null,Z=0,T}function Tk(){for(;Y!==null;)Uk(Y)}function Lk(){for(;Y!==null&&!cc();)Uk(Y)}function Uk(h){var o=Vk(h.alternate,h,fj);h.memoizedProps=h.pendingProps,o===null?Sk(h):Y=o,nk.current=null}function Sk(h){var o=h;do{var c=o.alternate;if(h=o.return,o.flags&32768){if(c=Ij(c,o),c!==null){c.flags&=32767,Y=c;return}if(h!==null)h.flags|=32768,h.subtreeFlags=0,h.deletions=null;else{T=6,Y=null;return}}else if(c=Ej(c,o,fj),c!==null){Y=c;return}if(o=o.sibling,o!==null){Y=o;return}Y=o=h}while(o!==null);T===0&&(T=5)}function Pk(h,o,c){var d=C,_=ok.transition;try{ok.transition=null,C=1,Wk(h,o,c,d)}finally{ok.transition=_,C=d}return null}function Wk(h,o,c,d){do Hk();while(wk!==null);if(K&6)throw Error(p(327));c=h.finishedWork;var _=h.finishedLanes;if(c===null)return null;if(h.finishedWork=null,h.finishedLanes=0,c===h.current)throw Error(p(177));h.callbackNode=null,h.callbackPriority=0;var v=c.lanes|c.childLanes;if(Bc(h,v),h===Q&&(Y=Q=null,Z=0),!(c.subtreeFlags&2064)&&!(c.flags&2064)||vk||(vk=!0,Fk(hc,function(){return Hk(),null})),v=(c.flags&15990)!==0,c.subtreeFlags&15990||v){v=ok.transition,ok.transition=null;var b=C;C=1;var tt=K;K|=4,nk.current=null,Oj(h,c),dk(c,h),Oe(Df),dd=!!Cf,Df=Cf=null,h.current=c,hk(c),dc(),K=tt,C=b,ok.transition=v}else h.current=c;if(vk&&(vk=!1,wk=h,xk=_),v=h.pendingLanes,v===0&&(Ri=null),mc(c.stateNode),Dk(h,B()),o!==null)for(d=h.onRecoverableError,c=0;c<o.length;c++)_=o[c],d(_.value,{componentStack:_.stack,digest:_.digest});if(Oi)throw Oi=!1,h=Pi,Pi=null,h;return xk&1&&h.tag!==0&&Hk(),v=h.pendingLanes,v&1?h===zk?yk++:(yk=0,zk=h):yk=0,jg(),null}function Hk(){if(wk!==null){var h=Dc(xk),o=ok.transition,c=C;try{if(ok.transition=null,C=16>h?16:h,wk===null)var d=!1;else{if(h=wk,wk=null,xk=0,K&6)throw Error(p(331));var _=K;for(K|=4,V=h.current;V!==null;){var v=V,b=v.child;if(V.flags&16){var tt=v.deletions;if(tt!==null){for(var it=0;it<tt.length;it++){var nt=tt[it];for(V=nt;V!==null;){var lt=V;switch(lt.tag){case 0:case 11:case 15:Pj(8,lt,v)}var ut=lt.child;if(ut!==null)ut.return=lt,V=ut;else for(;V!==null;){lt=V;var ht=lt.sibling,_t=lt.return;if(Sj(lt),lt===nt){V=null;break}if(ht!==null){ht.return=_t,V=ht;break}V=_t}}}var ft=v.alternate;if(ft!==null){var bt=ft.child;if(bt!==null){ft.child=null;do{var xt=bt.sibling;bt.sibling=null,bt=xt}while(bt!==null)}}V=v}}if(v.subtreeFlags&2064&&b!==null)b.return=v,V=b;else e:for(;V!==null;){if(v=V,v.flags&2048)switch(v.tag){case 0:case 11:case 15:Pj(9,v,v.return)}var St=v.sibling;if(St!==null){St.return=v.return,V=St;break e}V=v.return}}var wt=h.current;for(V=wt;V!==null;){b=V;var Pt=b.child;if(b.subtreeFlags&2064&&Pt!==null)Pt.return=b,V=Pt;else e:for(b=wt;V!==null;){if(tt=V,tt.flags&2048)try{switch(tt.tag){case 0:case 11:case 15:Qj(9,tt)}}catch(kt){W(tt,tt.return,kt)}if(tt===b){V=null;break e}var Rt=tt.sibling;if(Rt!==null){Rt.return=tt.return,V=Rt;break e}V=tt.return}}if(K=_,jg(),lc&&typeof lc.onPostCommitFiberRoot=="function")try{lc.onPostCommitFiberRoot(kc,h)}catch{}d=!0}return d}finally{C=c,ok.transition=o}}return!1}function Xk(h,o,c){o=Ji(c,o),o=Ni(h,o,1),h=nh(h,o,1),o=R(),h!==null&&(Ac(h,1,o),Dk(h,o))}function W(h,o,c){if(h.tag===3)Xk(h,h,c);else for(;o!==null;){if(o.tag===3){Xk(o,h,c);break}else if(o.tag===1){var d=o.stateNode;if(typeof o.type.getDerivedStateFromError=="function"||typeof d.componentDidCatch=="function"&&(Ri===null||!Ri.has(d))){h=Ji(c,h),h=Qi(o,h,1),o=nh(o,h,1),h=R(),o!==null&&(Ac(o,1,h),Dk(o,h));break}}o=o.return}}function Ti(h,o,c){var d=h.pingCache;d!==null&&d.delete(o),o=R(),h.pingedLanes|=h.suspendedLanes&c,Q===h&&(Z&c)===c&&(T===4||T===3&&(Z&130023424)===Z&&500>B()-fk?Kk(h,0):rk|=c),Dk(h,o)}function Yk(h,o){o===0&&(h.mode&1?(o=sc,sc<<=1,!(sc&130023424)&&(sc=4194304)):o=1);var c=R();h=ih(h,o),h!==null&&(Ac(h,o,c),Dk(h,c))}function uj(h){var o=h.memoizedState,c=0;o!==null&&(c=o.retryLane),Yk(h,c)}function bk(h,o){var c=0;switch(h.tag){case 13:var d=h.stateNode,_=h.memoizedState;_!==null&&(c=_.retryLane);break;case 19:d=h.stateNode;break;default:throw Error(p(314))}d!==null&&d.delete(o),Yk(h,c)}var Vk;Vk=function(h,o,c){if(h!==null)if(h.memoizedProps!==o.pendingProps||Wf.current)dh=!0;else{if(!(h.lanes&c)&&!(o.flags&128))return dh=!1,yj(h,o,c);dh=!!(h.flags&131072)}else dh=!1,I&&o.flags&1048576&&ug(o,ng,o.index);switch(o.lanes=0,o.tag){case 2:var d=o.type;ij(h,o),h=o.pendingProps;var _=Yf(o,H.current);ch(o,c),_=Nh(null,o,d,h,_,c);var v=Sh();return o.flags|=1,typeof _=="object"&&_!==null&&typeof _.render=="function"&&_.$$typeof===void 0?(o.tag=1,o.memoizedState=null,o.updateQueue=null,Zf(d)?(v=!0,cg(o)):v=!1,o.memoizedState=_.state!==null&&_.state!==void 0?_.state:null,kh(o),_.updater=Ei,o.stateNode=_,_._reactInternals=o,Ii(o,d,h,c),o=jj(null,o,d,!0,v,c)):(o.tag=0,I&&v&&vg(o),Xi(null,o,_,c),o=o.child),o;case 16:d=o.elementType;e:{switch(ij(h,o),h=o.pendingProps,_=d._init,d=_(d._payload),o.type=d,_=o.tag=Zk(d),h=Ci(d,h),_){case 0:o=cj(null,o,d,h,c);break e;case 1:o=hj(null,o,d,h,c);break e;case 11:o=Yi(null,o,d,h,c);break e;case 14:o=$i(null,o,d,Ci(d.type,h),c);break e}throw Error(p(306,d,""))}return o;case 0:return d=o.type,_=o.pendingProps,_=o.elementType===d?_:Ci(d,_),cj(h,o,d,_,c);case 1:return d=o.type,_=o.pendingProps,_=o.elementType===d?_:Ci(d,_),hj(h,o,d,_,c);case 3:e:{if(kj(o),h===null)throw Error(p(387));d=o.pendingProps,v=o.memoizedState,_=v.element,lh(h,o),qh(o,d,null,c);var b=o.memoizedState;if(d=b.element,v.isDehydrated)if(v={element:d,isDehydrated:!1,cache:b.cache,pendingSuspenseBoundaries:b.pendingSuspenseBoundaries,transitions:b.transitions},o.updateQueue.baseState=v,o.memoizedState=v,o.flags&256){_=Ji(Error(p(423)),o),o=lj(h,o,d,c,_);break e}else if(d!==_){_=Ji(Error(p(424)),o),o=lj(h,o,d,c,_);break e}else for(yg=Lf(o.stateNode.containerInfo.firstChild),xg=o,I=!0,zg=null,c=Vg(o,null,d,c),o.child=c;c;)c.flags=c.flags&-3|4096,c=c.sibling;else{if(Ig(),d===_){o=Zi(h,o,c);break e}Xi(h,o,d,c)}o=o.child}return o;case 5:return Ah(o),h===null&&Eg(o),d=o.type,_=o.pendingProps,v=h!==null?h.memoizedProps:null,b=_.children,Ef(d,_)?b=null:v!==null&&Ef(d,v)&&(o.flags|=32),gj(h,o),Xi(h,o,b,c),o.child;case 6:return h===null&&Eg(o),null;case 13:return oj(h,o,c);case 4:return yh(o,o.stateNode.containerInfo),d=o.pendingProps,h===null?o.child=Ug(o,null,d,c):Xi(h,o,d,c),o.child;case 11:return d=o.type,_=o.pendingProps,_=o.elementType===d?_:Ci(d,_),Yi(h,o,d,_,c);case 7:return Xi(h,o,o.pendingProps,c),o.child;case 8:return Xi(h,o,o.pendingProps.children,c),o.child;case 12:return Xi(h,o,o.pendingProps.children,c),o.child;case 10:e:{if(d=o.type._context,_=o.pendingProps,v=o.memoizedProps,b=_.value,G(Wg,d._currentValue),d._currentValue=b,v!==null)if(He(v.value,b)){if(v.children===_.children&&!Wf.current){o=Zi(h,o,c);break e}}else for(v=o.child,v!==null&&(v.return=o);v!==null;){var tt=v.dependencies;if(tt!==null){b=v.child;for(var it=tt.firstContext;it!==null;){if(it.context===d){if(v.tag===1){it=mh(-1,c&-c),it.tag=2;var nt=v.updateQueue;if(nt!==null){nt=nt.shared;var lt=nt.pending;lt===null?it.next=it:(it.next=lt.next,lt.next=it),nt.pending=it}}v.lanes|=c,it=v.alternate,it!==null&&(it.lanes|=c),bh(v.return,c,o),tt.lanes|=c;break}it=it.next}}else if(v.tag===10)b=v.type===o.type?null:v.child;else if(v.tag===18){if(b=v.return,b===null)throw Error(p(341));b.lanes|=c,tt=b.alternate,tt!==null&&(tt.lanes|=c),bh(b,c,o),b=v.sibling}else b=v.child;if(b!==null)b.return=v;else for(b=v;b!==null;){if(b===o){b=null;break}if(v=b.sibling,v!==null){v.return=b.return,b=v;break}b=b.return}v=b}Xi(h,o,_.children,c),o=o.child}return o;case 9:return _=o.type,d=o.pendingProps.children,ch(o,c),_=eh(_),d=d(_),o.flags|=1,Xi(h,o,d,c),o.child;case 14:return d=o.type,_=Ci(d,o.pendingProps),_=Ci(d.type,_),$i(h,o,d,_,c);case 15:return bj(h,o,o.type,o.pendingProps,c);case 17:return d=o.type,_=o.pendingProps,_=o.elementType===d?_:Ci(d,_),ij(h,o),o.tag=1,Zf(d)?(h=!0,cg(o)):h=!1,ch(o,c),Gi(o,d,_),Ii(o,d,_,c),jj(null,o,d,!0,h,c);case 19:return xj(h,o,c);case 22:return dj(h,o,c)}throw Error(p(156,o.tag))};function Fk(h,o){return ac(h,o)}function $k(h,o,c,d){this.tag=h,this.key=c,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=o,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=d,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Bg(h,o,c,d){return new $k(h,o,c,d)}function aj(h){return h=h.prototype,!(!h||!h.isReactComponent)}function Zk(h){if(typeof h=="function")return aj(h)?1:0;if(h!=null){if(h=h.$$typeof,h===Da)return 11;if(h===Ga)return 14}return 2}function Pg(h,o){var c=h.alternate;return c===null?(c=Bg(h.tag,o,h.key,h.mode),c.elementType=h.elementType,c.type=h.type,c.stateNode=h.stateNode,c.alternate=h,h.alternate=c):(c.pendingProps=o,c.type=h.type,c.flags=0,c.subtreeFlags=0,c.deletions=null),c.flags=h.flags&14680064,c.childLanes=h.childLanes,c.lanes=h.lanes,c.child=h.child,c.memoizedProps=h.memoizedProps,c.memoizedState=h.memoizedState,c.updateQueue=h.updateQueue,o=h.dependencies,c.dependencies=o===null?null:{lanes:o.lanes,firstContext:o.firstContext},c.sibling=h.sibling,c.index=h.index,c.ref=h.ref,c}function Rg(h,o,c,d,_,v){var b=2;if(d=h,typeof h=="function")aj(h)&&(b=1);else if(typeof h=="string")b=5;else e:switch(h){case ya:return Tg(c.children,_,v,o);case za:b=8,_|=8;break;case Aa:return h=Bg(12,c,o,_|2),h.elementType=Aa,h.lanes=v,h;case Ea:return h=Bg(13,c,o,_),h.elementType=Ea,h.lanes=v,h;case Fa:return h=Bg(19,c,o,_),h.elementType=Fa,h.lanes=v,h;case Ia:return pj(c,_,v,o);default:if(typeof h=="object"&&h!==null)switch(h.$$typeof){case Ba:b=10;break e;case Ca:b=9;break e;case Da:b=11;break e;case Ga:b=14;break e;case Ha:b=16,d=null;break e}throw Error(p(130,h==null?h:typeof h,""))}return o=Bg(b,c,o,_),o.elementType=h,o.type=d,o.lanes=v,o}function Tg(h,o,c,d){return h=Bg(7,h,d,o),h.lanes=c,h}function pj(h,o,c,d){return h=Bg(22,h,d,o),h.elementType=Ia,h.lanes=c,h.stateNode={isHidden:!1},h}function Qg(h,o,c){return h=Bg(6,h,null,o),h.lanes=c,h}function Sg(h,o,c){return o=Bg(4,h.children!==null?h.children:[],h.key,o),o.lanes=c,o.stateNode={containerInfo:h.containerInfo,pendingChildren:null,implementation:h.implementation},o}function al(h,o,c,d,_){this.tag=o,this.containerInfo=h,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=zc(0),this.expirationTimes=zc(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=zc(0),this.identifierPrefix=d,this.onRecoverableError=_,this.mutableSourceEagerHydrationData=null}function bl(h,o,c,d,_,v,b,tt,it){return h=new al(h,o,c,tt,it),o===1?(o=1,v===!0&&(o|=8)):o=0,v=Bg(3,null,null,o),h.current=v,v.stateNode=h,v.memoizedState={element:d,isDehydrated:c,cache:null,transitions:null,pendingSuspenseBoundaries:null},kh(v),h}function cl(h,o,c){var d=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:wa,key:d==null?null:""+d,children:h,containerInfo:o,implementation:c}}function dl(h){if(!h)return Vf;h=h._reactInternals;e:{if(Vb(h)!==h||h.tag!==1)throw Error(p(170));var o=h;do{switch(o.tag){case 3:o=o.stateNode.context;break e;case 1:if(Zf(o.type)){o=o.stateNode.__reactInternalMemoizedMergedChildContext;break e}}o=o.return}while(o!==null);throw Error(p(171))}if(h.tag===1){var c=h.type;if(Zf(c))return bg(h,c,o)}return o}function el(h,o,c,d,_,v,b,tt,it){return h=bl(c,d,!0,h,_,v,b,tt,it),h.context=dl(null),c=h.current,d=R(),_=yi(c),v=mh(d,_),v.callback=o??null,nh(c,v,_),h.current.lanes=_,Ac(h,_,d),Dk(h,d),h}function fl(h,o,c,d){var _=o.current,v=R(),b=yi(_);return c=dl(c),o.context===null?o.context=c:o.pendingContext=c,o=mh(v,b),o.payload={element:h},d=d===void 0?null:d,d!==null&&(o.callback=d),h=nh(_,o,b),h!==null&&(gi(h,_,b,v),oh(h,_,b)),b}function gl(h){if(h=h.current,!h.child)return null;switch(h.child.tag){case 5:return h.child.stateNode;default:return h.child.stateNode}}function hl(h,o){if(h=h.memoizedState,h!==null&&h.dehydrated!==null){var c=h.retryLane;h.retryLane=c!==0&&c<o?c:o}}function il(h,o){hl(h,o),(h=h.alternate)&&hl(h,o)}function jl(){return null}var kl=typeof reportError=="function"?reportError:function(h){console.error(h)};function ll(h){this._internalRoot=h}ml.prototype.render=ll.prototype.render=function(h){var o=this._internalRoot;if(o===null)throw Error(p(409));fl(h,o,null,null)};ml.prototype.unmount=ll.prototype.unmount=function(){var h=this._internalRoot;if(h!==null){this._internalRoot=null;var o=h.containerInfo;Rk(function(){fl(null,h,null,null)}),o[uf]=null}};function ml(h){this._internalRoot=h}ml.prototype.unstable_scheduleHydration=function(h){if(h){var o=Hc();h={blockedOn:null,target:h,priority:o};for(var c=0;c<Qc.length&&o!==0&&o<Qc[c].priority;c++);Qc.splice(c,0,h),c===0&&Vc(h)}};function nl(h){return!(!h||h.nodeType!==1&&h.nodeType!==9&&h.nodeType!==11)}function ol(h){return!(!h||h.nodeType!==1&&h.nodeType!==9&&h.nodeType!==11&&(h.nodeType!==8||h.nodeValue!==" react-mount-point-unstable "))}function pl(){}function ql(h,o,c,d,_){if(_){if(typeof d=="function"){var v=d;d=function(){var nt=gl(b);v.call(nt)}}var b=el(o,d,h,0,null,!1,!1,"",pl);return h._reactRootContainer=b,h[uf]=b.current,sf(h.nodeType===8?h.parentNode:h),Rk(),b}for(;_=h.lastChild;)h.removeChild(_);if(typeof d=="function"){var tt=d;d=function(){var nt=gl(it);tt.call(nt)}}var it=bl(h,0,!1,null,null,!1,!1,"",pl);return h._reactRootContainer=it,h[uf]=it.current,sf(h.nodeType===8?h.parentNode:h),Rk(function(){fl(o,it,c,d)}),it}function rl(h,o,c,d,_){var v=c._reactRootContainer;if(v){var b=v;if(typeof _=="function"){var tt=_;_=function(){var it=gl(b);tt.call(it)}}fl(o,b,h,_)}else b=ql(c,o,h,_,d);return gl(b)}Ec=function(h){switch(h.tag){case 3:var o=h.stateNode;if(o.current.memoizedState.isDehydrated){var c=tc(o.pendingLanes);c!==0&&(Cc(o,c|1),Dk(o,B()),!(K&6)&&(Gj=B()+500,jg()))}break;case 13:Rk(function(){var d=ih(h,1);if(d!==null){var _=R();gi(d,h,1,_)}}),il(h,1)}};Fc=function(h){if(h.tag===13){var o=ih(h,134217728);if(o!==null){var c=R();gi(o,h,134217728,c)}il(h,134217728)}};Gc=function(h){if(h.tag===13){var o=yi(h),c=ih(h,o);if(c!==null){var d=R();gi(c,h,o,d)}il(h,o)}};Hc=function(){return C};Ic=function(h,o){var c=C;try{return C=h,o()}finally{C=c}};yb=function(h,o,c){switch(o){case"input":if(bb(h,c),o=c.name,c.type==="radio"&&o!=null){for(c=h;c.parentNode;)c=c.parentNode;for(c=c.querySelectorAll("input[name="+JSON.stringify(""+o)+'][type="radio"]'),o=0;o<c.length;o++){var d=c[o];if(d!==h&&d.form===h.form){var _=Db(d);if(!_)throw Error(p(90));Wa(d),bb(d,_)}}}break;case"textarea":ib(h,c);break;case"select":o=c.value,o!=null&&fb(h,!!c.multiple,o,!1)}};Gb=Qk;Hb=Rk;var sl={usingClientEntryPoint:!1,Events:[Cb,ue,Db,Eb,Fb,Qk]},tl={findFiberByHostInstance:Wc,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},ul={bundleType:tl.bundleType,version:tl.version,rendererPackageName:tl.rendererPackageName,rendererConfig:tl.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:ua.ReactCurrentDispatcher,findHostInstanceByFiber:function(h){return h=Zb(h),h===null?null:h.stateNode},findFiberByHostInstance:tl.findFiberByHostInstance||jl,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var vl=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!vl.isDisabled&&vl.supportsFiber)try{kc=vl.inject(ul),lc=vl}catch{}}reactDom_production_min.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=sl;reactDom_production_min.createPortal=function(h,o){var c=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!nl(o))throw Error(p(200));return cl(h,o,null,c)};reactDom_production_min.createRoot=function(h,o){if(!nl(h))throw Error(p(299));var c=!1,d="",_=kl;return o!=null&&(o.unstable_strictMode===!0&&(c=!0),o.identifierPrefix!==void 0&&(d=o.identifierPrefix),o.onRecoverableError!==void 0&&(_=o.onRecoverableError)),o=bl(h,1,!1,null,null,c,!1,d,_),h[uf]=o.current,sf(h.nodeType===8?h.parentNode:h),new ll(o)};reactDom_production_min.findDOMNode=function(h){if(h==null)return null;if(h.nodeType===1)return h;var o=h._reactInternals;if(o===void 0)throw typeof h.render=="function"?Error(p(188)):(h=Object.keys(h).join(","),Error(p(268,h)));return h=Zb(o),h=h===null?null:h.stateNode,h};reactDom_production_min.flushSync=function(h){return Rk(h)};reactDom_production_min.hydrate=function(h,o,c){if(!ol(o))throw Error(p(200));return rl(null,h,o,!0,c)};reactDom_production_min.hydrateRoot=function(h,o,c){if(!nl(h))throw Error(p(405));var d=c!=null&&c.hydratedSources||null,_=!1,v="",b=kl;if(c!=null&&(c.unstable_strictMode===!0&&(_=!0),c.identifierPrefix!==void 0&&(v=c.identifierPrefix),c.onRecoverableError!==void 0&&(b=c.onRecoverableError)),o=el(o,null,h,1,c??null,_,!1,v,b),h[uf]=o.current,sf(h),d)for(h=0;h<d.length;h++)c=d[h],_=c._getVersion,_=_(c._source),o.mutableSourceEagerHydrationData==null?o.mutableSourceEagerHydrationData=[c,_]:o.mutableSourceEagerHydrationData.push(c,_);return new ml(o)};reactDom_production_min.render=function(h,o,c){if(!ol(o))throw Error(p(200));return rl(null,h,o,!1,c)};reactDom_production_min.unmountComponentAtNode=function(h){if(!ol(h))throw Error(p(40));return h._reactRootContainer?(Rk(function(){rl(null,null,h,!1,function(){h._reactRootContainer=null,h[uf]=null})}),!0):!1};reactDom_production_min.unstable_batchedUpdates=Qk;reactDom_production_min.unstable_renderSubtreeIntoContainer=function(h,o,c,d){if(!ol(c))throw Error(p(200));if(h==null||h._reactInternals===void 0)throw Error(p(38));return rl(h,o,c,!1,d)};reactDom_production_min.version="18.3.1-next-f1338f8080-20240426";function checkDCE(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(checkDCE)}catch(h){console.error(h)}}checkDCE(),reactDom.exports=reactDom_production_min;var reactDomExports=reactDom.exports,m=reactDomExports;client.createRoot=m.createRoot,client.hydrateRoot=m.hydrateRoot;const LEFT="Left",RIGHT="Right",UP="Up",DOWN="Down",defaultProps={delta:10,preventScrollOnSwipe:!1,rotationAngle:0,trackMouse:!1,trackTouch:!0,swipeDuration:1/0,touchEventOptions:{passive:!0}},initialState={first:!0,initial:[0,0],start:0,swiping:!1,xy:[0,0]},mouseMove="mousemove",mouseUp="mouseup",touchEnd="touchend",touchMove="touchmove",touchStart="touchstart";function getDirection(h,o,c,d){return h>o?c>0?RIGHT:LEFT:d>0?DOWN:UP}function rotateXYByAngle(h,o){if(o===0)return h;const c=Math.PI/180*o,d=h[0]*Math.cos(c)+h[1]*Math.sin(c),_=h[1]*Math.cos(c)-h[0]*Math.sin(c);return[d,_]}function getHandlers(h,o){const c=nt=>{const lt="touches"in nt;lt&&nt.touches.length>1||h((ut,ht)=>{ht.trackMouse&&!lt&&(document.addEventListener(mouseMove,d),document.addEventListener(mouseUp,b));const{clientX:_t,clientY:ft}=lt?nt.touches[0]:nt,bt=rotateXYByAngle([_t,ft],ht.rotationAngle);return ht.onTouchStartOrOnMouseDown&&ht.onTouchStartOrOnMouseDown({event:nt}),Object.assign(Object.assign(Object.assign({},ut),initialState),{initial:bt.slice(),xy:bt,start:nt.timeStamp||0})})},d=nt=>{h((lt,ut)=>{const ht="touches"in nt;if(ht&&nt.touches.length>1)return lt;if(nt.timeStamp-lt.start>ut.swipeDuration)return lt.swiping?Object.assign(Object.assign({},lt),{swiping:!1}):lt;const{clientX:_t,clientY:ft}=ht?nt.touches[0]:nt,[bt,xt]=rotateXYByAngle([_t,ft],ut.rotationAngle),St=bt-lt.xy[0],wt=xt-lt.xy[1],Pt=Math.abs(St),Rt=Math.abs(wt),kt=(nt.timeStamp||0)-lt.start,Gt=Math.sqrt(Pt*Pt+Rt*Rt)/(kt||1),Dt=[St/(kt||1),wt/(kt||1)],It=getDirection(Pt,Rt,St,wt),Nt=typeof ut.delta=="number"?ut.delta:ut.delta[It.toLowerCase()]||defaultProps.delta;if(Pt<Nt&&Rt<Nt&&!lt.swiping)return lt;const Vt={absX:Pt,absY:Rt,deltaX:St,deltaY:wt,dir:It,event:nt,first:lt.first,initial:lt.initial,velocity:Gt,vxvy:Dt};Vt.first&&ut.onSwipeStart&&ut.onSwipeStart(Vt),ut.onSwiping&&ut.onSwiping(Vt);let Kt=!1;return(ut.onSwiping||ut.onSwiped||ut[`onSwiped${It}`])&&(Kt=!0),Kt&&ut.preventScrollOnSwipe&&ut.trackTouch&&nt.cancelable&&nt.preventDefault(),Object.assign(Object.assign({},lt),{first:!1,eventData:Vt,swiping:!0})})},_=nt=>{h((lt,ut)=>{let ht;if(lt.swiping&&lt.eventData){if(nt.timeStamp-lt.start<ut.swipeDuration){ht=Object.assign(Object.assign({},lt.eventData),{event:nt}),ut.onSwiped&&ut.onSwiped(ht);const _t=ut[`onSwiped${ht.dir}`];_t&&_t(ht)}}else ut.onTap&&ut.onTap({event:nt});return ut.onTouchEndOrOnMouseUp&&ut.onTouchEndOrOnMouseUp({event:nt}),Object.assign(Object.assign(Object.assign({},lt),initialState),{eventData:ht})})},v=()=>{document.removeEventListener(mouseMove,d),document.removeEventListener(mouseUp,b)},b=nt=>{v(),_(nt)},tt=(nt,lt)=>{let ut=()=>{};if(nt&&nt.addEventListener){const ht=Object.assign(Object.assign({},defaultProps.touchEventOptions),lt.touchEventOptions),_t=[[touchStart,c,ht],[touchMove,d,Object.assign(Object.assign({},ht),lt.preventScrollOnSwipe?{passive:!1}:{})],[touchEnd,_,ht]];_t.forEach(([ft,bt,xt])=>nt.addEventListener(ft,bt,xt)),ut=()=>_t.forEach(([ft,bt])=>nt.removeEventListener(ft,bt))}return ut},it={ref:nt=>{nt!==null&&h((lt,ut)=>{if(lt.el===nt)return lt;const ht={};return lt.el&&lt.el!==nt&&lt.cleanUpTouch&&(lt.cleanUpTouch(),ht.cleanUpTouch=void 0),ut.trackTouch&&nt&&(ht.cleanUpTouch=tt(nt,ut)),Object.assign(Object.assign(Object.assign({},lt),{el:nt}),ht)})}};return o.trackMouse&&(it.onMouseDown=c),[it,tt]}function updateTransientState(h,o,c,d){return!o.trackTouch||!h.el?(h.cleanUpTouch&&h.cleanUpTouch(),Object.assign(Object.assign({},h),{cleanUpTouch:void 0})):h.cleanUpTouch?o.preventScrollOnSwipe!==c.preventScrollOnSwipe||o.touchEventOptions.passive!==c.touchEventOptions.passive?(h.cleanUpTouch(),Object.assign(Object.assign({},h),{cleanUpTouch:d(h.el,o)})):h:Object.assign(Object.assign({},h),{cleanUpTouch:d(h.el,o)})}function useSwipeable(h){const{trackMouse:o}=h,c=reactExports.useRef(Object.assign({},initialState)),d=reactExports.useRef(Object.assign({},defaultProps)),_=reactExports.useRef(Object.assign({},d.current));_.current=Object.assign({},d.current),d.current=Object.assign(Object.assign({},defaultProps),h);let v;for(v in defaultProps)d.current[v]===void 0&&(d.current[v]=defaultProps[v]);const[b,tt]=reactExports.useMemo(()=>getHandlers(it=>c.current=it(c.current,d.current),{trackMouse:o}),[o]);return c.current=updateTransientState(c.current,d.current,_.current,tt),b}const MotionConfigContext=reactExports.createContext({transformPagePoint:h=>h,isStatic:!1,reducedMotion:"never"}),MotionContext=reactExports.createContext({}),PresenceContext=reactExports.createContext(null),isBrowser=typeof document<"u",useIsomorphicLayoutEffect=isBrowser?reactExports.useLayoutEffect:reactExports.useEffect,LazyContext=reactExports.createContext({strict:!1}),camelToDash=h=>h.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),optimizedAppearDataId="framerAppearId",optimizedAppearDataAttribute="data-"+camelToDash(optimizedAppearDataId),MotionGlobalConfig={skipAnimations:!1,useManualTiming:!1};class Queue{constructor(){this.order=[],this.scheduled=new Set}add(o){if(!this.scheduled.has(o))return this.scheduled.add(o),this.order.push(o),!0}remove(o){const c=this.order.indexOf(o);c!==-1&&(this.order.splice(c,1),this.scheduled.delete(o))}clear(){this.order.length=0,this.scheduled.clear()}}function createRenderStep(h){let o=new Queue,c=new Queue,d=0,_=!1,v=!1;const b=new WeakSet,tt={schedule:(it,nt=!1,lt=!1)=>{const ut=lt&&_,ht=ut?o:c;return nt&&b.add(it),ht.add(it)&&ut&&_&&(d=o.order.length),it},cancel:it=>{c.remove(it),b.delete(it)},process:it=>{if(_){v=!0;return}if(_=!0,[o,c]=[c,o],c.clear(),d=o.order.length,d)for(let nt=0;nt<d;nt++){const lt=o.order[nt];b.has(lt)&&(tt.schedule(lt),h()),lt(it)}_=!1,v&&(v=!1,tt.process(it))}};return tt}const stepsOrder=["read","resolveKeyframes","update","preRender","render","postRender"],maxElapsed=40;function createRenderBatcher(h,o){let c=!1,d=!0;const _={delta:0,timestamp:0,isProcessing:!1},v=stepsOrder.reduce((nt,lt)=>(nt[lt]=createRenderStep(()=>c=!0),nt),{}),b=nt=>{v[nt].process(_)},tt=()=>{const nt=performance.now();c=!1,_.delta=d?1e3/60:Math.max(Math.min(nt-_.timestamp,maxElapsed),1),_.timestamp=nt,_.isProcessing=!0,stepsOrder.forEach(b),_.isProcessing=!1,c&&o&&(d=!1,h(tt))},it=()=>{c=!0,d=!0,_.isProcessing||h(tt)};return{schedule:stepsOrder.reduce((nt,lt)=>{const ut=v[lt];return nt[lt]=(ht,_t=!1,ft=!1)=>(c||it(),ut.schedule(ht,_t,ft)),nt},{}),cancel:nt=>stepsOrder.forEach(lt=>v[lt].cancel(nt)),state:_,steps:v}}const{schedule:microtask,cancel:cancelMicrotask}=createRenderBatcher(queueMicrotask,!1);function useVisualElement(h,o,c,d){const{visualElement:_}=reactExports.useContext(MotionContext),v=reactExports.useContext(LazyContext),b=reactExports.useContext(PresenceContext),tt=reactExports.useContext(MotionConfigContext).reducedMotion,it=reactExports.useRef();d=d||v.renderer,!it.current&&d&&(it.current=d(h,{visualState:o,parent:_,props:c,presenceContext:b,blockInitialAnimation:b?b.initial===!1:!1,reducedMotionConfig:tt}));const nt=it.current;reactExports.useInsertionEffect(()=>{nt&&nt.update(c,b)});const lt=reactExports.useRef(!!(c[optimizedAppearDataAttribute]&&!window.HandoffComplete));return useIsomorphicLayoutEffect(()=>{nt&&(microtask.postRender(nt.render),lt.current&&nt.animationState&&nt.animationState.animateChanges())}),reactExports.useEffect(()=>{nt&&(nt.updateFeatures(),!lt.current&&nt.animationState&&nt.animationState.animateChanges(),lt.current&&(lt.current=!1,window.HandoffComplete=!0))}),nt}function isRefObject(h){return h&&typeof h=="object"&&Object.prototype.hasOwnProperty.call(h,"current")}function useMotionRef(h,o,c){return reactExports.useCallback(d=>{d&&h.mount&&h.mount(d),o&&(d?o.mount(d):o.unmount()),c&&(typeof c=="function"?c(d):isRefObject(c)&&(c.current=d))},[o])}function isVariantLabel(h){return typeof h=="string"||Array.isArray(h)}function isAnimationControls(h){return h!==null&&typeof h=="object"&&typeof h.start=="function"}const variantPriorityOrder=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],variantProps=["initial",...variantPriorityOrder];function isControllingVariants(h){return isAnimationControls(h.animate)||variantProps.some(o=>isVariantLabel(h[o]))}function isVariantNode(h){return!!(isControllingVariants(h)||h.variants)}function getCurrentTreeVariants(h,o){if(isControllingVariants(h)){const{initial:c,animate:d}=h;return{initial:c===!1||isVariantLabel(c)?c:void 0,animate:isVariantLabel(d)?d:void 0}}return h.inherit!==!1?o:{}}function useCreateMotionContext(h){const{initial:o,animate:c}=getCurrentTreeVariants(h,reactExports.useContext(MotionContext));return reactExports.useMemo(()=>({initial:o,animate:c}),[variantLabelsAsDependency(o),variantLabelsAsDependency(c)])}function variantLabelsAsDependency(h){return Array.isArray(h)?h.join(" "):h}const featureProps={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},featureDefinitions={};for(const h in featureProps)featureDefinitions[h]={isEnabled:o=>featureProps[h].some(c=>!!o[c])};function loadFeatures(h){for(const o in h)featureDefinitions[o]={...featureDefinitions[o],...h[o]}}const LayoutGroupContext=reactExports.createContext({}),SwitchLayoutGroupContext=reactExports.createContext({}),motionComponentSymbol=Symbol.for("motionComponentSymbol");function createMotionComponent({preloadedFeatures:h,createVisualElement:o,useRender:c,useVisualState:d,Component:_}){h&&loadFeatures(h);function v(tt,it){let nt;const lt={...reactExports.useContext(MotionConfigContext),...tt,layoutId:useLayoutId(tt)},{isStatic:ut}=lt,ht=useCreateMotionContext(tt),_t=d(tt,ut);if(!ut&&isBrowser){ht.visualElement=useVisualElement(_,_t,lt,o);const ft=reactExports.useContext(SwitchLayoutGroupContext),bt=reactExports.useContext(LazyContext).strict;ht.visualElement&&(nt=ht.visualElement.loadFeatures(lt,bt,h,ft))}return jsxRuntimeExports.jsxs(MotionContext.Provider,{value:ht,children:[nt&&ht.visualElement?jsxRuntimeExports.jsx(nt,{visualElement:ht.visualElement,...lt}):null,c(_,tt,useMotionRef(_t,ht.visualElement,it),_t,ut,ht.visualElement)]})}const b=reactExports.forwardRef(v);return b[motionComponentSymbol]=_,b}function useLayoutId({layoutId:h}){const o=reactExports.useContext(LayoutGroupContext).id;return o&&h!==void 0?o+"-"+h:h}function createMotionProxy(h){function o(d,_={}){return createMotionComponent(h(d,_))}if(typeof Proxy>"u")return o;const c=new Map;return new Proxy(o,{get:(d,_)=>(c.has(_)||c.set(_,o(_)),c.get(_))})}const lowercaseSVGElements=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function isSVGComponent(h){return typeof h!="string"||h.includes("-")?!1:!!(lowercaseSVGElements.indexOf(h)>-1||/[A-Z]/u.test(h))}const scaleCorrectors={};function addScaleCorrector(h){Object.assign(scaleCorrectors,h)}const transformPropOrder=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],transformProps=new Set(transformPropOrder);function isForcedMotionValue(h,{layout:o,layoutId:c}){return transformProps.has(h)||h.startsWith("origin")||(o||c!==void 0)&&(!!scaleCorrectors[h]||h==="opacity")}const isMotionValue=h=>!!(h&&h.getVelocity),translateAlias={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},numTransforms=transformPropOrder.length;function buildTransform(h,{enableHardwareAcceleration:o=!0,allowTransformNone:c=!0},d,_){let v="";for(let b=0;b<numTransforms;b++){const tt=transformPropOrder[b];if(h[tt]!==void 0){const it=translateAlias[tt]||tt;v+=`${it}(${h[tt]}) `}}return o&&!h.z&&(v+="translateZ(0)"),v=v.trim(),_?v=_(h,d?"":v):c&&d&&(v="none"),v}const checkStringStartsWith=h=>o=>typeof o=="string"&&o.startsWith(h),isCSSVariableName=checkStringStartsWith("--"),startsAsVariableToken=checkStringStartsWith("var(--"),isCSSVariableToken=h=>startsAsVariableToken(h)?singleCssVariableRegex.test(h.split("/*")[0].trim()):!1,singleCssVariableRegex=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,getValueAsType=(h,o)=>o&&typeof h=="number"?o.transform(h):h,clamp=(h,o,c)=>c>o?o:c<h?h:c,number={test:h=>typeof h=="number",parse:parseFloat,transform:h=>h},alpha={...number,transform:h=>clamp(0,1,h)},scale={...number,default:1},sanitize=h=>Math.round(h*1e5)/1e5,floatRegex=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu,colorRegex=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu,singleColorRegex=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu;function isString(h){return typeof h=="string"}const createUnitType=h=>({test:o=>isString(o)&&o.endsWith(h)&&o.split(" ").length===1,parse:parseFloat,transform:o=>`${o}${h}`}),degrees=createUnitType("deg"),percent=createUnitType("%"),px=createUnitType("px"),vh=createUnitType("vh"),vw=createUnitType("vw"),progressPercentage={...percent,parse:h=>percent.parse(h)/100,transform:h=>percent.transform(h*100)},int={...number,transform:Math.round},numberValueTypes={borderWidth:px,borderTopWidth:px,borderRightWidth:px,borderBottomWidth:px,borderLeftWidth:px,borderRadius:px,radius:px,borderTopLeftRadius:px,borderTopRightRadius:px,borderBottomRightRadius:px,borderBottomLeftRadius:px,width:px,maxWidth:px,height:px,maxHeight:px,size:px,top:px,right:px,bottom:px,left:px,padding:px,paddingTop:px,paddingRight:px,paddingBottom:px,paddingLeft:px,margin:px,marginTop:px,marginRight:px,marginBottom:px,marginLeft:px,rotate:degrees,rotateX:degrees,rotateY:degrees,rotateZ:degrees,scale,scaleX:scale,scaleY:scale,scaleZ:scale,skew:degrees,skewX:degrees,skewY:degrees,distance:px,translateX:px,translateY:px,translateZ:px,x:px,y:px,z:px,perspective:px,transformPerspective:px,opacity:alpha,originX:progressPercentage,originY:progressPercentage,originZ:px,zIndex:int,backgroundPositionX:px,backgroundPositionY:px,fillOpacity:alpha,strokeOpacity:alpha,numOctaves:int};function buildHTMLStyles(h,o,c,d){const{style:_,vars:v,transform:b,transformOrigin:tt}=h;let it=!1,nt=!1,lt=!0;for(const ut in o){const ht=o[ut];if(isCSSVariableName(ut)){v[ut]=ht;continue}const _t=numberValueTypes[ut],ft=getValueAsType(ht,_t);if(transformProps.has(ut)){if(it=!0,b[ut]=ft,!lt)continue;ht!==(_t.default||0)&&(lt=!1)}else ut.startsWith("origin")?(nt=!0,tt[ut]=ft):_[ut]=ft}if(o.transform||(it||d?_.transform=buildTransform(h.transform,c,lt,d):_.transform&&(_.transform="none")),nt){const{originX:ut="50%",originY:ht="50%",originZ:_t=0}=tt;_.transformOrigin=`${ut} ${ht} ${_t}`}}const createHtmlRenderState=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function copyRawValuesOnly(h,o,c){for(const d in o)!isMotionValue(o[d])&&!isForcedMotionValue(d,c)&&(h[d]=o[d])}function useInitialMotionValues({transformTemplate:h},o,c){return reactExports.useMemo(()=>{const d=createHtmlRenderState();return buildHTMLStyles(d,o,{enableHardwareAcceleration:!c},h),Object.assign({},d.vars,d.style)},[o])}function useStyle(h,o,c){const d=h.style||{},_={};return copyRawValuesOnly(_,d,h),Object.assign(_,useInitialMotionValues(h,o,c)),_}function useHTMLProps(h,o,c){const d={},_=useStyle(h,o,c);return h.drag&&h.dragListener!==!1&&(d.draggable=!1,_.userSelect=_.WebkitUserSelect=_.WebkitTouchCallout="none",_.touchAction=h.drag===!0?"none":`pan-${h.drag==="x"?"y":"x"}`),h.tabIndex===void 0&&(h.onTap||h.onTapStart||h.whileTap)&&(d.tabIndex=0),d.style=_,d}const validMotionProps=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function isValidMotionProp(h){return h.startsWith("while")||h.startsWith("drag")&&h!=="draggable"||h.startsWith("layout")||h.startsWith("onTap")||h.startsWith("onPan")||h.startsWith("onLayout")||validMotionProps.has(h)}let shouldForward=h=>!isValidMotionProp(h);function loadExternalIsValidProp(h){h&&(shouldForward=o=>o.startsWith("on")?!isValidMotionProp(o):h(o))}try{loadExternalIsValidProp(require("@emotion/is-prop-valid").default)}catch(h){}function filterProps(h,o,c){const d={};for(const _ in h)_==="values"&&typeof h.values=="object"||(shouldForward(_)||c===!0&&isValidMotionProp(_)||!o&&!isValidMotionProp(_)||h.draggable&&_.startsWith("onDrag"))&&(d[_]=h[_]);return d}function calcOrigin$1(h,o,c){return typeof h=="string"?h:px.transform(o+c*h)}function calcSVGTransformOrigin(h,o,c){const d=calcOrigin$1(o,h.x,h.width),_=calcOrigin$1(c,h.y,h.height);return`${d} ${_}`}const dashKeys={offset:"stroke-dashoffset",array:"stroke-dasharray"},camelKeys={offset:"strokeDashoffset",array:"strokeDasharray"};function buildSVGPath(h,o,c=1,d=0,_=!0){h.pathLength=1;const v=_?dashKeys:camelKeys;h[v.offset]=px.transform(-d);const b=px.transform(o),tt=px.transform(c);h[v.array]=`${b} ${tt}`}function buildSVGAttrs(h,{attrX:o,attrY:c,attrScale:d,originX:_,originY:v,pathLength:b,pathSpacing:tt=1,pathOffset:it=0,...nt},lt,ut,ht){if(buildHTMLStyles(h,nt,lt,ht),ut){h.style.viewBox&&(h.attrs.viewBox=h.style.viewBox);return}h.attrs=h.style,h.style={};const{attrs:_t,style:ft,dimensions:bt}=h;_t.transform&&(bt&&(ft.transform=_t.transform),delete _t.transform),bt&&(_!==void 0||v!==void 0||ft.transform)&&(ft.transformOrigin=calcSVGTransformOrigin(bt,_!==void 0?_:.5,v!==void 0?v:.5)),o!==void 0&&(_t.x=o),c!==void 0&&(_t.y=c),d!==void 0&&(_t.scale=d),b!==void 0&&buildSVGPath(_t,b,tt,it,!1)}const createSvgRenderState=()=>({...createHtmlRenderState(),attrs:{}}),isSVGTag=h=>typeof h=="string"&&h.toLowerCase()==="svg";function useSVGProps(h,o,c,d){const _=reactExports.useMemo(()=>{const v=createSvgRenderState();return buildSVGAttrs(v,o,{enableHardwareAcceleration:!1},isSVGTag(d),h.transformTemplate),{...v.attrs,style:{...v.style}}},[o]);if(h.style){const v={};copyRawValuesOnly(v,h.style,h),_.style={...v,..._.style}}return _}function createUseRender(h=!1){return(o,c,d,{latestValues:_},v)=>{const b=(isSVGComponent(o)?useSVGProps:useHTMLProps)(c,_,v,o),tt=filterProps(c,typeof o=="string",h),it=o!==reactExports.Fragment?{...tt,...b,ref:d}:{},{children:nt}=c,lt=reactExports.useMemo(()=>isMotionValue(nt)?nt.get():nt,[nt]);return reactExports.createElement(o,{...it,children:lt})}}function renderHTML(h,{style:o,vars:c},d,_){Object.assign(h.style,o,_&&_.getProjectionStyles(d));for(const v in c)h.style.setProperty(v,c[v])}const camelCaseAttributes=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function renderSVG(h,o,c,d){renderHTML(h,o,void 0,d);for(const _ in o.attrs)h.setAttribute(camelCaseAttributes.has(_)?_:camelToDash(_),o.attrs[_])}function scrapeMotionValuesFromProps$1(h,o,c){var d;const{style:_}=h,v={};for(const b in _)(isMotionValue(_[b])||o.style&&isMotionValue(o.style[b])||isForcedMotionValue(b,h)||((d=c==null?void 0:c.getValue(b))===null||d===void 0?void 0:d.liveStyle)!==void 0)&&(v[b]=_[b]);return v}function scrapeMotionValuesFromProps(h,o,c){const d=scrapeMotionValuesFromProps$1(h,o,c);for(const _ in h)if(isMotionValue(h[_])||isMotionValue(o[_])){const v=transformPropOrder.indexOf(_)!==-1?"attr"+_.charAt(0).toUpperCase()+_.substring(1):_;d[v]=h[_]}return d}function resolveVariantFromProps(h,o,c,d={},_={}){return typeof o=="function"&&(o=o(c!==void 0?c:h.custom,d,_)),typeof o=="string"&&(o=h.variants&&h.variants[o]),typeof o=="function"&&(o=o(c!==void 0?c:h.custom,d,_)),o}function useConstant(h){const o=reactExports.useRef(null);return o.current===null&&(o.current=h()),o.current}const isKeyframesTarget=h=>Array.isArray(h),isCustomValue=h=>!!(h&&typeof h=="object"&&h.mix&&h.toValue),resolveFinalValueInKeyframes=h=>isKeyframesTarget(h)?h[h.length-1]||0:h;function resolveMotionValue(h){const o=isMotionValue(h)?h.get():h;return isCustomValue(o)?o.toValue():o}function makeState({scrapeMotionValuesFromProps:h,createRenderState:o,onMount:c},d,_,v){const b={latestValues:makeLatestValues(d,_,v,h),renderState:o()};return c&&(b.mount=tt=>c(d,tt,b)),b}const makeUseVisualState=h=>(o,c)=>{const d=reactExports.useContext(MotionContext),_=reactExports.useContext(PresenceContext),v=()=>makeState(h,o,d,_);return c?v():useConstant(v)};function makeLatestValues(h,o,c,d){const _={},v=d(h,{});for(const ht in v)_[ht]=resolveMotionValue(v[ht]);let{initial:b,animate:tt}=h;const it=isControllingVariants(h),nt=isVariantNode(h);o&&nt&&!it&&h.inherit!==!1&&(b===void 0&&(b=o.initial),tt===void 0&&(tt=o.animate));let lt=c?c.initial===!1:!1;lt=lt||b===!1;const ut=lt?tt:b;return ut&&typeof ut!="boolean"&&!isAnimationControls(ut)&&(Array.isArray(ut)?ut:[ut]).forEach(ht=>{const _t=resolveVariantFromProps(h,ht);if(!_t)return;const{transitionEnd:ft,transition:bt,...xt}=_t;for(const St in xt){let wt=xt[St];if(Array.isArray(wt)){const Pt=lt?wt.length-1:0;wt=wt[Pt]}wt!==null&&(_[St]=wt)}for(const St in ft)_[St]=ft[St]}),_}const noop=h=>h,{schedule:frame,cancel:cancelFrame,state:frameData,steps}=createRenderBatcher(typeof requestAnimationFrame<"u"?requestAnimationFrame:noop,!0),svgMotionConfig={useVisualState:makeUseVisualState({scrapeMotionValuesFromProps,createRenderState:createSvgRenderState,onMount:(h,o,{renderState:c,latestValues:d})=>{frame.read(()=>{try{c.dimensions=typeof o.getBBox=="function"?o.getBBox():o.getBoundingClientRect()}catch{c.dimensions={x:0,y:0,width:0,height:0}}}),frame.render(()=>{buildSVGAttrs(c,d,{enableHardwareAcceleration:!1},isSVGTag(o.tagName),h.transformTemplate),renderSVG(o,c)})}})},htmlMotionConfig={useVisualState:makeUseVisualState({scrapeMotionValuesFromProps:scrapeMotionValuesFromProps$1,createRenderState:createHtmlRenderState})};function createDomMotionConfig(h,{forwardMotionProps:o=!1},c,d){return{...isSVGComponent(h)?svgMotionConfig:htmlMotionConfig,preloadedFeatures:c,useRender:createUseRender(o),createVisualElement:d,Component:h}}function addDomEvent(h,o,c,d={passive:!0}){return h.addEventListener(o,c,d),()=>h.removeEventListener(o,c)}const isPrimaryPointer=h=>h.pointerType==="mouse"?typeof h.button!="number"||h.button<=0:h.isPrimary!==!1;function extractEventInfo(h,o="page"){return{point:{x:h[`${o}X`],y:h[`${o}Y`]}}}const addPointerInfo=h=>o=>isPrimaryPointer(o)&&h(o,extractEventInfo(o));function addPointerEvent(h,o,c,d){return addDomEvent(h,o,addPointerInfo(c),d)}const combineFunctions=(h,o)=>c=>o(h(c)),pipe=(...h)=>h.reduce(combineFunctions);function createLock(h){let o=null;return()=>{const c=()=>{o=null};return o===null?(o=h,c):!1}}const globalHorizontalLock=createLock("dragHorizontal"),globalVerticalLock=createLock("dragVertical");function getGlobalLock(h){let o=!1;if(h==="y")o=globalVerticalLock();else if(h==="x")o=globalHorizontalLock();else{const c=globalHorizontalLock(),d=globalVerticalLock();c&&d?o=()=>{c(),d()}:(c&&c(),d&&d())}return o}function isDragActive(){const h=getGlobalLock(!0);return h?(h(),!1):!0}class Feature{constructor(o){this.isMounted=!1,this.node=o}update(){}}function addHoverEvent(h,o){const c=o?"pointerenter":"pointerleave",d=o?"onHoverStart":"onHoverEnd",_=(v,b)=>{if(v.pointerType==="touch"||isDragActive())return;const tt=h.getProps();h.animationState&&tt.whileHover&&h.animationState.setActive("whileHover",o);const it=tt[d];it&&frame.postRender(()=>it(v,b))};return addPointerEvent(h.current,c,_,{passive:!h.getProps()[d]})}class HoverGesture extends Feature{mount(){this.unmount=pipe(addHoverEvent(this.node,!0),addHoverEvent(this.node,!1))}unmount(){}}class FocusGesture extends Feature{constructor(){super(...arguments),this.isActive=!1}onFocus(){let o=!1;try{o=this.node.current.matches(":focus-visible")}catch{o=!0}!o||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=pipe(addDomEvent(this.node.current,"focus",()=>this.onFocus()),addDomEvent(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}const isNodeOrChild=(h,o)=>o?h===o?!0:isNodeOrChild(h,o.parentElement):!1;function fireSyntheticPointerEvent(h,o){if(!o)return;const c=new PointerEvent("pointer"+h);o(c,extractEventInfo(c))}class PressGesture extends Feature{constructor(){super(...arguments),this.removeStartListeners=noop,this.removeEndListeners=noop,this.removeAccessibleListeners=noop,this.startPointerPress=(o,c)=>{if(this.isPressing)return;this.removeEndListeners();const d=this.node.getProps(),_=addPointerEvent(window,"pointerup",(b,tt)=>{if(!this.checkPressEnd())return;const{onTap:it,onTapCancel:nt,globalTapTarget:lt}=this.node.getProps(),ut=!lt&&!isNodeOrChild(this.node.current,b.target)?nt:it;ut&&frame.update(()=>ut(b,tt))},{passive:!(d.onTap||d.onPointerUp)}),v=addPointerEvent(window,"pointercancel",(b,tt)=>this.cancelPress(b,tt),{passive:!(d.onTapCancel||d.onPointerCancel)});this.removeEndListeners=pipe(_,v),this.startPress(o,c)},this.startAccessiblePress=()=>{const o=v=>{if(v.key!=="Enter"||this.isPressing)return;const b=tt=>{tt.key!=="Enter"||!this.checkPressEnd()||fireSyntheticPointerEvent("up",(it,nt)=>{const{onTap:lt}=this.node.getProps();lt&&frame.postRender(()=>lt(it,nt))})};this.removeEndListeners(),this.removeEndListeners=addDomEvent(this.node.current,"keyup",b),fireSyntheticPointerEvent("down",(tt,it)=>{this.startPress(tt,it)})},c=addDomEvent(this.node.current,"keydown",o),d=()=>{this.isPressing&&fireSyntheticPointerEvent("cancel",(v,b)=>this.cancelPress(v,b))},_=addDomEvent(this.node.current,"blur",d);this.removeAccessibleListeners=pipe(c,_)}}startPress(o,c){this.isPressing=!0;const{onTapStart:d,whileTap:_}=this.node.getProps();_&&this.node.animationState&&this.node.animationState.setActive("whileTap",!0),d&&frame.postRender(()=>d(o,c))}checkPressEnd(){return this.removeEndListeners(),this.isPressing=!1,this.node.getProps().whileTap&&this.node.animationState&&this.node.animationState.setActive("whileTap",!1),!isDragActive()}cancelPress(o,c){if(!this.checkPressEnd())return;const{onTapCancel:d}=this.node.getProps();d&&frame.postRender(()=>d(o,c))}mount(){const o=this.node.getProps(),c=addPointerEvent(o.globalTapTarget?window:this.node.current,"pointerdown",this.startPointerPress,{passive:!(o.onTapStart||o.onPointerStart)}),d=addDomEvent(this.node.current,"focus",this.startAccessiblePress);this.removeStartListeners=pipe(c,d)}unmount(){this.removeStartListeners(),this.removeEndListeners(),this.removeAccessibleListeners()}}const observerCallbacks=new WeakMap,observers=new WeakMap,fireObserverCallback=h=>{const o=observerCallbacks.get(h.target);o&&o(h)},fireAllObserverCallbacks=h=>{h.forEach(fireObserverCallback)};function initIntersectionObserver({root:h,...o}){const c=h||document;observers.has(c)||observers.set(c,{});const d=observers.get(c),_=JSON.stringify(o);return d[_]||(d[_]=new IntersectionObserver(fireAllObserverCallbacks,{root:h,...o})),d[_]}function observeIntersection(h,o,c){const d=initIntersectionObserver(o);return observerCallbacks.set(h,c),d.observe(h),()=>{observerCallbacks.delete(h),d.unobserve(h)}}const thresholdNames={some:0,all:1};class InViewFeature extends Feature{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:o={}}=this.node.getProps(),{root:c,margin:d,amount:_="some",once:v}=o,b={root:c?c.current:void 0,rootMargin:d,threshold:typeof _=="number"?_:thresholdNames[_]},tt=it=>{const{isIntersecting:nt}=it;if(this.isInView===nt||(this.isInView=nt,v&&!nt&&this.hasEnteredView))return;nt&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",nt);const{onViewportEnter:lt,onViewportLeave:ut}=this.node.getProps(),ht=nt?lt:ut;ht&&ht(it)};return observeIntersection(this.node.current,b,tt)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:o,prevProps:c}=this.node;["amount","margin","root"].some(hasViewportOptionChanged(o,c))&&this.startObserver()}unmount(){}}function hasViewportOptionChanged({viewport:h={}},{viewport:o={}}={}){return c=>h[c]!==o[c]}const gestureAnimations={inView:{Feature:InViewFeature},tap:{Feature:PressGesture},focus:{Feature:FocusGesture},hover:{Feature:HoverGesture}};function shallowCompare(h,o){if(!Array.isArray(o))return!1;const c=o.length;if(c!==h.length)return!1;for(let d=0;d<c;d++)if(o[d]!==h[d])return!1;return!0}function getCurrent(h){const o={};return h.values.forEach((c,d)=>o[d]=c.get()),o}function getVelocity$1(h){const o={};return h.values.forEach((c,d)=>o[d]=c.getVelocity()),o}function resolveVariant(h,o,c){const d=h.getProps();return resolveVariantFromProps(d,o,c!==void 0?c:d.custom,getCurrent(h),getVelocity$1(h))}const secondsToMilliseconds=h=>h*1e3,millisecondsToSeconds=h=>h/1e3,underDampedSpring={type:"spring",stiffness:500,damping:25,restSpeed:10},criticallyDampedSpring=h=>({type:"spring",stiffness:550,damping:h===0?2*Math.sqrt(550):30,restSpeed:10}),keyframesTransition={type:"keyframes",duration:.8},ease={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},getDefaultTransition=(h,{keyframes:o})=>o.length>2?keyframesTransition:transformProps.has(h)?h.startsWith("scale")?criticallyDampedSpring(o[1]):underDampedSpring:ease;function isTransitionDefined({when:h,delay:o,delayChildren:c,staggerChildren:d,staggerDirection:_,repeat:v,repeatType:b,repeatDelay:tt,from:it,elapsed:nt,...lt}){return!!Object.keys(lt).length}function getValueTransition(h,o){return h[o]||h.default||h}const isNotNull=h=>h!==null;function getFinalKeyframe(h,{repeat:o,repeatType:c="loop"},d){const _=h.filter(isNotNull),v=o&&c!=="loop"&&o%2===1?0:_.length-1;return!v||d===void 0?_[v]:d}let now;function clearTime(){now=void 0}const time={now:()=>(now===void 0&&time.set(frameData.isProcessing||MotionGlobalConfig.useManualTiming?frameData.timestamp:performance.now()),now),set:h=>{now=h,queueMicrotask(clearTime)}},isZeroValueString=h=>/^0[^.\s]+$/u.test(h);function isNone(h){return typeof h=="number"?h===0:h!==null?h==="none"||h==="0"||isZeroValueString(h):!0}let invariant=noop;const isNumericalString=h=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(h),splitCSSVariableRegex=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function parseCSSVariable(h){const o=splitCSSVariableRegex.exec(h);if(!o)return[,];const[,c,d,_]=o;return[`--${c??d}`,_]}function getVariableValue(h,o,c=1){const[d,_]=parseCSSVariable(h);if(!d)return;const v=window.getComputedStyle(o).getPropertyValue(d);if(v){const b=v.trim();return isNumericalString(b)?parseFloat(b):b}return isCSSVariableToken(_)?getVariableValue(_,o,c+1):_}const positionalKeys=new Set(["width","height","top","left","right","bottom","x","y","translateX","translateY"]),isNumOrPxType=h=>h===number||h===px,getPosFromMatrix=(h,o)=>parseFloat(h.split(", ")[o]),getTranslateFromMatrix=(h,o)=>(c,{transform:d})=>{if(d==="none"||!d)return 0;const _=d.match(/^matrix3d\((.+)\)$/u);if(_)return getPosFromMatrix(_[1],o);{const v=d.match(/^matrix\((.+)\)$/u);return v?getPosFromMatrix(v[1],h):0}},transformKeys=new Set(["x","y","z"]),nonTranslationalTransformKeys=transformPropOrder.filter(h=>!transformKeys.has(h));function removeNonTranslationalTransform(h){const o=[];return nonTranslationalTransformKeys.forEach(c=>{const d=h.getValue(c);d!==void 0&&(o.push([c,d.get()]),d.set(c.startsWith("scale")?1:0))}),o}const positionalValues={width:({x:h},{paddingLeft:o="0",paddingRight:c="0"})=>h.max-h.min-parseFloat(o)-parseFloat(c),height:({y:h},{paddingTop:o="0",paddingBottom:c="0"})=>h.max-h.min-parseFloat(o)-parseFloat(c),top:(h,{top:o})=>parseFloat(o),left:(h,{left:o})=>parseFloat(o),bottom:({y:h},{top:o})=>parseFloat(o)+(h.max-h.min),right:({x:h},{left:o})=>parseFloat(o)+(h.max-h.min),x:getTranslateFromMatrix(4,13),y:getTranslateFromMatrix(5,14)};positionalValues.translateX=positionalValues.x;positionalValues.translateY=positionalValues.y;const testValueType=h=>o=>o.test(h),auto={test:h=>h==="auto",parse:h=>h},dimensionValueTypes=[number,px,percent,degrees,vw,vh,auto],findDimensionValueType=h=>dimensionValueTypes.find(testValueType(h)),toResolve=new Set;let isScheduled=!1,anyNeedsMeasurement=!1;function measureAllKeyframes(){if(anyNeedsMeasurement){const h=Array.from(toResolve).filter(d=>d.needsMeasurement),o=new Set(h.map(d=>d.element)),c=new Map;o.forEach(d=>{const _=removeNonTranslationalTransform(d);_.length&&(c.set(d,_),d.render())}),h.forEach(d=>d.measureInitialState()),o.forEach(d=>{d.render();const _=c.get(d);_&&_.forEach(([v,b])=>{var tt;(tt=d.getValue(v))===null||tt===void 0||tt.set(b)})}),h.forEach(d=>d.measureEndState()),h.forEach(d=>{d.suspendedScrollY!==void 0&&window.scrollTo(0,d.suspendedScrollY)})}anyNeedsMeasurement=!1,isScheduled=!1,toResolve.forEach(h=>h.complete()),toResolve.clear()}function readAllKeyframes(){toResolve.forEach(h=>{h.readKeyframes(),h.needsMeasurement&&(anyNeedsMeasurement=!0)})}function flushKeyframeResolvers(){readAllKeyframes(),measureAllKeyframes()}class KeyframeResolver{constructor(o,c,d,_,v,b=!1){this.isComplete=!1,this.isAsync=!1,this.needsMeasurement=!1,this.isScheduled=!1,this.unresolvedKeyframes=[...o],this.onComplete=c,this.name=d,this.motionValue=_,this.element=v,this.isAsync=b}scheduleResolve(){this.isScheduled=!0,this.isAsync?(toResolve.add(this),isScheduled||(isScheduled=!0,frame.read(readAllKeyframes),frame.resolveKeyframes(measureAllKeyframes))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:o,name:c,element:d,motionValue:_}=this;for(let v=0;v<o.length;v++)if(o[v]===null)if(v===0){const b=_==null?void 0:_.get(),tt=o[o.length-1];if(b!==void 0)o[0]=b;else if(d&&c){const it=d.readValue(c,tt);it!=null&&(o[0]=it)}o[0]===void 0&&(o[0]=tt),_&&b===void 0&&_.set(o[0])}else o[v]=o[v-1]}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(){this.isComplete=!0,this.onComplete(this.unresolvedKeyframes,this.finalKeyframe),toResolve.delete(this)}cancel(){this.isComplete||(this.isScheduled=!1,toResolve.delete(this))}resume(){this.isComplete||this.scheduleResolve()}}const isColorString=(h,o)=>c=>!!(isString(c)&&singleColorRegex.test(c)&&c.startsWith(h)||o&&Object.prototype.hasOwnProperty.call(c,o)),splitColor=(h,o,c)=>d=>{if(!isString(d))return d;const[_,v,b,tt]=d.match(floatRegex);return{[h]:parseFloat(_),[o]:parseFloat(v),[c]:parseFloat(b),alpha:tt!==void 0?parseFloat(tt):1}},clampRgbUnit=h=>clamp(0,255,h),rgbUnit={...number,transform:h=>Math.round(clampRgbUnit(h))},rgba={test:isColorString("rgb","red"),parse:splitColor("red","green","blue"),transform:({red:h,green:o,blue:c,alpha:d=1})=>"rgba("+rgbUnit.transform(h)+", "+rgbUnit.transform(o)+", "+rgbUnit.transform(c)+", "+sanitize(alpha.transform(d))+")"};function parseHex(h){let o="",c="",d="",_="";return h.length>5?(o=h.substring(1,3),c=h.substring(3,5),d=h.substring(5,7),_=h.substring(7,9)):(o=h.substring(1,2),c=h.substring(2,3),d=h.substring(3,4),_=h.substring(4,5),o+=o,c+=c,d+=d,_+=_),{red:parseInt(o,16),green:parseInt(c,16),blue:parseInt(d,16),alpha:_?parseInt(_,16)/255:1}}const hex={test:isColorString("#"),parse:parseHex,transform:rgba.transform},hsla={test:isColorString("hsl","hue"),parse:splitColor("hue","saturation","lightness"),transform:({hue:h,saturation:o,lightness:c,alpha:d=1})=>"hsla("+Math.round(h)+", "+percent.transform(sanitize(o))+", "+percent.transform(sanitize(c))+", "+sanitize(alpha.transform(d))+")"},color={test:h=>rgba.test(h)||hex.test(h)||hsla.test(h),parse:h=>rgba.test(h)?rgba.parse(h):hsla.test(h)?hsla.parse(h):hex.parse(h),transform:h=>isString(h)?h:h.hasOwnProperty("red")?rgba.transform(h):hsla.transform(h)};function test(h){var o,c;return isNaN(h)&&isString(h)&&(((o=h.match(floatRegex))===null||o===void 0?void 0:o.length)||0)+(((c=h.match(colorRegex))===null||c===void 0?void 0:c.length)||0)>0}const NUMBER_TOKEN="number",COLOR_TOKEN="color",VAR_TOKEN="var",VAR_FUNCTION_TOKEN="var(",SPLIT_TOKEN="${}",complexRegex=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function analyseComplexValue(h){const o=h.toString(),c=[],d={color:[],number:[],var:[]},_=[];let v=0;const b=o.replace(complexRegex,tt=>(color.test(tt)?(d.color.push(v),_.push(COLOR_TOKEN),c.push(color.parse(tt))):tt.startsWith(VAR_FUNCTION_TOKEN)?(d.var.push(v),_.push(VAR_TOKEN),c.push(tt)):(d.number.push(v),_.push(NUMBER_TOKEN),c.push(parseFloat(tt))),++v,SPLIT_TOKEN)).split(SPLIT_TOKEN);return{values:c,split:b,indexes:d,types:_}}function parseComplexValue(h){return analyseComplexValue(h).values}function createTransformer(h){const{split:o,types:c}=analyseComplexValue(h),d=o.length;return _=>{let v="";for(let b=0;b<d;b++)if(v+=o[b],_[b]!==void 0){const tt=c[b];tt===NUMBER_TOKEN?v+=sanitize(_[b]):tt===COLOR_TOKEN?v+=color.transform(_[b]):v+=_[b]}return v}}const convertNumbersToZero=h=>typeof h=="number"?0:h;function getAnimatableNone$1(h){const o=parseComplexValue(h);return createTransformer(h)(o.map(convertNumbersToZero))}const complex={test,parse:parseComplexValue,createTransformer,getAnimatableNone:getAnimatableNone$1},maxDefaults=new Set(["brightness","contrast","saturate","opacity"]);function applyDefaultFilter(h){const[o,c]=h.slice(0,-1).split("(");if(o==="drop-shadow")return h;const[d]=c.match(floatRegex)||[];if(!d)return h;const _=c.replace(d,"");let v=maxDefaults.has(o)?1:0;return d!==c&&(v*=100),o+"("+v+_+")"}const functionRegex=/\b([a-z-]*)\(.*?\)/gu,filter={...complex,getAnimatableNone:h=>{const o=h.match(functionRegex);return o?o.map(applyDefaultFilter).join(" "):h}},defaultValueTypes={...numberValueTypes,color,backgroundColor:color,outlineColor:color,fill:color,stroke:color,borderColor:color,borderTopColor:color,borderRightColor:color,borderBottomColor:color,borderLeftColor:color,filter,WebkitFilter:filter},getDefaultValueType=h=>defaultValueTypes[h];function getAnimatableNone(h,o){let c=getDefaultValueType(h);return c!==filter&&(c=complex),c.getAnimatableNone?c.getAnimatableNone(o):void 0}const invalidTemplates=new Set(["auto","none","0"]);function makeNoneKeyframesAnimatable(h,o,c){let d=0,_;for(;d<h.length&&!_;){const v=h[d];typeof v=="string"&&!invalidTemplates.has(v)&&(_=h[d]),d++}if(_&&c)for(const v of o)h[v]=getAnimatableNone(c,_)}class DOMKeyframesResolver extends KeyframeResolver{constructor(o,c,d,_){super(o,c,d,_,_==null?void 0:_.owner,!0)}readKeyframes(){const{unresolvedKeyframes:o,element:c,name:d}=this;if(!c.current)return;super.readKeyframes();for(let it=0;it<o.length;it++){const nt=o[it];if(typeof nt=="string"&&isCSSVariableToken(nt)){const lt=getVariableValue(nt,c.current);lt!==void 0&&(o[it]=lt),it===o.length-1&&(this.finalKeyframe=nt)}}if(this.resolveNoneKeyframes(),!positionalKeys.has(d)||o.length!==2)return;const[_,v]=o,b=findDimensionValueType(_),tt=findDimensionValueType(v);if(b!==tt)if(isNumOrPxType(b)&&isNumOrPxType(tt))for(let it=0;it<o.length;it++){const nt=o[it];typeof nt=="string"&&(o[it]=parseFloat(nt))}else this.needsMeasurement=!0}resolveNoneKeyframes(){const{unresolvedKeyframes:o,name:c}=this,d=[];for(let _=0;_<o.length;_++)isNone(o[_])&&d.push(_);d.length&&makeNoneKeyframesAnimatable(o,d,c)}measureInitialState(){const{element:o,unresolvedKeyframes:c,name:d}=this;if(!o.current)return;d==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=positionalValues[d](o.measureViewportBox(),window.getComputedStyle(o.current)),c[0]=this.measuredOrigin;const _=c[c.length-1];_!==void 0&&o.getValue(d,_).jump(_,!1)}measureEndState(){var o;const{element:c,name:d,unresolvedKeyframes:_}=this;if(!c.current)return;const v=c.getValue(d);v&&v.jump(this.measuredOrigin,!1);const b=_.length-1,tt=_[b];_[b]=positionalValues[d](c.measureViewportBox(),window.getComputedStyle(c.current)),tt!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=tt),!((o=this.removedTransforms)===null||o===void 0)&&o.length&&this.removedTransforms.forEach(([it,nt])=>{c.getValue(it).set(nt)}),this.resolveNoneKeyframes()}}function memo(h){let o;return()=>(o===void 0&&(o=h()),o)}const isAnimatable=(h,o)=>o==="zIndex"?!1:!!(typeof h=="number"||Array.isArray(h)||typeof h=="string"&&(complex.test(h)||h==="0")&&!h.startsWith("url("));function hasKeyframesChanged(h){const o=h[0];if(h.length===1)return!0;for(let c=0;c<h.length;c++)if(h[c]!==o)return!0}function canAnimate(h,o,c,d){const _=h[0];if(_===null)return!1;const v=h[h.length-1],b=isAnimatable(_,o),tt=isAnimatable(v,o);return!b||!tt?!1:hasKeyframesChanged(h)||c==="spring"&&d}class BaseAnimation{constructor({autoplay:o=!0,delay:c=0,type:d="keyframes",repeat:_=0,repeatDelay:v=0,repeatType:b="loop",...tt}){this.isStopped=!1,this.hasAttemptedResolve=!1,this.options={autoplay:o,delay:c,type:d,repeat:_,repeatDelay:v,repeatType:b,...tt},this.updateFinishedPromise()}get resolved(){return!this._resolved&&!this.hasAttemptedResolve&&flushKeyframeResolvers(),this._resolved}onKeyframesResolved(o,c){this.hasAttemptedResolve=!0;const{name:d,type:_,velocity:v,delay:b,onComplete:tt,onUpdate:it,isGenerator:nt}=this.options;if(!nt&&!canAnimate(o,d,_,v))if(b)this.options.duration=0;else{it==null||it(getFinalKeyframe(o,this.options,c)),tt==null||tt(),this.resolveFinishedPromise();return}const lt=this.initPlayback(o,c);lt!==!1&&(this._resolved={keyframes:o,finalKeyframe:c,...lt},this.onPostResolved())}onPostResolved(){}then(o,c){return this.currentFinishedPromise.then(o,c)}updateFinishedPromise(){this.currentFinishedPromise=new Promise(o=>{this.resolveFinishedPromise=o})}}function velocityPerSecond(h,o){return o?h*(1e3/o):0}const velocitySampleDuration=5;function calcGeneratorVelocity(h,o,c){const d=Math.max(o-velocitySampleDuration,0);return velocityPerSecond(c-h(d),o-d)}const safeMin=.001,minDuration=.01,maxDuration$1=10,minDamping=.05,maxDamping=1;function findSpring({duration:h=800,bounce:o=.25,velocity:c=0,mass:d=1}){let _,v,b=1-o;b=clamp(minDamping,maxDamping,b),h=clamp(minDuration,maxDuration$1,millisecondsToSeconds(h)),b<1?(_=nt=>{const lt=nt*b,ut=lt*h,ht=lt-c,_t=calcAngularFreq(nt,b),ft=Math.exp(-ut);return safeMin-ht/_t*ft},v=nt=>{const lt=nt*b*h,ut=lt*c+c,ht=Math.pow(b,2)*Math.pow(nt,2)*h,_t=Math.exp(-lt),ft=calcAngularFreq(Math.pow(nt,2),b);return(-_(nt)+safeMin>0?-1:1)*((ut-ht)*_t)/ft}):(_=nt=>{const lt=Math.exp(-nt*h),ut=(nt-c)*h+1;return-safeMin+lt*ut},v=nt=>{const lt=Math.exp(-nt*h),ut=(c-nt)*(h*h);return lt*ut});const tt=5/h,it=approximateRoot(_,v,tt);if(h=secondsToMilliseconds(h),isNaN(it))return{stiffness:100,damping:10,duration:h};{const nt=Math.pow(it,2)*d;return{stiffness:nt,damping:b*2*Math.sqrt(d*nt),duration:h}}}const rootIterations=12;function approximateRoot(h,o,c){let d=c;for(let _=1;_<rootIterations;_++)d=d-h(d)/o(d);return d}function calcAngularFreq(h,o){return h*Math.sqrt(1-o*o)}const durationKeys=["duration","bounce"],physicsKeys=["stiffness","damping","mass"];function isSpringType(h,o){return o.some(c=>h[c]!==void 0)}function getSpringOptions(h){let o={velocity:0,stiffness:100,damping:10,mass:1,isResolvedFromDuration:!1,...h};if(!isSpringType(h,physicsKeys)&&isSpringType(h,durationKeys)){const c=findSpring(h);o={...o,...c,mass:1},o.isResolvedFromDuration=!0}return o}function spring({keyframes:h,restDelta:o,restSpeed:c,...d}){const _=h[0],v=h[h.length-1],b={done:!1,value:_},{stiffness:tt,damping:it,mass:nt,duration:lt,velocity:ut,isResolvedFromDuration:ht}=getSpringOptions({...d,velocity:-millisecondsToSeconds(d.velocity||0)}),_t=ut||0,ft=it/(2*Math.sqrt(tt*nt)),bt=v-_,xt=millisecondsToSeconds(Math.sqrt(tt/nt)),St=Math.abs(bt)<5;c||(c=St?.01:2),o||(o=St?.005:.5);let wt;if(ft<1){const Pt=calcAngularFreq(xt,ft);wt=Rt=>{const kt=Math.exp(-ft*xt*Rt);return v-kt*((_t+ft*xt*bt)/Pt*Math.sin(Pt*Rt)+bt*Math.cos(Pt*Rt))}}else if(ft===1)wt=Pt=>v-Math.exp(-xt*Pt)*(bt+(_t+xt*bt)*Pt);else{const Pt=xt*Math.sqrt(ft*ft-1);wt=Rt=>{const kt=Math.exp(-ft*xt*Rt),Gt=Math.min(Pt*Rt,300);return v-kt*((_t+ft*xt*bt)*Math.sinh(Gt)+Pt*bt*Math.cosh(Gt))/Pt}}return{calculatedDuration:ht&&lt||null,next:Pt=>{const Rt=wt(Pt);if(ht)b.done=Pt>=lt;else{let kt=_t;Pt!==0&&(ft<1?kt=calcGeneratorVelocity(wt,Pt,Rt):kt=0);const Gt=Math.abs(kt)<=c,Dt=Math.abs(v-Rt)<=o;b.done=Gt&&Dt}return b.value=b.done?v:Rt,b}}}function inertia({keyframes:h,velocity:o=0,power:c=.8,timeConstant:d=325,bounceDamping:_=10,bounceStiffness:v=500,modifyTarget:b,min:tt,max:it,restDelta:nt=.5,restSpeed:lt}){const ut=h[0],ht={done:!1,value:ut},_t=It=>tt!==void 0&&It<tt||it!==void 0&&It>it,ft=It=>tt===void 0?it:it===void 0||Math.abs(tt-It)<Math.abs(it-It)?tt:it;let bt=c*o;const xt=ut+bt,St=b===void 0?xt:b(xt);St!==xt&&(bt=St-ut);const wt=It=>-bt*Math.exp(-It/d),Pt=It=>St+wt(It),Rt=It=>{const Nt=wt(It),Vt=Pt(It);ht.done=Math.abs(Nt)<=nt,ht.value=ht.done?St:Vt};let kt,Gt;const Dt=It=>{_t(ht.value)&&(kt=It,Gt=spring({keyframes:[ht.value,ft(ht.value)],velocity:calcGeneratorVelocity(Pt,It,ht.value),damping:_,stiffness:v,restDelta:nt,restSpeed:lt}))};return Dt(0),{calculatedDuration:null,next:It=>{let Nt=!1;return!Gt&&kt===void 0&&(Nt=!0,Rt(It),Dt(It)),kt!==void 0&&It>=kt?Gt.next(It-kt):(!Nt&&Rt(It),ht)}}}const calcBezier=(h,o,c)=>(((1-3*c+3*o)*h+(3*c-6*o))*h+3*o)*h,subdivisionPrecision=1e-7,subdivisionMaxIterations=12;function binarySubdivide(h,o,c,d,_){let v,b,tt=0;do b=o+(c-o)/2,v=calcBezier(b,d,_)-h,v>0?c=b:o=b;while(Math.abs(v)>subdivisionPrecision&&++tt<subdivisionMaxIterations);return b}function cubicBezier(h,o,c,d){if(h===o&&c===d)return noop;const _=v=>binarySubdivide(v,0,1,h,c);return v=>v===0||v===1?v:calcBezier(_(v),o,d)}const easeIn=cubicBezier(.42,0,1,1),easeOut=cubicBezier(0,0,.58,1),easeInOut=cubicBezier(.42,0,.58,1),isEasingArray=h=>Array.isArray(h)&&typeof h[0]!="number",mirrorEasing=h=>o=>o<=.5?h(2*o)/2:(2-h(2*(1-o)))/2,reverseEasing=h=>o=>1-h(1-o),circIn=h=>1-Math.sin(Math.acos(h)),circOut=reverseEasing(circIn),circInOut=mirrorEasing(circIn),backOut=cubicBezier(.33,1.53,.69,.99),backIn=reverseEasing(backOut),backInOut=mirrorEasing(backIn),anticipate=h=>(h*=2)<1?.5*backIn(h):.5*(2-Math.pow(2,-10*(h-1))),easingLookup={linear:noop,easeIn,easeInOut,easeOut,circIn,circInOut,circOut,backIn,backInOut,backOut,anticipate},easingDefinitionToFunction=h=>{if(Array.isArray(h)){invariant(h.length===4);const[o,c,d,_]=h;return cubicBezier(o,c,d,_)}else if(typeof h=="string")return easingLookup[h];return h},progress=(h,o,c)=>{const d=o-h;return d===0?1:(c-h)/d},mixNumber$1=(h,o,c)=>h+(o-h)*c;function hueToRgb(h,o,c){return c<0&&(c+=1),c>1&&(c-=1),c<1/6?h+(o-h)*6*c:c<1/2?o:c<2/3?h+(o-h)*(2/3-c)*6:h}function hslaToRgba({hue:h,saturation:o,lightness:c,alpha:d}){h/=360,o/=100,c/=100;let _=0,v=0,b=0;if(!o)_=v=b=c;else{const tt=c<.5?c*(1+o):c+o-c*o,it=2*c-tt;_=hueToRgb(it,tt,h+1/3),v=hueToRgb(it,tt,h),b=hueToRgb(it,tt,h-1/3)}return{red:Math.round(_*255),green:Math.round(v*255),blue:Math.round(b*255),alpha:d}}const mixLinearColor=(h,o,c)=>{const d=h*h,_=c*(o*o-d)+d;return _<0?0:Math.sqrt(_)},colorTypes=[hex,rgba,hsla],getColorType=h=>colorTypes.find(o=>o.test(h));function asRGBA(h){const o=getColorType(h);let c=o.parse(h);return o===hsla&&(c=hslaToRgba(c)),c}const mixColor=(h,o)=>{const c=asRGBA(h),d=asRGBA(o),_={...c};return v=>(_.red=mixLinearColor(c.red,d.red,v),_.green=mixLinearColor(c.green,d.green,v),_.blue=mixLinearColor(c.blue,d.blue,v),_.alpha=mixNumber$1(c.alpha,d.alpha,v),rgba.transform(_))};function mixImmediate(h,o){return c=>c>0?o:h}function mixNumber(h,o){return c=>mixNumber$1(h,o,c)}function getMixer$1(h){return typeof h=="number"?mixNumber:typeof h=="string"?isCSSVariableToken(h)?mixImmediate:color.test(h)?mixColor:mixComplex:Array.isArray(h)?mixArray:typeof h=="object"?color.test(h)?mixColor:mixObject:mixImmediate}function mixArray(h,o){const c=[...h],d=c.length,_=h.map((v,b)=>getMixer$1(v)(v,o[b]));return v=>{for(let b=0;b<d;b++)c[b]=_[b](v);return c}}function mixObject(h,o){const c={...h,...o},d={};for(const _ in c)h[_]!==void 0&&o[_]!==void 0&&(d[_]=getMixer$1(h[_])(h[_],o[_]));return _=>{for(const v in d)c[v]=d[v](_);return c}}function matchOrder(h,o){var c;const d=[],_={color:0,var:0,number:0};for(let v=0;v<o.values.length;v++){const b=o.types[v],tt=h.indexes[b][_[b]],it=(c=h.values[tt])!==null&&c!==void 0?c:0;d[v]=it,_[b]++}return d}const mixComplex=(h,o)=>{const c=complex.createTransformer(o),d=analyseComplexValue(h),_=analyseComplexValue(o);return d.indexes.var.length===_.indexes.var.length&&d.indexes.color.length===_.indexes.color.length&&d.indexes.number.length>=_.indexes.number.length?pipe(mixArray(matchOrder(d,_),_.values),c):mixImmediate(h,o)};function mix(h,o,c){return typeof h=="number"&&typeof o=="number"&&typeof c=="number"?mixNumber$1(h,o,c):getMixer$1(h)(h,o)}function createMixers(h,o,c){const d=[],_=c||mix,v=h.length-1;for(let b=0;b<v;b++){let tt=_(h[b],h[b+1]);if(o){const it=Array.isArray(o)?o[b]||noop:o;tt=pipe(it,tt)}d.push(tt)}return d}function interpolate(h,o,{clamp:c=!0,ease:d,mixer:_}={}){const v=h.length;if(invariant(v===o.length),v===1)return()=>o[0];if(v===2&&h[0]===h[1])return()=>o[1];h[0]>h[v-1]&&(h=[...h].reverse(),o=[...o].reverse());const b=createMixers(o,d,_),tt=b.length,it=nt=>{let lt=0;if(tt>1)for(;lt<h.length-2&&!(nt<h[lt+1]);lt++);const ut=progress(h[lt],h[lt+1],nt);return b[lt](ut)};return c?nt=>it(clamp(h[0],h[v-1],nt)):it}function fillOffset(h,o){const c=h[h.length-1];for(let d=1;d<=o;d++){const _=progress(0,o,d);h.push(mixNumber$1(c,1,_))}}function defaultOffset(h){const o=[0];return fillOffset(o,h.length-1),o}function convertOffsetToTimes(h,o){return h.map(c=>c*o)}function defaultEasing(h,o){return h.map(()=>o||easeInOut).splice(0,h.length-1)}function keyframes({duration:h=300,keyframes:o,times:c,ease:d="easeInOut"}){const _=isEasingArray(d)?d.map(easingDefinitionToFunction):easingDefinitionToFunction(d),v={done:!1,value:o[0]},b=convertOffsetToTimes(c&&c.length===o.length?c:defaultOffset(o),h),tt=interpolate(b,o,{ease:Array.isArray(_)?_:defaultEasing(o,_)});return{calculatedDuration:h,next:it=>(v.value=tt(it),v.done=it>=h,v)}}const maxGeneratorDuration=2e4;function calcGeneratorDuration(h){let o=0;const c=50;let d=h.next(o);for(;!d.done&&o<maxGeneratorDuration;)o+=c,d=h.next(o);return o>=maxGeneratorDuration?1/0:o}const frameloopDriver=h=>{const o=({timestamp:c})=>h(c);return{start:()=>frame.update(o,!0),stop:()=>cancelFrame(o),now:()=>frameData.isProcessing?frameData.timestamp:time.now()}},generators={decay:inertia,inertia,tween:keyframes,keyframes,spring},percentToProgress=h=>h/100;class MainThreadAnimation extends BaseAnimation{constructor({KeyframeResolver:o=KeyframeResolver,...c}){super(c),this.holdTime=null,this.startTime=null,this.cancelTime=null,this.currentTime=0,this.playbackSpeed=1,this.pendingPlayState="running",this.state="idle",this.stop=()=>{if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;this.teardown();const{onStop:tt}=this.options;tt&&tt()};const{name:d,motionValue:_,keyframes:v}=this.options,b=(tt,it)=>this.onKeyframesResolved(tt,it);d&&_&&_.owner?this.resolver=_.owner.resolveKeyframes(v,b,d,_):this.resolver=new o(v,b,d,_),this.resolver.scheduleResolve()}initPlayback(o){const{type:c="keyframes",repeat:d=0,repeatDelay:_=0,repeatType:v,velocity:b=0}=this.options,tt=generators[c]||keyframes;let it,nt;tt!==keyframes&&typeof o[0]!="number"&&(it=pipe(percentToProgress,mix(o[0],o[1])),o=[0,100]);const lt=tt({...this.options,keyframes:o});v==="mirror"&&(nt=tt({...this.options,keyframes:[...o].reverse(),velocity:-b})),lt.calculatedDuration===null&&(lt.calculatedDuration=calcGeneratorDuration(lt));const{calculatedDuration:ut}=lt,ht=ut+_,_t=ht*(d+1)-_;return{generator:lt,mirroredGenerator:nt,mapPercentToKeyframes:it,calculatedDuration:ut,resolvedDuration:ht,totalDuration:_t}}onPostResolved(){const{autoplay:o=!0}=this.options;this.play(),this.pendingPlayState==="paused"||!o?this.pause():this.state=this.pendingPlayState}tick(o,c=!1){const{resolved:d}=this;if(!d){const{keyframes:It}=this.options;return{done:!0,value:It[It.length-1]}}const{finalKeyframe:_,generator:v,mirroredGenerator:b,mapPercentToKeyframes:tt,keyframes:it,calculatedDuration:nt,totalDuration:lt,resolvedDuration:ut}=d;if(this.startTime===null)return v.next(0);const{delay:ht,repeat:_t,repeatType:ft,repeatDelay:bt,onUpdate:xt}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,o):this.speed<0&&(this.startTime=Math.min(o-lt/this.speed,this.startTime)),c?this.currentTime=o:this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=Math.round(o-this.startTime)*this.speed;const St=this.currentTime-ht*(this.speed>=0?1:-1),wt=this.speed>=0?St<0:St>lt;this.currentTime=Math.max(St,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=lt);let Pt=this.currentTime,Rt=v;if(_t){const It=Math.min(this.currentTime,lt)/ut;let Nt=Math.floor(It),Vt=It%1;!Vt&&It>=1&&(Vt=1),Vt===1&&Nt--,Nt=Math.min(Nt,_t+1),Nt%2&&(ft==="reverse"?(Vt=1-Vt,bt&&(Vt-=bt/ut)):ft==="mirror"&&(Rt=b)),Pt=clamp(0,1,Vt)*ut}const kt=wt?{done:!1,value:it[0]}:Rt.next(Pt);tt&&(kt.value=tt(kt.value));let{done:Gt}=kt;!wt&&nt!==null&&(Gt=this.speed>=0?this.currentTime>=lt:this.currentTime<=0);const Dt=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&Gt);return Dt&&_!==void 0&&(kt.value=getFinalKeyframe(it,this.options,_)),xt&&xt(kt.value),Dt&&this.finish(),kt}get duration(){const{resolved:o}=this;return o?millisecondsToSeconds(o.calculatedDuration):0}get time(){return millisecondsToSeconds(this.currentTime)}set time(o){o=secondsToMilliseconds(o),this.currentTime=o,this.holdTime!==null||this.speed===0?this.holdTime=o:this.driver&&(this.startTime=this.driver.now()-o/this.speed)}get speed(){return this.playbackSpeed}set speed(o){const c=this.playbackSpeed!==o;this.playbackSpeed=o,c&&(this.time=millisecondsToSeconds(this.currentTime))}play(){if(this.resolver.isScheduled||this.resolver.resume(),!this._resolved){this.pendingPlayState="running";return}if(this.isStopped)return;const{driver:o=frameloopDriver,onPlay:c}=this.options;this.driver||(this.driver=o(_=>this.tick(_))),c&&c();const d=this.driver.now();this.holdTime!==null?this.startTime=d-this.holdTime:(!this.startTime||this.state==="finished")&&(this.startTime=d),this.state==="finished"&&this.updateFinishedPromise(),this.cancelTime=this.startTime,this.holdTime=null,this.state="running",this.driver.start()}pause(){var o;if(!this._resolved){this.pendingPlayState="paused";return}this.state="paused",this.holdTime=(o=this.currentTime)!==null&&o!==void 0?o:0}complete(){this.state!=="running"&&this.play(),this.pendingPlayState=this.state="finished",this.holdTime=null}finish(){this.teardown(),this.state="finished";const{onComplete:o}=this.options;o&&o()}cancel(){this.cancelTime!==null&&this.tick(this.cancelTime),this.teardown(),this.updateFinishedPromise()}teardown(){this.state="idle",this.stopDriver(),this.resolveFinishedPromise(),this.updateFinishedPromise(),this.startTime=this.cancelTime=null,this.resolver.cancel()}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(o){return this.startTime=0,this.tick(o,!0)}}function animateValue(h){return new MainThreadAnimation(h)}const isBezierDefinition=h=>Array.isArray(h)&&typeof h[0]=="number";function isWaapiSupportedEasing(h){return!!(!h||typeof h=="string"&&h in supportedWaapiEasing||isBezierDefinition(h)||Array.isArray(h)&&h.every(isWaapiSupportedEasing))}const cubicBezierAsString=([h,o,c,d])=>`cubic-bezier(${h}, ${o}, ${c}, ${d})`,supportedWaapiEasing={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:cubicBezierAsString([0,.65,.55,1]),circOut:cubicBezierAsString([.55,0,1,.45]),backIn:cubicBezierAsString([.31,.01,.66,-.59]),backOut:cubicBezierAsString([.33,1.53,.69,.99])};function mapEasingToNativeEasingWithDefault(h){return mapEasingToNativeEasing(h)||supportedWaapiEasing.easeOut}function mapEasingToNativeEasing(h){if(h)return isBezierDefinition(h)?cubicBezierAsString(h):Array.isArray(h)?h.map(mapEasingToNativeEasingWithDefault):supportedWaapiEasing[h]}function animateStyle(h,o,c,{delay:d=0,duration:_=300,repeat:v=0,repeatType:b="loop",ease:tt,times:it}={}){const nt={[o]:c};it&&(nt.offset=it);const lt=mapEasingToNativeEasing(tt);return Array.isArray(lt)&&(nt.easing=lt),h.animate(nt,{delay:d,duration:_,easing:Array.isArray(lt)?"linear":lt,fill:"both",iterations:v+1,direction:b==="reverse"?"alternate":"normal"})}const supportsWaapi=memo(()=>Object.hasOwnProperty.call(Element.prototype,"animate")),acceleratedValues=new Set(["opacity","clipPath","filter","transform"]),sampleDelta=10,maxDuration=2e4;function requiresPregeneratedKeyframes(h){return h.type==="spring"||h.name==="backgroundColor"||!isWaapiSupportedEasing(h.ease)}function pregenerateKeyframes(h,o){const c=new MainThreadAnimation({...o,keyframes:h,repeat:0,delay:0,isGenerator:!0});let d={done:!1,value:h[0]};const _=[];let v=0;for(;!d.done&&v<maxDuration;)d=c.sample(v),_.push(d.value),v+=sampleDelta;return{times:void 0,keyframes:_,duration:v-sampleDelta,ease:"linear"}}class AcceleratedAnimation extends BaseAnimation{constructor(o){super(o);const{name:c,motionValue:d,keyframes:_}=this.options;this.resolver=new DOMKeyframesResolver(_,(v,b)=>this.onKeyframesResolved(v,b),c,d),this.resolver.scheduleResolve()}initPlayback(o,c){var d;let{duration:_=300,times:v,ease:b,type:tt,motionValue:it,name:nt}=this.options;if(!(!((d=it.owner)===null||d===void 0)&&d.current))return!1;if(requiresPregeneratedKeyframes(this.options)){const{onComplete:ut,onUpdate:ht,motionValue:_t,...ft}=this.options,bt=pregenerateKeyframes(o,ft);o=bt.keyframes,o.length===1&&(o[1]=o[0]),_=bt.duration,v=bt.times,b=bt.ease,tt="keyframes"}const lt=animateStyle(it.owner.current,nt,o,{...this.options,duration:_,times:v,ease:b});return lt.startTime=time.now(),this.pendingTimeline?(lt.timeline=this.pendingTimeline,this.pendingTimeline=void 0):lt.onfinish=()=>{const{onComplete:ut}=this.options;it.set(getFinalKeyframe(o,this.options,c)),ut&&ut(),this.cancel(),this.resolveFinishedPromise()},{animation:lt,duration:_,times:v,type:tt,ease:b,keyframes:o}}get duration(){const{resolved:o}=this;if(!o)return 0;const{duration:c}=o;return millisecondsToSeconds(c)}get time(){const{resolved:o}=this;if(!o)return 0;const{animation:c}=o;return millisecondsToSeconds(c.currentTime||0)}set time(o){const{resolved:c}=this;if(!c)return;const{animation:d}=c;d.currentTime=secondsToMilliseconds(o)}get speed(){const{resolved:o}=this;if(!o)return 1;const{animation:c}=o;return c.playbackRate}set speed(o){const{resolved:c}=this;if(!c)return;const{animation:d}=c;d.playbackRate=o}get state(){const{resolved:o}=this;if(!o)return"idle";const{animation:c}=o;return c.playState}attachTimeline(o){if(!this._resolved)this.pendingTimeline=o;else{const{resolved:c}=this;if(!c)return noop;const{animation:d}=c;d.timeline=o,d.onfinish=null}return noop}play(){if(this.isStopped)return;const{resolved:o}=this;if(!o)return;const{animation:c}=o;c.playState==="finished"&&this.updateFinishedPromise(),c.play()}pause(){const{resolved:o}=this;if(!o)return;const{animation:c}=o;c.pause()}stop(){if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;const{resolved:o}=this;if(!o)return;const{animation:c,keyframes:d,duration:_,type:v,ease:b,times:tt}=o;if(!(c.playState==="idle"||c.playState==="finished")){if(this.time){const{motionValue:it,onUpdate:nt,onComplete:lt,...ut}=this.options,ht=new MainThreadAnimation({...ut,keyframes:d,duration:_,type:v,ease:b,times:tt,isGenerator:!0}),_t=secondsToMilliseconds(this.time);it.setWithVelocity(ht.sample(_t-sampleDelta).value,ht.sample(_t).value,sampleDelta)}this.cancel()}}complete(){const{resolved:o}=this;o&&o.animation.finish()}cancel(){const{resolved:o}=this;o&&o.animation.cancel()}static supports(o){const{motionValue:c,name:d,repeatDelay:_,repeatType:v,damping:b,type:tt}=o;return supportsWaapi()&&d&&acceleratedValues.has(d)&&c&&c.owner&&c.owner.current instanceof HTMLElement&&!c.owner.getProps().onUpdate&&!_&&v!=="mirror"&&b!==0&&tt!=="inertia"}}const animateMotionValue=(h,o,c,d={},_,v)=>b=>{const tt=getValueTransition(d,h)||{},it=tt.delay||d.delay||0;let{elapsed:nt=0}=d;nt=nt-secondsToMilliseconds(it);let lt={keyframes:Array.isArray(c)?c:[null,c],ease:"easeOut",velocity:o.getVelocity(),...tt,delay:-nt,onUpdate:ht=>{o.set(ht),tt.onUpdate&&tt.onUpdate(ht)},onComplete:()=>{b(),tt.onComplete&&tt.onComplete()},name:h,motionValue:o,element:v?void 0:_};isTransitionDefined(tt)||(lt={...lt,...getDefaultTransition(h,lt)}),lt.duration&&(lt.duration=secondsToMilliseconds(lt.duration)),lt.repeatDelay&&(lt.repeatDelay=secondsToMilliseconds(lt.repeatDelay)),lt.from!==void 0&&(lt.keyframes[0]=lt.from);let ut=!1;if((lt.type===!1||lt.duration===0&&!lt.repeatDelay)&&(lt.duration=0,lt.delay===0&&(ut=!0)),ut&&!v&&o.get()!==void 0){const ht=getFinalKeyframe(lt.keyframes,tt);if(ht!==void 0){frame.update(()=>{lt.onUpdate(ht),lt.onComplete()});return}}return!v&&AcceleratedAnimation.supports(lt)?new AcceleratedAnimation(lt):new MainThreadAnimation(lt)};function isWillChangeMotionValue(h){return!!(isMotionValue(h)&&h.add)}function addUniqueItem(h,o){h.indexOf(o)===-1&&h.push(o)}function removeItem(h,o){const c=h.indexOf(o);c>-1&&h.splice(c,1)}class SubscriptionManager{constructor(){this.subscriptions=[]}add(o){return addUniqueItem(this.subscriptions,o),()=>removeItem(this.subscriptions,o)}notify(o,c,d){const _=this.subscriptions.length;if(_)if(_===1)this.subscriptions[0](o,c,d);else for(let v=0;v<_;v++){const b=this.subscriptions[v];b&&b(o,c,d)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const MAX_VELOCITY_DELTA=30,isFloat=h=>!isNaN(parseFloat(h)),collectMotionValues={current:void 0};class MotionValue{constructor(o,c={}){this.version="11.1.9",this.canTrackVelocity=!1,this.events={},this.updateAndNotify=(d,_=!0)=>{const v=time.now();this.updatedAt!==v&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(d),this.current!==this.prev&&this.events.change&&this.events.change.notify(this.current),_&&this.events.renderRequest&&this.events.renderRequest.notify(this.current)},this.hasAnimated=!1,this.setCurrent(o),this.canTrackVelocity=isFloat(this.current),this.owner=c.owner}setCurrent(o){this.current=o,this.updatedAt=time.now()}setPrevFrameValue(o=this.current){this.prevFrameValue=o,this.prevUpdatedAt=this.updatedAt}onChange(o){return this.on("change",o)}on(o,c){this.events[o]||(this.events[o]=new SubscriptionManager);const d=this.events[o].add(c);return o==="change"?()=>{d(),frame.read(()=>{this.events.change.getSize()||this.stop()})}:d}clearListeners(){for(const o in this.events)this.events[o].clear()}attach(o,c){this.passiveEffect=o,this.stopPassiveEffect=c}set(o,c=!0){!c||!this.passiveEffect?this.updateAndNotify(o,c):this.passiveEffect(o,this.updateAndNotify)}setWithVelocity(o,c,d){this.set(c),this.prev=void 0,this.prevFrameValue=o,this.prevUpdatedAt=this.updatedAt-d}jump(o,c=!0){this.updateAndNotify(o),this.prev=o,this.prevUpdatedAt=this.prevFrameValue=void 0,c&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}get(){return collectMotionValues.current&&collectMotionValues.current.push(this),this.current}getPrevious(){return this.prev}getVelocity(){const o=time.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||o-this.updatedAt>MAX_VELOCITY_DELTA)return 0;const c=Math.min(this.updatedAt-this.prevUpdatedAt,MAX_VELOCITY_DELTA);return velocityPerSecond(parseFloat(this.current)-parseFloat(this.prevFrameValue),c)}start(o){return this.stop(),new Promise(c=>{this.hasAnimated=!0,this.animation=o(c),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function motionValue(h,o){return new MotionValue(h,o)}function setMotionValue(h,o,c){h.hasValue(o)?h.getValue(o).set(c):h.addValue(o,motionValue(c))}function setTarget(h,o){const c=resolveVariant(h,o);let{transitionEnd:d={},transition:_={},...v}=c||{};v={...v,...d};for(const b in v){const tt=resolveFinalValueInKeyframes(v[b]);setMotionValue(h,b,tt)}}function shouldBlockAnimation({protectedKeys:h,needsAnimating:o},c){const d=h.hasOwnProperty(c)&&o[c]!==!0;return o[c]=!1,d}function animateTarget(h,o,{delay:c=0,transitionOverride:d,type:_}={}){var v;let{transition:b=h.getDefaultTransition(),transitionEnd:tt,...it}=o;const nt=h.getValue("willChange");d&&(b=d);const lt=[],ut=_&&h.animationState&&h.animationState.getState()[_];for(const ht in it){const _t=h.getValue(ht,(v=h.latestValues[ht])!==null&&v!==void 0?v:null),ft=it[ht];if(ft===void 0||ut&&shouldBlockAnimation(ut,ht))continue;const bt={delay:c,elapsed:0,...getValueTransition(b||{},ht)};let xt=!1;if(window.HandoffAppearAnimations){const wt=h.getProps()[optimizedAppearDataAttribute];if(wt){const Pt=window.HandoffAppearAnimations(wt,ht);Pt!==null&&(bt.elapsed=Pt,xt=!0)}}_t.start(animateMotionValue(ht,_t,ft,h.shouldReduceMotion&&transformProps.has(ht)?{type:!1}:bt,h,xt));const St=_t.animation;St&&(isWillChangeMotionValue(nt)&&(nt.add(ht),St.then(()=>nt.remove(ht))),lt.push(St))}return tt&&Promise.all(lt).then(()=>{frame.update(()=>{tt&&setTarget(h,tt)})}),lt}function animateVariant(h,o,c={}){var d;const _=resolveVariant(h,o,c.type==="exit"?(d=h.presenceContext)===null||d===void 0?void 0:d.custom:void 0);let{transition:v=h.getDefaultTransition()||{}}=_||{};c.transitionOverride&&(v=c.transitionOverride);const b=_?()=>Promise.all(animateTarget(h,_,c)):()=>Promise.resolve(),tt=h.variantChildren&&h.variantChildren.size?(nt=0)=>{const{delayChildren:lt=0,staggerChildren:ut,staggerDirection:ht}=v;return animateChildren(h,o,lt+nt,ut,ht,c)}:()=>Promise.resolve(),{when:it}=v;if(it){const[nt,lt]=it==="beforeChildren"?[b,tt]:[tt,b];return nt().then(()=>lt())}else return Promise.all([b(),tt(c.delay)])}function animateChildren(h,o,c=0,d=0,_=1,v){const b=[],tt=(h.variantChildren.size-1)*d,it=_===1?(nt=0)=>nt*d:(nt=0)=>tt-nt*d;return Array.from(h.variantChildren).sort(sortByTreeOrder).forEach((nt,lt)=>{nt.notify("AnimationStart",o),b.push(animateVariant(nt,o,{...v,delay:c+it(lt)}).then(()=>nt.notify("AnimationComplete",o)))}),Promise.all(b)}function sortByTreeOrder(h,o){return h.sortNodePosition(o)}function animateVisualElement(h,o,c={}){h.notify("AnimationStart",o);let d;if(Array.isArray(o)){const _=o.map(v=>animateVariant(h,v,c));d=Promise.all(_)}else if(typeof o=="string")d=animateVariant(h,o,c);else{const _=typeof o=="function"?resolveVariant(h,o,c.custom):o;d=Promise.all(animateTarget(h,_,c))}return d.then(()=>{frame.postRender(()=>{h.notify("AnimationComplete",o)})})}const reversePriorityOrder=[...variantPriorityOrder].reverse(),numAnimationTypes=variantPriorityOrder.length;function animateList(h){return o=>Promise.all(o.map(({animation:c,options:d})=>animateVisualElement(h,c,d)))}function createAnimationState(h){let o=animateList(h);const c=createState();let d=!0;const _=it=>(nt,lt)=>{var ut;const ht=resolveVariant(h,lt,it==="exit"?(ut=h.presenceContext)===null||ut===void 0?void 0:ut.custom:void 0);if(ht){const{transition:_t,transitionEnd:ft,...bt}=ht;nt={...nt,...bt,...ft}}return nt};function v(it){o=it(h)}function b(it){const nt=h.getProps(),lt=h.getVariantContext(!0)||{},ut=[],ht=new Set;let _t={},ft=1/0;for(let xt=0;xt<numAnimationTypes;xt++){const St=reversePriorityOrder[xt],wt=c[St],Pt=nt[St]!==void 0?nt[St]:lt[St],Rt=isVariantLabel(Pt),kt=St===it?wt.isActive:null;kt===!1&&(ft=xt);let Gt=Pt===lt[St]&&Pt!==nt[St]&&Rt;if(Gt&&d&&h.manuallyAnimateOnMount&&(Gt=!1),wt.protectedKeys={..._t},!wt.isActive&&kt===null||!Pt&&!wt.prevProp||isAnimationControls(Pt)||typeof Pt=="boolean")continue;let Dt=checkVariantsDidChange(wt.prevProp,Pt)||St===it&&wt.isActive&&!Gt&&Rt||xt>ft&&Rt,It=!1;const Nt=Array.isArray(Pt)?Pt:[Pt];let Vt=Nt.reduce(_(St),{});kt===!1&&(Vt={});const{prevResolvedValues:Kt={}}=wt,Yt={...Kt,...Vt},nr=rr=>{Dt=!0,ht.has(rr)&&(It=!0,ht.delete(rr)),wt.needsAnimating[rr]=!0;const lr=h.getValue(rr);lr&&(lr.liveStyle=!1)};for(const rr in Yt){const lr=Vt[rr],or=Kt[rr];if(_t.hasOwnProperty(rr))continue;let pr=!1;isKeyframesTarget(lr)&&isKeyframesTarget(or)?pr=!shallowCompare(lr,or):pr=lr!==or,pr?lr!=null?nr(rr):ht.add(rr):lr!==void 0&&ht.has(rr)?nr(rr):wt.protectedKeys[rr]=!0}wt.prevProp=Pt,wt.prevResolvedValues=Vt,wt.isActive&&(_t={..._t,...Vt}),d&&h.blockInitialAnimation&&(Dt=!1),Dt&&(!Gt||It)&&ut.push(...Nt.map(rr=>({animation:rr,options:{type:St}})))}if(ht.size){const xt={};ht.forEach(St=>{const wt=h.getBaseTarget(St),Pt=h.getValue(St);Pt&&(Pt.liveStyle=!0),xt[St]=wt??null}),ut.push({animation:xt})}let bt=!!ut.length;return d&&(nt.initial===!1||nt.initial===nt.animate)&&!h.manuallyAnimateOnMount&&(bt=!1),d=!1,bt?o(ut):Promise.resolve()}function tt(it,nt){var lt;if(c[it].isActive===nt)return Promise.resolve();(lt=h.variantChildren)===null||lt===void 0||lt.forEach(ht=>{var _t;return(_t=ht.animationState)===null||_t===void 0?void 0:_t.setActive(it,nt)}),c[it].isActive=nt;const ut=b(it);for(const ht in c)c[ht].protectedKeys={};return ut}return{animateChanges:b,setActive:tt,setAnimateFunction:v,getState:()=>c}}function checkVariantsDidChange(h,o){return typeof o=="string"?o!==h:Array.isArray(o)?!shallowCompare(o,h):!1}function createTypeState(h=!1){return{isActive:h,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function createState(){return{animate:createTypeState(!0),whileInView:createTypeState(),whileHover:createTypeState(),whileTap:createTypeState(),whileDrag:createTypeState(),whileFocus:createTypeState(),exit:createTypeState()}}class AnimationFeature extends Feature{constructor(o){super(o),o.animationState||(o.animationState=createAnimationState(o))}updateAnimationControlsSubscription(){const{animate:o}=this.node.getProps();this.unmount(),isAnimationControls(o)&&(this.unmount=o.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:o}=this.node.getProps(),{animate:c}=this.node.prevProps||{};o!==c&&this.updateAnimationControlsSubscription()}unmount(){}}let id$1=0;class ExitAnimationFeature extends Feature{constructor(){super(...arguments),this.id=id$1++}update(){if(!this.node.presenceContext)return;const{isPresent:o,onExitComplete:c}=this.node.presenceContext,{isPresent:d}=this.node.prevPresenceContext||{};if(!this.node.animationState||o===d)return;const _=this.node.animationState.setActive("exit",!o);c&&!o&&_.then(()=>c(this.id))}mount(){const{register:o}=this.node.presenceContext||{};o&&(this.unmount=o(this.id))}unmount(){}}const animations={animation:{Feature:AnimationFeature},exit:{Feature:ExitAnimationFeature}},distance=(h,o)=>Math.abs(h-o);function distance2D(h,o){const c=distance(h.x,o.x),d=distance(h.y,o.y);return Math.sqrt(c**2+d**2)}class PanSession{constructor(o,c,{transformPagePoint:d,contextWindow:_,dragSnapToOrigin:v=!1}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const ut=getPanInfo(this.lastMoveEventInfo,this.history),ht=this.startEvent!==null,_t=distance2D(ut.offset,{x:0,y:0})>=3;if(!ht&&!_t)return;const{point:ft}=ut,{timestamp:bt}=frameData;this.history.push({...ft,timestamp:bt});const{onStart:xt,onMove:St}=this.handlers;ht||(xt&&xt(this.lastMoveEvent,ut),this.startEvent=this.lastMoveEvent),St&&St(this.lastMoveEvent,ut)},this.handlePointerMove=(ut,ht)=>{this.lastMoveEvent=ut,this.lastMoveEventInfo=transformPoint(ht,this.transformPagePoint),frame.update(this.updatePoint,!0)},this.handlePointerUp=(ut,ht)=>{this.end();const{onEnd:_t,onSessionEnd:ft,resumeAnimation:bt}=this.handlers;if(this.dragSnapToOrigin&&bt&&bt(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const xt=getPanInfo(ut.type==="pointercancel"?this.lastMoveEventInfo:transformPoint(ht,this.transformPagePoint),this.history);this.startEvent&&_t&&_t(ut,xt),ft&&ft(ut,xt)},!isPrimaryPointer(o))return;this.dragSnapToOrigin=v,this.handlers=c,this.transformPagePoint=d,this.contextWindow=_||window;const b=extractEventInfo(o),tt=transformPoint(b,this.transformPagePoint),{point:it}=tt,{timestamp:nt}=frameData;this.history=[{...it,timestamp:nt}];const{onSessionStart:lt}=c;lt&&lt(o,getPanInfo(tt,this.history)),this.removeListeners=pipe(addPointerEvent(this.contextWindow,"pointermove",this.handlePointerMove),addPointerEvent(this.contextWindow,"pointerup",this.handlePointerUp),addPointerEvent(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(o){this.handlers=o}end(){this.removeListeners&&this.removeListeners(),cancelFrame(this.updatePoint)}}function transformPoint(h,o){return o?{point:o(h.point)}:h}function subtractPoint(h,o){return{x:h.x-o.x,y:h.y-o.y}}function getPanInfo({point:h},o){return{point:h,delta:subtractPoint(h,lastDevicePoint(o)),offset:subtractPoint(h,startDevicePoint(o)),velocity:getVelocity(o,.1)}}function startDevicePoint(h){return h[0]}function lastDevicePoint(h){return h[h.length-1]}function getVelocity(h,o){if(h.length<2)return{x:0,y:0};let c=h.length-1,d=null;const _=lastDevicePoint(h);for(;c>=0&&(d=h[c],!(_.timestamp-d.timestamp>secondsToMilliseconds(o)));)c--;if(!d)return{x:0,y:0};const v=millisecondsToSeconds(_.timestamp-d.timestamp);if(v===0)return{x:0,y:0};const b={x:(_.x-d.x)/v,y:(_.y-d.y)/v};return b.x===1/0&&(b.x=0),b.y===1/0&&(b.y=0),b}function calcLength(h){return h.max-h.min}function isNear(h,o=0,c=.01){return Math.abs(h-o)<=c}function calcAxisDelta(h,o,c,d=.5){h.origin=d,h.originPoint=mixNumber$1(o.min,o.max,h.origin),h.scale=calcLength(c)/calcLength(o),(isNear(h.scale,1,1e-4)||isNaN(h.scale))&&(h.scale=1),h.translate=mixNumber$1(c.min,c.max,h.origin)-h.originPoint,(isNear(h.translate)||isNaN(h.translate))&&(h.translate=0)}function calcBoxDelta(h,o,c,d){calcAxisDelta(h.x,o.x,c.x,d?d.originX:void 0),calcAxisDelta(h.y,o.y,c.y,d?d.originY:void 0)}function calcRelativeAxis(h,o,c){h.min=c.min+o.min,h.max=h.min+calcLength(o)}function calcRelativeBox(h,o,c){calcRelativeAxis(h.x,o.x,c.x),calcRelativeAxis(h.y,o.y,c.y)}function calcRelativeAxisPosition(h,o,c){h.min=o.min-c.min,h.max=h.min+calcLength(o)}function calcRelativePosition(h,o,c){calcRelativeAxisPosition(h.x,o.x,c.x),calcRelativeAxisPosition(h.y,o.y,c.y)}function applyConstraints(h,{min:o,max:c},d){return o!==void 0&&h<o?h=d?mixNumber$1(o,h,d.min):Math.max(h,o):c!==void 0&&h>c&&(h=d?mixNumber$1(c,h,d.max):Math.min(h,c)),h}function calcRelativeAxisConstraints(h,o,c){return{min:o!==void 0?h.min+o:void 0,max:c!==void 0?h.max+c-(h.max-h.min):void 0}}function calcRelativeConstraints(h,{top:o,left:c,bottom:d,right:_}){return{x:calcRelativeAxisConstraints(h.x,c,_),y:calcRelativeAxisConstraints(h.y,o,d)}}function calcViewportAxisConstraints(h,o){let c=o.min-h.min,d=o.max-h.max;return o.max-o.min<h.max-h.min&&([c,d]=[d,c]),{min:c,max:d}}function calcViewportConstraints(h,o){return{x:calcViewportAxisConstraints(h.x,o.x),y:calcViewportAxisConstraints(h.y,o.y)}}function calcOrigin(h,o){let c=.5;const d=calcLength(h),_=calcLength(o);return _>d?c=progress(o.min,o.max-d,h.min):d>_&&(c=progress(h.min,h.max-_,o.min)),clamp(0,1,c)}function rebaseAxisConstraints(h,o){const c={};return o.min!==void 0&&(c.min=o.min-h.min),o.max!==void 0&&(c.max=o.max-h.min),c}const defaultElastic=.35;function resolveDragElastic(h=defaultElastic){return h===!1?h=0:h===!0&&(h=defaultElastic),{x:resolveAxisElastic(h,"left","right"),y:resolveAxisElastic(h,"top","bottom")}}function resolveAxisElastic(h,o,c){return{min:resolvePointElastic(h,o),max:resolvePointElastic(h,c)}}function resolvePointElastic(h,o){return typeof h=="number"?h:h[o]||0}const createAxisDelta=()=>({translate:0,scale:1,origin:0,originPoint:0}),createDelta=()=>({x:createAxisDelta(),y:createAxisDelta()}),createAxis=()=>({min:0,max:0}),createBox=()=>({x:createAxis(),y:createAxis()});function eachAxis(h){return[h("x"),h("y")]}function convertBoundingBoxToBox({top:h,left:o,right:c,bottom:d}){return{x:{min:o,max:c},y:{min:h,max:d}}}function convertBoxToBoundingBox({x:h,y:o}){return{top:o.min,right:h.max,bottom:o.max,left:h.min}}function transformBoxPoints(h,o){if(!o)return h;const c=o({x:h.left,y:h.top}),d=o({x:h.right,y:h.bottom});return{top:c.y,left:c.x,bottom:d.y,right:d.x}}function isIdentityScale(h){return h===void 0||h===1}function hasScale({scale:h,scaleX:o,scaleY:c}){return!isIdentityScale(h)||!isIdentityScale(o)||!isIdentityScale(c)}function hasTransform(h){return hasScale(h)||has2DTranslate(h)||h.z||h.rotate||h.rotateX||h.rotateY||h.skewX||h.skewY}function has2DTranslate(h){return is2DTranslate(h.x)||is2DTranslate(h.y)}function is2DTranslate(h){return h&&h!=="0%"}function scalePoint(h,o,c){const d=h-c,_=o*d;return c+_}function applyPointDelta(h,o,c,d,_){return _!==void 0&&(h=scalePoint(h,_,d)),scalePoint(h,c,d)+o}function applyAxisDelta(h,o=0,c=1,d,_){h.min=applyPointDelta(h.min,o,c,d,_),h.max=applyPointDelta(h.max,o,c,d,_)}function applyBoxDelta(h,{x:o,y:c}){applyAxisDelta(h.x,o.translate,o.scale,o.originPoint),applyAxisDelta(h.y,c.translate,c.scale,c.originPoint)}function applyTreeDeltas(h,o,c,d=!1){const _=c.length;if(!_)return;o.x=o.y=1;let v,b;for(let tt=0;tt<_;tt++){v=c[tt],b=v.projectionDelta;const it=v.instance;it&&it.style&&it.style.display==="contents"||(d&&v.options.layoutScroll&&v.scroll&&v!==v.root&&transformBox(h,{x:-v.scroll.offset.x,y:-v.scroll.offset.y}),b&&(o.x*=b.x.scale,o.y*=b.y.scale,applyBoxDelta(h,b)),d&&hasTransform(v.latestValues)&&transformBox(h,v.latestValues))}o.x=snapToDefault(o.x),o.y=snapToDefault(o.y)}function snapToDefault(h){return Number.isInteger(h)||h>1.0000000000001||h<.999999999999?h:1}function translateAxis(h,o){h.min=h.min+o,h.max=h.max+o}function transformAxis(h,o,[c,d,_]){const v=o[_]!==void 0?o[_]:.5,b=mixNumber$1(h.min,h.max,v);applyAxisDelta(h,o[c],o[d],b,o.scale)}const xKeys$1=["x","scaleX","originX"],yKeys$1=["y","scaleY","originY"];function transformBox(h,o){transformAxis(h.x,o,xKeys$1),transformAxis(h.y,o,yKeys$1)}function measureViewportBox(h,o){return convertBoundingBoxToBox(transformBoxPoints(h.getBoundingClientRect(),o))}function measurePageBox(h,o,c){const d=measureViewportBox(h,c),{scroll:_}=o;return _&&(translateAxis(d.x,_.offset.x),translateAxis(d.y,_.offset.y)),d}const getContextWindow=({current:h})=>h?h.ownerDocument.defaultView:null,elementDragControls=new WeakMap;class VisualElementDragControls{constructor(o){this.openGlobalLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=createBox(),this.visualElement=o}start(o,{snapToCursor:c=!1}={}){const{presenceContext:d}=this.visualElement;if(d&&d.isPresent===!1)return;const _=lt=>{const{dragSnapToOrigin:ut}=this.getProps();ut?this.pauseAnimation():this.stopAnimation(),c&&this.snapToCursor(extractEventInfo(lt,"page").point)},v=(lt,ut)=>{const{drag:ht,dragPropagation:_t,onDragStart:ft}=this.getProps();if(ht&&!_t&&(this.openGlobalLock&&this.openGlobalLock(),this.openGlobalLock=getGlobalLock(ht),!this.openGlobalLock))return;this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),eachAxis(xt=>{let St=this.getAxisMotionValue(xt).get()||0;if(percent.test(St)){const{projection:wt}=this.visualElement;if(wt&&wt.layout){const Pt=wt.layout.layoutBox[xt];Pt&&(St=calcLength(Pt)*(parseFloat(St)/100))}}this.originPoint[xt]=St}),ft&&frame.postRender(()=>ft(lt,ut));const{animationState:bt}=this.visualElement;bt&&bt.setActive("whileDrag",!0)},b=(lt,ut)=>{const{dragPropagation:ht,dragDirectionLock:_t,onDirectionLock:ft,onDrag:bt}=this.getProps();if(!ht&&!this.openGlobalLock)return;const{offset:xt}=ut;if(_t&&this.currentDirection===null){this.currentDirection=getCurrentDirection(xt),this.currentDirection!==null&&ft&&ft(this.currentDirection);return}this.updateAxis("x",ut.point,xt),this.updateAxis("y",ut.point,xt),this.visualElement.render(),bt&&bt(lt,ut)},tt=(lt,ut)=>this.stop(lt,ut),it=()=>eachAxis(lt=>{var ut;return this.getAnimationState(lt)==="paused"&&((ut=this.getAxisMotionValue(lt).animation)===null||ut===void 0?void 0:ut.play())}),{dragSnapToOrigin:nt}=this.getProps();this.panSession=new PanSession(o,{onSessionStart:_,onStart:v,onMove:b,onSessionEnd:tt,resumeAnimation:it},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:nt,contextWindow:getContextWindow(this.visualElement)})}stop(o,c){const d=this.isDragging;if(this.cancel(),!d)return;const{velocity:_}=c;this.startAnimation(_);const{onDragEnd:v}=this.getProps();v&&frame.postRender(()=>v(o,c))}cancel(){this.isDragging=!1;const{projection:o,animationState:c}=this.visualElement;o&&(o.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:d}=this.getProps();!d&&this.openGlobalLock&&(this.openGlobalLock(),this.openGlobalLock=null),c&&c.setActive("whileDrag",!1)}updateAxis(o,c,d){const{drag:_}=this.getProps();if(!d||!shouldDrag(o,_,this.currentDirection))return;const v=this.getAxisMotionValue(o);let b=this.originPoint[o]+d[o];this.constraints&&this.constraints[o]&&(b=applyConstraints(b,this.constraints[o],this.elastic[o])),v.set(b)}resolveConstraints(){var o;const{dragConstraints:c,dragElastic:d}=this.getProps(),_=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):(o=this.visualElement.projection)===null||o===void 0?void 0:o.layout,v=this.constraints;c&&isRefObject(c)?this.constraints||(this.constraints=this.resolveRefConstraints()):c&&_?this.constraints=calcRelativeConstraints(_.layoutBox,c):this.constraints=!1,this.elastic=resolveDragElastic(d),v!==this.constraints&&_&&this.constraints&&!this.hasMutatedConstraints&&eachAxis(b=>{this.constraints!==!1&&this.getAxisMotionValue(b)&&(this.constraints[b]=rebaseAxisConstraints(_.layoutBox[b],this.constraints[b]))})}resolveRefConstraints(){const{dragConstraints:o,onMeasureDragConstraints:c}=this.getProps();if(!o||!isRefObject(o))return!1;const d=o.current,{projection:_}=this.visualElement;if(!_||!_.layout)return!1;const v=measurePageBox(d,_.root,this.visualElement.getTransformPagePoint());let b=calcViewportConstraints(_.layout.layoutBox,v);if(c){const tt=c(convertBoxToBoundingBox(b));this.hasMutatedConstraints=!!tt,tt&&(b=convertBoundingBoxToBox(tt))}return b}startAnimation(o){const{drag:c,dragMomentum:d,dragElastic:_,dragTransition:v,dragSnapToOrigin:b,onDragTransitionEnd:tt}=this.getProps(),it=this.constraints||{},nt=eachAxis(lt=>{if(!shouldDrag(lt,c,this.currentDirection))return;let ut=it&&it[lt]||{};b&&(ut={min:0,max:0});const ht=_?200:1e6,_t=_?40:1e7,ft={type:"inertia",velocity:d?o[lt]:0,bounceStiffness:ht,bounceDamping:_t,timeConstant:750,restDelta:1,restSpeed:10,...v,...ut};return this.startAxisValueAnimation(lt,ft)});return Promise.all(nt).then(tt)}startAxisValueAnimation(o,c){const d=this.getAxisMotionValue(o);return d.start(animateMotionValue(o,d,0,c,this.visualElement))}stopAnimation(){eachAxis(o=>this.getAxisMotionValue(o).stop())}pauseAnimation(){eachAxis(o=>{var c;return(c=this.getAxisMotionValue(o).animation)===null||c===void 0?void 0:c.pause()})}getAnimationState(o){var c;return(c=this.getAxisMotionValue(o).animation)===null||c===void 0?void 0:c.state}getAxisMotionValue(o){const c=`_drag${o.toUpperCase()}`,d=this.visualElement.getProps();return d[c]||this.visualElement.getValue(o,(d.initial?d.initial[o]:void 0)||0)}snapToCursor(o){eachAxis(c=>{const{drag:d}=this.getProps();if(!shouldDrag(c,d,this.currentDirection))return;const{projection:_}=this.visualElement,v=this.getAxisMotionValue(c);if(_&&_.layout){const{min:b,max:tt}=_.layout.layoutBox[c];v.set(o[c]-mixNumber$1(b,tt,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:o,dragConstraints:c}=this.getProps(),{projection:d}=this.visualElement;if(!isRefObject(c)||!d||!this.constraints)return;this.stopAnimation();const _={x:0,y:0};eachAxis(b=>{const tt=this.getAxisMotionValue(b);if(tt&&this.constraints!==!1){const it=tt.get();_[b]=calcOrigin({min:it,max:it},this.constraints[b])}});const{transformTemplate:v}=this.visualElement.getProps();this.visualElement.current.style.transform=v?v({},""):"none",d.root&&d.root.updateScroll(),d.updateLayout(),this.resolveConstraints(),eachAxis(b=>{if(!shouldDrag(b,o,null))return;const tt=this.getAxisMotionValue(b),{min:it,max:nt}=this.constraints[b];tt.set(mixNumber$1(it,nt,_[b]))})}addListeners(){if(!this.visualElement.current)return;elementDragControls.set(this.visualElement,this);const o=this.visualElement.current,c=addPointerEvent(o,"pointerdown",it=>{const{drag:nt,dragListener:lt=!0}=this.getProps();nt&&lt&&this.start(it)}),d=()=>{const{dragConstraints:it}=this.getProps();isRefObject(it)&&(this.constraints=this.resolveRefConstraints())},{projection:_}=this.visualElement,v=_.addEventListener("measure",d);_&&!_.layout&&(_.root&&_.root.updateScroll(),_.updateLayout()),d();const b=addDomEvent(window,"resize",()=>this.scalePositionWithinConstraints()),tt=_.addEventListener("didUpdate",({delta:it,hasLayoutChanged:nt})=>{this.isDragging&&nt&&(eachAxis(lt=>{const ut=this.getAxisMotionValue(lt);ut&&(this.originPoint[lt]+=it[lt].translate,ut.set(ut.get()+it[lt].translate))}),this.visualElement.render())});return()=>{b(),c(),v(),tt&&tt()}}getProps(){const o=this.visualElement.getProps(),{drag:c=!1,dragDirectionLock:d=!1,dragPropagation:_=!1,dragConstraints:v=!1,dragElastic:b=defaultElastic,dragMomentum:tt=!0}=o;return{...o,drag:c,dragDirectionLock:d,dragPropagation:_,dragConstraints:v,dragElastic:b,dragMomentum:tt}}}function shouldDrag(h,o,c){return(o===!0||o===h)&&(c===null||c===h)}function getCurrentDirection(h,o=10){let c=null;return Math.abs(h.y)>o?c="y":Math.abs(h.x)>o&&(c="x"),c}class DragGesture extends Feature{constructor(o){super(o),this.removeGroupControls=noop,this.removeListeners=noop,this.controls=new VisualElementDragControls(o)}mount(){const{dragControls:o}=this.node.getProps();o&&(this.removeGroupControls=o.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||noop}unmount(){this.removeGroupControls(),this.removeListeners()}}const asyncHandler=h=>(o,c)=>{h&&frame.postRender(()=>h(o,c))};class PanGesture extends Feature{constructor(){super(...arguments),this.removePointerDownListener=noop}onPointerDown(o){this.session=new PanSession(o,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:getContextWindow(this.node)})}createPanHandlers(){const{onPanSessionStart:o,onPanStart:c,onPan:d,onPanEnd:_}=this.node.getProps();return{onSessionStart:asyncHandler(o),onStart:asyncHandler(c),onMove:d,onEnd:(v,b)=>{delete this.session,_&&frame.postRender(()=>_(v,b))}}}mount(){this.removePointerDownListener=addPointerEvent(this.node.current,"pointerdown",o=>this.onPointerDown(o))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}function usePresence(){const h=reactExports.useContext(PresenceContext);if(h===null)return[!0,null];const{isPresent:o,onExitComplete:c,register:d}=h,_=reactExports.useId();return reactExports.useEffect(()=>d(_),[]),!o&&c?[!1,()=>c&&c(_)]:[!0]}const globalProjectionState={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function pixelsToPercent(h,o){return o.max===o.min?0:h/(o.max-o.min)*100}const correctBorderRadius={correct:(h,o)=>{if(!o.target)return h;if(typeof h=="string")if(px.test(h))h=parseFloat(h);else return h;const c=pixelsToPercent(h,o.target.x),d=pixelsToPercent(h,o.target.y);return`${c}% ${d}%`}},correctBoxShadow={correct:(h,{treeScale:o,projectionDelta:c})=>{const d=h,_=complex.parse(h);if(_.length>5)return d;const v=complex.createTransformer(h),b=typeof _[0]!="number"?1:0,tt=c.x.scale*o.x,it=c.y.scale*o.y;_[0+b]/=tt,_[1+b]/=it;const nt=mixNumber$1(tt,it,.5);return typeof _[2+b]=="number"&&(_[2+b]/=nt),typeof _[3+b]=="number"&&(_[3+b]/=nt),v(_)}};class MeasureLayoutWithContext extends reactExports.Component{componentDidMount(){const{visualElement:o,layoutGroup:c,switchLayoutGroup:d,layoutId:_}=this.props,{projection:v}=o;addScaleCorrector(defaultScaleCorrectors),v&&(c.group&&c.group.add(v),d&&d.register&&_&&d.register(v),v.root.didUpdate(),v.addEventListener("animationComplete",()=>{this.safeToRemove()}),v.setOptions({...v.options,onExitComplete:()=>this.safeToRemove()})),globalProjectionState.hasEverUpdated=!0}getSnapshotBeforeUpdate(o){const{layoutDependency:c,visualElement:d,drag:_,isPresent:v}=this.props,b=d.projection;return b&&(b.isPresent=v,_||o.layoutDependency!==c||c===void 0?b.willUpdate():this.safeToRemove(),o.isPresent!==v&&(v?b.promote():b.relegate()||frame.postRender(()=>{const tt=b.getStack();(!tt||!tt.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:o}=this.props.visualElement;o&&(o.root.didUpdate(),microtask.postRender(()=>{!o.currentAnimation&&o.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:o,layoutGroup:c,switchLayoutGroup:d}=this.props,{projection:_}=o;_&&(_.scheduleCheckAfterUnmount(),c&&c.group&&c.group.remove(_),d&&d.deregister&&d.deregister(_))}safeToRemove(){const{safeToRemove:o}=this.props;o&&o()}render(){return null}}function MeasureLayout(h){const[o,c]=usePresence(),d=reactExports.useContext(LayoutGroupContext);return jsxRuntimeExports.jsx(MeasureLayoutWithContext,{...h,layoutGroup:d,switchLayoutGroup:reactExports.useContext(SwitchLayoutGroupContext),isPresent:o,safeToRemove:c})}const defaultScaleCorrectors={borderRadius:{...correctBorderRadius,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:correctBorderRadius,borderTopRightRadius:correctBorderRadius,borderBottomLeftRadius:correctBorderRadius,borderBottomRightRadius:correctBorderRadius,boxShadow:correctBoxShadow},borders=["TopLeft","TopRight","BottomLeft","BottomRight"],numBorders=borders.length,asNumber=h=>typeof h=="string"?parseFloat(h):h,isPx=h=>typeof h=="number"||px.test(h);function mixValues(h,o,c,d,_,v){_?(h.opacity=mixNumber$1(0,c.opacity!==void 0?c.opacity:1,easeCrossfadeIn(d)),h.opacityExit=mixNumber$1(o.opacity!==void 0?o.opacity:1,0,easeCrossfadeOut(d))):v&&(h.opacity=mixNumber$1(o.opacity!==void 0?o.opacity:1,c.opacity!==void 0?c.opacity:1,d));for(let b=0;b<numBorders;b++){const tt=`border${borders[b]}Radius`;let it=getRadius(o,tt),nt=getRadius(c,tt);it===void 0&&nt===void 0||(it||(it=0),nt||(nt=0),it===0||nt===0||isPx(it)===isPx(nt)?(h[tt]=Math.max(mixNumber$1(asNumber(it),asNumber(nt),d),0),(percent.test(nt)||percent.test(it))&&(h[tt]+="%")):h[tt]=nt)}(o.rotate||c.rotate)&&(h.rotate=mixNumber$1(o.rotate||0,c.rotate||0,d))}function getRadius(h,o){return h[o]!==void 0?h[o]:h.borderRadius}const easeCrossfadeIn=compress(0,.5,circOut),easeCrossfadeOut=compress(.5,.95,noop);function compress(h,o,c){return d=>d<h?0:d>o?1:c(progress(h,o,d))}function copyAxisInto(h,o){h.min=o.min,h.max=o.max}function copyBoxInto(h,o){copyAxisInto(h.x,o.x),copyAxisInto(h.y,o.y)}function removePointDelta(h,o,c,d,_){return h-=o,h=scalePoint(h,1/c,d),_!==void 0&&(h=scalePoint(h,1/_,d)),h}function removeAxisDelta(h,o=0,c=1,d=.5,_,v=h,b=h){if(percent.test(o)&&(o=parseFloat(o),o=mixNumber$1(b.min,b.max,o/100)-b.min),typeof o!="number")return;let tt=mixNumber$1(v.min,v.max,d);h===v&&(tt-=o),h.min=removePointDelta(h.min,o,c,tt,_),h.max=removePointDelta(h.max,o,c,tt,_)}function removeAxisTransforms(h,o,[c,d,_],v,b){removeAxisDelta(h,o[c],o[d],o[_],o.scale,v,b)}const xKeys=["x","scaleX","originX"],yKeys=["y","scaleY","originY"];function removeBoxTransforms(h,o,c,d){removeAxisTransforms(h.x,o,xKeys,c?c.x:void 0,d?d.x:void 0),removeAxisTransforms(h.y,o,yKeys,c?c.y:void 0,d?d.y:void 0)}function isAxisDeltaZero(h){return h.translate===0&&h.scale===1}function isDeltaZero(h){return isAxisDeltaZero(h.x)&&isAxisDeltaZero(h.y)}function boxEquals(h,o){return h.x.min===o.x.min&&h.x.max===o.x.max&&h.y.min===o.y.min&&h.y.max===o.y.max}function boxEqualsRounded(h,o){return Math.round(h.x.min)===Math.round(o.x.min)&&Math.round(h.x.max)===Math.round(o.x.max)&&Math.round(h.y.min)===Math.round(o.y.min)&&Math.round(h.y.max)===Math.round(o.y.max)}function aspectRatio(h){return calcLength(h.x)/calcLength(h.y)}class NodeStack{constructor(){this.members=[]}add(o){addUniqueItem(this.members,o),o.scheduleRender()}remove(o){if(removeItem(this.members,o),o===this.prevLead&&(this.prevLead=void 0),o===this.lead){const c=this.members[this.members.length-1];c&&this.promote(c)}}relegate(o){const c=this.members.findIndex(_=>o===_);if(c===0)return!1;let d;for(let _=c;_>=0;_--){const v=this.members[_];if(v.isPresent!==!1){d=v;break}}return d?(this.promote(d),!0):!1}promote(o,c){const d=this.lead;if(o!==d&&(this.prevLead=d,this.lead=o,o.show(),d)){d.instance&&d.scheduleRender(),o.scheduleRender(),o.resumeFrom=d,c&&(o.resumeFrom.preserveOpacity=!0),d.snapshot&&(o.snapshot=d.snapshot,o.snapshot.latestValues=d.animationValues||d.latestValues),o.root&&o.root.isUpdating&&(o.isLayoutDirty=!0);const{crossfade:_}=o.options;_===!1&&d.hide()}}exitAnimationComplete(){this.members.forEach(o=>{const{options:c,resumingFrom:d}=o;c.onExitComplete&&c.onExitComplete(),d&&d.options.onExitComplete&&d.options.onExitComplete()})}scheduleRender(){this.members.forEach(o=>{o.instance&&o.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function buildProjectionTransform(h,o,c){let d="";const _=h.x.translate/o.x,v=h.y.translate/o.y,b=(c==null?void 0:c.z)||0;if((_||v||b)&&(d=`translate3d(${_}px, ${v}px, ${b}px) `),(o.x!==1||o.y!==1)&&(d+=`scale(${1/o.x}, ${1/o.y}) `),c){const{transformPerspective:nt,rotate:lt,rotateX:ut,rotateY:ht,skewX:_t,skewY:ft}=c;nt&&(d=`perspective(${nt}px) ${d}`),lt&&(d+=`rotate(${lt}deg) `),ut&&(d+=`rotateX(${ut}deg) `),ht&&(d+=`rotateY(${ht}deg) `),_t&&(d+=`skewX(${_t}deg) `),ft&&(d+=`skewY(${ft}deg) `)}const tt=h.x.scale*o.x,it=h.y.scale*o.y;return(tt!==1||it!==1)&&(d+=`scale(${tt}, ${it})`),d||"none"}const compareByDepth=(h,o)=>h.depth-o.depth;class FlatTree{constructor(){this.children=[],this.isDirty=!1}add(o){addUniqueItem(this.children,o),this.isDirty=!0}remove(o){removeItem(this.children,o),this.isDirty=!0}forEach(o){this.isDirty&&this.children.sort(compareByDepth),this.isDirty=!1,this.children.forEach(o)}}function delay(h,o){const c=time.now(),d=({timestamp:_})=>{const v=_-c;v>=o&&(cancelFrame(d),h(v-o))};return frame.read(d,!0),()=>cancelFrame(d)}function record(h){window.MotionDebug&&window.MotionDebug.record(h)}function isSVGElement(h){return h instanceof SVGElement&&h.tagName!=="svg"}function animateSingleValue(h,o,c){const d=isMotionValue(h)?h:motionValue(h);return d.start(animateMotionValue("",d,o,c)),d.animation}const transformAxes=["","X","Y","Z"],hiddenVisibility={visibility:"hidden"},animationTarget=1e3;let id=0;const projectionFrameData={type:"projectionFrame",totalNodes:0,resolvedTargetDeltas:0,recalculatedProjection:0};function resetDistortingTransform(h,o,c,d){const{latestValues:_}=o;_[h]&&(c[h]=_[h],o.setStaticValue(h,0),d&&(d[h]=0))}function createProjectionNode({attachResizeListener:h,defaultParent:o,measureScroll:c,checkIsScrollRoot:d,resetTransform:_}){return class{constructor(v={},b=o==null?void 0:o()){this.id=id++,this.animationId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,projectionFrameData.totalNodes=projectionFrameData.resolvedTargetDeltas=projectionFrameData.recalculatedProjection=0,this.nodes.forEach(propagateDirtyNodes),this.nodes.forEach(resolveTargetDelta),this.nodes.forEach(calcProjection),this.nodes.forEach(cleanDirtyNodes),record(projectionFrameData)},this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=v,this.root=b?b.root||b:this,this.path=b?[...b.path,b]:[],this.parent=b,this.depth=b?b.depth+1:0;for(let tt=0;tt<this.path.length;tt++)this.path[tt].shouldResetTransform=!0;this.root===this&&(this.nodes=new FlatTree)}addEventListener(v,b){return this.eventHandlers.has(v)||this.eventHandlers.set(v,new SubscriptionManager),this.eventHandlers.get(v).add(b)}notifyListeners(v,...b){const tt=this.eventHandlers.get(v);tt&&tt.notify(...b)}hasListeners(v){return this.eventHandlers.has(v)}mount(v,b=this.root.hasTreeAnimated){if(this.instance)return;this.isSVG=isSVGElement(v),this.instance=v;const{layoutId:tt,layout:it,visualElement:nt}=this.options;if(nt&&!nt.current&&nt.mount(v),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),b&&(it||tt)&&(this.isLayoutDirty=!0),h){let lt;const ut=()=>this.root.updateBlockedByResize=!1;h(v,()=>{this.root.updateBlockedByResize=!0,lt&&lt(),lt=delay(ut,250),globalProjectionState.hasAnimatedSinceResize&&(globalProjectionState.hasAnimatedSinceResize=!1,this.nodes.forEach(finishAnimation))})}tt&&this.root.registerSharedNode(tt,this),this.options.animate!==!1&&nt&&(tt||it)&&this.addEventListener("didUpdate",({delta:lt,hasLayoutChanged:ut,hasRelativeTargetChanged:ht,layout:_t})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const ft=this.options.transition||nt.getDefaultTransition()||defaultLayoutTransition,{onLayoutAnimationStart:bt,onLayoutAnimationComplete:xt}=nt.getProps(),St=!this.targetLayout||!boxEqualsRounded(this.targetLayout,_t)||ht,wt=!ut&&ht;if(this.options.layoutRoot||this.resumeFrom&&this.resumeFrom.instance||wt||ut&&(St||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0),this.setAnimationOrigin(lt,wt);const Pt={...getValueTransition(ft,"layout"),onPlay:bt,onComplete:xt};(nt.shouldReduceMotion||this.options.layoutRoot)&&(Pt.delay=0,Pt.type=!1),this.startAnimation(Pt)}else ut||finishAnimation(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=_t})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const v=this.getStack();v&&v.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,cancelFrame(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(resetSkewAndRotation),this.animationId++)}getTransformTemplate(){const{visualElement:v}=this.options;return v&&v.getProps().transformTemplate}willUpdate(v=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let nt=0;nt<this.path.length;nt++){const lt=this.path[nt];lt.shouldResetTransform=!0,lt.updateScroll("snapshot"),lt.options.layoutRoot&&lt.willUpdate(!1)}const{layoutId:b,layout:tt}=this.options;if(b===void 0&&!tt)return;const it=this.getTransformTemplate();this.prevTransformTemplateValue=it?it(this.latestValues,""):void 0,this.updateSnapshot(),v&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(clearMeasurements);return}this.isUpdating||this.nodes.forEach(clearIsLayoutDirty),this.isUpdating=!1,window.HandoffCancelAllAnimations&&window.HandoffCancelAllAnimations(),this.nodes.forEach(resetTransformStyle),this.nodes.forEach(updateLayout),this.nodes.forEach(notifyLayoutUpdate),this.clearAllSnapshots();const v=time.now();frameData.delta=clamp(0,1e3/60,v-frameData.timestamp),frameData.timestamp=v,frameData.isProcessing=!0,steps.update.process(frameData),steps.preRender.process(frameData),steps.render.process(frameData),frameData.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,microtask.read(()=>this.update()))}clearAllSnapshots(){this.nodes.forEach(clearSnapshot),this.sharedNodes.forEach(removeLeadSnapshots)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,frame.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){frame.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure())}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let tt=0;tt<this.path.length;tt++)this.path[tt].updateScroll();const v=this.layout;this.layout=this.measure(!1),this.layoutCorrected=createBox(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:b}=this.options;b&&b.notify("LayoutMeasure",this.layout.layoutBox,v?v.layoutBox:void 0)}updateScroll(v="measure"){let b=!!(this.options.layoutScroll&&this.instance);this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===v&&(b=!1),b&&(this.scroll={animationId:this.root.animationId,phase:v,isRoot:d(this.instance),offset:c(this.instance)})}resetTransform(){if(!_)return;const v=this.isLayoutDirty||this.shouldResetTransform,b=this.projectionDelta&&!isDeltaZero(this.projectionDelta),tt=this.getTransformTemplate(),it=tt?tt(this.latestValues,""):void 0,nt=it!==this.prevTransformTemplateValue;v&&(b||hasTransform(this.latestValues)||nt)&&(_(this.instance,it),this.shouldResetTransform=!1,this.scheduleRender())}measure(v=!0){const b=this.measurePageBox();let tt=this.removeElementScroll(b);return v&&(tt=this.removeTransform(tt)),roundBox(tt),{animationId:this.root.animationId,measuredBox:b,layoutBox:tt,latestValues:{},source:this.id}}measurePageBox(){const{visualElement:v}=this.options;if(!v)return createBox();const b=v.measureViewportBox(),{scroll:tt}=this.root;return tt&&(translateAxis(b.x,tt.offset.x),translateAxis(b.y,tt.offset.y)),b}removeElementScroll(v){const b=createBox();copyBoxInto(b,v);for(let tt=0;tt<this.path.length;tt++){const it=this.path[tt],{scroll:nt,options:lt}=it;if(it!==this.root&&nt&&lt.layoutScroll){if(nt.isRoot){copyBoxInto(b,v);const{scroll:ut}=this.root;ut&&(translateAxis(b.x,-ut.offset.x),translateAxis(b.y,-ut.offset.y))}translateAxis(b.x,nt.offset.x),translateAxis(b.y,nt.offset.y)}}return b}applyTransform(v,b=!1){const tt=createBox();copyBoxInto(tt,v);for(let it=0;it<this.path.length;it++){const nt=this.path[it];!b&&nt.options.layoutScroll&&nt.scroll&&nt!==nt.root&&transformBox(tt,{x:-nt.scroll.offset.x,y:-nt.scroll.offset.y}),hasTransform(nt.latestValues)&&transformBox(tt,nt.latestValues)}return hasTransform(this.latestValues)&&transformBox(tt,this.latestValues),tt}removeTransform(v){const b=createBox();copyBoxInto(b,v);for(let tt=0;tt<this.path.length;tt++){const it=this.path[tt];if(!it.instance||!hasTransform(it.latestValues))continue;hasScale(it.latestValues)&&it.updateSnapshot();const nt=createBox(),lt=it.measurePageBox();copyBoxInto(nt,lt),removeBoxTransforms(b,it.latestValues,it.snapshot?it.snapshot.layoutBox:void 0,nt)}return hasTransform(this.latestValues)&&removeBoxTransforms(b,this.latestValues),b}setTargetDelta(v){this.targetDelta=v,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(v){this.options={...this.options,...v,crossfade:v.crossfade!==void 0?v.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==frameData.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(v=!1){var b;const tt=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=tt.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=tt.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=tt.isSharedProjectionDirty);const it=!!this.resumingFrom||this!==tt;if(!(v||it&&this.isSharedProjectionDirty||this.isProjectionDirty||!((b=this.parent)===null||b===void 0)&&b.isProjectionDirty||this.attemptToResolveRelativeTarget))return;const{layout:nt,layoutId:lt}=this.options;if(!(!this.layout||!(nt||lt))){if(this.resolvedRelativeTargetAt=frameData.timestamp,!this.targetDelta&&!this.relativeTarget){const ut=this.getClosestProjectingParent();ut&&ut.layout&&this.animationProgress!==1?(this.relativeParent=ut,this.forceRelativeParentToResolveTarget(),this.relativeTarget=createBox(),this.relativeTargetOrigin=createBox(),calcRelativePosition(this.relativeTargetOrigin,this.layout.layoutBox,ut.layout.layoutBox),copyBoxInto(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(!(!this.relativeTarget&&!this.targetDelta)){if(this.target||(this.target=createBox(),this.targetWithTransforms=createBox()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),calcRelativeBox(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):copyBoxInto(this.target,this.layout.layoutBox),applyBoxDelta(this.target,this.targetDelta)):copyBoxInto(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget){this.attemptToResolveRelativeTarget=!1;const ut=this.getClosestProjectingParent();ut&&!!ut.resumingFrom==!!this.resumingFrom&&!ut.options.layoutScroll&&ut.target&&this.animationProgress!==1?(this.relativeParent=ut,this.forceRelativeParentToResolveTarget(),this.relativeTarget=createBox(),this.relativeTargetOrigin=createBox(),calcRelativePosition(this.relativeTargetOrigin,this.target,ut.target),copyBoxInto(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}projectionFrameData.resolvedTargetDeltas++}}}getClosestProjectingParent(){if(!(!this.parent||hasScale(this.parent.latestValues)||has2DTranslate(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){var v;const b=this.getLead(),tt=!!this.resumingFrom||this!==b;let it=!0;if((this.isProjectionDirty||!((v=this.parent)===null||v===void 0)&&v.isProjectionDirty)&&(it=!1),tt&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(it=!1),this.resolvedRelativeTargetAt===frameData.timestamp&&(it=!1),it)return;const{layout:nt,layoutId:lt}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(nt||lt))return;copyBoxInto(this.layoutCorrected,this.layout.layoutBox);const ut=this.treeScale.x,ht=this.treeScale.y;applyTreeDeltas(this.layoutCorrected,this.treeScale,this.path,tt),b.layout&&!b.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(b.target=b.layout.layoutBox,b.targetWithTransforms=createBox());const{target:_t}=b;if(!_t){this.projectionTransform&&(this.projectionDelta=createDelta(),this.projectionTransform="none",this.scheduleRender());return}this.projectionDelta||(this.projectionDelta=createDelta(),this.projectionDeltaWithTransform=createDelta());const ft=this.projectionTransform;calcBoxDelta(this.projectionDelta,this.layoutCorrected,_t,this.latestValues),this.projectionTransform=buildProjectionTransform(this.projectionDelta,this.treeScale),(this.projectionTransform!==ft||this.treeScale.x!==ut||this.treeScale.y!==ht)&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",_t)),projectionFrameData.recalculatedProjection++}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(v=!0){if(this.options.scheduleRender&&this.options.scheduleRender(),v){const b=this.getStack();b&&b.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}setAnimationOrigin(v,b=!1){const tt=this.snapshot,it=tt?tt.latestValues:{},nt={...this.latestValues},lt=createDelta();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!b;const ut=createBox(),ht=tt?tt.source:void 0,_t=this.layout?this.layout.source:void 0,ft=ht!==_t,bt=this.getStack(),xt=!bt||bt.members.length<=1,St=!!(ft&&!xt&&this.options.crossfade===!0&&!this.path.some(hasOpacityCrossfade));this.animationProgress=0;let wt;this.mixTargetDelta=Pt=>{const Rt=Pt/1e3;mixAxisDelta(lt.x,v.x,Rt),mixAxisDelta(lt.y,v.y,Rt),this.setTargetDelta(lt),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(calcRelativePosition(ut,this.layout.layoutBox,this.relativeParent.layout.layoutBox),mixBox(this.relativeTarget,this.relativeTargetOrigin,ut,Rt),wt&&boxEquals(this.relativeTarget,wt)&&(this.isProjectionDirty=!1),wt||(wt=createBox()),copyBoxInto(wt,this.relativeTarget)),ft&&(this.animationValues=nt,mixValues(nt,it,this.latestValues,Rt,St,xt)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=Rt},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(v){this.notifyListeners("animationStart"),this.currentAnimation&&this.currentAnimation.stop(),this.resumingFrom&&this.resumingFrom.currentAnimation&&this.resumingFrom.currentAnimation.stop(),this.pendingAnimation&&(cancelFrame(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=frame.update(()=>{globalProjectionState.hasAnimatedSinceResize=!0,this.currentAnimation=animateSingleValue(0,animationTarget,{...v,onUpdate:b=>{this.mixTargetDelta(b),v.onUpdate&&v.onUpdate(b)},onComplete:()=>{v.onComplete&&v.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const v=this.getStack();v&&v.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(animationTarget),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const v=this.getLead();let{targetWithTransforms:b,target:tt,layout:it,latestValues:nt}=v;if(!(!b||!tt||!it)){if(this!==v&&this.layout&&it&&shouldAnimatePositionOnly(this.options.animationType,this.layout.layoutBox,it.layoutBox)){tt=this.target||createBox();const lt=calcLength(this.layout.layoutBox.x);tt.x.min=v.target.x.min,tt.x.max=tt.x.min+lt;const ut=calcLength(this.layout.layoutBox.y);tt.y.min=v.target.y.min,tt.y.max=tt.y.min+ut}copyBoxInto(b,tt),transformBox(b,nt),calcBoxDelta(this.projectionDeltaWithTransform,this.layoutCorrected,b,nt)}}registerSharedNode(v,b){this.sharedNodes.has(v)||this.sharedNodes.set(v,new NodeStack),this.sharedNodes.get(v).add(b);const tt=b.options.initialPromotionConfig;b.promote({transition:tt?tt.transition:void 0,preserveFollowOpacity:tt&&tt.shouldPreserveFollowOpacity?tt.shouldPreserveFollowOpacity(b):void 0})}isLead(){const v=this.getStack();return v?v.lead===this:!0}getLead(){var v;const{layoutId:b}=this.options;return b?((v=this.getStack())===null||v===void 0?void 0:v.lead)||this:this}getPrevLead(){var v;const{layoutId:b}=this.options;return b?(v=this.getStack())===null||v===void 0?void 0:v.prevLead:void 0}getStack(){const{layoutId:v}=this.options;if(v)return this.root.sharedNodes.get(v)}promote({needsReset:v,transition:b,preserveFollowOpacity:tt}={}){const it=this.getStack();it&&it.promote(this,tt),v&&(this.projectionDelta=void 0,this.needsReset=!0),b&&this.setOptions({transition:b})}relegate(){const v=this.getStack();return v?v.relegate(this):!1}resetSkewAndRotation(){const{visualElement:v}=this.options;if(!v)return;let b=!1;const{latestValues:tt}=v;if((tt.z||tt.rotate||tt.rotateX||tt.rotateY||tt.rotateZ||tt.skewX||tt.skewY)&&(b=!0),!b)return;const it={};tt.z&&resetDistortingTransform("z",v,it,this.animationValues);for(let nt=0;nt<transformAxes.length;nt++)resetDistortingTransform(`rotate${transformAxes[nt]}`,v,it,this.animationValues),resetDistortingTransform(`skew${transformAxes[nt]}`,v,it,this.animationValues);v.render();for(const nt in it)v.setStaticValue(nt,it[nt]),this.animationValues&&(this.animationValues[nt]=it[nt]);v.scheduleRender()}getProjectionStyles(v){var b,tt;if(!this.instance||this.isSVG)return;if(!this.isVisible)return hiddenVisibility;const it={visibility:""},nt=this.getTransformTemplate();if(this.needsReset)return this.needsReset=!1,it.opacity="",it.pointerEvents=resolveMotionValue(v==null?void 0:v.pointerEvents)||"",it.transform=nt?nt(this.latestValues,""):"none",it;const lt=this.getLead();if(!this.projectionDelta||!this.layout||!lt.target){const ft={};return this.options.layoutId&&(ft.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,ft.pointerEvents=resolveMotionValue(v==null?void 0:v.pointerEvents)||""),this.hasProjected&&!hasTransform(this.latestValues)&&(ft.transform=nt?nt({},""):"none",this.hasProjected=!1),ft}const ut=lt.animationValues||lt.latestValues;this.applyTransformsToTarget(),it.transform=buildProjectionTransform(this.projectionDeltaWithTransform,this.treeScale,ut),nt&&(it.transform=nt(ut,it.transform));const{x:ht,y:_t}=this.projectionDelta;it.transformOrigin=`${ht.origin*100}% ${_t.origin*100}% 0`,lt.animationValues?it.opacity=lt===this?(tt=(b=ut.opacity)!==null&&b!==void 0?b:this.latestValues.opacity)!==null&&tt!==void 0?tt:1:this.preserveOpacity?this.latestValues.opacity:ut.opacityExit:it.opacity=lt===this?ut.opacity!==void 0?ut.opacity:"":ut.opacityExit!==void 0?ut.opacityExit:0;for(const ft in scaleCorrectors){if(ut[ft]===void 0)continue;const{correct:bt,applyTo:xt}=scaleCorrectors[ft],St=it.transform==="none"?ut[ft]:bt(ut[ft],lt);if(xt){const wt=xt.length;for(let Pt=0;Pt<wt;Pt++)it[xt[Pt]]=St}else it[ft]=St}return this.options.layoutId&&(it.pointerEvents=lt===this?resolveMotionValue(v==null?void 0:v.pointerEvents)||"":"none"),it}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(v=>{var b;return(b=v.currentAnimation)===null||b===void 0?void 0:b.stop()}),this.root.nodes.forEach(clearMeasurements),this.root.sharedNodes.clear()}}}function updateLayout(h){h.updateLayout()}function notifyLayoutUpdate(h){var o;const c=((o=h.resumeFrom)===null||o===void 0?void 0:o.snapshot)||h.snapshot;if(h.isLead()&&h.layout&&c&&h.hasListeners("didUpdate")){const{layoutBox:d,measuredBox:_}=h.layout,{animationType:v}=h.options,b=c.source!==h.layout.source;v==="size"?eachAxis(ut=>{const ht=b?c.measuredBox[ut]:c.layoutBox[ut],_t=calcLength(ht);ht.min=d[ut].min,ht.max=ht.min+_t}):shouldAnimatePositionOnly(v,c.layoutBox,d)&&eachAxis(ut=>{const ht=b?c.measuredBox[ut]:c.layoutBox[ut],_t=calcLength(d[ut]);ht.max=ht.min+_t,h.relativeTarget&&!h.currentAnimation&&(h.isProjectionDirty=!0,h.relativeTarget[ut].max=h.relativeTarget[ut].min+_t)});const tt=createDelta();calcBoxDelta(tt,d,c.layoutBox);const it=createDelta();b?calcBoxDelta(it,h.applyTransform(_,!0),c.measuredBox):calcBoxDelta(it,d,c.layoutBox);const nt=!isDeltaZero(tt);let lt=!1;if(!h.resumeFrom){const ut=h.getClosestProjectingParent();if(ut&&!ut.resumeFrom){const{snapshot:ht,layout:_t}=ut;if(ht&&_t){const ft=createBox();calcRelativePosition(ft,c.layoutBox,ht.layoutBox);const bt=createBox();calcRelativePosition(bt,d,_t.layoutBox),boxEqualsRounded(ft,bt)||(lt=!0),ut.options.layoutRoot&&(h.relativeTarget=bt,h.relativeTargetOrigin=ft,h.relativeParent=ut)}}}h.notifyListeners("didUpdate",{layout:d,snapshot:c,delta:it,layoutDelta:tt,hasLayoutChanged:nt,hasRelativeTargetChanged:lt})}else if(h.isLead()){const{onExitComplete:d}=h.options;d&&d()}h.options.transition=void 0}function propagateDirtyNodes(h){projectionFrameData.totalNodes++,h.parent&&(h.isProjecting()||(h.isProjectionDirty=h.parent.isProjectionDirty),h.isSharedProjectionDirty||(h.isSharedProjectionDirty=!!(h.isProjectionDirty||h.parent.isProjectionDirty||h.parent.isSharedProjectionDirty)),h.isTransformDirty||(h.isTransformDirty=h.parent.isTransformDirty))}function cleanDirtyNodes(h){h.isProjectionDirty=h.isSharedProjectionDirty=h.isTransformDirty=!1}function clearSnapshot(h){h.clearSnapshot()}function clearMeasurements(h){h.clearMeasurements()}function clearIsLayoutDirty(h){h.isLayoutDirty=!1}function resetTransformStyle(h){const{visualElement:o}=h.options;o&&o.getProps().onBeforeLayoutMeasure&&o.notify("BeforeLayoutMeasure"),h.resetTransform()}function finishAnimation(h){h.finishAnimation(),h.targetDelta=h.relativeTarget=h.target=void 0,h.isProjectionDirty=!0}function resolveTargetDelta(h){h.resolveTargetDelta()}function calcProjection(h){h.calcProjection()}function resetSkewAndRotation(h){h.resetSkewAndRotation()}function removeLeadSnapshots(h){h.removeLeadSnapshot()}function mixAxisDelta(h,o,c){h.translate=mixNumber$1(o.translate,0,c),h.scale=mixNumber$1(o.scale,1,c),h.origin=o.origin,h.originPoint=o.originPoint}function mixAxis(h,o,c,d){h.min=mixNumber$1(o.min,c.min,d),h.max=mixNumber$1(o.max,c.max,d)}function mixBox(h,o,c,d){mixAxis(h.x,o.x,c.x,d),mixAxis(h.y,o.y,c.y,d)}function hasOpacityCrossfade(h){return h.animationValues&&h.animationValues.opacityExit!==void 0}const defaultLayoutTransition={duration:.45,ease:[.4,0,.1,1]},userAgentContains=h=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(h),roundPoint=userAgentContains("applewebkit/")&&!userAgentContains("chrome/")?Math.round:noop;function roundAxis(h){h.min=roundPoint(h.min),h.max=roundPoint(h.max)}function roundBox(h){roundAxis(h.x),roundAxis(h.y)}function shouldAnimatePositionOnly(h,o,c){return h==="position"||h==="preserve-aspect"&&!isNear(aspectRatio(o),aspectRatio(c),.2)}const DocumentProjectionNode=createProjectionNode({attachResizeListener:(h,o)=>addDomEvent(h,"resize",o),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),rootProjectionNode={current:void 0},HTMLProjectionNode=createProjectionNode({measureScroll:h=>({x:h.scrollLeft,y:h.scrollTop}),defaultParent:()=>{if(!rootProjectionNode.current){const h=new DocumentProjectionNode({});h.mount(window),h.setOptions({layoutScroll:!0}),rootProjectionNode.current=h}return rootProjectionNode.current},resetTransform:(h,o)=>{h.style.transform=o!==void 0?o:"none"},checkIsScrollRoot:h=>window.getComputedStyle(h).position==="fixed"}),drag={pan:{Feature:PanGesture},drag:{Feature:DragGesture,ProjectionNode:HTMLProjectionNode,MeasureLayout}},prefersReducedMotion={current:null},hasReducedMotionListener={current:!1};function initPrefersReducedMotion(){if(hasReducedMotionListener.current=!0,!!isBrowser)if(window.matchMedia){const h=window.matchMedia("(prefers-reduced-motion)"),o=()=>prefersReducedMotion.current=h.matches;h.addListener(o),o()}else prefersReducedMotion.current=!1}function updateMotionValuesFromProps(h,o,c){const{willChange:d}=o;for(const _ in o){const v=o[_],b=c[_];if(isMotionValue(v))h.addValue(_,v),isWillChangeMotionValue(d)&&d.add(_);else if(isMotionValue(b))h.addValue(_,motionValue(v,{owner:h})),isWillChangeMotionValue(d)&&d.remove(_);else if(b!==v)if(h.hasValue(_)){const tt=h.getValue(_);tt.liveStyle===!0?tt.jump(v):tt.hasAnimated||tt.set(v)}else{const tt=h.getStaticValue(_);h.addValue(_,motionValue(tt!==void 0?tt:v,{owner:h}))}}for(const _ in c)o[_]===void 0&&h.removeValue(_);return o}const visualElementStore=new WeakMap,valueTypes=[...dimensionValueTypes,color,complex],findValueType=h=>valueTypes.find(testValueType(h)),featureNames=Object.keys(featureDefinitions),numFeatures=featureNames.length,propEventHandlers=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"],numVariantProps=variantProps.length;function getClosestProjectingNode(h){if(h)return h.options.allowProjection!==!1?h.projection:getClosestProjectingNode(h.parent)}class VisualElement{scrapeMotionValuesFromProps(o,c,d){return{}}constructor({parent:o,props:c,presenceContext:d,reducedMotionConfig:_,blockInitialAnimation:v,visualState:b},tt={}){this.resolveKeyframes=(ht,_t,ft,bt)=>new this.KeyframeResolver(ht,_t,ft,bt,this),this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=KeyframeResolver,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.scheduleRender=()=>frame.render(this.render,!1,!0);const{latestValues:it,renderState:nt}=b;this.latestValues=it,this.baseTarget={...it},this.initialValues=c.initial?{...it}:{},this.renderState=nt,this.parent=o,this.props=c,this.presenceContext=d,this.depth=o?o.depth+1:0,this.reducedMotionConfig=_,this.options=tt,this.blockInitialAnimation=!!v,this.isControllingVariants=isControllingVariants(c),this.isVariantNode=isVariantNode(c),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(o&&o.current);const{willChange:lt,...ut}=this.scrapeMotionValuesFromProps(c,{},this);for(const ht in ut){const _t=ut[ht];it[ht]!==void 0&&isMotionValue(_t)&&(_t.set(it[ht],!1),isWillChangeMotionValue(lt)&&lt.add(ht))}}mount(o){this.current=o,visualElementStore.set(o,this),this.projection&&!this.projection.instance&&this.projection.mount(o),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((c,d)=>this.bindToMotionValue(d,c)),hasReducedMotionListener.current||initPrefersReducedMotion(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:prefersReducedMotion.current,this.parent&&this.parent.children.add(this),this.update(this.props,this.presenceContext)}unmount(){var o;visualElementStore.delete(this.current),this.projection&&this.projection.unmount(),cancelFrame(this.notifyUpdate),cancelFrame(this.render),this.valueSubscriptions.forEach(c=>c()),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent&&this.parent.children.delete(this);for(const c in this.events)this.events[c].clear();for(const c in this.features)(o=this.features[c])===null||o===void 0||o.unmount();this.current=null}bindToMotionValue(o,c){const d=transformProps.has(o),_=c.on("change",b=>{this.latestValues[o]=b,this.props.onUpdate&&frame.preRender(this.notifyUpdate),d&&this.projection&&(this.projection.isTransformDirty=!0)}),v=c.on("renderRequest",this.scheduleRender);this.valueSubscriptions.set(o,()=>{_(),v(),c.owner&&c.stop()})}sortNodePosition(o){return!this.current||!this.sortInstanceNodePosition||this.type!==o.type?0:this.sortInstanceNodePosition(this.current,o.current)}loadFeatures({children:o,...c},d,_,v){let b,tt;for(let it=0;it<numFeatures;it++){const nt=featureNames[it],{isEnabled:lt,Feature:ut,ProjectionNode:ht,MeasureLayout:_t}=featureDefinitions[nt];ht&&(b=ht),lt(c)&&(!this.features[nt]&&ut&&(this.features[nt]=new ut(this)),_t&&(tt=_t))}if((this.type==="html"||this.type==="svg")&&!this.projection&&b){this.projection=new b(this.latestValues,getClosestProjectingNode(this.parent));const{layoutId:it,layout:nt,drag:lt,dragConstraints:ut,layoutScroll:ht,layoutRoot:_t}=c;this.projection.setOptions({layoutId:it,layout:nt,alwaysMeasureLayout:!!lt||ut&&isRefObject(ut),visualElement:this,scheduleRender:()=>this.scheduleRender(),animationType:typeof nt=="string"?nt:"both",initialPromotionConfig:v,layoutScroll:ht,layoutRoot:_t})}return tt}updateFeatures(){for(const o in this.features){const c=this.features[o];c.isMounted?c.update():(c.mount(),c.isMounted=!0)}}triggerBuild(){this.build(this.renderState,this.latestValues,this.options,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):createBox()}getStaticValue(o){return this.latestValues[o]}setStaticValue(o,c){this.latestValues[o]=c}update(o,c){(o.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=o,this.prevPresenceContext=this.presenceContext,this.presenceContext=c;for(let d=0;d<propEventHandlers.length;d++){const _=propEventHandlers[d];this.propEventSubscriptions[_]&&(this.propEventSubscriptions[_](),delete this.propEventSubscriptions[_]);const v="on"+_,b=o[v];b&&(this.propEventSubscriptions[_]=this.on(_,b))}this.prevMotionValues=updateMotionValuesFromProps(this,this.scrapeMotionValuesFromProps(o,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(o){return this.props.variants?this.props.variants[o]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}getVariantContext(o=!1){if(o)return this.parent?this.parent.getVariantContext():void 0;if(!this.isControllingVariants){const d=this.parent?this.parent.getVariantContext()||{}:{};return this.props.initial!==void 0&&(d.initial=this.props.initial),d}const c={};for(let d=0;d<numVariantProps;d++){const _=variantProps[d],v=this.props[_];(isVariantLabel(v)||v===!1)&&(c[_]=v)}return c}addVariantChild(o){const c=this.getClosestVariantNode();if(c)return c.variantChildren&&c.variantChildren.add(o),()=>c.variantChildren.delete(o)}addValue(o,c){const d=this.values.get(o);c!==d&&(d&&this.removeValue(o),this.bindToMotionValue(o,c),this.values.set(o,c),this.latestValues[o]=c.get())}removeValue(o){this.values.delete(o);const c=this.valueSubscriptions.get(o);c&&(c(),this.valueSubscriptions.delete(o)),delete this.latestValues[o],this.removeValueFromRenderState(o,this.renderState)}hasValue(o){return this.values.has(o)}getValue(o,c){if(this.props.values&&this.props.values[o])return this.props.values[o];let d=this.values.get(o);return d===void 0&&c!==void 0&&(d=motionValue(c===null?void 0:c,{owner:this}),this.addValue(o,d)),d}readValue(o,c){var d;let _=this.latestValues[o]!==void 0||!this.current?this.latestValues[o]:(d=this.getBaseTargetFromProps(this.props,o))!==null&&d!==void 0?d:this.readValueFromInstance(this.current,o,this.options);return _!=null&&(typeof _=="string"&&(isNumericalString(_)||isZeroValueString(_))?_=parseFloat(_):!findValueType(_)&&complex.test(c)&&(_=getAnimatableNone(o,c)),this.setBaseTarget(o,isMotionValue(_)?_.get():_)),isMotionValue(_)?_.get():_}setBaseTarget(o,c){this.baseTarget[o]=c}getBaseTarget(o){var c;const{initial:d}=this.props;let _;if(typeof d=="string"||typeof d=="object"){const b=resolveVariantFromProps(this.props,d,(c=this.presenceContext)===null||c===void 0?void 0:c.custom);b&&(_=b[o])}if(d&&_!==void 0)return _;const v=this.getBaseTargetFromProps(this.props,o);return v!==void 0&&!isMotionValue(v)?v:this.initialValues[o]!==void 0&&_===void 0?void 0:this.baseTarget[o]}on(o,c){return this.events[o]||(this.events[o]=new SubscriptionManager),this.events[o].add(c)}notify(o,...c){this.events[o]&&this.events[o].notify(...c)}}class DOMVisualElement extends VisualElement{constructor(){super(...arguments),this.KeyframeResolver=DOMKeyframesResolver}sortInstanceNodePosition(o,c){return o.compareDocumentPosition(c)&2?1:-1}getBaseTargetFromProps(o,c){return o.style?o.style[c]:void 0}removeValueFromRenderState(o,{vars:c,style:d}){delete c[o],delete d[o]}}function getComputedStyle(h){return window.getComputedStyle(h)}class HTMLVisualElement extends DOMVisualElement{constructor(){super(...arguments),this.type="html"}readValueFromInstance(o,c){if(transformProps.has(c)){const d=getDefaultValueType(c);return d&&d.default||0}else{const d=getComputedStyle(o),_=(isCSSVariableName(c)?d.getPropertyValue(c):d[c])||0;return typeof _=="string"?_.trim():_}}measureInstanceViewportBox(o,{transformPagePoint:c}){return measureViewportBox(o,c)}build(o,c,d,_){buildHTMLStyles(o,c,d,_.transformTemplate)}scrapeMotionValuesFromProps(o,c,d){return scrapeMotionValuesFromProps$1(o,c,d)}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:o}=this.props;isMotionValue(o)&&(this.childSubscription=o.on("change",c=>{this.current&&(this.current.textContent=`${c}`)}))}renderInstance(o,c,d,_){renderHTML(o,c,d,_)}}class SVGVisualElement extends DOMVisualElement{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1}getBaseTargetFromProps(o,c){return o[c]}readValueFromInstance(o,c){if(transformProps.has(c)){const d=getDefaultValueType(c);return d&&d.default||0}return c=camelCaseAttributes.has(c)?c:camelToDash(c),o.getAttribute(c)}measureInstanceViewportBox(){return createBox()}scrapeMotionValuesFromProps(o,c,d){return scrapeMotionValuesFromProps(o,c,d)}build(o,c,d,_){buildSVGAttrs(o,c,d,this.isSVGTag,_.transformTemplate)}renderInstance(o,c,d,_){renderSVG(o,c,d,_)}mount(o){this.isSVGTag=isSVGTag(o.tagName),super.mount(o)}}const createDomVisualElement=(h,o)=>isSVGComponent(h)?new SVGVisualElement(o,{enableHardwareAcceleration:!1}):new HTMLVisualElement(o,{allowProjection:h!==reactExports.Fragment,enableHardwareAcceleration:!0}),layout={layout:{ProjectionNode:HTMLProjectionNode,MeasureLayout}},preloadedFeatures={...animations,...gestureAnimations,...drag,...layout},motion=createMotionProxy((h,o)=>createDomMotionConfig(h,o,preloadedFeatures,createDomVisualElement));function useIsMounted(){const h=reactExports.useRef(!1);return useIsomorphicLayoutEffect(()=>(h.current=!0,()=>{h.current=!1}),[]),h}function useForceUpdate(){const h=useIsMounted(),[o,c]=reactExports.useState(0),d=reactExports.useCallback(()=>{h.current&&c(o+1)},[o]);return[reactExports.useCallback(()=>frame.postRender(d),[d]),o]}class PopChildMeasure extends reactExports.Component{getSnapshotBeforeUpdate(o){const c=this.props.childRef.current;if(c&&o.isPresent&&!this.props.isPresent){const d=this.props.sizeRef.current;d.height=c.offsetHeight||0,d.width=c.offsetWidth||0,d.top=c.offsetTop,d.left=c.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function PopChild({children:h,isPresent:o}){const c=reactExports.useId(),d=reactExports.useRef(null),_=reactExports.useRef({width:0,height:0,top:0,left:0}),{nonce:v}=reactExports.useContext(MotionConfigContext);return reactExports.useInsertionEffect(()=>{const{width:b,height:tt,top:it,left:nt}=_.current;if(o||!d.current||!b||!tt)return;d.current.dataset.motionPopId=c;const lt=document.createElement("style");return v&&(lt.nonce=v),document.head.appendChild(lt),lt.sheet&&lt.sheet.insertRule(`
          [data-motion-pop-id="${c}"] {
            position: absolute !important;
            width: ${b}px !important;
            height: ${tt}px !important;
            top: ${it}px !important;
            left: ${nt}px !important;
          }
        `),()=>{document.head.removeChild(lt)}},[o]),jsxRuntimeExports.jsx(PopChildMeasure,{isPresent:o,childRef:d,sizeRef:_,children:reactExports.cloneElement(h,{ref:d})})}const PresenceChild=({children:h,initial:o,isPresent:c,onExitComplete:d,custom:_,presenceAffectsLayout:v,mode:b})=>{const tt=useConstant(newChildrenMap),it=reactExports.useId(),nt=reactExports.useMemo(()=>({id:it,initial:o,isPresent:c,custom:_,onExitComplete:lt=>{tt.set(lt,!0);for(const ut of tt.values())if(!ut)return;d&&d()},register:lt=>(tt.set(lt,!1),()=>tt.delete(lt))}),v?[Math.random()]:[c]);return reactExports.useMemo(()=>{tt.forEach((lt,ut)=>tt.set(ut,!1))},[c]),reactExports.useEffect(()=>{!c&&!tt.size&&d&&d()},[c]),b==="popLayout"&&(h=jsxRuntimeExports.jsx(PopChild,{isPresent:c,children:h})),jsxRuntimeExports.jsx(PresenceContext.Provider,{value:nt,children:h})};function newChildrenMap(){return new Map}function useUnmountEffect(h){return reactExports.useEffect(()=>()=>h(),[])}const getChildKey=h=>h.key||"";function updateChildLookup(h,o){h.forEach(c=>{const d=getChildKey(c);o.set(d,c)})}function onlyElements(h){const o=[];return reactExports.Children.forEach(h,c=>{reactExports.isValidElement(c)&&o.push(c)}),o}const AnimatePresence=({children:h,custom:o,initial:c=!0,onExitComplete:d,exitBeforeEnter:_,presenceAffectsLayout:v=!0,mode:b="sync"})=>{const tt=reactExports.useContext(LayoutGroupContext).forceRender||useForceUpdate()[0],it=useIsMounted(),nt=onlyElements(h);let lt=nt;const ut=reactExports.useRef(new Map).current,ht=reactExports.useRef(lt),_t=reactExports.useRef(new Map).current,ft=reactExports.useRef(!0);if(useIsomorphicLayoutEffect(()=>{ft.current=!1,updateChildLookup(nt,_t),ht.current=lt}),useUnmountEffect(()=>{ft.current=!0,_t.clear(),ut.clear()}),ft.current)return jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{children:lt.map(wt=>jsxRuntimeExports.jsx(PresenceChild,{isPresent:!0,initial:c?void 0:!1,presenceAffectsLayout:v,mode:b,children:wt},getChildKey(wt)))});lt=[...lt];const bt=ht.current.map(getChildKey),xt=nt.map(getChildKey),St=bt.length;for(let wt=0;wt<St;wt++){const Pt=bt[wt];xt.indexOf(Pt)===-1&&!ut.has(Pt)&&ut.set(Pt,void 0)}return b==="wait"&&ut.size&&(lt=[]),ut.forEach((wt,Pt)=>{if(xt.indexOf(Pt)!==-1)return;const Rt=_t.get(Pt);if(!Rt)return;const kt=bt.indexOf(Pt);let Gt=wt;if(!Gt){const Dt=()=>{ut.delete(Pt);const It=Array.from(_t.keys()).filter(Nt=>!xt.includes(Nt));if(It.forEach(Nt=>_t.delete(Nt)),ht.current=nt.filter(Nt=>{const Vt=getChildKey(Nt);return Vt===Pt||It.includes(Vt)}),!ut.size){if(it.current===!1)return;tt(),d&&d()}};Gt=jsxRuntimeExports.jsx(PresenceChild,{isPresent:!1,onExitComplete:Dt,custom:o,presenceAffectsLayout:v,mode:b,children:Rt},getChildKey(Rt)),ut.set(Pt,Gt)}lt.splice(kt,0,Gt)}),lt=lt.map(wt=>{const Pt=wt.key;return ut.has(Pt)?wt:jsxRuntimeExports.jsx(PresenceChild,{isPresent:!0,presenceAffectsLayout:v,mode:b,children:wt},getChildKey(wt))}),jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{children:ut.size?lt:lt.map(wt=>reactExports.cloneElement(wt))})};function useMotionValue(h){const o=useConstant(()=>motionValue(h)),{isStatic:c}=reactExports.useContext(MotionConfigContext);if(c){const[,d]=reactExports.useState(h);reactExports.useEffect(()=>o.on("change",d),[])}return o}const isCustomValueType=h=>h&&typeof h=="object"&&h.mix,getMixer=h=>isCustomValueType(h)?h.mix:void 0;function transform(...h){const o=!Array.isArray(h[0]),c=o?0:-1,d=h[0+c],_=h[1+c],v=h[2+c],b=h[3+c],tt=interpolate(_,v,{mixer:getMixer(v[0]),...b});return o?tt(d):tt}function useCombineMotionValues(h,o){const c=useMotionValue(o()),d=()=>c.set(o());return d(),useIsomorphicLayoutEffect(()=>{const _=()=>frame.preRender(d,!1,!0),v=h.map(b=>b.on("change",_));return()=>{v.forEach(b=>b()),cancelFrame(d)}}),c}function useComputed(h){collectMotionValues.current=[],h();const o=useCombineMotionValues(collectMotionValues.current,h);return collectMotionValues.current=void 0,o}function useTransform(h,o,c,d){if(typeof h=="function")return useComputed(h);const _=typeof o=="function"?o:transform(o,c,d);return Array.isArray(h)?useListTransform(h,_):useListTransform([h],([v])=>_(v))}function useListTransform(h,o){const c=useConstant(()=>[]);return useCombineMotionValues(h,()=>{c.length=0;const d=h.length;for(let _=0;_<d;_++)c[_]=h[_].get();return o(c)})}function useSpring(h,o={}){const{isStatic:c}=reactExports.useContext(MotionConfigContext),d=reactExports.useRef(null),_=useMotionValue(isMotionValue(h)?h.get():h),v=()=>{d.current&&d.current.stop()};return reactExports.useInsertionEffect(()=>_.attach((b,tt)=>{if(c)return tt(b);const it=d.current;return it&&it.time===0&&it.sample(frameData.delta),v(),d.current=animateValue({keyframes:[_.get(),b],velocity:_.getVelocity(),type:"spring",restDelta:.001,restSpeed:.01,...o,onUpdate:tt}),_.get()},v),[JSON.stringify(o)]),useIsomorphicLayoutEffect(()=>{if(isMotionValue(h))return h.on("change",b=>_.set(parseFloat(b)))},[_]),_}const Uicontext=reactExports.createContext({}),useUi=()=>reactExports.useContext(Uicontext);function useSetupProvider(h){const[o,c]=reactExports.useState(h.digitalZoom||1),[d,_]=reactExports.useState(h.cameraZoom||1),[v,b]=reactExports.useState(h.image||""),tt=h.handleStartAR||(()=>{}),it=h.loadRing||(()=>{}),nt=h.viewer,lt=h.clickImage||(()=>{}),ut=h.flipCamera||(()=>{}),ht=h.rings||[],[_t,ft]=reactExports.useState(3);return{image:v,setImage:b,digitalZoom:o,setDigitalZoom:c,handleStartAR:tt,cameraZoom:d,fingerIndex:_t,setCameraZoom:_,selectPreviousFinger:()=>{ft(bt=>(bt-1+5)%5)},selectNextFinger:()=>{ft(bt=>(bt+1)%5)},loadRing:it,clickImage:lt,flipCamera:ut,viewer:nt,rings:ht}}function UiProvider({children:h,initialValues:o}){const c=useSetupProvider(o);return reactExports.createElement(Uicontext.Provider,{value:c},h)}function Spinner(h){return jsxRuntimeExports.jsx("div",{className:"w-20 h-20 flex "+h.className,children:jsxRuntimeExports.jsx("span",{className:"spinner"})})}const RingOption=h=>{const o=useSpring(useMotionValue(1),{duration:.1,mass:.1}),{loadRing:c,viewer:d,clickImage:_,setImage:v}=useUi(),[b,tt]=reactExports.useState(!1),it=reactExports.useCallback(()=>{if(h.active){d.renderEnabled=!1;const ut=_();v(ut);const ht=document.getElementById("ui-wrapper");ht&&(ht.style.opacity="0",setTimeout(()=>{ht.style.pointerEvents="none"},200));const _t=document.getElementById("share");_t&&(_t.style.opacity="1",setTimeout(()=>{_t.style.pointerEvents="auto"},200))}},[h.active]),nt=reactExports.useCallback(()=>{h.active&&o.set(1.4,!0)},[h.active]),lt=reactExports.useCallback(()=>{h.active&&o.set(1.2,!0)},[h.active]);return reactExports.useEffect(()=>{h.active?(o.set(1.2,!0),tt(!0),c(h.ringUrl,h.configUrl).then(()=>{tt(!1)})):(tt(!1),o.set(1,!0))},[h.active]),jsxRuntimeExports.jsxs(motion.div,{style:{scale:o},ref:h.refrence,className:"w-20 h-20 rounded-full px-2 flex justify-center items-center relative "+(h.active?"pointer-events-auto":"pointer-events-none"),onClick:it,onPointerDown:nt,onPointerUp:lt,children:[b&&jsxRuntimeExports.jsx(Spinner,{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 h-20 w-20 p-4"}),jsxRuntimeExports.jsx("div",{className:"w-14 h-14 bg-[#ffffff48] rounded-full overflow-hidden "+(h.active?"bg-[#ffffff] ":"")+(b?"opacity-35":"opacity-100"),children:jsxRuntimeExports.jsx("img",{src:h.icon,alt:"ring",className:"w-full h-full object-cover"})})]})};function RingsWrapper(){const h=reactExports.useRef(null),o=reactExports.useRef(null),c=useMotionValue(0),[d,_]=reactExports.useState(!1),{rings:v}=useUi(),[b,tt]=reactExports.useState(0),[it,nt]=reactExports.useState(0),[lt,ut]=reactExports.useState(Math.floor(v.length/2));reactExports.useEffect(()=>{!h.current||!o.current||(tt(h.current.clientWidth),nt(o.current.clientWidth))},[h.current,o.current]),reactExports.useEffect(()=>{console.log(b)},[b]);const ht=reactExports.useCallback(_t=>{if(!h.current||d)return;const ft=h.current.getBoundingClientRect(),bt=ft.left+ft.width/2-_t.clientX;let xt=c.get()+bt;xt=Math.round(bt/it)*it,c.set(xt),console.log(xt,"clicked");let St=-Math.round(xt/it)+Math.floor(v.length/2);St<0&&(St=0),St>=v.length&&(St=v.length-1),ut(St)},[c,d,it,h.current]);return jsxRuntimeExports.jsxs("div",{className:"w-full flex justify-center items-center relative",children:[jsxRuntimeExports.jsx("div",{className:"absolute left-1/2 top-1/2 border-4 pointer-events-none border-primary rounded-full w-20 h-20 -translate-x-1/2 -translate-y-1/2 z-10"}),jsxRuntimeExports.jsx(motion.div,{onClick:ht,ref:h,drag:"x",_dragX:c,style:{x:c},dragConstraints:{left:-b/2+it/2,right:b/2-it/2},onDragTransitionEnd:()=>{_(!1)},onDragStart:()=>{_(!0)},dragTransition:{power:.1,timeConstant:200,modifyTarget:_t=>{const ft=Math.round(_t/it)*it;let bt=-Math.round(ft/it)+Math.floor(v.length/2);return bt<0&&(bt=0),bt>=v.length&&(bt=v.length-1),ut(bt),ft}},className:"flex w-fit justify-center items-center p-3 px-0",children:v.map((_t,ft)=>jsxRuntimeExports.jsx(RingOption,{active:ft===lt,refrence:ft===0?o:void 0,ringUrl:_t.ringUrl,configUrl:_t.configUrl,icon:_t.icon},ft))})]})}const ConfigOption=h=>{const o=reactExports.useRef(null);return jsxRuntimeExports.jsx("div",{id:h.selected?"selectedOption":"",ref:o,onClick:h.onClick,className:"flex justify-start items-center flex-col cursor-pointer relative md:h-unit-3xl md:w-unit-3xl h-[30px] w-[30px] shrink-0 "+h.className,children:jsxRuntimeExports.jsxs("div",{className:"relative w-full h-full"+(h.rect?" w-32":" "),children:[h.loading&&jsxRuntimeExports.jsx(Spinner,{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 h-full w-full p-1"}),jsxRuntimeExports.jsx("img",{src:h.src,className:"  object-fill rounded-full  outline-1 outline hover:outline-primary outline-transparent outline-default-300 transition-all duration-300 opacity-100 h-full  "+(h.selected?" outline outline-primary ":"")+(h.loading?" opacity-50":"")})]})})},metals=[{name:"gold-white",materialUrl:"./materials/metal/gold-white-750.pmat",img:"./materials/metal/gold-white-750.pmat.png"},{name:"gold-yellow",materialUrl:"./materials/metal/gold-yellow-750.pmat",img:"./materials/metal/gold-yellow-750.pmat.png"},{name:"gold-rose",materialUrl:"./materials/metal/gold-rose-750.pmat",img:"./materials/metal/gold-rose-750.pmat.png"}],gems=[{name:"diamond",materialUrl:"./materials/gem/diamond-white-1.dmat",img:"./materials/gem/diamond-white-1.dmat.png"},{name:"ruby",materialUrl:"./materials/gem/ruby-1.dmat",img:"./materials/gem/ruby-1.dmat.png"},{name:"sapphire-yellow",materialUrl:"./materials/gem/sapphire-yellow.dmat",img:"./materials/gem/sapphire-yellow.dmat.png"},{name:"sapphire-blue",materialUrl:"./materials/gem/sapphire-blue.dmat",img:"./materials/gem/sapphire-blue.dmat.png"},{name:"emerald-1",materialUrl:"./materials/gem/emerald-1.dmat",img:"./materials/gem/emerald-1.dmat.png"}],Configurator=()=>{const[h,o]=reactExports.useState("none"),{viewer:c}=useUi(),[d,_]=reactExports.useState("gold-white"),[v,b]=reactExports.useState("diamond"),[tt,it]=reactExports.useState(!1),nt=async(lt,ut)=>{if(!c)return;it(!0),ut==="metal"?_(lt.name):b(lt.name);const ht=c.getPlugin("MaterialPresetPlugin");console.log(ht),ht&&(await ht.apply(ut==="metal"?"Metal":"Gem",lt.materialUrl),it(!1))};return jsxRuntimeExports.jsx(AnimatePresence,{children:jsxRuntimeExports.jsxs(motion.div,{layout:!0,transition:{duration:.1,ease:"easeInOut"},className:"w-fit rounded-full p-2 px-4 flex justify-center items-center bg-[#00000055] gap-2",children:[h==="none"&&jsxRuntimeExports.jsxs("div",{className:"w-full flex justify-center items-center gap-2",children:[jsxRuntimeExports.jsx(motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1*0},children:jsxRuntimeExports.jsx("img",{src:"./icons/metal.svg",alt:"camera",className:"w-8 h-8 p-1 cursor-pointer",onClick:()=>o("metal")})}),jsxRuntimeExports.jsx(motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1*1},children:jsxRuntimeExports.jsx("img",{src:"./icons/diamond.svg",alt:"camera",className:"w-8 h-8 p-1 cursor-pointer",onClick:()=>o("gem")})})]}),h==="metal"&&jsxRuntimeExports.jsx("div",{className:"w-full flex justify-center items-center gap-2",children:metals.map((lt,ut)=>jsxRuntimeExports.jsx(motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1*ut},children:jsxRuntimeExports.jsx(ConfigOption,{selected:d===lt.name,loading:d===lt.name&&tt,onClick:()=>nt(lt,"metal"),src:lt.img,name:lt.name},lt.name+ut)},lt.name+ut+"container"))}),h==="gem"&&jsxRuntimeExports.jsx("div",{className:"w-full flex justify-center items-center gap-2",children:gems.map((lt,ut)=>jsxRuntimeExports.jsx(motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1*ut},children:jsxRuntimeExports.jsx(ConfigOption,{selected:v===lt.name,loading:v===lt.name&&tt,onClick:()=>nt(lt,"gem"),src:lt.img,name:lt.name},lt.name+ut)},lt.name+ut+"container"))}),h!=="none"&&jsxRuntimeExports.jsx("div",{className:"w-full flex justify-center items-center",children:jsxRuntimeExports.jsx("img",{src:"./icons/cancel.svg",alt:"close",className:"w-8 h-8 cursor-pointer",onClick:()=>o("none")})})]})})},SettingsButton=h=>jsxRuntimeExports.jsxs("div",{onClick:h.onClick,className:"flex flex-col justify-center items-center text-primary hover:text-secondary transition duration-200 "+(h.isActive?"text-secondary":""),children:[jsxRuntimeExports.jsx("div",{className:"cursor-pointer "+(h.text?"w-8 h-8":"w-10 h-10 "),children:h.img}),h.text&&jsxRuntimeExports.jsx("p",{className:" text-xs text-center",children:h.text})]}),ArrowDownIcon=h=>jsxRuntimeExports.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 38 43",style:{width:"100%",height:"100%"},fill:"none",className:h.className,children:[jsxRuntimeExports.jsxs("g",{filter:"url(#a)",children:[jsxRuntimeExports.jsx("mask",{id:"b",x:0,y:3,maskUnits:"userSpaceOnUse",style:{maskType:"alpha"},children:jsxRuntimeExports.jsx("path",{fill:"#D9D9D9",d:"M.23 3.241h37.512v37.512H.23z"})}),jsxRuntimeExports.jsx("g",{mask:"url(#b)",children:jsxRuntimeExports.jsx("path",{fill:"currentColor",d:"m18.466 36.635-10.698-10.7 2.14-2.179 7.03 7.032V19.82h3.057v10.968l7.03-6.994 2.14 2.14-10.699 10.701Zm-1.528-19.872v-4.587h3.057v4.586h-3.057Zm0-7.644V6.062h3.057v3.057h-3.057Z"})})]}),jsxRuntimeExports.jsx("defs",{children:jsxRuntimeExports.jsxs("filter",{id:"a",x:2.168,y:.462,colorInterpolationFilters:"sRGB",filterUnits:"userSpaceOnUse",children:[jsxRuntimeExports.jsx("feFlood",{floodOpacity:0,result:"BackgroundImageFix"}),jsxRuntimeExports.jsx("feColorMatrix",{in:"SourceAlpha",result:"hardAlpha",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"}),jsxRuntimeExports.jsx("feOffset",{}),jsxRuntimeExports.jsx("feGaussianBlur",{stdDeviation:2.8}),jsxRuntimeExports.jsx("feComposite",{in2:"hardAlpha",operator:"out"}),jsxRuntimeExports.jsx("feColorMatrix",{values:"0 0 0 0 0.0772917 0 0 0 0 0.08505 0 0 0 0 0.0875 0 0 0 1 0"}),jsxRuntimeExports.jsx("feBlend",{in2:"BackgroundImageFix",result:"effect1_dropShadow_196_816"}),jsxRuntimeExports.jsx("feBlend",{in:"SourceGraphic",in2:"effect1_dropShadow_196_816",result:"shape"})]})})]}),Slider=h=>jsxRuntimeExports.jsx(motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,ease:"easeInOut"},className:"w-full px-4 text-white",children:jsxRuntimeExports.jsx("input",{type:"range",step:h.step,min:h.min,max:h.max,value:h.value,onChange:o=>h.setSliderValue(Number(o.currentTarget.value)),className:"slider",id:"myRange"})}),CameraIcon=()=>jsxRuntimeExports.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 53 56",style:{width:"100%",height:"100%"},children:[jsxRuntimeExports.jsxs("g",{filter:"url(#aa)",children:[jsxRuntimeExports.jsx("mask",{id:"bb",x:0,y:2,maskUnits:"userSpaceOnUse",style:{maskType:"alpha"},children:jsxRuntimeExports.jsx("path",{fill:"#D9D9D9",d:"M.395 2.973h51.609v51.618H.395z"})}),jsxRuntimeExports.jsx("g",{fill:"currentColor",mask:"url(#bb)",children:jsxRuntimeExports.jsx("path",{d:"M19.812 8.625c.33.247.738.37 1.227.37H31.36c.488 0 .896-.123 1.226-.37.33-.248.494-.554.494-.92 0-.367-.165-.673-.494-.92-.33-.247-.738-.37-1.226-.37H21.039c-.489 0-.897.123-1.227.37-.329.247-.494.553-.494.92 0 .366.165.672.494.92ZM26.499 24.756h14.556c-.883-2.317-2.263-4.335-4.137-6.056-1.874-1.72-4.02-2.9-6.435-3.538l-4.774 8.214a.827.827 0 0 0 0 .92c.186.306.449.46.79.46Zm-6.75 2.605c.186.306.448.46.788.46s.604-.154.79-.46l7.332-12.595a11.15 11.15 0 0 0-1.23-.152c-.454-.033-.864-.05-1.23-.05-2.19 0-4.232.415-6.124 1.245a17.264 17.264 0 0 0-5.03 3.338l4.704 8.214Zm-8.987 7.126h9.477c.336 0 .603-.153.802-.46.198-.306.204-.613.018-.92L13.804 20.55a16.75 16.75 0 0 0-2.605 4.608c-.623 1.672-.935 3.454-.935 5.346a15.86 15.86 0 0 0 .498 3.984Zm11.193 11.356 4.743-8.214c.186-.307.18-.613-.018-.92-.199-.306-.466-.46-.802-.46H11.344c.884 2.317 2.27 4.336 4.157 6.056 1.887 1.72 4.039 2.9 6.454 3.538Zm4.245.598c2.19 0 4.233-.415 6.125-1.245a17.264 17.264 0 0 0 5.03-3.337l-4.704-8.215c-.186-.306-.449-.46-.789-.46s-.603.154-.79.46l-7.293 12.56c.365.078.76.138 1.185.178.426.039.837.059 1.236.059Zm12.396-5.985a17.567 17.567 0 0 0 2.566-4.603c.649-1.708.973-3.49.973-5.35a15.86 15.86 0 0 0-.498-3.985H32.16c-.336 0-.603.153-.801.46-.199.306-.205.613-.019.92l7.256 12.558ZM26.194 49.43c-2.59 0-5.036-.496-7.337-1.489-2.3-.993-4.31-2.348-6.026-4.066-1.718-1.718-3.073-3.727-4.066-6.028-.992-2.3-1.489-4.746-1.489-7.337 0-2.623.498-5.08 1.492-7.37.995-2.291 2.35-4.294 4.063-6.008 1.713-1.713 3.722-3.068 6.026-4.063 2.303-.995 4.749-1.492 7.337-1.492 2.619 0 5.074.497 7.366 1.492s4.295 2.35 6.009 4.063c1.713 1.714 3.067 3.717 4.062 6.007.995 2.291 1.492 4.748 1.492 7.37 0 2.592-.497 5.039-1.492 7.341-.995 2.303-2.349 4.31-4.062 6.025-1.714 1.714-3.716 3.068-6.006 4.063-2.29.995-4.747 1.492-7.37 1.492Z"})})]}),jsxRuntimeExports.jsx("defs",{children:jsxRuntimeExports.jsxs("filter",{id:"aa",x:1.676,y:.814,colorInterpolationFilters:"sRGB",filterUnits:"userSpaceOnUse",children:[jsxRuntimeExports.jsx("feFlood",{floodOpacity:0,result:"BackgroundImageFix"}),jsxRuntimeExports.jsx("feColorMatrix",{in:"SourceAlpha",result:"hardAlpha",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"}),jsxRuntimeExports.jsx("feOffset",{}),jsxRuntimeExports.jsx("feGaussianBlur",{stdDeviation:2.8}),jsxRuntimeExports.jsx("feComposite",{in2:"hardAlpha",operator:"out"}),jsxRuntimeExports.jsx("feColorMatrix",{values:"0 0 0 0 0.0772917 0 0 0 0 0.08505 0 0 0 0 0.0875 0 0 0 1 0"}),jsxRuntimeExports.jsx("feBlend",{in2:"BackgroundImageFix",result:"effect1_dropShadow_196_599"}),jsxRuntimeExports.jsx("feBlend",{in:"SourceGraphic",in2:"effect1_dropShadow_196_599",result:"shape"})]})})]}),CameraZoomIcon=()=>jsxRuntimeExports.jsx("svg",{className:"p-1",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 28 29",fill:"none",style:{width:"100%",height:"100%"},children:jsxRuntimeExports.jsx("path",{fill:"currentColor",d:"M14.22 10.036h10.718a11.59 11.59 0 0 0-3.046-4.458 11.12 11.12 0 0 0-4.739-2.605L13.64 9.02a.609.609 0 0 0 0 .677c.136.226.33.339.581.339Zm-4.97 1.918c.137.225.33.338.58.338.251 0 .445-.113.582-.338l5.399-9.272a8.218 8.218 0 0 0-.906-.112A12.54 12.54 0 0 0 14 2.533c-1.613 0-3.117.306-4.51.917a12.71 12.71 0 0 0-3.703 2.457l3.463 6.047ZM2.633 17.2h6.978c.248 0 .444-.113.59-.338a.592.592 0 0 0 .014-.677L4.873 6.939a12.334 12.334 0 0 0-1.918 3.392 11.178 11.178 0 0 0-.688 3.936 11.675 11.675 0 0 0 .366 2.933Zm8.242 8.36 3.492-6.047a.592.592 0 0 0-.014-.677c-.146-.226-.343-.339-.59-.339H3.062c.65 1.706 1.67 3.192 3.06 4.458a11.224 11.224 0 0 0 4.753 2.605ZM14 26c1.613 0 3.117-.306 4.51-.917a12.709 12.709 0 0 0 3.703-2.456l-3.463-6.048a.644.644 0 0 0-.58-.338.646.646 0 0 0-.582.338l-5.37 9.246c.268.058.56.102.872.131.313.03.617.044.91.044Zm9.127-4.406a12.933 12.933 0 0 0 1.89-3.389c.477-1.257.716-2.57.716-3.938a11.677 11.677 0 0 0-.366-2.934h-6.978c-.248 0-.444.113-.59.339a.592.592 0 0 0-.014.677l5.342 9.245ZM13.996 28.2c-1.908 0-3.709-.366-5.402-1.096a14.12 14.12 0 0 1-4.438-2.994 14.12 14.12 0 0 1-2.993-4.437A13.488 13.488 0 0 1 .067 14.27c0-1.93.366-3.74 1.098-5.426a14.172 14.172 0 0 1 2.991-4.422 14.126 14.126 0 0 1 4.437-2.991A13.482 13.482 0 0 1 13.995.333c1.929 0 3.737.366 5.425 1.099a14.167 14.167 0 0 1 4.424 2.991 14.173 14.173 0 0 1 2.99 4.422c.733 1.687 1.1 3.495 1.1 5.426 0 1.907-.367 3.709-1.1 5.404a14.131 14.131 0 0 1-2.99 4.435 14.172 14.172 0 0 1-4.423 2.991c-1.686.733-3.495 1.099-5.425 1.099Z"})}),FlipCameraIcon=()=>jsxRuntimeExports.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",style:{width:"100%",height:"100%"},viewBox:"0 0 51 52",fill:"none",children:[jsxRuntimeExports.jsx("ellipse",{cx:25.473,cy:26.304,fill:"#000",fillOpacity:.4,rx:25.473,ry:25.478}),jsxRuntimeExports.jsx("g",{clipPath:"url(#a)",filter:"url(#b)",children:jsxRuntimeExports.jsx("path",{fill:"currentColor",d:"M33.538 13.254a.832.832 0 1 0-1.177 1.176l1.906 1.904H15.506a3.322 3.322 0 0 0-3.323 3.323v10.8a.83.83 0 1 0 1.661 0v-10.8a1.661 1.661 0 0 1 1.662-1.661h18.76L32.362 19.9a.832.832 0 0 0 1.177 1.177l3.322-3.324a.83.83 0 0 0 0-1.176l-3.322-3.323Zm1.903 21.358a1.661 1.661 0 0 0 1.662-1.662v-10.8a.831.831 0 0 1 1.661 0v10.8a3.324 3.324 0 0 1-3.323 3.323h-18.76l1.905 1.904a.832.832 0 0 1-1.176 1.177l-3.323-3.323a.83.83 0 0 1 0-1.177l3.323-3.323a.83.83 0 0 1 1.42.588.832.832 0 0 1-.244.589l-1.906 1.904h18.761Zm-4.984-8.308a4.985 4.985 0 0 1-8.508 3.525 4.985 4.985 0 1 1 8.508-3.525Zm-1.66 0a3.323 3.323 0 1 0-6.648 0 3.323 3.323 0 0 0 6.647 0Z"})}),jsxRuntimeExports.jsxs("defs",{children:[jsxRuntimeExports.jsx("clipPath",{id:"a",children:jsxRuntimeExports.jsx("path",{fill:"currentColor",d:"M8.86 9.688h33.226V42.92H8.86z"})}),jsxRuntimeExports.jsxs("filter",{id:"b",width:37.781,height:37.788,x:6.583,y:7.41,colorInterpolationFilters:"sRGB",filterUnits:"userSpaceOnUse",children:[jsxRuntimeExports.jsx("feFlood",{floodOpacity:0,result:"BackgroundImageFix"}),jsxRuntimeExports.jsx("feColorMatrix",{in:"SourceAlpha",result:"hardAlpha",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"}),jsxRuntimeExports.jsx("feOffset",{}),jsxRuntimeExports.jsx("feGaussianBlur",{stdDeviation:2.8}),jsxRuntimeExports.jsx("feComposite",{in2:"hardAlpha",operator:"out"}),jsxRuntimeExports.jsx("feColorMatrix",{values:"0 0 0 0 0.0772917 0 0 0 0 0.08505 0 0 0 0 0.0875 0 0 0 1 0"}),jsxRuntimeExports.jsx("feBlend",{in2:"BackgroundImageFix",result:"effect1_dropShadow_196_793"}),jsxRuntimeExports.jsx("feBlend",{in:"SourceGraphic",in2:"effect1_dropShadow_196_793",result:"shape"})]})]})]}),FingerSelectionIcon=()=>jsxRuntimeExports.jsx("svg",{"data-slot":"icon",fill:"none",strokeWidth:"1.5",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10.05 4.575a1.575 1.575 0 1 0-3.15 0v3m3.15-3v-1.5a1.575 1.575 0 0 1 3.15 0v1.5m-3.15 0 .075 5.925m3.075.75V4.575m0 0a1.575 1.575 0 0 1 3.15 0V15M6.9 7.575a1.575 1.575 0 1 0-3.15 0v8.175a6.75 6.75 0 0 0 6.75 6.75h2.018a5.25 5.25 0 0 0 3.712-1.538l1.732-1.732a5.25 5.25 0 0 0 1.538-3.712l.003-2.024a.668.668 0 0 1 .198-.471 1.575 1.575 0 1 0-2.228-2.228 3.818 3.818 0 0 0-1.12 2.687M6.9 7.575V12m6.27 4.318A4.49 4.49 0 0 1 16.35 15m.002 0h-.002"})});function SettingTabs({setShow:h}){const[o,c]=reactExports.useState(0),{setDigitalZoom:d,digitalZoom:_,cameraZoom:v,setCameraZoom:b,flipCamera:tt,selectPreviousFinger:it,selectNextFinger:nt}=useUi();return jsxRuntimeExports.jsxs("div",{className:"w-full h-full flex flex-col gap-6 justify-center items-center",children:[jsxRuntimeExports.jsxs("div",{className:"w-full flex justify-center items-center gap-4",children:[jsxRuntimeExports.jsx(SettingsButton,{img:jsxRuntimeExports.jsx(ArrowDownIcon,{}),text:"Hide",onClick:()=>h(!1)}),jsxRuntimeExports.jsx(SettingsButton,{img:jsxRuntimeExports.jsx(CameraIcon,{}),text:"Digital Zoom",isActive:o===0,onClick:()=>c(0)}),jsxRuntimeExports.jsx(SettingsButton,{img:jsxRuntimeExports.jsx(CameraZoomIcon,{}),text:"Camera Zoom",isActive:o===1,onClick:()=>c(1)}),jsxRuntimeExports.jsx(SettingsButton,{img:jsxRuntimeExports.jsx(FingerSelectionIcon,{}),text:"Finger",isActive:o===2,onClick:()=>c(2)}),jsxRuntimeExports.jsx(SettingsButton,{onClick:tt,img:jsxRuntimeExports.jsx(FlipCameraIcon,{})})]}),jsxRuntimeExports.jsx(AnimatePresence,{children:jsxRuntimeExports.jsxs("div",{className:"h-10 w-full max-w-96",children:[o===0&&jsxRuntimeExports.jsx(Slider,{step:.1,value:_,setSliderValue:d,min:1,max:5},"digital-zoom"),o===1&&jsxRuntimeExports.jsx(Slider,{step:.1,value:v,setSliderValue:b,min:1,max:5},"camera-zoom"),o===2&&jsxRuntimeExports.jsxs("div",{className:"flex justify-center items-center gap-4",children:[jsxRuntimeExports.jsx("button",{className:"p-2 rounded-md w-32 bg-gray-200",onClick:it,children:"Previous Finger"}),jsxRuntimeExports.jsx("button",{className:"p-2 rounded-md w-32 bg-gray-200",onClick:nt,children:"Next Finger"})]})]})})]})}const Settings=({show:h,setShow:o})=>{const c=useSpring(useMotionValue(0),{duration:.2,mass:.1}),d=useTransform(c,[0,.3,1],[0,0,1]),_=useSpring(useMotionValue(100),{duration:.5,mass:.1}),v=reactExports.useRef(null);return reactExports.useEffect(()=>{h?(v.current&&(v.current.style.pointerEvents="auto"),setTimeout(()=>{},400),c.set(1,!0),_.set(0,!0)):(setTimeout(()=>{v.current&&(v.current.style.pointerEvents="none")},400),c.set(0,!0),_.set(100,!0))},[h]),jsxRuntimeExports.jsxs("div",{className:"w-full h-fit relative",children:[jsxRuntimeExports.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 bottom-0 transition-all duration-200 ease-out "+(h?"-translate-y-20 opacity-0 pointer-events-none":"translate-y-0 opacity-100 pointer-events-auto"),children:jsxRuntimeExports.jsx(SettingsButton,{onClick:()=>o(!0),img:jsxRuntimeExports.jsx(ArrowDownIcon,{className:"rotate-180"}),text:"Show"})}),jsxRuntimeExports.jsxs(motion.div,{ref:v,style:{opacity:d,y:_},transition:{duration:.2,ease:"easeInOut"},className:"w-full h-full flex flex-col gap-4 justify-center items-center opacity-0 pointer-events-none",children:[jsxRuntimeExports.jsx(Configurator,{}),jsxRuntimeExports.jsx(SettingTabs,{setShow:o})]})]})};function Share(){const{viewer:h,image:o}=useUi(),c=reactExports.useCallback(()=>{h.renderEnabled=!0;const _=document.getElementById("ui-wrapper");_&&(_.style.opacity="1",_.style.pointerEvents="auto");const v=document.getElementById("share");v&&(v.style.opacity="0",v.style.pointerEvents="none")},[]),d=reactExports.useCallback(async()=>{const _=await(await fetch(o)).blob(),v=new File([_],"fileName.jpeg",{type:_.type});navigator.share({title:"Hello",text:"Check out this image!",files:[v]})},[o]);return jsxRuntimeExports.jsxs("div",{className:"absolute z-10 opacity-0 gap-4 pointer-events-none w-full h-fit flex flex-col justify-center items-center bottom-7 transition-opacity duration-200",id:"share",children:[jsxRuntimeExports.jsx(SettingsButton,{onClick:c,img:jsxRuntimeExports.jsx(ArrowDownIcon,{className:"rotate-90"}),text:"back"}),jsxRuntimeExports.jsx("p",{className:"text-white",children:"Share this moment!"}),jsxRuntimeExports.jsx("button",{onClick:d,className:"w-40 h-10 bg-primary rounded-full active:bg-secondary text-black font-bold",children:"Share"})]})}const Logo="https://tiexbrasil.com.br/logo.svg",Intro=h=>{const{handleStartAR:o,viewer:c}=useUi(),d=reactExports.useRef(null),[_,v]=reactExports.useState(!0),[b,tt]=reactExports.useState(!1),[it,nt]=reactExports.useState(!1),lt=reactExports.useCallback(()=>{v(!0),d.current&&(d.current.style.pointerEvents="none",d.current.style.backgroundColor="#00000090");const ut=ht=>{console.log("Error",ht.detail),v(!1),tt(!0),nt(!1),d.current&&(d.current.style.backgroundColor="transparent",d.current.style.opacity="1"),h.setShowUi(!1),window.removeEventListener("tryonRunTimeError",ut)};window.addEventListener("tryonRunTimeError",ut),o().then(ht=>{if(!ht){v(!1),tt(!0),d.current&&(d.current.style.backgroundColor="transparent"),console.error("AR did not start");return}console.log("AR started"),nt(!0),tt(!1),v(!1),h.setShowUi(!0),d.current&&(d.current.style.opacity="0",setTimeout(()=>{d.current.style.pointerEvents="none"},200))})},[d.current]);return reactExports.useEffect(()=>{if(!c)return;const ut=()=>{v(!1),c.scene.removeEventListener("addSceneObject",ut)};c.scene.addEventListener("addSceneObject",ut)},[c]),jsxRuntimeExports.jsxs("div",{ref:d,className:"absolute z-50 pointer-events-none flex justify-center items-center flex-col gap-8 py-12 w-full h-full top-0 transition-opacity duration-200",children:[jsxRuntimeExports.jsx("img",{src:Logo,alt:"logo",className:"w-48 h-32 object-contain"}),jsxRuntimeExports.jsx("div",{className:"flex-1"}),!it&&jsxRuntimeExports.jsx("button",{onClick:lt,className:"w-fit h-10 rounded-full flex justify-center items-center text-black font-bold "+(_?" bg-transparent border-2 border-white transition-all duration-150 px-2 pointer-events-none ":"bg-primary px-14 pointer-events-auto"),children:_?jsxRuntimeExports.jsx(Spinner,{className:"h-6 w-6 text-secondary "}):b?"Try Again":"Start"})]})};function App(){const[h,o]=reactExports.useState(!1),{setDigitalZoom:c}=useUi(),[d,_]=reactExports.useState(!1),v=reactExports.useCallback(()=>{c(1),console.log("User Swiped up!"),o(!0)},[o]),b=reactExports.useCallback(()=>{console.log("User Swiped down!"),o(!1)},[o]),tt=useSwipeable({trackMouse:!0,swipeDuration:500,onSwipedUp:v,onSwipedDown:b});return jsxRuntimeExports.jsxs("div",{className:"w-full h-dvh pointer-events-none overflow-hidden bg-transparent font-main font-light relative",children:[jsxRuntimeExports.jsx(Intro,{setShowUi:_}),d&&jsxRuntimeExports.jsxs("div",{className:"w-full pointer-events-auto h-dvh overflow-hidden flex bg-transparent font-main font-light relative",children:[jsxRuntimeExports.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 top-5",children:jsxRuntimeExports.jsx("img",{src:"https://tiexbrasil.com.br/logo.svg",alt:"TieX Brasil",className:"w-20 h-12 object-contain"})}),jsxRuntimeExports.jsx(Share,{}),jsxRuntimeExports.jsxs("div",{...tt,className:"w-full h-full flex flex-col transition-opacity opacity-100",id:"ui-wrapper",children:[jsxRuntimeExports.jsx("div",{className:"flex-1 pointer-events-none"}),jsxRuntimeExports.jsx(Settings,{show:h,setShow:o}),jsxRuntimeExports.jsx(RingsWrapper,{})]})]})]})}const By=class extends __webpackgi_exports__AViewerPlugin{constructor(o){super(),this.enabled=!0,this._started=!1,this._fingerIndex=0,this.start=async()=>{var c;if(!this._viewer)return;const d=new URLSearchParams(window.location.search).has("disableInstore"),_=window.ij_vto.InstoreRingTryonPlugin,v=_&&!d&&await _.isAvailable();let b=_;if(!v){await((c=this.viewer)==null?void 0:c.addPlugin(window.ij_vto.RingTryonUIPlugin));const{RingTryonPlugin:it}=window.ij_vto;b=it}if(this._ringTryonPlugin=await this._viewer.getOrAddPlugin(b),!this._ringTryonPlugin)return;this._started=this._ringTryonPlugin.running;const tt=this._started;if(tt||(await this._ringTryonPlugin.start(),this._started=this._ringTryonPlugin.running),!tt)return this._started;this._ringTryonPlugin.running&&this._ringTryonPlugin.selectNextCamera()},this.loadRing=async(c,d)=>{var bt,xt,St,wt,Pt,Rt,kt,Gt,Dt;var _,v,b,tt,it,nt,lt,ut,ht;if(this._currentRingUrl=c,!this._viewer)return;(_=this._viewer)==null||_.scene.modelRoot.clear(),(b=(v=this._viewer)==null?void 0:v.getPlugin(__webpackgi_exports__DiamondPlugin))==null||b.disposeAllCacheMaps(),console.log("loading ring",c,this._viewer);let _t=null;try{d&&(_t=await fetch(d).then(It=>It.json()))}catch(It){console.warn("Error loading ring config",It)}const ft=await((nt=(it=(tt=this._viewer)==null?void 0:tt.getManager())==null?void 0:it.importer)==null?void 0:nt.importSinglePath(c,{forceImport:!0}));if(ft)if(this._currentRingUrl===c){_t&&(this._ringTryonPlugin.modelScaleFactor=_t.modelScaleFactor,this._ringTryonPlugin.modelPosition=new __webpackgi_exports__Vector3(_t.modelPosition.x,_t.modelPosition.y,_t.modelPosition.z),this._ringTryonPlugin.modelRotation=new __webpackgi_exports__Vector3(_t.modelRotation.x,_t.modelRotation.y,_t.modelRotation.z));const It=ft.modelObject;It.userData.finger=this._fingerIndex,It.visible=!0,this._ringTryonPlugin&&this._ringTryonPlugin.modelRoot?(It.name=It.name||"RingObject",It.userData.isRing=!0,It.userData.ringType="band",this._ringTryonPlugin.modelRoot.add(It),console.log("Ring added to VTO plugin modelRoot"),this._ringTryonPlugin.setDirty&&this._ringTryonPlugin.setDirty(),this._ringTryonPlugin.refresh&&this._ringTryonPlugin.refresh()):((lt=this._viewer)==null||lt.scene.modelRoot.add(It),console.log("Ring added to scene modelRoot as fallback")),_t&&(_t.modelPosition&&(It.position.set(_t.modelPosition.x,_t.modelPosition.y,_t.modelPosition.z),console.log("Applied position:",_t.modelPosition)),_t.modelRotation&&(It.rotation.set(_t.modelRotation.x,_t.modelRotation.y,_t.modelRotation.z),console.log("Applied rotation:",_t.modelRotation,"in radians"),console.log("Rotation in degrees:",{x:_t.modelRotation.x*57.2958,y:_t.modelRotation.y*57.2958,z:_t.modelRotation.z*57.2958})),_t.modelScaleFactor&&(It.scale.setScalar(_t.modelScaleFactor),console.log("Applied scale:",_t.modelScaleFactor))),console.log("=== FORANDO ROTAO PARA ANEL ==="),It.rotation.set(1.5708,1.5,0),It.position.set(0,0,0),It.scale.setScalar(.48),console.log("ROTAO FORADA:",It.rotation),console.log("POSIO FORADA:",It.position),console.log("ESCALA FORADA:",It.scale);const Nt=()=>{It&&It.rotation&&(It.rotation.set(1.5708,1.5,0),console.log("REFORANDO ROTAO:",It.rotation))};setTimeout(Nt,100),setTimeout(Nt,500),setTimeout(Nt,1e3),console.log("=== BASE RING DEBUG ==="),console.log("Ring URL:",c),console.log("Ring config:",_t),console.log("Ring object:",It),console.log("Ring added to scene. Children count:",(wt=(St=(xt=(bt=this._viewer)==null?void 0:bt.scene)==null?void 0:xt.modelRoot)==null?void 0:St.children)==null?void 0:wt.length),console.log("VTO plugin modelRoot children:",(kt=(Rt=(Pt=this._ringTryonPlugin)==null?void 0:Pt.modelRoot)==null?void 0:Rt.children)==null?void 0:kt.length),console.log("Ring visible:",It.visible),console.log("Ring userData:",It.userData),console.log("Ring position:",It.position),console.log("Ring scale:",It.scale),console.log("======================"),this._viewer&&this._viewer.scene&&this._viewer.scene.setDirty(),this._ringTryonPlugin&&this._ringTryonPlugin.setDirty&&this._ringTryonPlugin.setDirty(),await new Promise(Kt=>setTimeout(Kt,100));const Vt=(ut=this._viewer)==null?void 0:ut.getPlugin("MaterialPresetPlugin");if(console.log("MaterialPresetPlugin found:",!!Vt),console.log("Applying material to:",c),c.includes("base.glb")||c.includes("base-2.glb")){console.log("Applying premium silver material for Anel N Elegante"),console.log("Using position/scale/rotation from base.json config"),console.log("=== APLICAO FORADA DE MATERIAL ==="),console.log(" CONFIG COMPLETA:",_t),console.log(" PROPERTIES:",_t.properties),console.log(" METAL:",(Gt=_t.properties)==null?void 0:Gt.metal),console.log(" STONES:",(Dt=_t.properties)==null?void 0:Dt.stones);try{let Kt=!1;if(It.traverse(Yt=>{var nr,rr,lr,or,pr,hr,ur,cr,br,fr,kr,gr,tr,dr,Ir,Xr,Jr;if(Yt.isMesh&&Yt.material){const on=Array.isArray(Yt.material);console.log("  array de materiais?",on),console.log(" Tipo do material:",typeof Yt.material),console.log("=== MATERIAL DEBUG ==="),console.log("Processing mesh:",Yt.name||"unnamed"),console.log("Original material color:",Yt.material.color.getHex()),console.log("Material type:",Yt.material.type),console.log("Material UUID:",Yt.material.uuid);const Pn=(Yt.name||"").toLowerCase(),vn=(Yt.material.name||"").toLowerCase(),Gn=Pn.includes("stone")||Pn.includes("gem")||Pn.includes("diamond")||Pn.includes("zirconia")||Pn.includes("crystal")||Pn.includes("sphere")||Pn.includes("ball")||Pn.includes("dot")||vn.includes("stone")||vn.includes("gem")||vn.includes("crystal")||vn.includes("white")||vn.includes("bright")||vn.includes("clear")||((rr=(nr=Yt.geometry)==null?void 0:nr.boundingSphere)==null?void 0:rr.radius)&&Yt.geometry.boundingSphere.radius<.02||Yt.position&&Yt.position.y>.01||((pr=(or=(lr=Yt.geometry)==null?void 0:lr.attributes)==null?void 0:or.position)==null?void 0:pr.count)&&Yt.geometry.attributes.position.count<100;console.log("=== DETECO DEBUG ==="),console.log("Child name:",Pn),console.log("Material name:",vn),console.log("Geometry radius:",(ur=(hr=Yt.geometry)==null?void 0:hr.boundingSphere)==null?void 0:ur.radius),console.log("Position Y:",(cr=Yt.position)==null?void 0:cr.y),console.log("Vertex count:",(kr=(fr=(br=Yt.geometry)==null?void 0:br.attributes)==null?void 0:fr.position)==null?void 0:kr.count),console.log("Is stone detected:",Gn),console.log("======================"),on?(console.log(" LIMPANDO MLTIPLOS MATERIAIS..."),Yt.material.forEach(Ur=>{Ur&&Ur.dispose&&Ur.dispose()})):(console.log(" LIMPANDO MATERIAL NICO..."),Yt.material&&Yt.material.dispose&&Yt.material.dispose());const ms=((gr=_t.properties)==null?void 0:gr.metal)||{},ar=((dr=(tr=_t.properties)==null?void 0:tr.stones)==null?void 0:dr.main_diamonds)||{},vr=c.includes("base.glb");let Cr;if(Gn){console.log(" CRIANDO MATERIAL ULTRA-REALISTA PARA ZIRCNIA...");const Ur=((Xr=(Ir=_t.properties)==null?void 0:Ir.stones)==null?void 0:Xr.main_diamonds)||{},Pr=__webpackgi_exports__MeshPhysicalMaterial||__webpackgi_exports__MeshStandardMaterial;Cr=new Pr({color:parseInt((Ur.color||"#F8FFFE").replace("#","0x")),metalness:0,roughness:.005,envMapIntensity:8,ior:2.42,transmission:.95,transparency:1,thickness:.5,clearcoat:1,clearcoatRoughness:0,dispersion:.025,sheen:1,sheenRoughness:0,sheenColor:16777215,emissive:1118498,emissiveIntensity:.05,reflectivity:.9,refractionRatio:.98,transparent:!0,opacity:.98,side:__webpackgi_exports__DoubleSide||2}),console.log(" ZIRCNIA ULTRA-REALISTA CRIADA")}else{console.log(" CRIANDO MATERIAL ULTRA-REALISTA PARA PRATA...");const Ur=((Jr=_t.properties)==null?void 0:Jr.metal)||{},Pr=__webpackgi_exports__MeshPhysicalMaterial||__webpackgi_exports__MeshStandardMaterial;Cr=new Pr({color:parseInt((Ur.color||"#F6F6F4").replace("#","0x")),metalness:Ur.metalness||.98,roughness:Ur.roughness||.04,envMapIntensity:Ur.envMapIntensity||4.2,clearcoat:Ur.clearcoat||.92,clearcoatRoughness:Ur.clearcoatRoughness||.015,sheen:.4,sheenRoughness:.15,sheenColor:16316664,reflectivity:.92,ior:1.52,anisotropy:.08,anisotropyRotation:Math.PI*.3,emissive:parseInt((Ur.emissive||"#FAFAFA").replace("#","0x")),emissiveIntensity:Ur.emissiveIntensity||.035,flatShading:!1,transparent:!1,opacity:1,specularIntensity:.95,specularColor:16777215}),console.log(" PRATA 925 ULTRA-REALISTA CRIADA - COR:",Ur.color||"#F6F6F4")}try{Yt.material=Cr,Yt.userData=Yt.userData||{},Gn?Yt.userData.isZirconia=!0:Yt.userData.isMetal=!0,console.log(" MATERIAL APLICADO:",Gn?"ZIRCNIA":"PRATA","Mesh:",Yt.name||"unnamed"),console.log(" COR FINAL:",Cr.color.getHex().toString(16).toUpperCase())}catch(Ur){console.error(" Erro ao aplicar material:",Ur),Yt.material=new __webpackgi_exports__MeshStandardMaterial({color:Gn?16777215:12632256,metalness:Gn?0:.9,roughness:Gn?.01:.1,envMapIntensity:Gn?4:2.5})}Cr&&(Cr.needsUpdate=!0,Cr.map&&(Cr.map.needsUpdate=!0),Cr.envMap&&(Cr.envMap.needsUpdate=!0),Cr.transmission!==void 0&&(Cr.needsUpdate=!0),Cr.clearcoat!==void 0&&(Cr.needsUpdate=!0),Cr.sheen!==void 0&&(Cr.needsUpdate=!0)),Yt.visible=!0,Yt.castShadow=!0,Yt.receiveShadow=!0,Yt.geometry&&(Yt.geometry.attributes.normal||Yt.geometry.computeVertexNormals(),(Cr.normalMap||Cr.clearcoat)&&Yt.geometry.computeTangents()),Yt.frustumCulled=!0,Gn?Yt.renderOrder=1:Yt.renderOrder=0,Kt=!0}}),console.log(" Material customizado aplicado com sucesso:",Kt),console.log(" Posio final do anel:",It.position),console.log(" Escala final do anel:",It.scale),console.log(" Rotao final do anel:",It.rotation),this._viewer&&this._viewer.scene){console.log(" Aplicando configuraes avanadas de iluminao...");const Yt=this._viewer.scene,nr=this._viewer.renderer;nr&&nr.shadowMap&&(nr.shadowMap.enabled=!0,nr.shadowMap.type=__webpackgi_exports__PCFSoftShadowMap||2,nr.shadowMap.autoUpdate=!0),nr&&(nr.toneMapping=__webpackgi_exports__ACESFilmicToneMapping||4,nr.toneMappingExposure=1.2,nr.physicallyCorrectLights=!0),Yt.environment&&(Yt.environmentIntensity=1.5,It.traverse(rr=>{rr.isMesh&&rr.material&&!rr.material.envMap&&(rr.material.envMap=Yt.environment,rr.material.needsUpdate=!0)})),console.log(" Configuraes de iluminao aplicadas para mximo realismo")}console.log("Skipping MaterialPresetPlugin to preserve custom materials")}catch(Kt){console.log("Error applying custom material:",Kt)}}else console.log("Skipping diamond material - not base.glb")}else ft.modelObject.dispose(),(ht=ft.dispose)==null||ht.call(ft)},this.flipCamera=()=>{var c;(c=this._ringTryonPlugin)==null||c.flipCamera()},this.clickImage=()=>this._viewer?this._viewer.canvas.toDataURL("image/jpeg"):void 0,this.ControlComponent=()=>{const{digitalZoom:c,cameraZoom:d,fingerIndex:_}=useUi();return reactExports.useEffect(()=>{this.digitalZoom=c},[c]),reactExports.useEffect(()=>{this.cameraZoom=d},[d]),reactExports.useEffect(()=>{this.fingerIndex=_},[_]),jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{})},this.rings=o||[]}get digitalZoom(){var o;return((o=this._ringTryonPlugin)==null?void 0:o.videoScale)??1}set digitalZoom(o){this._ringTryonPlugin&&(this._ringTryonPlugin.videoScale=o)}get cameraZoom(){var o;return((o=this._ringTryonPlugin)==null?void 0:o.cameraZoom)??1}set cameraZoom(o){this._ringTryonPlugin&&(this._ringTryonPlugin.cameraZoom=o)}set fingerIndex(o){var c;this._fingerIndex=o,(c=this._ringTryonPlugin)==null||c.assignMainRingToFinger(o)}get fingerIndex(){return this._fingerIndex}async onAdded(o){await super.onAdded(o);const c=this.createUiContainer();o.container.appendChild(c),client.createRoot(c).render(jsxRuntimeExports.jsxs(UiProvider,{initialValues:{handleStartAR:this.start,digitalZoom:this.digitalZoom,cameraZoom:this.cameraZoom,fingerIndex:this.fingerIndex,loadRing:this.loadRing,viewer:this._viewer,clickImage:this.clickImage,flipCamera:this.flipCamera,rings:this.rings},children:[jsxRuntimeExports.jsx(this.ControlComponent,{}),jsxRuntimeExports.jsx(App,{})]}))}createUiContainer(){const o=document.createElement("div");return o.id="tryon-ui-wrapper",o.style.width="100%",o.style.height="100%",o.style.position="absolute",o.style.top="0",o.style.left="0",o.style.zIndex="100",o.style.pointerEvents="none",o}};By.PluginType="TryOnUiPlugin";let TryOnUiPlugin=By;const rings=[{icon:"./rings/1.png",ringUrl:"./rings/1.glb",configUrl:"./rings/1.json"},{icon:"./rings/2.png",ringUrl:"./rings/2.glb",configUrl:"./rings/2.json"},{icon:"./rings/3.png",ringUrl:"./rings/3.glb",configUrl:"./rings/3.json"},{icon:"./rings/4.png",ringUrl:"./rings/4.glb",configUrl:"./rings/4.json"},{icon:"./rings/5.png",ringUrl:"./rings/5.glb",configUrl:"./rings/5.json"},{icon:"./rings/6.png",ringUrl:"./rings/6.glb",configUrl:"./rings/6.json"},{icon:"./rings/7.png",ringUrl:"./rings/7.glb",configUrl:"./rings/7.json"},{icon:"./rings/base.png",ringUrl:"./rings/base.glb",configUrl:"./rings/base.json"},{icon:"./rings/base-2.png",ringUrl:"./rings/base-2.glb",configUrl:"./rings/base-2.json"}];async function setupViewer(){const{RingTryonPlugin:h,WebCameraBackgroundPlugin:o,WebCameraPlugin:c}=window.ij_vto,d=new __webpackgi_exports__ViewerApp({canvas:document.getElementById("webgi-canvas")}),_=/iPad|iPhone|iPod/.test(navigator.userAgent),v=_?Math.round(window.devicePixelRatio):window.devicePixelRatio,b=_?1:1.5,tt=_?1.4:1.5;d.renderer.displayCanvasScaling=__webpackgi_exports__MathUtils.clamp(v,b,tt),+await d.addPlugin(MaterialPresetPlugin),await __webpackgi_exports__addBasePlugins(d),await d.renderer.refreshPipeline();const it="./lightmap-r-2b.exr",nt=await d.addPlugin(__webpackgi_exports__DiamondPlugin);return nt.envMap=await d.load(it),nt.refreshEnvMaps(),d.renderEnabled=!1,await d.addPlugin(new TryOnUiPlugin(rings)),await d.load("./rings/2.glb"),await d.load("./rings/2.json"),await d.load("./tryon-2-web.json"),d.renderEnabled=!0,(__webpackgi_exports__getUrlQueryParam("debug")!==null||__webpackgi_exports__getUrlQueryParam("edit")!==null)&&(await d.addPlugin(__webpackgi_exports__HierarchyUiPlugin),await d.addPlugin(__webpackgi_exports__PickingPlugin),await d.addPlugin(__webpackgi_exports__CameraUiPlugin),await d.addPlugin(__webpackgi_exports__RendererUiPlugin),(await d.addPlugin(__webpackgi_exports__TweakpaneUiPlugin)).setupPlugins(h,__webpackgi_exports__HierarchyUiPlugin,__webpackgi_exports__PickingPlugin,c,o,__webpackgi_exports__TonemapPlugin,__webpackgi_exports__CameraUiPlugin,__webpackgi_exports__RendererUiPlugin,__webpackgi_exports__SSRPlugin,__webpackgi_exports__SSAOPlugin,__webpackgi_exports__VignettePlugin,__webpackgi_exports__BloomPlugin,__webpackgi_exports__FilmicGrainPlugin,__webpackgi_exports__TemporalAAPlugin,__webpackgi_exports__DiamondPlugin,__webpackgi_exports__DepthOfFieldPlugin)),d}Object.entries(WEBGI).forEach(([h,o])=>{h!=="default"&&!window[h]&&(window[h]=o)});window.webgi=window;document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{console.log("DOM loaded, setting up viewer..."),setupViewer()}):(console.log("DOM already loaded, setting up viewer..."),setupViewer());const main="";
