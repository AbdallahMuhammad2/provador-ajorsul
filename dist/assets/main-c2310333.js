(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const _ of document.querySelectorAll('link[rel="modulepreload"]'))d(_);new MutationObserver(_=>{for(const b of _)if(b.type==="childList")for(const _e of b.addedNodes)_e.tagName==="LINK"&&_e.rel==="modulepreload"&&d(_e)}).observe(document,{childList:!0,subtree:!0});function c(_){const b={};return _.integrity&&(b.integrity=_.integrity),_.referrerPolicy&&(b.referrerPolicy=_.referrerPolicy),_.crossOrigin==="use-credentials"?b.credentials="include":_.crossOrigin==="anonymous"?b.credentials="omit":b.credentials="same-origin",b}function d(_){if(_.ep)return;_.ep=!0;const b=c(_);fetch(_.href,b)}})();(function(){const h=document.createElement("link").relList;if(h&&h.supports&&h.supports("modulepreload"))return;for(const d of document.querySelectorAll('link[rel="modulepreload"]'))c(d);new MutationObserver(d=>{for(const _ of d)if(_.type==="childList")for(const b of _.addedNodes)b.tagName==="LINK"&&b.rel==="modulepreload"&&c(b)}).observe(document,{childList:!0,subtree:!0});function o(d){const _={};return d.integrity&&(_.integrity=d.integrity),d.referrerPolicy&&(_.referrerPolicy=d.referrerPolicy),d.crossOrigin==="use-credentials"?_.credentials="include":d.crossOrigin==="anonymous"?_.credentials="omit":_.credentials="same-origin",_}function c(d){if(d.ep)return;d.ep=!0;const _=o(d);fetch(d.href,_)}})();/*! For license information please see bundle.m.js.LICENSE.txt */var __webpackgi_modules__={774:function(h,o,c){var d=c(364),_=c.n(d)()(function(b){return b[1]});_.push([h.id,'.tippy-box[data-animation=fade][data-state=hidden]{opacity:0}[data-tippy-root]{max-width:calc(100vw - 10px)}.tippy-box{position:relative;background-color:#333;color:#fff;border-radius:4px;font-size:14px;line-height:1.4;white-space:normal;outline:0;transition-property:transform,visibility,opacity}.tippy-box[data-placement^=top]>.tippy-arrow{bottom:0}.tippy-box[data-placement^=top]>.tippy-arrow:before{bottom:-7px;left:0;border-width:8px 8px 0;border-top-color:initial;transform-origin:center top}.tippy-box[data-placement^=bottom]>.tippy-arrow{top:0}.tippy-box[data-placement^=bottom]>.tippy-arrow:before{top:-7px;left:0;border-width:0 8px 8px;border-bottom-color:initial;transform-origin:center bottom}.tippy-box[data-placement^=left]>.tippy-arrow{right:0}.tippy-box[data-placement^=left]>.tippy-arrow:before{border-width:8px 0 8px 8px;border-left-color:initial;right:-7px;transform-origin:center left}.tippy-box[data-placement^=right]>.tippy-arrow{left:0}.tippy-box[data-placement^=right]>.tippy-arrow:before{left:-7px;border-width:8px 8px 8px 0;border-right-color:initial;transform-origin:center right}.tippy-box[data-inertia][data-state=visible]{transition-timing-function:cubic-bezier(0.54, 1.5, 0.38, 1.11)}.tippy-arrow{width:16px;height:16px;color:#333}.tippy-arrow:before{content:"";position:absolute;border-color:rgba(0,0,0,0);border-style:solid}.tippy-content{position:relative;padding:5px 9px;z-index:1}',""]),o.A=_},611:function(h,o,c){var d=c(364),_=c.n(d)()(function(b){return b[1]});_.push([h.id,".loader{width:48px;height:48px;border:5px solid #333;border-bottom-color:rgba(0,0,0,0);border-radius:50%;display:inline-block;box-sizing:border-box;animation:rotation 1s linear infinite}@keyframes rotation{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}",""]),o.A=_},223:function(h,o,c){var d=c(364),_=c.n(d)()(function(b){return b[1]});_.push([h.id,"#assetManagerLoadingBar{z-index:400;position:absolute;top:0;left:0;right:0;width:100%;background-color:rgba(0,0,0,0);height:auto}#assetManagerLoadingBarContent{color:#fff;position:absolute;left:0;right:0;margin:auto;transition:width .5s;background-color:rgba(34,34,34,.6666666667);text-align:center;font-size:.5rem;line-height:.6rem;height:.6rem;border-radius:0 0 .125rem .125rem;border-bottom:#999 1px solid}.processState{font-weight:bold}",""]),o.A=_},646:function(h,o,c){var d=c(364),_=c.n(d)()(function(b){return b[1]});_.push([h.id,'#assetManagerLoadingScreen{z-index:300;position:absolute;bottom:0;right:0;min-width:100%;min-height:100%;color:#333;font-size:1rem;gap:1rem;display:flex;align-content:center;justify-content:center;align-items:center;flex-direction:column;opacity:1;transition:opacity .5s ease-in-out,min-width .5s,min-height .5s,bottom .5s,right .5s;overflow:hidden;background:rgba(0,0,0,0);-webkit-backdrop-filter:blur(16px);backdrop-filter:blur(16px);background-blend-mode:luminosity;--b-opacity: 0.8;--b-background: #ffffff}#assetManagerLoadingScreen::before{content:"";position:absolute;top:0;left:0;width:100%;height:100%;z-index:-1;opacity:var(--b-opacity);background:var(--b-background)}#assetManagerLoadingScreenContent{padding-top:.5rem}.loadingScreenProcessState{font-weight:bold}#assetManagerLoadingScreen.minimizedLoadingScreen{top:unset;left:unset;bottom:2rem;right:2rem;min-width:0;min-height:0;max-width:80vw;max-height:80vh;width:-moz-max-content;width:max-content;height:-moz-max-content;height:max-content;padding:1.5rem;border-radius:.5rem}.loadingScreenFilesElement{min-height:4rem;padding:1rem}.loadingScreenLogoElement{margin-bottom:.5rem;max-width:80%}.loadingScreenLogoElement img{min-height:3rem;max-height:5rem;max-width:100%;-o-object-fit:contain;object-fit:contain}.loadingScreenLogoImage{width:-moz-max-content;width:max-content;height:-moz-max-content;height:max-content}.minimizedLoadingScreen .loadingScreenLoadingElement{display:none}.minimizedLoadingScreen .loadingScreenFilesElement{min-height:0}.minimizedLoadingScreen .loadingScreenLogoElement{min-height:0;display:none}.minimizedLoadingScreen #assetManagerLoadingScreenContent{display:none}',""]),o.A=_},636:function(h,o,c){var d=c(364),_=c.n(d)()(function(b){return b[1]});_.push([h.id,"#assetManagerPopup{z-index:300;position:absolute;bottom:2rem;right:2rem;color:#fff;-webkit-backdrop-filter:blur(16px);backdrop-filter:blur(16px);background-blend-mode:luminosity;background-color:rgba(40,34,60,.6666666667);padding:1.5rem;font-size:1rem;width:-moz-max-content;width:max-content;max-width:80vw;max-height:80vh;overflow-y:scroll;border-radius:.5rem;height:-moz-max-content;height:max-content}#assetManagerPopupClose{position:absolute;top:0;right:0;padding:.5rem;cursor:pointer}#assetManagerPopupContent{padding-top:.5rem}.processState{font-weight:bold}",""]),o.A=_},757:function(h,o,c){var d=c(364),_=c.n(d)()(function(b){return b[1]});_.push([h.id,'.button-bar{background:var(--tp-base-background-color);width:fit-content;width:-moz-fit-content;height:auto;display:flex;flex-direction:row;justify-content:center;flex-wrap:wrap;z-index:200;padding:.25rem .5rem .5rem;border-radius:.5rem;pointer-events:auto;box-shadow:0 2px 4px var(--tp-base-shadow-color);gap:8px;font-size:.85rem;line-height:130%;font-family:Inter,"Roboto Mono","Source Code Pro",Menlo,Courier,monospace;opacity:1;transition:all .25s}.button-bar-button{background-color:rgba(0,0,0,0);cursor:pointer;width:auto;height:auto;font-weight:500;padding:.35rem .5rem;position:relative;-webkit-user-select:none;-moz-user-select:none;user-select:none;color:var(--tp-input-foreground-color, #cccccc);transition:color .25s}.button-bar-button:hover{color:var(--tp-label-foreground-color, #eeeeee)}.button-bar-selected{color:var(--tp-label-foreground-color, #eeeeee)}.button-bar-selected-box{color:var(--tp-label-foreground-color, #eeeeee)}.button-bar>.button-bar-button:not(:last-child)::after{content:"";position:absolute;right:-5px;top:20%;width:2px;height:60%;border-radius:1px;background-color:var(--tp-container-background-color-active, #413762)}.button-bar-button:before{left:50%;width:0;content:"";position:absolute}.button-bar-selected:before{left:25%;width:50%;bottom:0;height:2px;border-radius:1px;background-color:var(--tp-container-foreground-color, #cccccc);transition:width .25s,left .25s}.button-bar-selected-box{background-color:rgba(238,238,238,.3333333333);border-radius:.25rem;transition:all .25s}.round-button{width:1rem;height:1rem;padding:.6rem;background-color:var(--tp-base-background-color);border-radius:1.2rem;color:#ccc;cursor:pointer;box-shadow:0 2px 4px var(--tp-base-shadow-color);transition:all .25s;box-sizing:content-box !important}.round-button:hover{color:#fff}.util-buttons-container{bottom:1.25rem;right:1.25rem;position:absolute;gap:8px;padding:.25rem}.util-button{position:relative;width:auto;height:1.2rem;aspect-ratio:1;box-sizing:content-box !important}.mode-buttons-container{border-top:0;top:0;left:0;right:0;margin-left:auto;margin-right:auto;position:absolute;min-width:6rem;border-radius:0 0 .5rem .5rem;gap:8px;flex-wrap:nowrap !important;overflow-x:scroll;pointer-events:auto;max-width:100%;align-content:center;justify-content:flex-start;align-items:center;box-sizing:border-box}.mode-buttons-container::-webkit-scrollbar{display:none}.mode-buttons-container{-ms-overflow-style:none;scrollbar-width:none}.mode-button{font-weight:500}#webgi-logo{background-image:url("https://tiexbrasil.com.br/logo.svg");background-size:contain;background-repeat:no-repeat;background-position:center;bottom:1.25rem;left:1rem;z-index:100;width:7.5rem;height:2.5rem;position:absolute;cursor:pointer}#webgi-logo:hover{filter:grayscale(100%)}#fsToggle{position:absolute;right:1.25rem;top:1.25rem;color:var(--tp-container-foreground-color, #dddddd)}#assetManagerPopup{position:absolute;margin:auto;left:0;right:0;top:0;bottom:0;color:#fff;padding:1.5rem;font-size:.85rem;overflow-y:scroll;background-color:var(--tp-base-background-color)}::-webkit-scrollbar{width:8px;height:8px}::-webkit-scrollbar-track{background:rgba(40,34,60,.8) !important;border-radius:6px}::-webkit-scrollbar-thumb{background:hsla(0,0%,100%,.4);border-radius:6px}::-webkit-scrollbar-corner{background:rgba(0,0,0,.5)}.tippy-box[data-theme~=editor]{margin:.25rem !important;background-color:var(--tp-base-background-color) !important;font-size:.9rem !important;color:var(--tp-container-foreground-color, #dddddd) !important}#tweakpaneUiContainer{margin-top:4.5rem}#canvasContainer{display:flex;justify-content:center;align-items:center}@media only screen and (min-width: 920px){#canvasContainer{width:calc(min(100% - 3rem,100% - var(--tweakpane-ui-container-width, 300px)) - 3.5rem) !important;height:calc(100% - 5rem);margin:3.5rem 1.5rem 1.5rem 1.5rem;border-radius:.5rem;box-shadow:rgba(0,0,0,.25) 0px 25px 50px -12px}#mcanvas{border-radius:.5rem}#tweakpaneUiContainer{margin-top:3.5rem}}body{transition:background-color .5s ease;background-color:#d1d4e7}body.tpTheme-blue{background-color:#d1d4e7}body.tpTheme-white{background-color:#dcdcdc}body.tpTheme-black{background-color:#48495d}',""]),o.A=_},367:function(h,o,c){var d=c(364),_=c.n(d)()(function(b){return b[1]});_.push([h.id,':root{--tp-blade-unit-size: 26px;--tp-font-family: "Inter";--tp-element-border-radius: 0.25rem}:root{--tp-base-background-color: #0e0e0e;--tp-container-background-color: rgba(32, 32, 32, 0.2);--tp-container-background-color-hover: rgba(32, 32, 32, 0.3);--tp-container-background-color-active: rgba(50, 50, 50, 0.8);--tp-container-background-color-focus: rgba(50, 50, 50, 1.0);--tp-container-foreground-color: hsla(0, 0%, 90%, 0.90);--tp-label-foreground-color: hsla(0, 0%, 85%, 0.90)}:root .tpTheme-blue{--tp-base-background-color: #28223C;--tp-base-shadow-color: hsla(0, 0%, 0%, 0.2);--tp-button-background-color: hsla(230, 10%, 80%, 1.00);--tp-button-background-color-active: hsla(230, 10%, 95%, 1.00);--tp-button-background-color-focus: hsla(230, 10%, 90%, 1.00);--tp-button-background-color-hover: hsla(230, 10%, 85%, 1.00);--tp-button-foreground-color: hsla(230, 20%, 11%, 1.00);--tp-container-background-color: hsla(230, 25%, 16%, 0.65);--tp-container-background-color-active: hsla(230, 25%, 36%, 0.65);--tp-container-background-color-focus: hsla(230, 25%, 26%, 0.65);--tp-container-background-color-hover: hsla(230, 25%, 21%, 0.65);--tp-container-foreground-color: hsl(240, 10%, 92%);--tp-groove-foreground-color: hsla(230, 20%, 8%, 1.00);--tp-input-background-color: hsla(230, 20%, 8%, 1.00);--tp-input-background-color-active: hsla(230, 28%, 23%, 1.00);--tp-input-background-color-focus: hsla(230, 28%, 18%, 1.00);--tp-input-background-color-hover: hsla(230, 20%, 13%, 1.00);--tp-input-foreground-color: hsla(230, 10%, 80%, 1.00);--tp-monitor-background-color: hsla(230, 20%, 8%, 1.00);--tp-monitor-foreground-color: hsla(230, 12%, 48%, 1.00);--tp-label-foreground-color: #E4E2ED}:root .tpTheme-white{--tp-base-background-color: hsla(230, 5%, 90%, 1.00);--tp-base-shadow-color: hsla(0, 0%, 0%, 0.10);--tp-button-background-color: hsla(230, 7%, 85%, 1.00);--tp-button-background-color-active: hsla(230, 7%, 70%, 1.00);--tp-button-background-color-focus: hsla(230, 7%, 75%, 1.00);--tp-button-background-color-hover: hsla(230, 7%, 80%, 1.00);--tp-button-foreground-color: hsla(230, 10%, 30%, 1.00);--tp-container-background-color: hsla(230, 15%, 80%, 0.10);--tp-container-background-color-active: hsla(230, 15%, 70%, 0.32);--tp-container-background-color-focus: hsla(230, 15%, 70%, 0.28);--tp-container-background-color-hover: hsla(230, 15%, 70%, 0.24);--tp-container-foreground-color: hsla(230, 10%, 30%, 1.00);--tp-groove-foreground-color: hsla(230, 15%, 20%, 0.10);--tp-input-background-color: hsla(230, 15%, 30%, 0.10);--tp-input-background-color-active: hsla(230, 15%, 50%, 0.22);--tp-input-background-color-focus: hsla(230, 15%, 50%, 0.18);--tp-input-background-color-hover: hsla(230, 15%, 50%, 0.14);--tp-input-foreground-color: hsla(230, 10%, 20%, 1.00);--tp-label-foreground-color: hsla(230, 10%, 10%, 1.00);--tp-monitor-background-color: hsla(230, 15%, 30%, 0.10);--tp-monitor-foreground-color: hsla(230, 10%, 30%, 0.50)}.tp-fldv{margin-top:.25rem;margin-bottom:.25rem;background-blend-mode:luminosity;position:relative}.tp-fldv .tp-fldv{margin-top:.5rem;margin-bottom:.5rem}.tp-fldv_b{height:calc(var(--bld-us)*1.5 + 4px) !important;font-size:.9rem !important;transition:background-color .5s ease}.tp-fldv_b+.tp-brkv .tp-fldv_b{height:calc(var(--bld-us)*1.1 + 4px) !important;font-size:.7rem !important}.tp-lblv_l{font-size:.75rem !important;font-weight:500 !important;flex-grow:1 !important;flex-basis:20% !important}.tp-lblv_v{flex-grow:1 !important;flex-basis:50% !important}.tp-txtv_i{font-size:.75rem !important;font-weight:500 !important}.tp-fldv_t{font-weight:500 !important;padding-left:1.5rem !important}.tp-fldv_m{right:auto !important;left:.75rem;opacity:1 !important}.pluginOptionsButton{position:absolute;right:0;top:.75rem;padding-left:.5rem;padding-right:.5rem;height:-moz-min-content;height:min-content;background:rgba(0,0,0,0);color:var(--tp-container-foreground-color, #eeeeee);font-size:.9rem;border:none}.tp-sldv_k::after{background-color:var(--tp-input-foreground-color, hsl(230, 7%, 75%))}.tp-btnv_b{height:calc(var(--tp-blade-unit-size)*1.15)}.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{font-weight:500 !important}.tp-rotv{font-size:13px !important}',""]),o.A=_},160:function(h,o,c){var d=c(364),_=c.n(d)()(function(b){return b[1]});_.push([h.id,".wwise-perspective{perspective:1000px;position:fixed;left:0;top:0;width:100vw;height:100vh}.wwise-wrapper{position:fixed;width:0;height:0;font-weight:400}.wwise-wrapper.v-center{top:50%}.wwise-wrapper.h-center{left:50%}.wwise-wrapper.left{left:0}.wwise-wrapper.right{right:0}.wwise-wrapper.top{top:0}.wwise-wrapper.bottom{bottom:0}.wwise *.preset{color:#fafafa}.wwise *.preset.ok{background:rgba(45,193,80,.95)}.wwise *.preset.error{background:rgba(190,17,51,.95)}.wwise *.preset.info{background:rgba(40,34,60,.95)}.wwise *.preset.caution{background:rgba(239,128,0,.95)}.wwise-no-scroll{position:relative;overflow:hidden}.wwise-overlay{position:fixed;left:0;top:0;width:100vw;height:100vh;background:rgba(50,50,50,.5)}.wwise{position:absolute;left:0;top:0;display:flex;flex-direction:column;border-radius:5px;box-shadow:1px 1px 10px rgba(150,150,150,.5);box-sizing:border-box}.wwise.no-radius{border-radius:0}.wwise *{box-sizing:border-box}.wwise .clear{clear:both}.wwise>.content{padding:0;margin:0;flex-grow:1;border-radius:0 0 4px 4px;background:#fff;color:#333;box-shadow:0 1px 3px rgba(200,200,200,.5) inset}.wwise>.content.no-topbar{border-radius:4px;box-shadow:none}.wwise.no-radius>.content,.wwise.no-radius>.content.no-topbar{border-radius:0}.wwise .modal>.main{width:90vw;max-width:400px;border-radius:4px 4px 0 0;text-align:center;padding-bottom:10px;color:#fff}.wwise .modal>.main .icon{display:block;margin:0 auto;fill:#fff;width:100px}.wwise .modal>.main .title{font-size:30px}.wwise .modal>.main .text{margin:10px 0;font-weight:300;font-size:16px}.wwise .modal>.main.no-op{border-radius:4px}.wwise .modal>.main.ok{background:#2dc150}.wwise .modal>.main.error{background:#be1133}.wwise .modal>.main.info{background:#28223c}.wwise .modal>.main.caution{background:#ef8000}.wwise .modal>.operation .button-wrapper{text-align:center;margin:30px 0 20px 0}.wwise .modal>.operation .button{display:inline-block;line-height:18px;padding:8px 10px;margin:0 15px;line-height:18px;width:100px;border-radius:4px;border:1px solid #eee;box-shadow:1px 1px 3px rgba(220,220,220,.8);color:#555;transition:all ease .2s}.wwise .modal>.operation .button:hover{background:#f5f5f5;cursor:pointer}.wwise .modal>.operation .button.main{color:#fff}.wwise .modal>.operation.ok .main{background:#2dc150}.wwise .modal>.operation.ok .main:hover{background:rgb(35.3571428571,151.6428571429,62.8571428571)}.wwise .modal>.operation.error .main{background:#be1133}.wwise .modal>.operation.error .main:hover{background:rgb(143.1884057971,12.8115942029,38.4347826087)}.wwise .modal>.operation.info .main{background:#28223c}.wwise .modal>.operation.info .main:hover{background:rgb(18.2978723404,15.5531914894,27.4468085106)}.wwise .modal>.operation.caution .main{background:#ef8000}.wwise .modal>.operation.caution .main:hover{background:rgb(188,100.6861924686,0)}.wwise .input-wrapper{margin:15px auto -15px auto}.wwise .input-wrapper .input{display:block;margin:0 auto;width:95%;max-width:300px;outline:none;border:none;background:#f3f3f3;padding:15px;font-size:16px;border-radius:5px}.wwise .input-wrapper .error{width:95%;text-align:center;margin-top:10px;color:red}div:has(>.wwise-wrapper){position:absolute !important}.wwise-wrapper{position:absolute !important}.wwise .modal>.main{padding-top:10px}",""]),o.A=_},333:function(h){var o;o=function(){return function(c){var d={};function _(b){if(d[b])return d[b].exports;var _e=d[b]={i:b,l:!1,exports:{}};return c[b].call(_e.exports,_e,_e.exports,_),_e.l=!0,_e.exports}return _.m=c,_.c=d,_.i=function(b){return b},_.d=function(b,_e,it){_.o(b,_e)||Object.defineProperty(b,_e,{configurable:!1,enumerable:!0,get:it})},_.n=function(b){var _e=b&&b.__esModule?function(){return b.default}:function(){return b};return _.d(_e,"a",_e),_e},_.o=function(b,_e){return Object.prototype.hasOwnProperty.call(b,_e)},_.p="",_(_.s=5)}([function(c,d,_){Object.defineProperty(d,"__esModule",{value:!0});var b={convertToObject:function(_e){var it=_e.substring(_e.indexOf("{")+1).trim().slice(0,-1),nt={};return it.split(";").map(function(at){if(at=at.trim()){var ut=at.split(":");nt[ut[0].trim()]=ut[1].trim()}}),nt},getFromSheets:function(_e){var it=document.styleSheets;for(var nt in it){var at=null;try{at=it[nt].rules||it[nt].cssRules}catch{}if(at){for(var ut in at)if(at[ut].selectorText&&at[ut].selectorText.split(",").indexOf(_e)!=-1)return at[ut].cssText?b.convertToObject(at[ut].cssText):b.convertToObject(at[ut].style.cssText)}}return{}},getPropertyDefault:function(_e){return _e=="timing-function"?"ease":_e=="iteration-count"?1:_e=="direction"?"normal":_e=="fill-mode"?"none":null}};d.default=b},function(c,d,_){Object.defineProperty(d,"__esModule",{value:!0});var b={generateId:function(){for(var _e="",it=0;it<8;++it)_e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(Math.floor(62*Math.random()));return _e},frameToString:function(_e){var it="";for(var nt in _e)it+=nt+":"+_e[nt]+";";return it},convertTimeToMs:function(_e){if(!_e)return 0;if(typeof _e=="number")return _e;var it=parseFloat(_e);return _e.indexOf("ms")!=-1?it:1e3*it},prefixes:["","-webkit-","-moz-","-o-"]};d.default=b},function(c,d,_){Object.defineProperty(d,"__esModule",{value:!0});var b,_e=(b=_(0))&&b.__esModule?b:{default:b};d.default=function it(nt,at){if(function(mt,ft){if(!(mt instanceof ft))throw new TypeError("Cannot call a class as a function")}(this,it),this.styles=typeof nt=="string"?_e.default.getFromSheets(nt):nt,typeof at=="string"){var ut=_e.default.getFromSheets(at);for(var pt in this.options={},ut)this.options[pt.replace("animation-","")]=ut[pt]}else this.options=typeof at=="number"?{duration:at}:at}},function(c,d,_){Object.defineProperty(d,"__esModule",{value:!0});var b=function(){function pt(mt,ft){for(var vt=0;vt<ft.length;vt++){var xt=ft[vt];xt.enumerable=xt.enumerable||!1,xt.configurable=!0,"value"in xt&&(xt.writable=!0),Object.defineProperty(mt,xt.key,xt)}}return function(mt,ft,vt){return ft&&pt(mt.prototype,ft),vt&&pt(mt,vt),mt}}(),_e=at(_(4)),it=at(_(1)),nt=at(_(0));function at(pt){return pt&&pt.__esModule?pt:{default:pt}}var ut=function(){function pt(mt,ft,vt,xt){if(function(Et,Tt){if(!(Et instanceof Tt))throw new TypeError("Cannot call a class as a function")}(this,pt),mt.constructor===Array?this.doms=mt:this.doms=[mt],ft.constructor===Array?this.frames=ft:this.frames=[ft],this.options={startFrom:0,pauseAt:[],prefix:!1,count:1,clear:!0,applyOnEnd:!1,instant:!1},vt!=null&&vt!=null)if(typeof vt=="boolean")this.options.instant=vt;else if(typeof vt=="number")this.options.count=vt,typeof xt=="boolean"&&(this.options.instant=xt);else for(var At in vt)At=="pauseAt"&&vt.pauseAt.constructor!==Array?this.options[At]=[vt[At]]:this.options[At]=vt[At];for(var Ct in this.promiseSupported=typeof Promise<"u"&&Promise.toString().indexOf("[native code]")!==-1,this.countRemainder=[],this.animations=[],this.styleDoms=[],this.superSets=[],this.eventHandler=[],this.options.prefix?this.prefixes=it.default.prefixes:this.prefixes=[""],mt)this.countRemainder[Ct]=this.options.count-1;this.options.instant&&this.play()}return b(pt,[{key:"play",value:function(){var mt=this;for(var ft in this.clear(),this.promiseSupported&&(this.promise=new Promise(function(xt){mt.promiseResolve=xt})),this.doms){var vt=this.makeAnimation(this.doms[ft]);this.animations[ft]=vt.names,this.styleDoms[ft]=vt.styleDom,this.superSets[ft]=this.makeSuperSet(this.doms[ft],this.animations[ft]),this.playAnimation(this.doms[ft],this.superSets[ft]),this.eventHandler[ft]=this.handleAnimationEnd.bind(this,ft),this.doms[ft].addEventListener("animationend",this.eventHandler[ft])}if(this.promiseSupported)return this.promise}},{key:"clear",value:function(mt){if(!mt){for(var ft in this.doms)this.clear(ft);return this.animationEnded=0,this.promise=void 0,void(this.promiseResolve=void 0)}var vt=this.styleDoms[mt];for(var xt in vt&&vt.parentNode&&vt.parentNode.removeChild(vt),this.superSets[mt])for(var At in this.prefixes)this.doms[mt].style[this.prefixes[At]+"animation-"+xt]=null;for(var Ct in this.prefixes)this.doms[mt].style[this.prefixes[Ct]+"animation-play-state"]=null;this.doms[mt].removeEventListener("animationend",this.eventHandler[mt]),this.countRemainder[mt]=this.options.count-1}},{key:"replay",value:function(mt){var ft=this.doms[mt],vt=ft.cloneNode(!0);ft.parentNode.replaceChild(vt,ft),this.doms[mt].removeEventListener("animationend",this.eventHandler[mt]),this.doms[mt]=vt,this.doms[mt].addEventListener("animationend",this.eventHandler[mt])}},{key:"pause",value:function(){for(var mt in this.doms)this.pauseDom(this.doms[mt])}},{key:"resume",value:function(){for(var mt in this.doms)this.resumeDom(this.doms[mt])}},{key:"getPromise",value:function(){return this.promise}},{key:"handleAnimationEnd",value:function(mt,ft){var vt=ft.animationName,xt=vt.substring(vt.lastIndexOf("-")+1);this.options.pauseAt.includes(parseInt(xt))&&this.pauseDom(this.doms[mt]),xt==this.frames.length&&(this.countRemainder[mt]==-1?this.replay(mt):this.countRemainder[mt]>0?(this.countRemainder[mt]--,this.replay(mt)):(this.options.applyOnEnd&&this.applyOnEnd(mt),this.animationEnded++,this.animationEnded==this.doms.length&&(this.promiseSupported&&this.promiseResolve(),this.options.clear&&this.clear())))}},{key:"pauseDom",value:function(mt){for(var ft in this.prefixes)mt.style[this.prefixes[ft]+"animation-play-state"]="paused"}},{key:"resumeDom",value:function(mt){for(var ft in this.prefixes)mt.style[this.prefixes[ft]+"animation-play-state"]="running"}},{key:"applyOnEnd",value:function(mt){var ft=this.newFrames[this.frames.length];for(var vt in ft)this.doms[mt].style[vt]=ft[vt]}},{key:"makeAnimation",value:function(mt){var ft={},vt=[],xt={};for(var At in this.frames)for(var Ct in vt.push(this.frames[At].styles),vt[At])xt[Ct]=!0;var Et=window.getComputedStyle(mt);for(var Tt in xt)ft[Tt]=Et[Tt];vt.unshift(ft);for(var kt=[vt[0]],Dt=1;Dt<vt.length;++Dt){var zt=JSON.parse(JSON.stringify(kt[Dt-1]));for(var Bt in vt[Dt])zt[Bt]=vt[Dt][Bt];kt.push(zt)}return this.newFrames=kt,_e.default.make(kt,this.prefixes)}},{key:"makeSuperSet",value:function(mt,ft){var vt=0,xt={};for(var At in this.frames)for(var Ct in this.frames[At].options)xt[Ct]="";xt.name="",xt.duration="",xt.delay="";for(var Et=0;Et<this.frames.length;++Et){if(Et)for(var Tt in xt)xt[Tt]+=",";var kt=it.default.convertTimeToMs(this.frames[Et].options.duration),Dt=it.default.convertTimeToMs(this.frames[Et].options.delay);for(var zt in Et<this.options.startFrom&&(kt=0,Dt=0),xt.name+=ft[Et],xt.duration+=kt+"ms",xt.delay+=vt+Dt+"ms",xt)zt!="name"&&zt!="duration"&&zt!="delay"&&(xt[zt]+=this.frames[Et].options[zt]?this.frames[Et].options[zt]:nt.default.getPropertyDefault(zt));var Bt=this.frames[Et].options["iteration-count"];vt+=kt*parseInt(Bt||1)+Dt}return xt}},{key:"playAnimation",value:function(mt,ft){for(var vt in ft)for(var xt in this.prefixes)mt.style[this.prefixes[xt]+"animation-"+vt]=ft[vt];this.options.pauseAt.includes(0)&&this.pauseDom(mt)}}]),pt}();d.default=ut},function(c,d,_){Object.defineProperty(d,"__esModule",{value:!0});var b,_e=(b=_(1))&&b.__esModule?b:{default:b},it={make:function(nt,at){for(var ut=[],pt="",mt="atr-"+_e.default.generateId(),ft=document.createElement("style"),vt=0;vt<nt.length-1;++vt)ut.push(mt+"-"+(vt+1)),pt+=it.makeFromTwoFrames(nt[vt],nt[vt+1],ut[vt],at);return ft.innerHTML=pt,ft.class="foo",document.getElementsByTagName("head")[0].appendChild(ft),{names:ut,styleDom:ft}},makeFromTwoFrames:function(nt,at,ut,pt){var mt="";for(var ft in pt)mt+="@"+pt[ft]+"keyframes "+ut+" {",mt+="0%",mt+="{"+_e.default.frameToString(nt)+"}",mt+="100%",mt+="{"+_e.default.frameToString(at)+"}",mt+="}";return mt}};d.default=it},function(c,d,_){Object.defineProperty(d,"__esModule",{value:!0}),d.Queue=d.Frame=void 0;var b=it(_(2)),_e=it(_(3));function it(nt){return nt&&nt.__esModule?nt:{default:nt}}d.Frame=b.default,d.Queue=_e.default}])},h.exports=o()},364:function(h){h.exports=function(o){var c=[];return c.toString=function(){return this.map(function(d){var _=o(d);return d[2]?"@media ".concat(d[2]," {").concat(_,"}"):_}).join("")},c.i=function(d,_,b){typeof d=="string"&&(d=[[null,d,""]]);var _e={};if(b)for(var it=0;it<this.length;it++){var nt=this[it][0];nt!=null&&(_e[nt]=!0)}for(var at=0;at<d.length;at++){var ut=[].concat(d[at]);b&&_e[ut[0]]||(_&&(ut[2]?ut[2]="".concat(_," and ").concat(ut[2]):ut[2]=_),c.push(ut))}},c}},101:function(h,o,c){var d=c(986);function _(){this.argTypes=[],this.shimArgs=[],this.arrayArgs=[],this.arrayBlockIndices=[],this.scalarArgs=[],this.offsetArgs=[],this.offsetArgIndex=[],this.indexArgs=[],this.shapeArgs=[],this.funcName="",this.pre=null,this.body=null,this.post=null,this.debug=!1}h.exports=function(b){var _e=new _;_e.pre=b.pre,_e.body=b.body,_e.post=b.post;var it=b.args.slice(0);_e.argTypes=it;for(var nt=0;nt<it.length;++nt){var at=it[nt];if(at==="array"||typeof at=="object"&&at.blockIndices){if(_e.argTypes[nt]="array",_e.arrayArgs.push(nt),_e.arrayBlockIndices.push(at.blockIndices?at.blockIndices:0),_e.shimArgs.push("array"+nt),nt<_e.pre.args.length&&_e.pre.args[nt].count>0)throw new Error("cwise: pre() block may not reference array args");if(nt<_e.post.args.length&&_e.post.args[nt].count>0)throw new Error("cwise: post() block may not reference array args")}else if(at==="scalar")_e.scalarArgs.push(nt),_e.shimArgs.push("scalar"+nt);else if(at==="index"){if(_e.indexArgs.push(nt),nt<_e.pre.args.length&&_e.pre.args[nt].count>0)throw new Error("cwise: pre() block may not reference array index");if(nt<_e.body.args.length&&_e.body.args[nt].lvalue)throw new Error("cwise: body() block may not write to array index");if(nt<_e.post.args.length&&_e.post.args[nt].count>0)throw new Error("cwise: post() block may not reference array index")}else if(at==="shape"){if(_e.shapeArgs.push(nt),nt<_e.pre.args.length&&_e.pre.args[nt].lvalue)throw new Error("cwise: pre() block may not write to array shape");if(nt<_e.body.args.length&&_e.body.args[nt].lvalue)throw new Error("cwise: body() block may not write to array shape");if(nt<_e.post.args.length&&_e.post.args[nt].lvalue)throw new Error("cwise: post() block may not write to array shape")}else{if(typeof at!="object"||!at.offset)throw new Error("cwise: Unknown argument type "+it[nt]);_e.argTypes[nt]="offset",_e.offsetArgs.push({array:at.array,offset:at.offset}),_e.offsetArgIndex.push(nt)}}if(_e.arrayArgs.length<=0)throw new Error("cwise: No array arguments specified");if(_e.pre.args.length>it.length)throw new Error("cwise: Too many arguments in pre() block");if(_e.body.args.length>it.length)throw new Error("cwise: Too many arguments in body() block");if(_e.post.args.length>it.length)throw new Error("cwise: Too many arguments in post() block");return _e.debug=!!b.printCode||!!b.debug,_e.funcName=b.funcName||"cwise",_e.blockSize=b.blockSize||64,d(_e)}},151:function(h,o,c){var d=c(161);function _(it,nt,at){var ut,pt,mt=it.length,ft=nt.arrayArgs.length,vt=nt.indexArgs.length>0,xt=[],At=[],Ct=0,Et=0;for(ut=0;ut<mt;++ut)At.push(["i",ut,"=0"].join(""));for(pt=0;pt<ft;++pt)for(ut=0;ut<mt;++ut)Et=Ct,Ct=it[ut],ut===0?At.push(["d",pt,"s",ut,"=t",pt,"p",Ct].join("")):At.push(["d",pt,"s",ut,"=(t",pt,"p",Ct,"-s",Et,"*t",pt,"p",Et,")"].join(""));for(At.length>0&&xt.push("var "+At.join(",")),ut=mt-1;ut>=0;--ut)Ct=it[ut],xt.push(["for(i",ut,"=0;i",ut,"<s",Ct,";++i",ut,"){"].join(""));for(xt.push(at),ut=0;ut<mt;++ut){for(Et=Ct,Ct=it[ut],pt=0;pt<ft;++pt)xt.push(["p",pt,"+=d",pt,"s",ut].join(""));vt&&(ut>0&&xt.push(["index[",Et,"]-=s",Et].join("")),xt.push(["++index[",Ct,"]"].join(""))),xt.push("}")}return xt.join(`
`)}function b(it,nt,at){for(var ut=it.body,pt=[],mt=[],ft=0;ft<it.args.length;++ft){var vt=it.args[ft];if(!(vt.count<=0)){var xt=new RegExp(vt.name,"g"),At="",Ct=nt.arrayArgs.indexOf(ft);switch(nt.argTypes[ft]){case"offset":var Et=nt.offsetArgIndex.indexOf(ft);Ct=nt.offsetArgs[Et].array,At="+q"+Et;case"array":At="p"+Ct+At;var Tt="l"+ft,kt="a"+Ct;if(nt.arrayBlockIndices[Ct]===0)vt.count===1?at[Ct]==="generic"?vt.lvalue?(pt.push(["var ",Tt,"=",kt,".get(",At,")"].join("")),ut=ut.replace(xt,Tt),mt.push([kt,".set(",At,",",Tt,")"].join(""))):ut=ut.replace(xt,[kt,".get(",At,")"].join("")):ut=ut.replace(xt,[kt,"[",At,"]"].join("")):at[Ct]==="generic"?(pt.push(["var ",Tt,"=",kt,".get(",At,")"].join("")),ut=ut.replace(xt,Tt),vt.lvalue&&mt.push([kt,".set(",At,",",Tt,")"].join(""))):(pt.push(["var ",Tt,"=",kt,"[",At,"]"].join("")),ut=ut.replace(xt,Tt),vt.lvalue&&mt.push([kt,"[",At,"]=",Tt].join("")));else{for(var Dt=[vt.name],zt=[At],Bt=0;Bt<Math.abs(nt.arrayBlockIndices[Ct]);Bt++)Dt.push("\\s*\\[([^\\]]+)\\]"),zt.push("$"+(Bt+1)+"*t"+Ct+"b"+Bt);if(xt=new RegExp(Dt.join(""),"g"),At=zt.join("+"),at[Ct]==="generic")throw new Error("cwise: Generic arrays not supported in combination with blocks!");ut=ut.replace(xt,[kt,"[",At,"]"].join(""))}break;case"scalar":ut=ut.replace(xt,"Y"+nt.scalarArgs.indexOf(ft));break;case"index":ut=ut.replace(xt,"index");break;case"shape":ut=ut.replace(xt,"shape")}}}return[pt.join(`
`),ut,mt.join(`
`)].join(`
`).trim()}function _e(it){for(var nt=new Array(it.length),at=!0,ut=0;ut<it.length;++ut){var pt=it[ut],mt=pt.match(/\d+/);mt=mt?mt[0]:"",pt.charAt(0)===0?nt[ut]="u"+pt.charAt(1)+mt:nt[ut]=pt.charAt(0)+mt,ut>0&&(at=at&&nt[ut]===nt[ut-1])}return at?nt[0]:nt.join("")}h.exports=function(it,nt){for(var at=nt[1].length-Math.abs(it.arrayBlockIndices[0])|0,ut=new Array(it.arrayArgs.length),pt=new Array(it.arrayArgs.length),mt=0;mt<it.arrayArgs.length;++mt)pt[mt]=nt[2*mt],ut[mt]=nt[2*mt+1];var ft=[],vt=[],xt=[],At=[],Ct=[];for(mt=0;mt<it.arrayArgs.length;++mt){it.arrayBlockIndices[mt]<0?(xt.push(0),At.push(at),ft.push(at),vt.push(at+it.arrayBlockIndices[mt])):(xt.push(it.arrayBlockIndices[mt]),At.push(it.arrayBlockIndices[mt]+at),ft.push(0),vt.push(it.arrayBlockIndices[mt]));for(var Et=[],Tt=0;Tt<ut[mt].length;Tt++)xt[mt]<=ut[mt][Tt]&&ut[mt][Tt]<At[mt]&&Et.push(ut[mt][Tt]-xt[mt]);Ct.push(Et)}var kt=["SS"],Dt=["'use strict'"],zt=[];for(Tt=0;Tt<at;++Tt)zt.push(["s",Tt,"=SS[",Tt,"]"].join(""));for(mt=0;mt<it.arrayArgs.length;++mt){for(kt.push("a"+mt),kt.push("t"+mt),kt.push("p"+mt),Tt=0;Tt<at;++Tt)zt.push(["t",mt,"p",Tt,"=t",mt,"[",xt[mt]+Tt,"]"].join(""));for(Tt=0;Tt<Math.abs(it.arrayBlockIndices[mt]);++Tt)zt.push(["t",mt,"b",Tt,"=t",mt,"[",ft[mt]+Tt,"]"].join(""))}for(mt=0;mt<it.scalarArgs.length;++mt)kt.push("Y"+mt);if(it.shapeArgs.length>0&&zt.push("shape=SS.slice(0)"),it.indexArgs.length>0){var Bt=new Array(at);for(mt=0;mt<at;++mt)Bt[mt]="0";zt.push(["index=[",Bt.join(","),"]"].join(""))}for(mt=0;mt<it.offsetArgs.length;++mt){var Rt=it.offsetArgs[mt],Ut=[];for(Tt=0;Tt<Rt.offset.length;++Tt)Rt.offset[Tt]!==0&&(Rt.offset[Tt]===1?Ut.push(["t",Rt.array,"p",Tt].join("")):Ut.push([Rt.offset[Tt],"*t",Rt.array,"p",Tt].join("")));Ut.length===0?zt.push("q"+mt+"=0"):zt.push(["q",mt,"=",Ut.join("+")].join(""))}var Ht=d([].concat(it.pre.thisVars).concat(it.body.thisVars).concat(it.post.thisVars));for((zt=zt.concat(Ht)).length>0&&Dt.push("var "+zt.join(",")),mt=0;mt<it.arrayArgs.length;++mt)Dt.push("p"+mt+"|=0");it.pre.body.length>3&&Dt.push(b(it.pre,it,pt));var Jt=b(it.body,it,pt),Kt=function(ir){for(var cr=0,lr=ir[0].length;cr<lr;){for(var hr=1;hr<ir.length;++hr)if(ir[hr][cr]!==ir[0][cr])return cr;++cr}return cr}(Ct);Kt<at?Dt.push(function(ir,cr,lr,hr){for(var dr=cr.length,pr=lr.arrayArgs.length,ur=lr.blockSize,xr=lr.indexArgs.length>0,vr=[],Dr=0;Dr<pr;++Dr)vr.push(["var offset",Dr,"=p",Dr].join(""));for(Dr=ir;Dr<dr;++Dr)vr.push(["for(var j"+Dr+"=SS[",cr[Dr],"]|0;j",Dr,">0;){"].join("")),vr.push(["if(j",Dr,"<",ur,"){"].join("")),vr.push(["s",cr[Dr],"=j",Dr].join("")),vr.push(["j",Dr,"=0"].join("")),vr.push(["}else{s",cr[Dr],"=",ur].join("")),vr.push(["j",Dr,"-=",ur,"}"].join("")),xr&&vr.push(["index[",cr[Dr],"]=j",Dr].join(""));for(Dr=0;Dr<pr;++Dr){for(var _r=["offset"+Dr],rr=ir;rr<dr;++rr)_r.push(["j",rr,"*t",Dr,"p",cr[rr]].join(""));vr.push(["p",Dr,"=(",_r.join("+"),")"].join(""))}for(vr.push(_(cr,lr,hr)),Dr=ir;Dr<dr;++Dr)vr.push("}");return vr.join(`
`)}(Kt,Ct[0],it,Jt)):Dt.push(_(Ct[0],it,Jt)),it.post.body.length>3&&Dt.push(b(it.post,it,pt)),it.debug&&console.log("-----Generated cwise routine for ",nt,`:
`+Dt.join(`
`)+`
----------`);var sr=[it.funcName||"unnamed","_cwise_loop_",ut[0].join("s"),"m",Kt,_e(pt)].join("");return new Function(["function ",sr,"(",kt.join(","),"){",Dt.join(`
`),"} return ",sr].join(""))()}},986:function(h,o,c){var d=c(151);h.exports=function(_){var b=["'use strict'","var CACHED={}"],_e=[],it=_.funcName+"_cwise_thunk";b.push(["return function ",it,"(",_.shimArgs.join(","),"){"].join(""));for(var nt=[],at=[],ut=[["array",_.arrayArgs[0],".shape.slice(",Math.max(0,_.arrayBlockIndices[0]),_.arrayBlockIndices[0]<0?","+_.arrayBlockIndices[0]+")":")"].join("")],pt=[],mt=[],ft=0;ft<_.arrayArgs.length;++ft){var vt=_.arrayArgs[ft];_e.push(["t",vt,"=array",vt,".dtype,","r",vt,"=array",vt,".order"].join("")),nt.push("t"+vt),nt.push("r"+vt),at.push("t"+vt),at.push("r"+vt+".join()"),ut.push("array"+vt+".data"),ut.push("array"+vt+".stride"),ut.push("array"+vt+".offset|0"),ft>0&&(pt.push("array"+_.arrayArgs[0]+".shape.length===array"+vt+".shape.length+"+(Math.abs(_.arrayBlockIndices[0])-Math.abs(_.arrayBlockIndices[ft]))),mt.push("array"+_.arrayArgs[0]+".shape[shapeIndex+"+Math.max(0,_.arrayBlockIndices[0])+"]===array"+vt+".shape[shapeIndex+"+Math.max(0,_.arrayBlockIndices[ft])+"]"))}for(_.arrayArgs.length>1&&(b.push("if (!("+pt.join(" && ")+")) throw new Error('cwise: Arrays do not all have the same dimensionality!')"),b.push("for(var shapeIndex=array"+_.arrayArgs[0]+".shape.length-"+Math.abs(_.arrayBlockIndices[0])+"; shapeIndex-->0;) {"),b.push("if (!("+mt.join(" && ")+")) throw new Error('cwise: Arrays do not all have the same shape!')"),b.push("}")),ft=0;ft<_.scalarArgs.length;++ft)ut.push("scalar"+_.scalarArgs[ft]);return _e.push(["type=[",at.join(","),"].join()"].join("")),_e.push("proc=CACHED[type]"),b.push("var "+_e.join(",")),b.push(["if(!proc){","CACHED[type]=proc=compile([",nt.join(","),"])}","return proc(",ut.join(","),")}"].join("")),_.debug&&console.log(`-----Generated thunk:
`+b.join(`
`)+`
----------`),new Function("compile",b.join(`
`))(d.bind(void 0,_))}},981:function(h){h.exports=function(o){for(var c=new Array(o),d=0;d<o;++d)c[d]=d;return c}},872:function(h){function o(c){return!!c.constructor&&typeof c.constructor.isBuffer=="function"&&c.constructor.isBuffer(c)}h.exports=function(c){return c!=null&&(o(c)||function(d){return typeof d.readFloatLE=="function"&&typeof d.slice=="function"&&o(d.slice(0,0))}(c)||!!c._isBuffer)}},49:function(h,o,c){var d=c(101),_={body:"",args:[],thisVars:[],localVars:[]};function b(ft){if(!ft)return _;for(var vt=0;vt<ft.args.length;++vt){var xt=ft.args[vt];ft.args[vt]=vt===0?{name:xt,lvalue:!0,rvalue:!!ft.rvalue,count:ft.count||1}:{name:xt,lvalue:!1,rvalue:!0,count:1}}return ft.thisVars||(ft.thisVars=[]),ft.localVars||(ft.localVars=[]),ft}function _e(ft){for(var vt=[],xt=0;xt<ft.args.length;++xt)vt.push("a"+xt);return new Function("P",["return function ",ft.funcName,"_ndarrayops(",vt.join(","),") {P(",vt.join(","),");return a0}"].join(""))(function(At){return d({args:At.args,pre:b(At.pre),body:b(At.body),post:b(At.proc),funcName:At.funcName})}(ft))}var it={add:"+",sub:"-",mul:"*",div:"/",mod:"%",band:"&",bor:"|",bxor:"^",lshift:"<<",rshift:">>",rrshift:">>>"};(function(){for(var ft in it){var vt=it[ft];o[ft]=_e({args:["array","array","array"],body:{args:["a","b","c"],body:"a=b"+vt+"c"},funcName:ft}),o[ft+"eq"]=_e({args:["array","array"],body:{args:["a","b"],body:"a"+vt+"=b"},rvalue:!0,funcName:ft+"eq"}),o[ft+"s"]=_e({args:["array","array","scalar"],body:{args:["a","b","s"],body:"a=b"+vt+"s"},funcName:ft+"s"}),o[ft+"seq"]=_e({args:["array","scalar"],body:{args:["a","s"],body:"a"+vt+"=s"},rvalue:!0,funcName:ft+"seq"})}})();var nt={not:"!",bnot:"~",neg:"-",recip:"1.0/"};(function(){for(var ft in nt){var vt=nt[ft];o[ft]=_e({args:["array","array"],body:{args:["a","b"],body:"a="+vt+"b"},funcName:ft}),o[ft+"eq"]=_e({args:["array"],body:{args:["a"],body:"a="+vt+"a"},rvalue:!0,count:2,funcName:ft+"eq"})}})();var at={and:"&&",or:"||",eq:"===",neq:"!==",lt:"<",gt:">",leq:"<=",geq:">="};(function(){for(var ft in at){var vt=at[ft];o[ft]=_e({args:["array","array","array"],body:{args:["a","b","c"],body:"a=b"+vt+"c"},funcName:ft}),o[ft+"s"]=_e({args:["array","array","scalar"],body:{args:["a","b","s"],body:"a=b"+vt+"s"},funcName:ft+"s"}),o[ft+"eq"]=_e({args:["array","array"],body:{args:["a","b"],body:"a=a"+vt+"b"},rvalue:!0,count:2,funcName:ft+"eq"}),o[ft+"seq"]=_e({args:["array","scalar"],body:{args:["a","s"],body:"a=a"+vt+"s"},rvalue:!0,count:2,funcName:ft+"seq"})}})();var ut=["abs","acos","asin","atan","ceil","cos","exp","floor","log","round","sin","sqrt","tan"];(function(){for(var ft=0;ft<ut.length;++ft){var vt=ut[ft];o[vt]=_e({args:["array","array"],pre:{args:[],body:"this_f=Math."+vt,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b)",thisVars:["this_f"]},funcName:vt}),o[vt+"eq"]=_e({args:["array"],pre:{args:[],body:"this_f=Math."+vt,thisVars:["this_f"]},body:{args:["a"],body:"a=this_f(a)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:vt+"eq"})}})();var pt=["max","min","atan2","pow"];(function(){for(var ft=0;ft<pt.length;++ft){var vt=pt[ft];o[vt]=_e({args:["array","array","array"],pre:{args:[],body:"this_f=Math."+vt,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(b,c)",thisVars:["this_f"]},funcName:vt}),o[vt+"s"]=_e({args:["array","array","scalar"],pre:{args:[],body:"this_f=Math."+vt,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(b,c)",thisVars:["this_f"]},funcName:vt+"s"}),o[vt+"eq"]=_e({args:["array","array"],pre:{args:[],body:"this_f=Math."+vt,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(a,b)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:vt+"eq"}),o[vt+"seq"]=_e({args:["array","scalar"],pre:{args:[],body:"this_f=Math."+vt,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(a,b)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:vt+"seq"})}})();var mt=["atan2","pow"];(function(){for(var ft=0;ft<mt.length;++ft){var vt=mt[ft];o[vt+"op"]=_e({args:["array","array","array"],pre:{args:[],body:"this_f=Math."+vt,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(c,b)",thisVars:["this_f"]},funcName:vt+"op"}),o[vt+"ops"]=_e({args:["array","array","scalar"],pre:{args:[],body:"this_f=Math."+vt,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(c,b)",thisVars:["this_f"]},funcName:vt+"ops"}),o[vt+"opeq"]=_e({args:["array","array"],pre:{args:[],body:"this_f=Math."+vt,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b,a)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:vt+"opeq"}),o[vt+"opseq"]=_e({args:["array","scalar"],pre:{args:[],body:"this_f=Math."+vt,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b,a)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:vt+"opseq"})}})(),o.any=d({args:["array"],pre:_,body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:1}],body:"if(a){return true}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return false"},funcName:"any"}),o.all=d({args:["array"],pre:_,body:{args:[{name:"x",lvalue:!1,rvalue:!0,count:1}],body:"if(!x){return false}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return true"},funcName:"all"}),o.sum=d({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:1}],body:"this_s+=a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"sum"}),o.prod=d({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=1"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:1}],body:"this_s*=a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"prod"}),o.norm2squared=d({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:2}],body:"this_s+=a*a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norm2squared"}),o.norm2=d({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:2}],body:"this_s+=a*a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return Math.sqrt(this_s)"},funcName:"norm2"}),o.norminf=d({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:4}],body:"if(-a>this_s){this_s=-a}else if(a>this_s){this_s=a}",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norminf"}),o.norm1=d({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:3}],body:"this_s+=a<0?-a:a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norm1"}),o.sup=d({args:["array"],pre:{body:"this_h=-Infinity",args:[],thisVars:["this_h"],localVars:[]},body:{body:"if(_inline_1_arg0_>this_h)this_h=_inline_1_arg0_",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_h"],localVars:[]},post:{body:"return this_h",args:[],thisVars:["this_h"],localVars:[]}}),o.inf=d({args:["array"],pre:{body:"this_h=Infinity",args:[],thisVars:["this_h"],localVars:[]},body:{body:"if(_inline_1_arg0_<this_h)this_h=_inline_1_arg0_",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_h"],localVars:[]},post:{body:"return this_h",args:[],thisVars:["this_h"],localVars:[]}}),o.argmin=d({args:["index","array","shape"],pre:{body:"{this_v=Infinity;this_i=_inline_0_arg2_.slice(0)}",args:[{name:"_inline_0_arg0_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg1_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg2_",lvalue:!1,rvalue:!0,count:1}],thisVars:["this_i","this_v"],localVars:[]},body:{body:"{if(_inline_1_arg1_<this_v){this_v=_inline_1_arg1_;for(var _inline_1_k=0;_inline_1_k<_inline_1_arg0_.length;++_inline_1_k){this_i[_inline_1_k]=_inline_1_arg0_[_inline_1_k]}}}",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2},{name:"_inline_1_arg1_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_i","this_v"],localVars:["_inline_1_k"]},post:{body:"{return this_i}",args:[],thisVars:["this_i"],localVars:[]}}),o.argmax=d({args:["index","array","shape"],pre:{body:"{this_v=-Infinity;this_i=_inline_0_arg2_.slice(0)}",args:[{name:"_inline_0_arg0_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg1_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg2_",lvalue:!1,rvalue:!0,count:1}],thisVars:["this_i","this_v"],localVars:[]},body:{body:"{if(_inline_1_arg1_>this_v){this_v=_inline_1_arg1_;for(var _inline_1_k=0;_inline_1_k<_inline_1_arg0_.length;++_inline_1_k){this_i[_inline_1_k]=_inline_1_arg0_[_inline_1_k]}}}",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2},{name:"_inline_1_arg1_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_i","this_v"],localVars:["_inline_1_k"]},post:{body:"{return this_i}",args:[],thisVars:["this_i"],localVars:[]}}),o.random=_e({args:["array"],pre:{args:[],body:"this_f=Math.random",thisVars:["this_f"]},body:{args:["a"],body:"a=this_f()",thisVars:["this_f"]},funcName:"random"}),o.assign=_e({args:["array","array"],body:{args:["a","b"],body:"a=b"},funcName:"assign"}),o.assigns=_e({args:["array","scalar"],body:{args:["a","b"],body:"a=b"},funcName:"assigns"}),o.equals=d({args:["array","array"],pre:_,body:{args:[{name:"x",lvalue:!1,rvalue:!0,count:1},{name:"y",lvalue:!1,rvalue:!0,count:1}],body:"if(x!==y){return false}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return true"},funcName:"equals"})},881:function(h,o,c){var d=c(981),_=c(872),b=typeof Float64Array<"u";function _e(ut,pt){return ut[0]-pt[0]}function it(){var ut,pt=this.stride,mt=new Array(pt.length);for(ut=0;ut<mt.length;++ut)mt[ut]=[Math.abs(pt[ut]),ut];mt.sort(_e);var ft=new Array(mt.length);for(ut=0;ut<ft.length;++ut)ft[ut]=mt[ut][1];return ft}function nt(ut,pt){var mt=["View",pt,"d",ut].join("");pt<0&&(mt="View_Nil"+ut);var ft=ut==="generic";if(pt===-1){var vt="function "+mt+"(a){this.data=a;};var proto="+mt+".prototype;proto.dtype='"+ut+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+mt+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+mt+"(a){return new "+mt+"(a);}";return new Function(vt)()}if(pt===0)return vt="function "+mt+"(a,d) {this.data = a;this.offset = d};var proto="+mt+".prototype;proto.dtype='"+ut+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+mt+"_copy() {return new "+mt+"(this.data,this.offset)};proto.pick=function "+mt+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+mt+"_get(){return "+(ft?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+mt+"_set(v){return "+(ft?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+mt+"(a,b,c,d){return new "+mt+"(a,d)}",new Function("TrivialArray",vt)(at[ut][0]);vt=["'use strict'"];var xt=d(pt),At=xt.map(function(Ut){return"i"+Ut}),Ct="this.offset+"+xt.map(function(Ut){return"this.stride["+Ut+"]*i"+Ut}).join("+"),Et=xt.map(function(Ut){return"b"+Ut}).join(","),Tt=xt.map(function(Ut){return"c"+Ut}).join(",");vt.push("function "+mt+"(a,"+Et+","+Tt+",d){this.data=a","this.shape=["+Et+"]","this.stride=["+Tt+"]","this.offset=d|0}","var proto="+mt+".prototype","proto.dtype='"+ut+"'","proto.dimension="+pt),vt.push("Object.defineProperty(proto,'size',{get:function "+mt+"_size(){return "+xt.map(function(Ut){return"this.shape["+Ut+"]"}).join("*"),"}})"),pt===1?vt.push("proto.order=[0]"):(vt.push("Object.defineProperty(proto,'order',{get:"),pt<4?(vt.push("function "+mt+"_order(){"),pt===2?vt.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):pt===3&&vt.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):vt.push("ORDER})")),vt.push("proto.set=function "+mt+"_set("+At.join(",")+",v){"),ft?vt.push("return this.data.set("+Ct+",v)}"):vt.push("return this.data["+Ct+"]=v}"),vt.push("proto.get=function "+mt+"_get("+At.join(",")+"){"),ft?vt.push("return this.data.get("+Ct+")}"):vt.push("return this.data["+Ct+"]}"),vt.push("proto.index=function "+mt+"_index(",At.join(),"){return "+Ct+"}"),vt.push("proto.hi=function "+mt+"_hi("+At.join(",")+"){return new "+mt+"(this.data,"+xt.map(function(Ut){return["(typeof i",Ut,"!=='number'||i",Ut,"<0)?this.shape[",Ut,"]:i",Ut,"|0"].join("")}).join(",")+","+xt.map(function(Ut){return"this.stride["+Ut+"]"}).join(",")+",this.offset)}");var kt=xt.map(function(Ut){return"a"+Ut+"=this.shape["+Ut+"]"}),Dt=xt.map(function(Ut){return"c"+Ut+"=this.stride["+Ut+"]"});vt.push("proto.lo=function "+mt+"_lo("+At.join(",")+"){var b=this.offset,d=0,"+kt.join(",")+","+Dt.join(","));for(var zt=0;zt<pt;++zt)vt.push("if(typeof i"+zt+"==='number'&&i"+zt+">=0){d=i"+zt+"|0;b+=c"+zt+"*d;a"+zt+"-=d}");for(vt.push("return new "+mt+"(this.data,"+xt.map(function(Ut){return"a"+Ut}).join(",")+","+xt.map(function(Ut){return"c"+Ut}).join(",")+",b)}"),vt.push("proto.step=function "+mt+"_step("+At.join(",")+"){var "+xt.map(function(Ut){return"a"+Ut+"=this.shape["+Ut+"]"}).join(",")+","+xt.map(function(Ut){return"b"+Ut+"=this.stride["+Ut+"]"}).join(",")+",c=this.offset,d=0,ceil=Math.ceil"),zt=0;zt<pt;++zt)vt.push("if(typeof i"+zt+"==='number'){d=i"+zt+"|0;if(d<0){c+=b"+zt+"*(a"+zt+"-1);a"+zt+"=ceil(-a"+zt+"/d)}else{a"+zt+"=ceil(a"+zt+"/d)}b"+zt+"*=d}");vt.push("return new "+mt+"(this.data,"+xt.map(function(Ut){return"a"+Ut}).join(",")+","+xt.map(function(Ut){return"b"+Ut}).join(",")+",c)}");var Bt=new Array(pt),Rt=new Array(pt);for(zt=0;zt<pt;++zt)Bt[zt]="a[i"+zt+"]",Rt[zt]="b[i"+zt+"]";for(vt.push("proto.transpose=function "+mt+"_transpose("+At+"){"+At.map(function(Ut,Ht){return Ut+"=("+Ut+"===undefined?"+Ht+":"+Ut+"|0)"}).join(";"),"var a=this.shape,b=this.stride;return new "+mt+"(this.data,"+Bt.join(",")+","+Rt.join(",")+",this.offset)}"),vt.push("proto.pick=function "+mt+"_pick("+At+"){var a=[],b=[],c=this.offset"),zt=0;zt<pt;++zt)vt.push("if(typeof i"+zt+"==='number'&&i"+zt+">=0){c=(c+this.stride["+zt+"]*i"+zt+")|0}else{a.push(this.shape["+zt+"]);b.push(this.stride["+zt+"])}");return vt.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),vt.push("return function construct_"+mt+"(data,shape,stride,offset){return new "+mt+"(data,"+xt.map(function(Ut){return"shape["+Ut+"]"}).join(",")+","+xt.map(function(Ut){return"stride["+Ut+"]"}).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",vt.join(`
`))(at[ut],it)}var at={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};h.exports=function(ut,pt,mt,ft){if(ut===void 0)return(0,at.array[0])([]);typeof ut=="number"&&(ut=[ut]),pt===void 0&&(pt=[ut.length]);var vt=pt.length;if(mt===void 0){mt=new Array(vt);for(var xt=vt-1,At=1;xt>=0;--xt)mt[xt]=At,At*=pt[xt]}if(ft===void 0)for(ft=0,xt=0;xt<vt;++xt)mt[xt]<0&&(ft-=(pt[xt]-1)*mt[xt]);for(var Ct=function(Tt){if(_(Tt))return"buffer";if(b)switch(Object.prototype.toString.call(Tt)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(Tt)?"array":"generic"}(ut),Et=at[Ct];Et.length<=vt+1;)Et.push(nt(Ct,Et.length-1));return(0,Et[vt+1])(ut,pt,mt,ft)}},516:function(h){h.exports=function o(c,d,_){function b(nt,at){if(!d[nt]){if(!c[nt]){if(_e)return _e(nt,!0);throw new Error("Cannot find module '"+nt+"'")}var ut=d[nt]={exports:{}};c[nt][0].call(ut.exports,function(pt){return b(c[nt][1][pt]||pt)},ut,ut.exports,o,c,d,_)}return d[nt].exports}for(var _e=void 0,it=0;it<_.length;it++)b(_[it]);return b}({1:[function(o,c,d){(function(_,b,_e,it,nt,at,ut,pt,mt){var ft=o("crypto");function vt(Dt,zt){return function(Bt,Rt){var Ut;if((Ut=Rt.algorithm!=="passthrough"?ft.createHash(Rt.algorithm):new kt).write===void 0&&(Ut.write=Ut.update,Ut.end=Ut.update),Tt(Rt,Ut).dispatch(Bt),Ut.update||Ut.end(""),Ut.digest)return Ut.digest(Rt.encoding==="buffer"?void 0:Rt.encoding);var Ht=Ut.read();return Rt.encoding!=="buffer"?Ht.toString(Rt.encoding):Ht}(Dt,zt=Ct(Dt,zt))}(d=c.exports=vt).sha1=function(Dt){return vt(Dt)},d.keys=function(Dt){return vt(Dt,{excludeValues:!0,algorithm:"sha1",encoding:"hex"})},d.MD5=function(Dt){return vt(Dt,{algorithm:"md5",encoding:"hex"})},d.keysMD5=function(Dt){return vt(Dt,{algorithm:"md5",encoding:"hex",excludeValues:!0})};var xt=ft.getHashes?ft.getHashes().slice():["sha1","md5"];xt.push("passthrough");var At=["buffer","hex","binary","base64"];function Ct(Dt,zt){zt=zt||{};var Bt={};if(Bt.algorithm=zt.algorithm||"sha1",Bt.encoding=zt.encoding||"hex",Bt.excludeValues=!!zt.excludeValues,Bt.algorithm=Bt.algorithm.toLowerCase(),Bt.encoding=Bt.encoding.toLowerCase(),Bt.ignoreUnknown=zt.ignoreUnknown===!0,Bt.respectType=zt.respectType!==!1,Bt.respectFunctionNames=zt.respectFunctionNames!==!1,Bt.respectFunctionProperties=zt.respectFunctionProperties!==!1,Bt.unorderedArrays=zt.unorderedArrays===!0,Bt.unorderedSets=zt.unorderedSets!==!1,Bt.unorderedObjects=zt.unorderedObjects!==!1,Bt.replacer=zt.replacer||void 0,Bt.excludeKeys=zt.excludeKeys||void 0,Dt===void 0)throw new Error("Object argument required.");for(var Rt=0;Rt<xt.length;++Rt)xt[Rt].toLowerCase()===Bt.algorithm.toLowerCase()&&(Bt.algorithm=xt[Rt]);if(xt.indexOf(Bt.algorithm)===-1)throw new Error('Algorithm "'+Bt.algorithm+'"  not supported. supported values: '+xt.join(", "));if(At.indexOf(Bt.encoding)===-1&&Bt.algorithm!=="passthrough")throw new Error('Encoding "'+Bt.encoding+'"  not supported. supported values: '+At.join(", "));return Bt}function Et(Dt){if(typeof Dt=="function")return/^function\s+\w*\s*\(\s*\)\s*{\s+\[native code\]\s+}$/i.exec(Function.prototype.toString.call(Dt))!=null}function Tt(Dt,zt,Bt){function Rt(Ut){return zt.update?zt.update(Ut,"utf8"):zt.write(Ut,"utf8")}return Bt=Bt||[],{dispatch:function(Ut){return Dt.replacer&&(Ut=Dt.replacer(Ut)),this["_"+(Ut===null?"null":typeof Ut)](Ut)},_object:function(Ut){var Ht,Jt=Object.prototype.toString.call(Ut),Kt=/\[object (.*)\]/i.exec(Jt);if(Kt=(Kt=Kt?Kt[1]:"unknown:["+Jt+"]").toLowerCase(),0<=(Ht=Bt.indexOf(Ut)))return this.dispatch("[CIRCULAR:"+Ht+"]");if(Bt.push(Ut),_e!==void 0&&_e.isBuffer&&_e.isBuffer(Ut))return Rt("buffer:"),Rt(Ut);if(Kt==="object"||Kt==="function"||Kt==="asyncfunction"){var sr=Object.keys(Ut);Dt.unorderedObjects&&(sr=sr.sort()),Dt.respectType===!1||Et(Ut)||sr.splice(0,0,"prototype","__proto__","constructor"),Dt.excludeKeys&&(sr=sr.filter(function(cr){return!Dt.excludeKeys(cr)})),Rt("object:"+sr.length+":");var ir=this;return sr.forEach(function(cr){ir.dispatch(cr),Rt(":"),Dt.excludeValues||ir.dispatch(Ut[cr]),Rt(",")})}if(!this["_"+Kt]){if(Dt.ignoreUnknown)return Rt("["+Kt+"]");throw new Error('Unknown object type "'+Kt+'"')}this["_"+Kt](Ut)},_array:function(Ut,Ht){Ht=Ht!==void 0?Ht:Dt.unorderedArrays!==!1;var Jt=this;if(Rt("array:"+Ut.length+":"),!Ht||Ut.length<=1)return Ut.forEach(function(ir){return Jt.dispatch(ir)});var Kt=[],sr=Ut.map(function(ir){var cr=new kt,lr=Bt.slice();return Tt(Dt,cr,lr).dispatch(ir),Kt=Kt.concat(lr.slice(Bt.length)),cr.read().toString()});return Bt=Bt.concat(Kt),sr.sort(),this._array(sr,!1)},_date:function(Ut){return Rt("date:"+Ut.toJSON())},_symbol:function(Ut){return Rt("symbol:"+Ut.toString())},_error:function(Ut){return Rt("error:"+Ut.toString())},_boolean:function(Ut){return Rt("bool:"+Ut.toString())},_string:function(Ut){Rt("string:"+Ut.length+":"),Rt(Ut.toString())},_function:function(Ut){Rt("fn:"),Et(Ut)?this.dispatch("[native]"):this.dispatch(Ut.toString()),Dt.respectFunctionNames!==!1&&this.dispatch("function-name:"+String(Ut.name)),Dt.respectFunctionProperties&&this._object(Ut)},_number:function(Ut){return Rt("number:"+Ut.toString())},_xml:function(Ut){return Rt("xml:"+Ut.toString())},_null:function(){return Rt("Null")},_undefined:function(){return Rt("Undefined")},_regexp:function(Ut){return Rt("regex:"+Ut.toString())},_uint8array:function(Ut){return Rt("uint8array:"),this.dispatch(Array.prototype.slice.call(Ut))},_uint8clampedarray:function(Ut){return Rt("uint8clampedarray:"),this.dispatch(Array.prototype.slice.call(Ut))},_int8array:function(Ut){return Rt("uint8array:"),this.dispatch(Array.prototype.slice.call(Ut))},_uint16array:function(Ut){return Rt("uint16array:"),this.dispatch(Array.prototype.slice.call(Ut))},_int16array:function(Ut){return Rt("uint16array:"),this.dispatch(Array.prototype.slice.call(Ut))},_uint32array:function(Ut){return Rt("uint32array:"),this.dispatch(Array.prototype.slice.call(Ut))},_int32array:function(Ut){return Rt("uint32array:"),this.dispatch(Array.prototype.slice.call(Ut))},_float32array:function(Ut){return Rt("float32array:"),this.dispatch(Array.prototype.slice.call(Ut))},_float64array:function(Ut){return Rt("float64array:"),this.dispatch(Array.prototype.slice.call(Ut))},_arraybuffer:function(Ut){return Rt("arraybuffer:"),this.dispatch(new Uint8Array(Ut))},_url:function(Ut){return Rt("url:"+Ut.toString())},_map:function(Ut){Rt("map:");var Ht=Array.from(Ut);return this._array(Ht,Dt.unorderedSets!==!1)},_set:function(Ut){Rt("set:");var Ht=Array.from(Ut);return this._array(Ht,Dt.unorderedSets!==!1)},_file:function(Ut){return Rt("file:"),this.dispatch([Ut.name,Ut.size,Ut.type,Ut.lastModfied])},_blob:function(){if(Dt.ignoreUnknown)return Rt("[blob]");throw Error(`Hashing Blob objects is currently not supported
(see https://github.com/puleos/object-hash/issues/26)
Use "options.replacer" or "options.ignoreUnknown"
`)},_domwindow:function(){return Rt("domwindow")},_bigint:function(Ut){return Rt("bigint:"+Ut.toString())},_process:function(){return Rt("process")},_timer:function(){return Rt("timer")},_pipe:function(){return Rt("pipe")},_tcp:function(){return Rt("tcp")},_udp:function(){return Rt("udp")},_tty:function(){return Rt("tty")},_statwatcher:function(){return Rt("statwatcher")},_securecontext:function(){return Rt("securecontext")},_connection:function(){return Rt("connection")},_zlib:function(){return Rt("zlib")},_context:function(){return Rt("context")},_nodescript:function(){return Rt("nodescript")},_httpparser:function(){return Rt("httpparser")},_dataview:function(){return Rt("dataview")},_signal:function(){return Rt("signal")},_fsevent:function(){return Rt("fsevent")},_tlswrap:function(){return Rt("tlswrap")}}}function kt(){return{buf:"",write:function(Dt){this.buf+=Dt},end:function(Dt){this.buf+=Dt},read:function(){return this.buf}}}d.writeToStream=function(Dt,zt,Bt){return Bt===void 0&&(Bt=zt,zt={}),Tt(zt=Ct(Dt,zt),Bt).dispatch(Dt)}}).call(this,o("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},o("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/fake_7eac155c.js","/")},{buffer:3,crypto:5,lYpoI2:10}],2:[function(o,c,d){(function(_,b,_e,it,nt,at,ut,pt,mt){(function(ft){var vt=typeof Uint8Array<"u"?Uint8Array:Array,xt=43,At=47,Ct=48,Et=97,Tt=65,kt=45,Dt=95;function zt(Bt){var Rt=Bt.charCodeAt(0);return Rt===xt||Rt===kt?62:Rt===At||Rt===Dt?63:Rt<Ct?-1:Rt<Ct+10?Rt-Ct+26+26:Rt<Tt+26?Rt-Tt:Rt<Et+26?Rt-Et+26:void 0}ft.toByteArray=function(Bt){var Rt,Ut;if(0<Bt.length%4)throw new Error("Invalid string. Length must be a multiple of 4");var Ht=Bt.length,Jt=Bt.charAt(Ht-2)==="="?2:Bt.charAt(Ht-1)==="="?1:0,Kt=new vt(3*Bt.length/4-Jt),sr=0<Jt?Bt.length-4:Bt.length,ir=0;function cr(lr){Kt[ir++]=lr}for(Rt=0;Rt<sr;Rt+=4,0)cr((16711680&(Ut=zt(Bt.charAt(Rt))<<18|zt(Bt.charAt(Rt+1))<<12|zt(Bt.charAt(Rt+2))<<6|zt(Bt.charAt(Rt+3))))>>16),cr((65280&Ut)>>8),cr(255&Ut);return Jt==2?cr(255&(Ut=zt(Bt.charAt(Rt))<<2|zt(Bt.charAt(Rt+1))>>4)):Jt==1&&(cr((Ut=zt(Bt.charAt(Rt))<<10|zt(Bt.charAt(Rt+1))<<4|zt(Bt.charAt(Rt+2))>>2)>>8&255),cr(255&Ut)),Kt},ft.fromByteArray=function(Bt){var Rt,Ut,Ht,Jt,Kt=Bt.length%3,sr="";function ir(cr){return"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(cr)}for(Rt=0,Ht=Bt.length-Kt;Rt<Ht;Rt+=3)sr+=ir((Jt=Ut=(Bt[Rt]<<16)+(Bt[Rt+1]<<8)+Bt[Rt+2])>>18&63)+ir(Jt>>12&63)+ir(Jt>>6&63)+ir(63&Jt);switch(Kt){case 1:sr+=ir((Ut=Bt[Bt.length-1])>>2),sr+=ir(Ut<<4&63),sr+="==";break;case 2:sr+=ir((Ut=(Bt[Bt.length-2]<<8)+Bt[Bt.length-1])>>10),sr+=ir(Ut>>4&63),sr+=ir(Ut<<2&63),sr+="="}return sr}})(d===void 0?this.base64js={}:d)}).call(this,o("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},o("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/base64-js/lib/b64.js","/node_modules/gulp-browserify/node_modules/base64-js/lib")},{buffer:3,lYpoI2:10}],3:[function(o,c,d){(function(_,b,xt,it,nt,at,ut,pt,mt){var ft=o("base64-js"),vt=o("ieee754");function xt(rr,mr,Rr){if(!(this instanceof xt))return new xt(rr,mr,Rr);var Yr,Zr,cn,Tn,yn,zn=typeof rr;if(mr==="base64"&&zn=="string")for(rr=(Yr=rr).trim?Yr.trim():Yr.replace(/^\s+|\s+$/g,"");rr.length%4!=0;)rr+="=";if(zn=="number")Zr=ir(rr);else if(zn=="string")Zr=xt.byteLength(rr,mr);else{if(zn!="object")throw new Error("First argument needs to be a number, array or string.");Zr=ir(rr.length)}if(xt._useTypedArrays?cn=xt._augment(new Uint8Array(Zr)):((cn=this).length=Zr,cn._isBuffer=!0),xt._useTypedArrays&&typeof rr.byteLength=="number")cn._set(rr);else if(cr(yn=rr)||xt.isBuffer(yn)||yn&&typeof yn=="object"&&typeof yn.length=="number")for(Tn=0;Tn<Zr;Tn++)xt.isBuffer(rr)?cn[Tn]=rr.readUInt8(Tn):cn[Tn]=rr[Tn];else if(zn=="string")cn.write(rr,0,mr);else if(zn=="number"&&!xt._useTypedArrays&&!Rr)for(Tn=0;Tn<Zr;Tn++)cn[Tn]=0;return cn}function At(rr,mr,Rr,Yr){Yr||(_r(typeof Rr=="boolean","missing or invalid endian"),_r(mr!=null,"missing offset"),_r(mr+1<rr.length,"Trying to read beyond buffer length"));var Zr,cn=rr.length;if(!(cn<=mr))return Rr?(Zr=rr[mr],mr+1<cn&&(Zr|=rr[mr+1]<<8)):(Zr=rr[mr]<<8,mr+1<cn&&(Zr|=rr[mr+1])),Zr}function Ct(rr,mr,Rr,Yr){Yr||(_r(typeof Rr=="boolean","missing or invalid endian"),_r(mr!=null,"missing offset"),_r(mr+3<rr.length,"Trying to read beyond buffer length"));var Zr,cn=rr.length;if(!(cn<=mr))return Rr?(mr+2<cn&&(Zr=rr[mr+2]<<16),mr+1<cn&&(Zr|=rr[mr+1]<<8),Zr|=rr[mr],mr+3<cn&&(Zr+=rr[mr+3]<<24>>>0)):(mr+1<cn&&(Zr=rr[mr+1]<<16),mr+2<cn&&(Zr|=rr[mr+2]<<8),mr+3<cn&&(Zr|=rr[mr+3]),Zr+=rr[mr]<<24>>>0),Zr}function Et(rr,mr,Rr,Yr){if(Yr||(_r(typeof Rr=="boolean","missing or invalid endian"),_r(mr!=null,"missing offset"),_r(mr+1<rr.length,"Trying to read beyond buffer length")),!(rr.length<=mr)){var Zr=At(rr,mr,Rr,!0);return 32768&Zr?-1*(65535-Zr+1):Zr}}function Tt(rr,mr,Rr,Yr){if(Yr||(_r(typeof Rr=="boolean","missing or invalid endian"),_r(mr!=null,"missing offset"),_r(mr+3<rr.length,"Trying to read beyond buffer length")),!(rr.length<=mr)){var Zr=Ct(rr,mr,Rr,!0);return 2147483648&Zr?-1*(4294967295-Zr+1):Zr}}function kt(rr,mr,Rr,Yr){return Yr||(_r(typeof Rr=="boolean","missing or invalid endian"),_r(mr+3<rr.length,"Trying to read beyond buffer length")),vt.read(rr,mr,Rr,23,4)}function Dt(rr,mr,Rr,Yr){return Yr||(_r(typeof Rr=="boolean","missing or invalid endian"),_r(mr+7<rr.length,"Trying to read beyond buffer length")),vt.read(rr,mr,Rr,52,8)}function zt(rr,mr,Rr,Yr,Zr){Zr||(_r(mr!=null,"missing value"),_r(typeof Yr=="boolean","missing or invalid endian"),_r(Rr!=null,"missing offset"),_r(Rr+1<rr.length,"trying to write beyond buffer length"),xr(mr,65535));var cn=rr.length;if(!(cn<=Rr))for(var Tn=0,yn=Math.min(cn-Rr,2);Tn<yn;Tn++)rr[Rr+Tn]=(mr&255<<8*(Yr?Tn:1-Tn))>>>8*(Yr?Tn:1-Tn)}function Bt(rr,mr,Rr,Yr,Zr){Zr||(_r(mr!=null,"missing value"),_r(typeof Yr=="boolean","missing or invalid endian"),_r(Rr!=null,"missing offset"),_r(Rr+3<rr.length,"trying to write beyond buffer length"),xr(mr,4294967295));var cn=rr.length;if(!(cn<=Rr))for(var Tn=0,yn=Math.min(cn-Rr,4);Tn<yn;Tn++)rr[Rr+Tn]=mr>>>8*(Yr?Tn:3-Tn)&255}function Rt(rr,mr,Rr,Yr,Zr){Zr||(_r(mr!=null,"missing value"),_r(typeof Yr=="boolean","missing or invalid endian"),_r(Rr!=null,"missing offset"),_r(Rr+1<rr.length,"Trying to write beyond buffer length"),vr(mr,32767,-32768)),rr.length<=Rr||zt(rr,0<=mr?mr:65535+mr+1,Rr,Yr,Zr)}function Ut(rr,mr,Rr,Yr,Zr){Zr||(_r(mr!=null,"missing value"),_r(typeof Yr=="boolean","missing or invalid endian"),_r(Rr!=null,"missing offset"),_r(Rr+3<rr.length,"Trying to write beyond buffer length"),vr(mr,2147483647,-2147483648)),rr.length<=Rr||Bt(rr,0<=mr?mr:4294967295+mr+1,Rr,Yr,Zr)}function Ht(rr,mr,Rr,Yr,Zr){Zr||(_r(mr!=null,"missing value"),_r(typeof Yr=="boolean","missing or invalid endian"),_r(Rr!=null,"missing offset"),_r(Rr+3<rr.length,"Trying to write beyond buffer length"),Dr(mr,34028234663852886e22,-34028234663852886e22)),rr.length<=Rr||vt.write(rr,mr,Rr,Yr,23,4)}function Jt(rr,mr,Rr,Yr,Zr){Zr||(_r(mr!=null,"missing value"),_r(typeof Yr=="boolean","missing or invalid endian"),_r(Rr!=null,"missing offset"),_r(Rr+7<rr.length,"Trying to write beyond buffer length"),Dr(mr,17976931348623157e292,-17976931348623157e292)),rr.length<=Rr||vt.write(rr,mr,Rr,Yr,52,8)}d.Buffer=xt,d.SlowBuffer=xt,d.INSPECT_MAX_BYTES=50,xt.poolSize=8192,xt._useTypedArrays=function(){try{var rr=new ArrayBuffer(0),mr=new Uint8Array(rr);return mr.foo=function(){return 42},mr.foo()===42&&typeof mr.subarray=="function"}catch{return!1}}(),xt.isEncoding=function(rr){switch(String(rr).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"raw":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},xt.isBuffer=function(rr){return!(rr==null||!rr._isBuffer)},xt.byteLength=function(rr,mr){var Rr;switch(rr+="",mr||"utf8"){case"hex":Rr=rr.length/2;break;case"utf8":case"utf-8":Rr=hr(rr).length;break;case"ascii":case"binary":case"raw":Rr=rr.length;break;case"base64":Rr=dr(rr).length;break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":Rr=2*rr.length;break;default:throw new Error("Unknown encoding")}return Rr},xt.concat=function(rr,mr){if(_r(cr(rr),`Usage: Buffer.concat(list, [totalLength])
list should be an Array.`),rr.length===0)return new xt(0);if(rr.length===1)return rr[0];if(typeof mr!="number")for(Zr=mr=0;Zr<rr.length;Zr++)mr+=rr[Zr].length;for(var Rr=new xt(mr),Yr=0,Zr=0;Zr<rr.length;Zr++){var cn=rr[Zr];cn.copy(Rr,Yr),Yr+=cn.length}return Rr},xt.prototype.write=function(rr,mr,Rr,Yr){var Zr;isFinite(mr)?isFinite(Rr)||(Yr=Rr,Rr=void 0):(Zr=Yr,Yr=mr,mr=Rr,Rr=Zr),mr=Number(mr)||0;var cn,Tn,yn,zn,gs,or,yr,Pr=this.length-mr;switch((!Rr||Pr<(Rr=Number(Rr)))&&(Rr=Pr),Yr=String(Yr||"utf8").toLowerCase()){case"hex":cn=function(jr,Tr,Br,Gr){Br=Number(Br)||0;var tn=jr.length-Br;(!Gr||tn<(Gr=Number(Gr)))&&(Gr=tn);var nn=Tr.length;_r(nn%2==0,"Invalid hex string"),nn/2<Gr&&(Gr=nn/2);for(var gn=0;gn<Gr;gn++){var xn=parseInt(Tr.substr(2*gn,2),16);_r(!isNaN(xn),"Invalid hex string"),jr[Br+gn]=xn}return xt._charsWritten=2*gn,gn}(this,rr,mr,Rr);break;case"utf8":case"utf-8":gs=rr,or=mr,yr=Rr,cn=xt._charsWritten=pr(hr(gs),this,or,yr);break;case"ascii":case"binary":cn=function(jr,Tr,Br,Gr){return xt._charsWritten=pr(function(tn){for(var nn=[],gn=0;gn<tn.length;gn++)nn.push(255&tn.charCodeAt(gn));return nn}(Tr),jr,Br,Gr)}(this,rr,mr,Rr);break;case"base64":Tn=rr,yn=mr,zn=Rr,cn=xt._charsWritten=pr(dr(Tn),this,yn,zn);break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":cn=function(jr,Tr,Br,Gr){return xt._charsWritten=pr(function(tn){for(var nn,gn,xn,Mn=[],An=0;An<tn.length;An++)gn=(nn=tn.charCodeAt(An))>>8,xn=nn%256,Mn.push(xn),Mn.push(gn);return Mn}(Tr),jr,Br,Gr)}(this,rr,mr,Rr);break;default:throw new Error("Unknown encoding")}return cn},xt.prototype.toString=function(rr,mr,Rr){var Yr,Zr,cn,Tn,yn=this;if(rr=String(rr||"utf8").toLowerCase(),mr=Number(mr)||0,(Rr=Rr!==void 0?Number(Rr):Rr=yn.length)===mr)return"";switch(rr){case"hex":Yr=function(zn,gs,or){var yr=zn.length;(!gs||gs<0)&&(gs=0),(!or||or<0||yr<or)&&(or=yr);for(var Pr="",jr=gs;jr<or;jr++)Pr+=lr(zn[jr]);return Pr}(yn,mr,Rr);break;case"utf8":case"utf-8":Yr=function(zn,gs,or){var yr="",Pr="";or=Math.min(zn.length,or);for(var jr=gs;jr<or;jr++)zn[jr]<=127?(yr+=ur(Pr)+String.fromCharCode(zn[jr]),Pr=""):Pr+="%"+zn[jr].toString(16);return yr+ur(Pr)}(yn,mr,Rr);break;case"ascii":case"binary":Yr=function(zn,gs,or){var yr="";or=Math.min(zn.length,or);for(var Pr=gs;Pr<or;Pr++)yr+=String.fromCharCode(zn[Pr]);return yr}(yn,mr,Rr);break;case"base64":Zr=yn,Tn=Rr,Yr=(cn=mr)===0&&Tn===Zr.length?ft.fromByteArray(Zr):ft.fromByteArray(Zr.slice(cn,Tn));break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":Yr=function(zn,gs,or){for(var yr=zn.slice(gs,or),Pr="",jr=0;jr<yr.length;jr+=2)Pr+=String.fromCharCode(yr[jr]+256*yr[jr+1]);return Pr}(yn,mr,Rr);break;default:throw new Error("Unknown encoding")}return Yr},xt.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},xt.prototype.copy=function(rr,mr,Rr,Yr){if(Rr=Rr||0,Yr||Yr===0||(Yr=this.length),mr=mr||0,Yr!==Rr&&rr.length!==0&&this.length!==0){_r(Rr<=Yr,"sourceEnd < sourceStart"),_r(0<=mr&&mr<rr.length,"targetStart out of bounds"),_r(0<=Rr&&Rr<this.length,"sourceStart out of bounds"),_r(0<=Yr&&Yr<=this.length,"sourceEnd out of bounds"),Yr>this.length&&(Yr=this.length),rr.length-mr<Yr-Rr&&(Yr=rr.length-mr+Rr);var Zr=Yr-Rr;if(Zr<100||!xt._useTypedArrays)for(var cn=0;cn<Zr;cn++)rr[cn+mr]=this[cn+Rr];else rr._set(this.subarray(Rr,Rr+Zr),mr)}},xt.prototype.slice=function(rr,mr){var Rr=this.length;if(rr=sr(rr,Rr,0),mr=sr(mr,Rr,Rr),xt._useTypedArrays)return xt._augment(this.subarray(rr,mr));for(var Yr=mr-rr,Zr=new xt(Yr,void 0,!0),cn=0;cn<Yr;cn++)Zr[cn]=this[cn+rr];return Zr},xt.prototype.get=function(rr){return console.log(".get() is deprecated. Access using array indexes instead."),this.readUInt8(rr)},xt.prototype.set=function(rr,mr){return console.log(".set() is deprecated. Access using array indexes instead."),this.writeUInt8(rr,mr)},xt.prototype.readUInt8=function(rr,mr){if(mr||(_r(rr!=null,"missing offset"),_r(rr<this.length,"Trying to read beyond buffer length")),!(rr>=this.length))return this[rr]},xt.prototype.readUInt16LE=function(rr,mr){return At(this,rr,!0,mr)},xt.prototype.readUInt16BE=function(rr,mr){return At(this,rr,!1,mr)},xt.prototype.readUInt32LE=function(rr,mr){return Ct(this,rr,!0,mr)},xt.prototype.readUInt32BE=function(rr,mr){return Ct(this,rr,!1,mr)},xt.prototype.readInt8=function(rr,mr){if(mr||(_r(rr!=null,"missing offset"),_r(rr<this.length,"Trying to read beyond buffer length")),!(rr>=this.length))return 128&this[rr]?-1*(255-this[rr]+1):this[rr]},xt.prototype.readInt16LE=function(rr,mr){return Et(this,rr,!0,mr)},xt.prototype.readInt16BE=function(rr,mr){return Et(this,rr,!1,mr)},xt.prototype.readInt32LE=function(rr,mr){return Tt(this,rr,!0,mr)},xt.prototype.readInt32BE=function(rr,mr){return Tt(this,rr,!1,mr)},xt.prototype.readFloatLE=function(rr,mr){return kt(this,rr,!0,mr)},xt.prototype.readFloatBE=function(rr,mr){return kt(this,rr,!1,mr)},xt.prototype.readDoubleLE=function(rr,mr){return Dt(this,rr,!0,mr)},xt.prototype.readDoubleBE=function(rr,mr){return Dt(this,rr,!1,mr)},xt.prototype.writeUInt8=function(rr,mr,Rr){Rr||(_r(rr!=null,"missing value"),_r(mr!=null,"missing offset"),_r(mr<this.length,"trying to write beyond buffer length"),xr(rr,255)),mr>=this.length||(this[mr]=rr)},xt.prototype.writeUInt16LE=function(rr,mr,Rr){zt(this,rr,mr,!0,Rr)},xt.prototype.writeUInt16BE=function(rr,mr,Rr){zt(this,rr,mr,!1,Rr)},xt.prototype.writeUInt32LE=function(rr,mr,Rr){Bt(this,rr,mr,!0,Rr)},xt.prototype.writeUInt32BE=function(rr,mr,Rr){Bt(this,rr,mr,!1,Rr)},xt.prototype.writeInt8=function(rr,mr,Rr){Rr||(_r(rr!=null,"missing value"),_r(mr!=null,"missing offset"),_r(mr<this.length,"Trying to write beyond buffer length"),vr(rr,127,-128)),mr>=this.length||(0<=rr?this.writeUInt8(rr,mr,Rr):this.writeUInt8(255+rr+1,mr,Rr))},xt.prototype.writeInt16LE=function(rr,mr,Rr){Rt(this,rr,mr,!0,Rr)},xt.prototype.writeInt16BE=function(rr,mr,Rr){Rt(this,rr,mr,!1,Rr)},xt.prototype.writeInt32LE=function(rr,mr,Rr){Ut(this,rr,mr,!0,Rr)},xt.prototype.writeInt32BE=function(rr,mr,Rr){Ut(this,rr,mr,!1,Rr)},xt.prototype.writeFloatLE=function(rr,mr,Rr){Ht(this,rr,mr,!0,Rr)},xt.prototype.writeFloatBE=function(rr,mr,Rr){Ht(this,rr,mr,!1,Rr)},xt.prototype.writeDoubleLE=function(rr,mr,Rr){Jt(this,rr,mr,!0,Rr)},xt.prototype.writeDoubleBE=function(rr,mr,Rr){Jt(this,rr,mr,!1,Rr)},xt.prototype.fill=function(rr,mr,Rr){if(rr=rr||0,mr=mr||0,Rr=Rr||this.length,typeof rr=="string"&&(rr=rr.charCodeAt(0)),_r(typeof rr=="number"&&!isNaN(rr),"value is not a number"),_r(mr<=Rr,"end < start"),Rr!==mr&&this.length!==0){_r(0<=mr&&mr<this.length,"start out of bounds"),_r(0<=Rr&&Rr<=this.length,"end out of bounds");for(var Yr=mr;Yr<Rr;Yr++)this[Yr]=rr}},xt.prototype.inspect=function(){for(var rr=[],mr=this.length,Rr=0;Rr<mr;Rr++)if(rr[Rr]=lr(this[Rr]),Rr===d.INSPECT_MAX_BYTES){rr[Rr+1]="...";break}return"<Buffer "+rr.join(" ")+">"},xt.prototype.toArrayBuffer=function(){if(typeof Uint8Array>"u")throw new Error("Buffer.toArrayBuffer not supported in this browser");if(xt._useTypedArrays)return new xt(this).buffer;for(var rr=new Uint8Array(this.length),mr=0,Rr=rr.length;mr<Rr;mr+=1)rr[mr]=this[mr];return rr.buffer};var Kt=xt.prototype;function sr(rr,mr,Rr){return typeof rr!="number"?Rr:mr<=(rr=~~rr)?mr:0<=rr||0<=(rr+=mr)?rr:0}function ir(rr){return(rr=~~Math.ceil(+rr))<0?0:rr}function cr(rr){return(Array.isArray||function(mr){return Object.prototype.toString.call(mr)==="[object Array]"})(rr)}function lr(rr){return rr<16?"0"+rr.toString(16):rr.toString(16)}function hr(rr){for(var mr=[],Rr=0;Rr<rr.length;Rr++){var Yr=rr.charCodeAt(Rr);if(Yr<=127)mr.push(rr.charCodeAt(Rr));else{var Zr=Rr;55296<=Yr&&Yr<=57343&&Rr++;for(var cn=encodeURIComponent(rr.slice(Zr,Rr+1)).substr(1).split("%"),Tn=0;Tn<cn.length;Tn++)mr.push(parseInt(cn[Tn],16))}}return mr}function dr(rr){return ft.toByteArray(rr)}function pr(rr,mr,Rr,Yr){for(var Zr=0;Zr<Yr&&!(Zr+Rr>=mr.length||Zr>=rr.length);Zr++)mr[Zr+Rr]=rr[Zr];return Zr}function ur(rr){try{return decodeURIComponent(rr)}catch{return""}}function xr(rr,mr){_r(typeof rr=="number","cannot write a non-number as a number"),_r(0<=rr,"specified a negative value for writing an unsigned value"),_r(rr<=mr,"value is larger than maximum value for type"),_r(Math.floor(rr)===rr,"value has a fractional component")}function vr(rr,mr,Rr){_r(typeof rr=="number","cannot write a non-number as a number"),_r(rr<=mr,"value larger than maximum allowed value"),_r(Rr<=rr,"value smaller than minimum allowed value"),_r(Math.floor(rr)===rr,"value has a fractional component")}function Dr(rr,mr,Rr){_r(typeof rr=="number","cannot write a non-number as a number"),_r(rr<=mr,"value larger than maximum allowed value"),_r(Rr<=rr,"value smaller than minimum allowed value")}function _r(rr,mr){if(!rr)throw new Error(mr||"Failed assertion")}xt._augment=function(rr){return rr._isBuffer=!0,rr._get=rr.get,rr._set=rr.set,rr.get=Kt.get,rr.set=Kt.set,rr.write=Kt.write,rr.toString=Kt.toString,rr.toLocaleString=Kt.toString,rr.toJSON=Kt.toJSON,rr.copy=Kt.copy,rr.slice=Kt.slice,rr.readUInt8=Kt.readUInt8,rr.readUInt16LE=Kt.readUInt16LE,rr.readUInt16BE=Kt.readUInt16BE,rr.readUInt32LE=Kt.readUInt32LE,rr.readUInt32BE=Kt.readUInt32BE,rr.readInt8=Kt.readInt8,rr.readInt16LE=Kt.readInt16LE,rr.readInt16BE=Kt.readInt16BE,rr.readInt32LE=Kt.readInt32LE,rr.readInt32BE=Kt.readInt32BE,rr.readFloatLE=Kt.readFloatLE,rr.readFloatBE=Kt.readFloatBE,rr.readDoubleLE=Kt.readDoubleLE,rr.readDoubleBE=Kt.readDoubleBE,rr.writeUInt8=Kt.writeUInt8,rr.writeUInt16LE=Kt.writeUInt16LE,rr.writeUInt16BE=Kt.writeUInt16BE,rr.writeUInt32LE=Kt.writeUInt32LE,rr.writeUInt32BE=Kt.writeUInt32BE,rr.writeInt8=Kt.writeInt8,rr.writeInt16LE=Kt.writeInt16LE,rr.writeInt16BE=Kt.writeInt16BE,rr.writeInt32LE=Kt.writeInt32LE,rr.writeInt32BE=Kt.writeInt32BE,rr.writeFloatLE=Kt.writeFloatLE,rr.writeFloatBE=Kt.writeFloatBE,rr.writeDoubleLE=Kt.writeDoubleLE,rr.writeDoubleBE=Kt.writeDoubleBE,rr.fill=Kt.fill,rr.inspect=Kt.inspect,rr.toArrayBuffer=Kt.toArrayBuffer,rr}}).call(this,o("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},o("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/buffer/index.js","/node_modules/gulp-browserify/node_modules/buffer")},{"base64-js":2,buffer:3,ieee754:11,lYpoI2:10}],4:[function(o,c,d){(function(_,b,_e,it,nt,at,ut,pt,mt){_e=o("buffer").Buffer;var ft=new _e(4);ft.fill(0),c.exports={hash:function(vt,xt,At,Ct){return _e.isBuffer(vt)||(vt=new _e(vt)),function(Et,Tt,kt){for(var Dt=new _e(Tt),zt=kt?Dt.writeInt32BE:Dt.writeInt32LE,Bt=0;Bt<Et.length;Bt++)zt.call(Dt,Et[Bt],4*Bt,!0);return Dt}(xt(function(Et,Tt){var kt;Et.length%4!=0&&(kt=Et.length+(4-Et.length%4),Et=_e.concat([Et,ft],kt));for(var Dt=[],zt=Tt?Et.readInt32BE:Et.readInt32LE,Bt=0;Bt<Et.length;Bt+=4)Dt.push(zt.call(Et,Bt));return Dt}(vt,Ct),8*vt.length),At,Ct)}}}).call(this,o("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},o("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/helpers.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{buffer:3,lYpoI2:10}],5:[function(o,c,d){(function(_,b,_e,it,nt,at,ut,pt,mt){_e=o("buffer").Buffer;var ft=o("./sha"),vt=o("./sha256"),xt=o("./rng"),At={sha1:ft,sha256:vt,md5:o("./md5")},Ct=64,Et=new _e(Ct);function Tt(Dt,zt){var Bt=At[Dt=Dt||"sha1"],Rt=[];return Bt||kt("algorithm:",Dt,"is not yet supported"),{update:function(Ut){return _e.isBuffer(Ut)||(Ut=new _e(Ut)),Rt.push(Ut),Ut.length,this},digest:function(Ut){var Ht=_e.concat(Rt),Jt=zt?function(Kt,sr,ir){_e.isBuffer(sr)||(sr=new _e(sr)),_e.isBuffer(ir)||(ir=new _e(ir)),sr.length>Ct?sr=Kt(sr):sr.length<Ct&&(sr=_e.concat([sr,Et],Ct));for(var cr=new _e(Ct),lr=new _e(Ct),hr=0;hr<Ct;hr++)cr[hr]=54^sr[hr],lr[hr]=92^sr[hr];var dr=Kt(_e.concat([cr,ir]));return Kt(_e.concat([lr,dr]))}(Bt,zt,Ht):Bt(Ht);return Rt=null,Ut?Jt.toString(Ut):Jt}}}function kt(){var Dt=[].slice.call(arguments).join(" ");throw new Error([Dt,"we accept pull requests","http://github.com/dominictarr/crypto-browserify"].join(`
`))}Et.fill(0),d.createHash=function(Dt){return Tt(Dt)},d.createHmac=Tt,d.randomBytes=function(Dt,zt){if(!zt||!zt.call)return new _e(xt(Dt));try{zt.call(this,void 0,new _e(xt(Dt)))}catch(Bt){zt(Bt)}},function(Dt,zt){for(var Bt in Dt)zt(Dt[Bt])}(["createCredentials","createCipher","createCipheriv","createDecipher","createDecipheriv","createSign","createVerify","createDiffieHellman","pbkdf2"],function(Dt){d[Dt]=function(){kt("sorry,",Dt,"is not implemented yet")}})}).call(this,o("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},o("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/index.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./md5":6,"./rng":7,"./sha":8,"./sha256":9,buffer:3,lYpoI2:10}],6:[function(o,c,d){(function(_,b,_e,it,nt,at,ut,pt,mt){var ft=o("./helpers");function vt(Dt,zt){Dt[zt>>5]|=128<<zt%32,Dt[14+(zt+64>>>9<<4)]=zt;for(var Bt=1732584193,Rt=-271733879,Ut=-1732584194,Ht=271733878,Jt=0;Jt<Dt.length;Jt+=16){var Kt=Bt,sr=Rt,ir=Ut,cr=Ht;Bt=At(Bt,Rt,Ut,Ht,Dt[Jt+0],7,-680876936),Ht=At(Ht,Bt,Rt,Ut,Dt[Jt+1],12,-389564586),Ut=At(Ut,Ht,Bt,Rt,Dt[Jt+2],17,606105819),Rt=At(Rt,Ut,Ht,Bt,Dt[Jt+3],22,-1044525330),Bt=At(Bt,Rt,Ut,Ht,Dt[Jt+4],7,-176418897),Ht=At(Ht,Bt,Rt,Ut,Dt[Jt+5],12,1200080426),Ut=At(Ut,Ht,Bt,Rt,Dt[Jt+6],17,-1473231341),Rt=At(Rt,Ut,Ht,Bt,Dt[Jt+7],22,-45705983),Bt=At(Bt,Rt,Ut,Ht,Dt[Jt+8],7,1770035416),Ht=At(Ht,Bt,Rt,Ut,Dt[Jt+9],12,-1958414417),Ut=At(Ut,Ht,Bt,Rt,Dt[Jt+10],17,-42063),Rt=At(Rt,Ut,Ht,Bt,Dt[Jt+11],22,-1990404162),Bt=At(Bt,Rt,Ut,Ht,Dt[Jt+12],7,1804603682),Ht=At(Ht,Bt,Rt,Ut,Dt[Jt+13],12,-40341101),Ut=At(Ut,Ht,Bt,Rt,Dt[Jt+14],17,-1502002290),Bt=Ct(Bt,Rt=At(Rt,Ut,Ht,Bt,Dt[Jt+15],22,1236535329),Ut,Ht,Dt[Jt+1],5,-165796510),Ht=Ct(Ht,Bt,Rt,Ut,Dt[Jt+6],9,-1069501632),Ut=Ct(Ut,Ht,Bt,Rt,Dt[Jt+11],14,643717713),Rt=Ct(Rt,Ut,Ht,Bt,Dt[Jt+0],20,-373897302),Bt=Ct(Bt,Rt,Ut,Ht,Dt[Jt+5],5,-701558691),Ht=Ct(Ht,Bt,Rt,Ut,Dt[Jt+10],9,38016083),Ut=Ct(Ut,Ht,Bt,Rt,Dt[Jt+15],14,-660478335),Rt=Ct(Rt,Ut,Ht,Bt,Dt[Jt+4],20,-405537848),Bt=Ct(Bt,Rt,Ut,Ht,Dt[Jt+9],5,568446438),Ht=Ct(Ht,Bt,Rt,Ut,Dt[Jt+14],9,-1019803690),Ut=Ct(Ut,Ht,Bt,Rt,Dt[Jt+3],14,-187363961),Rt=Ct(Rt,Ut,Ht,Bt,Dt[Jt+8],20,1163531501),Bt=Ct(Bt,Rt,Ut,Ht,Dt[Jt+13],5,-1444681467),Ht=Ct(Ht,Bt,Rt,Ut,Dt[Jt+2],9,-51403784),Ut=Ct(Ut,Ht,Bt,Rt,Dt[Jt+7],14,1735328473),Bt=Et(Bt,Rt=Ct(Rt,Ut,Ht,Bt,Dt[Jt+12],20,-1926607734),Ut,Ht,Dt[Jt+5],4,-378558),Ht=Et(Ht,Bt,Rt,Ut,Dt[Jt+8],11,-2022574463),Ut=Et(Ut,Ht,Bt,Rt,Dt[Jt+11],16,1839030562),Rt=Et(Rt,Ut,Ht,Bt,Dt[Jt+14],23,-35309556),Bt=Et(Bt,Rt,Ut,Ht,Dt[Jt+1],4,-1530992060),Ht=Et(Ht,Bt,Rt,Ut,Dt[Jt+4],11,1272893353),Ut=Et(Ut,Ht,Bt,Rt,Dt[Jt+7],16,-155497632),Rt=Et(Rt,Ut,Ht,Bt,Dt[Jt+10],23,-1094730640),Bt=Et(Bt,Rt,Ut,Ht,Dt[Jt+13],4,681279174),Ht=Et(Ht,Bt,Rt,Ut,Dt[Jt+0],11,-358537222),Ut=Et(Ut,Ht,Bt,Rt,Dt[Jt+3],16,-722521979),Rt=Et(Rt,Ut,Ht,Bt,Dt[Jt+6],23,76029189),Bt=Et(Bt,Rt,Ut,Ht,Dt[Jt+9],4,-640364487),Ht=Et(Ht,Bt,Rt,Ut,Dt[Jt+12],11,-421815835),Ut=Et(Ut,Ht,Bt,Rt,Dt[Jt+15],16,530742520),Bt=Tt(Bt,Rt=Et(Rt,Ut,Ht,Bt,Dt[Jt+2],23,-995338651),Ut,Ht,Dt[Jt+0],6,-198630844),Ht=Tt(Ht,Bt,Rt,Ut,Dt[Jt+7],10,1126891415),Ut=Tt(Ut,Ht,Bt,Rt,Dt[Jt+14],15,-1416354905),Rt=Tt(Rt,Ut,Ht,Bt,Dt[Jt+5],21,-57434055),Bt=Tt(Bt,Rt,Ut,Ht,Dt[Jt+12],6,1700485571),Ht=Tt(Ht,Bt,Rt,Ut,Dt[Jt+3],10,-1894986606),Ut=Tt(Ut,Ht,Bt,Rt,Dt[Jt+10],15,-1051523),Rt=Tt(Rt,Ut,Ht,Bt,Dt[Jt+1],21,-2054922799),Bt=Tt(Bt,Rt,Ut,Ht,Dt[Jt+8],6,1873313359),Ht=Tt(Ht,Bt,Rt,Ut,Dt[Jt+15],10,-30611744),Ut=Tt(Ut,Ht,Bt,Rt,Dt[Jt+6],15,-1560198380),Rt=Tt(Rt,Ut,Ht,Bt,Dt[Jt+13],21,1309151649),Bt=Tt(Bt,Rt,Ut,Ht,Dt[Jt+4],6,-145523070),Ht=Tt(Ht,Bt,Rt,Ut,Dt[Jt+11],10,-1120210379),Ut=Tt(Ut,Ht,Bt,Rt,Dt[Jt+2],15,718787259),Rt=Tt(Rt,Ut,Ht,Bt,Dt[Jt+9],21,-343485551),Bt=kt(Bt,Kt),Rt=kt(Rt,sr),Ut=kt(Ut,ir),Ht=kt(Ht,cr)}return Array(Bt,Rt,Ut,Ht)}function xt(Dt,zt,Bt,Rt,Ut,Ht){return kt((Jt=kt(kt(zt,Dt),kt(Rt,Ht)))<<(Kt=Ut)|Jt>>>32-Kt,Bt);var Jt,Kt}function At(Dt,zt,Bt,Rt,Ut,Ht,Jt){return xt(zt&Bt|~zt&Rt,Dt,zt,Ut,Ht,Jt)}function Ct(Dt,zt,Bt,Rt,Ut,Ht,Jt){return xt(zt&Rt|Bt&~Rt,Dt,zt,Ut,Ht,Jt)}function Et(Dt,zt,Bt,Rt,Ut,Ht,Jt){return xt(zt^Bt^Rt,Dt,zt,Ut,Ht,Jt)}function Tt(Dt,zt,Bt,Rt,Ut,Ht,Jt){return xt(Bt^(zt|~Rt),Dt,zt,Ut,Ht,Jt)}function kt(Dt,zt){var Bt=(65535&Dt)+(65535&zt);return(Dt>>16)+(zt>>16)+(Bt>>16)<<16|65535&Bt}c.exports=function(Dt){return ft.hash(Dt,vt,16)}}).call(this,o("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},o("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/md5.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:10}],7:[function(o,c,d){(function(_,b,_e,it,nt,at,ut,pt,mt){var ft;ft=function(vt){for(var xt,At=new Array(vt),Ct=0;Ct<vt;Ct++)!(3&Ct)&&(xt=4294967296*Math.random()),At[Ct]=xt>>>((3&Ct)<<3)&255;return At},c.exports=ft}).call(this,o("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},o("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/rng.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{buffer:3,lYpoI2:10}],8:[function(o,c,d){(function(_,b,_e,it,nt,at,ut,pt,mt){var ft=o("./helpers");function vt(Ct,Et){Ct[Et>>5]|=128<<24-Et%32,Ct[15+(Et+64>>9<<4)]=Et;for(var Tt,kt,Dt,zt,Bt,Rt=Array(80),Ut=1732584193,Ht=-271733879,Jt=-1732584194,Kt=271733878,sr=-1009589776,ir=0;ir<Ct.length;ir+=16){for(var cr=Ut,lr=Ht,hr=Jt,dr=Kt,pr=sr,ur=0;ur<80;ur++){Rt[ur]=ur<16?Ct[ir+ur]:At(Rt[ur-3]^Rt[ur-8]^Rt[ur-14]^Rt[ur-16],1);var xr=xt(xt(At(Ut,5),(Dt=Ht,zt=Jt,Bt=Kt,(kt=ur)<20?Dt&zt|~Dt&Bt:!(kt<40)&&kt<60?Dt&zt|Dt&Bt|zt&Bt:Dt^zt^Bt)),xt(xt(sr,Rt[ur]),(Tt=ur)<20?1518500249:Tt<40?1859775393:Tt<60?-1894007588:-899497514));sr=Kt,Kt=Jt,Jt=At(Ht,30),Ht=Ut,Ut=xr}Ut=xt(Ut,cr),Ht=xt(Ht,lr),Jt=xt(Jt,hr),Kt=xt(Kt,dr),sr=xt(sr,pr)}return Array(Ut,Ht,Jt,Kt,sr)}function xt(Ct,Et){var Tt=(65535&Ct)+(65535&Et);return(Ct>>16)+(Et>>16)+(Tt>>16)<<16|65535&Tt}function At(Ct,Et){return Ct<<Et|Ct>>>32-Et}c.exports=function(Ct){return ft.hash(Ct,vt,20,!0)}}).call(this,o("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},o("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/sha.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:10}],9:[function(o,c,d){(function(_,b,_e,it,nt,at,ut,pt,mt){function ft(Ct,Et){var Tt=(65535&Ct)+(65535&Et);return(Ct>>16)+(Et>>16)+(Tt>>16)<<16|65535&Tt}function vt(Ct,Et){return Ct>>>Et|Ct<<32-Et}function xt(Ct,Et){var Tt,kt,Dt,zt,Bt,Rt,Ut,Ht,Jt,Kt,sr=new Array(1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298),ir=new Array(1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225),cr=new Array(64);Ct[Et>>5]|=128<<24-Et%32,Ct[15+(Et+64>>9<<4)]=Et;for(var lr,hr,dr,pr,ur,xr,vr,Dr,_r=0;_r<Ct.length;_r+=16){Tt=ir[0],kt=ir[1],Dt=ir[2],zt=ir[3],Bt=ir[4],Rt=ir[5],Ut=ir[6],Ht=ir[7];for(var rr=0;rr<64;rr++)cr[rr]=rr<16?Ct[rr+_r]:ft(ft(ft(vt(Dr=cr[rr-2],17)^vt(Dr,19)^Dr>>>10,cr[rr-7]),vt(vr=cr[rr-15],7)^vt(vr,18)^vr>>>3),cr[rr-16]),Jt=ft(ft(ft(ft(Ht,vt(xr=Bt,6)^vt(xr,11)^vt(xr,25)),(ur=Bt)&Rt^~ur&Ut),sr[rr]),cr[rr]),Kt=ft(vt(pr=Tt,2)^vt(pr,13)^vt(pr,22),(lr=Tt)&(hr=kt)^lr&(dr=Dt)^hr&dr),Ht=Ut,Ut=Rt,Rt=Bt,Bt=ft(zt,Jt),zt=Dt,Dt=kt,kt=Tt,Tt=ft(Jt,Kt);ir[0]=ft(Tt,ir[0]),ir[1]=ft(kt,ir[1]),ir[2]=ft(Dt,ir[2]),ir[3]=ft(zt,ir[3]),ir[4]=ft(Bt,ir[4]),ir[5]=ft(Rt,ir[5]),ir[6]=ft(Ut,ir[6]),ir[7]=ft(Ht,ir[7])}return ir}var At=o("./helpers");c.exports=function(Ct){return At.hash(Ct,xt,32,!0)}}).call(this,o("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},o("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/sha256.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:10}],10:[function(o,c,d){(function(_,b,_e,it,nt,at,ut,pt,mt){function ft(){}(_=c.exports={}).nextTick=function(){var vt=typeof window<"u"&&window.setImmediate,xt=typeof window<"u"&&window.postMessage&&window.addEventListener;if(vt)return function(Ct){return window.setImmediate(Ct)};if(xt){var At=[];return window.addEventListener("message",function(Ct){var Et=Ct.source;Et!==window&&Et!==null||Ct.data!=="process-tick"||(Ct.stopPropagation(),0<At.length&&At.shift()())},!0),function(Ct){At.push(Ct),window.postMessage("process-tick","*")}}return function(Ct){setTimeout(Ct,0)}}(),_.title="browser",_.browser=!0,_.env={},_.argv=[],_.on=ft,_.addListener=ft,_.once=ft,_.off=ft,_.removeListener=ft,_.removeAllListeners=ft,_.emit=ft,_.binding=function(vt){throw new Error("process.binding is not supported")},_.cwd=function(){return"/"},_.chdir=function(vt){throw new Error("process.chdir is not supported")}}).call(this,o("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},o("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/process/browser.js","/node_modules/gulp-browserify/node_modules/process")},{buffer:3,lYpoI2:10}],11:[function(o,c,d){(function(_,b,_e,it,nt,at,ut,pt,mt){d.read=function(ft,vt,xt,At,Ct){var Et,Tt,kt=8*Ct-At-1,Dt=(1<<kt)-1,zt=Dt>>1,Bt=-7,Rt=xt?Ct-1:0,Ut=xt?-1:1,Ht=ft[vt+Rt];for(Rt+=Ut,Et=Ht&(1<<-Bt)-1,Ht>>=-Bt,Bt+=kt;0<Bt;Et=256*Et+ft[vt+Rt],Rt+=Ut,Bt-=8);for(Tt=Et&(1<<-Bt)-1,Et>>=-Bt,Bt+=At;0<Bt;Tt=256*Tt+ft[vt+Rt],Rt+=Ut,Bt-=8);if(Et===0)Et=1-zt;else{if(Et===Dt)return Tt?NaN:1/0*(Ht?-1:1);Tt+=Math.pow(2,At),Et-=zt}return(Ht?-1:1)*Tt*Math.pow(2,Et-At)},d.write=function(ft,vt,xt,At,Ct,Et){var Tt,kt,Dt,zt=8*Et-Ct-1,Bt=(1<<zt)-1,Rt=Bt>>1,Ut=Ct===23?Math.pow(2,-24)-Math.pow(2,-77):0,Ht=At?0:Et-1,Jt=At?1:-1,Kt=vt<0||vt===0&&1/vt<0?1:0;for(vt=Math.abs(vt),isNaN(vt)||vt===1/0?(kt=isNaN(vt)?1:0,Tt=Bt):(Tt=Math.floor(Math.log(vt)/Math.LN2),vt*(Dt=Math.pow(2,-Tt))<1&&(Tt--,Dt*=2),2<=(vt+=1<=Tt+Rt?Ut/Dt:Ut*Math.pow(2,1-Rt))*Dt&&(Tt++,Dt/=2),Bt<=Tt+Rt?(kt=0,Tt=Bt):1<=Tt+Rt?(kt=(vt*Dt-1)*Math.pow(2,Ct),Tt+=Rt):(kt=vt*Math.pow(2,Rt-1)*Math.pow(2,Ct),Tt=0));8<=Ct;ft[xt+Ht]=255&kt,Ht+=Jt,kt/=256,Ct-=8);for(Tt=Tt<<Ct|kt,zt+=Ct;0<zt;ft[xt+Ht]=255&Tt,Ht+=Jt,Tt/=256,zt-=8);ft[xt+Ht-Jt]|=128*Kt}}).call(this,o("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},o("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/ieee754/index.js","/node_modules/ieee754")},{buffer:3,lYpoI2:10}]},{},[1])(1)},391:function(h){var o=function(){function c(xt){return ut(xt,pt(at(mt(xt.length),xt),1/xt.length))}function d(xt){return at(ft(xt),xt)}function _(xt,At){return pt(xt,At?1/(xt.length-1):1/xt.length)}function b(xt){var At=function(Tt){var kt,Dt=Math.pow(2,-52),zt=1e-64/Dt,Bt=0,Rt=0,Ut=0,Ht=0,Jt=0,Kt=vt(Tt),sr=Kt.length,ir=Kt[0].length;if(sr<ir)throw"Need more rows than columns";var cr=new Array(ir),lr=new Array(ir);for(Rt=0;Rt<ir;Rt++)cr[Rt]=lr[Rt]=0;var hr=function Zr(cn,Tn,yn){yn===void 0&&(yn=0);var zn,gs=cn[yn],or=Array(gs);if(yn===cn.length-1){for(zn=gs-2;zn>=0;zn-=2)or[zn+1]=Tn,or[zn]=Tn;return zn===-1&&(or[0]=Tn),or}for(zn=gs-1;zn>=0;zn--)or[zn]=Zr(cn,Tn,yn+1);return or}([ir,ir],0);function dr(Zr,cn){return(Zr=Math.abs(Zr))>(cn=Math.abs(cn))?Zr*Math.sqrt(1+cn*cn/Zr/Zr):cn==0?Zr:cn*Math.sqrt(1+Zr*Zr/cn/cn)}var pr=0,ur=0,xr=0,vr=0,Dr=0,_r=0,rr=0;for(Rt=0;Rt<ir;Rt++){for(cr[Rt]=ur,rr=0,Jt=Rt+1,Ut=Rt;Ut<sr;Ut++)rr+=Kt[Ut][Rt]*Kt[Ut][Rt];if(rr<=zt)ur=0;else for(pr=Kt[Rt][Rt],ur=Math.sqrt(rr),pr>=0&&(ur=-ur),xr=pr*ur-rr,Kt[Rt][Rt]=pr-ur,Ut=Jt;Ut<ir;Ut++){for(rr=0,Ht=Rt;Ht<sr;Ht++)rr+=Kt[Ht][Rt]*Kt[Ht][Ut];for(pr=rr/xr,Ht=Rt;Ht<sr;Ht++)Kt[Ht][Ut]+=pr*Kt[Ht][Rt]}for(lr[Rt]=ur,rr=0,Ut=Jt;Ut<ir;Ut++)rr+=Kt[Rt][Ut]*Kt[Rt][Ut];if(rr<=zt)ur=0;else{for(pr=Kt[Rt][Rt+1],ur=Math.sqrt(rr),pr>=0&&(ur=-ur),xr=pr*ur-rr,Kt[Rt][Rt+1]=pr-ur,Ut=Jt;Ut<ir;Ut++)cr[Ut]=Kt[Rt][Ut]/xr;for(Ut=Jt;Ut<sr;Ut++){for(rr=0,Ht=Jt;Ht<ir;Ht++)rr+=Kt[Ut][Ht]*Kt[Rt][Ht];for(Ht=Jt;Ht<ir;Ht++)Kt[Ut][Ht]+=rr*cr[Ht]}}(Dr=Math.abs(lr[Rt])+Math.abs(cr[Rt]))>vr&&(vr=Dr)}for(Rt=ir-1;Rt!=-1;Rt+=-1){if(ur!=0){for(xr=ur*Kt[Rt][Rt+1],Ut=Jt;Ut<ir;Ut++)hr[Ut][Rt]=Kt[Rt][Ut]/xr;for(Ut=Jt;Ut<ir;Ut++){for(rr=0,Ht=Jt;Ht<ir;Ht++)rr+=Kt[Rt][Ht]*hr[Ht][Ut];for(Ht=Jt;Ht<ir;Ht++)hr[Ht][Ut]+=rr*hr[Ht][Rt]}}for(Ut=Jt;Ut<ir;Ut++)hr[Rt][Ut]=0,hr[Ut][Rt]=0;hr[Rt][Rt]=1,ur=cr[Rt],Jt=Rt}for(Rt=ir-1;Rt!=-1;Rt+=-1){for(Jt=Rt+1,ur=lr[Rt],Ut=Jt;Ut<ir;Ut++)Kt[Rt][Ut]=0;if(ur!=0){for(xr=Kt[Rt][Rt]*ur,Ut=Jt;Ut<ir;Ut++){for(rr=0,Ht=Jt;Ht<sr;Ht++)rr+=Kt[Ht][Rt]*Kt[Ht][Ut];for(pr=rr/xr,Ht=Rt;Ht<sr;Ht++)Kt[Ht][Ut]+=pr*Kt[Ht][Rt]}for(Ut=Rt;Ut<sr;Ut++)Kt[Ut][Rt]=Kt[Ut][Rt]/ur}else for(Ut=Rt;Ut<sr;Ut++)Kt[Ut][Rt]=0;Kt[Rt][Rt]+=1}for(Dt*=vr,Ht=ir-1;Ht!=-1;Ht+=-1)for(var mr=0;mr<50;mr++){var Rr=!1;for(Jt=Ht;Jt!=-1;Jt+=-1){if(Math.abs(cr[Jt])<=Dt){Rr=!0;break}if(Math.abs(lr[Jt-1])<=Dt)break}if(!Rr){Bt=0,rr=1;var Yr=Jt-1;for(Rt=Jt;Rt<Ht+1&&(pr=rr*cr[Rt],cr[Rt]=Bt*cr[Rt],!(Math.abs(pr)<=Dt));Rt++)for(xr=dr(pr,ur=lr[Rt]),lr[Rt]=xr,Bt=ur/xr,rr=-pr/xr,Ut=0;Ut<sr;Ut++)Dr=Kt[Ut][Yr],_r=Kt[Ut][Rt],Kt[Ut][Yr]=Dr*Bt+_r*rr,Kt[Ut][Rt]=-Dr*rr+_r*Bt}if(_r=lr[Ht],Jt==Ht){if(_r<0)for(lr[Ht]=-_r,Ut=0;Ut<ir;Ut++)hr[Ut][Ht]=-hr[Ut][Ht];break}if(mr>=49)throw"Error: no convergence.";for(vr=lr[Jt],ur=dr(pr=(((Dr=lr[Ht-1])-_r)*(Dr+_r)+((ur=cr[Ht-1])-(xr=cr[Ht]))*(ur+xr))/(2*xr*Dr),1),pr=pr<0?((vr-_r)*(vr+_r)+xr*(Dr/(pr-ur)-xr))/vr:((vr-_r)*(vr+_r)+xr*(Dr/(pr+ur)-xr))/vr,Bt=1,rr=1,Rt=Jt+1;Rt<Ht+1;Rt++){for(ur=cr[Rt],Dr=lr[Rt],xr=rr*ur,ur*=Bt,_r=dr(pr,xr),cr[Rt-1]=_r,pr=vr*(Bt=pr/_r)+ur*(rr=xr/_r),ur=-vr*rr+ur*Bt,xr=Dr*rr,Dr*=Bt,Ut=0;Ut<ir;Ut++)vr=hr[Ut][Rt-1],_r=hr[Ut][Rt],hr[Ut][Rt-1]=vr*Bt+_r*rr,hr[Ut][Rt]=-vr*rr+_r*Bt;for(_r=dr(pr,xr),lr[Rt-1]=_r,pr=(Bt=pr/_r)*ur+(rr=xr/_r)*Dr,vr=-rr*ur+Bt*Dr,Ut=0;Ut<sr;Ut++)Dr=Kt[Ut][Rt-1],_r=Kt[Ut][Rt],Kt[Ut][Rt-1]=Dr*Bt+_r*rr,Kt[Ut][Rt]=-Dr*rr+_r*Bt}cr[Jt]=0,cr[Ht]=pr,lr[Ht]=vr}for(Rt=0;Rt<lr.length;Rt++)lr[Rt]<Dt&&(lr[Rt]=0);for(Rt=0;Rt<ir;Rt++)for(Ut=Rt-1;Ut>=0;Ut--)if(lr[Ut]<lr[Rt]){for(Bt=lr[Ut],lr[Ut]=lr[Rt],lr[Rt]=Bt,Ht=0;Ht<Kt.length;Ht++)kt=Kt[Ht][Rt],Kt[Ht][Rt]=Kt[Ht][Ut],Kt[Ht][Ut]=kt;for(Ht=0;Ht<hr.length;Ht++)kt=hr[Ht][Rt],hr[Ht][Rt]=hr[Ht][Ut],hr[Ht][Ut]=kt;Rt=Ut}return{U:Kt,S:lr,V:hr}}(xt);console.log(At);var Ct=At.U,Et=At.S.map(function(Tt,kt){var Dt={};return Dt.eigenvalue=Tt,Dt.vector=Ct.map(function(zt,Bt){return-1*zt[kt]}),Dt});return Et}function _e(xt,...At){var Ct=At.map(function(kt){return kt.vector}),Et=at(Ct,ft(c(xt))),Tt=pt(at(mt(xt.length),xt),-1/xt.length);return{adjustedData:Et,formattedAdjustedData:nt(Et,2),avgData:Tt,selectedVectors:Ct}}function it(xt){return b(_(d(c(xt)),!1))}function nt(xt,At){var Ct=Math.pow(10,At);return xt.map(function(Et,Tt){return Et.map(function(kt){return Math.round(kt*Ct)/Ct})})}function at(xt,At){if(!(xt[0]&&At[0]&&xt.length&&At.length))throw new Error("Both A and B should be matrices");if(At.length!==xt[0].length)throw new Error("Columns in A should be the same as the number of rows in B");for(var Ct=[],Et=0;Et<xt.length;Et++){Ct[Et]=[];for(var Tt=0;Tt<At[0].length;Tt++)for(var kt=0;kt<xt[0].length;kt++)Ct[Et][Tt]=Ct[Et][Tt]?Ct[Et][Tt]+xt[Et][kt]*At[kt][Tt]:xt[Et][kt]*At[kt][Tt]}return Ct}function ut(xt,At){if(xt.length!==At.length||xt[0].length!==At[0].length)throw new Error("Both A and B should have the same dimensions");for(var Ct=[],Et=0;Et<xt.length;Et++){Ct[Et]=[];for(var Tt=0;Tt<At[0].length;Tt++)Ct[Et][Tt]=xt[Et][Tt]-At[Et][Tt]}return Ct}function pt(xt,At){for(var Ct=[],Et=0;Et<xt.length;Et++){Ct[Et]=[];for(var Tt=0;Tt<xt[0].length;Tt++)Ct[Et][Tt]=xt[Et][Tt]*At}return Ct}function mt(xt){for(var At=[],Ct=0;Ct<xt;Ct++){At[Ct]=[];for(var Et=0;Et<xt;Et++)At[Ct][Et]=1}return At}function ft(xt){return vt(xt)[0].map(function(At,Ct){return xt.map(function(Et){return Et[Ct]})})}function vt(xt){var At=JSON.stringify(xt);return JSON.parse(At)}return{computeDeviationScores:d,computeDeviationMatrix:c,computeSVD:b,computePercentageExplained:function(xt,...At){var Ct=xt.map(function(Tt){return Tt.eigenvalue}).reduce(function(Tt,kt){return Tt+kt}),Et=At.map(function(Tt){return Tt.eigenvalue}).reduce(function(Tt,kt){return Tt+kt});return Et/Ct},computeOriginalData:function(xt,At,Ct){var Et=ut(ft(at(ft(At),xt)),Ct);return{originalData:Et,formattedOriginalData:nt(Et,2)}},computeVarianceCovariance:_,computeAdjustedData:_e,getEigenVectors:it,analyseTopResult:function(xt){var At=it(xt).sort(function(Ct,Et){return Et.eigenvalue-Ct.eigenvalue});return console.log("Sorted Vectors",At),_e(xt,At[0].vector)},transpose:ft,multiply:at,clone:vt,scale:pt}}();h.exports=o},186:function(h){var o=[];function c(b){for(var _e=-1,it=0;it<o.length;it++)if(o[it].identifier===b){_e=it;break}return _e}function d(b,_e){for(var it={},nt=[],at=0;at<b.length;at++){var ut=b[at],pt=_e.base?ut[0]+_e.base:ut[0],mt=it[pt]||0,ft="".concat(pt," ").concat(mt);it[pt]=mt+1;var vt=c(ft),xt={css:ut[1],media:ut[2],sourceMap:ut[3],supports:ut[4],layer:ut[5]};if(vt!==-1)o[vt].references++,o[vt].updater(xt);else{var At=_(xt,_e);_e.byIndex=at,o.splice(at,0,{identifier:ft,updater:At,references:1})}nt.push(ft)}return nt}function _(b,_e){var it=_e.domAPI(_e);return it.update(b),function(nt){if(nt){if(nt.css===b.css&&nt.media===b.media&&nt.sourceMap===b.sourceMap&&nt.supports===b.supports&&nt.layer===b.layer)return;it.update(b=nt)}else it.remove()}}h.exports=function(b,_e){var it=d(b=b||[],_e=_e||{});return function(nt){nt=nt||[];for(var at=0;at<it.length;at++){var ut=c(it[at]);o[ut].references--}for(var pt=d(nt,_e),mt=0;mt<it.length;mt++){var ft=c(it[mt]);o[ft].references===0&&(o[ft].updater(),o.splice(ft,1))}it=pt}}},990:function(h){h.exports=function(o){var c=document.createElement("style");return o.setAttributes(c,o.attributes),o.insert(c,o.options),c}},626:function(h,o,c){h.exports=function(d){var _=c.nc;_&&d.setAttribute("nonce",_)}},155:function(h){h.exports=function(o){var c=o.insertStyleElement(o);return{update:function(d){(function(_,b,_e){var it="";_e.supports&&(it+="@supports (".concat(_e.supports,") {")),_e.media&&(it+="@media ".concat(_e.media," {"));var nt=_e.layer!==void 0;nt&&(it+="@layer".concat(_e.layer.length>0?" ".concat(_e.layer):""," {")),it+=_e.css,nt&&(it+="}"),_e.media&&(it+="}"),_e.supports&&(it+="}");var at=_e.sourceMap;at&&typeof btoa<"u"&&(it+=`
/`,it+="*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(at))))," *"),it+="/"),b.styleTagTransform(it,_,b.options)})(c,o,d)},remove:function(){(function(d){if(d.parentNode===null)return!1;d.parentNode.removeChild(d)})(c)}}}},827:function(h){h.exports=function(o,c){if(c.styleSheet)c.styleSheet.cssText=o;else{for(;c.firstChild;)c.removeChild(c.firstChild);c.appendChild(document.createTextNode(o))}}},530:function(h){h.exports=function(){var o={820:function(b,_e,it){var nt=it(537),at=it.n(nt),ut=it(645),pt=it.n(ut)()(at());pt.push([b.id,`.treejs {
  -webkit-box-sizing: border-box;
          box-sizing: border-box;
  font-size: 14px;
  margin-left: -18px;
  -webkit-user-select: none;
     -moz-user-select: none;
      -ms-user-select: none;
          user-select: none;
}
.treejs *:after,
.treejs *:before {
  -webkit-box-sizing: border-box;
          box-sizing: border-box;
}
.treejs > .treejs-node {
  padding-left: 0;
}
.treejs .treejs-nodes {
  list-style: none;
  padding-left: 18px;
  margin: 0;
  overflow: hidden;
  -webkit-transition: height 150ms ease-out, opacity 150ms ease-out;
  -o-transition: height 150ms ease-out, opacity 150ms ease-out;
  transition: height 150ms ease-out, opacity 150ms ease-out;
}
.treejs .treejs-node {
  cursor: pointer;
  overflow: hidden;
}
.treejs .treejs-node.treejs-placeholder {
  padding-left: 18px;
}
.treejs .treejs-switcher {
  display: inline-block;
  vertical-align: middle;
  width: 20px;
  height: 20px;
  cursor: pointer;
  position: relative;
  -webkit-transition: -webkit-transform 150ms ease-out;
  transition: -webkit-transform 150ms ease-out;
  -o-transition: transform 150ms ease-out;
  transition: transform 150ms ease-out;
  transition: transform 150ms ease-out, -webkit-transform 150ms ease-out;
}
.treejs .treejs-switcher:before {
  position: absolute;
  top: 8px;
  left: 6px;
  display: block;
  content: ' ';
  border: 4px solid transparent;
  border-top: 4px solid rgba(245, 245, 245, 0.7);
  -webkit-transition: border-color 150ms;
  -o-transition: border-color 150ms;
  transition: border-color 150ms;
}
.treejs .treejs-switcher:hover:before {
  border-top: 4px solid rgba(245, 245, 245, 0.96);
}
.treejs .treejs-node__close > .treejs-switcher {
  -webkit-transform: rotate(-90deg);
      -ms-transform: rotate(-90deg);
          transform: rotate(-90deg);
}
.treejs .treejs-node__close > .treejs-nodes {
  height: 0;
}
.treejs .treejs-checkbox {
  display: inline-block;
  vertical-align: middle;
  width: 20px;
  height: 20px;
  cursor: pointer;
  position: relative;
}
.treejs .treejs-checkbox:before {
  -webkit-transition: all 0.3s;
  -o-transition: all 0.3s;
  transition: all 0.3s;
  cursor: pointer;
  position: absolute;
  top: 2px;
  content: ' ';
  display: block;
  width: 16px;
  height: 16px;
  border: 1px solid #d9d9d9;
  border-radius: 2px;
}
.treejs .treejs-checkbox:hover:before {
  -webkit-box-shadow: 0 0 2px 1px #1890ff;
          box-shadow: 0 0 2px 1px #1890ff;
}
.treejs .treejs-node__checked > .treejs-checkbox:before {
  background-color: #1890ff;
  border-color: #1890ff;
}
.treejs .treejs-node__checked > .treejs-checkbox:after {
  position: absolute;
  content: ' ';
  display: block;
  top: 4px;
  left: 5px;
  width: 5px;
  height: 9px;
  border: 2px solid #fff;
  border-top: none;
  border-left: none;
  -webkit-transform: rotate(45deg);
      -ms-transform: rotate(45deg);
          transform: rotate(45deg);
}
.treejs .treejs-node__halfchecked > .treejs-checkbox:before {
  background-color: #1890ff;
  border-color: #1890ff;
}
.treejs .treejs-node__halfchecked > .treejs-checkbox:after {
  position: absolute;
  content: ' ';
  display: block;
  top: 9px;
  left: 3px;
  width: 10px;
  height: 2px;
  background-color: #fff;
}
.treejs .treejs-node__disabled {
  cursor: not-allowed;
  color: rgba(255, 255, 255, 0.25);
}
.treejs .treejs-node__disabled .treejs-checkbox {
  cursor: not-allowed;
}
.treejs .treejs-node__disabled .treejs-checkbox:before {
  cursor: not-allowed;
  border-color: #d9d9d9 !important;
  background-color: #f5f5f5 !important;
}
.treejs .treejs-node__disabled .treejs-checkbox:hover:before {
  -webkit-box-shadow: none !important;
          box-shadow: none !important;
}
.treejs .treejs-node__disabled .treejs-node__checked > .treejs-checkbox:after {
  border-color: #d9d9d9;
}
.treejs .treejs-node__disabled .treejs-node__halfchecked > .treejs-checkbox:after {
  background-color: #d9d9d9;
}
.treejs .treejs-node__disabled.treejs-node__checked > .treejs-checkbox:after {
  border-color: #d9d9d9;
}
.treejs .treejs-node__disabled.treejs-node__halfchecked > .treejs-checkbox:after {
  background-color: #d9d9d9;
}
.treejs .treejs-label {
  vertical-align: middle;
}
`,"",{version:3,sources:["webpack://./src/index.less"],names:[],mappings:"AAKA;EACE,8BAAA;UAAA,sBAAA;EACA,eAAA;EACA,kBAAA;EACA,yBAAA;KAAA,sBAAA;MAAA,qBAAA;UAAA,iBAAA;AAJF;AAAA;;EAQI,8BAAA;UAAA,sBAAA;AAJJ;AAOE;EACE,eAAA;AALJ;AAPA;EAgBI,gBAAA;EACA,kBAAA;EACA,SAAA;EACA,gBAAA;EACA,iEAAA;EAAA,4DAAA;EAAA,yDAAA;AANJ;AAdA;EAwBI,eAAA;EACA,gBAAA;AAPJ;AASI;EACE,kBAAA;AAPN;AArBA;EAiCI,qBAAA;EACA,sBAAA;EACA,WAAA;EACA,YAAA;EACA,eAAA;EACA,kBAAA;EACA,oDAAA;EAAA,4CAAA;EAAA,uCAAA;EAAA,oCAAA;EAAA,sEAAA;AATJ;AAWI;EACE,kBAAA;EACA,QAAA;EACA,SAAA;EACA,cAAA;EACA,YAAA;EACA,6BAAA;EACA,8CAAA;EACA,sCAAA;EAAA,iCAAA;EAAA,8BAAA;AATN;AAWI;EACE,+CAAA;AATN;AA3CA;EAwDI,iCAAA;MAAA,6BAAA;UAAA,yBAAA;AAVJ;AA9CA;EA2DI,SAAA;AAVJ;AAjDA;EA+DI,qBAAA;EACA,sBAAA;EACA,WAAA;EACA,YAAA;EACA,eAAA;EACA,kBAAA;AAXJ;AAaI;EACE,4BAAA;EAAA,uBAAA;EAAA,oBAAA;EACA,eAAA;EACA,kBAAA;EACA,QAAA;EACA,YAAA;EACA,cAAA;EACA,WAAA;EACA,YAAA;EACA,yBAAA;EACA,kBAAA;AAXN;AAaI;EACE,uCAAA;UAAA,+BAAA;AAXN;AAgBM;EACE,yBAAA;EACA,qBAAA;AAdR;AAgBM;EACE,kBAAA;EACA,YAAA;EACA,cAAA;EACA,QAAA;EACA,SAAA;EACA,UAAA;EACA,WAAA;EACA,sBAAA;EACA,gBAAA;EACA,iBAAA;EACA,gCAAA;MAAA,4BAAA;UAAA,wBAAA;AAdR;AAoBM;EACE,yBAAA;EACA,qBAAA;AAlBR;AAoBM;EACE,kBAAA;EACA,YAAA;EACA,cAAA;EACA,QAAA;EACA,SAAA;EACA,WAAA;EACA,WAAA;EACA,sBAAA;AAlBR;AAvGA;EA+HI,mBAAA;EACA,gCAAA;AArBJ;AA3GA;EAkIM,mBAAA;AApBN;AAqBM;EACE,mBAAA;EACA,gCAAA;EACA,oCAAA;AAnBR;AAqBM;EACE,mCAAA;UAAA,2BAAA;AAnBR;AAwBQ;EACE,qBAAA;AAtBV;AA4BQ;EACE,yBAAA;AA1BV;AAiCM;EACE,qBAAA;AA/BR;AAqCM;EACE,yBAAA;AAnCR;AAlIA;EA2KI,sBAAA;AAtCJ",sourcesContent:[`@color-disable: #d4d4d4;
@bgcolor-disable: #f5f5f5;
@greyborder: #d9d9d9;
@bluebg: #1890ff;

.treejs {
  box-sizing: border-box;
  font-size: 14px;
  margin-left: -18px;
  user-select: none;

  *:after,
  *:before {
    box-sizing: border-box;
  }

  & > .treejs-node {
    padding-left: 0;
  }

  .treejs-nodes {
    list-style: none;
    padding-left: 18px;
    margin: 0; //  for default ul...
    overflow: hidden;
    transition: height 150ms ease-out, opacity 150ms ease-out;
  }

  .treejs-node {
    cursor: pointer;
    overflow: hidden;

    &.treejs-placeholder {
      padding-left: 18px;
    }
  }

  .treejs-switcher {
    display: inline-block;
    vertical-align: middle;
    width: 20px;
    height: 20px;
    cursor: pointer;
    position: relative;
    transition: transform 150ms ease-out;

    &:before {
      position: absolute;
      top: 8px;
      left: 6px;
      display: block;
      content: ' ';
      border: 4px solid transparent;
      border-top: 4px solid rgba(245, 245, 245, 0.7);
      transition: border-color 150ms;
    }
    &:hover:before {
      border-top: 4px solid rgba(245, 245, 245, 0.96);
    }
  }
  .treejs-node__close > .treejs-switcher {
    transform: rotate(-90deg);
  }
  .treejs-node__close > .treejs-nodes {
    height: 0;
  }

  .treejs-checkbox {
    display: inline-block;
    vertical-align: middle;
    width: 20px;
    height: 20px;
    cursor: pointer;
    position: relative;

    &:before {
      transition: all 0.3s;
      cursor: pointer;
      position: absolute;
      top: 2px;
      content: ' ';
      display: block;
      width: 16px;
      height: 16px;
      border: 1px solid @greyborder;
      border-radius: 2px;
    }
    &:hover:before {
      box-shadow: 0 0 2px 1px @bluebg;
    }
  }
  .treejs-node__checked {
    & > .treejs-checkbox {
      &:before {
        background-color: @bluebg;
        border-color: @bluebg;
      }
      &:after {
        position: absolute;
        content: ' ';
        display: block;
        top: 4px;
        left: 5px;
        width: 5px;
        height: 9px;
        border: 2px solid #fff;
        border-top: none;
        border-left: none;
        transform: rotate(45deg);
      }
    }
  }
  .treejs-node__halfchecked {
    & > .treejs-checkbox {
      &:before {
        background-color: @bluebg;
        border-color: @bluebg;
      }
      &:after {
        position: absolute;
        content: ' ';
        display: block;
        top: 9px;
        left: 3px;
        width: 10px;
        height: 2px;
        background-color: #fff;
      }
    }
  }

  .treejs-node__disabled {
    cursor: not-allowed;
    color: rgba(255, 255, 255, 0.25);
    .treejs-checkbox {
      cursor: not-allowed;
      &:before {
        cursor: not-allowed;
        border-color: @greyborder !important;
        background-color: @bgcolor-disable !important;
      }
      &:hover:before {
        box-shadow: none !important;
      }
    }
    .treejs-node__checked {
      & > .treejs-checkbox {
        &:after {
          border-color: @greyborder;
        }
      }
    }
    .treejs-node__halfchecked {
      & > .treejs-checkbox {
        &:after {
          background-color: @greyborder;
        }
      }
    }
  }
  .treejs-node__disabled.treejs-node__checked {
    & > .treejs-checkbox {
      &:after {
        border-color: @greyborder;
      }
    }
  }
  .treejs-node__disabled.treejs-node__halfchecked {
    & > .treejs-checkbox {
      &:after {
        background-color: @greyborder;
      }
    }
  }

  .treejs-label {
    vertical-align: middle;
  }
}
`],sourceRoot:""}]),_e.Z=pt},645:function(b){b.exports=function(_e){var it=[];return it.toString=function(){return this.map(function(nt){var at="",ut=nt[5]!==void 0;return nt[4]&&(at+="@supports (".concat(nt[4],") {")),nt[2]&&(at+="@media ".concat(nt[2]," {")),ut&&(at+="@layer".concat(nt[5].length>0?" ".concat(nt[5]):""," {")),at+=_e(nt),ut&&(at+="}"),nt[2]&&(at+="}"),nt[4]&&(at+="}"),at}).join("")},it.i=function(nt,at,ut,pt,mt){typeof nt=="string"&&(nt=[[null,nt,void 0]]);var ft={};if(ut)for(var vt=0;vt<this.length;vt++){var xt=this[vt][0];xt!=null&&(ft[xt]=!0)}for(var At=0;At<nt.length;At++){var Ct=[].concat(nt[At]);ut&&ft[Ct[0]]||(mt!==void 0&&(Ct[5]===void 0||(Ct[1]="@layer".concat(Ct[5].length>0?" ".concat(Ct[5]):""," {").concat(Ct[1],"}")),Ct[5]=mt),at&&(Ct[2]&&(Ct[1]="@media ".concat(Ct[2]," {").concat(Ct[1],"}")),Ct[2]=at),pt&&(Ct[4]?(Ct[1]="@supports (".concat(Ct[4],") {").concat(Ct[1],"}"),Ct[4]=pt):Ct[4]="".concat(pt)),it.push(Ct))}},it}},537:function(b){b.exports=function(_e){var it=_e[1],nt=_e[3];if(!nt)return it;if(typeof btoa=="function"){var at=btoa(unescape(encodeURIComponent(JSON.stringify(nt)))),ut="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(at),pt="/*# ".concat(ut," */"),mt=nt.sources.map(function(ft){return"/*# sourceURL=".concat(nt.sourceRoot||"").concat(ft," */")});return[it].concat(mt).concat([pt]).join(`
`)}return[it].join(`
`)}},379:function(b){var _e=[];function it(ut){for(var pt=-1,mt=0;mt<_e.length;mt++)if(_e[mt].identifier===ut){pt=mt;break}return pt}function nt(ut,pt){for(var mt={},ft=[],vt=0;vt<ut.length;vt++){var xt=ut[vt],At=pt.base?xt[0]+pt.base:xt[0],Ct=mt[At]||0,Et="".concat(At," ").concat(Ct);mt[At]=Ct+1;var Tt=it(Et),kt={css:xt[1],media:xt[2],sourceMap:xt[3],supports:xt[4],layer:xt[5]};if(Tt!==-1)_e[Tt].references++,_e[Tt].updater(kt);else{var Dt=at(kt,pt);pt.byIndex=vt,_e.splice(vt,0,{identifier:Et,updater:Dt,references:1})}ft.push(Et)}return ft}function at(ut,pt){var mt=pt.domAPI(pt);return mt.update(ut),function(ft){if(ft){if(ft.css===ut.css&&ft.media===ut.media&&ft.sourceMap===ut.sourceMap&&ft.supports===ut.supports&&ft.layer===ut.layer)return;mt.update(ut=ft)}else mt.remove()}}b.exports=function(ut,pt){var mt=nt(ut=ut||[],pt=pt||{});return function(ft){ft=ft||[];for(var vt=0;vt<mt.length;vt++){var xt=it(mt[vt]);_e[xt].references--}for(var At=nt(ft,pt),Ct=0;Ct<mt.length;Ct++){var Et=it(mt[Ct]);_e[Et].references===0&&(_e[Et].updater(),_e.splice(Et,1))}mt=At}}},216:function(b){b.exports=function(_e){var it=document.createElement("style");return _e.setAttributes(it,_e.attributes),_e.insert(it,_e.options),it}},636:function(b,_e,it){b.exports=function(nt){var at=it.nc;at&&nt.setAttribute("nonce",at)}},795:function(b){b.exports=function(_e){var it=_e.insertStyleElement(_e);return{update:function(nt){(function(at,ut,pt){var mt="";pt.supports&&(mt+="@supports (".concat(pt.supports,") {")),pt.media&&(mt+="@media ".concat(pt.media," {"));var ft=pt.layer!==void 0;ft&&(mt+="@layer".concat(pt.layer.length>0?" ".concat(pt.layer):""," {")),mt+=pt.css,ft&&(mt+="}"),pt.media&&(mt+="}"),pt.supports&&(mt+="}");var vt=pt.sourceMap;vt&&typeof btoa<"u"&&(mt+=`
/`,mt+="*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(vt))))," *"),mt+="/"),ut.styleTagTransform(mt,at,ut.options)})(it,_e,nt)},remove:function(){(function(nt){if(nt.parentNode===null)return!1;nt.parentNode.removeChild(nt)})(it)}}}},589:function(b){b.exports=function(_e,it){if(it.styleSheet)it.styleSheet.cssText=_e;else{for(;it.firstChild;)it.removeChild(it.firstChild);it.appendChild(document.createTextNode(_e))}}}},c={};function d(b){var _e=c[b];if(_e!==void 0)return _e.exports;var it=c[b]={id:b,exports:{}};return o[b](it,it.exports,d),it.exports}d.n=function(b){var _e=b&&b.__esModule?function(){return b.default}:function(){return b};return d.d(_e,{a:_e}),_e},d.d=function(b,_e){for(var it in _e)d.o(_e,it)&&!d.o(b,it)&&Object.defineProperty(b,it,{enumerable:!0,get:_e[it]})},d.o=function(b,_e){return Object.prototype.hasOwnProperty.call(b,_e)},d.nc=void 0;var _={};return function(){d.d(_,{default:function(){return cr}});var b=d(379),_e=d.n(b),it=d(795),nt=d.n(it),at=d(636),ut=d.n(at),pt=d(216),mt=d.n(pt),ft=d(589),vt=d.n(ft),xt=d(820),At={};xt.Z&&xt.Z.locals&&(At.locals=xt.Z.locals);var Ct,Et=0,Tt={};Tt.styleTagTransform=vt(),Tt.setAttributes=ut(),Tt.insert=function(lr,hr){(hr.target||document.head).appendChild(lr)},Tt.domAPI=nt(),Tt.insertStyleElement=mt(),At.use=function(lr){return Tt.options=lr||{},Et++||(Ct=_e()(xt.Z,Tt)),At},At.unuse=function(){Et>0&&!--Et&&(Ct(),Ct=null)};var kt=At;function Dt(lr,hr){return function(dr){if(Array.isArray(dr))return dr}(lr)||function(dr,pr){var ur=dr==null?null:typeof Symbol<"u"&&dr[Symbol.iterator]||dr["@@iterator"];if(ur!=null){var xr,vr,Dr=[],_r=!0,rr=!1;try{for(ur=ur.call(dr);!(_r=(xr=ur.next()).done)&&(Dr.push(xr.value),!pr||Dr.length!==pr);_r=!0);}catch(mr){rr=!0,vr=mr}finally{try{_r||ur.return==null||ur.return()}finally{if(rr)throw vr}}return Dr}}(lr,hr)||function(dr,pr){if(dr){if(typeof dr=="string")return zt(dr,pr);var ur=Object.prototype.toString.call(dr).slice(8,-1);return ur==="Object"&&dr.constructor&&(ur=dr.constructor.name),ur==="Map"||ur==="Set"?Array.from(dr):ur==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(ur)?zt(dr,pr):void 0}}(lr,hr)||function(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function zt(lr,hr){(hr==null||hr>lr.length)&&(hr=lr.length);for(var dr=0,pr=new Array(hr);dr<hr;dr++)pr[dr]=lr[dr];return pr}function Bt(lr,hr){var dr=Object.keys(lr);if(Object.getOwnPropertySymbols){var pr=Object.getOwnPropertySymbols(lr);hr&&(pr=pr.filter(function(ur){return Object.getOwnPropertyDescriptor(lr,ur).enumerable})),dr.push.apply(dr,pr)}return dr}function Rt(lr){for(var hr=1;hr<arguments.length;hr++){var dr=arguments[hr]!=null?arguments[hr]:{};hr%2?Bt(Object(dr),!0).forEach(function(pr){Ut(lr,pr,dr[pr])}):Object.getOwnPropertyDescriptors?Object.defineProperties(lr,Object.getOwnPropertyDescriptors(dr)):Bt(Object(dr)).forEach(function(pr){Object.defineProperty(lr,pr,Object.getOwnPropertyDescriptor(dr,pr))})}return lr}function Ut(lr,hr,dr){return hr in lr?Object.defineProperty(lr,hr,{value:dr,enumerable:!0,configurable:!0,writable:!0}):lr[hr]=dr,lr}function Ht(lr,hr){for(var dr=0;dr<hr.length;dr++){var pr=hr[dr];pr.enumerable=pr.enumerable||!1,pr.configurable=!0,"value"in pr&&(pr.writable=!0),Object.defineProperty(lr,pr.key,pr)}}function Jt(lr){var hr={};return lr.reduce(function(dr,pr){return hr[pr]||(hr[pr]=!0,dr.push(pr)),dr},[])}function Kt(lr,hr){requestAnimationFrame(function(){hr.enter(),requestAnimationFrame(function(){hr.active(),setTimeout(function(){hr.leave()},lr)})})}function sr(lr,hr){try{var dr=lr.liElementsById[hr.parent.id];dr.classList.contains("treejs-node__close")||dr.getElementsByClassName("treejs-switcher")[0].click()}catch{return}Object.prototype.hasOwnProperty.call(hr,"parent")&&sr(lr,hr.parent)}function ir(lr,hr){var dr=lr.liElementsById[hr.id];dr.classList.contains("treejs-node__close")&&dr.getElementsByClassName("treejs-switcher")[0].click(),Object.prototype.hasOwnProperty.call(hr,"children")&&hr.children.forEach(function(pr){return ir(lr,pr)})}var cr=function(){function lr(ur,xr){(function(vr,Dr){if(!(vr instanceof Dr))throw new TypeError("Cannot call a class as a function")})(this,lr),kt.use({target:typeof this.container=="string"?document.querySelector(this.container):this.container}),this.treeNodes=[],this.nodesById={},this.leafNodesById={},this.liElementsById={},this.willUpdateNodesById={},this.container=ur,this.options=Object.assign({values:[],disables:[],loaded:null,closeDepth:null},xr),Object.defineProperties(this,{values:{get:function(){return this.getValues()},set:function(vr){this.setValues(Jt(vr))}},disables:{get:function(){return this.getDisables()},set:function(vr){this.setDisables(Jt(vr))}},selectedNodes:{get:function(){var vr=[],Dr=this.nodesById;return Object.keys(Dr).forEach(function(_r){if(Object.prototype.hasOwnProperty.call(Dr,_r)&&(Dr[_r].status===1||Dr[_r].status===2)){var rr=Rt({},Dr[_r]);delete rr.parent,delete rr.children,vr.push(rr)}}),vr}},disabledNodes:{get:function(){var vr=[],Dr=this.nodesById;return Object.keys(Dr).forEach(function(_r){if(Object.prototype.hasOwnProperty.call(Dr,_r)&&Dr[_r].disabled){var rr=Rt({},Dr[_r]);delete rr.parent,vr.push(rr)}}),vr}}}),this.init(this.options.data)}var hr,dr,pr;return hr=lr,pr=[{key:"onSwitcherClick",value:function(ur){var xr=ur.parentNode,vr=xr.lastChild,Dr=vr.scrollHeight;xr.classList.contains("treejs-node__close")?Kt(150,{enter:function(){vr.style.height=0,vr.style.opacity=0},active:function(){vr.style.height="".concat(Dr,"px"),vr.style.opacity=1},leave:function(){vr.style.height="",vr.style.opacity="",xr.classList.remove("treejs-node__close")}}):Kt(150,{enter:function(){vr.style.height="".concat(Dr,"px"),vr.style.opacity=1},active:function(){vr.style.height=0,vr.style.opacity=0},leave:function(){vr.style.height="",vr.style.opacity="",xr.classList.add("treejs-node__close")}})}},{key:"parseTreeData",value:function(ur){var xr,vr=(xr=ur,JSON.parse(JSON.stringify(xr))),Dr={},_r={},rr=[],mr=[];return function Rr(Yr,Zr){Yr.forEach(function(cn){Dr[cn.id]=cn,cn.checked&&rr.push(cn.id),cn.disabled&&mr.push(cn.id),Zr&&(cn.parent=Zr),cn.children&&cn.children.length?Rr(cn.children,cn):_r[cn.id]=cn})}(vr),{treeNodes:vr,nodesById:Dr,leafNodesById:_r,defaultValues:rr,defaultDisables:mr}}},{key:"createRootEle",value:function(){var ur=document.createElement("div");return ur.classList.add("treejs"),ur}},{key:"createUlEle",value:function(){var ur=document.createElement("ul");return ur.classList.add("treejs-nodes"),ur}},{key:"createLiEle",value:function(ur,xr){var vr=document.createElement("li");if(vr.classList.add("treejs-node"),xr&&vr.classList.add("treejs-node__close"),ur.children&&ur.children.length){var Dr=document.createElement("span");Dr.classList.add("treejs-switcher"),vr.appendChild(Dr)}else vr.classList.add("treejs-placeholder");var _r=document.createElement("span");_r.classList.add("treejs-checkbox"),vr.appendChild(_r);var rr=document.createElement("span");rr.classList.add("treejs-label");var mr=document.createTextNode(ur.text);return rr.appendChild(mr),vr.appendChild(rr),vr.nodeId=ur.id,vr}}],(dr=[{key:"init",value:function(ur){var xr=lr.parseTreeData(ur),vr=xr.treeNodes,Dr=xr.nodesById,_r=xr.leafNodesById,rr=xr.defaultValues,mr=xr.defaultDisables;this.treeNodes=vr,this.nodesById=Dr,this.leafNodesById=_r,this.render(this.treeNodes);var Rr=this.options,Yr=Rr.values,Zr=Rr.disables,cn=Rr.loaded;Yr&&Yr.length?this.setValues(Yr):rr&&rr.length&&this.setValues(rr),Zr&&Zr.length?this.setDisables(Zr):mr&&mr.length&&this.setDisables(mr),typeof cn=="function"&&cn.call(this)}},{key:"render",value:function(ur){var xr=lr.createRootEle();xr.appendChild(this.buildTree(ur,0)),this.bindEvent(xr);var vr=typeof this.container=="string"?document.querySelector(this.container):this.container;(function(Dr){for(;Dr.firstChild;)Dr.removeChild(Dr.firstChild)})(vr),vr.appendChild(xr)}},{key:"buildTree",value:function(ur,xr){var vr=this,Dr=lr.createUlEle();return ur&&ur.length&&ur.forEach(function(_r){var rr=lr.createLiEle(_r,xr===vr.options.closeDepth-1);vr.liElementsById[_r.id]=rr;var mr=null;_r.children&&_r.children.length&&(mr=vr.buildTree(_r.children,xr+1)),mr&&rr.appendChild(mr),Dr.appendChild(rr)}),Dr}},{key:"bindEvent",value:function(ur){var xr=this;ur.addEventListener("click",function(vr){var Dr=vr.target;Dr.nodeName==="SPAN"&&Dr.classList.contains("treejs-checkbox")?xr.onItemClick(Dr.parentNode.nodeId):Dr.nodeName==="SPAN"&&Dr.classList.contains("treejs-label")?xr.onItemLabelClick(Dr.parentNode.nodeId):Dr.nodeName==="LI"&&Dr.classList.contains("treejs-node")?xr.onItemClick(Dr.nodeId):Dr.nodeName==="SPAN"&&Dr.classList.contains("treejs-switcher")&&lr.onSwitcherClick(Dr)},!1)}},{key:"onItemClick",value:function(ur){var xr=this.nodesById[ur],vr=this.options.onChange;xr.disabled||(this.setValue(ur),this.updateLiElements()),vr&&vr.call(this)}},{key:"onItemLabelClick",value:function(ur){var xr=this.options.onItemLabelClick;xr&&xr.call(this,ur)}},{key:"setValue",value:function(ur){var xr=this.nodesById[ur];if(xr){var vr=xr.status,Dr=vr===1||vr===2?0:2;xr.status=Dr,this.markWillUpdateNode(xr),this.walkUp(xr,"status"),this.walkDown(xr,"status")}}},{key:"getValues",value:function(){var ur=this,xr=[];return Object.keys(this.leafNodesById).forEach(function(vr){Object.prototype.hasOwnProperty.call(ur.leafNodesById,vr)&&(ur.leafNodesById[vr].status!==1&&ur.leafNodesById[vr].status!==2||xr.push(vr))}),xr}},{key:"setValues",value:function(ur){var xr=this;this.emptyNodesCheckStatus(),ur.forEach(function(Dr){xr.setValue(Dr)}),this.updateLiElements();var vr=this.options.onChange;vr&&vr.call(this)}},{key:"setDisable",value:function(ur){var xr=this.nodesById[ur];xr&&(xr.disabled||(xr.disabled=!0,this.markWillUpdateNode(xr),this.walkUp(xr,"disabled"),this.walkDown(xr,"disabled")))}},{key:"getDisables",value:function(){var ur=this,xr=[];return Object.keys(this.leafNodesById).forEach(function(vr){Object.prototype.hasOwnProperty.call(ur.leafNodesById,vr)&&ur.leafNodesById[vr].disabled&&xr.push(vr)}),xr}},{key:"setDisables",value:function(ur){var xr=this;this.emptyNodesDisable(),ur.forEach(function(vr){xr.setDisable(vr)}),this.updateLiElements()}},{key:"emptyNodesCheckStatus",value:function(){this.willUpdateNodesById=this.getSelectedNodesById(),Object.values(this.willUpdateNodesById).forEach(function(ur){ur.disabled||(ur.status=0)})}},{key:"emptyNodesDisable",value:function(){this.willUpdateNodesById=this.getDisabledNodesById(),Object.values(this.willUpdateNodesById).forEach(function(ur){ur.disabled=!1})}},{key:"getSelectedNodesById",value:function(){return Object.entries(this.nodesById).reduce(function(ur,xr){var vr=Dt(xr,2),Dr=vr[0],_r=vr[1];return _r.status!==1&&_r.status!==2||(ur[Dr]=_r),ur},{})}},{key:"getDisabledNodesById",value:function(){return Object.entries(this.nodesById).reduce(function(ur,xr){var vr=Dt(xr,2),Dr=vr[0],_r=vr[1];return _r.disabled&&(ur[Dr]=_r),ur},{})}},{key:"updateLiElements",value:function(){var ur=this;Object.values(this.willUpdateNodesById).forEach(function(xr){ur.updateLiElement(xr)}),this.willUpdateNodesById={}}},{key:"markWillUpdateNode",value:function(ur){this.willUpdateNodesById[ur.id]=ur}},{key:"walkUp",value:function(ur,xr){var vr=ur.parent;if(vr){if(xr==="status"){var Dr,_r=vr.children.reduce(function(mr,Rr){return Number.isNaN(Rr.status)?mr:mr+Rr.status},0);if(Dr=_r?_r===2*vr.children.length?2:1:0,vr.status===Dr)return;vr.status=Dr}else{var rr=vr.children.reduce(function(mr,Rr){return mr&&Rr.disabled},!0);if(vr.disabled===rr)return;vr.disabled=rr}this.markWillUpdateNode(vr),this.walkUp(vr,xr)}}},{key:"walkDown",value:function(ur,xr){var vr=this;ur.children&&ur.children.length&&ur.children.forEach(function(Dr){xr==="status"&&Dr.disabled||(Dr[xr]=ur[xr],vr.markWillUpdateNode(Dr),vr.walkDown(Dr,xr))})}},{key:"updateLiElement",value:function(ur){var xr=this.liElementsById[ur.id].classList;switch(ur.status){case 0:xr.remove("treejs-node__halfchecked","treejs-node__checked");break;case 1:xr.remove("treejs-node__checked"),xr.add("treejs-node__halfchecked");break;case 2:xr.remove("treejs-node__halfchecked"),xr.add("treejs-node__checked")}switch(ur.disabled){case!0:xr.contains("treejs-node__disabled")||xr.add("treejs-node__disabled");break;case!1:xr.contains("treejs-node__disabled")&&xr.remove("treejs-node__disabled")}}},{key:"collapseAll",value:function(){var ur=this;Object.keys(this.leafNodesById).forEach(function(xr){var vr=ur.leafNodesById[xr];sr(ur,vr)})}},{key:"expandAll",value:function(){ir(this,this.treeNodes[0])}}])&&Ht(hr.prototype,dr),pr&&Ht(hr,pr),Object.defineProperty(hr,"prototype",{writable:!1}),lr}()}(),_.default}()},282:function(h,o){(function(c){const d="tp";function _(Bt){return Rt=>Ut=>{if(!Rt&&Ut===void 0)return{succeeded:!1,value:void 0};if(Rt&&Ut===void 0)return{succeeded:!0,value:void 0};const Ht=Bt(Ut);return Ht!==void 0?{succeeded:!0,value:Ht}:{succeeded:!1,value:void 0}}}function b(Bt){return{custom:Rt=>_(Rt)(Bt),boolean:_(Rt=>typeof Rt=="boolean"?Rt:void 0)(Bt),number:_(Rt=>typeof Rt=="number"?Rt:void 0)(Bt),string:_(Rt=>typeof Rt=="string"?Rt:void 0)(Bt),function:_(Rt=>typeof Rt=="function"?Rt:void 0)(Bt),constant:Rt=>_(Ut=>Ut===Rt?Rt:void 0)(Bt),raw:_(Rt=>Rt)(Bt),object:Rt=>_(Ut=>{if((Ht=Ut)!==null&&typeof Ht=="object")return function(Jt,Kt){return Object.keys(Kt).reduce((sr,ir)=>{if(sr===void 0)return;const cr=(0,Kt[ir])(Jt[ir]);return cr.succeeded?Object.assign(Object.assign({},sr),{[ir]:cr.value}):void 0},{})}(Ut,Rt);var Ht})(Bt),array:Rt=>_(Ut=>{if(Array.isArray(Ut))return Ht=Rt,Ut.reduce((Jt,Kt)=>{if(Jt===void 0)return;const sr=Ht(Kt);return sr.succeeded&&sr.value!==void 0?[...Jt,sr.value]:void 0},[]);var Ht})(Bt)}}const _e={optional:b(!0),required:b(!1)};function it(Bt){return Rt=>Rt.toFixed(Math.max(Math.min(Bt,20),0))}function nt(Bt){return[Bt[0],Bt[1],Bt[2]]}function at(Bt){return Rt=>function(Ut,Ht){const Jt=it(Ht==="float"?2:0);return`rgb(${nt(Ut.getComponents("rgb",Ht)).map(Kt=>Jt(Kt)).join(", ")})`}(Rt,Bt)}function ut(Bt){return Rt=>function(Ut,Ht){const Jt=it(2),Kt=it(Ht==="float"?2:0);return`rgba(${Ut.getComponents("rgb",Ht).map((sr,ir)=>(ir===3?Jt:Kt)(sr)).join(", ")})`}(Rt,Bt)}function pt(Bt){return Rt=>function(Ut,Ht){const Jt=it(Ht==="float"?2:0),Kt=["r","g","b"];return`{${nt(Ut.getComponents("rgb",Ht)).map((sr,ir)=>`${Kt[ir]}: ${Jt(sr)}`).join(", ")}}`}(Rt,Bt)}function mt(Bt){return Rt=>function(Ut,Ht){const Jt=it(2),Kt=it(Ht==="float"?2:0),sr=["r","g","b","a"];return`{${Ut.getComponents("rgb",Ht).map((ir,cr)=>`${sr[cr]}: ${(cr===3?Jt:Kt)(ir)}`).join(", ")}}`}(Rt,Bt)}function ft(Bt,Rt,Ut,Ht){return new(Ut||(Ut=Promise))(function(Jt,Kt){function sr(lr){try{cr(Ht.next(lr))}catch(hr){Kt(hr)}}function ir(lr){try{cr(Ht.throw(lr))}catch(hr){Kt(hr)}}function cr(lr){var hr;lr.done?Jt(lr.value):(hr=lr.value,hr instanceof Ut?hr:new Ut(function(dr){dr(hr)})).then(sr,ir)}cr((Ht=Ht.apply(Bt,[])).next())})}function vt(Bt){return ft(this,void 0,void 0,function*(){const Rt=new Image;return Rt.crossOrigin="anonymous",new Promise((Ut,Ht)=>{Rt.src=Bt,Rt.onload=()=>{Ut(Rt)},Rt.onerror=Ht})})}["int","float"].reduce((Bt,Rt)=>[...Bt,{format:{alpha:!1,mode:"rgb",notation:"func",type:Rt},stringifier:at(Rt)},{format:{alpha:!0,mode:"rgb",notation:"func",type:Rt},stringifier:ut(Rt)},{format:{alpha:!1,mode:"rgb",notation:"object",type:Rt},stringifier:pt(Rt)},{format:{alpha:!0,mode:"rgb",notation:"object",type:Rt},stringifier:mt(Rt)}],[]);const xt=(At="img",(Bt,Rt)=>[d,"-",At,"v",Bt?`_${Bt}`:"",Rt?`-${Rt}`:""].join(""));var At;class Ct{constructor(Rt,Ut){this.element=Rt.createElement("div"),this.element.classList.add(xt()),Ut.viewProps.bindClassModifiers(this.element),this.input=Rt.createElement("input"),this.input.classList.add(xt("input")),this.input.setAttribute("type","file"),this.input.setAttribute("accept",Ut.extensions.join(",")),this.image_=Rt.createElement("img"),this.image_.classList.add(xt("image")),this.image_.classList.add(xt(`image_${Ut.imageFit}`)),this.image_.crossOrigin="anonymous",this.image_.onclick=Ht=>{Ut.clickCallback?Ut.clickCallback(Ht,this.input):this.input.click()},this.element.classList.add(xt("area_root")),this.element.appendChild(this.image_),this.element.appendChild(this.input)}changeImage(Rt){this.image_.src=Rt}changeDraggingState(Rt){const Ut=this.element;Rt?Ut==null||Ut.classList.add(xt("area_dragging")):Ut==null||Ut.classList.remove(xt("area_dragging"))}}let Et=null;class Tt{constructor(Rt,Ut){this.value=Ut.value,this.viewProps=Ut.viewProps,this.view=new Ct(Rt,{viewProps:this.viewProps,extensions:Ut.extensions,imageFit:Ut.imageFit,clickCallback:Ut.clickCallback}),this.onFile=this.onFile.bind(this),this.onDrop=this.onDrop.bind(this),this.onDragOver=this.onDragOver.bind(this),this.onDragLeave=this.onDragLeave.bind(this),this.view.input.addEventListener("change",this.onFile),this.view.element.addEventListener("drop",this.onDrop),this.view.element.addEventListener("dragover",this.onDragOver),this.view.element.addEventListener("dragleave",this.onDragLeave),this.viewProps.handleDispose(()=>{this.view.input.removeEventListener("change",this.onFile),this.view.input.removeEventListener("drop",this.onDrop),this.view.input.removeEventListener("dragover",this.onDragOver),this.view.input.removeEventListener("dragleave",this.onDragLeave)}),this.value.emitter.on("change",this.handleValueChange.bind(this)),this.handleValueChange()}onFile(Rt){const Ut=(Rt==null?void 0:Rt.target).files;if(!Ut||!Ut.length)return;const Ht=Ut[0];this.setValue(Ht)}onDrop(Rt){return ft(this,void 0,void 0,function*(){Rt.preventDefault();try{const{dataTransfer:Ut}=Rt,Ht=Ut==null?void 0:Ut.files[0];if(Ht)this.setValue(Ht);else{const Jt=Ut==null?void 0:Ut.getData("url");if(!Jt)throw new Error("No url");this.setValue(Jt)}}catch(Ut){console.error("Could not parse the dropped image",Ut)}finally{this.view.changeDraggingState(!1)}})}onDragOver(Rt){Rt.preventDefault(),this.view.changeDraggingState(!0)}onDragLeave(){this.view.changeDraggingState(!1)}handleImage(Rt){return ft(this,void 0,void 0,function*(){Rt instanceof HTMLImageElement?this.updateImage(Rt.src):typeof Rt!="string"&&Rt?yield this.setValue(Rt):(Rt!=="placeholder"&&Rt||(Rt=(yield this.handlePlaceholderImage()).src),this.updateImage(Rt))})}updateImage(Rt){this.view.changeImage(Rt)}setValue(Rt){return ft(this,void 0,void 0,function*(){if(Rt instanceof HTMLImageElement)this.value.setRawValue(Rt);else if(Rt instanceof File){const Ut=URL.createObjectURL(Rt)+"#"+Rt.name;Rt.src=Ut;const Ht=yield vt(Ut).catch(()=>{});this.value.setRawValue(Ht||Rt)}else Rt?this.value.setRawValue(yield vt(Rt)):this.value.setRawValue(yield this.handlePlaceholderImage())})}handleValueChange(){this.handleImage(this.value.rawValue)}handlePlaceholderImage(){return ft(this,void 0,void 0,function*(){return Et||(Et=yield function(){const Rt=document.createElement("canvas");Rt.width=320,Rt.height=50;const Ut=Rt.getContext("2d");return Ut.fillStyle="#00000004",Ut.fillRect(0,0,Rt.width,Rt.height),Ut.fillStyle="#eee",Ut.font='1.25rem "Roboto Mono", "Source Code Pro", Menlo, Courier, monospace',Ut.textAlign="center",Ut.textBaseline="middle",Ut.fillText("No image",.5*Rt.width,.5*Rt.height),new Promise(Ht=>{Rt.toBlob(Jt=>{const Kt=new Image;Kt.src=URL.createObjectURL(Jt),Kt.isPlaceholder=!0,Kt.onload=()=>{Ht(Kt)}})})}()),Et})}}const kt=[".jpg",".png",".gif"],Dt={id:"input-image",type:"input",css:".tp-imgv{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:rgba(0,0,0,0);border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-imgv{background-color:var(--in-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--bld-us);line-height:var(--bld-us);min-width:0;width:100%}.tp-imgv:hover{background-color:var(--in-bg-h)}.tp-imgv:focus{background-color:var(--in-bg-f)}.tp-imgv:active{background-color:var(--in-bg-a)}.tp-imgv:disabled{opacity:.5}:root{--tp-plugin-image-dragging-color: hsla(230, 100%, 66%, 1.00)}.tp-imgv{cursor:pointer;display:inline-flex;height:auto !important;max-height:calc(var(--bld-us)*3);border-radius:4px;position:relative}.tp-imgv.tp-v-disabled{opacity:.5}.tp-imgv_input{width:0;height:0;pointer-events:none;visibility:hidden}.tp-imgv_image{width:100%;height:-moz-max-content;height:max-content;max-height:calc(var(--bld-us)*3);border:0}.tp-imgv_image_contain{-o-object-fit:contain;object-fit:contain}.tp-imgv_image_cover{-o-object-fit:cover;object-fit:cover}.tp-imgv_area_root{transition:opacity .16s ease-in-out}.tp-imgv_area_dragging{border:2px dashed var(--tp-plugin-image-dragging-color);border-radius:4px;opacity:.6}",accept(Bt,Rt){if(!(Bt instanceof HTMLImageElement||typeof Bt=="string"))return null;const Ut=_e,Ht=function(Jt,Kt){const sr=_e.required.object(Kt)(Jt);return sr.succeeded?sr.value:void 0}(Rt,{view:Ut.required.constant("input-image"),acceptUrl:Ut.optional.boolean,clickCallback:Ut.optional.function,imageFit:Ut.optional.custom(Jt=>Jt==="contain"||Jt==="cover"?Jt:void 0),extensions:Ut.optional.array(Ut.required.string)});return Ht?{initialValue:Bt,params:Ht}:null},binding:{reader(Bt){return Rt=>Rt.src!==void 0?Rt.src===""?"placeholder":Rt.src:Rt},writer(Bt){return(Rt,Ut)=>{Rt.write(Ut)}}},controller(Bt){var Rt,Ut;return new Tt(Bt.document,{value:Bt.value,imageFit:(Rt=Bt.params.imageFit)!==null&&Rt!==void 0?Rt:"cover",clickCallback:Bt.params.clickCallback,viewProps:Bt.viewProps,extensions:(Ut=Bt.params.extensions)!==null&&Ut!==void 0?Ut:kt})}},zt=Dt;c.plugin=zt,Object.defineProperty(c,"__esModule",{value:!0})})(o)},578:function(h,o){(function(c){class d{constructor(wt){this.controller_=wt}get element(){return this.controller_.view.element}get disabled(){return this.controller_.viewProps.get("disabled")}set disabled(wt){this.controller_.viewProps.set("disabled",wt)}get hidden(){return this.controller_.viewProps.get("hidden")}set hidden(wt){this.controller_.viewProps.set("hidden",wt)}dispose(){this.controller_.viewProps.set("disposed",!0)}}class _{constructor(wt){this.target=wt}}class b extends _{constructor(wt,It,Vt,nr){super(wt),this.value=It,this.presetKey=Vt,this.last=nr==null||nr}}class _e extends _{constructor(wt,It,Vt){super(wt),this.value=It,this.presetKey=Vt}}class it extends _{constructor(wt,It){super(wt),this.expanded=It}}class nt extends _{constructor(wt,It){super(wt),this.index=It}}function at(Gt){return Gt==null}function ut(Gt,wt){if(Gt.length!==wt.length)return!1;for(let It=0;It<Gt.length;It++)if(Gt[It]!==wt[It])return!1;return!0}function pt(Gt,wt){let It=Gt;do{const Vt=Object.getOwnPropertyDescriptor(It,wt);if(Vt&&(Vt.set!==void 0||Vt.writable===!0))return!0;It=Object.getPrototypeOf(It)}while(It!==null);return!1}const mt={alreadydisposed:()=>"View has been already disposed",invalidparams:Gt=>`Invalid parameters for '${Gt.name}'`,nomatchingcontroller:Gt=>`No matching controller for '${Gt.key}'`,nomatchingview:Gt=>`No matching view for '${JSON.stringify(Gt.params)}'`,notbindable:()=>"Value is not bindable",propertynotfound:Gt=>`Property '${Gt.name}' not found`,shouldneverhappen:()=>"This error should never happen"};class ft{static alreadyDisposed(){return new ft({type:"alreadydisposed"})}static notBindable(){return new ft({type:"notbindable"})}static propertyNotFound(wt){return new ft({type:"propertynotfound",context:{name:wt}})}static shouldNeverHappen(){return new ft({type:"shouldneverhappen"})}constructor(wt){var It;this.message=(It=mt[wt.type](wt.context))!==null&&It!==void 0?It:"Unexpected error",this.name=this.constructor.name,this.stack=new Error(this.message).stack,this.type=wt.type}}class vt{constructor(wt,It,Vt){this.obj_=wt,this.key_=It,this.presetKey_=Vt??It}static isBindable(wt){return wt!==null&&(typeof wt=="object"||typeof wt=="function")}get key(){return this.key_}get presetKey(){return this.presetKey_}read(){return this.obj_[this.key_]}write(wt){this.obj_[this.key_]=wt}writeProperty(wt,It){const Vt=this.read();if(!vt.isBindable(Vt))throw ft.notBindable();if(!(wt in Vt))throw ft.propertyNotFound(wt);Vt[wt]=It}}class xt extends d{get label(){return this.controller_.props.get("label")}set label(wt){this.controller_.props.set("label",wt)}get title(){var wt;return(wt=this.controller_.valueController.props.get("title"))!==null&&wt!==void 0?wt:""}set title(wt){this.controller_.valueController.props.set("title",wt)}on(wt,It){const Vt=It.bind(this);return this.controller_.valueController.emitter.on(wt,()=>{Vt(new _(this))}),this}}class At{constructor(){this.observers_={}}on(wt,It){let Vt=this.observers_[wt];return Vt||(Vt=this.observers_[wt]=[]),Vt.push({handler:It}),this}off(wt,It){const Vt=this.observers_[wt];return Vt&&(this.observers_[wt]=Vt.filter(nr=>nr.handler!==It)),this}emit(wt,It){const Vt=this.observers_[wt];Vt&&Vt.forEach(nr=>{nr.handler(It)})}}const Ct="tp";function Et(Gt){return(wt,It)=>[Ct,"-",Gt,"v",wt?`_${wt}`:"",It?`-${It}`:""].join("")}function Tt(Gt){return Gt.rawValue}function kt(Gt,wt){var It,Vt;Gt.emitter.on("change",(It=Tt,Vt=wt,nr=>Vt(It(nr)))),wt(Gt.rawValue)}function Dt(Gt,wt,It){kt(Gt.value(wt),It)}function zt(Gt,wt){return It=>{(function(Vt,nr,gr){gr?Vt.classList.add(nr):Vt.classList.remove(nr)})(Gt,wt,It)}}function Bt(Gt,wt){kt(Gt,It=>{wt.textContent=It??""})}const Rt=Et("btn");class Ut{constructor(wt,It){this.element=wt.createElement("div"),this.element.classList.add(Rt()),It.viewProps.bindClassModifiers(this.element);const Vt=wt.createElement("button");Vt.classList.add(Rt("b")),It.viewProps.bindDisabled(Vt),this.element.appendChild(Vt),this.buttonElement=Vt;const nr=wt.createElement("div");nr.classList.add(Rt("t")),Bt(It.props.value("title"),nr),this.buttonElement.appendChild(nr)}}class Ht{constructor(wt,It){this.emitter=new At,this.onClick_=this.onClick_.bind(this),this.props=It.props,this.viewProps=It.viewProps,this.view=new Ut(wt,{props:this.props,viewProps:this.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}}class Jt{constructor(wt,It){var Vt;this.constraint_=It==null?void 0:It.constraint,this.equals_=(Vt=It==null?void 0:It.equals)!==null&&Vt!==void 0?Vt:(nr,gr)=>nr===gr,this.emitter=new At,this.rawValue_=wt}get constraint(){return this.constraint_}get rawValue(){return this.rawValue_}set rawValue(wt){this.setRawValue(wt,{forceEmit:!1,last:!0})}setRawValue(wt,It){const Vt=It??{forceEmit:!1,last:!0},nr=this.constraint_?this.constraint_.constrain(wt):wt,gr=this.rawValue_;(!this.equals_(gr,nr)||Vt.forceEmit)&&(this.emitter.emit("beforechange",{sender:this}),this.rawValue_=nr,this.emitter.emit("change",{options:Vt,previousRawValue:gr,rawValue:nr,sender:this}))}}class Kt{constructor(wt){this.emitter=new At,this.value_=wt}get rawValue(){return this.value_}set rawValue(wt){this.setRawValue(wt,{forceEmit:!1,last:!0})}setRawValue(wt,It){const Vt=It??{forceEmit:!1,last:!0},nr=this.value_;(nr!==wt||Vt.forceEmit)&&(this.emitter.emit("beforechange",{sender:this}),this.value_=wt,this.emitter.emit("change",{options:Vt,previousRawValue:nr,rawValue:this.value_,sender:this}))}}function sr(Gt,wt){const It=wt==null?void 0:wt.constraint,Vt=wt==null?void 0:wt.equals;return It||Vt?new Jt(Gt,wt):new Kt(Gt)}class ir{constructor(wt){this.emitter=new At,this.valMap_=wt;for(const It in this.valMap_)this.valMap_[It].emitter.on("change",()=>{this.emitter.emit("change",{key:It,sender:this})})}static createCore(wt){return Object.keys(wt).reduce((It,Vt)=>Object.assign(It,{[Vt]:sr(wt[Vt])}),{})}static fromObject(wt){const It=this.createCore(wt);return new ir(It)}get(wt){return this.valMap_[wt].rawValue}set(wt,It){this.valMap_[wt].rawValue=It}value(wt){return this.valMap_[wt]}}function cr(Gt){return wt=>It=>{if(!wt&&It===void 0)return{succeeded:!1,value:void 0};if(wt&&It===void 0)return{succeeded:!0,value:void 0};const Vt=Gt(It);return Vt!==void 0?{succeeded:!0,value:Vt}:{succeeded:!1,value:void 0}}}function lr(Gt){return{custom:wt=>cr(wt)(Gt),boolean:cr(wt=>typeof wt=="boolean"?wt:void 0)(Gt),number:cr(wt=>typeof wt=="number"?wt:void 0)(Gt),string:cr(wt=>typeof wt=="string"?wt:void 0)(Gt),function:cr(wt=>typeof wt=="function"?wt:void 0)(Gt),constant:wt=>cr(It=>It===wt?wt:void 0)(Gt),raw:cr(wt=>wt)(Gt),object:wt=>cr(It=>{if((Vt=It)!==null&&typeof Vt=="object")return function(nr,gr){return Object.keys(gr).reduce((Cr,qr)=>{if(Cr===void 0)return;const fn=(0,gr[qr])(nr[qr]);return fn.succeeded?Object.assign(Object.assign({},Cr),{[qr]:fn.value}):void 0},{})}(It,wt);var Vt})(Gt),array:wt=>cr(It=>{if(Array.isArray(It))return Vt=wt,It.reduce((nr,gr)=>{if(nr===void 0)return;const Cr=Vt(gr);return Cr.succeeded&&Cr.value!==void 0?[...nr,Cr.value]:void 0},[]);var Vt})(Gt)}}const hr={optional:lr(!0),required:lr(!1)};function dr(Gt,wt){const It=hr.required.object(wt)(Gt);return It.succeeded?It.value:void 0}function pr(Gt){console.warn([`Missing '${Gt.key}' of ${Gt.target} in ${Gt.place}.`,"Please rebuild plugins with the latest core package."].join(" "))}class ur{constructor(wt){this.value_=wt}static create(wt){return[new ur(wt),(It,Vt)=>{wt.setRawValue(It,Vt)}]}get emitter(){return this.value_.emitter}get rawValue(){return this.value_.rawValue}}const xr=Et("");function vr(Gt,wt){return zt(Gt,xr(void 0,wt))}class Dr extends ir{constructor(wt){var It;super(wt),this.onDisabledChange_=this.onDisabledChange_.bind(this),this.onParentChange_=this.onParentChange_.bind(this),this.onParentGlobalDisabledChange_=this.onParentGlobalDisabledChange_.bind(this),[this.globalDisabled_,this.setGlobalDisabled_]=ur.create(sr(this.getGlobalDisabled_())),this.value("disabled").emitter.on("change",this.onDisabledChange_),this.value("parent").emitter.on("change",this.onParentChange_),(It=this.get("parent"))===null||It===void 0||It.globalDisabled.emitter.on("change",this.onParentGlobalDisabledChange_)}static create(wt){var It,Vt,nr;const gr=wt??{};return new Dr(ir.createCore({disabled:(It=gr.disabled)!==null&&It!==void 0&&It,disposed:!1,hidden:(Vt=gr.hidden)!==null&&Vt!==void 0&&Vt,parent:(nr=gr.parent)!==null&&nr!==void 0?nr:null}))}get globalDisabled(){return this.globalDisabled_}bindClassModifiers(wt){kt(this.globalDisabled_,vr(wt,"disabled")),Dt(this,"hidden",vr(wt,"hidden"))}bindDisabled(wt){kt(this.globalDisabled_,It=>{wt.disabled=It})}bindTabIndex(wt){kt(this.globalDisabled_,It=>{wt.tabIndex=It?-1:0})}handleDispose(wt){this.value("disposed").emitter.on("change",It=>{It&&wt()})}getGlobalDisabled_(){const wt=this.get("parent");return!!wt&&wt.globalDisabled.rawValue||this.get("disabled")}updateGlobalDisabled_(){this.setGlobalDisabled_(this.getGlobalDisabled_())}onDisabledChange_(){this.updateGlobalDisabled_()}onParentGlobalDisabledChange_(){this.updateGlobalDisabled_()}onParentChange_(wt){var It;const Vt=wt.previousRawValue;Vt==null||Vt.globalDisabled.emitter.off("change",this.onParentGlobalDisabledChange_),(It=this.get("parent"))===null||It===void 0||It.globalDisabled.emitter.on("change",this.onParentGlobalDisabledChange_),this.updateGlobalDisabled_()}}const _r=Et(""),rr={veryfirst:"vfst",first:"fst",last:"lst",verylast:"vlst"};class mr{constructor(wt){this.parent_=null,this.blade=wt.blade,this.view=wt.view,this.viewProps=wt.viewProps;const It=this.view.element;this.blade.value("positions").emitter.on("change",()=>{["veryfirst","first","last","verylast"].forEach(Vt=>{It.classList.remove(_r(void 0,rr[Vt]))}),this.blade.get("positions").forEach(Vt=>{It.classList.add(_r(void 0,rr[Vt]))})}),this.viewProps.handleDispose(()=>{(function(Vt){Vt&&Vt.parentElement&&Vt.parentElement.removeChild(Vt)})(It)})}get parent(){return this.parent_}set parent(wt){this.parent_=wt,"parent"in this.viewProps.valMap_?this.viewProps.set("parent",this.parent_?this.parent_.viewProps:null):pr({key:"parent",target:Dr.name,place:"BladeController.parent"})}}const Rr="http://www.w3.org/2000/svg";function Yr(Gt){Gt.offsetHeight}function Zr(Gt){return Gt.ontouchstart!==void 0}function cn(){return globalThis.document}const Tn={check:'<path d="M2 8l4 4l8 -8"/>',dropdown:'<path d="M5 7h6l-3 3 z"/>',p2dpad:'<path d="M8 4v8"/><path d="M4 8h8"/><circle cx="12" cy="12" r="1.2"/>'};function yn(Gt,wt){const It=Gt.createElementNS(Rr,"svg");return It.innerHTML=Tn[wt],It}function zn(Gt,wt,It){Gt.insertBefore(wt,Gt.children[It])}function gs(Gt){Gt.parentElement&&Gt.parentElement.removeChild(Gt)}function or(Gt){for(;Gt.children.length>0;)Gt.removeChild(Gt.children[0])}function yr(Gt){return Gt.relatedTarget?Gt.relatedTarget:"explicitOriginalTarget"in Gt?Gt.explicitOriginalTarget:null}const Pr=Et("lbl");class jr{constructor(wt,It){this.element=wt.createElement("div"),this.element.classList.add(Pr()),It.viewProps.bindClassModifiers(this.element);const Vt=wt.createElement("div");Vt.classList.add(Pr("l")),Dt(It.props,"label",gr=>{at(gr)?this.element.classList.add(Pr(void 0,"nol")):(this.element.classList.remove(Pr(void 0,"nol")),function(Cr){for(;Cr.childNodes.length>0;)Cr.removeChild(Cr.childNodes[0])}(Vt),Vt.appendChild(function(Cr,qr){const fn=Cr.createDocumentFragment();return qr.split(`
`).map(Vn=>Cr.createTextNode(Vn)).forEach((Vn,ls)=>{ls>0&&fn.appendChild(Cr.createElement("br")),fn.appendChild(Vn)}),fn}(wt,gr)))}),this.element.appendChild(Vt),this.labelElement=Vt;const nr=wt.createElement("div");nr.classList.add(Pr("v")),this.element.appendChild(nr),this.valueElement=nr}}class Tr extends mr{constructor(wt,It){const Vt=It.valueController.viewProps;super(Object.assign(Object.assign({},It),{view:new jr(wt,{props:It.props,viewProps:Vt}),viewProps:Vt})),this.props=It.props,this.valueController=It.valueController,this.view.valueElement.appendChild(this.valueController.view.element)}}const Br={id:"button",type:"blade",accept(Gt){const wt=hr,It=dr(Gt,{title:wt.required.string,view:wt.required.constant("button"),label:wt.optional.string});return It?{params:It}:null},controller(Gt){return new Tr(Gt.document,{blade:Gt.blade,props:ir.fromObject({label:Gt.params.label}),valueController:new Ht(Gt.document,{props:ir.fromObject({title:Gt.params.title}),viewProps:Gt.viewProps})})},api(Gt){return Gt.controller instanceof Tr&&Gt.controller.valueController instanceof Ht?new xt(Gt.controller):null}};class Gr extends mr{constructor(wt){super(wt),this.value=wt.value}}function tn(){return new ir({positions:sr([],{equals:ut})})}class nn extends ir{constructor(wt){super(wt)}static create(wt){const It={completed:!0,expanded:wt,expandedHeight:null,shouldFixHeight:!1,temporaryExpanded:null},Vt=ir.createCore(It);return new nn(Vt)}get styleExpanded(){var wt;return(wt=this.get("temporaryExpanded"))!==null&&wt!==void 0?wt:this.get("expanded")}get styleHeight(){if(!this.styleExpanded)return"0";const wt=this.get("expandedHeight");return this.get("shouldFixHeight")&&!at(wt)?`${wt}px`:"auto"}bindExpandedClass(wt,It){const Vt=()=>{this.styleExpanded?wt.classList.add(It):wt.classList.remove(It)};Dt(this,"expanded",Vt),Dt(this,"temporaryExpanded",Vt)}cleanUpTransition(){this.set("shouldFixHeight",!1),this.set("expandedHeight",null),this.set("completed",!0)}}function gn(Gt,wt){wt.style.height=Gt.styleHeight}function xn(Gt,wt){Gt.value("expanded").emitter.on("beforechange",()=>{if(Gt.set("completed",!1),at(Gt.get("expandedHeight"))){const It=function(Vt,nr){let gr=0;return function(Cr,qr){const fn=Cr.style.transition;Cr.style.transition="none",qr(),Cr.style.transition=fn}(nr,()=>{Vt.set("expandedHeight",null),Vt.set("temporaryExpanded",!0),Yr(nr),gr=nr.clientHeight,Vt.set("temporaryExpanded",null),Yr(nr)}),gr}(Gt,wt);It>0&&Gt.set("expandedHeight",It)}Gt.set("shouldFixHeight",!0),Yr(wt)}),Gt.emitter.on("change",()=>{gn(Gt,wt)}),gn(Gt,wt),wt.addEventListener("transitionend",It=>{It.propertyName==="height"&&Gt.cleanUpTransition()})}class Mn extends d{constructor(wt,It){super(wt),this.rackApi_=It}}class An{constructor(wt){this.emitter=new At,this.items_=[],this.cache_=new Set,this.onSubListAdd_=this.onSubListAdd_.bind(this),this.onSubListRemove_=this.onSubListRemove_.bind(this),this.extract_=wt}get items(){return this.items_}allItems(){return Array.from(this.cache_)}find(wt){for(const It of this.allItems())if(wt(It))return It;return null}includes(wt){return this.cache_.has(wt)}add(wt,It){if(this.includes(wt))throw ft.shouldNeverHappen();const Vt=It!==void 0?It:this.items_.length;this.items_.splice(Vt,0,wt),this.cache_.add(wt);const nr=this.extract_(wt);nr&&(nr.emitter.on("add",this.onSubListAdd_),nr.emitter.on("remove",this.onSubListRemove_),nr.allItems().forEach(gr=>{this.cache_.add(gr)})),this.emitter.emit("add",{index:Vt,item:wt,root:this,target:this})}remove(wt){const It=this.items_.indexOf(wt);if(It<0)return;this.items_.splice(It,1),this.cache_.delete(wt);const Vt=this.extract_(wt);Vt&&(Vt.emitter.off("add",this.onSubListAdd_),Vt.emitter.off("remove",this.onSubListRemove_)),this.emitter.emit("remove",{index:It,item:wt,root:this,target:this})}onSubListAdd_(wt){this.cache_.add(wt.item),this.emitter.emit("add",{index:wt.index,item:wt.item,root:this,target:wt.target})}onSubListRemove_(wt){this.cache_.delete(wt.item),this.emitter.emit("remove",{index:wt.index,item:wt.item,root:this,target:wt.target})}}class vn extends d{constructor(wt){super(wt),this.onBindingChange_=this.onBindingChange_.bind(this),this.emitter_=new At,this.controller_.binding.emitter.on("change",this.onBindingChange_)}get label(){return this.controller_.props.get("label")}set label(wt){this.controller_.props.set("label",wt)}on(wt,It){const Vt=It.bind(this);return this.emitter_.on(wt,nr=>{Vt(nr.event)}),this}refresh(){this.controller_.binding.read()}onBindingChange_(wt){const It=wt.sender.target.read();this.emitter_.emit("change",{event:new b(this,It,this.controller_.binding.target.presetKey,wt.options.last)})}}class Cn extends Tr{constructor(wt,It){super(wt,It),this.binding=It.binding}}class rn extends d{constructor(wt){super(wt),this.onBindingUpdate_=this.onBindingUpdate_.bind(this),this.emitter_=new At,this.controller_.binding.emitter.on("update",this.onBindingUpdate_)}get label(){return this.controller_.props.get("label")}set label(wt){this.controller_.props.set("label",wt)}on(wt,It){const Vt=It.bind(this);return this.emitter_.on(wt,nr=>{Vt(nr.event)}),this}refresh(){this.controller_.binding.read()}onBindingUpdate_(wt){const It=wt.sender.target.read();this.emitter_.emit("update",{event:new _e(this,It,this.controller_.binding.target.presetKey)})}}class En extends Tr{constructor(wt,It){super(wt,It),this.binding=It.binding,this.viewProps.bindDisabled(this.binding.ticker),this.viewProps.handleDispose(()=>{this.binding.dispose()})}}function Hn(Gt){return Gt instanceof Wn?Gt.apiSet_:Gt instanceof Mn?Gt.rackApi_.apiSet_:null}function Qn(Gt,wt){const It=Gt.find(Vt=>Vt.controller_===wt);if(!It)throw ft.shouldNeverHappen();return It}function ks(Gt,wt,It){if(!vt.isBindable(Gt))throw ft.notBindable();return new vt(Gt,wt,It)}class Wn extends d{constructor(wt,It){super(wt),this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this),this.onRackInputChange_=this.onRackInputChange_.bind(this),this.onRackMonitorUpdate_=this.onRackMonitorUpdate_.bind(this),this.emitter_=new At,this.apiSet_=new An(Hn),this.pool_=It;const Vt=this.controller_.rack;Vt.emitter.on("add",this.onRackAdd_),Vt.emitter.on("remove",this.onRackRemove_),Vt.emitter.on("inputchange",this.onRackInputChange_),Vt.emitter.on("monitorupdate",this.onRackMonitorUpdate_),Vt.children.forEach(nr=>{this.setUpApi_(nr)})}get children(){return this.controller_.rack.children.map(wt=>Qn(this.apiSet_,wt))}addInput(wt,It,Vt){const nr=Vt??{},gr=this.controller_.view.element.ownerDocument,Cr=this.pool_.createInput(gr,ks(wt,It,nr.presetKey),nr),qr=new vn(Cr);return this.add(qr,nr.index)}addMonitor(wt,It,Vt){const nr=Vt??{},gr=this.controller_.view.element.ownerDocument,Cr=this.pool_.createMonitor(gr,ks(wt,It),nr),qr=new rn(Cr);return this.add(qr,nr.index)}addFolder(wt){return function(It,Vt){return It.addBlade(Object.assign(Object.assign({},Vt),{view:"folder"}))}(this,wt)}addButton(wt){return function(It,Vt){return It.addBlade(Object.assign(Object.assign({},Vt),{view:"button"}))}(this,wt)}addSeparator(wt){return function(It,Vt){const nr=Vt??{};return It.addBlade(Object.assign(Object.assign({},nr),{view:"separator"}))}(this,wt)}addTab(wt){return function(It,Vt){return It.addBlade(Object.assign(Object.assign({},Vt),{view:"tab"}))}(this,wt)}add(wt,It){this.controller_.rack.add(wt.controller_,It);const Vt=this.apiSet_.find(nr=>nr.controller_===wt.controller_);return Vt&&this.apiSet_.remove(Vt),this.apiSet_.add(wt),wt}remove(wt){this.controller_.rack.remove(wt.controller_)}addBlade(wt){const It=this.controller_.view.element.ownerDocument,Vt=this.pool_.createBlade(It,wt),nr=this.pool_.createBladeApi(Vt);return this.add(nr,wt.index)}on(wt,It){const Vt=It.bind(this);return this.emitter_.on(wt,nr=>{Vt(nr.event)}),this}setUpApi_(wt){this.apiSet_.find(It=>It.controller_===wt)||this.apiSet_.add(this.pool_.createBladeApi(wt))}onRackAdd_(wt){this.setUpApi_(wt.bladeController)}onRackRemove_(wt){if(wt.isRoot){const It=Qn(this.apiSet_,wt.bladeController);this.apiSet_.remove(It)}}onRackInputChange_(wt){const It=wt.bladeController;if(It instanceof Cn){const Vt=Qn(this.apiSet_,It),nr=It.binding;this.emitter_.emit("change",{event:new b(Vt,nr.target.read(),nr.target.presetKey,wt.options.last)})}else if(It instanceof Gr){const Vt=Qn(this.apiSet_,It);this.emitter_.emit("change",{event:new b(Vt,It.value.rawValue,void 0,wt.options.last)})}}onRackMonitorUpdate_(wt){if(!(wt.bladeController instanceof En))throw ft.shouldNeverHappen();const It=Qn(this.apiSet_,wt.bladeController),Vt=wt.bladeController.binding;this.emitter_.emit("update",{event:new _e(It,Vt.target.read(),Vt.target.presetKey)})}}class Gn extends Mn{constructor(wt,It){super(wt,new Wn(wt.rackController,It)),this.emitter_=new At,this.controller_.foldable.value("expanded").emitter.on("change",Vt=>{this.emitter_.emit("fold",{event:new it(this,Vt.sender.rawValue)})}),this.rackApi_.on("change",Vt=>{this.emitter_.emit("change",{event:Vt})}),this.rackApi_.on("update",Vt=>{this.emitter_.emit("update",{event:Vt})})}get expanded(){return this.controller_.foldable.get("expanded")}set expanded(wt){this.controller_.foldable.set("expanded",wt)}get title(){return this.controller_.props.get("title")}set title(wt){this.controller_.props.set("title",wt)}get children(){return this.rackApi_.children}addInput(wt,It,Vt){return this.rackApi_.addInput(wt,It,Vt)}addMonitor(wt,It,Vt){return this.rackApi_.addMonitor(wt,It,Vt)}addFolder(wt){return this.rackApi_.addFolder(wt)}addButton(wt){return this.rackApi_.addButton(wt)}addSeparator(wt){return this.rackApi_.addSeparator(wt)}addTab(wt){return this.rackApi_.addTab(wt)}add(wt,It){return this.rackApi_.add(wt,It)}remove(wt){this.rackApi_.remove(wt)}addBlade(wt){return this.rackApi_.addBlade(wt)}on(wt,It){const Vt=It.bind(this);return this.emitter_.on(wt,nr=>{Vt(nr.event)}),this}}class Xn extends mr{constructor(wt){super({blade:wt.blade,view:wt.view,viewProps:wt.rackController.viewProps}),this.rackController=wt.rackController}}class Jn{constructor(wt,It){const Vt=Et(It.viewName);this.element=wt.createElement("div"),this.element.classList.add(Vt()),It.viewProps.bindClassModifiers(this.element)}}function Vs(Gt){return Gt instanceof to?Gt.rack:Gt instanceof Xn?Gt.rackController.rack:null}function Gs(Gt){const wt=Vs(Gt);return wt?wt.bcSet_:null}class $s{constructor(wt){var It,Vt;this.onBladePositionsChange_=this.onBladePositionsChange_.bind(this),this.onSetAdd_=this.onSetAdd_.bind(this),this.onSetRemove_=this.onSetRemove_.bind(this),this.onChildDispose_=this.onChildDispose_.bind(this),this.onChildPositionsChange_=this.onChildPositionsChange_.bind(this),this.onChildInputChange_=this.onChildInputChange_.bind(this),this.onChildMonitorUpdate_=this.onChildMonitorUpdate_.bind(this),this.onChildValueChange_=this.onChildValueChange_.bind(this),this.onChildViewPropsChange_=this.onChildViewPropsChange_.bind(this),this.onDescendantLayout_=this.onDescendantLayout_.bind(this),this.onDescendantInputChange_=this.onDescendantInputChange_.bind(this),this.onDescendantMonitorUpdate_=this.onDescendantMonitorUpdate_.bind(this),this.emitter=new At,this.blade_=(It=wt.blade)!==null&&It!==void 0?It:null,(Vt=this.blade_)===null||Vt===void 0||Vt.value("positions").emitter.on("change",this.onBladePositionsChange_),this.viewProps=wt.viewProps,this.bcSet_=new An(Gs),this.bcSet_.emitter.on("add",this.onSetAdd_),this.bcSet_.emitter.on("remove",this.onSetRemove_)}get children(){return this.bcSet_.items}add(wt,It){var Vt;(Vt=wt.parent)===null||Vt===void 0||Vt.remove(wt),pt(wt,"parent")?wt.parent=this:(wt.parent_=this,pr({key:"parent",target:"BladeController",place:"BladeRack.add"})),this.bcSet_.add(wt,It)}remove(wt){pt(wt,"parent")?wt.parent=null:(wt.parent_=null,pr({key:"parent",target:"BladeController",place:"BladeRack.remove"})),this.bcSet_.remove(wt)}find(wt){return this.bcSet_.allItems().filter(It=>It instanceof wt)}onSetAdd_(wt){this.updatePositions_();const It=wt.target===wt.root;if(this.emitter.emit("add",{bladeController:wt.item,index:wt.index,isRoot:It,sender:this}),!It)return;const Vt=wt.item;if(Vt.viewProps.emitter.on("change",this.onChildViewPropsChange_),Vt.blade.value("positions").emitter.on("change",this.onChildPositionsChange_),Vt.viewProps.handleDispose(this.onChildDispose_),Vt instanceof Cn)Vt.binding.emitter.on("change",this.onChildInputChange_);else if(Vt instanceof En)Vt.binding.emitter.on("update",this.onChildMonitorUpdate_);else if(Vt instanceof Gr)Vt.value.emitter.on("change",this.onChildValueChange_);else{const nr=Vs(Vt);if(nr){const gr=nr.emitter;gr.on("layout",this.onDescendantLayout_),gr.on("inputchange",this.onDescendantInputChange_),gr.on("monitorupdate",this.onDescendantMonitorUpdate_)}}}onSetRemove_(wt){this.updatePositions_();const It=wt.target===wt.root;if(this.emitter.emit("remove",{bladeController:wt.item,isRoot:It,sender:this}),!It)return;const Vt=wt.item;if(Vt instanceof Cn)Vt.binding.emitter.off("change",this.onChildInputChange_);else if(Vt instanceof En)Vt.binding.emitter.off("update",this.onChildMonitorUpdate_);else if(Vt instanceof Gr)Vt.value.emitter.off("change",this.onChildValueChange_);else{const nr=Vs(Vt);if(nr){const gr=nr.emitter;gr.off("layout",this.onDescendantLayout_),gr.off("inputchange",this.onDescendantInputChange_),gr.off("monitorupdate",this.onDescendantMonitorUpdate_)}}}updatePositions_(){const wt=this.bcSet_.items.filter(nr=>!nr.viewProps.get("hidden")),It=wt[0],Vt=wt[wt.length-1];this.bcSet_.items.forEach(nr=>{const gr=[];nr===It&&(gr.push("first"),this.blade_&&!this.blade_.get("positions").includes("veryfirst")||gr.push("veryfirst")),nr===Vt&&(gr.push("last"),this.blade_&&!this.blade_.get("positions").includes("verylast")||gr.push("verylast")),nr.blade.set("positions",gr)})}onChildPositionsChange_(){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildViewPropsChange_(wt){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildDispose_(){this.bcSet_.items.filter(wt=>wt.viewProps.get("disposed")).forEach(wt=>{this.bcSet_.remove(wt)})}onChildInputChange_(wt){const It=function(Vt,nr){for(let gr=0;gr<Vt.length;gr++){const Cr=Vt[gr];if(Cr instanceof Cn&&Cr.binding===nr)return Cr}return null}(this.find(Cn),wt.sender);if(!It)throw ft.alreadyDisposed();this.emitter.emit("inputchange",{bladeController:It,options:wt.options,sender:this})}onChildMonitorUpdate_(wt){const It=function(Vt,nr){for(let gr=0;gr<Vt.length;gr++){const Cr=Vt[gr];if(Cr instanceof En&&Cr.binding===nr)return Cr}return null}(this.find(En),wt.sender);if(!It)throw ft.alreadyDisposed();this.emitter.emit("monitorupdate",{bladeController:It,sender:this})}onChildValueChange_(wt){const It=function(Vt,nr){for(let gr=0;gr<Vt.length;gr++){const Cr=Vt[gr];if(Cr instanceof Gr&&Cr.value===nr)return Cr}return null}(this.find(Gr),wt.sender);if(!It)throw ft.alreadyDisposed();this.emitter.emit("inputchange",{bladeController:It,options:wt.options,sender:this})}onDescendantLayout_(wt){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onDescendantInputChange_(wt){this.emitter.emit("inputchange",{bladeController:wt.bladeController,options:wt.options,sender:this})}onDescendantMonitorUpdate_(wt){this.emitter.emit("monitorupdate",{bladeController:wt.bladeController,sender:this})}onBladePositionsChange_(){this.updatePositions_()}}class to extends mr{constructor(wt,It){super(Object.assign(Object.assign({},It),{view:new Jn(wt,{viewName:"brk",viewProps:It.viewProps})})),this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this);const Vt=new $s({blade:It.root?void 0:It.blade,viewProps:It.viewProps});Vt.emitter.on("add",this.onRackAdd_),Vt.emitter.on("remove",this.onRackRemove_),this.rack=Vt,this.viewProps.handleDispose(()=>{for(let nr=this.rack.children.length-1;nr>=0;nr--)this.rack.children[nr].viewProps.set("disposed",!0)})}onRackAdd_(wt){wt.isRoot&&zn(this.view.element,wt.bladeController.view.element,wt.index)}onRackRemove_(wt){wt.isRoot&&gs(wt.bladeController.view.element)}}const Mo=Et("cnt");class rp{constructor(wt,It){var Vt;this.className_=Et((Vt=It.viewName)!==null&&Vt!==void 0?Vt:"fld"),this.element=wt.createElement("div"),this.element.classList.add(this.className_(),Mo()),It.viewProps.bindClassModifiers(this.element),this.foldable_=It.foldable,this.foldable_.bindExpandedClass(this.element,this.className_(void 0,"expanded")),Dt(this.foldable_,"completed",zt(this.element,this.className_(void 0,"cpl")));const nr=wt.createElement("button");nr.classList.add(this.className_("b")),Dt(It.props,"title",Vn=>{at(Vn)?this.element.classList.add(this.className_(void 0,"not")):this.element.classList.remove(this.className_(void 0,"not"))}),It.viewProps.bindDisabled(nr),this.element.appendChild(nr),this.buttonElement=nr;const gr=wt.createElement("div");gr.classList.add(this.className_("i")),this.element.appendChild(gr);const Cr=wt.createElement("div");Cr.classList.add(this.className_("t")),Bt(It.props.value("title"),Cr),this.buttonElement.appendChild(Cr),this.titleElement=Cr;const qr=wt.createElement("div");qr.classList.add(this.className_("m")),this.buttonElement.appendChild(qr);const fn=It.containerElement;fn.classList.add(this.className_("c")),this.element.appendChild(fn),this.containerElement=fn}}class ho extends Xn{constructor(wt,It){var Vt;const nr=nn.create((Vt=It.expanded)===null||Vt===void 0||Vt),gr=new to(wt,{blade:It.blade,root:It.root,viewProps:It.viewProps});super(Object.assign(Object.assign({},It),{rackController:gr,view:new rp(wt,{containerElement:gr.view.element,foldable:nr,props:It.props,viewName:It.root?"rot":void 0,viewProps:It.viewProps})})),this.onTitleClick_=this.onTitleClick_.bind(this),this.props=It.props,this.foldable=nr,xn(this.foldable,this.view.containerElement),this.rackController.rack.emitter.on("add",()=>{this.foldable.cleanUpTransition()}),this.rackController.rack.emitter.on("remove",()=>{this.foldable.cleanUpTransition()}),this.view.buttonElement.addEventListener("click",this.onTitleClick_)}get document(){return this.view.element.ownerDocument}onTitleClick_(){this.foldable.set("expanded",!this.foldable.get("expanded"))}}const ro={id:"folder",type:"blade",accept(Gt){const wt=hr,It=dr(Gt,{title:wt.required.string,view:wt.required.constant("folder"),expanded:wt.optional.boolean});return It?{params:It}:null},controller(Gt){return new ho(Gt.document,{blade:Gt.blade,expanded:Gt.params.expanded,props:ir.fromObject({title:Gt.params.title}),viewProps:Gt.viewProps})},api(Gt){return Gt.controller instanceof ho?new Gn(Gt.controller,Gt.pool):null}};class xa extends Gr{constructor(wt,It){const Vt=It.valueController.viewProps;super(Object.assign(Object.assign({},It),{value:It.valueController.value,view:new jr(wt,{props:It.props,viewProps:Vt}),viewProps:Vt})),this.props=It.props,this.valueController=It.valueController,this.view.valueElement.appendChild(this.valueController.view.element)}}class io extends d{}const Ml=Et("spr");class kn{constructor(wt,It){this.element=wt.createElement("div"),this.element.classList.add(Ml()),It.viewProps.bindClassModifiers(this.element);const Vt=wt.createElement("hr");Vt.classList.add(Ml("r")),this.element.appendChild(Vt)}}class Nn extends mr{constructor(wt,It){super(Object.assign(Object.assign({},It),{view:new kn(wt,{viewProps:It.viewProps})}))}}const no={id:"separator",type:"blade",accept(Gt){const wt=dr(Gt,{view:hr.required.constant("separator")});return wt?{params:wt}:null},controller(Gt){return new Nn(Gt.document,{blade:Gt.blade,viewProps:Gt.viewProps})},api(Gt){return Gt.controller instanceof Nn?new io(Gt.controller):null}},Ss=Et("tbi");class Il{constructor(wt,It){this.element=wt.createElement("div"),this.element.classList.add(Ss()),It.viewProps.bindClassModifiers(this.element),Dt(It.props,"selected",gr=>{gr?this.element.classList.add(Ss(void 0,"sel")):this.element.classList.remove(Ss(void 0,"sel"))});const Vt=wt.createElement("button");Vt.classList.add(Ss("b")),It.viewProps.bindDisabled(Vt),this.element.appendChild(Vt),this.buttonElement=Vt;const nr=wt.createElement("div");nr.classList.add(Ss("t")),Bt(It.props.value("title"),nr),this.buttonElement.appendChild(nr),this.titleElement=nr}}class mo{constructor(wt,It){this.emitter=new At,this.onClick_=this.onClick_.bind(this),this.props=It.props,this.viewProps=It.viewProps,this.view=new Il(wt,{props:It.props,viewProps:It.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}}class Ws{constructor(wt,It){this.onItemClick_=this.onItemClick_.bind(this),this.ic_=new mo(wt,{props:It.itemProps,viewProps:Dr.create()}),this.ic_.emitter.on("click",this.onItemClick_),this.cc_=new to(wt,{blade:tn(),viewProps:Dr.create()}),this.props=It.props,Dt(this.props,"selected",Vt=>{this.itemController.props.set("selected",Vt),this.contentController.viewProps.set("hidden",!Vt)})}get itemController(){return this.ic_}get contentController(){return this.cc_}onItemClick_(){this.props.set("selected",!0)}}class As{constructor(wt,It){this.controller_=wt,this.rackApi_=It}get title(){var wt;return(wt=this.controller_.itemController.props.get("title"))!==null&&wt!==void 0?wt:""}set title(wt){this.controller_.itemController.props.set("title",wt)}get selected(){return this.controller_.props.get("selected")}set selected(wt){this.controller_.props.set("selected",wt)}get children(){return this.rackApi_.children}addButton(wt){return this.rackApi_.addButton(wt)}addFolder(wt){return this.rackApi_.addFolder(wt)}addSeparator(wt){return this.rackApi_.addSeparator(wt)}addTab(wt){return this.rackApi_.addTab(wt)}add(wt,It){this.rackApi_.add(wt,It)}remove(wt){this.rackApi_.remove(wt)}addInput(wt,It,Vt){return this.rackApi_.addInput(wt,It,Vt)}addMonitor(wt,It,Vt){return this.rackApi_.addMonitor(wt,It,Vt)}addBlade(wt){return this.rackApi_.addBlade(wt)}}class Ps extends Mn{constructor(wt,It){super(wt,new Wn(wt.rackController,It)),this.onPageAdd_=this.onPageAdd_.bind(this),this.onPageRemove_=this.onPageRemove_.bind(this),this.onSelect_=this.onSelect_.bind(this),this.emitter_=new At,this.pageApiMap_=new Map,this.rackApi_.on("change",Vt=>{this.emitter_.emit("change",{event:Vt})}),this.rackApi_.on("update",Vt=>{this.emitter_.emit("update",{event:Vt})}),this.controller_.tab.selectedIndex.emitter.on("change",this.onSelect_),this.controller_.pageSet.emitter.on("add",this.onPageAdd_),this.controller_.pageSet.emitter.on("remove",this.onPageRemove_),this.controller_.pageSet.items.forEach(Vt=>{this.setUpPageApi_(Vt)})}get pages(){return this.controller_.pageSet.items.map(wt=>{const It=this.pageApiMap_.get(wt);if(!It)throw ft.shouldNeverHappen();return It})}addPage(wt){const It=this.controller_.view.element.ownerDocument,Vt=new Ws(It,{itemProps:ir.fromObject({selected:!1,title:wt.title}),props:ir.fromObject({selected:!1})});this.controller_.add(Vt,wt.index);const nr=this.pageApiMap_.get(Vt);if(!nr)throw ft.shouldNeverHappen();return nr}removePage(wt){this.controller_.remove(wt)}on(wt,It){const Vt=It.bind(this);return this.emitter_.on(wt,nr=>{Vt(nr.event)}),this}setUpPageApi_(wt){const It=this.rackApi_.apiSet_.find(nr=>nr.controller_===wt.contentController);if(!It)throw ft.shouldNeverHappen();const Vt=new As(wt,It);this.pageApiMap_.set(wt,Vt)}onPageAdd_(wt){this.setUpPageApi_(wt.item)}onPageRemove_(wt){if(!this.pageApiMap_.get(wt.item))throw ft.shouldNeverHappen();this.pageApiMap_.delete(wt.item)}onSelect_(wt){this.emitter_.emit("select",{event:new nt(this,wt.rawValue)})}}class Fo{constructor(){this.onItemSelectedChange_=this.onItemSelectedChange_.bind(this),this.empty=sr(!0),this.selectedIndex=sr(-1),this.items_=[]}add(wt,It){const Vt=It??this.items_.length;this.items_.splice(Vt,0,wt),wt.emitter.on("change",this.onItemSelectedChange_),this.keepSelection_()}remove(wt){const It=this.items_.indexOf(wt);It<0||(this.items_.splice(It,1),wt.emitter.off("change",this.onItemSelectedChange_),this.keepSelection_())}keepSelection_(){if(this.items_.length===0)return this.selectedIndex.rawValue=-1,void(this.empty.rawValue=!0);const wt=this.items_.findIndex(It=>It.rawValue);wt<0?(this.items_.forEach((It,Vt)=>{It.rawValue=Vt===0}),this.selectedIndex.rawValue=0):(this.items_.forEach((It,Vt)=>{It.rawValue=Vt===wt}),this.selectedIndex.rawValue=wt),this.empty.rawValue=!1}onItemSelectedChange_(wt){if(wt.rawValue){const It=this.items_.findIndex(Vt=>Vt===wt.sender);this.items_.forEach((Vt,nr)=>{Vt.rawValue=nr===It}),this.selectedIndex.rawValue=It}else this.keepSelection_()}}const Io=Et("tab");class xo{constructor(wt,It){this.element=wt.createElement("div"),this.element.classList.add(Io(),Mo()),It.viewProps.bindClassModifiers(this.element),kt(It.empty,zt(this.element,Io(void 0,"nop")));const Vt=wt.createElement("div");Vt.classList.add(Io("t")),this.element.appendChild(Vt),this.itemsElement=Vt;const nr=wt.createElement("div");nr.classList.add(Io("i")),this.element.appendChild(nr);const gr=It.contentsElement;gr.classList.add(Io("c")),this.element.appendChild(gr),this.contentsElement=gr}}class yl extends Xn{constructor(wt,It){const Vt=new to(wt,{blade:It.blade,viewProps:It.viewProps}),nr=new Fo;super({blade:It.blade,rackController:Vt,view:new xo(wt,{contentsElement:Vt.view.element,empty:nr.empty,viewProps:It.viewProps})}),this.onPageAdd_=this.onPageAdd_.bind(this),this.onPageRemove_=this.onPageRemove_.bind(this),this.pageSet_=new An(()=>null),this.pageSet_.emitter.on("add",this.onPageAdd_),this.pageSet_.emitter.on("remove",this.onPageRemove_),this.tab=nr}get pageSet(){return this.pageSet_}add(wt,It){this.pageSet_.add(wt,It)}remove(wt){this.pageSet_.remove(this.pageSet_.items[wt])}onPageAdd_(wt){const It=wt.item;zn(this.view.itemsElement,It.itemController.view.element,wt.index),It.itemController.viewProps.set("parent",this.viewProps),this.rackController.rack.add(It.contentController,wt.index),this.tab.add(It.props.value("selected"))}onPageRemove_(wt){const It=wt.item;gs(It.itemController.view.element),It.itemController.viewProps.set("parent",null),this.rackController.rack.remove(It.contentController),this.tab.remove(It.props.value("selected"))}}const ip={id:"tab",type:"blade",accept(Gt){const wt=hr,It=dr(Gt,{pages:wt.required.array(wt.required.object({title:wt.required.string})),view:wt.required.constant("tab")});return It&&It.pages.length!==0?{params:It}:null},controller(Gt){const wt=new yl(Gt.document,{blade:Gt.blade,viewProps:Gt.viewProps});return Gt.params.pages.forEach(It=>{const Vt=new Ws(Gt.document,{itemProps:ir.fromObject({selected:!1,title:It.title}),props:ir.fromObject({selected:!1})});wt.add(Vt)}),wt},api(Gt){return Gt.controller instanceof yl?new Ps(Gt.controller,Gt.pool):null}};class jp{constructor(){this.disabled=!1,this.emitter=new At}dispose(){}tick(){this.disabled||this.emitter.emit("tick",{sender:this})}}class Gp{constructor(wt,It){this.disabled_=!1,this.timerId_=null,this.onTick_=this.onTick_.bind(this),this.doc_=wt,this.emitter=new At,this.interval_=It,this.setTimer_()}get disabled(){return this.disabled_}set disabled(wt){this.disabled_=wt,this.disabled_?this.clearTimer_():this.setTimer_()}dispose(){this.clearTimer_()}clearTimer_(){if(this.timerId_===null)return;const wt=this.doc_.defaultView;wt&&wt.clearInterval(this.timerId_),this.timerId_=null}setTimer_(){if(this.clearTimer_(),this.interval_<=0)return;const wt=this.doc_.defaultView;wt&&(this.timerId_=wt.setInterval(this.onTick_,this.interval_))}onTick_(){this.disabled_||this.emitter.emit("tick",{sender:this})}}class Bm{constructor(wt){this.onValueChange_=this.onValueChange_.bind(this),this.reader=wt.reader,this.writer=wt.writer,this.emitter=new At,this.value=wt.value,this.value.emitter.on("change",this.onValueChange_),this.target=wt.target,this.read()}read(){const wt=this.target.read();wt!==void 0&&(this.value.rawValue=this.reader(wt))}write_(wt){this.writer(this.target,wt)}onValueChange_(wt){this.write_(wt.rawValue),this.emitter.emit("change",{options:wt.options,rawValue:wt.rawValue,sender:this})}}function zp(Gt,wt){for(;Gt.length<wt;)Gt.push(void 0)}function Lm(Gt){const wt=[];return zp(wt,Gt),sr(wt)}function Om(Gt){const wt=Gt.indexOf(void 0);return wt<0?Gt:Gt.slice(0,wt)}class V_{constructor(wt){this.onTick_=this.onTick_.bind(this),this.reader_=wt.reader,this.target=wt.target,this.emitter=new At,this.value=wt.value,this.ticker=wt.ticker,this.ticker.emitter.on("tick",this.onTick_),this.read()}dispose(){this.ticker.dispose()}read(){const wt=this.target.read();if(wt===void 0)return;const It=this.value.rawValue,Vt=this.reader_(wt);this.value.rawValue=function(nr,gr){const Cr=[...Om(nr),gr];return Cr.length>nr.length?Cr.splice(0,Cr.length-nr.length):zp(Cr,nr.length),Cr}(It,Vt),this.emitter.emit("update",{rawValue:Vt,sender:this})}onTick_(wt){this.read()}}class nu{constructor(wt){this.constraints=wt}constrain(wt){return this.constraints.reduce((It,Vt)=>Vt.constrain(It),wt)}}function Qo(Gt,wt){if(Gt instanceof wt)return Gt;if(Gt instanceof nu){const It=Gt.constraints.reduce((Vt,nr)=>Vt||(nr instanceof wt?nr:null),null);if(It)return It}return null}class Hl{constructor(wt){this.values=ir.fromObject({max:wt.max,min:wt.min})}constrain(wt){const It=this.values.get("max"),Vt=this.values.get("min");return Math.min(Math.max(wt,Vt),It)}}class su{constructor(wt){this.values=ir.fromObject({options:wt})}get options(){return this.values.get("options")}constrain(wt){const It=this.values.get("options");return It.length===0||It.filter(Vt=>Vt.value===wt).length>0?wt:It[0].value}}class Vp{constructor(wt){this.values=ir.fromObject({max:wt.max,min:wt.min})}get maxValue(){return this.values.get("max")}get minValue(){return this.values.get("min")}constrain(wt){const It=this.values.get("max"),Vt=this.values.get("min");let nr=wt;return at(Vt)||(nr=Math.max(nr,Vt)),at(It)||(nr=Math.min(nr,It)),nr}}class Cu{constructor(wt,It=0){this.step=wt,this.origin=It}constrain(wt){const It=this.origin%this.step;return It+Math.round((wt-It)/this.step)*this.step}}const np=Et("lst");class Nm{constructor(wt,It){this.onValueChange_=this.onValueChange_.bind(this),this.props_=It.props,this.element=wt.createElement("div"),this.element.classList.add(np()),It.viewProps.bindClassModifiers(this.element);const Vt=wt.createElement("select");Vt.classList.add(np("s")),It.viewProps.bindDisabled(Vt),this.element.appendChild(Vt),this.selectElement=Vt;const nr=wt.createElement("div");nr.classList.add(np("m")),nr.appendChild(yn(wt,"dropdown")),this.element.appendChild(nr),It.value.emitter.on("change",this.onValueChange_),this.value_=It.value,Dt(this.props_,"options",gr=>{or(this.selectElement),gr.forEach(Cr=>{const qr=wt.createElement("option");qr.textContent=Cr.text,this.selectElement.appendChild(qr)}),this.update_()})}update_(){const wt=this.props_.get("options").map(It=>It.value);this.selectElement.selectedIndex=wt.indexOf(this.value_.rawValue)}onValueChange_(){this.update_()}}class au{constructor(wt,It){this.onSelectChange_=this.onSelectChange_.bind(this),this.props=It.props,this.value=It.value,this.viewProps=It.viewProps,this.view=new Nm(wt,{props:this.props,value:this.value,viewProps:this.viewProps}),this.view.selectElement.addEventListener("change",this.onSelectChange_)}onSelectChange_(wt){const It=wt.currentTarget;this.value.rawValue=this.props.get("options")[It.selectedIndex].value}}const Hp=Et("pop");class Fm{constructor(wt,It){this.element=wt.createElement("div"),this.element.classList.add(Hp()),It.viewProps.bindClassModifiers(this.element),kt(It.shows,zt(this.element,Hp(void 0,"v")))}}class Qp{constructor(wt,It){this.shows=sr(!1),this.viewProps=It.viewProps,this.view=new Fm(wt,{shows:this.shows,viewProps:this.viewProps})}}const Wp=Et("txt");class Um{constructor(wt,It){this.onChange_=this.onChange_.bind(this),this.element=wt.createElement("div"),this.element.classList.add(Wp()),It.viewProps.bindClassModifiers(this.element),this.props_=It.props,this.props_.emitter.on("change",this.onChange_);const Vt=wt.createElement("input");Vt.classList.add(Wp("i")),Vt.type="text",It.viewProps.bindDisabled(Vt),this.element.appendChild(Vt),this.inputElement=Vt,It.value.emitter.on("change",this.onChange_),this.value_=It.value,this.refresh()}refresh(){const wt=this.props_.get("formatter");this.inputElement.value=wt(this.value_.rawValue)}onChange_(){this.refresh()}}class Pu{constructor(wt,It){this.onInputChange_=this.onInputChange_.bind(this),this.parser_=It.parser,this.props=It.props,this.value=It.value,this.viewProps=It.viewProps,this.view=new Um(wt,{props:It.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(wt){const It=wt.currentTarget.value,Vt=this.parser_(It);at(Vt)||(this.value.rawValue=Vt),this.view.refresh()}}function qp(Gt){return Gt!=="false"&&!!Gt}function sp(Gt){return function(wt){return String(wt)}(Gt)}class jm{constructor(wt){this.text=wt}evaluate(){return Number(this.text)}toString(){return this.text}}const Gm={"**":(Gt,wt)=>Math.pow(Gt,wt),"*":(Gt,wt)=>Gt*wt,"/":(Gt,wt)=>Gt/wt,"%":(Gt,wt)=>Gt%wt,"+":(Gt,wt)=>Gt+wt,"-":(Gt,wt)=>Gt-wt,"<<":(Gt,wt)=>Gt<<wt,">>":(Gt,wt)=>Gt>>wt,">>>":(Gt,wt)=>Gt>>>wt,"&":(Gt,wt)=>Gt&wt,"^":(Gt,wt)=>Gt^wt,"|":(Gt,wt)=>Gt|wt};class H_{constructor(wt,It,Vt){this.left=It,this.operator=wt,this.right=Vt}evaluate(){const wt=Gm[this.operator];if(!wt)throw new Error(`unexpected binary operator: '${this.operator}`);return wt(this.left.evaluate(),this.right.evaluate())}toString(){return["b(",this.left.toString(),this.operator,this.right.toString(),")"].join(" ")}}const zm={"+":Gt=>Gt,"-":Gt=>-Gt,"~":Gt=>~Gt};class Vm{constructor(wt,It){this.operator=wt,this.expression=It}evaluate(){const wt=zm[this.operator];if(!wt)throw new Error(`unexpected unary operator: '${this.operator}`);return wt(this.expression.evaluate())}toString(){return["u(",this.operator,this.expression.toString(),")"].join(" ")}}function ap(Gt){return(wt,It)=>{for(let Vt=0;Vt<Gt.length;Vt++){const nr=Gt[Vt](wt,It);if(nr!=="")return nr}return""}}function Tu(Gt,wt){var It;const Vt=Gt.substr(wt).match(/^\s+/);return(It=Vt&&Vt[0])!==null&&It!==void 0?It:""}function Mu(Gt,wt){var It;const Vt=Gt.substr(wt).match(/^[0-9]+/);return(It=Vt&&Vt[0])!==null&&It!==void 0?It:""}function $p(Gt,wt){const It=Gt.substr(wt,1);if(wt+=1,It.toLowerCase()!=="e")return"";const Vt=function(nr,gr){const Cr=Mu(nr,gr);if(Cr!=="")return Cr;const qr=nr.substr(gr,1);if(qr!=="-"&&qr!=="+")return"";const fn=Mu(nr,gr+=1);return fn===""?"":qr+fn}(Gt,wt);return Vt===""?"":It+Vt}function Iu(Gt,wt){const It=Gt.substr(wt,1);if(It==="0")return It;const Vt=function(nr,gr){const Cr=nr.substr(gr,1);return Cr.match(/^[1-9]$/)?Cr:""}(Gt,wt);return wt+=Vt.length,Vt===""?"":Vt+Mu(Gt,wt)}const op=ap([function(Gt,wt){const It=Iu(Gt,wt);if(wt+=It.length,It==="")return"";const Vt=Gt.substr(wt,1);if(wt+=Vt.length,Vt!==".")return"";const nr=Mu(Gt,wt);return It+Vt+nr+$p(Gt,wt+=nr.length)},function(Gt,wt){const It=Gt.substr(wt,1);if(wt+=It.length,It!==".")return"";const Vt=Mu(Gt,wt);return wt+=Vt.length,Vt===""?"":It+Vt+$p(Gt,wt)},function(Gt,wt){const It=Iu(Gt,wt);return wt+=It.length,It===""?"":It+$p(Gt,wt)}]),Xp=ap([function(Gt,wt){const It=Gt.substr(wt,2);if(wt+=It.length,It.toLowerCase()!=="0b")return"";const Vt=function(nr,gr){var Cr;const qr=nr.substr(gr).match(/^[01]+/);return(Cr=qr&&qr[0])!==null&&Cr!==void 0?Cr:""}(Gt,wt);return Vt===""?"":It+Vt},function(Gt,wt){const It=Gt.substr(wt,2);if(wt+=It.length,It.toLowerCase()!=="0o")return"";const Vt=function(nr,gr){var Cr;const qr=nr.substr(gr).match(/^[0-7]+/);return(Cr=qr&&qr[0])!==null&&Cr!==void 0?Cr:""}(Gt,wt);return Vt===""?"":It+Vt},function(Gt,wt){const It=Gt.substr(wt,2);if(wt+=It.length,It.toLowerCase()!=="0x")return"";const Vt=function(nr,gr){var Cr;const qr=nr.substr(gr).match(/^[0-9a-f]+/i);return(Cr=qr&&qr[0])!==null&&Cr!==void 0?Cr:""}(Gt,wt);return Vt===""?"":It+Vt}]),ou=ap([Xp,op]);function lu(Gt,wt){var It;return(It=function(Vt,nr){const gr=ou(Vt,nr);return nr+=gr.length,gr===""?null:{evaluable:new jm(gr),cursor:nr}}(Gt,wt))!==null&&It!==void 0?It:function(Vt,nr){const gr=Vt.substr(nr,1);if(nr+=gr.length,gr!=="(")return null;const Cr=Yp(Vt,nr);if(!Cr)return null;nr=Cr.cursor,nr+=Tu(Vt,nr).length;const qr=Vt.substr(nr,1);return nr+=qr.length,qr!==")"?null:{evaluable:Cr.evaluable,cursor:nr}}(Gt,wt)}function lp(Gt,wt,It){It+=Tu(wt,It).length;const Vt=Gt.filter(nr=>wt.startsWith(nr,It))[0];return Vt?(It+=Vt.length,{cursor:It+=Tu(wt,It).length,operator:Vt}):null}const Hm=[["**"],["*","/","%"],["+","-"],["<<",">>>",">>"],["&"],["^"],["|"]].reduce((Gt,wt)=>function(It,Vt){return(nr,gr)=>{const Cr=It(nr,gr);if(!Cr)return null;gr=Cr.cursor;let qr=Cr.evaluable;for(;;){const fn=lp(Vt,nr,gr);if(!fn)break;gr=fn.cursor;const Vn=It(nr,gr);if(!Vn)return null;gr=Vn.cursor,qr=new H_(fn.operator,qr,Vn.evaluable)}return qr?{cursor:gr,evaluable:qr}:null}}(Gt,wt),function Gt(wt,It){const Vt=lu(wt,It);if(Vt)return Vt;const nr=wt.substr(It,1);if(It+=nr.length,nr!=="+"&&nr!=="-"&&nr!=="~")return null;const gr=Gt(wt,It);return gr?{cursor:It=gr.cursor,evaluable:new Vm(nr,gr.evaluable)}:null});function Yp(Gt,wt){return wt+=Tu(Gt,wt).length,Hm(Gt,wt)}function Rl(Gt){var wt;const It=function(Vt){const nr=Yp(Vt,0);return nr?nr.cursor+Tu(Vt,nr.cursor).length!==Vt.length?null:nr.evaluable:null}(Gt);return(wt=It==null?void 0:It.evaluate())!==null&&wt!==void 0?wt:null}function Q_(Gt){if(typeof Gt=="number")return Gt;if(typeof Gt=="string"){const wt=Rl(Gt);if(!at(wt))return wt}return 0}function E0(Gt){return String(Gt)}function Ks(Gt){return wt=>wt.toFixed(Math.max(Math.min(Gt,20),0))}const Dl=Ks(0);function cp(Gt){return Dl(Gt)+"%"}function Qm(Gt){return String(Gt)}function xl(Gt){return Gt}function Ru({primary:Gt,secondary:wt,forward:It,backward:Vt}){let nr=!1;function gr(Cr){nr||(nr=!0,Cr(),nr=!1)}Gt.emitter.on("change",Cr=>{gr(()=>{wt.setRawValue(It(Gt,wt),Cr.options)})}),wt.emitter.on("change",Cr=>{gr(()=>{Gt.setRawValue(Vt(Gt,wt),Cr.options)}),gr(()=>{wt.setRawValue(It(Gt,wt),Cr.options)})}),gr(()=>{wt.setRawValue(It(Gt,wt),{forceEmit:!1,last:!0})})}function Ds(Gt,wt){const It=Gt*(wt.altKey?.1:1)*(wt.shiftKey?10:1);return wt.upKey?+It:wt.downKey?-It:0}function Ns(Gt){return{altKey:Gt.altKey,downKey:Gt.key==="ArrowDown",shiftKey:Gt.shiftKey,upKey:Gt.key==="ArrowUp"}}function qs(Gt){return{altKey:Gt.altKey,downKey:Gt.key==="ArrowLeft",shiftKey:Gt.shiftKey,upKey:Gt.key==="ArrowRight"}}function up(Gt){return function(wt){return wt==="ArrowUp"||wt==="ArrowDown"}(Gt)||Gt==="ArrowLeft"||Gt==="ArrowRight"}function cu(Gt,wt){var It,Vt;const nr=wt.ownerDocument.defaultView,gr=wt.getBoundingClientRect();return{x:Gt.pageX-(((It=nr&&nr.scrollX)!==null&&It!==void 0?It:0)+gr.left),y:Gt.pageY-(((Vt=nr&&nr.scrollY)!==null&&Vt!==void 0?Vt:0)+gr.top)}}class so{constructor(wt){this.lastTouch_=null,this.onDocumentMouseMove_=this.onDocumentMouseMove_.bind(this),this.onDocumentMouseUp_=this.onDocumentMouseUp_.bind(this),this.onMouseDown_=this.onMouseDown_.bind(this),this.onTouchEnd_=this.onTouchEnd_.bind(this),this.onTouchMove_=this.onTouchMove_.bind(this),this.onTouchStart_=this.onTouchStart_.bind(this),this.elem_=wt,this.emitter=new At,wt.addEventListener("touchstart",this.onTouchStart_,{passive:!1}),wt.addEventListener("touchmove",this.onTouchMove_,{passive:!0}),wt.addEventListener("touchend",this.onTouchEnd_),wt.addEventListener("mousedown",this.onMouseDown_)}computePosition_(wt){const It=this.elem_.getBoundingClientRect();return{bounds:{width:It.width,height:It.height},point:wt?{x:wt.x,y:wt.y}:null}}onMouseDown_(wt){var It;wt.preventDefault(),(It=wt.currentTarget)===null||It===void 0||It.focus();const Vt=this.elem_.ownerDocument;Vt.addEventListener("mousemove",this.onDocumentMouseMove_),Vt.addEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("down",{altKey:wt.altKey,data:this.computePosition_(cu(wt,this.elem_)),sender:this,shiftKey:wt.shiftKey})}onDocumentMouseMove_(wt){this.emitter.emit("move",{altKey:wt.altKey,data:this.computePosition_(cu(wt,this.elem_)),sender:this,shiftKey:wt.shiftKey})}onDocumentMouseUp_(wt){const It=this.elem_.ownerDocument;It.removeEventListener("mousemove",this.onDocumentMouseMove_),It.removeEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("up",{altKey:wt.altKey,data:this.computePosition_(cu(wt,this.elem_)),sender:this,shiftKey:wt.shiftKey})}onTouchStart_(wt){wt.preventDefault();const It=wt.targetTouches.item(0),Vt=this.elem_.getBoundingClientRect();this.emitter.emit("down",{altKey:wt.altKey,data:this.computePosition_(It?{x:It.clientX-Vt.left,y:It.clientY-Vt.top}:void 0),sender:this,shiftKey:wt.shiftKey}),this.lastTouch_=It}onTouchMove_(wt){const It=wt.targetTouches.item(0),Vt=this.elem_.getBoundingClientRect();this.emitter.emit("move",{altKey:wt.altKey,data:this.computePosition_(It?{x:It.clientX-Vt.left,y:It.clientY-Vt.top}:void 0),sender:this,shiftKey:wt.shiftKey}),this.lastTouch_=It}onTouchEnd_(wt){var It;const Vt=(It=wt.targetTouches.item(0))!==null&&It!==void 0?It:this.lastTouch_,nr=this.elem_.getBoundingClientRect();this.emitter.emit("up",{altKey:wt.altKey,data:this.computePosition_(Vt?{x:Vt.clientX-nr.left,y:Vt.clientY-nr.top}:void 0),sender:this,shiftKey:wt.shiftKey})}}function Bs(Gt,wt,It,Vt,nr){return Vt+(Gt-wt)/(It-wt)*(nr-Vt)}function Fs(Gt){return String(Gt.toFixed(10)).split(".")[1].replace(/0+$/,"").length}function Hs(Gt,wt,It){return Math.min(Math.max(Gt,wt),It)}function ku(Gt,wt){return(Gt%wt+wt)%wt}const Uo=Et("txt");class Kp{constructor(wt,It){this.onChange_=this.onChange_.bind(this),this.props_=It.props,this.props_.emitter.on("change",this.onChange_),this.element=wt.createElement("div"),this.element.classList.add(Uo(),Uo(void 0,"num")),It.arrayPosition&&this.element.classList.add(Uo(void 0,It.arrayPosition)),It.viewProps.bindClassModifiers(this.element);const Vt=wt.createElement("input");Vt.classList.add(Uo("i")),Vt.type="text",It.viewProps.bindDisabled(Vt),this.element.appendChild(Vt),this.inputElement=Vt,this.onDraggingChange_=this.onDraggingChange_.bind(this),this.dragging_=It.dragging,this.dragging_.emitter.on("change",this.onDraggingChange_),this.element.classList.add(Uo()),this.inputElement.classList.add(Uo("i"));const nr=wt.createElement("div");nr.classList.add(Uo("k")),this.element.appendChild(nr),this.knobElement=nr;const gr=wt.createElementNS(Rr,"svg");gr.classList.add(Uo("g")),this.knobElement.appendChild(gr);const Cr=wt.createElementNS(Rr,"path");Cr.classList.add(Uo("gb")),gr.appendChild(Cr),this.guideBodyElem_=Cr;const qr=wt.createElementNS(Rr,"path");qr.classList.add(Uo("gh")),gr.appendChild(qr),this.guideHeadElem_=qr;const fn=wt.createElement("div");fn.classList.add(Et("tt")()),this.knobElement.appendChild(fn),this.tooltipElem_=fn,It.value.emitter.on("change",this.onChange_),this.value=It.value,this.refresh()}onDraggingChange_(wt){if(wt.rawValue===null)return void this.element.classList.remove(Uo(void 0,"drg"));this.element.classList.add(Uo(void 0,"drg"));const It=wt.rawValue/this.props_.get("draggingScale"),Vt=It+(It>0?-1:It<0?1:0),nr=Hs(-Vt,-4,4);this.guideHeadElem_.setAttributeNS(null,"d",[`M ${Vt+nr},0 L${Vt},4 L${Vt+nr},8`,`M ${It},-1 L${It},9`].join(" ")),this.guideBodyElem_.setAttributeNS(null,"d",`M 0,4 L${It},4`);const gr=this.props_.get("formatter");this.tooltipElem_.textContent=gr(this.value.rawValue),this.tooltipElem_.style.left=`${It}px`}refresh(){const wt=this.props_.get("formatter");this.inputElement.value=wt(this.value.rawValue)}onChange_(){this.refresh()}}class pp{constructor(wt,It){var Vt;this.originRawValue_=0,this.onInputChange_=this.onInputChange_.bind(this),this.onInputKeyDown_=this.onInputKeyDown_.bind(this),this.onInputKeyUp_=this.onInputKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.baseStep_=It.baseStep,this.parser_=It.parser,this.props=It.props,this.sliderProps_=(Vt=It.sliderProps)!==null&&Vt!==void 0?Vt:null,this.value=It.value,this.viewProps=It.viewProps,this.dragging_=sr(null),this.view=new Kp(wt,{arrayPosition:It.arrayPosition,dragging:this.dragging_,props:this.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_),this.view.inputElement.addEventListener("keydown",this.onInputKeyDown_),this.view.inputElement.addEventListener("keyup",this.onInputKeyUp_);const nr=new so(this.view.knobElement);nr.emitter.on("down",this.onPointerDown_),nr.emitter.on("move",this.onPointerMove_),nr.emitter.on("up",this.onPointerUp_)}constrainValue_(wt){var It,Vt;const nr=(It=this.sliderProps_)===null||It===void 0?void 0:It.get("minValue"),gr=(Vt=this.sliderProps_)===null||Vt===void 0?void 0:Vt.get("maxValue");let Cr=wt;return nr!==void 0&&(Cr=Math.max(Cr,nr)),gr!==void 0&&(Cr=Math.min(Cr,gr)),Cr}onInputChange_(wt){const It=wt.currentTarget.value,Vt=this.parser_(It);at(Vt)||(this.value.rawValue=this.constrainValue_(Vt)),this.view.refresh()}onInputKeyDown_(wt){const It=Ds(this.baseStep_,Ns(wt));It!==0&&this.value.setRawValue(this.constrainValue_(this.value.rawValue+It),{forceEmit:!1,last:!1})}onInputKeyUp_(wt){Ds(this.baseStep_,Ns(wt))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}onPointerDown_(){this.originRawValue_=this.value.rawValue,this.dragging_.rawValue=0}computeDraggingValue_(wt){if(!wt.point)return null;const It=wt.point.x-wt.bounds.width/2;return this.constrainValue_(this.originRawValue_+It*this.props.get("draggingScale"))}onPointerMove_(wt){const It=this.computeDraggingValue_(wt.data);It!==null&&(this.value.setRawValue(It,{forceEmit:!1,last:!1}),this.dragging_.rawValue=this.value.rawValue-this.originRawValue_)}onPointerUp_(wt){const It=this.computeDraggingValue_(wt.data);It!==null&&(this.value.setRawValue(It,{forceEmit:!0,last:!0}),this.dragging_.rawValue=null)}}const Wm=Et("sld");class S0{constructor(wt,It){this.onChange_=this.onChange_.bind(this),this.props_=It.props,this.props_.emitter.on("change",this.onChange_),this.element=wt.createElement("div"),this.element.classList.add(Wm()),It.viewProps.bindClassModifiers(this.element);const Vt=wt.createElement("div");Vt.classList.add(Wm("t")),It.viewProps.bindTabIndex(Vt),this.element.appendChild(Vt),this.trackElement=Vt;const nr=wt.createElement("div");nr.classList.add(Wm("k")),this.trackElement.appendChild(nr),this.knobElement=nr,It.value.emitter.on("change",this.onChange_),this.value=It.value,this.update_()}update_(){const wt=Hs(Bs(this.value.rawValue,this.props_.get("minValue"),this.props_.get("maxValue"),0,100),0,100);this.knobElement.style.width=`${wt}%`}onChange_(){this.update_()}}class C0{constructor(wt,It){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDownOrMove_=this.onPointerDownOrMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.baseStep_=It.baseStep,this.value=It.value,this.viewProps=It.viewProps,this.props=It.props,this.view=new S0(wt,{props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new so(this.view.trackElement),this.ptHandler_.emitter.on("down",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("move",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.trackElement.addEventListener("keydown",this.onKeyDown_),this.view.trackElement.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(wt,It){wt.point&&this.value.setRawValue(Bs(Hs(wt.point.x,0,wt.bounds.width),0,wt.bounds.width,this.props.get("minValue"),this.props.get("maxValue")),It)}onPointerDownOrMove_(wt){this.handlePointerEvent_(wt.data,{forceEmit:!1,last:!1})}onPointerUp_(wt){this.handlePointerEvent_(wt.data,{forceEmit:!0,last:!0})}onKeyDown_(wt){const It=Ds(this.baseStep_,qs(wt));It!==0&&this.value.setRawValue(this.value.rawValue+It,{forceEmit:!1,last:!1})}onKeyUp_(wt){Ds(this.baseStep_,qs(wt))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const qm=Et("sldtxt");class P0{constructor(wt,It){this.element=wt.createElement("div"),this.element.classList.add(qm());const Vt=wt.createElement("div");Vt.classList.add(qm("s")),this.sliderView_=It.sliderView,Vt.appendChild(this.sliderView_.element),this.element.appendChild(Vt);const nr=wt.createElement("div");nr.classList.add(qm("t")),this.textView_=It.textView,nr.appendChild(this.textView_.element),this.element.appendChild(nr)}}class $m{constructor(wt,It){this.value=It.value,this.viewProps=It.viewProps,this.sliderC_=new C0(wt,{baseStep:It.baseStep,props:It.sliderProps,value:It.value,viewProps:this.viewProps}),this.textC_=new pp(wt,{baseStep:It.baseStep,parser:It.parser,props:It.textProps,sliderProps:It.sliderProps,value:It.value,viewProps:It.viewProps}),this.view=new P0(wt,{sliderView:this.sliderC_.view,textView:this.textC_.view})}get sliderController(){return this.sliderC_}get textController(){return this.textC_}}function hp(Gt,wt){Gt.write(wt)}function Jp(Gt){const wt=hr;return Array.isArray(Gt)?wt.required.array(wt.required.object({text:wt.required.string,value:wt.required.raw}))(Gt).value:typeof Gt=="object"?wt.required.raw(Gt).value:void 0}function W_(Gt){if(Gt==="inline"||Gt==="popup")return Gt}function Ql(Gt){const wt=hr;return wt.required.object({max:wt.optional.number,min:wt.optional.number,step:wt.optional.number})(Gt).value}function q_(Gt){if(Array.isArray(Gt))return Gt;const wt=[];return Object.keys(Gt).forEach(It=>{wt.push({text:It,value:Gt[It]})}),wt}function Xm(Gt){return at(Gt)?null:new su(q_(Gt))}function dp(Gt,wt){const It=Gt&&Qo(Gt,Cu);return It?Fs(It.step):Math.max(Fs(wt),2)}function uu(Gt){return function(It){const Vt=It?Qo(It,Cu):null;return Vt?Vt.step:null}(Gt)??1}function pu(Gt,wt){var It;const Vt=Gt&&Qo(Gt,Cu),nr=Math.abs((It=Vt==null?void 0:Vt.step)!==null&&It!==void 0?It:wt);return nr===0?.1:Math.pow(10,Math.floor(Math.log10(nr))-1)}const mp=Et("ckb");class $_{constructor(wt,It){this.onValueChange_=this.onValueChange_.bind(this),this.element=wt.createElement("div"),this.element.classList.add(mp()),It.viewProps.bindClassModifiers(this.element);const Vt=wt.createElement("label");Vt.classList.add(mp("l")),this.element.appendChild(Vt);const nr=wt.createElement("input");nr.classList.add(mp("i")),nr.type="checkbox",Vt.appendChild(nr),this.inputElement=nr,It.viewProps.bindDisabled(this.inputElement);const gr=wt.createElement("div");gr.classList.add(mp("w")),Vt.appendChild(gr);const Cr=yn(wt,"check");gr.appendChild(Cr),It.value.emitter.on("change",this.onValueChange_),this.value=It.value,this.update_()}update_(){this.inputElement.checked=this.value.rawValue}onValueChange_(){this.update_()}}class X_{constructor(wt,It){this.onInputChange_=this.onInputChange_.bind(this),this.value=It.value,this.viewProps=It.viewProps,this.view=new $_(wt,{value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(wt){const It=wt.currentTarget;this.value.rawValue=It.checked}}const Y_={id:"input-bool",type:"input",accept:(Gt,wt)=>{if(typeof Gt!="boolean")return null;const It=dr(wt,{options:hr.optional.custom(Jp)});return It?{initialValue:Gt,params:It}:null},binding:{reader:Gt=>qp,constraint:Gt=>function(wt){const It=[],Vt=Xm(wt.options);return Vt&&It.push(Vt),new nu(It)}(Gt.params),writer:Gt=>hp},controller:Gt=>{const wt=Gt.document,It=Gt.value,Vt=Gt.constraint,nr=Vt&&Qo(Vt,su);return nr?new au(wt,{props:new ir({options:nr.values.value("options")}),value:It,viewProps:Gt.viewProps}):new X_(wt,{value:It,viewProps:Gt.viewProps})}},Wl=Et("col");class K_{constructor(wt,It){this.element=wt.createElement("div"),this.element.classList.add(Wl()),It.foldable.bindExpandedClass(this.element,Wl(void 0,"expanded")),Dt(It.foldable,"completed",zt(this.element,Wl(void 0,"cpl")));const Vt=wt.createElement("div");Vt.classList.add(Wl("h")),this.element.appendChild(Vt);const nr=wt.createElement("div");nr.classList.add(Wl("s")),Vt.appendChild(nr),this.swatchElement=nr;const gr=wt.createElement("div");if(gr.classList.add(Wl("t")),Vt.appendChild(gr),this.textElement=gr,It.pickerLayout==="inline"){const Cr=wt.createElement("div");Cr.classList.add(Wl("p")),this.element.appendChild(Cr),this.pickerElement=Cr}else this.pickerElement=null}}function Du(Gt,wt,It){const Vt=ku(Gt,360),nr=Hs(wt/100,0,1),gr=Hs(It/100,0,1),Cr=gr*nr,qr=Cr*(1-Math.abs(Vt/60%2-1)),fn=gr-Cr;let Vn,ls,na;return[Vn,ls,na]=Vt>=0&&Vt<60?[Cr,qr,0]:Vt>=60&&Vt<120?[qr,Cr,0]:Vt>=120&&Vt<180?[0,Cr,qr]:Vt>=180&&Vt<240?[0,qr,Cr]:Vt>=240&&Vt<300?[qr,0,Cr]:[Cr,0,qr],[255*(Vn+fn),255*(ls+fn),255*(na+fn)]}function hu(Gt){return[Gt[0],Gt[1],Gt[2]]}function J_(Gt,wt){return[Gt[0],Gt[1],Gt[2],wt]}const T0={hsl:{hsl:(Gt,wt,It)=>[Gt,wt,It],hsv:function(Gt,wt,It){const Vt=It+wt*(100-Math.abs(2*It-100))/200;return[Gt,Vt!==0?wt*(100-Math.abs(2*It-100))/Vt:0,It+wt*(100-Math.abs(2*It-100))/200]},rgb:function(Gt,wt,It){const Vt=(Gt%360+360)%360,nr=Hs(wt/100,0,1),gr=Hs(It/100,0,1),Cr=(1-Math.abs(2*gr-1))*nr,qr=Cr*(1-Math.abs(Vt/60%2-1)),fn=gr-Cr/2;let Vn,ls,na;return[Vn,ls,na]=Vt>=0&&Vt<60?[Cr,qr,0]:Vt>=60&&Vt<120?[qr,Cr,0]:Vt>=120&&Vt<180?[0,Cr,qr]:Vt>=180&&Vt<240?[0,qr,Cr]:Vt>=240&&Vt<300?[qr,0,Cr]:[Cr,0,qr],[255*(Vn+fn),255*(ls+fn),255*(na+fn)]}},hsv:{hsl:function(Gt,wt,It){const Vt=100-Math.abs(It*(200-wt)/100-100);return[Gt,Vt!==0?wt*It/Vt:0,It*(200-wt)/200]},hsv:(Gt,wt,It)=>[Gt,wt,It],rgb:Du},rgb:{hsl:function(Gt,wt,It){const Vt=Hs(Gt/255,0,1),nr=Hs(wt/255,0,1),gr=Hs(It/255,0,1),Cr=Math.max(Vt,nr,gr),qr=Math.min(Vt,nr,gr),fn=Cr-qr;let Vn=0,ls=0;const na=(qr+Cr)/2;return fn!==0&&(ls=fn/(1-Math.abs(Cr+qr-1)),Vn=Vt===Cr?(nr-gr)/fn:nr===Cr?2+(gr-Vt)/fn:4+(Vt-nr)/fn,Vn=Vn/6+(Vn<0?1:0)),[360*Vn,100*ls,100*na]},hsv:function(Gt,wt,It){const Vt=Hs(Gt/255,0,1),nr=Hs(wt/255,0,1),gr=Hs(It/255,0,1),Cr=Math.max(Vt,nr,gr),qr=Cr-Math.min(Vt,nr,gr);let fn;return fn=qr===0?0:Cr===Vt?((nr-gr)/qr%6+6)%6*60:Cr===nr?60*((gr-Vt)/qr+2):60*((Vt-nr)/qr+4),[fn,100*(Cr===0?0:qr/Cr),100*Cr]},rgb:(Gt,wt,It)=>[Gt,wt,It]}};function Zp(Gt,wt){return[wt==="float"?1:Gt==="rgb"?255:360,wt==="float"?1:Gt==="rgb"?255:100,wt==="float"?1:Gt==="rgb"?255:100]}function M0(Gt,wt){return Gt===wt?wt:ku(Gt,wt)}function Z_(Gt,wt,It,Vt){const nr=Zp(wt,It),gr=Zp(wt,Vt);return Gt.map((Cr,qr)=>Cr/nr[qr]*gr[qr])}function _h(Gt,wt){return typeof Gt=="object"&&!at(Gt)&&wt in Gt&&typeof Gt[wt]=="number"}class _s{static black(wt="int"){return new _s([0,0,0],"rgb",wt)}static fromObject(wt,It="int"){const Vt="a"in wt?[wt.r,wt.g,wt.b,wt.a]:[wt.r,wt.g,wt.b];return new _s(Vt,"rgb",It)}static toRgbaObject(wt,It="int"){return wt.toRgbaObject(It)}static isRgbColorObject(wt){return _h(wt,"r")&&_h(wt,"g")&&_h(wt,"b")}static isRgbaColorObject(wt){return this.isRgbColorObject(wt)&&_h(wt,"a")}static isColorObject(wt){return this.isRgbColorObject(wt)}static equals(wt,It){if(wt.mode!==It.mode)return!1;const Vt=wt.comps_,nr=It.comps_;for(let gr=0;gr<Vt.length;gr++)if(Vt[gr]!==nr[gr])return!1;return!0}constructor(wt,It,Vt="int"){this.mode=It,this.type=Vt,this.comps_=function(nr,gr,Cr){var qr;const fn=Zp(gr,Cr);return[gr==="rgb"?Hs(nr[0],0,fn[0]):M0(nr[0],fn[0]),Hs(nr[1],0,fn[1]),Hs(nr[2],0,fn[2]),Hs((qr=nr[3])!==null&&qr!==void 0?qr:1,0,1)]}(wt,It,Vt)}getComponents(wt,It="int"){return J_(function(Vt,nr,gr){const Cr=Z_(Vt,nr.mode,nr.type,"int");return Z_(T0[nr.mode][gr.mode](...Cr),gr.mode,"int",gr.type)}(hu(this.comps_),{mode:this.mode,type:this.type},{mode:wt??this.mode,type:It}),this.comps_[3])}toRgbaObject(wt="int"){const It=this.getComponents("rgb",wt);return{r:It[0],g:It[1],b:It[2],a:It[3]}}}const $l=Et("colp");class Ym{constructor(wt,It){this.alphaViews_=null,this.element=wt.createElement("div"),this.element.classList.add($l()),It.viewProps.bindClassModifiers(this.element);const Vt=wt.createElement("div");Vt.classList.add($l("hsv"));const nr=wt.createElement("div");nr.classList.add($l("sv")),this.svPaletteView_=It.svPaletteView,nr.appendChild(this.svPaletteView_.element),Vt.appendChild(nr);const gr=wt.createElement("div");gr.classList.add($l("h")),this.hPaletteView_=It.hPaletteView,gr.appendChild(this.hPaletteView_.element),Vt.appendChild(gr),this.element.appendChild(Vt);const Cr=wt.createElement("div");if(Cr.classList.add($l("rgb")),this.textView_=It.textView,Cr.appendChild(this.textView_.element),this.element.appendChild(Cr),It.alphaViews){this.alphaViews_={palette:It.alphaViews.palette,text:It.alphaViews.text};const qr=wt.createElement("div");qr.classList.add($l("a"));const fn=wt.createElement("div");fn.classList.add($l("ap")),fn.appendChild(this.alphaViews_.palette.element),qr.appendChild(fn);const Vn=wt.createElement("div");Vn.classList.add($l("at")),Vn.appendChild(this.alphaViews_.text.element),qr.appendChild(Vn),this.element.appendChild(qr)}}get allFocusableElements(){const wt=[this.svPaletteView_.element,this.hPaletteView_.element,this.textView_.modeSelectElement,...this.textView_.textViews.map(It=>It.inputElement)];return this.alphaViews_&&wt.push(this.alphaViews_.palette.element,this.alphaViews_.text.inputElement),wt}}function _d(Gt){return Gt==="int"?"int":Gt==="float"?"float":void 0}function jo(Gt){const wt=hr;return dr(Gt,{alpha:wt.optional.boolean,color:wt.optional.object({alpha:wt.optional.boolean,type:wt.optional.custom(_d)}),expanded:wt.optional.boolean,picker:wt.optional.custom(W_)})}function Wo(Gt){return Gt?.1:1}function go(Gt){var wt;return(wt=Gt.color)===null||wt===void 0?void 0:wt.type}function Us(Gt,wt){const It=Gt.match(/^(.+)%$/);return Math.min(It?.01*parseFloat(It[1])*wt:parseFloat(Gt),wt)}const _f={deg:Gt=>Gt,grad:Gt=>360*Gt/400,rad:Gt=>360*Gt/(2*Math.PI),turn:Gt=>360*Gt};function Xl(Gt){const wt=Gt.match(/^([0-9.]+?)(deg|grad|rad|turn)$/);if(!wt)return parseFloat(Gt);const It=parseFloat(wt[1]),Vt=wt[2];return _f[Vt](It)}function du(Gt){const wt=Gt.match(/^rgb\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!wt)return null;const It=[Us(wt[1],255),Us(wt[2],255),Us(wt[3],255)];return isNaN(It[0])||isNaN(It[1])||isNaN(It[2])?null:It}function Ao(Gt){return wt=>{const It=du(wt);return It?new _s(It,"rgb",Gt):null}}function Qs(Gt){const wt=Gt.match(/^rgba\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!wt)return null;const It=[Us(wt[1],255),Us(wt[2],255),Us(wt[3],255),Us(wt[4],1)];return isNaN(It[0])||isNaN(It[1])||isNaN(It[2])||isNaN(It[3])?null:It}function em(Gt){return wt=>{const It=Qs(wt);return It?new _s(It,"rgb",Gt):null}}function Bu(Gt){const wt=Gt.match(/^hsl\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!wt)return null;const It=[Xl(wt[1]),Us(wt[2],100),Us(wt[3],100)];return isNaN(It[0])||isNaN(It[1])||isNaN(It[2])?null:It}function tm(Gt){return wt=>{const It=Bu(wt);return It?new _s(It,"hsl",Gt):null}}function Km(Gt){const wt=Gt.match(/^hsla\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!wt)return null;const It=[Xl(wt[1]),Us(wt[2],100),Us(wt[3],100),Us(wt[4],1)];return isNaN(It[0])||isNaN(It[1])||isNaN(It[2])||isNaN(It[3])?null:It}function gp(Gt){return wt=>{const It=Km(wt);return It?new _s(It,"hsl",Gt):null}}function _o(Gt){const wt=Gt.match(/^#([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(wt)return[parseInt(wt[1]+wt[1],16),parseInt(wt[2]+wt[2],16),parseInt(wt[3]+wt[3],16)];const It=Gt.match(/^(?:#|0x)([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return It?[parseInt(It[1],16),parseInt(It[2],16),parseInt(It[3],16)]:null}function ss(Gt){const wt=Gt.match(/^#?([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(wt)return[parseInt(wt[1]+wt[1],16),parseInt(wt[2]+wt[2],16),parseInt(wt[3]+wt[3],16),Bs(parseInt(wt[4]+wt[4],16),0,255,0,1)];const It=Gt.match(/^(?:#|0x)?([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return It?[parseInt(It[1],16),parseInt(It[2],16),parseInt(It[3],16),Bs(parseInt(It[4],16),0,255,0,1)]:null}function ev(Gt){const wt=Gt.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!wt)return null;const It=[parseFloat(wt[1]),parseFloat(wt[2]),parseFloat(wt[3])];return isNaN(It[0])||isNaN(It[1])||isNaN(It[2])?null:It}function mn(Gt){return wt=>{const It=ev(wt);return It?new _s(It,"rgb",Gt):null}}function os(Gt){const wt=Gt.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*a\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!wt)return null;const It=[parseFloat(wt[1]),parseFloat(wt[2]),parseFloat(wt[3]),parseFloat(wt[4])];return isNaN(It[0])||isNaN(It[1])||isNaN(It[2])||isNaN(It[3])?null:It}function rm(Gt){return wt=>{const It=os(wt);return It?new _s(It,"rgb",Gt):null}}const tv=[{parser:_o,result:{alpha:!1,mode:"rgb",notation:"hex"}},{parser:ss,result:{alpha:!0,mode:"rgb",notation:"hex"}},{parser:du,result:{alpha:!1,mode:"rgb",notation:"func"}},{parser:Qs,result:{alpha:!0,mode:"rgb",notation:"func"}},{parser:Bu,result:{alpha:!1,mode:"hsl",notation:"func"}},{parser:Km,result:{alpha:!0,mode:"hsl",notation:"func"}},{parser:ev,result:{alpha:!1,mode:"rgb",notation:"object"}},{parser:os,result:{alpha:!0,mode:"rgb",notation:"object"}}];function Jm(Gt,wt="int"){const It=function(Vt){return tv.reduce((nr,{parser:gr,result:Cr})=>nr||(gr(Vt)?Cr:null),null)}(Gt);return It?It.notation==="hex"&&wt!=="float"?Object.assign(Object.assign({},It),{type:"int"}):It.notation==="func"?Object.assign(Object.assign({},It),{type:wt}):null:null}const mu={int:[function(Gt){const wt=_o(Gt);return wt?new _s(wt,"rgb","int"):null},function(Gt){const wt=ss(Gt);return wt?new _s(wt,"rgb","int"):null},Ao("int"),em("int"),tm("int"),gp("int"),mn("int"),rm("int")],float:[Ao("float"),em("float"),tm("float"),gp("float"),mn("float"),rm("float")]};function gu(Gt){const wt=mu[Gt];return It=>wt.reduce((Vt,nr)=>Vt||nr(It),null)}function Zm(Gt){const wt=Hs(Math.floor(Gt),0,255).toString(16);return wt.length===1?`0${wt}`:wt}function _g(Gt,wt="#"){return`${wt}${hu(Gt.getComponents("rgb")).map(Zm).join("")}`}function _u(Gt,wt="#"){const It=Gt.getComponents("rgb");return`${wt}${[It[0],It[1],It[2],255*It[3]].map(Zm).join("")}`}function e_(Gt,wt){const It=Ks(wt==="float"?2:0);return`rgb(${hu(Gt.getComponents("rgb",wt)).map(Vt=>It(Vt)).join(", ")})`}function rv(Gt){return wt=>e_(wt,Gt)}function fu(Gt,wt){const It=Ks(2),Vt=Ks(wt==="float"?2:0);return`rgba(${Gt.getComponents("rgb",wt).map((nr,gr)=>(gr===3?It:Vt)(nr)).join(", ")})`}function I0(Gt){return wt=>fu(wt,Gt)}function Is(Gt,wt){const It=Ks(wt==="float"?2:0),Vt=["r","g","b"];return`{${hu(Gt.getComponents("rgb",wt)).map((nr,gr)=>`${Vt[gr]}: ${It(nr)}`).join(", ")}}`}function Lu(Gt){return wt=>Is(wt,Gt)}function im(Gt,wt){const It=Ks(2),Vt=Ks(wt==="float"?2:0),nr=["r","g","b","a"];return`{${Gt.getComponents("rgb",wt).map((gr,Cr)=>`${nr[Cr]}: ${(Cr===3?It:Vt)(gr)}`).join(", ")}}`}function Ou(Gt){return wt=>im(wt,Gt)}const t_=[{format:{alpha:!1,mode:"rgb",notation:"hex",type:"int"},stringifier:_g},{format:{alpha:!0,mode:"rgb",notation:"hex",type:"int"},stringifier:_u},{format:{alpha:!1,mode:"hsl",notation:"func",type:"int"},stringifier:function(Gt){const wt=[Ks(0),cp,cp];return`hsl(${hu(Gt.getComponents("hsl")).map((It,Vt)=>wt[Vt](It)).join(", ")})`}},{format:{alpha:!0,mode:"hsl",notation:"func",type:"int"},stringifier:function(Gt){const wt=[Ks(0),cp,cp,Ks(2)];return`hsla(${Gt.getComponents("hsl").map((It,Vt)=>wt[Vt](It)).join(", ")})`}},...["int","float"].reduce((Gt,wt)=>[...Gt,{format:{alpha:!1,mode:"rgb",notation:"func",type:wt},stringifier:rv(wt)},{format:{alpha:!0,mode:"rgb",notation:"func",type:wt},stringifier:I0(wt)},{format:{alpha:!1,mode:"rgb",notation:"object",type:wt},stringifier:Lu(wt)},{format:{alpha:!0,mode:"rgb",notation:"object",type:wt},stringifier:Ou(wt)}],[])];function r_(Gt){return t_.reduce((wt,It)=>{return wt||(Vt=It.format,nr=Gt,Vt.alpha===nr.alpha&&Vt.mode===nr.mode&&Vt.notation===nr.notation&&Vt.type===nr.type?It.stringifier:null);var Vt,nr},null)}const qo=Et("apl");class i_{constructor(wt,It){this.onValueChange_=this.onValueChange_.bind(this),this.value=It.value,this.value.emitter.on("change",this.onValueChange_),this.element=wt.createElement("div"),this.element.classList.add(qo()),It.viewProps.bindClassModifiers(this.element),It.viewProps.bindTabIndex(this.element);const Vt=wt.createElement("div");Vt.classList.add(qo("b")),this.element.appendChild(Vt);const nr=wt.createElement("div");nr.classList.add(qo("c")),Vt.appendChild(nr),this.colorElem_=nr;const gr=wt.createElement("div");gr.classList.add(qo("m")),this.element.appendChild(gr),this.markerElem_=gr;const Cr=wt.createElement("div");Cr.classList.add(qo("p")),this.markerElem_.appendChild(Cr),this.previewElem_=Cr,this.update_()}update_(){const wt=this.value.rawValue,It=wt.getComponents("rgb"),Vt=new _s([It[0],It[1],It[2],0],"rgb"),nr=new _s([It[0],It[1],It[2],255],"rgb"),gr=["to right",fu(Vt),fu(nr)];this.colorElem_.style.background=`linear-gradient(${gr.join(",")})`,this.previewElem_.style.backgroundColor=fu(wt);const Cr=Bs(It[3],0,1,0,100);this.markerElem_.style.left=`${Cr}%`}onValueChange_(){this.update_()}}class R0{constructor(wt,It){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=It.value,this.viewProps=It.viewProps,this.view=new i_(wt,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new so(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(wt,It){if(!wt.point)return;const Vt=wt.point.x/wt.bounds.width,nr=this.value.rawValue,[gr,Cr,qr]=nr.getComponents("hsv");this.value.setRawValue(new _s([gr,Cr,qr,Vt],"hsv"),It)}onPointerDown_(wt){this.handlePointerEvent_(wt.data,{forceEmit:!1,last:!1})}onPointerMove_(wt){this.handlePointerEvent_(wt.data,{forceEmit:!1,last:!1})}onPointerUp_(wt){this.handlePointerEvent_(wt.data,{forceEmit:!0,last:!0})}onKeyDown_(wt){const It=Ds(Wo(!0),qs(wt));if(It===0)return;const Vt=this.value.rawValue,[nr,gr,Cr,qr]=Vt.getComponents("hsv");this.value.setRawValue(new _s([nr,gr,Cr,qr+It],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(wt){Ds(Wo(!0),qs(wt))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const js=Et("coltxt");class Rs{constructor(wt,It){this.element=wt.createElement("div"),this.element.classList.add(js()),It.viewProps.bindClassModifiers(this.element);const Vt=wt.createElement("div");Vt.classList.add(js("m")),this.modeElem_=function(Cr){const qr=Cr.createElement("select");return qr.appendChild([{text:"RGB",value:"rgb"},{text:"HSL",value:"hsl"},{text:"HSV",value:"hsv"}].reduce((fn,Vn)=>{const ls=Cr.createElement("option");return ls.textContent=Vn.text,ls.value=Vn.value,fn.appendChild(ls),fn},Cr.createDocumentFragment())),qr}(wt),this.modeElem_.classList.add(js("ms")),Vt.appendChild(this.modeSelectElement),It.viewProps.bindDisabled(this.modeElem_);const nr=wt.createElement("div");nr.classList.add(js("mm")),nr.appendChild(yn(wt,"dropdown")),Vt.appendChild(nr),this.element.appendChild(Vt);const gr=wt.createElement("div");gr.classList.add(js("w")),this.element.appendChild(gr),this.textsElem_=gr,this.textViews_=It.textViews,this.applyTextViews_(),kt(It.colorMode,Cr=>{this.modeElem_.value=Cr})}get modeSelectElement(){return this.modeElem_}get textViews(){return this.textViews_}set textViews(wt){this.textViews_=wt,this.applyTextViews_()}applyTextViews_(){or(this.textsElem_);const wt=this.element.ownerDocument;this.textViews_.forEach(It=>{const Vt=wt.createElement("div");Vt.classList.add(js("c")),Vt.appendChild(It.element),this.textsElem_.appendChild(Vt)})}}function iv(Gt,wt,It){const Vt=Zp(Gt,wt)[It];return new Hl({min:0,max:Vt})}function wo(Gt,wt,It){return new pp(Gt,{arrayPosition:It===0?"fst":It===2?"lst":"mid",baseStep:Wo(!1),parser:wt.parser,props:ir.fromObject({draggingScale:wt.colorType==="float"?.01:1,formatter:(Vt=wt.colorType,Ks(Vt==="float"?2:0))}),value:sr(0,{constraint:iv(wt.colorMode,wt.colorType,It)}),viewProps:wt.viewProps});var Vt}class nm{constructor(wt,It){this.onModeSelectChange_=this.onModeSelectChange_.bind(this),this.colorType_=It.colorType,this.parser_=It.parser,this.value=It.value,this.viewProps=It.viewProps,this.colorMode=sr(this.value.rawValue.mode),this.ccs_=this.createComponentControllers_(wt),this.view=new Rs(wt,{colorMode:this.colorMode,textViews:[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view],viewProps:this.viewProps}),this.view.modeSelectElement.addEventListener("change",this.onModeSelectChange_)}createComponentControllers_(wt){const It={colorMode:this.colorMode.rawValue,colorType:this.colorType_,parser:this.parser_,viewProps:this.viewProps},Vt=[wo(wt,It,0),wo(wt,It,1),wo(wt,It,2)];return Vt.forEach((nr,gr)=>{Ru({primary:this.value,secondary:nr.value,forward:Cr=>Cr.rawValue.getComponents(this.colorMode.rawValue,this.colorType_)[gr],backward:(Cr,qr)=>{const fn=this.colorMode.rawValue,Vn=Cr.rawValue.getComponents(fn,this.colorType_);return Vn[gr]=qr.rawValue,new _s(J_(hu(Vn),Vn[3]),fn,this.colorType_)}})}),Vt}onModeSelectChange_(wt){const It=wt.currentTarget;this.colorMode.rawValue=It.value,this.ccs_=this.createComponentControllers_(this.view.element.ownerDocument),this.view.textViews=[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view]}}const n_=Et("hpl");class s_{constructor(wt,It){this.onValueChange_=this.onValueChange_.bind(this),this.value=It.value,this.value.emitter.on("change",this.onValueChange_),this.element=wt.createElement("div"),this.element.classList.add(n_()),It.viewProps.bindClassModifiers(this.element),It.viewProps.bindTabIndex(this.element);const Vt=wt.createElement("div");Vt.classList.add(n_("c")),this.element.appendChild(Vt);const nr=wt.createElement("div");nr.classList.add(n_("m")),this.element.appendChild(nr),this.markerElem_=nr,this.update_()}update_(){const wt=this.value.rawValue,[It]=wt.getComponents("hsv");this.markerElem_.style.backgroundColor=e_(new _s([It,100,100],"hsv"));const Vt=Bs(It,0,360,0,100);this.markerElem_.style.left=`${Vt}%`}onValueChange_(){this.update_()}}class k0{constructor(wt,It){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=It.value,this.viewProps=It.viewProps,this.view=new s_(wt,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new so(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(wt,It){if(!wt.point)return;const Vt=Bs(Hs(wt.point.x,0,wt.bounds.width),0,wt.bounds.width,0,360),nr=this.value.rawValue,[,gr,Cr,qr]=nr.getComponents("hsv");this.value.setRawValue(new _s([Vt,gr,Cr,qr],"hsv"),It)}onPointerDown_(wt){this.handlePointerEvent_(wt.data,{forceEmit:!1,last:!1})}onPointerMove_(wt){this.handlePointerEvent_(wt.data,{forceEmit:!1,last:!1})}onPointerUp_(wt){this.handlePointerEvent_(wt.data,{forceEmit:!0,last:!0})}onKeyDown_(wt){const It=Ds(Wo(!1),qs(wt));if(It===0)return;const Vt=this.value.rawValue,[nr,gr,Cr,qr]=Vt.getComponents("hsv");this.value.setRawValue(new _s([nr+It,gr,Cr,qr],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(wt){Ds(Wo(!1),qs(wt))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const a_=Et("svp");class Eo{constructor(wt,It){this.onValueChange_=this.onValueChange_.bind(this),this.value=It.value,this.value.emitter.on("change",this.onValueChange_),this.element=wt.createElement("div"),this.element.classList.add(a_()),It.viewProps.bindClassModifiers(this.element),It.viewProps.bindTabIndex(this.element);const Vt=wt.createElement("canvas");Vt.height=64,Vt.width=64,Vt.classList.add(a_("c")),this.element.appendChild(Vt),this.canvasElement=Vt;const nr=wt.createElement("div");nr.classList.add(a_("m")),this.element.appendChild(nr),this.markerElem_=nr,this.update_()}update_(){const wt=function(Vn){const ls=Vn.ownerDocument.defaultView;return ls&&"document"in ls?Vn.getContext("2d",{willReadFrequently:!0}):null}(this.canvasElement);if(!wt)return;const It=this.value.rawValue.getComponents("hsv"),Vt=this.canvasElement.width,nr=this.canvasElement.height,gr=wt.getImageData(0,0,Vt,nr),Cr=gr.data;for(let Vn=0;Vn<nr;Vn++)for(let ls=0;ls<Vt;ls++){const na=Bs(ls,0,Vt,0,100),yo=Bs(Vn,0,nr,100,0),So=Du(It[0],na,yo),On=4*(Vn*Vt+ls);Cr[On]=So[0],Cr[On+1]=So[1],Cr[On+2]=So[2],Cr[On+3]=255}wt.putImageData(gr,0,0);const qr=Bs(It[1],0,100,0,100);this.markerElem_.style.left=`${qr}%`;const fn=Bs(It[2],0,100,100,0);this.markerElem_.style.top=`${fn}%`}onValueChange_(){this.update_()}}class Sr{constructor(wt,It){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=It.value,this.viewProps=It.viewProps,this.view=new Eo(wt,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new so(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(wt,It){if(!wt.point)return;const Vt=Bs(wt.point.x,0,wt.bounds.width,0,100),nr=Bs(wt.point.y,0,wt.bounds.height,100,0),[gr,,,Cr]=this.value.rawValue.getComponents("hsv");this.value.setRawValue(new _s([gr,Vt,nr,Cr],"hsv"),It)}onPointerDown_(wt){this.handlePointerEvent_(wt.data,{forceEmit:!1,last:!1})}onPointerMove_(wt){this.handlePointerEvent_(wt.data,{forceEmit:!1,last:!1})}onPointerUp_(wt){this.handlePointerEvent_(wt.data,{forceEmit:!0,last:!0})}onKeyDown_(wt){up(wt.key)&&wt.preventDefault();const[It,Vt,nr,gr]=this.value.rawValue.getComponents("hsv"),Cr=Wo(!1),qr=Ds(Cr,qs(wt)),fn=Ds(Cr,Ns(wt));qr===0&&fn===0||this.value.setRawValue(new _s([It,Vt+qr,nr+fn,gr],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(wt){const It=Wo(!1),Vt=Ds(It,qs(wt)),nr=Ds(It,Ns(wt));Vt===0&&nr===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class o_{constructor(wt,It){this.value=It.value,this.viewProps=It.viewProps,this.hPaletteC_=new k0(wt,{value:this.value,viewProps:this.viewProps}),this.svPaletteC_=new Sr(wt,{value:this.value,viewProps:this.viewProps}),this.alphaIcs_=It.supportsAlpha?{palette:new R0(wt,{value:this.value,viewProps:this.viewProps}),text:new pp(wt,{parser:Rl,baseStep:.1,props:ir.fromObject({draggingScale:.01,formatter:Ks(2)}),value:sr(0,{constraint:new Hl({min:0,max:1})}),viewProps:this.viewProps})}:null,this.alphaIcs_&&Ru({primary:this.value,secondary:this.alphaIcs_.text.value,forward:Vt=>Vt.rawValue.getComponents()[3],backward:(Vt,nr)=>{const gr=Vt.rawValue.getComponents();return gr[3]=nr.rawValue,new _s(gr,Vt.rawValue.mode)}}),this.textC_=new nm(wt,{colorType:It.colorType,parser:Rl,value:this.value,viewProps:this.viewProps}),this.view=new Ym(wt,{alphaViews:this.alphaIcs_?{palette:this.alphaIcs_.palette.view,text:this.alphaIcs_.text.view}:null,hPaletteView:this.hPaletteC_.view,supportsAlpha:It.supportsAlpha,svPaletteView:this.svPaletteC_.view,textView:this.textC_.view,viewProps:this.viewProps})}get textController(){return this.textC_}}const sm=Et("colsw");class Al{constructor(wt,It){this.onValueChange_=this.onValueChange_.bind(this),It.value.emitter.on("change",this.onValueChange_),this.value=It.value,this.element=wt.createElement("div"),this.element.classList.add(sm()),It.viewProps.bindClassModifiers(this.element);const Vt=wt.createElement("div");Vt.classList.add(sm("sw")),this.element.appendChild(Vt),this.swatchElem_=Vt;const nr=wt.createElement("button");nr.classList.add(sm("b")),It.viewProps.bindDisabled(nr),this.element.appendChild(nr),this.buttonElement=nr,this.update_()}update_(){const wt=this.value.rawValue;this.swatchElem_.style.backgroundColor=_u(wt)}onValueChange_(){this.update_()}}class Bl{constructor(wt,It){this.value=It.value,this.viewProps=It.viewProps,this.view=new Al(wt,{value:this.value,viewProps:this.viewProps})}}class $o{constructor(wt,It){this.onButtonBlur_=this.onButtonBlur_.bind(this),this.onButtonClick_=this.onButtonClick_.bind(this),this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.value=It.value,this.viewProps=It.viewProps,this.foldable_=nn.create(It.expanded),this.swatchC_=new Bl(wt,{value:this.value,viewProps:this.viewProps});const Vt=this.swatchC_.view.buttonElement;Vt.addEventListener("blur",this.onButtonBlur_),Vt.addEventListener("click",this.onButtonClick_),this.textC_=new Pu(wt,{parser:It.parser,props:ir.fromObject({formatter:It.formatter}),value:this.value,viewProps:this.viewProps}),this.view=new K_(wt,{foldable:this.foldable_,pickerLayout:It.pickerLayout}),this.view.swatchElement.appendChild(this.swatchC_.view.element),this.view.textElement.appendChild(this.textC_.view.element),this.popC_=It.pickerLayout==="popup"?new Qp(wt,{viewProps:this.viewProps}):null;const nr=new o_(wt,{colorType:It.colorType,supportsAlpha:It.supportsAlpha,value:this.value,viewProps:this.viewProps});nr.view.allFocusableElements.forEach(gr=>{gr.addEventListener("blur",this.onPopupChildBlur_),gr.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=nr,this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(nr.view.element),Ru({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:gr=>gr.rawValue,backward:(gr,Cr)=>Cr.rawValue})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),xn(this.foldable_,this.view.pickerElement))}get textController(){return this.textC_}onButtonBlur_(wt){if(!this.popC_)return;const It=this.view.element,Vt=wt.relatedTarget;Vt&&It.contains(Vt)||(this.popC_.shows.rawValue=!1)}onButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(wt){if(!this.popC_)return;const It=this.popC_.view.element,Vt=yr(wt);Vt&&It.contains(Vt)||Vt&&Vt===this.swatchC_.view.buttonElement&&!Zr(It.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(wt){this.popC_?wt.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&wt.key==="Escape"&&this.swatchC_.view.buttonElement.focus()}}function Nu(Gt){return hu(Gt.getComponents("rgb")).reduce((wt,It)=>wt<<8|255&Math.floor(It),0)}function Fu(Gt){return Gt.getComponents("rgb").reduce((wt,It,Vt)=>wt<<8|255&Math.floor(Vt===3?255*It:It),0)>>>0}function Uu(Gt){return typeof Gt!="number"?_s.black():new _s([(wt=Gt)>>16&255,wt>>8&255,255&wt],"rgb");var wt}function ju(Gt){return typeof Gt!="number"?_s.black():new _s([(wt=Gt)>>24&255,wt>>16&255,wt>>8&255,Bs(255&wt,0,255,0,1)],"rgb");var wt}function wl(Gt){var wt;return!(!(Gt!=null&&Gt.alpha)&&!(!((wt=Gt==null?void 0:Gt.color)===null||wt===void 0)&&wt.alpha))}function Yl(Gt){return Gt?wt=>_u(wt,"0x"):wt=>_g(wt,"0x")}const vu={id:"input-color-number",type:"input",accept:(Gt,wt)=>{if(typeof Gt!="number"||!function(Vt){return"color"in Vt||"view"in Vt&&Vt.view==="color"}(wt))return null;const It=jo(wt);return It?{initialValue:Gt,params:It}:null},binding:{reader:Gt=>wl(Gt.params)?ju:Uu,equals:_s.equals,writer:Gt=>function(wt){const It=wt?Fu:Nu;return(Vt,nr)=>{hp(Vt,It(nr))}}(wl(Gt.params))},controller:Gt=>{const wt=wl(Gt.params),It="expanded"in Gt.params?Gt.params.expanded:void 0,Vt="picker"in Gt.params?Gt.params.picker:void 0;return new $o(Gt.document,{colorType:"int",expanded:It!=null&&It,formatter:Yl(wt),parser:gu("int"),pickerLayout:Vt??"popup",supportsAlpha:wt,value:Gt.value,viewProps:Gt.viewProps})}};function _p(Gt){return wt=>function(It,Vt){return _s.isColorObject(It)?_s.fromObject(It,Vt):_s.black(Vt)}(wt,Gt)}function am(Gt,wt){return It=>Gt?im(It,wt):Is(It,wt)}const om={id:"input-color-object",type:"input",accept:(Gt,wt)=>{if(!_s.isColorObject(Gt))return null;const It=jo(wt);return It?{initialValue:Gt,params:It}:null},binding:{reader:Gt=>_p(go(Gt.params)),equals:_s.equals,writer:Gt=>{return Vt=Gt.initialValue,wt=_s.isRgbaColorObject(Vt),It=go(Gt.params),(nr,gr)=>{wt?function(Cr,qr,fn){const Vn=qr.toRgbaObject(fn);Cr.writeProperty("r",Vn.r),Cr.writeProperty("g",Vn.g),Cr.writeProperty("b",Vn.b),Cr.writeProperty("a",Vn.a)}(nr,gr,It):function(Cr,qr,fn){const Vn=qr.toRgbaObject(fn);Cr.writeProperty("r",Vn.r),Cr.writeProperty("g",Vn.g),Cr.writeProperty("b",Vn.b)}(nr,gr,It)};var wt,It,Vt}},controller:Gt=>{var wt;const It=_s.isRgbaColorObject(Gt.initialValue),Vt="expanded"in Gt.params?Gt.params.expanded:void 0,nr="picker"in Gt.params?Gt.params.picker:void 0,gr=(wt=go(Gt.params))!==null&&wt!==void 0?wt:"int";return new $o(Gt.document,{colorType:gr,expanded:Vt!=null&&Vt,formatter:am(It,gr),parser:gu(gr),pickerLayout:nr??"popup",supportsAlpha:It,value:Gt.value,viewProps:Gt.viewProps})}},yu={id:"input-color-string",type:"input",accept:(Gt,wt)=>{if(typeof Gt!="string"||"view"in wt&&wt.view==="text")return null;const It=Jm(Gt,go(wt));if(!It||!r_(It))return null;const Vt=jo(wt);return Vt?{initialValue:Gt,params:Vt}:null},binding:{reader:Gt=>{var wt;return function(It){const Vt=mu[It];return nr=>typeof nr!="string"?_s.black(It):Vt.reduce((Cr,qr)=>Cr||qr(nr),null)??_s.black(It)}((wt=go(Gt.params))!==null&&wt!==void 0?wt:"int")},equals:_s.equals,writer:Gt=>{const wt=Jm(Gt.initialValue,go(Gt.params));if(!wt)throw ft.shouldNeverHappen();const It=function(Vt){const nr=r_(Vt);return nr?(gr,Cr)=>{hp(gr,nr(Cr))}:null}(wt);if(!It)throw ft.notBindable();return It}},controller:Gt=>{const wt=Jm(Gt.initialValue,go(Gt.params));if(!wt)throw ft.shouldNeverHappen();const It=r_(wt);if(!It)throw ft.shouldNeverHappen();const Vt="expanded"in Gt.params?Gt.params.expanded:void 0,nr="picker"in Gt.params?Gt.params.picker:void 0;return new $o(Gt.document,{colorType:wt.type,expanded:Vt!=null&&Vt,formatter:It,parser:gu(wt.type),pickerLayout:nr??"popup",supportsAlpha:wt.alpha,value:Gt.value,viewProps:Gt.viewProps})}};class El{constructor(wt){this.components=wt.components,this.asm_=wt.assembly}constrain(wt){const It=this.asm_.toComponents(wt).map((Vt,nr)=>{var gr,Cr;return(Cr=(gr=this.components[nr])===null||gr===void 0?void 0:gr.constrain(Vt))!==null&&Cr!==void 0?Cr:Vt});return this.asm_.fromComponents(It)}}const nv=Et("pndtxt");class fp{constructor(wt,It){this.textViews=It.textViews,this.element=wt.createElement("div"),this.element.classList.add(nv()),this.textViews.forEach(Vt=>{const nr=wt.createElement("div");nr.classList.add(nv("a")),nr.appendChild(Vt.element),this.element.appendChild(nr)})}}class vp{constructor(wt,It){this.value=It.value,this.viewProps=It.viewProps,this.acs_=It.axes.map((Vt,nr)=>function(gr,Cr,qr){return new pp(gr,{arrayPosition:qr===0?"fst":qr===Cr.axes.length-1?"lst":"mid",baseStep:Cr.axes[qr].baseStep,parser:Cr.parser,props:Cr.axes[qr].textProps,value:sr(0,{constraint:Cr.axes[qr].constraint}),viewProps:Cr.viewProps})}(wt,It,nr)),this.acs_.forEach((Vt,nr)=>{Ru({primary:this.value,secondary:Vt.value,forward:gr=>It.assembly.toComponents(gr.rawValue)[nr],backward:(gr,Cr)=>{const qr=It.assembly.toComponents(gr.rawValue);return qr[nr]=Cr.rawValue,It.assembly.fromComponents(qr)}})}),this.view=new fp(wt,{textViews:this.acs_.map(Vt=>Vt.view)})}}function Go(Gt,wt){return"step"in Gt&&!at(Gt.step)?new Cu(Gt.step,wt):null}function Sl(Gt){return at(Gt.max)||at(Gt.min)?at(Gt.max)&&at(Gt.min)?null:new Vp({max:Gt.max,min:Gt.min}):new Hl({max:Gt.max,min:Gt.min})}const l_={id:"input-number",type:"input",accept:(Gt,wt)=>{if(typeof Gt!="number")return null;const It=hr,Vt=dr(wt,{format:It.optional.function,max:It.optional.number,min:It.optional.number,options:It.optional.custom(Jp),step:It.optional.number});return Vt?{initialValue:Gt,params:Vt}:null},binding:{reader:Gt=>Q_,constraint:Gt=>function(wt,It){const Vt=[],nr=Go(wt,It);nr&&Vt.push(nr);const gr=Sl(wt);gr&&Vt.push(gr);const Cr=Xm(wt.options);return Cr&&Vt.push(Cr),new nu(Vt)}(Gt.params,Gt.initialValue),writer:Gt=>hp},controller:Gt=>{var wt;const It=Gt.value,Vt=Gt.constraint,nr=Vt&&Qo(Vt,su);if(nr)return new au(Gt.document,{props:new ir({options:nr.values.value("options")}),value:It,viewProps:Gt.viewProps});const gr=(wt="format"in Gt.params?Gt.params.format:void 0)!==null&&wt!==void 0?wt:Ks(dp(Vt,It.rawValue)),Cr=Vt&&Qo(Vt,Hl);return Cr?new $m(Gt.document,{baseStep:uu(Vt),parser:Rl,sliderProps:new ir({maxValue:Cr.values.value("max"),minValue:Cr.values.value("min")}),textProps:ir.fromObject({draggingScale:pu(Vt,It.rawValue),formatter:gr}),value:It,viewProps:Gt.viewProps}):new pp(Gt.document,{baseStep:uu(Vt),parser:Rl,props:ir.fromObject({draggingScale:pu(Vt,It.rawValue),formatter:gr}),value:It,viewProps:Gt.viewProps})}};class Xo{constructor(wt=0,It=0){this.x=wt,this.y=It}getComponents(){return[this.x,this.y]}static isObject(wt){if(at(wt))return!1;const It=wt.x,Vt=wt.y;return typeof It=="number"&&typeof Vt=="number"}static equals(wt,It){return wt.x===It.x&&wt.y===It.y}toObject(){return{x:this.x,y:this.y}}}const Ll={toComponents:Gt=>Gt.getComponents(),fromComponents:Gt=>new Xo(...Gt)},Kl=Et("p2d");class lm{constructor(wt,It){this.element=wt.createElement("div"),this.element.classList.add(Kl()),It.viewProps.bindClassModifiers(this.element),kt(It.expanded,zt(this.element,Kl(void 0,"expanded")));const Vt=wt.createElement("div");Vt.classList.add(Kl("h")),this.element.appendChild(Vt);const nr=wt.createElement("button");nr.classList.add(Kl("b")),nr.appendChild(yn(wt,"p2dpad")),It.viewProps.bindDisabled(nr),Vt.appendChild(nr),this.buttonElement=nr;const gr=wt.createElement("div");if(gr.classList.add(Kl("t")),Vt.appendChild(gr),this.textElement=gr,It.pickerLayout==="inline"){const Cr=wt.createElement("div");Cr.classList.add(Kl("p")),this.element.appendChild(Cr),this.pickerElement=Cr}else this.pickerElement=null}}const Cl=Et("p2dp");class Gu{constructor(wt,It){this.onFoldableChange_=this.onFoldableChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.invertsY_=It.invertsY,this.maxValue_=It.maxValue,this.element=wt.createElement("div"),this.element.classList.add(Cl()),It.layout==="popup"&&this.element.classList.add(Cl(void 0,"p")),It.viewProps.bindClassModifiers(this.element);const Vt=wt.createElement("div");Vt.classList.add(Cl("p")),It.viewProps.bindTabIndex(Vt),this.element.appendChild(Vt),this.padElement=Vt;const nr=wt.createElementNS(Rr,"svg");nr.classList.add(Cl("g")),this.padElement.appendChild(nr),this.svgElem_=nr;const gr=wt.createElementNS(Rr,"line");gr.classList.add(Cl("ax")),gr.setAttributeNS(null,"x1","0"),gr.setAttributeNS(null,"y1","50%"),gr.setAttributeNS(null,"x2","100%"),gr.setAttributeNS(null,"y2","50%"),this.svgElem_.appendChild(gr);const Cr=wt.createElementNS(Rr,"line");Cr.classList.add(Cl("ax")),Cr.setAttributeNS(null,"x1","50%"),Cr.setAttributeNS(null,"y1","0"),Cr.setAttributeNS(null,"x2","50%"),Cr.setAttributeNS(null,"y2","100%"),this.svgElem_.appendChild(Cr);const qr=wt.createElementNS(Rr,"line");qr.classList.add(Cl("l")),qr.setAttributeNS(null,"x1","50%"),qr.setAttributeNS(null,"y1","50%"),this.svgElem_.appendChild(qr),this.lineElem_=qr;const fn=wt.createElement("div");fn.classList.add(Cl("m")),this.padElement.appendChild(fn),this.markerElem_=fn,It.value.emitter.on("change",this.onValueChange_),this.value=It.value,this.update_()}get allFocusableElements(){return[this.padElement]}update_(){const[wt,It]=this.value.rawValue.getComponents(),Vt=this.maxValue_,nr=Bs(wt,-Vt,+Vt,0,100),gr=Bs(It,-Vt,+Vt,0,100),Cr=this.invertsY_?100-gr:gr;this.lineElem_.setAttributeNS(null,"x2",`${nr}%`),this.lineElem_.setAttributeNS(null,"y2",`${Cr}%`),this.markerElem_.style.left=`${nr}%`,this.markerElem_.style.top=`${Cr}%`}onValueChange_(){this.update_()}onFoldableChange_(){this.update_()}}function is(Gt,wt,It){return[Ds(wt[0],qs(Gt)),Ds(wt[1],Ns(Gt))*(It?1:-1)]}class zu{constructor(wt,It){this.onPadKeyDown_=this.onPadKeyDown_.bind(this),this.onPadKeyUp_=this.onPadKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=It.value,this.viewProps=It.viewProps,this.baseSteps_=It.baseSteps,this.maxValue_=It.maxValue,this.invertsY_=It.invertsY,this.view=new Gu(wt,{invertsY:this.invertsY_,layout:It.layout,maxValue:this.maxValue_,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new so(this.view.padElement),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.padElement.addEventListener("keydown",this.onPadKeyDown_),this.view.padElement.addEventListener("keyup",this.onPadKeyUp_)}handlePointerEvent_(wt,It){if(!wt.point)return;const Vt=this.maxValue_,nr=Bs(wt.point.x,0,wt.bounds.width,-Vt,+Vt),gr=Bs(this.invertsY_?wt.bounds.height-wt.point.y:wt.point.y,0,wt.bounds.height,-Vt,+Vt);this.value.setRawValue(new Xo(nr,gr),It)}onPointerDown_(wt){this.handlePointerEvent_(wt.data,{forceEmit:!1,last:!1})}onPointerMove_(wt){this.handlePointerEvent_(wt.data,{forceEmit:!1,last:!1})}onPointerUp_(wt){this.handlePointerEvent_(wt.data,{forceEmit:!0,last:!0})}onPadKeyDown_(wt){up(wt.key)&&wt.preventDefault();const[It,Vt]=is(wt,this.baseSteps_,this.invertsY_);It===0&&Vt===0||this.value.setRawValue(new Xo(this.value.rawValue.x+It,this.value.rawValue.y+Vt),{forceEmit:!1,last:!1})}onPadKeyUp_(wt){const[It,Vt]=is(wt,this.baseSteps_,this.invertsY_);It===0&&Vt===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class Yo{constructor(wt,It){var Vt,nr;this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.onPadButtonBlur_=this.onPadButtonBlur_.bind(this),this.onPadButtonClick_=this.onPadButtonClick_.bind(this),this.value=It.value,this.viewProps=It.viewProps,this.foldable_=nn.create(It.expanded),this.popC_=It.pickerLayout==="popup"?new Qp(wt,{viewProps:this.viewProps}):null;const gr=new zu(wt,{baseSteps:[It.axes[0].baseStep,It.axes[1].baseStep],invertsY:It.invertsY,layout:It.pickerLayout,maxValue:It.maxValue,value:this.value,viewProps:this.viewProps});gr.view.allFocusableElements.forEach(Cr=>{Cr.addEventListener("blur",this.onPopupChildBlur_),Cr.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=gr,this.textC_=new vp(wt,{assembly:Ll,axes:It.axes,parser:It.parser,value:this.value,viewProps:this.viewProps}),this.view=new lm(wt,{expanded:this.foldable_.value("expanded"),pickerLayout:It.pickerLayout,viewProps:this.viewProps}),this.view.textElement.appendChild(this.textC_.view.element),(Vt=this.view.buttonElement)===null||Vt===void 0||Vt.addEventListener("blur",this.onPadButtonBlur_),(nr=this.view.buttonElement)===null||nr===void 0||nr.addEventListener("click",this.onPadButtonClick_),this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(this.pickerC_.view.element),Ru({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:Cr=>Cr.rawValue,backward:(Cr,qr)=>qr.rawValue})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),xn(this.foldable_,this.view.pickerElement))}onPadButtonBlur_(wt){if(!this.popC_)return;const It=this.view.element,Vt=wt.relatedTarget;Vt&&It.contains(Vt)||(this.popC_.shows.rawValue=!1)}onPadButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(wt){if(!this.popC_)return;const It=this.popC_.view.element,Vt=yr(wt);Vt&&It.contains(Vt)||Vt&&Vt===this.view.buttonElement&&!Zr(It.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(wt){this.popC_?wt.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&wt.key==="Escape"&&this.view.buttonElement.focus()}}class Vu{constructor(wt=0,It=0,Vt=0){this.x=wt,this.y=It,this.z=Vt}getComponents(){return[this.x,this.y,this.z]}static isObject(wt){if(at(wt))return!1;const It=wt.x,Vt=wt.y,nr=wt.z;return typeof It=="number"&&typeof Vt=="number"&&typeof nr=="number"}static equals(wt,It){return wt.x===It.x&&wt.y===It.y&&wt.z===It.z}toObject(){return{x:this.x,y:this.y,z:this.z}}}const sv={toComponents:Gt=>Gt.getComponents(),fromComponents:Gt=>new Vu(...Gt)};function Jl(Gt){return Vu.isObject(Gt)?new Vu(Gt.x,Gt.y,Gt.z):new Vu}function cm(Gt,wt){Gt.writeProperty("x",wt.x),Gt.writeProperty("y",wt.y),Gt.writeProperty("z",wt.z)}function fo(Gt,wt){return{baseStep:uu(wt),constraint:wt,textProps:ir.fromObject({draggingScale:pu(wt,Gt),formatter:Ks(dp(wt,Gt))})}}const av={id:"input-point3d",type:"input",accept:(Gt,wt)=>{if(!Vu.isObject(Gt))return null;const It=hr,Vt=dr(wt,{x:It.optional.custom(Ql),y:It.optional.custom(Ql),z:It.optional.custom(Ql)});return Vt?{initialValue:Gt,params:Vt}:null},binding:{reader:Gt=>Jl,constraint:Gt=>{return wt=Gt.params,It=Gt.initialValue,new El({assembly:sv,components:[Ko("x"in wt?wt.x:void 0,It.x),Ko("y"in wt?wt.y:void 0,It.y),Ko("z"in wt?wt.z:void 0,It.z)]});var wt,It},equals:Vu.equals,writer:Gt=>cm},controller:Gt=>{const wt=Gt.value,It=Gt.constraint;if(!(It instanceof El))throw ft.shouldNeverHappen();return new vp(Gt.document,{assembly:sv,axes:[fo(wt.rawValue.x,It.components[0]),fo(wt.rawValue.y,It.components[1]),fo(wt.rawValue.z,It.components[2])],parser:Rl,value:wt,viewProps:Gt.viewProps})}};class bu{constructor(wt=0,It=0,Vt=0,nr=0){this.x=wt,this.y=It,this.z=Vt,this.w=nr}getComponents(){return[this.x,this.y,this.z,this.w]}static isObject(wt){if(at(wt))return!1;const It=wt.x,Vt=wt.y,nr=wt.z,gr=wt.w;return typeof It=="number"&&typeof Vt=="number"&&typeof nr=="number"&&typeof gr=="number"}static equals(wt,It){return wt.x===It.x&&wt.y===It.y&&wt.z===It.z&&wt.w===It.w}toObject(){return{x:this.x,y:this.y,z:this.z,w:this.w}}}const Hu={toComponents:Gt=>Gt.getComponents(),fromComponents:Gt=>new bu(...Gt)};function um(Gt){return bu.isObject(Gt)?new bu(Gt.x,Gt.y,Gt.z,Gt.w):new bu}function D0(Gt,wt){Gt.writeProperty("x",wt.x),Gt.writeProperty("y",wt.y),Gt.writeProperty("z",wt.z),Gt.writeProperty("w",wt.w)}const ov={id:"input-point4d",type:"input",accept:(Gt,wt)=>{if(!bu.isObject(Gt))return null;const It=hr,Vt=dr(wt,{x:It.optional.custom(Ql),y:It.optional.custom(Ql),z:It.optional.custom(Ql),w:It.optional.custom(Ql)});return Vt?{initialValue:Gt,params:Vt}:null},binding:{reader:Gt=>um,constraint:Gt=>{return wt=Gt.params,It=Gt.initialValue,new El({assembly:Hu,components:[Ko("x"in wt?wt.x:void 0,It.x),Ko("y"in wt?wt.y:void 0,It.y),Ko("z"in wt?wt.z:void 0,It.z),Ko("w"in wt?wt.w:void 0,It.w)]});var wt,It},equals:bu.equals,writer:Gt=>D0},controller:Gt=>{const wt=Gt.value,It=Gt.constraint;if(!(It instanceof El))throw ft.shouldNeverHappen();return new vp(Gt.document,{assembly:Hu,axes:wt.rawValue.getComponents().map((Vt,nr)=>{return gr=Vt,{baseStep:uu(Cr=It.components[nr]),constraint:Cr,textProps:ir.fromObject({draggingScale:pu(Cr,gr),formatter:Ks(dp(Cr,gr))})};var gr,Cr}),parser:Rl,value:wt,viewProps:Gt.viewProps})}},Qu={id:"input-string",type:"input",accept:(Gt,wt)=>{if(typeof Gt!="string")return null;const It=dr(wt,{options:hr.optional.custom(Jp)});return It?{initialValue:Gt,params:It}:null},binding:{reader:Gt=>Qm,constraint:Gt=>function(wt){const It=[],Vt=Xm(wt.options);return Vt&&It.push(Vt),new nu(It)}(Gt.params),writer:Gt=>hp},controller:Gt=>{const wt=Gt.document,It=Gt.value,Vt=Gt.constraint,nr=Vt&&Qo(Vt,su);return nr?new au(wt,{props:new ir({options:nr.values.value("options")}),value:It,viewProps:Gt.viewProps}):new Pu(wt,{parser:gr=>gr,props:ir.fromObject({formatter:xl}),value:It,viewProps:Gt.viewProps})}},Ro={defaultInterval:200,defaultLineCount:3},yp=Et("mll");class bp{constructor(wt,It){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=It.formatter,this.element=wt.createElement("div"),this.element.classList.add(yp()),It.viewProps.bindClassModifiers(this.element);const Vt=wt.createElement("textarea");Vt.classList.add(yp("i")),Vt.style.height=`calc(var(--bld-us) * ${It.lineCount})`,Vt.readOnly=!0,It.viewProps.bindDisabled(Vt),this.element.appendChild(Vt),this.textareaElem_=Vt,It.value.emitter.on("change",this.onValueUpdate_),this.value=It.value,this.update_()}update_(){const wt=this.textareaElem_,It=wt.scrollTop===wt.scrollHeight-wt.clientHeight,Vt=[];this.value.rawValue.forEach(nr=>{nr!==void 0&&Vt.push(this.formatter_(nr))}),wt.textContent=Vt.join(`
`),It&&(wt.scrollTop=wt.scrollHeight)}onValueUpdate_(){this.update_()}}class c_{constructor(wt,It){this.value=It.value,this.viewProps=It.viewProps,this.view=new bp(wt,{formatter:It.formatter,lineCount:It.lineCount,value:this.value,viewProps:this.viewProps})}}const lv=Et("sgl");class cv{constructor(wt,It){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=It.formatter,this.element=wt.createElement("div"),this.element.classList.add(lv()),It.viewProps.bindClassModifiers(this.element);const Vt=wt.createElement("input");Vt.classList.add(lv("i")),Vt.readOnly=!0,Vt.type="text",It.viewProps.bindDisabled(Vt),this.element.appendChild(Vt),this.inputElement=Vt,It.value.emitter.on("change",this.onValueUpdate_),this.value=It.value,this.update_()}update_(){const wt=this.value.rawValue,It=wt[wt.length-1];this.inputElement.value=It!==void 0?this.formatter_(It):""}onValueUpdate_(){this.update_()}}class pm{constructor(wt,It){this.value=It.value,this.viewProps=It.viewProps,this.view=new cv(wt,{formatter:It.formatter,value:this.value,viewProps:this.viewProps})}}const uv={id:"monitor-bool",type:"monitor",accept:(Gt,wt)=>{if(typeof Gt!="boolean")return null;const It=dr(wt,{lineCount:hr.optional.number});return It?{initialValue:Gt,params:It}:null},binding:{reader:Gt=>qp},controller:Gt=>{var wt;return Gt.value.rawValue.length===1?new pm(Gt.document,{formatter:sp,value:Gt.value,viewProps:Gt.viewProps}):new c_(Gt.document,{formatter:sp,lineCount:(wt=Gt.params.lineCount)!==null&&wt!==void 0?wt:Ro.defaultLineCount,value:Gt.value,viewProps:Gt.viewProps})}},Zl=Et("grl");class B0{constructor(wt,It){this.onCursorChange_=this.onCursorChange_.bind(this),this.onValueUpdate_=this.onValueUpdate_.bind(this),this.element=wt.createElement("div"),this.element.classList.add(Zl()),It.viewProps.bindClassModifiers(this.element),this.formatter_=It.formatter,this.props_=It.props,this.cursor_=It.cursor,this.cursor_.emitter.on("change",this.onCursorChange_);const Vt=wt.createElementNS(Rr,"svg");Vt.classList.add(Zl("g")),Vt.style.height=`calc(var(--bld-us) * ${It.lineCount})`,this.element.appendChild(Vt),this.svgElem_=Vt;const nr=wt.createElementNS(Rr,"polyline");this.svgElem_.appendChild(nr),this.lineElem_=nr;const gr=wt.createElement("div");gr.classList.add(Zl("t"),Et("tt")()),this.element.appendChild(gr),this.tooltipElem_=gr,It.value.emitter.on("change",this.onValueUpdate_),this.value=It.value,this.update_()}get graphElement(){return this.svgElem_}update_(){const wt=this.svgElem_.getBoundingClientRect(),It=this.value.rawValue.length-1,Vt=this.props_.get("minValue"),nr=this.props_.get("maxValue"),gr=[];this.value.rawValue.forEach((ls,na)=>{if(ls===void 0)return;const yo=Bs(na,0,It,0,wt.width),So=Bs(ls,Vt,nr,wt.height,0);gr.push([yo,So].join(","))}),this.lineElem_.setAttributeNS(null,"points",gr.join(" "));const Cr=this.tooltipElem_,qr=this.value.rawValue[this.cursor_.rawValue];if(qr===void 0)return void Cr.classList.remove(Zl("t","a"));const fn=Bs(this.cursor_.rawValue,0,It,0,wt.width),Vn=Bs(qr,Vt,nr,wt.height,0);Cr.style.left=`${fn}px`,Cr.style.top=`${Vn}px`,Cr.textContent=`${this.formatter_(qr)}`,Cr.classList.contains(Zl("t","a"))||(Cr.classList.add(Zl("t","a"),Zl("t","in")),Yr(Cr),Cr.classList.remove(Zl("t","in")))}onValueUpdate_(){this.update_()}onCursorChange_(){this.update_()}}class Cs{constructor(wt,It){if(this.onGraphMouseMove_=this.onGraphMouseMove_.bind(this),this.onGraphMouseLeave_=this.onGraphMouseLeave_.bind(this),this.onGraphPointerDown_=this.onGraphPointerDown_.bind(this),this.onGraphPointerMove_=this.onGraphPointerMove_.bind(this),this.onGraphPointerUp_=this.onGraphPointerUp_.bind(this),this.props_=It.props,this.value=It.value,this.viewProps=It.viewProps,this.cursor_=sr(-1),this.view=new B0(wt,{cursor:this.cursor_,formatter:It.formatter,lineCount:It.lineCount,props:this.props_,value:this.value,viewProps:this.viewProps}),Zr(wt)){const Vt=new so(this.view.element);Vt.emitter.on("down",this.onGraphPointerDown_),Vt.emitter.on("move",this.onGraphPointerMove_),Vt.emitter.on("up",this.onGraphPointerUp_)}else this.view.element.addEventListener("mousemove",this.onGraphMouseMove_),this.view.element.addEventListener("mouseleave",this.onGraphMouseLeave_)}onGraphMouseLeave_(){this.cursor_.rawValue=-1}onGraphMouseMove_(wt){const It=this.view.element.getBoundingClientRect();this.cursor_.rawValue=Math.floor(Bs(wt.offsetX,0,It.width,0,this.value.rawValue.length))}onGraphPointerDown_(wt){this.onGraphPointerMove_(wt)}onGraphPointerMove_(wt){wt.data.point?this.cursor_.rawValue=Math.floor(Bs(wt.data.point.x,0,wt.data.bounds.width,0,this.value.rawValue.length)):this.cursor_.rawValue=-1}onGraphPointerUp_(){this.cursor_.rawValue=-1}}function ko(Gt){return"format"in Gt&&!at(Gt.format)?Gt.format:Ks(2)}function Pl(Gt){return"view"in Gt&&Gt.view==="graph"}const u_={id:"monitor-number",type:"monitor",accept:(Gt,wt)=>{if(typeof Gt!="number")return null;const It=hr,Vt=dr(wt,{format:It.optional.function,lineCount:It.optional.number,max:It.optional.number,min:It.optional.number,view:It.optional.string});return Vt?{initialValue:Gt,params:Vt}:null},binding:{defaultBufferSize:Gt=>Pl(Gt)?64:1,reader:Gt=>Q_},controller:Gt=>Pl(Gt.params)?function(wt){var It,Vt,nr;return new Cs(wt.document,{formatter:ko(wt.params),lineCount:(It=wt.params.lineCount)!==null&&It!==void 0?It:Ro.defaultLineCount,props:ir.fromObject({maxValue:(Vt="max"in wt.params?wt.params.max:null)!==null&&Vt!==void 0?Vt:100,minValue:(nr="min"in wt.params?wt.params.min:null)!==null&&nr!==void 0?nr:0}),value:wt.value,viewProps:wt.viewProps})}(Gt):function(wt){var It;return wt.value.rawValue.length===1?new pm(wt.document,{formatter:ko(wt.params),value:wt.value,viewProps:wt.viewProps}):new c_(wt.document,{formatter:ko(wt.params),lineCount:(It=wt.params.lineCount)!==null&&It!==void 0?It:Ro.defaultLineCount,value:wt.value,viewProps:wt.viewProps})}(Gt)},Ol={id:"monitor-string",type:"monitor",accept:(Gt,wt)=>{if(typeof Gt!="string")return null;const It=hr,Vt=dr(wt,{lineCount:It.optional.number,multiline:It.optional.boolean});return Vt?{initialValue:Gt,params:Vt}:null},binding:{reader:Gt=>Qm},controller:Gt=>{var wt;const It=Gt.value;return It.rawValue.length>1||"multiline"in Gt.params&&Gt.params.multiline?new c_(Gt.document,{formatter:xl,lineCount:(wt=Gt.params.lineCount)!==null&&wt!==void 0?wt:Ro.defaultLineCount,value:It,viewProps:Gt.viewProps}):new pm(Gt.document,{formatter:xl,value:It,viewProps:Gt.viewProps})}};function Wu(Gt,wt){return wt===0?new jp:new Gp(Gt,wt??Ro.defaultInterval)}class qu{constructor(){this.pluginsMap_={blades:[],inputs:[],monitors:[]}}getAll(){return[...this.pluginsMap_.blades,...this.pluginsMap_.inputs,...this.pluginsMap_.monitors]}register(wt){wt.type==="blade"?this.pluginsMap_.blades.unshift(wt):wt.type==="input"?this.pluginsMap_.inputs.unshift(wt):wt.type==="monitor"&&this.pluginsMap_.monitors.unshift(wt)}createInput(wt,It,Vt){if(at(It.read()))throw new ft({context:{key:It.key},type:"nomatchingcontroller"});const nr=this.pluginsMap_.inputs.reduce((gr,Cr)=>gr??function(qr,fn){var Vn;const ls=qr.accept(fn.target.read(),fn.params);if(at(ls))return null;const na=hr,yo={target:fn.target,initialValue:ls.initialValue,params:ls.params},So=qr.binding.reader(yo),On=qr.binding.constraint?qr.binding.constraint(yo):void 0,g_=sr(So(ls.initialValue),{constraint:On,equals:qr.binding.equals}),gm=new Bm({reader:So,target:fn.target,value:g_,writer:qr.binding.writer(yo)}),Co=na.optional.boolean(fn.params.disabled).value,$u=na.optional.boolean(fn.params.hidden).value,Fl=qr.controller({constraint:On,document:fn.document,initialValue:ls.initialValue,params:ls.params,value:gm.value,viewProps:Dr.create({disabled:Co,hidden:$u})});return new Cn(fn.document,{binding:gm,blade:tn(),props:ir.fromObject({label:"label"in fn.params?(Vn=na.optional.string(fn.params.label).value)!==null&&Vn!==void 0?Vn:null:fn.target.key}),valueController:Fl})}(Cr,{document:wt,target:It,params:Vt}),null);if(nr)return nr;throw new ft({context:{key:It.key},type:"nomatchingcontroller"})}createMonitor(wt,It,Vt){const nr=this.pluginsMap_.monitors.reduce((gr,Cr)=>gr??function(qr,fn){var Vn,ls,na;const yo=hr,So=qr.accept(fn.target.read(),fn.params);if(at(So))return null;const On={target:fn.target,initialValue:So.initialValue,params:So.params},g_=qr.binding.reader(On),gm=(ls=(Vn=yo.optional.number(fn.params.bufferSize).value)!==null&&Vn!==void 0?Vn:qr.binding.defaultBufferSize&&qr.binding.defaultBufferSize(So.params))!==null&&ls!==void 0?ls:1,Co=yo.optional.number(fn.params.interval).value,$u=new V_({reader:g_,target:fn.target,ticker:Wu(fn.document,Co),value:Lm(gm)}),Fl=yo.optional.boolean(fn.params.disabled).value,Do=yo.optional.boolean(fn.params.hidden).value,xp=qr.controller({document:fn.document,params:So.params,value:$u.value,viewProps:Dr.create({disabled:Fl,hidden:Do})});return new En(fn.document,{binding:$u,blade:tn(),props:ir.fromObject({label:"label"in fn.params?(na=yo.optional.string(fn.params.label).value)!==null&&na!==void 0?na:null:fn.target.key}),valueController:xp})}(Cr,{document:wt,params:Vt,target:It}),null);if(nr)return nr;throw new ft({context:{key:It.key},type:"nomatchingcontroller"})}createBlade(wt,It){const Vt=this.pluginsMap_.blades.reduce((nr,gr)=>nr??function(Cr,qr){const fn=Cr.accept(qr.params);if(!fn)return null;const Vn=hr.optional.boolean(qr.params.disabled).value,ls=hr.optional.boolean(qr.params.hidden).value;return Cr.controller({blade:tn(),document:qr.document,params:Object.assign(Object.assign({},fn.params),{disabled:Vn,hidden:ls}),viewProps:Dr.create({disabled:Vn,hidden:ls})})}(gr,{document:wt,params:It}),null);if(!Vt)throw new ft({type:"nomatchingview",context:{params:It}});return Vt}createBladeApi(wt){if(wt instanceof Cn)return new vn(wt);if(wt instanceof En)return new rn(wt);if(wt instanceof to)return new Wn(wt,this);const It=this.pluginsMap_.blades.reduce((Vt,nr)=>Vt??nr.api({controller:wt,pool:this}),null);if(!It)throw ft.shouldNeverHappen();return It}}function pv(Gt){return Xo.isObject(Gt)?new Xo(Gt.x,Gt.y):new Xo}function p_(Gt,wt){Gt.writeProperty("x",wt.x),Gt.writeProperty("y",wt.y)}function Ko(Gt,wt){if(!Gt)return;const It=[],Vt=Go(Gt,wt);Vt&&It.push(Vt);const nr=Sl(Gt);return nr&&It.push(nr),new nu(It)}function hm(Gt,wt){const[It,Vt]=Gt?function(gr){const Cr=Qo(gr,Hl);if(Cr)return[Cr.values.get("min"),Cr.values.get("max")];const qr=Qo(gr,Vp);return qr?[qr.minValue,qr.maxValue]:[void 0,void 0]}(Gt):[];if(!at(It)||!at(Vt))return Math.max(Math.abs(It??0),Math.abs(Vt??0));const nr=uu(Gt);return Math.max(10*Math.abs(nr),10*Math.abs(wt))}function dm(Gt,wt){const It=wt instanceof El?wt.components[0]:void 0,Vt=wt instanceof El?wt.components[1]:void 0,nr=hm(It,Gt.x),gr=hm(Vt,Gt.y);return Math.max(nr,gr)}function vo(Gt,wt){return{baseStep:uu(wt),constraint:wt,textProps:ir.fromObject({draggingScale:pu(wt,Gt),formatter:Ks(dp(wt,Gt))})}}function L0(Gt){if(!("y"in Gt))return!1;const wt=Gt.y;return!!wt&&"inverted"in wt&&!!wt.inverted}const ao={id:"input-point2d",type:"input",accept:(Gt,wt)=>{if(!Xo.isObject(Gt))return null;const It=hr,Vt=dr(wt,{expanded:It.optional.boolean,picker:It.optional.custom(W_),x:It.optional.custom(Ql),y:It.optional.object({inverted:It.optional.boolean,max:It.optional.number,min:It.optional.number,step:It.optional.number})});return Vt?{initialValue:Gt,params:Vt}:null},binding:{reader:Gt=>pv,constraint:Gt=>{return wt=Gt.params,It=Gt.initialValue,new El({assembly:Ll,components:[Ko("x"in wt?wt.x:void 0,It.x),Ko("y"in wt?wt.y:void 0,It.y)]});var wt,It},equals:Xo.equals,writer:Gt=>p_},controller:Gt=>{const wt=Gt.document,It=Gt.value,Vt=Gt.constraint;if(!(Vt instanceof El))throw ft.shouldNeverHappen();const nr="expanded"in Gt.params?Gt.params.expanded:void 0,gr="picker"in Gt.params?Gt.params.picker:void 0;return new Yo(wt,{axes:[vo(It.rawValue.x,Vt.components[0]),vo(It.rawValue.y,Vt.components[1])],expanded:nr!=null&&nr,invertsY:L0(Gt.params),maxValue:dm(It.rawValue,Vt),parser:Rl,pickerLayout:gr??"popup",value:It,viewProps:Gt.viewProps})}};class h_ extends d{constructor(wt){super(wt),this.emitter_=new At,this.controller_.valueController.value.emitter.on("change",It=>{this.emitter_.emit("change",{event:new b(this,It.rawValue)})})}get label(){return this.controller_.props.get("label")}set label(wt){this.controller_.props.set("label",wt)}get options(){return this.controller_.valueController.props.get("options")}set options(wt){this.controller_.valueController.props.set("options",wt)}get value(){return this.controller_.valueController.value.rawValue}set value(wt){this.controller_.valueController.value.rawValue=wt}on(wt,It){const Vt=It.bind(this);return this.emitter_.on(wt,nr=>{Vt(nr.event)}),this}}class d_ extends d{constructor(wt){super(wt),this.emitter_=new At,this.controller_.valueController.value.emitter.on("change",It=>{this.emitter_.emit("change",{event:new b(this,It.rawValue)})})}get label(){return this.controller_.props.get("label")}set label(wt){this.controller_.props.set("label",wt)}get maxValue(){return this.controller_.valueController.sliderController.props.get("maxValue")}set maxValue(wt){this.controller_.valueController.sliderController.props.set("maxValue",wt)}get minValue(){return this.controller_.valueController.sliderController.props.get("minValue")}set minValue(wt){this.controller_.valueController.sliderController.props.set("minValue",wt)}get value(){return this.controller_.valueController.value.rawValue}set value(wt){this.controller_.valueController.value.rawValue=wt}on(wt,It){const Vt=It.bind(this);return this.emitter_.on(wt,nr=>{Vt(nr.event)}),this}}class Nl extends d{constructor(wt){super(wt),this.emitter_=new At,this.controller_.valueController.value.emitter.on("change",It=>{this.emitter_.emit("change",{event:new b(this,It.rawValue)})})}get label(){return this.controller_.props.get("label")}set label(wt){this.controller_.props.set("label",wt)}get formatter(){return this.controller_.valueController.props.get("formatter")}set formatter(wt){this.controller_.valueController.props.set("formatter",wt)}get value(){return this.controller_.valueController.value.rawValue}set value(wt){this.controller_.valueController.value.rawValue=wt}on(wt,It){const Vt=It.bind(this);return this.emitter_.on(wt,nr=>{Vt(nr.event)}),this}}const mm={id:"list",type:"blade",accept(Gt){const wt=hr,It=dr(Gt,{options:wt.required.custom(Jp),value:wt.required.raw,view:wt.required.constant("list"),label:wt.optional.string});return It?{params:It}:null},controller(Gt){const wt=new su(q_(Gt.params.options)),It=sr(Gt.params.value,{constraint:wt}),Vt=new au(Gt.document,{props:new ir({options:wt.values.value("options")}),value:It,viewProps:Gt.viewProps});return new xa(Gt.document,{blade:Gt.blade,props:ir.fromObject({label:Gt.params.label}),valueController:Vt})},api(Gt){return Gt.controller instanceof xa&&Gt.controller.valueController instanceof au?new h_(Gt.controller):null}};class m_ extends Gn{constructor(wt,It){super(wt,It)}get element(){return this.controller_.view.element}importPreset(wt){(function(It,Vt){It.forEach(nr=>{const gr=Vt[nr.target.presetKey];gr!==void 0&&nr.writer(nr.target,nr.reader(gr))})})(this.controller_.rackController.rack.find(Cn).map(It=>It.binding),wt),this.refresh()}exportPreset(){return this.controller_.rackController.rack.find(Cn).map(wt=>wt.binding.target).reduce((wt,It)=>Object.assign(wt,{[It.presetKey]:It.read()}),{})}refresh(){this.controller_.rackController.rack.find(Cn).forEach(wt=>{wt.binding.read()}),this.controller_.rackController.rack.find(En).forEach(wt=>{wt.binding.read()})}}class jn extends ho{constructor(wt,It){super(wt,{expanded:It.expanded,blade:It.blade,props:It.props,root:!0,viewProps:It.viewProps})}}const oo={id:"slider",type:"blade",accept(Gt){const wt=hr,It=dr(Gt,{max:wt.required.number,min:wt.required.number,view:wt.required.constant("slider"),format:wt.optional.function,label:wt.optional.string,value:wt.optional.number});return It?{params:It}:null},controller(Gt){var wt,It;const Vt=(wt=Gt.params.value)!==null&&wt!==void 0?wt:0,nr=new Hl({max:Gt.params.max,min:Gt.params.min}),gr=new $m(Gt.document,{baseStep:1,parser:Rl,sliderProps:new ir({maxValue:nr.values.value("max"),minValue:nr.values.value("min")}),textProps:ir.fromObject({draggingScale:pu(void 0,Vt),formatter:(It=Gt.params.format)!==null&&It!==void 0?It:E0}),value:sr(Vt,{constraint:nr}),viewProps:Gt.viewProps});return new xa(Gt.document,{blade:Gt.blade,props:ir.fromObject({label:Gt.params.label}),valueController:gr})},api(Gt){return Gt.controller instanceof xa&&Gt.controller.valueController instanceof $m?new d_(Gt.controller):null}},_c={id:"text",type:"blade",accept(Gt){const wt=hr,It=dr(Gt,{parse:wt.required.function,value:wt.required.raw,view:wt.required.constant("text"),format:wt.optional.function,label:wt.optional.string});return It?{params:It}:null},controller(Gt){var wt;const It=new Pu(Gt.document,{parser:Gt.params.parse,props:ir.fromObject({formatter:(wt=Gt.params.format)!==null&&wt!==void 0?wt:Vt=>String(Vt)}),value:sr(Gt.params.value),viewProps:Gt.viewProps});return new xa(Gt.document,{blade:Gt.blade,props:ir.fromObject({label:Gt.params.label}),valueController:It})},api(Gt){return Gt.controller instanceof xa&&Gt.controller.valueController instanceof Pu?new Nl(Gt.controller):null}};function Tl(Gt,wt,It){if(Gt.querySelector(`style[data-tp-style=${wt}]`))return;const Vt=Gt.createElement("style");Vt.dataset.tpStyle=wt,Vt.textContent=It,Gt.head.appendChild(Vt)}const O0=new class{constructor(Gt){const[wt,It]=Gt.split("-"),Vt=wt.split(".");this.major=parseInt(Vt[0],10),this.minor=parseInt(Vt[1],10),this.patch=parseInt(Vt[2],10),this.prerelease=It??null}toString(){const Gt=[this.major,this.minor,this.patch].join(".");return this.prerelease!==null?[Gt,this.prerelease].join("-"):Gt}}("3.1.10");c.BladeApi=d,c.ButtonApi=xt,c.FolderApi=Gn,c.InputBindingApi=vn,c.ListApi=h_,c.MonitorBindingApi=rn,c.Pane=class extends m_{constructor(Gt){var wt,It;const Vt=Gt??{},nr=(wt=Vt.document)!==null&&wt!==void 0?wt:cn(),gr=function(){const Cr=new qu;return[ao,av,ov,Qu,l_,yu,om,vu,Y_,uv,Ol,u_,Br,ro,no,ip].forEach(qr=>{Cr.register(qr)}),Cr}();super(new jn(nr,{expanded:Vt.expanded,blade:tn(),props:ir.fromObject({title:Vt.title}),viewProps:Dr.create()}),gr),this.pool_=gr,this.containerElem_=(It=Vt.container)!==null&&It!==void 0?It:function(Cr){const qr=Cr.createElement("div");return qr.classList.add(Et("dfw")()),Cr.body&&Cr.body.appendChild(qr),qr}(nr),this.containerElem_.appendChild(this.element),this.doc_=nr,this.usesDefaultWrapper_=!Vt.container,this.setUpDefaultPlugins_()}get document(){if(!this.doc_)throw ft.alreadyDisposed();return this.doc_}dispose(){const Gt=this.containerElem_;if(!Gt)throw ft.alreadyDisposed();if(this.usesDefaultWrapper_){const wt=Gt.parentElement;wt&&wt.removeChild(Gt)}this.containerElem_=null,this.doc_=null,super.dispose()}registerPlugin(Gt){("plugin"in Gt?[Gt.plugin]:"plugins"in Gt?Gt.plugins:[]).forEach(wt=>{this.pool_.register(wt),this.embedPluginStyle_(wt)})}embedPluginStyle_(Gt){Gt.css&&Tl(this.document,`plugin-${Gt.id}`,Gt.css)}setUpDefaultPlugins_(){Tl(this.document,"default",'.tp-tbiv_b,.tp-coltxtv_ms,.tp-ckbv_i,.tp-rotv_b,.tp-fldv_b,.tp-mllv_i,.tp-sglv_i,.tp-grlv_g,.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw,.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:rgba(0,0,0,0);border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{background-color:var(--btn-bg);border-radius:var(--elm-br);color:var(--btn-fg);cursor:pointer;display:block;font-weight:bold;height:var(--bld-us);line-height:var(--bld-us);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.tp-p2dv_b:hover,.tp-btnv_b:hover,.tp-lstv_s:hover{background-color:var(--btn-bg-h)}.tp-p2dv_b:focus,.tp-btnv_b:focus,.tp-lstv_s:focus{background-color:var(--btn-bg-f)}.tp-p2dv_b:active,.tp-btnv_b:active,.tp-lstv_s:active{background-color:var(--btn-bg-a)}.tp-p2dv_b:disabled,.tp-btnv_b:disabled,.tp-lstv_s:disabled{opacity:.5}.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw{background-color:var(--in-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--bld-us);line-height:var(--bld-us);min-width:0;width:100%}.tp-txtv_i:hover,.tp-p2dpv_p:hover,.tp-colswv_sw:hover{background-color:var(--in-bg-h)}.tp-txtv_i:focus,.tp-p2dpv_p:focus,.tp-colswv_sw:focus{background-color:var(--in-bg-f)}.tp-txtv_i:active,.tp-p2dpv_p:active,.tp-colswv_sw:active{background-color:var(--in-bg-a)}.tp-txtv_i:disabled,.tp-p2dpv_p:disabled,.tp-colswv_sw:disabled{opacity:.5}.tp-mllv_i,.tp-sglv_i,.tp-grlv_g{background-color:var(--mo-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--mo-fg);height:var(--bld-us);scrollbar-color:currentColor rgba(0,0,0,0);scrollbar-width:thin;width:100%}.tp-mllv_i::-webkit-scrollbar,.tp-sglv_i::-webkit-scrollbar,.tp-grlv_g::-webkit-scrollbar{height:8px;width:8px}.tp-mllv_i::-webkit-scrollbar-corner,.tp-sglv_i::-webkit-scrollbar-corner,.tp-grlv_g::-webkit-scrollbar-corner{background-color:rgba(0,0,0,0)}.tp-mllv_i::-webkit-scrollbar-thumb,.tp-sglv_i::-webkit-scrollbar-thumb,.tp-grlv_g::-webkit-scrollbar-thumb{background-clip:padding-box;background-color:currentColor;border:rgba(0,0,0,0) solid 2px;border-radius:4px}.tp-rotv{--font-family: var(--tp-font-family, Roboto Mono, Source Code Pro, Menlo, Courier, monospace);--bs-br: var(--tp-base-border-radius, 6px);--cnt-h-p: var(--tp-container-horizontal-padding, 4px);--cnt-v-p: var(--tp-container-vertical-padding, 4px);--elm-br: var(--tp-element-border-radius, 2px);--bld-s: var(--tp-blade-spacing, 4px);--bld-us: var(--tp-blade-unit-size, 20px);--bs-bg: var(--tp-base-background-color, hsl(230, 7%, 17%));--bs-sh: var(--tp-base-shadow-color, rgba(0, 0, 0, 0.2));--btn-bg: var(--tp-button-background-color, hsl(230, 7%, 70%));--btn-bg-a: var(--tp-button-background-color-active, #d6d7db);--btn-bg-f: var(--tp-button-background-color-focus, #c8cad0);--btn-bg-h: var(--tp-button-background-color-hover, #bbbcc4);--btn-fg: var(--tp-button-foreground-color, hsl(230, 7%, 17%));--cnt-bg: var(--tp-container-background-color, rgba(187, 188, 196, 0.1));--cnt-bg-a: var(--tp-container-background-color-active, rgba(187, 188, 196, 0.25));--cnt-bg-f: var(--tp-container-background-color-focus, rgba(187, 188, 196, 0.2));--cnt-bg-h: var(--tp-container-background-color-hover, rgba(187, 188, 196, 0.15));--cnt-fg: var(--tp-container-foreground-color, hsl(230, 7%, 75%));--in-bg: var(--tp-input-background-color, rgba(187, 188, 196, 0.1));--in-bg-a: var(--tp-input-background-color-active, rgba(187, 188, 196, 0.25));--in-bg-f: var(--tp-input-background-color-focus, rgba(187, 188, 196, 0.2));--in-bg-h: var(--tp-input-background-color-hover, rgba(187, 188, 196, 0.15));--in-fg: var(--tp-input-foreground-color, hsl(230, 7%, 75%));--lbl-fg: var(--tp-label-foreground-color, rgba(187, 188, 196, 0.7));--mo-bg: var(--tp-monitor-background-color, rgba(0, 0, 0, 0.2));--mo-fg: var(--tp-monitor-foreground-color, rgba(187, 188, 196, 0.7));--grv-fg: var(--tp-groove-foreground-color, rgba(187, 188, 196, 0.1))}.tp-rotv_c>.tp-cntv.tp-v-lst,.tp-tabv_c .tp-brkv>.tp-cntv.tp-v-lst,.tp-fldv_c>.tp-cntv.tp-v-lst{margin-bottom:calc(-1*var(--cnt-v-p))}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-tabv_c .tp-brkv>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_c{border-bottom-left-radius:0}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-tabv_c .tp-brkv>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_b{border-bottom-left-radius:0}.tp-rotv_c>*:not(.tp-v-fst),.tp-tabv_c .tp-brkv>*:not(.tp-v-fst),.tp-fldv_c>*:not(.tp-v-fst){margin-top:var(--bld-s)}.tp-rotv_c>.tp-sprv:not(.tp-v-fst),.tp-tabv_c .tp-brkv>.tp-sprv:not(.tp-v-fst),.tp-fldv_c>.tp-sprv:not(.tp-v-fst),.tp-rotv_c>.tp-cntv:not(.tp-v-fst),.tp-tabv_c .tp-brkv>.tp-cntv:not(.tp-v-fst),.tp-fldv_c>.tp-cntv:not(.tp-v-fst){margin-top:var(--cnt-v-p)}.tp-rotv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-tabv_c .tp-brkv>.tp-sprv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-rotv_c>.tp-cntv+*:not(.tp-v-hidden),.tp-tabv_c .tp-brkv>.tp-cntv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-cntv+*:not(.tp-v-hidden){margin-top:var(--cnt-v-p)}.tp-rotv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-tabv_c .tp-brkv>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-fldv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-rotv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-tabv_c .tp-brkv>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-fldv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv{margin-top:0}.tp-tabv_c .tp-brkv>.tp-cntv,.tp-fldv_c>.tp-cntv{margin-left:4px}.tp-tabv_c .tp-brkv>.tp-fldv>.tp-fldv_b,.tp-fldv_c>.tp-fldv>.tp-fldv_b{border-top-left-radius:var(--elm-br);border-bottom-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv>.tp-fldv.tp-fldv-expanded>.tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-fldv-expanded>.tp-fldv_b{border-bottom-left-radius:0}.tp-tabv_c .tp-brkv .tp-fldv>.tp-fldv_c,.tp-fldv_c .tp-fldv>.tp-fldv_c{border-bottom-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv>.tp-cntv+.tp-fldv>.tp-fldv_b,.tp-fldv_c>.tp-cntv+.tp-fldv>.tp-fldv_b{border-top-left-radius:0}.tp-tabv_c .tp-brkv>.tp-cntv+.tp-tabv>.tp-tabv_t,.tp-fldv_c>.tp-cntv+.tp-tabv>.tp-tabv_t{border-top-left-radius:0}.tp-tabv_c .tp-brkv>.tp-tabv>.tp-tabv_t,.tp-fldv_c>.tp-tabv>.tp-tabv_t{border-top-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv .tp-tabv>.tp-tabv_c,.tp-fldv_c .tp-tabv>.tp-tabv_c{border-bottom-left-radius:var(--elm-br)}.tp-rotv_b,.tp-fldv_b{background-color:var(--cnt-bg);color:var(--cnt-fg);cursor:pointer;display:block;height:calc(var(--bld-us) + 4px);line-height:calc(var(--bld-us) + 4px);overflow:hidden;padding-left:var(--cnt-h-p);padding-right:calc(4px + var(--bld-us) + var(--cnt-h-p));position:relative;text-align:left;text-overflow:ellipsis;white-space:nowrap;width:100%;transition:border-radius .2s ease-in-out .2s}.tp-rotv_b:hover,.tp-fldv_b:hover{background-color:var(--cnt-bg-h)}.tp-rotv_b:focus,.tp-fldv_b:focus{background-color:var(--cnt-bg-f)}.tp-rotv_b:active,.tp-fldv_b:active{background-color:var(--cnt-bg-a)}.tp-rotv_b:disabled,.tp-fldv_b:disabled{opacity:.5}.tp-rotv_m,.tp-fldv_m{background:linear-gradient(to left, var(--cnt-fg), var(--cnt-fg) 2px, transparent 2px, transparent 4px, var(--cnt-fg) 4px);border-radius:2px;bottom:0;content:"";display:block;height:6px;right:calc(var(--cnt-h-p) + (var(--bld-us) + 4px - 6px)/2 - 2px);margin:auto;opacity:.5;position:absolute;top:0;transform:rotate(90deg);transition:transform .2s ease-in-out;width:6px}.tp-rotv.tp-rotv-expanded .tp-rotv_m,.tp-fldv.tp-fldv-expanded>.tp-fldv_b>.tp-fldv_m{transform:none}.tp-rotv_c,.tp-fldv_c{box-sizing:border-box;height:0;opacity:0;overflow:hidden;padding-bottom:0;padding-top:0;position:relative;transition:height .2s ease-in-out,opacity .2s linear,padding .2s ease-in-out}.tp-rotv.tp-rotv-cpl:not(.tp-rotv-expanded) .tp-rotv_c,.tp-fldv.tp-fldv-cpl:not(.tp-fldv-expanded)>.tp-fldv_c{display:none}.tp-rotv.tp-rotv-expanded .tp-rotv_c,.tp-fldv.tp-fldv-expanded>.tp-fldv_c{opacity:1;padding-bottom:var(--cnt-v-p);padding-top:var(--cnt-v-p);transform:none;overflow:visible;transition:height .2s ease-in-out,opacity .2s linear .2s,padding .2s ease-in-out}.tp-lstv,.tp-coltxtv_m{position:relative}.tp-lstv_s{padding:0 20px 0 4px;width:100%}.tp-lstv_m,.tp-coltxtv_mm{bottom:0;margin:auto;pointer-events:none;position:absolute;right:2px;top:0}.tp-lstv_m svg,.tp-coltxtv_mm svg{bottom:0;height:16px;margin:auto;position:absolute;right:0;top:0;width:16px}.tp-lstv_m svg path,.tp-coltxtv_mm svg path{fill:currentColor}.tp-pndtxtv,.tp-coltxtv_w{display:flex}.tp-pndtxtv_a,.tp-coltxtv_c{width:100%}.tp-pndtxtv_a+.tp-pndtxtv_a,.tp-coltxtv_c+.tp-pndtxtv_a,.tp-pndtxtv_a+.tp-coltxtv_c,.tp-coltxtv_c+.tp-coltxtv_c{margin-left:2px}.tp-btnv_b{width:100%}.tp-btnv_t{text-align:center}.tp-ckbv_l{display:block;position:relative}.tp-ckbv_i{left:0;opacity:0;position:absolute;top:0}.tp-ckbv_w{background-color:var(--in-bg);border-radius:var(--elm-br);cursor:pointer;display:block;height:var(--bld-us);position:relative;width:var(--bld-us)}.tp-ckbv_w svg{bottom:0;display:block;height:16px;left:0;margin:auto;opacity:0;position:absolute;right:0;top:0;width:16px}.tp-ckbv_w svg path{fill:none;stroke:var(--in-fg);stroke-width:2}.tp-ckbv_i:hover+.tp-ckbv_w{background-color:var(--in-bg-h)}.tp-ckbv_i:focus+.tp-ckbv_w{background-color:var(--in-bg-f)}.tp-ckbv_i:active+.tp-ckbv_w{background-color:var(--in-bg-a)}.tp-ckbv_i:checked+.tp-ckbv_w svg{opacity:1}.tp-ckbv.tp-v-disabled .tp-ckbv_w{opacity:.5}.tp-colv{position:relative}.tp-colv_h{display:flex}.tp-colv_s{flex-grow:0;flex-shrink:0;width:var(--bld-us)}.tp-colv_t{flex:1;margin-left:4px}.tp-colv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-colv.tp-colv-expanded.tp-colv-cpl .tp-colv_p{overflow:visible}.tp-colv.tp-colv-expanded .tp-colv_p{margin-top:var(--bld-s);opacity:1}.tp-colv .tp-popv{left:calc(-1*var(--cnt-h-p));right:calc(-1*var(--cnt-h-p));top:var(--bld-us)}.tp-colpv_h,.tp-colpv_ap{margin-left:6px;margin-right:6px}.tp-colpv_h{margin-top:var(--bld-s)}.tp-colpv_rgb{display:flex;margin-top:var(--bld-s);width:100%}.tp-colpv_a{display:flex;margin-top:var(--cnt-v-p);padding-top:calc(var(--cnt-v-p) + 2px);position:relative}.tp-colpv_a::before{background-color:var(--grv-fg);content:"";height:2px;left:calc(-1*var(--cnt-h-p));position:absolute;right:calc(-1*var(--cnt-h-p));top:0}.tp-colpv.tp-v-disabled .tp-colpv_a::before{opacity:.5}.tp-colpv_ap{align-items:center;display:flex;flex:3}.tp-colpv_at{flex:1;margin-left:4px}.tp-svpv{border-radius:var(--elm-br);outline:none;overflow:hidden;position:relative}.tp-svpv.tp-v-disabled{opacity:.5}.tp-svpv_c{cursor:crosshair;display:block;height:calc(var(--bld-us)*4);width:100%}.tp-svpv_m{border-radius:100%;border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;filter:drop-shadow(0 0 1px rgba(0, 0, 0, 0.3));height:12px;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;width:12px}.tp-svpv:focus .tp-svpv_m{border-color:#fff}.tp-hplv{cursor:pointer;height:var(--bld-us);outline:none;position:relative}.tp-hplv.tp-v-disabled{opacity:.5}.tp-hplv_c{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAABCAYAAABubagXAAAAQ0lEQVQoU2P8z8Dwn0GCgQEDi2OK/RBgYHjBgIpfovFh8j8YBIgzFGQxuqEgPhaDOT5gOhPkdCxOZeBg+IDFZZiGAgCaSSMYtcRHLgAAAABJRU5ErkJggg==);background-position:left top;background-repeat:no-repeat;background-size:100% 100%;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;position:absolute;top:50%;width:100%}.tp-hplv_m{border-radius:var(--elm-br);border:rgba(255,255,255,.75) solid 2px;box-shadow:0 0 2px rgba(0,0,0,.1);box-sizing:border-box;height:12px;left:50%;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;top:50%;width:12px}.tp-hplv:focus .tp-hplv_m{border-color:#fff}.tp-aplv{cursor:pointer;height:var(--bld-us);outline:none;position:relative;width:100%}.tp-aplv.tp-v-disabled{opacity:.5}.tp-aplv_b{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:4px 4px;background-position:0 0,2px 2px;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;overflow:hidden;position:absolute;top:50%;width:100%}.tp-aplv_c{bottom:0;left:0;position:absolute;right:0;top:0}.tp-aplv_m{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:12px 12px;background-position:0 0,6px 6px;border-radius:var(--elm-br);box-shadow:0 0 2px rgba(0,0,0,.1);height:12px;left:50%;margin-left:-6px;margin-top:-6px;overflow:hidden;pointer-events:none;position:absolute;top:50%;width:12px}.tp-aplv_p{border-radius:var(--elm-br);border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;bottom:0;left:0;position:absolute;right:0;top:0}.tp-aplv:focus .tp-aplv_p{border-color:#fff}.tp-colswv{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:10px 10px;background-position:0 0,5px 5px;border-radius:var(--elm-br);overflow:hidden}.tp-colswv.tp-v-disabled{opacity:.5}.tp-colswv_sw{border-radius:0}.tp-colswv_b{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:rgba(0,0,0,0);border-width:0;cursor:pointer;display:block;height:var(--bld-us);left:0;margin:0;outline:none;padding:0;position:absolute;top:0;width:var(--bld-us)}.tp-colswv_b:focus::after{border:rgba(255,255,255,.75) solid 2px;border-radius:var(--elm-br);bottom:0;content:"";display:block;left:0;position:absolute;right:0;top:0}.tp-coltxtv{display:flex;width:100%}.tp-coltxtv_m{margin-right:4px}.tp-coltxtv_ms{border-radius:var(--elm-br);color:var(--lbl-fg);cursor:pointer;height:var(--bld-us);line-height:var(--bld-us);padding:0 18px 0 4px}.tp-coltxtv_ms:hover{background-color:var(--in-bg-h)}.tp-coltxtv_ms:focus{background-color:var(--in-bg-f)}.tp-coltxtv_ms:active{background-color:var(--in-bg-a)}.tp-coltxtv_mm{color:var(--lbl-fg)}.tp-coltxtv.tp-v-disabled .tp-coltxtv_mm{opacity:.5}.tp-coltxtv_w{flex:1}.tp-dfwv{position:absolute;top:8px;right:8px;width:256px}.tp-fldv{position:relative}.tp-fldv.tp-fldv-not .tp-fldv_b{display:none}.tp-fldv_t{padding-left:4px}.tp-fldv_b:disabled .tp-fldv_m{display:none}.tp-fldv_c{padding-left:4px}.tp-fldv_i{bottom:0;color:var(--cnt-bg);left:0;overflow:hidden;position:absolute;top:calc(var(--bld-us) + 4px);width:var(--bs-br)}.tp-fldv_i::before{background-color:currentColor;bottom:0;content:"";left:0;position:absolute;top:0;width:4px}.tp-fldv_b:hover+.tp-fldv_i{color:var(--cnt-bg-h)}.tp-fldv_b:focus+.tp-fldv_i{color:var(--cnt-bg-f)}.tp-fldv_b:active+.tp-fldv_i{color:var(--cnt-bg-a)}.tp-fldv.tp-v-disabled>.tp-fldv_i{opacity:.5}.tp-grlv{position:relative}.tp-grlv_g{display:block;height:calc(var(--bld-us)*3)}.tp-grlv_g polyline{fill:none;stroke:var(--mo-fg);stroke-linejoin:round}.tp-grlv_t{margin-top:-4px;transition:left .05s,top .05s;visibility:hidden}.tp-grlv_t.tp-grlv_t-a{visibility:visible}.tp-grlv_t.tp-grlv_t-in{transition:none}.tp-grlv.tp-v-disabled .tp-grlv_g{opacity:.5}.tp-grlv .tp-ttv{background-color:var(--mo-fg)}.tp-grlv .tp-ttv::before{border-top-color:var(--mo-fg)}.tp-lblv{align-items:center;display:flex;line-height:1.3;padding-left:var(--cnt-h-p);padding-right:var(--cnt-h-p)}.tp-lblv.tp-lblv-nol{display:block}.tp-lblv_l{color:var(--lbl-fg);flex:1;-webkit-hyphens:auto;hyphens:auto;overflow:hidden;padding-left:4px;padding-right:16px}.tp-lblv.tp-v-disabled .tp-lblv_l{opacity:.5}.tp-lblv.tp-lblv-nol .tp-lblv_l{display:none}.tp-lblv_v{align-self:flex-start;flex-grow:0;flex-shrink:0;width:160px}.tp-lblv.tp-lblv-nol .tp-lblv_v{width:100%}.tp-lstv_s{padding:0 20px 0 4px;width:100%}.tp-lstv_m{color:var(--btn-fg)}.tp-sglv_i{padding:0 4px}.tp-sglv.tp-v-disabled .tp-sglv_i{opacity:.5}.tp-mllv_i{display:block;height:calc(var(--bld-us)*3);line-height:var(--bld-us);padding:0 4px;resize:none;white-space:pre}.tp-mllv.tp-v-disabled .tp-mllv_i{opacity:.5}.tp-p2dv{position:relative}.tp-p2dv_h{display:flex}.tp-p2dv_b{height:var(--bld-us);margin-right:4px;position:relative;width:var(--bld-us)}.tp-p2dv_b svg{display:block;height:16px;left:50%;margin-left:-8px;margin-top:-8px;position:absolute;top:50%;width:16px}.tp-p2dv_b svg path{stroke:currentColor;stroke-width:2}.tp-p2dv_b svg circle{fill:currentColor}.tp-p2dv_t{flex:1}.tp-p2dv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-p2dv.tp-p2dv-expanded .tp-p2dv_p{margin-top:var(--bld-s);opacity:1}.tp-p2dv .tp-popv{left:calc(-1*var(--cnt-h-p));right:calc(-1*var(--cnt-h-p));top:var(--bld-us)}.tp-p2dpv{padding-left:calc(var(--bld-us) + 4px)}.tp-p2dpv_p{cursor:crosshair;height:0;overflow:hidden;padding-bottom:100%;position:relative}.tp-p2dpv.tp-v-disabled .tp-p2dpv_p{opacity:.5}.tp-p2dpv_g{display:block;height:100%;left:0;pointer-events:none;position:absolute;top:0;width:100%}.tp-p2dpv_ax{opacity:.1;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_l{opacity:.5;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_m{border:var(--in-fg) solid 1px;border-radius:50%;box-sizing:border-box;height:4px;margin-left:-2px;margin-top:-2px;position:absolute;width:4px}.tp-p2dpv_p:focus .tp-p2dpv_m{background-color:var(--in-fg);border-width:0}.tp-popv{background-color:var(--bs-bg);border-radius:6px;box-shadow:0 2px 4px var(--bs-sh);display:none;max-width:168px;padding:var(--cnt-v-p) var(--cnt-h-p);position:absolute;visibility:hidden;z-index:1000}.tp-popv.tp-popv-v{display:block;visibility:visible}.tp-sprv_r{background-color:var(--grv-fg);border-width:0;display:block;height:2px;margin:0;width:100%}.tp-sprv.tp-v-disabled .tp-sprv_r{opacity:.5}.tp-sldv.tp-v-disabled{opacity:.5}.tp-sldv_t{box-sizing:border-box;cursor:pointer;height:var(--bld-us);margin:0 6px;outline:none;position:relative}.tp-sldv_t::before{background-color:var(--in-bg);border-radius:1px;bottom:0;content:"";display:block;height:2px;left:0;margin:auto;position:absolute;right:0;top:0}.tp-sldv_k{height:100%;left:0;position:absolute;top:0}.tp-sldv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:"";display:block;height:2px;left:0;margin-bottom:auto;margin-top:auto;position:absolute;right:0;top:0}.tp-sldv_k::after{background-color:var(--btn-bg);border-radius:var(--elm-br);bottom:0;content:"";display:block;height:12px;margin-bottom:auto;margin-top:auto;position:absolute;right:-6px;top:0;width:12px}.tp-sldv_t:hover .tp-sldv_k::after{background-color:var(--btn-bg-h)}.tp-sldv_t:focus .tp-sldv_k::after{background-color:var(--btn-bg-f)}.tp-sldv_t:active .tp-sldv_k::after{background-color:var(--btn-bg-a)}.tp-sldtxtv{display:flex}.tp-sldtxtv_s{flex:2}.tp-sldtxtv_t{flex:1;margin-left:4px}.tp-tabv{position:relative}.tp-tabv_t{align-items:flex-end;color:var(--cnt-bg);display:flex;overflow:hidden;position:relative}.tp-tabv_t:hover{color:var(--cnt-bg-h)}.tp-tabv_t:has(*:focus){color:var(--cnt-bg-f)}.tp-tabv_t:has(*:active){color:var(--cnt-bg-a)}.tp-tabv_t::before{background-color:currentColor;bottom:0;content:"";height:2px;left:0;pointer-events:none;position:absolute;right:0}.tp-tabv.tp-v-disabled .tp-tabv_t::before{opacity:.5}.tp-tabv.tp-tabv-nop .tp-tabv_t{height:calc(var(--bld-us) + 4px);position:relative}.tp-tabv.tp-tabv-nop .tp-tabv_t::before{background-color:var(--cnt-bg);bottom:0;content:"";height:2px;left:0;position:absolute;right:0}.tp-tabv_c{padding-bottom:var(--cnt-v-p);padding-left:4px;padding-top:var(--cnt-v-p)}.tp-tabv_i{bottom:0;color:var(--cnt-bg);left:0;overflow:hidden;position:absolute;top:calc(var(--bld-us) + 4px);width:var(--bs-br)}.tp-tabv_i::before{background-color:currentColor;bottom:0;content:"";left:0;position:absolute;top:0;width:4px}.tp-tabv_t:hover+.tp-tabv_i{color:var(--cnt-bg-h)}.tp-tabv_t:has(*:focus)+.tp-tabv_i{color:var(--cnt-bg-f)}.tp-tabv_t:has(*:active)+.tp-tabv_i{color:var(--cnt-bg-a)}.tp-tabv.tp-v-disabled>.tp-tabv_i{opacity:.5}.tp-tbiv{flex:1;min-width:0;position:relative}.tp-tbiv+.tp-tbiv{margin-left:2px}.tp-tbiv+.tp-tbiv.tp-v-disabled::before{opacity:.5}.tp-tbiv_b{display:block;padding-left:calc(var(--cnt-h-p) + 4px);padding-right:calc(var(--cnt-h-p) + 4px);position:relative;width:100%}.tp-tbiv_b:disabled{opacity:.5}.tp-tbiv_b::before{background-color:var(--cnt-bg);bottom:2px;content:"";left:0;pointer-events:none;position:absolute;right:0;top:0}.tp-tbiv_b:hover::before{background-color:var(--cnt-bg-h)}.tp-tbiv_b:focus::before{background-color:var(--cnt-bg-f)}.tp-tbiv_b:active::before{background-color:var(--cnt-bg-a)}.tp-tbiv_t{color:var(--cnt-fg);height:calc(var(--bld-us) + 4px);line-height:calc(var(--bld-us) + 4px);opacity:.5;overflow:hidden;text-overflow:ellipsis}.tp-tbiv.tp-tbiv-sel .tp-tbiv_t{opacity:1}.tp-txtv{position:relative}.tp-txtv_i{padding:0 4px}.tp-txtv.tp-txtv-fst .tp-txtv_i{border-bottom-right-radius:0;border-top-right-radius:0}.tp-txtv.tp-txtv-mid .tp-txtv_i{border-radius:0}.tp-txtv.tp-txtv-lst .tp-txtv_i{border-bottom-left-radius:0;border-top-left-radius:0}.tp-txtv.tp-txtv-num .tp-txtv_i{text-align:right}.tp-txtv.tp-txtv-drg .tp-txtv_i{opacity:.3}.tp-txtv_k{cursor:pointer;height:100%;left:-3px;position:absolute;top:0;width:12px}.tp-txtv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:"";height:calc(var(--bld-us) - 4px);left:50%;margin-bottom:auto;margin-left:-1px;margin-top:auto;opacity:.1;position:absolute;top:0;transition:border-radius .1s,height .1s,transform .1s,width .1s;width:2px}.tp-txtv_k:hover::before,.tp-txtv.tp-txtv-drg .tp-txtv_k::before{opacity:1}.tp-txtv.tp-txtv-drg .tp-txtv_k::before{border-radius:50%;height:4px;transform:translateX(-1px);width:4px}.tp-txtv_g{bottom:0;display:block;height:8px;left:50%;margin:auto;overflow:visible;pointer-events:none;position:absolute;top:0;visibility:hidden;width:100%}.tp-txtv.tp-txtv-drg .tp-txtv_g{visibility:visible}.tp-txtv_gb{fill:none;stroke:var(--in-fg);stroke-dasharray:1}.tp-txtv_gh{fill:none;stroke:var(--in-fg)}.tp-txtv .tp-ttv{margin-left:6px;visibility:hidden}.tp-txtv.tp-txtv-drg .tp-ttv{visibility:visible}.tp-ttv{background-color:var(--in-fg);border-radius:var(--elm-br);color:var(--bs-bg);padding:2px 4px;pointer-events:none;position:absolute;transform:translate(-50%, -100%)}.tp-ttv::before{border-color:var(--in-fg) rgba(0,0,0,0) rgba(0,0,0,0) rgba(0,0,0,0);border-style:solid;border-width:2px;box-sizing:border-box;content:"";font-size:.9em;height:4px;left:50%;margin-left:-2px;position:absolute;top:100%;width:4px}.tp-rotv{background-color:var(--bs-bg);border-radius:var(--bs-br);box-shadow:0 2px 4px var(--bs-sh);font-family:var(--font-family);font-size:11px;font-weight:500;line-height:1;text-align:left}.tp-rotv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br);border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br);padding-left:calc(4px + var(--bld-us) + var(--cnt-h-p));text-align:center}.tp-rotv.tp-rotv-expanded .tp-rotv_b{border-bottom-left-radius:0;border-bottom-right-radius:0}.tp-rotv.tp-rotv-not .tp-rotv_b{display:none}.tp-rotv_b:disabled .tp-rotv_m{display:none}.tp-rotv_c>.tp-fldv.tp-v-lst>.tp-fldv_c{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst>.tp-fldv_i{border-bottom-left-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c .tp-fldv.tp-v-vlst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-right-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst{margin-top:calc(-1*var(--cnt-v-p))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst>.tp-fldv_b{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv_c>.tp-tabv.tp-v-lst>.tp-tabv_c{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-tabv.tp-v-lst>.tp-tabv_i{border-bottom-left-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst{margin-top:calc(-1*var(--cnt-v-p))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst>.tp-tabv_t{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv.tp-v-disabled,.tp-rotv .tp-v-disabled{pointer-events:none}.tp-rotv.tp-v-hidden,.tp-rotv .tp-v-hidden{display:none}'),this.pool_.getAll().forEach(Gt=>{this.embedPluginStyle_(Gt)}),this.registerPlugin({plugins:[oo,mm,ip,_c]})}},c.SeparatorApi=io,c.SliderApi=d_,c.TabApi=Ps,c.TabPageApi=As,c.TextApi=Nl,c.TpChangeEvent=b,c.VERSION=O0,Object.defineProperty(c,"__esModule",{value:!0})})(o)},161:function(h){h.exports=function(o,c,d){return o.length===0?o:c?(d||o.sort(c),function(_,b){for(var _e=1,it=_.length,nt=_[0],at=_[0],ut=1;ut<it;++ut)if(at=nt,b(nt=_[ut],at)){if(ut===_e){_e++;continue}_[_e++]=nt}return _.length=_e,_}(o,c)):(d||o.sort(),function(_){for(var b=1,_e=_.length,it=_[0],nt=_[0],at=1;at<_e;++at,nt=it)if(nt=it,(it=_[at])!==nt){if(at===b){b++;continue}_[b++]=it}return _.length=b,_}(o))}},957:function(__unused_webpack_module,__webpackgi_exports__,__webpackgi_require__){__webpackgi_require__.d(__webpackgi_exports__,{Z:function(){return DRACOLoader2}});var three_examples_jsm_loaders_DRACOLoader__WEBPACK_IMPORTED_MODULE_0__=__webpackgi_require__(149),three__WEBPACK_IMPORTED_MODULE_1__=__webpackgi_require__(848);class DRACOLoader2 extends three_examples_jsm_loaders_DRACOLoader__WEBPACK_IMPORTED_MODULE_0__.Z{constructor(h){super(h),this.encoderPending=null,this.encoderConfig={type:"js"},this.isDRACOLoader2=!0,this.setDecoderPath(DRACOLoader2.LIB_CDN_PATH),this.setDecoderConfig({type:"js"})}transform(h,o){return h?new three__WEBPACK_IMPORTED_MODULE_1__.eaF(h,new three__WEBPACK_IMPORTED_MODULE_1__._4j):void 0}preload(h=!0,o=!1){return h&&super.preload(),o&&this.initEncoder(),this}async initEncoder(){if(this.encoderPending)return this.encoderPending;const useJS=typeof WebAssembly!="object"||this.encoderConfig.type==="js",librariesPending=[],libLoader=this._loadLibrary.bind(this);return useJS?librariesPending.push(libLoader("draco_encoder.js","text")):(librariesPending.push(libLoader("draco_wasm_wrapper.js","text")),librariesPending.push(libLoader("draco_encoder.wasm","arraybuffer"))),this.encoderPending=Promise.all(librariesPending).then(libraries=>{var _a;const jsContent=libraries[0];return useJS||(this.encoderConfig.wasmBinary=libraries[1]),(_a=eval(jsContent+`
DracoEncoderModule;`))===null||_a===void 0?void 0:_a()}),this.encoderPending}async initDecoder(){var _a;await this._initDecoder();const jsContent=await fetch(this.workerSourceURL).then(async h=>h.text()).then(h=>{const o=h.indexOf("/* worker */");if(o<1)throw new Error("unable to load decoder module");return h.substring(0,o-1)});return(_a=eval(jsContent+`
DracoDecoderModule;`))===null||_a===void 0?void 0:_a()}async _loadLibrary(h,o){return DRACOLoader2.LibraryValueMap[h]?DRACOLoader2.LibraryValueMap[h]:DRACOLoader2.LibraryValueMap[h]=await super._loadLibrary(h,o)}static SetDecoderJsString(h){this.LibraryValueMap["draco_decoder.js"]=h}}DRACOLoader2.LIB_CDN_PATH="https://cdn.jsdelivr.net/gh/google/draco@1.4.1/javascript/",DRACOLoader2.LibraryValueMap={}},848:function(h,o,c){c.d(o,{$EB:function(){return At},$Kf:function(){return K0},$NF:function(){return N_},$O9:function(){return Hn},$_I:function(){return Jn},$ei:function(){return Kt},$p8:function(){return kA},A$4:function(){return ls},AKb:function(){return wE},ALV:function(){return k0},AT1:function(){return a_},Am1:function(){return NE},B69:function(){return Cs},B6O:function(){return Xx},BH$:function(){return Z0},BKk:function(){return Ul},BND:function(){return _S},BRH:function(){return ME},BXX:function(){return Gp},B_h:function(){return su},BdL:function(){return G0},CMB:function(){return Il},CR7:function(){return W_},CSG:function(){return H0},CV9:function(){return ly},CVz:function(){return V_},CWW:function(){return ap},Cfg:function(){return Qn},CmU:function(){return OA},CwR:function(){return VE},D$Q:function(){return pA},DAe:function(){return Yp},DAr:function(){return so},DXC:function(){return eu},Df:function(){return mA},E0M:function(){return vS},EAD:function(){return Lv},EQC:function(){return Xp},EZo:function(){return kt},EdD:function(){return zt},F1T:function(){return zy},F1l:function(){return lS},FCc:function(){return Hx},FFZ:function(){return K_},FNr:function(){return fA},FV:function(){return Tr},FXf:function(){return Ut},FZo:function(){return LA},Fn:function(){return sp},Fpm:function(){return aS},FvD:function(){return jv},Fvt:function(){return vA},G3T:function(){return Tu},GBG:function(){return wA},GJx:function(){return An},GOR:function(){return hE},GTy:function(){return Ct},GWd:function(){return no},GYF:function(){return Tm},GZZ:function(){return ay},G_z:function(){return _A},Gu$:function(){return k_},Gwm:function(){return Zr},GxU:function(){return It},H23:function(){return jm},HLH:function(){return Wm},HO_:function(){return Vm},HPb:function(){return $m},HXV:function(){return Lm},HgN:function(){return t_},HiM:function(){return IA},Hit:function(){return B_},Ho_:function(){return Rm},Hrb:function(){return Vn},Hrq:function(){return Z_},I46:function(){return Bx},I9Y:function(){return mn},IE4:function(){return yl},IUQ:function(){return Rs},IWo:function(){return gS},Ipv:function(){return Gl},Iw4:function(){return YE},IzY:function(){return yS},JeP:function(){return bx},Jnc:function(){return nt},K52:function(){return cn},KDk:function(){return Qo},KLL:function(){return Fs},KPJ:function(){return vy},KRh:function(){return zn},Ke9:function(){return Hm},Kef:function(){return H_},Ktl:function(){return J_},Kwu:function(){return Dt},Kzg:function(){return OE},Kzv:function(){return Ss},Ld9:function(){return bS},LiQ:function(){return lr},LlO:function(){return Gy},LoY:function(){return fs},LuO:function(){return ZE},MBL:function(){return Dm},MOq:function(){return _h},MSw:function(){return i0},MW4:function(){return yo},Mjd:function(){return Pr},N1A:function(){return Ku},N2s:function(){return qA},N5j:function(){return Qm},NRn:function(){return Al},NTi:function(){return Tt},NZq:function(){return Vs},Nt7:function(){return ur},Nv2:function(){return lE},Nwf:function(){return Ts},Nz6:function(){return ip},O0B:function(){return iv},O3Y:function(){return s0},O49:function(){return Q_},O9p:function(){return Hu},ONl:function(){return Wx},OUM:function(){return Gs},Oax:function(){return So},Om:function(){return Mn},OuU:function(){return dr},P5j:function(){return $E},PFK:function(){return dS},PJ3:function(){return op},PPD:function(){return Av},PTz:function(){return Eo},Pdi:function(){return xA},Pem:function(){return cE},Pf$:function(){return jE},Pq0:function(){return Sr},Q1f:function(){return jn},QCA:function(){return e0},QP0:function(){return pt},Qev:function(){return go},Qrf:function(){return np},R1W:function(){return uS},RJ4:function(){return Rl},ROr:function(){return S0},RQf:function(){return ro},RcT:function(){return Ql},RiT:function(){return L_},Riy:function(){return nu},Rkk:function(){return cp},RlV:function(){return Gu},RoJ:function(){return q0},Ru$:function(){return C0},RyA:function(){return ft},S$4:function(){return qp},S20:function(){return Gv},S2Q:function(){return Dl},S3G:function(){return xx},SUR:function(){return NA},ScU:function(){return TE},T6I:function(){return fy},TDQ:function(){return eA},THS:function(){return gr},TMh:function(){return Xm},Tap:function(){return IE},TdN:function(){return jo},TiK:function(){return $_},TkQ:function(){return Io},U3G:function(){return Yr},UJ6:function(){return zl},UPV:function(){return a0},UTZ:function(){return Gr},Ua6:function(){return _d},Ufg:function(){return R_},UpK:function(){return Tx},UtB:function(){return nS},UtX:function(){return wy},V3x:function(){return kn},V58:function(){return g_},V5c:function(){return up},V9B:function(){return _c},VCu:function(){return yx},VT0:function(){return As},VVr:function(){return Kp},Vb5:function(){return it},VnP:function(){return Jx},Vnu:function(){return hu},VxR:function(){return Bs},W9U:function(){return Gm},WBB:function(){return t0},WNZ:function(){return _e},WTh:function(){return mS},Wdf:function(){return Ym},Wew:function(){return io},Wk7:function(){return mt},Wyr:function(){return $l},XG_:function(){return zm},XIg:function(){return Et},XJ7:function(){return oA},XTe:function(){return BE},XrR:function(){return gs},Y9S:function(){return ru},YHV:function(){return rS},YJl:function(){return Am},YOZ:function(){return Ip},YRT:function(){return PE},Yhb:function(){return AA},Yuy:function(){return rp},Z0B:function(){return sy},Z58:function(){return Ax},ZLX:function(){return Fx},ZM4:function(){return fS},ZQM:function(){return Ps},Zcv:function(){return Yu},Zpd:function(){return n0},Zr2:function(){return qs},ZyN:function(){return RA},_4j:function(){return dy},_QJ:function(){return Hp},_xc:function(){return oS},a$r:function(){return ks},a5J:function(){return au},aEY:function(){return vr},aHM:function(){return Vo},aMy:function(){return Mu},aVO:function(){return Q0},agE:function(){return Du},amv:function(){return uu},b4q:function(){return __},bC7:function(){return Wp},bCz:function(){return Bt},bI3:function(){return xl},bTm:function(){return ut},baL:function(){return qr},bdM:function(){return f_},bkx:function(){return ho},brA:function(){return mr},bw0:function(){return Tn},c5h:function(){return pE},c90:function(){return xo},cHt:function(){return Mo},cRK:function(){return Tv},cZY:function(){return sS},caT:function(){return yn},cj9:function(){return ev},czI:function(){return Vp},dAo:function(){return oy},dYF:function(){return s_},dcC:function(){return Ws},dhZ:function(){return lp},dth:function(){return SA},dwI:function(){return os},dzP:function(){return JE},eB$:function(){return Iv},eHc:function(){return _r},eHs:function(){return Cp},eaF:function(){return co},eoi:function(){return X_},er$:function(){return Ns},ezk:function(){return _y},f4X:function(){return cr},fBL:function(){return to},fCn:function(){return Dn},fJr:function(){return qm},fP5:function(){return QA},fTw:function(){return pS},fc6:function(){return fn},g7M:function(){return Br},gJ2:function(){return Ml},gO9:function(){return Rt},gPd:function(){return js},gWB:function(){return Wl},ghU:function(){return vn},h2z:function(){return lu},hB5:function(){return vt},hIf:function(){return Zp},hZF:function(){return Rp},h_9:function(){return EA},hdd:function(){return pr},hfX:function(){return fx},hgQ:function(){return Dr},hjs:function(){return iS},hsX:function(){return xt},hxR:function(){return rn},hy7:function(){return tn},hzE:function(){return hS},i7d:function(){return bv},i7u:function(){return Wo},iNn:function(){return Xu},iOZ:function(){return uE},iUH:function(){return Xn},ibB:function(){return $x},ie2:function(){return hr},imn:function(){return ao},ix0:function(){return xa},iyt:function(){return Go},j6:function(){return o0},jGm:function(){return Zx},jR7:function(){return jp},jUj:function(){return Mv},jf0:function(){return Ds},jsO:function(){return Jp},jut:function(){return l0},jzd:function(){return Y_},k6Q:function(){return Bm},k6q:function(){return Wn},kBv:function(){return _},kEx:function(){return CE},kG0:function(){return pp},kLi:function(){return qo},kO0:function(){return mp},kRr:function(){return Gn},kTW:function(){return Cn},kTp:function(){return zp},kYr:function(){return hp},keZ:function(){return FE},klZ:function(){return q_},kn4:function(){return is},kqe:function(){return Uo},kxk:function(){return Cx},kyO:function(){return yr},l2R:function(){return xu},lGu:function(){return rr},lGw:function(){return D_},lMl:function(){return vo},lPF:function(){return Zm},lc7:function(){return $p},ljd:function(){return Iu},lyL:function(){return Qp},mrM:function(){return Oo},nCl:function(){return TA},nEu:function(){return qv},nNL:function(){return jr},nST:function(){return Ht},nWS:function(){return wo},nZQ:function(){return vx},nc$:function(){return Cy},nzx:function(){return P_},o6l:function(){return Vy},oVO:function(){return P0},oh6:function(){return eS},ojh:function(){return sr},ojs:function(){return Pu},pBf:function(){return Om},pFK:function(){return Ju},pHI:function(){return En},pPE:function(){return $A},paN:function(){return Fo},ppV:function(){return Is},psI:function(){return Nm},q2:function(){return uA},qBx:function(){return gA},qFE:function(){return Wv},qIQ:function(){return cu},qU7:function(){return Hv},qUd:function(){return Ev},qa3:function(){return Hl},qad:function(){return ir},qtW:function(){return On},r6x:function(){return Ay},rFo:function(){return nm},rKP:function(){return r0},rOG:function(){return _s},rQf:function(){return ou},rSH:function(){return Cu},rYR:function(){return E0},s0K:function(){return Kx},sKt:function(){return dp},sPf:function(){return d},tBo:function(){return tS},tJf:function(){return $s},tXL:function(){return dA},tcD:function(){return Qv},tgE:function(){return Ks},tz3:function(){return O_},uB5:function(){return Fm},uSd:function(){return hA},uV5:function(){return xn},uWO:function(){return Mm},uXQ:function(){return T0},ubm:function(){return bo},uov:function(){return M0},ure:function(){return DA},veJ:function(){return Zu},vim:function(){return pu},vmz:function(){return na},vxI:function(){return ds},vyJ:function(){return Ru},wAk:function(){return C_},wfO:function(){return gn},wn6:function(){return xr},wqq:function(){return ku},wrO:function(){return Nn},wtR:function(){return b},wvS:function(){return Cr},xFO:function(){return nn},xJ6:function(){return tu},xOk:function(){return BA},xSv:function(){return Rr},xZx:function(){return zE},xfg:function(){return cy},y3Z:function(){return Um},y9J:function(){return n_},y_p:function(){return or},ypk:function(){return Pp},ywQ:function(){return at},z5:function(){return Hs},zD7:function(){return zA},zdS:function(){return mo},zgK:function(){return um},zkh:function(){return zo},znC:function(){return Jt}});const d="157",_={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},b={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},_e=0,it=1,nt=2,at=3,ut=0,pt=1,mt=2,ft=3,vt=0,xt=1,At=2,Ct=2,Et=0,Tt=1,kt=2,Dt=3,zt=4,Bt=5,Rt=100,Ut=101,Ht=102,Jt=103,Kt=104,sr=200,ir=201,cr=202,lr=203,hr=204,dr=205,pr=206,ur=207,xr=208,vr=209,Dr=210,_r=0,rr=1,mr=2,Rr=3,Yr=4,Zr=5,cn=6,Tn=7,yn=0,zn=1,gs=2,or=0,yr=1,Pr=2,jr=3,Tr=4,Br=5,Gr=300,tn=301,nn=302,gn=303,xn=304,Mn=306,An=1e3,vn=1001,Cn=1002,rn=1003,En=1004,Hn=1004,Qn=1005,ks=1005,Wn=1006,Gn=1007,Xn=1007,Jn=1008,Vs=1008,Gs=1009,$s=1010,to=1011,Mo=1012,rp=1013,ho=1014,ro=1015,xa=1016,io=1017,Ml=1018,kn=1020,Nn=1021,no=1023,Ss=1024,Il=1025,mo=1026,Ws=1027,As=1028,Ps=1029,Fo=1030,Io=1031,xo=1033,yl=33776,ip=33777,jp=33778,Gp=33779,Bm=35840,zp=35841,Lm=35842,Om=35843,V_=36196,nu=37492,Qo=37496,Hl=37808,su=37809,Vp=37810,Cu=37811,np=37812,Nm=37813,au=37814,Hp=37815,Fm=37816,Qp=37817,Wp=37818,Um=37819,Pu=37820,qp=37821,sp=36492,jm=36494,Gm=36495,H_=36283,zm=36284,Vm=36285,ap=36286,Tu=2200,Mu=2201,$p=2202,Iu=2300,op=2301,Xp=2302,ou=2400,lu=2401,lp=2402,Hm=2500,Yp=2501,Rl=0,Q_=1,E0=2,Ks=3e3,Dl=3001,cp=3200,Qm=3201,xl=0,Ru=1,Ds="",Ns="srgb",qs="srgb-linear",up="display-p3",cu="display-p3-linear",so="rgbm-16",Bs="linear",Fs="srgb",Hs="rec709",ku="p3",Uo=0,Kp=7680,pp=7681,Wm=7682,S0=7683,C0=34055,qm=34056,P0=5386,$m=512,hp=513,Jp=514,W_=515,Ql=516,q_=517,Xm=518,dp=519,uu=512,pu=513,mp=514,$_=515,X_=516,Y_=517,Wl=518,K_=519,Du=35044,hu=35048,J_=35040,T0=35045,Zp=35049,M0=35041,Z_=35046,_h=35050,_s=35042,$l="100",Ym="300 es",_d=1035,jo=2e3,Wo=2001;class go{addEventListener(tt,lt){this._listeners===void 0&&(this._listeners={});const ht=this._listeners;ht[tt]===void 0&&(ht[tt]=[]),ht[tt].indexOf(lt)===-1&&ht[tt].push(lt)}hasEventListener(tt,lt){if(this._listeners===void 0)return!1;const ht=this._listeners;return ht[tt]!==void 0&&ht[tt].indexOf(lt)!==-1}removeEventListener(tt,lt){if(this._listeners===void 0)return;const ht=this._listeners[tt];if(ht!==void 0){const _t=ht.indexOf(lt);_t!==-1&&ht.splice(_t,1)}}dispatchEvent(tt){if(this._listeners===void 0)return;const lt=this._listeners[tt.type];if(lt!==void 0){tt.target=this;const ht=lt.slice(0);for(let _t=0,bt=ht.length;_t<bt;_t++)ht[_t].call(this,tt);tt.target=null}}}const Us=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let _f=1234567;const Xl=Math.PI/180,du=180/Math.PI;function Ao(){const St=4294967295*Math.random()|0,tt=4294967295*Math.random()|0,lt=4294967295*Math.random()|0,ht=4294967295*Math.random()|0;return(Us[255&St]+Us[St>>8&255]+Us[St>>16&255]+Us[St>>24&255]+"-"+Us[255&tt]+Us[tt>>8&255]+"-"+Us[tt>>16&15|64]+Us[tt>>24&255]+"-"+Us[63&lt|128]+Us[lt>>8&255]+"-"+Us[lt>>16&255]+Us[lt>>24&255]+Us[255&ht]+Us[ht>>8&255]+Us[ht>>16&255]+Us[ht>>24&255]).toLowerCase()}function Qs(St,tt,lt){return Math.max(tt,Math.min(lt,St))}function em(St,tt){return(St%tt+tt)%tt}function Bu(St,tt,lt){return(1-lt)*St+lt*tt}function tm(St){return!(St&St-1)&&St!==0}function Km(St){return Math.pow(2,Math.ceil(Math.log(St)/Math.LN2))}function gp(St){return Math.pow(2,Math.floor(Math.log(St)/Math.LN2))}function _o(St,tt){switch(tt.constructor){case Float32Array:return St;case Uint32Array:return St/4294967295;case Uint16Array:return St/65535;case Uint8Array:return St/255;case Int32Array:return Math.max(St/2147483647,-1);case Int16Array:return Math.max(St/32767,-1);case Int8Array:return Math.max(St/127,-1);default:throw new Error("Invalid component type.")}}function ss(St,tt){switch(tt.constructor){case Float32Array:return St;case Uint32Array:return Math.round(4294967295*St);case Uint16Array:return Math.round(65535*St);case Uint8Array:return Math.round(255*St);case Int32Array:return Math.round(2147483647*St);case Int16Array:return Math.round(32767*St);case Int8Array:return Math.round(127*St);default:throw new Error("Invalid component type.")}}const ev={DEG2RAD:Xl,RAD2DEG:du,generateUUID:Ao,clamp:Qs,euclideanModulo:em,mapLinear:function(St,tt,lt,ht,_t){return ht+(St-tt)*(_t-ht)/(lt-tt)},inverseLerp:function(St,tt,lt){return St!==tt?(lt-St)/(tt-St):0},lerp:Bu,damp:function(St,tt,lt,ht){return Bu(St,tt,1-Math.exp(-lt*ht))},pingpong:function(St,tt=1){return tt-Math.abs(em(St,2*tt)-tt)},smoothstep:function(St,tt,lt){return St<=tt?0:St>=lt?1:(St=(St-tt)/(lt-tt))*St*(3-2*St)},smootherstep:function(St,tt,lt){return St<=tt?0:St>=lt?1:(St=(St-tt)/(lt-tt))*St*St*(St*(6*St-15)+10)},randInt:function(St,tt){return St+Math.floor(Math.random()*(tt-St+1))},randFloat:function(St,tt){return St+Math.random()*(tt-St)},randFloatSpread:function(St){return St*(.5-Math.random())},seededRandom:function(St){St!==void 0&&(_f=St);let tt=_f+=1831565813;return tt=Math.imul(tt^tt>>>15,1|tt),tt^=tt+Math.imul(tt^tt>>>7,61|tt),((tt^tt>>>14)>>>0)/4294967296},degToRad:function(St){return St*Xl},radToDeg:function(St){return St*du},isPowerOfTwo:tm,ceilPowerOfTwo:Km,floorPowerOfTwo:gp,setQuaternionFromProperEuler:function(St,tt,lt,ht,_t){const bt=Math.cos,Pt=Math.sin,Mt=bt(lt/2),Lt=Pt(lt/2),Nt=bt((tt+ht)/2),jt=Pt((tt+ht)/2),Wt=bt((tt-ht)/2),Qt=Pt((tt-ht)/2),qt=bt((ht-tt)/2),Xt=Pt((ht-tt)/2);switch(_t){case"XYX":St.set(Mt*jt,Lt*Wt,Lt*Qt,Mt*Nt);break;case"YZY":St.set(Lt*Qt,Mt*jt,Lt*Wt,Mt*Nt);break;case"ZXZ":St.set(Lt*Wt,Lt*Qt,Mt*jt,Mt*Nt);break;case"XZX":St.set(Mt*jt,Lt*Xt,Lt*qt,Mt*Nt);break;case"YXY":St.set(Lt*qt,Mt*jt,Lt*Xt,Mt*Nt);break;case"ZYZ":St.set(Lt*Xt,Lt*qt,Mt*jt,Mt*Nt);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+_t)}},normalize:ss,denormalize:_o};class mn{constructor(tt=0,lt=0){mn.prototype.isVector2=!0,this.x=tt,this.y=lt}get width(){return this.x}set width(tt){this.x=tt}get height(){return this.y}set height(tt){this.y=tt}set(tt,lt){return this.x=tt,this.y=lt,this}setScalar(tt){return this.x=tt,this.y=tt,this}setX(tt){return this.x=tt,this}setY(tt){return this.y=tt,this}setComponent(tt,lt){switch(tt){case 0:this.x=lt;break;case 1:this.y=lt;break;default:throw new Error("index is out of range: "+tt)}return this}getComponent(tt){switch(tt){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+tt)}}clone(){return new this.constructor(this.x,this.y)}copy(tt){return this.x=tt.x,this.y=tt.y,this}add(tt){return this.x+=tt.x,this.y+=tt.y,this}addScalar(tt){return this.x+=tt,this.y+=tt,this}addVectors(tt,lt){return this.x=tt.x+lt.x,this.y=tt.y+lt.y,this}addScaledVector(tt,lt){return this.x+=tt.x*lt,this.y+=tt.y*lt,this}sub(tt){return this.x-=tt.x,this.y-=tt.y,this}subScalar(tt){return this.x-=tt,this.y-=tt,this}subVectors(tt,lt){return this.x=tt.x-lt.x,this.y=tt.y-lt.y,this}multiply(tt){return this.x*=tt.x,this.y*=tt.y,this}multiplyScalar(tt){return this.x*=tt,this.y*=tt,this}divide(tt){return this.x/=tt.x,this.y/=tt.y,this}divideScalar(tt){return this.multiplyScalar(1/tt)}applyMatrix3(tt){const lt=this.x,ht=this.y,_t=tt.elements;return this.x=_t[0]*lt+_t[3]*ht+_t[6],this.y=_t[1]*lt+_t[4]*ht+_t[7],this}min(tt){return this.x=Math.min(this.x,tt.x),this.y=Math.min(this.y,tt.y),this}max(tt){return this.x=Math.max(this.x,tt.x),this.y=Math.max(this.y,tt.y),this}clamp(tt,lt){return this.x=Math.max(tt.x,Math.min(lt.x,this.x)),this.y=Math.max(tt.y,Math.min(lt.y,this.y)),this}clampScalar(tt,lt){return this.x=Math.max(tt,Math.min(lt,this.x)),this.y=Math.max(tt,Math.min(lt,this.y)),this}clampLength(tt,lt){const ht=this.length();return this.divideScalar(ht||1).multiplyScalar(Math.max(tt,Math.min(lt,ht)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(tt){return this.x*tt.x+this.y*tt.y}cross(tt){return this.x*tt.y-this.y*tt.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(tt){const lt=Math.sqrt(this.lengthSq()*tt.lengthSq());if(lt===0)return Math.PI/2;const ht=this.dot(tt)/lt;return Math.acos(Qs(ht,-1,1))}distanceTo(tt){return Math.sqrt(this.distanceToSquared(tt))}distanceToSquared(tt){const lt=this.x-tt.x,ht=this.y-tt.y;return lt*lt+ht*ht}manhattanDistanceTo(tt){return Math.abs(this.x-tt.x)+Math.abs(this.y-tt.y)}setLength(tt){return this.normalize().multiplyScalar(tt)}lerp(tt,lt){return this.x+=(tt.x-this.x)*lt,this.y+=(tt.y-this.y)*lt,this}lerpVectors(tt,lt,ht){return this.x=tt.x+(lt.x-tt.x)*ht,this.y=tt.y+(lt.y-tt.y)*ht,this}equals(tt){return tt.x===this.x&&tt.y===this.y}fromArray(tt,lt=0){return this.x=tt[lt],this.y=tt[lt+1],this}toArray(tt=[],lt=0){return tt[lt]=this.x,tt[lt+1]=this.y,tt}fromBufferAttribute(tt,lt){return this.x=tt.getX(lt),this.y=tt.getY(lt),this}rotateAround(tt,lt){const ht=Math.cos(lt),_t=Math.sin(lt),bt=this.x-tt.x,Pt=this.y-tt.y;return this.x=bt*ht-Pt*_t+tt.x,this.y=bt*_t+Pt*ht+tt.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class os{constructor(tt,lt,ht,_t,bt,Pt,Mt,Lt,Nt){os.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],tt!==void 0&&this.set(tt,lt,ht,_t,bt,Pt,Mt,Lt,Nt)}set(tt,lt,ht,_t,bt,Pt,Mt,Lt,Nt){const jt=this.elements;return jt[0]=tt,jt[1]=_t,jt[2]=Mt,jt[3]=lt,jt[4]=bt,jt[5]=Lt,jt[6]=ht,jt[7]=Pt,jt[8]=Nt,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(tt){const lt=this.elements,ht=tt.elements;return lt[0]=ht[0],lt[1]=ht[1],lt[2]=ht[2],lt[3]=ht[3],lt[4]=ht[4],lt[5]=ht[5],lt[6]=ht[6],lt[7]=ht[7],lt[8]=ht[8],this}extractBasis(tt,lt,ht){return tt.setFromMatrix3Column(this,0),lt.setFromMatrix3Column(this,1),ht.setFromMatrix3Column(this,2),this}setFromMatrix4(tt){const lt=tt.elements;return this.set(lt[0],lt[4],lt[8],lt[1],lt[5],lt[9],lt[2],lt[6],lt[10]),this}multiply(tt){return this.multiplyMatrices(this,tt)}premultiply(tt){return this.multiplyMatrices(tt,this)}multiplyMatrices(tt,lt){const ht=tt.elements,_t=lt.elements,bt=this.elements,Pt=ht[0],Mt=ht[3],Lt=ht[6],Nt=ht[1],jt=ht[4],Wt=ht[7],Qt=ht[2],qt=ht[5],Xt=ht[8],Zt=_t[0],Yt=_t[3],ar=_t[6],er=_t[1],tr=_t[4],Ar=_t[7],wr=_t[2],br=_t[5],Mr=_t[8];return bt[0]=Pt*Zt+Mt*er+Lt*wr,bt[3]=Pt*Yt+Mt*tr+Lt*br,bt[6]=Pt*ar+Mt*Ar+Lt*Mr,bt[1]=Nt*Zt+jt*er+Wt*wr,bt[4]=Nt*Yt+jt*tr+Wt*br,bt[7]=Nt*ar+jt*Ar+Wt*Mr,bt[2]=Qt*Zt+qt*er+Xt*wr,bt[5]=Qt*Yt+qt*tr+Xt*br,bt[8]=Qt*ar+qt*Ar+Xt*Mr,this}multiplyScalar(tt){const lt=this.elements;return lt[0]*=tt,lt[3]*=tt,lt[6]*=tt,lt[1]*=tt,lt[4]*=tt,lt[7]*=tt,lt[2]*=tt,lt[5]*=tt,lt[8]*=tt,this}determinant(){const tt=this.elements,lt=tt[0],ht=tt[1],_t=tt[2],bt=tt[3],Pt=tt[4],Mt=tt[5],Lt=tt[6],Nt=tt[7],jt=tt[8];return lt*Pt*jt-lt*Mt*Nt-ht*bt*jt+ht*Mt*Lt+_t*bt*Nt-_t*Pt*Lt}invert(){const tt=this.elements,lt=tt[0],ht=tt[1],_t=tt[2],bt=tt[3],Pt=tt[4],Mt=tt[5],Lt=tt[6],Nt=tt[7],jt=tt[8],Wt=jt*Pt-Mt*Nt,Qt=Mt*Lt-jt*bt,qt=Nt*bt-Pt*Lt,Xt=lt*Wt+ht*Qt+_t*qt;if(Xt===0)return this.set(0,0,0,0,0,0,0,0,0);const Zt=1/Xt;return tt[0]=Wt*Zt,tt[1]=(_t*Nt-jt*ht)*Zt,tt[2]=(Mt*ht-_t*Pt)*Zt,tt[3]=Qt*Zt,tt[4]=(jt*lt-_t*Lt)*Zt,tt[5]=(_t*bt-Mt*lt)*Zt,tt[6]=qt*Zt,tt[7]=(ht*Lt-Nt*lt)*Zt,tt[8]=(Pt*lt-ht*bt)*Zt,this}transpose(){let tt;const lt=this.elements;return tt=lt[1],lt[1]=lt[3],lt[3]=tt,tt=lt[2],lt[2]=lt[6],lt[6]=tt,tt=lt[5],lt[5]=lt[7],lt[7]=tt,this}getNormalMatrix(tt){return this.setFromMatrix4(tt).invert().transpose()}transposeIntoArray(tt){const lt=this.elements;return tt[0]=lt[0],tt[1]=lt[3],tt[2]=lt[6],tt[3]=lt[1],tt[4]=lt[4],tt[5]=lt[7],tt[6]=lt[2],tt[7]=lt[5],tt[8]=lt[8],this}setUvTransform(tt,lt,ht,_t,bt,Pt,Mt){const Lt=Math.cos(bt),Nt=Math.sin(bt);return this.set(ht*Lt,ht*Nt,-ht*(Lt*Pt+Nt*Mt)+Pt+tt,-_t*Nt,_t*Lt,-_t*(-Nt*Pt+Lt*Mt)+Mt+lt,0,0,1),this}scale(tt,lt){return this.premultiply(rm.makeScale(tt,lt)),this}rotate(tt){return this.premultiply(rm.makeRotation(-tt)),this}translate(tt,lt){return this.premultiply(rm.makeTranslation(tt,lt)),this}makeTranslation(tt,lt){return tt.isVector2?this.set(1,0,tt.x,0,1,tt.y,0,0,1):this.set(1,0,tt,0,1,lt,0,0,1),this}makeRotation(tt){const lt=Math.cos(tt),ht=Math.sin(tt);return this.set(lt,-ht,0,ht,lt,0,0,0,1),this}makeScale(tt,lt){return this.set(tt,0,0,0,lt,0,0,0,1),this}equals(tt){const lt=this.elements,ht=tt.elements;for(let _t=0;_t<9;_t++)if(lt[_t]!==ht[_t])return!1;return!0}fromArray(tt,lt=0){for(let ht=0;ht<9;ht++)this.elements[ht]=tt[ht+lt];return this}toArray(tt=[],lt=0){const ht=this.elements;return tt[lt]=ht[0],tt[lt+1]=ht[1],tt[lt+2]=ht[2],tt[lt+3]=ht[3],tt[lt+4]=ht[4],tt[lt+5]=ht[5],tt[lt+6]=ht[6],tt[lt+7]=ht[7],tt[lt+8]=ht[8],tt}clone(){return new this.constructor().fromArray(this.elements)}}const rm=new os;function tv(St){for(let tt=St.length-1;tt>=0;--tt)if(St[tt]>=65535)return!0;return!1}const Jm={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function mu(St,tt){return new Jm[St](tt)}function gu(St){return document.createElementNS("http://www.w3.org/1999/xhtml",St)}function Zm(){const St=gu("canvas");return St.style.display="block",St}const _g={};function _u(St){St in _g||(_g[St]=!0,console.warn(St))}const e_=new os().set(.8224621,.177538,0,.0331941,.9668058,0,.0170827,.0723974,.9105199),rv=new os().set(1.2249401,-.2249404,0,-.0420569,1.0420571,0,-.0196376,-.0786361,1.0982735),fu={[qs]:{transfer:Bs,primaries:Hs,toReference:St=>St,fromReference:St=>St},[Ns]:{transfer:Fs,primaries:Hs,toReference:St=>St.convertSRGBToLinear(),fromReference:St=>St.convertLinearToSRGB()},[cu]:{transfer:Bs,primaries:ku,toReference:St=>St.applyMatrix3(rv),fromReference:St=>St.applyMatrix3(e_)},[up]:{transfer:Fs,primaries:ku,toReference:St=>St.convertSRGBToLinear().applyMatrix3(rv),fromReference:St=>St.applyMatrix3(e_).convertLinearToSRGB()}},I0=new Set([qs,cu]),Is={enabled:!0,_workingColorSpace:qs,get legacyMode(){return console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),!this.enabled},set legacyMode(St){console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),this.enabled=!St},get workingColorSpace(){return this._workingColorSpace},set workingColorSpace(St){if(!I0.has(St))throw new Error(`Unsupported working color space, "${St}".`);this._workingColorSpace=St},convert:function(St,tt,lt){if(this.enabled===!1||tt===lt||!tt||!lt)return St;const ht=fu[tt].toReference;return(0,fu[lt].fromReference)(ht(St))},fromWorkingColorSpace:function(St,tt){return this.convert(St,this._workingColorSpace,tt)},toWorkingColorSpace:function(St,tt){return this.convert(St,tt,this._workingColorSpace)},getPrimaries:function(St){return fu[St].primaries},getTransfer:function(St){return St===Ds||St===so?Bs:fu[St].transfer}};function Lu(St){return St<.04045?.0773993808*St:Math.pow(.9478672986*St+.0521327014,2.4)}function im(St){return St<.0031308?12.92*St:1.055*Math.pow(St,.41666)-.055}let Ou;class t_{static getDataURL(tt,lt=!1){if(/^data:/i.test(tt.src)||typeof HTMLCanvasElement>"u")return tt.src;let ht;if(tt instanceof HTMLCanvasElement)ht=tt;else{Ou===void 0&&(Ou=gu("canvas")),Ou.width=tt.width,Ou.height=tt.height;const _t=Ou.getContext("2d");tt instanceof ImageData?_t.putImageData(tt,0,0):_t.drawImage(tt,0,0,tt.width,tt.height),ht=Ou}return!lt&&(ht.width>2048||ht.height>2048)?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",tt),ht.toDataURL("image/jpeg",.6)):ht.toDataURL("image/png")}static sRGBToLinear(tt){if(typeof HTMLImageElement<"u"&&tt instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&tt instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&tt instanceof ImageBitmap){const lt=gu("canvas");lt.width=tt.width,lt.height=tt.height;const ht=lt.getContext("2d");ht.drawImage(tt,0,0,tt.width,tt.height);const _t=ht.getImageData(0,0,tt.width,tt.height),bt=_t.data;for(let Pt=0;Pt<bt.length;Pt++)bt[Pt]=255*Lu(bt[Pt]/255);return ht.putImageData(_t,0,0),lt}if(tt.data){const lt=tt.data.slice(0);for(let ht=0;ht<lt.length;ht++)lt instanceof Uint8Array||lt instanceof Uint8ClampedArray?lt[ht]=Math.floor(255*Lu(lt[ht]/255)):lt[ht]=Lu(lt[ht]);return{data:lt,width:tt.width,height:tt.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),tt}}let r_=0;class qo{constructor(tt=null){this.isSource=!0,Object.defineProperty(this,"id",{value:r_++}),this.uuid=Ao(),this.data=tt,this.version=0}set needsUpdate(tt){tt===!0&&this.version++}toJSON(tt){const lt=tt===void 0||typeof tt=="string";if(!lt&&tt.images[this.uuid]!==void 0)return tt.images[this.uuid];const ht={uuid:this.uuid,url:""},_t=this.data;if(_t!==null){let bt;if(Array.isArray(_t)){bt=[];for(let Pt=0,Mt=_t.length;Pt<Mt;Pt++)_t[Pt].isDataTexture?bt.push(i_(_t[Pt].image)):bt.push(i_(_t[Pt]))}else bt=i_(_t);ht.url=bt}return lt||(tt.images[this.uuid]=ht),ht}}function i_(St){if(typeof HTMLImageElement<"u"&&St instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&St instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&St instanceof ImageBitmap)return t_.getDataURL(St);if(St.data){let tt=[];try{tt=Array.from(St.data)}catch(lt){lt.message.includes("Invalid array length")?console.warn("Serializing large texture, might not be saved in JSON structure."):console.error(lt),tt=St.data}return{data:tt,width:St.width,height:St.height,type:St.data.constructor.name}}return St.url!==void 0?St.url:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let R0=0;class js extends go{constructor(tt=js.DEFAULT_IMAGE,lt=js.DEFAULT_MAPPING,ht=vn,_t=vn,bt=Wn,Pt=Jn,Mt=no,Lt=Gs,Nt=js.DEFAULT_ANISOTROPY,jt=Ds){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:R0++}),this.uuid=Ao(),this.name="",this.source=new qo(tt),this.mipmaps=[],this.mapping=lt,this.channel=0,this.wrapS=ht,this.wrapT=_t,this.magFilter=bt,this.minFilter=Pt,this.anisotropy=Nt,this.format=Mt,this.internalFormat=null,this.type=Lt,this.offset=new mn(0,0),this.repeat=new mn(1,1),this.center=new mn(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new os,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,typeof jt=="string"?this.colorSpace=jt:(_u("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=jt===Dl?Ns:Ds),this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1,tt instanceof ImageData&&(this.needsUpdate=!0)}get image(){return this.source.data}set image(tt=null){this.source.data=tt}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(tt){return this.name=tt.name,this.source=tt.source,this.mipmaps=tt.mipmaps.slice(0),this.mapping=tt.mapping,this.channel=tt.channel,this.wrapS=tt.wrapS,this.wrapT=tt.wrapT,this.magFilter=tt.magFilter,this.minFilter=tt.minFilter,this.anisotropy=tt.anisotropy,this.format=tt.format,this.internalFormat=tt.internalFormat,this.type=tt.type,this.offset.copy(tt.offset),this.repeat.copy(tt.repeat),this.center.copy(tt.center),this.rotation=tt.rotation,this.matrixAutoUpdate=tt.matrixAutoUpdate,this.matrix.copy(tt.matrix),this.generateMipmaps=tt.generateMipmaps,this.premultiplyAlpha=tt.premultiplyAlpha,this.flipY=tt.flipY,this.unpackAlignment=tt.unpackAlignment,this.colorSpace=tt.colorSpace,this.userData=JSON.parse(JSON.stringify(tt.userData)),this.needsUpdate=!0,this}toJSON(tt){const lt=tt===void 0||typeof tt=="string";if(!lt&&tt.textures&&tt.textures[this.uuid]!==void 0)return tt.textures[this.uuid];const ht={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(tt).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,encoding:this.colorSpace===Ns?Dl:Ks,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(ht.userData=this.userData),!lt&&tt.textures&&(tt.textures[this.uuid]=ht),ht}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(tt){if(this.mapping!==Gr)return tt;if(tt.applyMatrix3(this.matrix),tt.x<0||tt.x>1)switch(this.wrapS){case An:tt.x=tt.x-Math.floor(tt.x);break;case vn:tt.x=tt.x<0?0:1;break;case Cn:Math.abs(Math.floor(tt.x)%2)===1?tt.x=Math.ceil(tt.x)-tt.x:tt.x=tt.x-Math.floor(tt.x)}if(tt.y<0||tt.y>1)switch(this.wrapT){case An:tt.y=tt.y-Math.floor(tt.y);break;case vn:tt.y=tt.y<0?0:1;break;case Cn:Math.abs(Math.floor(tt.y)%2)===1?tt.y=Math.ceil(tt.y)-tt.y:tt.y=tt.y-Math.floor(tt.y)}return this.flipY&&(tt.y=1-tt.y),tt}set needsUpdate(tt){tt===!0&&(this.version++,this.source.needsUpdate=!0,this.dispatchEvent({type:"update"}))}get encoding(){return _u("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace===Ns?Dl:Ks}set encoding(tt){_u("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=tt===Dl?Ns:Ds}}js.DEFAULT_IMAGE=null,js.DEFAULT_MAPPING=Gr,js.DEFAULT_ANISOTROPY=1;class Rs{constructor(tt=0,lt=0,ht=0,_t=1){Rs.prototype.isVector4=!0,this.x=tt,this.y=lt,this.z=ht,this.w=_t}get width(){return this.z}set width(tt){this.z=tt}get height(){return this.w}set height(tt){this.w=tt}set(tt,lt,ht,_t){return this.x=tt,this.y=lt,this.z=ht,this.w=_t,this}setScalar(tt){return this.x=tt,this.y=tt,this.z=tt,this.w=tt,this}setX(tt){return this.x=tt,this}setY(tt){return this.y=tt,this}setZ(tt){return this.z=tt,this}setW(tt){return this.w=tt,this}setComponent(tt,lt){switch(tt){case 0:this.x=lt;break;case 1:this.y=lt;break;case 2:this.z=lt;break;case 3:this.w=lt;break;default:throw new Error("index is out of range: "+tt)}return this}getComponent(tt){switch(tt){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+tt)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(tt){return this.x=tt.x,this.y=tt.y,this.z=tt.z,this.w=tt.w!==void 0?tt.w:1,this}add(tt){return this.x+=tt.x,this.y+=tt.y,this.z+=tt.z,this.w+=tt.w,this}addScalar(tt){return this.x+=tt,this.y+=tt,this.z+=tt,this.w+=tt,this}addVectors(tt,lt){return this.x=tt.x+lt.x,this.y=tt.y+lt.y,this.z=tt.z+lt.z,this.w=tt.w+lt.w,this}addScaledVector(tt,lt){return this.x+=tt.x*lt,this.y+=tt.y*lt,this.z+=tt.z*lt,this.w+=tt.w*lt,this}sub(tt){return this.x-=tt.x,this.y-=tt.y,this.z-=tt.z,this.w-=tt.w,this}subScalar(tt){return this.x-=tt,this.y-=tt,this.z-=tt,this.w-=tt,this}subVectors(tt,lt){return this.x=tt.x-lt.x,this.y=tt.y-lt.y,this.z=tt.z-lt.z,this.w=tt.w-lt.w,this}multiply(tt){return this.x*=tt.x,this.y*=tt.y,this.z*=tt.z,this.w*=tt.w,this}multiplyScalar(tt){return this.x*=tt,this.y*=tt,this.z*=tt,this.w*=tt,this}applyMatrix4(tt){const lt=this.x,ht=this.y,_t=this.z,bt=this.w,Pt=tt.elements;return this.x=Pt[0]*lt+Pt[4]*ht+Pt[8]*_t+Pt[12]*bt,this.y=Pt[1]*lt+Pt[5]*ht+Pt[9]*_t+Pt[13]*bt,this.z=Pt[2]*lt+Pt[6]*ht+Pt[10]*_t+Pt[14]*bt,this.w=Pt[3]*lt+Pt[7]*ht+Pt[11]*_t+Pt[15]*bt,this}divideScalar(tt){return this.multiplyScalar(1/tt)}setAxisAngleFromQuaternion(tt){this.w=2*Math.acos(tt.w);const lt=Math.sqrt(1-tt.w*tt.w);return lt<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=tt.x/lt,this.y=tt.y/lt,this.z=tt.z/lt),this}setAxisAngleFromRotationMatrix(tt){let lt,ht,_t,bt;const Pt=tt.elements,Mt=Pt[0],Lt=Pt[4],Nt=Pt[8],jt=Pt[1],Wt=Pt[5],Qt=Pt[9],qt=Pt[2],Xt=Pt[6],Zt=Pt[10];if(Math.abs(Lt-jt)<.01&&Math.abs(Nt-qt)<.01&&Math.abs(Qt-Xt)<.01){if(Math.abs(Lt+jt)<.1&&Math.abs(Nt+qt)<.1&&Math.abs(Qt+Xt)<.1&&Math.abs(Mt+Wt+Zt-3)<.1)return this.set(1,0,0,0),this;lt=Math.PI;const ar=(Mt+1)/2,er=(Wt+1)/2,tr=(Zt+1)/2,Ar=(Lt+jt)/4,wr=(Nt+qt)/4,br=(Qt+Xt)/4;return ar>er&&ar>tr?ar<.01?(ht=0,_t=.707106781,bt=.707106781):(ht=Math.sqrt(ar),_t=Ar/ht,bt=wr/ht):er>tr?er<.01?(ht=.707106781,_t=0,bt=.707106781):(_t=Math.sqrt(er),ht=Ar/_t,bt=br/_t):tr<.01?(ht=.707106781,_t=.707106781,bt=0):(bt=Math.sqrt(tr),ht=wr/bt,_t=br/bt),this.set(ht,_t,bt,lt),this}let Yt=Math.sqrt((Xt-Qt)*(Xt-Qt)+(Nt-qt)*(Nt-qt)+(jt-Lt)*(jt-Lt));return Math.abs(Yt)<.001&&(Yt=1),this.x=(Xt-Qt)/Yt,this.y=(Nt-qt)/Yt,this.z=(jt-Lt)/Yt,this.w=Math.acos((Mt+Wt+Zt-1)/2),this}min(tt){return this.x=Math.min(this.x,tt.x),this.y=Math.min(this.y,tt.y),this.z=Math.min(this.z,tt.z),this.w=Math.min(this.w,tt.w),this}max(tt){return this.x=Math.max(this.x,tt.x),this.y=Math.max(this.y,tt.y),this.z=Math.max(this.z,tt.z),this.w=Math.max(this.w,tt.w),this}clamp(tt,lt){return this.x=Math.max(tt.x,Math.min(lt.x,this.x)),this.y=Math.max(tt.y,Math.min(lt.y,this.y)),this.z=Math.max(tt.z,Math.min(lt.z,this.z)),this.w=Math.max(tt.w,Math.min(lt.w,this.w)),this}clampScalar(tt,lt){return this.x=Math.max(tt,Math.min(lt,this.x)),this.y=Math.max(tt,Math.min(lt,this.y)),this.z=Math.max(tt,Math.min(lt,this.z)),this.w=Math.max(tt,Math.min(lt,this.w)),this}clampLength(tt,lt){const ht=this.length();return this.divideScalar(ht||1).multiplyScalar(Math.max(tt,Math.min(lt,ht)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(tt){return this.x*tt.x+this.y*tt.y+this.z*tt.z+this.w*tt.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(tt){return this.normalize().multiplyScalar(tt)}lerp(tt,lt){return this.x+=(tt.x-this.x)*lt,this.y+=(tt.y-this.y)*lt,this.z+=(tt.z-this.z)*lt,this.w+=(tt.w-this.w)*lt,this}lerpVectors(tt,lt,ht){return this.x=tt.x+(lt.x-tt.x)*ht,this.y=tt.y+(lt.y-tt.y)*ht,this.z=tt.z+(lt.z-tt.z)*ht,this.w=tt.w+(lt.w-tt.w)*ht,this}equals(tt){return tt.x===this.x&&tt.y===this.y&&tt.z===this.z&&tt.w===this.w}fromArray(tt,lt=0){return this.x=tt[lt],this.y=tt[lt+1],this.z=tt[lt+2],this.w=tt[lt+3],this}toArray(tt=[],lt=0){return tt[lt]=this.x,tt[lt+1]=this.y,tt[lt+2]=this.z,tt[lt+3]=this.w,tt}fromBufferAttribute(tt,lt){return this.x=tt.getX(lt),this.y=tt.getY(lt),this.z=tt.getZ(lt),this.w=tt.getW(lt),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class iv extends go{constructor(tt=1,lt=1,ht={}){super(),this.isRenderTarget=!0,this.width=tt,this.height=lt,this.depth=1,this.scissor=new Rs(0,0,tt,lt),this.scissorTest=!1,this.viewport=new Rs(0,0,tt,lt);const _t={width:tt,height:lt,depth:1};ht.encoding!==void 0&&(_u("THREE.WebGLRenderTarget: option.encoding has been replaced by option.colorSpace."),ht.colorSpace=ht.encoding===Dl?Ns:Ds),ht=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:Wn,depthBuffer:!0,stencilBuffer:!1,depthTexture:null,samples:0},ht),this.texture=new js(_t,ht.mapping,ht.wrapS,ht.wrapT,ht.magFilter,ht.minFilter,ht.format,ht.type,ht.anisotropy,ht.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=ht.generateMipmaps,this.texture.internalFormat=ht.internalFormat,this.depthBuffer=ht.depthBuffer,this.stencilBuffer=ht.stencilBuffer,this.depthTexture=ht.depthTexture,this.samples=ht.samples}setSize(tt,lt,ht=1){this.width===tt&&this.height===lt&&this.depth===ht||(this.width=tt,this.height=lt,this.depth=ht,this.texture.image.width=tt,this.texture.image.height=lt,this.texture.image.depth=ht,this.dispose()),this.viewport.set(0,0,tt,lt),this.scissor.set(0,0,tt,lt)}clone(){return new this.constructor().copy(this)}copy(tt){this.width=tt.width,this.height=tt.height,this.depth=tt.depth,this.scissor.copy(tt.scissor),this.scissorTest=tt.scissorTest,this.viewport.copy(tt.viewport),this.texture=tt.texture.clone(),this.texture.isRenderTargetTexture=!0;const lt=Object.assign({},tt.texture.image);return this.texture.source=new qo(lt),this.depthBuffer=tt.depthBuffer,this.stencilBuffer=tt.stencilBuffer,tt.depthTexture&&(this.depthTexture=tt.depthTexture.clone()),this.samples=tt.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class wo extends iv{constructor(tt=1,lt=1,ht={}){super(tt,lt,ht),this.isWebGLRenderTarget=!0}}class nm extends js{constructor(tt=null,lt=1,ht=1,_t=1){super(null),this.isDataArrayTexture=!0,this.image={data:tt,width:lt,height:ht,depth:_t},this.magFilter=rn,this.minFilter=rn,this.wrapR=vn,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class n_ extends wo{constructor(tt=1,lt=1,ht=1){super(tt,lt),this.isWebGLArrayRenderTarget=!0,this.depth=ht,this.texture=new nm(null,tt,lt,ht),this.texture.isRenderTargetTexture=!0}}class s_ extends js{constructor(tt=null,lt=1,ht=1,_t=1){super(null),this.isData3DTexture=!0,this.image={data:tt,width:lt,height:ht,depth:_t},this.magFilter=rn,this.minFilter=rn,this.wrapR=vn,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class k0 extends wo{constructor(tt=1,lt=1,ht=1){super(tt,lt),this.isWebGL3DRenderTarget=!0,this.depth=ht,this.texture=new s_(null,tt,lt,ht),this.texture.isRenderTargetTexture=!0}}class a_ extends wo{constructor(tt=1,lt=1,ht=1,_t={}){super(tt,lt,_t),this.isWebGLMultipleRenderTargets=!0;const bt=this.texture;this.texture=[];for(let Pt=0;Pt<ht;Pt++)this.texture[Pt]=bt.clone(),this.texture[Pt].isRenderTargetTexture=!0}setSize(tt,lt,ht=1){if(this.width!==tt||this.height!==lt||this.depth!==ht){this.width=tt,this.height=lt,this.depth=ht;for(let _t=0,bt=this.texture.length;_t<bt;_t++)this.texture[_t].image.width=tt,this.texture[_t].image.height=lt,this.texture[_t].image.depth=ht;this.dispose()}this.viewport.set(0,0,tt,lt),this.scissor.set(0,0,tt,lt)}copy(tt){this.dispose(),this.width=tt.width,this.height=tt.height,this.depth=tt.depth,this.scissor.copy(tt.scissor),this.scissorTest=tt.scissorTest,this.viewport.copy(tt.viewport),this.depthBuffer=tt.depthBuffer,this.stencilBuffer=tt.stencilBuffer,tt.depthTexture!==null&&(this.depthTexture=tt.depthTexture.clone()),this.texture.length=0;for(let lt=0,ht=tt.texture.length;lt<ht;lt++)this.texture[lt]=tt.texture[lt].clone(),this.texture[lt].isRenderTargetTexture=!0;return this}}class Eo{constructor(tt=0,lt=0,ht=0,_t=1){this.isQuaternion=!0,this._x=tt,this._y=lt,this._z=ht,this._w=_t}static slerpFlat(tt,lt,ht,_t,bt,Pt,Mt){let Lt=ht[_t+0],Nt=ht[_t+1],jt=ht[_t+2],Wt=ht[_t+3];const Qt=bt[Pt+0],qt=bt[Pt+1],Xt=bt[Pt+2],Zt=bt[Pt+3];if(Mt===0)return tt[lt+0]=Lt,tt[lt+1]=Nt,tt[lt+2]=jt,void(tt[lt+3]=Wt);if(Mt===1)return tt[lt+0]=Qt,tt[lt+1]=qt,tt[lt+2]=Xt,void(tt[lt+3]=Zt);if(Wt!==Zt||Lt!==Qt||Nt!==qt||jt!==Xt){let Yt=1-Mt;const ar=Lt*Qt+Nt*qt+jt*Xt+Wt*Zt,er=ar>=0?1:-1,tr=1-ar*ar;if(tr>Number.EPSILON){const wr=Math.sqrt(tr),br=Math.atan2(wr,ar*er);Yt=Math.sin(Yt*br)/wr,Mt=Math.sin(Mt*br)/wr}const Ar=Mt*er;if(Lt=Lt*Yt+Qt*Ar,Nt=Nt*Yt+qt*Ar,jt=jt*Yt+Xt*Ar,Wt=Wt*Yt+Zt*Ar,Yt===1-Mt){const wr=1/Math.sqrt(Lt*Lt+Nt*Nt+jt*jt+Wt*Wt);Lt*=wr,Nt*=wr,jt*=wr,Wt*=wr}}tt[lt]=Lt,tt[lt+1]=Nt,tt[lt+2]=jt,tt[lt+3]=Wt}static multiplyQuaternionsFlat(tt,lt,ht,_t,bt,Pt){const Mt=ht[_t],Lt=ht[_t+1],Nt=ht[_t+2],jt=ht[_t+3],Wt=bt[Pt],Qt=bt[Pt+1],qt=bt[Pt+2],Xt=bt[Pt+3];return tt[lt]=Mt*Xt+jt*Wt+Lt*qt-Nt*Qt,tt[lt+1]=Lt*Xt+jt*Qt+Nt*Wt-Mt*qt,tt[lt+2]=Nt*Xt+jt*qt+Mt*Qt-Lt*Wt,tt[lt+3]=jt*Xt-Mt*Wt-Lt*Qt-Nt*qt,tt}get x(){return this._x}set x(tt){this._x=tt,this._onChangeCallback()}get y(){return this._y}set y(tt){this._y=tt,this._onChangeCallback()}get z(){return this._z}set z(tt){this._z=tt,this._onChangeCallback()}get w(){return this._w}set w(tt){this._w=tt,this._onChangeCallback()}set(tt,lt,ht,_t){return this._x=tt,this._y=lt,this._z=ht,this._w=_t,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(tt){return this._x=tt.x,this._y=tt.y,this._z=tt.z,this._w=tt.w,this._onChangeCallback(),this}setFromEuler(tt,lt){const ht=tt._x,_t=tt._y,bt=tt._z,Pt=tt._order,Mt=Math.cos,Lt=Math.sin,Nt=Mt(ht/2),jt=Mt(_t/2),Wt=Mt(bt/2),Qt=Lt(ht/2),qt=Lt(_t/2),Xt=Lt(bt/2);switch(Pt){case"XYZ":this._x=Qt*jt*Wt+Nt*qt*Xt,this._y=Nt*qt*Wt-Qt*jt*Xt,this._z=Nt*jt*Xt+Qt*qt*Wt,this._w=Nt*jt*Wt-Qt*qt*Xt;break;case"YXZ":this._x=Qt*jt*Wt+Nt*qt*Xt,this._y=Nt*qt*Wt-Qt*jt*Xt,this._z=Nt*jt*Xt-Qt*qt*Wt,this._w=Nt*jt*Wt+Qt*qt*Xt;break;case"ZXY":this._x=Qt*jt*Wt-Nt*qt*Xt,this._y=Nt*qt*Wt+Qt*jt*Xt,this._z=Nt*jt*Xt+Qt*qt*Wt,this._w=Nt*jt*Wt-Qt*qt*Xt;break;case"ZYX":this._x=Qt*jt*Wt-Nt*qt*Xt,this._y=Nt*qt*Wt+Qt*jt*Xt,this._z=Nt*jt*Xt-Qt*qt*Wt,this._w=Nt*jt*Wt+Qt*qt*Xt;break;case"YZX":this._x=Qt*jt*Wt+Nt*qt*Xt,this._y=Nt*qt*Wt+Qt*jt*Xt,this._z=Nt*jt*Xt-Qt*qt*Wt,this._w=Nt*jt*Wt-Qt*qt*Xt;break;case"XZY":this._x=Qt*jt*Wt-Nt*qt*Xt,this._y=Nt*qt*Wt-Qt*jt*Xt,this._z=Nt*jt*Xt+Qt*qt*Wt,this._w=Nt*jt*Wt+Qt*qt*Xt;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+Pt)}return lt!==!1&&this._onChangeCallback(),this}setFromAxisAngle(tt,lt){const ht=lt/2,_t=Math.sin(ht);return this._x=tt.x*_t,this._y=tt.y*_t,this._z=tt.z*_t,this._w=Math.cos(ht),this._onChangeCallback(),this}setFromRotationMatrix(tt){const lt=tt.elements,ht=lt[0],_t=lt[4],bt=lt[8],Pt=lt[1],Mt=lt[5],Lt=lt[9],Nt=lt[2],jt=lt[6],Wt=lt[10],Qt=ht+Mt+Wt;if(Qt>0){const qt=.5/Math.sqrt(Qt+1);this._w=.25/qt,this._x=(jt-Lt)*qt,this._y=(bt-Nt)*qt,this._z=(Pt-_t)*qt}else if(ht>Mt&&ht>Wt){const qt=2*Math.sqrt(1+ht-Mt-Wt);this._w=(jt-Lt)/qt,this._x=.25*qt,this._y=(_t+Pt)/qt,this._z=(bt+Nt)/qt}else if(Mt>Wt){const qt=2*Math.sqrt(1+Mt-ht-Wt);this._w=(bt-Nt)/qt,this._x=(_t+Pt)/qt,this._y=.25*qt,this._z=(Lt+jt)/qt}else{const qt=2*Math.sqrt(1+Wt-ht-Mt);this._w=(Pt-_t)/qt,this._x=(bt+Nt)/qt,this._y=(Lt+jt)/qt,this._z=.25*qt}return this._onChangeCallback(),this}setFromUnitVectors(tt,lt){let ht=tt.dot(lt)+1;return ht<Number.EPSILON?(ht=0,Math.abs(tt.x)>Math.abs(tt.z)?(this._x=-tt.y,this._y=tt.x,this._z=0,this._w=ht):(this._x=0,this._y=-tt.z,this._z=tt.y,this._w=ht)):(this._x=tt.y*lt.z-tt.z*lt.y,this._y=tt.z*lt.x-tt.x*lt.z,this._z=tt.x*lt.y-tt.y*lt.x,this._w=ht),this.normalize()}angleTo(tt){return 2*Math.acos(Math.abs(Qs(this.dot(tt),-1,1)))}rotateTowards(tt,lt){const ht=this.angleTo(tt);if(ht===0)return this;const _t=Math.min(1,lt/ht);return this.slerp(tt,_t),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(tt){return this._x*tt._x+this._y*tt._y+this._z*tt._z+this._w*tt._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let tt=this.length();return tt===0?(this._x=0,this._y=0,this._z=0,this._w=1):(tt=1/tt,this._x=this._x*tt,this._y=this._y*tt,this._z=this._z*tt,this._w=this._w*tt),this._onChangeCallback(),this}multiply(tt){return this.multiplyQuaternions(this,tt)}premultiply(tt){return this.multiplyQuaternions(tt,this)}multiplyQuaternions(tt,lt){const ht=tt._x,_t=tt._y,bt=tt._z,Pt=tt._w,Mt=lt._x,Lt=lt._y,Nt=lt._z,jt=lt._w;return this._x=ht*jt+Pt*Mt+_t*Nt-bt*Lt,this._y=_t*jt+Pt*Lt+bt*Mt-ht*Nt,this._z=bt*jt+Pt*Nt+ht*Lt-_t*Mt,this._w=Pt*jt-ht*Mt-_t*Lt-bt*Nt,this._onChangeCallback(),this}slerp(tt,lt){if(lt===0)return this;if(lt===1)return this.copy(tt);const ht=this._x,_t=this._y,bt=this._z,Pt=this._w;let Mt=Pt*tt._w+ht*tt._x+_t*tt._y+bt*tt._z;if(Mt<0?(this._w=-tt._w,this._x=-tt._x,this._y=-tt._y,this._z=-tt._z,Mt=-Mt):this.copy(tt),Mt>=1)return this._w=Pt,this._x=ht,this._y=_t,this._z=bt,this;const Lt=1-Mt*Mt;if(Lt<=Number.EPSILON){const qt=1-lt;return this._w=qt*Pt+lt*this._w,this._x=qt*ht+lt*this._x,this._y=qt*_t+lt*this._y,this._z=qt*bt+lt*this._z,this.normalize(),this._onChangeCallback(),this}const Nt=Math.sqrt(Lt),jt=Math.atan2(Nt,Mt),Wt=Math.sin((1-lt)*jt)/Nt,Qt=Math.sin(lt*jt)/Nt;return this._w=Pt*Wt+this._w*Qt,this._x=ht*Wt+this._x*Qt,this._y=_t*Wt+this._y*Qt,this._z=bt*Wt+this._z*Qt,this._onChangeCallback(),this}slerpQuaternions(tt,lt,ht){return this.copy(tt).slerp(lt,ht)}random(){const tt=Math.random(),lt=Math.sqrt(1-tt),ht=Math.sqrt(tt),_t=2*Math.PI*Math.random(),bt=2*Math.PI*Math.random();return this.set(lt*Math.cos(_t),ht*Math.sin(bt),ht*Math.cos(bt),lt*Math.sin(_t))}equals(tt){return tt._x===this._x&&tt._y===this._y&&tt._z===this._z&&tt._w===this._w}fromArray(tt,lt=0){return this._x=tt[lt],this._y=tt[lt+1],this._z=tt[lt+2],this._w=tt[lt+3],this._onChangeCallback(),this}toArray(tt=[],lt=0){return tt[lt]=this._x,tt[lt+1]=this._y,tt[lt+2]=this._z,tt[lt+3]=this._w,tt}fromBufferAttribute(tt,lt){return this._x=tt.getX(lt),this._y=tt.getY(lt),this._z=tt.getZ(lt),this._w=tt.getW(lt),this}toJSON(){return this.toArray()}_onChange(tt){return this._onChangeCallback=tt,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class Sr{constructor(tt=0,lt=0,ht=0){Sr.prototype.isVector3=!0,this.x=tt,this.y=lt,this.z=ht}set(tt,lt,ht){return ht===void 0&&(ht=this.z),this.x=tt,this.y=lt,this.z=ht,this}setScalar(tt){return this.x=tt,this.y=tt,this.z=tt,this}setX(tt){return this.x=tt,this}setY(tt){return this.y=tt,this}setZ(tt){return this.z=tt,this}setComponent(tt,lt){switch(tt){case 0:this.x=lt;break;case 1:this.y=lt;break;case 2:this.z=lt;break;default:throw new Error("index is out of range: "+tt)}return this}getComponent(tt){switch(tt){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+tt)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(tt){return this.x=tt.x,this.y=tt.y,this.z=tt.z,this}add(tt){return this.x+=tt.x,this.y+=tt.y,this.z+=tt.z,this}addScalar(tt){return this.x+=tt,this.y+=tt,this.z+=tt,this}addVectors(tt,lt){return this.x=tt.x+lt.x,this.y=tt.y+lt.y,this.z=tt.z+lt.z,this}addScaledVector(tt,lt){return this.x+=tt.x*lt,this.y+=tt.y*lt,this.z+=tt.z*lt,this}sub(tt){return this.x-=tt.x,this.y-=tt.y,this.z-=tt.z,this}subScalar(tt){return this.x-=tt,this.y-=tt,this.z-=tt,this}subVectors(tt,lt){return this.x=tt.x-lt.x,this.y=tt.y-lt.y,this.z=tt.z-lt.z,this}multiply(tt){return this.x*=tt.x,this.y*=tt.y,this.z*=tt.z,this}multiplyScalar(tt){return this.x*=tt,this.y*=tt,this.z*=tt,this}multiplyVectors(tt,lt){return this.x=tt.x*lt.x,this.y=tt.y*lt.y,this.z=tt.z*lt.z,this}applyEuler(tt){return this.applyQuaternion(sm.setFromEuler(tt))}applyAxisAngle(tt,lt){return this.applyQuaternion(sm.setFromAxisAngle(tt,lt))}applyMatrix3(tt){const lt=this.x,ht=this.y,_t=this.z,bt=tt.elements;return this.x=bt[0]*lt+bt[3]*ht+bt[6]*_t,this.y=bt[1]*lt+bt[4]*ht+bt[7]*_t,this.z=bt[2]*lt+bt[5]*ht+bt[8]*_t,this}applyNormalMatrix(tt){return this.applyMatrix3(tt).normalize()}applyMatrix4(tt){const lt=this.x,ht=this.y,_t=this.z,bt=tt.elements,Pt=1/(bt[3]*lt+bt[7]*ht+bt[11]*_t+bt[15]);return this.x=(bt[0]*lt+bt[4]*ht+bt[8]*_t+bt[12])*Pt,this.y=(bt[1]*lt+bt[5]*ht+bt[9]*_t+bt[13])*Pt,this.z=(bt[2]*lt+bt[6]*ht+bt[10]*_t+bt[14])*Pt,this}applyQuaternion(tt){const lt=this.x,ht=this.y,_t=this.z,bt=tt.x,Pt=tt.y,Mt=tt.z,Lt=tt.w,Nt=Lt*lt+Pt*_t-Mt*ht,jt=Lt*ht+Mt*lt-bt*_t,Wt=Lt*_t+bt*ht-Pt*lt,Qt=-bt*lt-Pt*ht-Mt*_t;return this.x=Nt*Lt+Qt*-bt+jt*-Mt-Wt*-Pt,this.y=jt*Lt+Qt*-Pt+Wt*-bt-Nt*-Mt,this.z=Wt*Lt+Qt*-Mt+Nt*-Pt-jt*-bt,this}project(tt){return this.applyMatrix4(tt.matrixWorldInverse).applyMatrix4(tt.projectionMatrix)}unproject(tt){return this.applyMatrix4(tt.projectionMatrixInverse).applyMatrix4(tt.matrixWorld)}transformDirection(tt){const lt=this.x,ht=this.y,_t=this.z,bt=tt.elements;return this.x=bt[0]*lt+bt[4]*ht+bt[8]*_t,this.y=bt[1]*lt+bt[5]*ht+bt[9]*_t,this.z=bt[2]*lt+bt[6]*ht+bt[10]*_t,this.normalize()}divide(tt){return this.x/=tt.x,this.y/=tt.y,this.z/=tt.z,this}divideScalar(tt){return this.multiplyScalar(1/tt)}min(tt){return this.x=Math.min(this.x,tt.x),this.y=Math.min(this.y,tt.y),this.z=Math.min(this.z,tt.z),this}max(tt){return this.x=Math.max(this.x,tt.x),this.y=Math.max(this.y,tt.y),this.z=Math.max(this.z,tt.z),this}clamp(tt,lt){return this.x=Math.max(tt.x,Math.min(lt.x,this.x)),this.y=Math.max(tt.y,Math.min(lt.y,this.y)),this.z=Math.max(tt.z,Math.min(lt.z,this.z)),this}clampScalar(tt,lt){return this.x=Math.max(tt,Math.min(lt,this.x)),this.y=Math.max(tt,Math.min(lt,this.y)),this.z=Math.max(tt,Math.min(lt,this.z)),this}clampLength(tt,lt){const ht=this.length();return this.divideScalar(ht||1).multiplyScalar(Math.max(tt,Math.min(lt,ht)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(tt){return this.x*tt.x+this.y*tt.y+this.z*tt.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(tt){return this.normalize().multiplyScalar(tt)}lerp(tt,lt){return this.x+=(tt.x-this.x)*lt,this.y+=(tt.y-this.y)*lt,this.z+=(tt.z-this.z)*lt,this}lerpVectors(tt,lt,ht){return this.x=tt.x+(lt.x-tt.x)*ht,this.y=tt.y+(lt.y-tt.y)*ht,this.z=tt.z+(lt.z-tt.z)*ht,this}cross(tt){return this.crossVectors(this,tt)}crossVectors(tt,lt){const ht=tt.x,_t=tt.y,bt=tt.z,Pt=lt.x,Mt=lt.y,Lt=lt.z;return this.x=_t*Lt-bt*Mt,this.y=bt*Pt-ht*Lt,this.z=ht*Mt-_t*Pt,this}projectOnVector(tt){const lt=tt.lengthSq();if(lt===0)return this.set(0,0,0);const ht=tt.dot(this)/lt;return this.copy(tt).multiplyScalar(ht)}projectOnPlane(tt){return o_.copy(this).projectOnVector(tt),this.sub(o_)}reflect(tt){return this.sub(o_.copy(tt).multiplyScalar(2*this.dot(tt)))}angleTo(tt){const lt=Math.sqrt(this.lengthSq()*tt.lengthSq());if(lt===0)return Math.PI/2;const ht=this.dot(tt)/lt;return Math.acos(Qs(ht,-1,1))}distanceTo(tt){return Math.sqrt(this.distanceToSquared(tt))}distanceToSquared(tt){const lt=this.x-tt.x,ht=this.y-tt.y,_t=this.z-tt.z;return lt*lt+ht*ht+_t*_t}manhattanDistanceTo(tt){return Math.abs(this.x-tt.x)+Math.abs(this.y-tt.y)+Math.abs(this.z-tt.z)}setFromSpherical(tt){return this.setFromSphericalCoords(tt.radius,tt.phi,tt.theta)}setFromSphericalCoords(tt,lt,ht){const _t=Math.sin(lt)*tt;return this.x=_t*Math.sin(ht),this.y=Math.cos(lt)*tt,this.z=_t*Math.cos(ht),this}setFromCylindrical(tt){return this.setFromCylindricalCoords(tt.radius,tt.theta,tt.y)}setFromCylindricalCoords(tt,lt,ht){return this.x=tt*Math.sin(lt),this.y=ht,this.z=tt*Math.cos(lt),this}setFromMatrixPosition(tt){const lt=tt.elements;return this.x=lt[12],this.y=lt[13],this.z=lt[14],this}setFromMatrixScale(tt){const lt=this.setFromMatrixColumn(tt,0).length(),ht=this.setFromMatrixColumn(tt,1).length(),_t=this.setFromMatrixColumn(tt,2).length();return this.x=lt,this.y=ht,this.z=_t,this}setFromMatrixColumn(tt,lt){return this.fromArray(tt.elements,4*lt)}setFromMatrix3Column(tt,lt){return this.fromArray(tt.elements,3*lt)}setFromEuler(tt){return this.x=tt._x,this.y=tt._y,this.z=tt._z,this}setFromColor(tt){return this.x=tt.r,this.y=tt.g,this.z=tt.b,this}equals(tt){return tt.x===this.x&&tt.y===this.y&&tt.z===this.z}fromArray(tt,lt=0){return this.x=tt[lt],this.y=tt[lt+1],this.z=tt[lt+2],this}toArray(tt=[],lt=0){return tt[lt]=this.x,tt[lt+1]=this.y,tt[lt+2]=this.z,tt}fromBufferAttribute(tt,lt){return this.x=tt.getX(lt),this.y=tt.getY(lt),this.z=tt.getZ(lt),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const tt=2*(Math.random()-.5),lt=Math.random()*Math.PI*2,ht=Math.sqrt(1-tt**2);return this.x=ht*Math.cos(lt),this.y=ht*Math.sin(lt),this.z=tt,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const o_=new Sr,sm=new Eo;class Al{constructor(tt=new Sr(1/0,1/0,1/0),lt=new Sr(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=tt,this.max=lt}set(tt,lt){return this.min.copy(tt),this.max.copy(lt),this}setFromArray(tt){this.makeEmpty();for(let lt=0,ht=tt.length;lt<ht;lt+=3)this.expandByPoint($o.fromArray(tt,lt));return this}setFromBufferAttribute(tt){this.makeEmpty();for(let lt=0,ht=tt.count;lt<ht;lt++)this.expandByPoint($o.fromBufferAttribute(tt,lt));return this}setFromPoints(tt){this.makeEmpty();for(let lt=0,ht=tt.length;lt<ht;lt++)this.expandByPoint(tt[lt]);return this}setFromCenterAndSize(tt,lt){const ht=$o.copy(lt).multiplyScalar(.5);return this.min.copy(tt).sub(ht),this.max.copy(tt).add(ht),this}setFromObject(tt,lt=!1){return this.makeEmpty(),this.expandByObject(tt,lt)}clone(){return new this.constructor().copy(this)}copy(tt){return this.min.copy(tt.min),this.max.copy(tt.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(tt){return this.isEmpty()?tt.set(0,0,0):tt.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(tt){return this.isEmpty()?tt.set(0,0,0):tt.subVectors(this.max,this.min)}expandByPoint(tt){return this.min.min(tt),this.max.max(tt),this}expandByVector(tt){return this.min.sub(tt),this.max.add(tt),this}expandByScalar(tt){return this.min.addScalar(-tt),this.max.addScalar(tt),this}expandByObject(tt,lt=!1){if(tt.updateWorldMatrix(!1,!1),tt.boundingBox!==void 0)tt.boundingBox===null&&tt.computeBoundingBox(),Nu.copy(tt.boundingBox),Nu.applyMatrix4(tt.matrixWorld),this.union(Nu);else{const _t=tt.geometry;if(_t!==void 0)if(lt&&_t.attributes!==void 0&&_t.attributes.position!==void 0){const bt=_t.attributes.position;for(let Pt=0,Mt=bt.count;Pt<Mt;Pt++)$o.fromBufferAttribute(bt,Pt).applyMatrix4(tt.matrixWorld),this.expandByPoint($o)}else _t.boundingBox===null&&_t.computeBoundingBox(),Nu.copy(_t.boundingBox),Nu.applyMatrix4(tt.matrixWorld),this.union(Nu)}const ht=tt.children;for(let _t=0,bt=ht.length;_t<bt;_t++)this.expandByObject(ht[_t],lt);return this}containsPoint(tt){return!(tt.x<this.min.x||tt.x>this.max.x||tt.y<this.min.y||tt.y>this.max.y||tt.z<this.min.z||tt.z>this.max.z)}containsBox(tt){return this.min.x<=tt.min.x&&tt.max.x<=this.max.x&&this.min.y<=tt.min.y&&tt.max.y<=this.max.y&&this.min.z<=tt.min.z&&tt.max.z<=this.max.z}getParameter(tt,lt){return lt.set((tt.x-this.min.x)/(this.max.x-this.min.x),(tt.y-this.min.y)/(this.max.y-this.min.y),(tt.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(tt){return!(tt.max.x<this.min.x||tt.min.x>this.max.x||tt.max.y<this.min.y||tt.min.y>this.max.y||tt.max.z<this.min.z||tt.min.z>this.max.z)}intersectsSphere(tt){return this.clampPoint(tt.center,$o),$o.distanceToSquared(tt.center)<=tt.radius*tt.radius}intersectsPlane(tt){let lt,ht;return tt.normal.x>0?(lt=tt.normal.x*this.min.x,ht=tt.normal.x*this.max.x):(lt=tt.normal.x*this.max.x,ht=tt.normal.x*this.min.x),tt.normal.y>0?(lt+=tt.normal.y*this.min.y,ht+=tt.normal.y*this.max.y):(lt+=tt.normal.y*this.max.y,ht+=tt.normal.y*this.min.y),tt.normal.z>0?(lt+=tt.normal.z*this.min.z,ht+=tt.normal.z*this.max.z):(lt+=tt.normal.z*this.max.z,ht+=tt.normal.z*this.min.z),lt<=-tt.constant&&ht>=-tt.constant}intersectsTriangle(tt){if(this.isEmpty())return!1;this.getCenter(_p),am.subVectors(this.max,_p),Fu.subVectors(tt.a,_p),Uu.subVectors(tt.b,_p),ju.subVectors(tt.c,_p),wl.subVectors(Uu,Fu),Yl.subVectors(ju,Uu),vu.subVectors(Fu,ju);let lt=[0,-wl.z,wl.y,0,-Yl.z,Yl.y,0,-vu.z,vu.y,wl.z,0,-wl.x,Yl.z,0,-Yl.x,vu.z,0,-vu.x,-wl.y,wl.x,0,-Yl.y,Yl.x,0,-vu.y,vu.x,0];return!!El(lt,Fu,Uu,ju,am)&&(lt=[1,0,0,0,1,0,0,0,1],!!El(lt,Fu,Uu,ju,am)&&(om.crossVectors(wl,Yl),lt=[om.x,om.y,om.z],El(lt,Fu,Uu,ju,am)))}clampPoint(tt,lt){return lt.copy(tt).clamp(this.min,this.max)}distanceToPoint(tt){return this.clampPoint(tt,$o).distanceTo(tt)}getBoundingSphere(tt){return this.isEmpty()?tt.makeEmpty():(this.getCenter(tt.center),tt.radius=.5*this.getSize($o).length()),tt}intersect(tt){return this.min.max(tt.min),this.max.min(tt.max),this.isEmpty()&&this.makeEmpty(),this}union(tt){return this.min.min(tt.min),this.max.max(tt.max),this}applyMatrix4(tt){return this.isEmpty()||(Bl[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(tt),Bl[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(tt),Bl[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(tt),Bl[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(tt),Bl[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(tt),Bl[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(tt),Bl[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(tt),Bl[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(tt),this.setFromPoints(Bl)),this}translate(tt){return this.min.add(tt),this.max.add(tt),this}equals(tt){return tt.min.equals(this.min)&&tt.max.equals(this.max)}}const Bl=[new Sr,new Sr,new Sr,new Sr,new Sr,new Sr,new Sr,new Sr],$o=new Sr,Nu=new Al,Fu=new Sr,Uu=new Sr,ju=new Sr,wl=new Sr,Yl=new Sr,vu=new Sr,_p=new Sr,am=new Sr,om=new Sr,yu=new Sr;function El(St,tt,lt,ht,_t){for(let bt=0,Pt=St.length-3;bt<=Pt;bt+=3){yu.fromArray(St,bt);const Mt=_t.x*Math.abs(yu.x)+_t.y*Math.abs(yu.y)+_t.z*Math.abs(yu.z),Lt=tt.dot(yu),Nt=lt.dot(yu),jt=ht.dot(yu);if(Math.max(-Math.max(Lt,Nt,jt),Math.min(Lt,Nt,jt))>Mt)return!1}return!0}const nv=new Al,fp=new Sr,vp=new Sr;class Go{constructor(tt=new Sr,lt=-1){this.center=tt,this.radius=lt}set(tt,lt){return this.center.copy(tt),this.radius=lt,this}setFromPoints(tt,lt){const ht=this.center;lt!==void 0?ht.copy(lt):nv.setFromPoints(tt).getCenter(ht);let _t=0;for(let bt=0,Pt=tt.length;bt<Pt;bt++)_t=Math.max(_t,ht.distanceToSquared(tt[bt]));return this.radius=Math.sqrt(_t),this}copy(tt){return this.center.copy(tt.center),this.radius=tt.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(tt){return tt.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(tt){return tt.distanceTo(this.center)-this.radius}intersectsSphere(tt){const lt=this.radius+tt.radius;return tt.center.distanceToSquared(this.center)<=lt*lt}intersectsBox(tt){return tt.intersectsSphere(this)}intersectsPlane(tt){return Math.abs(tt.distanceToPoint(this.center))<=this.radius}clampPoint(tt,lt){const ht=this.center.distanceToSquared(tt);return lt.copy(tt),ht>this.radius*this.radius&&(lt.sub(this.center).normalize(),lt.multiplyScalar(this.radius).add(this.center)),lt}getBoundingBox(tt){return this.isEmpty()?(tt.makeEmpty(),tt):(tt.set(this.center,this.center),tt.expandByScalar(this.radius),tt)}applyMatrix4(tt){return this.center.applyMatrix4(tt),this.radius=this.radius*tt.getMaxScaleOnAxis(),this}translate(tt){return this.center.add(tt),this}expandByPoint(tt){if(this.isEmpty())return this.center.copy(tt),this.radius=0,this;fp.subVectors(tt,this.center);const lt=fp.lengthSq();if(lt>this.radius*this.radius){const ht=Math.sqrt(lt),_t=.5*(ht-this.radius);this.center.addScaledVector(fp,_t/ht),this.radius+=_t}return this}union(tt){return tt.isEmpty()?this:this.isEmpty()?(this.copy(tt),this):(this.center.equals(tt.center)===!0?this.radius=Math.max(this.radius,tt.radius):(vp.subVectors(tt.center,this.center).setLength(tt.radius),this.expandByPoint(fp.copy(tt.center).add(vp)),this.expandByPoint(fp.copy(tt.center).sub(vp))),this)}equals(tt){return tt.center.equals(this.center)&&tt.radius===this.radius}clone(){return new this.constructor().copy(this)}}const Sl=new Sr,l_=new Sr,Xo=new Sr,Ll=new Sr,Kl=new Sr,lm=new Sr,Cl=new Sr;class Gu{constructor(tt=new Sr,lt=new Sr(0,0,-1)){this.origin=tt,this.direction=lt}set(tt,lt){return this.origin.copy(tt),this.direction.copy(lt),this}copy(tt){return this.origin.copy(tt.origin),this.direction.copy(tt.direction),this}at(tt,lt){return lt.copy(this.origin).addScaledVector(this.direction,tt)}lookAt(tt){return this.direction.copy(tt).sub(this.origin).normalize(),this}recast(tt){return this.origin.copy(this.at(tt,Sl)),this}closestPointToPoint(tt,lt){lt.subVectors(tt,this.origin);const ht=lt.dot(this.direction);return ht<0?lt.copy(this.origin):lt.copy(this.origin).addScaledVector(this.direction,ht)}distanceToPoint(tt){return Math.sqrt(this.distanceSqToPoint(tt))}distanceSqToPoint(tt){const lt=Sl.subVectors(tt,this.origin).dot(this.direction);return lt<0?this.origin.distanceToSquared(tt):(Sl.copy(this.origin).addScaledVector(this.direction,lt),Sl.distanceToSquared(tt))}distanceSqToSegment(tt,lt,ht,_t){l_.copy(tt).add(lt).multiplyScalar(.5),Xo.copy(lt).sub(tt).normalize(),Ll.copy(this.origin).sub(l_);const bt=.5*tt.distanceTo(lt),Pt=-this.direction.dot(Xo),Mt=Ll.dot(this.direction),Lt=-Ll.dot(Xo),Nt=Ll.lengthSq(),jt=Math.abs(1-Pt*Pt);let Wt,Qt,qt,Xt;if(jt>0)if(Wt=Pt*Lt-Mt,Qt=Pt*Mt-Lt,Xt=bt*jt,Wt>=0)if(Qt>=-Xt)if(Qt<=Xt){const Zt=1/jt;Wt*=Zt,Qt*=Zt,qt=Wt*(Wt+Pt*Qt+2*Mt)+Qt*(Pt*Wt+Qt+2*Lt)+Nt}else Qt=bt,Wt=Math.max(0,-(Pt*Qt+Mt)),qt=-Wt*Wt+Qt*(Qt+2*Lt)+Nt;else Qt=-bt,Wt=Math.max(0,-(Pt*Qt+Mt)),qt=-Wt*Wt+Qt*(Qt+2*Lt)+Nt;else Qt<=-Xt?(Wt=Math.max(0,-(-Pt*bt+Mt)),Qt=Wt>0?-bt:Math.min(Math.max(-bt,-Lt),bt),qt=-Wt*Wt+Qt*(Qt+2*Lt)+Nt):Qt<=Xt?(Wt=0,Qt=Math.min(Math.max(-bt,-Lt),bt),qt=Qt*(Qt+2*Lt)+Nt):(Wt=Math.max(0,-(Pt*bt+Mt)),Qt=Wt>0?bt:Math.min(Math.max(-bt,-Lt),bt),qt=-Wt*Wt+Qt*(Qt+2*Lt)+Nt);else Qt=Pt>0?-bt:bt,Wt=Math.max(0,-(Pt*Qt+Mt)),qt=-Wt*Wt+Qt*(Qt+2*Lt)+Nt;return ht&&ht.copy(this.origin).addScaledVector(this.direction,Wt),_t&&_t.copy(l_).addScaledVector(Xo,Qt),qt}intersectSphere(tt,lt){Sl.subVectors(tt.center,this.origin);const ht=Sl.dot(this.direction),_t=Sl.dot(Sl)-ht*ht,bt=tt.radius*tt.radius;if(_t>bt)return null;const Pt=Math.sqrt(bt-_t),Mt=ht-Pt,Lt=ht+Pt;return Lt<0?null:Mt<0?this.at(Lt,lt):this.at(Mt,lt)}intersectsSphere(tt){return this.distanceSqToPoint(tt.center)<=tt.radius*tt.radius}distanceToPlane(tt){const lt=tt.normal.dot(this.direction);if(lt===0)return tt.distanceToPoint(this.origin)===0?0:null;const ht=-(this.origin.dot(tt.normal)+tt.constant)/lt;return ht>=0?ht:null}intersectPlane(tt,lt){const ht=this.distanceToPlane(tt);return ht===null?null:this.at(ht,lt)}intersectsPlane(tt){const lt=tt.distanceToPoint(this.origin);return lt===0||tt.normal.dot(this.direction)*lt<0}intersectBox(tt,lt){let ht,_t,bt,Pt,Mt,Lt;const Nt=1/this.direction.x,jt=1/this.direction.y,Wt=1/this.direction.z,Qt=this.origin;return Nt>=0?(ht=(tt.min.x-Qt.x)*Nt,_t=(tt.max.x-Qt.x)*Nt):(ht=(tt.max.x-Qt.x)*Nt,_t=(tt.min.x-Qt.x)*Nt),jt>=0?(bt=(tt.min.y-Qt.y)*jt,Pt=(tt.max.y-Qt.y)*jt):(bt=(tt.max.y-Qt.y)*jt,Pt=(tt.min.y-Qt.y)*jt),ht>Pt||bt>_t?null:((bt>ht||isNaN(ht))&&(ht=bt),(Pt<_t||isNaN(_t))&&(_t=Pt),Wt>=0?(Mt=(tt.min.z-Qt.z)*Wt,Lt=(tt.max.z-Qt.z)*Wt):(Mt=(tt.max.z-Qt.z)*Wt,Lt=(tt.min.z-Qt.z)*Wt),ht>Lt||Mt>_t?null:((Mt>ht||ht!=ht)&&(ht=Mt),(Lt<_t||_t!=_t)&&(_t=Lt),_t<0?null:this.at(ht>=0?ht:_t,lt)))}intersectsBox(tt){return this.intersectBox(tt,Sl)!==null}intersectTriangle(tt,lt,ht,_t,bt){Kl.subVectors(lt,tt),lm.subVectors(ht,tt),Cl.crossVectors(Kl,lm);let Pt,Mt=this.direction.dot(Cl);if(Mt>0){if(_t)return null;Pt=1}else{if(!(Mt<0))return null;Pt=-1,Mt=-Mt}Ll.subVectors(this.origin,tt);const Lt=Pt*this.direction.dot(lm.crossVectors(Ll,lm));if(Lt<0)return null;const Nt=Pt*this.direction.dot(Kl.cross(Ll));if(Nt<0||Lt+Nt>Mt)return null;const jt=-Pt*Ll.dot(Cl);return jt<0?null:this.at(jt/Mt,bt)}applyMatrix4(tt){return this.origin.applyMatrix4(tt),this.direction.transformDirection(tt),this}equals(tt){return tt.origin.equals(this.origin)&&tt.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class is{constructor(tt,lt,ht,_t,bt,Pt,Mt,Lt,Nt,jt,Wt,Qt,qt,Xt,Zt,Yt){is.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],tt!==void 0&&this.set(tt,lt,ht,_t,bt,Pt,Mt,Lt,Nt,jt,Wt,Qt,qt,Xt,Zt,Yt)}set(tt,lt,ht,_t,bt,Pt,Mt,Lt,Nt,jt,Wt,Qt,qt,Xt,Zt,Yt){const ar=this.elements;return ar[0]=tt,ar[4]=lt,ar[8]=ht,ar[12]=_t,ar[1]=bt,ar[5]=Pt,ar[9]=Mt,ar[13]=Lt,ar[2]=Nt,ar[6]=jt,ar[10]=Wt,ar[14]=Qt,ar[3]=qt,ar[7]=Xt,ar[11]=Zt,ar[15]=Yt,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new is().fromArray(this.elements)}copy(tt){const lt=this.elements,ht=tt.elements;return lt[0]=ht[0],lt[1]=ht[1],lt[2]=ht[2],lt[3]=ht[3],lt[4]=ht[4],lt[5]=ht[5],lt[6]=ht[6],lt[7]=ht[7],lt[8]=ht[8],lt[9]=ht[9],lt[10]=ht[10],lt[11]=ht[11],lt[12]=ht[12],lt[13]=ht[13],lt[14]=ht[14],lt[15]=ht[15],this}copyPosition(tt){const lt=this.elements,ht=tt.elements;return lt[12]=ht[12],lt[13]=ht[13],lt[14]=ht[14],this}setFromMatrix3(tt){const lt=tt.elements;return this.set(lt[0],lt[3],lt[6],0,lt[1],lt[4],lt[7],0,lt[2],lt[5],lt[8],0,0,0,0,1),this}extractBasis(tt,lt,ht){return tt.setFromMatrixColumn(this,0),lt.setFromMatrixColumn(this,1),ht.setFromMatrixColumn(this,2),this}makeBasis(tt,lt,ht){return this.set(tt.x,lt.x,ht.x,0,tt.y,lt.y,ht.y,0,tt.z,lt.z,ht.z,0,0,0,0,1),this}extractRotation(tt){const lt=this.elements,ht=tt.elements,_t=1/zu.setFromMatrixColumn(tt,0).length(),bt=1/zu.setFromMatrixColumn(tt,1).length(),Pt=1/zu.setFromMatrixColumn(tt,2).length();return lt[0]=ht[0]*_t,lt[1]=ht[1]*_t,lt[2]=ht[2]*_t,lt[3]=0,lt[4]=ht[4]*bt,lt[5]=ht[5]*bt,lt[6]=ht[6]*bt,lt[7]=0,lt[8]=ht[8]*Pt,lt[9]=ht[9]*Pt,lt[10]=ht[10]*Pt,lt[11]=0,lt[12]=0,lt[13]=0,lt[14]=0,lt[15]=1,this}makeRotationFromEuler(tt){const lt=this.elements,ht=tt.x,_t=tt.y,bt=tt.z,Pt=Math.cos(ht),Mt=Math.sin(ht),Lt=Math.cos(_t),Nt=Math.sin(_t),jt=Math.cos(bt),Wt=Math.sin(bt);if(tt.order==="XYZ"){const Qt=Pt*jt,qt=Pt*Wt,Xt=Mt*jt,Zt=Mt*Wt;lt[0]=Lt*jt,lt[4]=-Lt*Wt,lt[8]=Nt,lt[1]=qt+Xt*Nt,lt[5]=Qt-Zt*Nt,lt[9]=-Mt*Lt,lt[2]=Zt-Qt*Nt,lt[6]=Xt+qt*Nt,lt[10]=Pt*Lt}else if(tt.order==="YXZ"){const Qt=Lt*jt,qt=Lt*Wt,Xt=Nt*jt,Zt=Nt*Wt;lt[0]=Qt+Zt*Mt,lt[4]=Xt*Mt-qt,lt[8]=Pt*Nt,lt[1]=Pt*Wt,lt[5]=Pt*jt,lt[9]=-Mt,lt[2]=qt*Mt-Xt,lt[6]=Zt+Qt*Mt,lt[10]=Pt*Lt}else if(tt.order==="ZXY"){const Qt=Lt*jt,qt=Lt*Wt,Xt=Nt*jt,Zt=Nt*Wt;lt[0]=Qt-Zt*Mt,lt[4]=-Pt*Wt,lt[8]=Xt+qt*Mt,lt[1]=qt+Xt*Mt,lt[5]=Pt*jt,lt[9]=Zt-Qt*Mt,lt[2]=-Pt*Nt,lt[6]=Mt,lt[10]=Pt*Lt}else if(tt.order==="ZYX"){const Qt=Pt*jt,qt=Pt*Wt,Xt=Mt*jt,Zt=Mt*Wt;lt[0]=Lt*jt,lt[4]=Xt*Nt-qt,lt[8]=Qt*Nt+Zt,lt[1]=Lt*Wt,lt[5]=Zt*Nt+Qt,lt[9]=qt*Nt-Xt,lt[2]=-Nt,lt[6]=Mt*Lt,lt[10]=Pt*Lt}else if(tt.order==="YZX"){const Qt=Pt*Lt,qt=Pt*Nt,Xt=Mt*Lt,Zt=Mt*Nt;lt[0]=Lt*jt,lt[4]=Zt-Qt*Wt,lt[8]=Xt*Wt+qt,lt[1]=Wt,lt[5]=Pt*jt,lt[9]=-Mt*jt,lt[2]=-Nt*jt,lt[6]=qt*Wt+Xt,lt[10]=Qt-Zt*Wt}else if(tt.order==="XZY"){const Qt=Pt*Lt,qt=Pt*Nt,Xt=Mt*Lt,Zt=Mt*Nt;lt[0]=Lt*jt,lt[4]=-Wt,lt[8]=Nt*jt,lt[1]=Qt*Wt+Zt,lt[5]=Pt*jt,lt[9]=qt*Wt-Xt,lt[2]=Xt*Wt-qt,lt[6]=Mt*jt,lt[10]=Zt*Wt+Qt}return lt[3]=0,lt[7]=0,lt[11]=0,lt[12]=0,lt[13]=0,lt[14]=0,lt[15]=1,this}makeRotationFromQuaternion(tt){return this.compose(Vu,tt,sv)}lookAt(tt,lt,ht){const _t=this.elements;return fo.subVectors(tt,lt),fo.lengthSq()===0&&(fo.z=1),fo.normalize(),Jl.crossVectors(ht,fo),Jl.lengthSq()===0&&(Math.abs(ht.z)===1?fo.x+=1e-4:fo.z+=1e-4,fo.normalize(),Jl.crossVectors(ht,fo)),Jl.normalize(),cm.crossVectors(fo,Jl),_t[0]=Jl.x,_t[4]=cm.x,_t[8]=fo.x,_t[1]=Jl.y,_t[5]=cm.y,_t[9]=fo.y,_t[2]=Jl.z,_t[6]=cm.z,_t[10]=fo.z,this}multiply(tt){return this.multiplyMatrices(this,tt)}premultiply(tt){return this.multiplyMatrices(tt,this)}multiplyMatrices(tt,lt){const ht=tt.elements,_t=lt.elements,bt=this.elements,Pt=ht[0],Mt=ht[4],Lt=ht[8],Nt=ht[12],jt=ht[1],Wt=ht[5],Qt=ht[9],qt=ht[13],Xt=ht[2],Zt=ht[6],Yt=ht[10],ar=ht[14],er=ht[3],tr=ht[7],Ar=ht[11],wr=ht[15],br=_t[0],Mr=_t[4],Qr=_t[8],Fr=_t[12],Vr=_t[1],zr=_t[5],Hr=_t[9],_n=_t[13],hn=_t[2],Rn=_t[6],Bn=_t[10],un=_t[14],Xr=_t[3],Jr=_t[7],an=_t[11],sn=_t[15];return bt[0]=Pt*br+Mt*Vr+Lt*hn+Nt*Xr,bt[4]=Pt*Mr+Mt*zr+Lt*Rn+Nt*Jr,bt[8]=Pt*Qr+Mt*Hr+Lt*Bn+Nt*an,bt[12]=Pt*Fr+Mt*_n+Lt*un+Nt*sn,bt[1]=jt*br+Wt*Vr+Qt*hn+qt*Xr,bt[5]=jt*Mr+Wt*zr+Qt*Rn+qt*Jr,bt[9]=jt*Qr+Wt*Hr+Qt*Bn+qt*an,bt[13]=jt*Fr+Wt*_n+Qt*un+qt*sn,bt[2]=Xt*br+Zt*Vr+Yt*hn+ar*Xr,bt[6]=Xt*Mr+Zt*zr+Yt*Rn+ar*Jr,bt[10]=Xt*Qr+Zt*Hr+Yt*Bn+ar*an,bt[14]=Xt*Fr+Zt*_n+Yt*un+ar*sn,bt[3]=er*br+tr*Vr+Ar*hn+wr*Xr,bt[7]=er*Mr+tr*zr+Ar*Rn+wr*Jr,bt[11]=er*Qr+tr*Hr+Ar*Bn+wr*an,bt[15]=er*Fr+tr*_n+Ar*un+wr*sn,this}multiplyScalar(tt){const lt=this.elements;return lt[0]*=tt,lt[4]*=tt,lt[8]*=tt,lt[12]*=tt,lt[1]*=tt,lt[5]*=tt,lt[9]*=tt,lt[13]*=tt,lt[2]*=tt,lt[6]*=tt,lt[10]*=tt,lt[14]*=tt,lt[3]*=tt,lt[7]*=tt,lt[11]*=tt,lt[15]*=tt,this}determinant(){const tt=this.elements,lt=tt[0],ht=tt[4],_t=tt[8],bt=tt[12],Pt=tt[1],Mt=tt[5],Lt=tt[9],Nt=tt[13],jt=tt[2],Wt=tt[6],Qt=tt[10],qt=tt[14];return tt[3]*(+bt*Lt*Wt-_t*Nt*Wt-bt*Mt*Qt+ht*Nt*Qt+_t*Mt*qt-ht*Lt*qt)+tt[7]*(+lt*Lt*qt-lt*Nt*Qt+bt*Pt*Qt-_t*Pt*qt+_t*Nt*jt-bt*Lt*jt)+tt[11]*(+lt*Nt*Wt-lt*Mt*qt-bt*Pt*Wt+ht*Pt*qt+bt*Mt*jt-ht*Nt*jt)+tt[15]*(-_t*Mt*jt-lt*Lt*Wt+lt*Mt*Qt+_t*Pt*Wt-ht*Pt*Qt+ht*Lt*jt)}transpose(){const tt=this.elements;let lt;return lt=tt[1],tt[1]=tt[4],tt[4]=lt,lt=tt[2],tt[2]=tt[8],tt[8]=lt,lt=tt[6],tt[6]=tt[9],tt[9]=lt,lt=tt[3],tt[3]=tt[12],tt[12]=lt,lt=tt[7],tt[7]=tt[13],tt[13]=lt,lt=tt[11],tt[11]=tt[14],tt[14]=lt,this}setPosition(tt,lt,ht){const _t=this.elements;return tt.isVector3?(_t[12]=tt.x,_t[13]=tt.y,_t[14]=tt.z):(_t[12]=tt,_t[13]=lt,_t[14]=ht),this}invert(){const tt=this.elements,lt=tt[0],ht=tt[1],_t=tt[2],bt=tt[3],Pt=tt[4],Mt=tt[5],Lt=tt[6],Nt=tt[7],jt=tt[8],Wt=tt[9],Qt=tt[10],qt=tt[11],Xt=tt[12],Zt=tt[13],Yt=tt[14],ar=tt[15],er=Wt*Yt*Nt-Zt*Qt*Nt+Zt*Lt*qt-Mt*Yt*qt-Wt*Lt*ar+Mt*Qt*ar,tr=Xt*Qt*Nt-jt*Yt*Nt-Xt*Lt*qt+Pt*Yt*qt+jt*Lt*ar-Pt*Qt*ar,Ar=jt*Zt*Nt-Xt*Wt*Nt+Xt*Mt*qt-Pt*Zt*qt-jt*Mt*ar+Pt*Wt*ar,wr=Xt*Wt*Lt-jt*Zt*Lt-Xt*Mt*Qt+Pt*Zt*Qt+jt*Mt*Yt-Pt*Wt*Yt,br=lt*er+ht*tr+_t*Ar+bt*wr;if(br===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const Mr=1/br;return tt[0]=er*Mr,tt[1]=(Zt*Qt*bt-Wt*Yt*bt-Zt*_t*qt+ht*Yt*qt+Wt*_t*ar-ht*Qt*ar)*Mr,tt[2]=(Mt*Yt*bt-Zt*Lt*bt+Zt*_t*Nt-ht*Yt*Nt-Mt*_t*ar+ht*Lt*ar)*Mr,tt[3]=(Wt*Lt*bt-Mt*Qt*bt-Wt*_t*Nt+ht*Qt*Nt+Mt*_t*qt-ht*Lt*qt)*Mr,tt[4]=tr*Mr,tt[5]=(jt*Yt*bt-Xt*Qt*bt+Xt*_t*qt-lt*Yt*qt-jt*_t*ar+lt*Qt*ar)*Mr,tt[6]=(Xt*Lt*bt-Pt*Yt*bt-Xt*_t*Nt+lt*Yt*Nt+Pt*_t*ar-lt*Lt*ar)*Mr,tt[7]=(Pt*Qt*bt-jt*Lt*bt+jt*_t*Nt-lt*Qt*Nt-Pt*_t*qt+lt*Lt*qt)*Mr,tt[8]=Ar*Mr,tt[9]=(Xt*Wt*bt-jt*Zt*bt-Xt*ht*qt+lt*Zt*qt+jt*ht*ar-lt*Wt*ar)*Mr,tt[10]=(Pt*Zt*bt-Xt*Mt*bt+Xt*ht*Nt-lt*Zt*Nt-Pt*ht*ar+lt*Mt*ar)*Mr,tt[11]=(jt*Mt*bt-Pt*Wt*bt-jt*ht*Nt+lt*Wt*Nt+Pt*ht*qt-lt*Mt*qt)*Mr,tt[12]=wr*Mr,tt[13]=(jt*Zt*_t-Xt*Wt*_t+Xt*ht*Qt-lt*Zt*Qt-jt*ht*Yt+lt*Wt*Yt)*Mr,tt[14]=(Xt*Mt*_t-Pt*Zt*_t-Xt*ht*Lt+lt*Zt*Lt+Pt*ht*Yt-lt*Mt*Yt)*Mr,tt[15]=(Pt*Wt*_t-jt*Mt*_t+jt*ht*Lt-lt*Wt*Lt-Pt*ht*Qt+lt*Mt*Qt)*Mr,this}scale(tt){const lt=this.elements,ht=tt.x,_t=tt.y,bt=tt.z;return lt[0]*=ht,lt[4]*=_t,lt[8]*=bt,lt[1]*=ht,lt[5]*=_t,lt[9]*=bt,lt[2]*=ht,lt[6]*=_t,lt[10]*=bt,lt[3]*=ht,lt[7]*=_t,lt[11]*=bt,this}getMaxScaleOnAxis(){const tt=this.elements,lt=tt[0]*tt[0]+tt[1]*tt[1]+tt[2]*tt[2],ht=tt[4]*tt[4]+tt[5]*tt[5]+tt[6]*tt[6],_t=tt[8]*tt[8]+tt[9]*tt[9]+tt[10]*tt[10];return Math.sqrt(Math.max(lt,ht,_t))}makeTranslation(tt,lt,ht){return tt.isVector3?this.set(1,0,0,tt.x,0,1,0,tt.y,0,0,1,tt.z,0,0,0,1):this.set(1,0,0,tt,0,1,0,lt,0,0,1,ht,0,0,0,1),this}makeRotationX(tt){const lt=Math.cos(tt),ht=Math.sin(tt);return this.set(1,0,0,0,0,lt,-ht,0,0,ht,lt,0,0,0,0,1),this}makeRotationY(tt){const lt=Math.cos(tt),ht=Math.sin(tt);return this.set(lt,0,ht,0,0,1,0,0,-ht,0,lt,0,0,0,0,1),this}makeRotationZ(tt){const lt=Math.cos(tt),ht=Math.sin(tt);return this.set(lt,-ht,0,0,ht,lt,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(tt,lt){const ht=Math.cos(lt),_t=Math.sin(lt),bt=1-ht,Pt=tt.x,Mt=tt.y,Lt=tt.z,Nt=bt*Pt,jt=bt*Mt;return this.set(Nt*Pt+ht,Nt*Mt-_t*Lt,Nt*Lt+_t*Mt,0,Nt*Mt+_t*Lt,jt*Mt+ht,jt*Lt-_t*Pt,0,Nt*Lt-_t*Mt,jt*Lt+_t*Pt,bt*Lt*Lt+ht,0,0,0,0,1),this}makeScale(tt,lt,ht){return this.set(tt,0,0,0,0,lt,0,0,0,0,ht,0,0,0,0,1),this}makeShear(tt,lt,ht,_t,bt,Pt){return this.set(1,ht,bt,0,tt,1,Pt,0,lt,_t,1,0,0,0,0,1),this}compose(tt,lt,ht){const _t=this.elements,bt=lt._x,Pt=lt._y,Mt=lt._z,Lt=lt._w,Nt=bt+bt,jt=Pt+Pt,Wt=Mt+Mt,Qt=bt*Nt,qt=bt*jt,Xt=bt*Wt,Zt=Pt*jt,Yt=Pt*Wt,ar=Mt*Wt,er=Lt*Nt,tr=Lt*jt,Ar=Lt*Wt,wr=ht.x,br=ht.y,Mr=ht.z;return _t[0]=(1-(Zt+ar))*wr,_t[1]=(qt+Ar)*wr,_t[2]=(Xt-tr)*wr,_t[3]=0,_t[4]=(qt-Ar)*br,_t[5]=(1-(Qt+ar))*br,_t[6]=(Yt+er)*br,_t[7]=0,_t[8]=(Xt+tr)*Mr,_t[9]=(Yt-er)*Mr,_t[10]=(1-(Qt+Zt))*Mr,_t[11]=0,_t[12]=tt.x,_t[13]=tt.y,_t[14]=tt.z,_t[15]=1,this}decompose(tt,lt,ht){const _t=this.elements;let bt=zu.set(_t[0],_t[1],_t[2]).length();const Pt=zu.set(_t[4],_t[5],_t[6]).length(),Mt=zu.set(_t[8],_t[9],_t[10]).length();this.determinant()<0&&(bt=-bt),tt.x=_t[12],tt.y=_t[13],tt.z=_t[14],Yo.copy(this);const Lt=1/bt,Nt=1/Pt,jt=1/Mt;return Yo.elements[0]*=Lt,Yo.elements[1]*=Lt,Yo.elements[2]*=Lt,Yo.elements[4]*=Nt,Yo.elements[5]*=Nt,Yo.elements[6]*=Nt,Yo.elements[8]*=jt,Yo.elements[9]*=jt,Yo.elements[10]*=jt,lt.setFromRotationMatrix(Yo),ht.x=bt,ht.y=Pt,ht.z=Mt,this}makePerspective(tt,lt,ht,_t,bt,Pt,Mt=jo){const Lt=this.elements,Nt=2*bt/(lt-tt),jt=2*bt/(ht-_t),Wt=(lt+tt)/(lt-tt),Qt=(ht+_t)/(ht-_t);let qt,Xt;if(Mt===jo)qt=-(Pt+bt)/(Pt-bt),Xt=-2*Pt*bt/(Pt-bt);else{if(Mt!==Wo)throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+Mt);qt=-Pt/(Pt-bt),Xt=-Pt*bt/(Pt-bt)}return Lt[0]=Nt,Lt[4]=0,Lt[8]=Wt,Lt[12]=0,Lt[1]=0,Lt[5]=jt,Lt[9]=Qt,Lt[13]=0,Lt[2]=0,Lt[6]=0,Lt[10]=qt,Lt[14]=Xt,Lt[3]=0,Lt[7]=0,Lt[11]=-1,Lt[15]=0,this}makeOrthographic(tt,lt,ht,_t,bt,Pt,Mt=jo){const Lt=this.elements,Nt=1/(lt-tt),jt=1/(ht-_t),Wt=1/(Pt-bt),Qt=(lt+tt)*Nt,qt=(ht+_t)*jt;let Xt,Zt;if(Mt===jo)Xt=(Pt+bt)*Wt,Zt=-2*Wt;else{if(Mt!==Wo)throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+Mt);Xt=bt*Wt,Zt=-1*Wt}return Lt[0]=2*Nt,Lt[4]=0,Lt[8]=0,Lt[12]=-Qt,Lt[1]=0,Lt[5]=2*jt,Lt[9]=0,Lt[13]=-qt,Lt[2]=0,Lt[6]=0,Lt[10]=Zt,Lt[14]=-Xt,Lt[3]=0,Lt[7]=0,Lt[11]=0,Lt[15]=1,this}equals(tt){const lt=this.elements,ht=tt.elements;for(let _t=0;_t<16;_t++)if(lt[_t]!==ht[_t])return!1;return!0}fromArray(tt,lt=0){for(let ht=0;ht<16;ht++)this.elements[ht]=tt[ht+lt];return this}toArray(tt=[],lt=0){const ht=this.elements;return tt[lt]=ht[0],tt[lt+1]=ht[1],tt[lt+2]=ht[2],tt[lt+3]=ht[3],tt[lt+4]=ht[4],tt[lt+5]=ht[5],tt[lt+6]=ht[6],tt[lt+7]=ht[7],tt[lt+8]=ht[8],tt[lt+9]=ht[9],tt[lt+10]=ht[10],tt[lt+11]=ht[11],tt[lt+12]=ht[12],tt[lt+13]=ht[13],tt[lt+14]=ht[14],tt[lt+15]=ht[15],tt}}const zu=new Sr,Yo=new is,Vu=new Sr(0,0,0),sv=new Sr(1,1,1),Jl=new Sr,cm=new Sr,fo=new Sr,av=new is,bu=new Eo;class Hu{constructor(tt=0,lt=0,ht=0,_t=Hu.DEFAULT_ORDER){this.isEuler=!0,this._x=tt,this._y=lt,this._z=ht,this._order=_t}get x(){return this._x}set x(tt){this._x=tt,this._onChangeCallback()}get y(){return this._y}set y(tt){this._y=tt,this._onChangeCallback()}get z(){return this._z}set z(tt){this._z=tt,this._onChangeCallback()}get order(){return this._order}set order(tt){this._order=tt,this._onChangeCallback()}set(tt,lt,ht,_t=this._order){return this._x=tt,this._y=lt,this._z=ht,this._order=_t,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(tt){return this._x=tt._x,this._y=tt._y,this._z=tt._z,this._order=tt._order,this._onChangeCallback(),this}setFromRotationMatrix(tt,lt=this._order,ht=!0){const _t=tt.elements,bt=_t[0],Pt=_t[4],Mt=_t[8],Lt=_t[1],Nt=_t[5],jt=_t[9],Wt=_t[2],Qt=_t[6],qt=_t[10];switch(lt){case"XYZ":this._y=Math.asin(Qs(Mt,-1,1)),Math.abs(Mt)<.9999999?(this._x=Math.atan2(-jt,qt),this._z=Math.atan2(-Pt,bt)):(this._x=Math.atan2(Qt,Nt),this._z=0);break;case"YXZ":this._x=Math.asin(-Qs(jt,-1,1)),Math.abs(jt)<.9999999?(this._y=Math.atan2(Mt,qt),this._z=Math.atan2(Lt,Nt)):(this._y=Math.atan2(-Wt,bt),this._z=0);break;case"ZXY":this._x=Math.asin(Qs(Qt,-1,1)),Math.abs(Qt)<.9999999?(this._y=Math.atan2(-Wt,qt),this._z=Math.atan2(-Pt,Nt)):(this._y=0,this._z=Math.atan2(Lt,bt));break;case"ZYX":this._y=Math.asin(-Qs(Wt,-1,1)),Math.abs(Wt)<.9999999?(this._x=Math.atan2(Qt,qt),this._z=Math.atan2(Lt,bt)):(this._x=0,this._z=Math.atan2(-Pt,Nt));break;case"YZX":this._z=Math.asin(Qs(Lt,-1,1)),Math.abs(Lt)<.9999999?(this._x=Math.atan2(-jt,Nt),this._y=Math.atan2(-Wt,bt)):(this._x=0,this._y=Math.atan2(Mt,qt));break;case"XZY":this._z=Math.asin(-Qs(Pt,-1,1)),Math.abs(Pt)<.9999999?(this._x=Math.atan2(Qt,Nt),this._y=Math.atan2(Mt,bt)):(this._x=Math.atan2(-jt,qt),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+lt)}return this._order=lt,ht===!0&&this._onChangeCallback(),this}setFromQuaternion(tt,lt,ht){return av.makeRotationFromQuaternion(tt),this.setFromRotationMatrix(av,lt,ht)}setFromVector3(tt,lt=this._order){return this.set(tt.x,tt.y,tt.z,lt)}reorder(tt){return bu.setFromEuler(this),this.setFromQuaternion(bu,tt)}equals(tt){return tt._x===this._x&&tt._y===this._y&&tt._z===this._z&&tt._order===this._order}fromArray(tt){return this._x=tt[0],this._y=tt[1],this._z=tt[2],tt[3]!==void 0&&(this._order=tt[3]),this._onChangeCallback(),this}toArray(tt=[],lt=0){return tt[lt]=this._x,tt[lt+1]=this._y,tt[lt+2]=this._z,tt[lt+3]=this._order,tt}_onChange(tt){return this._onChangeCallback=tt,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}Hu.DEFAULT_ORDER="XYZ";class um{constructor(){this.mask=1}set(tt){this.mask=1<<tt>>>0}enable(tt){this.mask|=1<<tt}enableAll(){this.mask=-1}toggle(tt){this.mask^=1<<tt}disable(tt){this.mask&=~(1<<tt)}disableAll(){this.mask=0}test(tt){return!!(this.mask&tt.mask)}isEnabled(tt){return!!(this.mask&1<<tt)}}let D0=0;const ov=new Sr,Qu=new Eo,Ro=new is,yp=new Sr,bp=new Sr,c_=new Sr,lv=new Eo,cv=new Sr(1,0,0),pm=new Sr(0,1,0),uv=new Sr(0,0,1),Zl={type:"added"},B0={type:"removed"};class Cs extends go{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:D0++}),this.uuid=Ao(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Cs.DEFAULT_UP.clone();const tt=new Sr,lt=new Hu,ht=new Eo,_t=new Sr(1,1,1);lt._onChange(function(){ht.setFromEuler(lt,!1)}),ht._onChange(function(){lt.setFromQuaternion(ht,void 0,!1)}),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:tt},rotation:{configurable:!0,enumerable:!0,value:lt},quaternion:{configurable:!0,enumerable:!0,value:ht},scale:{configurable:!0,enumerable:!0,value:_t},modelViewMatrix:{value:new is},normalMatrix:{value:new os}}),this.matrix=new is,this.matrixWorld=new is,this.matrixAutoUpdate=Cs.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.matrixWorldAutoUpdate=Cs.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.layers=new um,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(tt,lt,ht,_t,bt,Pt){this.dispatchEvent({type:"beforeRender",renderer:tt,scene:lt,camera:ht,geometry:_t,material:bt,group:Pt})}onAfterRender(tt,lt,ht,_t,bt,Pt){this.dispatchEvent({type:"afterRender",renderer:tt,scene:lt,camera:ht,geometry:_t,material:bt,group:Pt})}applyMatrix4(tt){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(tt),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(tt){return this.quaternion.premultiply(tt),this}setRotationFromAxisAngle(tt,lt){this.quaternion.setFromAxisAngle(tt,lt)}setRotationFromEuler(tt){this.quaternion.setFromEuler(tt,!0)}setRotationFromMatrix(tt){this.quaternion.setFromRotationMatrix(tt)}setRotationFromQuaternion(tt){this.quaternion.copy(tt)}rotateOnAxis(tt,lt){return Qu.setFromAxisAngle(tt,lt),this.quaternion.multiply(Qu),this}rotateOnWorldAxis(tt,lt){return Qu.setFromAxisAngle(tt,lt),this.quaternion.premultiply(Qu),this}rotateX(tt){return this.rotateOnAxis(cv,tt)}rotateY(tt){return this.rotateOnAxis(pm,tt)}rotateZ(tt){return this.rotateOnAxis(uv,tt)}translateOnAxis(tt,lt){return ov.copy(tt).applyQuaternion(this.quaternion),this.position.add(ov.multiplyScalar(lt)),this}translateX(tt){return this.translateOnAxis(cv,tt)}translateY(tt){return this.translateOnAxis(pm,tt)}translateZ(tt){return this.translateOnAxis(uv,tt)}localToWorld(tt){return this.updateWorldMatrix(!0,!1),tt.applyMatrix4(this.matrixWorld)}worldToLocal(tt){return this.updateWorldMatrix(!0,!1),tt.applyMatrix4(Ro.copy(this.matrixWorld).invert())}lookAt(tt,lt,ht){tt.isVector3?yp.copy(tt):yp.set(tt,lt,ht);const _t=this.parent;this.updateWorldMatrix(!0,!1),bp.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Ro.lookAt(bp,yp,this.up):Ro.lookAt(yp,bp,this.up),this.quaternion.setFromRotationMatrix(Ro),_t&&(Ro.extractRotation(_t.matrixWorld),Qu.setFromRotationMatrix(Ro),this.quaternion.premultiply(Qu.invert()))}add(tt){if(arguments.length>1){for(let lt=0;lt<arguments.length;lt++)this.add(arguments[lt]);return this}return tt===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",tt),this):(tt&&tt.isObject3D?(tt.parent!==null&&tt.parent.remove(tt),tt.parent=this,this.children.push(tt),tt.dispatchEvent(Zl)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",tt),this)}remove(tt){if(arguments.length>1){for(let ht=0;ht<arguments.length;ht++)this.remove(arguments[ht]);return this}const lt=this.children.indexOf(tt);return lt!==-1&&(tt.parent=null,this.children.splice(lt,1),tt.dispatchEvent(B0)),this}removeFromParent(){const tt=this.parent;return tt!==null&&tt.remove(this),this}clear(){return this.remove(...this.children)}attach(tt){return this.updateWorldMatrix(!0,!1),Ro.copy(this.matrixWorld).invert(),tt.parent!==null&&(tt.parent.updateWorldMatrix(!0,!1),Ro.multiply(tt.parent.matrixWorld)),tt.applyMatrix4(Ro),this.add(tt),tt.updateWorldMatrix(!1,!0),this}getObjectById(tt){return this.getObjectByProperty("id",tt)}getObjectByName(tt){return this.getObjectByProperty("name",tt)}getObjectByProperty(tt,lt){if(this[tt]===lt)return this;for(let ht=0,_t=this.children.length;ht<_t;ht++){const bt=this.children[ht].getObjectByProperty(tt,lt);if(bt!==void 0)return bt}}getObjectsByProperty(tt,lt){let ht=[];this[tt]===lt&&ht.push(this);for(let _t=0,bt=this.children.length;_t<bt;_t++){const Pt=this.children[_t].getObjectsByProperty(tt,lt);Pt.length>0&&(ht=ht.concat(Pt))}return ht}getWorldPosition(tt){return this.updateWorldMatrix(!0,!1),tt.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(tt){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(bp,tt,c_),tt}getWorldScale(tt){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(bp,lv,tt),tt}getWorldDirection(tt){this.updateWorldMatrix(!0,!1);const lt=this.matrixWorld.elements;return tt.set(lt[8],lt[9],lt[10]).normalize()}raycast(){}traverse(tt){tt(this);const lt=this.children;for(let ht=0,_t=lt.length;ht<_t;ht++)lt[ht].traverse(tt)}traverseVisible(tt){if(this.visible===!1)return;tt(this);const lt=this.children;for(let ht=0,_t=lt.length;ht<_t;ht++)lt[ht].traverseVisible(tt)}traverseAncestors(tt){const lt=this.parent;lt!==null&&(tt(lt),lt.traverseAncestors(tt))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(tt){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||tt)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,tt=!0);const lt=this.children;for(let ht=0,_t=lt.length;ht<_t;ht++){const bt=lt[ht];bt.matrixWorldAutoUpdate!==!0&&tt!==!0||bt.updateMatrixWorld(tt)}}updateWorldMatrix(tt,lt){const ht=this.parent;if(tt===!0&&ht!==null&&ht.matrixWorldAutoUpdate===!0&&ht.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),lt===!0){const _t=this.children;for(let bt=0,Pt=_t.length;bt<Pt;bt++){const Mt=_t[bt];Mt.matrixWorldAutoUpdate===!0&&Mt.updateWorldMatrix(!1,!0)}}}toJSON(tt){const lt=tt===void 0||typeof tt=="string",ht={};lt&&(tt={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{},extras:{}},ht.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const _t={};function bt(Mt,Lt){return Mt[Lt.uuid]===void 0&&(Mt[Lt.uuid]=Lt.toJSON(tt)),Lt.uuid}if(_t.uuid=this.uuid,_t.type=this.type,this.name!==""&&(_t.name=this.name),this.castShadow===!0&&(_t.castShadow=!0),this.receiveShadow===!0&&(_t.receiveShadow=!0),this.visible===!1&&(_t.visible=!1),this.frustumCulled===!1&&(_t.frustumCulled=!1),this.renderOrder!==0&&(_t.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(_t.userData=this.userData),_t.layers=this.layers.mask,_t.matrix=this.matrix.toArray(),_t.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(_t.matrixAutoUpdate=!1),this.isInstancedMesh&&(_t.type="InstancedMesh",_t.count=this.count,_t.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(_t.instanceColor=this.instanceColor.toJSON())),this.isScene)this.background&&(this.background.isColor?_t.background=this.background.toJSON():this.background.isTexture&&(_t.background=this.background.toJSON(tt).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(_t.environment=this.environment.toJSON(tt).uuid);else if(this.isMesh||this.isLine||this.isPoints){_t.geometry=bt(tt.geometries,this.geometry);const Mt=this.geometry.parameters;if(Mt!==void 0&&Mt.shapes!==void 0){const Lt=Mt.shapes;if(Array.isArray(Lt))for(let Nt=0,jt=Lt.length;Nt<jt;Nt++){const Wt=Lt[Nt];bt(tt.shapes,Wt)}else bt(tt.shapes,Lt)}}if(this.isSkinnedMesh&&(_t.bindMode=this.bindMode,_t.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(bt(tt.skeletons,this.skeleton),_t.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const Mt=[];for(let Lt=0,Nt=this.material.length;Lt<Nt;Lt++)Mt.push(bt(tt.materials,this.material[Lt]));_t.material=Mt}else _t.material=bt(tt.materials,this.material);if(this.children.length>0){_t.children=[];for(let Mt=0;Mt<this.children.length;Mt++)_t.children.push(this.children[Mt].toJSON(tt).object)}if(this.animations.length>0){_t.animations=[];for(let Mt=0;Mt<this.animations.length;Mt++){const Lt=this.animations[Mt];_t.animations.push(bt(tt.animations,Lt))}}if(lt){const Mt=Pt(tt.geometries),Lt=Pt(tt.materials),Nt=Pt(tt.textures),jt=Pt(tt.images),Wt=Pt(tt.shapes),Qt=Pt(tt.skeletons),qt=Pt(tt.animations),Xt=Pt(tt.nodes);Mt.length>0&&(ht.geometries=Mt),Lt.length>0&&(ht.materials=Lt),Nt.length>0&&(ht.textures=Nt),jt.length>0&&(ht.images=jt),Wt.length>0&&(ht.shapes=Wt),Qt.length>0&&(ht.skeletons=Qt),qt.length>0&&(ht.animations=qt),Xt.length>0&&(ht.nodes=Xt)}return ht.object=_t,ht;function Pt(Mt){const Lt=[];for(const Nt in Mt){const jt=Mt[Nt];delete jt.metadata,Lt.push(jt)}return Lt}}clone(tt){return new this.constructor().copy(this,tt)}copy(tt,lt=!0){this.name=tt.name,this.up.copy(tt.up),this.position.copy(tt.position),this.rotation.order=tt.rotation.order,this.quaternion.copy(tt.quaternion),this.scale.copy(tt.scale),this.matrix.copy(tt.matrix),this.matrixWorld.copy(tt.matrixWorld),this.matrixAutoUpdate=tt.matrixAutoUpdate,this.matrixWorldNeedsUpdate=tt.matrixWorldNeedsUpdate,this.matrixWorldAutoUpdate=tt.matrixWorldAutoUpdate,this.layers.mask=tt.layers.mask,this.visible=tt.visible,this.castShadow=tt.castShadow,this.receiveShadow=tt.receiveShadow,this.frustumCulled=tt.frustumCulled,this.renderOrder=tt.renderOrder,this.animations=tt.animations.slice(),this.userData={};for(const[ht,_t]of Object.entries(tt.userData))this.userData[ht]=!_t||_t&&(_t.isTexture||_t.isObject3D)?_t:JSON.parse(JSON.stringify(_t));if(lt===!0)for(let ht=0;ht<tt.children.length;ht++){const _t=tt.children[ht];this.add(_t.clone())}return this}}Cs.DEFAULT_UP=new Sr(0,1,0),Cs.DEFAULT_MATRIX_AUTO_UPDATE=!0,Cs.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const ko=new Sr,Pl=new Sr,u_=new Sr,Ol=new Sr,Wu=new Sr,qu=new Sr,pv=new Sr,p_=new Sr,Ko=new Sr,hm=new Sr;let dm=!1;class vo{constructor(tt=new Sr,lt=new Sr,ht=new Sr){this.a=tt,this.b=lt,this.c=ht}static getNormal(tt,lt,ht,_t){_t.subVectors(ht,lt),ko.subVectors(tt,lt),_t.cross(ko);const bt=_t.lengthSq();return bt>0?_t.multiplyScalar(1/Math.sqrt(bt)):_t.set(0,0,0)}static getBarycoord(tt,lt,ht,_t,bt){ko.subVectors(_t,lt),Pl.subVectors(ht,lt),u_.subVectors(tt,lt);const Pt=ko.dot(ko),Mt=ko.dot(Pl),Lt=ko.dot(u_),Nt=Pl.dot(Pl),jt=Pl.dot(u_),Wt=Pt*Nt-Mt*Mt;if(Wt===0)return bt.set(-2,-1,-1);const Qt=1/Wt,qt=(Nt*Lt-Mt*jt)*Qt,Xt=(Pt*jt-Mt*Lt)*Qt;return bt.set(1-qt-Xt,Xt,qt)}static containsPoint(tt,lt,ht,_t){return this.getBarycoord(tt,lt,ht,_t,Ol),Ol.x>=0&&Ol.y>=0&&Ol.x+Ol.y<=1}static getUV(tt,lt,ht,_t,bt,Pt,Mt,Lt){return dm===!1&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),dm=!0),this.getInterpolation(tt,lt,ht,_t,bt,Pt,Mt,Lt)}static getInterpolation(tt,lt,ht,_t,bt,Pt,Mt,Lt){return this.getBarycoord(tt,lt,ht,_t,Ol),Lt.setScalar(0),Lt.addScaledVector(bt,Ol.x),Lt.addScaledVector(Pt,Ol.y),Lt.addScaledVector(Mt,Ol.z),Lt}static isFrontFacing(tt,lt,ht,_t){return ko.subVectors(ht,lt),Pl.subVectors(tt,lt),ko.cross(Pl).dot(_t)<0}set(tt,lt,ht){return this.a.copy(tt),this.b.copy(lt),this.c.copy(ht),this}setFromPointsAndIndices(tt,lt,ht,_t){return this.a.copy(tt[lt]),this.b.copy(tt[ht]),this.c.copy(tt[_t]),this}setFromAttributeAndIndices(tt,lt,ht,_t){return this.a.fromBufferAttribute(tt,lt),this.b.fromBufferAttribute(tt,ht),this.c.fromBufferAttribute(tt,_t),this}clone(){return new this.constructor().copy(this)}copy(tt){return this.a.copy(tt.a),this.b.copy(tt.b),this.c.copy(tt.c),this}getArea(){return ko.subVectors(this.c,this.b),Pl.subVectors(this.a,this.b),.5*ko.cross(Pl).length()}getMidpoint(tt){return tt.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(tt){return vo.getNormal(this.a,this.b,this.c,tt)}getPlane(tt){return tt.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(tt,lt){return vo.getBarycoord(tt,this.a,this.b,this.c,lt)}getUV(tt,lt,ht,_t,bt){return dm===!1&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),dm=!0),vo.getInterpolation(tt,this.a,this.b,this.c,lt,ht,_t,bt)}getInterpolation(tt,lt,ht,_t,bt){return vo.getInterpolation(tt,this.a,this.b,this.c,lt,ht,_t,bt)}containsPoint(tt){return vo.containsPoint(tt,this.a,this.b,this.c)}isFrontFacing(tt){return vo.isFrontFacing(this.a,this.b,this.c,tt)}intersectsBox(tt){return tt.intersectsTriangle(this)}closestPointToPoint(tt,lt){const ht=this.a,_t=this.b,bt=this.c;let Pt,Mt;Wu.subVectors(_t,ht),qu.subVectors(bt,ht),p_.subVectors(tt,ht);const Lt=Wu.dot(p_),Nt=qu.dot(p_);if(Lt<=0&&Nt<=0)return lt.copy(ht);Ko.subVectors(tt,_t);const jt=Wu.dot(Ko),Wt=qu.dot(Ko);if(jt>=0&&Wt<=jt)return lt.copy(_t);const Qt=Lt*Wt-jt*Nt;if(Qt<=0&&Lt>=0&&jt<=0)return Pt=Lt/(Lt-jt),lt.copy(ht).addScaledVector(Wu,Pt);hm.subVectors(tt,bt);const qt=Wu.dot(hm),Xt=qu.dot(hm);if(Xt>=0&&qt<=Xt)return lt.copy(bt);const Zt=qt*Nt-Lt*Xt;if(Zt<=0&&Nt>=0&&Xt<=0)return Mt=Nt/(Nt-Xt),lt.copy(ht).addScaledVector(qu,Mt);const Yt=jt*Xt-qt*Wt;if(Yt<=0&&Wt-jt>=0&&qt-Xt>=0)return pv.subVectors(bt,_t),Mt=(Wt-jt)/(Wt-jt+(qt-Xt)),lt.copy(_t).addScaledVector(pv,Mt);const ar=1/(Yt+Zt+Qt);return Pt=Zt*ar,Mt=Qt*ar,lt.copy(ht).addScaledVector(Wu,Pt).addScaledVector(qu,Mt)}equals(tt){return tt.a.equals(this.a)&&tt.b.equals(this.b)&&tt.c.equals(this.c)}}let L0=0;class ao extends go{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:L0++}),this.uuid=Ao(),this.name="",this.type="Material",this.blending=Tt,this.side=vt,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=hr,this.blendDst=dr,this.blendEquation=Rt,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=Rr,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=dp,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Kp,this.stencilZFail=Kp,this.stencilZPass=Kp,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(tt){this._alphaTest>0!=tt>0&&this.version++,this._alphaTest=tt}onBuild(){}onBeforeRender(){}onAfterRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(tt){if(tt!==void 0)for(const lt in tt){const ht=tt[lt];if(ht===void 0){console.warn(`THREE.Material: parameter '${lt}' has value of undefined.`);continue}const _t=this[lt];_t!==void 0&&(_t&&_t.isColor?_t.set(ht):_t&&_t.isVector3&&ht&&ht.isVector3?_t.copy(ht):Array.isArray(ht)&&_t&&typeof _t.fromArray=="function"?_t.fromArray(ht):this[lt]=ht)}}toJSON(tt){const lt=tt===void 0||typeof tt=="string";lt&&(tt={textures:{},images:{}});const ht={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};function _t(bt){const Pt=[];for(const Mt in bt){const Lt=bt[Mt];delete Lt.metadata,Pt.push(Lt)}return Pt}if(ht.uuid=this.uuid,ht.type=this.type,this.name!==""&&(ht.name=this.name),this.color&&this.color.isColor&&(ht.color=this.color.getHex()),this.roughness!==void 0&&(ht.roughness=this.roughness),this.metalness!==void 0&&(ht.metalness=this.metalness),this.sheen!==void 0&&(ht.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(ht.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(ht.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(ht.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(ht.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(ht.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(ht.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(ht.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(ht.shininess=this.shininess),this.clearcoat!==void 0&&(ht.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(ht.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(ht.clearcoatMap=this.clearcoatMap.toJSON(tt).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(ht.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(tt).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(ht.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(tt).uuid,ht.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.iridescence!==void 0&&(ht.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(ht.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(ht.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(ht.iridescenceMap=this.iridescenceMap.toJSON(tt).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(ht.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(tt).uuid),this.anisotropy!==void 0&&(ht.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(ht.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(ht.anisotropyMap=this.anisotropyMap.toJSON(tt).uuid),this.map&&this.map.isTexture&&(ht.map=this.map.toJSON(tt).uuid),this.matcap&&this.matcap.isTexture&&(ht.matcap=this.matcap.toJSON(tt).uuid),this.alphaMap&&this.alphaMap.isTexture&&(ht.alphaMap=this.alphaMap.toJSON(tt).uuid),this.lightMap&&this.lightMap.isTexture&&(ht.lightMap=this.lightMap.toJSON(tt).uuid,ht.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(ht.aoMap=this.aoMap.toJSON(tt).uuid,ht.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(ht.bumpMap=this.bumpMap.toJSON(tt).uuid,ht.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(ht.normalMap=this.normalMap.toJSON(tt).uuid,ht.normalMapType=this.normalMapType,ht.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(ht.displacementMap=this.displacementMap.toJSON(tt).uuid,ht.displacementScale=this.displacementScale,ht.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(ht.roughnessMap=this.roughnessMap.toJSON(tt).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(ht.metalnessMap=this.metalnessMap.toJSON(tt).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(ht.emissiveMap=this.emissiveMap.toJSON(tt).uuid),this.specularMap&&this.specularMap.isTexture&&(ht.specularMap=this.specularMap.toJSON(tt).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(ht.specularIntensityMap=this.specularIntensityMap.toJSON(tt).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(ht.specularColorMap=this.specularColorMap.toJSON(tt).uuid),this.envMap&&this.envMap.isTexture&&(ht.envMap=this.envMap.toJSON(tt).uuid,this.combine!==void 0&&(ht.combine=this.combine)),this.envMapIntensity!==void 0&&(ht.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(ht.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(ht.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(ht.gradientMap=this.gradientMap.toJSON(tt).uuid),this.transmission!==void 0&&(ht.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(ht.transmissionMap=this.transmissionMap.toJSON(tt).uuid),this.thickness!==void 0&&(ht.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(ht.thicknessMap=this.thicknessMap.toJSON(tt).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(ht.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(ht.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(ht.size=this.size),this.shadowSide!==null&&(ht.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(ht.sizeAttenuation=this.sizeAttenuation),this.blending!==Tt&&(ht.blending=this.blending),this.side!==vt&&(ht.side=this.side),this.vertexColors===!0&&(ht.vertexColors=!0),this.opacity<1&&(ht.opacity=this.opacity),this.transparent===!0&&(ht.transparent=!0),ht.depthFunc=this.depthFunc,ht.depthTest=this.depthTest,ht.depthWrite=this.depthWrite,ht.colorWrite=this.colorWrite,ht.stencilWrite=this.stencilWrite,ht.stencilWriteMask=this.stencilWriteMask,ht.stencilFunc=this.stencilFunc,ht.stencilRef=this.stencilRef,ht.stencilFuncMask=this.stencilFuncMask,ht.stencilFail=this.stencilFail,ht.stencilZFail=this.stencilZFail,ht.stencilZPass=this.stencilZPass,this.rotation!==void 0&&this.rotation!==0&&(ht.rotation=this.rotation),this.polygonOffset===!0&&(ht.polygonOffset=!0),this.polygonOffsetFactor!==0&&(ht.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(ht.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(ht.linewidth=this.linewidth),this.dashSize!==void 0&&(ht.dashSize=this.dashSize),this.gapSize!==void 0&&(ht.gapSize=this.gapSize),this.scale!==void 0&&(ht.scale=this.scale),this.dithering===!0&&(ht.dithering=!0),this.alphaTest>0&&(ht.alphaTest=this.alphaTest),this.alphaHash===!0&&(ht.alphaHash=!0),this.alphaToCoverage===!0&&(ht.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(ht.premultipliedAlpha=!0),this.forceSinglePass===!0&&(ht.forceSinglePass=!0),this.wireframe===!0&&(ht.wireframe=!0),this.wireframeLinewidth>1&&(ht.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(ht.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(ht.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(ht.flatShading=!0),this.visible===!1&&(ht.visible=!1),this.toneMapped===!1&&(ht.toneMapped=!1),this.fog===!1&&(ht.fog=!1),Object.keys(this.userData).length>0&&(ht.userData=this.userData),lt){const bt=_t(tt.textures),Pt=_t(tt.images);bt.length>0&&(ht.textures=bt),Pt.length>0&&(ht.images=Pt)}return ht}clone(){return new this.constructor().copy(this)}copy(tt){this.name=tt.name,this.blending=tt.blending,this.side=tt.side,this.vertexColors=tt.vertexColors,this.opacity=tt.opacity,this.transparent=tt.transparent,this.blendSrc=tt.blendSrc,this.blendDst=tt.blendDst,this.blendEquation=tt.blendEquation,this.blendSrcAlpha=tt.blendSrcAlpha,this.blendDstAlpha=tt.blendDstAlpha,this.blendEquationAlpha=tt.blendEquationAlpha,this.depthFunc=tt.depthFunc,this.depthTest=tt.depthTest,this.depthWrite=tt.depthWrite,this.stencilWriteMask=tt.stencilWriteMask,this.stencilFunc=tt.stencilFunc,this.stencilRef=tt.stencilRef,this.stencilFuncMask=tt.stencilFuncMask,this.stencilFail=tt.stencilFail,this.stencilZFail=tt.stencilZFail,this.stencilZPass=tt.stencilZPass,this.stencilWrite=tt.stencilWrite;const lt=tt.clippingPlanes;let ht=null;if(lt!==null){const _t=lt.length;ht=new Array(_t);for(let bt=0;bt!==_t;++bt)ht[bt]=lt[bt].clone()}return this.clippingPlanes=ht,this.clipIntersection=tt.clipIntersection,this.clipShadows=tt.clipShadows,this.shadowSide=tt.shadowSide,this.colorWrite=tt.colorWrite,this.precision=tt.precision,this.polygonOffset=tt.polygonOffset,this.polygonOffsetFactor=tt.polygonOffsetFactor,this.polygonOffsetUnits=tt.polygonOffsetUnits,this.dithering=tt.dithering,this.alphaTest=tt.alphaTest,this.alphaHash=tt.alphaHash,this.alphaToCoverage=tt.alphaToCoverage,this.premultipliedAlpha=tt.premultipliedAlpha,this.forceSinglePass=tt.forceSinglePass,this.visible=tt.visible,this.toneMapped=tt.toneMapped,this.userData=h_({},tt.userData),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(tt){tt===!0&&this.version++}}function h_(St,tt){if(!tt)return St;for(const lt of Object.keys(tt)){if(lt.startsWith("__")||typeof St[lt]=="function"||typeof tt[lt]=="function")continue;const ht=tt[lt],_t=!ht||ht.isTexture||ht.isObject3D||ht.isMaterial;_t||typeof tt[lt].clone!="function"?_t||typeof tt[lt]!="object"&&!Array.isArray(tt[lt])?St[lt]=tt[lt]:St[lt]=h_(Array.isArray(tt[lt])?[]:{},tt[lt]):St[lt]=tt[lt].clone()}return St}const d_={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Nl={h:0,s:0,l:0},mm={h:0,s:0,l:0};function m_(St,tt,lt){return lt<0&&(lt+=1),lt>1&&(lt-=1),lt<1/6?St+6*(tt-St)*lt:lt<.5?tt:lt<2/3?St+6*(tt-St)*(2/3-lt):St}class jn{constructor(tt,lt,ht){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(tt,lt,ht)}set(tt,lt,ht){if(lt===void 0&&ht===void 0){const _t=tt;_t&&_t.isColor?this.copy(_t):typeof _t=="number"?this.setHex(_t):typeof _t=="string"&&this.setStyle(_t)}else this.setRGB(tt,lt,ht);return this}setScalar(tt){return this.r=tt,this.g=tt,this.b=tt,this}setHex(tt,lt=Ns){return tt=Math.floor(tt),this.r=(tt>>16&255)/255,this.g=(tt>>8&255)/255,this.b=(255&tt)/255,Is.toWorkingColorSpace(this,lt),this}setRGB(tt,lt,ht,_t=Is.workingColorSpace){return this.r=tt,this.g=lt,this.b=ht,Is.toWorkingColorSpace(this,_t),this}setHSL(tt,lt,ht,_t=Is.workingColorSpace){if(tt=em(tt,1),lt=Qs(lt,0,1),ht=Qs(ht,0,1),lt===0)this.r=this.g=this.b=ht;else{const bt=ht<=.5?ht*(1+lt):ht+lt-ht*lt,Pt=2*ht-bt;this.r=m_(Pt,bt,tt+1/3),this.g=m_(Pt,bt,tt),this.b=m_(Pt,bt,tt-1/3)}return Is.toWorkingColorSpace(this,_t),this}setStyle(tt,lt=Ns){function ht(bt){bt!==void 0&&parseFloat(bt)<1&&console.warn("THREE.Color: Alpha component of "+tt+" will be ignored.")}let _t;if(_t=/^(\w+)\(([^\)]*)\)/.exec(tt)){let bt;const Pt=_t[1],Mt=_t[2];switch(Pt){case"rgb":case"rgba":if(bt=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(Mt))return ht(bt[4]),this.setRGB(Math.min(255,parseInt(bt[1],10))/255,Math.min(255,parseInt(bt[2],10))/255,Math.min(255,parseInt(bt[3],10))/255,lt);if(bt=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(Mt))return ht(bt[4]),this.setRGB(Math.min(100,parseInt(bt[1],10))/100,Math.min(100,parseInt(bt[2],10))/100,Math.min(100,parseInt(bt[3],10))/100,lt);break;case"hsl":case"hsla":if(bt=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(Mt))return ht(bt[4]),this.setHSL(parseFloat(bt[1])/360,parseFloat(bt[2])/100,parseFloat(bt[3])/100,lt);break;default:console.warn("THREE.Color: Unknown color model "+tt)}}else if(_t=/^\#([A-Fa-f\d]+)$/.exec(tt)){const bt=_t[1],Pt=bt.length;if(Pt===3)return this.setRGB(parseInt(bt.charAt(0),16)/15,parseInt(bt.charAt(1),16)/15,parseInt(bt.charAt(2),16)/15,lt);if(Pt===6)return this.setHex(parseInt(bt,16),lt);console.warn("THREE.Color: Invalid hex color "+tt)}else if(tt&&tt.length>0)return this.setColorName(tt,lt);return this}setColorName(tt,lt=Ns){const ht=d_[tt.toLowerCase()];return ht!==void 0?this.setHex(ht,lt):console.warn("THREE.Color: Unknown color "+tt),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(tt){return this.r=tt.r,this.g=tt.g,this.b=tt.b,this}copySRGBToLinear(tt){return this.r=Lu(tt.r),this.g=Lu(tt.g),this.b=Lu(tt.b),this}copyLinearToSRGB(tt){return this.r=im(tt.r),this.g=im(tt.g),this.b=im(tt.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(tt=Ns){return Is.fromWorkingColorSpace(oo.copy(this),tt),65536*Math.round(Qs(255*oo.r,0,255))+256*Math.round(Qs(255*oo.g,0,255))+Math.round(Qs(255*oo.b,0,255))}getHexString(tt=Ns){return("000000"+this.getHex(tt).toString(16)).slice(-6)}getHSL(tt,lt=Is.workingColorSpace){Is.fromWorkingColorSpace(oo.copy(this),lt);const ht=oo.r,_t=oo.g,bt=oo.b,Pt=Math.max(ht,_t,bt),Mt=Math.min(ht,_t,bt);let Lt,Nt;const jt=(Mt+Pt)/2;if(Mt===Pt)Lt=0,Nt=0;else{const Wt=Pt-Mt;switch(Nt=jt<=.5?Wt/(Pt+Mt):Wt/(2-Pt-Mt),Pt){case ht:Lt=(_t-bt)/Wt+(_t<bt?6:0);break;case _t:Lt=(bt-ht)/Wt+2;break;case bt:Lt=(ht-_t)/Wt+4}Lt/=6}return tt.h=Lt,tt.s=Nt,tt.l=jt,tt}getRGB(tt,lt=Is.workingColorSpace){return Is.fromWorkingColorSpace(oo.copy(this),lt),tt.r=oo.r,tt.g=oo.g,tt.b=oo.b,tt}getStyle(tt=Ns){Is.fromWorkingColorSpace(oo.copy(this),tt);const lt=oo.r,ht=oo.g,_t=oo.b;return tt!==Ns?`color(${tt} ${lt.toFixed(3)} ${ht.toFixed(3)} ${_t.toFixed(3)})`:`rgb(${Math.round(255*lt)},${Math.round(255*ht)},${Math.round(255*_t)})`}offsetHSL(tt,lt,ht){return this.getHSL(Nl),this.setHSL(Nl.h+tt,Nl.s+lt,Nl.l+ht)}add(tt){return this.r+=tt.r,this.g+=tt.g,this.b+=tt.b,this}addColors(tt,lt){return this.r=tt.r+lt.r,this.g=tt.g+lt.g,this.b=tt.b+lt.b,this}addScalar(tt){return this.r+=tt,this.g+=tt,this.b+=tt,this}sub(tt){return this.r=Math.max(0,this.r-tt.r),this.g=Math.max(0,this.g-tt.g),this.b=Math.max(0,this.b-tt.b),this}multiply(tt){return this.r*=tt.r,this.g*=tt.g,this.b*=tt.b,this}multiplyScalar(tt){return this.r*=tt,this.g*=tt,this.b*=tt,this}lerp(tt,lt){return this.r+=(tt.r-this.r)*lt,this.g+=(tt.g-this.g)*lt,this.b+=(tt.b-this.b)*lt,this}lerpColors(tt,lt,ht){return this.r=tt.r+(lt.r-tt.r)*ht,this.g=tt.g+(lt.g-tt.g)*ht,this.b=tt.b+(lt.b-tt.b)*ht,this}lerpHSL(tt,lt){this.getHSL(Nl),tt.getHSL(mm);const ht=Bu(Nl.h,mm.h,lt),_t=Bu(Nl.s,mm.s,lt),bt=Bu(Nl.l,mm.l,lt);return this.setHSL(ht,_t,bt),this}setFromVector3(tt){return this.r=tt.x,this.g=tt.y,this.b=tt.z,this}applyMatrix3(tt){const lt=this.r,ht=this.g,_t=this.b,bt=tt.elements;return this.r=bt[0]*lt+bt[3]*ht+bt[6]*_t,this.g=bt[1]*lt+bt[4]*ht+bt[7]*_t,this.b=bt[2]*lt+bt[5]*ht+bt[8]*_t,this}equals(tt){return tt.r===this.r&&tt.g===this.g&&tt.b===this.b}fromArray(tt,lt=0){return this.r=tt[lt],this.g=tt[lt+1],this.b=tt[lt+2],this}toArray(tt=[],lt=0){return tt[lt]=this.r,tt[lt+1]=this.g,tt[lt+2]=this.b,tt}fromBufferAttribute(tt,lt){return this.r=tt.getX(lt),this.g=tt.getY(lt),this.b=tt.getZ(lt),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const oo=new jn;jn.NAMES=d_;class _c extends ao{constructor(tt){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new jn(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=yn,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(tt)}copy(tt){return super.copy(tt),this.color.copy(tt.color),this.map=tt.map,this.lightMap=tt.lightMap,this.lightMapIntensity=tt.lightMapIntensity,this.aoMap=tt.aoMap,this.aoMapIntensity=tt.aoMapIntensity,this.specularMap=tt.specularMap,this.alphaMap=tt.alphaMap,this.envMap=tt.envMap,this.combine=tt.combine,this.reflectivity=tt.reflectivity,this.refractionRatio=tt.refractionRatio,this.wireframe=tt.wireframe,this.wireframeLinewidth=tt.wireframeLinewidth,this.wireframeLinecap=tt.wireframeLinecap,this.wireframeLinejoin=tt.wireframeLinejoin,this.fog=tt.fog,this}}const Tl=O0();function O0(){const St=new ArrayBuffer(4),tt=new Float32Array(St),lt=new Uint32Array(St),ht=new Uint32Array(512),_t=new Uint32Array(512);for(let Lt=0;Lt<256;++Lt){const Nt=Lt-127;Nt<-27?(ht[Lt]=0,ht[256|Lt]=32768,_t[Lt]=24,_t[256|Lt]=24):Nt<-14?(ht[Lt]=1024>>-Nt-14,ht[256|Lt]=1024>>-Nt-14|32768,_t[Lt]=-Nt-1,_t[256|Lt]=-Nt-1):Nt<=15?(ht[Lt]=Nt+15<<10,ht[256|Lt]=Nt+15<<10|32768,_t[Lt]=13,_t[256|Lt]=13):Nt<128?(ht[Lt]=31744,ht[256|Lt]=64512,_t[Lt]=24,_t[256|Lt]=24):(ht[Lt]=31744,ht[256|Lt]=64512,_t[Lt]=13,_t[256|Lt]=13)}const bt=new Uint32Array(2048),Pt=new Uint32Array(64),Mt=new Uint32Array(64);for(let Lt=1;Lt<1024;++Lt){let Nt=Lt<<13,jt=0;for(;!(8388608&Nt);)Nt<<=1,jt-=8388608;Nt&=-8388609,jt+=947912704,bt[Lt]=Nt|jt}for(let Lt=1024;Lt<2048;++Lt)bt[Lt]=939524096+(Lt-1024<<13);for(let Lt=1;Lt<31;++Lt)Pt[Lt]=Lt<<23;Pt[31]=1199570944,Pt[32]=2147483648;for(let Lt=33;Lt<63;++Lt)Pt[Lt]=2147483648+(Lt-32<<23);Pt[63]=3347054592;for(let Lt=1;Lt<64;++Lt)Lt!==32&&(Mt[Lt]=1024);return{floatView:tt,uint32View:lt,baseTable:ht,shiftTable:_t,mantissaTable:bt,exponentTable:Pt,offsetTable:Mt}}function Gt(St){Math.abs(St)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),St=Qs(St,-65504,65504),Tl.floatView[0]=St;const tt=Tl.uint32View[0],lt=tt>>23&511;return Tl.baseTable[lt]+((8388607&tt)>>Tl.shiftTable[lt])}function wt(St){const tt=St>>10;return Tl.uint32View[0]=Tl.mantissaTable[Tl.offsetTable[tt]+(1023&St)]+Tl.exponentTable[tt],Tl.floatView[0]}const It={toHalfFloat:Gt,fromHalfFloat:wt},Vt=new Sr,nr=new mn;class gr{constructor(tt,lt,ht=!1){if(Array.isArray(tt))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=tt,this.itemSize=lt,this.count=tt!==void 0?tt.length/lt:0,this.normalized=ht,this.usage=Du,this.updateRange={offset:0,count:-1},this.gpuType=ro,this.version=0}onUploadCallback(){}set needsUpdate(tt){tt===!0&&this.version++}setUsage(tt){return this.usage=tt,this}copy(tt){return this.name=tt.name,this.array=new tt.array.constructor(tt.array),this.itemSize=tt.itemSize,this.count=tt.count,this.normalized=tt.normalized,this.usage=tt.usage,this.gpuType=tt.gpuType,this}copyAt(tt,lt,ht){tt*=this.itemSize,ht*=lt.itemSize;for(let _t=0,bt=this.itemSize;_t<bt;_t++)this.array[tt+_t]=lt.array[ht+_t];return this}copyArray(tt){return this.array.set(tt),this}applyMatrix3(tt){if(this.itemSize===2)for(let lt=0,ht=this.count;lt<ht;lt++)nr.fromBufferAttribute(this,lt),nr.applyMatrix3(tt),this.setXY(lt,nr.x,nr.y);else if(this.itemSize===3)for(let lt=0,ht=this.count;lt<ht;lt++)Vt.fromBufferAttribute(this,lt),Vt.applyMatrix3(tt),this.setXYZ(lt,Vt.x,Vt.y,Vt.z);return this}applyMatrix4(tt){for(let lt=0,ht=this.count;lt<ht;lt++)Vt.fromBufferAttribute(this,lt),Vt.applyMatrix4(tt),this.setXYZ(lt,Vt.x,Vt.y,Vt.z);return this}applyNormalMatrix(tt){for(let lt=0,ht=this.count;lt<ht;lt++)Vt.fromBufferAttribute(this,lt),Vt.applyNormalMatrix(tt),this.setXYZ(lt,Vt.x,Vt.y,Vt.z);return this}transformDirection(tt){for(let lt=0,ht=this.count;lt<ht;lt++)Vt.fromBufferAttribute(this,lt),Vt.transformDirection(tt),this.setXYZ(lt,Vt.x,Vt.y,Vt.z);return this}set(tt,lt=0){return this.array.set(tt,lt),this}getComponent(tt,lt){let ht=this.array[tt*this.itemSize+lt];return this.normalized&&(ht=_o(ht,this.array)),ht}setComponent(tt,lt,ht){return this.normalized&&(ht=ss(ht,this.array)),this.array[tt*this.itemSize+lt]=ht,this}getX(tt){let lt=this.array[tt*this.itemSize];return this.normalized&&(lt=_o(lt,this.array)),lt}setX(tt,lt){return this.normalized&&(lt=ss(lt,this.array)),this.array[tt*this.itemSize]=lt,this}getY(tt){let lt=this.array[tt*this.itemSize+1];return this.normalized&&(lt=_o(lt,this.array)),lt}setY(tt,lt){return this.normalized&&(lt=ss(lt,this.array)),this.array[tt*this.itemSize+1]=lt,this}getZ(tt){let lt=this.array[tt*this.itemSize+2];return this.normalized&&(lt=_o(lt,this.array)),lt}setZ(tt,lt){return this.normalized&&(lt=ss(lt,this.array)),this.array[tt*this.itemSize+2]=lt,this}getW(tt){let lt=this.array[tt*this.itemSize+3];return this.normalized&&(lt=_o(lt,this.array)),lt}setW(tt,lt){return this.normalized&&(lt=ss(lt,this.array)),this.array[tt*this.itemSize+3]=lt,this}setXY(tt,lt,ht){return tt*=this.itemSize,this.normalized&&(lt=ss(lt,this.array),ht=ss(ht,this.array)),this.array[tt+0]=lt,this.array[tt+1]=ht,this}setXYZ(tt,lt,ht,_t){return tt*=this.itemSize,this.normalized&&(lt=ss(lt,this.array),ht=ss(ht,this.array),_t=ss(_t,this.array)),this.array[tt+0]=lt,this.array[tt+1]=ht,this.array[tt+2]=_t,this}setXYZW(tt,lt,ht,_t,bt){return tt*=this.itemSize,this.normalized&&(lt=ss(lt,this.array),ht=ss(ht,this.array),_t=ss(_t,this.array),bt=ss(bt,this.array)),this.array[tt+0]=lt,this.array[tt+1]=ht,this.array[tt+2]=_t,this.array[tt+3]=bt,this}onUpload(tt){return this.onUploadCallback=tt,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const tt={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(tt.name=this.name),this.usage!==Du&&(tt.usage=this.usage),this.updateRange.offset===0&&this.updateRange.count===-1||(tt.updateRange=this.updateRange),tt}}class Cr extends gr{constructor(tt,lt,ht){super(new Int8Array(tt),lt,ht)}}class qr extends gr{constructor(tt,lt,ht){super(new Uint8Array(tt),lt,ht)}}class fn extends gr{constructor(tt,lt,ht){super(new Uint8ClampedArray(tt),lt,ht)}}class Vn extends gr{constructor(tt,lt,ht){super(new Int16Array(tt),lt,ht)}}class ls extends gr{constructor(tt,lt,ht){super(new Uint16Array(tt),lt,ht)}}class na extends gr{constructor(tt,lt,ht){super(new Int32Array(tt),lt,ht)}}class yo extends gr{constructor(tt,lt,ht){super(new Uint32Array(tt),lt,ht)}}class So extends gr{constructor(tt,lt,ht){super(new Uint16Array(tt),lt,ht),this.isFloat16BufferAttribute=!0}getX(tt){let lt=wt(this.array[tt*this.itemSize]);return this.normalized&&(lt=_o(lt,this.array)),lt}setX(tt,lt){return this.normalized&&(lt=ss(lt,this.array)),this.array[tt*this.itemSize]=Gt(lt),this}getY(tt){let lt=wt(this.array[tt*this.itemSize+1]);return this.normalized&&(lt=_o(lt,this.array)),lt}setY(tt,lt){return this.normalized&&(lt=ss(lt,this.array)),this.array[tt*this.itemSize+1]=Gt(lt),this}getZ(tt){let lt=wt(this.array[tt*this.itemSize+2]);return this.normalized&&(lt=_o(lt,this.array)),lt}setZ(tt,lt){return this.normalized&&(lt=ss(lt,this.array)),this.array[tt*this.itemSize+2]=Gt(lt),this}getW(tt){let lt=wt(this.array[tt*this.itemSize+3]);return this.normalized&&(lt=_o(lt,this.array)),lt}setW(tt,lt){return this.normalized&&(lt=ss(lt,this.array)),this.array[tt*this.itemSize+3]=Gt(lt),this}setXY(tt,lt,ht){return tt*=this.itemSize,this.normalized&&(lt=ss(lt,this.array),ht=ss(ht,this.array)),this.array[tt+0]=Gt(lt),this.array[tt+1]=Gt(ht),this}setXYZ(tt,lt,ht,_t){return tt*=this.itemSize,this.normalized&&(lt=ss(lt,this.array),ht=ss(ht,this.array),_t=ss(_t,this.array)),this.array[tt+0]=Gt(lt),this.array[tt+1]=Gt(ht),this.array[tt+2]=Gt(_t),this}setXYZW(tt,lt,ht,_t,bt){return tt*=this.itemSize,this.normalized&&(lt=ss(lt,this.array),ht=ss(ht,this.array),_t=ss(_t,this.array),bt=ss(bt,this.array)),this.array[tt+0]=Gt(lt),this.array[tt+1]=Gt(ht),this.array[tt+2]=Gt(_t),this.array[tt+3]=Gt(bt),this}}class On extends gr{constructor(tt,lt,ht){super(new Float32Array(tt),lt,ht)}}class g_ extends gr{constructor(tt,lt,ht){super(new Float64Array(tt),lt,ht)}}let gm=0;const Co=new is,$u=new Cs,Fl=new Sr,Do=new Al,xp=new Al,lo=new Sr;class fs extends go{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:gm++}),this.uuid=Ao(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(tt){return Array.isArray(tt)?this.index=new(tv(tt)?yo:ls)(tt,1):this.index=tt,this}getAttribute(tt){return this.attributes[tt]}setAttribute(tt,lt){return this.attributes[tt]=lt,this}deleteAttribute(tt){return delete this.attributes[tt],this}hasAttribute(tt){return this.attributes[tt]!==void 0}addGroup(tt,lt,ht=0){this.groups.push({start:tt,count:lt,materialIndex:ht})}clearGroups(){this.groups=[]}setDrawRange(tt,lt){this.drawRange.start=tt,this.drawRange.count=lt}applyMatrix4(tt){const lt=this.attributes.position;lt!==void 0&&(lt.applyMatrix4(tt),lt.needsUpdate=!0);const ht=this.attributes.normal;if(ht!==void 0){const bt=new os().getNormalMatrix(tt);ht.applyNormalMatrix(bt),ht.needsUpdate=!0}const _t=this.attributes.tangent;return _t!==void 0&&(_t.transformDirection(tt),_t.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(tt){return Co.makeRotationFromQuaternion(tt),this.applyMatrix4(Co),this}rotateX(tt){return Co.makeRotationX(tt),this.applyMatrix4(Co),this}rotateY(tt){return Co.makeRotationY(tt),this.applyMatrix4(Co),this}rotateZ(tt){return Co.makeRotationZ(tt),this.applyMatrix4(Co),this}translate(tt,lt,ht){return Co.makeTranslation(tt,lt,ht),this.applyMatrix4(Co),this}scale(tt,lt,ht){return Co.makeScale(tt,lt,ht),this.applyMatrix4(Co),this}lookAt(tt){return $u.lookAt(tt),$u.updateMatrix(),this.applyMatrix4($u.matrix),this}center(tt=void 0){return this.computeBoundingBox(),this.boundingBox.getCenter(Fl).negate(),this.translate(Fl.x,Fl.y,Fl.z),tt&&tt.copy(Fl),this}setFromPoints(tt){const lt=[];for(let ht=0,_t=tt.length;ht<_t;ht++){const bt=tt[ht];lt.push(bt.x,bt.y,bt.z||0)}return this.setAttribute("position",new On(lt,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Al);const tt=this.attributes.position,lt=this.morphAttributes.position;if(tt&&tt.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new Sr(-1/0,-1/0,-1/0),new Sr(1/0,1/0,1/0));if(tt!==void 0){if(this.boundingBox.setFromBufferAttribute(tt),lt)for(let ht=0,_t=lt.length;ht<_t;ht++){const bt=lt[ht];Do.setFromBufferAttribute(bt),this.morphTargetsRelative?(lo.addVectors(this.boundingBox.min,Do.min),this.boundingBox.expandByPoint(lo),lo.addVectors(this.boundingBox.max,Do.max),this.boundingBox.expandByPoint(lo)):(this.boundingBox.expandByPoint(Do.min),this.boundingBox.expandByPoint(Do.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Go);const tt=this.attributes.position,lt=this.morphAttributes.position;if(tt&&tt.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new Sr,1/0);if(tt){const ht=this.boundingSphere.center;if(Do.setFromBufferAttribute(tt),lt)for(let bt=0,Pt=lt.length;bt<Pt;bt++){const Mt=lt[bt];xp.setFromBufferAttribute(Mt),this.morphTargetsRelative?(lo.addVectors(Do.min,xp.min),Do.expandByPoint(lo),lo.addVectors(Do.max,xp.max),Do.expandByPoint(lo)):(Do.expandByPoint(xp.min),Do.expandByPoint(xp.max))}Do.getCenter(ht);let _t=0;for(let bt=0,Pt=tt.count;bt<Pt;bt++)lo.fromBufferAttribute(tt,bt),_t=Math.max(_t,ht.distanceToSquared(lo));if(lt)for(let bt=0,Pt=lt.length;bt<Pt;bt++){const Mt=lt[bt],Lt=this.morphTargetsRelative;for(let Nt=0,jt=Mt.count;Nt<jt;Nt++)lo.fromBufferAttribute(Mt,Nt),Lt&&(Fl.fromBufferAttribute(tt,Nt),lo.add(Fl)),_t=Math.max(_t,ht.distanceToSquared(lo))}this.boundingSphere.radius=Math.sqrt(_t),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const tt=this.index,lt=this.attributes;if(tt===null||lt.position===void 0||lt.normal===void 0||lt.uv===void 0)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const ht=tt.array,_t=lt.position.array,bt=lt.normal.array,Pt=lt.uv.array,Mt=_t.length/3;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new gr(new Float32Array(4*Mt),4));const Lt=this.getAttribute("tangent").array,Nt=[],jt=[];for(let Vr=0;Vr<Mt;Vr++)Nt[Vr]=new Sr,jt[Vr]=new Sr;const Wt=new Sr,Qt=new Sr,qt=new Sr,Xt=new mn,Zt=new mn,Yt=new mn,ar=new Sr,er=new Sr;function tr(Vr,zr,Hr){Wt.fromArray(_t,3*Vr),Qt.fromArray(_t,3*zr),qt.fromArray(_t,3*Hr),Xt.fromArray(Pt,2*Vr),Zt.fromArray(Pt,2*zr),Yt.fromArray(Pt,2*Hr),Qt.sub(Wt),qt.sub(Wt),Zt.sub(Xt),Yt.sub(Xt);const _n=1/(Zt.x*Yt.y-Yt.x*Zt.y);isFinite(_n)&&(ar.copy(Qt).multiplyScalar(Yt.y).addScaledVector(qt,-Zt.y).multiplyScalar(_n),er.copy(qt).multiplyScalar(Zt.x).addScaledVector(Qt,-Yt.x).multiplyScalar(_n),Nt[Vr].add(ar),Nt[zr].add(ar),Nt[Hr].add(ar),jt[Vr].add(er),jt[zr].add(er),jt[Hr].add(er))}let Ar=this.groups;Ar.length===0&&(Ar=[{start:0,count:ht.length}]);for(let Vr=0,zr=Ar.length;Vr<zr;++Vr){const Hr=Ar[Vr],_n=Hr.start;for(let hn=_n,Rn=_n+Hr.count;hn<Rn;hn+=3)tr(ht[hn+0],ht[hn+1],ht[hn+2])}const wr=new Sr,br=new Sr,Mr=new Sr,Qr=new Sr;function Fr(Vr){Mr.fromArray(bt,3*Vr),Qr.copy(Mr);const zr=Nt[Vr];wr.copy(zr),wr.sub(Mr.multiplyScalar(Mr.dot(zr))).normalize(),br.crossVectors(Qr,zr);const Hr=br.dot(jt[Vr])<0?-1:1;Lt[4*Vr]=wr.x,Lt[4*Vr+1]=wr.y,Lt[4*Vr+2]=wr.z,Lt[4*Vr+3]=Hr}for(let Vr=0,zr=Ar.length;Vr<zr;++Vr){const Hr=Ar[Vr],_n=Hr.start;for(let hn=_n,Rn=_n+Hr.count;hn<Rn;hn+=3)Fr(ht[hn+0]),Fr(ht[hn+1]),Fr(ht[hn+2])}}computeVertexNormals(){const tt=this.index,lt=this.getAttribute("position");if(lt!==void 0){let ht=this.getAttribute("normal");if(ht===void 0)ht=new gr(new Float32Array(3*lt.count),3),this.setAttribute("normal",ht);else for(let Qt=0,qt=ht.count;Qt<qt;Qt++)ht.setXYZ(Qt,0,0,0);const _t=new Sr,bt=new Sr,Pt=new Sr,Mt=new Sr,Lt=new Sr,Nt=new Sr,jt=new Sr,Wt=new Sr;if(tt)for(let Qt=0,qt=tt.count;Qt<qt;Qt+=3){const Xt=tt.getX(Qt+0),Zt=tt.getX(Qt+1),Yt=tt.getX(Qt+2);_t.fromBufferAttribute(lt,Xt),bt.fromBufferAttribute(lt,Zt),Pt.fromBufferAttribute(lt,Yt),jt.subVectors(Pt,bt),Wt.subVectors(_t,bt),jt.cross(Wt),Mt.fromBufferAttribute(ht,Xt),Lt.fromBufferAttribute(ht,Zt),Nt.fromBufferAttribute(ht,Yt),Mt.add(jt),Lt.add(jt),Nt.add(jt),ht.setXYZ(Xt,Mt.x,Mt.y,Mt.z),ht.setXYZ(Zt,Lt.x,Lt.y,Lt.z),ht.setXYZ(Yt,Nt.x,Nt.y,Nt.z)}else for(let Qt=0,qt=lt.count;Qt<qt;Qt+=3)_t.fromBufferAttribute(lt,Qt+0),bt.fromBufferAttribute(lt,Qt+1),Pt.fromBufferAttribute(lt,Qt+2),jt.subVectors(Pt,bt),Wt.subVectors(_t,bt),jt.cross(Wt),ht.setXYZ(Qt+0,jt.x,jt.y,jt.z),ht.setXYZ(Qt+1,jt.x,jt.y,jt.z),ht.setXYZ(Qt+2,jt.x,jt.y,jt.z);this.normalizeNormals(),ht.needsUpdate=!0}}normalizeNormals(){const tt=this.attributes.normal;for(let lt=0,ht=tt.count;lt<ht;lt++)lo.fromBufferAttribute(tt,lt),lo.normalize(),tt.setXYZ(lt,lo.x,lo.y,lo.z)}toNonIndexed(){function tt(Mt,Lt){const Nt=Mt.array,jt=Mt.itemSize,Wt=Mt.normalized,Qt=new Nt.constructor(Lt.length*jt);let qt=0,Xt=0;for(let Zt=0,Yt=Lt.length;Zt<Yt;Zt++){qt=Mt.isInterleavedBufferAttribute?Lt[Zt]*Mt.data.stride+Mt.offset:Lt[Zt]*jt;for(let ar=0;ar<jt;ar++)Qt[Xt++]=Nt[qt++]}return new gr(Qt,jt,Wt)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const lt=new fs,ht=this.index.array,_t=this.attributes;for(const Mt in _t){const Lt=tt(_t[Mt],ht);lt.setAttribute(Mt,Lt)}const bt=this.morphAttributes;for(const Mt in bt){const Lt=[],Nt=bt[Mt];for(let jt=0,Wt=Nt.length;jt<Wt;jt++){const Qt=tt(Nt[jt],ht);Lt.push(Qt)}lt.morphAttributes[Mt]=Lt}lt.morphTargetsRelative=this.morphTargetsRelative;const Pt=this.groups;for(let Mt=0,Lt=Pt.length;Mt<Lt;Mt++){const Nt=Pt[Mt];lt.addGroup(Nt.start,Nt.count,Nt.materialIndex)}return lt}toJSON(){const tt={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(tt.uuid=this.uuid,tt.type=this.type,this.name!==""&&(tt.name=this.name),Object.keys(this.userData).length>0&&(tt.userData=this.userData),this.parameters!==void 0){const Lt=this.parameters;for(const Nt in Lt)Lt[Nt]!==void 0&&(tt[Nt]=Lt[Nt]);return tt}tt.data={attributes:{}};const lt=this.index;lt!==null&&(tt.data.index={type:lt.array.constructor.name,array:Array.prototype.slice.call(lt.array)});const ht=this.attributes;for(const Lt in ht){const Nt=ht[Lt];tt.data.attributes[Lt]=Nt.toJSON(tt.data)}const _t={};let bt=!1;for(const Lt in this.morphAttributes){const Nt=this.morphAttributes[Lt],jt=[];for(let Wt=0,Qt=Nt.length;Wt<Qt;Wt++){const qt=Nt[Wt];jt.push(qt.toJSON(tt.data))}jt.length>0&&(_t[Lt]=jt,bt=!0)}bt&&(tt.data.morphAttributes=_t,tt.data.morphTargetsRelative=this.morphTargetsRelative);const Pt=this.groups;Pt.length>0&&(tt.data.groups=JSON.parse(JSON.stringify(Pt)));const Mt=this.boundingSphere;return Mt!==null&&(tt.data.boundingSphere={center:Mt.center.toArray(),radius:Mt.radius}),tt}clone(){return new this.constructor().copy(this)}copy(tt){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const lt={};this.name=tt.name;const ht=tt.index;ht!==null&&this.setIndex(ht.clone(lt));const _t=tt.attributes;for(const Nt in _t){const jt=_t[Nt];this.setAttribute(Nt,jt.clone(lt))}const bt=tt.morphAttributes;for(const Nt in bt){const jt=[],Wt=bt[Nt];for(let Qt=0,qt=Wt.length;Qt<qt;Qt++)jt.push(Wt[Qt].clone(lt));this.morphAttributes[Nt]=jt}this.morphTargetsRelative=tt.morphTargetsRelative;const Pt=tt.groups;for(let Nt=0,jt=Pt.length;Nt<jt;Nt++){const Wt=Pt[Nt];this.addGroup(Wt.start,Wt.count,Wt.materialIndex)}const Mt=tt.boundingBox;Mt!==null&&(this.boundingBox=Mt.clone());const Lt=tt.boundingSphere;return Lt!==null&&(this.boundingSphere=Lt.clone()),this.drawRange.start=tt.drawRange.start,this.drawRange.count=tt.drawRange.count,this.userData=tt.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const Ly=new is,Ap=new Gu,hv=new Go,Oy=new Sr,_m=new Sr,fm=new Sr,vm=new Sr,N0=new Sr,dv=new Sr,mv=new mn,gv=new mn,_v=new mn,Ny=new Sr,Fy=new Sr,Uy=new Sr,fv=new Sr,vv=new Sr;class co extends Cs{constructor(tt=new fs,lt=new _c){super(),this.isMesh=!0,this.type="Mesh",this.geometry=tt,this.material=lt,this.updateMorphTargets()}copy(tt,lt){return super.copy(tt,lt),tt.isMesh?(tt.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=tt.morphTargetInfluences.slice()),tt.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},tt.morphTargetDictionary)),this.material=Array.isArray(tt.material)?tt.material.slice():tt.material,this.geometry=tt.geometry,this):this}updateMorphTargets(){const tt=this.geometry.morphAttributes,lt=Object.keys(tt);if(lt.length>0){const ht=tt[lt[0]];if(ht!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let _t=0,bt=ht.length;_t<bt;_t++){const Pt=ht[_t].name||String(_t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[Pt]=_t}}}}getVertexPosition(tt,lt){const ht=this.geometry,_t=ht.attributes.position,bt=ht.morphAttributes.position,Pt=ht.morphTargetsRelative;lt.fromBufferAttribute(_t,tt);const Mt=this.morphTargetInfluences;if(bt&&Mt){dv.set(0,0,0);for(let Lt=0,Nt=bt.length;Lt<Nt;Lt++){const jt=Mt[Lt],Wt=bt[Lt];jt!==0&&(N0.fromBufferAttribute(Wt,tt),Pt?dv.addScaledVector(N0,jt):dv.addScaledVector(N0.sub(lt),jt))}lt.add(dv)}return lt}raycast(tt,lt){const ht=this.geometry,_t=this.material,bt=this.matrixWorld;if(_t!==void 0){if(ht.boundingSphere===null&&ht.computeBoundingSphere(),hv.copy(ht.boundingSphere),hv.applyMatrix4(bt),Ap.copy(tt.ray).recast(tt.near),hv.containsPoint(Ap.origin)===!1&&(Ap.intersectSphere(hv,Oy)===null||Ap.origin.distanceToSquared(Oy)>(tt.far-tt.near)**2))return;Ly.copy(bt).invert(),Ap.copy(tt.ray).applyMatrix4(Ly),ht.boundingBox!==null&&Ap.intersectsBox(ht.boundingBox)===!1||this._computeIntersections(tt,lt,Ap)}}_computeIntersections(tt,lt,ht){let _t;const bt=this.geometry,Pt=this.material,Mt=bt.index,Lt=bt.attributes.position,Nt=bt.attributes.uv,jt=bt.attributes.uv1,Wt=bt.attributes.normal,Qt=bt.groups,qt=bt.drawRange;if(Mt!==null)if(Array.isArray(Pt))for(let Xt=0,Zt=Qt.length;Xt<Zt;Xt++){const Yt=Qt[Xt],ar=Pt[Yt.materialIndex];for(let er=Math.max(Yt.start,qt.start),tr=Math.min(Mt.count,Math.min(Yt.start+Yt.count,qt.start+qt.count));er<tr;er+=3)_t=yv(this,ar,tt,ht,Nt,jt,Wt,Mt.getX(er),Mt.getX(er+1),Mt.getX(er+2)),_t&&(_t.faceIndex=Math.floor(er/3),_t.face.materialIndex=Yt.materialIndex,lt.push(_t))}else for(let Xt=Math.max(0,qt.start),Zt=Math.min(Mt.count,qt.start+qt.count);Xt<Zt;Xt+=3)_t=yv(this,Pt,tt,ht,Nt,jt,Wt,Mt.getX(Xt),Mt.getX(Xt+1),Mt.getX(Xt+2)),_t&&(_t.faceIndex=Math.floor(Xt/3),lt.push(_t));else if(Lt!==void 0)if(Array.isArray(Pt))for(let Xt=0,Zt=Qt.length;Xt<Zt;Xt++){const Yt=Qt[Xt],ar=Pt[Yt.materialIndex];for(let er=Math.max(Yt.start,qt.start),tr=Math.min(Lt.count,Math.min(Yt.start+Yt.count,qt.start+qt.count));er<tr;er+=3)_t=yv(this,ar,tt,ht,Nt,jt,Wt,er,er+1,er+2),_t&&(_t.faceIndex=Math.floor(er/3),_t.face.materialIndex=Yt.materialIndex,lt.push(_t))}else for(let Xt=Math.max(0,qt.start),Zt=Math.min(Lt.count,qt.start+qt.count);Xt<Zt;Xt+=3)_t=yv(this,Pt,tt,ht,Nt,jt,Wt,Xt,Xt+1,Xt+2),_t&&(_t.faceIndex=Math.floor(Xt/3),lt.push(_t))}}function yv(St,tt,lt,ht,_t,bt,Pt,Mt,Lt,Nt){St.getVertexPosition(Mt,_m),St.getVertexPosition(Lt,fm),St.getVertexPosition(Nt,vm);const jt=function(Wt,Qt,qt,Xt,Zt,Yt,ar,er){let tr;if(tr=Qt.side===xt?Xt.intersectTriangle(ar,Yt,Zt,!0,er):Xt.intersectTriangle(Zt,Yt,ar,Qt.side===vt,er),tr===null)return null;vv.copy(er),vv.applyMatrix4(Wt.matrixWorld);const Ar=qt.ray.origin.distanceTo(vv);return Ar<qt.near||Ar>qt.far?null:{distance:Ar,point:vv.clone(),object:Wt}}(St,tt,lt,ht,_m,fm,vm,fv);if(jt){_t&&(mv.fromBufferAttribute(_t,Mt),gv.fromBufferAttribute(_t,Lt),_v.fromBufferAttribute(_t,Nt),jt.uv=vo.getInterpolation(fv,_m,fm,vm,mv,gv,_v,new mn)),bt&&(mv.fromBufferAttribute(bt,Mt),gv.fromBufferAttribute(bt,Lt),_v.fromBufferAttribute(bt,Nt),jt.uv1=vo.getInterpolation(fv,_m,fm,vm,mv,gv,_v,new mn),jt.uv2=jt.uv1),Pt&&(Ny.fromBufferAttribute(Pt,Mt),Fy.fromBufferAttribute(Pt,Lt),Uy.fromBufferAttribute(Pt,Nt),jt.normal=vo.getInterpolation(fv,_m,fm,vm,Ny,Fy,Uy,new Sr),jt.normal.dot(ht.direction)>0&&jt.normal.multiplyScalar(-1));const Wt={a:Mt,b:Lt,c:Nt,normal:new Sr,materialIndex:0};vo.getNormal(_m,fm,vm,Wt.normal),jt.face=Wt}return jt}class Xu extends fs{constructor(tt=1,lt=1,ht=1,_t=1,bt=1,Pt=1){super(),this.type="BoxGeometry",this.parameters={width:tt,height:lt,depth:ht,widthSegments:_t,heightSegments:bt,depthSegments:Pt};const Mt=this;_t=Math.floor(_t),bt=Math.floor(bt),Pt=Math.floor(Pt);const Lt=[],Nt=[],jt=[],Wt=[];let Qt=0,qt=0;function Xt(Zt,Yt,ar,er,tr,Ar,wr,br,Mr,Qr,Fr){const Vr=Ar/Mr,zr=wr/Qr,Hr=Ar/2,_n=wr/2,hn=br/2,Rn=Mr+1,Bn=Qr+1;let un=0,Xr=0;const Jr=new Sr;for(let an=0;an<Bn;an++){const sn=an*zr-_n;for(let Fn=0;Fn<Rn;Fn++){const rs=Fn*Vr-Hr;Jr[Zt]=rs*er,Jr[Yt]=sn*tr,Jr[ar]=hn,Nt.push(Jr.x,Jr.y,Jr.z),Jr[Zt]=0,Jr[Yt]=0,Jr[ar]=br>0?1:-1,jt.push(Jr.x,Jr.y,Jr.z),Wt.push(Fn/Mr),Wt.push(1-an/Qr),un+=1}}for(let an=0;an<Qr;an++)for(let sn=0;sn<Mr;sn++){const Fn=Qt+sn+Rn*an,rs=Qt+sn+Rn*(an+1),Yn=Qt+(sn+1)+Rn*(an+1),Un=Qt+(sn+1)+Rn*an;Lt.push(Fn,rs,Un),Lt.push(rs,Yn,Un),Xr+=6}Mt.addGroup(qt,Xr,Fr),qt+=Xr,Qt+=un}Xt("z","y","x",-1,-1,ht,lt,tt,Pt,bt,0),Xt("z","y","x",1,-1,ht,lt,-tt,Pt,bt,1),Xt("x","z","y",1,1,tt,ht,lt,_t,Pt,2),Xt("x","z","y",1,-1,tt,ht,-lt,_t,Pt,3),Xt("x","y","z",1,-1,tt,lt,ht,_t,bt,4),Xt("x","y","z",-1,-1,tt,lt,-ht,_t,bt,5),this.setIndex(Lt),this.setAttribute("position",new On(Nt,3)),this.setAttribute("normal",new On(jt,3)),this.setAttribute("uv",new On(Wt,2))}copy(tt){return super.copy(tt),this.parameters=Object.assign({},tt.parameters),this}static fromJSON(tt){return new Xu(tt.width,tt.height,tt.depth,tt.widthSegments,tt.heightSegments,tt.depthSegments)}}function wp(St){const tt={};for(const lt in St){tt[lt]={};for(const ht in St[lt]){const _t=St[lt][ht];_t&&(_t.isColor||_t.isMatrix3||_t.isMatrix4||_t.isVector2||_t.isVector3||_t.isVector4||_t.isTexture||_t.isQuaternion)?_t.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),tt[lt][ht]=null):tt[lt][ht]=_t.clone():Array.isArray(_t)?tt[lt][ht]=_t.slice():tt[lt][ht]=_t}}return tt}function Bo(St){const tt={};for(let lt=0;lt<St.length;lt++){const ht=wp(St[lt]);for(const _t in ht)tt[_t]=ht[_t]}return tt}function jy(St){return St.getRenderTarget()===null?St.outputColorSpace:Is.workingColorSpace}const Gy={clone:wp,merge:Bo};class Ul extends ao{constructor(tt){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,this.fragmentShader=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,tt!==void 0&&this.setValues(tt)}copy(tt){return super.copy(tt),this.fragmentShader=tt.fragmentShader,this.vertexShader=tt.vertexShader,this.uniforms=wp(tt.uniforms),this.uniformsGroups=function(lt){const ht=[];for(let _t=0;_t<lt.length;_t++)ht.push(lt[_t].clone());return ht}(tt.uniformsGroups),this.defines=Object.assign({},tt.defines),this.wireframe=tt.wireframe,this.wireframeLinewidth=tt.wireframeLinewidth,this.fog=tt.fog,this.lights=tt.lights,this.clipping=tt.clipping,this.extensions=Object.assign({},tt.extensions),this.glslVersion=tt.glslVersion,this}toJSON(tt){const lt=super.toJSON(tt);lt.glslVersion=this.glslVersion,lt.uniforms={};for(const _t in this.uniforms){const bt=this.uniforms[_t].value;bt&&bt.isTexture?lt.uniforms[_t]={type:"t",value:bt.toJSON(tt).uuid}:bt&&bt.isColor?lt.uniforms[_t]={type:"c",value:bt.getHex()}:bt&&bt.isVector2?lt.uniforms[_t]={type:"v2",value:bt.toArray()}:bt&&bt.isVector3?lt.uniforms[_t]={type:"v3",value:bt.toArray()}:bt&&bt.isVector4?lt.uniforms[_t]={type:"v4",value:bt.toArray()}:bt&&bt.isMatrix3?lt.uniforms[_t]={type:"m3",value:bt.toArray()}:bt&&bt.isMatrix4?lt.uniforms[_t]={type:"m4",value:bt.toArray()}:lt.uniforms[_t]={value:bt}}Object.keys(this.defines).length>0&&(lt.defines=this.defines),lt.vertexShader=this.vertexShader,lt.fragmentShader=this.fragmentShader,lt.lights=this.lights,lt.clipping=this.clipping;const ht={};for(const _t in this.extensions)this.extensions[_t]===!0&&(ht[_t]=!0);return Object.keys(ht).length>0&&(lt.extensions=ht),lt}}class bv extends Cs{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new is,this.projectionMatrix=new is,this.projectionMatrixInverse=new is,this.coordinateSystem=jo}copy(tt,lt){return super.copy(tt,lt),this.matrixWorldInverse.copy(tt.matrixWorldInverse),this.projectionMatrix.copy(tt.projectionMatrix),this.projectionMatrixInverse.copy(tt.projectionMatrixInverse),this.coordinateSystem=tt.coordinateSystem,this}getWorldDirection(tt){return super.getWorldDirection(tt).negate()}updateMatrixWorld(tt){super.updateMatrixWorld(tt),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(tt,lt){super.updateWorldMatrix(tt,lt),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}class bo extends bv{constructor(tt=50,lt=1,ht=.1,_t=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=tt,this.zoom=1,this.near=ht,this.far=_t,this.focus=10,this.aspect=lt,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(tt,lt){return super.copy(tt,lt),this.fov=tt.fov,this.zoom=tt.zoom,this.near=tt.near,this.far=tt.far,this.focus=tt.focus,this.aspect=tt.aspect,this.view=tt.view===null?null:Object.assign({},tt.view),this.filmGauge=tt.filmGauge,this.filmOffset=tt.filmOffset,this}setFocalLength(tt){const lt=.5*this.getFilmHeight()/tt;this.fov=2*du*Math.atan(lt),this.updateProjectionMatrix()}getFocalLength(){const tt=Math.tan(.5*Xl*this.fov);return .5*this.getFilmHeight()/tt}getEffectiveFOV(){return 2*du*Math.atan(Math.tan(.5*Xl*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(tt,lt,ht,_t,bt,Pt){this.aspect=tt/lt,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=tt,this.view.fullHeight=lt,this.view.offsetX=ht,this.view.offsetY=_t,this.view.width=bt,this.view.height=Pt,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const tt=this.near;let lt=tt*Math.tan(.5*Xl*this.fov)/this.zoom,ht=2*lt,_t=this.aspect*ht,bt=-.5*_t;const Pt=this.view;if(this.view!==null&&this.view.enabled){const Lt=Pt.fullWidth,Nt=Pt.fullHeight;bt+=Pt.offsetX*_t/Lt,lt-=Pt.offsetY*ht/Nt,_t*=Pt.width/Lt,ht*=Pt.height/Nt}const Mt=this.filmOffset;Mt!==0&&(bt+=tt*Mt/this.getFilmWidth()),this.projectionMatrix.makePerspective(bt,bt+_t,lt,lt-ht,tt,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(tt){const lt=super.toJSON(tt);return lt.object.fov=this.fov,lt.object.zoom=this.zoom,lt.object.near=this.near,lt.object.far=this.far,lt.object.focus=this.focus,lt.object.aspect=this.aspect,this.view!==null&&(lt.object.view=Object.assign({},this.view)),lt.object.filmGauge=this.filmGauge,lt.object.filmOffset=this.filmOffset,lt}}const ym=-90;class zy extends Cs{constructor(tt,lt,ht){super(),this.type="CubeCamera",this.renderTarget=ht,this.coordinateSystem=null,this.activeMipmapLevel=0;const _t=new bo(ym,1,tt,lt);_t.layers=this.layers,this.add(_t);const bt=new bo(ym,1,tt,lt);bt.layers=this.layers,this.add(bt);const Pt=new bo(ym,1,tt,lt);Pt.layers=this.layers,this.add(Pt);const Mt=new bo(ym,1,tt,lt);Mt.layers=this.layers,this.add(Mt);const Lt=new bo(ym,1,tt,lt);Lt.layers=this.layers,this.add(Lt);const Nt=new bo(ym,1,tt,lt);Nt.layers=this.layers,this.add(Nt)}updateCoordinateSystem(){const tt=this.coordinateSystem,lt=this.children.concat(),[ht,_t,bt,Pt,Mt,Lt]=lt;for(const Nt of lt)this.remove(Nt);if(tt===jo)ht.up.set(0,1,0),ht.lookAt(1,0,0),_t.up.set(0,1,0),_t.lookAt(-1,0,0),bt.up.set(0,0,-1),bt.lookAt(0,1,0),Pt.up.set(0,0,1),Pt.lookAt(0,-1,0),Mt.up.set(0,1,0),Mt.lookAt(0,0,1),Lt.up.set(0,1,0),Lt.lookAt(0,0,-1);else{if(tt!==Wo)throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+tt);ht.up.set(0,-1,0),ht.lookAt(-1,0,0),_t.up.set(0,-1,0),_t.lookAt(1,0,0),bt.up.set(0,0,1),bt.lookAt(0,1,0),Pt.up.set(0,0,-1),Pt.lookAt(0,-1,0),Mt.up.set(0,-1,0),Mt.lookAt(0,0,1),Lt.up.set(0,-1,0),Lt.lookAt(0,0,-1)}for(const Nt of lt)this.add(Nt),Nt.updateMatrixWorld()}update(tt,lt){this.parent===null&&this.updateMatrixWorld();const{renderTarget:ht,activeMipmapLevel:_t}=this;this.coordinateSystem!==tt.coordinateSystem&&(this.coordinateSystem=tt.coordinateSystem,this.updateCoordinateSystem());const[bt,Pt,Mt,Lt,Nt,jt]=this.children,Wt=tt.getRenderTarget(),Qt=tt.getActiveCubeFace(),qt=tt.getActiveMipmapLevel(),Xt=tt.xr.enabled;tt.xr.enabled=!1;const Zt=ht.texture.generateMipmaps;ht.texture.generateMipmaps=!1,tt.setRenderTarget(ht,0,_t),tt.render(lt,bt),tt.setRenderTarget(ht,1,_t),tt.render(lt,Pt),tt.setRenderTarget(ht,2,_t),tt.render(lt,Mt),tt.setRenderTarget(ht,3,_t),tt.render(lt,Lt),tt.setRenderTarget(ht,4,_t),tt.render(lt,Nt),ht.texture.generateMipmaps=Zt,tt.setRenderTarget(ht,5,_t),tt.render(lt,jt),tt.setRenderTarget(Wt,Qt,qt),tt.xr.enabled=Xt,ht.texture.needsPMREMUpdate=!0}}class __ extends js{constructor(tt,lt,ht,_t,bt,Pt,Mt,Lt,Nt,jt){super(tt=tt!==void 0?tt:[],lt=lt!==void 0?lt:tn,ht,_t,bt,Pt,Mt,Lt,Nt,jt),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(tt){this.image=tt}}class Vy extends wo{constructor(tt=1,lt={}){super(tt,tt,lt),this.isWebGLCubeRenderTarget=!0;const ht={width:tt,height:tt,depth:1},_t=[ht,ht,ht,ht,ht,ht];lt.encoding!==void 0&&(_u("THREE.WebGLCubeRenderTarget: option.encoding has been replaced by option.colorSpace."),lt.colorSpace=lt.encoding===Dl?Ns:Ds),this.texture=new __(_t,lt.mapping,lt.wrapS,lt.wrapT,lt.magFilter,lt.minFilter,lt.format,lt.type,lt.anisotropy,lt.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=lt.generateMipmaps!==void 0&&lt.generateMipmaps,this.texture.minFilter=lt.minFilter!==void 0?lt.minFilter:Wn}fromEquirectangularTexture(tt,lt){this.texture.type=lt.type,this.texture.colorSpace=lt.colorSpace,this.texture.generateMipmaps=lt.generateMipmaps,this.texture.minFilter=lt.minFilter,this.texture.magFilter=lt.magFilter;const ht={tEquirect:{value:null}},_t=`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,bt=`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`,Pt=new Xu(5,5,5),Mt=new Ul({name:"CubemapFromEquirect",uniforms:wp(ht),vertexShader:_t,fragmentShader:bt,side:xt,blending:Et});Mt.uniforms.tEquirect.value=lt;const Lt=new co(Pt,Mt),Nt=lt.minFilter;return lt.minFilter===Jn&&(lt.minFilter=Wn),new zy(1,10,this).update(tt,Lt),lt.minFilter=Nt,Lt.geometry.dispose(),Lt.material.dispose(),this}clear(tt,lt,ht,_t){const bt=tt.getRenderTarget();for(let Pt=0;Pt<6;Pt++)tt.setRenderTarget(this,Pt),tt.clear(lt,ht,_t);tt.setRenderTarget(bt)}}const F0=new Sr,ww=new Sr,Ew=new os;class Yu{constructor(tt=new Sr(1,0,0),lt=0){this.isPlane=!0,this.normal=tt,this.constant=lt}set(tt,lt){return this.normal.copy(tt),this.constant=lt,this}setComponents(tt,lt,ht,_t){return this.normal.set(tt,lt,ht),this.constant=_t,this}setFromNormalAndCoplanarPoint(tt,lt){return this.normal.copy(tt),this.constant=-lt.dot(this.normal),this}setFromCoplanarPoints(tt,lt,ht){const _t=F0.subVectors(ht,lt).cross(ww.subVectors(tt,lt)).normalize();return this.setFromNormalAndCoplanarPoint(_t,tt),this}copy(tt){return this.normal.copy(tt.normal),this.constant=tt.constant,this}normalize(){const tt=1/this.normal.length();return this.normal.multiplyScalar(tt),this.constant*=tt,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(tt){return this.normal.dot(tt)+this.constant}distanceToSphere(tt){return this.distanceToPoint(tt.center)-tt.radius}projectPoint(tt,lt){return lt.copy(tt).addScaledVector(this.normal,-this.distanceToPoint(tt))}intersectLine(tt,lt){const ht=tt.delta(F0),_t=this.normal.dot(ht);if(_t===0)return this.distanceToPoint(tt.start)===0?lt.copy(tt.start):null;const bt=-(tt.start.dot(this.normal)+this.constant)/_t;return bt<0||bt>1?null:lt.copy(tt.start).addScaledVector(ht,bt)}intersectsLine(tt){const lt=this.distanceToPoint(tt.start),ht=this.distanceToPoint(tt.end);return lt<0&&ht>0||ht<0&&lt>0}intersectsBox(tt){return tt.intersectsPlane(this)}intersectsSphere(tt){return tt.intersectsPlane(this)}coplanarPoint(tt){return tt.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(tt,lt){const ht=lt||Ew.getNormalMatrix(tt),_t=this.coplanarPoint(F0).applyMatrix4(tt),bt=this.normal.applyMatrix3(ht).normalize();return this.constant=-_t.dot(bt),this}translate(tt){return this.constant-=tt.dot(this.normal),this}equals(tt){return tt.normal.equals(this.normal)&&tt.constant===this.constant}clone(){return new this.constructor().copy(this)}}const Ep=new Go,xv=new Sr;class Av{constructor(tt=new Yu,lt=new Yu,ht=new Yu,_t=new Yu,bt=new Yu,Pt=new Yu){this.planes=[tt,lt,ht,_t,bt,Pt]}set(tt,lt,ht,_t,bt,Pt){const Mt=this.planes;return Mt[0].copy(tt),Mt[1].copy(lt),Mt[2].copy(ht),Mt[3].copy(_t),Mt[4].copy(bt),Mt[5].copy(Pt),this}copy(tt){const lt=this.planes;for(let ht=0;ht<6;ht++)lt[ht].copy(tt.planes[ht]);return this}setFromProjectionMatrix(tt,lt=jo){const ht=this.planes,_t=tt.elements,bt=_t[0],Pt=_t[1],Mt=_t[2],Lt=_t[3],Nt=_t[4],jt=_t[5],Wt=_t[6],Qt=_t[7],qt=_t[8],Xt=_t[9],Zt=_t[10],Yt=_t[11],ar=_t[12],er=_t[13],tr=_t[14],Ar=_t[15];if(ht[0].setComponents(Lt-bt,Qt-Nt,Yt-qt,Ar-ar).normalize(),ht[1].setComponents(Lt+bt,Qt+Nt,Yt+qt,Ar+ar).normalize(),ht[2].setComponents(Lt+Pt,Qt+jt,Yt+Xt,Ar+er).normalize(),ht[3].setComponents(Lt-Pt,Qt-jt,Yt-Xt,Ar-er).normalize(),ht[4].setComponents(Lt-Mt,Qt-Wt,Yt-Zt,Ar-tr).normalize(),lt===jo)ht[5].setComponents(Lt+Mt,Qt+Wt,Yt+Zt,Ar+tr).normalize();else{if(lt!==Wo)throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+lt);ht[5].setComponents(Mt,Wt,Zt,tr).normalize()}return this}intersectsObject(tt){if(tt.boundingSphere!==void 0)tt.boundingSphere===null&&tt.computeBoundingSphere(),Ep.copy(tt.boundingSphere).applyMatrix4(tt.matrixWorld);else{const lt=tt.geometry;lt.boundingSphere===null&&lt.computeBoundingSphere(),Ep.copy(lt.boundingSphere).applyMatrix4(tt.matrixWorld)}return this.intersectsSphere(Ep)}intersectsSprite(tt){return Ep.center.set(0,0,0),Ep.radius=.7071067811865476,Ep.applyMatrix4(tt.matrixWorld),this.intersectsSphere(Ep)}intersectsSphere(tt){const lt=this.planes,ht=tt.center,_t=-tt.radius;for(let bt=0;bt<6;bt++)if(lt[bt].distanceToPoint(ht)<_t)return!1;return!0}intersectsBox(tt){const lt=this.planes;for(let ht=0;ht<6;ht++){const _t=lt[ht];if(xv.x=_t.normal.x>0?tt.max.x:tt.min.x,xv.y=_t.normal.y>0?tt.max.y:tt.min.y,xv.z=_t.normal.z>0?tt.max.z:tt.min.z,_t.distanceToPoint(xv)<0)return!1}return!0}containsPoint(tt){const lt=this.planes;for(let ht=0;ht<6;ht++)if(lt[ht].distanceToPoint(tt)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}function Hy(){let St=null,tt=!1,lt=null,ht=null;function _t(bt,Pt){lt(bt,Pt),ht=St.requestAnimationFrame(_t)}return{start:function(){tt!==!0&&lt!==null&&(ht=St.requestAnimationFrame(_t),tt=!0)},stop:function(){St.cancelAnimationFrame(ht),tt=!1},setAnimationLoop:function(bt){lt=bt},setContext:function(bt){St=bt}}}function Sw(St,tt){const lt=tt.isWebGL2,ht=new WeakMap;return{get:function(_t){return _t.isInterleavedBufferAttribute&&(_t=_t.data),ht.get(_t)},remove:function(_t){_t.isInterleavedBufferAttribute&&(_t=_t.data);const bt=ht.get(_t);bt&&(St.deleteBuffer(bt.buffer),ht.delete(_t))},update:function(_t,bt){if(_t.isGLBufferAttribute){const Mt=ht.get(_t);return void((!Mt||Mt.version<_t.version)&&ht.set(_t,{buffer:_t.buffer,type:_t.type,bytesPerElement:_t.elementSize,version:_t.version}))}_t.isInterleavedBufferAttribute&&(_t=_t.data);const Pt=ht.get(_t);Pt===void 0?ht.set(_t,function(Mt,Lt){const Nt=Mt.array,jt=Mt.usage,Wt=St.createBuffer();let Qt;if(St.bindBuffer(Lt,Wt),St.bufferData(Lt,Nt,jt),Mt.onUploadCallback(),Nt instanceof Float32Array)Qt=St.FLOAT;else if(Nt instanceof Uint16Array)if(Mt.isFloat16BufferAttribute){if(!lt)throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");Qt=St.HALF_FLOAT}else Qt=St.UNSIGNED_SHORT;else if(Nt instanceof Int16Array)Qt=St.SHORT;else if(Nt instanceof Uint32Array)Qt=St.UNSIGNED_INT;else if(Nt instanceof Int32Array)Qt=St.INT;else if(Nt instanceof Int8Array)Qt=St.BYTE;else if(Nt instanceof Uint8Array)Qt=St.UNSIGNED_BYTE;else{if(!(Nt instanceof Uint8ClampedArray))throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+Nt);Qt=St.UNSIGNED_BYTE}return{buffer:Wt,type:Qt,bytesPerElement:Nt.BYTES_PER_ELEMENT,version:Mt.version}}(_t,bt)):Pt.version<_t.version&&(function(Mt,Lt,Nt){const jt=Lt.array,Wt=Lt.updateRange;St.bindBuffer(Nt,Mt),Wt.count===-1?St.bufferSubData(Nt,0,jt):(lt?St.bufferSubData(Nt,Wt.offset*jt.BYTES_PER_ELEMENT,jt,Wt.offset,Wt.count):St.bufferSubData(Nt,Wt.offset*jt.BYTES_PER_ELEMENT,jt.subarray(Wt.offset,Wt.offset+Wt.count)),Wt.count=-1),Lt.onUploadCallback()}(Pt.buffer,_t,bt),Pt.version=_t.version)}}}class f_ extends fs{constructor(tt=1,lt=1,ht=1,_t=1){super(),this.type="PlaneGeometry",this.parameters={width:tt,height:lt,widthSegments:ht,heightSegments:_t};const bt=tt/2,Pt=lt/2,Mt=Math.floor(ht),Lt=Math.floor(_t),Nt=Mt+1,jt=Lt+1,Wt=tt/Mt,Qt=lt/Lt,qt=[],Xt=[],Zt=[],Yt=[];for(let ar=0;ar<jt;ar++){const er=ar*Qt-Pt;for(let tr=0;tr<Nt;tr++){const Ar=tr*Wt-bt;Xt.push(Ar,-er,0),Zt.push(0,0,1),Yt.push(tr/Mt),Yt.push(1-ar/Lt)}}for(let ar=0;ar<Lt;ar++)for(let er=0;er<Mt;er++){const tr=er+Nt*ar,Ar=er+Nt*(ar+1),wr=er+1+Nt*(ar+1),br=er+1+Nt*ar;qt.push(tr,Ar,br),qt.push(Ar,wr,br)}this.setIndex(qt),this.setAttribute("position",new On(Xt,3)),this.setAttribute("normal",new On(Zt,3)),this.setAttribute("uv",new On(Yt,2))}copy(tt){return super.copy(tt),this.parameters=Object.assign({},tt.parameters),this}static fromJSON(tt){return new f_(tt.width,tt.height,tt.widthSegments,tt.heightSegments)}}const ds={alphahash_fragment:`#ifdef USE_ALPHAHASH
	if ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;
#endif`,alphahash_pars_fragment:`#ifdef USE_ALPHAHASH
	const float ALPHA_HASH_SCALE = 0.05;
	float hash2D( vec2 value ) {
		return fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );
	}
	float hash3D( vec3 value ) {
		return hash2D( vec2( hash2D( value.xy ), value.z ) );
	}
	float getAlphaHashThreshold( vec3 position ) {
		float maxDeriv = max(
			length( dFdx( position.xyz ) ),
			length( dFdy( position.xyz ) )
		);
		float pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );
		vec2 pixScales = vec2(
			exp2( floor( log2( pixScale ) ) ),
			exp2( ceil( log2( pixScale ) ) )
		);
		vec2 alpha = vec2(
			hash3D( floor( pixScales.x * position.xyz ) ),
			hash3D( floor( pixScales.y * position.xyz ) )
		);
		float lerpFactor = fract( log2( pixScale ) );
		float x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;
		float a = min( lerpFactor, 1.0 - lerpFactor );
		vec3 cases = vec3(
			x * x / ( 2.0 * a * ( 1.0 - a ) ),
			( x - 0.5 * a ) / ( 1.0 - a ),
			1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )
		);
		float threshold = ( x < ( 1.0 - a ) )
			? ( ( x < a ) ? cases.x : cases.y )
			: cases.z;
		return clamp( threshold , 1.0e-6, 1.0 );
	}
#endif`,alphamap_fragment:`#ifdef USE_ALPHAMAP
	#if defined(INVERSE_ALPHAMAP) && INVERSE_ALPHAMAP >= 1
	diffuseColor.a *= 1.0-texture2D( alphaMap, vAlphaMapUv ).g;
	#else
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
	#endif
#endif`,alphamap_pars_fragment:`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,alphatest_fragment:`#ifdef USE_ALPHATEST
	if ( diffuseColor.a < alphaTest ) discard;
#endif`,alphatest_pars_fragment:`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,aomap_fragment:`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometryNormal, geometryViewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,aomap_pars_fragment:`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,begin_vertex:`vec3 transformed = vec3( position );
#ifdef USE_ALPHAHASH
	vPosition = vec3( position );
#endif`,beginnormal_vertex:`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,bsdfs:`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,iridescence_fragment:`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,bumpmap_pars_fragment:`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = dFdx( surf_pos.xyz );
		vec3 vSigmaY = dFdy( surf_pos.xyz );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,clipping_planes_fragment:`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#pragma unroll_loop_start
	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
		plane = clippingPlanes[ i ];
		if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
	}
	#pragma unroll_loop_end
	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
		bool clipped = true;
		#pragma unroll_loop_start
		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
		}
		#pragma unroll_loop_end
		if ( clipped ) discard;
	#endif
#endif`,clipping_planes_pars_fragment:`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,clipping_planes_pars_vertex:`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,clipping_planes_vertex:`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,color_fragment:`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,color_pars_fragment:`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,color_pars_vertex:`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,color_vertex:`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,common:`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
#ifdef USE_ALPHAHASH
	varying vec3 vPosition;
#endif
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float luminance( const in vec3 rgb ) {
	const vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );
	return dot( weights, rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,cube_uv_reflection_fragment:`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_v0 0.339
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_v1 0.276
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_v4 0.046
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_v5 0.016
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_v6 0.0038
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,defaultnormal_vertex:`vec3 transformedNormal = objectNormal;
#ifdef USE_INSTANCING
	mat3 m = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );
	transformedNormal = m * transformedNormal;
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,displacementmap_pars_vertex:`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,displacementmap_vertex:`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,emissivemap_fragment:`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,emissivemap_pars_fragment:`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,colorspace_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",colorspace_pars_fragment:`
const mat3 LINEAR_SRGB_TO_LINEAR_DISPLAY_P3 = mat3(
	vec3( 0.8224621, 0.177538, 0.0 ),
	vec3( 0.0331941, 0.9668058, 0.0 ),
	vec3( 0.0170827, 0.0723974, 0.9105199 )
);
const mat3 LINEAR_DISPLAY_P3_TO_LINEAR_SRGB = mat3(
	vec3( 1.2249401, - 0.2249404, 0.0 ),
	vec3( - 0.0420569, 1.0420571, 0.0 ),
	vec3( - 0.0196376, - 0.0786361, 1.0982735 )
);
vec4 LinearSRGBToLinearDisplayP3( in vec4 value ) {
	return vec4( value.rgb * LINEAR_SRGB_TO_LINEAR_DISPLAY_P3, value.a );
}
vec4 LinearDisplayP3ToLinearSRGB( in vec4 value ) {
	return vec4( value.rgb * LINEAR_DISPLAY_P3_TO_LINEAR_SRGB, value.a );
}
vec4 LinearTransferOETF( in vec4 value ) {
	return value;
}
vec4 sRGBTransferOETF( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}
vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 LinearTosRGB( in vec4 value ) {
	return sRGBTransferOETF( value );
}
vec4 sRGBToLinear( in vec4 value ) {
	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
}
vec4 RGBM16ToLinear( in vec4 value ) {
	return vec4( value.rgb * value.a * 16.0, 1.0 );
}
vec4 LinearToRGBM16( in vec4 value ) {
	float maxRGB = max( value.r, max( value.g, value.b ) );
	float M = clamp( maxRGB / 16.0, 0.0, 1.0 );
	M = ceil( M * 255.0 ) / 255.0;
	return vec4( value.rgb / ( M * 16.0 ), M );
}`,envmap_fragment:`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	reflectVec = transformDirection(reflectVec, rotationMatrix(vec3(0,1,0), envMapRotation));
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,envmap_common_pars_fragment:`#ifdef USE_ENVMAP
	mat4 rotationMatrix(vec3 axis, float angle) {
		axis = normalize(axis);
		float s = sin(angle);
		float c = cos(angle);
		float oc = 1.0 - c;
		return mat4(oc * axis.x * axis.x + c,           oc * axis.x * axis.y - axis.z * s,  oc * axis.z * axis.x + axis.y * s,  0.0,
					oc * axis.x * axis.y + axis.z * s,  oc * axis.y * axis.y + c,           oc * axis.y * axis.z - axis.x * s,  0.0,
					oc * axis.z * axis.x - axis.y * s,  oc * axis.y * axis.z + axis.x * s,  oc * axis.z * axis.z + c,           0.0,
					0.0,                                0.0,                                0.0,                                1.0);
	}
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform float envMapRotation;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
#endif`,envmap_pars_fragment:`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,envmap_pars_vertex:`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,envmap_physical_pars_fragment:`#ifdef USE_ENVMAP
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
		#if defined( FIX_ENV_DIRECTION )
			vec3 worldNormal = normal;
		#else
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#endif
			worldNormal = transformDirection(worldNormal, rotationMatrix(vec3(0,1,0), envMapRotation));
			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			#if !defined( FIX_ENV_DIRECTION )
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			#endif
			reflectVec = transformDirection(reflectVec, rotationMatrix(vec3(0,1,0), envMapRotation));
			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	#ifdef USE_ANISOTROPY
		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {
			#ifdef ENVMAP_TYPE_CUBE_UV
				vec3 bentNormal = cross( bitangent, viewDir );
				bentNormal = normalize( cross( bentNormal, bitangent ) );
				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );
				return getIBLRadiance( viewDir, bentNormal, roughness );
			#else
				return vec3( 0.0 );
			#endif
		}
	#endif
#endif`,envmap_vertex:`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,fog_vertex:`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,fog_pars_vertex:`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,fog_fragment:`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,fog_pars_fragment:`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,gradientmap_pars_fragment:`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,lightmap_fragment:`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
	vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
	reflectedLight.indirectDiffuse += lightMapIrradiance;
#endif`,lightmap_pars_fragment:`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,lights_lambert_fragment:`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,lights_lambert_pars_fragment:`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,lights_pars_begin:`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
#if defined( USE_LIGHT_PROBES )
	uniform vec3 lightProbe[ 9 ];
#endif
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	#if defined ( LEGACY_LIGHTS )
		if ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
			return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );
		}
		return 1.0;
	#else
		float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
		if ( cutoffDistance > 0.0 ) {
			distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
		}
		return distanceFalloff;
	#endif
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,lights_toon_fragment:`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,lights_toon_pars_fragment:`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,lights_phong_fragment:`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,lights_phong_pars_fragment:`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,lights_physical_fragment:`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif
#ifdef USE_ANISOTROPY
	#ifdef USE_ANISOTROPYMAP
		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );
		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;
		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;
	#else
		vec2 anisotropyV = anisotropyVector;
	#endif
	material.anisotropy = length( anisotropyV );
	anisotropyV /= material.anisotropy;
	material.anisotropy = saturate( material.anisotropy );
	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );
	material.anisotropyT = tbn[ 0 ] * anisotropyV.x - tbn[ 1 ] * anisotropyV.y;
	material.anisotropyB = tbn[ 1 ] * anisotropyV.x + tbn[ 0 ] * anisotropyV.y;
#endif`,lights_physical_pars_fragment:`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
	#ifdef USE_ANISOTROPY
		float anisotropy;
		float alphaT;
		vec3 anisotropyT;
		vec3 anisotropyB;
	#endif
};
vec3 clearcoatSpecular = vec3( 0.0 );
vec3 sheenSpecular = vec3( 0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#if defined( USE_ANISOTROPY ) || defined( USE_ANISOTROPY_BRDF )
	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {
		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );
		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );
		float v = 0.5 / ( gv + gl );
		return saturate(v);
	}
	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {
		float a2 = alphaT * alphaB;
		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );
		highp float v2 = dot( v, v );
		float w2 = a2 / v2;
		return RECIPROCAL_PI * a2 * pow2 ( w2 );
	}
#endif
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColor;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	#ifdef USE_ANISOTROPY
		float dotTL = dot( material.anisotropyT, lightDir );
		float dotTV = dot( material.anisotropyT, viewDir );
		float dotTH = dot( material.anisotropyT, halfDir );
		float dotBL = dot( material.anisotropyB, lightDir );
		float dotBV = dot( material.anisotropyB, viewDir );
		float dotBH = dot( material.anisotropyB, halfDir );
		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );
		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );
	#else
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
	#endif
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometryNormal;
		vec3 viewDir = geometryViewDir;
		vec3 position = geometryPosition;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecular += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,lights_fragment_begin:`
vec3 geometryPosition = - vViewPosition;
vec3 geometryNormal = normal;
vec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
vec3 geometryClearcoatNormal;
#ifdef USE_CLEARCOAT
	geometryClearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometryViewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometryPosition, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometryPosition, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	#if defined( USE_LIGHT_PROBES )
		irradiance += getLightProbeIrradiance( lightProbe, geometryNormal );
	#endif
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,lights_fragment_maps:`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometryNormal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	#ifdef USE_ANISOTROPY
		radiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );
	#else
		radiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );
	#endif
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,lights_fragment_end:`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif`,logdepthbuf_fragment:`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,logdepthbuf_pars_fragment:`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,logdepthbuf_pars_vertex:`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,logdepthbuf_vertex:`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,map_fragment:`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vMapUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );
	
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,map_pars_fragment:`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,map_particle_fragment:`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,map_particle_pars_fragment:`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,metalnessmap_fragment:`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,metalnessmap_pars_fragment:`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,morphcolor_vertex:`#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,morphnormal_vertex:`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
		objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
		objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
		objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
	#endif
#endif`,morphtarget_pars_vertex:`#ifdef USE_MORPHTARGETS
	uniform float morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
		uniform sampler2DArray morphTargetsTexture;
		uniform ivec2 morphTargetsTextureSize;
		vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
			int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
			int y = texelIndex / morphTargetsTextureSize.x;
			int x = texelIndex - y * morphTargetsTextureSize.x;
			ivec3 morphUV = ivec3( x, y, morphTargetIndex );
			return texelFetch( morphTargetsTexture, morphUV, 0 );
		}
	#else
		#ifndef USE_MORPHNORMALS
			uniform float morphTargetInfluences[ 8 ];
		#else
			uniform float morphTargetInfluences[ 4 ];
		#endif
	#endif
#endif`,morphtarget_vertex:`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		transformed += morphTarget0 * morphTargetInfluences[ 0 ];
		transformed += morphTarget1 * morphTargetInfluences[ 1 ];
		transformed += morphTarget2 * morphTargetInfluences[ 2 ];
		transformed += morphTarget3 * morphTargetInfluences[ 3 ];
		#ifndef USE_MORPHNORMALS
			transformed += morphTarget4 * morphTargetInfluences[ 4 ];
			transformed += morphTarget5 * morphTargetInfluences[ 5 ];
			transformed += morphTarget6 * morphTargetInfluences[ 6 ];
			transformed += morphTarget7 * morphTargetInfluences[ 7 ];
		#endif
	#endif
#endif`,normal_fragment_begin:`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal,
		#if defined( USE_NORMALMAP )
			vNormalMapUv
		#elif defined( USE_CLEARCOAT_NORMALMAP )
			vClearcoatNormalMapUv
		#else
			vUv
		#endif
		);
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 nonPerturbedNormal = normal;`,normal_fragment_maps:`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,normal_pars_fragment:`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,normal_pars_vertex:`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,normal_vertex:`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,normalmap_pars_fragment:`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,clearcoat_normal_fragment_begin:`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = nonPerturbedNormal;
#endif`,clearcoat_normal_fragment_maps:`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,clearcoat_pars_fragment:`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,iridescence_pars_fragment:`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,opaque_fragment:`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha;
diffuseColor.a = min(max(diffuseColor.a, 0.), 1.);
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,packing:`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec2 packDepthToRG( in highp float v ) {
	return packDepthToRGBA( v ).yx;
}
float unpackRGToDepth( const in highp vec2 v ) {
	return unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,premultiplied_alpha_fragment:`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,project_vertex:`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,dithering_fragment:`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,dithering_pars_fragment:`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,roughnessmap_fragment:`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,roughnessmap_pars_fragment:`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,shadowmap_pars_fragment:`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,shadowmap_pars_vertex:`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,shadowmap_vertex:`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,shadowmask_pars_fragment:`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,skinbase_vertex:`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,skinning_pars_vertex:`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	uniform int boneTextureSize;
	mat4 getBoneMatrix( const in float i ) {
		float j = i * 4.0;
		float x = mod( j, float( boneTextureSize ) );
		float y = floor( j / float( boneTextureSize ) );
		float dx = 1.0 / float( boneTextureSize );
		float dy = 1.0 / float( boneTextureSize );
		y = dy * ( y + 0.5 );
		vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );
		vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );
		vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );
		vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );
		mat4 bone = mat4( v1, v2, v3, v4 );
		return bone;
	}
#endif`,skinning_vertex:`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,skinnormal_vertex:`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,specularmap_fragment:`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,specularmap_pars_fragment:`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,tonemapping_fragment:`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,tonemapping_pars_fragment:`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return saturate( toneMappingExposure * color );
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,transmission_fragment:`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmitted = getIBLVolumeRefraction(
		n, v, roughnessFactor, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );
#endif`,transmission_pars_fragment:`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	#ifndef WebGL2Context
	#define textureLod texture2DLodEXT
	#define textureSize(s, lod) vec2(1024./pow(2.,float(lod)),1024./pow(2.,float(lod)))
	#define isinf(x) (x > 1e20 || x < -1e20)
	#endif
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		if(roughness == 0.0) return transmissionSamplerMapTexelToLinear( texture2D( transmissionSamplerMap, fragCoord.xy ) );
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return transmissionSamplerMapTexelToLinear( textureBicubic( transmissionSamplerMap, fragCoord.xy, lod ) );
	}
	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) || attenuationDistance == 0.0) {
			return vec3( 1.0 );
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
		vec3 refractedRayExit = position + transmissionRay;
		vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
		vec2 refractionCoords = ndcPos.xy / ndcPos.w;
		refractionCoords += 1.0;
		refractionCoords /= 2.0;
		vec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
		vec3 transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );
		vec3 attenuatedColor = transmittance * transmittedLight.rgb;
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;
		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );
	}
#endif`,uv_pars_fragment:`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,uv_pars_vertex:`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,uv_vertex:`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ANISOTROPYMAP
	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,worldpos_vertex:`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`,background_vert:`#ifdef HAS_TEXTURE
varying vec2 vUv;
uniform mat3 uvTransform;
uniform bool flipX;
uniform bool flipY;
#endif
void main() {
#ifdef HAS_TEXTURE
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
    vUv = flipX ? vec2( 1.0 - vUv.x, vUv.y ) : vUv;
    vUv = flipY ? vec2( vUv.x, 1.0 - vUv.y ) : vUv;
#endif
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,background_frag:`#ifdef HAS_TEXTURE
uniform sampler2D t2D;
varying vec2 vUv;
#endif
uniform float backgroundIntensity;
uniform vec3 backgroundColor;
void main() {
#ifdef HAS_TEXTURE
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
#else
	vec4 texColor = vec4( 1.0 );
#endif
	texColor.rgb *= backgroundColor * backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,backgroundCube_vert:`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,backgroundCube_frag:`#include <envmap_common_pars_fragment>
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
void main() {
	vec3 vReflect = vWorldDirection;
	vReflect = transformDirection(vReflect, rotationMatrix(vec3(0,1,0), envMapRotation));
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, vec3( flipEnvMap * vReflect.x, vReflect.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, vReflect, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	texColor.rgb *= envMapIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,cube_vert:`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,cube_frag:`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,depth_vert:`#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,depth_frag:`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,distanceRGBA_vert:`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,distanceRGBA_frag:`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,equirect_vert:`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,equirect_frag:`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,linedashed_vert:`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,linedashed_frag:`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,meshbasic_vert:`#include <common>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,meshbasic_frag:`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshlambert_vert:`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshlambert_frag:`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshmatcap_vert:`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,meshmatcap_frag:`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshnormal_vert:`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,meshnormal_frag:`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,meshphong_vert:`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshphong_frag:`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshphysical_vert:`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,meshphysical_frag:`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
#ifdef USE_ANISOTROPY
	uniform vec2 anisotropyVector;
	#ifdef USE_ANISOTROPYMAP
		uniform sampler2D anisotropyMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;
	#endif
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshtoon_vert:`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshtoon_frag:`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,points_vert:`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,points_frag:`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,shadow_vert:`#include <common>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,shadow_frag:`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,sprite_vert:`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,sprite_frag:`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`},Dn={common:{diffuse:{value:new jn(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new os},alphaMap:{value:null},alphaMapTransform:{value:new os},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new os}},envmap:{envMap:{value:null},envMapRotation:{value:0},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new os}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new os}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new os},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new os},normalScale:{value:new mn(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new os},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new os}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new os}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new os}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new jn(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new jn(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new os},alphaTest:{value:0},uvTransform:{value:new os}},sprite:{diffuse:{value:new jn(16777215)},opacity:{value:1},center:{value:new mn(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new os},alphaMap:{value:null},alphaMapTransform:{value:new os},alphaTest:{value:0}}},zo={basic:{uniforms:Bo([Dn.common,Dn.specularmap,Dn.envmap,Dn.aomap,Dn.lightmap,Dn.fog]),vertexShader:ds.meshbasic_vert,fragmentShader:ds.meshbasic_frag},lambert:{uniforms:Bo([Dn.common,Dn.specularmap,Dn.envmap,Dn.aomap,Dn.lightmap,Dn.emissivemap,Dn.bumpmap,Dn.normalmap,Dn.displacementmap,Dn.fog,Dn.lights,{emissive:{value:new jn(0)}}]),vertexShader:ds.meshlambert_vert,fragmentShader:ds.meshlambert_frag},phong:{uniforms:Bo([Dn.common,Dn.specularmap,Dn.envmap,Dn.aomap,Dn.lightmap,Dn.emissivemap,Dn.bumpmap,Dn.normalmap,Dn.displacementmap,Dn.fog,Dn.lights,{emissive:{value:new jn(0)},specular:{value:new jn(1118481)},shininess:{value:30}}]),vertexShader:ds.meshphong_vert,fragmentShader:ds.meshphong_frag},standard:{uniforms:Bo([Dn.common,Dn.envmap,Dn.aomap,Dn.lightmap,Dn.emissivemap,Dn.bumpmap,Dn.normalmap,Dn.displacementmap,Dn.roughnessmap,Dn.metalnessmap,Dn.fog,Dn.lights,{emissive:{value:new jn(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:ds.meshphysical_vert,fragmentShader:ds.meshphysical_frag},toon:{uniforms:Bo([Dn.common,Dn.aomap,Dn.lightmap,Dn.emissivemap,Dn.bumpmap,Dn.normalmap,Dn.displacementmap,Dn.gradientmap,Dn.fog,Dn.lights,{emissive:{value:new jn(0)}}]),vertexShader:ds.meshtoon_vert,fragmentShader:ds.meshtoon_frag},matcap:{uniforms:Bo([Dn.common,Dn.bumpmap,Dn.normalmap,Dn.displacementmap,Dn.fog,{matcap:{value:null}}]),vertexShader:ds.meshmatcap_vert,fragmentShader:ds.meshmatcap_frag},points:{uniforms:Bo([Dn.points,Dn.fog]),vertexShader:ds.points_vert,fragmentShader:ds.points_frag},dashed:{uniforms:Bo([Dn.common,Dn.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:ds.linedashed_vert,fragmentShader:ds.linedashed_frag},depth:{uniforms:Bo([Dn.common,Dn.displacementmap]),vertexShader:ds.depth_vert,fragmentShader:ds.depth_frag},normal:{uniforms:Bo([Dn.common,Dn.bumpmap,Dn.normalmap,Dn.displacementmap,{opacity:{value:1}}]),vertexShader:ds.meshnormal_vert,fragmentShader:ds.meshnormal_frag},sprite:{uniforms:Bo([Dn.sprite,Dn.fog]),vertexShader:ds.sprite_vert,fragmentShader:ds.sprite_frag},background:{uniforms:{uvTransform:{value:new os},t2D:{value:null},backgroundIntensity:{value:1},backgroundColor:{value:new jn(16777215)},flipX:{value:!1},flipY:{value:!1}},vertexShader:ds.background_vert,fragmentShader:ds.background_frag},backgroundCube:{uniforms:{envMap:{value:null},envMapRotation:{value:0},envMapIntensity:{value:1},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1}},vertexShader:ds.backgroundCube_vert,fragmentShader:ds.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:ds.cube_vert,fragmentShader:ds.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:ds.equirect_vert,fragmentShader:ds.equirect_frag},distanceRGBA:{uniforms:Bo([Dn.common,Dn.displacementmap,{referencePosition:{value:new Sr},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:ds.distanceRGBA_vert,fragmentShader:ds.distanceRGBA_frag},shadow:{uniforms:Bo([Dn.lights,Dn.fog,{color:{value:new jn(0)},opacity:{value:1}}]),vertexShader:ds.shadow_vert,fragmentShader:ds.shadow_frag}};zo.physical={uniforms:Bo([zo.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new os},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new os},clearcoatNormalScale:{value:new mn(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new os},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new os},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new os},sheen:{value:0},sheenColor:{value:new jn(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new os},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new os},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new os},transmissionSamplerSize:{value:new mn},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new os},attenuationDistance:{value:0},attenuationColor:{value:new jn(0)},specularColor:{value:new jn(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new os},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new os},anisotropyVector:{value:new mn},anisotropyMap:{value:null},anisotropyMapTransform:{value:new os}}]),vertexShader:ds.meshphysical_vert,fragmentShader:ds.meshphysical_frag};const wv={r:0,b:0,g:0};function Cw(St,tt,lt,ht,_t,bt,Pt){const Mt=new jn(0);let Lt,Nt,jt=bt===!0?0:1,Wt=null,Qt=0,qt=null;function Xt(Zt,Yt){Zt.getRGB(wv,jy(St)),ht.buffers.color.setClear(wv.r,wv.g,wv.b,Yt,Pt)}return{getClearColor:function(){return Mt},setClearColor:function(Zt,Yt=1){Mt.set(Zt),jt=Yt,Xt(Mt,jt)},getClearAlpha:function(){return jt},setClearAlpha:function(Zt){jt=Zt,Xt(Mt,jt)},getPlaneMesh:function(){return Lt},getBoxMesh:function(){return Nt},getBoxMesh2:function(){return Nt===void 0&&(Nt=new co(new Xu(1,1,1),new Ul({name:"BackgroundCubeMaterial",uniforms:wp(zo.backgroundCube.uniforms),vertexShader:zo.backgroundCube.vertexShader,fragmentShader:zo.backgroundCube.fragmentShader,side:xt,depthTest:!1,depthWrite:!1,fog:!1})),Nt.geometry.deleteAttribute("normal"),Nt.geometry.deleteAttribute("uv"),Nt.onBeforeRender=function(Zt,Yt,ar){this.matrixWorld.copyPosition(ar.matrixWorld)},Object.defineProperty(Nt.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),_t.update(Nt)),Nt},render:function(Zt,Yt){let ar=!1,er=Yt.isScene===!0?Yt.background:null;const tr=Yt.isScene&&Yt.backgroundColor!==void 0?Yt.backgroundColor:null;er==="environment"&&(er=Yt.environment),er&&er.isTexture&&(er=(Yt.backgroundBlurriness>0?lt:tt).get(er)),er===null?Xt(Mt,jt):er&&er.isColor&&(Xt(er,1),ar=!0);const Ar=St.xr.getEnvironmentBlendMode();if(Ar==="additive"?ht.buffers.color.setClear(0,0,0,1,Pt):Ar==="alpha-blend"&&ht.buffers.color.setClear(0,0,0,0,Pt),(St.autoClear||ar)&&St.clear(St.autoClearColor,St.autoClearDepth,St.autoClearStencil),er&&(er.isCubeTexture||er.mapping===Mn))Nt===void 0&&(Nt=new co(new Xu(1,1,1),new Ul({name:"BackgroundCubeMaterial",uniforms:wp(zo.backgroundCube.uniforms),vertexShader:zo.backgroundCube.vertexShader,fragmentShader:zo.backgroundCube.fragmentShader,side:xt,depthTest:!1,depthWrite:!1,fog:!1})),Nt.geometry.deleteAttribute("normal"),Nt.geometry.deleteAttribute("uv"),Nt.onBeforeRender=function(wr,br,Mr){this.matrixWorld.copyPosition(Mr.matrixWorld)},Object.defineProperty(Nt.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),_t.update(Nt)),Nt.material.uniforms.envMap.value=er,Nt.material.uniforms.envMapRotation.value=er&&er.rotation||0,Nt.material.uniforms.envMapIntensity.value=er===Yt.environment&&Yt.envMapIntensity||.05,Nt.material.uniforms.flipEnvMap.value=er.isCubeTexture&&er.isRenderTargetTexture===!1?-1:1,Nt.material.uniforms.backgroundBlurriness.value=Yt.backgroundBlurriness,Nt.material.uniforms.backgroundIntensity.value=Yt.backgroundIntensity,Nt.material.toneMapped=Is.getTransfer(er.colorSpace)!==Fs,Wt===er&&Qt===er.version&&qt===St.toneMapping||(Nt.material.needsUpdate=!0,Wt=er,Qt=er.version,qt=St.toneMapping),Nt.layers.enableAll(),Zt.unshift(Nt,Nt.geometry,Nt.material,0,0,null);else if(er&&er.isTexture||!er&&tr){Lt===void 0&&(Lt=new co(new f_(2,2),new Ul({name:"BackgroundMaterial",uniforms:wp(zo.background.uniforms),vertexShader:zo.background.vertexShader,fragmentShader:zo.background.fragmentShader,side:vt,depthTest:!1,depthWrite:!1,fog:!1})),Lt.geometry.deleteAttribute("normal"),Object.defineProperty(Lt.material,"map",{get:function(){return this.uniforms.t2D.value}}),_t.update(Lt)),Lt.material.uniforms.backgroundColor.value.set(tr||16777215),Lt.material.uniforms.t2D.value=er,Lt.material.uniforms.backgroundIntensity.value=Yt.backgroundIntensity,er?(Lt.material.toneMapped=Is.getTransfer(er.colorSpace)!==Fs,Lt.material.uniforms.flipX.value=er.userData.flipX||!1,Lt.material.uniforms.flipY.value=er.userData.flipY||!1,er.matrixAutoUpdate===!0&&er.updateMatrix(),Lt.material.uniforms.uvTransform.value.copy(er.matrix),Lt.material.defines.HAS_TEXTURE="1"):Lt.material.defines.HAS_TEXTURE&&delete Lt.material.defines.HAS_TEXTURE;const wr=er?er.version:-1;Wt===er&&Qt===wr&&qt===St.toneMapping||(Lt.material.needsUpdate=!0,Wt=er,Qt=wr,qt=St.toneMapping),Lt.layers.enableAll(),Zt.unshift(Lt,Lt.geometry,Lt.material,0,0,null)}}}}function Pw(St,tt,lt,ht){const _t=St.getParameter(St.MAX_VERTEX_ATTRIBS),bt=ht.isWebGL2?null:tt.get("OES_vertex_array_object"),Pt=ht.isWebGL2||bt!==null,Mt={},Lt=qt(null);let Nt=Lt,jt=!1;function Wt(wr){return ht.isWebGL2?St.bindVertexArray(wr):bt.bindVertexArrayOES(wr)}function Qt(wr){return ht.isWebGL2?St.deleteVertexArray(wr):bt.deleteVertexArrayOES(wr)}function qt(wr){const br=[],Mr=[],Qr=[];for(let Fr=0;Fr<_t;Fr++)br[Fr]=0,Mr[Fr]=0,Qr[Fr]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:br,enabledAttributes:Mr,attributeDivisors:Qr,object:wr,attributes:{},index:null}}function Xt(){const wr=Nt.newAttributes;for(let br=0,Mr=wr.length;br<Mr;br++)wr[br]=0}function Zt(wr){Yt(wr,0)}function Yt(wr,br){const Mr=Nt.newAttributes,Qr=Nt.enabledAttributes,Fr=Nt.attributeDivisors;Mr[wr]=1,Qr[wr]===0&&(St.enableVertexAttribArray(wr),Qr[wr]=1),Fr[wr]!==br&&((ht.isWebGL2?St:tt.get("ANGLE_instanced_arrays"))[ht.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](wr,br),Fr[wr]=br)}function ar(){const wr=Nt.newAttributes,br=Nt.enabledAttributes;for(let Mr=0,Qr=br.length;Mr<Qr;Mr++)br[Mr]!==wr[Mr]&&(St.disableVertexAttribArray(Mr),br[Mr]=0)}function er(wr,br,Mr,Qr,Fr,Vr,zr){zr===!0?St.vertexAttribIPointer(wr,br,Mr,Fr,Vr):St.vertexAttribPointer(wr,br,Mr,Qr,Fr,Vr)}function tr(){Ar(),jt=!0,Nt!==Lt&&(Nt=Lt,Wt(Nt.object))}function Ar(){Lt.geometry=null,Lt.program=null,Lt.wireframe=!1}return{setup:function(wr,br,Mr,Qr,Fr){let Vr=!1;if(Pt){const zr=function(Hr,_n,hn){const Rn=hn.wireframe===!0;let Bn=Mt[Hr.id];Bn===void 0&&(Bn={},Mt[Hr.id]=Bn);let un=Bn[_n.id];un===void 0&&(un={},Bn[_n.id]=un);let Xr=un[Rn];return Xr===void 0&&(Xr=qt(ht.isWebGL2?St.createVertexArray():bt.createVertexArrayOES()),un[Rn]=Xr),Xr}(Qr,Mr,br);Nt!==zr&&(Nt=zr,Wt(Nt.object)),Vr=function(Hr,_n,hn,Rn){const Bn=Nt.attributes,un=_n.attributes;let Xr=0;const Jr=hn.getAttributes();for(const an in Jr)if(Jr[an].location>=0){const sn=Bn[an];let Fn=un[an];if(Fn===void 0&&(an==="instanceMatrix"&&Hr.instanceMatrix&&(Fn=Hr.instanceMatrix),an==="instanceColor"&&Hr.instanceColor&&(Fn=Hr.instanceColor)),sn===void 0||sn.attribute!==Fn||Fn&&sn.data!==Fn.data)return!0;Xr++}return Nt.attributesNum!==Xr||Nt.index!==Rn}(wr,Qr,Mr,Fr),Vr&&function(Hr,_n,hn,Rn){const Bn={},un=_n.attributes;let Xr=0;const Jr=hn.getAttributes();for(const an in Jr)if(Jr[an].location>=0){let sn=un[an];sn===void 0&&(an==="instanceMatrix"&&Hr.instanceMatrix&&(sn=Hr.instanceMatrix),an==="instanceColor"&&Hr.instanceColor&&(sn=Hr.instanceColor));const Fn={};Fn.attribute=sn,sn&&sn.data&&(Fn.data=sn.data),Bn[an]=Fn,Xr++}Nt.attributes=Bn,Nt.attributesNum=Xr,Nt.index=Rn}(wr,Qr,Mr,Fr)}else{const zr=br.wireframe===!0;Nt.geometry===Qr.id&&Nt.program===Mr.id&&Nt.wireframe===zr||(Nt.geometry=Qr.id,Nt.program=Mr.id,Nt.wireframe=zr,Vr=!0)}Fr!==null&&lt.update(Fr,St.ELEMENT_ARRAY_BUFFER),(Vr||jt)&&(jt=!1,function(zr,Hr,_n,hn){if(ht.isWebGL2===!1&&(zr.isInstancedMesh||hn.isInstancedBufferGeometry)&&tt.get("ANGLE_instanced_arrays")===null)return;Xt();const Rn=hn.attributes,Bn=_n.getAttributes(),un=Hr.defaultAttributeValues;for(const Xr in Bn){const Jr=Bn[Xr];if(Jr.location>=0){let an=Rn[Xr];if(an===void 0&&(Xr==="instanceMatrix"&&zr.instanceMatrix&&(an=zr.instanceMatrix),Xr==="instanceColor"&&zr.instanceColor&&(an=zr.instanceColor)),an!==void 0){const sn=an.normalized,Fn=an.itemSize,rs=lt.get(an);if(rs===void 0)continue;const Yn=rs.buffer,Un=rs.type,cs=rs.bytesPerElement,Lr=ht.isWebGL2===!0&&(Un===St.INT||Un===St.UNSIGNED_INT||an.gpuType===rp);if(an.isInterleavedBufferAttribute){const Er=an.data,Ur=Er.stride,Wr=an.offset;if(Er.isInstancedInterleavedBuffer){for(let kr=0;kr<Jr.locationSize;kr++)Yt(Jr.location+kr,Er.meshPerAttribute);zr.isInstancedMesh!==!0&&hn._maxInstanceCount===void 0&&(hn._maxInstanceCount=Er.meshPerAttribute*Er.count)}else for(let kr=0;kr<Jr.locationSize;kr++)Zt(Jr.location+kr);St.bindBuffer(St.ARRAY_BUFFER,Yn);for(let kr=0;kr<Jr.locationSize;kr++)er(Jr.location+kr,Fn/Jr.locationSize,Un,sn,Ur*cs,(Wr+Fn/Jr.locationSize*kr)*cs,Lr)}else{if(an.isInstancedBufferAttribute){for(let Er=0;Er<Jr.locationSize;Er++)Yt(Jr.location+Er,an.meshPerAttribute);zr.isInstancedMesh!==!0&&hn._maxInstanceCount===void 0&&(hn._maxInstanceCount=an.meshPerAttribute*an.count)}else for(let Er=0;Er<Jr.locationSize;Er++)Zt(Jr.location+Er);St.bindBuffer(St.ARRAY_BUFFER,Yn);for(let Er=0;Er<Jr.locationSize;Er++)er(Jr.location+Er,Fn/Jr.locationSize,Un,sn,Fn*cs,Fn/Jr.locationSize*Er*cs,Lr)}}else if(un!==void 0){const sn=un[Xr];if(sn!==void 0)switch(sn.length){case 2:St.vertexAttrib2fv(Jr.location,sn);break;case 3:St.vertexAttrib3fv(Jr.location,sn);break;case 4:St.vertexAttrib4fv(Jr.location,sn);break;default:St.vertexAttrib1fv(Jr.location,sn)}}}}ar()}(wr,br,Mr,Qr),Fr!==null&&St.bindBuffer(St.ELEMENT_ARRAY_BUFFER,lt.get(Fr).buffer))},reset:tr,resetDefaultState:Ar,dispose:function(){tr();for(const wr in Mt){const br=Mt[wr];for(const Mr in br){const Qr=br[Mr];for(const Fr in Qr)Qt(Qr[Fr].object),delete Qr[Fr];delete br[Mr]}delete Mt[wr]}},releaseStatesOfGeometry:function(wr){if(Mt[wr.id]===void 0)return;const br=Mt[wr.id];for(const Mr in br){const Qr=br[Mr];for(const Fr in Qr)Qt(Qr[Fr].object),delete Qr[Fr];delete br[Mr]}delete Mt[wr.id]},releaseStatesOfProgram:function(wr){for(const br in Mt){const Mr=Mt[br];if(Mr[wr.id]===void 0)continue;const Qr=Mr[wr.id];for(const Fr in Qr)Qt(Qr[Fr].object),delete Qr[Fr];delete Mr[wr.id]}},initAttributes:Xt,enableAttribute:Zt,disableUnusedAttributes:ar}}function Tw(St,tt,lt,ht){const _t=ht.isWebGL2;let bt;this.setMode=function(Pt){bt=Pt},this.render=function(Pt,Mt){St.drawArrays(bt,Pt,Mt),lt.update(Mt,bt,1)},this.renderInstances=function(Pt,Mt,Lt){if(Lt===0)return;let Nt,jt;if(_t)Nt=St,jt="drawArraysInstanced";else if(Nt=tt.get("ANGLE_instanced_arrays"),jt="drawArraysInstancedANGLE",Nt===null)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");Nt[jt](bt,Pt,Mt,Lt),lt.update(Mt,bt,Lt)}}function Mw(St,tt,lt){let ht;function _t(Ar){if(Ar==="highp"){if(St.getShaderPrecisionFormat(St.VERTEX_SHADER,St.HIGH_FLOAT).precision>0&&St.getShaderPrecisionFormat(St.FRAGMENT_SHADER,St.HIGH_FLOAT).precision>0)return"highp";Ar="mediump"}return Ar==="mediump"&&St.getShaderPrecisionFormat(St.VERTEX_SHADER,St.MEDIUM_FLOAT).precision>0&&St.getShaderPrecisionFormat(St.FRAGMENT_SHADER,St.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}const bt=typeof WebGL2RenderingContext<"u"&&St.constructor.name==="WebGL2RenderingContext";let Pt=lt.precision!==void 0?lt.precision:"highp";const Mt=_t(Pt);Mt!==Pt&&(console.warn("THREE.WebGLRenderer:",Pt,"not supported, using",Mt,"instead."),Pt=Mt);const Lt=bt||tt.has("WEBGL_draw_buffers"),Nt=lt.logarithmicDepthBuffer===!0,jt=St.getParameter(St.MAX_TEXTURE_IMAGE_UNITS),Wt=St.getParameter(St.MAX_VERTEX_TEXTURE_IMAGE_UNITS),Qt=St.getParameter(St.MAX_TEXTURE_SIZE),qt=St.getParameter(St.MAX_CUBE_MAP_TEXTURE_SIZE),Xt=St.getParameter(St.MAX_VERTEX_ATTRIBS),Zt=St.getParameter(St.MAX_VERTEX_UNIFORM_VECTORS),Yt=St.getParameter(St.MAX_VARYING_VECTORS),ar=St.getParameter(St.MAX_FRAGMENT_UNIFORM_VECTORS),er=Wt>0,tr=bt||tt.has("OES_texture_float");return{isWebGL2:bt,drawBuffers:Lt,getMaxAnisotropy:function(){if(ht!==void 0)return ht;if(tt.has("EXT_texture_filter_anisotropic")===!0){const Ar=tt.get("EXT_texture_filter_anisotropic");ht=St.getParameter(Ar.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else ht=0;return ht},getMaxPrecision:_t,precision:Pt,logarithmicDepthBuffer:Nt,maxTextures:jt,maxVertexTextures:Wt,maxTextureSize:Qt,maxCubemapSize:qt,maxAttributes:Xt,maxVertexUniforms:Zt,maxVaryings:Yt,maxFragmentUniforms:ar,vertexTextures:er,floatFragmentTextures:tr,floatVertexTextures:er&&tr,maxSamples:bt?St.getParameter(St.MAX_SAMPLES):0}}function Iw(St){const tt=this;let lt=null,ht=0,_t=!1,bt=!1;const Pt=new Yu,Mt=new os,Lt={value:null,needsUpdate:!1};function Nt(jt,Wt,Qt,qt){const Xt=jt!==null?jt.length:0;let Zt=null;if(Xt!==0){if(Zt=Lt.value,qt!==!0||Zt===null){const Yt=Qt+4*Xt,ar=Wt.matrixWorldInverse;Mt.getNormalMatrix(ar),(Zt===null||Zt.length<Yt)&&(Zt=new Float32Array(Yt));for(let er=0,tr=Qt;er!==Xt;++er,tr+=4)Pt.copy(jt[er]).applyMatrix4(ar,Mt),Pt.normal.toArray(Zt,tr),Zt[tr+3]=Pt.constant}Lt.value=Zt,Lt.needsUpdate=!0}return tt.numPlanes=Xt,tt.numIntersection=0,Zt}this.uniform=Lt,this.numPlanes=0,this.numIntersection=0,this.init=function(jt,Wt){const Qt=jt.length!==0||Wt||ht!==0||_t;return _t=Wt,ht=jt.length,Qt},this.beginShadows=function(){bt=!0,Nt(null)},this.endShadows=function(){bt=!1},this.setGlobalState=function(jt,Wt){lt=Nt(jt,Wt,0)},this.setState=function(jt,Wt,Qt){const qt=jt.clippingPlanes,Xt=jt.clipIntersection,Zt=jt.clipShadows,Yt=St.get(jt);if(!_t||qt===null||qt.length===0||bt&&!Zt)bt?Nt(null):(Lt.value!==lt&&(Lt.value=lt,Lt.needsUpdate=ht>0),tt.numPlanes=ht,tt.numIntersection=0);else{const ar=bt?0:ht,er=4*ar;let tr=Yt.clippingState||null;Lt.value=tr,tr=Nt(qt,Wt,er,Qt);for(let Ar=0;Ar!==er;++Ar)tr[Ar]=lt[Ar];Yt.clippingState=tr,this.numIntersection=Xt?this.numPlanes:0,this.numPlanes+=ar}}}function Rw(St){let tt=new WeakMap;function lt(_t,bt){return bt===gn?_t.mapping=tn:bt===xn&&(_t.mapping=nn),_t}function ht(_t){const bt=_t.target;bt.removeEventListener("dispose",ht);const Pt=tt.get(bt);Pt!==void 0&&(tt.delete(bt),Pt.dispose())}return{get:function(_t){if(_t&&_t.isTexture&&_t.isRenderTargetTexture===!1){const bt=_t.mapping;if(bt===gn||bt===xn){if(tt.has(_t)){const Pt=tt.get(_t).texture;return Pt.rotation=_t.rotation,lt(Pt,_t.mapping)}{const Pt=_t.image;if(Pt&&Pt.height>0){const Mt=new Vy(Pt.height/2);return Mt.fromEquirectangularTexture(St,_t),Mt.texture.rotation=_t.rotation,tt.set(_t,Mt),_t.addEventListener("dispose",ht),lt(Mt.texture,_t.mapping)}return null}}}return _t},dispose:function(){tt=new WeakMap}}}class Ev extends bv{constructor(tt=-1,lt=1,ht=1,_t=-1,bt=.1,Pt=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=tt,this.right=lt,this.top=ht,this.bottom=_t,this.near=bt,this.far=Pt,this.updateProjectionMatrix()}copy(tt,lt){return super.copy(tt,lt),this.left=tt.left,this.right=tt.right,this.top=tt.top,this.bottom=tt.bottom,this.near=tt.near,this.far=tt.far,this.zoom=tt.zoom,this.view=tt.view===null?null:Object.assign({},tt.view),this}setViewOffset(tt,lt,ht,_t,bt,Pt){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=tt,this.view.fullHeight=lt,this.view.offsetX=ht,this.view.offsetY=_t,this.view.width=bt,this.view.height=Pt,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const tt=(this.right-this.left)/(2*this.zoom),lt=(this.top-this.bottom)/(2*this.zoom),ht=(this.right+this.left)/2,_t=(this.top+this.bottom)/2;let bt=ht-tt,Pt=ht+tt,Mt=_t+lt,Lt=_t-lt;if(this.view!==null&&this.view.enabled){const Nt=(this.right-this.left)/this.view.fullWidth/this.zoom,jt=(this.top-this.bottom)/this.view.fullHeight/this.zoom;bt+=Nt*this.view.offsetX,Pt=bt+Nt*this.view.width,Mt-=jt*this.view.offsetY,Lt=Mt-jt*this.view.height}this.projectionMatrix.makeOrthographic(bt,Pt,Mt,Lt,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(tt){const lt=super.toJSON(tt);return lt.object.zoom=this.zoom,lt.object.left=this.left,lt.object.right=this.right,lt.object.top=this.top,lt.object.bottom=this.bottom,lt.object.near=this.near,lt.object.far=this.far,this.view!==null&&(lt.object.view=Object.assign({},this.view)),lt}}const Qy=[.125,.215,.35,.446,.526,.582],U0=new Ev,Wy=new jn;let j0=null;const Sp=(1+Math.sqrt(5))/2,bm=1/Sp,qy=[new Sr(1,1,1),new Sr(-1,1,1),new Sr(1,1,-1),new Sr(-1,1,-1),new Sr(0,Sp,bm),new Sr(0,Sp,-bm),new Sr(bm,0,Sp),new Sr(-bm,0,Sp),new Sr(Sp,bm,0),new Sr(-Sp,bm,0)];class G0{constructor(tt){this._renderer=tt,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(tt,lt=0,ht=.1,_t=100){j0=this._renderer.getRenderTarget(),this._setSize(256);const bt=this._allocateTargets();return bt.depthBuffer=!0,this._sceneToCubeUV(tt,ht,_t,bt),lt>0&&this._blur(bt,0,0,lt),this._applyPMREM(bt),this._cleanup(bt),bt}fromEquirectangular(tt,lt=null){return this._fromTexture(tt,lt)}fromCubemap(tt,lt=null){return this._fromTexture(tt,lt)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=Yy(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=Xy(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(tt){this._lodMax=Math.floor(Math.log2(tt)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let tt=0;tt<this._lodPlanes.length;tt++)this._lodPlanes[tt].dispose()}_cleanup(tt){this._renderer.setRenderTarget(j0),tt.scissorTest=!1,Sv(tt,0,0,tt.width,tt.height)}_fromTexture(tt,lt){tt.mapping===tn||tt.mapping===nn?this._setSize(tt.image.length===0?16:tt.image[0].width||tt.image[0].image.width):this._setSize(tt.image.width/4),j0=this._renderer.getRenderTarget();const ht=lt||this._allocateTargets();return this._textureToCubeUV(tt,ht),this._applyPMREM(ht),this._cleanup(ht),ht}_allocateTargets(){const tt=3*Math.max(this._cubeSize,112),lt=4*this._cubeSize,ht={magFilter:Wn,minFilter:Wn,generateMipmaps:!1,type:xa,format:no,colorSpace:qs,depthBuffer:!1},_t=$y(tt,lt,ht);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==tt||this._pingPongRenderTarget.height!==lt){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=$y(tt,lt,ht);const{_lodMax:bt}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=function(Pt){const Mt=[],Lt=[],Nt=[];let jt=Pt;const Wt=Pt-4+1+Qy.length;for(let Qt=0;Qt<Wt;Qt++){const qt=Math.pow(2,jt);Lt.push(qt);let Xt=1/qt;Qt>Pt-4?Xt=Qy[Qt-Pt+4-1]:Qt===0&&(Xt=0),Nt.push(Xt);const Zt=1/(qt-2),Yt=-Zt,ar=1+Zt,er=[Yt,Yt,ar,Yt,ar,ar,Yt,Yt,ar,ar,Yt,ar],tr=6,Ar=6,wr=3,br=2,Mr=1,Qr=new Float32Array(wr*Ar*tr),Fr=new Float32Array(br*Ar*tr),Vr=new Float32Array(Mr*Ar*tr);for(let Hr=0;Hr<tr;Hr++){const _n=Hr%3*2/3-1,hn=Hr>2?0:-1,Rn=[_n,hn,0,_n+2/3,hn,0,_n+2/3,hn+1,0,_n,hn,0,_n+2/3,hn+1,0,_n,hn+1,0];Qr.set(Rn,wr*Ar*Hr),Fr.set(er,br*Ar*Hr);const Bn=[Hr,Hr,Hr,Hr,Hr,Hr];Vr.set(Bn,Mr*Ar*Hr)}const zr=new fs;zr.setAttribute("position",new gr(Qr,wr)),zr.setAttribute("uv",new gr(Fr,br)),zr.setAttribute("faceIndex",new gr(Vr,Mr)),Mt.push(zr),jt>4&&jt--}return{lodPlanes:Mt,sizeLods:Lt,sigmas:Nt}}(bt)),this._blurMaterial=function(Pt,Mt,Lt){const Nt=new Float32Array(20),jt=new Sr(0,1,0);return new Ul({name:"SphericalGaussianBlur",defines:{n:20,CUBEUV_TEXEL_WIDTH:1/Mt,CUBEUV_TEXEL_HEIGHT:1/Lt,CUBEUV_MAX_MIP:`${Pt}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:Nt},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:jt}},vertexShader:`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`,fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:Et,depthTest:!1,depthWrite:!1})}(bt,tt,lt)}return _t}_compileMaterial(tt){const lt=new co(this._lodPlanes[0],tt);this._renderer.compile(lt,U0)}_sceneToCubeUV(tt,lt,ht,_t){const bt=new bo(90,1,lt,ht),Pt=[1,-1,1,1,1,1],Mt=[1,1,1,-1,-1,-1],Lt=this._renderer,Nt=Lt.autoClear,jt=Lt.toneMapping;Lt.getClearColor(Wy),Lt.toneMapping=or,Lt.autoClear=!1;const Wt=new _c({name:"PMREM.Background",side:xt,depthWrite:!1,depthTest:!1}),Qt=new co(new Xu,Wt);let qt=!1;const Xt=tt.background;Xt?Xt.isColor&&(Wt.color.copy(Xt),tt.background=null,qt=!0):(Wt.color.copy(Wy),qt=!0);for(let Zt=0;Zt<6;Zt++){const Yt=Zt%3;Yt===0?(bt.up.set(0,Pt[Zt],0),bt.lookAt(Mt[Zt],0,0)):Yt===1?(bt.up.set(0,0,Pt[Zt]),bt.lookAt(0,Mt[Zt],0)):(bt.up.set(0,Pt[Zt],0),bt.lookAt(0,0,Mt[Zt]));const ar=this._cubeSize;Sv(_t,Yt*ar,Zt>2?ar:0,ar,ar),Lt.setRenderTarget(_t),qt&&Lt.render(Qt,bt),Lt.render(tt,bt)}Qt.geometry.dispose(),Qt.material.dispose(),Lt.toneMapping=jt,Lt.autoClear=Nt,tt.background=Xt}_textureToCubeUV(tt,lt){const ht=this._renderer,_t=tt.mapping===tn||tt.mapping===nn;_t?(this._cubemapMaterial===null&&(this._cubemapMaterial=Yy()),this._cubemapMaterial.uniforms.flipEnvMap.value=tt.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=Xy());const bt=_t?this._cubemapMaterial:this._equirectMaterial,Pt=new co(this._lodPlanes[0],bt);bt.uniforms.envMap.value=tt;const Mt=this._cubeSize;Sv(lt,0,0,3*Mt,2*Mt),ht.setRenderTarget(lt),ht.render(Pt,U0)}_applyPMREM(tt){const lt=this._renderer,ht=lt.autoClear;lt.autoClear=!1;for(let _t=1;_t<this._lodPlanes.length;_t++){const bt=Math.sqrt(this._sigmas[_t]*this._sigmas[_t]-this._sigmas[_t-1]*this._sigmas[_t-1]),Pt=qy[(_t-1)%qy.length];this._blur(tt,_t-1,_t,bt,Pt)}lt.autoClear=ht}_blur(tt,lt,ht,_t,bt){const Pt=this._pingPongRenderTarget;this._halfBlur(tt,Pt,lt,ht,_t,"latitudinal",bt),this._halfBlur(Pt,tt,ht,ht,_t,"longitudinal",bt)}_halfBlur(tt,lt,ht,_t,bt,Pt,Mt){const Lt=this._renderer,Nt=this._blurMaterial;Pt!=="latitudinal"&&Pt!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const jt=new co(this._lodPlanes[_t],Nt),Wt=Nt.uniforms,Qt=this._sizeLods[ht]-1,qt=isFinite(bt)?Math.PI/(2*Qt):2*Math.PI/39,Xt=bt/qt,Zt=isFinite(bt)?1+Math.floor(3*Xt):20;Zt>20&&console.warn(`sigmaRadians, ${bt}, is too large and will clip, as it requested ${Zt} samples when the maximum is set to 20`);const Yt=[];let ar=0;for(let Ar=0;Ar<20;++Ar){const wr=Ar/Xt,br=Math.exp(-wr*wr/2);Yt.push(br),Ar===0?ar+=br:Ar<Zt&&(ar+=2*br)}for(let Ar=0;Ar<Yt.length;Ar++)Yt[Ar]=Yt[Ar]/ar;Wt.envMap.value=tt.texture,Wt.samples.value=Zt,Wt.weights.value=Yt,Wt.latitudinal.value=Pt==="latitudinal",Mt&&(Wt.poleAxis.value=Mt);const{_lodMax:er}=this;Wt.dTheta.value=qt,Wt.mipInt.value=er-ht;const tr=this._sizeLods[_t];Sv(lt,3*tr*(_t>er-4?_t-er+4:0),4*(this._cubeSize-tr),3*tr,2*tr),Lt.setRenderTarget(lt),Lt.render(jt,U0)}}function $y(St,tt,lt){const ht=new wo(St,tt,lt);return ht.texture.mapping=Mn,ht.texture.name="PMREM.cubeUv",ht.scissorTest=!0,ht}function Sv(St,tt,lt,ht,_t){St.viewport.set(tt,lt,ht,_t),St.scissor.set(tt,lt,ht,_t)}function Xy(){return new Ul({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`,fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:Et,depthTest:!1,depthWrite:!1})}function Yy(){return new Ul({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`,fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:Et,depthTest:!1,depthWrite:!1})}function kw(St){let tt=new WeakMap,lt=null;function ht(_t){const bt=_t.target;bt.removeEventListener("dispose",ht);const Pt=tt.get(bt);Pt!==void 0&&(tt.delete(bt),Pt.dispose())}return{get:function(_t){if(_t&&_t.isTexture){const bt=_t.mapping,Pt=bt===gn||bt===xn,Mt=bt===tn||bt===nn;if(Pt||Mt){if(_t.isRenderTargetTexture&&_t.needsPMREMUpdate===!0){_t.needsPMREMUpdate=!1;let Lt=tt.get(_t);return lt===null&&(lt=new G0(St)),Lt=Pt?lt.fromEquirectangular(_t,Lt):lt.fromCubemap(_t,Lt),tt.set(_t,Lt),Lt.texture}if(tt.has(_t))return tt.get(_t).texture;{const Lt=_t.image;if(Pt&&Lt&&Lt.height>0||Mt&&Lt&&function(Nt){let jt=0;for(let Wt=0;Wt<6;Wt++)Nt[Wt]!==void 0&&jt++;return jt===6}(Lt)){lt===null&&(lt=new G0(St));const Nt=Pt?lt.fromEquirectangular(_t):lt.fromCubemap(_t);return tt.set(_t,Nt),_t.addEventListener("dispose",ht),Nt.texture}return null}}}return _t},dispose:function(){tt=new WeakMap,lt!==null&&(lt.dispose(),lt=null)}}}function Dw(St){const tt={};function lt(ht){if(tt[ht]!==void 0)return tt[ht];let _t;switch(ht){case"WEBGL_depth_texture":_t=St.getExtension("WEBGL_depth_texture")||St.getExtension("MOZ_WEBGL_depth_texture")||St.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":_t=St.getExtension("EXT_texture_filter_anisotropic")||St.getExtension("MOZ_EXT_texture_filter_anisotropic")||St.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":_t=St.getExtension("WEBGL_compressed_texture_s3tc")||St.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||St.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":_t=St.getExtension("WEBGL_compressed_texture_pvrtc")||St.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:_t=St.getExtension(ht)}return tt[ht]=_t,_t}return{has:function(ht){return lt(ht)!==null},init:function(ht){ht.isWebGL2?lt("EXT_color_buffer_float"):(lt("WEBGL_depth_texture"),lt("OES_texture_float"),lt("OES_texture_half_float"),lt("OES_texture_half_float_linear"),lt("OES_standard_derivatives"),lt("OES_element_index_uint"),lt("OES_vertex_array_object"),lt("ANGLE_instanced_arrays")),lt("OES_texture_float_linear"),lt("EXT_color_buffer_half_float"),lt("WEBGL_multisampled_render_to_texture")},get:function(ht){const _t=lt(ht);return _t===null&&console.warn("THREE.WebGLRenderer: "+ht+" extension not supported."),_t}}}function Bw(St,tt,lt,ht){const _t={},bt=new WeakMap;function Pt(Lt){const Nt=Lt.target;Nt.index!==null&&tt.remove(Nt.index);for(const Wt in Nt.attributes)tt.remove(Nt.attributes[Wt]);for(const Wt in Nt.morphAttributes){const Qt=Nt.morphAttributes[Wt];for(let qt=0,Xt=Qt.length;qt<Xt;qt++)tt.remove(Qt[qt])}Nt.removeEventListener("dispose",Pt),delete _t[Nt.id];const jt=bt.get(Nt);jt&&(tt.remove(jt),bt.delete(Nt)),ht.releaseStatesOfGeometry(Nt),Nt.isInstancedBufferGeometry===!0&&delete Nt._maxInstanceCount,lt.memory.geometries--}function Mt(Lt){const Nt=[],jt=Lt.index,Wt=Lt.attributes.position;let Qt=0;if(jt!==null){const Zt=jt.array;Qt=jt.version;for(let Yt=0,ar=Zt.length;Yt<ar;Yt+=3){const er=Zt[Yt+0],tr=Zt[Yt+1],Ar=Zt[Yt+2];Nt.push(er,tr,tr,Ar,Ar,er)}}else{if(Wt===void 0)return;{const Zt=Wt.array;Qt=Wt.version;for(let Yt=0,ar=Zt.length/3-1;Yt<ar;Yt+=3){const er=Yt+0,tr=Yt+1,Ar=Yt+2;Nt.push(er,tr,tr,Ar,Ar,er)}}}const qt=new(tv(Nt)?yo:ls)(Nt,1);qt.version=Qt;const Xt=bt.get(Lt);Xt&&tt.remove(Xt),bt.set(Lt,qt)}return{get:function(Lt,Nt){return _t[Nt.id]===!0||(Nt.addEventListener("dispose",Pt),_t[Nt.id]=!0,lt.memory.geometries++),Nt},update:function(Lt){const Nt=Lt.attributes;for(const Wt in Nt)tt.update(Nt[Wt],St.ARRAY_BUFFER);const jt=Lt.morphAttributes;for(const Wt in jt){const Qt=jt[Wt];for(let qt=0,Xt=Qt.length;qt<Xt;qt++)tt.update(Qt[qt],St.ARRAY_BUFFER)}},getWireframeAttribute:function(Lt){const Nt=bt.get(Lt);if(Nt){const jt=Lt.index;jt!==null&&Nt.version<jt.version&&Mt(Lt)}else Mt(Lt);return bt.get(Lt)}}}function Lw(St,tt,lt,ht){const _t=ht.isWebGL2;let bt,Pt,Mt;this.setMode=function(Lt){bt=Lt},this.setIndex=function(Lt){Pt=Lt.type,Mt=Lt.bytesPerElement},this.render=function(Lt,Nt){St.drawElements(bt,Nt,Pt,Lt*Mt),lt.update(Nt,bt,1)},this.renderInstances=function(Lt,Nt,jt){if(jt===0)return;let Wt,Qt;if(_t)Wt=St,Qt="drawElementsInstanced";else if(Wt=tt.get("ANGLE_instanced_arrays"),Qt="drawElementsInstancedANGLE",Wt===null)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");Wt[Qt](bt,Nt,Pt,Lt*Mt,jt),lt.update(Nt,bt,jt)}}function Ow(St){const tt={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:tt,programs:null,autoReset:!0,reset:function(){tt.calls=0,tt.triangles=0,tt.points=0,tt.lines=0},update:function(lt,ht,_t){switch(tt.calls++,ht){case St.TRIANGLES:tt.triangles+=_t*(lt/3);break;case St.LINES:tt.lines+=_t*(lt/2);break;case St.LINE_STRIP:tt.lines+=_t*(lt-1);break;case St.LINE_LOOP:tt.lines+=_t*lt;break;case St.POINTS:tt.points+=_t*lt;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",ht)}}}}function Nw(St,tt){return St[0]-tt[0]}function Fw(St,tt){return Math.abs(tt[1])-Math.abs(St[1])}function Uw(St,tt,lt){const ht={},_t=new Float32Array(8),bt=new WeakMap,Pt=new Rs,Mt=[];for(let Lt=0;Lt<8;Lt++)Mt[Lt]=[Lt,0];return{update:function(Lt,Nt,jt){const Wt=Lt.morphTargetInfluences;if(tt.isWebGL2===!0){const Qt=Nt.morphAttributes.position||Nt.morphAttributes.normal||Nt.morphAttributes.color,qt=Qt!==void 0?Qt.length:0;let Xt=bt.get(Nt);if(Xt===void 0||Xt.count!==qt){let ar=function(){Hr.dispose(),bt.delete(Nt),Nt.removeEventListener("dispose",ar)};Xt!==void 0&&Xt.texture.dispose();const er=Nt.morphAttributes.position!==void 0,tr=Nt.morphAttributes.normal!==void 0,Ar=Nt.morphAttributes.color!==void 0,wr=Nt.morphAttributes.position||[],br=Nt.morphAttributes.normal||[],Mr=Nt.morphAttributes.color||[];let Qr=0;er===!0&&(Qr=1),tr===!0&&(Qr=2),Ar===!0&&(Qr=3);let Fr=Nt.attributes.position.count*Qr,Vr=1;Fr>tt.maxTextureSize&&(Vr=Math.ceil(Fr/tt.maxTextureSize),Fr=tt.maxTextureSize);const zr=new Float32Array(Fr*Vr*4*qt),Hr=new nm(zr,Fr,Vr,qt);Hr.type=ro,Hr.needsUpdate=!0;const _n=4*Qr;for(let hn=0;hn<qt;hn++){const Rn=wr[hn],Bn=br[hn],un=Mr[hn],Xr=Fr*Vr*4*hn;for(let Jr=0;Jr<Rn.count;Jr++){const an=Jr*_n;er===!0&&(Pt.fromBufferAttribute(Rn,Jr),zr[Xr+an+0]=Pt.x,zr[Xr+an+1]=Pt.y,zr[Xr+an+2]=Pt.z,zr[Xr+an+3]=0),tr===!0&&(Pt.fromBufferAttribute(Bn,Jr),zr[Xr+an+4]=Pt.x,zr[Xr+an+5]=Pt.y,zr[Xr+an+6]=Pt.z,zr[Xr+an+7]=0),Ar===!0&&(Pt.fromBufferAttribute(un,Jr),zr[Xr+an+8]=Pt.x,zr[Xr+an+9]=Pt.y,zr[Xr+an+10]=Pt.z,zr[Xr+an+11]=un.itemSize===4?Pt.w:1)}}Xt={count:qt,texture:Hr,size:new mn(Fr,Vr)},bt.set(Nt,Xt),Nt.addEventListener("dispose",ar)}let Zt=0;for(let ar=0;ar<Wt.length;ar++)Zt+=Wt[ar];const Yt=Nt.morphTargetsRelative?1:1-Zt;jt.getUniforms().setValue(St,"morphTargetBaseInfluence",Yt),jt.getUniforms().setValue(St,"morphTargetInfluences",Wt),jt.getUniforms().setValue(St,"morphTargetsTexture",Xt.texture,lt),jt.getUniforms().setValue(St,"morphTargetsTextureSize",Xt.size)}else{const Qt=Wt===void 0?0:Wt.length;let qt=ht[Nt.id];if(qt===void 0||qt.length!==Qt){qt=[];for(let er=0;er<Qt;er++)qt[er]=[er,0];ht[Nt.id]=qt}for(let er=0;er<Qt;er++){const tr=qt[er];tr[0]=er,tr[1]=Wt[er]}qt.sort(Fw);for(let er=0;er<8;er++)er<Qt&&qt[er][1]?(Mt[er][0]=qt[er][0],Mt[er][1]=qt[er][1]):(Mt[er][0]=Number.MAX_SAFE_INTEGER,Mt[er][1]=0);Mt.sort(Nw);const Xt=Nt.morphAttributes.position,Zt=Nt.morphAttributes.normal;let Yt=0;for(let er=0;er<8;er++){const tr=Mt[er],Ar=tr[0],wr=tr[1];Ar!==Number.MAX_SAFE_INTEGER&&wr?(Xt&&Nt.getAttribute("morphTarget"+er)!==Xt[Ar]&&Nt.setAttribute("morphTarget"+er,Xt[Ar]),Zt&&Nt.getAttribute("morphNormal"+er)!==Zt[Ar]&&Nt.setAttribute("morphNormal"+er,Zt[Ar]),_t[er]=wr,Yt+=wr):(Xt&&Nt.hasAttribute("morphTarget"+er)===!0&&Nt.deleteAttribute("morphTarget"+er),Zt&&Nt.hasAttribute("morphNormal"+er)===!0&&Nt.deleteAttribute("morphNormal"+er),_t[er]=0)}const ar=Nt.morphTargetsRelative?1:1-Yt;jt.getUniforms().setValue(St,"morphTargetBaseInfluence",ar),jt.getUniforms().setValue(St,"morphTargetInfluences",_t)}}}}function jw(St,tt,lt,ht){let _t=new WeakMap;function bt(Pt){const Mt=Pt.target;Mt.removeEventListener("dispose",bt),lt.remove(Mt.instanceMatrix),Mt.instanceColor!==null&&lt.remove(Mt.instanceColor)}return{update:function(Pt){const Mt=ht.render.frame,Lt=Pt.geometry,Nt=tt.get(Pt,Lt);if(_t.get(Nt)!==Mt&&(tt.update(Nt),_t.set(Nt,Mt)),Pt.isInstancedMesh&&(Pt.hasEventListener("dispose",bt)===!1&&Pt.addEventListener("dispose",bt),_t.get(Pt)!==Mt&&(lt.update(Pt.instanceMatrix,St.ARRAY_BUFFER),Pt.instanceColor!==null&&lt.update(Pt.instanceColor,St.ARRAY_BUFFER),_t.set(Pt,Mt))),Pt.isSkinnedMesh){const jt=Pt.skeleton;_t.get(jt)!==Mt&&(jt.update(),_t.set(jt,Mt))}return Nt},dispose:function(){_t=new WeakMap}}}const Ky=new js,Jy=new nm,Zy=new s_,ex=new __,tx=[],rx=[],ix=new Float32Array(16),nx=new Float32Array(9),sx=new Float32Array(4);function xm(St,tt,lt){const ht=St[0];if(ht<=0||ht>0)return St;const _t=tt*lt;let bt=tx[_t];if(bt===void 0&&(bt=new Float32Array(_t),tx[_t]=bt),tt!==0){ht.toArray(bt,0);for(let Pt=1,Mt=0;Pt!==tt;++Pt)Mt+=lt,St[Pt].toArray(bt,Mt)}return bt}function $a(St,tt){if(St.length!==tt.length)return!1;for(let lt=0,ht=St.length;lt<ht;lt++)if(St[lt]!==tt[lt])return!1;return!0}function eo(St,tt){for(let lt=0,ht=tt.length;lt<ht;lt++)St[lt]=tt[lt]}function Cv(St,tt){let lt=rx[tt];lt===void 0&&(lt=new Int32Array(tt),rx[tt]=lt);for(let ht=0;ht!==tt;++ht)lt[ht]=St.allocateTextureUnit();return lt}function Gw(St,tt){const lt=this.cache;lt[0]!==tt&&(St.uniform1f(this.addr,tt),lt[0]=tt)}function zw(St,tt){const lt=this.cache;if(tt.x!==void 0)lt[0]===tt.x&&lt[1]===tt.y||(St.uniform2f(this.addr,tt.x,tt.y),lt[0]=tt.x,lt[1]=tt.y);else{if($a(lt,tt))return;St.uniform2fv(this.addr,tt),eo(lt,tt)}}function Vw(St,tt){const lt=this.cache;if(tt.x!==void 0)lt[0]===tt.x&&lt[1]===tt.y&&lt[2]===tt.z||(St.uniform3f(this.addr,tt.x,tt.y,tt.z),lt[0]=tt.x,lt[1]=tt.y,lt[2]=tt.z);else if(tt.r!==void 0)lt[0]===tt.r&&lt[1]===tt.g&&lt[2]===tt.b||(St.uniform3f(this.addr,tt.r,tt.g,tt.b),lt[0]=tt.r,lt[1]=tt.g,lt[2]=tt.b);else{if($a(lt,tt))return;St.uniform3fv(this.addr,tt),eo(lt,tt)}}function Hw(St,tt){const lt=this.cache;if(tt.x!==void 0)lt[0]===tt.x&&lt[1]===tt.y&&lt[2]===tt.z&&lt[3]===tt.w||(St.uniform4f(this.addr,tt.x,tt.y,tt.z,tt.w),lt[0]=tt.x,lt[1]=tt.y,lt[2]=tt.z,lt[3]=tt.w);else{if($a(lt,tt))return;St.uniform4fv(this.addr,tt),eo(lt,tt)}}function Qw(St,tt){const lt=this.cache,ht=tt.elements;if(ht===void 0){if($a(lt,tt))return;St.uniformMatrix2fv(this.addr,!1,tt),eo(lt,tt)}else{if($a(lt,ht))return;sx.set(ht),St.uniformMatrix2fv(this.addr,!1,sx),eo(lt,ht)}}function Ww(St,tt){const lt=this.cache,ht=tt.elements;if(ht===void 0){if($a(lt,tt))return;St.uniformMatrix3fv(this.addr,!1,tt),eo(lt,tt)}else{if($a(lt,ht))return;nx.set(ht),St.uniformMatrix3fv(this.addr,!1,nx),eo(lt,ht)}}function qw(St,tt){const lt=this.cache,ht=tt.elements;if(ht===void 0){if($a(lt,tt))return;St.uniformMatrix4fv(this.addr,!1,tt),eo(lt,tt)}else{if($a(lt,ht))return;ix.set(ht),St.uniformMatrix4fv(this.addr,!1,ix),eo(lt,ht)}}function $w(St,tt){const lt=this.cache;lt[0]!==tt&&(St.uniform1i(this.addr,tt),lt[0]=tt)}function Xw(St,tt){const lt=this.cache;if(tt.x!==void 0)lt[0]===tt.x&&lt[1]===tt.y||(St.uniform2i(this.addr,tt.x,tt.y),lt[0]=tt.x,lt[1]=tt.y);else{if($a(lt,tt))return;St.uniform2iv(this.addr,tt),eo(lt,tt)}}function Yw(St,tt){const lt=this.cache;if(tt.x!==void 0)lt[0]===tt.x&&lt[1]===tt.y&&lt[2]===tt.z||(St.uniform3i(this.addr,tt.x,tt.y,tt.z),lt[0]=tt.x,lt[1]=tt.y,lt[2]=tt.z);else{if($a(lt,tt))return;St.uniform3iv(this.addr,tt),eo(lt,tt)}}function Kw(St,tt){const lt=this.cache;if(tt.x!==void 0)lt[0]===tt.x&&lt[1]===tt.y&&lt[2]===tt.z&&lt[3]===tt.w||(St.uniform4i(this.addr,tt.x,tt.y,tt.z,tt.w),lt[0]=tt.x,lt[1]=tt.y,lt[2]=tt.z,lt[3]=tt.w);else{if($a(lt,tt))return;St.uniform4iv(this.addr,tt),eo(lt,tt)}}function Jw(St,tt){const lt=this.cache;lt[0]!==tt&&(St.uniform1ui(this.addr,tt),lt[0]=tt)}function Zw(St,tt){const lt=this.cache;if(tt.x!==void 0)lt[0]===tt.x&&lt[1]===tt.y||(St.uniform2ui(this.addr,tt.x,tt.y),lt[0]=tt.x,lt[1]=tt.y);else{if($a(lt,tt))return;St.uniform2uiv(this.addr,tt),eo(lt,tt)}}function e1(St,tt){const lt=this.cache;if(tt.x!==void 0)lt[0]===tt.x&&lt[1]===tt.y&&lt[2]===tt.z||(St.uniform3ui(this.addr,tt.x,tt.y,tt.z),lt[0]=tt.x,lt[1]=tt.y,lt[2]=tt.z);else{if($a(lt,tt))return;St.uniform3uiv(this.addr,tt),eo(lt,tt)}}function t1(St,tt){const lt=this.cache;if(tt.x!==void 0)lt[0]===tt.x&&lt[1]===tt.y&&lt[2]===tt.z&&lt[3]===tt.w||(St.uniform4ui(this.addr,tt.x,tt.y,tt.z,tt.w),lt[0]=tt.x,lt[1]=tt.y,lt[2]=tt.z,lt[3]=tt.w);else{if($a(lt,tt))return;St.uniform4uiv(this.addr,tt),eo(lt,tt)}}function r1(St,tt,lt){const ht=this.cache,_t=lt.allocateTextureUnit();ht[0]!==_t&&(St.uniform1i(this.addr,_t),ht[0]=_t),lt.setTexture2D(tt||Ky,_t)}function i1(St,tt,lt){const ht=this.cache,_t=lt.allocateTextureUnit();ht[0]!==_t&&(St.uniform1i(this.addr,_t),ht[0]=_t),lt.setTexture3D(tt||Zy,_t)}function n1(St,tt,lt){const ht=this.cache,_t=lt.allocateTextureUnit();ht[0]!==_t&&(St.uniform1i(this.addr,_t),ht[0]=_t),lt.setTextureCube(tt||ex,_t)}function s1(St,tt,lt){const ht=this.cache,_t=lt.allocateTextureUnit();ht[0]!==_t&&(St.uniform1i(this.addr,_t),ht[0]=_t),lt.setTexture2DArray(tt||Jy,_t)}function a1(St,tt){St.uniform1fv(this.addr,tt)}function o1(St,tt){const lt=xm(tt,this.size,2);St.uniform2fv(this.addr,lt)}function l1(St,tt){const lt=xm(tt,this.size,3);St.uniform3fv(this.addr,lt)}function c1(St,tt){const lt=xm(tt,this.size,4);St.uniform4fv(this.addr,lt)}function u1(St,tt){const lt=xm(tt,this.size,4);St.uniformMatrix2fv(this.addr,!1,lt)}function p1(St,tt){const lt=xm(tt,this.size,9);St.uniformMatrix3fv(this.addr,!1,lt)}function h1(St,tt){const lt=xm(tt,this.size,16);St.uniformMatrix4fv(this.addr,!1,lt)}function d1(St,tt){St.uniform1iv(this.addr,tt)}function m1(St,tt){St.uniform2iv(this.addr,tt)}function g1(St,tt){St.uniform3iv(this.addr,tt)}function _1(St,tt){St.uniform4iv(this.addr,tt)}function f1(St,tt){St.uniform1uiv(this.addr,tt)}function y1(St,tt){St.uniform2uiv(this.addr,tt)}function b1(St,tt){St.uniform3uiv(this.addr,tt)}function x1(St,tt){St.uniform4uiv(this.addr,tt)}function A1(St,tt,lt){const ht=this.cache,_t=tt.length,bt=Cv(lt,_t);$a(ht,bt)||(St.uniform1iv(this.addr,bt),eo(ht,bt));for(let Pt=0;Pt!==_t;++Pt)lt.setTexture2D(tt[Pt]||Ky,bt[Pt])}function w1(St,tt,lt){const ht=this.cache,_t=tt.length,bt=Cv(lt,_t);$a(ht,bt)||(St.uniform1iv(this.addr,bt),eo(ht,bt));for(let Pt=0;Pt!==_t;++Pt)lt.setTexture3D(tt[Pt]||Zy,bt[Pt])}function E1(St,tt,lt){const ht=this.cache,_t=tt.length,bt=Cv(lt,_t);$a(ht,bt)||(St.uniform1iv(this.addr,bt),eo(ht,bt));for(let Pt=0;Pt!==_t;++Pt)lt.setTextureCube(tt[Pt]||ex,bt[Pt])}function S1(St,tt,lt){const ht=this.cache,_t=tt.length,bt=Cv(lt,_t);$a(ht,bt)||(St.uniform1iv(this.addr,bt),eo(ht,bt));for(let Pt=0;Pt!==_t;++Pt)lt.setTexture2DArray(tt[Pt]||Jy,bt[Pt])}class C1{constructor(tt,lt,ht){this.id=tt,this.addr=ht,this.cache=[],this.setValue=function(_t){switch(_t){case 5126:return Gw;case 35664:return zw;case 35665:return Vw;case 35666:return Hw;case 35674:return Qw;case 35675:return Ww;case 35676:return qw;case 5124:case 35670:return $w;case 35667:case 35671:return Xw;case 35668:case 35672:return Yw;case 35669:case 35673:return Kw;case 5125:return Jw;case 36294:return Zw;case 36295:return e1;case 36296:return t1;case 35678:case 36198:case 36298:case 36306:case 35682:return r1;case 35679:case 36299:case 36307:return i1;case 35680:case 36300:case 36308:case 36293:return n1;case 36289:case 36303:case 36311:case 36292:return s1}}(lt.type)}}class P1{constructor(tt,lt,ht){this.id=tt,this.addr=ht,this.cache=[],this.size=lt.size,this.setValue=function(_t){switch(_t){case 5126:return a1;case 35664:return o1;case 35665:return l1;case 35666:return c1;case 35674:return u1;case 35675:return p1;case 35676:return h1;case 5124:case 35670:return d1;case 35667:case 35671:return m1;case 35668:case 35672:return g1;case 35669:case 35673:return _1;case 5125:return f1;case 36294:return y1;case 36295:return b1;case 36296:return x1;case 35678:case 36198:case 36298:case 36306:case 35682:return A1;case 35679:case 36299:case 36307:return w1;case 35680:case 36300:case 36308:case 36293:return E1;case 36289:case 36303:case 36311:case 36292:return S1}}(lt.type)}}class T1{constructor(tt){this.id=tt,this.seq=[],this.map={}}setValue(tt,lt,ht){const _t=this.seq;for(let bt=0,Pt=_t.length;bt!==Pt;++bt){const Mt=_t[bt];Mt.setValue(tt,lt[Mt.id],ht)}}}const z0=/(\w+)(\])?(\[|\.)?/g;function ax(St,tt){St.seq.push(tt),St.map[tt.id]=tt}function M1(St,tt,lt){const ht=St.name,_t=ht.length;for(z0.lastIndex=0;;){const bt=z0.exec(ht),Pt=z0.lastIndex;let Mt=bt[1];const Lt=bt[2]==="]",Nt=bt[3];if(Lt&&(Mt|=0),Nt===void 0||Nt==="["&&Pt+2===_t){ax(lt,Nt===void 0?new C1(Mt,St,tt):new P1(Mt,St,tt));break}{let jt=lt.map[Mt];jt===void 0&&(jt=new T1(Mt),ax(lt,jt)),lt=jt}}}class Pv{constructor(tt,lt){this.seq=[],this.map={};const ht=tt.getProgramParameter(lt,tt.ACTIVE_UNIFORMS);for(let _t=0;_t<ht;++_t){const bt=tt.getActiveUniform(lt,_t);M1(bt,tt.getUniformLocation(lt,bt.name),this)}}setValue(tt,lt,ht,_t){const bt=this.map[lt];bt!==void 0&&bt.setValue(tt,ht,_t)}setOptional(tt,lt,ht){const _t=lt[ht];_t!==void 0&&this.setValue(tt,ht,_t)}static upload(tt,lt,ht,_t){for(let bt=0,Pt=lt.length;bt!==Pt;++bt){const Mt=lt[bt],Lt=ht[Mt.id];Lt.needsUpdate!==!1&&Mt.setValue(tt,Lt.value,_t)}}static seqWithValue(tt,lt){const ht=[];for(let _t=0,bt=tt.length;_t!==bt;++_t){const Pt=tt[_t];Pt.id in lt&&ht.push(Pt)}return ht}}function ox(St,tt,lt){const ht=St.createShader(tt);return St.shaderSource(ht,lt),St.compileShader(ht),ht}let I1=0;function lx(St,tt,lt){const ht=St.getShaderParameter(tt,St.COMPILE_STATUS),_t=St.getShaderInfoLog(tt).trim();if(ht&&_t==="")return"";const bt=/ERROR: 0:(\d+)/.exec(_t);if(bt){const Pt=parseInt(bt[1]);return lt.toUpperCase()+`

`+_t+`

`+function(Mt,Lt){const Nt=Mt.split(`
`),jt=[],Wt=Math.max(Lt-6,0),Qt=Math.min(Lt+6,Nt.length);for(let qt=Wt;qt<Qt;qt++){const Xt=qt+1;jt.push(`${Xt===Lt?">":" "} ${Xt}: ${Nt[qt]}`)}return jt.join(`
`)}(St.getShaderSource(tt),Pt)}return _t}function R1(St,tt){let lt;switch(tt){case qs:lt="";break;case Ns:lt="sRGBToLinear";break;case so:lt="RGBM16ToLinear";break;default:console.warn("THREE.WebGLProgram: Unsupported color space:",tt),lt=""}return`vec4 ${St}( vec4 value ) { return ${lt} ( value ); }`}function k1(St,tt){const lt=function(ht){const _t=Is.getPrimaries(Is.workingColorSpace),bt=ht===Ds||ht===so?null:Is.getPrimaries(ht);let Pt;switch(_t!==bt&&bt?_t===ku&&bt===Hs?Pt="LinearDisplayP3ToLinearSRGB":_t===Hs&&bt===ku&&(Pt="LinearSRGBToLinearDisplayP3"):Pt="",ht){case Ds:return["",""];case qs:case cu:return[Pt,"LinearTransferOETF"];case Ns:case up:return[Pt,"sRGBTransferOETF"];case so:return["","LinearToRGBM16"];default:return console.warn("THREE.WebGLProgram: Unsupported color space:",ht),[Pt,"LinearTransferOETF"]}}(tt);return`vec4 ${St}( vec4 value ) { return ${lt[0]}( ${lt[1]}( value ) ); }`}function D1(St,tt){let lt;switch(tt){case yr:lt="Linear";break;case Pr:lt="Reinhard";break;case jr:lt="OptimizedCineon";break;case Tr:lt="ACESFilmic";break;case Br:lt="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",tt),lt="Linear"}return"vec3 "+St+"( vec3 color ) { return "+lt+"ToneMapping( color ); }"}function v_(St){return St!==""}function cx(St,tt){const lt=tt.numSpotLightShadows+tt.numSpotLightMaps-tt.numSpotLightShadowsWithMaps;return St.replace(/NUM_DIR_LIGHTS/g,tt.numDirLights).replace(/NUM_SPOT_LIGHTS/g,tt.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,tt.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,lt).replace(/NUM_RECT_AREA_LIGHTS/g,tt.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,tt.numPointLights).replace(/NUM_HEMI_LIGHTS/g,tt.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,tt.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,tt.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,tt.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,tt.numPointLightShadows)}function ux(St,tt){return St.replace(/NUM_CLIPPING_PLANES/g,tt.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,tt.numClippingPlanes-tt.numClipIntersection)}const B1=/^[ \t]*#include +<([\w\d./]+)>/gm;function V0(St){return St.replace(B1,O1)}const L1=new Map([["encodings_fragment","colorspace_fragment"],["encodings_pars_fragment","colorspace_pars_fragment"],["output_fragment","opaque_fragment"]]);function O1(St,tt){let lt=ds[tt];if(lt===void 0){const ht=L1.get(tt);if(ht===void 0)throw new Error("Can not resolve #include <"+tt+">");lt=ds[ht],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',tt,ht)}return V0(lt)}const N1=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function hx(St){return St.replace(N1,F1)}function F1(St,tt,lt,ht){let _t="";for(let bt=parseInt(tt);bt<parseInt(lt);bt++)_t+=ht.replace(/\[\s*i\s*\]/g,"[ "+bt+" ]").replace(/UNROLLED_LOOP_INDEX/g,bt);return _t}function dx(St){let tt="precision "+St.precision+` float;
precision `+St.precision+" int;";return St.precision==="highp"?tt+=`
#define HIGH_PRECISION`:St.precision==="mediump"?tt+=`
#define MEDIUM_PRECISION`:St.precision==="lowp"&&(tt+=`
#define LOW_PRECISION`),tt}function U1(St,tt,lt,ht){const _t=St.getContext(),bt=lt.defines;let Pt=lt.vertexShader,Mt=lt.fragmentShader;const Lt=function(Fr){let Vr="SHADOWMAP_TYPE_BASIC";return Fr.shadowMapType===pt?Vr="SHADOWMAP_TYPE_PCF":Fr.shadowMapType===mt?Vr="SHADOWMAP_TYPE_PCF_SOFT":Fr.shadowMapType===ft&&(Vr="SHADOWMAP_TYPE_VSM"),Vr}(lt),Nt=function(Fr){let Vr="ENVMAP_TYPE_CUBE";if(Fr.envMap)switch(Fr.envMapMode){case tn:case nn:Vr="ENVMAP_TYPE_CUBE";break;case Mn:Vr="ENVMAP_TYPE_CUBE_UV"}return Vr}(lt),jt=function(Fr){let Vr="ENVMAP_MODE_REFLECTION";return Fr.envMap&&Fr.envMapMode===nn&&(Vr="ENVMAP_MODE_REFRACTION"),Vr}(lt),Wt=function(Fr){let Vr="ENVMAP_BLENDING_NONE";if(Fr.envMap)switch(Fr.combine){case yn:Vr="ENVMAP_BLENDING_MULTIPLY";break;case zn:Vr="ENVMAP_BLENDING_MIX";break;case gs:Vr="ENVMAP_BLENDING_ADD"}return Vr}(lt),Qt=function(Fr){const Vr=Fr.envMapCubeUVHeight;if(Vr===null)return null;const zr=Math.log2(Vr)-2,Hr=1/Vr;return{texelWidth:1/(3*Math.max(Math.pow(2,zr),112)),texelHeight:Hr,maxMip:zr}}(lt),qt=lt.isWebGL2?"":function(Fr){return[Fr.extensionDerivatives||Fr.envMapCubeUVHeight||Fr.bumpMap||Fr.normalMapTangentSpace||Fr.clearcoatNormalMap||Fr.flatShading||Fr.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(Fr.extensionFragDepth||Fr.logarithmicDepthBuffer)&&Fr.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",Fr.extensionDrawBuffers&&Fr.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(Fr.extensionShaderTextureLOD||Fr.envMap||Fr.transmission)&&Fr.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(v_).join(`
`)}(lt),Xt=function(Fr){const Vr=[];for(const zr in Fr){const Hr=Fr[zr];Hr!==!1&&Vr.push("#define "+zr+" "+Hr)}return Vr.join(`
`)}(bt),Zt=_t.createProgram();let Yt,ar,er=lt.glslVersion?"#version "+lt.glslVersion+`
`:"";lt.isRawShaderMaterial?(Yt=["#define SHADER_TYPE "+lt.shaderType,"#define SHADER_NAME "+lt.shaderName,Xt].filter(v_).join(`
`),Yt.length>0&&(Yt+=`
`),ar=[qt,"#define SHADER_TYPE "+lt.shaderType,"#define SHADER_NAME "+lt.shaderName,Xt].filter(v_).join(`
`),ar.length>0&&(ar+=`
`)):(Yt=[dx(lt),"#define SHADER_TYPE "+lt.shaderType,"#define SHADER_NAME "+lt.shaderName,Xt,lt.instancing?"#define USE_INSTANCING":"",lt.instancingColor?"#define USE_INSTANCING_COLOR":"",lt.useFog&&lt.fog?"#define USE_FOG":"",lt.useFog&&lt.fogExp2?"#define FOG_EXP2":"",lt.map?"#define USE_MAP":"",lt.envMap?"#define USE_ENVMAP":"",lt.envMap?"#define "+jt:"",lt.lightMap?"#define USE_LIGHTMAP":"",lt.aoMap?"#define USE_AOMAP":"",lt.bumpMap?"#define USE_BUMPMAP":"",lt.normalMap?"#define USE_NORMALMAP":"",lt.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",lt.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",lt.displacementMap?"#define USE_DISPLACEMENTMAP":"",lt.emissiveMap?"#define USE_EMISSIVEMAP":"",lt.anisotropy?"#define USE_ANISOTROPY":"",lt.anisotropyMap?"#define USE_ANISOTROPYMAP":"",lt.clearcoatMap?"#define USE_CLEARCOATMAP":"",lt.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",lt.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",lt.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",lt.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",lt.specularMap?"#define USE_SPECULARMAP":"",lt.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",lt.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",lt.roughnessMap?"#define USE_ROUGHNESSMAP":"",lt.metalnessMap?"#define USE_METALNESSMAP":"",lt.alphaMap?"#define USE_ALPHAMAP":"",lt.alphaHash?"#define USE_ALPHAHASH":"",lt.transmission?"#define USE_TRANSMISSION":"",lt.transmissionMap?"#define USE_TRANSMISSIONMAP":"",lt.thicknessMap?"#define USE_THICKNESSMAP":"",lt.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",lt.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",lt.mapUv?"#define MAP_UV "+lt.mapUv:"",lt.alphaMapUv?"#define ALPHAMAP_UV "+lt.alphaMapUv:"",lt.lightMapUv?"#define LIGHTMAP_UV "+lt.lightMapUv:"",lt.aoMapUv?"#define AOMAP_UV "+lt.aoMapUv:"",lt.emissiveMapUv?"#define EMISSIVEMAP_UV "+lt.emissiveMapUv:"",lt.bumpMapUv?"#define BUMPMAP_UV "+lt.bumpMapUv:"",lt.normalMapUv?"#define NORMALMAP_UV "+lt.normalMapUv:"",lt.displacementMapUv?"#define DISPLACEMENTMAP_UV "+lt.displacementMapUv:"",lt.metalnessMapUv?"#define METALNESSMAP_UV "+lt.metalnessMapUv:"",lt.roughnessMapUv?"#define ROUGHNESSMAP_UV "+lt.roughnessMapUv:"",lt.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+lt.anisotropyMapUv:"",lt.clearcoatMapUv?"#define CLEARCOATMAP_UV "+lt.clearcoatMapUv:"",lt.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+lt.clearcoatNormalMapUv:"",lt.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+lt.clearcoatRoughnessMapUv:"",lt.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+lt.iridescenceMapUv:"",lt.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+lt.iridescenceThicknessMapUv:"",lt.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+lt.sheenColorMapUv:"",lt.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+lt.sheenRoughnessMapUv:"",lt.specularMapUv?"#define SPECULARMAP_UV "+lt.specularMapUv:"",lt.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+lt.specularColorMapUv:"",lt.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+lt.specularIntensityMapUv:"",lt.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+lt.transmissionMapUv:"",lt.thicknessMapUv?"#define THICKNESSMAP_UV "+lt.thicknessMapUv:"",lt.vertexTangents&&lt.flatShading===!1?"#define USE_TANGENT":"",lt.vertexColors?"#define USE_COLOR":"",lt.vertexAlphas?"#define USE_COLOR_ALPHA":"",lt.vertexUv1s?"#define USE_UV1":"",lt.vertexUv2s?"#define USE_UV2":"",lt.vertexUv3s?"#define USE_UV3":"",lt.pointsUvs?"#define USE_POINTS_UV":"",lt.flatShading?"#define FLAT_SHADED":"",lt.skinning?"#define USE_SKINNING":"",lt.morphTargets?"#define USE_MORPHTARGETS":"",lt.morphNormals&&lt.flatShading===!1?"#define USE_MORPHNORMALS":"",lt.morphColors&&lt.isWebGL2?"#define USE_MORPHCOLORS":"",lt.morphTargetsCount>0&&lt.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",lt.morphTargetsCount>0&&lt.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+lt.morphTextureStride:"",lt.morphTargetsCount>0&&lt.isWebGL2?"#define MORPHTARGETS_COUNT "+lt.morphTargetsCount:"",lt.doubleSided?"#define DOUBLE_SIDED":"",lt.flipSided?"#define FLIP_SIDED":"",lt.shadowMapEnabled?"#define USE_SHADOWMAP":"",lt.shadowMapEnabled?"#define "+Lt:"",lt.sizeAttenuation?"#define USE_SIZEATTENUATION":"",lt.numLightProbes>0?"#define USE_LIGHT_PROBES":"",lt.useLegacyLights?"#define LEGACY_LIGHTS":"",lt.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",lt.logarithmicDepthBuffer&&lt.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(v_).join(`
`),ar=[qt,dx(lt),"#define SHADER_TYPE "+lt.shaderType,"#define SHADER_NAME "+lt.shaderName,Xt,lt.instancing?"#define USE_INSTANCING":"",lt.instancingColor?"#define USE_INSTANCING_COLOR":"",lt.useFog&&lt.fog?"#define USE_FOG":"",lt.useFog&&lt.fogExp2?"#define FOG_EXP2":"",lt.map?"#define USE_MAP":"",lt.matcap?"#define USE_MATCAP":"",lt.envMap?"#define USE_ENVMAP":"",lt.envMap?"#define "+Nt:"",lt.envMap?"#define "+jt:"",lt.envMap?"#define "+Wt:"",Qt?"#define CUBEUV_TEXEL_WIDTH "+Qt.texelWidth:"",Qt?"#define CUBEUV_TEXEL_HEIGHT "+Qt.texelHeight:"",Qt?"#define CUBEUV_MAX_MIP "+Qt.maxMip+".0":"",lt.lightMap?"#define USE_LIGHTMAP":"",lt.aoMap?"#define USE_AOMAP":"",lt.bumpMap?"#define USE_BUMPMAP":"",lt.normalMap?"#define USE_NORMALMAP":"",lt.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",lt.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",lt.emissiveMap?"#define USE_EMISSIVEMAP":"",lt.anisotropy?"#define USE_ANISOTROPY":"",lt.anisotropyMap?"#define USE_ANISOTROPYMAP":"",lt.clearcoat?"#define USE_CLEARCOAT":"",lt.clearcoatMap?"#define USE_CLEARCOATMAP":"",lt.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",lt.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",lt.iridescence?"#define USE_IRIDESCENCE":"",lt.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",lt.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",lt.specularMap?"#define USE_SPECULARMAP":"",lt.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",lt.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",lt.roughnessMap?"#define USE_ROUGHNESSMAP":"",lt.metalnessMap?"#define USE_METALNESSMAP":"",lt.alphaMap?"#define USE_ALPHAMAP":"",lt.alphaTest?"#define USE_ALPHATEST":"",lt.alphaHash?"#define USE_ALPHAHASH":"",lt.sheen?"#define USE_SHEEN":"",lt.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",lt.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",lt.transmission?"#define USE_TRANSMISSION":"",lt.transmissionMap?"#define USE_TRANSMISSIONMAP":"",lt.thicknessMap?"#define USE_THICKNESSMAP":"",lt.vertexTangents&&lt.flatShading===!1?"#define USE_TANGENT":"",lt.vertexColors||lt.instancingColor?"#define USE_COLOR":"",lt.vertexAlphas?"#define USE_COLOR_ALPHA":"",lt.vertexUv1s?"#define USE_UV1":"",lt.vertexUv2s?"#define USE_UV2":"",lt.vertexUv3s?"#define USE_UV3":"",lt.pointsUvs?"#define USE_POINTS_UV":"",lt.gradientMap?"#define USE_GRADIENTMAP":"",lt.flatShading?"#define FLAT_SHADED":"",lt.doubleSided?"#define DOUBLE_SIDED":"",lt.flipSided?"#define FLIP_SIDED":"",lt.shadowMapEnabled?"#define USE_SHADOWMAP":"",lt.shadowMapEnabled?"#define "+Lt:"",lt.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",lt.numLightProbes>0?"#define USE_LIGHT_PROBES":"",lt.useLegacyLights?"#define LEGACY_LIGHTS":"",lt.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",lt.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",lt.logarithmicDepthBuffer&&lt.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",lt.toneMapping!==or?"#define TONE_MAPPING":"",lt.toneMapping!==or?ds.tonemapping_pars_fragment:"",lt.toneMapping!==or?D1("toneMapping",lt.toneMapping):"",lt.dithering?"#define DITHERING":"",lt.opaque?"#define OPAQUE":"",ds.colorspace_pars_fragment,k1("linearToOutputTexel",lt.outputColorSpace),lt.transmissionSamplerMapEncoding?R1("transmissionSamplerMapTexelToLinear",lt.transmissionSamplerMapEncoding):"",lt.useDepthPacking?"#define DEPTH_PACKING "+lt.depthPacking:"",`
`].filter(v_).join(`
`)),Pt=V0(Pt),Pt=cx(Pt,lt),Pt=ux(Pt,lt),Mt=V0(Mt),Mt=cx(Mt,lt),Mt=ux(Mt,lt),Pt=hx(Pt),Mt=hx(Mt),lt.isWebGL2&&lt.isRawShaderMaterial!==!0&&(er=`#version 300 es
`,Yt=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+Yt,ar=["#define varying in",lt.glslVersion===Ym?"":"layout(location = 0) out highp vec4 pc_fragColor;",lt.glslVersion===Ym?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad","#define WebGL2Context 1"].join(`
`)+`
`+ar);const tr=er+Yt+Pt,Ar=er+ar+Mt,wr=ox(_t,_t.VERTEX_SHADER,tr),br=ox(_t,_t.FRAGMENT_SHADER,Ar);if(_t.attachShader(Zt,wr),_t.attachShader(Zt,br),lt.index0AttributeName!==void 0?_t.bindAttribLocation(Zt,0,lt.index0AttributeName):lt.morphTargets===!0&&_t.bindAttribLocation(Zt,0,"position"),_t.linkProgram(Zt),St.debug.checkShaderErrors){const Fr=_t.getProgramInfoLog(Zt).trim(),Vr=_t.getShaderInfoLog(wr).trim(),zr=_t.getShaderInfoLog(br).trim();let Hr=!0,_n=!0;if(_t.getProgramParameter(Zt,_t.LINK_STATUS)===!1)if(Hr=!1,typeof St.debug.onShaderError=="function")St.debug.onShaderError(_t,Zt,wr,br);else{const hn=lx(_t,wr,"vertex"),Rn=lx(_t,br,"fragment");console.error("THREE.WebGLProgram: Shader Error "+_t.getError()+" - VALIDATE_STATUS "+_t.getProgramParameter(Zt,_t.VALIDATE_STATUS)+`

Program Info Log: `+Fr+`
`+hn+`
`+Rn)}else Fr!==""?console.warn("THREE.WebGLProgram: Program Info Log:",Fr):Vr!==""&&zr!==""||(_n=!1);_n&&(this.diagnostics={runnable:Hr,programLog:Fr,vertexShader:{log:Vr,prefix:Yt},fragmentShader:{log:zr,prefix:ar}})}let Mr,Qr;return _t.deleteShader(wr),_t.deleteShader(br),this.getUniforms=function(){return Mr===void 0&&(Mr=new Pv(_t,Zt)),Mr},this.getAttributes=function(){return Qr===void 0&&(Qr=function(Fr,Vr){const zr={},Hr=Fr.getProgramParameter(Vr,Fr.ACTIVE_ATTRIBUTES);for(let _n=0;_n<Hr;_n++){const hn=Fr.getActiveAttrib(Vr,_n),Rn=hn.name;let Bn=1;hn.type===Fr.FLOAT_MAT2&&(Bn=2),hn.type===Fr.FLOAT_MAT3&&(Bn=3),hn.type===Fr.FLOAT_MAT4&&(Bn=4),zr[Rn]={type:hn.type,location:Fr.getAttribLocation(Vr,Rn),locationSize:Bn}}return zr}(_t,Zt)),Qr},this.destroy=function(){ht.releaseStatesOfProgram(this),_t.deleteProgram(Zt),this.program=void 0},this.type=lt.shaderType,this.name=lt.shaderName,this.id=I1++,this.cacheKey=tt,this.usedTimes=1,this.program=Zt,this.vertexShader=wr,this.fragmentShader=br,this}let j1=0;class G1{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(tt){const lt=tt.vertexShader,ht=tt.fragmentShader,_t=this._getShaderStage(lt),bt=this._getShaderStage(ht),Pt=this._getShaderCacheForMaterial(tt);return Pt.has(_t)===!1&&(Pt.add(_t),_t.usedTimes++),Pt.has(bt)===!1&&(Pt.add(bt),bt.usedTimes++),this}remove(tt){const lt=this.materialCache.get(tt);for(const ht of lt)ht.usedTimes--,ht.usedTimes===0&&this.shaderCache.delete(ht.code);return this.materialCache.delete(tt),this}getVertexShaderID(tt){return this._getShaderStage(tt.vertexShader).id}getFragmentShaderID(tt){return this._getShaderStage(tt.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(tt){const lt=this.materialCache;let ht=lt.get(tt);return ht===void 0&&(ht=new Set,lt.set(tt,ht)),ht}_getShaderStage(tt){const lt=this.shaderCache;let ht=lt.get(tt);return ht===void 0&&(ht=new z1(tt),lt.set(tt,ht)),ht}}class z1{constructor(tt){this.id=j1++,this.code=tt,this.usedTimes=0}}function V1(St,tt,lt,ht,_t,bt,Pt){const Mt=new um,Lt=new G1,Nt=[],jt=_t.isWebGL2,Wt=_t.logarithmicDepthBuffer,Qt=_t.vertexTextures;let qt=_t.precision;const Xt={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function Zt(Yt){return Yt===0?"uv":`uv${Yt}`}return{getParameters:function(Yt,ar,er,tr,Ar){const wr=tr.fog,br=Ar.geometry,Mr=Yt.isMeshStandardMaterial?tr.environment:null,Qr=(Yt.isMeshStandardMaterial?lt:tt).get(Yt.envMap||Mr),Fr=Qr&&Qr.mapping===Mn?Qr.image.height:null,Vr=Xt[Yt.type];Yt.precision!==null&&(qt=_t.getMaxPrecision(Yt.precision),qt!==Yt.precision&&console.warn("THREE.WebGLProgram.getParameters:",Yt.precision,"not supported, using",qt,"instead."));const zr=br.morphAttributes.position||br.morphAttributes.normal||br.morphAttributes.color,Hr=zr!==void 0?zr.length:0;let _n,hn,Rn,Bn,un=0;if(br.morphAttributes.position!==void 0&&(un=1),br.morphAttributes.normal!==void 0&&(un=2),br.morphAttributes.color!==void 0&&(un=3),Vr){const U_=zo[Vr];_n=U_.vertexShader,hn=U_.fragmentShader}else _n=Yt.vertexShader,hn=Yt.fragmentShader,Lt.update(Yt),Rn=Lt.getVertexShaderID(Yt),Bn=Lt.getFragmentShaderID(Yt);const Xr=St.getRenderTarget(),Jr=St.userData&&St.userData.transmissionRenderTarget,an=Xr?Array.isArray(Xr.texture)?Xr.texture[0]:Xr.texture:null,sn=Ar.isInstancedMesh===!0,Fn=!!Yt.map,rs=!!Yt.matcap,Yn=!!Qr,Un=!!Yt.aoMap,cs=!!Yt.lightMap,Lr=!!Yt.bumpMap,Er=!!Yt.normalMap,Ur=!!Yt.displacementMap,Wr=!!Yt.emissiveMap,kr=!!Yt.metalnessMap,fr=!!Yt.roughnessMap,Or=Yt.anisotropy>0,Nr=Yt.clearcoat>0,$r=Yt.iridescence>0,Kr=Yt.sheen>0,wn=Yt.transmission>0,dn=Or&&!!Yt.anisotropyMap,ms=Nr&&!!Yt.clearcoatMap,ts=Nr&&!!Yt.clearcoatNormalMap,Pn=Nr&&!!Yt.clearcoatRoughnessMap,Zn=$r&&!!Yt.iridescenceMap,qn=$r&&!!Yt.iridescenceThicknessMap,us=Kr&&!!Yt.sheenColorMap,vs=Kr&&!!Yt.sheenRoughnessMap,Ls=!!Yt.specularMap,Ms=!!Yt.specularColorMap,$n=!!Yt.specularIntensityMap,ws=wn&&!!Yt.transmissionMap,Jo=wn&&!!Yt.thicknessMap,ps=!!Yt.gradientMap,zs=!!Yt.alphaMap,Es=Yt.alphaTest>0,wu=!!Yt.alphaHash,Eu=!!Yt.extensions,_i=!!br.attributes.uv1,_0=!!br.attributes.uv2,f0=!!br.attributes.uv3;let Po=or;return Yt.toneMapped&&(Xr!==null&&Xr.isXRRenderTarget!==!0||(Po=St.toneMapping)),{isWebGL2:jt,shaderID:Vr,shaderType:Yt.type,shaderName:Yt.name,vertexShader:_n,fragmentShader:hn,defines:Yt.defines,customVertexShaderID:Rn,customFragmentShaderID:Bn,isRawShaderMaterial:Yt.isRawShaderMaterial===!0,glslVersion:Yt.glslVersion,precision:qt,instancing:sn,instancingColor:sn&&Ar.instanceColor!==null,supportsVertexTextures:Qt,outputColorSpace:Xr===null?St.outputColorSpace:Xr.isXRRenderTarget===!0||an.colorSpace&&an.colorSpace!==Ns?an.colorSpace:qs,map:Fn,matcap:rs,envMap:Yn,envMapMode:Yn&&Qr.mapping,envMapCubeUVHeight:Fr,aoMap:Un,lightMap:cs,bumpMap:Lr,normalMap:Er,displacementMap:Qt&&Ur,emissiveMap:Wr,normalMapObjectSpace:Er&&Yt.normalMapType===Ru,normalMapTangentSpace:Er&&Yt.normalMapType===xl,metalnessMap:kr,roughnessMap:fr,anisotropy:Or,anisotropyMap:dn,clearcoat:Nr,clearcoatMap:ms,clearcoatNormalMap:ts,clearcoatRoughnessMap:Pn,iridescence:$r,iridescenceMap:Zn,iridescenceThicknessMap:qn,sheen:Kr,sheenColorMap:us,sheenRoughnessMap:vs,specularMap:Ls,specularColorMap:Ms,specularIntensityMap:$n,transmission:wn,transmissionMap:ws,thicknessMap:Jo,transmissionSamplerMapEncoding:Jr&&Jr.texture.colorSpace||qs,gradientMap:ps,opaque:Yt.transparent===!1&&Yt.blending===Tt&&!(Yt.transmission>0),alphaMap:zs,alphaTest:Es,alphaHash:wu,combine:Yt.combine,mapUv:Fn&&Zt(Yt.map.channel),aoMapUv:Un&&Zt(Yt.aoMap.channel),lightMapUv:cs&&Zt(Yt.lightMap.channel),bumpMapUv:Lr&&Zt(Yt.bumpMap.channel),normalMapUv:Er&&Zt(Yt.normalMap.channel),displacementMapUv:Ur&&Zt(Yt.displacementMap.channel),emissiveMapUv:Wr&&Zt(Yt.emissiveMap.channel),metalnessMapUv:kr&&Zt(Yt.metalnessMap.channel),roughnessMapUv:fr&&Zt(Yt.roughnessMap.channel),anisotropyMapUv:dn&&Zt(Yt.anisotropyMap.channel),clearcoatMapUv:ms&&Zt(Yt.clearcoatMap.channel),clearcoatNormalMapUv:ts&&Zt(Yt.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:Pn&&Zt(Yt.clearcoatRoughnessMap.channel),iridescenceMapUv:Zn&&Zt(Yt.iridescenceMap.channel),iridescenceThicknessMapUv:qn&&Zt(Yt.iridescenceThicknessMap.channel),sheenColorMapUv:us&&Zt(Yt.sheenColorMap.channel),sheenRoughnessMapUv:vs&&Zt(Yt.sheenRoughnessMap.channel),specularMapUv:Ls&&Zt(Yt.specularMap.channel),specularColorMapUv:Ms&&Zt(Yt.specularColorMap.channel),specularIntensityMapUv:$n&&Zt(Yt.specularIntensityMap.channel),transmissionMapUv:ws&&Zt(Yt.transmissionMap.channel),thicknessMapUv:Jo&&Zt(Yt.thicknessMap.channel),alphaMapUv:zs&&Zt(Yt.alphaMap.channel),vertexTangents:!!br.attributes.tangent&&(Er||Or||br.userData.__forceUseTangent),vertexColors:Yt.vertexColors,vertexAlphas:Yt.vertexColors===!0&&!!br.attributes.color&&br.attributes.color.itemSize===4,vertexUv1s:_i,vertexUv2s:_0,vertexUv3s:f0,pointsUvs:Ar.isPoints===!0&&!!br.attributes.uv&&(Fn||zs),fog:!!wr,useFog:Yt.fog===!0,fogExp2:wr&&wr.isFogExp2,flatShading:Yt.flatShading===!0,sizeAttenuation:Yt.sizeAttenuation===!0,logarithmicDepthBuffer:Wt,skinning:Ar.isSkinnedMesh===!0,morphTargets:br.morphAttributes.position!==void 0,morphNormals:br.morphAttributes.normal!==void 0,morphColors:br.morphAttributes.color!==void 0,morphTargetsCount:Hr,morphTextureStride:un,numDirLights:ar.directional.length,numPointLights:ar.point.length,numSpotLights:ar.spot.length,numSpotLightMaps:ar.spotLightMap.length,numRectAreaLights:ar.rectArea.length,numHemiLights:ar.hemi.length,numDirLightShadows:ar.directionalShadowMap.length,numPointLightShadows:ar.pointShadowMap.length,numSpotLightShadows:ar.spotShadowMap.length,numSpotLightShadowsWithMaps:ar.numSpotLightShadowsWithMaps,numLightProbes:ar.numLightProbes,numClippingPlanes:Pt.numPlanes,numClipIntersection:Pt.numIntersection,dithering:Yt.dithering,shadowMapEnabled:St.shadowMap.enabled&&er.length>0,shadowMapType:St.shadowMap.type,toneMapping:Po,useLegacyLights:St._useLegacyLights,decodeVideoTexture:Fn&&Yt.map.isVideoTexture===!0&&Is.getTransfer(Yt.map.colorSpace)===Fs,premultipliedAlpha:Yt.premultipliedAlpha,doubleSided:Yt.side===At,flipSided:Yt.side===xt,useDepthPacking:Yt.depthPacking>=0,depthPacking:Yt.depthPacking||0,index0AttributeName:Yt.index0AttributeName,extensionDerivatives:Eu&&Yt.extensions.derivatives===!0,extensionFragDepth:Eu&&Yt.extensions.fragDepth===!0,extensionDrawBuffers:Eu&&Yt.extensions.drawBuffers===!0,extensionShaderTextureLOD:Eu&&Yt.extensions.shaderTextureLOD===!0,rendererExtensionFragDepth:jt||ht.has("EXT_frag_depth"),rendererExtensionDrawBuffers:jt||ht.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:jt||ht.has("EXT_shader_texture_lod"),customProgramCacheKey:Yt.customProgramCacheKey()}},getProgramCacheKey:function(Yt){const ar=[];if(Yt.shaderID?ar.push(Yt.shaderID):(ar.push(Yt.customVertexShaderID),ar.push(Yt.customFragmentShaderID)),Yt.defines!==void 0)for(const er in Yt.defines)ar.push(er),ar.push(Yt.defines[er]);return Yt.isRawShaderMaterial===!1&&(function(er,tr){er.push(tr.precision),er.push(tr.outputColorSpace),er.push(tr.envMapMode),er.push(tr.envMapCubeUVHeight),er.push(tr.mapUv),er.push(tr.alphaMapUv),er.push(tr.lightMapUv),er.push(tr.aoMapUv),er.push(tr.bumpMapUv),er.push(tr.normalMapUv),er.push(tr.displacementMapUv),er.push(tr.emissiveMapUv),er.push(tr.metalnessMapUv),er.push(tr.roughnessMapUv),er.push(tr.anisotropyMapUv),er.push(tr.clearcoatMapUv),er.push(tr.clearcoatNormalMapUv),er.push(tr.clearcoatRoughnessMapUv),er.push(tr.iridescenceMapUv),er.push(tr.iridescenceThicknessMapUv),er.push(tr.sheenColorMapUv),er.push(tr.sheenRoughnessMapUv),er.push(tr.specularMapUv),er.push(tr.specularColorMapUv),er.push(tr.specularIntensityMapUv),er.push(tr.transmissionMapUv),er.push(tr.thicknessMapUv),er.push(tr.combine),er.push(tr.fogExp2),er.push(tr.sizeAttenuation),er.push(tr.morphTargetsCount),er.push(tr.morphAttributeCount),er.push(tr.numDirLights),er.push(tr.numPointLights),er.push(tr.numSpotLights),er.push(tr.numSpotLightMaps),er.push(tr.numHemiLights),er.push(tr.numRectAreaLights),er.push(tr.numDirLightShadows),er.push(tr.numPointLightShadows),er.push(tr.numSpotLightShadows),er.push(tr.numSpotLightShadowsWithMaps),er.push(tr.numLightProbes),er.push(tr.shadowMapType),er.push(tr.toneMapping),er.push(tr.numClippingPlanes),er.push(tr.numClipIntersection),er.push(tr.depthPacking)}(ar,Yt),function(er,tr){Mt.disableAll(),tr.isWebGL2&&Mt.enable(0),tr.supportsVertexTextures&&Mt.enable(1),tr.instancing&&Mt.enable(2),tr.instancingColor&&Mt.enable(3),tr.matcap&&Mt.enable(4),tr.envMap&&Mt.enable(5),tr.normalMapObjectSpace&&Mt.enable(6),tr.normalMapTangentSpace&&Mt.enable(7),tr.clearcoat&&Mt.enable(8),tr.iridescence&&Mt.enable(9),tr.alphaTest&&Mt.enable(10),tr.vertexColors&&Mt.enable(11),tr.vertexAlphas&&Mt.enable(12),tr.vertexUv1s&&Mt.enable(13),tr.vertexUv2s&&Mt.enable(14),tr.vertexUv3s&&Mt.enable(15),tr.vertexTangents&&Mt.enable(16),tr.anisotropy&&Mt.enable(17),er.push(Mt.mask),Mt.disableAll(),tr.fog&&Mt.enable(0),tr.useFog&&Mt.enable(1),tr.flatShading&&Mt.enable(2),tr.logarithmicDepthBuffer&&Mt.enable(3),tr.skinning&&Mt.enable(4),tr.morphTargets&&Mt.enable(5),tr.morphNormals&&Mt.enable(6),tr.morphColors&&Mt.enable(7),tr.premultipliedAlpha&&Mt.enable(8),tr.shadowMapEnabled&&Mt.enable(9),tr.useLegacyLights&&Mt.enable(10),tr.doubleSided&&Mt.enable(11),tr.flipSided&&Mt.enable(12),tr.useDepthPacking&&Mt.enable(13),tr.dithering&&Mt.enable(14),tr.transmission&&Mt.enable(15),tr.sheen&&Mt.enable(16),tr.opaque&&Mt.enable(17),tr.pointsUvs&&Mt.enable(18),tr.decodeVideoTexture&&Mt.enable(19),er.push(Mt.mask)}(ar,Yt),ar.push(St.outputColorSpace)),ar.push(Yt.customProgramCacheKey),ar.join()},getUniforms:function(Yt){const ar=Xt[Yt.type];let er;if(ar){const tr=zo[ar];er=Gy.clone(tr.uniforms)}else er=Yt.uniforms;return er},acquireProgram:function(Yt,ar){let er;for(let tr=0,Ar=Nt.length;tr<Ar;tr++){const wr=Nt[tr];if(wr.cacheKey===ar){er=wr,++er.usedTimes;break}}return er===void 0&&(er=new U1(St,ar,Yt,bt),Nt.push(er)),er},releaseProgram:function(Yt){if(--Yt.usedTimes==0){const ar=Nt.indexOf(Yt);Nt[ar]=Nt[Nt.length-1],Nt.pop(),Yt.destroy()}},releaseShaderCache:function(Yt){Lt.remove(Yt)},programs:Nt,dispose:function(){Lt.dispose()}}}function H1(){let St=new WeakMap;return{get:function(tt){let lt=St.get(tt);return lt===void 0&&(lt={},St.set(tt,lt)),lt},remove:function(tt){St.delete(tt)},update:function(tt,lt,ht){St.get(tt)[lt]=ht},dispose:function(){St=new WeakMap}}}function Q1(St,tt){return St.groupOrder!==tt.groupOrder?St.groupOrder-tt.groupOrder:St.renderOrder!==tt.renderOrder?St.renderOrder-tt.renderOrder:St.material.id!==tt.material.id?St.material.id-tt.material.id:St.z!==tt.z?St.z-tt.z:St.id-tt.id}function mx(St,tt){return St.groupOrder!==tt.groupOrder?St.groupOrder-tt.groupOrder:St.renderOrder!==tt.renderOrder?St.renderOrder-tt.renderOrder:St.z!==tt.z?tt.z-St.z:St.id-tt.id}function gx(){const St=[];let tt=0;const lt=[],ht=[],_t=[];function bt(Pt,Mt,Lt,Nt,jt,Wt){let Qt=St[tt];return Qt===void 0?(Qt={id:Pt.id,object:Pt,geometry:Mt,material:Lt,groupOrder:Nt,renderOrder:Pt.renderOrder,z:jt,group:Wt},St[tt]=Qt):(Qt.id=Pt.id,Qt.object=Pt,Qt.geometry=Mt,Qt.material=Lt,Qt.groupOrder=Nt,Qt.renderOrder=Pt.renderOrder,Qt.z=jt,Qt.group=Wt),tt++,Qt}return{opaque:lt,transmissive:ht,transparent:_t,init:function(){tt=0,lt.length=0,ht.length=0,_t.length=0},push:function(Pt,Mt,Lt,Nt,jt,Wt){const Qt=bt(Pt,Mt,Lt,Nt,jt,Wt);Lt.transmission>0?ht.push(Qt):Lt.transparent===!0?_t.push(Qt):lt.push(Qt)},unshift:function(Pt,Mt,Lt,Nt,jt,Wt){const Qt=bt(Pt,Mt,Lt,Nt,jt,Wt);Lt.transmission>0?ht.unshift(Qt):Lt.transparent===!0?_t.unshift(Qt):lt.unshift(Qt)},finish:function(){for(let Pt=tt,Mt=St.length;Pt<Mt;Pt++){const Lt=St[Pt];if(Lt.id===null)break;Lt.id=null,Lt.object=null,Lt.geometry=null,Lt.material=null,Lt.group=null}},sort:function(Pt,Mt){lt.length>1&&lt.sort(Pt||Q1),ht.length>1&&ht.sort(Mt||mx),_t.length>1&&_t.sort(Mt||mx)}}}function W1(){let St=new WeakMap;return{get:function(tt,lt){const ht=St.get(tt);let _t;return ht===void 0?(_t=new gx,St.set(tt,[_t])):lt>=ht.length?(_t=new gx,ht.push(_t)):_t=ht[lt],_t},dispose:function(){St=new WeakMap}}}function q1(){const St={};return{get:function(tt){if(St[tt.id]!==void 0)return St[tt.id];let lt;switch(tt.type){case"DirectionalLight":lt={direction:new Sr,color:new jn};break;case"SpotLight":lt={position:new Sr,direction:new Sr,color:new jn,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":lt={position:new Sr,color:new jn,distance:0,decay:0};break;case"HemisphereLight":lt={direction:new Sr,skyColor:new jn,groundColor:new jn};break;case"RectAreaLight":lt={color:new jn,position:new Sr,halfWidth:new Sr,halfHeight:new Sr}}return St[tt.id]=lt,lt}}}let $1=0;function X1(St,tt){return(tt.castShadow?2:0)-(St.castShadow?2:0)+(tt.map?1:0)-(St.map?1:0)}function Y1(St,tt){const lt=new q1,ht=function(){const Lt={};return{get:function(Nt){if(Lt[Nt.id]!==void 0)return Lt[Nt.id];let jt;switch(Nt.type){case"DirectionalLight":case"SpotLight":jt={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new mn};break;case"PointLight":jt={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new mn,shadowCameraNear:1,shadowCameraFar:1e3}}return Lt[Nt.id]=jt,jt}}}(),_t={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let Lt=0;Lt<9;Lt++)_t.probe.push(new Sr);const bt=new Sr,Pt=new is,Mt=new is;return{setup:function(Lt,Nt){let jt=0,Wt=0,Qt=0;for(let Vr=0;Vr<9;Vr++)_t.probe[Vr].set(0,0,0);let qt=0,Xt=0,Zt=0,Yt=0,ar=0,er=0,tr=0,Ar=0,wr=0,br=0,Mr=0;Lt.sort(X1);const Qr=Nt===!0?Math.PI:1;for(let Vr=0,zr=Lt.length;Vr<zr;Vr++){const Hr=Lt[Vr],_n=Hr.color,hn=Hr.intensity,Rn=Hr.distance,Bn=Hr.shadow&&Hr.shadow.map?Hr.shadow.map.texture:null;if(Hr.isAmbientLight)jt+=_n.r*hn*Qr,Wt+=_n.g*hn*Qr,Qt+=_n.b*hn*Qr;else if(Hr.isLightProbe){for(let un=0;un<9;un++)_t.probe[un].addScaledVector(Hr.sh.coefficients[un],hn);Mr++}else if(Hr.isDirectionalLight){const un=lt.get(Hr);if(un.color.copy(Hr.color).multiplyScalar(Hr.intensity*Qr),Hr.castShadow){const Xr=Hr.shadow,Jr=ht.get(Hr);Jr.shadowBias=Xr.bias,Jr.shadowNormalBias=Xr.normalBias,Jr.shadowRadius=Xr.radius,Jr.shadowMapSize=Xr.mapSize,_t.directionalShadow[qt]=Jr,_t.directionalShadowMap[qt]=Bn,_t.directionalShadowMatrix[qt]=Hr.shadow.matrix,er++}_t.directional[qt]=un,qt++}else if(Hr.isSpotLight){const un=lt.get(Hr);un.position.setFromMatrixPosition(Hr.matrixWorld),un.color.copy(_n).multiplyScalar(hn*Qr),un.distance=Rn,un.coneCos=Math.cos(Hr.angle),un.penumbraCos=Math.cos(Hr.angle*(1-Hr.penumbra)),un.decay=Hr.decay,_t.spot[Zt]=un;const Xr=Hr.shadow;if(Hr.map&&(_t.spotLightMap[wr]=Hr.map,wr++,Xr.updateMatrices(Hr),Hr.castShadow&&br++),_t.spotLightMatrix[Zt]=Xr.matrix,Hr.castShadow){const Jr=ht.get(Hr);Jr.shadowBias=Xr.bias,Jr.shadowNormalBias=Xr.normalBias,Jr.shadowRadius=Xr.radius,Jr.shadowMapSize=Xr.mapSize,_t.spotShadow[Zt]=Jr,_t.spotShadowMap[Zt]=Bn,Ar++}Zt++}else if(Hr.isRectAreaLight){const un=lt.get(Hr);un.color.copy(_n).multiplyScalar(hn),un.halfWidth.set(.5*Hr.width,0,0),un.halfHeight.set(0,.5*Hr.height,0),_t.rectArea[Yt]=un,Yt++}else if(Hr.isPointLight){const un=lt.get(Hr);if(un.color.copy(Hr.color).multiplyScalar(Hr.intensity*Qr),un.distance=Hr.distance,un.decay=Hr.decay,Hr.castShadow){const Xr=Hr.shadow,Jr=ht.get(Hr);Jr.shadowBias=Xr.bias,Jr.shadowNormalBias=Xr.normalBias,Jr.shadowRadius=Xr.radius,Jr.shadowMapSize=Xr.mapSize,Jr.shadowCameraNear=Xr.camera.near,Jr.shadowCameraFar=Xr.camera.far,_t.pointShadow[Xt]=Jr,_t.pointShadowMap[Xt]=Bn,_t.pointShadowMatrix[Xt]=Hr.shadow.matrix,tr++}_t.point[Xt]=un,Xt++}else if(Hr.isHemisphereLight){const un=lt.get(Hr);un.skyColor.copy(Hr.color).multiplyScalar(hn*Qr),un.groundColor.copy(Hr.groundColor).multiplyScalar(hn*Qr),_t.hemi[ar]=un,ar++}}Yt>0&&(tt.isWebGL2||St.has("OES_texture_float_linear")===!0?(_t.rectAreaLTC1=Dn.LTC_FLOAT_1,_t.rectAreaLTC2=Dn.LTC_FLOAT_2):St.has("OES_texture_half_float_linear")===!0?(_t.rectAreaLTC1=Dn.LTC_HALF_1,_t.rectAreaLTC2=Dn.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),_t.ambient[0]=jt,_t.ambient[1]=Wt,_t.ambient[2]=Qt;const Fr=_t.hash;Fr.directionalLength===qt&&Fr.pointLength===Xt&&Fr.spotLength===Zt&&Fr.rectAreaLength===Yt&&Fr.hemiLength===ar&&Fr.numDirectionalShadows===er&&Fr.numPointShadows===tr&&Fr.numSpotShadows===Ar&&Fr.numSpotMaps===wr&&Fr.numLightProbes===Mr||(_t.directional.length=qt,_t.spot.length=Zt,_t.rectArea.length=Yt,_t.point.length=Xt,_t.hemi.length=ar,_t.directionalShadow.length=er,_t.directionalShadowMap.length=er,_t.pointShadow.length=tr,_t.pointShadowMap.length=tr,_t.spotShadow.length=Ar,_t.spotShadowMap.length=Ar,_t.directionalShadowMatrix.length=er,_t.pointShadowMatrix.length=tr,_t.spotLightMatrix.length=Ar+wr-br,_t.spotLightMap.length=wr,_t.numSpotLightShadowsWithMaps=br,_t.numLightProbes=Mr,Fr.directionalLength=qt,Fr.pointLength=Xt,Fr.spotLength=Zt,Fr.rectAreaLength=Yt,Fr.hemiLength=ar,Fr.numDirectionalShadows=er,Fr.numPointShadows=tr,Fr.numSpotShadows=Ar,Fr.numSpotMaps=wr,Fr.numLightProbes=Mr,_t.version=$1++)},setupView:function(Lt,Nt){let jt=0,Wt=0,Qt=0,qt=0,Xt=0;const Zt=Nt.matrixWorldInverse;for(let Yt=0,ar=Lt.length;Yt<ar;Yt++){const er=Lt[Yt];if(er.isDirectionalLight){const tr=_t.directional[jt];tr.direction.setFromMatrixPosition(er.matrixWorld),bt.setFromMatrixPosition(er.target.matrixWorld),tr.direction.sub(bt),tr.direction.transformDirection(Zt),jt++}else if(er.isSpotLight){const tr=_t.spot[Qt];tr.position.setFromMatrixPosition(er.matrixWorld),tr.position.applyMatrix4(Zt),tr.direction.setFromMatrixPosition(er.matrixWorld),bt.setFromMatrixPosition(er.target.matrixWorld),tr.direction.sub(bt),tr.direction.transformDirection(Zt),Qt++}else if(er.isRectAreaLight){const tr=_t.rectArea[qt];tr.position.setFromMatrixPosition(er.matrixWorld),tr.position.applyMatrix4(Zt),Mt.identity(),Pt.copy(er.matrixWorld),Pt.premultiply(Zt),Mt.extractRotation(Pt),tr.halfWidth.set(.5*er.width,0,0),tr.halfHeight.set(0,.5*er.height,0),tr.halfWidth.applyMatrix4(Mt),tr.halfHeight.applyMatrix4(Mt),qt++}else if(er.isPointLight){const tr=_t.point[Wt];tr.position.setFromMatrixPosition(er.matrixWorld),tr.position.applyMatrix4(Zt),Wt++}else if(er.isHemisphereLight){const tr=_t.hemi[Xt];tr.direction.setFromMatrixPosition(er.matrixWorld),tr.direction.transformDirection(Zt),Xt++}}},state:_t}}function _x(St,tt){const lt=new Y1(St,tt),ht=[],_t=[];return{init:function(){ht.length=0,_t.length=0},state:{lightsArray:ht,shadowsArray:_t,lights:lt},setupLights:function(bt){lt.setup(ht,bt)},setupLightsView:function(bt){lt.setupView(ht,bt)},pushLight:function(bt){ht.push(bt)},pushShadow:function(bt){_t.push(bt)}}}function K1(St,tt){let lt=new WeakMap;return{get:function(ht,_t=0){const bt=lt.get(ht);let Pt;return bt===void 0?(Pt=new _x(St,tt),lt.set(ht,[Pt])):_t>=bt.length?(Pt=new _x(St,tt),bt.push(Pt)):Pt=bt[_t],Pt},dispose:function(){lt=new WeakMap}}}class H0 extends ao{constructor(tt){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=cp,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(tt)}copy(tt){return super.copy(tt),this.depthPacking=tt.depthPacking,this.map=tt.map,this.alphaMap=tt.alphaMap,this.displacementMap=tt.displacementMap,this.displacementScale=tt.displacementScale,this.displacementBias=tt.displacementBias,this.wireframe=tt.wireframe,this.wireframeLinewidth=tt.wireframeLinewidth,this}}class Q0 extends ao{constructor(tt){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(tt)}copy(tt){return super.copy(tt),this.map=tt.map,this.alphaMap=tt.alphaMap,this.displacementMap=tt.displacementMap,this.displacementScale=tt.displacementScale,this.displacementBias=tt.displacementBias,this}}function J1(St,tt,lt){let ht=new Av;const _t=new mn,bt=new mn,Pt=new Rs,Mt=new H0({depthPacking:Qm}),Lt=new Q0,Nt={},jt=lt.maxTextureSize,Wt={[vt]:xt,[xt]:vt,[At]:At},Qt=new Ul({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new mn},radius:{value:4}},vertexShader:`void main() {
	gl_Position = vec4( position, 1.0 );
}`,fragmentShader:`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`}),qt=Qt.clone();qt.defines.HORIZONTAL_PASS=1;const Xt=new fs;Xt.setAttribute("position",new gr(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const Zt=new co(Xt,Qt),Yt=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=pt;let ar=this.type;function er(wr,br){const Mr=tt.update(Zt);Qt.defines.VSM_SAMPLES!==wr.blurSamples&&(Qt.defines.VSM_SAMPLES=wr.blurSamples,qt.defines.VSM_SAMPLES=wr.blurSamples,Qt.needsUpdate=!0,qt.needsUpdate=!0),wr.mapPass===null&&(wr.mapPass=new wo(_t.x,_t.y)),Qt.uniforms.shadow_pass.value=wr.map.texture,Qt.uniforms.resolution.value=wr.mapSize,Qt.uniforms.radius.value=wr.radius,St.setRenderTarget(wr.mapPass),St.clear(),St.renderBufferDirect(br,null,Mr,Qt,Zt,null),qt.uniforms.shadow_pass.value=wr.mapPass.texture,qt.uniforms.resolution.value=wr.mapSize,qt.uniforms.radius.value=wr.radius,St.setRenderTarget(wr.map),St.clear(),St.renderBufferDirect(br,null,Mr,qt,Zt,null)}function tr(wr,br,Mr,Qr){let Fr=null;const Vr=Mr.isPointLight===!0?wr.customDistanceMaterial:wr.customDepthMaterial;if(Vr!==void 0)Fr=Vr;else if(Fr=Mr.isPointLight===!0?Lt:Mt,St.localClippingEnabled&&br.clipShadows===!0&&Array.isArray(br.clippingPlanes)&&br.clippingPlanes.length!==0||br.displacementMap&&br.displacementScale!==0||br.alphaMap&&br.alphaTest>0||br.map&&br.alphaTest>0){const zr=Fr.uuid,Hr=br.uuid;let _n=Nt[zr];_n===void 0&&(_n={},Nt[zr]=_n);let hn=_n[Hr];hn===void 0&&(hn=Fr.clone(),_n[Hr]=hn),Fr=hn}return Fr.visible=br.visible,Fr.wireframe=br.wireframe,Fr.side=Qr===ft?br.shadowSide!==null?br.shadowSide:br.side:br.shadowSide!==null?br.shadowSide:Wt[br.side],Fr.alphaMap=br.alphaMap,Fr.alphaTest=br.alphaTest,Fr.map=br.map,Fr.clipShadows=br.clipShadows,Fr.clippingPlanes=br.clippingPlanes,Fr.clipIntersection=br.clipIntersection,Fr.displacementMap=br.displacementMap,Fr.displacementScale=br.displacementScale,Fr.displacementBias=br.displacementBias,Fr.wireframeLinewidth=br.wireframeLinewidth,Fr.linewidth=br.linewidth,Mr.isPointLight===!0&&Fr.isMeshDistanceMaterial===!0&&(St.properties.get(Fr).light=Mr),Fr}function Ar(wr,br,Mr,Qr,Fr){if(wr.visible===!1)return;if(wr.layers.test(br.layers)&&(wr.isMesh||wr.isLine||wr.isPoints)&&(wr.castShadow||wr.receiveShadow&&Fr===ft)&&(!wr.frustumCulled||ht.intersectsObject(wr))){wr.modelViewMatrix.multiplyMatrices(Mr.matrixWorldInverse,wr.matrixWorld);const zr=tt.update(wr),Hr=wr.material;if(Array.isArray(Hr)){const _n=zr.groups;for(let hn=0,Rn=_n.length;hn<Rn;hn++){const Bn=_n[hn],un=Hr[Bn.materialIndex];if(un&&un.visible){const Xr=tr(wr,un,Qr,Fr);St.renderBufferDirect(Mr,null,zr,Xr,wr,Bn)}}}else if(Hr.visible){const _n=tr(wr,Hr,Qr,Fr);St.renderBufferDirect(Mr,null,zr,_n,wr,null)}}const Vr=wr.children;for(let zr=0,Hr=Vr.length;zr<Hr;zr++)Ar(Vr[zr],br,Mr,Qr,Fr)}this.render=function(wr,br,Mr){if(Yt.enabled===!1||Yt.autoUpdate===!1&&Yt.needsUpdate===!1||wr.length===0)return;const Qr=St.getRenderTarget(),Fr=St.getActiveCubeFace(),Vr=St.getActiveMipmapLevel(),zr=St.state;zr.setBlending(Et),zr.buffers.color.setClear(1,1,1,1),zr.buffers.depth.setTest(!0),zr.setScissorTest(!1);const Hr=ar!==ft&&this.type===ft,_n=ar===ft&&this.type!==ft;for(let hn=0,Rn=wr.length;hn<Rn;hn++){const Bn=wr[hn],un=Bn.shadow;if(un===void 0){console.warn("THREE.WebGLShadowMap:",Bn,"has no shadow.");continue}if(un.autoUpdate===!1&&un.needsUpdate===!1)continue;_t.copy(un.mapSize);const Xr=un.getFrameExtents();if(_t.multiply(Xr),bt.copy(un.mapSize),(_t.x>jt||_t.y>jt)&&(_t.x>jt&&(bt.x=Math.floor(jt/Xr.x),_t.x=bt.x*Xr.x,un.mapSize.x=bt.x),_t.y>jt&&(bt.y=Math.floor(jt/Xr.y),_t.y=bt.y*Xr.y,un.mapSize.y=bt.y)),un.map===null||Hr===!0||_n===!0){const an=this.type!==ft?{minFilter:rn,magFilter:rn}:{};un.map!==null&&un.map.dispose(),un.map=new wo(_t.x,_t.y,an),un.map.texture.name=Bn.name+".shadowMap",un.camera.updateProjectionMatrix()}St.setRenderTarget(un.map),St.clear();const Jr=un.getViewportCount();for(let an=0;an<Jr;an++){const sn=un.getViewport(an);Pt.set(bt.x*sn.x,bt.y*sn.y,bt.x*sn.z,bt.y*sn.w),zr.viewport(Pt),un.updateMatrices(Bn,an),ht=un.getFrustum(),Ar(br,Mr,un.camera,Bn,this.type)}un.isPointLightShadow!==!0&&this.type===ft&&er(un,Mr),un.needsUpdate=!1}ar=this.type,Yt.needsUpdate=!1,St.setRenderTarget(Qr,Fr,Vr)}}function Z1(St,tt,lt){const ht=lt.isWebGL2,_t=new function(){let fr=!1;const Or=new Rs;let Nr=null;const $r=new Rs(0,0,0,0);return{setMask:function(Kr){Nr===Kr||fr||(St.colorMask(Kr,Kr,Kr,Kr),Nr=Kr)},setLocked:function(Kr){fr=Kr},setClear:function(Kr,wn,dn,ms,ts){ts===!0&&(Kr*=ms,wn*=ms,dn*=ms),Or.set(Kr,wn,dn,ms),$r.equals(Or)===!1&&(St.clearColor(Kr,wn,dn,ms),$r.copy(Or))},reset:function(){fr=!1,Nr=null,$r.set(-1,0,0,0)}}},bt=new function(){let fr=!1,Or=null,Nr=null,$r=null;return{setTest:function(Kr){Kr?Yn(St.DEPTH_TEST):Un(St.DEPTH_TEST)},setMask:function(Kr){Or===Kr||fr||(St.depthMask(Kr),Or=Kr)},setFunc:function(Kr){if(Nr!==Kr){switch(Kr){case _r:St.depthFunc(St.NEVER);break;case rr:St.depthFunc(St.ALWAYS);break;case mr:St.depthFunc(St.LESS);break;case Rr:St.depthFunc(St.LEQUAL);break;case Yr:St.depthFunc(St.EQUAL);break;case Zr:St.depthFunc(St.GEQUAL);break;case cn:St.depthFunc(St.GREATER);break;case Tn:St.depthFunc(St.NOTEQUAL);break;default:St.depthFunc(St.LEQUAL)}Nr=Kr}},setLocked:function(Kr){fr=Kr},setClear:function(Kr){$r!==Kr&&(St.clearDepth(Kr),$r=Kr)},reset:function(){fr=!1,Or=null,Nr=null,$r=null}}},Pt=new function(){let fr=!1,Or=null,Nr=null,$r=null,Kr=null,wn=null,dn=null,ms=null,ts=null;return{setTest:function(Pn){fr||(Pn?Yn(St.STENCIL_TEST):Un(St.STENCIL_TEST))},setMask:function(Pn){Or===Pn||fr||(St.stencilMask(Pn),Or=Pn)},setFunc:function(Pn,Zn,qn){Nr===Pn&&$r===Zn&&Kr===qn||(St.stencilFunc(Pn,Zn,qn),Nr=Pn,$r=Zn,Kr=qn)},setOp:function(Pn,Zn,qn){wn===Pn&&dn===Zn&&ms===qn||(St.stencilOp(Pn,Zn,qn),wn=Pn,dn=Zn,ms=qn)},setLocked:function(Pn){fr=Pn},setClear:function(Pn){ts!==Pn&&(St.clearStencil(Pn),ts=Pn)},reset:function(){fr=!1,Or=null,Nr=null,$r=null,Kr=null,wn=null,dn=null,ms=null,ts=null}}},Mt=new WeakMap,Lt=new WeakMap;let Nt={},jt={},Wt=new WeakMap,Qt=[],qt=null,Xt=!1,Zt=null,Yt=null,ar=null,er=null,tr=null,Ar=null,wr=null,br=!1,Mr=null,Qr=null,Fr=null,Vr=null,zr=null;const Hr=St.getParameter(St.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let _n=!1,hn=0;const Rn=St.getParameter(St.VERSION);Rn.indexOf("WebGL")!==-1?(hn=parseFloat(/^WebGL (\d)/.exec(Rn)[1]),_n=hn>=1):Rn.indexOf("OpenGL ES")!==-1&&(hn=parseFloat(/^OpenGL ES (\d)/.exec(Rn)[1]),_n=hn>=2);let Bn=null,un={};const Xr=St.getParameter(St.SCISSOR_BOX),Jr=St.getParameter(St.VIEWPORT),an=new Rs().fromArray(Xr),sn=new Rs().fromArray(Jr);function Fn(fr,Or,Nr,$r){const Kr=new Uint8Array(4),wn=St.createTexture();St.bindTexture(fr,wn),St.texParameteri(fr,St.TEXTURE_MIN_FILTER,St.NEAREST),St.texParameteri(fr,St.TEXTURE_MAG_FILTER,St.NEAREST);for(let dn=0;dn<Nr;dn++)!ht||fr!==St.TEXTURE_3D&&fr!==St.TEXTURE_2D_ARRAY?St.texImage2D(Or+dn,0,St.RGBA,1,1,0,St.RGBA,St.UNSIGNED_BYTE,Kr):St.texImage3D(Or,0,St.RGBA,1,1,$r,0,St.RGBA,St.UNSIGNED_BYTE,Kr);return wn}const rs={};function Yn(fr){Nt[fr]!==!0&&(St.enable(fr),Nt[fr]=!0)}function Un(fr){Nt[fr]!==!1&&(St.disable(fr),Nt[fr]=!1)}rs[St.TEXTURE_2D]=Fn(St.TEXTURE_2D,St.TEXTURE_2D,1),rs[St.TEXTURE_CUBE_MAP]=Fn(St.TEXTURE_CUBE_MAP,St.TEXTURE_CUBE_MAP_POSITIVE_X,6),ht&&(rs[St.TEXTURE_2D_ARRAY]=Fn(St.TEXTURE_2D_ARRAY,St.TEXTURE_2D_ARRAY,1,1),rs[St.TEXTURE_3D]=Fn(St.TEXTURE_3D,St.TEXTURE_3D,1,1)),_t.setClear(0,0,0,1),bt.setClear(1),Pt.setClear(0),Yn(St.DEPTH_TEST),bt.setFunc(Rr),Ur(!1),Wr(it),Yn(St.CULL_FACE),Er(Et);const cs={[Rt]:St.FUNC_ADD,[Ut]:St.FUNC_SUBTRACT,[Ht]:St.FUNC_REVERSE_SUBTRACT};if(ht)cs[Jt]=St.MIN,cs[Kt]=St.MAX;else{const fr=tt.get("EXT_blend_minmax");fr!==null&&(cs[Jt]=fr.MIN_EXT,cs[Kt]=fr.MAX_EXT)}const Lr={[sr]:St.ZERO,[ir]:St.ONE,[cr]:St.SRC_COLOR,[hr]:St.SRC_ALPHA,[Dr]:St.SRC_ALPHA_SATURATE,[xr]:St.DST_COLOR,[pr]:St.DST_ALPHA,[lr]:St.ONE_MINUS_SRC_COLOR,[dr]:St.ONE_MINUS_SRC_ALPHA,[vr]:St.ONE_MINUS_DST_COLOR,[ur]:St.ONE_MINUS_DST_ALPHA};function Er(fr,Or,Nr,$r,Kr,wn,dn,ms){if(fr!==Et){if(Xt===!1&&(Yn(St.BLEND),Xt=!0),fr===Bt)Kr=Kr||Or,wn=wn||Nr,dn=dn||$r,Or===Yt&&Kr===tr||(St.blendEquationSeparate(cs[Or],cs[Kr]),Yt=Or,tr=Kr),Nr===ar&&$r===er&&wn===Ar&&dn===wr||(St.blendFuncSeparate(Lr[Nr],Lr[$r],Lr[wn],Lr[dn]),ar=Nr,er=$r,Ar=wn,wr=dn),Zt=fr,br=!1;else if(fr!==Zt||ms!==br){if(Yt===Rt&&tr===Rt||(St.blendEquation(St.FUNC_ADD),Yt=Rt,tr=Rt),ms)switch(fr){case Tt:St.blendFuncSeparate(St.ONE,St.ONE_MINUS_SRC_ALPHA,St.ONE,St.ONE_MINUS_SRC_ALPHA);break;case kt:St.blendFunc(St.ONE,St.ONE);break;case Dt:St.blendFuncSeparate(St.ZERO,St.ONE_MINUS_SRC_COLOR,St.ZERO,St.ONE);break;case zt:St.blendFuncSeparate(St.ZERO,St.SRC_COLOR,St.ZERO,St.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",fr)}else switch(fr){case Tt:St.blendFuncSeparate(St.SRC_ALPHA,St.ONE_MINUS_SRC_ALPHA,St.ONE,St.ONE_MINUS_SRC_ALPHA);break;case kt:St.blendFunc(St.SRC_ALPHA,St.ONE);break;case Dt:St.blendFuncSeparate(St.ZERO,St.ONE_MINUS_SRC_COLOR,St.ZERO,St.ONE);break;case zt:St.blendFunc(St.ZERO,St.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",fr)}ar=null,er=null,Ar=null,wr=null,Zt=fr,br=ms}}else Xt===!0&&(Un(St.BLEND),Xt=!1)}function Ur(fr){Mr!==fr&&(fr?St.frontFace(St.CW):St.frontFace(St.CCW),Mr=fr)}function Wr(fr){fr!==_e?(Yn(St.CULL_FACE),fr!==Qr&&(fr===it?St.cullFace(St.BACK):fr===nt?St.cullFace(St.FRONT):St.cullFace(St.FRONT_AND_BACK))):Un(St.CULL_FACE),Qr=fr}function kr(fr,Or,Nr){fr?(Yn(St.POLYGON_OFFSET_FILL),Vr===Or&&zr===Nr||(St.polygonOffset(Or,Nr),Vr=Or,zr=Nr)):Un(St.POLYGON_OFFSET_FILL)}return{buffers:{color:_t,depth:bt,stencil:Pt},enable:Yn,disable:Un,bindFramebuffer:function(fr,Or){return jt[fr]!==Or&&(St.bindFramebuffer(fr,Or),jt[fr]=Or,ht&&(fr===St.DRAW_FRAMEBUFFER&&(jt[St.FRAMEBUFFER]=Or),fr===St.FRAMEBUFFER&&(jt[St.DRAW_FRAMEBUFFER]=Or)),!0)},drawBuffers:function(fr,Or){let Nr=Qt,$r=!1;if(fr)if(Nr=Wt.get(Or),Nr===void 0&&(Nr=[],Wt.set(Or,Nr)),fr.isWebGLMultipleRenderTargets){const Kr=fr.texture;if(Nr.length!==Kr.length||Nr[0]!==St.COLOR_ATTACHMENT0){for(let wn=0,dn=Kr.length;wn<dn;wn++)Nr[wn]=St.COLOR_ATTACHMENT0+wn;Nr.length=Kr.length,$r=!0}}else Nr[0]!==St.COLOR_ATTACHMENT0&&(Nr[0]=St.COLOR_ATTACHMENT0,$r=!0);else Nr[0]!==St.BACK&&(Nr[0]=St.BACK,$r=!0);$r&&(lt.isWebGL2?St.drawBuffers(Nr):tt.get("WEBGL_draw_buffers").drawBuffersWEBGL(Nr))},useProgram:function(fr){return qt!==fr&&(St.useProgram(fr),qt=fr,!0)},setBlending:Er,setMaterial:function(fr,Or){fr.side===At?Un(St.CULL_FACE):Yn(St.CULL_FACE);let Nr=fr.side===xt;Or&&(Nr=!Nr),Ur(Nr),fr.blending===Tt&&fr.transparent===!1?Er(Et):Er(fr.blending,fr.blendEquation,fr.blendSrc,fr.blendDst,fr.blendEquationAlpha,fr.blendSrcAlpha,fr.blendDstAlpha,fr.premultipliedAlpha),bt.setFunc(fr.depthFunc),bt.setTest(fr.depthTest),bt.setMask(fr.depthWrite),_t.setMask(fr.colorWrite);const $r=fr.stencilWrite;Pt.setTest($r),$r&&(Pt.setMask(fr.stencilWriteMask),Pt.setFunc(fr.stencilFunc,fr.stencilRef,fr.stencilFuncMask),Pt.setOp(fr.stencilFail,fr.stencilZFail,fr.stencilZPass)),kr(fr.polygonOffset,fr.polygonOffsetFactor,fr.polygonOffsetUnits),fr.alphaToCoverage===!0?Yn(St.SAMPLE_ALPHA_TO_COVERAGE):Un(St.SAMPLE_ALPHA_TO_COVERAGE)},setFlipSided:Ur,setCullFace:Wr,setLineWidth:function(fr){fr!==Fr&&(_n&&St.lineWidth(fr),Fr=fr)},setPolygonOffset:kr,setScissorTest:function(fr){fr?Yn(St.SCISSOR_TEST):Un(St.SCISSOR_TEST)},activeTexture:function(fr){fr===void 0&&(fr=St.TEXTURE0+Hr-1),Bn!==fr&&(St.activeTexture(fr),Bn=fr)},bindTexture:function(fr,Or,Nr){Nr===void 0&&(Nr=Bn===null?St.TEXTURE0+Hr-1:Bn);let $r=un[Nr];$r===void 0&&($r={type:void 0,texture:void 0},un[Nr]=$r),$r.type===fr&&$r.texture===Or||(Bn!==Nr&&(St.activeTexture(Nr),Bn=Nr),St.bindTexture(fr,Or||rs[fr]),$r.type=fr,$r.texture=Or)},unbindTexture:function(){const fr=un[Bn];fr!==void 0&&fr.type!==void 0&&(St.bindTexture(fr.type,null),fr.type=void 0,fr.texture=void 0)},compressedTexImage2D:function(){try{St.compressedTexImage2D.apply(St,arguments)}catch(fr){console.error("THREE.WebGLState:",fr)}},compressedTexImage3D:function(){try{St.compressedTexImage3D.apply(St,arguments)}catch(fr){console.error("THREE.WebGLState:",fr)}},texImage2D:function(){try{St.texImage2D.apply(St,arguments)}catch(fr){console.error("THREE.WebGLState:",fr)}},texImage3D:function(){try{St.texImage3D.apply(St,arguments)}catch(fr){console.error("THREE.WebGLState:",fr)}},updateUBOMapping:function(fr,Or){let Nr=Lt.get(Or);Nr===void 0&&(Nr=new WeakMap,Lt.set(Or,Nr));let $r=Nr.get(fr);$r===void 0&&($r=St.getUniformBlockIndex(Or,fr.name),Nr.set(fr,$r))},uniformBlockBinding:function(fr,Or){const Nr=Lt.get(Or).get(fr);Mt.get(Or)!==Nr&&(St.uniformBlockBinding(Or,Nr,fr.__bindingPointIndex),Mt.set(Or,Nr))},texStorage2D:function(){try{St.texStorage2D.apply(St,arguments)}catch(fr){console.error("THREE.WebGLState:",fr)}},texStorage3D:function(){try{St.texStorage3D.apply(St,arguments)}catch(fr){console.error("THREE.WebGLState:",fr)}},texSubImage2D:function(){try{St.texSubImage2D.apply(St,arguments)}catch(fr){console.error("THREE.WebGLState:",fr)}},texSubImage3D:function(){try{St.texSubImage3D.apply(St,arguments)}catch(fr){console.error("THREE.WebGLState:",fr)}},compressedTexSubImage2D:function(){try{St.compressedTexSubImage2D.apply(St,arguments)}catch(fr){console.error("THREE.WebGLState:",fr)}},compressedTexSubImage3D:function(){try{St.compressedTexSubImage3D.apply(St,arguments)}catch(fr){console.error("THREE.WebGLState:",fr)}},scissor:function(fr){an.equals(fr)===!1&&(St.scissor(fr.x,fr.y,fr.z,fr.w),an.copy(fr))},viewport:function(fr){sn.equals(fr)===!1&&(St.viewport(fr.x,fr.y,fr.z,fr.w),sn.copy(fr))},reset:function(){St.disable(St.BLEND),St.disable(St.CULL_FACE),St.disable(St.DEPTH_TEST),St.disable(St.POLYGON_OFFSET_FILL),St.disable(St.SCISSOR_TEST),St.disable(St.STENCIL_TEST),St.disable(St.SAMPLE_ALPHA_TO_COVERAGE),St.blendEquation(St.FUNC_ADD),St.blendFunc(St.ONE,St.ZERO),St.blendFuncSeparate(St.ONE,St.ZERO,St.ONE,St.ZERO),St.colorMask(!0,!0,!0,!0),St.clearColor(0,0,0,0),St.depthMask(!0),St.depthFunc(St.LESS),St.clearDepth(1),St.stencilMask(4294967295),St.stencilFunc(St.ALWAYS,0,4294967295),St.stencilOp(St.KEEP,St.KEEP,St.KEEP),St.clearStencil(0),St.cullFace(St.BACK),St.frontFace(St.CCW),St.polygonOffset(0,0),St.activeTexture(St.TEXTURE0),St.bindFramebuffer(St.FRAMEBUFFER,null),ht===!0&&(St.bindFramebuffer(St.DRAW_FRAMEBUFFER,null),St.bindFramebuffer(St.READ_FRAMEBUFFER,null)),St.useProgram(null),St.lineWidth(1),St.scissor(0,0,St.canvas.width,St.canvas.height),St.viewport(0,0,St.canvas.width,St.canvas.height),Nt={},Bn=null,un={},jt={},Wt=new WeakMap,Qt=[],qt=null,Xt=!1,Zt=null,Yt=null,ar=null,er=null,tr=null,Ar=null,wr=null,br=!1,Mr=null,Qr=null,Fr=null,Vr=null,zr=null,an.set(0,0,St.canvas.width,St.canvas.height),sn.set(0,0,St.canvas.width,St.canvas.height),_t.reset(),bt.reset(),Pt.reset()}}}function eE(St,tt,lt,ht,_t,bt,Pt){const Mt=_t.isWebGL2,Lt=_t.maxTextures,Nt=_t.maxCubemapSize,jt=_t.maxTextureSize,Wt=_t.maxSamples,Qt=tt.has("WEBGL_multisampled_render_to_texture")?tt.get("WEBGL_multisampled_render_to_texture"):null,qt=typeof navigator<"u"&&/OculusBrowser/g.test(navigator.userAgent),Xt=new WeakMap;let Zt;const Yt=new WeakMap;let ar=!1;try{ar=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function er(Lr,Er){return ar?new OffscreenCanvas(Lr,Er):gu("canvas")}function tr(Lr,Er,Ur,Wr){let kr=1;if((Lr.width>Wr||Lr.height>Wr)&&(kr=Wr/Math.max(Lr.width,Lr.height)),kr<1||Er===!0){if(typeof HTMLImageElement<"u"&&Lr instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&Lr instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&Lr instanceof ImageBitmap){const fr=Er?gp:Math.floor,Or=fr(kr*Lr.width),Nr=fr(kr*Lr.height);Zt===void 0&&(Zt=er(Or,Nr));const $r=Ur?er(Or,Nr):Zt;return $r.width=Or,$r.height=Nr,$r.getContext("2d").drawImage(Lr,0,0,Or,Nr),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+Lr.width+"x"+Lr.height+") to ("+Or+"x"+Nr+")."),$r}return"data"in Lr&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+Lr.width+"x"+Lr.height+")."),Lr}return Lr}function Ar(Lr){return tm(Lr.width)&&tm(Lr.height)}function wr(Lr,Er){return Lr.generateMipmaps&&Er&&Lr.minFilter!==rn&&Lr.minFilter!==Wn}function br(Lr){St.generateMipmap(Lr)}function Mr(Lr,Er,Ur,Wr,kr=!1){if(Mt===!1)return Er;if(Lr!==null){if(St[Lr]!==void 0)return St[Lr];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+Lr+"'")}let fr=Er;if(Er===St.RED&&(Ur===St.FLOAT&&(fr=St.R32F),Ur===St.HALF_FLOAT&&(fr=St.R16F),Ur===St.UNSIGNED_BYTE&&(fr=St.R8)),Er===St.RED_INTEGER&&(Ur===St.UNSIGNED_BYTE&&(fr=St.R8UI),Ur===St.UNSIGNED_SHORT&&(fr=St.R16UI),Ur===St.UNSIGNED_INT&&(fr=St.R32UI),Ur===St.BYTE&&(fr=St.R8I),Ur===St.SHORT&&(fr=St.R16I),Ur===St.INT&&(fr=St.R32I)),Er===St.RG&&(Ur===St.FLOAT&&(fr=St.RG32F),Ur===St.HALF_FLOAT&&(fr=St.RG16F),Ur===St.UNSIGNED_BYTE&&(fr=St.RG8)),Er===St.RGBA){const Or=kr?Bs:Is.getTransfer(Wr);Ur===St.FLOAT&&(fr=St.RGBA32F),Ur===St.HALF_FLOAT&&(fr=St.RGBA16F),Ur===St.UNSIGNED_BYTE&&(fr=Or===Fs?St.SRGB8_ALPHA8:St.RGBA8),Ur===St.UNSIGNED_SHORT_4_4_4_4&&(fr=St.RGBA4),Ur===St.UNSIGNED_SHORT_5_5_5_1&&(fr=St.RGB5_A1)}return fr!==St.R16F&&fr!==St.R32F&&fr!==St.RG16F&&fr!==St.RG32F&&fr!==St.RGBA16F&&fr!==St.RGBA32F||tt.get("EXT_color_buffer_float"),fr}function Qr(Lr,Er,Ur){return wr(Lr,Ur)===!0||Lr.isFramebufferTexture&&Lr.minFilter!==rn&&Lr.minFilter!==Wn?Math.log2(Math.max(Er.width,Er.height))+1:Lr.mipmaps!==void 0&&Lr.mipmaps.length>0?Lr.mipmaps.length:Lr.isCompressedTexture&&Array.isArray(Lr.image)?Er.mipmaps.length:1}function Fr(Lr){return Lr===rn||Lr===En||Lr===Qn?St.NEAREST:St.LINEAR}function Vr(Lr){const Er=Lr.target;Er.removeEventListener("dispose",Vr),function(Ur){const Wr=ht.get(Ur);if(Wr.__webglInit===void 0)return;const kr=Ur.source,fr=Yt.get(kr);if(fr){const Or=fr[Wr.__cacheKey];Or.usedTimes--,Or.usedTimes===0&&Hr(Ur),Object.keys(fr).length===0&&Yt.delete(kr)}ht.remove(Ur)}(Er),Er.isVideoTexture&&Xt.delete(Er)}function zr(Lr){const Er=Lr.target;Er.removeEventListener("dispose",zr),function(Ur){const Wr=Ur.texture,kr=ht.get(Ur),fr=ht.get(Wr);if(fr.__webglTexture!==void 0&&(St.deleteTexture(fr.__webglTexture),Pt.memory.textures--),Ur.depthTexture&&Ur.depthTexture.dispose(),Ur.isWebGLCubeRenderTarget)for(let Or=0;Or<6;Or++){if(Array.isArray(kr.__webglFramebuffer[Or]))for(let Nr=0;Nr<kr.__webglFramebuffer[Or].length;Nr++)St.deleteFramebuffer(kr.__webglFramebuffer[Or][Nr]);else St.deleteFramebuffer(kr.__webglFramebuffer[Or]);kr.__webglDepthbuffer&&St.deleteRenderbuffer(kr.__webglDepthbuffer[Or])}else{if(Array.isArray(kr.__webglFramebuffer))for(let Or=0;Or<kr.__webglFramebuffer.length;Or++)St.deleteFramebuffer(kr.__webglFramebuffer[Or]);else St.deleteFramebuffer(kr.__webglFramebuffer);if(kr.__webglDepthbuffer&&St.deleteRenderbuffer(kr.__webglDepthbuffer),kr.__webglMultisampledFramebuffer&&St.deleteFramebuffer(kr.__webglMultisampledFramebuffer),kr.__webglColorRenderbuffer)for(let Or=0;Or<kr.__webglColorRenderbuffer.length;Or++)kr.__webglColorRenderbuffer[Or]&&St.deleteRenderbuffer(kr.__webglColorRenderbuffer[Or]);kr.__webglDepthRenderbuffer&&St.deleteRenderbuffer(kr.__webglDepthRenderbuffer)}if(Ur.isWebGLMultipleRenderTargets)for(let Or=0,Nr=Wr.length;Or<Nr;Or++){const $r=ht.get(Wr[Or]);$r.__webglTexture&&(St.deleteTexture($r.__webglTexture),Pt.memory.textures--),ht.remove(Wr[Or])}ht.remove(Wr),ht.remove(Ur)}(Er)}function Hr(Lr){const Er=ht.get(Lr);St.deleteTexture(Er.__webglTexture);const Ur=Lr.source;delete Yt.get(Ur)[Er.__cacheKey],Pt.memory.textures--}let _n=0;function hn(Lr,Er){const Ur=ht.get(Lr);if(Lr.isVideoTexture&&function(Wr){const kr=Pt.render.frame;Xt.get(Wr)!==kr&&(Xt.set(Wr,kr),Wr.update())}(Lr),Lr.isRenderTargetTexture===!1&&Lr.version>0&&Ur.__version!==Lr.version){const Wr=Lr.image;if(Wr===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else{if(Wr.complete!==!1)return void an(Ur,Lr,Er);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}lt.bindTexture(St.TEXTURE_2D,Ur.__webglTexture,St.TEXTURE0+Er)}const Rn={[An]:St.REPEAT,[vn]:St.CLAMP_TO_EDGE,[Cn]:St.MIRRORED_REPEAT},Bn={[rn]:St.NEAREST,[En]:St.NEAREST_MIPMAP_NEAREST,[Qn]:St.NEAREST_MIPMAP_LINEAR,[Wn]:St.LINEAR,[Gn]:St.LINEAR_MIPMAP_NEAREST,[Jn]:St.LINEAR_MIPMAP_LINEAR},un={[uu]:St.NEVER,[K_]:St.ALWAYS,[pu]:St.LESS,[$_]:St.LEQUAL,[mp]:St.EQUAL,[Wl]:St.GEQUAL,[X_]:St.GREATER,[Y_]:St.NOTEQUAL};function Xr(Lr,Er,Ur){if(Ur?(St.texParameteri(Lr,St.TEXTURE_WRAP_S,Rn[Er.wrapS]),St.texParameteri(Lr,St.TEXTURE_WRAP_T,Rn[Er.wrapT]),Lr!==St.TEXTURE_3D&&Lr!==St.TEXTURE_2D_ARRAY||St.texParameteri(Lr,St.TEXTURE_WRAP_R,Rn[Er.wrapR]),St.texParameteri(Lr,St.TEXTURE_MAG_FILTER,Bn[Er.magFilter]),St.texParameteri(Lr,St.TEXTURE_MIN_FILTER,Bn[Er.minFilter])):(St.texParameteri(Lr,St.TEXTURE_WRAP_S,St.CLAMP_TO_EDGE),St.texParameteri(Lr,St.TEXTURE_WRAP_T,St.CLAMP_TO_EDGE),Lr!==St.TEXTURE_3D&&Lr!==St.TEXTURE_2D_ARRAY||St.texParameteri(Lr,St.TEXTURE_WRAP_R,St.CLAMP_TO_EDGE),Er.wrapS===vn&&Er.wrapT===vn||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),St.texParameteri(Lr,St.TEXTURE_MAG_FILTER,Fr(Er.magFilter)),St.texParameteri(Lr,St.TEXTURE_MIN_FILTER,Fr(Er.minFilter)),Er.minFilter!==rn&&Er.minFilter!==Wn&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),Er.compareFunction&&(St.texParameteri(Lr,St.TEXTURE_COMPARE_MODE,St.COMPARE_REF_TO_TEXTURE),St.texParameteri(Lr,St.TEXTURE_COMPARE_FUNC,un[Er.compareFunction])),tt.has("EXT_texture_filter_anisotropic")===!0){const Wr=tt.get("EXT_texture_filter_anisotropic");if(Er.magFilter===rn||Er.minFilter!==Qn&&Er.minFilter!==Jn||Er.type===ro&&tt.has("OES_texture_float_linear")===!1||Mt===!1&&Er.type===xa&&tt.has("OES_texture_half_float_linear")===!1)return;(Er.anisotropy>1||ht.get(Er).__currentAnisotropy)&&(St.texParameterf(Lr,Wr.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(Er.anisotropy,_t.getMaxAnisotropy())),ht.get(Er).__currentAnisotropy=Er.anisotropy)}}function Jr(Lr,Er){let Ur=!1;Lr.__webglInit===void 0&&(Lr.__webglInit=!0,Er.addEventListener("dispose",Vr));const Wr=Er.source;let kr=Yt.get(Wr);kr===void 0&&(kr={},Yt.set(Wr,kr));const fr=function(Or){const Nr=[];return Nr.push(Or.wrapS),Nr.push(Or.wrapT),Nr.push(Or.wrapR||0),Nr.push(Or.magFilter),Nr.push(Or.minFilter),Nr.push(Or.anisotropy),Nr.push(Or.internalFormat),Nr.push(Or.format),Nr.push(Or.type),Nr.push(Or.generateMipmaps),Nr.push(Or.premultiplyAlpha),Nr.push(Or.flipY),Nr.push(Or.unpackAlignment),Nr.push(Or.colorSpace),Nr.join()}(Er);if(fr!==Lr.__cacheKey){kr[fr]===void 0&&(kr[fr]={texture:St.createTexture(),usedTimes:0},Pt.memory.textures++,Ur=!0),kr[fr].usedTimes++;const Or=kr[Lr.__cacheKey];Or!==void 0&&(kr[Lr.__cacheKey].usedTimes--,Or.usedTimes===0&&Hr(Er)),Lr.__cacheKey=fr,Lr.__webglTexture=kr[fr].texture}return Ur}function an(Lr,Er,Ur){let Wr=St.TEXTURE_2D;(Er.isDataArrayTexture||Er.isCompressedArrayTexture)&&(Wr=St.TEXTURE_2D_ARRAY),Er.isData3DTexture&&(Wr=St.TEXTURE_3D);const kr=Jr(Lr,Er),fr=Er.source;lt.bindTexture(Wr,Lr.__webglTexture,St.TEXTURE0+Ur);const Or=ht.get(fr);if(fr.version!==Or.__version||kr===!0){lt.activeTexture(St.TEXTURE0+Ur);const Nr=Is.getPrimaries(Is.workingColorSpace),$r=Er.colorSpace===Ds||Er.colorSpace===so?null:Is.getPrimaries(Er.colorSpace),Kr=Er.colorSpace===Ds||Er.colorSpace===so||Nr===$r?St.NONE:St.BROWSER_DEFAULT_WEBGL;St.pixelStorei(St.UNPACK_FLIP_Y_WEBGL,Er.flipY),St.pixelStorei(St.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Er.premultiplyAlpha),St.pixelStorei(St.UNPACK_ALIGNMENT,Er.unpackAlignment),St.pixelStorei(St.UNPACK_COLORSPACE_CONVERSION_WEBGL,Kr);const wn=function($n){return!Mt&&($n.wrapS!==vn||$n.wrapT!==vn||$n.minFilter!==rn&&$n.minFilter!==Wn)}(Er)&&Ar(Er.image)===!1;let dn=tr(Er.image,wn,!1,jt);dn=cs(Er,dn);const ms=Ar(dn)||Mt,ts=bt.convert(Er.format,Er.colorSpace);let Pn,Zn=bt.convert(Er.type),qn=Mr(Er.internalFormat,ts,Zn,Er.colorSpace,Er.isVideoTexture);Xr(Wr,Er,ms);const us=Er.mipmaps,vs=Mt&&Er.isVideoTexture!==!0,Ls=Or.__version===void 0||kr===!0,Ms=Qr(Er,dn,ms);if(Er.isDepthTexture)qn=St.DEPTH_COMPONENT,Mt?qn=Er.type===ro?St.DEPTH_COMPONENT32F:Er.type===ho?St.DEPTH_COMPONENT24:Er.type===kn?St.DEPTH24_STENCIL8:St.DEPTH_COMPONENT16:Er.type===ro&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),Er.format===mo&&qn===St.DEPTH_COMPONENT&&Er.type!==Mo&&Er.type!==ho&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),Er.type=ho,Zn=bt.convert(Er.type)),Er.format===Ws&&qn===St.DEPTH_COMPONENT&&(qn=St.DEPTH_STENCIL,Er.type!==kn&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),Er.type=kn,Zn=bt.convert(Er.type))),Ls&&(vs?lt.texStorage2D(St.TEXTURE_2D,1,qn,dn.width,dn.height):lt.texImage2D(St.TEXTURE_2D,0,qn,dn.width,dn.height,0,ts,Zn,null));else if(Er.isDataTexture)if(us.length>0&&ms){vs&&Ls&&lt.texStorage2D(St.TEXTURE_2D,Ms,qn,us[0].width,us[0].height);for(let $n=0,ws=us.length;$n<ws;$n++)Pn=us[$n],vs?lt.texSubImage2D(St.TEXTURE_2D,$n,0,0,Pn.width,Pn.height,ts,Zn,Pn.data):lt.texImage2D(St.TEXTURE_2D,$n,qn,Pn.width,Pn.height,0,ts,Zn,Pn.data);Er.generateMipmaps=!1}else vs?(Ls&&lt.texStorage2D(St.TEXTURE_2D,Ms,qn,dn.width,dn.height),lt.texSubImage2D(St.TEXTURE_2D,0,0,0,dn.width,dn.height,ts,Zn,dn.data)):lt.texImage2D(St.TEXTURE_2D,0,qn,dn.width,dn.height,0,ts,Zn,dn.data);else if(Er.isCompressedTexture)if(Er.isCompressedArrayTexture){vs&&Ls&&lt.texStorage3D(St.TEXTURE_2D_ARRAY,Ms,qn,us[0].width,us[0].height,dn.depth);for(let $n=0,ws=us.length;$n<ws;$n++)Pn=us[$n],Er.format!==no?ts!==null?vs?lt.compressedTexSubImage3D(St.TEXTURE_2D_ARRAY,$n,0,0,0,Pn.width,Pn.height,dn.depth,ts,Pn.data,0,0):lt.compressedTexImage3D(St.TEXTURE_2D_ARRAY,$n,qn,Pn.width,Pn.height,dn.depth,0,Pn.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):vs?lt.texSubImage3D(St.TEXTURE_2D_ARRAY,$n,0,0,0,Pn.width,Pn.height,dn.depth,ts,Zn,Pn.data):lt.texImage3D(St.TEXTURE_2D_ARRAY,$n,qn,Pn.width,Pn.height,dn.depth,0,ts,Zn,Pn.data)}else{vs&&Ls&&lt.texStorage2D(St.TEXTURE_2D,Ms,qn,us[0].width,us[0].height);for(let $n=0,ws=us.length;$n<ws;$n++)Pn=us[$n],Er.format!==no?ts!==null?vs?lt.compressedTexSubImage2D(St.TEXTURE_2D,$n,0,0,Pn.width,Pn.height,ts,Pn.data):lt.compressedTexImage2D(St.TEXTURE_2D,$n,qn,Pn.width,Pn.height,0,Pn.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):vs?lt.texSubImage2D(St.TEXTURE_2D,$n,0,0,Pn.width,Pn.height,ts,Zn,Pn.data):lt.texImage2D(St.TEXTURE_2D,$n,qn,Pn.width,Pn.height,0,ts,Zn,Pn.data)}else if(Er.isDataArrayTexture)vs?(Ls&&lt.texStorage3D(St.TEXTURE_2D_ARRAY,Ms,qn,dn.width,dn.height,dn.depth),lt.texSubImage3D(St.TEXTURE_2D_ARRAY,0,0,0,0,dn.width,dn.height,dn.depth,ts,Zn,dn.data)):lt.texImage3D(St.TEXTURE_2D_ARRAY,0,qn,dn.width,dn.height,dn.depth,0,ts,Zn,dn.data);else if(Er.isData3DTexture)vs?(Ls&&lt.texStorage3D(St.TEXTURE_3D,Ms,qn,dn.width,dn.height,dn.depth),lt.texSubImage3D(St.TEXTURE_3D,0,0,0,0,dn.width,dn.height,dn.depth,ts,Zn,dn.data)):lt.texImage3D(St.TEXTURE_3D,0,qn,dn.width,dn.height,dn.depth,0,ts,Zn,dn.data);else if(Er.isFramebufferTexture){if(Ls)if(vs)lt.texStorage2D(St.TEXTURE_2D,Ms,qn,dn.width,dn.height);else{let $n=dn.width,ws=dn.height;for(let Jo=0;Jo<Ms;Jo++)lt.texImage2D(St.TEXTURE_2D,Jo,qn,$n,ws,0,ts,Zn,null),$n>>=1,ws>>=1}}else if(us.length>0&&ms){vs&&Ls&&lt.texStorage2D(St.TEXTURE_2D,Ms,qn,us[0].width,us[0].height);for(let $n=0,ws=us.length;$n<ws;$n++)Pn=us[$n],vs?lt.texSubImage2D(St.TEXTURE_2D,$n,0,0,ts,Zn,Pn):lt.texImage2D(St.TEXTURE_2D,$n,qn,ts,Zn,Pn);Er.generateMipmaps=!1}else vs?(Ls&&lt.texStorage2D(St.TEXTURE_2D,Ms,qn,dn.width,dn.height),lt.texSubImage2D(St.TEXTURE_2D,0,0,0,ts,Zn,dn)):lt.texImage2D(St.TEXTURE_2D,0,qn,ts,Zn,dn);wr(Er,ms)&&br(Wr),Or.__version=fr.version,Er.onUpdate&&Er.onUpdate(Er)}Lr.__version=Er.version}function sn(Lr,Er,Ur,Wr,kr,fr){const Or=bt.convert(Ur.format,Ur.colorSpace),Nr=bt.convert(Ur.type),$r=Mr(Ur.internalFormat,Or,Nr,Ur.colorSpace);if(!ht.get(Er).__hasExternalTextures){const Kr=Math.max(1,Er.width>>fr),wn=Math.max(1,Er.height>>fr);kr===St.TEXTURE_3D||kr===St.TEXTURE_2D_ARRAY?lt.texImage3D(kr,fr,$r,Kr,wn,Er.depth,0,Or,Nr,null):lt.texImage2D(kr,fr,$r,Kr,wn,0,Or,Nr,null)}lt.bindFramebuffer(St.FRAMEBUFFER,Lr),Un(Er)?Qt.framebufferTexture2DMultisampleEXT(St.FRAMEBUFFER,Wr,kr,ht.get(Ur).__webglTexture,0,Yn(Er)):(kr===St.TEXTURE_2D||kr>=St.TEXTURE_CUBE_MAP_POSITIVE_X&&kr<=St.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&St.framebufferTexture2D(St.FRAMEBUFFER,Wr,kr,ht.get(Ur).__webglTexture,fr),lt.bindFramebuffer(St.FRAMEBUFFER,null)}function Fn(Lr,Er,Ur){if(St.bindRenderbuffer(St.RENDERBUFFER,Lr),Er.depthBuffer&&!Er.stencilBuffer){let Wr=Mt===!0?St.DEPTH_COMPONENT24:St.DEPTH_COMPONENT16;if(Ur||Un(Er)){const kr=Er.depthTexture;kr&&kr.isDepthTexture&&(kr.type===ro?Wr=St.DEPTH_COMPONENT32F:kr.type===ho&&(Wr=St.DEPTH_COMPONENT24));const fr=Yn(Er);Un(Er)?Qt.renderbufferStorageMultisampleEXT(St.RENDERBUFFER,fr,Wr,Er.width,Er.height):St.renderbufferStorageMultisample(St.RENDERBUFFER,fr,Wr,Er.width,Er.height)}else St.renderbufferStorage(St.RENDERBUFFER,Wr,Er.width,Er.height);St.framebufferRenderbuffer(St.FRAMEBUFFER,St.DEPTH_ATTACHMENT,St.RENDERBUFFER,Lr)}else if(Er.depthBuffer&&Er.stencilBuffer){const Wr=Yn(Er);Ur&&Un(Er)===!1?St.renderbufferStorageMultisample(St.RENDERBUFFER,Wr,St.DEPTH24_STENCIL8,Er.width,Er.height):Un(Er)?Qt.renderbufferStorageMultisampleEXT(St.RENDERBUFFER,Wr,St.DEPTH24_STENCIL8,Er.width,Er.height):St.renderbufferStorage(St.RENDERBUFFER,St.DEPTH_STENCIL,Er.width,Er.height),St.framebufferRenderbuffer(St.FRAMEBUFFER,St.DEPTH_STENCIL_ATTACHMENT,St.RENDERBUFFER,Lr)}else{const Wr=Er.isWebGLMultipleRenderTargets===!0?Er.texture:[Er.texture];for(let kr=0;kr<Wr.length;kr++){const fr=Wr[kr],Or=bt.convert(fr.format,fr.colorSpace),Nr=bt.convert(fr.type),$r=Mr(fr.internalFormat,Or,Nr,fr.colorSpace),Kr=Yn(Er);Ur&&Un(Er)===!1?St.renderbufferStorageMultisample(St.RENDERBUFFER,Kr,$r,Er.width,Er.height):Un(Er)?Qt.renderbufferStorageMultisampleEXT(St.RENDERBUFFER,Kr,$r,Er.width,Er.height):St.renderbufferStorage(St.RENDERBUFFER,$r,Er.width,Er.height)}}St.bindRenderbuffer(St.RENDERBUFFER,null)}function rs(Lr){const Er=ht.get(Lr),Ur=Lr.isWebGLCubeRenderTarget===!0;if(Lr.depthTexture&&!Er.__autoAllocateDepthBuffer){if(Ur)throw new Error("target.depthTexture not supported in Cube render targets");(function(Wr,kr){if(kr&&kr.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(lt.bindFramebuffer(St.FRAMEBUFFER,Wr),!kr.depthTexture||!kr.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");ht.get(kr.depthTexture).__webglTexture&&kr.depthTexture.image.width===kr.width&&kr.depthTexture.image.height===kr.height||(kr.depthTexture.image.width=kr.width,kr.depthTexture.image.height=kr.height,kr.depthTexture.needsUpdate=!0),hn(kr.depthTexture,0);const fr=ht.get(kr.depthTexture).__webglTexture,Or=Yn(kr);if(kr.depthTexture.format===mo)Un(kr)?Qt.framebufferTexture2DMultisampleEXT(St.FRAMEBUFFER,St.DEPTH_ATTACHMENT,St.TEXTURE_2D,fr,0,Or):St.framebufferTexture2D(St.FRAMEBUFFER,St.DEPTH_ATTACHMENT,St.TEXTURE_2D,fr,0);else{if(kr.depthTexture.format!==Ws)throw new Error("Unknown depthTexture format");Un(kr)?Qt.framebufferTexture2DMultisampleEXT(St.FRAMEBUFFER,St.DEPTH_STENCIL_ATTACHMENT,St.TEXTURE_2D,fr,0,Or):St.framebufferTexture2D(St.FRAMEBUFFER,St.DEPTH_STENCIL_ATTACHMENT,St.TEXTURE_2D,fr,0)}})(Er.__webglFramebuffer,Lr)}else if(Ur){Er.__webglDepthbuffer=[];for(let Wr=0;Wr<6;Wr++)lt.bindFramebuffer(St.FRAMEBUFFER,Er.__webglFramebuffer[Wr]),Er.__webglDepthbuffer[Wr]=St.createRenderbuffer(),Fn(Er.__webglDepthbuffer[Wr],Lr,!1)}else lt.bindFramebuffer(St.FRAMEBUFFER,Er.__webglFramebuffer),Er.__webglDepthbuffer=St.createRenderbuffer(),Fn(Er.__webglDepthbuffer,Lr,!1);lt.bindFramebuffer(St.FRAMEBUFFER,null)}function Yn(Lr){return Math.min(Wt,Lr.samples)}function Un(Lr){const Er=ht.get(Lr);return Mt&&Lr.samples>0&&tt.has("WEBGL_multisampled_render_to_texture")===!0&&Er.__useRenderToTexture!==!1}function cs(Lr,Er){const Ur=Lr.colorSpace,Wr=Lr.format,kr=Lr.type;return Lr.isCompressedTexture===!0||Lr.isVideoTexture===!0||Lr.format===_d||Ur!==qs&&Ur!==Ds&&(Is.getTransfer(Ur)===Fs?Mt===!1?tt.has("EXT_sRGB")===!0&&Wr===no?(Lr.format=_d,Lr.minFilter=Wn,Lr.generateMipmaps=!1):Er=t_.sRGBToLinear(Er):Wr===no&&kr===Gs||console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):Ur===so||console.error("THREE.WebGLTextures: Unsupported texture color space:",Ur)),Er}this.allocateTextureUnit=function(){const Lr=_n;return Lr>=Lt&&console.warn("THREE.WebGLTextures: Trying to use "+Lr+" texture units while this GPU supports only "+Lt),_n+=1,Lr},this.resetTextureUnits=function(){_n=0},this.setTexture2D=hn,this.setTexture2DArray=function(Lr,Er){const Ur=ht.get(Lr);Lr.version>0&&Ur.__version!==Lr.version?an(Ur,Lr,Er):lt.bindTexture(St.TEXTURE_2D_ARRAY,Ur.__webglTexture,St.TEXTURE0+Er)},this.setTexture3D=function(Lr,Er){const Ur=ht.get(Lr);Lr.version>0&&Ur.__version!==Lr.version?an(Ur,Lr,Er):lt.bindTexture(St.TEXTURE_3D,Ur.__webglTexture,St.TEXTURE0+Er)},this.setTextureCube=function(Lr,Er){const Ur=ht.get(Lr);Lr.version>0&&Ur.__version!==Lr.version?function(Wr,kr,fr){if(kr.image.length!==6)return;const Or=Jr(Wr,kr),Nr=kr.source;lt.bindTexture(St.TEXTURE_CUBE_MAP,Wr.__webglTexture,St.TEXTURE0+fr);const $r=ht.get(Nr);if(Nr.version!==$r.__version||Or===!0){lt.activeTexture(St.TEXTURE0+fr);const Kr=Is.getPrimaries(Is.workingColorSpace),wn=kr.colorSpace===Ds||kr.colorSpace===so?null:Is.getPrimaries(kr.colorSpace),dn=kr.colorSpace===Ds||kr.colorSpace===so||Kr===wn?St.NONE:St.BROWSER_DEFAULT_WEBGL;St.pixelStorei(St.UNPACK_FLIP_Y_WEBGL,kr.flipY),St.pixelStorei(St.UNPACK_PREMULTIPLY_ALPHA_WEBGL,kr.premultiplyAlpha),St.pixelStorei(St.UNPACK_ALIGNMENT,kr.unpackAlignment),St.pixelStorei(St.UNPACK_COLORSPACE_CONVERSION_WEBGL,dn);const ms=kr.isCompressedTexture||kr.image[0].isCompressedTexture,ts=kr.image[0]&&kr.image[0].isDataTexture,Pn=[];for(let ps=0;ps<6;ps++)Pn[ps]=ms||ts?ts?kr.image[ps].image:kr.image[ps]:tr(kr.image[ps],!1,!0,Nt),Pn[ps]=cs(kr,Pn[ps]);const Zn=Pn[0],qn=Ar(Zn)||Mt,us=bt.convert(kr.format,kr.colorSpace),vs=bt.convert(kr.type),Ls=Mr(kr.internalFormat,us,vs,kr.colorSpace),Ms=Mt&&kr.isVideoTexture!==!0,$n=$r.__version===void 0||Or===!0;let ws,Jo=Qr(kr,Zn,qn);if(Xr(St.TEXTURE_CUBE_MAP,kr,qn),ms){Ms&&$n&&lt.texStorage2D(St.TEXTURE_CUBE_MAP,Jo,Ls,Zn.width,Zn.height);for(let ps=0;ps<6;ps++){ws=Pn[ps].mipmaps;for(let zs=0;zs<ws.length;zs++){const Es=ws[zs];kr.format!==no?us!==null?Ms?lt.compressedTexSubImage2D(St.TEXTURE_CUBE_MAP_POSITIVE_X+ps,zs,0,0,Es.width,Es.height,us,Es.data):lt.compressedTexImage2D(St.TEXTURE_CUBE_MAP_POSITIVE_X+ps,zs,Ls,Es.width,Es.height,0,Es.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):Ms?lt.texSubImage2D(St.TEXTURE_CUBE_MAP_POSITIVE_X+ps,zs,0,0,Es.width,Es.height,us,vs,Es.data):lt.texImage2D(St.TEXTURE_CUBE_MAP_POSITIVE_X+ps,zs,Ls,Es.width,Es.height,0,us,vs,Es.data)}}}else{ws=kr.mipmaps,Ms&&$n&&(ws.length>0&&Jo++,lt.texStorage2D(St.TEXTURE_CUBE_MAP,Jo,Ls,Pn[0].width,Pn[0].height));for(let ps=0;ps<6;ps++)if(ts){Ms?lt.texSubImage2D(St.TEXTURE_CUBE_MAP_POSITIVE_X+ps,0,0,0,Pn[ps].width,Pn[ps].height,us,vs,Pn[ps].data):lt.texImage2D(St.TEXTURE_CUBE_MAP_POSITIVE_X+ps,0,Ls,Pn[ps].width,Pn[ps].height,0,us,vs,Pn[ps].data);for(let zs=0;zs<ws.length;zs++){const Es=ws[zs].image[ps].image;Ms?lt.texSubImage2D(St.TEXTURE_CUBE_MAP_POSITIVE_X+ps,zs+1,0,0,Es.width,Es.height,us,vs,Es.data):lt.texImage2D(St.TEXTURE_CUBE_MAP_POSITIVE_X+ps,zs+1,Ls,Es.width,Es.height,0,us,vs,Es.data)}}else{Ms?lt.texSubImage2D(St.TEXTURE_CUBE_MAP_POSITIVE_X+ps,0,0,0,us,vs,Pn[ps]):lt.texImage2D(St.TEXTURE_CUBE_MAP_POSITIVE_X+ps,0,Ls,us,vs,Pn[ps]);for(let zs=0;zs<ws.length;zs++){const Es=ws[zs];Ms?lt.texSubImage2D(St.TEXTURE_CUBE_MAP_POSITIVE_X+ps,zs+1,0,0,us,vs,Es.image[ps]):lt.texImage2D(St.TEXTURE_CUBE_MAP_POSITIVE_X+ps,zs+1,Ls,us,vs,Es.image[ps])}}}wr(kr,qn)&&br(St.TEXTURE_CUBE_MAP),$r.__version=Nr.version,kr.onUpdate&&kr.onUpdate(kr)}Wr.__version=kr.version}(Ur,Lr,Er):lt.bindTexture(St.TEXTURE_CUBE_MAP,Ur.__webglTexture,St.TEXTURE0+Er)},this.rebindTextures=function(Lr,Er,Ur){const Wr=ht.get(Lr);Er!==void 0&&sn(Wr.__webglFramebuffer,Lr,Lr.texture,St.COLOR_ATTACHMENT0,St.TEXTURE_2D,0),Ur!==void 0&&rs(Lr)},this.setupRenderTarget=function(Lr){const Er=Lr.texture,Ur=ht.get(Lr),Wr=ht.get(Er);Lr.addEventListener("dispose",zr),Lr.isWebGLMultipleRenderTargets!==!0&&(Wr.__webglTexture===void 0&&(Wr.__webglTexture=St.createTexture()),Wr.__version=Er.version,Pt.memory.textures++);const kr=Lr.isWebGLCubeRenderTarget===!0,fr=Lr.isWebGLMultipleRenderTargets===!0,Or=Ar(Lr)||Mt;if(kr){Ur.__webglFramebuffer=[];for(let Nr=0;Nr<6;Nr++)if(Mt&&Er.mipmaps&&Er.mipmaps.length>0){Ur.__webglFramebuffer[Nr]=[];for(let $r=0;$r<Er.mipmaps.length;$r++)Ur.__webglFramebuffer[Nr][$r]=St.createFramebuffer()}else Ur.__webglFramebuffer[Nr]=St.createFramebuffer()}else{if(Mt&&Er.mipmaps&&Er.mipmaps.length>0){Ur.__webglFramebuffer=[];for(let Nr=0;Nr<Er.mipmaps.length;Nr++)Ur.__webglFramebuffer[Nr]=St.createFramebuffer()}else Ur.__webglFramebuffer=St.createFramebuffer();if(fr)if(_t.drawBuffers){const Nr=Lr.texture;for(let $r=0,Kr=Nr.length;$r<Kr;$r++){const wn=ht.get(Nr[$r]);wn.__webglTexture===void 0&&(wn.__webglTexture=St.createTexture(),Pt.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(Mt&&Lr.samples>0&&Un(Lr)===!1){const Nr=fr?Er:[Er];Ur.__webglMultisampledFramebuffer=St.createFramebuffer(),Ur.__webglColorRenderbuffer=[],lt.bindFramebuffer(St.FRAMEBUFFER,Ur.__webglMultisampledFramebuffer);for(let $r=0;$r<Nr.length;$r++){const Kr=Nr[$r];Ur.__webglColorRenderbuffer[$r]=St.createRenderbuffer(),St.bindRenderbuffer(St.RENDERBUFFER,Ur.__webglColorRenderbuffer[$r]);const wn=bt.convert(Kr.format,Kr.colorSpace),dn=bt.convert(Kr.type),ms=Mr(Kr.internalFormat,wn,dn,Kr.colorSpace,Lr.isXRRenderTarget===!0),ts=Yn(Lr);St.renderbufferStorageMultisample(St.RENDERBUFFER,ts,ms,Lr.width,Lr.height),St.framebufferRenderbuffer(St.FRAMEBUFFER,St.COLOR_ATTACHMENT0+$r,St.RENDERBUFFER,Ur.__webglColorRenderbuffer[$r])}St.bindRenderbuffer(St.RENDERBUFFER,null),Lr.depthBuffer&&(Ur.__webglDepthRenderbuffer=St.createRenderbuffer(),Fn(Ur.__webglDepthRenderbuffer,Lr,!0)),lt.bindFramebuffer(St.FRAMEBUFFER,null)}}if(kr){lt.bindTexture(St.TEXTURE_CUBE_MAP,Wr.__webglTexture),Xr(St.TEXTURE_CUBE_MAP,Er,Or);for(let Nr=0;Nr<6;Nr++)if(Mt&&Er.mipmaps&&Er.mipmaps.length>0)for(let $r=0;$r<Er.mipmaps.length;$r++)sn(Ur.__webglFramebuffer[Nr][$r],Lr,Er,St.COLOR_ATTACHMENT0,St.TEXTURE_CUBE_MAP_POSITIVE_X+Nr,$r);else sn(Ur.__webglFramebuffer[Nr],Lr,Er,St.COLOR_ATTACHMENT0,St.TEXTURE_CUBE_MAP_POSITIVE_X+Nr,0);wr(Er,Or)&&br(St.TEXTURE_CUBE_MAP),lt.unbindTexture()}else if(fr){const Nr=Lr.texture;for(let $r=0,Kr=Nr.length;$r<Kr;$r++){const wn=Nr[$r],dn=ht.get(wn);lt.bindTexture(St.TEXTURE_2D,dn.__webglTexture),Xr(St.TEXTURE_2D,wn,Or),sn(Ur.__webglFramebuffer,Lr,wn,St.COLOR_ATTACHMENT0+$r,St.TEXTURE_2D,0),wr(wn,Or)&&br(St.TEXTURE_2D)}lt.unbindTexture()}else{let Nr=St.TEXTURE_2D;if((Lr.isWebGL3DRenderTarget||Lr.isWebGLArrayRenderTarget)&&(Mt?Nr=Lr.isWebGL3DRenderTarget?St.TEXTURE_3D:St.TEXTURE_2D_ARRAY:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),lt.bindTexture(Nr,Wr.__webglTexture),Xr(Nr,Er,Or),Mt&&Er.mipmaps&&Er.mipmaps.length>0)for(let $r=0;$r<Er.mipmaps.length;$r++)sn(Ur.__webglFramebuffer[$r],Lr,Er,St.COLOR_ATTACHMENT0,Nr,$r);else sn(Ur.__webglFramebuffer,Lr,Er,St.COLOR_ATTACHMENT0,Nr,0);wr(Er,Or)&&br(Nr),lt.unbindTexture()}Lr.depthBuffer&&rs(Lr)},this.updateRenderTargetMipmap=function(Lr){const Er=Ar(Lr)||Mt,Ur=Lr.isWebGLMultipleRenderTargets===!0?Lr.texture:[Lr.texture],Wr=Lr.isWebGLCubeRenderTarget?St.TEXTURE_CUBE_MAP:St.TEXTURE_2D;for(let kr=0,fr=Ur.length;kr<fr;kr++){const Or=Ur[kr],Nr=ht.get(Or),$r=Nr.__webglTexture;Nr.__version!==Or.version&&(lt.bindTexture(Wr,$r),Xr(Wr,Or,Er),lt.unbindTexture(),Nr.__version=Or.version),wr(Or,Er)&&(lt.bindTexture(Wr,$r),br(Wr),lt.unbindTexture())}},this.updateMultisampleRenderTarget=function(Lr){if(Mt&&Lr.samples>0&&Un(Lr)===!1){const Er=Lr.isWebGLMultipleRenderTargets?Lr.texture:[Lr.texture],Ur=Lr.width,Wr=Lr.height;let kr=St.COLOR_BUFFER_BIT;const fr=[],Or=Lr.stencilBuffer?St.DEPTH_STENCIL_ATTACHMENT:St.DEPTH_ATTACHMENT,Nr=ht.get(Lr),$r=Lr.isWebGLMultipleRenderTargets===!0;if($r)for(let Kr=0;Kr<Er.length;Kr++)lt.bindFramebuffer(St.FRAMEBUFFER,Nr.__webglMultisampledFramebuffer),St.framebufferRenderbuffer(St.FRAMEBUFFER,St.COLOR_ATTACHMENT0+Kr,St.RENDERBUFFER,null),lt.bindFramebuffer(St.FRAMEBUFFER,Nr.__webglFramebuffer),St.framebufferTexture2D(St.DRAW_FRAMEBUFFER,St.COLOR_ATTACHMENT0+Kr,St.TEXTURE_2D,null,0);lt.bindFramebuffer(St.READ_FRAMEBUFFER,Nr.__webglMultisampledFramebuffer),lt.bindFramebuffer(St.DRAW_FRAMEBUFFER,Nr.__webglFramebuffer);for(let Kr=0;Kr<Er.length;Kr++){fr.push(St.COLOR_ATTACHMENT0+Kr),Lr.depthBuffer&&fr.push(Or);const wn=Nr.__ignoreDepthValues!==void 0&&Nr.__ignoreDepthValues;if(wn===!1&&(Lr.depthBuffer&&(kr|=St.DEPTH_BUFFER_BIT),Lr.stencilBuffer&&(kr|=St.STENCIL_BUFFER_BIT)),$r&&St.framebufferRenderbuffer(St.READ_FRAMEBUFFER,St.COLOR_ATTACHMENT0,St.RENDERBUFFER,Nr.__webglColorRenderbuffer[Kr]),wn===!0&&(St.invalidateFramebuffer(St.READ_FRAMEBUFFER,[Or]),St.invalidateFramebuffer(St.DRAW_FRAMEBUFFER,[Or])),$r){const dn=ht.get(Er[Kr]).__webglTexture;St.framebufferTexture2D(St.DRAW_FRAMEBUFFER,St.COLOR_ATTACHMENT0,St.TEXTURE_2D,dn,0)}St.blitFramebuffer(0,0,Ur,Wr,0,0,Ur,Wr,kr,St.NEAREST),qt&&St.invalidateFramebuffer(St.READ_FRAMEBUFFER,fr)}if(lt.bindFramebuffer(St.READ_FRAMEBUFFER,null),lt.bindFramebuffer(St.DRAW_FRAMEBUFFER,null),$r)for(let Kr=0;Kr<Er.length;Kr++){lt.bindFramebuffer(St.FRAMEBUFFER,Nr.__webglMultisampledFramebuffer),St.framebufferRenderbuffer(St.FRAMEBUFFER,St.COLOR_ATTACHMENT0+Kr,St.RENDERBUFFER,Nr.__webglColorRenderbuffer[Kr]);const wn=ht.get(Er[Kr]).__webglTexture;lt.bindFramebuffer(St.FRAMEBUFFER,Nr.__webglFramebuffer),St.framebufferTexture2D(St.DRAW_FRAMEBUFFER,St.COLOR_ATTACHMENT0+Kr,St.TEXTURE_2D,wn,0)}lt.bindFramebuffer(St.DRAW_FRAMEBUFFER,Nr.__webglMultisampledFramebuffer)}},this.setupDepthRenderbuffer=rs,this.setupFrameBufferTexture=sn,this.useMultisampledRTT=Un}function fx(St,tt,lt){const ht=lt.isWebGL2;return{convert:function(_t,bt=Ds){let Pt;const Mt=Is.getTransfer(bt);if(_t===Gs)return St.UNSIGNED_BYTE;if(_t===io)return St.UNSIGNED_SHORT_4_4_4_4;if(_t===Ml)return St.UNSIGNED_SHORT_5_5_5_1;if(_t===$s)return St.BYTE;if(_t===to)return St.SHORT;if(_t===Mo)return St.UNSIGNED_SHORT;if(_t===rp)return St.INT;if(_t===ho)return St.UNSIGNED_INT;if(_t===ro)return St.FLOAT;if(_t===xa)return ht?St.HALF_FLOAT:(Pt=tt.get("OES_texture_half_float"),Pt!==null?Pt.HALF_FLOAT_OES:null);if(_t===Nn)return St.ALPHA;if(_t===no)return St.RGBA;if(_t===Ss)return St.LUMINANCE;if(_t===Il)return St.LUMINANCE_ALPHA;if(_t===mo)return St.DEPTH_COMPONENT;if(_t===Ws)return St.DEPTH_STENCIL;if(_t===_d)return Pt=tt.get("EXT_sRGB"),Pt!==null?Pt.SRGB_ALPHA_EXT:null;if(_t===As)return St.RED;if(_t===Ps)return St.RED_INTEGER;if(_t===Fo)return St.RG;if(_t===Io)return St.RG_INTEGER;if(_t===xo)return St.RGBA_INTEGER;if(_t===yl||_t===ip||_t===jp||_t===Gp)if(Mt===Fs){if(Pt=tt.get("WEBGL_compressed_texture_s3tc_srgb"),Pt===null)return null;if(_t===yl)return Pt.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(_t===ip)return Pt.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(_t===jp)return Pt.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(_t===Gp)return Pt.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(Pt=tt.get("WEBGL_compressed_texture_s3tc"),Pt===null)return null;if(_t===yl)return Pt.COMPRESSED_RGB_S3TC_DXT1_EXT;if(_t===ip)return Pt.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(_t===jp)return Pt.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(_t===Gp)return Pt.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(_t===Bm||_t===zp||_t===Lm||_t===Om){if(Pt=tt.get("WEBGL_compressed_texture_pvrtc"),Pt===null)return null;if(_t===Bm)return Pt.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(_t===zp)return Pt.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(_t===Lm)return Pt.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(_t===Om)return Pt.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(_t===V_)return Pt=tt.get("WEBGL_compressed_texture_etc1"),Pt!==null?Pt.COMPRESSED_RGB_ETC1_WEBGL:null;if(_t===nu||_t===Qo){if(Pt=tt.get("WEBGL_compressed_texture_etc"),Pt===null)return null;if(_t===nu)return Mt===Fs?Pt.COMPRESSED_SRGB8_ETC2:Pt.COMPRESSED_RGB8_ETC2;if(_t===Qo)return Mt===Fs?Pt.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:Pt.COMPRESSED_RGBA8_ETC2_EAC}if(_t===Hl||_t===su||_t===Vp||_t===Cu||_t===np||_t===Nm||_t===au||_t===Hp||_t===Fm||_t===Qp||_t===Wp||_t===Um||_t===Pu||_t===qp){if(Pt=tt.get("WEBGL_compressed_texture_astc"),Pt===null)return null;if(_t===Hl)return Mt===Fs?Pt.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:Pt.COMPRESSED_RGBA_ASTC_4x4_KHR;if(_t===su)return Mt===Fs?Pt.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:Pt.COMPRESSED_RGBA_ASTC_5x4_KHR;if(_t===Vp)return Mt===Fs?Pt.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:Pt.COMPRESSED_RGBA_ASTC_5x5_KHR;if(_t===Cu)return Mt===Fs?Pt.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:Pt.COMPRESSED_RGBA_ASTC_6x5_KHR;if(_t===np)return Mt===Fs?Pt.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:Pt.COMPRESSED_RGBA_ASTC_6x6_KHR;if(_t===Nm)return Mt===Fs?Pt.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:Pt.COMPRESSED_RGBA_ASTC_8x5_KHR;if(_t===au)return Mt===Fs?Pt.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:Pt.COMPRESSED_RGBA_ASTC_8x6_KHR;if(_t===Hp)return Mt===Fs?Pt.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:Pt.COMPRESSED_RGBA_ASTC_8x8_KHR;if(_t===Fm)return Mt===Fs?Pt.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:Pt.COMPRESSED_RGBA_ASTC_10x5_KHR;if(_t===Qp)return Mt===Fs?Pt.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:Pt.COMPRESSED_RGBA_ASTC_10x6_KHR;if(_t===Wp)return Mt===Fs?Pt.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:Pt.COMPRESSED_RGBA_ASTC_10x8_KHR;if(_t===Um)return Mt===Fs?Pt.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:Pt.COMPRESSED_RGBA_ASTC_10x10_KHR;if(_t===Pu)return Mt===Fs?Pt.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:Pt.COMPRESSED_RGBA_ASTC_12x10_KHR;if(_t===qp)return Mt===Fs?Pt.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:Pt.COMPRESSED_RGBA_ASTC_12x12_KHR}if(_t===sp||_t===jm||_t===Gm){if(Pt=tt.get("EXT_texture_compression_bptc"),Pt===null)return null;if(_t===sp)return Mt===Fs?Pt.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:Pt.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(_t===jm)return Pt.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(_t===Gm)return Pt.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}if(_t===H_||_t===zm||_t===Vm||_t===ap){if(Pt=tt.get("EXT_texture_compression_rgtc"),Pt===null)return null;if(_t===sp)return Pt.COMPRESSED_RED_RGTC1_EXT;if(_t===zm)return Pt.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(_t===Vm)return Pt.COMPRESSED_RED_GREEN_RGTC2_EXT;if(_t===ap)return Pt.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}return _t===kn?ht?St.UNSIGNED_INT_24_8:(Pt=tt.get("WEBGL_depth_texture"),Pt!==null?Pt.UNSIGNED_INT_24_8_WEBGL:null):St[_t]!==void 0?St[_t]:null}}}class vx extends bo{constructor(tt=[]){super(),this.isArrayCamera=!0,this.cameras=tt}}class Am extends Cs{constructor(){super(),this.isGroup=!0,this.type="Group"}}const tE={type:"move"};class W0{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new Am,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new Am,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new Sr,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new Sr),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new Am,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new Sr,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new Sr),this._grip}dispatchEvent(tt){return this._targetRay!==null&&this._targetRay.dispatchEvent(tt),this._grip!==null&&this._grip.dispatchEvent(tt),this._hand!==null&&this._hand.dispatchEvent(tt),this}connect(tt){if(tt&&tt.hand){const lt=this._hand;if(lt)for(const ht of tt.hand.values())this._getHandJoint(lt,ht)}return this.dispatchEvent({type:"connected",data:tt}),this}disconnect(tt){return this.dispatchEvent({type:"disconnected",data:tt}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(tt,lt,ht){let _t=null,bt=null,Pt=null;const Mt=this._targetRay,Lt=this._grip,Nt=this._hand;if(tt&&lt.session.visibilityState!=="visible-blurred"){if(Nt&&tt.hand){Pt=!0;for(const Zt of tt.hand.values()){const Yt=lt.getJointPose(Zt,ht),ar=this._getHandJoint(Nt,Zt);Yt!==null&&(ar.matrix.fromArray(Yt.transform.matrix),ar.matrix.decompose(ar.position,ar.rotation,ar.scale),ar.matrixWorldNeedsUpdate=!0,ar.jointRadius=Yt.radius),ar.visible=Yt!==null}const jt=Nt.joints["index-finger-tip"],Wt=Nt.joints["thumb-tip"],Qt=jt.position.distanceTo(Wt.position),qt=.02,Xt=.005;Nt.inputState.pinching&&Qt>qt+Xt?(Nt.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:tt.handedness,target:this})):!Nt.inputState.pinching&&Qt<=qt-Xt&&(Nt.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:tt.handedness,target:this}))}else Lt!==null&&tt.gripSpace&&(bt=lt.getPose(tt.gripSpace,ht),bt!==null&&(Lt.matrix.fromArray(bt.transform.matrix),Lt.matrix.decompose(Lt.position,Lt.rotation,Lt.scale),Lt.matrixWorldNeedsUpdate=!0,bt.linearVelocity?(Lt.hasLinearVelocity=!0,Lt.linearVelocity.copy(bt.linearVelocity)):Lt.hasLinearVelocity=!1,bt.angularVelocity?(Lt.hasAngularVelocity=!0,Lt.angularVelocity.copy(bt.angularVelocity)):Lt.hasAngularVelocity=!1));Mt!==null&&(_t=lt.getPose(tt.targetRaySpace,ht),_t===null&&bt!==null&&(_t=bt),_t!==null&&(Mt.matrix.fromArray(_t.transform.matrix),Mt.matrix.decompose(Mt.position,Mt.rotation,Mt.scale),Mt.matrixWorldNeedsUpdate=!0,_t.linearVelocity?(Mt.hasLinearVelocity=!0,Mt.linearVelocity.copy(_t.linearVelocity)):Mt.hasLinearVelocity=!1,_t.angularVelocity?(Mt.hasAngularVelocity=!0,Mt.angularVelocity.copy(_t.angularVelocity)):Mt.hasAngularVelocity=!1,this.dispatchEvent(tE)))}return Mt!==null&&(Mt.visible=_t!==null),Lt!==null&&(Lt.visible=bt!==null),Nt!==null&&(Nt.visible=Pt!==null),this}_getHandJoint(tt,lt){if(tt.joints[lt.jointName]===void 0){const ht=new Am;ht.matrixAutoUpdate=!1,ht.visible=!1,tt.joints[lt.jointName]=ht,tt.add(ht)}return tt.joints[lt.jointName]}}class yx extends js{constructor(tt,lt,ht,_t,bt,Pt,Mt,Lt,Nt,jt){if((jt=jt!==void 0?jt:mo)!==mo&&jt!==Ws)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");ht===void 0&&jt===mo&&(ht=ho),ht===void 0&&jt===Ws&&(ht=kn),super(null,_t,bt,Pt,Mt,Lt,jt,ht,Nt),this.isDepthTexture=!0,this.image={width:tt,height:lt},this.magFilter=Mt!==void 0?Mt:rn,this.minFilter=Lt!==void 0?Lt:rn,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(tt){return super.copy(tt),this.compareFunction=tt.compareFunction,this}toJSON(tt){const lt=super.toJSON(tt);return this.compareFunction!==null&&(lt.compareFunction=this.compareFunction),lt}}class rE extends go{constructor(tt,lt){super();const ht=this;let _t=null,bt=1,Pt=null,Mt="local-floor",Lt=1,Nt=null,jt=null,Wt=null,Qt=null,qt=null,Xt=null;const Zt=lt.getContextAttributes();let Yt=null,ar=null;const er=[],tr=[],Ar=new bo;Ar.layers.enable(1),Ar.viewport=new Rs;const wr=new bo;wr.layers.enable(2),wr.viewport=new Rs;const br=[Ar,wr],Mr=new vx;Mr.layers.enable(1),Mr.layers.enable(2);let Qr=null,Fr=null;function Vr(Xr){const Jr=tr.indexOf(Xr.inputSource);if(Jr===-1)return;const an=er[Jr];an!==void 0&&(an.update(Xr.inputSource,Xr.frame,Nt||Pt),an.dispatchEvent({type:Xr.type,data:Xr.inputSource}))}function zr(){_t.removeEventListener("select",Vr),_t.removeEventListener("selectstart",Vr),_t.removeEventListener("selectend",Vr),_t.removeEventListener("squeeze",Vr),_t.removeEventListener("squeezestart",Vr),_t.removeEventListener("squeezeend",Vr),_t.removeEventListener("end",zr),_t.removeEventListener("inputsourceschange",Hr);for(let Xr=0;Xr<er.length;Xr++){const Jr=tr[Xr];Jr!==null&&(tr[Xr]=null,er[Xr].disconnect(Jr))}Qr=null,Fr=null,tt.setRenderTarget(Yt),qt=null,Qt=null,Wt=null,_t=null,ar=null,un.stop(),ht.isPresenting=!1,ht.dispatchEvent({type:"sessionend"})}function Hr(Xr){for(let Jr=0;Jr<Xr.removed.length;Jr++){const an=Xr.removed[Jr],sn=tr.indexOf(an);sn>=0&&(tr[sn]=null,er[sn].disconnect(an))}for(let Jr=0;Jr<Xr.added.length;Jr++){const an=Xr.added[Jr];let sn=tr.indexOf(an);if(sn===-1){for(let rs=0;rs<er.length;rs++){if(rs>=tr.length){tr.push(an),sn=rs;break}if(tr[rs]===null){tr[rs]=an,sn=rs;break}}if(sn===-1)break}const Fn=er[sn];Fn&&Fn.connect(an)}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(Xr){let Jr=er[Xr];return Jr===void 0&&(Jr=new W0,er[Xr]=Jr),Jr.getTargetRaySpace()},this.getControllerGrip=function(Xr){let Jr=er[Xr];return Jr===void 0&&(Jr=new W0,er[Xr]=Jr),Jr.getGripSpace()},this.getHand=function(Xr){let Jr=er[Xr];return Jr===void 0&&(Jr=new W0,er[Xr]=Jr),Jr.getHandSpace()},this.setFramebufferScaleFactor=function(Xr){bt=Xr,ht.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(Xr){Mt=Xr,ht.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return Nt||Pt},this.setReferenceSpace=function(Xr){Nt=Xr},this.getBaseLayer=function(){return Qt!==null?Qt:qt},this.getBinding=function(){return Wt},this.getFrame=function(){return Xt},this.getSession=function(){return _t},this.setSession=async function(Xr){if(_t=Xr,_t!==null){if(Yt=tt.getRenderTarget(),_t.addEventListener("select",Vr),_t.addEventListener("selectstart",Vr),_t.addEventListener("selectend",Vr),_t.addEventListener("squeeze",Vr),_t.addEventListener("squeezestart",Vr),_t.addEventListener("squeezeend",Vr),_t.addEventListener("end",zr),_t.addEventListener("inputsourceschange",Hr),Zt.xrCompatible!==!0&&await lt.makeXRCompatible(),_t.renderState.layers===void 0||tt.capabilities.isWebGL2===!1){const Jr={antialias:_t.renderState.layers!==void 0||Zt.antialias,alpha:!0,depth:Zt.depth,stencil:Zt.stencil,framebufferScaleFactor:bt};qt=new XRWebGLLayer(_t,lt,Jr),_t.updateRenderState({baseLayer:qt}),ar=new wo(qt.framebufferWidth,qt.framebufferHeight,{format:no,type:Gs,colorSpace:tt.outputColorSpace,stencilBuffer:Zt.stencil})}else{let Jr=null,an=null,sn=null;Zt.depth&&(sn=Zt.stencil?lt.DEPTH24_STENCIL8:lt.DEPTH_COMPONENT24,Jr=Zt.stencil?Ws:mo,an=Zt.stencil?kn:ho);const Fn={colorFormat:lt.RGBA8,depthFormat:sn,scaleFactor:bt};Wt=new XRWebGLBinding(_t,lt),Qt=Wt.createProjectionLayer(Fn),_t.updateRenderState({layers:[Qt]}),ar=new wo(Qt.textureWidth,Qt.textureHeight,{format:no,type:Gs,depthTexture:new yx(Qt.textureWidth,Qt.textureHeight,an,void 0,void 0,void 0,void 0,void 0,void 0,Jr),stencilBuffer:Zt.stencil,colorSpace:tt.outputColorSpace,samples:Zt.antialias?4:0}),tt.properties.get(ar).__ignoreDepthValues=Qt.ignoreDepthValues}ar.isXRRenderTarget=!0,this.setFoveation(Lt),Nt=null,Pt=await _t.requestReferenceSpace(Mt),un.setContext(_t),un.start(),ht.isPresenting=!0,ht.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(_t!==null)return _t.environmentBlendMode};const _n=new Sr,hn=new Sr;function Rn(Xr,Jr){Jr===null?Xr.matrixWorld.copy(Xr.matrix):Xr.matrixWorld.multiplyMatrices(Jr.matrixWorld,Xr.matrix),Xr.matrixWorldInverse.copy(Xr.matrixWorld).invert()}this.updateCamera=function(Xr){if(_t===null)return;Mr.near=wr.near=Ar.near=Xr.near,Mr.far=wr.far=Ar.far=Xr.far,Qr===Mr.near&&Fr===Mr.far||(_t.updateRenderState({depthNear:Mr.near,depthFar:Mr.far}),Qr=Mr.near,Fr=Mr.far);const Jr=Xr.parent,an=Mr.cameras;Rn(Mr,Jr);for(let sn=0;sn<an.length;sn++)Rn(an[sn],Jr);an.length===2?function(sn,Fn,rs){_n.setFromMatrixPosition(Fn.matrixWorld),hn.setFromMatrixPosition(rs.matrixWorld);const Yn=_n.distanceTo(hn),Un=Fn.projectionMatrix.elements,cs=rs.projectionMatrix.elements,Lr=Un[14]/(Un[10]-1),Er=Un[14]/(Un[10]+1),Ur=(Un[9]+1)/Un[5],Wr=(Un[9]-1)/Un[5],kr=(Un[8]-1)/Un[0],fr=(cs[8]+1)/cs[0],Or=Lr*kr,Nr=Lr*fr,$r=Yn/(-kr+fr),Kr=$r*-kr;Fn.matrixWorld.decompose(sn.position,sn.quaternion,sn.scale),sn.translateX(Kr),sn.translateZ($r),sn.matrixWorld.compose(sn.position,sn.quaternion,sn.scale),sn.matrixWorldInverse.copy(sn.matrixWorld).invert();const wn=Lr+$r,dn=Er+$r,ms=Or-Kr,ts=Nr+(Yn-Kr),Pn=Ur*Er/dn*wn,Zn=Wr*Er/dn*wn;sn.projectionMatrix.makePerspective(ms,ts,Pn,Zn,wn,dn),sn.projectionMatrixInverse.copy(sn.projectionMatrix).invert()}(Mr,Ar,wr):Mr.projectionMatrix.copy(Ar.projectionMatrix),function(sn,Fn,rs){rs===null?sn.matrix.copy(Fn.matrixWorld):(sn.matrix.copy(rs.matrixWorld),sn.matrix.invert(),sn.matrix.multiply(Fn.matrixWorld)),sn.matrix.decompose(sn.position,sn.quaternion,sn.scale),sn.updateMatrixWorld(!0),sn.projectionMatrix.copy(Fn.projectionMatrix),sn.projectionMatrixInverse.copy(Fn.projectionMatrixInverse),sn.isPerspectiveCamera&&(sn.fov=2*du*Math.atan(1/sn.projectionMatrix.elements[5]),sn.zoom=1)}(Xr,Mr,Jr)},this.getCamera=function(){return Mr},this.getFoveation=function(){if(Qt!==null||qt!==null)return Lt},this.setFoveation=function(Xr){Lt=Xr,Qt!==null&&(Qt.fixedFoveation=Xr),qt!==null&&qt.fixedFoveation!==void 0&&(qt.fixedFoveation=Xr)};let Bn=null;this.onPreAnimationFrameCallback=null;const un=new Hy;un.setAnimationLoop(function(Xr,Jr){if(ht.onPreAnimationFrameCallback&&ht.onPreAnimationFrameCallback(Xr,Jr),jt=Jr.getViewerPose(Nt||Pt),Xt=Jr,jt!==null){const an=jt.views;qt!==null&&(tt.setRenderTargetFramebuffer(ar,qt.framebuffer),tt.setRenderTarget(ar));let sn=!1;an.length!==Mr.cameras.length&&(Mr.cameras.length=0,sn=!0);for(let Fn=0;Fn<an.length;Fn++){const rs=an[Fn];let Yn=null;if(qt!==null)Yn=qt.getViewport(rs);else{const cs=Wt.getViewSubImage(Qt,rs);Yn=cs.viewport,Fn===0&&(tt.setRenderTargetTextures(ar,cs.colorTexture,Qt.ignoreDepthValues?void 0:cs.depthStencilTexture),tt.setRenderTarget(ar))}let Un=br[Fn];Un===void 0&&(Un=new bo,Un.layers.enable(Fn),Un.viewport=new Rs,br[Fn]=Un),Un.matrix.fromArray(rs.transform.matrix),Un.matrix.decompose(Un.position,Un.quaternion,Un.scale),Un.projectionMatrix.fromArray(rs.projectionMatrix),Un.projectionMatrixInverse.copy(Un.projectionMatrix).invert(),Un.viewport.set(Yn.x,Yn.y,Yn.width,Yn.height),Fn===0&&(Mr.matrix.copy(Un.matrix),Mr.matrix.decompose(Mr.position,Mr.quaternion,Mr.scale)),sn===!0&&Mr.cameras.push(Un)}}for(let an=0;an<er.length;an++){const sn=tr[an],Fn=er[an];sn!==null&&Fn!==void 0&&Fn.update(sn,Jr,Nt||Pt)}Bn&&Bn(Xr,Jr),Jr.detectedPlanes&&ht.dispatchEvent({type:"planesdetected",data:Jr}),Xt=null}),this.setAnimationLoop=function(Xr){Bn=Xr},this.dispose=function(){}}}function iE(St,tt){function lt(_t,bt){_t.matrixAutoUpdate===!0&&_t.updateMatrix(),bt.value.copy(_t.matrix)}function ht(_t,bt){_t.opacity.value=bt.opacity,bt.color&&_t.diffuse.value.copy(bt.color),bt.emissive&&_t.emissive.value.copy(bt.emissive).multiplyScalar(bt.emissiveIntensity),bt.map&&(_t.map.value=bt.map,lt(bt.map,_t.mapTransform)),bt.alphaMap&&(_t.alphaMap.value=bt.alphaMap,lt(bt.alphaMap,_t.alphaMapTransform)),bt.bumpMap&&(_t.bumpMap.value=bt.bumpMap,lt(bt.bumpMap,_t.bumpMapTransform),_t.bumpScale.value=bt.bumpScale,bt.side===xt&&(_t.bumpScale.value*=-1)),bt.normalMap&&(_t.normalMap.value=bt.normalMap,lt(bt.normalMap,_t.normalMapTransform),_t.normalScale.value.copy(bt.normalScale),bt.side===xt&&_t.normalScale.value.negate()),bt.displacementMap&&(_t.displacementMap.value=bt.displacementMap,lt(bt.displacementMap,_t.displacementMapTransform),_t.displacementScale.value=bt.displacementScale,_t.displacementBias.value=bt.displacementBias),bt.emissiveMap&&(_t.emissiveMap.value=bt.emissiveMap,lt(bt.emissiveMap,_t.emissiveMapTransform)),bt.specularMap&&(_t.specularMap.value=bt.specularMap,lt(bt.specularMap,_t.specularMapTransform)),bt.alphaTest>0&&(_t.alphaTest.value=bt.alphaTest);const Pt=tt.get(bt).envMap;if(Pt){_t.envMap.value=Pt;const Mt=bt.envMap||tt.get(bt).environment||Pt;_t.envMapRotation.value=Mt?Mt.rotation:0,_t.flipEnvMap.value=Pt.isCubeTexture&&Pt.isRenderTargetTexture===!1?-1:1,_t.reflectivity.value=bt.reflectivity,_t.ior.value=bt.ior,_t.refractionRatio.value=bt.refractionRatio}if(bt.lightMap){_t.lightMap.value=bt.lightMap;const Mt=St._useLegacyLights===!0?Math.PI:1;_t.lightMapIntensity.value=bt.lightMapIntensity*Mt,lt(bt.lightMap,_t.lightMapTransform)}bt.aoMap&&(_t.aoMap.value=bt.aoMap,_t.aoMapIntensity.value=bt.aoMapIntensity,lt(bt.aoMap,_t.aoMapTransform))}return{refreshTransformUniform:lt,refreshFogUniforms:function(_t,bt){bt.color.getRGB(_t.fogColor.value,jy(St)),bt.isFog?(_t.fogNear.value=bt.near,_t.fogFar.value=bt.far):bt.isFogExp2&&(_t.fogDensity.value=bt.density)},refreshMaterialUniforms:function(_t,bt,Pt,Mt,Lt){bt.isMeshBasicMaterial||bt.isMeshLambertMaterial?ht(_t,bt):bt.isMeshToonMaterial?(ht(_t,bt),function(Nt,jt){jt.gradientMap&&(Nt.gradientMap.value=jt.gradientMap)}(_t,bt)):bt.isMeshPhongMaterial?(ht(_t,bt),function(Nt,jt){Nt.specular.value.copy(jt.specular),Nt.shininess.value=Math.max(jt.shininess,1e-4)}(_t,bt)):bt.isMeshStandardMaterial?(ht(_t,bt),function(Nt,jt){Nt.metalness.value=jt.metalness,jt.metalnessMap&&(Nt.metalnessMap.value=jt.metalnessMap,lt(jt.metalnessMap,Nt.metalnessMapTransform)),Nt.roughness.value=jt.roughness,jt.roughnessMap&&(Nt.roughnessMap.value=jt.roughnessMap,lt(jt.roughnessMap,Nt.roughnessMapTransform)),tt.get(jt).envMap&&(Nt.envMapIntensity.value=jt.envMapIntensity)}(_t,bt),bt.isMeshPhysicalMaterial&&function(Nt,jt,Wt){Nt.ior.value=jt.ior,jt.sheen>0&&(Nt.sheenColor.value.copy(jt.sheenColor).multiplyScalar(jt.sheen),Nt.sheenRoughness.value=jt.sheenRoughness,jt.sheenColorMap&&(Nt.sheenColorMap.value=jt.sheenColorMap,lt(jt.sheenColorMap,Nt.sheenColorMapTransform)),jt.sheenRoughnessMap&&(Nt.sheenRoughnessMap.value=jt.sheenRoughnessMap,lt(jt.sheenRoughnessMap,Nt.sheenRoughnessMapTransform))),jt.clearcoat>0&&(Nt.clearcoat.value=jt.clearcoat,Nt.clearcoatRoughness.value=jt.clearcoatRoughness,jt.clearcoatMap&&(Nt.clearcoatMap.value=jt.clearcoatMap,lt(jt.clearcoatMap,Nt.clearcoatMapTransform)),jt.clearcoatRoughnessMap&&(Nt.clearcoatRoughnessMap.value=jt.clearcoatRoughnessMap,lt(jt.clearcoatRoughnessMap,Nt.clearcoatRoughnessMapTransform)),jt.clearcoatNormalMap&&(Nt.clearcoatNormalMap.value=jt.clearcoatNormalMap,lt(jt.clearcoatNormalMap,Nt.clearcoatNormalMapTransform),Nt.clearcoatNormalScale.value.copy(jt.clearcoatNormalScale),jt.side===xt&&Nt.clearcoatNormalScale.value.negate())),jt.iridescence>0&&(Nt.iridescence.value=jt.iridescence,Nt.iridescenceIOR.value=jt.iridescenceIOR,Nt.iridescenceThicknessMinimum.value=jt.iridescenceThicknessRange[0],Nt.iridescenceThicknessMaximum.value=jt.iridescenceThicknessRange[1],jt.iridescenceMap&&(Nt.iridescenceMap.value=jt.iridescenceMap,lt(jt.iridescenceMap,Nt.iridescenceMapTransform)),jt.iridescenceThicknessMap&&(Nt.iridescenceThicknessMap.value=jt.iridescenceThicknessMap,lt(jt.iridescenceThicknessMap,Nt.iridescenceThicknessMapTransform))),jt.transmission>0&&(Nt.transmission.value=jt.transmission,Nt.transmissionSamplerMap.value=Wt.texture,Nt.transmissionSamplerSize.value.set(Wt.width,Wt.height),jt.transmissionMap&&(Nt.transmissionMap.value=jt.transmissionMap,lt(jt.transmissionMap,Nt.transmissionMapTransform)),Nt.thickness.value=jt.thickness,jt.thicknessMap&&(Nt.thicknessMap.value=jt.thicknessMap,lt(jt.thicknessMap,Nt.thicknessMapTransform)),Nt.attenuationDistance.value=jt.attenuationDistance,Nt.attenuationColor.value.copy(jt.attenuationColor)),jt.anisotropy>0&&(Nt.anisotropyVector.value.set(jt.anisotropy*Math.cos(jt.anisotropyRotation),jt.anisotropy*Math.sin(jt.anisotropyRotation)),jt.anisotropyMap&&(Nt.anisotropyMap.value=jt.anisotropyMap,lt(jt.anisotropyMap,Nt.anisotropyMapTransform))),Nt.specularIntensity.value=jt.specularIntensity,Nt.specularColor.value.copy(jt.specularColor),jt.specularColorMap&&(Nt.specularColorMap.value=jt.specularColorMap,lt(jt.specularColorMap,Nt.specularColorMapTransform)),jt.specularIntensityMap&&(Nt.specularIntensityMap.value=jt.specularIntensityMap,lt(jt.specularIntensityMap,Nt.specularIntensityMapTransform))}(_t,bt,Lt)):bt.isMeshMatcapMaterial?(ht(_t,bt),function(Nt,jt){jt.matcap&&(Nt.matcap.value=jt.matcap)}(_t,bt)):bt.isMeshDepthMaterial?ht(_t,bt):bt.isMeshDistanceMaterial?(ht(_t,bt),function(Nt,jt){const Wt=tt.get(jt).light;Nt.referencePosition.value.setFromMatrixPosition(Wt.matrixWorld),Nt.nearDistance.value=Wt.shadow.camera.near,Nt.farDistance.value=Wt.shadow.camera.far}(_t,bt)):bt.isMeshNormalMaterial?ht(_t,bt):bt.isLineBasicMaterial?(function(Nt,jt){Nt.diffuse.value.copy(jt.color),Nt.opacity.value=jt.opacity,jt.map&&(Nt.map.value=jt.map,lt(jt.map,Nt.mapTransform))}(_t,bt),bt.isLineDashedMaterial&&function(Nt,jt){Nt.dashSize.value=jt.dashSize,Nt.totalSize.value=jt.dashSize+jt.gapSize,Nt.scale.value=jt.scale}(_t,bt)):bt.isPointsMaterial?function(Nt,jt,Wt,Qt){Nt.diffuse.value.copy(jt.color),Nt.opacity.value=jt.opacity,Nt.size.value=jt.size*Wt,Nt.scale.value=.5*Qt,jt.map&&(Nt.map.value=jt.map,lt(jt.map,Nt.uvTransform)),jt.alphaMap&&(Nt.alphaMap.value=jt.alphaMap,lt(jt.alphaMap,Nt.alphaMapTransform)),jt.alphaTest>0&&(Nt.alphaTest.value=jt.alphaTest)}(_t,bt,Pt,Mt):bt.isSpriteMaterial?function(Nt,jt){Nt.diffuse.value.copy(jt.color),Nt.opacity.value=jt.opacity,Nt.rotation.value=jt.rotation,jt.map&&(Nt.map.value=jt.map,lt(jt.map,Nt.mapTransform)),jt.alphaMap&&(Nt.alphaMap.value=jt.alphaMap,lt(jt.alphaMap,Nt.alphaMapTransform)),jt.alphaTest>0&&(Nt.alphaTest.value=jt.alphaTest)}(_t,bt):bt.isShadowMaterial?(_t.color.value.copy(bt.color),_t.opacity.value=bt.opacity):bt.isShaderMaterial&&(bt.transmission!==void 0&&(_t.transmission&&(_t.transmission.value=bt.transmission),_t.transmissionSamplerMap&&Lt&&(_t.transmissionSamplerMap.value=Lt?Lt.texture:null),_t.transmissionSamplerSize&&Lt&&_t.transmissionSamplerSize.value.set(Lt.width,Lt.height)),bt.uniformsNeedUpdate=!1)}}}function nE(St,tt,lt,ht){let _t={},bt={},Pt=[];const Mt=lt.isWebGL2?St.getParameter(St.MAX_UNIFORM_BUFFER_BINDINGS):0;function Lt(Wt,Qt,qt){const Xt=Wt.value;if(qt[Qt]===void 0){if(typeof Xt=="number")qt[Qt]=Xt;else{const Zt=Array.isArray(Xt)?Xt:[Xt],Yt=[];for(let ar=0;ar<Zt.length;ar++)Yt.push(Zt[ar].clone());qt[Qt]=Yt}return!0}if(typeof Xt=="number"){if(qt[Qt]!==Xt)return qt[Qt]=Xt,!0}else{const Zt=Array.isArray(qt[Qt])?qt[Qt]:[qt[Qt]],Yt=Array.isArray(Xt)?Xt:[Xt];for(let ar=0;ar<Zt.length;ar++){const er=Zt[ar];if(er.equals(Yt[ar])===!1)return er.copy(Yt[ar]),!0}}return!1}function Nt(Wt){const Qt={boundary:0,storage:0};return typeof Wt=="number"?(Qt.boundary=4,Qt.storage=4):Wt.isVector2?(Qt.boundary=8,Qt.storage=8):Wt.isVector3||Wt.isColor?(Qt.boundary=16,Qt.storage=12):Wt.isVector4?(Qt.boundary=16,Qt.storage=16):Wt.isMatrix3?(Qt.boundary=48,Qt.storage=48):Wt.isMatrix4?(Qt.boundary=64,Qt.storage=64):Wt.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",Wt),Qt}function jt(Wt){const Qt=Wt.target;Qt.removeEventListener("dispose",jt);const qt=Pt.indexOf(Qt.__bindingPointIndex);Pt.splice(qt,1),St.deleteBuffer(_t[Qt.id]),delete _t[Qt.id],delete bt[Qt.id]}return{bind:function(Wt,Qt){const qt=Qt.program;ht.uniformBlockBinding(Wt,qt)},update:function(Wt,Qt){let qt=_t[Wt.id];qt===void 0&&(function(Yt){const ar=Yt.uniforms;let er=0,tr=0;for(let Ar=0,wr=ar.length;Ar<wr;Ar++){const br=ar[Ar],Mr={boundary:0,storage:0},Qr=Array.isArray(br.value)?br.value:[br.value];for(let Fr=0,Vr=Qr.length;Fr<Vr;Fr++){const zr=Nt(Qr[Fr]);Mr.boundary+=zr.boundary,Mr.storage+=zr.storage}br.__data=new Float32Array(Mr.storage/Float32Array.BYTES_PER_ELEMENT),br.__offset=er,Ar>0&&(tr=er%16,tr!==0&&16-tr-Mr.boundary<0&&(er+=16-tr,br.__offset=er)),er+=Mr.storage}tr=er%16,tr>0&&(er+=16-tr),Yt.__size=er,Yt.__cache={}}(Wt),qt=function(Yt){const ar=function(){for(let wr=0;wr<Mt;wr++)if(Pt.indexOf(wr)===-1)return Pt.push(wr),wr;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}();Yt.__bindingPointIndex=ar;const er=St.createBuffer(),tr=Yt.__size,Ar=Yt.usage;return St.bindBuffer(St.UNIFORM_BUFFER,er),St.bufferData(St.UNIFORM_BUFFER,tr,Ar),St.bindBuffer(St.UNIFORM_BUFFER,null),St.bindBufferBase(St.UNIFORM_BUFFER,ar,er),er}(Wt),_t[Wt.id]=qt,Wt.addEventListener("dispose",jt));const Xt=Qt.program;ht.updateUBOMapping(Wt,Xt);const Zt=tt.render.frame;bt[Wt.id]!==Zt&&(function(Yt){const ar=_t[Yt.id],er=Yt.uniforms,tr=Yt.__cache;St.bindBuffer(St.UNIFORM_BUFFER,ar);for(let Ar=0,wr=er.length;Ar<wr;Ar++){const br=er[Ar];if(Lt(br,Ar,tr)===!0){const Mr=br.__offset,Qr=Array.isArray(br.value)?br.value:[br.value];let Fr=0;for(let Vr=0;Vr<Qr.length;Vr++){const zr=Qr[Vr],Hr=Nt(zr);typeof zr=="number"?(br.__data[0]=zr,St.bufferSubData(St.UNIFORM_BUFFER,Mr+Fr,br.__data)):zr.isMatrix3?(br.__data[0]=zr.elements[0],br.__data[1]=zr.elements[1],br.__data[2]=zr.elements[2],br.__data[3]=zr.elements[0],br.__data[4]=zr.elements[3],br.__data[5]=zr.elements[4],br.__data[6]=zr.elements[5],br.__data[7]=zr.elements[0],br.__data[8]=zr.elements[6],br.__data[9]=zr.elements[7],br.__data[10]=zr.elements[8],br.__data[11]=zr.elements[0]):(zr.toArray(br.__data,Fr),Fr+=Hr.storage/Float32Array.BYTES_PER_ELEMENT)}St.bufferSubData(St.UNIFORM_BUFFER,Mr,br.__data)}}St.bindBuffer(St.UNIFORM_BUFFER,null)}(Wt),bt[Wt.id]=Zt)},dispose:function(){for(const Wt in _t)St.deleteBuffer(_t[Wt]);Pt=[],_t={},bt={}}}}class bx{constructor(tt={}){const{canvas:lt=Zm(),context:ht=null,depth:_t=!0,stencil:bt=!0,alpha:Pt=!1,antialias:Mt=!1,premultipliedAlpha:Lt=!0,preserveDrawingBuffer:Nt=!1,powerPreference:jt="default",failIfMajorPerformanceCaveat:Wt=!1}=tt;let Qt;this.isWebGLRenderer=!0,Qt=ht!==null?ht.getContextAttributes().alpha:Pt;const qt=new Uint32Array(4),Xt=new Int32Array(4);let Zt=null,Yt=null;const ar=[],er=[];this.domElement=lt,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this._outputColorSpace=Ns,this._useLegacyLights=!1,this.toneMapping=or,this.toneMappingExposure=1,this.userData={},this.onContextLost=()=>{},this.onContextRestore=()=>{},this.onContextCreationError=()=>{};const tr=this;let Ar=!1,wr=0,br=0,Mr=null,Qr=-1,Fr=null;const Vr=new Rs,zr=new Rs;let Hr=null;const _n=new jn(0);let hn=0,Rn=lt.width,Bn=lt.height,un=1,Xr=null,Jr=null;const an=new Rs(0,0,Rn,Bn),sn=new Rs(0,0,Rn,Bn);let Fn=!1;const rs=new Av;let Yn=!1,Un=!1,cs=null;const Lr=new is,Er=new mn,Ur=new Sr,Wr={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function kr(){return Mr===null?un:1}let fr,Or,Nr,$r,Kr,wn,dn,ms,ts,Pn,Zn,qn,us,vs,Ls,Ms,$n,ws,Jo,ps,zs,Es,wu,Eu,_i=ht;function _0(Ir,en){for(let on=0;on<Ir.length;on++){const pn=Ir[on],bn=lt.getContext(pn,en);if(bn!==null)return bn}return null}try{const Ir={alpha:!0,depth:_t,stencil:bt,antialias:Mt,premultipliedAlpha:Lt,preserveDrawingBuffer:Nt,powerPreference:jt,failIfMajorPerformanceCaveat:Wt};if("setAttribute"in lt&&lt.setAttribute("data-engine",`three.js r${d}`),lt.addEventListener("webglcontextlost",U_,!1),lt.addEventListener("webglcontextrestored",sw,!1),lt.addEventListener("webglcontextcreationerror",aw,!1),_i===null){const en=["webgl2","webgl","experimental-webgl"];if(tr.isWebGL1Renderer===!0&&en.shift(),_i=_0(en,Ir),_i===null)throw _0(en)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}typeof WebGLRenderingContext<"u"&&_i instanceof WebGLRenderingContext&&console.warn("THREE.WebGLRenderer: WebGL 1 support was deprecated in r153 and will be removed in r163."),_i.getShaderPrecisionFormat===void 0&&(_i.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(Ir){throw console.error("THREE.WebGLRenderer: "+Ir.message),Ir}function f0(){fr=new Dw(_i),Or=new Mw(_i,fr,tt),fr.init(Or),Es=new fx(_i,fr,Or),Nr=new Z1(_i,fr,Or),$r=new Ow(_i),Kr=new H1,wn=new eE(_i,fr,Nr,Kr,Or,Es,$r),dn=new Rw(tr),ms=new kw(tr),ts=new Sw(_i,Or),wu=new Pw(_i,fr,ts,Or),Pn=new Bw(_i,ts,$r,wu),Zn=new jw(_i,Pn,ts,$r),Jo=new Uw(_i,Or,wn),Ms=new Iw(Kr),qn=new V1(tr,dn,ms,fr,Or,wu,Ms),us=new iE(tr,Kr),vs=new W1,Ls=new K1(fr,Or),ws=new Cw(tr,dn,ms,Nr,Zn,Qt,Lt),$n=new J1(tr,Zn,Or),Eu=new nE(_i,$r,Or,Nr),ps=new Tw(_i,fr,$r,Or),zs=new Lw(_i,fr,$r,Or),$r.programs=qn.programs,tr.capabilities=Or,tr.extensions=fr,tr.properties=Kr,tr.renderLists=vs,tr.shadowMap=$n,tr.state=Nr,tr.info=$r,tr.background=ws,tr.cubemaps=dn,tr.cubeuvmaps=ms,tr.materials=us}f0();const Po=new rE(tr,_i);function U_(Ir){Ir.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),Ar=!0,tr.onContextLost(Ir)}function sw(){console.log("THREE.WebGLRenderer: Context Restored."),Ar=!1;const Ir=tr.info?tr.info.autoReset:void 0,en=$n.enabled,on=$n.autoUpdate,pn=$n.needsUpdate,bn=$n.type;f0(),tr.info&&Ir!==void 0&&(tr.info.autoReset=Ir),$n.enabled=en,$n.autoUpdate=on,$n.needsUpdate=pn,$n.type=bn,tr.onContextRestore&&tr.onContextRestore()}function aw(Ir){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",Ir.statusMessage),tr.onContextCreationError(Ir)}function ow(Ir){const en=Ir.target;en.removeEventListener("dispose",ow),function(on){(function(pn){const bn=Kr.get(pn).programs;bn!==void 0&&(bn.forEach(function(Ln){qn.releaseProgram(Ln)}),pn.isShaderMaterial&&qn.releaseShaderCache(pn))})(on),Kr.remove(on)}(en)}this.xr=Po,this.getContext=function(){return _i},this.getContextAttributes=function(){return _i.getContextAttributes()},this.forceContextLoss=function(){const Ir=fr.get("WEBGL_lose_context");Ir&&Ir.loseContext()},this.forceContextRestore=function(){const Ir=fr.get("WEBGL_lose_context");Ir&&Ir.restoreContext()},this.getPixelRatio=function(){return un},this.setPixelRatio=function(Ir){Ir!==void 0&&(un=Ir,this.setSize(Rn,Bn,!1))},this.getSize=function(Ir){return Ir.set(Rn,Bn)},this.setSize=function(Ir,en,on=!0){Po.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(Rn=Ir,Bn=en,lt.width=Math.floor(Ir*un),lt.height=Math.floor(en*un),on===!0&&(lt.style.width=Ir+"px",lt.style.height=en+"px"),this.setViewport(0,0,Ir,en))},this.getDrawingBufferSize=function(Ir){return Ir.set(Rn*un,Bn*un).floor()},this.setDrawingBufferSize=function(Ir,en,on){Rn=Ir,Bn=en,un=on,lt.width=Math.floor(Ir*on),lt.height=Math.floor(en*on),this.setViewport(0,0,Ir,en)},this.getCurrentViewport=function(Ir){return Ir.copy(Vr)},this.getViewport=function(Ir){return Ir.copy(an)},this.setViewport=function(Ir,en,on,pn){Ir.isVector4?an.set(Ir.x,Ir.y,Ir.z,Ir.w):an.set(Ir,en,on,pn),Nr.viewport(Vr.copy(an).multiplyScalar(un).floor())},this.getScissor=function(Ir){return Ir.copy(sn)},this.setScissor=function(Ir,en,on,pn){Ir.isVector4?sn.set(Ir.x,Ir.y,Ir.z,Ir.w):sn.set(Ir,en,on,pn),Nr.scissor(zr.copy(sn).multiplyScalar(un).floor())},this.getScissorTest=function(){return Fn},this.setScissorTest=function(Ir){Nr.setScissorTest(Fn=Ir)},this.setOpaqueSort=function(Ir){Xr=Ir},this.setTransparentSort=function(Ir){Jr=Ir},this.getClearColor=function(Ir){return Ir.copy(ws.getClearColor())},this.setClearColor=function(){ws.setClearColor.apply(ws,arguments)},this.getClearAlpha=function(){return ws.getClearAlpha()},this.setClearAlpha=function(){ws.setClearAlpha.apply(ws,arguments)},this.clear=function(Ir=!0,en=!0,on=!0){let pn=0;if(Ir){let bn=!1;if(Mr!==null){const Ln=Mr.texture.format;bn=Ln===xo||Ln===Io||Ln===Ps}if(bn){const Ln=Mr.texture.type,xs=Ln===Gs||Ln===ho||Ln===Mo||Ln===kn||Ln===io||Ln===Ml,Kn=ws.getClearColor(),hs=ws.getClearAlpha(),ys=Kn.r,bs=Kn.g,as=Kn.b;xs?(qt[0]=ys,qt[1]=bs,qt[2]=as,qt[3]=hs,_i.clearBufferuiv(_i.COLOR,0,qt)):(Xt[0]=ys,Xt[1]=bs,Xt[2]=as,Xt[3]=hs,_i.clearBufferiv(_i.COLOR,0,Xt))}else pn|=_i.COLOR_BUFFER_BIT}en&&(pn|=_i.DEPTH_BUFFER_BIT),on&&(pn|=_i.STENCIL_BUFFER_BIT),_i.clear(pn)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){lt.removeEventListener("webglcontextlost",U_,!1),lt.removeEventListener("webglcontextrestored",sw,!1),lt.removeEventListener("webglcontextcreationerror",aw,!1),vs.dispose(),Ls.dispose(),Kr.dispose(),dn.dispose(),ms.dispose(),Zn.dispose(),wu.dispose(),Eu.dispose(),qn.dispose(),Po.dispose(),Po.removeEventListener("sessionstart",lw),Po.removeEventListener("sessionend",cw),cs&&(cs.dispose(),cs=null),Np.stop()},this.renderBufferDirect=function(Ir,en,on,pn,bn,Ln){en===null&&(en=Wr);const xs=bn.isMesh&&bn.matrixWorld.determinant()<0,Kn=function(Zs,_l,Ho,ns,Ys){_l.isScene!==!0&&(_l=Wr),wn.resetTextureUnits();const j_=_l.fog,xS=ns.userData&&ns.userData.envMapSlotKey&&_l.textureSlots&&_l.textureSlots[ns.userData.envMapSlotKey]?_l.textureSlots[ns.userData.envMapSlotKey]:ns.isMeshStandardMaterial?_l.environment:null,AS=Mr===null?tr.outputColorSpace:Mr.isXRRenderTarget===!0||Mr.texture.colorSpace&&Mr.texture.colorSpace!==Ns?Mr.texture.colorSpace:qs,x0=(ns.isMeshStandardMaterial?ms:dn).get(ns.envMap||xS),wS=ns.vertexColors===!0&&!!Ho.attributes.color&&Ho.attributes.color.itemSize===4,ES=!!Ho.attributes.tangent&&(!!ns.normalMap||ns.anisotropy>0||Ho.userData.__forceUseTangent),SS=!!Ho.morphAttributes.position,CS=!!Ho.morphAttributes.normal,PS=!!Ho.morphAttributes.color;let mw=or;ns.toneMapped&&(Mr!==null&&Mr.isXRRenderTarget!==!0||(mw=tr.toneMapping));const gw=Ho.morphAttributes.position||Ho.morphAttributes.normal||Ho.morphAttributes.color,TS=gw!==void 0?gw.length:0,Os=Kr.get(ns),MS=Yt.state.lights;if(Yn===!0&&(Un===!0||Zs!==Fr)){const No=Zs===Fr&&ns.id===Qr;Ms.setState(ns,Zs,No)}let Su=!1;ns.version===Os.__version?Os.needsLights&&Os.lightsStateVersion!==MS.state.version||Os.outputColorSpace!==AS||Ys.isInstancedMesh&&Os.instancing===!1?Su=!0:Ys.isInstancedMesh||Os.instancing!==!0?Ys.isSkinnedMesh&&Os.skinning===!1?Su=!0:Ys.isSkinnedMesh||Os.skinning!==!0?Ys.isInstancedMesh&&Os.instancingColor===!0&&Ys.instanceColor===null||Ys.isInstancedMesh&&Os.instancingColor===!1&&Ys.instanceColor!==null||Os.envMap!==x0||ns.fog===!0&&Os.fog!==j_?Su=!0:Os.numClippingPlanes===void 0||Os.numClippingPlanes===Ms.numPlanes&&Os.numIntersection===Ms.numIntersection?(Os.vertexAlphas!==wS||Os.vertexTangents!==ES||Os.morphTargets!==SS||Os.morphNormals!==CS||Os.morphColors!==PS||Os.toneMapping!==mw||Or.isWebGL2===!0&&Os.morphTargetsCount!==TS)&&(Su=!0):Su=!0:Su=!0:Su=!0:(Su=!0,Os.__version=ns.version);let Fp=Os.currentProgram;Su===!0&&(Fp=b0(ns,_l,Ys));let _w=!1,G_=!1,Ry=!1;const To=Fp.getUniforms(),Up=Os.uniforms;if(Nr.useProgram(Fp.program)&&(_w=!0,G_=!0,Ry=!0),ns.id!==Qr&&(Qr=ns.id,G_=!0),_w||Fr!==Zs){To.setValue(_i,"projectionMatrix",Zs.projectionMatrix),To.setValue(_i,"viewMatrix",Zs.matrixWorldInverse);const No=To.map.cameraPosition;No!==void 0&&No.setValue(_i,Ur.setFromMatrixPosition(Zs.matrixWorld)),Or.logarithmicDepthBuffer&&To.setValue(_i,"logDepthBufFC",2/(Math.log(Zs.far+1)/Math.LN2)),(ns.isMeshPhongMaterial||ns.isMeshToonMaterial||ns.isMeshLambertMaterial||ns.isMeshBasicMaterial||ns.isMeshStandardMaterial||ns.isShaderMaterial)&&To.setValue(_i,"isOrthographic",Zs.isOrthographicCamera===!0),Fr!==Zs&&(Fr=Zs,G_=!0,Ry=!0)}if(Ys.isSkinnedMesh){To.setOptional(_i,Ys,"bindMatrix"),To.setOptional(_i,Ys,"bindMatrixInverse");const No=Ys.skeleton;No&&(Or.floatVertexTextures?(No.boneTexture===null&&No.computeBoneTexture(),To.setValue(_i,"boneTexture",No.boneTexture,wn),To.setValue(_i,"boneTextureSize",No.boneTextureSize)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}const ky=Ho.morphAttributes;var iu,Vl;(ky.position!==void 0||ky.normal!==void 0||ky.color!==void 0&&Or.isWebGL2===!0)&&Jo.update(Ys,Ho,Fp),(G_||Os.receiveShadow!==Ys.receiveShadow)&&(Os.receiveShadow=Ys.receiveShadow,To.setValue(_i,"receiveShadow",Ys.receiveShadow)),ns.isMeshGouraudMaterial&&ns.envMap!==null&&(Up.envMap.value=x0,Up.flipEnvMap.value=x0.isCubeTexture&&x0.isRenderTargetTexture===!1?-1:1),G_&&(To.setValue(_i,"toneMappingExposure",tr.toneMappingExposure),Os.needsLights&&(Vl=Ry,(iu=Up).ambientLightColor.needsUpdate=Vl,iu.lightProbe.needsUpdate=Vl,iu.directionalLights.needsUpdate=Vl,iu.directionalLightShadows.needsUpdate=Vl,iu.pointLights.needsUpdate=Vl,iu.pointLightShadows.needsUpdate=Vl,iu.spotLights.needsUpdate=Vl,iu.spotLightShadows.needsUpdate=Vl,iu.rectAreaLights.needsUpdate=Vl,iu.hemisphereLights.needsUpdate=Vl),j_&&ns.fog===!0&&us.refreshFogUniforms(Up,j_),us.refreshMaterialUniforms(Up,ns,un,Bn,tr.userData.transmissionRenderTarget||cs),Pv.upload(_i,Os.uniformsList,Up,wn)),ns.isShaderMaterial&&ns.uniformsNeedUpdate===!0&&(Pv.upload(_i,Os.uniformsList,Up,wn),ns.uniformsNeedUpdate=!1),ns.isSpriteMaterial&&To.setValue(_i,"center",Ys.center),To.setValue(_i,"modelViewMatrix",Ys.modelViewMatrix),To.setValue(_i,"normalMatrix",Ys.normalMatrix),To.setValue(_i,"modelMatrix",Ys.matrixWorld);const fw=ns.extraUniformsToUpload;if(fw&&Object.entries(fw).forEach(([No,z_])=>To.setValue(_i,No,z_.value,wn)),ns.isShaderMaterial||ns.isRawShaderMaterial){const No=ns.uniformsGroups;for(let z_=0,IS=No.length;z_<IS;z_++)if(Or.isWebGL2){const yw=No[z_];Eu.update(yw,Fp),Eu.bind(yw,Fp)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return Fp}(Ir,en,on,pn,bn);Nr.setMaterial(pn,xs);let hs=on.index,ys=1;if(pn.wireframe===!0){if(hs=Pn.getWireframeAttribute(on),hs===void 0)return;ys=2}const bs=on.drawRange,as=on.attributes.position;let uo=bs.start*ys,Zo=(bs.start+bs.count)*ys;Ln!==null&&(uo=Math.max(uo,Ln.start*ys),Zo=Math.min(Zo,(Ln.start+Ln.count)*ys)),hs!==null?(uo=Math.max(uo,0),Zo=Math.min(Zo,hs.count)):as!=null&&(uo=Math.max(uo,0),Zo=Math.min(Zo,as.count));const po=Zo-uo;if(po<0||po===1/0)return;let tp;wu.setup(bn,pn,Kn,on,hs);let ba=ps;if(hs!==null&&(tp=ts.get(hs),ba=zs,ba.setIndex(tp)),bn.isMesh)pn.wireframe===!0?(Nr.setLineWidth(pn.wireframeLinewidth*kr()),ba.setMode(_i.LINES)):ba.setMode(_i.TRIANGLES);else if(bn.isLine){let Zs=pn.linewidth;Zs===void 0&&(Zs=1),Nr.setLineWidth(Zs*kr()),bn.isLineSegments?ba.setMode(_i.LINES):bn.isLineLoop?ba.setMode(_i.LINE_LOOP):ba.setMode(_i.LINE_STRIP)}else bn.isPoints?ba.setMode(_i.POINTS):bn.isSprite&&ba.setMode(_i.TRIANGLES);if(bn.isInstancedMesh)ba.renderInstances(uo,po,bn.count);else if(on.isInstancedBufferGeometry){const Zs=on._maxInstanceCount!==void 0?on._maxInstanceCount:1/0,_l=Math.min(on.instanceCount,Zs);ba.renderInstances(uo,po,_l)}else ba.render(uo,po)},this.compile=function(Ir,en){function on(pn,bn,Ln){pn.transparent===!0&&pn.side===At&&pn.forceSinglePass===!1?(pn.side=xt,pn.needsUpdate=!0,b0(pn,bn,Ln),pn.side=vt,pn.needsUpdate=!0,b0(pn,bn,Ln),pn.side=At):b0(pn,bn,Ln)}Yt=Ls.get(Ir),Yt.init(),er.push(Yt),Ir.traverseVisible(function(pn){pn.isLight&&pn.layers.test(en.layers)&&(Yt.pushLight(pn),pn.castShadow&&Yt.pushShadow(pn))}),Yt.setupLights(tr._useLegacyLights),Ir.traverse(function(pn){const bn=pn.material;if(bn)if(Array.isArray(bn))for(let Ln=0;Ln<bn.length;Ln++)on(bn[Ln],Ir,pn);else on(bn,Ir,pn)}),er.pop(),Yt=null};let Iy=null;function lw(){Np.stop()}function cw(){Np.start()}const Np=new Hy;function uw(Ir,en,on,pn){if(Ir.visible===!1)return;if(Ir.layers.test(en.layers)){if(Ir.isGroup)on=Ir.renderOrder;else if(Ir.isLOD)Ir.autoUpdate===!0&&Ir.update(en);else if(Ir.isLight)Yt.pushLight(Ir),Ir.castShadow&&Yt.pushShadow(Ir);else if(Ir.isSprite){if(!Ir.frustumCulled||rs.intersectsSprite(Ir)){pn&&Ur.setFromMatrixPosition(Ir.matrixWorld).applyMatrix4(Lr);const Ln=Zn.update(Ir),xs=Ir.material;xs.visible&&Zt.push(Ir,Ln,xs,on,Ur.z,null)}}else if((Ir.isMesh||Ir.isLine||Ir.isPoints)&&(!Ir.frustumCulled||rs.intersectsObject(Ir))){const Ln=Zn.update(Ir),xs=Ir.material;if(pn&&(Ir.boundingSphere!==void 0?(Ir.boundingSphere===null&&Ir.computeBoundingSphere(),Ur.copy(Ir.boundingSphere.center)):(Ln.boundingSphere===null&&Ln.computeBoundingSphere(),Ur.copy(Ln.boundingSphere.center)),Ur.applyMatrix4(Ir.matrixWorld).applyMatrix4(Lr)),Array.isArray(xs)){const Kn=Ln.groups;for(let hs=0,ys=Kn.length;hs<ys;hs++){const bs=Kn[hs],as=xs[bs.materialIndex];as&&as.visible&&Zt.push(Ir,Ln,as,on,Ur.z,bs)}}else xs.visible&&Zt.push(Ir,Ln,xs,on,Ur.z,null)}}const bn=Ir.children;for(let Ln=0,xs=bn.length;Ln<xs;Ln++)uw(bn[Ln],en,on,pn)}function pw(Ir,en,on,pn){const bn=Ir.opaque,Ln=Ir.transmissive,xs=Ir.transparent;if(Yt.setupLightsView(on),Yn===!0&&Ms.setGlobalState(tr.clippingPlanes,on),tr.userData.transmissionRender===void 0&&tr.userData.renderTransmissionPass!==!1&&Ln.length>0&&function(Kn,hs,ys,bs){console.warn("three.js internal render transmission pass should not be called");const as=Or.isWebGL2;cs===null&&(cs=new wo(1,1,{generateMipmaps:!0,type:fr.has("EXT_color_buffer_half_float")?xa:Gs,minFilter:Jn,samples:as?4:0})),tr.getDrawingBufferSize(Er),as?cs.setSize(Er.x,Er.y):cs.setSize(gp(Er.x),gp(Er.y));const uo=tr.getRenderTarget();tr.setRenderTarget(cs),tr.getClearColor(_n),hn=tr.getClearAlpha(),hn<1&&tr.setClearColor(16777215,.5),tr.clear();const Zo=tr.toneMapping;tr.toneMapping=or,y0(Kn,ys,bs),wn.updateMultisampleRenderTarget(cs),wn.updateRenderTargetMipmap(cs);let po=!1;for(let tp=0,ba=hs.length;tp<ba;tp++){const Zs=hs[tp],_l=Zs.object,Ho=Zs.geometry,ns=Zs.material,Ys=Zs.group;if(ns.side===At&&_l.layers.test(bs.layers)){const j_=ns.side;ns.side=xt,ns.needsUpdate=!0,hw(_l,ys,bs,Ho,ns,Ys),ns.side=j_,ns.needsUpdate=!0,po=!0}}po===!0&&(wn.updateMultisampleRenderTarget(cs),wn.updateRenderTargetMipmap(cs)),tr.setRenderTarget(uo),tr.setClearColor(_n,hn),tr.toneMapping=Zo}([...bn,...xs],Ln,en,on),pn&&Nr.viewport(Vr.copy(pn)),tr.userData.opaqueRender!==!1&&bn.length>0&&y0(bn,en,on),tr.userData.transparentRender!==!1&&xs.length>0&&y0(xs,en,on),tr.userData.transmissionRender!==!1&&Ln.length>0){cs||(cs=new wo(1,1));const Kn=(tr.userData.transmissionRenderTarget||cs).texture,hs=Or.isWebGL2,ys=Kn.generateMipmaps,bs=Kn.minFilter;hs&&tr.userData.blurTransmissionTarget&&tr.userData.transmissionRenderTarget&&(Kn.generateMipmaps=!0,Kn.minFilter=Jn,Kn.needsUpdate=!0,wn.updateMultisampleRenderTarget(tr.userData.transmissionRenderTarget),wn.updateRenderTargetMipmap(tr.userData.transmissionRenderTarget)),y0(Ln,en,on),hs&&tr.userData.blurTransmissionTarget&&tr.userData.transmissionRenderTarget&&(Kn.generateMipmaps=ys,Kn.minFilter=bs,Kn.needsUpdate=!0,wn.updateMultisampleRenderTarget(tr.userData.transmissionRenderTarget),wn.updateRenderTargetMipmap(tr.userData.transmissionRenderTarget))}Nr.buffers.depth.setTest(!0),Nr.buffers.depth.setMask(!0),Nr.buffers.color.setMask(!0),Nr.setPolygonOffset(!1)}function y0(Ir,en,on){const pn={...tr.userData};tr.userData.opaqueRender=void 0,tr.userData.transparentRender=void 0,tr.userData.transmissionRender=void 0,tr.userData.backgroundRender=void 0;const bn=en.isScene===!0?en.overrideMaterial:null;for(let Ln=0,xs=Ir.length;Ln<xs;Ln++){const Kn=Ir[Ln],hs=Kn.object,ys=Kn.geometry,bs=bn===null?Kn.material:bn,as=Kn.group;hs.layers.test(on.layers)&&hw(hs,en,on,ys,bs,as)}Object.assign(tr.userData,pn)}function hw(Ir,en,on,pn,bn,Ln){Ir.onBeforeRender(tr,en,on,pn,bn,Ln),Ir.modelViewMatrix.multiplyMatrices(on.matrixWorldInverse,Ir.matrixWorld),Ir.normalMatrix.getNormalMatrix(Ir.modelViewMatrix),bn.onBeforeRender(tr,en,on,pn,Ir,Ln),bn.transparent===!0&&bn.side===At&&bn.forceSinglePass===!1?(bn.side=xt,bn.needsUpdate=!0,tr.renderBufferDirect(on,en,pn,bn,Ir,Ln),bn.side=vt,bn.needsUpdate=!0,tr.renderBufferDirect(on,en,pn,bn,Ir,Ln),bn.side=At):tr.renderBufferDirect(on,en,pn,bn,Ir,Ln),Ir.onAfterRender(tr,en,on,pn,bn,Ln),bn.onAfterRender(tr,en,on,pn,Ir,Ln)}function b0(Ir,en,on){en.isScene!==!0&&(en=Wr);const pn=Kr.get(Ir),bn=Yt.state.lights,Ln=Yt.state.shadowsArray,xs=bn.state.version,Kn=qn.getParameters(Ir,bn.state,Ln,en,on),hs=qn.getProgramCacheKey(Kn);let ys=pn.programs;pn.environment=Ir.userData&&Ir.userData.envMapSlotKey&&en.textureSlots&&en.textureSlots[Ir.userData.envMapSlotKey]?en.textureSlots[Ir.userData.envMapSlotKey]:Ir.isMeshStandardMaterial?en.environment:null,pn.fog=en.fog,pn.envMap=(Ir.isMeshStandardMaterial?ms:dn).get(Ir.envMap||pn.environment),ys===void 0&&(Ir.addEventListener("dispose",ow),ys=new Map,pn.programs=ys);let bs=ys.get(hs);if(bs!==void 0){if(pn.currentProgram===bs&&pn.lightsStateVersion===xs)return dw(Ir,Kn),bs}else Kn.uniforms=qn.getUniforms(Ir),Ir.onBuild(on,Kn,tr),Ir.onBeforeCompile(Kn,tr),bs=qn.acquireProgram(Kn,hs),ys.set(hs,bs),pn.uniforms=Kn.uniforms;const as=pn.uniforms;(Ir.isShaderMaterial||Ir.isRawShaderMaterial)&&Ir.clipping!==!0||(as.clippingPlanes=Ms.uniform),dw(Ir,Kn),pn.needsLights=function(po){return po.isMeshLambertMaterial||po.isMeshToonMaterial||po.isMeshPhongMaterial||po.isMeshStandardMaterial||po.isShadowMaterial||po.isShaderMaterial&&po.lights===!0}(Ir),pn.lightsStateVersion=xs,pn.needsLights&&(as.ambientLightColor.value=bn.state.ambient,as.lightProbe.value=bn.state.probe,as.directionalLights.value=bn.state.directional,as.directionalLightShadows.value=bn.state.directionalShadow,as.spotLights.value=bn.state.spot,as.spotLightShadows.value=bn.state.spotShadow,as.rectAreaLights.value=bn.state.rectArea,as.ltc_1.value=bn.state.rectAreaLTC1,as.ltc_2.value=bn.state.rectAreaLTC2,as.pointLights.value=bn.state.point,as.pointLightShadows.value=bn.state.pointShadow,as.hemisphereLights.value=bn.state.hemi,as.directionalShadowMap.value=bn.state.directionalShadowMap,as.directionalShadowMatrix.value=bn.state.directionalShadowMatrix,as.spotShadowMap.value=bn.state.spotShadowMap,as.spotLightMatrix.value=bn.state.spotLightMatrix,as.spotLightMap.value=bn.state.spotLightMap,as.pointShadowMap.value=bn.state.pointShadowMap,as.pointShadowMatrix.value=bn.state.pointShadowMatrix);const uo=bs.getUniforms(),Zo=Pv.seqWithValue(uo.seq,as);return pn.currentProgram=bs,pn.uniformsList=Zo,bs}function dw(Ir,en){const on=Kr.get(Ir);on.outputColorSpace=en.outputColorSpace,on.instancing=en.instancing,on.instancingColor=en.instancingColor,on.skinning=en.skinning,on.morphTargets=en.morphTargets,on.morphNormals=en.morphNormals,on.morphColors=en.morphColors,on.morphTargetsCount=en.morphTargetsCount,on.numClippingPlanes=en.numClippingPlanes,on.numIntersection=en.numClipIntersection,on.vertexAlphas=en.vertexAlphas,on.vertexTangents=en.vertexTangents,on.toneMapping=en.toneMapping}Np.setAnimationLoop(function(Ir){Iy&&Iy(Ir)}),typeof self<"u"&&Np.setContext(self),this.setAnimationLoop=function(Ir){Iy=Ir,Po.setAnimationLoop(Ir),Ir===null?Np.stop():Np.start()},Po.addEventListener("sessionstart",lw),Po.addEventListener("sessionend",cw),this.render=function(Ir,en){if(en===void 0||en.isCamera===!0){if(Ar!==!0){if(Ir.matrixWorldAutoUpdate===!0&&Ir.updateMatrixWorld(),en.parent===null&&en.matrixWorldAutoUpdate===!0&&en.updateMatrixWorld(),Po.enabled===!0&&Po.isPresenting===!0&&(Po.cameraAutoUpdate===!0&&Po.updateCamera(en),en=Po.getCamera()),Ir.isScene===!0&&Ir.onBeforeRender(tr,Ir,en,Mr),Yt=Ls.get(Ir,er.length),Yt.init(),er.push(Yt),Lr.multiplyMatrices(en.projectionMatrix,en.matrixWorldInverse),rs.setFromProjectionMatrix(Lr),Un=this.localClippingEnabled,Yn=Ms.init(this.clippingPlanes,Un),Zt=vs.get(Ir,ar.length),Zt.init(),ar.push(Zt),uw(Ir,en,0,tr.sortObjects),Zt.finish(),tr.sortObjects===!0&&Zt.sort(Xr,Jr),this.info.render.frame++,tr.userData.shadowMapRender!==!1){Yn===!0&&Ms.beginShadows();const on=Yt.state.shadowsArray;on.length>0&&$n.render(on,Ir,en),Yn===!0&&Ms.endShadows()}if(this.info.autoReset===!0&&this.info.reset(),tr.userData.backgroundRender!==!1&&ws.render(Zt,Ir),tr.userData.sceneRender!==!1)if(Yt.setupLights(tr._useLegacyLights),en.isArrayCamera){const on=en.cameras;for(let pn=0,bn=on.length;pn<bn;pn++){const Ln=on[pn];pw(Zt,Ir,Ln,Ln.viewport)}}else pw(Zt,Ir,en);Mr!==null&&(wn.updateMultisampleRenderTarget(Mr),wn.updateRenderTargetMipmap(Mr)),Ir.isScene===!0&&Ir.onAfterRender(tr,Ir,en),wu.resetDefaultState(),Qr=-1,Fr=null,er.pop(),Yt=er.length>0?er[er.length-1]:null,ar.pop(),Zt=ar.length>0?ar[ar.length-1]:null}}else console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.getActiveCubeFace=function(){return wr},this.getActiveMipmapLevel=function(){return br},this.getRenderTarget=function(){return Mr},this.setRenderTargetTextures=function(Ir,en,on){Kr.get(Ir.texture).__webglTexture=en,Kr.get(Ir.depthTexture).__webglTexture=on;const pn=Kr.get(Ir);pn.__hasExternalTextures=!0,pn.__hasExternalTextures&&(pn.__autoAllocateDepthBuffer=on===void 0,pn.__autoAllocateDepthBuffer||fr.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),pn.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(Ir,en){const on=Kr.get(Ir);on.__webglFramebuffer=en,on.__useDefaultFramebuffer=en===void 0},this.setRenderTarget=function(Ir,en=0,on=0){Mr=Ir,wr=en,br=on;let pn=!0,bn=null,Ln=!1,xs=!1;if(Ir){const Kn=Kr.get(Ir);Kn.__useDefaultFramebuffer!==void 0?(Nr.bindFramebuffer(_i.FRAMEBUFFER,null),pn=!1):Kn.__webglFramebuffer===void 0?wn.setupRenderTarget(Ir):Kn.__hasExternalTextures&&wn.rebindTextures(Ir,Kr.get(Ir.texture).__webglTexture,Kr.get(Ir.depthTexture).__webglTexture);const hs=Ir.texture;(hs.isData3DTexture||hs.isDataArrayTexture||hs.isCompressedArrayTexture)&&(xs=!0);const ys=Kr.get(Ir).__webglFramebuffer;Ir.isWebGLCubeRenderTarget?(bn=Array.isArray(ys[en])?ys[en][on]:ys[en],Ln=!0):bn=Or.isWebGL2&&Ir.samples>0&&wn.useMultisampledRTT(Ir)===!1?Kr.get(Ir).__webglMultisampledFramebuffer:Array.isArray(ys)?ys[on]:ys,Vr.copy(Ir.viewport),zr.copy(Ir.scissor),Hr=Ir.scissorTest}else Vr.copy(an).multiplyScalar(un).floor(),zr.copy(sn).multiplyScalar(un).floor(),Hr=Fn;if(Nr.bindFramebuffer(_i.FRAMEBUFFER,bn)&&Or.drawBuffers&&pn&&Nr.drawBuffers(Ir,bn),Nr.viewport(Vr),Nr.scissor(zr),Nr.setScissorTest(Hr),Ln){const Kn=Kr.get(Ir.texture);_i.framebufferTexture2D(_i.FRAMEBUFFER,_i.COLOR_ATTACHMENT0,_i.TEXTURE_CUBE_MAP_POSITIVE_X+en,Kn.__webglTexture,on)}else if(xs){const Kn=Kr.get(Ir.texture),hs=en||0;_i.framebufferTextureLayer(_i.FRAMEBUFFER,_i.COLOR_ATTACHMENT0,Kn.__webglTexture,on||0,hs)}Qr=-1},this.readRenderTargetPixels=function(Ir,en,on,pn,bn,Ln,xs,Kn){if(!Ir||!Ir.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let hs=Kr.get(Ir).__webglFramebuffer;if(Ir.isWebGLCubeRenderTarget&&xs!==void 0&&(hs=hs[xs]),hs){Nr.bindFramebuffer(_i.FRAMEBUFFER,hs);try{const ys=Array.isArray(Ir.texture)?Ir.texture[Kn||0]:Ir.texture,bs=ys.format,as=ys.type;if(bs!==no&&Es.convert(bs)!==_i.getParameter(_i.IMPLEMENTATION_COLOR_READ_FORMAT))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");const uo=as===xa&&(fr.has("EXT_color_buffer_half_float")||Or.isWebGL2&&fr.has("EXT_color_buffer_float"));if(!(as===Gs||Es.convert(as)===_i.getParameter(_i.IMPLEMENTATION_COLOR_READ_TYPE)||as===ro&&(Or.isWebGL2||fr.has("OES_texture_float")||fr.has("WEBGL_color_buffer_float"))||uo))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");en>=0&&en<=Ir.width-pn&&on>=0&&on<=Ir.height-bn&&(Ir.isWebGLMultipleRenderTargets&&_i.readBuffer(_i.COLOR_ATTACHMENT0+Kn),_i.readPixels(en,on,pn,bn,Es.convert(bs),Es.convert(as),Ln))}finally{const ys=Mr?Kr.get(Mr).__webglFramebuffer:null;Nr.bindFramebuffer(_i.FRAMEBUFFER,ys)}}},this.copyFramebufferToTexture=function(Ir,en,on=0){const pn=Math.pow(2,-on),bn=Math.floor(en.image.width*pn),Ln=Math.floor(en.image.height*pn);wn.setTexture2D(en,0),_i.copyTexSubImage2D(_i.TEXTURE_2D,on,0,0,Ir.x,Ir.y,bn,Ln),Nr.unbindTexture()},this.copyTextureToTexture=function(Ir,en,on,pn=0){const bn=en.image.width,Ln=en.image.height,xs=Es.convert(on.format),Kn=Es.convert(on.type);wn.setTexture2D(on,0),_i.pixelStorei(_i.UNPACK_FLIP_Y_WEBGL,on.flipY),_i.pixelStorei(_i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,on.premultiplyAlpha),_i.pixelStorei(_i.UNPACK_ALIGNMENT,on.unpackAlignment),en.isDataTexture?_i.texSubImage2D(_i.TEXTURE_2D,pn,Ir.x,Ir.y,bn,Ln,xs,Kn,en.image.data):en.isCompressedTexture?_i.compressedTexSubImage2D(_i.TEXTURE_2D,pn,Ir.x,Ir.y,en.mipmaps[0].width,en.mipmaps[0].height,xs,en.mipmaps[0].data):_i.texSubImage2D(_i.TEXTURE_2D,pn,Ir.x,Ir.y,xs,Kn,en.image),pn===0&&on.generateMipmaps&&_i.generateMipmap(_i.TEXTURE_2D),Nr.unbindTexture()},this.copyTextureToTexture3D=function(Ir,en,on,pn,bn=0){if(tr.isWebGL1Renderer)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");const Ln=Ir.max.x-Ir.min.x+1,xs=Ir.max.y-Ir.min.y+1,Kn=Ir.max.z-Ir.min.z+1,hs=Es.convert(pn.format),ys=Es.convert(pn.type);let bs;if(pn.isData3DTexture)wn.setTexture3D(pn,0),bs=_i.TEXTURE_3D;else{if(!pn.isDataArrayTexture)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");wn.setTexture2DArray(pn,0),bs=_i.TEXTURE_2D_ARRAY}_i.pixelStorei(_i.UNPACK_FLIP_Y_WEBGL,pn.flipY),_i.pixelStorei(_i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,pn.premultiplyAlpha),_i.pixelStorei(_i.UNPACK_ALIGNMENT,pn.unpackAlignment);const as=_i.getParameter(_i.UNPACK_ROW_LENGTH),uo=_i.getParameter(_i.UNPACK_IMAGE_HEIGHT),Zo=_i.getParameter(_i.UNPACK_SKIP_PIXELS),po=_i.getParameter(_i.UNPACK_SKIP_ROWS),tp=_i.getParameter(_i.UNPACK_SKIP_IMAGES),ba=on.isCompressedTexture?on.mipmaps[0]:on.image;_i.pixelStorei(_i.UNPACK_ROW_LENGTH,ba.width),_i.pixelStorei(_i.UNPACK_IMAGE_HEIGHT,ba.height),_i.pixelStorei(_i.UNPACK_SKIP_PIXELS,Ir.min.x),_i.pixelStorei(_i.UNPACK_SKIP_ROWS,Ir.min.y),_i.pixelStorei(_i.UNPACK_SKIP_IMAGES,Ir.min.z),on.isDataTexture||on.isData3DTexture?_i.texSubImage3D(bs,bn,en.x,en.y,en.z,Ln,xs,Kn,hs,ys,ba.data):on.isCompressedArrayTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),_i.compressedTexSubImage3D(bs,bn,en.x,en.y,en.z,Ln,xs,Kn,hs,ba.data)):_i.texSubImage3D(bs,bn,en.x,en.y,en.z,Ln,xs,Kn,hs,ys,ba),_i.pixelStorei(_i.UNPACK_ROW_LENGTH,as),_i.pixelStorei(_i.UNPACK_IMAGE_HEIGHT,uo),_i.pixelStorei(_i.UNPACK_SKIP_PIXELS,Zo),_i.pixelStorei(_i.UNPACK_SKIP_ROWS,po),_i.pixelStorei(_i.UNPACK_SKIP_IMAGES,tp),bn===0&&pn.generateMipmaps&&_i.generateMipmap(bs),Nr.unbindTexture()},this.initTexture=function(Ir){Ir.isCubeTexture?wn.setTextureCube(Ir,0):Ir.isData3DTexture?wn.setTexture3D(Ir,0):Ir.isDataArrayTexture||Ir.isCompressedArrayTexture?wn.setTexture2DArray(Ir,0):wn.setTexture2D(Ir,0),Nr.unbindTexture()},this.resetState=function(){wr=0,br=0,Mr=null,Nr.reset(),wu.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return jo}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(tt){this._outputColorSpace=tt;const lt=this.getContext();lt.drawingBufferColorSpace=tt===up?"display-p3":"srgb",lt.unpackColorSpace=Is.workingColorSpace===cu?"display-p3":"srgb"}get physicallyCorrectLights(){return console.warn("THREE.WebGLRenderer: The property .physicallyCorrectLights has been removed. Set renderer.useLegacyLights instead."),!this.useLegacyLights}set physicallyCorrectLights(tt){console.warn("THREE.WebGLRenderer: The property .physicallyCorrectLights has been removed. Set renderer.useLegacyLights instead."),this.useLegacyLights=!tt}get outputEncoding(){return console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace===Ns?Dl:Ks}set outputEncoding(tt){console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace=tt===Dl?Ns:qs}get useLegacyLights(){return console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733."),this._useLegacyLights}set useLegacyLights(tt){console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733."),this._useLegacyLights=tt}}class xx extends bx{}xx.prototype.isWebGL1Renderer=!0;class Tv{constructor(tt,lt=25e-5){this.isFogExp2=!0,this.name="",this.color=new jn(tt),this.density=lt}clone(){return new Tv(this.color,this.density)}toJSON(){return{type:"FogExp2",name:this.name,color:this.color.getHex(),density:this.density}}}class Mv{constructor(tt,lt=1,ht=1e3){this.isFog=!0,this.name="",this.color=new jn(tt),this.near=lt,this.far=ht}clone(){return new Mv(this.color,this.near,this.far)}toJSON(){return{type:"Fog",name:this.name,color:this.color.getHex(),near:this.near,far:this.far}}}class Ax extends Cs{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(tt,lt){return super.copy(tt,lt),tt.background!==null&&(this.background=tt.background.clone()),tt.environment!==null&&(this.environment=tt.environment.clone()),tt.fog!==null&&(this.fog=tt.fog.clone()),this.backgroundBlurriness=tt.backgroundBlurriness,this.backgroundIntensity=tt.backgroundIntensity,tt.overrideMaterial!==null&&(this.overrideMaterial=tt.overrideMaterial.clone()),this.matrixAutoUpdate=tt.matrixAutoUpdate,this}toJSON(tt){const lt=super.toJSON(tt);return this.fog!==null&&(lt.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(lt.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(lt.object.backgroundIntensity=this.backgroundIntensity),lt}}class Iv{constructor(tt,lt){this.isInterleavedBuffer=!0,this.array=tt,this.stride=lt,this.count=tt!==void 0?tt.length/lt:0,this.usage=Du,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=Ao()}onUploadCallback(){}set needsUpdate(tt){tt===!0&&this.version++}setUsage(tt){return this.usage=tt,this}copy(tt){return this.array=new tt.array.constructor(tt.array),this.count=tt.count,this.stride=tt.stride,this.usage=tt.usage,this}copyAt(tt,lt,ht){tt*=this.stride,ht*=lt.stride;for(let _t=0,bt=this.stride;_t<bt;_t++)this.array[tt+_t]=lt.array[ht+_t];return this}set(tt,lt=0){return this.array.set(tt,lt),this}clone(tt){tt.arrayBuffers===void 0&&(tt.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Ao()),tt.arrayBuffers[this.array.buffer._uuid]===void 0&&(tt.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const lt=new this.array.constructor(tt.arrayBuffers[this.array.buffer._uuid]),ht=new this.constructor(lt,this.stride);return ht.setUsage(this.usage),ht}onUpload(tt){return this.onUploadCallback=tt,this}toJSON(tt){return tt.arrayBuffers===void 0&&(tt.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Ao()),tt.arrayBuffers[this.array.buffer._uuid]===void 0&&(tt.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const Lo=new Sr;class Cp{constructor(tt,lt,ht,_t=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=tt,this.itemSize=lt,this.offset=ht,this.normalized=_t}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(tt){this.data.needsUpdate=tt}applyMatrix4(tt){for(let lt=0,ht=this.data.count;lt<ht;lt++)Lo.fromBufferAttribute(this,lt),Lo.applyMatrix4(tt),this.setXYZ(lt,Lo.x,Lo.y,Lo.z);return this}applyNormalMatrix(tt){for(let lt=0,ht=this.count;lt<ht;lt++)Lo.fromBufferAttribute(this,lt),Lo.applyNormalMatrix(tt),this.setXYZ(lt,Lo.x,Lo.y,Lo.z);return this}transformDirection(tt){for(let lt=0,ht=this.count;lt<ht;lt++)Lo.fromBufferAttribute(this,lt),Lo.transformDirection(tt),this.setXYZ(lt,Lo.x,Lo.y,Lo.z);return this}setX(tt,lt){return this.normalized&&(lt=ss(lt,this.array)),this.data.array[tt*this.data.stride+this.offset]=lt,this}setY(tt,lt){return this.normalized&&(lt=ss(lt,this.array)),this.data.array[tt*this.data.stride+this.offset+1]=lt,this}setZ(tt,lt){return this.normalized&&(lt=ss(lt,this.array)),this.data.array[tt*this.data.stride+this.offset+2]=lt,this}setW(tt,lt){return this.normalized&&(lt=ss(lt,this.array)),this.data.array[tt*this.data.stride+this.offset+3]=lt,this}getX(tt){let lt=this.data.array[tt*this.data.stride+this.offset];return this.normalized&&(lt=_o(lt,this.array)),lt}getY(tt){let lt=this.data.array[tt*this.data.stride+this.offset+1];return this.normalized&&(lt=_o(lt,this.array)),lt}getZ(tt){let lt=this.data.array[tt*this.data.stride+this.offset+2];return this.normalized&&(lt=_o(lt,this.array)),lt}getW(tt){let lt=this.data.array[tt*this.data.stride+this.offset+3];return this.normalized&&(lt=_o(lt,this.array)),lt}setXY(tt,lt,ht){return tt=tt*this.data.stride+this.offset,this.normalized&&(lt=ss(lt,this.array),ht=ss(ht,this.array)),this.data.array[tt+0]=lt,this.data.array[tt+1]=ht,this}setXYZ(tt,lt,ht,_t){return tt=tt*this.data.stride+this.offset,this.normalized&&(lt=ss(lt,this.array),ht=ss(ht,this.array),_t=ss(_t,this.array)),this.data.array[tt+0]=lt,this.data.array[tt+1]=ht,this.data.array[tt+2]=_t,this}setXYZW(tt,lt,ht,_t,bt){return tt=tt*this.data.stride+this.offset,this.normalized&&(lt=ss(lt,this.array),ht=ss(ht,this.array),_t=ss(_t,this.array),bt=ss(bt,this.array)),this.data.array[tt+0]=lt,this.data.array[tt+1]=ht,this.data.array[tt+2]=_t,this.data.array[tt+3]=bt,this}clone(tt){if(tt===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const lt=[];for(let ht=0;ht<this.count;ht++){const _t=ht*this.data.stride+this.offset;for(let bt=0;bt<this.itemSize;bt++)lt.push(this.data.array[_t+bt])}return new gr(new this.array.constructor(lt),this.itemSize,this.normalized)}return tt.interleavedBuffers===void 0&&(tt.interleavedBuffers={}),tt.interleavedBuffers[this.data.uuid]===void 0&&(tt.interleavedBuffers[this.data.uuid]=this.data.clone(tt)),new Cp(tt.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(tt){if(tt===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const lt=[];for(let ht=0;ht<this.count;ht++){const _t=ht*this.data.stride+this.offset;for(let bt=0;bt<this.itemSize;bt++)lt.push(this.data.array[_t+bt])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:lt,normalized:this.normalized}}return tt.interleavedBuffers===void 0&&(tt.interleavedBuffers={}),tt.interleavedBuffers[this.data.uuid]===void 0&&(tt.interleavedBuffers[this.data.uuid]=this.data.toJSON(tt)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class q0 extends ao{constructor(tt){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new jn(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(tt)}copy(tt){return super.copy(tt),this.color.copy(tt.color),this.map=tt.map,this.alphaMap=tt.alphaMap,this.rotation=tt.rotation,this.sizeAttenuation=tt.sizeAttenuation,this.fog=tt.fog,this}}let wm;const y_=new Sr,Em=new Sr,Sm=new Sr,Cm=new mn,b_=new mn,wx=new is,Rv=new Sr,x_=new Sr,kv=new Sr,Ex=new mn,$0=new mn,Sx=new mn;class Cx extends Cs{constructor(tt=new q0){if(super(),this.isSprite=!0,this.type="Sprite",wm===void 0){wm=new fs;const lt=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),ht=new Iv(lt,5);wm.setIndex([0,1,2,0,2,3]),wm.setAttribute("position",new Cp(ht,3,0,!1)),wm.setAttribute("uv",new Cp(ht,2,3,!1))}this.geometry=wm,this.material=tt,this.center=new mn(.5,.5)}raycast(tt,lt){tt.camera===null&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),Em.setFromMatrixScale(this.matrixWorld),wx.copy(tt.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(tt.camera.matrixWorldInverse,this.matrixWorld),Sm.setFromMatrixPosition(this.modelViewMatrix),tt.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&Em.multiplyScalar(-Sm.z);const ht=this.material.rotation;let _t,bt;ht!==0&&(bt=Math.cos(ht),_t=Math.sin(ht));const Pt=this.center;Dv(Rv.set(-.5,-.5,0),Sm,Pt,Em,_t,bt),Dv(x_.set(.5,-.5,0),Sm,Pt,Em,_t,bt),Dv(kv.set(.5,.5,0),Sm,Pt,Em,_t,bt),Ex.set(0,0),$0.set(1,0),Sx.set(1,1);let Mt=tt.ray.intersectTriangle(Rv,x_,kv,!1,y_);if(Mt===null&&(Dv(x_.set(-.5,.5,0),Sm,Pt,Em,_t,bt),$0.set(0,1),Mt=tt.ray.intersectTriangle(Rv,kv,x_,!1,y_),Mt===null))return;const Lt=tt.ray.origin.distanceTo(y_);Lt<tt.near||Lt>tt.far||lt.push({distance:Lt,point:y_.clone(),uv:vo.getInterpolation(y_,Rv,x_,kv,Ex,$0,Sx,new mn),face:null,object:this})}copy(tt,lt){return super.copy(tt,lt),tt.center!==void 0&&this.center.copy(tt.center),this.material=tt.material,this}}function Dv(St,tt,lt,ht,_t,bt){Cm.subVectors(St,lt).addScalar(.5).multiply(ht),_t!==void 0?(b_.x=bt*Cm.x-_t*Cm.y,b_.y=_t*Cm.x+bt*Cm.y):b_.copy(Cm),St.copy(tt),St.x+=b_.x,St.y+=b_.y,St.applyMatrix4(wx)}const Bv=new Sr,Px=new Sr;class Tx extends Cs{constructor(){super(),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(tt){super.copy(tt,!1);const lt=tt.levels;for(let ht=0,_t=lt.length;ht<_t;ht++){const bt=lt[ht];this.addLevel(bt.object.clone(),bt.distance,bt.hysteresis)}return this.autoUpdate=tt.autoUpdate,this}addLevel(tt,lt=0,ht=0){lt=Math.abs(lt);const _t=this.levels;let bt;for(bt=0;bt<_t.length&&!(lt<_t[bt].distance);bt++);return _t.splice(bt,0,{distance:lt,hysteresis:ht,object:tt}),this.add(tt),this}getCurrentLevel(){return this._currentLevel}getObjectForDistance(tt){const lt=this.levels;if(lt.length>0){let ht,_t;for(ht=1,_t=lt.length;ht<_t;ht++){let bt=lt[ht].distance;if(lt[ht].object.visible&&(bt-=bt*lt[ht].hysteresis),tt<bt)break}return lt[ht-1].object}return null}raycast(tt,lt){if(this.levels.length>0){Bv.setFromMatrixPosition(this.matrixWorld);const ht=tt.ray.origin.distanceTo(Bv);this.getObjectForDistance(ht).raycast(tt,lt)}}update(tt){const lt=this.levels;if(lt.length>1){Bv.setFromMatrixPosition(tt.matrixWorld),Px.setFromMatrixPosition(this.matrixWorld);const ht=Bv.distanceTo(Px)/tt.zoom;let _t,bt;for(lt[0].object.visible=!0,_t=1,bt=lt.length;_t<bt;_t++){let Pt=lt[_t].distance;if(lt[_t].object.visible&&(Pt-=Pt*lt[_t].hysteresis),!(ht>=Pt))break;lt[_t-1].object.visible=!1,lt[_t].object.visible=!0}for(this._currentLevel=_t-1;_t<bt;_t++)lt[_t].object.visible=!1}}toJSON(tt){const lt=super.toJSON(tt);this.autoUpdate===!1&&(lt.object.autoUpdate=!1),lt.object.levels=[];const ht=this.levels;for(let _t=0,bt=ht.length;_t<bt;_t++){const Pt=ht[_t];lt.object.levels.push({object:Pt.object.uuid,distance:Pt.distance,hysteresis:Pt.hysteresis})}return lt}}const Mx=new Sr,Ix=new Rs,Rx=new Rs,sE=new Sr,kx=new is,Pm=new Sr,X0=new Go,Dx=new is,Y0=new Gu;class Bx extends co{constructor(tt,lt){super(tt,lt),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new is,this.bindMatrixInverse=new is,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const tt=this.geometry;this.boundingBox===null&&(this.boundingBox=new Al),this.boundingBox.makeEmpty();const lt=tt.getAttribute("position");for(let ht=0;ht<lt.count;ht++)Pm.fromBufferAttribute(lt,ht),this.applyBoneTransform(ht,Pm),this.boundingBox.expandByPoint(Pm)}computeBoundingSphere(){const tt=this.geometry;this.boundingSphere===null&&(this.boundingSphere=new Go),this.boundingSphere.makeEmpty();const lt=tt.getAttribute("position");for(let ht=0;ht<lt.count;ht++)Pm.fromBufferAttribute(lt,ht),this.applyBoneTransform(ht,Pm),this.boundingSphere.expandByPoint(Pm)}copy(tt,lt){return super.copy(tt,lt),this.bindMode=tt.bindMode,this.bindMatrix.copy(tt.bindMatrix),this.bindMatrixInverse.copy(tt.bindMatrixInverse),this.skeleton=tt.skeleton,tt.boundingBox!==null&&(this.boundingBox=tt.boundingBox.clone()),tt.boundingSphere!==null&&(this.boundingSphere=tt.boundingSphere.clone()),this}raycast(tt,lt){const ht=this.material,_t=this.matrixWorld;ht!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),X0.copy(this.boundingSphere),X0.applyMatrix4(_t),tt.ray.intersectsSphere(X0)!==!1&&(Dx.copy(_t).invert(),Y0.copy(tt.ray).applyMatrix4(Dx),this.boundingBox!==null&&Y0.intersectsBox(this.boundingBox)===!1||this._computeIntersections(tt,lt,Y0)))}getVertexPosition(tt,lt){return super.getVertexPosition(tt,lt),this.applyBoneTransform(tt,lt),lt}bind(tt,lt){this.skeleton=tt,lt===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),lt=this.matrixWorld),this.bindMatrix.copy(lt),this.bindMatrixInverse.copy(lt).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const tt=new Rs,lt=this.geometry.attributes.skinWeight;for(let ht=0,_t=lt.count;ht<_t;ht++){tt.fromBufferAttribute(lt,ht);const bt=1/tt.manhattanLength();bt!==1/0?tt.multiplyScalar(bt):tt.set(1,0,0,0),lt.setXYZW(ht,tt.x,tt.y,tt.z,tt.w)}}updateMatrixWorld(tt){super.updateMatrixWorld(tt),this.bindMode==="attached"?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode==="detached"?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(tt,lt){const ht=this.skeleton,_t=this.geometry;Ix.fromBufferAttribute(_t.attributes.skinIndex,tt),Rx.fromBufferAttribute(_t.attributes.skinWeight,tt),Mx.copy(lt).applyMatrix4(this.bindMatrix),lt.set(0,0,0);for(let bt=0;bt<4;bt++){const Pt=Rx.getComponent(bt);if(Pt!==0){const Mt=Ix.getComponent(bt);kx.multiplyMatrices(ht.bones[Mt].matrixWorld,ht.boneInverses[Mt]),lt.addScaledVector(sE.copy(Mx).applyMatrix4(kx),Pt)}}return lt.applyMatrix4(this.bindMatrixInverse)}boneTransform(tt,lt){return console.warn("THREE.SkinnedMesh: .boneTransform() was renamed to .applyBoneTransform() in r151."),this.applyBoneTransform(tt,lt)}}class K0 extends Cs{constructor(){super(),this.isBone=!0,this.type="Bone"}}class Tm extends js{constructor(tt=null,lt=1,ht=1,_t,bt,Pt,Mt,Lt,Nt=rn,jt=rn,Wt,Qt){super(null,Pt,Mt,Lt,Nt,jt,_t,bt,Wt,Qt),this.isDataTexture=!0,this.image={data:tt,width:lt,height:ht},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const Lx=new is,aE=new is;class Lv{constructor(tt=[],lt=[]){this.uuid=Ao(),this.bones=tt.slice(0),this.boneInverses=lt,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.init()}init(){const tt=this.bones,lt=this.boneInverses;if(this.boneMatrices=new Float32Array(16*tt.length),lt.length===0)this.calculateInverses();else if(tt.length!==lt.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let ht=0,_t=this.bones.length;ht<_t;ht++)this.boneInverses.push(new is)}}calculateInverses(){this.boneInverses.length=0;for(let tt=0,lt=this.bones.length;tt<lt;tt++){const ht=new is;this.bones[tt]&&ht.copy(this.bones[tt].matrixWorld).invert(),this.boneInverses.push(ht)}}pose(){for(let tt=0,lt=this.bones.length;tt<lt;tt++){const ht=this.bones[tt];ht&&ht.matrixWorld.copy(this.boneInverses[tt]).invert()}for(let tt=0,lt=this.bones.length;tt<lt;tt++){const ht=this.bones[tt];ht&&(ht.parent&&ht.parent.isBone?(ht.matrix.copy(ht.parent.matrixWorld).invert(),ht.matrix.multiply(ht.matrixWorld)):ht.matrix.copy(ht.matrixWorld),ht.matrix.decompose(ht.position,ht.quaternion,ht.scale))}}update(){const tt=this.bones,lt=this.boneInverses,ht=this.boneMatrices,_t=this.boneTexture;for(let bt=0,Pt=tt.length;bt<Pt;bt++){const Mt=tt[bt]?tt[bt].matrixWorld:aE;Lx.multiplyMatrices(Mt,lt[bt]),Lx.toArray(ht,16*bt)}_t!==null&&(_t.needsUpdate=!0)}clone(){return new Lv(this.bones,this.boneInverses)}computeBoneTexture(){let tt=Math.sqrt(4*this.bones.length);tt=Km(tt),tt=Math.max(tt,4);const lt=new Float32Array(tt*tt*4);lt.set(this.boneMatrices);const ht=new Tm(lt,tt,tt,no,ro);return ht.needsUpdate=!0,this.boneMatrices=lt,this.boneTexture=ht,this.boneTextureSize=tt,this}getBoneByName(tt){for(let lt=0,ht=this.bones.length;lt<ht;lt++){const _t=this.bones[lt];if(_t.name===tt)return _t}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(tt,lt){this.uuid=tt.uuid;for(let ht=0,_t=tt.bones.length;ht<_t;ht++){const bt=tt.bones[ht];let Pt=lt[bt];Pt===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",bt),Pt=new K0),this.bones.push(Pt),this.boneInverses.push(new is().fromArray(tt.boneInverses[ht]))}return this.init(),this}toJSON(){const tt={metadata:{version:4.6,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};tt.uuid=this.uuid;const lt=this.bones,ht=this.boneInverses;for(let _t=0,bt=lt.length;_t<bt;_t++){const Pt=lt[_t];tt.bones.push(Pt.uuid);const Mt=ht[_t];tt.boneInverses.push(Mt.toArray())}return tt}}class Mm extends gr{constructor(tt,lt,ht,_t=1){super(tt,lt,ht),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=_t}copy(tt){return super.copy(tt),this.meshPerAttribute=tt.meshPerAttribute,this}toJSON(){const tt=super.toJSON();return tt.meshPerAttribute=this.meshPerAttribute,tt.isInstancedBufferAttribute=!0,tt}}const Im=new is,Ox=new is,Ov=[],Nx=new Al,oE=new is,A_=new co,w_=new Go;class Fx extends co{constructor(tt,lt,ht){super(tt,lt),this.isInstancedMesh=!0,this.instanceMatrix=new Mm(new Float32Array(16*ht),16),this.instanceColor=null,this.sourceTrs=null,this.count=ht,this.boundingBox=null,this.boundingSphere=null;for(let _t=0;_t<ht;_t++)this.setMatrixAt(_t,oE)}computeBoundingBox(){const tt=this.geometry,lt=this.count;this.boundingBox===null&&(this.boundingBox=new Al),tt.boundingBox===null&&tt.computeBoundingBox(),this.boundingBox.makeEmpty();for(let ht=0;ht<lt;ht++)this.getMatrixAt(ht,Im),Nx.copy(tt.boundingBox).applyMatrix4(Im),this.boundingBox.union(Nx)}computeBoundingSphere(){const tt=this.geometry,lt=this.count;this.boundingSphere===null&&(this.boundingSphere=new Go),tt.boundingSphere===null&&tt.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let ht=0;ht<lt;ht++)this.getMatrixAt(ht,Im),w_.copy(tt.boundingSphere).applyMatrix4(Im),this.boundingSphere.union(w_)}copy(tt,lt){return super.copy(tt,lt),tt.isInstancedMesh?(this.instanceMatrix.copy(tt.instanceMatrix),tt.instanceColor!==null&&(this.instanceColor=tt.instanceColor.clone()),this.count=tt.count,tt.boundingBox!==null&&(this.boundingBox=tt.boundingBox.clone()),tt.boundingSphere!==null&&(this.boundingSphere=tt.boundingSphere.clone()),this):this}getColorAt(tt,lt){lt.fromArray(this.instanceColor.array,3*tt)}getMatrixAt(tt,lt){lt.fromArray(this.instanceMatrix.array,16*tt)}raycast(tt,lt){const ht=this.matrixWorld,_t=this.count;if(A_.geometry=this.geometry,A_.material=this.material,A_.material!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),w_.copy(this.boundingSphere),w_.applyMatrix4(ht),tt.ray.intersectsSphere(w_)!==!1))for(let bt=0;bt<_t;bt++){this.getMatrixAt(bt,Im),Ox.multiplyMatrices(ht,Im),A_.matrixWorld=Ox,A_.raycast(tt,Ov);for(let Pt=0,Mt=Ov.length;Pt<Mt;Pt++){const Lt=Ov[Pt];Lt.instanceId=bt,Lt.object=this,lt.push(Lt)}Ov.length=0}}setColorAt(tt,lt){this.instanceColor===null&&(this.instanceColor=new Mm(new Float32Array(3*this.instanceMatrix.count),3)),lt.toArray(this.instanceColor.array,3*tt)}setMatrixAt(tt,lt){lt.toArray(this.instanceMatrix.array,16*tt)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}class Oo extends ao{constructor(tt){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new jn(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(tt)}copy(tt){return super.copy(tt),this.color.copy(tt.color),this.map=tt.map,this.linewidth=tt.linewidth,this.linecap=tt.linecap,this.linejoin=tt.linejoin,this.fog=tt.fog,this}}const Ux=new Sr,jx=new Sr,Gx=new is,J0=new Gu,Nv=new Go;class Ku extends Cs{constructor(tt=new fs,lt=new Oo){super(),this.isLine=!0,this.type="Line",this.geometry=tt,this.material=lt,this.updateMorphTargets()}copy(tt,lt){return super.copy(tt,lt),this.material=Array.isArray(tt.material)?tt.material.slice():tt.material,this.geometry=tt.geometry,this}computeLineDistances(){const tt=this.geometry;if(tt.index===null){const lt=tt.attributes.position,ht=[0];for(let _t=1,bt=lt.count;_t<bt;_t++)Ux.fromBufferAttribute(lt,_t-1),jx.fromBufferAttribute(lt,_t),ht[_t]=ht[_t-1],ht[_t]+=Ux.distanceTo(jx);tt.setAttribute("lineDistance",new On(ht,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(tt,lt){const ht=this.geometry,_t=this.matrixWorld,bt=tt.params.Line.threshold,Pt=ht.drawRange;if(ht.boundingSphere===null&&ht.computeBoundingSphere(),Nv.copy(ht.boundingSphere),Nv.applyMatrix4(_t),Nv.radius+=bt,tt.ray.intersectsSphere(Nv)===!1)return;Gx.copy(_t).invert(),J0.copy(tt.ray).applyMatrix4(Gx);const Mt=bt/((this.scale.x+this.scale.y+this.scale.z)/3),Lt=Mt*Mt,Nt=new Sr,jt=new Sr,Wt=new Sr,Qt=new Sr,qt=this.isLineSegments?2:1,Xt=ht.index,Zt=ht.attributes.position;if(Xt!==null)for(let Yt=Math.max(0,Pt.start),ar=Math.min(Xt.count,Pt.start+Pt.count)-1;Yt<ar;Yt+=qt){const er=Xt.getX(Yt),tr=Xt.getX(Yt+1);if(Nt.fromBufferAttribute(Zt,er),jt.fromBufferAttribute(Zt,tr),J0.distanceSqToSegment(Nt,jt,Qt,Wt)>Lt)continue;Qt.applyMatrix4(this.matrixWorld);const Ar=tt.ray.origin.distanceTo(Qt);Ar<tt.near||Ar>tt.far||lt.push({distance:Ar,point:Wt.clone().applyMatrix4(this.matrixWorld),index:Yt,face:null,faceIndex:null,object:this})}else for(let Yt=Math.max(0,Pt.start),ar=Math.min(Zt.count,Pt.start+Pt.count)-1;Yt<ar;Yt+=qt){if(Nt.fromBufferAttribute(Zt,Yt),jt.fromBufferAttribute(Zt,Yt+1),J0.distanceSqToSegment(Nt,jt,Qt,Wt)>Lt)continue;Qt.applyMatrix4(this.matrixWorld);const er=tt.ray.origin.distanceTo(Qt);er<tt.near||er>tt.far||lt.push({distance:er,point:Wt.clone().applyMatrix4(this.matrixWorld),index:Yt,face:null,faceIndex:null,object:this})}}updateMorphTargets(){const tt=this.geometry.morphAttributes,lt=Object.keys(tt);if(lt.length>0){const ht=tt[lt[0]];if(ht!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let _t=0,bt=ht.length;_t<bt;_t++){const Pt=ht[_t].name||String(_t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[Pt]=_t}}}}}const zx=new Sr,Vx=new Sr;class eu extends Ku{constructor(tt,lt){super(tt,lt),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const tt=this.geometry;if(tt.index===null){const lt=tt.attributes.position,ht=[];for(let _t=0,bt=lt.count;_t<bt;_t+=2)zx.fromBufferAttribute(lt,_t),Vx.fromBufferAttribute(lt,_t+1),ht[_t]=_t===0?0:ht[_t-1],ht[_t+1]=ht[_t]+zx.distanceTo(Vx);tt.setAttribute("lineDistance",new On(ht,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class Hx extends Ku{constructor(tt,lt){super(tt,lt),this.isLineLoop=!0,this.type="LineLoop"}}class Z0 extends ao{constructor(tt){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new jn(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(tt)}copy(tt){return super.copy(tt),this.color.copy(tt.color),this.map=tt.map,this.alphaMap=tt.alphaMap,this.size=tt.size,this.sizeAttenuation=tt.sizeAttenuation,this.fog=tt.fog,this}}const Qx=new is,ey=new Gu,Fv=new Go,Uv=new Sr;class Wx extends Cs{constructor(tt=new fs,lt=new Z0){super(),this.isPoints=!0,this.type="Points",this.geometry=tt,this.material=lt,this.updateMorphTargets()}copy(tt,lt){return super.copy(tt,lt),this.material=Array.isArray(tt.material)?tt.material.slice():tt.material,this.geometry=tt.geometry,this}raycast(tt,lt){const ht=this.geometry,_t=this.matrixWorld,bt=tt.params.Points.threshold,Pt=ht.drawRange;if(ht.boundingSphere===null&&ht.computeBoundingSphere(),Fv.copy(ht.boundingSphere),Fv.applyMatrix4(_t),Fv.radius+=bt,tt.ray.intersectsSphere(Fv)===!1)return;Qx.copy(_t).invert(),ey.copy(tt.ray).applyMatrix4(Qx);const Mt=bt/((this.scale.x+this.scale.y+this.scale.z)/3),Lt=Mt*Mt,Nt=ht.index,jt=ht.attributes.position;if(Nt!==null)for(let Wt=Math.max(0,Pt.start),Qt=Math.min(Nt.count,Pt.start+Pt.count);Wt<Qt;Wt++){const qt=Nt.getX(Wt);Uv.fromBufferAttribute(jt,qt),qx(Uv,qt,Lt,_t,tt,lt,this)}else for(let Wt=Math.max(0,Pt.start),Qt=Math.min(jt.count,Pt.start+Pt.count);Wt<Qt;Wt++)Uv.fromBufferAttribute(jt,Wt),qx(Uv,Wt,Lt,_t,tt,lt,this)}updateMorphTargets(){const tt=this.geometry.morphAttributes,lt=Object.keys(tt);if(lt.length>0){const ht=tt[lt[0]];if(ht!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let _t=0,bt=ht.length;_t<bt;_t++){const Pt=ht[_t].name||String(_t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[Pt]=_t}}}}}function qx(St,tt,lt,ht,_t,bt,Pt){const Mt=ey.distanceSqToPoint(St);if(Mt<lt){const Lt=new Sr;ey.closestPointToPoint(St,Lt),Lt.applyMatrix4(ht);const Nt=_t.ray.origin.distanceTo(Lt);if(Nt<_t.near||Nt>_t.far)return;bt.push({distance:Nt,distanceToRay:Math.sqrt(Mt),point:Lt,index:tt,face:null,object:Pt})}}class lE extends js{constructor(tt,lt,ht,_t,bt,Pt,Mt,Lt,Nt){super(tt,lt,ht,_t,bt,Pt,Mt,Lt,Nt),this.isVideoTexture=!0,this.minFilter=Pt!==void 0?Pt:Wn,this.magFilter=bt!==void 0?bt:Wn,this.generateMipmaps=!1;const jt=this;"requestVideoFrameCallback"in tt&&tt.requestVideoFrameCallback(function Wt(){jt.needsUpdate=!0,tt.requestVideoFrameCallback(Wt)})}clone(){return new this.constructor(this.image).copy(this)}update(){const tt=this.image;!("requestVideoFrameCallback"in tt)&&tt.readyState>=tt.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}class cE extends js{constructor(tt,lt){super({width:tt,height:lt}),this.isFramebufferTexture=!0,this.magFilter=rn,this.minFilter=rn,this.generateMipmaps=!1,this.needsUpdate=!0}}class jv extends js{constructor(tt,lt,ht,_t,bt,Pt,Mt,Lt,Nt,jt,Wt,Qt){super(null,Pt,Mt,Lt,Nt,jt,_t,bt,Wt,Qt),this.isCompressedTexture=!0,this.image={width:lt,height:ht},this.mipmaps=tt,this.flipY=!1,this.generateMipmaps=!1}}class uE extends jv{constructor(tt,lt,ht,_t,bt,Pt){super(tt,lt,ht,bt,Pt),this.isCompressedArrayTexture=!0,this.image.depth=_t,this.wrapR=vn}}class pE extends jv{constructor(tt,lt,ht){super(void 0,tt[0].width,tt[0].height,lt,ht,tn),this.isCompressedCubeTexture=!0,this.isCubeTexture=!0,this.image=tt}}class hE extends js{constructor(tt,lt,ht,_t,bt,Pt,Mt,Lt,Nt){super(tt,lt,ht,_t,bt,Pt,Mt,Lt,Nt),this.isCanvasTexture=!0,this.needsUpdate=!0}}class Gl{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(tt,lt){const ht=this.getUtoTmapping(tt);return this.getPoint(ht,lt)}getPoints(tt=5){const lt=[];for(let ht=0;ht<=tt;ht++)lt.push(this.getPoint(ht/tt));return lt}getSpacedPoints(tt=5){const lt=[];for(let ht=0;ht<=tt;ht++)lt.push(this.getPointAt(ht/tt));return lt}getLength(){const tt=this.getLengths();return tt[tt.length-1]}getLengths(tt=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===tt+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const lt=[];let ht,_t=this.getPoint(0),bt=0;lt.push(0);for(let Pt=1;Pt<=tt;Pt++)ht=this.getPoint(Pt/tt),bt+=ht.distanceTo(_t),lt.push(bt),_t=ht;return this.cacheArcLengths=lt,lt}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(tt,lt){const ht=this.getLengths();let _t=0;const bt=ht.length;let Pt;Pt=lt||tt*ht[bt-1];let Mt,Lt=0,Nt=bt-1;for(;Lt<=Nt;)if(_t=Math.floor(Lt+(Nt-Lt)/2),Mt=ht[_t]-Pt,Mt<0)Lt=_t+1;else{if(!(Mt>0)){Nt=_t;break}Nt=_t-1}if(_t=Nt,ht[_t]===Pt)return _t/(bt-1);const jt=ht[_t];return(_t+(Pt-jt)/(ht[_t+1]-jt))/(bt-1)}getTangent(tt,lt){let ht=tt-1e-4,_t=tt+1e-4;ht<0&&(ht=0),_t>1&&(_t=1);const bt=this.getPoint(ht),Pt=this.getPoint(_t),Mt=lt||(bt.isVector2?new mn:new Sr);return Mt.copy(Pt).sub(bt).normalize(),Mt}getTangentAt(tt,lt){const ht=this.getUtoTmapping(tt);return this.getTangent(ht,lt)}computeFrenetFrames(tt,lt){const ht=new Sr,_t=[],bt=[],Pt=[],Mt=new Sr,Lt=new is;for(let qt=0;qt<=tt;qt++){const Xt=qt/tt;_t[qt]=this.getTangentAt(Xt,new Sr)}bt[0]=new Sr,Pt[0]=new Sr;let Nt=Number.MAX_VALUE;const jt=Math.abs(_t[0].x),Wt=Math.abs(_t[0].y),Qt=Math.abs(_t[0].z);jt<=Nt&&(Nt=jt,ht.set(1,0,0)),Wt<=Nt&&(Nt=Wt,ht.set(0,1,0)),Qt<=Nt&&ht.set(0,0,1),Mt.crossVectors(_t[0],ht).normalize(),bt[0].crossVectors(_t[0],Mt),Pt[0].crossVectors(_t[0],bt[0]);for(let qt=1;qt<=tt;qt++){if(bt[qt]=bt[qt-1].clone(),Pt[qt]=Pt[qt-1].clone(),Mt.crossVectors(_t[qt-1],_t[qt]),Mt.length()>Number.EPSILON){Mt.normalize();const Xt=Math.acos(Qs(_t[qt-1].dot(_t[qt]),-1,1));bt[qt].applyMatrix4(Lt.makeRotationAxis(Mt,Xt))}Pt[qt].crossVectors(_t[qt],bt[qt])}if(lt===!0){let qt=Math.acos(Qs(bt[0].dot(bt[tt]),-1,1));qt/=tt,_t[0].dot(Mt.crossVectors(bt[0],bt[tt]))>0&&(qt=-qt);for(let Xt=1;Xt<=tt;Xt++)bt[Xt].applyMatrix4(Lt.makeRotationAxis(_t[Xt],qt*Xt)),Pt[Xt].crossVectors(_t[Xt],bt[Xt])}return{tangents:_t,normals:bt,binormals:Pt}}clone(){return new this.constructor().copy(this)}copy(tt){return this.arcLengthDivisions=tt.arcLengthDivisions,this}toJSON(){const tt={metadata:{version:4.6,type:"Curve",generator:"Curve.toJSON"}};return tt.arcLengthDivisions=this.arcLengthDivisions,tt.type=this.type,tt}fromJSON(tt){return this.arcLengthDivisions=tt.arcLengthDivisions,this}}class Gv extends Gl{constructor(tt=0,lt=0,ht=1,_t=1,bt=0,Pt=2*Math.PI,Mt=!1,Lt=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=tt,this.aY=lt,this.xRadius=ht,this.yRadius=_t,this.aStartAngle=bt,this.aEndAngle=Pt,this.aClockwise=Mt,this.aRotation=Lt}getPoint(tt,lt){const ht=lt||new mn,_t=2*Math.PI;let bt=this.aEndAngle-this.aStartAngle;const Pt=Math.abs(bt)<Number.EPSILON;for(;bt<0;)bt+=_t;for(;bt>_t;)bt-=_t;bt<Number.EPSILON&&(bt=Pt?0:_t),this.aClockwise!==!0||Pt||(bt===_t?bt=-_t:bt-=_t);const Mt=this.aStartAngle+tt*bt;let Lt=this.aX+this.xRadius*Math.cos(Mt),Nt=this.aY+this.yRadius*Math.sin(Mt);if(this.aRotation!==0){const jt=Math.cos(this.aRotation),Wt=Math.sin(this.aRotation),Qt=Lt-this.aX,qt=Nt-this.aY;Lt=Qt*jt-qt*Wt+this.aX,Nt=Qt*Wt+qt*jt+this.aY}return ht.set(Lt,Nt)}copy(tt){return super.copy(tt),this.aX=tt.aX,this.aY=tt.aY,this.xRadius=tt.xRadius,this.yRadius=tt.yRadius,this.aStartAngle=tt.aStartAngle,this.aEndAngle=tt.aEndAngle,this.aClockwise=tt.aClockwise,this.aRotation=tt.aRotation,this}toJSON(){const tt=super.toJSON();return tt.aX=this.aX,tt.aY=this.aY,tt.xRadius=this.xRadius,tt.yRadius=this.yRadius,tt.aStartAngle=this.aStartAngle,tt.aEndAngle=this.aEndAngle,tt.aClockwise=this.aClockwise,tt.aRotation=this.aRotation,tt}fromJSON(tt){return super.fromJSON(tt),this.aX=tt.aX,this.aY=tt.aY,this.xRadius=tt.xRadius,this.yRadius=tt.yRadius,this.aStartAngle=tt.aStartAngle,this.aEndAngle=tt.aEndAngle,this.aClockwise=tt.aClockwise,this.aRotation=tt.aRotation,this}}class $x extends Gv{constructor(tt,lt,ht,_t,bt,Pt){super(tt,lt,ht,ht,_t,bt,Pt),this.isArcCurve=!0,this.type="ArcCurve"}}function ty(){let St=0,tt=0,lt=0,ht=0;function _t(bt,Pt,Mt,Lt){St=bt,tt=Mt,lt=-3*bt+3*Pt-2*Mt-Lt,ht=2*bt-2*Pt+Mt+Lt}return{initCatmullRom:function(bt,Pt,Mt,Lt,Nt){_t(Pt,Mt,Nt*(Mt-bt),Nt*(Lt-Pt))},initNonuniformCatmullRom:function(bt,Pt,Mt,Lt,Nt,jt,Wt){let Qt=(Pt-bt)/Nt-(Mt-bt)/(Nt+jt)+(Mt-Pt)/jt,qt=(Mt-Pt)/jt-(Lt-Pt)/(jt+Wt)+(Lt-Mt)/Wt;Qt*=jt,qt*=jt,_t(Pt,Mt,Qt,qt)},calc:function(bt){const Pt=bt*bt;return St+tt*bt+lt*Pt+ht*(Pt*bt)}}}const zv=new Sr,ry=new ty,iy=new ty,ny=new ty;class Xx extends Gl{constructor(tt=[],lt=!1,ht="centripetal",_t=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=tt,this.closed=lt,this.curveType=ht,this.tension=_t}getPoint(tt,lt=new Sr){const ht=lt,_t=this.points,bt=_t.length,Pt=(bt-(this.closed?0:1))*tt;let Mt,Lt,Nt=Math.floor(Pt),jt=Pt-Nt;this.closed?Nt+=Nt>0?0:(Math.floor(Math.abs(Nt)/bt)+1)*bt:jt===0&&Nt===bt-1&&(Nt=bt-2,jt=1),this.closed||Nt>0?Mt=_t[(Nt-1)%bt]:(zv.subVectors(_t[0],_t[1]).add(_t[0]),Mt=zv);const Wt=_t[Nt%bt],Qt=_t[(Nt+1)%bt];if(this.closed||Nt+2<bt?Lt=_t[(Nt+2)%bt]:(zv.subVectors(_t[bt-1],_t[bt-2]).add(_t[bt-1]),Lt=zv),this.curveType==="centripetal"||this.curveType==="chordal"){const qt=this.curveType==="chordal"?.5:.25;let Xt=Math.pow(Mt.distanceToSquared(Wt),qt),Zt=Math.pow(Wt.distanceToSquared(Qt),qt),Yt=Math.pow(Qt.distanceToSquared(Lt),qt);Zt<1e-4&&(Zt=1),Xt<1e-4&&(Xt=Zt),Yt<1e-4&&(Yt=Zt),ry.initNonuniformCatmullRom(Mt.x,Wt.x,Qt.x,Lt.x,Xt,Zt,Yt),iy.initNonuniformCatmullRom(Mt.y,Wt.y,Qt.y,Lt.y,Xt,Zt,Yt),ny.initNonuniformCatmullRom(Mt.z,Wt.z,Qt.z,Lt.z,Xt,Zt,Yt)}else this.curveType==="catmullrom"&&(ry.initCatmullRom(Mt.x,Wt.x,Qt.x,Lt.x,this.tension),iy.initCatmullRom(Mt.y,Wt.y,Qt.y,Lt.y,this.tension),ny.initCatmullRom(Mt.z,Wt.z,Qt.z,Lt.z,this.tension));return ht.set(ry.calc(jt),iy.calc(jt),ny.calc(jt)),ht}copy(tt){super.copy(tt),this.points=[];for(let lt=0,ht=tt.points.length;lt<ht;lt++){const _t=tt.points[lt];this.points.push(_t.clone())}return this.closed=tt.closed,this.curveType=tt.curveType,this.tension=tt.tension,this}toJSON(){const tt=super.toJSON();tt.points=[];for(let lt=0,ht=this.points.length;lt<ht;lt++){const _t=this.points[lt];tt.points.push(_t.toArray())}return tt.closed=this.closed,tt.curveType=this.curveType,tt.tension=this.tension,tt}fromJSON(tt){super.fromJSON(tt),this.points=[];for(let lt=0,ht=tt.points.length;lt<ht;lt++){const _t=tt.points[lt];this.points.push(new Sr().fromArray(_t))}return this.closed=tt.closed,this.curveType=tt.curveType,this.tension=tt.tension,this}}function Yx(St,tt,lt,ht,_t){const bt=.5*(ht-tt),Pt=.5*(_t-lt),Mt=St*St;return(2*lt-2*ht+bt+Pt)*(St*Mt)+(-3*lt+3*ht-2*bt-Pt)*Mt+bt*St+lt}function E_(St,tt,lt,ht){return function(_t,bt){const Pt=1-_t;return Pt*Pt*bt}(St,tt)+function(_t,bt){return 2*(1-_t)*_t*bt}(St,lt)+function(_t,bt){return _t*_t*bt}(St,ht)}function S_(St,tt,lt,ht,_t){return function(bt,Pt){const Mt=1-bt;return Mt*Mt*Mt*Pt}(St,tt)+function(bt,Pt){const Mt=1-bt;return 3*Mt*Mt*bt*Pt}(St,lt)+function(bt,Pt){return 3*(1-bt)*bt*bt*Pt}(St,ht)+function(bt,Pt){return bt*bt*bt*Pt}(St,_t)}class sy extends Gl{constructor(tt=new mn,lt=new mn,ht=new mn,_t=new mn){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=tt,this.v1=lt,this.v2=ht,this.v3=_t}getPoint(tt,lt=new mn){const ht=lt,_t=this.v0,bt=this.v1,Pt=this.v2,Mt=this.v3;return ht.set(S_(tt,_t.x,bt.x,Pt.x,Mt.x),S_(tt,_t.y,bt.y,Pt.y,Mt.y)),ht}copy(tt){return super.copy(tt),this.v0.copy(tt.v0),this.v1.copy(tt.v1),this.v2.copy(tt.v2),this.v3.copy(tt.v3),this}toJSON(){const tt=super.toJSON();return tt.v0=this.v0.toArray(),tt.v1=this.v1.toArray(),tt.v2=this.v2.toArray(),tt.v3=this.v3.toArray(),tt}fromJSON(tt){return super.fromJSON(tt),this.v0.fromArray(tt.v0),this.v1.fromArray(tt.v1),this.v2.fromArray(tt.v2),this.v3.fromArray(tt.v3),this}}class Kx extends Gl{constructor(tt=new Sr,lt=new Sr,ht=new Sr,_t=new Sr){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=tt,this.v1=lt,this.v2=ht,this.v3=_t}getPoint(tt,lt=new Sr){const ht=lt,_t=this.v0,bt=this.v1,Pt=this.v2,Mt=this.v3;return ht.set(S_(tt,_t.x,bt.x,Pt.x,Mt.x),S_(tt,_t.y,bt.y,Pt.y,Mt.y),S_(tt,_t.z,bt.z,Pt.z,Mt.z)),ht}copy(tt){return super.copy(tt),this.v0.copy(tt.v0),this.v1.copy(tt.v1),this.v2.copy(tt.v2),this.v3.copy(tt.v3),this}toJSON(){const tt=super.toJSON();return tt.v0=this.v0.toArray(),tt.v1=this.v1.toArray(),tt.v2=this.v2.toArray(),tt.v3=this.v3.toArray(),tt}fromJSON(tt){return super.fromJSON(tt),this.v0.fromArray(tt.v0),this.v1.fromArray(tt.v1),this.v2.fromArray(tt.v2),this.v3.fromArray(tt.v3),this}}class ay extends Gl{constructor(tt=new mn,lt=new mn){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=tt,this.v2=lt}getPoint(tt,lt=new mn){const ht=lt;return tt===1?ht.copy(this.v2):(ht.copy(this.v2).sub(this.v1),ht.multiplyScalar(tt).add(this.v1)),ht}getPointAt(tt,lt){return this.getPoint(tt,lt)}getTangent(tt,lt=new mn){return lt.subVectors(this.v2,this.v1).normalize()}getTangentAt(tt,lt){return this.getTangent(tt,lt)}copy(tt){return super.copy(tt),this.v1.copy(tt.v1),this.v2.copy(tt.v2),this}toJSON(){const tt=super.toJSON();return tt.v1=this.v1.toArray(),tt.v2=this.v2.toArray(),tt}fromJSON(tt){return super.fromJSON(tt),this.v1.fromArray(tt.v1),this.v2.fromArray(tt.v2),this}}class Jx extends Gl{constructor(tt=new Sr,lt=new Sr){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=tt,this.v2=lt}getPoint(tt,lt=new Sr){const ht=lt;return tt===1?ht.copy(this.v2):(ht.copy(this.v2).sub(this.v1),ht.multiplyScalar(tt).add(this.v1)),ht}getPointAt(tt,lt){return this.getPoint(tt,lt)}getTangent(tt,lt=new Sr){return lt.subVectors(this.v2,this.v1).normalize()}getTangentAt(tt,lt){return this.getTangent(tt,lt)}copy(tt){return super.copy(tt),this.v1.copy(tt.v1),this.v2.copy(tt.v2),this}toJSON(){const tt=super.toJSON();return tt.v1=this.v1.toArray(),tt.v2=this.v2.toArray(),tt}fromJSON(tt){return super.fromJSON(tt),this.v1.fromArray(tt.v1),this.v2.fromArray(tt.v2),this}}class oy extends Gl{constructor(tt=new mn,lt=new mn,ht=new mn){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=tt,this.v1=lt,this.v2=ht}getPoint(tt,lt=new mn){const ht=lt,_t=this.v0,bt=this.v1,Pt=this.v2;return ht.set(E_(tt,_t.x,bt.x,Pt.x),E_(tt,_t.y,bt.y,Pt.y)),ht}copy(tt){return super.copy(tt),this.v0.copy(tt.v0),this.v1.copy(tt.v1),this.v2.copy(tt.v2),this}toJSON(){const tt=super.toJSON();return tt.v0=this.v0.toArray(),tt.v1=this.v1.toArray(),tt.v2=this.v2.toArray(),tt}fromJSON(tt){return super.fromJSON(tt),this.v0.fromArray(tt.v0),this.v1.fromArray(tt.v1),this.v2.fromArray(tt.v2),this}}class ly extends Gl{constructor(tt=new Sr,lt=new Sr,ht=new Sr){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=tt,this.v1=lt,this.v2=ht}getPoint(tt,lt=new Sr){const ht=lt,_t=this.v0,bt=this.v1,Pt=this.v2;return ht.set(E_(tt,_t.x,bt.x,Pt.x),E_(tt,_t.y,bt.y,Pt.y),E_(tt,_t.z,bt.z,Pt.z)),ht}copy(tt){return super.copy(tt),this.v0.copy(tt.v0),this.v1.copy(tt.v1),this.v2.copy(tt.v2),this}toJSON(){const tt=super.toJSON();return tt.v0=this.v0.toArray(),tt.v1=this.v1.toArray(),tt.v2=this.v2.toArray(),tt}fromJSON(tt){return super.fromJSON(tt),this.v0.fromArray(tt.v0),this.v1.fromArray(tt.v1),this.v2.fromArray(tt.v2),this}}class cy extends Gl{constructor(tt=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=tt}getPoint(tt,lt=new mn){const ht=lt,_t=this.points,bt=(_t.length-1)*tt,Pt=Math.floor(bt),Mt=bt-Pt,Lt=_t[Pt===0?Pt:Pt-1],Nt=_t[Pt],jt=_t[Pt>_t.length-2?_t.length-1:Pt+1],Wt=_t[Pt>_t.length-3?_t.length-1:Pt+2];return ht.set(Yx(Mt,Lt.x,Nt.x,jt.x,Wt.x),Yx(Mt,Lt.y,Nt.y,jt.y,Wt.y)),ht}copy(tt){super.copy(tt),this.points=[];for(let lt=0,ht=tt.points.length;lt<ht;lt++){const _t=tt.points[lt];this.points.push(_t.clone())}return this}toJSON(){const tt=super.toJSON();tt.points=[];for(let lt=0,ht=this.points.length;lt<ht;lt++){const _t=this.points[lt];tt.points.push(_t.toArray())}return tt}fromJSON(tt){super.fromJSON(tt),this.points=[];for(let lt=0,ht=tt.points.length;lt<ht;lt++){const _t=tt.points[lt];this.points.push(new mn().fromArray(_t))}return this}}var Vv=Object.freeze({__proto__:null,ArcCurve:$x,CatmullRomCurve3:Xx,CubicBezierCurve:sy,CubicBezierCurve3:Kx,EllipseCurve:Gv,LineCurve:ay,LineCurve3:Jx,QuadraticBezierCurve:oy,QuadraticBezierCurve3:ly,SplineCurve:cy});class Zx extends Gl{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(tt){this.curves.push(tt)}closePath(){const tt=this.curves[0].getPoint(0),lt=this.curves[this.curves.length-1].getPoint(1);if(!tt.equals(lt)){const ht=tt.isVector2===!0?"LineCurve":"LineCurve3";this.curves.push(new Vv[ht](lt,tt))}return this}getPoint(tt,lt){const ht=tt*this.getLength(),_t=this.getCurveLengths();let bt=0;for(;bt<_t.length;){if(_t[bt]>=ht){const Pt=_t[bt]-ht,Mt=this.curves[bt],Lt=Mt.getLength(),Nt=Lt===0?0:1-Pt/Lt;return Mt.getPointAt(Nt,lt)}bt++}return null}getLength(){const tt=this.getCurveLengths();return tt[tt.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const tt=[];let lt=0;for(let ht=0,_t=this.curves.length;ht<_t;ht++)lt+=this.curves[ht].getLength(),tt.push(lt);return this.cacheLengths=tt,tt}getSpacedPoints(tt=40){const lt=[];for(let ht=0;ht<=tt;ht++)lt.push(this.getPoint(ht/tt));return this.autoClose&&lt.push(lt[0]),lt}getPoints(tt=12){const lt=[];let ht;for(let _t=0,bt=this.curves;_t<bt.length;_t++){const Pt=bt[_t],Mt=Pt.isEllipseCurve?2*tt:Pt.isLineCurve||Pt.isLineCurve3?1:Pt.isSplineCurve?tt*Pt.points.length:tt,Lt=Pt.getPoints(Mt);for(let Nt=0;Nt<Lt.length;Nt++){const jt=Lt[Nt];ht&&ht.equals(jt)||(lt.push(jt),ht=jt)}}return this.autoClose&&lt.length>1&&!lt[lt.length-1].equals(lt[0])&&lt.push(lt[0]),lt}copy(tt){super.copy(tt),this.curves=[];for(let lt=0,ht=tt.curves.length;lt<ht;lt++){const _t=tt.curves[lt];this.curves.push(_t.clone())}return this.autoClose=tt.autoClose,this}toJSON(){const tt=super.toJSON();tt.autoClose=this.autoClose,tt.curves=[];for(let lt=0,ht=this.curves.length;lt<ht;lt++){const _t=this.curves[lt];tt.curves.push(_t.toJSON())}return tt}fromJSON(tt){super.fromJSON(tt),this.autoClose=tt.autoClose,this.curves=[];for(let lt=0,ht=tt.curves.length;lt<ht;lt++){const _t=tt.curves[lt];this.curves.push(new Vv[_t.type]().fromJSON(_t))}return this}}class C_ extends Zx{constructor(tt){super(),this.type="Path",this.currentPoint=new mn,tt&&this.setFromPoints(tt)}setFromPoints(tt){this.moveTo(tt[0].x,tt[0].y);for(let lt=1,ht=tt.length;lt<ht;lt++)this.lineTo(tt[lt].x,tt[lt].y);return this}moveTo(tt,lt){return this.currentPoint.set(tt,lt),this}lineTo(tt,lt){const ht=new ay(this.currentPoint.clone(),new mn(tt,lt));return this.curves.push(ht),this.currentPoint.set(tt,lt),this}quadraticCurveTo(tt,lt,ht,_t){const bt=new oy(this.currentPoint.clone(),new mn(tt,lt),new mn(ht,_t));return this.curves.push(bt),this.currentPoint.set(ht,_t),this}bezierCurveTo(tt,lt,ht,_t,bt,Pt){const Mt=new sy(this.currentPoint.clone(),new mn(tt,lt),new mn(ht,_t),new mn(bt,Pt));return this.curves.push(Mt),this.currentPoint.set(bt,Pt),this}splineThru(tt){const lt=[this.currentPoint.clone()].concat(tt),ht=new cy(lt);return this.curves.push(ht),this.currentPoint.copy(tt[tt.length-1]),this}arc(tt,lt,ht,_t,bt,Pt){const Mt=this.currentPoint.x,Lt=this.currentPoint.y;return this.absarc(tt+Mt,lt+Lt,ht,_t,bt,Pt),this}absarc(tt,lt,ht,_t,bt,Pt){return this.absellipse(tt,lt,ht,ht,_t,bt,Pt),this}ellipse(tt,lt,ht,_t,bt,Pt,Mt,Lt){const Nt=this.currentPoint.x,jt=this.currentPoint.y;return this.absellipse(tt+Nt,lt+jt,ht,_t,bt,Pt,Mt,Lt),this}absellipse(tt,lt,ht,_t,bt,Pt,Mt,Lt){const Nt=new Gv(tt,lt,ht,_t,bt,Pt,Mt,Lt);if(this.curves.length>0){const Wt=Nt.getPoint(0);Wt.equals(this.currentPoint)||this.lineTo(Wt.x,Wt.y)}this.curves.push(Nt);const jt=Nt.getPoint(1);return this.currentPoint.copy(jt),this}copy(tt){return super.copy(tt),this.currentPoint.copy(tt.currentPoint),this}toJSON(){const tt=super.toJSON();return tt.currentPoint=this.currentPoint.toArray(),tt}fromJSON(tt){return super.fromJSON(tt),this.currentPoint.fromArray(tt.currentPoint),this}}class P_ extends fs{constructor(tt=[new mn(0,-.5),new mn(.5,0),new mn(0,.5)],lt=12,ht=0,_t=2*Math.PI){super(),this.type="LatheGeometry",this.parameters={points:tt,segments:lt,phiStart:ht,phiLength:_t},lt=Math.floor(lt),_t=Qs(_t,0,2*Math.PI);const bt=[],Pt=[],Mt=[],Lt=[],Nt=[],jt=1/lt,Wt=new Sr,Qt=new mn,qt=new Sr,Xt=new Sr,Zt=new Sr;let Yt=0,ar=0;for(let er=0;er<=tt.length-1;er++)switch(er){case 0:Yt=tt[er+1].x-tt[er].x,ar=tt[er+1].y-tt[er].y,qt.x=1*ar,qt.y=-Yt,qt.z=0*ar,Zt.copy(qt),qt.normalize(),Lt.push(qt.x,qt.y,qt.z);break;case tt.length-1:Lt.push(Zt.x,Zt.y,Zt.z);break;default:Yt=tt[er+1].x-tt[er].x,ar=tt[er+1].y-tt[er].y,qt.x=1*ar,qt.y=-Yt,qt.z=0*ar,Xt.copy(qt),qt.x+=Zt.x,qt.y+=Zt.y,qt.z+=Zt.z,qt.normalize(),Lt.push(qt.x,qt.y,qt.z),Zt.copy(Xt)}for(let er=0;er<=lt;er++){const tr=ht+er*jt*_t,Ar=Math.sin(tr),wr=Math.cos(tr);for(let br=0;br<=tt.length-1;br++){Wt.x=tt[br].x*Ar,Wt.y=tt[br].y,Wt.z=tt[br].x*wr,Pt.push(Wt.x,Wt.y,Wt.z),Qt.x=er/lt,Qt.y=br/(tt.length-1),Mt.push(Qt.x,Qt.y);const Mr=Lt[3*br+0]*Ar,Qr=Lt[3*br+1],Fr=Lt[3*br+0]*wr;Nt.push(Mr,Qr,Fr)}}for(let er=0;er<lt;er++)for(let tr=0;tr<tt.length-1;tr++){const Ar=tr+er*tt.length,wr=Ar,br=Ar+tt.length,Mr=Ar+tt.length+1,Qr=Ar+1;bt.push(wr,br,Qr),bt.push(Mr,Qr,br)}this.setIndex(bt),this.setAttribute("position",new On(Pt,3)),this.setAttribute("uv",new On(Mt,2)),this.setAttribute("normal",new On(Nt,3))}copy(tt){return super.copy(tt),this.parameters=Object.assign({},tt.parameters),this}static fromJSON(tt){return new P_(tt.points,tt.segments,tt.phiStart,tt.phiLength)}}class Hv extends P_{constructor(tt=1,lt=1,ht=4,_t=8){const bt=new C_;bt.absarc(0,-lt/2,tt,1.5*Math.PI,0),bt.absarc(0,lt/2,tt,0,.5*Math.PI),super(bt.getPoints(ht),_t),this.type="CapsuleGeometry",this.parameters={radius:tt,length:lt,capSegments:ht,radialSegments:_t}}static fromJSON(tt){return new Hv(tt.radius,tt.length,tt.capSegments,tt.radialSegments)}}class Qv extends fs{constructor(tt=1,lt=32,ht=0,_t=2*Math.PI){super(),this.type="CircleGeometry",this.parameters={radius:tt,segments:lt,thetaStart:ht,thetaLength:_t},lt=Math.max(3,lt);const bt=[],Pt=[],Mt=[],Lt=[],Nt=new Sr,jt=new mn;Pt.push(0,0,0),Mt.push(0,0,1),Lt.push(.5,.5);for(let Wt=0,Qt=3;Wt<=lt;Wt++,Qt+=3){const qt=ht+Wt/lt*_t;Nt.x=tt*Math.cos(qt),Nt.y=tt*Math.sin(qt),Pt.push(Nt.x,Nt.y,Nt.z),Mt.push(0,0,1),jt.x=(Pt[Qt]/tt+1)/2,jt.y=(Pt[Qt+1]/tt+1)/2,Lt.push(jt.x,jt.y)}for(let Wt=1;Wt<=lt;Wt++)bt.push(Wt,Wt+1,0);this.setIndex(bt),this.setAttribute("position",new On(Pt,3)),this.setAttribute("normal",new On(Mt,3)),this.setAttribute("uv",new On(Lt,2))}copy(tt){return super.copy(tt),this.parameters=Object.assign({},tt.parameters),this}static fromJSON(tt){return new Qv(tt.radius,tt.segments,tt.thetaStart,tt.thetaLength)}}class Rm extends fs{constructor(tt=1,lt=1,ht=1,_t=32,bt=1,Pt=!1,Mt=0,Lt=2*Math.PI){super(),this.type="CylinderGeometry",this.parameters={radiusTop:tt,radiusBottom:lt,height:ht,radialSegments:_t,heightSegments:bt,openEnded:Pt,thetaStart:Mt,thetaLength:Lt};const Nt=this;_t=Math.floor(_t),bt=Math.floor(bt);const jt=[],Wt=[],Qt=[],qt=[];let Xt=0;const Zt=[],Yt=ht/2;let ar=0;function er(tr){const Ar=Xt,wr=new mn,br=new Sr;let Mr=0;const Qr=tr===!0?tt:lt,Fr=tr===!0?1:-1;for(let zr=1;zr<=_t;zr++)Wt.push(0,Yt*Fr,0),Qt.push(0,Fr,0),qt.push(.5,.5),Xt++;const Vr=Xt;for(let zr=0;zr<=_t;zr++){const Hr=zr/_t*Lt+Mt,_n=Math.cos(Hr),hn=Math.sin(Hr);br.x=Qr*hn,br.y=Yt*Fr,br.z=Qr*_n,Wt.push(br.x,br.y,br.z),Qt.push(0,Fr,0),wr.x=.5*_n+.5,wr.y=.5*hn*Fr+.5,qt.push(wr.x,wr.y),Xt++}for(let zr=0;zr<_t;zr++){const Hr=Ar+zr,_n=Vr+zr;tr===!0?jt.push(_n,_n+1,Hr):jt.push(_n+1,_n,Hr),Mr+=3}Nt.addGroup(ar,Mr,tr===!0?1:2),ar+=Mr}(function(){const tr=new Sr,Ar=new Sr;let wr=0;const br=(lt-tt)/ht;for(let Mr=0;Mr<=bt;Mr++){const Qr=[],Fr=Mr/bt,Vr=Fr*(lt-tt)+tt;for(let zr=0;zr<=_t;zr++){const Hr=zr/_t,_n=Hr*Lt+Mt,hn=Math.sin(_n),Rn=Math.cos(_n);Ar.x=Vr*hn,Ar.y=-Fr*ht+Yt,Ar.z=Vr*Rn,Wt.push(Ar.x,Ar.y,Ar.z),tr.set(hn,br,Rn).normalize(),Qt.push(tr.x,tr.y,tr.z),qt.push(Hr,1-Fr),Qr.push(Xt++)}Zt.push(Qr)}for(let Mr=0;Mr<_t;Mr++)for(let Qr=0;Qr<bt;Qr++){const Fr=Zt[Qr][Mr],Vr=Zt[Qr+1][Mr],zr=Zt[Qr+1][Mr+1],Hr=Zt[Qr][Mr+1];jt.push(Fr,Vr,Hr),jt.push(Vr,zr,Hr),wr+=6}Nt.addGroup(ar,wr,0),ar+=wr})(),Pt===!1&&(tt>0&&er(!0),lt>0&&er(!1)),this.setIndex(jt),this.setAttribute("position",new On(Wt,3)),this.setAttribute("normal",new On(Qt,3)),this.setAttribute("uv",new On(qt,2))}copy(tt){return super.copy(tt),this.parameters=Object.assign({},tt.parameters),this}static fromJSON(tt){return new Rm(tt.radiusTop,tt.radiusBottom,tt.height,tt.radialSegments,tt.heightSegments,tt.openEnded,tt.thetaStart,tt.thetaLength)}}class Wv extends Rm{constructor(tt=1,lt=1,ht=32,_t=1,bt=!1,Pt=0,Mt=2*Math.PI){super(0,tt,lt,ht,_t,bt,Pt,Mt),this.type="ConeGeometry",this.parameters={radius:tt,height:lt,radialSegments:ht,heightSegments:_t,openEnded:bt,thetaStart:Pt,thetaLength:Mt}}static fromJSON(tt){return new Wv(tt.radius,tt.height,tt.radialSegments,tt.heightSegments,tt.openEnded,tt.thetaStart,tt.thetaLength)}}class Ju extends fs{constructor(tt=[],lt=[],ht=1,_t=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:tt,indices:lt,radius:ht,detail:_t};const bt=[],Pt=[];function Mt(Qt,qt,Xt,Zt){const Yt=Zt+1,ar=[];for(let er=0;er<=Yt;er++){ar[er]=[];const tr=Qt.clone().lerp(Xt,er/Yt),Ar=qt.clone().lerp(Xt,er/Yt),wr=Yt-er;for(let br=0;br<=wr;br++)ar[er][br]=br===0&&er===Yt?tr:tr.clone().lerp(Ar,br/wr)}for(let er=0;er<Yt;er++)for(let tr=0;tr<2*(Yt-er)-1;tr++){const Ar=Math.floor(tr/2);tr%2==0?(Lt(ar[er][Ar+1]),Lt(ar[er+1][Ar]),Lt(ar[er][Ar])):(Lt(ar[er][Ar+1]),Lt(ar[er+1][Ar+1]),Lt(ar[er+1][Ar]))}}function Lt(Qt){bt.push(Qt.x,Qt.y,Qt.z)}function Nt(Qt,qt){const Xt=3*Qt;qt.x=tt[Xt+0],qt.y=tt[Xt+1],qt.z=tt[Xt+2]}function jt(Qt,qt,Xt,Zt){Zt<0&&Qt.x===1&&(Pt[qt]=Qt.x-1),Xt.x===0&&Xt.z===0&&(Pt[qt]=Zt/2/Math.PI+.5)}function Wt(Qt){return Math.atan2(Qt.z,-Qt.x)}(function(Qt){const qt=new Sr,Xt=new Sr,Zt=new Sr;for(let Yt=0;Yt<lt.length;Yt+=3)Nt(lt[Yt+0],qt),Nt(lt[Yt+1],Xt),Nt(lt[Yt+2],Zt),Mt(qt,Xt,Zt,Qt)})(_t),function(Qt){const qt=new Sr;for(let Xt=0;Xt<bt.length;Xt+=3)qt.x=bt[Xt+0],qt.y=bt[Xt+1],qt.z=bt[Xt+2],qt.normalize().multiplyScalar(Qt),bt[Xt+0]=qt.x,bt[Xt+1]=qt.y,bt[Xt+2]=qt.z}(ht),function(){const Qt=new Sr;for(let Xt=0;Xt<bt.length;Xt+=3){Qt.x=bt[Xt+0],Qt.y=bt[Xt+1],Qt.z=bt[Xt+2];const Zt=Wt(Qt)/2/Math.PI+.5,Yt=(qt=Qt,Math.atan2(-qt.y,Math.sqrt(qt.x*qt.x+qt.z*qt.z))/Math.PI+.5);Pt.push(Zt,1-Yt)}var qt;(function(){const Xt=new Sr,Zt=new Sr,Yt=new Sr,ar=new Sr,er=new mn,tr=new mn,Ar=new mn;for(let wr=0,br=0;wr<bt.length;wr+=9,br+=6){Xt.set(bt[wr+0],bt[wr+1],bt[wr+2]),Zt.set(bt[wr+3],bt[wr+4],bt[wr+5]),Yt.set(bt[wr+6],bt[wr+7],bt[wr+8]),er.set(Pt[br+0],Pt[br+1]),tr.set(Pt[br+2],Pt[br+3]),Ar.set(Pt[br+4],Pt[br+5]),ar.copy(Xt).add(Zt).add(Yt).divideScalar(3);const Mr=Wt(ar);jt(er,br+0,Xt,Mr),jt(tr,br+2,Zt,Mr),jt(Ar,br+4,Yt,Mr)}})(),function(){for(let Xt=0;Xt<Pt.length;Xt+=6){const Zt=Pt[Xt+0],Yt=Pt[Xt+2],ar=Pt[Xt+4],er=Math.max(Zt,Yt,ar),tr=Math.min(Zt,Yt,ar);er>.9&&tr<.1&&(Zt<.2&&(Pt[Xt+0]+=1),Yt<.2&&(Pt[Xt+2]+=1),ar<.2&&(Pt[Xt+4]+=1))}}()}(),this.setAttribute("position",new On(bt,3)),this.setAttribute("normal",new On(bt.slice(),3)),this.setAttribute("uv",new On(Pt,2)),_t===0?this.computeVertexNormals():this.normalizeNormals()}copy(tt){return super.copy(tt),this.parameters=Object.assign({},tt.parameters),this}static fromJSON(tt){return new Ju(tt.vertices,tt.indices,tt.radius,tt.details)}}class qv extends Ju{constructor(tt=1,lt=0){const ht=(1+Math.sqrt(5))/2,_t=1/ht;super([-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-_t,-ht,0,-_t,ht,0,_t,-ht,0,_t,ht,-_t,-ht,0,-_t,ht,0,_t,-ht,0,_t,ht,0,-ht,0,-_t,ht,0,-_t,-ht,0,_t,ht,0,_t],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],tt,lt),this.type="DodecahedronGeometry",this.parameters={radius:tt,detail:lt}}static fromJSON(tt){return new qv(tt.radius,tt.detail)}}const $v=new Sr,Xv=new Sr,uy=new Sr,Yv=new vo;class eA extends fs{constructor(tt=null,lt=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:tt,thresholdAngle:lt},tt!==null){const ht=Math.pow(10,4),_t=Math.cos(Xl*lt),bt=tt.getIndex(),Pt=tt.getAttribute("position"),Mt=bt?bt.count:Pt.count,Lt=[0,0,0],Nt=["a","b","c"],jt=new Array(3),Wt={},Qt=[];for(let qt=0;qt<Mt;qt+=3){bt?(Lt[0]=bt.getX(qt),Lt[1]=bt.getX(qt+1),Lt[2]=bt.getX(qt+2)):(Lt[0]=qt,Lt[1]=qt+1,Lt[2]=qt+2);const{a:Xt,b:Zt,c:Yt}=Yv;if(Xt.fromBufferAttribute(Pt,Lt[0]),Zt.fromBufferAttribute(Pt,Lt[1]),Yt.fromBufferAttribute(Pt,Lt[2]),Yv.getNormal(uy),jt[0]=`${Math.round(Xt.x*ht)},${Math.round(Xt.y*ht)},${Math.round(Xt.z*ht)}`,jt[1]=`${Math.round(Zt.x*ht)},${Math.round(Zt.y*ht)},${Math.round(Zt.z*ht)}`,jt[2]=`${Math.round(Yt.x*ht)},${Math.round(Yt.y*ht)},${Math.round(Yt.z*ht)}`,jt[0]!==jt[1]&&jt[1]!==jt[2]&&jt[2]!==jt[0])for(let ar=0;ar<3;ar++){const er=(ar+1)%3,tr=jt[ar],Ar=jt[er],wr=Yv[Nt[ar]],br=Yv[Nt[er]],Mr=`${tr}_${Ar}`,Qr=`${Ar}_${tr}`;Qr in Wt&&Wt[Qr]?(uy.dot(Wt[Qr].normal)<=_t&&(Qt.push(wr.x,wr.y,wr.z),Qt.push(br.x,br.y,br.z)),Wt[Qr]=null):Mr in Wt||(Wt[Mr]={index0:Lt[ar],index1:Lt[er],normal:uy.clone()})}}for(const qt in Wt)if(Wt[qt]){const{index0:Xt,index1:Zt}=Wt[qt];$v.fromBufferAttribute(Pt,Xt),Xv.fromBufferAttribute(Pt,Zt),Qt.push($v.x,$v.y,$v.z),Qt.push(Xv.x,Xv.y,Xv.z)}this.setAttribute("position",new On(Qt,3))}}copy(tt){return super.copy(tt),this.parameters=Object.assign({},tt.parameters),this}}class Pp extends C_{constructor(tt){super(tt),this.uuid=Ao(),this.type="Shape",this.holes=[]}getPointsHoles(tt){const lt=[];for(let ht=0,_t=this.holes.length;ht<_t;ht++)lt[ht]=this.holes[ht].getPoints(tt);return lt}extractPoints(tt){return{shape:this.getPoints(tt),holes:this.getPointsHoles(tt)}}copy(tt){super.copy(tt),this.holes=[];for(let lt=0,ht=tt.holes.length;lt<ht;lt++){const _t=tt.holes[lt];this.holes.push(_t.clone())}return this}toJSON(){const tt=super.toJSON();tt.uuid=this.uuid,tt.holes=[];for(let lt=0,ht=this.holes.length;lt<ht;lt++){const _t=this.holes[lt];tt.holes.push(_t.toJSON())}return tt}fromJSON(tt){super.fromJSON(tt),this.uuid=tt.uuid,this.holes=[];for(let lt=0,ht=tt.holes.length;lt<ht;lt++){const _t=tt.holes[lt];this.holes.push(new C_().fromJSON(_t))}return this}}function tA(St,tt,lt,ht,_t){let bt,Pt;if(_t===function(Mt,Lt,Nt,jt){let Wt=0;for(let Qt=Lt,qt=Nt-jt;Qt<Nt;Qt+=jt)Wt+=(Mt[qt]-Mt[Qt])*(Mt[Qt+1]+Mt[qt+1]),qt=Qt;return Wt}(St,tt,lt,ht)>0)for(bt=tt;bt<lt;bt+=ht)Pt=nA(bt,St[bt],St[bt+1],Pt);else for(bt=lt-ht;bt>=tt;bt-=ht)Pt=nA(bt,St[bt],St[bt+1],Pt);return Pt&&Kv(Pt,Pt.next)&&(I_(Pt),Pt=Pt.next),Pt}function Tp(St,tt){if(!St)return St;tt||(tt=St);let lt,ht=St;do if(lt=!1,ht.steiner||!Kv(ht,ht.next)&&Xs(ht.prev,ht,ht.next)!==0)ht=ht.next;else{if(I_(ht),ht=tt=ht.prev,ht===ht.next)break;lt=!0}while(lt||ht!==tt);return tt}function T_(St,tt,lt,ht,_t,bt,Pt){if(!St)return;!Pt&&bt&&function(jt,Wt,Qt,qt){let Xt=jt;do Xt.z===0&&(Xt.z=py(Xt.x,Xt.y,Wt,Qt,qt)),Xt.prevZ=Xt.prev,Xt.nextZ=Xt.next,Xt=Xt.next;while(Xt!==jt);Xt.prevZ.nextZ=null,Xt.prevZ=null,function(Zt){let Yt,ar,er,tr,Ar,wr,br,Mr,Qr=1;do{for(ar=Zt,Zt=null,Ar=null,wr=0;ar;){for(wr++,er=ar,br=0,Yt=0;Yt<Qr&&(br++,er=er.nextZ,er);Yt++);for(Mr=Qr;br>0||Mr>0&&er;)br!==0&&(Mr===0||!er||ar.z<=er.z)?(tr=ar,ar=ar.nextZ,br--):(tr=er,er=er.nextZ,Mr--),Ar?Ar.nextZ=tr:Zt=tr,tr.prevZ=Ar,Ar=tr;ar=er}Ar.nextZ=null,Qr*=2}while(wr>1)}(Xt)}(St,ht,_t,bt);let Mt,Lt,Nt=St;for(;St.prev!==St.next;)if(Mt=St.prev,Lt=St.next,bt?mE(St,ht,_t,bt):dE(St))tt.push(Mt.i/lt|0),tt.push(St.i/lt|0),tt.push(Lt.i/lt|0),I_(St),St=Lt.next,Nt=Lt.next;else if((St=Lt)===Nt){Pt?Pt===1?T_(St=gE(Tp(St),tt,lt),tt,lt,ht,_t,bt,2):Pt===2&&_E(St,tt,lt,ht,_t,bt):T_(Tp(St),tt,lt,ht,_t,bt,1);break}}function dE(St){const tt=St.prev,lt=St,ht=St.next;if(Xs(tt,lt,ht)>=0)return!1;const _t=tt.x,bt=lt.x,Pt=ht.x,Mt=tt.y,Lt=lt.y,Nt=ht.y,jt=_t<bt?_t<Pt?_t:Pt:bt<Pt?bt:Pt,Wt=Mt<Lt?Mt<Nt?Mt:Nt:Lt<Nt?Lt:Nt,Qt=_t>bt?_t>Pt?_t:Pt:bt>Pt?bt:Pt,qt=Mt>Lt?Mt>Nt?Mt:Nt:Lt>Nt?Lt:Nt;let Xt=ht.next;for(;Xt!==tt;){if(Xt.x>=jt&&Xt.x<=Qt&&Xt.y>=Wt&&Xt.y<=qt&&km(_t,Mt,bt,Lt,Pt,Nt,Xt.x,Xt.y)&&Xs(Xt.prev,Xt,Xt.next)>=0)return!1;Xt=Xt.next}return!0}function mE(St,tt,lt,ht){const _t=St.prev,bt=St,Pt=St.next;if(Xs(_t,bt,Pt)>=0)return!1;const Mt=_t.x,Lt=bt.x,Nt=Pt.x,jt=_t.y,Wt=bt.y,Qt=Pt.y,qt=Mt<Lt?Mt<Nt?Mt:Nt:Lt<Nt?Lt:Nt,Xt=jt<Wt?jt<Qt?jt:Qt:Wt<Qt?Wt:Qt,Zt=Mt>Lt?Mt>Nt?Mt:Nt:Lt>Nt?Lt:Nt,Yt=jt>Wt?jt>Qt?jt:Qt:Wt>Qt?Wt:Qt,ar=py(qt,Xt,tt,lt,ht),er=py(Zt,Yt,tt,lt,ht);let tr=St.prevZ,Ar=St.nextZ;for(;tr&&tr.z>=ar&&Ar&&Ar.z<=er;){if(tr.x>=qt&&tr.x<=Zt&&tr.y>=Xt&&tr.y<=Yt&&tr!==_t&&tr!==Pt&&km(Mt,jt,Lt,Wt,Nt,Qt,tr.x,tr.y)&&Xs(tr.prev,tr,tr.next)>=0||(tr=tr.prevZ,Ar.x>=qt&&Ar.x<=Zt&&Ar.y>=Xt&&Ar.y<=Yt&&Ar!==_t&&Ar!==Pt&&km(Mt,jt,Lt,Wt,Nt,Qt,Ar.x,Ar.y)&&Xs(Ar.prev,Ar,Ar.next)>=0))return!1;Ar=Ar.nextZ}for(;tr&&tr.z>=ar;){if(tr.x>=qt&&tr.x<=Zt&&tr.y>=Xt&&tr.y<=Yt&&tr!==_t&&tr!==Pt&&km(Mt,jt,Lt,Wt,Nt,Qt,tr.x,tr.y)&&Xs(tr.prev,tr,tr.next)>=0)return!1;tr=tr.prevZ}for(;Ar&&Ar.z<=er;){if(Ar.x>=qt&&Ar.x<=Zt&&Ar.y>=Xt&&Ar.y<=Yt&&Ar!==_t&&Ar!==Pt&&km(Mt,jt,Lt,Wt,Nt,Qt,Ar.x,Ar.y)&&Xs(Ar.prev,Ar,Ar.next)>=0)return!1;Ar=Ar.nextZ}return!0}function gE(St,tt,lt){let ht=St;do{const _t=ht.prev,bt=ht.next.next;!Kv(_t,bt)&&rA(_t,ht,ht.next,bt)&&M_(_t,bt)&&M_(bt,_t)&&(tt.push(_t.i/lt|0),tt.push(ht.i/lt|0),tt.push(bt.i/lt|0),I_(ht),I_(ht.next),ht=St=bt),ht=ht.next}while(ht!==St);return Tp(ht)}function _E(St,tt,lt,ht,_t,bt){let Pt=St;do{let Mt=Pt.next.next;for(;Mt!==Pt.prev;){if(Pt.i!==Mt.i&&xE(Pt,Mt)){let Lt=iA(Pt,Mt);return Pt=Tp(Pt,Pt.next),Lt=Tp(Lt,Lt.next),T_(Pt,tt,lt,ht,_t,bt,0),void T_(Lt,tt,lt,ht,_t,bt,0)}Mt=Mt.next}Pt=Pt.next}while(Pt!==St)}function fE(St,tt){return St.x-tt.x}function vE(St,tt){const lt=function(_t,bt){let Pt,Mt=bt,Lt=-1/0;const Nt=_t.x,jt=_t.y;do{if(jt<=Mt.y&&jt>=Mt.next.y&&Mt.next.y!==Mt.y){const Yt=Mt.x+(jt-Mt.y)*(Mt.next.x-Mt.x)/(Mt.next.y-Mt.y);if(Yt<=Nt&&Yt>Lt&&(Lt=Yt,Pt=Mt.x<Mt.next.x?Mt:Mt.next,Yt===Nt))return Pt}Mt=Mt.next}while(Mt!==bt);if(!Pt)return null;const Wt=Pt,Qt=Pt.x,qt=Pt.y;let Xt,Zt=1/0;Mt=Pt;do Nt>=Mt.x&&Mt.x>=Qt&&Nt!==Mt.x&&km(jt<qt?Nt:Lt,jt,Qt,qt,jt<qt?Lt:Nt,jt,Mt.x,Mt.y)&&(Xt=Math.abs(jt-Mt.y)/(Nt-Mt.x),M_(Mt,_t)&&(Xt<Zt||Xt===Zt&&(Mt.x>Pt.x||Mt.x===Pt.x&&yE(Pt,Mt)))&&(Pt=Mt,Zt=Xt)),Mt=Mt.next;while(Mt!==Wt);return Pt}(St,tt);if(!lt)return tt;const ht=iA(lt,St);return Tp(ht,ht.next),Tp(lt,lt.next)}function yE(St,tt){return Xs(St.prev,St,tt.prev)<0&&Xs(tt.next,St,St.next)<0}function py(St,tt,lt,ht,_t){return(St=1431655765&((St=858993459&((St=252645135&((St=16711935&((St=(St-lt)*_t|0)|St<<8))|St<<4))|St<<2))|St<<1))|(tt=1431655765&((tt=858993459&((tt=252645135&((tt=16711935&((tt=(tt-ht)*_t|0)|tt<<8))|tt<<4))|tt<<2))|tt<<1))<<1}function bE(St){let tt=St,lt=St;do(tt.x<lt.x||tt.x===lt.x&&tt.y<lt.y)&&(lt=tt),tt=tt.next;while(tt!==St);return lt}function km(St,tt,lt,ht,_t,bt,Pt,Mt){return(_t-Pt)*(tt-Mt)>=(St-Pt)*(bt-Mt)&&(St-Pt)*(ht-Mt)>=(lt-Pt)*(tt-Mt)&&(lt-Pt)*(bt-Mt)>=(_t-Pt)*(ht-Mt)}function xE(St,tt){return St.next.i!==tt.i&&St.prev.i!==tt.i&&!function(lt,ht){let _t=lt;do{if(_t.i!==lt.i&&_t.next.i!==lt.i&&_t.i!==ht.i&&_t.next.i!==ht.i&&rA(_t,_t.next,lt,ht))return!0;_t=_t.next}while(_t!==lt);return!1}(St,tt)&&(M_(St,tt)&&M_(tt,St)&&function(lt,ht){let _t=lt,bt=!1;const Pt=(lt.x+ht.x)/2,Mt=(lt.y+ht.y)/2;do _t.y>Mt!=_t.next.y>Mt&&_t.next.y!==_t.y&&Pt<(_t.next.x-_t.x)*(Mt-_t.y)/(_t.next.y-_t.y)+_t.x&&(bt=!bt),_t=_t.next;while(_t!==lt);return bt}(St,tt)&&(Xs(St.prev,St,tt.prev)||Xs(St,tt.prev,tt))||Kv(St,tt)&&Xs(St.prev,St,St.next)>0&&Xs(tt.prev,tt,tt.next)>0)}function Xs(St,tt,lt){return(tt.y-St.y)*(lt.x-tt.x)-(tt.x-St.x)*(lt.y-tt.y)}function Kv(St,tt){return St.x===tt.x&&St.y===tt.y}function rA(St,tt,lt,ht){const _t=Zv(Xs(St,tt,lt)),bt=Zv(Xs(St,tt,ht)),Pt=Zv(Xs(lt,ht,St)),Mt=Zv(Xs(lt,ht,tt));return _t!==bt&&Pt!==Mt||!(_t!==0||!Jv(St,lt,tt))||!(bt!==0||!Jv(St,ht,tt))||!(Pt!==0||!Jv(lt,St,ht))||!(Mt!==0||!Jv(lt,tt,ht))}function Jv(St,tt,lt){return tt.x<=Math.max(St.x,lt.x)&&tt.x>=Math.min(St.x,lt.x)&&tt.y<=Math.max(St.y,lt.y)&&tt.y>=Math.min(St.y,lt.y)}function Zv(St){return St>0?1:St<0?-1:0}function M_(St,tt){return Xs(St.prev,St,St.next)<0?Xs(St,tt,St.next)>=0&&Xs(St,St.prev,tt)>=0:Xs(St,tt,St.prev)<0||Xs(St,St.next,tt)<0}function iA(St,tt){const lt=new hy(St.i,St.x,St.y),ht=new hy(tt.i,tt.x,tt.y),_t=St.next,bt=tt.prev;return St.next=tt,tt.prev=St,lt.next=_t,_t.prev=lt,ht.next=lt,lt.prev=ht,bt.next=ht,ht.prev=bt,ht}function nA(St,tt,lt,ht){const _t=new hy(St,tt,lt);return ht?(_t.next=ht.next,_t.prev=ht,ht.next.prev=_t,ht.next=_t):(_t.prev=_t,_t.next=_t),_t}function I_(St){St.next.prev=St.prev,St.prev.next=St.next,St.prevZ&&(St.prevZ.nextZ=St.nextZ),St.nextZ&&(St.nextZ.prevZ=St.prevZ)}function hy(St,tt,lt){this.i=St,this.x=tt,this.y=lt,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}class tu{static area(tt){const lt=tt.length;let ht=0;for(let _t=lt-1,bt=0;bt<lt;_t=bt++)ht+=tt[_t].x*tt[bt].y-tt[bt].x*tt[_t].y;return .5*ht}static isClockWise(tt){return tu.area(tt)<0}static triangulateShape(tt,lt){const ht=[],_t=[],bt=[];sA(tt),aA(ht,tt);let Pt=tt.length;lt.forEach(sA);for(let Lt=0;Lt<lt.length;Lt++)_t.push(Pt),Pt+=lt[Lt].length,aA(ht,lt[Lt]);const Mt=function(Lt,Nt,jt=2){const Wt=Nt&&Nt.length,Qt=Wt?Nt[0]*jt:Lt.length;let qt=tA(Lt,0,Qt,jt,!0);const Xt=[];if(!qt||qt.next===qt.prev)return Xt;let Zt,Yt,ar,er,tr,Ar,wr;if(Wt&&(qt=function(br,Mr,Qr,Fr){const Vr=[];let zr,Hr,_n,hn,Rn;for(zr=0,Hr=Mr.length;zr<Hr;zr++)_n=Mr[zr]*Fr,hn=zr<Hr-1?Mr[zr+1]*Fr:br.length,Rn=tA(br,_n,hn,Fr,!1),Rn===Rn.next&&(Rn.steiner=!0),Vr.push(bE(Rn));for(Vr.sort(fE),zr=0;zr<Vr.length;zr++)Qr=vE(Vr[zr],Qr);return Qr}(Lt,Nt,qt,jt)),Lt.length>80*jt){Zt=ar=Lt[0],Yt=er=Lt[1];for(let br=jt;br<Qt;br+=jt)tr=Lt[br],Ar=Lt[br+1],tr<Zt&&(Zt=tr),Ar<Yt&&(Yt=Ar),tr>ar&&(ar=tr),Ar>er&&(er=Ar);wr=Math.max(ar-Zt,er-Yt),wr=wr!==0?32767/wr:0}return T_(qt,Xt,jt,Zt,Yt,wr,0),Xt}(ht,_t);for(let Lt=0;Lt<Mt.length;Lt+=3)bt.push(Mt.slice(Lt,Lt+3));return bt}}function sA(St){const tt=St.length;tt>2&&St[tt-1].equals(St[0])&&St.pop()}function aA(St,tt){for(let lt=0;lt<tt.length;lt++)St.push(tt[lt].x),St.push(tt[lt].y)}class e0 extends fs{constructor(tt=new Pp([new mn(.5,.5),new mn(-.5,.5),new mn(-.5,-.5),new mn(.5,-.5)]),lt={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:tt,options:lt},tt=Array.isArray(tt)?tt:[tt];const ht=this,_t=[],bt=[];for(let Mt=0,Lt=tt.length;Mt<Lt;Mt++)Pt(tt[Mt]);function Pt(Mt){const Lt=[],Nt=lt.curveSegments!==void 0?lt.curveSegments:12,jt=lt.steps!==void 0?lt.steps:1,Wt=lt.depth!==void 0?lt.depth:1;let Qt=lt.bevelEnabled===void 0||lt.bevelEnabled,qt=lt.bevelThickness!==void 0?lt.bevelThickness:.2,Xt=lt.bevelSize!==void 0?lt.bevelSize:qt-.1,Zt=lt.bevelOffset!==void 0?lt.bevelOffset:0,Yt=lt.bevelSegments!==void 0?lt.bevelSegments:3;const ar=lt.extrudePath,er=lt.UVGenerator!==void 0?lt.UVGenerator:AE;let tr,Ar,wr,br,Mr,Qr=!1;ar&&(tr=ar.getSpacedPoints(jt),Qr=!0,Qt=!1,Ar=ar.computeFrenetFrames(jt,!1),wr=new Sr,br=new Sr,Mr=new Sr),Qt||(Yt=0,qt=0,Xt=0,Zt=0);const Fr=Mt.extractPoints(Nt);let Vr=Fr.shape;const zr=Fr.holes;if(!tu.isClockWise(Vr)){Vr=Vr.reverse();for(let Ur=0,Wr=zr.length;Ur<Wr;Ur++){const kr=zr[Ur];tu.isClockWise(kr)&&(zr[Ur]=kr.reverse())}}const Hr=tu.triangulateShape(Vr,zr),_n=Vr;for(let Ur=0,Wr=zr.length;Ur<Wr;Ur++){const kr=zr[Ur];Vr=Vr.concat(kr)}function hn(Ur,Wr,kr){return Wr||console.error("THREE.ExtrudeGeometry: vec does not exist"),Ur.clone().addScaledVector(Wr,kr)}const Rn=Vr.length,Bn=Hr.length;function un(Ur,Wr,kr){let fr,Or,Nr;const $r=Ur.x-Wr.x,Kr=Ur.y-Wr.y,wn=kr.x-Ur.x,dn=kr.y-Ur.y,ms=$r*$r+Kr*Kr,ts=$r*dn-Kr*wn;if(Math.abs(ts)>Number.EPSILON){const Pn=Math.sqrt(ms),Zn=Math.sqrt(wn*wn+dn*dn),qn=Wr.x-Kr/Pn,us=Wr.y+$r/Pn,vs=((kr.x-dn/Zn-qn)*dn-(kr.y+wn/Zn-us)*wn)/($r*dn-Kr*wn);fr=qn+$r*vs-Ur.x,Or=us+Kr*vs-Ur.y;const Ls=fr*fr+Or*Or;if(Ls<=2)return new mn(fr,Or);Nr=Math.sqrt(Ls/2)}else{let Pn=!1;$r>Number.EPSILON?wn>Number.EPSILON&&(Pn=!0):$r<-Number.EPSILON?wn<-Number.EPSILON&&(Pn=!0):Math.sign(Kr)===Math.sign(dn)&&(Pn=!0),Pn?(fr=-Kr,Or=$r,Nr=Math.sqrt(ms)):(fr=$r,Or=Kr,Nr=Math.sqrt(ms/2))}return new mn(fr/Nr,Or/Nr)}const Xr=[];for(let Ur=0,Wr=_n.length,kr=Wr-1,fr=Ur+1;Ur<Wr;Ur++,kr++,fr++)kr===Wr&&(kr=0),fr===Wr&&(fr=0),Xr[Ur]=un(_n[Ur],_n[kr],_n[fr]);const Jr=[];let an,sn=Xr.concat();for(let Ur=0,Wr=zr.length;Ur<Wr;Ur++){const kr=zr[Ur];an=[];for(let fr=0,Or=kr.length,Nr=Or-1,$r=fr+1;fr<Or;fr++,Nr++,$r++)Nr===Or&&(Nr=0),$r===Or&&($r=0),an[fr]=un(kr[fr],kr[Nr],kr[$r]);Jr.push(an),sn=sn.concat(an)}for(let Ur=0;Ur<Yt;Ur++){const Wr=Ur/Yt,kr=qt*Math.cos(Wr*Math.PI/2),fr=Xt*Math.sin(Wr*Math.PI/2)+Zt;for(let Or=0,Nr=_n.length;Or<Nr;Or++){const $r=hn(_n[Or],Xr[Or],fr);Yn($r.x,$r.y,-kr)}for(let Or=0,Nr=zr.length;Or<Nr;Or++){const $r=zr[Or];an=Jr[Or];for(let Kr=0,wn=$r.length;Kr<wn;Kr++){const dn=hn($r[Kr],an[Kr],fr);Yn(dn.x,dn.y,-kr)}}}const Fn=Xt+Zt;for(let Ur=0;Ur<Rn;Ur++){const Wr=Qt?hn(Vr[Ur],sn[Ur],Fn):Vr[Ur];Qr?(br.copy(Ar.normals[0]).multiplyScalar(Wr.x),wr.copy(Ar.binormals[0]).multiplyScalar(Wr.y),Mr.copy(tr[0]).add(br).add(wr),Yn(Mr.x,Mr.y,Mr.z)):Yn(Wr.x,Wr.y,0)}for(let Ur=1;Ur<=jt;Ur++)for(let Wr=0;Wr<Rn;Wr++){const kr=Qt?hn(Vr[Wr],sn[Wr],Fn):Vr[Wr];Qr?(br.copy(Ar.normals[Ur]).multiplyScalar(kr.x),wr.copy(Ar.binormals[Ur]).multiplyScalar(kr.y),Mr.copy(tr[Ur]).add(br).add(wr),Yn(Mr.x,Mr.y,Mr.z)):Yn(kr.x,kr.y,Wt/jt*Ur)}for(let Ur=Yt-1;Ur>=0;Ur--){const Wr=Ur/Yt,kr=qt*Math.cos(Wr*Math.PI/2),fr=Xt*Math.sin(Wr*Math.PI/2)+Zt;for(let Or=0,Nr=_n.length;Or<Nr;Or++){const $r=hn(_n[Or],Xr[Or],fr);Yn($r.x,$r.y,Wt+kr)}for(let Or=0,Nr=zr.length;Or<Nr;Or++){const $r=zr[Or];an=Jr[Or];for(let Kr=0,wn=$r.length;Kr<wn;Kr++){const dn=hn($r[Kr],an[Kr],fr);Qr?Yn(dn.x,dn.y+tr[jt-1].y,tr[jt-1].x+kr):Yn(dn.x,dn.y,Wt+kr)}}}function rs(Ur,Wr){let kr=Ur.length;for(;--kr>=0;){const fr=kr;let Or=kr-1;Or<0&&(Or=Ur.length-1);for(let Nr=0,$r=jt+2*Yt;Nr<$r;Nr++){const Kr=Rn*Nr,wn=Rn*(Nr+1);cs(Wr+fr+Kr,Wr+Or+Kr,Wr+Or+wn,Wr+fr+wn)}}}function Yn(Ur,Wr,kr){Lt.push(Ur),Lt.push(Wr),Lt.push(kr)}function Un(Ur,Wr,kr){Lr(Ur),Lr(Wr),Lr(kr);const fr=_t.length/3,Or=er.generateTopUV(ht,_t,fr-3,fr-2,fr-1);Er(Or[0]),Er(Or[1]),Er(Or[2])}function cs(Ur,Wr,kr,fr){Lr(Ur),Lr(Wr),Lr(fr),Lr(Wr),Lr(kr),Lr(fr);const Or=_t.length/3,Nr=er.generateSideWallUV(ht,_t,Or-6,Or-3,Or-2,Or-1);Er(Nr[0]),Er(Nr[1]),Er(Nr[3]),Er(Nr[1]),Er(Nr[2]),Er(Nr[3])}function Lr(Ur){_t.push(Lt[3*Ur+0]),_t.push(Lt[3*Ur+1]),_t.push(Lt[3*Ur+2])}function Er(Ur){bt.push(Ur.x),bt.push(Ur.y)}(function(){const Ur=_t.length/3;if(Qt){let Wr=0,kr=Rn*Wr;for(let fr=0;fr<Bn;fr++){const Or=Hr[fr];Un(Or[2]+kr,Or[1]+kr,Or[0]+kr)}Wr=jt+2*Yt,kr=Rn*Wr;for(let fr=0;fr<Bn;fr++){const Or=Hr[fr];Un(Or[0]+kr,Or[1]+kr,Or[2]+kr)}}else{for(let Wr=0;Wr<Bn;Wr++){const kr=Hr[Wr];Un(kr[2],kr[1],kr[0])}for(let Wr=0;Wr<Bn;Wr++){const kr=Hr[Wr];Un(kr[0]+Rn*jt,kr[1]+Rn*jt,kr[2]+Rn*jt)}}ht.addGroup(Ur,_t.length/3-Ur,0)})(),function(){const Ur=_t.length/3;let Wr=0;rs(_n,Wr),Wr+=_n.length;for(let kr=0,fr=zr.length;kr<fr;kr++){const Or=zr[kr];rs(Or,Wr),Wr+=Or.length}ht.addGroup(Ur,_t.length/3-Ur,1)}()}this.setAttribute("position",new On(_t,3)),this.setAttribute("uv",new On(bt,2)),this.computeVertexNormals()}copy(tt){return super.copy(tt),this.parameters=Object.assign({},tt.parameters),this}toJSON(){const tt=super.toJSON();return function(lt,ht,_t){if(_t.shapes=[],Array.isArray(lt))for(let bt=0,Pt=lt.length;bt<Pt;bt++){const Mt=lt[bt];_t.shapes.push(Mt.uuid)}else _t.shapes.push(lt.uuid);return _t.options=Object.assign({},ht),ht.extrudePath!==void 0&&(_t.options.extrudePath=ht.extrudePath.toJSON()),_t}(this.parameters.shapes,this.parameters.options,tt)}static fromJSON(tt,lt){const ht=[];for(let bt=0,Pt=tt.shapes.length;bt<Pt;bt++){const Mt=lt[tt.shapes[bt]];ht.push(Mt)}const _t=tt.options.extrudePath;return _t!==void 0&&(tt.options.extrudePath=new Vv[_t.type]().fromJSON(_t)),new e0(ht,tt.options)}}const AE={generateTopUV:function(St,tt,lt,ht,_t){const bt=tt[3*lt],Pt=tt[3*lt+1],Mt=tt[3*ht],Lt=tt[3*ht+1],Nt=tt[3*_t],jt=tt[3*_t+1];return[new mn(bt,Pt),new mn(Mt,Lt),new mn(Nt,jt)]},generateSideWallUV:function(St,tt,lt,ht,_t,bt){const Pt=tt[3*lt],Mt=tt[3*lt+1],Lt=tt[3*lt+2],Nt=tt[3*ht],jt=tt[3*ht+1],Wt=tt[3*ht+2],Qt=tt[3*_t],qt=tt[3*_t+1],Xt=tt[3*_t+2],Zt=tt[3*bt],Yt=tt[3*bt+1],ar=tt[3*bt+2];return Math.abs(Mt-jt)<Math.abs(Pt-Nt)?[new mn(Pt,1-Lt),new mn(Nt,1-Wt),new mn(Qt,1-Xt),new mn(Zt,1-ar)]:[new mn(Mt,1-Lt),new mn(jt,1-Wt),new mn(qt,1-Xt),new mn(Yt,1-ar)]}};class t0 extends Ju{constructor(tt=1,lt=0){const ht=(1+Math.sqrt(5))/2;super([-1,ht,0,1,ht,0,-1,-ht,0,1,-ht,0,0,-1,ht,0,1,ht,0,-1,-ht,0,1,-ht,ht,0,-1,ht,0,1,-ht,0,-1,-ht,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],tt,lt),this.type="IcosahedronGeometry",this.parameters={radius:tt,detail:lt}}static fromJSON(tt){return new t0(tt.radius,tt.detail)}}class R_ extends Ju{constructor(tt=1,lt=0){super([1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],tt,lt),this.type="OctahedronGeometry",this.parameters={radius:tt,detail:lt}}static fromJSON(tt){return new R_(tt.radius,tt.detail)}}class r0 extends fs{constructor(tt=.5,lt=1,ht=32,_t=1,bt=0,Pt=2*Math.PI){super(),this.type="RingGeometry",this.parameters={innerRadius:tt,outerRadius:lt,thetaSegments:ht,phiSegments:_t,thetaStart:bt,thetaLength:Pt},ht=Math.max(3,ht);const Mt=[],Lt=[],Nt=[],jt=[];let Wt=tt;const Qt=(lt-tt)/(_t=Math.max(1,_t)),qt=new Sr,Xt=new mn;for(let Zt=0;Zt<=_t;Zt++){for(let Yt=0;Yt<=ht;Yt++){const ar=bt+Yt/ht*Pt;qt.x=Wt*Math.cos(ar),qt.y=Wt*Math.sin(ar),Lt.push(qt.x,qt.y,qt.z),Nt.push(0,0,1),Xt.x=(qt.x/lt+1)/2,Xt.y=(qt.y/lt+1)/2,jt.push(Xt.x,Xt.y)}Wt+=Qt}for(let Zt=0;Zt<_t;Zt++){const Yt=Zt*(ht+1);for(let ar=0;ar<ht;ar++){const er=ar+Yt,tr=er,Ar=er+ht+1,wr=er+ht+2,br=er+1;Mt.push(tr,Ar,br),Mt.push(Ar,wr,br)}}this.setIndex(Mt),this.setAttribute("position",new On(Lt,3)),this.setAttribute("normal",new On(Nt,3)),this.setAttribute("uv",new On(jt,2))}copy(tt){return super.copy(tt),this.parameters=Object.assign({},tt.parameters),this}static fromJSON(tt){return new r0(tt.innerRadius,tt.outerRadius,tt.thetaSegments,tt.phiSegments,tt.thetaStart,tt.thetaLength)}}class i0 extends fs{constructor(tt=new Pp([new mn(0,.5),new mn(-.5,-.5),new mn(.5,-.5)]),lt=12){super(),this.type="ShapeGeometry",this.parameters={shapes:tt,curveSegments:lt};const ht=[],_t=[],bt=[],Pt=[];let Mt=0,Lt=0;if(Array.isArray(tt)===!1)Nt(tt);else for(let jt=0;jt<tt.length;jt++)Nt(tt[jt]),this.addGroup(Mt,Lt,jt),Mt+=Lt,Lt=0;function Nt(jt){const Wt=_t.length/3,Qt=jt.extractPoints(lt);let qt=Qt.shape;const Xt=Qt.holes;tu.isClockWise(qt)===!1&&(qt=qt.reverse());for(let Yt=0,ar=Xt.length;Yt<ar;Yt++){const er=Xt[Yt];tu.isClockWise(er)===!0&&(Xt[Yt]=er.reverse())}const Zt=tu.triangulateShape(qt,Xt);for(let Yt=0,ar=Xt.length;Yt<ar;Yt++){const er=Xt[Yt];qt=qt.concat(er)}for(let Yt=0,ar=qt.length;Yt<ar;Yt++){const er=qt[Yt];_t.push(er.x,er.y,0),bt.push(0,0,1),Pt.push(er.x,er.y)}for(let Yt=0,ar=Zt.length;Yt<ar;Yt++){const er=Zt[Yt],tr=er[0]+Wt,Ar=er[1]+Wt,wr=er[2]+Wt;ht.push(tr,Ar,wr),Lt+=3}}this.setIndex(ht),this.setAttribute("position",new On(_t,3)),this.setAttribute("normal",new On(bt,3)),this.setAttribute("uv",new On(Pt,2))}copy(tt){return super.copy(tt),this.parameters=Object.assign({},tt.parameters),this}toJSON(){const tt=super.toJSON();return function(lt,ht){if(ht.shapes=[],Array.isArray(lt))for(let _t=0,bt=lt.length;_t<bt;_t++){const Pt=lt[_t];ht.shapes.push(Pt.uuid)}else ht.shapes.push(lt.uuid);return ht}(this.parameters.shapes,tt)}static fromJSON(tt,lt){const ht=[];for(let _t=0,bt=tt.shapes.length;_t<bt;_t++){const Pt=lt[tt.shapes[_t]];ht.push(Pt)}return new i0(ht,tt.curveSegments)}}class k_ extends fs{constructor(tt=1,lt=32,ht=16,_t=0,bt=2*Math.PI,Pt=0,Mt=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:tt,widthSegments:lt,heightSegments:ht,phiStart:_t,phiLength:bt,thetaStart:Pt,thetaLength:Mt},lt=Math.max(3,Math.floor(lt)),ht=Math.max(2,Math.floor(ht));const Lt=Math.min(Pt+Mt,Math.PI);let Nt=0;const jt=[],Wt=new Sr,Qt=new Sr,qt=[],Xt=[],Zt=[],Yt=[];for(let ar=0;ar<=ht;ar++){const er=[],tr=ar/ht;let Ar=0;ar===0&&Pt===0?Ar=.5/lt:ar===ht&&Lt===Math.PI&&(Ar=-.5/lt);for(let wr=0;wr<=lt;wr++){const br=wr/lt;Wt.x=-tt*Math.cos(_t+br*bt)*Math.sin(Pt+tr*Mt),Wt.y=tt*Math.cos(Pt+tr*Mt),Wt.z=tt*Math.sin(_t+br*bt)*Math.sin(Pt+tr*Mt),Xt.push(Wt.x,Wt.y,Wt.z),Qt.copy(Wt).normalize(),Zt.push(Qt.x,Qt.y,Qt.z),Yt.push(br+Ar,1-tr),er.push(Nt++)}jt.push(er)}for(let ar=0;ar<ht;ar++)for(let er=0;er<lt;er++){const tr=jt[ar][er+1],Ar=jt[ar][er],wr=jt[ar+1][er],br=jt[ar+1][er+1];(ar!==0||Pt>0)&&qt.push(tr,Ar,br),(ar!==ht-1||Lt<Math.PI)&&qt.push(Ar,wr,br)}this.setIndex(qt),this.setAttribute("position",new On(Xt,3)),this.setAttribute("normal",new On(Zt,3)),this.setAttribute("uv",new On(Yt,2))}copy(tt){return super.copy(tt),this.parameters=Object.assign({},tt.parameters),this}static fromJSON(tt){return new k_(tt.radius,tt.widthSegments,tt.heightSegments,tt.phiStart,tt.phiLength,tt.thetaStart,tt.thetaLength)}}class n0 extends Ju{constructor(tt=1,lt=0){super([1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],tt,lt),this.type="TetrahedronGeometry",this.parameters={radius:tt,detail:lt}}static fromJSON(tt){return new n0(tt.radius,tt.detail)}}class s0 extends fs{constructor(tt=1,lt=.4,ht=12,_t=48,bt=2*Math.PI){super(),this.type="TorusGeometry",this.parameters={radius:tt,tube:lt,radialSegments:ht,tubularSegments:_t,arc:bt},ht=Math.floor(ht),_t=Math.floor(_t);const Pt=[],Mt=[],Lt=[],Nt=[],jt=new Sr,Wt=new Sr,Qt=new Sr;for(let qt=0;qt<=ht;qt++)for(let Xt=0;Xt<=_t;Xt++){const Zt=Xt/_t*bt,Yt=qt/ht*Math.PI*2;Wt.x=(tt+lt*Math.cos(Yt))*Math.cos(Zt),Wt.y=(tt+lt*Math.cos(Yt))*Math.sin(Zt),Wt.z=lt*Math.sin(Yt),Mt.push(Wt.x,Wt.y,Wt.z),jt.x=tt*Math.cos(Zt),jt.y=tt*Math.sin(Zt),Qt.subVectors(Wt,jt).normalize(),Lt.push(Qt.x,Qt.y,Qt.z),Nt.push(Xt/_t),Nt.push(qt/ht)}for(let qt=1;qt<=ht;qt++)for(let Xt=1;Xt<=_t;Xt++){const Zt=(_t+1)*qt+Xt-1,Yt=(_t+1)*(qt-1)+Xt-1,ar=(_t+1)*(qt-1)+Xt,er=(_t+1)*qt+Xt;Pt.push(Zt,Yt,er),Pt.push(Yt,ar,er)}this.setIndex(Pt),this.setAttribute("position",new On(Mt,3)),this.setAttribute("normal",new On(Lt,3)),this.setAttribute("uv",new On(Nt,2))}copy(tt){return super.copy(tt),this.parameters=Object.assign({},tt.parameters),this}static fromJSON(tt){return new s0(tt.radius,tt.tube,tt.radialSegments,tt.tubularSegments,tt.arc)}}class a0 extends fs{constructor(tt=1,lt=.4,ht=64,_t=8,bt=2,Pt=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:tt,tube:lt,tubularSegments:ht,radialSegments:_t,p:bt,q:Pt},ht=Math.floor(ht),_t=Math.floor(_t);const Mt=[],Lt=[],Nt=[],jt=[],Wt=new Sr,Qt=new Sr,qt=new Sr,Xt=new Sr,Zt=new Sr,Yt=new Sr,ar=new Sr;for(let tr=0;tr<=ht;++tr){const Ar=tr/ht*bt*Math.PI*2;er(Ar,bt,Pt,tt,qt),er(Ar+.01,bt,Pt,tt,Xt),Yt.subVectors(Xt,qt),ar.addVectors(Xt,qt),Zt.crossVectors(Yt,ar),ar.crossVectors(Zt,Yt),Zt.normalize(),ar.normalize();for(let wr=0;wr<=_t;++wr){const br=wr/_t*Math.PI*2,Mr=-lt*Math.cos(br),Qr=lt*Math.sin(br);Wt.x=qt.x+(Mr*ar.x+Qr*Zt.x),Wt.y=qt.y+(Mr*ar.y+Qr*Zt.y),Wt.z=qt.z+(Mr*ar.z+Qr*Zt.z),Lt.push(Wt.x,Wt.y,Wt.z),Qt.subVectors(Wt,qt).normalize(),Nt.push(Qt.x,Qt.y,Qt.z),jt.push(tr/ht),jt.push(wr/_t)}}for(let tr=1;tr<=ht;tr++)for(let Ar=1;Ar<=_t;Ar++){const wr=(_t+1)*(tr-1)+(Ar-1),br=(_t+1)*tr+(Ar-1),Mr=(_t+1)*tr+Ar,Qr=(_t+1)*(tr-1)+Ar;Mt.push(wr,br,Qr),Mt.push(br,Mr,Qr)}function er(tr,Ar,wr,br,Mr){const Qr=Math.cos(tr),Fr=Math.sin(tr),Vr=wr/Ar*tr,zr=Math.cos(Vr);Mr.x=br*(2+zr)*.5*Qr,Mr.y=br*(2+zr)*Fr*.5,Mr.z=br*Math.sin(Vr)*.5}this.setIndex(Mt),this.setAttribute("position",new On(Lt,3)),this.setAttribute("normal",new On(Nt,3)),this.setAttribute("uv",new On(jt,2))}copy(tt){return super.copy(tt),this.parameters=Object.assign({},tt.parameters),this}static fromJSON(tt){return new a0(tt.radius,tt.tube,tt.tubularSegments,tt.radialSegments,tt.p,tt.q)}}class o0 extends fs{constructor(tt=new ly(new Sr(-1,-1,0),new Sr(-1,1,0),new Sr(1,1,0)),lt=64,ht=1,_t=8,bt=!1){super(),this.type="TubeGeometry",this.parameters={path:tt,tubularSegments:lt,radius:ht,radialSegments:_t,closed:bt};const Pt=tt.computeFrenetFrames(lt,bt);this.tangents=Pt.tangents,this.normals=Pt.normals,this.binormals=Pt.binormals;const Mt=new Sr,Lt=new Sr,Nt=new mn;let jt=new Sr;const Wt=[],Qt=[],qt=[],Xt=[];function Zt(Yt){jt=tt.getPointAt(Yt/lt,jt);const ar=Pt.normals[Yt],er=Pt.binormals[Yt];for(let tr=0;tr<=_t;tr++){const Ar=tr/_t*Math.PI*2,wr=Math.sin(Ar),br=-Math.cos(Ar);Lt.x=br*ar.x+wr*er.x,Lt.y=br*ar.y+wr*er.y,Lt.z=br*ar.z+wr*er.z,Lt.normalize(),Qt.push(Lt.x,Lt.y,Lt.z),Mt.x=jt.x+ht*Lt.x,Mt.y=jt.y+ht*Lt.y,Mt.z=jt.z+ht*Lt.z,Wt.push(Mt.x,Mt.y,Mt.z)}}(function(){for(let Yt=0;Yt<lt;Yt++)Zt(Yt);Zt(bt===!1?lt:0),function(){for(let Yt=0;Yt<=lt;Yt++)for(let ar=0;ar<=_t;ar++)Nt.x=Yt/lt,Nt.y=ar/_t,qt.push(Nt.x,Nt.y)}(),function(){for(let Yt=1;Yt<=lt;Yt++)for(let ar=1;ar<=_t;ar++){const er=(_t+1)*(Yt-1)+(ar-1),tr=(_t+1)*Yt+(ar-1),Ar=(_t+1)*Yt+ar,wr=(_t+1)*(Yt-1)+ar;Xt.push(er,tr,wr),Xt.push(tr,Ar,wr)}}()})(),this.setIndex(Xt),this.setAttribute("position",new On(Wt,3)),this.setAttribute("normal",new On(Qt,3)),this.setAttribute("uv",new On(qt,2))}copy(tt){return super.copy(tt),this.parameters=Object.assign({},tt.parameters),this}toJSON(){const tt=super.toJSON();return tt.path=this.parameters.path.toJSON(),tt}static fromJSON(tt){return new o0(new Vv[tt.path.type]().fromJSON(tt.path),tt.tubularSegments,tt.radius,tt.radialSegments,tt.closed)}}class oA extends fs{constructor(tt=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:tt},tt!==null){const lt=[],ht=new Set,_t=new Sr,bt=new Sr;if(tt.index!==null){const Pt=tt.attributes.position,Mt=tt.index;let Lt=tt.groups;Lt.length===0&&(Lt=[{start:0,count:Mt.count,materialIndex:0}]);for(let Nt=0,jt=Lt.length;Nt<jt;++Nt){const Wt=Lt[Nt],Qt=Wt.start;for(let qt=Qt,Xt=Qt+Wt.count;qt<Xt;qt+=3)for(let Zt=0;Zt<3;Zt++){const Yt=Mt.getX(qt+Zt),ar=Mt.getX(qt+(Zt+1)%3);_t.fromBufferAttribute(Pt,Yt),bt.fromBufferAttribute(Pt,ar),lA(_t,bt,ht)===!0&&(lt.push(_t.x,_t.y,_t.z),lt.push(bt.x,bt.y,bt.z))}}}else{const Pt=tt.attributes.position;for(let Mt=0,Lt=Pt.count/3;Mt<Lt;Mt++)for(let Nt=0;Nt<3;Nt++){const jt=3*Mt+Nt,Wt=3*Mt+(Nt+1)%3;_t.fromBufferAttribute(Pt,jt),bt.fromBufferAttribute(Pt,Wt),lA(_t,bt,ht)===!0&&(lt.push(_t.x,_t.y,_t.z),lt.push(bt.x,bt.y,bt.z))}}this.setAttribute("position",new On(lt,3))}}copy(tt){return super.copy(tt),this.parameters=Object.assign({},tt.parameters),this}}function lA(St,tt,lt){const ht=`${St.x},${St.y},${St.z}-${tt.x},${tt.y},${tt.z}`,_t=`${tt.x},${tt.y},${tt.z}-${St.x},${St.y},${St.z}`;return lt.has(ht)!==!0&&lt.has(_t)!==!0&&(lt.add(ht),lt.add(_t),!0)}var cA=Object.freeze({__proto__:null,BoxGeometry:Xu,CapsuleGeometry:Hv,CircleGeometry:Qv,ConeGeometry:Wv,CylinderGeometry:Rm,DodecahedronGeometry:qv,EdgesGeometry:eA,ExtrudeGeometry:e0,IcosahedronGeometry:t0,LatheGeometry:P_,OctahedronGeometry:R_,PlaneGeometry:f_,PolyhedronGeometry:Ju,RingGeometry:r0,ShapeGeometry:i0,SphereGeometry:k_,TetrahedronGeometry:n0,TorusGeometry:s0,TorusKnotGeometry:a0,TubeGeometry:o0,WireframeGeometry:oA});class uA extends ao{constructor(tt){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new jn(0),this.transparent=!0,this.fog=!0,this.setValues(tt)}copy(tt){return super.copy(tt),this.color.copy(tt.color),this.fog=tt.fog,this}}class pA extends Ul{constructor(tt){super(tt),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}class dy extends ao{constructor(tt){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new jn(16777215),this.roughness=.5,this.metalness=.1,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new jn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=xl,this.normalScale=new mn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=.05,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(tt)}copy(tt){return super.copy(tt),this.defines={STANDARD:""},this.color.copy(tt.color),this.roughness=tt.roughness,this.metalness=tt.metalness,this.map=tt.map,this.lightMap=tt.lightMap,this.lightMapIntensity=tt.lightMapIntensity,this.aoMap=tt.aoMap,this.aoMapIntensity=tt.aoMapIntensity,this.emissive.copy(tt.emissive),this.emissiveMap=tt.emissiveMap,this.emissiveIntensity=tt.emissiveIntensity,this.bumpMap=tt.bumpMap,this.bumpScale=tt.bumpScale,this.normalMap=tt.normalMap,this.normalMapType=tt.normalMapType,this.normalScale.copy(tt.normalScale),this.displacementMap=tt.displacementMap,this.displacementScale=tt.displacementScale,this.displacementBias=tt.displacementBias,this.roughnessMap=tt.roughnessMap,this.metalnessMap=tt.metalnessMap,this.alphaMap=tt.alphaMap,this.envMap=tt.envMap,this.envMapIntensity=tt.envMapIntensity,this.wireframe=tt.wireframe,this.wireframeLinewidth=tt.wireframeLinewidth,this.wireframeLinecap=tt.wireframeLinecap,this.wireframeLinejoin=tt.wireframeLinejoin,this.flatShading=tt.flatShading,this.fog=tt.fog,this}}class hA extends dy{constructor(tt){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new mn(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return Qs(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(lt){this.ior=(1+.4*lt)/(1-.4*lt)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new jn(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new jn(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new jn(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(tt)}get anisotropy(){return this._anisotropy}set anisotropy(tt){this._anisotropy>0!=tt>0&&this.version++,this._anisotropy=tt}get clearcoat(){return this._clearcoat}set clearcoat(tt){this._clearcoat>0!=tt>0&&this.version++,this._clearcoat=tt}get iridescence(){return this._iridescence}set iridescence(tt){this._iridescence>0!=tt>0&&this.version++,this._iridescence=tt}get sheen(){return this._sheen}set sheen(tt){this._sheen>0!=tt>0&&this.version++,this._sheen=tt}get transmission(){return this._transmission}set transmission(tt){this._transmission>0!=tt>0&&this.version++,this._transmission=tt}copy(tt){return super.copy(tt),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=tt.anisotropy,this.anisotropyRotation=tt.anisotropyRotation,this.anisotropyMap=tt.anisotropyMap,this.clearcoat=tt.clearcoat,this.clearcoatMap=tt.clearcoatMap,this.clearcoatRoughness=tt.clearcoatRoughness,this.clearcoatRoughnessMap=tt.clearcoatRoughnessMap,this.clearcoatNormalMap=tt.clearcoatNormalMap,this.clearcoatNormalScale.copy(tt.clearcoatNormalScale),this.ior=tt.ior,this.iridescence=tt.iridescence,this.iridescenceMap=tt.iridescenceMap,this.iridescenceIOR=tt.iridescenceIOR,this.iridescenceThicknessRange=[...tt.iridescenceThicknessRange],this.iridescenceThicknessMap=tt.iridescenceThicknessMap,this.sheen=tt.sheen,this.sheenColor.copy(tt.sheenColor),this.sheenColorMap=tt.sheenColorMap,this.sheenRoughness=tt.sheenRoughness,this.sheenRoughnessMap=tt.sheenRoughnessMap,this.transmission=tt.transmission,this.transmissionMap=tt.transmissionMap,this.thickness=tt.thickness,this.thicknessMap=tt.thicknessMap,this.attenuationDistance=tt.attenuationDistance,this.attenuationColor.copy(tt.attenuationColor),this.specularIntensity=tt.specularIntensity,this.specularIntensityMap=tt.specularIntensityMap,this.specularColor.copy(tt.specularColor),this.specularColorMap=tt.specularColorMap,this}}class dA extends ao{constructor(tt){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new jn(16777215),this.specular=new jn(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new jn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=xl,this.normalScale=new mn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=yn,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(tt)}copy(tt){return super.copy(tt),this.color.copy(tt.color),this.specular.copy(tt.specular),this.shininess=tt.shininess,this.map=tt.map,this.lightMap=tt.lightMap,this.lightMapIntensity=tt.lightMapIntensity,this.aoMap=tt.aoMap,this.aoMapIntensity=tt.aoMapIntensity,this.emissive.copy(tt.emissive),this.emissiveMap=tt.emissiveMap,this.emissiveIntensity=tt.emissiveIntensity,this.bumpMap=tt.bumpMap,this.bumpScale=tt.bumpScale,this.normalMap=tt.normalMap,this.normalMapType=tt.normalMapType,this.normalScale.copy(tt.normalScale),this.displacementMap=tt.displacementMap,this.displacementScale=tt.displacementScale,this.displacementBias=tt.displacementBias,this.specularMap=tt.specularMap,this.alphaMap=tt.alphaMap,this.envMap=tt.envMap,this.combine=tt.combine,this.reflectivity=tt.reflectivity,this.refractionRatio=tt.refractionRatio,this.wireframe=tt.wireframe,this.wireframeLinewidth=tt.wireframeLinewidth,this.wireframeLinecap=tt.wireframeLinecap,this.wireframeLinejoin=tt.wireframeLinejoin,this.flatShading=tt.flatShading,this.fog=tt.fog,this}}class mA extends ao{constructor(tt){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new jn(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new jn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=xl,this.normalScale=new mn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(tt)}copy(tt){return super.copy(tt),this.color.copy(tt.color),this.map=tt.map,this.gradientMap=tt.gradientMap,this.lightMap=tt.lightMap,this.lightMapIntensity=tt.lightMapIntensity,this.aoMap=tt.aoMap,this.aoMapIntensity=tt.aoMapIntensity,this.emissive.copy(tt.emissive),this.emissiveMap=tt.emissiveMap,this.emissiveIntensity=tt.emissiveIntensity,this.bumpMap=tt.bumpMap,this.bumpScale=tt.bumpScale,this.normalMap=tt.normalMap,this.normalMapType=tt.normalMapType,this.normalScale.copy(tt.normalScale),this.displacementMap=tt.displacementMap,this.displacementScale=tt.displacementScale,this.displacementBias=tt.displacementBias,this.alphaMap=tt.alphaMap,this.wireframe=tt.wireframe,this.wireframeLinewidth=tt.wireframeLinewidth,this.wireframeLinecap=tt.wireframeLinecap,this.wireframeLinejoin=tt.wireframeLinejoin,this.fog=tt.fog,this}}class gA extends ao{constructor(tt){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=xl,this.normalScale=new mn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(tt)}copy(tt){return super.copy(tt),this.bumpMap=tt.bumpMap,this.bumpScale=tt.bumpScale,this.normalMap=tt.normalMap,this.normalMapType=tt.normalMapType,this.normalScale.copy(tt.normalScale),this.displacementMap=tt.displacementMap,this.displacementScale=tt.displacementScale,this.displacementBias=tt.displacementBias,this.wireframe=tt.wireframe,this.wireframeLinewidth=tt.wireframeLinewidth,this.flatShading=tt.flatShading,this}}class _A extends ao{constructor(tt){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new jn(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new jn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=xl,this.normalScale=new mn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=yn,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(tt)}copy(tt){return super.copy(tt),this.color.copy(tt.color),this.map=tt.map,this.lightMap=tt.lightMap,this.lightMapIntensity=tt.lightMapIntensity,this.aoMap=tt.aoMap,this.aoMapIntensity=tt.aoMapIntensity,this.emissive.copy(tt.emissive),this.emissiveMap=tt.emissiveMap,this.emissiveIntensity=tt.emissiveIntensity,this.bumpMap=tt.bumpMap,this.bumpScale=tt.bumpScale,this.normalMap=tt.normalMap,this.normalMapType=tt.normalMapType,this.normalScale.copy(tt.normalScale),this.displacementMap=tt.displacementMap,this.displacementScale=tt.displacementScale,this.displacementBias=tt.displacementBias,this.specularMap=tt.specularMap,this.alphaMap=tt.alphaMap,this.envMap=tt.envMap,this.combine=tt.combine,this.reflectivity=tt.reflectivity,this.refractionRatio=tt.refractionRatio,this.wireframe=tt.wireframe,this.wireframeLinewidth=tt.wireframeLinewidth,this.wireframeLinecap=tt.wireframeLinecap,this.wireframeLinejoin=tt.wireframeLinejoin,this.flatShading=tt.flatShading,this.fog=tt.fog,this}}class fA extends ao{constructor(tt){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new jn(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=xl,this.normalScale=new mn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(tt)}copy(tt){return super.copy(tt),this.defines={MATCAP:""},this.color.copy(tt.color),this.matcap=tt.matcap,this.map=tt.map,this.bumpMap=tt.bumpMap,this.bumpScale=tt.bumpScale,this.normalMap=tt.normalMap,this.normalMapType=tt.normalMapType,this.normalScale.copy(tt.normalScale),this.displacementMap=tt.displacementMap,this.displacementScale=tt.displacementScale,this.displacementBias=tt.displacementBias,this.alphaMap=tt.alphaMap,this.flatShading=tt.flatShading,this.fog=tt.fog,this}}class vA extends Oo{constructor(tt){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(tt)}copy(tt){return super.copy(tt),this.scale=tt.scale,this.dashSize=tt.dashSize,this.gapSize=tt.gapSize,this}}function Mp(St,tt,lt){return!St||!lt&&St.constructor===tt?St:typeof tt.BYTES_PER_ELEMENT=="number"?new tt(St):Array.prototype.slice.call(St)}function yA(St){return ArrayBuffer.isView(St)&&!(St instanceof DataView)}function bA(St){const tt=St.length,lt=new Array(tt);for(let ht=0;ht!==tt;++ht)lt[ht]=ht;return lt.sort(function(ht,_t){return St[ht]-St[_t]}),lt}function my(St,tt,lt){const ht=St.length,_t=new St.constructor(ht);for(let bt=0,Pt=0;Pt!==ht;++bt){const Mt=lt[bt]*tt;for(let Lt=0;Lt!==tt;++Lt)_t[Pt++]=St[Mt+Lt]}return _t}function gy(St,tt,lt,ht){let _t=1,bt=St[0];for(;bt!==void 0&&bt[ht]===void 0;)bt=St[_t++];if(bt===void 0)return;let Pt=bt[ht];if(Pt!==void 0)if(Array.isArray(Pt))do Pt=bt[ht],Pt!==void 0&&(tt.push(bt.time),lt.push.apply(lt,Pt)),bt=St[_t++];while(bt!==void 0);else if(Pt.toArray!==void 0)do Pt=bt[ht],Pt!==void 0&&(tt.push(bt.time),Pt.toArray(lt,lt.length)),bt=St[_t++];while(bt!==void 0);else do Pt=bt[ht],Pt!==void 0&&(tt.push(bt.time),lt.push(Pt)),bt=St[_t++];while(bt!==void 0)}const wE={convertArray:Mp,isTypedArray:yA,getKeyframeOrder:bA,sortedArray:my,flattenJSON:gy,subclip:function(St,tt,lt,ht,_t=30){const bt=St.clone();bt.name=tt;const Pt=[];for(let Lt=0;Lt<bt.tracks.length;++Lt){const Nt=bt.tracks[Lt],jt=Nt.getValueSize(),Wt=[],Qt=[];for(let qt=0;qt<Nt.times.length;++qt){const Xt=Nt.times[qt]*_t;if(!(Xt<lt||Xt>=ht)){Wt.push(Nt.times[qt]);for(let Zt=0;Zt<jt;++Zt)Qt.push(Nt.values[qt*jt+Zt])}}Wt.length!==0&&(Nt.times=Mp(Wt,Nt.times.constructor),Nt.values=Mp(Qt,Nt.values.constructor),Pt.push(Nt))}bt.tracks=Pt;let Mt=1/0;for(let Lt=0;Lt<bt.tracks.length;++Lt)Mt>bt.tracks[Lt].times[0]&&(Mt=bt.tracks[Lt].times[0]);for(let Lt=0;Lt<bt.tracks.length;++Lt)bt.tracks[Lt].shift(-1*Mt);return bt.resetDuration(),bt},makeClipAdditive:function(St,tt=0,lt=St,ht=30){ht<=0&&(ht=30);const _t=lt.tracks.length,bt=tt/ht;for(let Pt=0;Pt<_t;++Pt){const Mt=lt.tracks[Pt],Lt=Mt.ValueTypeName;if(Lt==="bool"||Lt==="string")continue;const Nt=St.tracks.find(function(ar){return ar.name===Mt.name&&ar.ValueTypeName===Lt});if(Nt===void 0)continue;let jt=0;const Wt=Mt.getValueSize();Mt.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(jt=Wt/3);let Qt=0;const qt=Nt.getValueSize();Nt.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(Qt=qt/3);const Xt=Mt.times.length-1;let Zt;if(bt<=Mt.times[0]){const ar=jt,er=Wt-jt;Zt=Mt.values.slice(ar,er)}else if(bt>=Mt.times[Xt]){const ar=Xt*Wt+jt,er=ar+Wt-jt;Zt=Mt.values.slice(ar,er)}else{const ar=Mt.createInterpolant(),er=jt,tr=Wt-jt;ar.evaluate(bt),Zt=ar.resultBuffer.slice(er,tr)}Lt==="quaternion"&&new Eo().fromArray(Zt).normalize().conjugate().toArray(Zt);const Yt=Nt.times.length;for(let ar=0;ar<Yt;++ar){const er=ar*qt+Qt;if(Lt==="quaternion")Eo.multiplyQuaternionsFlat(Nt.values,er,Zt,0,Nt.values,er);else{const tr=qt-2*Qt;for(let Ar=0;Ar<tr;++Ar)Nt.values[er+Ar]-=Zt[Ar]}}}return St.blendMode=Yp,St}};class D_{constructor(tt,lt,ht,_t){this.parameterPositions=tt,this._cachedIndex=0,this.resultBuffer=_t!==void 0?_t:new lt.constructor(ht),this.sampleValues=lt,this.valueSize=ht,this.settings=null,this.DefaultSettings_={}}evaluate(tt){const lt=this.parameterPositions;let ht=this._cachedIndex,_t=lt[ht],bt=lt[ht-1];e:{t:{let Pt;r:{i:if(!(tt<_t)){for(let Mt=ht+2;;){if(_t===void 0){if(tt<bt)break i;return ht=lt.length,this._cachedIndex=ht,this.copySampleValue_(ht-1)}if(ht===Mt)break;if(bt=_t,_t=lt[++ht],tt<_t)break t}Pt=lt.length;break r}if(tt>=bt)break e;{const Mt=lt[1];tt<Mt&&(ht=2,bt=Mt);for(let Lt=ht-2;;){if(bt===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(ht===Lt)break;if(_t=bt,bt=lt[--ht-1],tt>=bt)break t}Pt=ht,ht=0}}for(;ht<Pt;){const Mt=ht+Pt>>>1;tt<lt[Mt]?Pt=Mt:ht=Mt+1}if(_t=lt[ht],bt=lt[ht-1],bt===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(_t===void 0)return ht=lt.length,this._cachedIndex=ht,this.copySampleValue_(ht-1)}this._cachedIndex=ht,this.intervalChanged_(ht,bt,_t)}return this.interpolate_(ht,bt,tt,_t)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(tt){const lt=this.resultBuffer,ht=this.sampleValues,_t=this.valueSize,bt=tt*_t;for(let Pt=0;Pt!==_t;++Pt)lt[Pt]=ht[bt+Pt];return lt}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class xA extends D_{constructor(tt,lt,ht,_t){super(tt,lt,ht,_t),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:ou,endingEnd:ou}}intervalChanged_(tt,lt,ht){const _t=this.parameterPositions;let bt=tt-2,Pt=tt+1,Mt=_t[bt],Lt=_t[Pt];if(Mt===void 0)switch(this.getSettings_().endingStart){case lu:bt=tt,Mt=2*lt-ht;break;case lp:bt=_t.length-2,Mt=lt+_t[bt]-_t[bt+1];break;default:bt=tt,Mt=ht}if(Lt===void 0)switch(this.getSettings_().endingEnd){case lu:Pt=tt,Lt=2*ht-lt;break;case lp:Pt=1,Lt=ht+_t[1]-_t[0];break;default:Pt=tt-1,Lt=lt}const Nt=.5*(ht-lt),jt=this.valueSize;this._weightPrev=Nt/(lt-Mt),this._weightNext=Nt/(Lt-ht),this._offsetPrev=bt*jt,this._offsetNext=Pt*jt}interpolate_(tt,lt,ht,_t){const bt=this.resultBuffer,Pt=this.sampleValues,Mt=this.valueSize,Lt=tt*Mt,Nt=Lt-Mt,jt=this._offsetPrev,Wt=this._offsetNext,Qt=this._weightPrev,qt=this._weightNext,Xt=(ht-lt)/(_t-lt),Zt=Xt*Xt,Yt=Zt*Xt,ar=-Qt*Yt+2*Qt*Zt-Qt*Xt,er=(1+Qt)*Yt+(-1.5-2*Qt)*Zt+(-.5+Qt)*Xt+1,tr=(-1-qt)*Yt+(1.5+qt)*Zt+.5*Xt,Ar=qt*Yt-qt*Zt;for(let wr=0;wr!==Mt;++wr)bt[wr]=ar*Pt[jt+wr]+er*Pt[Nt+wr]+tr*Pt[Lt+wr]+Ar*Pt[Wt+wr];return bt}}class _y extends D_{constructor(tt,lt,ht,_t){super(tt,lt,ht,_t)}interpolate_(tt,lt,ht,_t){const bt=this.resultBuffer,Pt=this.sampleValues,Mt=this.valueSize,Lt=tt*Mt,Nt=Lt-Mt,jt=(ht-lt)/(_t-lt),Wt=1-jt;for(let Qt=0;Qt!==Mt;++Qt)bt[Qt]=Pt[Nt+Qt]*Wt+Pt[Lt+Qt]*jt;return bt}}class AA extends D_{constructor(tt,lt,ht,_t){super(tt,lt,ht,_t)}interpolate_(tt){return this.copySampleValue_(tt-1)}}class zl{constructor(tt,lt,ht,_t){if(tt===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(lt===void 0||lt.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+tt);this.name=tt,this.times=Mp(lt,this.TimeBufferType),this.values=Mp(ht,this.ValueBufferType),this.setInterpolation(_t||this.DefaultInterpolation)}static toJSON(tt){const lt=tt.constructor;let ht;if(lt.toJSON!==this.toJSON)ht=lt.toJSON(tt);else{ht={name:tt.name,times:Mp(tt.times,Array),values:Mp(tt.values,Array)};const _t=tt.getInterpolation();_t!==tt.DefaultInterpolation&&(ht.interpolation=_t)}return ht.type=tt.ValueTypeName,ht}InterpolantFactoryMethodDiscrete(tt){return new AA(this.times,this.values,this.getValueSize(),tt)}InterpolantFactoryMethodLinear(tt){return new _y(this.times,this.values,this.getValueSize(),tt)}InterpolantFactoryMethodSmooth(tt){return new xA(this.times,this.values,this.getValueSize(),tt)}setInterpolation(tt){let lt;switch(tt){case Iu:lt=this.InterpolantFactoryMethodDiscrete;break;case op:lt=this.InterpolantFactoryMethodLinear;break;case Xp:lt=this.InterpolantFactoryMethodSmooth}if(lt===void 0){const ht="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0){if(tt===this.DefaultInterpolation)throw new Error(ht);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",ht),this}return this.createInterpolant=lt,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Iu;case this.InterpolantFactoryMethodLinear:return op;case this.InterpolantFactoryMethodSmooth:return Xp}}getValueSize(){return this.values.length/this.times.length}shift(tt){if(tt!==0){const lt=this.times;for(let ht=0,_t=lt.length;ht!==_t;++ht)lt[ht]+=tt}return this}scale(tt){if(tt!==1){const lt=this.times;for(let ht=0,_t=lt.length;ht!==_t;++ht)lt[ht]*=tt}return this}trim(tt,lt){const ht=this.times,_t=ht.length;let bt=0,Pt=_t-1;for(;bt!==_t&&ht[bt]<tt;)++bt;for(;Pt!==-1&&ht[Pt]>lt;)--Pt;if(++Pt,bt!==0||Pt!==_t){bt>=Pt&&(Pt=Math.max(Pt,1),bt=Pt-1);const Mt=this.getValueSize();this.times=ht.slice(bt,Pt),this.values=this.values.slice(bt*Mt,Pt*Mt)}return this}validate(){let tt=!0;const lt=this.getValueSize();lt-Math.floor(lt)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),tt=!1);const ht=this.times,_t=this.values,bt=ht.length;bt===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),tt=!1);let Pt=null;for(let Mt=0;Mt!==bt;Mt++){const Lt=ht[Mt];if(typeof Lt=="number"&&isNaN(Lt)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,Mt,Lt),tt=!1;break}if(Pt!==null&&Pt>Lt){console.error("THREE.KeyframeTrack: Out of order keys.",this,Mt,Lt,Pt),tt=!1;break}Pt=Lt}if(_t!==void 0&&yA(_t))for(let Mt=0,Lt=_t.length;Mt!==Lt;++Mt){const Nt=_t[Mt];if(isNaN(Nt)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,Mt,Nt),tt=!1;break}}return tt}optimize(){const tt=this.times.slice(),lt=this.values.slice(),ht=this.getValueSize(),_t=this.getInterpolation()===Xp,bt=tt.length-1;let Pt=1;for(let Mt=1;Mt<bt;++Mt){let Lt=!1;const Nt=tt[Mt];if(Nt!==tt[Mt+1]&&(Mt!==1||Nt!==tt[0]))if(_t)Lt=!0;else{const jt=Mt*ht,Wt=jt-ht,Qt=jt+ht;for(let qt=0;qt!==ht;++qt){const Xt=lt[jt+qt];if(Xt!==lt[Wt+qt]||Xt!==lt[Qt+qt]){Lt=!0;break}}}if(Lt){if(Mt!==Pt){tt[Pt]=tt[Mt];const jt=Mt*ht,Wt=Pt*ht;for(let Qt=0;Qt!==ht;++Qt)lt[Wt+Qt]=lt[jt+Qt]}++Pt}}if(bt>0){tt[Pt]=tt[bt];for(let Mt=bt*ht,Lt=Pt*ht,Nt=0;Nt!==ht;++Nt)lt[Lt+Nt]=lt[Mt+Nt];++Pt}return Pt!==tt.length?(this.times=tt.slice(0,Pt),this.values=lt.slice(0,Pt*ht)):(this.times=tt,this.values=lt),this}clone(){const tt=this.times.slice(),lt=this.values.slice(),ht=new this.constructor(this.name,tt,lt);return ht.createInterpolant=this.createInterpolant,ht}}zl.prototype.TimeBufferType=Float32Array,zl.prototype.ValueBufferType=Float32Array,zl.prototype.DefaultInterpolation=op;class Ip extends zl{}Ip.prototype.ValueTypeName="bool",Ip.prototype.ValueBufferType=Array,Ip.prototype.DefaultInterpolation=Iu,Ip.prototype.InterpolantFactoryMethodLinear=void 0,Ip.prototype.InterpolantFactoryMethodSmooth=void 0;class fy extends zl{}fy.prototype.ValueTypeName="color";class B_ extends zl{}B_.prototype.ValueTypeName="number";class wA extends D_{constructor(tt,lt,ht,_t){super(tt,lt,ht,_t)}interpolate_(tt,lt,ht,_t){const bt=this.resultBuffer,Pt=this.sampleValues,Mt=this.valueSize,Lt=(ht-lt)/(_t-lt);let Nt=tt*Mt;for(let jt=Nt+Mt;Nt!==jt;Nt+=4)Eo.slerpFlat(bt,0,Pt,Nt-Mt,Pt,Nt,Lt);return bt}}class Dm extends zl{InterpolantFactoryMethodLinear(tt){return new wA(this.times,this.values,this.getValueSize(),tt)}}Dm.prototype.ValueTypeName="quaternion",Dm.prototype.DefaultInterpolation=op,Dm.prototype.InterpolantFactoryMethodSmooth=void 0;class Rp extends zl{}Rp.prototype.ValueTypeName="string",Rp.prototype.ValueBufferType=Array,Rp.prototype.DefaultInterpolation=Iu,Rp.prototype.InterpolantFactoryMethodLinear=void 0,Rp.prototype.InterpolantFactoryMethodSmooth=void 0;class L_ extends zl{}L_.prototype.ValueTypeName="vector";class O_{constructor(tt,lt=-1,ht,_t=Hm){this.name=tt,this.tracks=ht,this.duration=lt,this.blendMode=_t,this.uuid=Ao(),this.duration<0&&this.resetDuration()}static parse(tt){const lt=[],ht=tt.tracks,_t=1/(tt.fps||1);for(let Pt=0,Mt=ht.length;Pt!==Mt;++Pt)lt.push(EE(ht[Pt]).scale(_t));const bt=new this(tt.name,tt.duration,lt,tt.blendMode);return bt.uuid=tt.uuid,bt}static toJSON(tt){const lt=[],ht=tt.tracks,_t={name:tt.name,duration:tt.duration,tracks:lt,uuid:tt.uuid,blendMode:tt.blendMode};for(let bt=0,Pt=ht.length;bt!==Pt;++bt)lt.push(zl.toJSON(ht[bt]));return _t}static CreateFromMorphTargetSequence(tt,lt,ht,_t){const bt=lt.length,Pt=[];for(let Mt=0;Mt<bt;Mt++){let Lt=[],Nt=[];Lt.push((Mt+bt-1)%bt,Mt,(Mt+1)%bt),Nt.push(0,1,0);const jt=bA(Lt);Lt=my(Lt,1,jt),Nt=my(Nt,1,jt),_t||Lt[0]!==0||(Lt.push(bt),Nt.push(Nt[0])),Pt.push(new B_(".morphTargetInfluences["+lt[Mt].name+"]",Lt,Nt).scale(1/ht))}return new this(tt,-1,Pt)}static findByName(tt,lt){let ht=tt;if(!Array.isArray(tt)){const _t=tt;ht=_t.geometry&&_t.geometry.animations||_t.animations}for(let _t=0;_t<ht.length;_t++)if(ht[_t].name===lt)return ht[_t];return null}static CreateClipsFromMorphTargetSequences(tt,lt,ht){const _t={},bt=/^([\w-]*?)([\d]+)$/;for(let Mt=0,Lt=tt.length;Mt<Lt;Mt++){const Nt=tt[Mt],jt=Nt.name.match(bt);if(jt&&jt.length>1){const Wt=jt[1];let Qt=_t[Wt];Qt||(_t[Wt]=Qt=[]),Qt.push(Nt)}}const Pt=[];for(const Mt in _t)Pt.push(this.CreateFromMorphTargetSequence(Mt,_t[Mt],lt,ht));return Pt}static parseAnimation(tt,lt){if(!tt)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const ht=function(jt,Wt,Qt,qt,Xt){if(Qt.length!==0){const Zt=[],Yt=[];gy(Qt,Zt,Yt,qt),Zt.length!==0&&Xt.push(new jt(Wt,Zt,Yt))}},_t=[],bt=tt.name||"default",Pt=tt.fps||30,Mt=tt.blendMode;let Lt=tt.length||-1;const Nt=tt.hierarchy||[];for(let jt=0;jt<Nt.length;jt++){const Wt=Nt[jt].keys;if(Wt&&Wt.length!==0)if(Wt[0].morphTargets){const Qt={};let qt;for(qt=0;qt<Wt.length;qt++)if(Wt[qt].morphTargets)for(let Xt=0;Xt<Wt[qt].morphTargets.length;Xt++)Qt[Wt[qt].morphTargets[Xt]]=-1;for(const Xt in Qt){const Zt=[],Yt=[];for(let ar=0;ar!==Wt[qt].morphTargets.length;++ar){const er=Wt[qt];Zt.push(er.time),Yt.push(er.morphTarget===Xt?1:0)}_t.push(new B_(".morphTargetInfluence["+Xt+"]",Zt,Yt))}Lt=Qt.length*Pt}else{const Qt=".bones["+lt[jt].name+"]";ht(L_,Qt+".position",Wt,"pos",_t),ht(Dm,Qt+".quaternion",Wt,"rot",_t),ht(L_,Qt+".scale",Wt,"scl",_t)}}return _t.length===0?null:new this(bt,Lt,_t,Mt)}resetDuration(){let tt=0;for(let lt=0,ht=this.tracks.length;lt!==ht;++lt){const _t=this.tracks[lt];tt=Math.max(tt,_t.times[_t.times.length-1])}return this.duration=tt,this}trim(){for(let tt=0;tt<this.tracks.length;tt++)this.tracks[tt].trim(0,this.duration);return this}validate(){let tt=!0;for(let lt=0;lt<this.tracks.length;lt++)tt=tt&&this.tracks[lt].validate();return tt}optimize(){for(let tt=0;tt<this.tracks.length;tt++)this.tracks[tt].optimize();return this}clone(){const tt=[];for(let lt=0;lt<this.tracks.length;lt++)tt.push(this.tracks[lt].clone());return new this.constructor(this.name,this.duration,tt,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function EE(St){if(St.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const tt=function(lt){switch(lt.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return B_;case"vector":case"vector2":case"vector3":case"vector4":return L_;case"color":return fy;case"quaternion":return Dm;case"bool":case"boolean":return Ip;case"string":return Rp}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+lt)}(St.type);if(St.times===void 0){const lt=[],ht=[];gy(St.keys,lt,ht,"value"),St.times=lt,St.values=ht}return tt.parse!==void 0?tt.parse(St):new tt(St.name,St.times,St.values,St.interpolation)}const xu={enabled:!1,files:{},add:function(St,tt){this.enabled!==!1&&(this.files[St]=tt)},get:function(St,tt){return this.enabled===!1?tt?Promise.resolve():void 0:tt?Promise.resolve(this.files[St]):this.files[St]},remove:function(St){delete this.files[St]},clear:function(){this.files={}}};class vy{constructor(tt,lt,ht){const _t=this;let bt,Pt=!1,Mt=0,Lt=0;const Nt=[];this.onStart=void 0,this.onLoad=tt,this.onProgress=lt,this.onError=ht,this.itemStart=function(jt){Lt++,Pt===!1&&_t.onStart!==void 0&&_t.onStart(jt,Mt,Lt),Pt=!0},this.itemEnd=function(jt){Mt++,_t.onProgress!==void 0&&_t.onProgress(jt,Mt,Lt),Mt===Lt&&(Pt=!1,_t.onLoad!==void 0&&_t.onLoad())},this.itemError=function(jt){_t.onError!==void 0&&_t.onError(jt)},this.resolveURL=function(jt){return bt?bt(jt):jt},this.setURLModifier=function(jt){return bt=jt,this},this.addHandler=function(jt,Wt){return Nt.push(jt,Wt),this},this.removeHandler=function(jt){const Wt=Nt.indexOf(jt);return Wt!==-1&&Nt.splice(Wt,2),this},this.getHandler=function(jt){for(let Wt=0,Qt=Nt.length;Wt<Qt;Wt+=2){const qt=Nt[Wt],Xt=Nt[Wt+1];if(qt.global&&(qt.lastIndex=0),qt.test(jt))return Xt}return null}}}const EA=new vy;class Vo{constructor(tt){this.manager=tt!==void 0?tt:EA,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(tt,lt){const ht=this;return new Promise(function(_t,bt){ht.load(tt,_t,lt,bt)})}parse(){}setCrossOrigin(tt){return this.crossOrigin=tt,this}setWithCredentials(tt){return this.withCredentials=tt,this}setPath(tt){return this.path=tt,this}setResourcePath(tt){return this.resourcePath=tt,this}setRequestHeader(tt){return this.requestHeader=tt,this}}Vo.DEFAULT_MATERIAL_NAME="__DEFAULT";const Au={};class SE extends Error{constructor(tt,lt){super(tt),this.response=lt}}class ru extends Vo{constructor(tt){super(tt),this.responseType="text",this.useCache=!0}load(tt,lt,ht,_t){tt===void 0&&(tt=""),this.path!==void 0&&(tt=this.path+tt),tt=this.manager.resolveURL(tt),(this.useCache?xu.get(tt,this.responseType,this.mimeType):Promise.resolve(void 0)).then(bt=>{if(bt!==void 0)return this.manager.itemStart(tt),setTimeout(()=>{lt&&lt(bt),this.manager.itemEnd(tt)},0),bt;if(Au[tt]!==void 0)return void Au[tt].push({onLoad:lt,onProgress:ht,onError:_t});Au[tt]=[],Au[tt].push({onLoad:lt,onProgress:ht,onError:_t});const Pt=new Request(tt,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),Mt=this.mimeType,Lt=this.responseType;fetch(Pt).then(Nt=>{if(Nt.status===200||Nt.status===0){if(Nt.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||Nt.body===void 0||Nt.body.getReader===void 0)return Nt;const jt=Au[tt],Wt=Nt.body.getReader(),Qt=Nt.headers.get("Content-Length")||Nt.headers.get("X-File-Size"),qt=Qt?parseInt(Qt):0,Xt=qt!==0;let Zt=0;const Yt=new ReadableStream({start(ar){(function er(){Wt.read().then(({done:tr,value:Ar})=>{if(tr)ar.close();else{Zt+=Ar.byteLength;const wr=new ProgressEvent("progress",{lengthComputable:Xt,loaded:Zt,total:qt});for(let br=0,Mr=jt.length;br<Mr;br++){const Qr=jt[br];Qr.onProgress&&Qr.onProgress(wr)}ar.enqueue(Ar),er()}})})()}});return new Response(Yt)}throw new SE(`fetch for "${Nt.url}" responded with ${Nt.status}: ${Nt.statusText}`,Nt)}).then(Nt=>{switch(Lt){case"arraybuffer":return Nt.arrayBuffer();case"blob":return Nt.blob();case"document":return Nt.text().then(jt=>new DOMParser().parseFromString(jt,Mt));case"json":return Nt.json();default:if(Mt===void 0)return Nt.text();{const jt=/charset="?([^;"\s]*)"?/i.exec(Mt),Wt=jt&&jt[1]?jt[1].toLowerCase():void 0,Qt=new TextDecoder(Wt);return Nt.arrayBuffer().then(qt=>Qt.decode(qt))}}}).then(Nt=>{this.useCache&&xu.add(tt,Nt,this.responseType);const jt=Au[tt];delete Au[tt];for(let Wt=0,Qt=jt.length;Wt<Qt;Wt++){const qt=jt[Wt];qt.onLoad&&qt.onLoad(Nt)}}).catch(Nt=>{const jt=Au[tt];if(jt===void 0)throw this.manager.itemError(tt),Nt;delete Au[tt];for(let Wt=0,Qt=jt.length;Wt<Qt;Wt++){const qt=jt[Wt];qt.onError&&qt.onError(Nt)}this.manager.itemError(tt)}).finally(()=>{this.useCache&&this.manager.itemEnd(tt)}),this.useCache&&this.manager.itemStart(tt)})}setResponseType(tt){return this.responseType=tt,this}setMimeType(tt){return this.mimeType=tt,this}}class CE extends Vo{constructor(tt){super(tt)}load(tt,lt,ht,_t){const bt=this,Pt=new ru(this.manager);Pt.setPath(this.path),Pt.setRequestHeader(this.requestHeader),Pt.setWithCredentials(this.withCredentials),Pt.load(tt,function(Mt){try{lt(bt.parse(JSON.parse(Mt)))}catch(Lt){_t?_t(Lt):console.error(Lt),bt.manager.itemError(tt)}},ht,_t)}parse(tt){const lt=[];for(let ht=0;ht<tt.length;ht++){const _t=O_.parse(tt[ht]);lt.push(_t)}return lt}}class PE extends Vo{constructor(tt){super(tt)}load(tt,lt,ht,_t){const bt=this,Pt=[],Mt=new jv,Lt=new ru(this.manager);Lt.setPath(this.path),Lt.setResponseType("arraybuffer"),Lt.setRequestHeader(this.requestHeader),Lt.setWithCredentials(bt.withCredentials);let Nt=0;function jt(Wt){Lt.load(tt[Wt],function(Qt){const qt=bt.parse(Qt,!0);Pt[Wt]={width:qt.width,height:qt.height,format:qt.format,mipmaps:qt.mipmaps},Nt+=1,Nt===6&&(qt.mipmapCount===1&&(Mt.minFilter=Wn),Mt.image=Pt,Mt.format=qt.format,Mt.needsUpdate=!0,lt&&lt(Mt))},ht,_t)}if(Array.isArray(tt))for(let Wt=0,Qt=tt.length;Wt<Qt;++Wt)jt(Wt);else Lt.load(tt,function(Wt){const Qt=bt.parse(Wt,!0);if(Qt.isCubemap){const qt=Qt.mipmaps.length/Qt.mipmapCount;for(let Xt=0;Xt<qt;Xt++){Pt[Xt]={mipmaps:[]};for(let Zt=0;Zt<Qt.mipmapCount;Zt++)Pt[Xt].mipmaps.push(Qt.mipmaps[Xt*Qt.mipmapCount+Zt]),Pt[Xt].format=Qt.format,Pt[Xt].width=Qt.width,Pt[Xt].height=Qt.height}Mt.image=Pt}else Mt.image.width=Qt.width,Mt.image.height=Qt.height,Mt.mipmaps=Qt.mipmaps;Qt.mipmapCount===1&&(Mt.minFilter=Wn),Mt.format=Qt.format,Mt.needsUpdate=!0,lt&&lt(Mt)},ht,_t);return Mt}}class N_ extends Vo{constructor(tt){super(tt)}load(tt,lt,ht,_t){const bt=tt;this.path!==void 0&&(tt=this.path+tt),tt=this.manager.resolveURL(tt);const Pt=this,Mt=xu.get(tt);if(Mt!==void 0)return Pt.manager.itemStart(tt),setTimeout(function(){lt&&lt(Mt),Pt.manager.itemEnd(tt)},0),Mt;const Lt=gu("img");function Nt(){Wt(),xu.add(tt,this),lt&&lt(this),Pt.manager.itemEnd(tt)}function jt(Qt){Wt(),_t&&_t(Qt),Pt.manager.itemError(tt),Pt.manager.itemEnd(tt)}function Wt(){Lt.removeEventListener("load",Nt,!1),Lt.removeEventListener("error",jt,!1)}return Lt.addEventListener("load",Nt,!1),Lt.addEventListener("error",jt,!1),tt.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(Lt.crossOrigin=this.crossOrigin),Pt.manager.itemStart(tt),xu.get(tt,"blob").then(Qt=>{if(Qt!==void 0&&!Qt.type.startsWith("text/plain"))return Qt.type||(tt.endsWith(".svg")||tt.startsWith("data:image/svg"))&&(Qt=new Blob([Qt],{type:"image/svg+xml"})),void(Lt.src=URL.createObjectURL(Qt));const qt=new ru(this.manager);qt.useCache=!1,qt.setPath(this.path),qt.setCrossOrigin(this.crossOrigin),qt.setResponseType("blob"),qt.load(bt,function(Xt){Xt.type||(tt.endsWith(".svg")||tt.startsWith("data:image/svg"))&&(Xt=new Blob([Xt],{type:"image/svg+xml"})),xu.add(tt,Xt,"blob"),Lt.src=URL.createObjectURL(Xt)},ht,Xt=>{Wt(),_t&&_t(Xt)})}),Lt}}class TE extends Vo{constructor(tt){super(tt)}load(tt,lt,ht,_t){const bt=new __;bt.colorSpace=Ns;const Pt=new N_(this.manager);Pt.setCrossOrigin(this.crossOrigin),Pt.setPath(this.path);let Mt=0;function Lt(Nt){Pt.load(tt[Nt],function(jt){bt.images[Nt]=jt,Mt++,Mt===6&&(bt.needsUpdate=!0,lt&&lt(bt))},void 0,_t)}for(let Nt=0;Nt<tt.length;++Nt)Lt(Nt);return bt}}class ME extends Vo{constructor(tt){super(tt)}load(tt,lt,ht,_t){const bt=this,Pt=new Tm,Mt=new ru(this.manager);return Mt.setResponseType("arraybuffer"),Mt.setRequestHeader(this.requestHeader),Mt.setPath(this.path),Mt.setWithCredentials(bt.withCredentials),Mt.load(tt,function(Lt){let Nt;try{Nt=bt.parse(Lt)}catch(jt){if(_t===void 0)return void console.error(jt);_t(jt)}Nt.image!==void 0?Pt.image=Nt.image:Nt.data!==void 0&&(Pt.image.width=Nt.width,Pt.image.height=Nt.height,Pt.image.data=Nt.data,Pt.image.complete=!0),Pt.wrapS=Nt.wrapS!==void 0?Nt.wrapS:vn,Pt.wrapT=Nt.wrapT!==void 0?Nt.wrapT:vn,Pt.magFilter=Nt.magFilter!==void 0?Nt.magFilter:Wn,Pt.minFilter=Nt.minFilter!==void 0?Nt.minFilter:Wn,Pt.anisotropy=Nt.anisotropy!==void 0?Nt.anisotropy:1,Nt.colorSpace!==void 0?Pt.colorSpace=Nt.colorSpace:Nt.encoding!==void 0&&(Pt.encoding=Nt.encoding),Nt.flipY!==void 0&&(Pt.flipY=Nt.flipY),Nt.format!==void 0&&(Pt.format=Nt.format),Nt.type!==void 0&&(Pt.type=Nt.type),Nt.mipmaps!==void 0&&(Pt.mipmaps=Nt.mipmaps,Pt.minFilter=Jn),Nt.mipmapCount===1&&(Pt.minFilter=Wn),Nt.generateMipmaps!==void 0&&(Pt.generateMipmaps=Nt.generateMipmaps),Pt.needsUpdate=!0,lt&&lt(Pt,Nt)},ht,_t),Pt}}class IE extends Vo{constructor(tt){super(tt)}load(tt,lt,ht,_t){const bt=new js,Pt=new N_(this.manager);return Pt.setCrossOrigin(this.crossOrigin),Pt.setPath(this.path),Pt.load(tt,function(Mt){bt.image=Mt,bt.needsUpdate=!0,lt!==void 0&&lt(bt)},ht,_t),bt}}class Zu extends Cs{constructor(tt,lt=1){super(),this.isLight=!0,this.type="Light",this.color=new jn(tt),this.intensity=lt}dispose(){}copy(tt,lt){return super.copy(tt,lt),this.color.copy(tt.color),this.intensity=tt.intensity,this}toJSON(tt){const lt=super.toJSON(tt);return lt.object.color=this.color.getHex(),lt.object.intensity=this.intensity,this.groundColor!==void 0&&(lt.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(lt.object.distance=this.distance),this.angle!==void 0&&(lt.object.angle=this.angle),this.decay!==void 0&&(lt.object.decay=this.decay),this.penumbra!==void 0&&(lt.object.penumbra=this.penumbra),this.shadow!==void 0&&(lt.object.shadow=this.shadow.toJSON()),lt}}class SA extends Zu{constructor(tt,lt,ht){super(tt,ht),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(Cs.DEFAULT_UP),this.updateMatrix(),this.groundColor=new jn(lt)}copy(tt,lt){return super.copy(tt,lt),this.groundColor.copy(tt.groundColor),this}}const yy=new is,CA=new Sr,PA=new Sr;class by{constructor(tt){this.camera=tt,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new mn(512,512),this.map=null,this.mapPass=null,this.matrix=new is,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Av,this._frameExtents=new mn(1,1),this._viewportCount=1,this._viewports=[new Rs(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(tt){const lt=this.camera,ht=this.matrix;CA.setFromMatrixPosition(tt.matrixWorld),lt.position.copy(CA),PA.setFromMatrixPosition(tt.target.matrixWorld),lt.lookAt(PA),lt.updateMatrixWorld(),yy.multiplyMatrices(lt.projectionMatrix,lt.matrixWorldInverse),this._frustum.setFromProjectionMatrix(yy),ht.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),ht.multiply(yy)}getViewport(tt){return this._viewports[tt]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(tt){return this.camera=tt.camera.clone(),this.bias=tt.bias,this.normalBias=tt.normalBias,this.radius=tt.radius,this.mapSize.copy(tt.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const tt={};return this.bias!==0&&(tt.bias=this.bias),this.normalBias!==0&&(tt.normalBias=this.normalBias),this.radius!==1&&(tt.radius=this.radius),this.mapSize.x===512&&this.mapSize.y===512||(tt.mapSize=this.mapSize.toArray()),tt.camera=this.camera.toJSON(!1).object,delete tt.camera.matrix,tt}}class RE extends by{constructor(){super(new bo(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(tt){const lt=this.camera,ht=2*du*tt.angle*this.focus,_t=this.mapSize.width/this.mapSize.height,bt=tt.distance||lt.far;ht===lt.fov&&_t===lt.aspect&&bt===lt.far||(lt.fov=ht,lt.aspect=_t,lt.far=bt,lt.updateProjectionMatrix()),super.updateMatrices(tt)}copy(tt){return super.copy(tt),this.focus=tt.focus,this}}class TA extends Zu{constructor(tt,lt,ht=0,_t=Math.PI/3,bt=0,Pt=2){super(tt,lt),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(Cs.DEFAULT_UP),this.updateMatrix(),this.target=new Cs,this.distance=ht,this.angle=_t,this.penumbra=bt,this.decay=Pt,this.map=null,this.shadow=new RE}get power(){return this.intensity*Math.PI}set power(tt){this.intensity=tt/Math.PI}dispose(){this.shadow.dispose()}copy(tt,lt){return super.copy(tt,lt),this.distance=tt.distance,this.angle=tt.angle,this.penumbra=tt.penumbra,this.decay=tt.decay,this.target=tt.target.clone(),this.shadow=tt.shadow.clone(),this}}const MA=new is,F_=new Sr,xy=new Sr;class kE extends by{constructor(){super(new bo(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new mn(4,2),this._viewportCount=6,this._viewports=[new Rs(2,1,1,1),new Rs(0,1,1,1),new Rs(3,1,1,1),new Rs(1,1,1,1),new Rs(3,0,1,1),new Rs(1,0,1,1)],this._cubeDirections=[new Sr(1,0,0),new Sr(-1,0,0),new Sr(0,0,1),new Sr(0,0,-1),new Sr(0,1,0),new Sr(0,-1,0)],this._cubeUps=[new Sr(0,1,0),new Sr(0,1,0),new Sr(0,1,0),new Sr(0,1,0),new Sr(0,0,1),new Sr(0,0,-1)]}updateMatrices(tt,lt=0){const ht=this.camera,_t=this.matrix,bt=tt.distance||ht.far;bt!==ht.far&&(ht.far=bt,ht.updateProjectionMatrix()),F_.setFromMatrixPosition(tt.matrixWorld),ht.position.copy(F_),xy.copy(ht.position),xy.add(this._cubeDirections[lt]),ht.up.copy(this._cubeUps[lt]),ht.lookAt(xy),ht.updateMatrixWorld(),_t.makeTranslation(-F_.x,-F_.y,-F_.z),MA.multiplyMatrices(ht.projectionMatrix,ht.matrixWorldInverse),this._frustum.setFromProjectionMatrix(MA)}}class IA extends Zu{constructor(tt,lt,ht=0,_t=2){super(tt,lt),this.isPointLight=!0,this.type="PointLight",this.distance=ht,this.decay=_t,this.shadow=new kE}get power(){return 4*this.intensity*Math.PI}set power(tt){this.intensity=tt/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(tt,lt){return super.copy(tt,lt),this.distance=tt.distance,this.decay=tt.decay,this.shadow=tt.shadow.clone(),this}}class DE extends by{constructor(){super(new Ev(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class RA extends Zu{constructor(tt,lt){super(tt,lt),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Cs.DEFAULT_UP),this.updateMatrix(),this.target=new Cs,this.shadow=new DE}dispose(){this.shadow.dispose()}copy(tt){return super.copy(tt),this.target=tt.target.clone(),this.shadow=tt.shadow.clone(),this}}class kA extends Zu{constructor(tt,lt){super(tt,lt),this.isAmbientLight=!0,this.type="AmbientLight"}}class DA extends Zu{constructor(tt,lt,ht=10,_t=10){super(tt,lt),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=ht,this.height=_t}get power(){return this.intensity*this.width*this.height*Math.PI}set power(tt){this.intensity=tt/(this.width*this.height*Math.PI)}copy(tt){return super.copy(tt),this.width=tt.width,this.height=tt.height,this}toJSON(tt){const lt=super.toJSON(tt);return lt.object.width=this.width,lt.object.height=this.height,lt}}class BA{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let tt=0;tt<9;tt++)this.coefficients.push(new Sr)}set(tt){for(let lt=0;lt<9;lt++)this.coefficients[lt].copy(tt[lt]);return this}zero(){for(let tt=0;tt<9;tt++)this.coefficients[tt].set(0,0,0);return this}getAt(tt,lt){const ht=tt.x,_t=tt.y,bt=tt.z,Pt=this.coefficients;return lt.copy(Pt[0]).multiplyScalar(.282095),lt.addScaledVector(Pt[1],.488603*_t),lt.addScaledVector(Pt[2],.488603*bt),lt.addScaledVector(Pt[3],.488603*ht),lt.addScaledVector(Pt[4],ht*_t*1.092548),lt.addScaledVector(Pt[5],_t*bt*1.092548),lt.addScaledVector(Pt[6],.315392*(3*bt*bt-1)),lt.addScaledVector(Pt[7],ht*bt*1.092548),lt.addScaledVector(Pt[8],.546274*(ht*ht-_t*_t)),lt}getIrradianceAt(tt,lt){const ht=tt.x,_t=tt.y,bt=tt.z,Pt=this.coefficients;return lt.copy(Pt[0]).multiplyScalar(.886227),lt.addScaledVector(Pt[1],1.023328*_t),lt.addScaledVector(Pt[2],1.023328*bt),lt.addScaledVector(Pt[3],1.023328*ht),lt.addScaledVector(Pt[4],.858086*ht*_t),lt.addScaledVector(Pt[5],.858086*_t*bt),lt.addScaledVector(Pt[6],.743125*bt*bt-.247708),lt.addScaledVector(Pt[7],.858086*ht*bt),lt.addScaledVector(Pt[8],.429043*(ht*ht-_t*_t)),lt}add(tt){for(let lt=0;lt<9;lt++)this.coefficients[lt].add(tt.coefficients[lt]);return this}addScaledSH(tt,lt){for(let ht=0;ht<9;ht++)this.coefficients[ht].addScaledVector(tt.coefficients[ht],lt);return this}scale(tt){for(let lt=0;lt<9;lt++)this.coefficients[lt].multiplyScalar(tt);return this}lerp(tt,lt){for(let ht=0;ht<9;ht++)this.coefficients[ht].lerp(tt.coefficients[ht],lt);return this}equals(tt){for(let lt=0;lt<9;lt++)if(!this.coefficients[lt].equals(tt.coefficients[lt]))return!1;return!0}copy(tt){return this.set(tt.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(tt,lt=0){const ht=this.coefficients;for(let _t=0;_t<9;_t++)ht[_t].fromArray(tt,lt+3*_t);return this}toArray(tt=[],lt=0){const ht=this.coefficients;for(let _t=0;_t<9;_t++)ht[_t].toArray(tt,lt+3*_t);return tt}static getBasisAt(tt,lt){const ht=tt.x,_t=tt.y,bt=tt.z;lt[0]=.282095,lt[1]=.488603*_t,lt[2]=.488603*bt,lt[3]=.488603*ht,lt[4]=1.092548*ht*_t,lt[5]=1.092548*_t*bt,lt[6]=.315392*(3*bt*bt-1),lt[7]=1.092548*ht*bt,lt[8]=.546274*(ht*ht-_t*_t)}}class LA extends Zu{constructor(tt=new BA,lt=1){super(void 0,lt),this.isLightProbe=!0,this.sh=tt}copy(tt){return super.copy(tt),this.sh.copy(tt.sh),this}fromJSON(tt){return this.intensity=tt.intensity,this.sh.fromArray(tt.sh),this}toJSON(tt){const lt=super.toJSON(tt);return lt.object.sh=this.sh.toArray(),lt}}class l0 extends Vo{constructor(tt){super(tt),this.textures={}}load(tt,lt,ht,_t){const bt=this,Pt=new ru(bt.manager);Pt.setPath(bt.path),Pt.setRequestHeader(bt.requestHeader),Pt.setWithCredentials(bt.withCredentials),Pt.load(tt,function(Mt){try{lt(bt.parse(JSON.parse(Mt)))}catch(Lt){_t?_t(Lt):console.error(Lt),bt.manager.itemError(tt)}},ht,_t)}parse(tt){const lt=this.textures;function ht(Pt){return lt[Pt]===void 0&&console.warn("THREE.MaterialLoader: Undefined texture",Pt),lt[Pt]}const _t=tt.metadata&&tt.metadata.version<=4.5?qs:void 0,bt=l0.createMaterialFromType(tt.type);if(tt.uuid!==void 0&&(bt.uuid=tt.uuid),tt.name!==void 0&&(bt.name=tt.name),tt.color!==void 0&&bt.color!==void 0&&bt.color.setHex(tt.color,_t),tt.roughness!==void 0&&(bt.roughness=tt.roughness),tt.metalness!==void 0&&(bt.metalness=tt.metalness),tt.sheen!==void 0&&(bt.sheen=tt.sheen),tt.sheenColor!==void 0&&(bt.sheenColor=new jn().setHex(tt.sheenColor,_t)),tt.sheenRoughness!==void 0&&(bt.sheenRoughness=tt.sheenRoughness),tt.emissive!==void 0&&bt.emissive!==void 0&&bt.emissive.setHex(tt.emissive,_t),tt.specular!==void 0&&bt.specular!==void 0&&bt.specular.setHex(tt.specular,_t),tt.specularIntensity!==void 0&&(bt.specularIntensity=tt.specularIntensity),tt.specularColor!==void 0&&bt.specularColor!==void 0&&bt.specularColor.setHex(tt.specularColor,_t),tt.shininess!==void 0&&(bt.shininess=tt.shininess),tt.clearcoat!==void 0&&(bt.clearcoat=tt.clearcoat),tt.clearcoatRoughness!==void 0&&(bt.clearcoatRoughness=tt.clearcoatRoughness),tt.iridescence!==void 0&&(bt.iridescence=tt.iridescence),tt.iridescenceIOR!==void 0&&(bt.iridescenceIOR=tt.iridescenceIOR),tt.iridescenceThicknessRange!==void 0&&(bt.iridescenceThicknessRange=tt.iridescenceThicknessRange),tt.transmission!==void 0&&(bt.transmission=tt.transmission),tt.thickness!==void 0&&(bt.thickness=tt.thickness),tt.attenuationDistance!==void 0&&(bt.attenuationDistance=tt.attenuationDistance),tt.attenuationColor!==void 0&&bt.attenuationColor!==void 0&&bt.attenuationColor.setHex(tt.attenuationColor,_t),tt.anisotropy!==void 0&&(bt.anisotropy=tt.anisotropy),tt.anisotropyRotation!==void 0&&(bt.anisotropyRotation=tt.anisotropyRotation),tt.fog!==void 0&&(bt.fog=tt.fog),tt.flatShading!==void 0&&(bt.flatShading=tt.flatShading),tt.blending!==void 0&&(bt.blending=tt.blending),tt.combine!==void 0&&(bt.combine=tt.combine),tt.side!==void 0&&(bt.side=tt.side),tt.shadowSide!==void 0&&(bt.shadowSide=tt.shadowSide),tt.opacity!==void 0&&(bt.opacity=tt.opacity),tt.transparent!==void 0&&(bt.transparent=tt.transparent),tt.alphaTest!==void 0&&(bt.alphaTest=tt.alphaTest),tt.alphaHash!==void 0&&(bt.alphaHash=tt.alphaHash),tt.depthTest!==void 0&&(bt.depthTest=tt.depthTest),tt.depthWrite!==void 0&&(bt.depthWrite=tt.depthWrite),tt.colorWrite!==void 0&&(bt.colorWrite=tt.colorWrite),tt.stencilWrite!==void 0&&(bt.stencilWrite=tt.stencilWrite),tt.stencilWriteMask!==void 0&&(bt.stencilWriteMask=tt.stencilWriteMask),tt.stencilFunc!==void 0&&(bt.stencilFunc=tt.stencilFunc),tt.stencilRef!==void 0&&(bt.stencilRef=tt.stencilRef),tt.stencilFuncMask!==void 0&&(bt.stencilFuncMask=tt.stencilFuncMask),tt.stencilFail!==void 0&&(bt.stencilFail=tt.stencilFail),tt.stencilZFail!==void 0&&(bt.stencilZFail=tt.stencilZFail),tt.stencilZPass!==void 0&&(bt.stencilZPass=tt.stencilZPass),tt.wireframe!==void 0&&(bt.wireframe=tt.wireframe),tt.wireframeLinewidth!==void 0&&(bt.wireframeLinewidth=tt.wireframeLinewidth),tt.wireframeLinecap!==void 0&&(bt.wireframeLinecap=tt.wireframeLinecap),tt.wireframeLinejoin!==void 0&&(bt.wireframeLinejoin=tt.wireframeLinejoin),tt.rotation!==void 0&&(bt.rotation=tt.rotation),tt.linewidth!==void 0&&(bt.linewidth=tt.linewidth),tt.dashSize!==void 0&&(bt.dashSize=tt.dashSize),tt.gapSize!==void 0&&(bt.gapSize=tt.gapSize),tt.scale!==void 0&&(bt.scale=tt.scale),tt.polygonOffset!==void 0&&(bt.polygonOffset=tt.polygonOffset),tt.polygonOffsetFactor!==void 0&&(bt.polygonOffsetFactor=tt.polygonOffsetFactor),tt.polygonOffsetUnits!==void 0&&(bt.polygonOffsetUnits=tt.polygonOffsetUnits),tt.dithering!==void 0&&(bt.dithering=tt.dithering),tt.alphaToCoverage!==void 0&&(bt.alphaToCoverage=tt.alphaToCoverage),tt.premultipliedAlpha!==void 0&&(bt.premultipliedAlpha=tt.premultipliedAlpha),tt.forceSinglePass!==void 0&&(bt.forceSinglePass=tt.forceSinglePass),tt.visible!==void 0&&(bt.visible=tt.visible),tt.toneMapped!==void 0&&(bt.toneMapped=tt.toneMapped),tt.userData!==void 0&&(bt.userData=tt.userData),tt.vertexColors!==void 0&&(typeof tt.vertexColors=="number"?bt.vertexColors=tt.vertexColors>0:bt.vertexColors=tt.vertexColors),tt.uniforms!==void 0)for(const Pt in tt.uniforms){const Mt=tt.uniforms[Pt];switch(bt.uniforms[Pt]={},Mt.type){case"t":bt.uniforms[Pt].value=ht(Mt.value);break;case"c":bt.uniforms[Pt].value=new jn().setHex(Mt.value,_t);break;case"v2":bt.uniforms[Pt].value=new mn().fromArray(Mt.value);break;case"v3":bt.uniforms[Pt].value=new Sr().fromArray(Mt.value);break;case"v4":bt.uniforms[Pt].value=new Rs().fromArray(Mt.value);break;case"m3":bt.uniforms[Pt].value=new os().fromArray(Mt.value);break;case"m4":bt.uniforms[Pt].value=new is().fromArray(Mt.value);break;default:bt.uniforms[Pt].value=Mt.value}}if(tt.defines!==void 0&&(bt.defines=tt.defines),tt.vertexShader!==void 0&&(bt.vertexShader=tt.vertexShader),tt.fragmentShader!==void 0&&(bt.fragmentShader=tt.fragmentShader),tt.glslVersion!==void 0&&(bt.glslVersion=tt.glslVersion),tt.extensions!==void 0)for(const Pt in tt.extensions)bt.extensions[Pt]=tt.extensions[Pt];if(tt.lights!==void 0&&(bt.lights=tt.lights),tt.clipping!==void 0&&(bt.clipping=tt.clipping),tt.size!==void 0&&(bt.size=tt.size),tt.sizeAttenuation!==void 0&&(bt.sizeAttenuation=tt.sizeAttenuation),tt.map!==void 0&&(bt.map=ht(tt.map)),tt.matcap!==void 0&&(bt.matcap=ht(tt.matcap)),tt.alphaMap!==void 0&&(bt.alphaMap=ht(tt.alphaMap)),tt.bumpMap!==void 0&&(bt.bumpMap=ht(tt.bumpMap)),tt.bumpScale!==void 0&&(bt.bumpScale=tt.bumpScale),tt.normalMap!==void 0&&(bt.normalMap=ht(tt.normalMap)),tt.normalMapType!==void 0&&(bt.normalMapType=tt.normalMapType),tt.normalScale!==void 0){let Pt=tt.normalScale;Array.isArray(Pt)===!1&&(Pt=[Pt,Pt]),bt.normalScale=new mn().fromArray(Pt)}return tt.displacementMap!==void 0&&(bt.displacementMap=ht(tt.displacementMap)),tt.displacementScale!==void 0&&(bt.displacementScale=tt.displacementScale),tt.displacementBias!==void 0&&(bt.displacementBias=tt.displacementBias),tt.roughnessMap!==void 0&&(bt.roughnessMap=ht(tt.roughnessMap)),tt.metalnessMap!==void 0&&(bt.metalnessMap=ht(tt.metalnessMap)),tt.emissiveMap!==void 0&&(bt.emissiveMap=ht(tt.emissiveMap)),tt.emissiveIntensity!==void 0&&(bt.emissiveIntensity=tt.emissiveIntensity),tt.specularMap!==void 0&&(bt.specularMap=ht(tt.specularMap)),tt.specularIntensityMap!==void 0&&(bt.specularIntensityMap=ht(tt.specularIntensityMap)),tt.specularColorMap!==void 0&&(bt.specularColorMap=ht(tt.specularColorMap)),tt.envMap!==void 0&&(bt.envMap=ht(tt.envMap)),tt.envMapIntensity!==void 0&&(bt.envMapIntensity=tt.envMapIntensity),tt.reflectivity!==void 0&&(bt.reflectivity=tt.reflectivity),tt.refractionRatio!==void 0&&(bt.refractionRatio=tt.refractionRatio),tt.lightMap!==void 0&&(bt.lightMap=ht(tt.lightMap)),tt.lightMapIntensity!==void 0&&(bt.lightMapIntensity=tt.lightMapIntensity),tt.aoMap!==void 0&&(bt.aoMap=ht(tt.aoMap)),tt.aoMapIntensity!==void 0&&(bt.aoMapIntensity=tt.aoMapIntensity),tt.gradientMap!==void 0&&(bt.gradientMap=ht(tt.gradientMap)),tt.clearcoatMap!==void 0&&(bt.clearcoatMap=ht(tt.clearcoatMap)),tt.clearcoatRoughnessMap!==void 0&&(bt.clearcoatRoughnessMap=ht(tt.clearcoatRoughnessMap)),tt.clearcoatNormalMap!==void 0&&(bt.clearcoatNormalMap=ht(tt.clearcoatNormalMap)),tt.clearcoatNormalScale!==void 0&&(bt.clearcoatNormalScale=new mn().fromArray(tt.clearcoatNormalScale)),tt.iridescenceMap!==void 0&&(bt.iridescenceMap=ht(tt.iridescenceMap)),tt.iridescenceThicknessMap!==void 0&&(bt.iridescenceThicknessMap=ht(tt.iridescenceThicknessMap)),tt.transmissionMap!==void 0&&(bt.transmissionMap=ht(tt.transmissionMap)),tt.thicknessMap!==void 0&&(bt.thicknessMap=ht(tt.thicknessMap)),tt.anisotropyMap!==void 0&&(bt.anisotropyMap=ht(tt.anisotropyMap)),tt.sheenColorMap!==void 0&&(bt.sheenColorMap=ht(tt.sheenColorMap)),tt.sheenRoughnessMap!==void 0&&(bt.sheenRoughnessMap=ht(tt.sheenRoughnessMap)),bt}setTextures(tt){return this.textures=tt,this}static createMaterialFromType(tt){return new{ShadowMaterial:uA,SpriteMaterial:q0,RawShaderMaterial:pA,ShaderMaterial:Ul,PointsMaterial:Z0,MeshPhysicalMaterial:hA,MeshStandardMaterial:dy,MeshPhongMaterial:dA,MeshToonMaterial:mA,MeshNormalMaterial:gA,MeshLambertMaterial:_A,MeshDepthMaterial:H0,MeshDistanceMaterial:Q0,MeshBasicMaterial:_c,MeshMatcapMaterial:fA,LineDashedMaterial:vA,LineBasicMaterial:Oo,Material:ao}[tt]}}class Ay{static decodeText(tt){if(typeof TextDecoder<"u")return new TextDecoder().decode(tt);let lt="";for(let ht=0,_t=tt.length;ht<_t;ht++)lt+=String.fromCharCode(tt[ht]);try{return decodeURIComponent(escape(lt))}catch{return lt}}static extractUrlBase(tt){const lt=tt.lastIndexOf("/");return lt===-1?"./":tt.slice(0,lt+1)}static resolveURL(tt,lt){return typeof tt!="string"||tt===""?"":(/^https?:\/\//i.test(lt)&&/^\//.test(tt)&&(lt=lt.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(tt)||/^data:.*,.*$/i.test(tt)||/^blob:.*$/i.test(tt)?tt:lt+tt)}}class OA extends fs{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(tt){return super.copy(tt),this.instanceCount=tt.instanceCount,this}toJSON(){const tt=super.toJSON();return tt.instanceCount=this.instanceCount,tt.isInstancedBufferGeometry=!0,tt}}class NA extends Vo{constructor(tt){super(tt)}load(tt,lt,ht,_t){const bt=this,Pt=new ru(bt.manager);Pt.setPath(bt.path),Pt.setRequestHeader(bt.requestHeader),Pt.setWithCredentials(bt.withCredentials),Pt.load(tt,function(Mt){try{lt(bt.parse(JSON.parse(Mt)))}catch(Lt){_t?_t(Lt):console.error(Lt),bt.manager.itemError(tt)}},ht,_t)}parse(tt){const lt={},ht={};function _t(Wt,Qt){if(lt[Qt]!==void 0)return lt[Qt];const qt=Wt.interleavedBuffers[Qt],Xt=function(ar,er){if(ht[er]!==void 0)return ht[er];const tr=ar.arrayBuffers[er],Ar=new Uint32Array(tr).buffer;return ht[er]=Ar,Ar}(Wt,qt.buffer),Zt=mu(qt.type,Xt),Yt=new Iv(Zt,qt.stride);return Yt.uuid=qt.uuid,lt[Qt]=Yt,Yt}const bt=tt.isInstancedBufferGeometry?new OA:new fs,Pt=tt.data.index;if(Pt!==void 0){const Wt=mu(Pt.type,Pt.array);bt.setIndex(new gr(Wt,1))}const Mt=tt.data.attributes;for(const Wt in Mt){const Qt=Mt[Wt];let qt;if(Qt.isInterleavedBufferAttribute){const Xt=_t(tt.data,Qt.data);qt=new Cp(Xt,Qt.itemSize,Qt.offset,Qt.normalized)}else{const Xt=mu(Qt.type,Qt.array);qt=new(Qt.isInstancedBufferAttribute?Mm:gr)(Xt,Qt.itemSize,Qt.normalized)}Qt.name!==void 0&&(qt.name=Qt.name),Qt.usage!==void 0&&qt.setUsage(Qt.usage),Qt.updateRange!==void 0&&(qt.updateRange.offset=Qt.updateRange.offset,qt.updateRange.count=Qt.updateRange.count),bt.setAttribute(Wt,qt)}const Lt=tt.data.morphAttributes;if(Lt)for(const Wt in Lt){const Qt=Lt[Wt],qt=[];for(let Xt=0,Zt=Qt.length;Xt<Zt;Xt++){const Yt=Qt[Xt];let ar;if(Yt.isInterleavedBufferAttribute){const er=_t(tt.data,Yt.data);ar=new Cp(er,Yt.itemSize,Yt.offset,Yt.normalized)}else{const er=mu(Yt.type,Yt.array);ar=new gr(er,Yt.itemSize,Yt.normalized)}Yt.name!==void 0&&(ar.name=Yt.name),qt.push(ar)}bt.morphAttributes[Wt]=qt}tt.data.morphTargetsRelative&&(bt.morphTargetsRelative=!0);const Nt=tt.data.groups||tt.data.drawcalls||tt.data.offsets;if(Nt!==void 0)for(let Wt=0,Qt=Nt.length;Wt!==Qt;++Wt){const qt=Nt[Wt];bt.addGroup(qt.start,qt.count,qt.materialIndex)}const jt=tt.data.boundingSphere;if(jt!==void 0){const Wt=new Sr;jt.center!==void 0&&Wt.fromArray(jt.center),bt.boundingSphere=new Go(Wt,jt.radius)}return tt.name&&(bt.name=tt.name),tt.userData&&(bt.userData=tt.userData),bt}}class BE extends Vo{constructor(tt){super(tt)}load(tt,lt,ht,_t){const bt=this,Pt=this.path===""?Ay.extractUrlBase(tt):this.path;this.resourcePath=this.resourcePath||Pt;const Mt=new ru(this.manager);Mt.setPath(this.path),Mt.setRequestHeader(this.requestHeader),Mt.setWithCredentials(this.withCredentials),Mt.load(tt,function(Lt){let Nt=null;try{Nt=JSON.parse(Lt)}catch(Wt){return _t!==void 0&&_t(Wt),void console.error("THREE:ObjectLoader: Can't parse "+tt+".",Wt.message)}const jt=Nt.metadata;if(jt===void 0||jt.type===void 0||jt.type.toLowerCase()==="geometry")return _t!==void 0&&_t(new Error("THREE.ObjectLoader: Can't load "+tt)),void console.error("THREE.ObjectLoader: Can't load "+tt);bt.parse(Nt,lt)},ht,_t)}async loadAsync(tt,lt){const ht=this.path===""?Ay.extractUrlBase(tt):this.path;this.resourcePath=this.resourcePath||ht;const _t=new ru(this.manager);_t.setPath(this.path),_t.setRequestHeader(this.requestHeader),_t.setWithCredentials(this.withCredentials);const bt=await _t.loadAsync(tt,lt),Pt=JSON.parse(bt),Mt=Pt.metadata;if(Mt===void 0||Mt.type===void 0||Mt.type.toLowerCase()==="geometry")throw new Error("THREE.ObjectLoader: Can't load "+tt);return await this.parseAsync(Pt)}parse(tt,lt){const ht=this.parseAnimations(tt.animations),_t=this.parseShapes(tt.shapes),bt=this.parseGeometries(tt.geometries,_t),Pt=this.parseImages(tt.images,function(){lt!==void 0&&lt(Nt)}),Mt=this.parseTextures(tt.textures,Pt),Lt=this.parseMaterials(tt.materials,Mt),Nt=this.parseObject(tt.object,bt,Lt,Mt,ht),jt=this.parseSkeletons(tt.skeletons,Nt);if(this.bindSkeletons(Nt,jt),lt!==void 0){let Wt=!1;for(const Qt in Pt)if(Pt[Qt].data instanceof HTMLImageElement){Wt=!0;break}Wt===!1&&lt(Nt)}return Nt}async parseAsync(tt){const lt=this.parseAnimations(tt.animations),ht=this.parseShapes(tt.shapes),_t=this.parseGeometries(tt.geometries,ht),bt=await this.parseImagesAsync(tt.images),Pt=this.parseTextures(tt.textures,bt),Mt=this.parseMaterials(tt.materials,Pt),Lt=this.parseObject(tt.object,_t,Mt,Pt,lt),Nt=this.parseSkeletons(tt.skeletons,Lt);return this.bindSkeletons(Lt,Nt),Lt}parseShapes(tt){const lt={};if(tt!==void 0)for(let ht=0,_t=tt.length;ht<_t;ht++){const bt=new Pp().fromJSON(tt[ht]);lt[bt.uuid]=bt}return lt}parseSkeletons(tt,lt){const ht={},_t={};if(lt.traverse(function(bt){bt.isBone&&(_t[bt.uuid]=bt)}),tt!==void 0)for(let bt=0,Pt=tt.length;bt<Pt;bt++){const Mt=new Lv().fromJSON(tt[bt],_t);ht[Mt.uuid]=Mt}return ht}parseGeometries(tt,lt){const ht={};if(tt!==void 0){const _t=new NA;for(let bt=0,Pt=tt.length;bt<Pt;bt++){let Mt;const Lt=tt[bt];switch(Lt.type){case"BufferGeometry":case"InstancedBufferGeometry":Mt=_t.parse(Lt);break;default:Lt.type in cA?Mt=cA[Lt.type].fromJSON(Lt,lt):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${Lt.type}"`)}Mt.uuid=Lt.uuid,Lt.name!==void 0&&(Mt.name=Lt.name),Lt.userData!==void 0&&(Mt.userData=Lt.userData),ht[Lt.uuid]=Mt}}return ht}parseMaterials(tt,lt){const ht={},_t={};if(tt!==void 0){const bt=new l0;bt.setTextures(lt);for(let Pt=0,Mt=tt.length;Pt<Mt;Pt++){const Lt=tt[Pt];ht[Lt.uuid]===void 0&&(ht[Lt.uuid]=bt.parse(Lt)),_t[Lt.uuid]=ht[Lt.uuid]}}return _t}parseAnimations(tt){const lt={};if(tt!==void 0)for(let ht=0;ht<tt.length;ht++){const _t=tt[ht],bt=O_.parse(_t);lt[bt.uuid]=bt}return lt}parseImages(tt,lt){const ht=this,_t={};let bt;function Pt(Mt){if(typeof Mt=="string"){const Lt=Mt;return function(Nt){return ht.manager.itemStart(Nt),bt.load(Nt,function(){ht.manager.itemEnd(Nt)},void 0,function(){ht.manager.itemError(Nt),ht.manager.itemEnd(Nt)})}(/^(\/\/)|([a-z]+:(\/\/)?)/i.test(Lt)?Lt:ht.resourcePath+Lt)}return Mt.data?{data:mu(Mt.type,Mt.data),width:Mt.width,height:Mt.height,complete:!0}:null}if(tt!==void 0&&tt.length>0){const Mt=new vy(lt);bt=new N_(Mt),bt.setCrossOrigin(this.crossOrigin);for(let Lt=0,Nt=tt.length;Lt<Nt;Lt++){const jt=tt[Lt],Wt=jt.url;if(Array.isArray(Wt)){const Qt=[];for(let qt=0,Xt=Wt.length;qt<Xt;qt++){const Zt=Pt(Wt[qt]);Zt!==null&&(Zt instanceof HTMLImageElement?Qt.push(Zt):Qt.push(new Tm(Zt.data,Zt.width,Zt.height)))}_t[jt.uuid]=new qo(Qt)}else{const Qt=Pt(jt.url);_t[jt.uuid]=new qo(Qt)}}}return _t}async parseImagesAsync(tt){const lt=this,ht={};let _t;async function bt(Pt){if(typeof Pt=="string"){const Mt=Pt,Lt=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(Mt)?Mt:lt.resourcePath+Mt;return await _t.loadAsync(Lt)}return Pt.data?{data:mu(Pt.type,Pt.data),width:Pt.width,height:Pt.height,complete:!0}:null}if(tt!==void 0&&tt.length>0){_t=new N_(this.manager),_t.setCrossOrigin(this.crossOrigin);for(let Pt=0,Mt=tt.length;Pt<Mt;Pt++){const Lt=tt[Pt],Nt=Lt.url;if(Array.isArray(Nt)){const jt=[];for(let Wt=0,Qt=Nt.length;Wt<Qt;Wt++){const qt=Nt[Wt],Xt=await bt(qt);Xt!==null&&(Xt instanceof HTMLImageElement?jt.push(Xt):jt.push(new Tm(Xt.data,Xt.width,Xt.height)))}ht[Lt.uuid]=new qo(jt)}else{const jt=await bt(Lt.url);ht[Lt.uuid]=new qo(jt)}}}return ht}parseTextures(tt,lt){function ht(bt,Pt){return typeof bt=="number"?bt:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",bt),Pt[bt])}const _t={};if(tt!==void 0)for(let bt=0,Pt=tt.length;bt<Pt;bt++){const Mt=tt[bt];Mt.image===void 0&&console.warn('THREE.ObjectLoader: No "image" specified for',Mt.uuid),lt[Mt.image]===void 0&&console.warn("THREE.ObjectLoader: Undefined image",Mt.image);const Lt=lt[Mt.image],Nt=Lt?Lt.data:void 0;let jt;Array.isArray(Nt)?(jt=new __,Nt.length===6&&(jt.needsUpdate=!0)):(jt=Nt&&Nt.data?new Tm:new js,Nt&&Nt.complete&&(jt.needsUpdate=!0)),jt.source=Lt,jt.uuid=Mt.uuid,Mt.name!==void 0&&(jt.name=Mt.name),Mt.mapping!==void 0&&(jt.mapping=ht(Mt.mapping,LE)),Mt.channel!==void 0&&(jt.channel=Mt.channel),Mt.offset!==void 0&&jt.offset.fromArray(Mt.offset),Mt.repeat!==void 0&&jt.repeat.fromArray(Mt.repeat),Mt.center!==void 0&&jt.center.fromArray(Mt.center),Mt.rotation!==void 0&&(jt.rotation=Mt.rotation),Mt.wrap!==void 0&&(jt.wrapS=ht(Mt.wrap[0],FA),jt.wrapT=ht(Mt.wrap[1],FA)),Mt.format!==void 0&&(jt.format=Mt.format),Mt.internalFormat!==void 0&&(jt.internalFormat=Mt.internalFormat),Mt.type!==void 0&&(jt.type=Mt.type),Mt.colorSpace!==void 0?jt.colorSpace=Mt.colorSpace:Mt.encoding!==void 0&&(jt.encoding=Mt.encoding),Mt.minFilter!==void 0&&(jt.minFilter=ht(Mt.minFilter,UA)),Mt.magFilter!==void 0&&(jt.magFilter=ht(Mt.magFilter,UA)),Mt.anisotropy!==void 0&&(jt.anisotropy=Mt.anisotropy),Mt.flipY!==void 0&&(jt.flipY=Mt.flipY),Mt.generateMipmaps!==void 0&&(jt.generateMipmaps=Mt.generateMipmaps),Mt.premultiplyAlpha!==void 0&&(jt.premultiplyAlpha=Mt.premultiplyAlpha),Mt.unpackAlignment!==void 0&&(jt.unpackAlignment=Mt.unpackAlignment),Mt.compareFunction!==void 0&&(jt.compareFunction=Mt.compareFunction),Mt.userData!==void 0&&(jt.userData=Mt.userData),_t[Mt.uuid]=jt}return _t}parseObject(tt,lt,ht,_t,bt){let Pt;const Mt=tt.metadata&&tt.metadata.version<=4.5?qs:void 0;function Lt(qt){return lt[qt]===void 0&&console.warn("THREE.ObjectLoader: Undefined geometry",qt),lt[qt]}function Nt(qt){if(qt!==void 0){if(Array.isArray(qt)){const Xt=[];for(let Zt=0,Yt=qt.length;Zt<Yt;Zt++){const ar=qt[Zt];ht[ar]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",ar),Xt.push(ht[ar])}return Xt}return ht[qt]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",qt),ht[qt]}}function jt(qt){return _t[qt]===void 0&&console.warn("THREE.ObjectLoader: Undefined texture",qt),_t[qt]}let Wt,Qt;switch(tt.type){case"Scene":Pt=new Ax,tt.background!==void 0&&(Number.isInteger(tt.background)?Pt.background=new jn().setHex(tt.background,Mt):Pt.background=jt(tt.background)),tt.environment!==void 0&&(Pt.environment=jt(tt.environment)),tt.fog!==void 0&&(tt.fog.type==="Fog"?Pt.fog=new Mv(tt.fog.color,tt.fog.near,tt.fog.far):tt.fog.type==="FogExp2"&&(Pt.fog=new Tv(tt.fog.color,tt.fog.density)),tt.fog.name!==""&&(Pt.fog.name=tt.fog.name)),tt.backgroundBlurriness!==void 0&&(Pt.backgroundBlurriness=tt.backgroundBlurriness),tt.backgroundIntensity!==void 0&&(Pt.backgroundIntensity=tt.backgroundIntensity);break;case"PerspectiveCamera":Pt=new bo(tt.fov,tt.aspect,tt.near,tt.far),tt.focus!==void 0&&(Pt.focus=tt.focus),tt.zoom!==void 0&&(Pt.zoom=tt.zoom),tt.filmGauge!==void 0&&(Pt.filmGauge=tt.filmGauge),tt.filmOffset!==void 0&&(Pt.filmOffset=tt.filmOffset),tt.view!==void 0&&(Pt.view=Object.assign({},tt.view));break;case"OrthographicCamera":Pt=new Ev(tt.left,tt.right,tt.top,tt.bottom,tt.near,tt.far),tt.zoom!==void 0&&(Pt.zoom=tt.zoom),tt.view!==void 0&&(Pt.view=Object.assign({},tt.view));break;case"AmbientLight":Pt=new kA(tt.color,tt.intensity);break;case"DirectionalLight":Pt=new RA(tt.color,tt.intensity);break;case"PointLight":Pt=new IA(tt.color,tt.intensity,tt.distance,tt.decay);break;case"RectAreaLight":Pt=new DA(tt.color,tt.intensity,tt.width,tt.height);break;case"SpotLight":Pt=new TA(tt.color,tt.intensity,tt.distance,tt.angle,tt.penumbra,tt.decay);break;case"HemisphereLight":Pt=new SA(tt.color,tt.groundColor,tt.intensity);break;case"LightProbe":Pt=new LA().fromJSON(tt);break;case"SkinnedMesh":Wt=Lt(tt.geometry),Qt=Nt(tt.material),Pt=new Bx(Wt,Qt),tt.bindMode!==void 0&&(Pt.bindMode=tt.bindMode),tt.bindMatrix!==void 0&&Pt.bindMatrix.fromArray(tt.bindMatrix),tt.skeleton!==void 0&&(Pt.skeleton=tt.skeleton);break;case"Mesh":Wt=Lt(tt.geometry),Qt=Nt(tt.material),Pt=new co(Wt,Qt);break;case"InstancedMesh":Wt=Lt(tt.geometry),Qt=Nt(tt.material);const qt=tt.count,Xt=tt.instanceMatrix,Zt=tt.instanceColor;Pt=new Fx(Wt,Qt,qt),Pt.instanceMatrix=new Mm(new Float32Array(Xt.array),16),Zt!==void 0&&(Pt.instanceColor=new Mm(new Float32Array(Zt.array),Zt.itemSize));break;case"LOD":Pt=new Tx;break;case"Line":Pt=new Ku(Lt(tt.geometry),Nt(tt.material));break;case"LineLoop":Pt=new Hx(Lt(tt.geometry),Nt(tt.material));break;case"LineSegments":Pt=new eu(Lt(tt.geometry),Nt(tt.material));break;case"PointCloud":case"Points":Pt=new Wx(Lt(tt.geometry),Nt(tt.material));break;case"Sprite":Pt=new Cx(Nt(tt.material));break;case"Group":Pt=new Am;break;case"Bone":Pt=new K0;break;default:Pt=new Cs}if(Pt.uuid=tt.uuid,tt.name!==void 0&&(Pt.name=tt.name),tt.matrix!==void 0?(Pt.matrix.fromArray(tt.matrix),tt.matrixAutoUpdate!==void 0&&(Pt.matrixAutoUpdate=tt.matrixAutoUpdate),Pt.matrixAutoUpdate&&Pt.matrix.decompose(Pt.position,Pt.quaternion,Pt.scale)):(tt.position!==void 0&&Pt.position.fromArray(tt.position),tt.rotation!==void 0&&Pt.rotation.fromArray(tt.rotation),tt.quaternion!==void 0&&Pt.quaternion.fromArray(tt.quaternion),tt.scale!==void 0&&Pt.scale.fromArray(tt.scale)),tt.up!==void 0&&Pt.up.fromArray(tt.up),tt.castShadow!==void 0&&(Pt.castShadow=tt.castShadow),tt.receiveShadow!==void 0&&(Pt.receiveShadow=tt.receiveShadow),tt.shadow&&(tt.shadow.bias!==void 0&&(Pt.shadow.bias=tt.shadow.bias),tt.shadow.normalBias!==void 0&&(Pt.shadow.normalBias=tt.shadow.normalBias),tt.shadow.radius!==void 0&&(Pt.shadow.radius=tt.shadow.radius),tt.shadow.mapSize!==void 0&&Pt.shadow.mapSize.fromArray(tt.shadow.mapSize),tt.shadow.camera!==void 0&&(Pt.shadow.camera=this.parseObject(tt.shadow.camera))),tt.visible!==void 0&&(Pt.visible=tt.visible),tt.frustumCulled!==void 0&&(Pt.frustumCulled=tt.frustumCulled),tt.renderOrder!==void 0&&(Pt.renderOrder=tt.renderOrder),tt.userData!==void 0&&(Pt.userData=tt.userData),tt.layers!==void 0&&(Pt.layers.mask=tt.layers),tt.children!==void 0){const qt=tt.children;for(let Xt=0;Xt<qt.length;Xt++)Pt.add(this.parseObject(qt[Xt],lt,ht,_t,bt))}if(tt.animations!==void 0){const qt=tt.animations;for(let Xt=0;Xt<qt.length;Xt++){const Zt=qt[Xt];Pt.animations.push(bt[Zt])}}if(tt.type==="LOD"){tt.autoUpdate!==void 0&&(Pt.autoUpdate=tt.autoUpdate);const qt=tt.levels;for(let Xt=0;Xt<qt.length;Xt++){const Zt=qt[Xt],Yt=Pt.getObjectByProperty("uuid",Zt.object);Yt!==void 0&&Pt.addLevel(Yt,Zt.distance,Zt.hysteresis)}}return Pt}bindSkeletons(tt,lt){Object.keys(lt).length!==0&&tt.traverse(function(ht){if(ht.isSkinnedMesh===!0&&ht.skeleton!==void 0){const _t=lt[ht.skeleton];_t===void 0?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",ht.skeleton):ht.bind(_t,ht.bindMatrix)}})}}const LE={UVMapping:Gr,CubeReflectionMapping:tn,CubeRefractionMapping:nn,EquirectangularReflectionMapping:gn,EquirectangularRefractionMapping:xn,CubeUVReflectionMapping:Mn},FA={RepeatWrapping:An,ClampToEdgeWrapping:vn,MirroredRepeatWrapping:Cn},UA={NearestFilter:rn,NearestMipmapNearestFilter:En,NearestMipmapLinearFilter:Qn,LinearFilter:Wn,LinearMipmapNearestFilter:Gn,LinearMipmapLinearFilter:Jn};class OE extends Vo{constructor(tt){super(tt),this.isImageBitmapLoader=!0,typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(tt){return this.options=tt,this}load(tt,lt,ht,_t){tt===void 0&&(tt=""),this.path!==void 0&&(tt=this.path+tt),tt=this.manager.resolveURL(tt);const bt=this;xu.get(tt,"blob").then(Pt=>{if(Pt!==void 0)return bt.manager.itemStart(tt),void createImageBitmap(Pt,Object.assign(bt.options,{colorSpaceConversion:"none"})).then(function(Lt){lt&&lt(Lt),bt.manager.itemEnd(tt)}).catch(function(Lt){_t&&_t(Lt),bt.manager.itemError(tt),bt.manager.itemEnd(tt)});const Mt={};Mt.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",Mt.headers=this.requestHeader,fetch(tt,Mt).then(function(Lt){return Lt.blob()}).then(function(Lt){return xu.add(tt,Lt,"blob"),createImageBitmap(Lt,Object.assign(bt.options,{colorSpaceConversion:"none"}))}).then(function(Lt){lt&&lt(Lt),bt.manager.itemEnd(tt)}).catch(function(Lt){_t&&_t(Lt),bt.manager.itemError(tt),bt.manager.itemEnd(tt)}),bt.manager.itemStart(tt)})}}let c0;class wy{static getContext(){return c0===void 0&&(c0=new(window.AudioContext||window.webkitAudioContext)),c0}static setContext(tt){c0=tt}}class NE extends Vo{constructor(tt){super(tt)}load(tt,lt,ht,_t){const bt=this,Pt=new ru(this.manager);function Mt(Lt){_t?_t(Lt):console.error(Lt),bt.manager.itemError(tt)}Pt.setResponseType("arraybuffer"),Pt.setPath(this.path),Pt.setRequestHeader(this.requestHeader),Pt.setWithCredentials(this.withCredentials),Pt.load(tt,function(Lt){try{const Nt=Lt.slice(0);wy.getContext().decodeAudioData(Nt,function(jt){lt(jt)},Mt)}catch(Nt){Mt(Nt)}},ht,_t)}}const jA=new is,GA=new is,kp=new is;class FE{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new bo,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new bo,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(tt){const lt=this._cache;if(lt.focus!==tt.focus||lt.fov!==tt.fov||lt.aspect!==tt.aspect*this.aspect||lt.near!==tt.near||lt.far!==tt.far||lt.zoom!==tt.zoom||lt.eyeSep!==this.eyeSep){lt.focus=tt.focus,lt.fov=tt.fov,lt.aspect=tt.aspect*this.aspect,lt.near=tt.near,lt.far=tt.far,lt.zoom=tt.zoom,lt.eyeSep=this.eyeSep,kp.copy(tt.projectionMatrix);const ht=lt.eyeSep/2,_t=ht*lt.near/lt.focus,bt=lt.near*Math.tan(Xl*lt.fov*.5)/lt.zoom;let Pt,Mt;GA.elements[12]=-ht,jA.elements[12]=ht,Pt=-bt*lt.aspect+_t,Mt=bt*lt.aspect+_t,kp.elements[0]=2*lt.near/(Mt-Pt),kp.elements[8]=(Mt+Pt)/(Mt-Pt),this.cameraL.projectionMatrix.copy(kp),Pt=-bt*lt.aspect-_t,Mt=bt*lt.aspect-_t,kp.elements[0]=2*lt.near/(Mt-Pt),kp.elements[8]=(Mt+Pt)/(Mt-Pt),this.cameraR.projectionMatrix.copy(kp)}this.cameraL.matrixWorld.copy(tt.matrixWorld).multiply(GA),this.cameraR.matrixWorld.copy(tt.matrixWorld).multiply(jA)}}class zA{constructor(tt=!0){this.autoStart=tt,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=VA(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let tt=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const lt=VA();tt=(lt-this.oldTime)/1e3,this.oldTime=lt,this.elapsedTime+=tt}return tt}}function VA(){return(typeof performance>"u"?Date:performance).now()}const Dp=new Sr,HA=new Eo,UE=new Sr,Bp=new Sr;class jE extends Cs{constructor(){super(),this.type="AudioListener",this.context=wy.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new zA}getInput(){return this.gain}removeFilter(){return this.filter!==null&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(tt){return this.filter!==null?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=tt,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(tt){return this.gain.gain.setTargetAtTime(tt,this.context.currentTime,.01),this}updateMatrixWorld(tt){super.updateMatrixWorld(tt);const lt=this.context.listener,ht=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(Dp,HA,UE),Bp.set(0,0,-1).applyQuaternion(HA),lt.positionX){const _t=this.context.currentTime+this.timeDelta;lt.positionX.linearRampToValueAtTime(Dp.x,_t),lt.positionY.linearRampToValueAtTime(Dp.y,_t),lt.positionZ.linearRampToValueAtTime(Dp.z,_t),lt.forwardX.linearRampToValueAtTime(Bp.x,_t),lt.forwardY.linearRampToValueAtTime(Bp.y,_t),lt.forwardZ.linearRampToValueAtTime(Bp.z,_t),lt.upX.linearRampToValueAtTime(ht.x,_t),lt.upY.linearRampToValueAtTime(ht.y,_t),lt.upZ.linearRampToValueAtTime(ht.z,_t)}else lt.setPosition(Dp.x,Dp.y,Dp.z),lt.setOrientation(Bp.x,Bp.y,Bp.z,ht.x,ht.y,ht.z)}}class QA extends Cs{constructor(tt){super(),this.type="Audio",this.listener=tt,this.context=tt.context,this.gain=this.context.createGain(),this.gain.connect(tt.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(tt){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=tt,this.connect(),this}setMediaElementSource(tt){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(tt),this.connect(),this}setMediaStreamSource(tt){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(tt),this.connect(),this}setBuffer(tt){return this.buffer=tt,this.sourceType="buffer",this.autoplay&&this.play(),this}play(tt=0){if(this.isPlaying===!0)return void console.warn("THREE.Audio: Audio is already playing.");if(this.hasPlaybackControl===!1)return void console.warn("THREE.Audio: this Audio has no playback control.");this._startedAt=this.context.currentTime+tt;const lt=this.context.createBufferSource();return lt.buffer=this.buffer,lt.loop=this.loop,lt.loopStart=this.loopStart,lt.loopEnd=this.loopEnd,lt.onended=this.onEnded.bind(this),lt.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=lt,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(this.hasPlaybackControl!==!1)return this.isPlaying===!0&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,this.loop===!0&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")}stop(){if(this.hasPlaybackControl!==!1)return this._progress=0,this.source!==null&&(this.source.stop(),this.source.onended=null),this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let tt=1,lt=this.filters.length;tt<lt;tt++)this.filters[tt-1].connect(this.filters[tt]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this._connected!==!1){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let tt=1,lt=this.filters.length;tt<lt;tt++)this.filters[tt-1].disconnect(this.filters[tt]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}}getFilters(){return this.filters}setFilters(tt){return tt||(tt=[]),this._connected===!0?(this.disconnect(),this.filters=tt.slice(),this.connect()):this.filters=tt.slice(),this}setDetune(tt){if(this.detune=tt,this.source.detune!==void 0)return this.isPlaying===!0&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(tt){return this.setFilters(tt?[tt]:[])}setPlaybackRate(tt){if(this.hasPlaybackControl!==!1)return this.playbackRate=tt,this.isPlaying===!0&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return this.hasPlaybackControl===!1?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(tt){if(this.hasPlaybackControl!==!1)return this.loop=tt,this.isPlaying===!0&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")}setLoopStart(tt){return this.loopStart=tt,this}setLoopEnd(tt){return this.loopEnd=tt,this}getVolume(){return this.gain.gain.value}setVolume(tt){return this.gain.gain.setTargetAtTime(tt,this.context.currentTime,.01),this}}const Lp=new Sr,WA=new Eo,GE=new Sr,Op=new Sr;class zE extends QA{constructor(tt){super(tt),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}connect(){super.connect(),this.panner.connect(this.gain)}disconnect(){super.disconnect(),this.panner.disconnect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(tt){return this.panner.refDistance=tt,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(tt){return this.panner.rolloffFactor=tt,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(tt){return this.panner.distanceModel=tt,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(tt){return this.panner.maxDistance=tt,this}setDirectionalCone(tt,lt,ht){return this.panner.coneInnerAngle=tt,this.panner.coneOuterAngle=lt,this.panner.coneOuterGain=ht,this}updateMatrixWorld(tt){if(super.updateMatrixWorld(tt),this.hasPlaybackControl===!0&&this.isPlaying===!1)return;this.matrixWorld.decompose(Lp,WA,GE),Op.set(0,0,1).applyQuaternion(WA);const lt=this.panner;if(lt.positionX){const ht=this.context.currentTime+this.listener.timeDelta;lt.positionX.linearRampToValueAtTime(Lp.x,ht),lt.positionY.linearRampToValueAtTime(Lp.y,ht),lt.positionZ.linearRampToValueAtTime(Lp.z,ht),lt.orientationX.linearRampToValueAtTime(Op.x,ht),lt.orientationY.linearRampToValueAtTime(Op.y,ht),lt.orientationZ.linearRampToValueAtTime(Op.z,ht)}else lt.setPosition(Lp.x,Lp.y,Lp.z),lt.setOrientation(Op.x,Op.y,Op.z)}}class VE{constructor(tt,lt=2048){this.analyser=tt.context.createAnalyser(),this.analyser.fftSize=lt,this.data=new Uint8Array(this.analyser.frequencyBinCount),tt.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let tt=0;const lt=this.getFrequencyData();for(let ht=0;ht<lt.length;ht++)tt+=lt[ht];return tt/lt.length}}class qA{constructor(tt,lt,ht){let _t,bt,Pt;switch(this.binding=tt,this.valueSize=ht,lt){case"quaternion":_t=this._slerp,bt=this._slerpAdditive,Pt=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*ht),this._workIndex=5;break;case"string":case"bool":_t=this._select,bt=this._select,Pt=this._setAdditiveIdentityOther,this.buffer=new Array(5*ht);break;default:_t=this._lerp,bt=this._lerpAdditive,Pt=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*ht)}this._mixBufferRegion=_t,this._mixBufferRegionAdditive=bt,this._setIdentity=Pt,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(tt,lt){const ht=this.buffer,_t=this.valueSize,bt=tt*_t+_t;let Pt=this.cumulativeWeight;if(Pt===0){for(let Mt=0;Mt!==_t;++Mt)ht[bt+Mt]=ht[Mt];Pt=lt}else{Pt+=lt;const Mt=lt/Pt;this._mixBufferRegion(ht,bt,0,Mt,_t)}this.cumulativeWeight=Pt}accumulateAdditive(tt){const lt=this.buffer,ht=this.valueSize,_t=ht*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(lt,_t,0,tt,ht),this.cumulativeWeightAdditive+=tt}apply(tt){const lt=this.valueSize,ht=this.buffer,_t=tt*lt+lt,bt=this.cumulativeWeight,Pt=this.cumulativeWeightAdditive,Mt=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,bt<1){const Lt=lt*this._origIndex;this._mixBufferRegion(ht,_t,Lt,1-bt,lt)}Pt>0&&this._mixBufferRegionAdditive(ht,_t,this._addIndex*lt,1,lt);for(let Lt=lt,Nt=lt+lt;Lt!==Nt;++Lt)if(ht[Lt]!==ht[Lt+lt]){Mt.setValue(ht,_t);break}}saveOriginalState(){const tt=this.binding,lt=this.buffer,ht=this.valueSize,_t=ht*this._origIndex;tt.getValue(lt,_t);for(let bt=ht,Pt=_t;bt!==Pt;++bt)lt[bt]=lt[_t+bt%ht];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const tt=3*this.valueSize;this.binding.setValue(this.buffer,tt)}_setAdditiveIdentityNumeric(){const tt=this._addIndex*this.valueSize,lt=tt+this.valueSize;for(let ht=tt;ht<lt;ht++)this.buffer[ht]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const tt=this._origIndex*this.valueSize,lt=this._addIndex*this.valueSize;for(let ht=0;ht<this.valueSize;ht++)this.buffer[lt+ht]=this.buffer[tt+ht]}_select(tt,lt,ht,_t,bt){if(_t>=.5)for(let Pt=0;Pt!==bt;++Pt)tt[lt+Pt]=tt[ht+Pt]}_slerp(tt,lt,ht,_t){Eo.slerpFlat(tt,lt,tt,lt,tt,ht,_t)}_slerpAdditive(tt,lt,ht,_t,bt){const Pt=this._workIndex*bt;Eo.multiplyQuaternionsFlat(tt,Pt,tt,lt,tt,ht),Eo.slerpFlat(tt,lt,tt,lt,tt,Pt,_t)}_lerp(tt,lt,ht,_t,bt){const Pt=1-_t;for(let Mt=0;Mt!==bt;++Mt){const Lt=lt+Mt;tt[Lt]=tt[Lt]*Pt+tt[ht+Mt]*_t}}_lerpAdditive(tt,lt,ht,_t,bt){for(let Pt=0;Pt!==bt;++Pt){const Mt=lt+Pt;tt[Mt]=tt[Mt]+tt[ht+Pt]*_t}}}const Ey="\\[\\]\\.:\\/",HE=new RegExp("["+Ey+"]","g"),Sy="[^"+Ey+"]",QE="[^"+Ey.replace("\\.","")+"]",WE=new RegExp("^"+/((?:WC+[\/:])*)/.source.replace("WC",Sy)+/(WCOD+)?/.source.replace("WCOD",QE)+/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",Sy)+/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",Sy)+"$"),qE=["material","materials","bones","map"];class Ts{constructor(tt,lt,ht){this.path=lt,this.parsedPath=ht||Ts.parseTrackName(lt),this.node=Ts.findNode(tt,this.parsedPath.nodeName),this.rootNode=tt,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(tt,lt,ht){return tt&&tt.isAnimationObjectGroup?new Ts.Composite(tt,lt,ht):new Ts(tt,lt,ht)}static sanitizeNodeName(tt){return tt.replace(/\s/g,"_").replace(HE,"")}static parseTrackName(tt){const lt=WE.exec(tt);if(lt===null)throw new Error("PropertyBinding: Cannot parse trackName: "+tt);const ht={nodeName:lt[2],objectName:lt[3],objectIndex:lt[4],propertyName:lt[5],propertyIndex:lt[6]},_t=ht.nodeName&&ht.nodeName.lastIndexOf(".");if(_t!==void 0&&_t!==-1){const bt=ht.nodeName.substring(_t+1);qE.indexOf(bt)!==-1&&(ht.nodeName=ht.nodeName.substring(0,_t),ht.objectName=bt)}if(ht.propertyName===null||ht.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+tt);return ht}static findNode(tt,lt){if(lt===void 0||lt===""||lt==="."||lt===-1||lt===tt.name||lt===tt.uuid)return tt;if(tt.skeleton){const ht=tt.skeleton.getBoneByName(lt);if(ht!==void 0)return ht}if(tt.children){const ht=function(bt){for(let Pt=0;Pt<bt.length;Pt++){const Mt=bt[Pt];if(Mt.name===lt||Mt.uuid===lt)return Mt;const Lt=ht(Mt.children);if(Lt)return Lt}return null},_t=ht(tt.children);if(_t)return _t}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(tt,lt){tt[lt]=this.targetObject[this.propertyName]}_getValue_array(tt,lt){const ht=this.resolvedProperty;for(let _t=0,bt=ht.length;_t!==bt;++_t)tt[lt++]=ht[_t]}_getValue_arrayElement(tt,lt){tt[lt]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(tt,lt){this.resolvedProperty.toArray(tt,lt)}_setValue_direct(tt,lt){this.targetObject[this.propertyName]=tt[lt]}_setValue_direct_setNeedsUpdate(tt,lt){this.targetObject[this.propertyName]=tt[lt],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(tt,lt){this.targetObject[this.propertyName]=tt[lt],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(tt,lt){const ht=this.resolvedProperty;for(let _t=0,bt=ht.length;_t!==bt;++_t)ht[_t]=tt[lt++]}_setValue_array_setNeedsUpdate(tt,lt){const ht=this.resolvedProperty;for(let _t=0,bt=ht.length;_t!==bt;++_t)ht[_t]=tt[lt++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(tt,lt){const ht=this.resolvedProperty;for(let _t=0,bt=ht.length;_t!==bt;++_t)ht[_t]=tt[lt++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(tt,lt){this.resolvedProperty[this.propertyIndex]=tt[lt]}_setValue_arrayElement_setNeedsUpdate(tt,lt){this.resolvedProperty[this.propertyIndex]=tt[lt],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(tt,lt){this.resolvedProperty[this.propertyIndex]=tt[lt],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(tt,lt){this.resolvedProperty.fromArray(tt,lt)}_setValue_fromArray_setNeedsUpdate(tt,lt){this.resolvedProperty.fromArray(tt,lt),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(tt,lt){this.resolvedProperty.fromArray(tt,lt),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(tt,lt){this.bind(),this.getValue(tt,lt)}_setValue_unbound(tt,lt){this.bind(),this.setValue(tt,lt)}bind(){let tt=this.node;const lt=this.parsedPath,ht=lt.objectName,_t=lt.propertyName;let bt=lt.propertyIndex;if(tt||(tt=Ts.findNode(this.rootNode,lt.nodeName),this.node=tt),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!tt)return void console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");if(ht){let Nt=lt.objectIndex;switch(ht){case"materials":if(!tt.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!tt.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);tt=tt.material.materials;break;case"bones":if(!tt.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);tt=tt.skeleton.bones;for(let jt=0;jt<tt.length;jt++)if(tt[jt].name===Nt){Nt=jt;break}break;case"map":if("map"in tt){tt=tt.map;break}if(!tt.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!tt.material.map)return void console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);tt=tt.material.map;break;default:if(tt[ht]===void 0)return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);tt=tt[ht]}if(Nt!==void 0){if(tt[Nt]===void 0)return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,tt);tt=tt[Nt]}}const Pt=tt[_t];if(Pt===void 0){const Nt=lt.nodeName;return void console.error("THREE.PropertyBinding: Trying to update property for track: "+Nt+"."+_t+" but it wasn't found.",tt)}let Mt=this.Versioning.None;this.targetObject=tt,tt.needsUpdate!==void 0?Mt=this.Versioning.NeedsUpdate:tt.matrixWorldNeedsUpdate!==void 0&&(Mt=this.Versioning.MatrixWorldNeedsUpdate);let Lt=this.BindingType.Direct;if(bt!==void 0){if(_t==="morphTargetInfluences"){if(!tt.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!tt.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);tt.morphTargetDictionary[bt]!==void 0&&(bt=tt.morphTargetDictionary[bt])}Lt=this.BindingType.ArrayElement,this.resolvedProperty=Pt,this.propertyIndex=bt}else Pt.fromArray!==void 0&&Pt.toArray!==void 0?(Lt=this.BindingType.HasFromToArray,this.resolvedProperty=Pt):Array.isArray(Pt)?(Lt=this.BindingType.EntireArray,this.resolvedProperty=Pt):this.propertyName=_t;this.getValue=this.GetterByBindingType[Lt],this.setValue=this.SetterByBindingTypeAndVersioning[Lt][Mt]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}Ts.Composite=class{constructor(St,tt,lt){const ht=lt||Ts.parseTrackName(tt);this._targetGroup=St,this._bindings=St.subscribe_(tt,ht)}getValue(St,tt){this.bind();const lt=this._targetGroup.nCachedObjects_,ht=this._bindings[lt];ht!==void 0&&ht.getValue(St,tt)}setValue(St,tt){const lt=this._bindings;for(let ht=this._targetGroup.nCachedObjects_,_t=lt.length;ht!==_t;++ht)lt[ht].setValue(St,tt)}bind(){const St=this._bindings;for(let tt=this._targetGroup.nCachedObjects_,lt=St.length;tt!==lt;++tt)St[tt].bind()}unbind(){const St=this._bindings;for(let tt=this._targetGroup.nCachedObjects_,lt=St.length;tt!==lt;++tt)St[tt].unbind()}},Ts.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Ts.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},Ts.prototype.GetterByBindingType=[Ts.prototype._getValue_direct,Ts.prototype._getValue_array,Ts.prototype._getValue_arrayElement,Ts.prototype._getValue_toArray],Ts.prototype.SetterByBindingTypeAndVersioning=[[Ts.prototype._setValue_direct,Ts.prototype._setValue_direct_setNeedsUpdate,Ts.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Ts.prototype._setValue_array,Ts.prototype._setValue_array_setNeedsUpdate,Ts.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Ts.prototype._setValue_arrayElement,Ts.prototype._setValue_arrayElement_setNeedsUpdate,Ts.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Ts.prototype._setValue_fromArray,Ts.prototype._setValue_fromArray_setNeedsUpdate,Ts.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class $E{constructor(){this.isAnimationObjectGroup=!0,this.uuid=Ao(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const tt={};this._indicesByUUID=tt;for(let ht=0,_t=arguments.length;ht!==_t;++ht)tt[arguments[ht].uuid]=ht;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const lt=this;this.stats={objects:{get total(){return lt._objects.length},get inUse(){return this.total-lt.nCachedObjects_}},get bindingsPerObject(){return lt._bindings.length}}}add(){const tt=this._objects,lt=this._indicesByUUID,ht=this._paths,_t=this._parsedPaths,bt=this._bindings,Pt=bt.length;let Mt,Lt=tt.length,Nt=this.nCachedObjects_;for(let jt=0,Wt=arguments.length;jt!==Wt;++jt){const Qt=arguments[jt],qt=Qt.uuid;let Xt=lt[qt];if(Xt===void 0){Xt=Lt++,lt[qt]=Xt,tt.push(Qt);for(let Zt=0,Yt=Pt;Zt!==Yt;++Zt)bt[Zt].push(new Ts(Qt,ht[Zt],_t[Zt]))}else if(Xt<Nt){Mt=tt[Xt];const Zt=--Nt,Yt=tt[Zt];lt[Yt.uuid]=Xt,tt[Xt]=Yt,lt[qt]=Zt,tt[Zt]=Qt;for(let ar=0,er=Pt;ar!==er;++ar){const tr=bt[ar],Ar=tr[Zt];let wr=tr[Xt];tr[Xt]=Ar,wr===void 0&&(wr=new Ts(Qt,ht[ar],_t[ar])),tr[Zt]=wr}}else tt[Xt]!==Mt&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=Nt}remove(){const tt=this._objects,lt=this._indicesByUUID,ht=this._bindings,_t=ht.length;let bt=this.nCachedObjects_;for(let Pt=0,Mt=arguments.length;Pt!==Mt;++Pt){const Lt=arguments[Pt],Nt=Lt.uuid,jt=lt[Nt];if(jt!==void 0&&jt>=bt){const Wt=bt++,Qt=tt[Wt];lt[Qt.uuid]=jt,tt[jt]=Qt,lt[Nt]=Wt,tt[Wt]=Lt;for(let qt=0,Xt=_t;qt!==Xt;++qt){const Zt=ht[qt],Yt=Zt[Wt],ar=Zt[jt];Zt[jt]=Yt,Zt[Wt]=ar}}}this.nCachedObjects_=bt}uncache(){const tt=this._objects,lt=this._indicesByUUID,ht=this._bindings,_t=ht.length;let bt=this.nCachedObjects_,Pt=tt.length;for(let Mt=0,Lt=arguments.length;Mt!==Lt;++Mt){const Nt=arguments[Mt].uuid,jt=lt[Nt];if(jt!==void 0)if(delete lt[Nt],jt<bt){const Wt=--bt,Qt=tt[Wt],qt=--Pt,Xt=tt[qt];lt[Qt.uuid]=jt,tt[jt]=Qt,lt[Xt.uuid]=Wt,tt[Wt]=Xt,tt.pop();for(let Zt=0,Yt=_t;Zt!==Yt;++Zt){const ar=ht[Zt],er=ar[Wt],tr=ar[qt];ar[jt]=er,ar[Wt]=tr,ar.pop()}}else{const Wt=--Pt,Qt=tt[Wt];Wt>0&&(lt[Qt.uuid]=jt),tt[jt]=Qt,tt.pop();for(let qt=0,Xt=_t;qt!==Xt;++qt){const Zt=ht[qt];Zt[jt]=Zt[Wt],Zt.pop()}}}this.nCachedObjects_=bt}subscribe_(tt,lt){const ht=this._bindingsIndicesByPath;let _t=ht[tt];const bt=this._bindings;if(_t!==void 0)return bt[_t];const Pt=this._paths,Mt=this._parsedPaths,Lt=this._objects,Nt=Lt.length,jt=this.nCachedObjects_,Wt=new Array(Nt);_t=bt.length,ht[tt]=_t,Pt.push(tt),Mt.push(lt),bt.push(Wt);for(let Qt=jt,qt=Lt.length;Qt!==qt;++Qt){const Xt=Lt[Qt];Wt[Qt]=new Ts(Xt,tt,lt)}return Wt}unsubscribe_(tt){const lt=this._bindingsIndicesByPath,ht=lt[tt];if(ht!==void 0){const _t=this._paths,bt=this._parsedPaths,Pt=this._bindings,Mt=Pt.length-1,Lt=Pt[Mt];lt[tt[Mt]]=ht,Pt[ht]=Lt,Pt.pop(),bt[ht]=bt[Mt],bt.pop(),_t[ht]=_t[Mt],_t.pop()}}}class $A{constructor(tt,lt,ht=null,_t=lt.blendMode){this._mixer=tt,this._clip=lt,this._localRoot=ht,this.blendMode=_t;const bt=lt.tracks,Pt=bt.length,Mt=new Array(Pt),Lt={endingStart:ou,endingEnd:ou};for(let Nt=0;Nt!==Pt;++Nt){const jt=bt[Nt].createInterpolant(null);Mt[Nt]=jt,jt.settings=Lt}this._interpolantSettings=Lt,this._interpolants=Mt,this._propertyBindings=new Array(Pt),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=Mu,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(tt){return this._startTime=tt,this}setLoop(tt,lt){return this.loop=tt,this.repetitions=lt,this}setEffectiveWeight(tt){return this.weight=tt,this._effectiveWeight=this.enabled?tt:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(tt){return this._scheduleFading(tt,0,1)}fadeOut(tt){return this._scheduleFading(tt,1,0)}crossFadeFrom(tt,lt,ht){if(tt.fadeOut(lt),this.fadeIn(lt),ht){const _t=this._clip.duration,bt=tt._clip.duration,Pt=bt/_t,Mt=_t/bt;tt.warp(1,Pt,lt),this.warp(Mt,1,lt)}return this}crossFadeTo(tt,lt,ht){return tt.crossFadeFrom(this,lt,ht)}stopFading(){const tt=this._weightInterpolant;return tt!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(tt)),this}setEffectiveTimeScale(tt){return this.timeScale=tt,this._effectiveTimeScale=this.paused?0:tt,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(tt){return this.timeScale=this._clip.duration/tt,this.stopWarping()}syncWith(tt){return this.time=tt.time,this.timeScale=tt.timeScale,this.stopWarping()}halt(tt){return this.warp(this._effectiveTimeScale,0,tt)}warp(tt,lt,ht){const _t=this._mixer,bt=_t.time,Pt=this.timeScale;let Mt=this._timeScaleInterpolant;Mt===null&&(Mt=_t._lendControlInterpolant(),this._timeScaleInterpolant=Mt);const Lt=Mt.parameterPositions,Nt=Mt.sampleValues;return Lt[0]=bt,Lt[1]=bt+ht,Nt[0]=tt/Pt,Nt[1]=lt/Pt,this}stopWarping(){const tt=this._timeScaleInterpolant;return tt!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(tt)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(tt,lt,ht,_t){if(!this.enabled)return void this._updateWeight(tt);const bt=this._startTime;if(bt!==null){const Lt=(tt-bt)*ht;Lt<0||ht===0?lt=0:(this._startTime=null,lt=ht*Lt)}lt*=this._updateTimeScale(tt);const Pt=this._updateTime(lt),Mt=this._updateWeight(tt);if(Mt>0){const Lt=this._interpolants,Nt=this._propertyBindings;if(this.blendMode===Yp)for(let jt=0,Wt=Lt.length;jt!==Wt;++jt)Lt[jt].evaluate(Pt),Nt[jt].accumulateAdditive(Mt);else for(let jt=0,Wt=Lt.length;jt!==Wt;++jt)Lt[jt].evaluate(Pt),Nt[jt].accumulate(_t,Mt)}}_updateWeight(tt){let lt=0;if(this.enabled){lt=this.weight;const ht=this._weightInterpolant;if(ht!==null){const _t=ht.evaluate(tt)[0];lt*=_t,tt>ht.parameterPositions[1]&&(this.stopFading(),_t===0&&(this.enabled=!1))}}return this._effectiveWeight=lt,lt}_updateTimeScale(tt){let lt=0;if(!this.paused){lt=this.timeScale;const ht=this._timeScaleInterpolant;ht!==null&&(lt*=ht.evaluate(tt)[0],tt>ht.parameterPositions[1]&&(this.stopWarping(),lt===0?this.paused=!0:this.timeScale=lt))}return this._effectiveTimeScale=lt,lt}_updateTime(tt){const lt=this._clip.duration,ht=this.loop;let _t=this.time+tt,bt=this._loopCount;const Pt=ht===$p;if(tt===0)return bt===-1||!Pt||1&~bt?_t:lt-_t;if(ht===Tu){bt===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(_t>=lt)_t=lt;else{if(!(_t<0)){this.time=_t;break e}_t=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=_t,this._mixer.dispatchEvent({type:"finished",action:this,direction:tt<0?-1:1})}}else{if(bt===-1&&(tt>=0?(bt=0,this._setEndings(!0,this.repetitions===0,Pt)):this._setEndings(this.repetitions===0,!0,Pt)),_t>=lt||_t<0){const Mt=Math.floor(_t/lt);_t-=lt*Mt,bt+=Math.abs(Mt);const Lt=this.repetitions-bt;if(Lt<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,_t=tt>0?lt:0,this.time=_t,this._mixer.dispatchEvent({type:"finished",action:this,direction:tt>0?1:-1});else{if(Lt===1){const Nt=tt<0;this._setEndings(Nt,!Nt,Pt)}else this._setEndings(!1,!1,Pt);this._loopCount=bt,this.time=_t,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:Mt})}}else this.time=_t;if(Pt&&!(1&~bt))return lt-_t}return _t}_setEndings(tt,lt,ht){const _t=this._interpolantSettings;ht?(_t.endingStart=lu,_t.endingEnd=lu):(_t.endingStart=tt?this.zeroSlopeAtStart?lu:ou:lp,_t.endingEnd=lt?this.zeroSlopeAtEnd?lu:ou:lp)}_scheduleFading(tt,lt,ht){const _t=this._mixer,bt=_t.time;let Pt=this._weightInterpolant;Pt===null&&(Pt=_t._lendControlInterpolant(),this._weightInterpolant=Pt);const Mt=Pt.parameterPositions,Lt=Pt.sampleValues;return Mt[0]=bt,Lt[0]=lt,Mt[1]=bt+tt,Lt[1]=ht,this}}const XE=new Float32Array(1);class YE extends go{constructor(tt){super(),this._root=tt,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(tt,lt){const ht=tt._localRoot||this._root,_t=tt._clip.tracks,bt=_t.length,Pt=tt._propertyBindings,Mt=tt._interpolants,Lt=ht.uuid,Nt=this._bindingsByRootAndName;let jt=Nt[Lt];jt===void 0&&(jt={},Nt[Lt]=jt);for(let Wt=0;Wt!==bt;++Wt){const Qt=_t[Wt],qt=Qt.name;let Xt=jt[qt];if(Xt!==void 0)++Xt.referenceCount,Pt[Wt]=Xt;else{if(Xt=Pt[Wt],Xt!==void 0){Xt._cacheIndex===null&&(++Xt.referenceCount,this._addInactiveBinding(Xt,Lt,qt));continue}const Zt=lt&&lt._propertyBindings[Wt].binding.parsedPath;Xt=new qA(Ts.create(ht,qt,Zt),Qt.ValueTypeName,Qt.getValueSize()),++Xt.referenceCount,this._addInactiveBinding(Xt,Lt,qt),Pt[Wt]=Xt}Mt[Wt].resultBuffer=Xt.buffer}}_activateAction(tt){if(!this._isActiveAction(tt)){if(tt._cacheIndex===null){const ht=(tt._localRoot||this._root).uuid,_t=tt._clip.uuid,bt=this._actionsByClip[_t];this._bindAction(tt,bt&&bt.knownActions[0]),this._addInactiveAction(tt,_t,ht)}const lt=tt._propertyBindings;for(let ht=0,_t=lt.length;ht!==_t;++ht){const bt=lt[ht];bt.useCount++==0&&(this._lendBinding(bt),bt.saveOriginalState())}this._lendAction(tt)}}_deactivateAction(tt){if(this._isActiveAction(tt)){const lt=tt._propertyBindings;for(let ht=0,_t=lt.length;ht!==_t;++ht){const bt=lt[ht];--bt.useCount==0&&(bt.restoreOriginalState(),this._takeBackBinding(bt))}this._takeBackAction(tt)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const tt=this;this.stats={actions:{get total(){return tt._actions.length},get inUse(){return tt._nActiveActions}},bindings:{get total(){return tt._bindings.length},get inUse(){return tt._nActiveBindings}},controlInterpolants:{get total(){return tt._controlInterpolants.length},get inUse(){return tt._nActiveControlInterpolants}}}}_isActiveAction(tt){const lt=tt._cacheIndex;return lt!==null&&lt<this._nActiveActions}_addInactiveAction(tt,lt,ht){const _t=this._actions,bt=this._actionsByClip;let Pt=bt[lt];if(Pt===void 0)Pt={knownActions:[tt],actionByRoot:{}},tt._byClipCacheIndex=0,bt[lt]=Pt;else{const Mt=Pt.knownActions;tt._byClipCacheIndex=Mt.length,Mt.push(tt)}tt._cacheIndex=_t.length,_t.push(tt),Pt.actionByRoot[ht]=tt}_removeInactiveAction(tt){const lt=this._actions,ht=lt[lt.length-1],_t=tt._cacheIndex;ht._cacheIndex=_t,lt[_t]=ht,lt.pop(),tt._cacheIndex=null;const bt=tt._clip.uuid,Pt=this._actionsByClip,Mt=Pt[bt],Lt=Mt.knownActions,Nt=Lt[Lt.length-1],jt=tt._byClipCacheIndex;Nt._byClipCacheIndex=jt,Lt[jt]=Nt,Lt.pop(),tt._byClipCacheIndex=null,delete Mt.actionByRoot[(tt._localRoot||this._root).uuid],Lt.length===0&&delete Pt[bt],this._removeInactiveBindingsForAction(tt)}_removeInactiveBindingsForAction(tt){const lt=tt._propertyBindings;for(let ht=0,_t=lt.length;ht!==_t;++ht){const bt=lt[ht];--bt.referenceCount==0&&this._removeInactiveBinding(bt)}}_lendAction(tt){const lt=this._actions,ht=tt._cacheIndex,_t=this._nActiveActions++,bt=lt[_t];tt._cacheIndex=_t,lt[_t]=tt,bt._cacheIndex=ht,lt[ht]=bt}_takeBackAction(tt){const lt=this._actions,ht=tt._cacheIndex,_t=--this._nActiveActions,bt=lt[_t];tt._cacheIndex=_t,lt[_t]=tt,bt._cacheIndex=ht,lt[ht]=bt}_addInactiveBinding(tt,lt,ht){const _t=this._bindingsByRootAndName,bt=this._bindings;let Pt=_t[lt];Pt===void 0&&(Pt={},_t[lt]=Pt),Pt[ht]=tt,tt._cacheIndex=bt.length,bt.push(tt)}_removeInactiveBinding(tt){const lt=this._bindings,ht=tt.binding,_t=ht.rootNode.uuid,bt=ht.path,Pt=this._bindingsByRootAndName,Mt=Pt[_t],Lt=lt[lt.length-1],Nt=tt._cacheIndex;Lt._cacheIndex=Nt,lt[Nt]=Lt,lt.pop(),delete Mt[bt],Object.keys(Mt).length===0&&delete Pt[_t]}_lendBinding(tt){const lt=this._bindings,ht=tt._cacheIndex,_t=this._nActiveBindings++,bt=lt[_t];tt._cacheIndex=_t,lt[_t]=tt,bt._cacheIndex=ht,lt[ht]=bt}_takeBackBinding(tt){const lt=this._bindings,ht=tt._cacheIndex,_t=--this._nActiveBindings,bt=lt[_t];tt._cacheIndex=_t,lt[_t]=tt,bt._cacheIndex=ht,lt[ht]=bt}_lendControlInterpolant(){const tt=this._controlInterpolants,lt=this._nActiveControlInterpolants++;let ht=tt[lt];return ht===void 0&&(ht=new _y(new Float32Array(2),new Float32Array(2),1,XE),ht.__cacheIndex=lt,tt[lt]=ht),ht}_takeBackControlInterpolant(tt){const lt=this._controlInterpolants,ht=tt.__cacheIndex,_t=--this._nActiveControlInterpolants,bt=lt[_t];tt.__cacheIndex=_t,lt[_t]=tt,bt.__cacheIndex=ht,lt[ht]=bt}clipAction(tt,lt,ht){const _t=lt||this._root,bt=_t.uuid;let Pt=typeof tt=="string"?O_.findByName(_t,tt):tt;const Mt=Pt!==null?Pt.uuid:tt,Lt=this._actionsByClip[Mt];let Nt=null;if(ht===void 0&&(ht=Pt!==null?Pt.blendMode:Hm),Lt!==void 0){const Wt=Lt.actionByRoot[bt];if(Wt!==void 0&&Wt.blendMode===ht)return Wt;Nt=Lt.knownActions[0],Pt===null&&(Pt=Nt._clip)}if(Pt===null)return null;const jt=new $A(this,Pt,lt,ht);return this._bindAction(jt,Nt),this._addInactiveAction(jt,Mt,bt),jt}existingAction(tt,lt){const ht=lt||this._root,_t=ht.uuid,bt=typeof tt=="string"?O_.findByName(ht,tt):tt,Pt=bt?bt.uuid:tt,Mt=this._actionsByClip[Pt];return Mt!==void 0&&Mt.actionByRoot[_t]||null}stopAllAction(){const tt=this._actions;for(let lt=this._nActiveActions-1;lt>=0;--lt)tt[lt].stop();return this}update(tt){tt*=this.timeScale;const lt=this._actions,ht=this._nActiveActions,_t=this.time+=tt,bt=Math.sign(tt),Pt=this._accuIndex^=1;for(let Nt=0;Nt!==ht;++Nt)lt[Nt]._update(_t,tt,bt,Pt);const Mt=this._bindings,Lt=this._nActiveBindings;for(let Nt=0;Nt!==Lt;++Nt)Mt[Nt].apply(Pt);return this}setTime(tt){this.time=0;for(let lt=0;lt<this._actions.length;lt++)this._actions[lt].time=0;return this.update(tt)}getRoot(){return this._root}uncacheClip(tt){const lt=this._actions,ht=tt.uuid,_t=this._actionsByClip,bt=_t[ht];if(bt!==void 0){const Pt=bt.knownActions;for(let Mt=0,Lt=Pt.length;Mt!==Lt;++Mt){const Nt=Pt[Mt];this._deactivateAction(Nt);const jt=Nt._cacheIndex,Wt=lt[lt.length-1];Nt._cacheIndex=null,Nt._byClipCacheIndex=null,Wt._cacheIndex=jt,lt[jt]=Wt,lt.pop(),this._removeInactiveBindingsForAction(Nt)}delete _t[ht]}}uncacheRoot(tt){const lt=tt.uuid,ht=this._actionsByClip;for(const bt in ht){const Pt=ht[bt].actionByRoot[lt];Pt!==void 0&&(this._deactivateAction(Pt),this._removeInactiveAction(Pt))}const _t=this._bindingsByRootAndName[lt];if(_t!==void 0)for(const bt in _t){const Pt=_t[bt];Pt.restoreOriginalState(),this._removeInactiveBinding(Pt)}}uncacheAction(tt,lt){const ht=this.existingAction(tt,lt);ht!==null&&(this._deactivateAction(ht),this._removeInactiveAction(ht))}}class Cy{constructor(tt){this.value=tt}clone(){return new Cy(this.value.clone===void 0?this.value:this.value.clone())}}let KE=0;class JE extends go{constructor(){super(),this.isUniformsGroup=!0,Object.defineProperty(this,"id",{value:KE++}),this.name="",this.usage=Du,this.uniforms=[]}add(tt){return this.uniforms.push(tt),this}remove(tt){const lt=this.uniforms.indexOf(tt);return lt!==-1&&this.uniforms.splice(lt,1),this}setName(tt){return this.name=tt,this}setUsage(tt){return this.usage=tt,this}dispose(){return this.dispatchEvent({type:"dispose"}),this}copy(tt){this.name=tt.name,this.usage=tt.usage;const lt=tt.uniforms;this.uniforms.length=0;for(let ht=0,_t=lt.length;ht<_t;ht++)this.uniforms.push(lt[ht].clone());return this}clone(){return new this.constructor().copy(this)}}class ZE extends Iv{constructor(tt,lt,ht=1){super(tt,lt),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=ht}copy(tt){return super.copy(tt),this.meshPerAttribute=tt.meshPerAttribute,this}clone(tt){const lt=super.clone(tt);return lt.meshPerAttribute=this.meshPerAttribute,lt}toJSON(tt){const lt=super.toJSON(tt);return lt.isInstancedInterleavedBuffer=!0,lt.meshPerAttribute=this.meshPerAttribute,lt}}class eS{constructor(tt,lt,ht,_t,bt){this.isGLBufferAttribute=!0,this.name="",this.buffer=tt,this.type=lt,this.itemSize=ht,this.elementSize=_t,this.count=bt,this.version=0}set needsUpdate(tt){tt===!0&&this.version++}setBuffer(tt){return this.buffer=tt,this}setType(tt,lt){return this.type=tt,this.elementSize=lt,this}setItemSize(tt){return this.itemSize=tt,this}setCount(tt){return this.count=tt,this}}class tS{constructor(tt,lt,ht=0,_t=1/0){this.ray=new Gu(tt,lt),this.near=ht,this.far=_t,this.camera=null,this.layers=new um,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(tt,lt){this.ray.set(tt,lt)}setFromCamera(tt,lt){lt.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(lt.matrixWorld),this.ray.direction.set(tt.x,tt.y,.5).unproject(lt).sub(this.ray.origin).normalize(),this.camera=lt):lt.isOrthographicCamera?(this.ray.origin.set(tt.x,tt.y,(lt.near+lt.far)/(lt.near-lt.far)).unproject(lt),this.ray.direction.set(0,0,-1).transformDirection(lt.matrixWorld),this.camera=lt):console.error("THREE.Raycaster: Unsupported camera type: "+lt.type)}intersectObject(tt,lt=!0,ht=[]){return Py(tt,this,ht,lt),ht.sort(XA),ht}intersectObjects(tt,lt=!0,ht=[]){for(let _t=0,bt=tt.length;_t<bt;_t++)Py(tt[_t],this,ht,lt);return ht.sort(XA),ht}}function XA(St,tt){return St.distance-tt.distance}function Py(St,tt,lt,ht){if(St.layers.test(tt.layers)&&St.raycast(tt,lt),ht===!0){const _t=St.children;for(let bt=0,Pt=_t.length;bt<Pt;bt++)Py(_t[bt],tt,lt,!0)}}class rS{constructor(tt=1,lt=0,ht=0){return this.radius=tt,this.phi=lt,this.theta=ht,this}set(tt,lt,ht){return this.radius=tt,this.phi=lt,this.theta=ht,this}copy(tt){return this.radius=tt.radius,this.phi=tt.phi,this.theta=tt.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(tt){return this.setFromCartesianCoords(tt.x,tt.y,tt.z)}setFromCartesianCoords(tt,lt,ht){return this.radius=Math.sqrt(tt*tt+lt*lt+ht*ht),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(tt,ht),this.phi=Math.acos(Qs(lt/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}class iS{constructor(tt=1,lt=0,ht=0){return this.radius=tt,this.theta=lt,this.y=ht,this}set(tt,lt,ht){return this.radius=tt,this.theta=lt,this.y=ht,this}copy(tt){return this.radius=tt.radius,this.theta=tt.theta,this.y=tt.y,this}setFromVector3(tt){return this.setFromCartesianCoords(tt.x,tt.y,tt.z)}setFromCartesianCoords(tt,lt,ht){return this.radius=Math.sqrt(tt*tt+ht*ht),this.theta=Math.atan2(tt,ht),this.y=lt,this}clone(){return new this.constructor().copy(this)}}const YA=new mn;class nS{constructor(tt=new mn(1/0,1/0),lt=new mn(-1/0,-1/0)){this.isBox2=!0,this.min=tt,this.max=lt}set(tt,lt){return this.min.copy(tt),this.max.copy(lt),this}setFromPoints(tt){this.makeEmpty();for(let lt=0,ht=tt.length;lt<ht;lt++)this.expandByPoint(tt[lt]);return this}setFromCenterAndSize(tt,lt){const ht=YA.copy(lt).multiplyScalar(.5);return this.min.copy(tt).sub(ht),this.max.copy(tt).add(ht),this}clone(){return new this.constructor().copy(this)}copy(tt){return this.min.copy(tt.min),this.max.copy(tt.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(tt){return this.isEmpty()?tt.set(0,0):tt.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(tt){return this.isEmpty()?tt.set(0,0):tt.subVectors(this.max,this.min)}expandByPoint(tt){return this.min.min(tt),this.max.max(tt),this}expandByVector(tt){return this.min.sub(tt),this.max.add(tt),this}expandByScalar(tt){return this.min.addScalar(-tt),this.max.addScalar(tt),this}containsPoint(tt){return!(tt.x<this.min.x||tt.x>this.max.x||tt.y<this.min.y||tt.y>this.max.y)}containsBox(tt){return this.min.x<=tt.min.x&&tt.max.x<=this.max.x&&this.min.y<=tt.min.y&&tt.max.y<=this.max.y}getParameter(tt,lt){return lt.set((tt.x-this.min.x)/(this.max.x-this.min.x),(tt.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(tt){return!(tt.max.x<this.min.x||tt.min.x>this.max.x||tt.max.y<this.min.y||tt.min.y>this.max.y)}clampPoint(tt,lt){return lt.copy(tt).clamp(this.min,this.max)}distanceToPoint(tt){return this.clampPoint(tt,YA).distanceTo(tt)}intersect(tt){return this.min.max(tt.min),this.max.min(tt.max),this.isEmpty()&&this.makeEmpty(),this}union(tt){return this.min.min(tt.min),this.max.max(tt.max),this}translate(tt){return this.min.add(tt),this.max.add(tt),this}equals(tt){return tt.min.equals(this.min)&&tt.max.equals(this.max)}}const KA=new Sr,u0=new Sr;class sS{constructor(tt=new Sr,lt=new Sr){this.start=tt,this.end=lt}set(tt,lt){return this.start.copy(tt),this.end.copy(lt),this}copy(tt){return this.start.copy(tt.start),this.end.copy(tt.end),this}getCenter(tt){return tt.addVectors(this.start,this.end).multiplyScalar(.5)}delta(tt){return tt.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(tt,lt){return this.delta(lt).multiplyScalar(tt).add(this.start)}closestPointToPointParameter(tt,lt){KA.subVectors(tt,this.start),u0.subVectors(this.end,this.start);const ht=u0.dot(u0);let _t=u0.dot(KA)/ht;return lt&&(_t=Qs(_t,0,1)),_t}closestPointToPoint(tt,lt,ht){const _t=this.closestPointToPointParameter(tt,lt);return this.delta(ht).multiplyScalar(_t).add(this.start)}applyMatrix4(tt){return this.start.applyMatrix4(tt),this.end.applyMatrix4(tt),this}equals(tt){return tt.start.equals(this.start)&&tt.end.equals(this.end)}clone(){return new this.constructor().copy(this)}}const JA=new Sr;class aS extends Cs{constructor(tt,lt){super(),this.light=tt,this.matrix=tt.matrixWorld,this.matrixAutoUpdate=!1,this.color=lt,this.type="SpotLightHelper";const ht=new fs,_t=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let Pt=0,Mt=1,Lt=32;Pt<Lt;Pt++,Mt++){const Nt=Pt/Lt*Math.PI*2,jt=Mt/Lt*Math.PI*2;_t.push(Math.cos(Nt),Math.sin(Nt),1,Math.cos(jt),Math.sin(jt),1)}ht.setAttribute("position",new On(_t,3));const bt=new Oo({fog:!1,toneMapped:!1});this.cone=new eu(ht,bt),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1);const tt=this.light.distance?this.light.distance:1e3,lt=tt*Math.tan(this.light.angle);this.cone.scale.set(lt,lt,tt),JA.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(JA),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const ep=new Sr,p0=new is,Ty=new is;class oS extends eu{constructor(tt){const lt=ZA(tt),ht=new fs,_t=[],bt=[],Pt=new jn(0,0,1),Mt=new jn(0,1,0);for(let Lt=0;Lt<lt.length;Lt++){const Nt=lt[Lt];Nt.parent&&Nt.parent.isBone&&(_t.push(0,0,0),_t.push(0,0,0),bt.push(Pt.r,Pt.g,Pt.b),bt.push(Mt.r,Mt.g,Mt.b))}ht.setAttribute("position",new On(_t,3)),ht.setAttribute("color",new On(bt,3)),super(ht,new Oo({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0})),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=tt,this.bones=lt,this.matrix=tt.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(tt){const lt=this.bones,ht=this.geometry,_t=ht.getAttribute("position");Ty.copy(this.root.matrixWorld).invert();for(let bt=0,Pt=0;bt<lt.length;bt++){const Mt=lt[bt];Mt.parent&&Mt.parent.isBone&&(p0.multiplyMatrices(Ty,Mt.matrixWorld),ep.setFromMatrixPosition(p0),_t.setXYZ(Pt,ep.x,ep.y,ep.z),p0.multiplyMatrices(Ty,Mt.parent.matrixWorld),ep.setFromMatrixPosition(p0),_t.setXYZ(Pt+1,ep.x,ep.y,ep.z),Pt+=2)}ht.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(tt)}dispose(){this.geometry.dispose(),this.material.dispose()}}function ZA(St){const tt=[];St.isBone===!0&&tt.push(St);for(let lt=0;lt<St.children.length;lt++)tt.push.apply(tt,ZA(St.children[lt]));return tt}class lS extends co{constructor(tt,lt,ht){super(new k_(lt,4,2),new _c({wireframe:!0,fog:!1,toneMapped:!1})),this.light=tt,this.color=ht,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const cS=new Sr,ew=new jn,tw=new jn;class uS extends Cs{constructor(tt,lt,ht){super(),this.light=tt,this.matrix=tt.matrixWorld,this.matrixAutoUpdate=!1,this.color=ht,this.type="HemisphereLightHelper";const _t=new R_(lt);_t.rotateY(.5*Math.PI),this.material=new _c({wireframe:!0,fog:!1,toneMapped:!1}),this.color===void 0&&(this.material.vertexColors=!0);const bt=_t.getAttribute("position"),Pt=new Float32Array(3*bt.count);_t.setAttribute("color",new gr(Pt,3)),this.add(new co(_t,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const tt=this.children[0];if(this.color!==void 0)this.material.color.set(this.color);else{const lt=tt.geometry.getAttribute("color");ew.copy(this.light.color),tw.copy(this.light.groundColor);for(let ht=0,_t=lt.count;ht<_t;ht++){const bt=ht<_t/2?ew:tw;lt.setXYZ(ht,bt.r,bt.g,bt.b)}lt.needsUpdate=!0}this.light.updateWorldMatrix(!0,!1),tt.lookAt(cS.setFromMatrixPosition(this.light.matrixWorld).negate())}}class pS extends eu{constructor(tt=10,lt=10,ht=4473924,_t=8947848){ht=new jn(ht),_t=new jn(_t);const bt=lt/2,Pt=tt/lt,Mt=tt/2,Lt=[],Nt=[];for(let Wt=0,Qt=0,qt=-Mt;Wt<=lt;Wt++,qt+=Pt){Lt.push(-Mt,0,qt,Mt,0,qt),Lt.push(qt,0,-Mt,qt,0,Mt);const Xt=Wt===bt?ht:_t;Xt.toArray(Nt,Qt),Qt+=3,Xt.toArray(Nt,Qt),Qt+=3,Xt.toArray(Nt,Qt),Qt+=3,Xt.toArray(Nt,Qt),Qt+=3}const jt=new fs;jt.setAttribute("position",new On(Lt,3)),jt.setAttribute("color",new On(Nt,3)),super(jt,new Oo({vertexColors:!0,toneMapped:!1})),this.type="GridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}class hS extends eu{constructor(tt=10,lt=16,ht=8,_t=64,bt=4473924,Pt=8947848){bt=new jn(bt),Pt=new jn(Pt);const Mt=[],Lt=[];if(lt>1)for(let jt=0;jt<lt;jt++){const Wt=jt/lt*(2*Math.PI),Qt=Math.sin(Wt)*tt,qt=Math.cos(Wt)*tt;Mt.push(0,0,0),Mt.push(Qt,0,qt);const Xt=1&jt?bt:Pt;Lt.push(Xt.r,Xt.g,Xt.b),Lt.push(Xt.r,Xt.g,Xt.b)}for(let jt=0;jt<ht;jt++){const Wt=1&jt?bt:Pt,Qt=tt-tt/ht*jt;for(let qt=0;qt<_t;qt++){let Xt=qt/_t*(2*Math.PI),Zt=Math.sin(Xt)*Qt,Yt=Math.cos(Xt)*Qt;Mt.push(Zt,0,Yt),Lt.push(Wt.r,Wt.g,Wt.b),Xt=(qt+1)/_t*(2*Math.PI),Zt=Math.sin(Xt)*Qt,Yt=Math.cos(Xt)*Qt,Mt.push(Zt,0,Yt),Lt.push(Wt.r,Wt.g,Wt.b)}}const Nt=new fs;Nt.setAttribute("position",new On(Mt,3)),Nt.setAttribute("color",new On(Lt,3)),super(Nt,new Oo({vertexColors:!0,toneMapped:!1})),this.type="PolarGridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}const rw=new Sr,h0=new Sr,iw=new Sr;class dS extends Cs{constructor(tt,lt,ht){super(),this.light=tt,this.matrix=tt.matrixWorld,this.matrixAutoUpdate=!1,this.color=ht,this.type="DirectionalLightHelper",lt===void 0&&(lt=1);let _t=new fs;_t.setAttribute("position",new On([-lt,lt,0,lt,lt,0,lt,-lt,0,-lt,-lt,0,-lt,lt,0],3));const bt=new Oo({fog:!1,toneMapped:!1});this.lightPlane=new Ku(_t,bt),this.add(this.lightPlane),_t=new fs,_t.setAttribute("position",new On([0,0,0,0,0,1],3)),this.targetLine=new Ku(_t,bt),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),rw.setFromMatrixPosition(this.light.matrixWorld),h0.setFromMatrixPosition(this.light.target.matrixWorld),iw.subVectors(h0,rw),this.lightPlane.lookAt(h0),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(h0),this.targetLine.scale.z=iw.length()}}const d0=new Sr,Js=new bv;class mS extends eu{constructor(tt){const lt=new fs,ht=new Oo({color:16777215,vertexColors:!0,toneMapped:!1}),_t=[],bt=[],Pt={};function Mt(Xt,Zt){Lt(Xt),Lt(Zt)}function Lt(Xt){_t.push(0,0,0),bt.push(0,0,0),Pt[Xt]===void 0&&(Pt[Xt]=[]),Pt[Xt].push(_t.length/3-1)}Mt("n1","n2"),Mt("n2","n4"),Mt("n4","n3"),Mt("n3","n1"),Mt("f1","f2"),Mt("f2","f4"),Mt("f4","f3"),Mt("f3","f1"),Mt("n1","f1"),Mt("n2","f2"),Mt("n3","f3"),Mt("n4","f4"),Mt("p","n1"),Mt("p","n2"),Mt("p","n3"),Mt("p","n4"),Mt("u1","u2"),Mt("u2","u3"),Mt("u3","u1"),Mt("c","t"),Mt("p","c"),Mt("cn1","cn2"),Mt("cn3","cn4"),Mt("cf1","cf2"),Mt("cf3","cf4"),lt.setAttribute("position",new On(_t,3)),lt.setAttribute("color",new On(bt,3)),super(lt,ht),this.type="CameraHelper",this.camera=tt,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=tt.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=Pt,this.update();const Nt=new jn(16755200),jt=new jn(16711680),Wt=new jn(43775),Qt=new jn(16777215),qt=new jn(3355443);this.setColors(Nt,jt,Wt,Qt,qt)}setColors(tt,lt,ht,_t,bt){const Pt=this.geometry.getAttribute("color");Pt.setXYZ(0,tt.r,tt.g,tt.b),Pt.setXYZ(1,tt.r,tt.g,tt.b),Pt.setXYZ(2,tt.r,tt.g,tt.b),Pt.setXYZ(3,tt.r,tt.g,tt.b),Pt.setXYZ(4,tt.r,tt.g,tt.b),Pt.setXYZ(5,tt.r,tt.g,tt.b),Pt.setXYZ(6,tt.r,tt.g,tt.b),Pt.setXYZ(7,tt.r,tt.g,tt.b),Pt.setXYZ(8,tt.r,tt.g,tt.b),Pt.setXYZ(9,tt.r,tt.g,tt.b),Pt.setXYZ(10,tt.r,tt.g,tt.b),Pt.setXYZ(11,tt.r,tt.g,tt.b),Pt.setXYZ(12,tt.r,tt.g,tt.b),Pt.setXYZ(13,tt.r,tt.g,tt.b),Pt.setXYZ(14,tt.r,tt.g,tt.b),Pt.setXYZ(15,tt.r,tt.g,tt.b),Pt.setXYZ(16,tt.r,tt.g,tt.b),Pt.setXYZ(17,tt.r,tt.g,tt.b),Pt.setXYZ(18,tt.r,tt.g,tt.b),Pt.setXYZ(19,tt.r,tt.g,tt.b),Pt.setXYZ(20,tt.r,tt.g,tt.b),Pt.setXYZ(21,tt.r,tt.g,tt.b),Pt.setXYZ(22,tt.r,tt.g,tt.b),Pt.setXYZ(23,tt.r,tt.g,tt.b),Pt.setXYZ(24,lt.r,lt.g,lt.b),Pt.setXYZ(25,lt.r,lt.g,lt.b),Pt.setXYZ(26,lt.r,lt.g,lt.b),Pt.setXYZ(27,lt.r,lt.g,lt.b),Pt.setXYZ(28,lt.r,lt.g,lt.b),Pt.setXYZ(29,lt.r,lt.g,lt.b),Pt.setXYZ(30,lt.r,lt.g,lt.b),Pt.setXYZ(31,lt.r,lt.g,lt.b),Pt.setXYZ(32,ht.r,ht.g,ht.b),Pt.setXYZ(33,ht.r,ht.g,ht.b),Pt.setXYZ(34,ht.r,ht.g,ht.b),Pt.setXYZ(35,ht.r,ht.g,ht.b),Pt.setXYZ(36,ht.r,ht.g,ht.b),Pt.setXYZ(37,ht.r,ht.g,ht.b),Pt.setXYZ(38,_t.r,_t.g,_t.b),Pt.setXYZ(39,_t.r,_t.g,_t.b),Pt.setXYZ(40,bt.r,bt.g,bt.b),Pt.setXYZ(41,bt.r,bt.g,bt.b),Pt.setXYZ(42,bt.r,bt.g,bt.b),Pt.setXYZ(43,bt.r,bt.g,bt.b),Pt.setXYZ(44,bt.r,bt.g,bt.b),Pt.setXYZ(45,bt.r,bt.g,bt.b),Pt.setXYZ(46,bt.r,bt.g,bt.b),Pt.setXYZ(47,bt.r,bt.g,bt.b),Pt.setXYZ(48,bt.r,bt.g,bt.b),Pt.setXYZ(49,bt.r,bt.g,bt.b),Pt.needsUpdate=!0}update(){const tt=this.geometry,lt=this.pointMap;Js.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),ga("c",lt,tt,Js,0,0,-1),ga("t",lt,tt,Js,0,0,1),ga("n1",lt,tt,Js,-1,-1,-1),ga("n2",lt,tt,Js,1,-1,-1),ga("n3",lt,tt,Js,-1,1,-1),ga("n4",lt,tt,Js,1,1,-1),ga("f1",lt,tt,Js,-1,-1,1),ga("f2",lt,tt,Js,1,-1,1),ga("f3",lt,tt,Js,-1,1,1),ga("f4",lt,tt,Js,1,1,1),ga("u1",lt,tt,Js,.7,1.1,-1),ga("u2",lt,tt,Js,-.7,1.1,-1),ga("u3",lt,tt,Js,0,2,-1),ga("cf1",lt,tt,Js,-1,0,1),ga("cf2",lt,tt,Js,1,0,1),ga("cf3",lt,tt,Js,0,-1,1),ga("cf4",lt,tt,Js,0,1,1),ga("cn1",lt,tt,Js,-1,0,-1),ga("cn2",lt,tt,Js,1,0,-1),ga("cn3",lt,tt,Js,0,-1,-1),ga("cn4",lt,tt,Js,0,1,-1),tt.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function ga(St,tt,lt,ht,_t,bt,Pt){d0.set(_t,bt,Pt).unproject(ht);const Mt=tt[St];if(Mt!==void 0){const Lt=lt.getAttribute("position");for(let Nt=0,jt=Mt.length;Nt<jt;Nt++)Lt.setXYZ(Mt[Nt],d0.x,d0.y,d0.z)}}const m0=new Al;class gS extends eu{constructor(tt,lt=16776960){const ht=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),_t=new Float32Array(24),bt=new fs;bt.setIndex(new gr(ht,1)),bt.setAttribute("position",new gr(_t,3)),super(bt,new Oo({color:lt,toneMapped:!1})),this.object=tt,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(tt){if(tt!==void 0&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),this.object!==void 0&&m0.setFromObject(this.object),m0.isEmpty())return;const lt=m0.min,ht=m0.max,_t=this.geometry.attributes.position,bt=_t.array;bt[0]=ht.x,bt[1]=ht.y,bt[2]=ht.z,bt[3]=lt.x,bt[4]=ht.y,bt[5]=ht.z,bt[6]=lt.x,bt[7]=lt.y,bt[8]=ht.z,bt[9]=ht.x,bt[10]=lt.y,bt[11]=ht.z,bt[12]=ht.x,bt[13]=ht.y,bt[14]=lt.z,bt[15]=lt.x,bt[16]=ht.y,bt[17]=lt.z,bt[18]=lt.x,bt[19]=lt.y,bt[20]=lt.z,bt[21]=ht.x,bt[22]=lt.y,bt[23]=lt.z,_t.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(tt){return this.object=tt,this.update(),this}copy(tt,lt){return super.copy(tt,lt),this.object=tt.object,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class _S extends eu{constructor(tt,lt=16776960){const ht=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),_t=new fs;_t.setIndex(new gr(ht,1)),_t.setAttribute("position",new On([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),super(_t,new Oo({color:lt,toneMapped:!1})),this.box=tt,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(tt){const lt=this.box;lt.isEmpty()||(lt.getCenter(this.position),lt.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(tt))}dispose(){this.geometry.dispose(),this.material.dispose()}}class fS extends Ku{constructor(tt,lt=1,ht=16776960){const _t=ht,bt=new fs;bt.setAttribute("position",new On([1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],3)),bt.computeBoundingSphere(),super(bt,new Oo({color:_t,toneMapped:!1})),this.type="PlaneHelper",this.plane=tt,this.size=lt;const Pt=new fs;Pt.setAttribute("position",new On([1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],3)),Pt.computeBoundingSphere(),this.add(new co(Pt,new _c({color:_t,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(tt){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),super.updateMatrixWorld(tt)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}}const nw=new Sr;let g0,My;class vS extends Cs{constructor(tt=new Sr(0,0,1),lt=new Sr(0,0,0),ht=1,_t=16776960,bt=.2*ht,Pt=.2*bt){super(),this.type="ArrowHelper",g0===void 0&&(g0=new fs,g0.setAttribute("position",new On([0,0,0,0,1,0],3)),My=new Rm(0,.5,1,5,1),My.translate(0,-.5,0)),this.position.copy(lt),this.line=new Ku(g0,new Oo({color:_t,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new co(My,new _c({color:_t,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(tt),this.setLength(ht,bt,Pt)}setDirection(tt){if(tt.y>.99999)this.quaternion.set(0,0,0,1);else if(tt.y<-.99999)this.quaternion.set(1,0,0,0);else{nw.set(tt.z,0,-tt.x).normalize();const lt=Math.acos(tt.y);this.quaternion.setFromAxisAngle(nw,lt)}}setLength(tt,lt=.2*tt,ht=.2*lt){this.line.scale.set(1,Math.max(1e-4,tt-lt),1),this.line.updateMatrix(),this.cone.scale.set(ht,lt,ht),this.cone.position.y=tt,this.cone.updateMatrix()}setColor(tt){this.line.material.color.set(tt),this.cone.material.color.set(tt)}copy(tt){return super.copy(tt,!1),this.line.copy(tt.line),this.cone.copy(tt.cone),this}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),this.cone.geometry.dispose(),this.cone.material.dispose()}}class yS extends eu{constructor(tt=1){const lt=[0,0,0,tt,0,0,0,0,0,0,tt,0,0,0,0,0,0,tt],ht=new fs;ht.setAttribute("position",new On(lt,3)),ht.setAttribute("color",new On([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3)),super(ht,new Oo({vertexColors:!0,toneMapped:!1})),this.type="AxesHelper"}setColors(tt,lt,ht){const _t=new jn,bt=this.geometry.attributes.color.array;return _t.set(tt),_t.toArray(bt,0),_t.toArray(bt,3),_t.set(lt),_t.toArray(bt,6),_t.toArray(bt,9),_t.set(ht),_t.toArray(bt,12),_t.toArray(bt,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class bS{constructor(){this.type="ShapePath",this.color=new jn,this.subPaths=[],this.currentPath=null}moveTo(tt,lt){return this.currentPath=new C_,this.subPaths.push(this.currentPath),this.currentPath.moveTo(tt,lt),this}lineTo(tt,lt){return this.currentPath.lineTo(tt,lt),this}quadraticCurveTo(tt,lt,ht,_t){return this.currentPath.quadraticCurveTo(tt,lt,ht,_t),this}bezierCurveTo(tt,lt,ht,_t,bt,Pt){return this.currentPath.bezierCurveTo(tt,lt,ht,_t,bt,Pt),this}splineThru(tt){return this.currentPath.splineThru(tt),this}toShapes(tt){function lt(Yt,ar){const er=ar.length;let tr=!1;for(let Ar=er-1,wr=0;wr<er;Ar=wr++){let br=ar[Ar],Mr=ar[wr],Qr=Mr.x-br.x,Fr=Mr.y-br.y;if(Math.abs(Fr)>Number.EPSILON){if(Fr<0&&(br=ar[wr],Qr=-Qr,Mr=ar[Ar],Fr=-Fr),Yt.y<br.y||Yt.y>Mr.y)continue;if(Yt.y===br.y){if(Yt.x===br.x)return!0}else{const Vr=Fr*(Yt.x-br.x)-Qr*(Yt.y-br.y);if(Vr===0)return!0;if(Vr<0)continue;tr=!tr}}else{if(Yt.y!==br.y)continue;if(Mr.x<=Yt.x&&Yt.x<=br.x||br.x<=Yt.x&&Yt.x<=Mr.x)return!0}}return tr}const ht=tu.isClockWise,_t=this.subPaths;if(_t.length===0)return[];let bt,Pt,Mt;const Lt=[];if(_t.length===1)return Pt=_t[0],Mt=new Pp,Mt.curves=Pt.curves,Lt.push(Mt),Lt;let Nt=!ht(_t[0].getPoints());Nt=tt?!Nt:Nt;const jt=[],Wt=[];let Qt,qt,Xt=[],Zt=0;Wt[Zt]=void 0,Xt[Zt]=[];for(let Yt=0,ar=_t.length;Yt<ar;Yt++)Pt=_t[Yt],Qt=Pt.getPoints(),bt=ht(Qt),bt=tt?!bt:bt,bt?(!Nt&&Wt[Zt]&&Zt++,Wt[Zt]={s:new Pp,p:Qt},Wt[Zt].s.curves=Pt.curves,Nt&&Zt++,Xt[Zt]=[]):Xt[Zt].push({h:Pt,p:Qt[0]});if(!Wt[0])return function(Yt){const ar=[];for(let er=0,tr=Yt.length;er<tr;er++){const Ar=Yt[er],wr=new Pp;wr.curves=Ar.curves,ar.push(wr)}return ar}(_t);if(Wt.length>1){let Yt=!1,ar=0;for(let er=0,tr=Wt.length;er<tr;er++)jt[er]=[];for(let er=0,tr=Wt.length;er<tr;er++){const Ar=Xt[er];for(let wr=0;wr<Ar.length;wr++){const br=Ar[wr];let Mr=!0;for(let Qr=0;Qr<Wt.length;Qr++)lt(br.p,Wt[Qr].p)&&(er!==Qr&&ar++,Mr?(Mr=!1,jt[Qr].push(br)):Yt=!0);Mr&&jt[er].push(br)}}ar>0&&Yt===!1&&(Xt=jt)}for(let Yt=0,ar=Wt.length;Yt<ar;Yt++){Mt=Wt[Yt].s,Lt.push(Mt),qt=Xt[Yt];for(let er=0,tr=qt.length;er<tr;er++)Mt.holes.push(qt[er].h)}return Lt}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:d}})),typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=d)},149:function(h,o,c){c.d(o,{Z:function(){return b}});var d=c(848);const _=new WeakMap;class b extends d.aHM{constructor(nt){super(nt),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(nt){return this.decoderPath=nt,this}setDecoderConfig(nt){return this.decoderConfig=nt,this}setWorkerLimit(nt){return this.workerLimit=nt,this}load(nt,at,ut,pt){const mt=new d.Y9S(this.manager);mt.setPath(this.path),mt.setResponseType("arraybuffer"),mt.setRequestHeader(this.requestHeader),mt.setWithCredentials(this.withCredentials),mt.load(nt,ft=>{this.parse(ft,at,pt)},ut,pt)}parse(nt,at,ut){this.decodeDracoFile(nt,at,null,null,d.er$).catch(ut)}decodeDracoFile(nt,at,ut,pt,mt=d.Zr2){const ft={attributeIDs:ut||this.defaultAttributeIDs,attributeTypes:pt||this.defaultAttributeTypes,useUniqueIDs:!!ut,vertexColorSpace:mt};return this.decodeGeometry(nt,ft).then(at)}decodeGeometry(nt,at){const ut=JSON.stringify(at);if(_.has(nt)){const xt=_.get(nt);if(xt.key===ut)return xt.promise;if(nt.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let pt;const mt=this.workerNextTaskID++,ft=nt.byteLength,vt=this._getWorker(mt,ft).then(xt=>(pt=xt,new Promise((At,Ct)=>{pt._callbacks[mt]={resolve:At,reject:Ct},pt.postMessage({type:"decode",id:mt,taskConfig:at,buffer:nt},[nt])}))).then(xt=>this._createGeometry(xt.geometry));return vt.catch(()=>!0).then(()=>{pt&&mt&&this._releaseTask(pt,mt)}),_.set(nt,{key:ut,promise:vt}),vt}_createGeometry(nt){const at=new d.LoY;nt.index&&at.setIndex(new d.THS(nt.index.array,1));for(let ut=0;ut<nt.attributes.length;ut++){const pt=nt.attributes[ut],mt=pt.name,ft=pt.array,vt=pt.itemSize,xt=new d.THS(ft,vt);mt==="color"&&(this._assignVertexColorSpace(xt,pt.vertexColorSpace),xt.normalized=ft instanceof Float32Array==0),at.setAttribute(mt,xt)}return at}_assignVertexColorSpace(nt,at){if(at!==d.er$)return;const ut=new d.Q1f;for(let pt=0,mt=nt.count;pt<mt;pt++)ut.fromBufferAttribute(nt,pt).convertSRGBToLinear(),nt.setXYZ(pt,ut.r,ut.g,ut.b)}_loadLibrary(nt,at){const ut=new d.Y9S(this.manager);return ut.setPath(this.decoderPath),ut.setResponseType(at),ut.setWithCredentials(this.withCredentials),new Promise((pt,mt)=>{ut.load(nt,pt,void 0,mt)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const nt=typeof WebAssembly!="object"||this.decoderConfig.type==="js",at=[];return nt?at.push(this._loadLibrary("draco_decoder.js","text")):(at.push(this._loadLibrary("draco_wasm_wrapper.js","text")),at.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(at).then(ut=>{const pt=ut[0];nt||(this.decoderConfig.wasmBinary=ut[1]);const mt=_e,ft=["/* draco decoder */",pt,"","/* worker */",mt.substring(mt.indexOf("{")+1,mt.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([ft]))}),this.decoderPending}_getWorker(nt,at){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const pt=new Worker(this.workerSourceURL);pt._callbacks={},pt._taskCosts={},pt._taskLoad=0,pt.postMessage({type:"init",decoderConfig:this.decoderConfig}),pt.onmessage=function(mt){const ft=mt.data;switch(ft.type){case"decode":pt._callbacks[ft.id].resolve(ft);break;case"error":pt._callbacks[ft.id].reject(ft);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+ft.type+'"')}},this.workerPool.push(pt)}else this.workerPool.sort(function(pt,mt){return pt._taskLoad>mt._taskLoad?-1:1});const ut=this.workerPool[this.workerPool.length-1];return ut._taskCosts[nt]=at,ut._taskLoad+=at,ut})}_releaseTask(nt,at){nt._taskLoad-=nt._taskCosts[at],delete nt._callbacks[at],delete nt._taskCosts[at]}debug(){console.log("Task load: ",this.workerPool.map(nt=>nt._taskLoad))}dispose(){for(let nt=0;nt<this.workerPool.length;++nt)this.workerPool[nt].terminate();return this.workerPool.length=0,this.workerSourceURL!==""&&URL.revokeObjectURL(this.workerSourceURL),this}}const _e=`
function DRACOWorker() {

	let decoderConfig;
	let decoderPending;

	onmessage = function ( e ) {

		const message = e.data;

		switch ( message.type ) {

			case 'init':
				decoderConfig = message.decoderConfig;
				decoderPending = new Promise( function ( resolve/*, reject*/ ) {

					decoderConfig.onModuleLoaded = function ( draco ) {

						// Module is Promise-like. Wrap before resolving to avoid loop.
						resolve( { draco: draco } );

					};

					DracoDecoderModule( decoderConfig ); // eslint-disable-line no-undef

				} );
				break;

			case 'decode':
				const buffer = message.buffer;
				const taskConfig = message.taskConfig;
				decoderPending.then( ( module ) => {

					const draco = module.draco;
					const decoder = new draco.Decoder();

					try {

						const geometry = decodeGeometry( draco, decoder, new Int8Array( buffer ), taskConfig );

						const buffers = geometry.attributes.map( ( attr ) => attr.array.buffer );

						if ( geometry.index ) buffers.push( geometry.index.array.buffer );

						self.postMessage( { type: 'decode', id: message.id, geometry }, buffers );

					} catch ( error ) {

						console.error( error );

						self.postMessage( { type: 'error', id: message.id, error: error.message } );

					} finally {

						draco.destroy( decoder );

					}

				} );
				break;

		}

	};

	function decodeGeometry( draco, decoder, array, taskConfig ) {

		const attributeIDs = taskConfig.attributeIDs;
		const attributeTypes = taskConfig.attributeTypes;

		let dracoGeometry;
		let decodingStatus;

		const geometryType = decoder.GetEncodedGeometryType( array );

		if ( geometryType === draco.TRIANGULAR_MESH ) {

			dracoGeometry = new draco.Mesh();
			decodingStatus = decoder.DecodeArrayToMesh( array, array.byteLength, dracoGeometry );

		} else if ( geometryType === draco.POINT_CLOUD ) {

			dracoGeometry = new draco.PointCloud();
			decodingStatus = decoder.DecodeArrayToPointCloud( array, array.byteLength, dracoGeometry );

		} else {

			throw new Error( 'THREE.DRACOLoader: Unexpected geometry type.' );

		}

		if ( ! decodingStatus.ok() || dracoGeometry.ptr === 0 ) {

			throw new Error( 'THREE.DRACOLoader: Decoding failed: ' + decodingStatus.error_msg() );

		}

		const geometry = { index: null, attributes: [] };

		// Gather all vertex attributes.
		for ( const attributeName in attributeIDs ) {

			const attributeType = self[ attributeTypes[ attributeName ] ];

			let attribute;
			let attributeID;

			// A Draco file may be created with default vertex attributes, whose attribute IDs
			// are mapped 1:1 from their semantic name (POSITION, NORMAL, ...). Alternatively,
			// a Draco file may contain a custom set of attributes, identified by known unique
			// IDs. glTF files always do the latter, and .drc files typically do the former.
			if ( taskConfig.useUniqueIDs ) {

				attributeID = attributeIDs[ attributeName ];
				attribute = decoder.GetAttributeByUniqueId( dracoGeometry, attributeID );

			} else {

				attributeID = decoder.GetAttributeId( dracoGeometry, draco[ attributeIDs[ attributeName ] ] );

				if ( attributeID === - 1 ) continue;

				attribute = decoder.GetAttribute( dracoGeometry, attributeID );

			}

			const attributeResult = decodeAttribute( draco, decoder, dracoGeometry, attributeName, attributeType, attribute );

			if ( attributeName === 'color' ) {

				attributeResult.vertexColorSpace = taskConfig.vertexColorSpace;

			}

			geometry.attributes.push( attributeResult );

		}

		// Add index.
		if ( geometryType === draco.TRIANGULAR_MESH ) {

			geometry.index = decodeIndex( draco, decoder, dracoGeometry );

		}

		draco.destroy( dracoGeometry );

		return geometry;

	}

	function decodeIndex( draco, decoder, dracoGeometry ) {

		const numFaces = dracoGeometry.num_faces();
		const numIndices = numFaces * 3;
		const byteLength = numIndices * 4;

		const ptr = draco._malloc( byteLength );
		decoder.GetTrianglesUInt32Array( dracoGeometry, byteLength, ptr );
		const index = new Uint32Array( draco.HEAPF32.buffer, ptr, numIndices ).slice();
		draco._free( ptr );

		return { array: index, itemSize: 1 };

	}

	function decodeAttribute( draco, decoder, dracoGeometry, attributeName, attributeType, attribute ) {

		const numComponents = attribute.num_components();
		const numPoints = dracoGeometry.num_points();
		const numValues = numPoints * numComponents;
		const byteLength = numValues * attributeType.BYTES_PER_ELEMENT;
		const dataType = getDracoDataType( draco, attributeType );

		const ptr = draco._malloc( byteLength );
		decoder.GetAttributeDataArrayForAllPoints( dracoGeometry, attribute, dataType, byteLength, ptr );
		const array = new attributeType( draco.HEAPF32.buffer, ptr, numValues ).slice();
		draco._free( ptr );

		return {
			name: attributeName,
			array: array,
			itemSize: numComponents
		};

	}

	function getDracoDataType( draco, attributeType ) {

		switch ( attributeType ) {

			case Float32Array: return draco.DT_FLOAT32;
			case Int8Array: return draco.DT_INT8;
			case Int16Array: return draco.DT_INT16;
			case Int32Array: return draco.DT_INT32;
			case Uint8Array: return draco.DT_UINT8;
			case Uint16Array: return draco.DT_UINT16;
			case Uint32Array: return draco.DT_UINT32;

		}

	}

}
`}},__webpackgi_module_cache__={},leafPrototypes,getProto,inProgress,dataWebpackPrefix;function __webpackgi_require__(h){var o=__webpackgi_module_cache__[h];if(o!==void 0)return o.exports;var c=__webpackgi_module_cache__[h]={id:h,exports:{}};return __webpackgi_modules__[h].call(c.exports,c,c.exports,__webpackgi_require__),c.exports}__webpackgi_require__.m=__webpackgi_modules__,__webpackgi_require__.n=function(h){var o=h&&h.__esModule?function(){return h.default}:function(){return h};return __webpackgi_require__.d(o,{a:o}),o},getProto=Object.getPrototypeOf?function(h){return Object.getPrototypeOf(h)}:function(h){return h.__proto__},__webpackgi_require__.t=function(h,o){if(1&o&&(h=this(h)),8&o||typeof h=="object"&&h&&(4&o&&h.__esModule||16&o&&typeof h.then=="function"))return h;var c=Object.create(null);__webpackgi_require__.r(c);var d={};leafPrototypes=leafPrototypes||[null,getProto({}),getProto([]),getProto(getProto)];for(var _=2&o&&h;typeof _=="object"&&!~leafPrototypes.indexOf(_);_=getProto(_))Object.getOwnPropertyNames(_).forEach(function(b){d[b]=function(){return h[b]}});return d.default=function(){return h},__webpackgi_require__.d(c,d),c},__webpackgi_require__.d=function(h,o){for(var c in o)__webpackgi_require__.o(o,c)&&!__webpackgi_require__.o(h,c)&&Object.defineProperty(h,c,{enumerable:!0,get:o[c]})},__webpackgi_require__.f={},__webpackgi_require__.e=function(h){return Promise.all(Object.keys(__webpackgi_require__.f).reduce(function(o,c){return __webpackgi_require__.f[c](h,o),o},[]))},__webpackgi_require__.u=function(h){return h+".mjs"},__webpackgi_require__.o=function(h,o){return Object.prototype.hasOwnProperty.call(h,o)},inProgress={},dataWebpackPrefix="webgi:",__webpackgi_require__.l=function(h,o,c,d){if(inProgress[h])inProgress[h].push(o);else{var _,b;if(c!==void 0)for(var _e=document.getElementsByTagName("script"),it=0;it<_e.length;it++){var nt=_e[it];if(nt.getAttribute("src")==h||nt.getAttribute("data-webpack")==dataWebpackPrefix+c){_=nt;break}}_||(b=!0,(_=document.createElement("script")).type="module",_.charset="utf-8",_.timeout=120,__webpackgi_require__.nc&&_.setAttribute("nonce",__webpackgi_require__.nc),_.setAttribute("data-webpack",dataWebpackPrefix+c),_.src=h),inProgress[h]=[o];var at=function(pt,mt){_.onerror=_.onload=null,clearTimeout(ut);var ft=inProgress[h];if(delete inProgress[h],_.parentNode&&_.parentNode.removeChild(_),ft&&ft.forEach(function(vt){return vt(mt)}),pt)return pt(mt)},ut=setTimeout(at.bind(null,void 0,{type:"timeout",target:_}),12e4);_.onerror=at.bind(null,_.onerror),_.onload=at.bind(null,_.onload),b&&document.head.appendChild(_)}},__webpackgi_require__.r=function(h){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(h,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(h,"__esModule",{value:!0})},function(){var h;if(typeof import.meta.url=="string"&&(h=import.meta.url),!h)throw new Error("Automatic publicPath is not supported in this browser");h=h.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),__webpackgi_require__.p=h+"../../"}(),function(){var h={573:0};__webpackgi_require__.f.j=function(d,_){var b=__webpackgi_require__.o(h,d)?h[d]:void 0;if(b!==0)if(b)_.push(b[2]);else{var _e=new Promise(function(at,ut){b=h[d]=[at,ut]});_.push(b[2]=_e);var it=__webpackgi_require__.p+__webpackgi_require__.u(d),nt=new Error;__webpackgi_require__.l(it,function(at){if(__webpackgi_require__.o(h,d)&&((b=h[d])!==0&&(h[d]=void 0),b)){var ut=at&&(at.type==="load"?"missing":at.type),pt=at&&at.target&&at.target.src;nt.message="Loading chunk "+d+` failed.
(`+ut+": "+pt+")",nt.name="ChunkLoadError",nt.type=ut,nt.request=pt,b[1](nt)}},"chunk-"+d,d)}};var o=function(d,_){var b,_e,it=_[0],nt=_[1],at=_[2],ut=0;if(it.some(function(pt){return h[pt]!==0})){for(b in nt)__webpackgi_require__.o(nt,b)&&(__webpackgi_require__.m[b]=nt[b]);at&&at(__webpackgi_require__)}for(d&&d(_);ut<it.length;ut++)_e=it[ut],__webpackgi_require__.o(h,_e)&&h[_e]&&h[_e][0](),h[_e]=0},c=self.webpackChunkwebgi=self.webpackChunkwebgi||[];c.forEach(o.bind(null,0)),c.push=o.bind(null,c.push.bind(c))}(),__webpackgi_require__.nc=void 0;var __webpackgi_exports__={},ViewerState;__webpackgi_require__.d(__webpackgi_exports__,{CZu:function(){return AAssetManagerProcessStatePlugin},FV:function(){return three_module.FV},oK2:function(){return ACameraControlsPlugin},SLH:function(){return ACanvasRecorder},yo9:function(){return ALL_WEBGI_EXTENSIONS},YJd:function(){return AMaterialManager},qnC:function(){return ARPlacementBox},TtJ:function(){return ARPlugin},rUH:function(){return ARTouchInputHelper},oAs:function(){return AShaderMaterial2},$fV:function(){return AViewerPlugin},upe:function(){return AWSClientPlugin},yPJ:function(){return AddBlendPass},gO9:function(){return three_module.gO9},XrR:function(){return three_module.XrR},DAe:function(){return three_module.DAe},EZo:function(){return three_module.EZo},wrO:function(){return three_module.wrO},FFZ:function(){return three_module.FFZ},lGu:function(){return three_module.lGu},sKt:function(){return three_module.sKt},$p8:function(){return three_module.$p8},nJr:function(){return AmbientLight2},pPE:function(){return three_module.pPE},tz3:function(){return three_module.tz3},kEx:function(){return three_module.kEx},Iw4:function(){return three_module.Iw4},P5j:function(){return three_module.P5j},AKb:function(){return three_module.AKb},GXy:function(){return AnisotropyPlugin},ibB:function(){return three_module.ibB},nZQ:function(){return three_module.nZQ},E0M:function(){return three_module.E0M},GLG:function(){return AssetExporter},$VP:function(){return AssetExporterPlugin},NeI:function(){return AssetImporter},rzc:function(){return AssetManagerBasicPopupPlugin},Kiu:function(){return AssetManagerLoadingBarPlugin},XDT:function(){return AssetManagerPlugin},XiN:function(){return AsyncGzip},_I9:function(){return AsyncDecompress},ShE:function(){return AsyncDeflate},OXP:function(){return AsyncGunzip},JZ8:function(){return AsyncGzip},gS4:function(){return AsyncInflate},eFx:function(){return AsyncUnzipInflate},peq:function(){return AsyncUnzlib},hw0:function(){return AsyncZipDeflate},_DG:function(){return AsyncZlib},fP5:function(){return three_module.fP5},CwR:function(){return three_module.CwR},UtX:function(){return three_module.UtX},Pf$:function(){return three_module.Pf$},Am1:function(){return three_module.Am1},IzY:function(){return three_module.IzY},hsX:function(){return three_module.hsX},XFr:function(){return BackgroundPresetGroup},Eh1:function(){return BaseGroundPlugin},RJS:function(){return BaseRenderer},Rkk:function(){return three_module.Rkk},bTm:function(){return three_module.bTm},Otl:function(){return BeringRingAnimation},pOj:function(){return BlobLoader},jg0:function(){return BloomPlugin},$Kf:function(){return three_module.$Kf},YOZ:function(){return three_module.YOZ},UtB:function(){return three_module.UtB},NRn:function(){return three_module.NRn},DYt:function(){return Box3B},BND:function(){return three_module.BND},iNn:function(){return three_module.iNn},IWo:function(){return three_module.IWo},SYd:function(){return BoxSelectionWidget},THS:function(){return three_module.THS},LoY:function(){return three_module.LoY},SUR:function(){return three_module.SUR},tJf:function(){return three_module.tJf},Y3u:function(){return CSGPluginBSP},poD:function(){return CSGPluginBVH},gaG:function(){return CSGPluginBase},z0x:function(){return CSS3DRendererPlugin},l2R:function(){return three_module.l2R},i7d:function(){return three_module.i7d},mL7:function(){return CameraController},WTh:function(){return three_module.WTh},l5h:function(){return CameraUiPlugin},hzv:function(){return CameraView},f_U:function(){return CameraViewControlPlugin},sxt:function(){return CameraViewPlugin},af0:function(){return CannonPhysicsPlugin},Phj:function(){return CanvasMediaRecorder},p5D:function(){return CanvasRecorder},CS6:function(){return CanvasRecorderPlugin},aKT:function(){return CanvasSnipper},RzO:function(){return CanvasSnipperPlugin},GOR:function(){return three_module.GOR},qU7:function(){return three_module.qU7},B6O:function(){return three_module.B6O},z1d:function(){return ChromaticAberrationPlugin},nNL:function(){return three_module.nNL},tcD:function(){return three_module.tcD},ghU:function(){return three_module.ghU},Dk8:function(){return ClearcoatTintPlugin},zD7:function(){return three_module.zD7},Q1f:function(){return three_module.Q1f},T6I:function(){return three_module.T6I},ppV:function(){return three_module.ppV},FvD:function(){return CombinedPostPlugin},n3b:function(){return Gzip},iOZ:function(){return three_module.iOZ},c5h:function(){return three_module.c5h},YSM:function(){return three_module.FvD},YRT:function(){return three_module.YRT},qFE:function(){return three_module.qFE},fCM:function(){return ContactShadowGroundPlugin},afc:function(){return CoreEditorApp},hLJ:function(){return CoreViewerApp},F1T:function(){return three_module.F1T},SXA:function(){return CubeNormalsCaptureHelper},hy7:function(){return three_module.hy7},xFO:function(){return three_module.xFO},b4q:function(){return three_module.b4q},ScU:function(){return three_module.ScU},Om:function(){return three_module.Om},Z0B:function(){return three_module.Z0B},s0K:function(){return three_module.s0K},Pdi:function(){return three_module.Pdi},Vb5:function(){return three_module.Vb5},Jnc:function(){return three_module.Jnc},ywQ:function(){return three_module.ywQ},WNZ:function(){return three_module.WNZ},Ipv:function(){return three_module.Ipv},jGm:function(){return three_module.jGm},Ogy:function(){return CustomAnimationHelper},xLk:function(){return CustomAnimationHelperPlugin},bCz:function(){return three_module.bCz},bGG:function(){return CustomBumpMapPlugin},g7M:function(){return three_module.g7M},Ho_:function(){return three_module.Ho_},hjs:function(){return three_module.hjs},Zn9:function(){return DRACOLoader2.Z},AHf:function(){return k$1},dYF:function(){return three_module.dYF},rFo:function(){return three_module.rFo},GYF:function(){return three_module.GYF},BRH:function(){return three_module.BRH},psi:function(){return DataUrlLoader},GxU:function(){return three_module.GxU},n2t:function(){return DebugPlugin},yuL:function(){return DecodeUTF8},YMq:function(){return Decompress},ROr:function(){return three_module.ROr},fJr:function(){return three_module.fJr},h_9:function(){return three_module.h_9},Gyi:function(){return Deflate},zdS:function(){return three_module.zdS},WCV:function(){return DepthOfFieldPass},_Vf:function(){return DepthOfFieldPlugin},dcC:function(){return three_module.dcC},VCu:function(){return three_module.VCu},n1S:function(){return DeviceOrientationControls2},sOF:function(){return DeviceOrientationControlsPlugin},aFP:function(){return DiamondMaterial},GMU:function(){return DiamondPlugin},ZyN:function(){return three_module.ZyN},rFg:function(){return DirectionalLight2},PFK:function(){return three_module.PFK},Yhb:function(){return three_module.Yhb},V5c:function(){return three_module.V5c},nEu:function(){return three_module.nEu},$EB:function(){return three_module.$EB},mRE:function(){return Dropzone},hSt:function(){return DropzonePlugin},hdd:function(){return three_module.hdd},wn6:function(){return three_module.wn6},MOq:function(){return three_module.MOq},Vnu:function(){return three_module.Vnu},hIf:function(){return three_module.hIf},d5G:function(){return EXRExporter2},vr8:function(){return EXRLoadPlugin},JCs:function(){return EasingFunctions},TDQ:function(){return three_module.TDQ},WYq:function(){return EffectComposer2},S20:function(){return three_module.S20},LWT:function(){return EllipseCurve3D},MJ1:function(){return EncodeUTF8},KDW:function(){return EncoderMethod},SQT:function(){return EnvironmentPresetGroup},kO0:function(){return three_module.kO0},U3G:function(){return three_module.U3G},jsO:function(){return three_module.jsO},wfO:function(){return three_module.wfO},uV5:function(){return three_module.uV5},O9p:function(){return three_module.O9p},Qev:function(){return three_module.Qev},j8I:function(){return ExtrasUiPlugin},QCA:function(){return three_module.QCA},ol2:function(){return FBXLoadPlugin},y74:function(){return FFMPEGRecorder},lT0:function(){return FSShadowMaterial},Y9S:function(){return three_module.Y9S},ryq:function(){return FileTransferPlugin},xcV:function(){return FilmicGrainPlugin},OMG:function(){return FirstPersonControls2},Vkg:function(){return FirstPersonControlsPlugin},Oax:function(){return three_module.Oax},qtW:function(){return three_module.qtW},V58:function(){return three_module.V58},RQf:function(){return three_module.RQf},jUj:function(){return three_module.jUj},cRK:function(){return three_module.cRK},ziY:function(){return FragmentClippingExtensionPlugin},kzd:function(){return FragmentClippingMode},VNy:function(){return FrameFadePlugin},Pem:function(){return three_module.Pem},hB5:function(){return three_module.hB5},PPD:function(){return three_module.PPD},BH6:function(){return FullScreenPlugin},HSI:function(){return GBufferPlugin},oh6:function(){return three_module.oh6},Wyr:function(){return three_module.Wyr},Wdf:function(){return three_module.Wdf},P3V:function(){return GLTFAnimationPlugin},s0N:function(){return GLTFDracoExportPlugin},_Js:function(){return GLTFDracoExporter},xQA:function(){return GLTFExporter2},Yeh:function(){return GLTFExporterMaterialsVariantsExtensionExport},N30:function(){return GLTFKHRMaterialVariantsPlugin},P44:function(){return GLTFLoader2},MdZ:function(){return GLTFMaterialsVariantsExtensionImport},Cc9:function(){return GLTFMeshGpuInstancingExporter},HjZ:function(){return GLTFMeshOptPlugin},UX5:function(){return GLTFSpecGlossinessConverterPlugin},fGP:function(){return GLTFWriter2},T03:function(){return GammaCorrectionExtension},fPK:function(){return GammaCorrectionPlugin},XpU:function(){return GemEnvironmentPresetGroup},hUz:function(){return GenericBlendTexturePass},pbu:function(){return GenericFilterPlugin},jhn:function(){return GeometryGeneratorPlugin},eoi:function(){return three_module.eoi},K52:function(){return three_module.K52},gWB:function(){return three_module.gWB},Gwm:function(){return three_module.Gwm},TMh:function(){return three_module.TMh},RcT:function(){return three_module.RcT},fTw:function(){return three_module.fTw},Hx_:function(){return GroundPlugin},YJl:function(){return three_module.YJl},asK:function(){return Gunzip},_qo:function(){return GyroInputDevice},Ne:function(){return Gzip},Guc:function(){return HDRiGroundPlugin},ix0:function(){return three_module.ix0},dth:function(){return three_module.dth},R1W:function(){return three_module.R1W},tcR:function(){return HierarchyUiPlugin},WBB:function(){return three_module.WBB},Kzg:function(){return three_module.Kzg},$NF:function(){return three_module.$NF},NuM:function(){return ImageSequenceRecorder},HgN:function(){return three_module.HgN},l9C:function(){return Importer},HLH:function(){return three_module.HLH},Ru$:function(){return three_module.Ru$},ELl:function(){return Inflate},uWO:function(){return three_module.uWO},CmU:function(){return three_module.CmU},LuO:function(){return three_module.LuO},ZLX:function(){return three_module.ZLX},Hrb:function(){return three_module.Hrb},vmz:function(){return three_module.vmz},wvS:function(){return three_module.wvS},Yuy:function(){return three_module.Yuy},K5h:function(){return InteractionPromptPlugin},eB$:function(){return three_module.eB$},eHs:function(){return three_module.eHs},lGw:function(){return three_module.lGw},ljd:function(){return three_module.ljd},PJ3:function(){return three_module.PJ3},EQC:function(){return three_module.EQC},oVO:function(){return three_module.oVO},Yj4:function(){return KHR_TEXTURE_BASISU},ZPL:function(){return KTX2LoadPlugin},$16:function(){return KTXLoadPlugin},VVr:function(){return three_module.VVr},UJ6:function(){return three_module.UJ6},UpK:function(){return three_module.UpK},ZYb:function(){return LUTPlugin},nzx:function(){return three_module.nzx},DLJ:function(){return LayeredMaterialPlugin},zgK:function(){return three_module.zgK},vim:function(){return three_module.vim},brA:function(){return three_module.brA},TiK:function(){return three_module.TiK},xSv:function(){return three_module.xSv},CR7:function(){return three_module.CR7},kYr:function(){return three_module.kYr},veJ:function(){return three_module.veJ},FZo:function(){return three_module.FZo},Dvx:function(){return LightsUiPlugin},N1A:function(){return three_module.N1A},XkL:function(){return Line2},cZY:function(){return three_module.cZY},mrM:function(){return three_module.mrM},GZZ:function(){return three_module.GZZ},VnP:function(){return three_module.VnP},Fvt:function(){return three_module.Fvt},vK6:function(){return LineGeometry},FCc:function(){return three_module.FCc},GV4:function(){return LineMaterial},DXC:function(){return three_module.DXC},bFd:function(){return LineSegments2},n31:function(){return LineSegmentsGeometry},qIQ:function(){return three_module.qIQ},tgE:function(){return three_module.tgE},k6q:function(){return three_module.k6q},ezk:function(){return three_module.ezk},NZq:function(){return three_module.NZq},iUH:function(){return three_module.iUH},$_I:function(){return three_module.$_I},kRr:function(){return three_module.kRr},Zr2:function(){return three_module.Zr2},kyO:function(){return three_module.kyO},VxR:function(){return three_module.VxR},aHM:function(){return three_module.aHM},r6x:function(){return three_module.r6x},KPJ:function(){return three_module.KPJ},O0Q:function(){return LoadingScreenPlugin},G3T:function(){return three_module.G3T},lc7:function(){return three_module.lc7},aMy:function(){return three_module.aMy},CMB:function(){return three_module.CMB},Kzv:function(){return three_module.Kzv},kBv:function(){return three_module.kBv},T6P:function(){return MTLLoader2},imn:function(){return three_module.imn},Bhh:function(){return MaterialConfiguratorBasePlugin},q$N:function(){return MaterialConfiguratorPlugin},pzC:function(){return MaterialExtender},xbg:function(){return MaterialLibPresetGroupPresetGroup},LTv:function(){return MaterialLibraryBasePlugin},usO:function(){return MaterialLibraryPlugin},jut:function(){return three_module.jut},Jxy:function(){return MaterialManager},Kmw:function(){return MaterialPresetPlugin$1},jR8:function(){return MaterialPreviewGenerator},cj9:function(){return three_module.cj9},dwI:function(){return three_module.dwI},kn4:function(){return three_module.kn4},$ei:function(){return three_module.$ei},eaF:function(){return three_module.eaF},V9B:function(){return three_module.V9B},NLY:function(){return MeshBasicMaterial2},CSG:function(){return three_module.CSG},aVO:function(){return three_module.aVO},G_z:function(){return three_module.G_z},FNr:function(){return three_module.FNr},qBx:function(){return three_module.qBx},onB:function(){return MeshOptSimplifyModifierPlugin},tXL:function(){return three_module.tXL},uSd:function(){return three_module.uSd},_4j:function(){return three_module._4j},gCR:function(){return MeshStandardMaterial2},Df:function(){return three_module.Df},znC:function(){return three_module.znC},kTW:function(){return three_module.kTW},KRh:function(){return three_module.KRh},$iG:function(){return ModelStagePlugin},eti:function(){return ModelStagePresetGroup},Um5:function(){return MouseInputDevice},tF0:function(){return MultiFilterPlugin},EdD:function(){return three_module.EdD},caT:function(){return three_module.caT},hxR:function(){return three_module.hxR},a$r:function(){return three_module.a$r},$O9:function(){return three_module.$O9},Cfg:function(){return three_module.Cfg},pHI:function(){return three_module.pHI},amv:function(){return three_module.amv},eHc:function(){return three_module.eHc},HPb:function(){return three_module.HPb},XIg:function(){return three_module.XIg},jf0:function(){return three_module.jf0},y_p:function(){return three_module.y_p},dFv:function(){return NoiseBumpMaterialPlugin},Ke9:function(){return three_module.Ke9},NTi:function(){return three_module.NTi},nqf:function(){return NormalBufferPlugin},hws:function(){return NormalCaptureMaterial},jzd:function(){return three_module.jzd},bw0:function(){return three_module.bw0},klZ:function(){return three_module.klZ},Hit:function(){return three_module.Hit},DJz:function(){return OBJLoader2},UwE:function(){return ObjMtlLoadPlugin},B69:function(){return three_module.B69},QA8:function(){return Object3DModel},$xz:function(){return Object3DWidgetsPlugin},XTe:function(){return three_module.XTe},zjB:function(){return ObjectLoader2},sHL:function(){return ObjectPicker},Upe:function(){return ObjectProcessorMap},nEH:function(){return ObjectRotationPlugin},vyJ:function(){return three_module.vyJ},Ufg:function(){return three_module.Ufg},qad:function(){return three_module.qad},Nt7:function(){return three_module.Nt7},aEY:function(){return three_module.aEY},OuU:function(){return three_module.OuU},LiQ:function(){return three_module.LiQ},xYO:function(){return OrbitControls2},c07:function(){return OrbitControls3},qUd:function(){return three_module.qUd},I_i:function(){return OutlinePlugin},wqq:function(){return three_module.wqq},QP0:function(){return three_module.QP0},Wk7:function(){return three_module.Wk7},BdL:function(){return three_module.BdL},Q7O:function(){return PMREMGeneratorPlugin},uxM:function(){return ParallaxCameraControllerPlugin},N9C:function(){return ParallaxMappingPlugin},wAk:function(){return three_module.wAk},ubm:function(){return three_module.ubm},PG6:function(){return PickingPlugin},Zcv:function(){return three_module.Zcv},bdM:function(){return three_module.bdM},ZM4:function(){return three_module.ZM4},_EQ:function(){return PluginPresetGroup},HiM:function(){return three_module.HiM},RXx:function(){return PointLight2},F1l:function(){return three_module.F1l},W_W:function(){return Z$1},FnS:function(){return PointerLockControls2},oPt:function(){return PointerLockControlsPlugin},ONl:function(){return three_module.ONl},BH$:function(){return three_module.BH$},hzE:function(){return three_module.hzE},pFK:function(){return three_module.pFK},j9d:function(){return PopmotionPlugin},DeC:function(){return PosePlugin},xZx:function(){return three_module.xZx},ZaL:function(){return PresetGroup},UwN:function(){return PresetLibraryPlugin},hzf:function(){return ProgressivePlugin},Nwf:function(){return three_module.Nwf},N2s:function(){return three_module.N2s},dAo:function(){return three_module.dAo},CV9:function(){return three_module.CV9},PTz:function(){return three_module.PTz},MBL:function(){return three_module.MBL},GBG:function(){return three_module.GBG},HO_:function(){return three_module.HO_},Kef:function(){return three_module.Kef},sPf:function(){return three_module.sPf},N5j:function(){return three_module.N5j},GWd:function(){return three_module.GWd},c90:function(){return three_module.c90},y3Z:function(){return three_module.y3Z},uB5:function(){return three_module.uB5},lyL:function(){return three_module.lyL},bC7:function(){return three_module.bC7},ojs:function(){return three_module.ojs},S$4:function(){return three_module.S$4},qa3:function(){return three_module.qa3},B_h:function(){return three_module.B_h},czI:function(){return three_module.czI},rSH:function(){return three_module.rSH},Qrf:function(){return three_module.Qrf},psI:function(){return three_module.psI},a5J:function(){return three_module.a5J},_QJ:function(){return three_module._QJ},Fn:function(){return three_module.Fn},KDk:function(){return three_module.KDk},pBf:function(){return three_module.pBf},HXV:function(){return three_module.HXV},Nz6:function(){return three_module.Nz6},jR7:function(){return three_module.jR7},BXX:function(){return three_module.BXX},DAr:function(){return three_module.DAr},uC4:function(){return RGBM16ColorSpace_},H23:function(){return three_module.H23},W9U:function(){return three_module.W9U},CVz:function(){return three_module.CVz},Riy:function(){return three_module.Riy},kTp:function(){return three_module.kTp},k6Q:function(){return three_module.k6Q},IE4:function(){return three_module.IE4},paN:function(){return three_module.paN},TkQ:function(){return three_module.TkQ},qa1:function(){return RainbowDiamondPlugin},EZL:function(){return RandomizedDirectionalLight},fMJ:function(){return RandomizedDirectionalLightPlugin},D$Q:function(){return three_module.D$Q},RlV:function(){return three_module.RlV},tBo:function(){return three_module.tBo},z5:function(){return three_module.z5},ure:function(){return three_module.ure},VT0:function(){return three_module.VT0},ZQM:function(){return three_module.ZQM},TyI:function(){return Reflector2},Mjd:function(){return three_module.Mjd},O0B:function(){return three_module.O0B},FZz:function(){return RendererUiPlugin},GJx:function(){return three_module.GJx},kG0:function(){return three_module.kG0},nST:function(){return three_module.nST},AUf:function(){return Rhino3dmLoadPlugin},oXQ:function(){return Rhino3dmLoader2},rKP:function(){return three_module.rKP},vMJ:function(){return RootScene},CWW:function(){return three_module.CWW},XG_:function(){return three_module.XG_},er$:function(){return three_module.er$},KLL:function(){return three_module.KLL},ye:function(){return SSAOPlugin},czS:function(){return SSBevelPass},UG9:function(){return SSBevelPlugin},aJo:function(){return SSContactShadows},uC9:function(){return SSGIPlugin},k9M:function(){return SSRPlugin},fRH:function(){return STLLoadPlugin},Z58:function(){return three_module.Z58},_I4:function(){return SceneCamerasUiPlugin},Sr:function(){return SceneLoopPlugin},zx2:function(){return ScrollableCameraViewPlugin},r1V:function(){return ScrollableCameraViewPreviewPlugin},tI0:function(){return SelectionWidget},vxI:function(){return three_module.vxI},zkh:function(){return three_module.zkh},BKk:function(){return three_module.BKk},rNP:function(){return ShaderMaterial2},DkA:function(){return ShaderMaterialEncodingSupport},rpH:function(){return ShaderPass2},Q4F:function(){return ShadowMapBaker},q2:function(){return three_module.q2},ypk:function(){return three_module.ypk},MSw:function(){return three_module.MSw},Ld9:function(){return three_module.Ld9},YOp:function(){return ShapeTubeExtrudePlugin},xJ6:function(){return three_module.xJ6},fBL:function(){return three_module.fBL},XTN:function(){return SimpleAssetList},ZXl:function(){return SimpleBackgroundEnvUiPlugin},O9e:function(){return SimpleDataSource},ILd:function(){return I$2},SQN:function(){return SimpleJSONExporter},GDD:function(){return SimpleJSONLoader},HVh:function(){return SimpleTextExporter},X46:function(){return SimpleTextPlugin},hdr:function(){return SimpleViewerUi},CSJ:function(){return SimplifyModifierPlugin},EAD:function(){return three_module.EAD},_xc:function(){return three_module._xc},I46:function(){return three_module.I46},CSm:function(){return SnowFallPlugin},kLi:function(){return three_module.kLi},iyt:function(){return three_module.iyt},Gu$:function(){return three_module.Gu$},s6s:function(){return SphereSelectionWidget},YHV:function(){return three_module.YHV},xOk:function(){return three_module.xOk},xfg:function(){return three_module.xfg},nCl:function(){return three_module.nCl},Hs2:function(){return SpotLight2},Fpm:function(){return three_module.Fpm},kxk:function(){return three_module.kxk},RoJ:function(){return three_module.RoJ},ie2:function(){return three_module.ie2},hgQ:function(){return three_module.hgQ},f4X:function(){return three_module.f4X},Hrq:function(){return three_module.Hrq},agE:function(){return three_module.agE},uXQ:function(){return three_module.uXQ},keZ:function(){return three_module.keZ},rOG:function(){return three_module.rOG},Ktl:function(){return three_module.Ktl},uov:function(){return three_module.uov},hZF:function(){return three_module.hZF},FXf:function(){return three_module.FXf},Kwu:function(){return three_module.Kwu},hv1:function(){return SwitchNodeBasePlugin},AqU:function(){return SwitchNodePlugin},wtR:function(){return three_module.wtR},cGs:function(){return R$2},bI3:function(){return three_module.bI3},afA:function(){return TemporalAAPlugin},Zpd:function(){return three_module.Zpd},gO_:function(){return TextSVGOptions},gPd:function(){return three_module.gPd},Tap:function(){return three_module.Tap},k4W:function(){return ThinFilmLayerPlugin},ndu:function(){return ThreeMaterialLoader},el_:function(){return TonemapPlugin},O3Y:function(){return three_module.O3Y},UPV:function(){return three_module.UPV},iu6:function(){return TrackballControlsPlugin},Ijk:function(){return TransformAnimationPlugin},ZU6:function(){return TransformControls},XXP:function(){return TransformControls2},RQH:function(){return TransformControlsGizmo},tUF:function(){return TransformControlsPlane},Tww:function(){return TransfrSharePlugin},lMl:function(){return three_module.lMl},rYR:function(){return three_module.rYR},O49:function(){return three_module.O49},RJ4:function(){return three_module.RJ4},CXS:function(){return TriplanarUVMappingPlugin},j6:function(){return three_module.j6},G8g:function(){return TubeShapeGeometry},SOP:function(){return TweakpaneUiPlugin},e2_:function(){return TweakpaneWrapper},GTy:function(){return three_module.GTy},cOZ:function(){return UChartOptions},XxD:function(){return UPackOptions},UTZ:function(){return three_module.UTZ},A$4:function(){return three_module.A$4},MW4:function(){return three_module.MW4},baL:function(){return three_module.baL},fc6:function(){return three_module.fc6},t7h:function(){return Uncharted2Tonemapping},nc$:function(){return three_module.nc$},dzP:function(){return three_module.dzP},fCn:function(){return three_module.fCn},LlO:function(){return three_module.LlO},OUM:function(){return three_module.OUM},V3x:function(){return three_module.V3x},bkx:function(){return three_module.bkx},Wew:function(){return three_module.Wew},gJ2:function(){return three_module.gJ2},cHt:function(){return three_module.cHt},HJp:function(){return Unzip},mMi:function(){return UnzipInflate},XLH:function(){return UnzipPassThrough},TWi:function(){return Unzlib},DcJ:function(){return VJSONPresetGroup},Kmx:function(){return VRPluginBasic},RyA:function(){return three_module.RyA},NPD:function(){return VariationConfiguratorEditorUiPlugin},Gpr:function(){return VariationConfiguratorGridUiPlugin},mKI:function(){return VariationConfiguratorPlugin},I9Y:function(){return three_module.I9Y},Pq0:function(){return three_module.Pq0},IUQ:function(){return three_module.IUQ},RiT:function(){return three_module.RiT},Xkr:function(){return VelocityBufferPlugin},Nv2:function(){return three_module.Nv2},EW5:function(){return ViewerApp},oJ0:function(){return ViewerState},Q1b:function(){return VignettePlugin},jK_:function(){return VirtualCamerasPlugin},gTm:function(){return WaveGroundPlugin},S3G:function(){return three_module.S3G},ALV:function(){return three_module.ALV},y9J:function(){return three_module.y9J},TdN:function(){return three_module.TdN},o6l:function(){return three_module.o6l},AT1:function(){return three_module.AT1},nWS:function(){return three_module.nWS},JeP:function(){return three_module.JeP},hfX:function(){return three_module.hfX},i7u:function(){return three_module.i7u},b5D:function(){return WebGiViewerElement},Z1R:function(){return WindowiseDialogPlugin},pWZ:function(){return Wireframe},XJ7:function(){return three_module.XJ7},r3D:function(){return WireframeGeometry2},dhZ:function(){return three_module.dhZ},$Tl:function(){return XAtlasPlugin},rQf:function(){return three_module.rQf},ojh:function(){return three_module.ojh},h2z:function(){return three_module.h2z},kqe:function(){return three_module.kqe},qQr:function(){return Zip},D8L:function(){return ZipDeflate},p9O:function(){return ZipLoader},uZB:function(){return ZipPassThrough},KK:function(){return Zlib},Ua6:function(){return three_module.Ua6},TYE:function(){return et},rQr:function(){return addBasePlugins},$00:function(){return addBloomData},ued:function(){return addDracoLoader},p$A:function(){return addEditorPlugins},m2A:function(){return addGLTFExporter},MqB:function(){return addGLTFLoader},Dv6:function(){return addLUTData},f9i:function(){return addRGBELoader},qHA:function(){return addSSBevel},sQz:function(){return Pe$1},G52:function(){return Te$1},EP1:function(){return afterMain},v5N:function(){return afterRead},SET:function(){return afterWrite},g7h:function(){return angle},i0Z:function(){return animate},GcL:function(){return animateAsync},z67:function(){return animateObject},im4:function(){return animateSet},$bx:function(){return animateTarget$1},btx:function(){return anticipate$1},M7c:function(){return applyOffset},ZMO:function(){return modifiers_applyStyles},YiG:function(){return ie$1},UE8:function(){return modifiers_arrow},uHr:function(){return attract},YYK:function(){return attractExpo},qZL:function(){return auto$1},XMb:function(){return autoCenterObject3D},utC:function(){return autoGPUInstanceMeshes},uO_:function(){return autoScaleObject3D},dgX:function(){return backIn$1},ZZ5:function(){return backInOut$1},Szj:function(){return backOut$1},Ms4:function(){return re$1},OMj:function(){return basePlacements},D7g:function(){return basicMaterialPropList},LG_:function(){return beforeMain},cis:function(){return beforeRead},pAB:function(){return beforeWrite},y80:function(){return q$2},sQg:function(){return bottom},ipZ:function(){return bounceIn},wmn:function(){return bounceInOut},Tel:function(){return bounceOut},Q5:function(){return buildCSGMeshBSP},b1j:function(){return buildCSGMeshBVH},wzf:function(){return cLinearToRGBM},Cq_:function(){return cRGBMToLinear},poN:function(){return circIn$1},tnX:function(){return circInOut$1},yT:function(){return circOut$1},qE8:function(){return clamp$1},WYS:function(){return clippingParents},Cp1:function(){return be$1},mz1:function(){return combineDofShader},Bc:function(){return gzip},oSR:function(){return gzipSync},KJu:function(){return computeAverageGeometryNormal},G1I:function(){return computeEigenVectors},dXm:function(){return computeGeometryCenter},lRj:function(){return computeGeometrySize},WL9:function(){return computeMikkTSpaceTangents},OkM:function(){return computeMorphedAttributes},kRU:function(){return computeOffsetMatrix},Xpo:function(){return computeScreenSpaceBoundingBox},KCp:function(){return modifiers_computeStyles},a17:function(){return copyMaterialUserData},prl:function(){return copyObject3DUserData},ij0:function(){return xe$1},MjE:function(){return copyTextureUserData},bhJ:function(){return createAnticipate},nMR:function(){return createAttractor},p4x:function(){return createBackIn},lPF:function(){return three_module.lPF},SwP:function(){return ee$1},U2C:function(){return createExpoIn},FOd:function(){return createGenericExtensionClass},WOM:function(){return createIFrameCSS3DObject},mFw:function(){return T$2},n4h:function(){return popper_createPopper},eRo:function(){return createPopper},LsR:function(){return popper_lite_createPopper},tJ:function(){return createRenderTargetKey},bES:function(){return te$1},rU:function(){return P$2},omb:function(){return csgOperations},AHW:function(){return $},AKs:function(){return cubicBezier$1},VxZ:function(){return dataTextureFromColor},GRd:function(){return dataTextureFromVec4},TVt:function(){return decay},mFv:function(){return decompress},RqU:function(){return decompressSync},UKN:function(){return Se$1},mmZ:function(){return deepCloneAttribute},Ikv:function(){return defaultPresets},Kcl:function(){return deflate},pdh:function(){return deflateSync},tRv:function(){return degreesToRadians},nNY:function(){return deinterleaveAttribute},LK7:function(){return deinterleaveGeometry},$q:function(){return deserializeObject},vem:function(){return deserializers},__B:function(){return detectOverflow},BF2:function(){return diamondMaterialPropList},IoC:function(){return distance$1},WNF:function(){return N$2},PE3:function(){return me$1},a6C:function(){return easeIn$1},am_:function(){return easeInOut$1},vTE:function(){return easeOut$1},VAT:function(){return Ze$1},_N2:function(){return end},oib:function(){return envMapBackground},NtM:function(){return F$1},ru_:function(){return estimateBytesUsed},GcD:function(){return eventListeners},pJG:function(){return extractAnimationKey},vxL:function(){return flattenUiConfig},UUz:function(){return modifiers_flip},mlk:function(){return fontFormatExtensionMap},SVi:function(){return generateUiConfig},QXJ:function(){return generateUiFolder},D01:function(){return Me$1},$7C:function(){return le$1},cdn:function(){return Ue$1},vGk:function(){return Re$1},GPz:function(){return Ee$1},NxN:function(){return H$2},o7j:function(){return getTexelDecoding},yqR:function(){return getTexelDecodingFunction},U_j:function(){return getTextureDataType},mB_:function(){return se$1},d6c:function(){return rt},zhG:function(){return glbEncryptionPreparser},HJb:function(){return fe$1},e5R:function(){return gltfExporterMaterialsVariantsExtensionExport},kdR:function(){return gunzip},D85:function(){return gunzipSync},ZIX:function(){return gzip},u3y:function(){return gzipSync},jDu:function(){return modifiers_hide},qyt:function(){return de$1},Dtr:function(){return Qe$1},WKP:function(){return je$1},fJV:function(){return z$2},tC7:function(){return iGeometryIgnoredUserData},Uan:function(){return iMaterialIgnoredUserData},Uct:function(){return iModelIgnoredUserData},K_U:function(){return iTextureIgnoredUserData},BFA:function(){return Ne$1},BHX:function(){return We$1},Pee:function(){return V$2},$If:function(){return He$1},RFY:function(){return Ce$1},Buv:function(){return inertia$1},UDz:function(){return inflate},HMP:function(){return inflateSync},Zg4:function(){return interleaveAttributes},GWP:function(){return interpolate$1},r58:function(){return isAnimatableType},fTC:function(){return isPoint},YWz:function(){return isPoint3D},eAs:function(){return W$2},i7C:function(){return keyframes$1},jFo:function(){return khrMaterialsVariantsGLTF},kbd:function(){return left},nU8:function(){return lerpAngle},NFx:function(){return lerpAngle2},sns:function(){return linear},S2G:function(){return he$1},iW4:function(){return main$1},Se$:function(){return Je$1},Sop:function(){return Ge$1},HNH:function(){return makeFilter},jGz:function(){return makeSamplerUi},ll7:function(){return makeSetterFor},SrG:function(){return Xe$1},UGD:function(){return matDefine},KVf:function(){return mergeAttributes},gDN:function(){return mergeBufferAttributes},h0o:function(){return mergeBufferGeometries},pPQ:function(){return mergeGeometries},hLo:function(){return mergeGroups},ecu:function(){return mergeVertices},mhB:function(){return mirrorEasing$1},jhA:function(){return mix$1},iou:function(){return mixColor$1},JL8:function(){return mixComplex$1},G8Z:function(){return we$1},GMB:function(){return modifierPhases},tB5:function(){return g},GnX:function(){return v$3},cYW:function(){return modifiers_offset},k9K:function(){return x$1},CTC:function(){return ze$1},JW6:function(){return Ae$1},p7C:function(){return ae$1},OId:function(){return patchShaderEncodingSupport},CN_:function(){return ot},uaX:function(){return physicalMaterialPropList},FsL:function(){return pipe$1},gtD:function(){return pivotToBBoxCenter},wbL:function(){return pivotToPoint},DDu:function(){return enums_placements},O$W:function(){return pointFromVector},xfb:function(){return popper},UD3:function(){return popperGenerator},ZoD:function(){return modifiers_popperOffsets},hQ_:function(){return pe$1},V7C:function(){return modifiers_preventOverflow},Sow:function(){return processViewer},qB0:function(){return progress$1},nv6:function(){return radiansToDegrees},LF4:function(){return enums_read},TAg:function(){return Fe$1},irg:function(){return reference},Ei4:function(){return ct},Grb:function(){return removeDuplicateGeometries},yhl:function(){return f$1},Gmo:function(){return reverseEasing$1},pGT:function(){return right},Gsh:function(){return rotateDuplicatedMesh},S2Q:function(){return three_module.S2Q},pUp:function(){return S$2},sU3:function(){return serializable},lKg:function(){return serialize},gwL:function(){return serializeObject},EBS:function(){return serializeTextureInExtras},YCG:function(){return serializers},gC:function(){return setMeshGeometry},R5k:function(){return setMeshMaterial},zB$:function(){return setThreeRendererMode},dGw:function(){return st},tNl:function(){return setupCoreWebGiViewer},AAd:function(){return setupIModel},YFt:function(){return setupModesStyles},IRk:function(){return setupModesUi},ZVX:function(){return setupObject3dModel},cTN:function(){return setupSandboxWebGiEditor},PlU:function(){return shaderReplaceString},Mi5:function(){return sign2},nuN:function(){return slerp},Jp2:function(){return smooth},oDA:function(){return smoothFrame},n$K:function(){return snap},w4b:function(){return snapObject},JVv:function(){return sphericalFromObject},ozl:function(){return spring$1},asH:function(){return standardMaterialPropList},niF:function(){return start},CiD:function(){return steps_steps},heq:function(){return strFromU8},_uk:function(){return strToU8},xrZ:function(){return supportsRequestStreams},aUi:function(){return L$2},Tmf:function(){return J$1},AYr:function(){return B$2},SVO:function(){return texImageToCanvas},mBH:function(){return textureDataToImageData},z73:function(){return textureToCanvas},cyN:function(){return textureToDataUrl},wRz:function(){return X$2},pbX:function(){return toCreasedNormals},nIf:function(){return toDecimal},RY5:function(){return toIndexedGeometry},SnO:function(){return oe$1},_cJ:function(){return toTrianglesDrawMode},Mny:function(){return enums_top},X0G:function(){return uiButton},mBY:function(){return uiColor},rpQ:function(){return uiConfig},exO:function(){return uiDropdown},rsv:function(){return uiFolder},gpt:function(){return uiImage},hEL:function(){return uiInput},LIx:function(){return uiMonitor},Z5F:function(){return uiPanel},Eiw:function(){return uiSlider},Jx6:function(){return uiToggle},q00:function(){return uiVector},PiW:function(){return uniform},$15:function(){return unzip},AOo:function(){return unzipSync},VTi:function(){return unzlib},a8Y:function(){return unzlibSync},QMY:function(){return ge$1},d5o:function(){return vLinearToRGBM},Fxe:function(){return vRGBMToLinear},Nan:function(){return valueToUiType},Ols:function(){return variationPlacements},Ovn:function(){return velocityPerFrame},fjO:function(){return velocityPerSecond$1},pZl:function(){return Be$1},R9T:function(){return viewport},LV7:function(){return wrap},M98:function(){return write},_h9:function(){return $e$1},yU6:function(){return zip},LaF:function(){return zipSync},w58:function(){return zlib},$ax:function(){return zlibSync}}),function(h){h[h.Error=-2]="Error",h[h.Destroyed=-1]="Destroyed",h[h.None=0]="None",h[h.Running=1]="Running",h[h.Paused=2]="Paused"}(ViewerState||(ViewerState={}));let I$2=class{constructor(){this._eventListeners={},this.dispatchEvent=this.dispatchEvent.bind(this),this.addEventListener=this.addEventListener.bind(this),this.removeEventListener=this.removeEventListener.bind(this),this.hasEventListener=this.hasEventListener.bind(this)}addEventListener(h,o){const c=this._eventListeners;c[h]===void 0&&(c[h]=[]),c[h].includes(o)||c[h].push(o)}hasEventListener(h,o){const c=this._eventListeners;return c[h]!==void 0&&c[h].includes(o)}removeEventListener(h,o){const c=this._eventListeners[h];if(c!==void 0){const d=c.indexOf(o);d!==-1&&c.splice(d,1)}}dispatchEvent(h){const o=this._eventListeners[h.type];if(o!==void 0){h.target=this;const c=o.slice(0);for(let d=0,_=c.length;d<_;d++)c[d].call(this,h)}}};async function X$2(h){return new Promise(o=>setTimeout(o,Math.max(0,h)))}function g(){return(typeof performance>"u"?Date:performance).now()}let Z$1=class extends I$2{constructor(){super(...arguments),this._onPointerDown=h=>{if(h.button!==0||!this._element)return;this._pointerUp=void 0;const o=h.clientX/this._element.clientWidth*2-1,c=-h.clientY/this._element.clientHeight*2+1,d=g();this._pointerDown={x:o,y:c,time:d},this._pointer=this._pointerDown,this.dispatchEvent({type:"dragStart",pointer:this._pointerDown})},this._onPointerMove=h=>{if(!this._pointerDown||!this._pointer||!this._element)return;const o=h.clientX/this._element.clientWidth*2-1,c=-h.clientY/this._element.clientHeight*2+1,d=g();this.dispatchEvent({type:"drag",pointer:this._pointer,drag:{x:o-this._pointerDown.x,y:c-this._pointerDown.y,time:d-this._pointerDown.time},delta:{x:o-this._pointer.x,y:c-this._pointer.y,time:d-this._pointer.time}}),this._pointer={x:o,y:c,time:g()},h.buttons%2==0&&this._onPointerUp(h)},this._onPointerUp=h=>{if(h.button!==0||!this._pointerDown||!this._element)return;const o=h.clientX/this._element.clientWidth*2-1,c=-h.clientY/this._element.clientHeight*2+1,d=g();this._pointerUp={x:o,y:c,time:d},this.dispatchEvent({type:"dragEnd",pointer:this._pointerUp,drag:{x:this._pointerUp.x-this._pointerDown.x,y:this._pointerUp.y-this._pointerDown.y,time:this._pointerUp.time-this._pointerDown.time}}),this._pointerDown=void 0,this._pointer=void 0}}get element(){return this._element}set element(h){this._element!==h&&(this._element&&this._removeElement(),this._element=h,this._element&&this._addElement())}_removeElement(){var h,o,c,d,_;(h=this._element)==null||h.removeEventListener("pointerdown",this._onPointerDown),(o=this._element)==null||o.removeEventListener("pointermove",this._onPointerMove),(c=this._element)==null||c.removeEventListener("pointerup",this._onPointerUp),(d=this._element)==null||d.removeEventListener("pointercancel",this._onPointerUp),(_=this._element)==null||_.removeEventListener("pointerout",this._onPointerUp)}_addElement(){var h,o,c,d,_;(h=this._element)==null||h.addEventListener("pointerdown",this._onPointerDown),(o=this._element)==null||o.addEventListener("pointermove",this._onPointerMove),(c=this._element)==null||c.addEventListener("pointerup",this._onPointerUp),(d=this._element)==null||d.addEventListener("pointercancel",this._onPointerUp),(_=this._element)==null||_.addEventListener("pointerout",this._onPointerUp)}dispose(){this.element=void 0}},Q$2=class{constructor(h){this.options={limit:500,debug:!1,bindHotKeys:!1},this.enabled=!0,this.presets={},this._keyDown=o=>{if(!this.enabled)return;const c=o.ctrlKey||o.metaKey;o.code==="KeyZ"&&c&&!o.shiftKey?this.undo():(o.code==="KeyZ"&&c&&o.shiftKey||o.code==="KeyY"&&o.ctrlKey)&&this.redo()},Object.assign(this.options,h),this.limit=h.limit,this.options=h,this.reset(),h.bindHotKeys&&this.bindHotKeys(),this.log(`Initialized with stack limit of ${this.limit} commands`)}bindHotKeys(){return this.log("Bound 'undo' and 'redo' actions to 'Ctrl/Cmd+Z', 'Ctrl+Y' & 'Ctrl/Cmd+Shift+Z' hot keys"),(this.options.hotKeyRoot??document).addEventListener("keydown",this._keyDown),this}dispose(){return(this.options.hotKeyRoot??document).removeEventListener("keydown",this._keyDown),this.reset()}record(h){return this.enabled?(this._record(h),this):this}replaceLast(h){const o=this.peek();if(o)return this.log("replace",o,"with",h),this.stack[this.sp]=h,this}execute(h){if(!this.enabled)return;let o=this._rc(h),c=o.redo;return this.record.apply(this,o),this.log("Executing function..."),c.apply(h),this}_rc(h){if(h.type){const o=this.presets[h.type];if(typeof o=="function")return o(h);throw console.error(h,o,this.presets),new Error("Preset command not found")}return h}_record(h){this.enabled&&(this.log("Recording command",h),this._rebase(),this.stack.push(h),this.sp++,this._keepLimit())}_rebase(){this.canRedo()&&(this.stack.length=this.sp+1)}_keepLimit(){if(this.stack.length<=this.limit)return;let h=this.stack.length-this.limit;this.log("Stack size reached its limit: ${this.limit} commands. Cutting off most old commands..."),h===1?this.stack.shift():this.stack.splice(0,h),this.sp-=h}undo(){if(!this.canUndo())return this;let h=this.stack[this.sp];return this.log("undo"),this.sp--,this._rc(h).undo(),this}canUndo(){return this.sp>=0&&this.enabled}peek(){return this.canUndo()?this.stack[this.sp]:null}redo(){if(!this.canRedo())return this;let h=this.stack[this.sp+1];return this.log("redo"),this.sp++,this._rc(h).redo(),this}canRedo(){return this.sp<this.stack.length-1&&this.enabled}peekForward(){return this.canRedo()?this.stack[this.sp+1]:null}setLimit(h){let o=this.stack.length-this.sp-1;if(h<1||typeof h!="number")throw new TypeError(`JSUndoManager.setLimit(): unexpected argument limit=${h}. Should be a positive number`);return h<o?console.warn(`JSUndoManager.setLimit(): cannot set stack limit (${h}) less than the number of 'redoable' commands (${o})`):(this.limit=Math.floor(h),this._keepLimit()),this}reset(){return this.log("reset"),this.stack=[],this.sp=-1,this}isEmpty(){return!this.stack.length}isFull(){return this.stack.length===this.limit}getSize(){return this.stack.length}log(h,...o){this.options.debug&&console.log(`Command Manager: ${h}`,...o)}};const p$3=class Dy{constructor(o=Dy.DECAY_MILLISECONDS){this.velocity=0,this.naturalFrequency=0,this.setDecayTime(o)}setDecayTime(o){this.naturalFrequency=1/Math.max(Dy.MIN_DECAY_MILLISECONDS,o)}update(o,c,d,_){const b=2e-4*this.naturalFrequency;if(o==null||_===0||o===c&&this.velocity===0)return c;if(d<0)return o;const _e=o-c,it=this.velocity+this.naturalFrequency*_e,nt=_e+d*it,at=Math.exp(-this.naturalFrequency*d),ut=(it-this.naturalFrequency*nt)*at,pt=-this.naturalFrequency*(ut+it*at);return Math.abs(ut)<b*Math.abs(_)&&pt*_e>=0?(this.velocity=0,c):(this.velocity=ut,c+nt*at)}};p$3.SETTLING_TIME=1e4,p$3.MIN_DECAY_MILLISECONDS=.001,p$3.DECAY_MILLISECONDS=50;let k$1=p$3;function j(){const h=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");return h.style.display="block",h}function ee$1({innerHTML:h="",id:o,classList:c,addToBody:d=!0,elementTag:_="div"}){const b=document.createElement(_);return o&&(b.id=o),b.innerHTML=h,c&&b.classList.add(...c),d&&document.body.appendChild(b),b}async function T$2(h){return new Promise((o,c)=>{const d=new Image;d.onload=()=>o(d),d.onerror=c,d.crossOrigin="anonymous",d.decoding="sync",d.src=h})}function P$2(h,o=document.head){const c=document.createElement("style");return c.type="text/css",c.innerText=h,o==null||o.appendChild(c),c}async function te$1(h,o=document.head){return new Promise((c,d)=>{const _=document.createElement("script");_.setAttribute("src",h),_.addEventListener("load",()=>c(_)),_.addEventListener("error",d),o.appendChild(_)})}function ie$1(h){if(!window)return console.warn("window is required"),"";let o="";const c=new Uint8Array(h),d=c.byteLength;for(let _=0;_<d;_++)o+=String.fromCharCode(c[_]);return window.btoa(o)}function re$1(h){if(!window)return console.warn("window is required"),new Uint8Array(0);const o=window.atob(h),c=o.length,d=new Uint8Array(c);for(let _=0;_<c;_++)d[_]=o.charCodeAt(_);return d.buffer}const R$2={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function se$1(h,o){return new R$2[h](o)}function oe$1(h){return h.replace(/\w\S*/g,function(o){return o.charAt(0).toUpperCase()+o.substr(1).toLowerCase()})}function ae$1(h){if(!h||h===""||h.match(/__MACOSX\/.*\._/))return"";const o=(h=h.replace(/\?.*$/,"")).split(/[\\/]/).pop()??"",c=o.lastIndexOf(".");return o===""||c<1?"":o.slice(c+1)}function le$1(h){return h.substring(h.lastIndexOf("/")+1)}function F$1(h){return h.replace(/([.*+?^=!:${}()|[\]/\\])/g,"\\$1")}function f$1(h,o,c){return h.replace(new RegExp(F$1(o),"g"),c)}function he$1(h){return h.sort(),h[0].split("").map((o,c)=>h[h.length-1][c]===o?o:"\0").join("").split("\0").at(0)||""}const fe$1=(h,...o)=>String.raw({raw:h},...o),$=(h,...o)=>String.raw({raw:h},...o),de$1=(h,...o)=>String.raw({raw:h},...o),B$2=(h,...o)=>{let c=String.raw({raw:h},...o);return c=f$1(c,"%","%25"),c=f$1(c,"> <","><"),c=f$1(c,"; }",";}"),c=f$1(c,"<","%3c"),c=f$1(c,">","%3e"),c=f$1(c,'"',"'"),c=f$1(c,"#","%23"),c=f$1(c,"{","%7b"),c=f$1(c,"}","%7d"),c=f$1(c,"|","%7c"),c=f$1(c,"^","%5e"),c=f$1(c,"`","%60"),c=f$1(c,"@","%40"),c=f$1(c,"&","&amp;"),c=f$1(c,`
`,"%0A"),"data:image/svg+xml;charset=UTF-8,"+c};function pe$1(h=document.head){return P$2($`
      ::-webkit-scrollbar
      {
        width: 8px;  /* for vertical scrollbars */
        height: 8px; /* for horizontal scrollbars */
      }
      ::-webkit-scrollbar-track
      {
        background: rgba(64, 64, 64, 0.4);
        border-radius: 6px;
      }
      ::-webkit-scrollbar-thumb
      {
        background: rgba(128, 128, 128, 0.2);
        border-radius: 6px;
      }
      ::-webkit-scrollbar-corner {background: rgba(0,0,0,0.5);}
    `,h)}function N$2(h,o){const c=window.URL.createObjectURL(h),d=document.createElement("a");d.style.display="none",d.href=c,d.download=o,document.body.appendChild(d),d.click(),setTimeout(()=>{document.body.removeChild(d),window.URL.revokeObjectURL(c)},1e3)}async function q$2(h){return new Promise((o,c)=>{const d=new FileReader;d.onload=_=>o(d.result),d.onerror=_=>c(d.error),d.onabort=_=>c(new Error("Read aborted")),d.readAsDataURL(h)})}function me$1(h,o){return N$2(h,o??h.name)}async function ge$1(h=!1,o=!1,c){const d=document.createElement("input");d.type="file",d.multiple=h,d.accept=c||"*",d.webkitdirectory=o,d.style.display="none",document.body.appendChild(d),d.click();const _=await new Promise(b=>{d.onchange=_e=>{b(Array.from(d.files||[]))}});return document.body.removeChild(d),_}function we$1(){let h=!1;return function(o){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(o)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(o.substr(0,4)))&&(h=!0)}(navigator.userAgent||navigator.vendor||window.opera),h}function ve$1(h){return h<.0031308?12.92*h:1.055*Math.pow(h,.41666)-.055}function be$1(h,o=1,c=1){const d=document.createElement("canvas");d.width=o,d.height=c;const _=d.getContext("2d");_.fillStyle="#"+h,_.fillRect(0,0,o,c);const b=d.toDataURL();return d.remove(),b}function H$2(h,o){let c;do c=Object.getOwnPropertyDescriptor(h,o);while(!c&&(h=Object.getPrototypeOf(h)));return c}function W$2(h,o,c=!0,d=!1){const _=H$2(h,o);return!(_==null||!_.set)||c&&(_==null?void 0:_.writable)!==!1&&(_==null?void 0:_.get)===void 0||d&&!_}function S$2(h,o,c,d=!0,_=!1){return!(!h||!W$2(h,o,d,_)||(h[o]=c,0))}function Ee$1(h,...o){return typeof h=="function"&&(h=h(...o)),h}function xe$1(h,o,c){for(const d of c){const _=h[d];_!==void 0&&S$2(o,d,_,!0)}return o}function Ce$1(h,o){for(const c of o)if(!h.includes(c))return!1;return!0}function Se$1(h,o,c=!1){for(typeof h=="string"&&(h=h.split("."));h.length>0;){if(!o)return o;const d=h.splice(0,1)[0];if(!(d.length<1))if(Array.isArray(o))o=o[parseInt(d)];else{if(typeof o!="object"||!(d in o)){if(c)throw new Error("invalid access, check "+d+" in "+o);return}o=o[d]}}return o}function Ue$1(h,o){return Object.keys(h).find(c=>h[c]===o)}function v$3(h,o){return Object.hasOwn?Object.hasOwn(h,o):h.hasOwnProperty(o)}const m$2=class A0{static callFunction(o,c,d=[]){if(!c)return o(...d);if(o.name&&c[o.name]===o)return o.call(c,...d);A0.methodMap.has(c)||A0.methodMap.set(c,new WeakMap);const _=A0.methodMap.get(c);if(!_.has(o)){let b=c;for(;b;){const _e=Object.values(Object.getOwnPropertyDescriptors(b));for(let it of _e)if(it.value===o)return _.set(o,!0),o.call(c,...d);b=Object.getPrototypeOf(b)}_.set(o,!1)}return _.get(o)?o.call(c,...d):o(...d)}};m$2.methodMap=new WeakMap;let E$2=m$2;function x$1(h,o="param"){if(!h)throw new Error("onChange: fnKey is undefined, make sure the function exists or provide a string");return(c,d,_)=>{const b={get(){return this[`_oc_${d}`]},set(_e){var it;const nt=this[`_oc_${d}`];if(nt===_e)return;this[`_oc_${d}`]=_e;const at=o==="param"?[d,_e,nt,this]:o==="object"?[{key:d,value:_e,oldValue:nt,target:this}]:[];typeof h=="string"?(it=this[h])==null||it.call(this,...at):typeof h=="function"&&E$2.callFunction(h,this,at)}};if(_)return v$3(_,"value")&&delete _.value,v$3(_,"writable")&&delete _.writable,v$3(_,"initializer")&&delete _.initializer,Object.assign(_,b);Object.defineProperty(c,d,b)}}function ze$1(h,o="void"){if(!h)throw new Error("onChange: fnKey is undefined, make sure the function exists or provide a string");return x$1(h,o)}function Ae$1(h,o="object"){if(!h)throw new Error("onChange: fnKey is undefined, make sure the function exists or provide a string");return x$1(h,o)}async function Te$1(h,o,c){const d=typeof o=="string"?new TextEncoder().encode(o):o,_=await crypto.subtle.digest("SHA-256",d),b=crypto.getRandomValues(new Uint8Array(12)),_e=Array.from(b).map(At=>String.fromCharCode(At)).join(""),it={name:"AES-GCM",iv:b},nt=await crypto.subtle.importKey("raw",_,it,!1,["encrypt"]),at=typeof h=="string"?new TextEncoder().encode(h):h,ut=await crypto.subtle.encrypt(it,nt,at),pt=new Uint8Array(ut),mt=Array.from(pt),ft=mt.map(At=>String.fromCharCode(At)).join(""),vt=c?typeof c=="string"?c:new TextDecoder().decode(c):"",xt=c?typeof c=="string"?new TextEncoder().encode(c):Array.from(c):[];return typeof h=="string"?vt+_e+ft:new Uint8Array([...xt,...b,...mt])}async function Pe$1(h,o){const c=typeof o=="string"?new TextEncoder().encode(o):o,d=await crypto.subtle.digest("SHA-256",c),_=h.slice(0,12),b={name:"AES-GCM",iv:typeof _=="string"?new Uint8Array(Array.from(_).map(at=>at.charCodeAt(0))):_},_e=await crypto.subtle.importKey("raw",d,b,!1,["decrypt"]),it=h.slice(12),nt=typeof it=="string"?new Uint8Array(Array.from(it).map(at=>at.charCodeAt(0))):it;try{const at=await crypto.subtle.decrypt(b,_e,nt);return typeof h=="string"?new TextDecoder().decode(at):new Uint8Array(at)}catch{throw new Error("Decrypt failed")}}async function Me$1(){return"showOpenFilePicker"in window?window.showOpenFilePicker().then(h=>h[0]):window.chooseFileSystemEntries()}function Re$1(){if("showSaveFilePicker"in window){const h={types:[{description:"Text file",accept:{"text/plain":[".txt"]}}]};return window.showSaveFilePicker(h)}return window.chooseFileSystemEntries({type:"save-file",accepts:[{description:"Text file",extensions:["txt"],mimeTypes:["text/plain"]}]})}function Fe$1(h){return h.text?h.text():K$2(h)}function K$2(h){return new Promise(o=>{const c=new FileReader;c.addEventListener("loadend",d=>{const _=(d.srcElement||d.target).result;o(_)}),c.readAsText(h)})}async function $e$1(h,o){if(h.createWriter){const d=await h.createWriter();return await d.write(0,o),void await d.close()}const c=await h.createWritable();await c.write(o),await c.close()}async function Be$1(h,o){const c={};return o&&(c.writable=!0,c.mode="readwrite"),await h.queryPermission(c)==="granted"||await h.requestPermission(c)==="granted"}function U$2(h,o=8192,c=!1){var d;if(!h.width||!h.height)throw new Error("Invalid bitmap");const _=document.createElement("canvas");_.width=Math.min(o,h.width),_.height=Math.floor(1+_.width*h.height/h.width);const b=h instanceof ImageBitmap,_e=b&&c&&Math.abs(_.width-h.width)<.5?_.getContext("bitmaprenderer"):void 0;return _e?_e.transferFromImageBitmap(h):(d=_.getContext("2d"))==null||d.drawImage(h,0,0,_.width,_.height),b&&c&&h.close(),_}function Ne$1(h,o=8192,c=!1,d="image/png"){if(!h.width||!h.height)return"";const _=U$2(h,o,!1),b=_.toDataURL(d);return _.remove(),c&&h instanceof ImageBitmap&&h.close(),b}async function He$1(h){return new Promise((o,c)=>{const d=new Image;d.addEventListener("load",()=>{const _=document.createElement("canvas");_.width=d.width,_.height=d.height;const b=_.getContext("2d");if(!b)return void c(new Error("Could not get 2d context"));b.drawImage(d,0,0,_.width,_.height);const _e=b.getImageData(0,0,_.width,_.height);o(_e),_.remove(),d.remove()},!1),d.addEventListener("error",_=>{d.remove(),c(_)},!1),d.src=h})}function V$2(h,{backgroundColor:o="",scale:c=1,width:d=512,height:_=512}){const b=document.createElement("canvas"),_e=b.getContext("2d"),it=c,nt=d,at=_;return b.width=nt*it,b.height=at*it,b.style.width=`${nt}`,b.style.height=`${at}`,(o==null?void 0:o.length)>0&&(_e.fillStyle=o,_e.fillRect(0,0,b.width,b.height)),_e.drawImage(h,0,0,b.width,b.height),b}function We$1(h){const o=document.createElement("canvas");return o.width=h.width,o.height=h.height,o.getContext("2d").putImageData(h,0,0),o}function Ke$1(h){const o=document.createElement("canvas");o.width=h.width,o.height=h.height;const c=o.getContext("2d");if(!c)throw new Error("Unable to get 2d context");return c.translate(0,h.height),c.scale(1,-1),c.drawImage(h,0,0),o}const Je$1=h=>`data:image/svg+xml,%3Csvg width='16' height='16' viewBox='0 0 16 16' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Crect width='16' height='16' fill='%23${h}'/%3E%3C/svg%3E%0A`,Ge$1=h=>`data:image/svg+xml,%3Csvg width='16' height='16' viewBox='0 0 16 16' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Ccircle cx='8' cy='8' r='7' fill='%23${h}'/%3E%3C/svg%3E%0A`,Xe$1=h=>`data:image/svg+xml,%3Csvg viewBox='0 0 80 14' xmlns='http://www.w3.org/2000/svg'%3E%3Ctext style='font: 8px "Roboto Mono", "Source Code Pro", Menlo, Courier, monospace; fill: white;' x='9' y='9'%3E${h}%3C/text%3E%3C/svg%3E%0A`,L$2=async(h,o)=>V$2(await T$2(h),o),J$1=async(h,o)=>await L$2(h,o).then(c=>c.toDataURL("image/png")),G$2=async h=>q$2(await(await fetch(h)).blob());async function Ze$1(h,o=G$2){const c=h.match(/(((ftp|https?):\/\/)[\-\w@:%_\+.~#?,&\/\/=]+)/g);if(c)for(const d of c){const _=await o(d);h=h.replace(d,_)}return h}function z$2(h,o,{width:c,height:d},_=!0){const b=`
<svg viewBox="0 0 ${c} ${d}" xmlns="http://www.w3.org/2000/svg">
    <style>
    ${o}
    </style>
    <foreignObject x="0" y="0" width="100%" height="100%">
        <div xmlns="http://www.w3.org/1999/xhtml" style="height: 100%; width: 100%; position: absolute: top:0; left:0">
            ${h}
        </div>
    </foreignObject>
</svg>
    `;return _?B$2(b):b}async function Qe$1(h,o,c){const d=z$2(h,o,c);return await L$2(d,c)}async function je$1(h,o,c){const d=z$2(h,o,c);return await J$1(d,c)}function et(h,o){return Math.abs(h)>Math.abs(o)?h:o}function rt(h,o=null){return new URL(window.location.href).searchParams.get(h)??o}function st(h,o,c=!1){const d=new URLSearchParams(location.search);o==null?d.has(h)&&d.delete(h):d.set(h,o),c?window.location.search=d.toString():window.history.replaceState({},"","?"+d.toString())}function ot(h,o="/"){return h.join(o)}function ct(h,o){const c=(o?`var Module = { locateFile: function(s) { return "${o}"; } }; 
`:"")+`importScripts( "${h}" );`;return URL.createObjectURL(new Blob([c],{type:"text/javascript"}))}var three_module=__webpackgi_require__(848);const CopyShader={name:"CopyShader",uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform float opacity;

		uniform sampler2D tDiffuse;

		varying vec2 vUv;

		void main() {

			vec4 texel = texture2D( tDiffuse, vUv );
			gl_FragColor = opacity * texel;


		}`};class Pass{constructor(){this.isPass=!0,this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}setSize(){}render(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}dispose(){}}const _camera=new three_module.qUd(-1,1,1,-1,0,1),_geometry=new three_module.LoY;_geometry.setAttribute("position",new three_module.qtW([-1,3,0,-1,-1,0,3,-1,0],3)),_geometry.setAttribute("uv",new three_module.qtW([0,2,0,0,2,0],2));class FullScreenQuad{constructor(o){this._mesh=new three_module.eaF(_geometry,o)}dispose(){this._mesh.geometry.dispose()}render(o){o.render(this._mesh,_camera)}get material(){return this._mesh.material}set material(o){this._mesh.material=o}}class ShaderPass extends Pass{constructor(o,c){super(),this.textureID=c!==void 0?c:"tDiffuse",o instanceof three_module.BKk?(this.uniforms=o.uniforms,this.material=o):o&&(this.uniforms=three_module.LlO.clone(o.uniforms),this.material=new three_module.BKk({name:o.name!==void 0?o.name:"unspecified",defines:Object.assign({},o.defines),uniforms:this.uniforms,vertexShader:o.vertexShader,fragmentShader:o.fragmentShader})),this.fsQuad=new FullScreenQuad(this.material),this.useExistingRenderTarget=!1}render(o,c,d){this.uniforms[this.textureID]&&d&&(this.uniforms[this.textureID].value=d.texture),this.fsQuad.material=this.material,this.renderToScreen?(o.setRenderTarget(null),this.fsQuad.render(o)):(this.useExistingRenderTarget||o.setRenderTarget(c||null),this.clear&&o.clear(o.autoClearColor,o.autoClearDepth,o.autoClearStencil),this.fsQuad.render(o))}dispose(){this.material.dispose(),this.fsQuad.dispose()}}class MaskPass extends Pass{constructor(o,c){super(),this.scene=o,this.camera=c,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(o,c,d){const _=o.getContext(),b=o.state;let _e,it;b.buffers.color.setMask(!1),b.buffers.depth.setMask(!1),b.buffers.color.setLocked(!0),b.buffers.depth.setLocked(!0),this.inverse?(_e=0,it=1):(_e=1,it=0),b.buffers.stencil.setTest(!0),b.buffers.stencil.setOp(_.REPLACE,_.REPLACE,_.REPLACE),b.buffers.stencil.setFunc(_.ALWAYS,_e,4294967295),b.buffers.stencil.setClear(it),b.buffers.stencil.setLocked(!0),o.setRenderTarget(d),this.clear&&o.clear(),o.render(this.scene,this.camera),o.setRenderTarget(c),this.clear&&o.clear(),o.render(this.scene,this.camera),b.buffers.color.setLocked(!1),b.buffers.depth.setLocked(!1),b.buffers.color.setMask(!0),b.buffers.depth.setMask(!0),b.buffers.stencil.setLocked(!1),b.buffers.stencil.setFunc(_.EQUAL,1,4294967295),b.buffers.stencil.setOp(_.KEEP,_.KEEP,_.KEEP),b.buffers.stencil.setLocked(!0)}}class ClearMaskPass extends Pass{constructor(){super(),this.needsSwap=!1}render(o){o.state.buffers.stencil.setLocked(!1),o.state.buffers.stencil.setTest(!1)}}class EffectComposer{constructor(o,c){if(this.renderer=o,this._pixelRatio=o.getPixelRatio(),c===void 0){const d=o.getSize(new three_module.I9Y);this._width=d.width,this._height=d.height,(c=new three_module.nWS(this._width*this._pixelRatio,this._height*this._pixelRatio,{type:three_module.ix0})).texture.name="EffectComposer.rt1"}else this._width=c.width,this._height=c.height;this.renderTarget1=c,this.renderTarget2=c.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],this.copyPass=new ShaderPass(CopyShader),this.copyPass.material.blending=three_module.XIg,this.clock=new three_module.zD7}swapBuffers(){const o=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=o}addPass(o){this.passes.push(o),o.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(o,c){this.passes.splice(c,0,o),o.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(o){const c=this.passes.indexOf(o);c!==-1&&this.passes.splice(c,1)}isLastEnabledPass(o){for(let c=o+1;c<this.passes.length;c++)if(this.passes[c].enabled)return!1;return!0}render(o){o===void 0&&(o=this.clock.getDelta());const c=this.renderer.getRenderTarget();let d=!1;for(let _=0,b=this.passes.length;_<b;_++){const _e=this.passes[_];if(_e.enabled!==!1){if(_e.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(_),_e.render(this.renderer,this.writeBuffer,this.readBuffer,o,d),_e.needsSwap){if(d){const it=this.renderer.getContext(),nt=this.renderer.state.buffers.stencil;nt.setFunc(it.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,o),nt.setFunc(it.EQUAL,1,4294967295)}this.swapBuffers()}MaskPass!==void 0&&(_e instanceof MaskPass?d=!0:_e instanceof ClearMaskPass&&(d=!1))}}this.renderer.setRenderTarget(c)}reset(o){if(o===void 0){const c=this.renderer.getSize(new three_module.I9Y);this._pixelRatio=this.renderer.getPixelRatio(),this._width=c.width,this._height=c.height,(o=this.renderTarget1.clone()).setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=o,this.renderTarget2=o.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(o,c){this._width=o,this._height=c;const d=this._width*this._pixelRatio,_=this._height*this._pixelRatio;this.renderTarget1.setSize(d,_),this.renderTarget2.setSize(d,_);for(let b=0;b<this.passes.length;b++)this.passes[b].setSize(d,_)}setPixelRatio(o){this._pixelRatio=o,this.setSize(this._width,this._height)}dispose(){this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.copyPass.dispose()}}class EffectComposer2 extends EffectComposer{constructor(o,c){super(o,c)}setPixelRatio(o,c=!0){const d=this.setSize;c||(this.setSize=()=>{}),super.setPixelRatio(o),c||(this.setSize=d)}}class Box3B extends three_module.NRn{expandByObject(o,c=!1,d=!1,_){var b;if(((b=o.userData)===null||b===void 0?void 0:b.bboxVisible)===!1)return this;if(!o.visible&&d)return this;if(_&&_(o))return this;if(o.updateWorldMatrix(!1,!1),o.boundingBox!==void 0)o.boundingBox===null&&o.computeBoundingBox(),_box.copy(o.boundingBox),_box.applyMatrix4(o.matrixWorld),this.union(_box);else{const it=o.geometry;if(it!==void 0)if(c&&it.attributes!=null&&it.attributes.position!==void 0){const nt=it.attributes.position;for(let at=0,ut=nt.count;at<ut;at++)_vector.fromBufferAttribute(nt,at).applyMatrix4(o.matrixWorld),this.expandByPoint(_vector)}else it.boundingBox===null&&it.computeBoundingBox(),_box.copy(it.boundingBox),_box.applyMatrix4(o.matrixWorld),this.union(_box)}const _e=o.children;for(let it=0,nt=_e.length;it<nt;it++)this.expandByObject(_e[it],c,d,_);return this}expandByObjects(o,c=!1,d=!1,_){for(let b=0,_e=o.length;b<_e;b++)this.expandByObject(o[b],c,d,_);return this}getPoints(){return[new three_module.Pq0(this.min.x,this.min.y,this.min.z),new three_module.Pq0(this.min.x,this.min.y,this.max.z),new three_module.Pq0(this.min.x,this.max.y,this.min.z),new three_module.Pq0(this.min.x,this.max.y,this.max.z),new three_module.Pq0(this.max.x,this.min.y,this.min.z),new three_module.Pq0(this.max.x,this.min.y,this.max.z),new three_module.Pq0(this.max.x,this.max.y,this.min.z),new three_module.Pq0(this.max.x,this.max.y,this.max.z)]}getScreenSpaceBounds(o){const c=this.getPoints(),d=new three_module.UtB;for(const _ of c){const b=_.project(o);d.min.min(b),d.max.max(b)}return d}}const _box=new Box3B,_vector=new three_module.Pq0;function computeMikkTSpaceTangents(h,o,c=!0){if(!o||!o.isReady)throw new Error("BufferGeometryUtils: Initialized MikkTSpace library required.");if(!h.hasAttribute("position")||!h.hasAttribute("normal")||!h.hasAttribute("uv"))throw new Error('BufferGeometryUtils: Tangents require "position", "normal", and "uv" attributes.');function d(_e){if(_e.normalized||_e.isInterleavedBufferAttribute){const it=new Float32Array(_e.count*_e.itemSize);for(let nt=0,at=0;nt<_e.count;nt++)it[at++]=_e.getX(nt),it[at++]=_e.getY(nt),_e.itemSize>2&&(it[at++]=_e.getZ(nt));return it}return _e.array instanceof Float32Array?_e.array:new Float32Array(_e.array)}const _=h.index?h.toNonIndexed():h,b=o.generateTangents(d(_.attributes.position),d(_.attributes.normal),d(_.attributes.uv));if(c)for(let _e=3;_e<b.length;_e+=4)b[_e]*=-1;return _.setAttribute("tangent",new three_module.THS(b,4)),h!==_&&h.copy(_),h}function mergeGeometries(h,o=!1){const c=h[0].index!==null,d=new Set(Object.keys(h[0].attributes)),_=new Set(Object.keys(h[0].morphAttributes)),b={},_e={},it=h[0].morphTargetsRelative,nt=new three_module.LoY;let at=0;for(let ut=0;ut<h.length;++ut){const pt=h[ut];let mt=0;if(c!==(pt.index!==null))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+ut+". All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them."),null;for(const ft in pt.attributes){if(!d.has(ft))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+ut+'. All geometries must have compatible attributes; make sure "'+ft+'" attribute exists among all geometries, or in none of them.'),null;b[ft]===void 0&&(b[ft]=[]),b[ft].push(pt.attributes[ft]),mt++}if(mt!==d.size)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+ut+". Make sure all geometries have the same number of attributes."),null;if(it!==pt.morphTargetsRelative)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+ut+". .morphTargetsRelative must be consistent throughout all geometries."),null;for(const ft in pt.morphAttributes){if(!_.has(ft))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+ut+".  .morphAttributes must be consistent throughout all geometries."),null;_e[ft]===void 0&&(_e[ft]=[]),_e[ft].push(pt.morphAttributes[ft])}if(o){let ft;if(c)ft=pt.index.count;else{if(pt.attributes.position===void 0)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+ut+". The geometry must have either an index or a position attribute"),null;ft=pt.attributes.position.count}nt.addGroup(at,ft,ut),at+=ft}}if(c){let ut=0;const pt=[];for(let mt=0;mt<h.length;++mt){const ft=h[mt].index;for(let vt=0;vt<ft.count;++vt)pt.push(ft.getX(vt)+ut);ut+=h[mt].attributes.position.count}nt.setIndex(pt)}for(const ut in b){const pt=mergeAttributes(b[ut]);if(!pt)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed while trying to merge the "+ut+" attribute."),null;nt.setAttribute(ut,pt)}for(const ut in _e){const pt=_e[ut][0].length;if(pt===0)break;nt.morphAttributes=nt.morphAttributes||{},nt.morphAttributes[ut]=[];for(let mt=0;mt<pt;++mt){const ft=[];for(let xt=0;xt<_e[ut].length;++xt)ft.push(_e[ut][xt][mt]);const vt=mergeAttributes(ft);if(!vt)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed while trying to merge the "+ut+" morphAttribute."),null;nt.morphAttributes[ut].push(vt)}}return nt}function mergeAttributes(h){let o,c,d,_=-1,b=0;for(let at=0;at<h.length;++at){const ut=h[at];if(ut.isInterleavedBufferAttribute)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. InterleavedBufferAttributes are not supported."),null;if(o===void 0&&(o=ut.array.constructor),o!==ut.array.constructor)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.array must be of consistent array types across matching attributes."),null;if(c===void 0&&(c=ut.itemSize),c!==ut.itemSize)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.itemSize must be consistent across matching attributes."),null;if(d===void 0&&(d=ut.normalized),d!==ut.normalized)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.normalized must be consistent across matching attributes."),null;if(_===-1&&(_=ut.gpuType),_!==ut.gpuType)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.gpuType must be consistent across matching attributes."),null;b+=ut.array.length}const _e=new o(b);let it=0;for(let at=0;at<h.length;++at)_e.set(h[at].array,it),it+=h[at].array.length;const nt=new three_module.THS(_e,c,d);return _!==void 0&&(nt.gpuType=_),nt}function deepCloneAttribute(h){return h.isInstancedInterleavedBufferAttribute||h.isInterleavedBufferAttribute?deinterleaveAttribute(h):h.isInstancedBufferAttribute?new three_module.uWO().copy(h):new three_module.THS().copy(h)}function interleaveAttributes(h){let o,c=0,d=0;for(let at=0,ut=h.length;at<ut;++at){const pt=h[at];if(o===void 0&&(o=pt.array.constructor),o!==pt.array.constructor)return console.error("AttributeBuffers of different types cannot be interleaved"),null;c+=pt.array.length,d+=pt.itemSize}const _=new three_module.eB$(new o(c),d);let b=0;const _e=[],it=["getX","getY","getZ","getW"],nt=["setX","setY","setZ","setW"];for(let at=0,ut=h.length;at<ut;at++){const pt=h[at],mt=pt.itemSize,ft=pt.count,vt=new three_module.eHs(_,mt,b,pt.normalized);_e.push(vt),b+=mt;for(let xt=0;xt<ft;xt++)for(let At=0;At<mt;At++)vt[nt[At]](xt,pt[it[At]](xt))}return _e}function deinterleaveAttribute(h){const o=h.data.array.constructor,c=h.count,d=h.itemSize,_=h.normalized,b=new o(c*d);let _e;_e=h.isInstancedInterleavedBufferAttribute?new three_module.uWO(b,d,_,h.meshPerAttribute):new three_module.THS(b,d,_);for(let it=0;it<c;it++)_e.setX(it,h.getX(it)),d>=2&&_e.setY(it,h.getY(it)),d>=3&&_e.setZ(it,h.getZ(it)),d>=4&&_e.setW(it,h.getW(it));return _e}function deinterleaveGeometry(h){const o=h.attributes,c=h.morphTargets,d=new Map;for(const _ in o){const b=o[_];b.isInterleavedBufferAttribute&&(d.has(b)||d.set(b,deinterleaveAttribute(b)),o[_]=d.get(b))}for(const _ in c){const b=c[_];b.isInterleavedBufferAttribute&&(d.has(b)||d.set(b,deinterleaveAttribute(b)),c[_]=d.get(b))}}function estimateBytesUsed(h){let o=0;for(const d in h.attributes){const _=h.getAttribute(d);o+=_.count*_.itemSize*_.array.BYTES_PER_ELEMENT}const c=h.getIndex();return o+=c?c.count*c.itemSize*c.array.BYTES_PER_ELEMENT:0,o}function mergeVertices(h,o=1e-4){const c=o>0;o=Math.max(o,Number.EPSILON);const d={},_=h.getIndex(),b=h.getAttribute("position"),_e=_?_.count:b.count;let it=0;const nt=Object.keys(h.attributes),at={},ut={},pt=[],mt=["getX","getY","getZ","getW"],ft=["setX","setY","setZ","setW"];for(let Tt=0,kt=nt.length;Tt<kt;Tt++){const Dt=nt[Tt],zt=h.attributes[Dt];at[Dt]=new three_module.THS(new zt.array.constructor(zt.count*zt.itemSize),zt.itemSize,zt.normalized);const Bt=h.morphAttributes[Dt];Bt&&(ut[Dt]=new three_module.THS(new Bt.array.constructor(Bt.count*Bt.itemSize),Bt.itemSize,Bt.normalized))}const vt=.5*o,xt=Math.log10(1/o),At=Math.pow(10,xt),Ct=vt*At;for(let Tt=0;Tt<_e;Tt++){const kt=_?_.getX(Tt):Tt;let Dt="";for(let zt=0,Bt=nt.length;zt<Bt&&c;zt++){const Rt=nt[zt],Ut=h.getAttribute(Rt),Ht=Ut.itemSize;for(let Jt=0;Jt<Ht;Jt++)Dt+=~~(Ut[mt[Jt]](kt)*At+Ct)+","}if(c&&Dt in d)pt.push(d[Dt]);else{for(let zt=0,Bt=nt.length;zt<Bt;zt++){const Rt=nt[zt],Ut=h.getAttribute(Rt),Ht=h.morphAttributes[Rt],Jt=Ut.itemSize,Kt=at[Rt],sr=ut[Rt];for(let ir=0;ir<Jt;ir++){const cr=mt[ir],lr=ft[ir];if(Kt[lr](it,Ut[cr](kt)),Ht)for(let hr=0,dr=Ht.length;hr<dr;hr++)sr[hr][lr](it,Ht[hr][cr](kt))}}c&&(d[Dt]=it),pt.push(it),it++}}const Et=h.clone();for(const Tt in h.attributes){const kt=at[Tt];if(Et.setAttribute(Tt,new three_module.THS(kt.array.slice(0,it*kt.itemSize),kt.itemSize,kt.normalized)),Tt in ut)for(let Dt=0;Dt<ut[Tt].length;Dt++){const zt=ut[Tt][Dt];Et.morphAttributes[Tt][Dt]=new three_module.THS(zt.array.slice(0,it*zt.itemSize),zt.itemSize,zt.normalized)}}return Et.setIndex(pt),Et}function toTrianglesDrawMode(h,o){if(o===three_module.RJ4)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),h;if(o===three_module.rYR||o===three_module.O49){let c=h.getIndex();if(c===null){const _e=[],it=h.getAttribute("position");if(it===void 0)return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),h;for(let nt=0;nt<it.count;nt++)_e.push(nt);h.setIndex(_e),c=h.getIndex()}const d=c.count-2,_=[];if(o===three_module.rYR)for(let _e=1;_e<=d;_e++)_.push(c.getX(0)),_.push(c.getX(_e)),_.push(c.getX(_e+1));else for(let _e=0;_e<d;_e++)_e%2==0?(_.push(c.getX(_e)),_.push(c.getX(_e+1)),_.push(c.getX(_e+2))):(_.push(c.getX(_e+2)),_.push(c.getX(_e+1)),_.push(c.getX(_e)));_.length/3!==d&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const b=h.clone();return b.setIndex(_),b.clearGroups(),b}return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",o),h}function computeMorphedAttributes(h){const o=new three_module.Pq0,c=new three_module.Pq0,d=new three_module.Pq0,_=new three_module.Pq0,b=new three_module.Pq0,_e=new three_module.Pq0,it=new three_module.Pq0,nt=new three_module.Pq0,at=new three_module.Pq0;function ut(hr,dr,pr,ur,xr,vr,Dr,_r){o.fromBufferAttribute(dr,xr),c.fromBufferAttribute(dr,vr),d.fromBufferAttribute(dr,Dr);const rr=hr.morphTargetInfluences;if(pr&&rr){it.set(0,0,0),nt.set(0,0,0),at.set(0,0,0);for(let mr=0,Rr=pr.length;mr<Rr;mr++){const Yr=rr[mr],Zr=pr[mr];Yr!==0&&(_.fromBufferAttribute(Zr,xr),b.fromBufferAttribute(Zr,vr),_e.fromBufferAttribute(Zr,Dr),ur?(it.addScaledVector(_,Yr),nt.addScaledVector(b,Yr),at.addScaledVector(_e,Yr)):(it.addScaledVector(_.sub(o),Yr),nt.addScaledVector(b.sub(c),Yr),at.addScaledVector(_e.sub(d),Yr)))}o.add(it),c.add(nt),d.add(at)}hr.isSkinnedMesh&&(hr.applyBoneTransform(xr,o),hr.applyBoneTransform(vr,c),hr.applyBoneTransform(Dr,d)),_r[3*xr+0]=o.x,_r[3*xr+1]=o.y,_r[3*xr+2]=o.z,_r[3*vr+0]=c.x,_r[3*vr+1]=c.y,_r[3*vr+2]=c.z,_r[3*Dr+0]=d.x,_r[3*Dr+1]=d.y,_r[3*Dr+2]=d.z}const pt=h.geometry,mt=h.material;let ft,vt,xt;const At=pt.index,Ct=pt.attributes.position,Et=pt.morphAttributes.position,Tt=pt.morphTargetsRelative,kt=pt.attributes.normal,Dt=pt.morphAttributes.position,zt=pt.groups,Bt=pt.drawRange;let Rt,Ut,Ht,Jt,Kt,sr,ir;const cr=new Float32Array(Ct.count*Ct.itemSize),lr=new Float32Array(kt.count*kt.itemSize);if(At!==null)if(Array.isArray(mt))for(Rt=0,Ht=zt.length;Rt<Ht;Rt++)for(Kt=zt[Rt],sr=Math.max(Kt.start,Bt.start),ir=Math.min(Kt.start+Kt.count,Bt.start+Bt.count),Ut=sr,Jt=ir;Ut<Jt;Ut+=3)ft=At.getX(Ut),vt=At.getX(Ut+1),xt=At.getX(Ut+2),ut(h,Ct,Et,Tt,ft,vt,xt,cr),ut(h,kt,Dt,Tt,ft,vt,xt,lr);else for(sr=Math.max(0,Bt.start),ir=Math.min(At.count,Bt.start+Bt.count),Rt=sr,Ht=ir;Rt<Ht;Rt+=3)ft=At.getX(Rt),vt=At.getX(Rt+1),xt=At.getX(Rt+2),ut(h,Ct,Et,Tt,ft,vt,xt,cr),ut(h,kt,Dt,Tt,ft,vt,xt,lr);else if(Array.isArray(mt))for(Rt=0,Ht=zt.length;Rt<Ht;Rt++)for(Kt=zt[Rt],sr=Math.max(Kt.start,Bt.start),ir=Math.min(Kt.start+Kt.count,Bt.start+Bt.count),Ut=sr,Jt=ir;Ut<Jt;Ut+=3)ft=Ut,vt=Ut+1,xt=Ut+2,ut(h,Ct,Et,Tt,ft,vt,xt,cr),ut(h,kt,Dt,Tt,ft,vt,xt,lr);else for(sr=Math.max(0,Bt.start),ir=Math.min(Ct.count,Bt.start+Bt.count),Rt=sr,Ht=ir;Rt<Ht;Rt+=3)ft=Rt,vt=Rt+1,xt=Rt+2,ut(h,Ct,Et,Tt,ft,vt,xt,cr),ut(h,kt,Dt,Tt,ft,vt,xt,lr);return{positionAttribute:Ct,normalAttribute:kt,morphedPositionAttribute:new three_module.qtW(cr,3),morphedNormalAttribute:new three_module.qtW(lr,3)}}function mergeGroups(h){if(h.groups.length===0)return console.warn("THREE.BufferGeometryUtils.mergeGroups(): No groups are defined. Nothing to merge."),h;let o=h.groups;if(o=o.sort((_e,it)=>_e.materialIndex!==it.materialIndex?_e.materialIndex-it.materialIndex:_e.start-it.start),h.getIndex()===null){const _e=h.getAttribute("position"),it=[];for(let nt=0;nt<_e.count;nt+=3)it.push(nt,nt+1,nt+2);h.setIndex(it)}const c=h.getIndex(),d=[];for(let _e=0;_e<o.length;_e++){const it=o[_e],nt=it.start,at=nt+it.count;for(let ut=nt;ut<at;ut++)d.push(c.getX(ut))}h.dispose(),h.setIndex(d);let _=0;for(let _e=0;_e<o.length;_e++){const it=o[_e];it.start=_,_+=it.count}let b=o[0];h.groups=[b];for(let _e=1;_e<o.length;_e++){const it=o[_e];b.materialIndex===it.materialIndex?b.count+=it.count:(b=it,h.groups.push(b))}return h}function toCreasedNormals(h,o=Math.PI/3){const c=Math.cos(o),d=100*(1+1e-10),_=[new three_module.Pq0,new three_module.Pq0,new three_module.Pq0],b=new three_module.Pq0,_e=new three_module.Pq0,it=new three_module.Pq0,nt=new three_module.Pq0;function at(xt){return`${~~(xt.x*d)},${~~(xt.y*d)},${~~(xt.z*d)}`}const ut=h.index?h.toNonIndexed():h,pt=ut.attributes.position,mt={};for(let xt=0,At=pt.count/3;xt<At;xt++){const Ct=3*xt,Et=_[0].fromBufferAttribute(pt,Ct+0),Tt=_[1].fromBufferAttribute(pt,Ct+1),kt=_[2].fromBufferAttribute(pt,Ct+2);b.subVectors(kt,Tt),_e.subVectors(Et,Tt);const Dt=new three_module.Pq0().crossVectors(b,_e).normalize();for(let zt=0;zt<3;zt++){const Bt=at(_[zt]);Bt in mt||(mt[Bt]=[]),mt[Bt].push(Dt)}}const ft=new Float32Array(3*pt.count),vt=new three_module.THS(ft,3,!1);for(let xt=0,At=pt.count/3;xt<At;xt++){const Ct=3*xt,Et=_[0].fromBufferAttribute(pt,Ct+0),Tt=_[1].fromBufferAttribute(pt,Ct+1),kt=_[2].fromBufferAttribute(pt,Ct+2);b.subVectors(kt,Tt),_e.subVectors(Et,Tt),it.crossVectors(b,_e).normalize();for(let Dt=0;Dt<3;Dt++){const zt=mt[at(_[Dt])];nt.set(0,0,0);for(let Bt=0,Rt=zt.length;Bt<Rt;Bt++){const Ut=zt[Bt];it.dot(Ut)>c&&nt.add(Ut)}nt.normalize(),vt.setXYZ(Ct+Dt,nt.x,nt.y,nt.z)}}return ut.setAttribute("normal",vt),ut}function mergeBufferGeometries(h,o=!1){return console.warn("THREE.BufferGeometryUtils: mergeBufferGeometries() has been renamed to mergeGeometries()."),mergeGeometries(h,o)}function mergeBufferAttributes(h){return console.warn("THREE.BufferGeometryUtils: mergeBufferAttributes() has been renamed to mergeAttributes()."),mergeAttributes(h)}function computeScreenSpaceBoundingBox(h,o){let c,d;if(Array.isArray(h))for(const b of h){const _e=computeScreenSpaceBoundingBox(b,o);c===void 0||d===void 0?(c=_e.min.clone(),d=_e.max.clone()):(c.min(_e.min),d.max(_e.max))}const _=h;if(_.geometry!==void 0){const b=_.geometry.vertices;if(b===void 0&&_.geometry.attributes!==void 0&&"position"in _.geometry.attributes){const _e=new three_module.Pq0,it=_.geometry.attributes.position;for(let nt=0;nt<it.count*it.itemSize;nt+=it.itemSize){_e.set(it.array[nt],it.array[nt+1],it.array[3]);const at=_e.applyMatrix4(h.matrixWorld).project(o),ut=new three_module.I9Y(at.x,at.y);c===void 0||d===void 0?(c=ut.clone(),d=ut.clone()):(c.min(ut),d.max(ut))}}else for(const _e of b){const it=_e.clone().applyMatrix4(h.matrixWorld).project(o),nt=new three_module.I9Y(it.x,it.y);c===void 0||d===void 0?(c=nt.clone(),d=nt.clone()):(c.min(nt),d.max(nt))}}if(h.children!==void 0)for(const b of h.children){const _e=computeScreenSpaceBoundingBox(b,o);c===void 0||d===void 0?(c=_e.min.clone(),d=_e.max.clone()):(c.min(_e.min),d.max(_e.max))}return new three_module.UtB(c,d)}const RGBM16ColorSpace_="rgbm-16";function getTexelDecodingFunction(h,o){let c;switch(o){case three_module.jf0:case three_module.Zr2:case three_module.er$:c="";break;case three_module.DAr:c="RGBM16ToLinear";break;default:console.warn("THREE.WebGLProgram: Unsupported color space:",o),c=""}return`#define ${h}( value ) ${c} ( value )`}function getTexelDecoding(h,o){return getTexelDecodingFunction(h+"TexelToLinear",o??three_module.Zr2)+`
`}function uniform({uniforms:h,propKey:o,thisTarget:c=!1}={}){const d=!!h,_=!!o,b=c;return(_e,it)=>{const nt=at=>{const ut=b?at:d?h:at.uniforms||at._uniforms;let pt=_?o:it;b&&(pt="_"+pt);let mt=ut[pt];return mt||(mt={value:null},ut[pt]=mt),mt};Object.defineProperty(_e,it,{get(){return nt(this).value},set(at){nt(this).value=at,S$2(this,"uniformsNeedUpdate",!0,!0)}})}}function matDefine(h,o,c=!1,d){const _=!!o,b=!!h;return(_e,it)=>{const nt=at=>({t:_?o:at.defines||at._defines,p:b?h:it});Object.defineProperty(_e,it,{get(){const{t:at,p:ut}=nt(c?this:this.material);return at[ut]},set(at){const{t:ut,p:pt}=nt(c?this:this.material);if(S$2(ut,pt,at,!0),typeof d=="function"){const mt=[pt,at];if(d.name){const ft=this[d.name];ft===d?d.call(this,...mt):ft.name===`bound ${d.name}`?ft(...mt):d(...mt)}else d(...mt)}else S$2(c?this:this.material,"needsUpdate",!0,!0)}})}}function dataTextureFromColor(h){const o=new three_module.GYF(new Uint8Array([Math.floor(255*h.r),Math.floor(255*h.g),Math.floor(255*h.b),255]),1,1,three_module.GWd,three_module.OUM);return o.needsUpdate=!0,o.colorSpace=three_module.jf0,o}function dataTextureFromVec4(h){const o=new three_module.GYF(new Uint8Array([Math.floor(255*h.x),Math.floor(255*h.y),Math.floor(255*h.z),Math.floor(255*h.w)]),1,1,three_module.GWd,three_module.OUM);return o.needsUpdate=!0,o}function setThreeRendererMode(h,o,c){const d=h.userData,{backgroundRender:_,transparentRender:b,shadowMapRender:_e,mainRenderPass:it,opaqueRender:nt,transmissionRender:at,sceneRender:ut,screenSpaceRendering:pt}=d;o.backgroundRender!==void 0&&(d.backgroundRender=o.backgroundRender),o.transparentRender!==void 0&&(d.transparentRender=o.transparentRender),o.shadowMapRender!==void 0&&(d.shadowMapRender=o.shadowMapRender),o.mainRenderPass!==void 0&&(d.mainRenderPass=o.mainRenderPass),o.opaqueRender!==void 0&&(d.opaqueRender=o.opaqueRender),o.sceneRender!==void 0&&(d.sceneRender=o.sceneRender),o.transmissionRender!==void 0&&(d.transmissionRender=o.transmissionRender),o.screenSpaceRendering!==void 0&&(d.screenSpaceRendering=o.screenSpaceRendering),c(),d.backgroundRender=_,d.transparentRender=b,d.shadowMapRender=_e,d.mainRenderPass=it,d.opaqueRender=nt,d.sceneRender=ut,d.transmissionRender=at,d.screenSpaceRendering=pt}function autoCenterObject3D(h,o=!1){if(o){if(!h.userData.autoCentered||!h.userData._lastCenter)return h;h.position.add(h.userData._lastCenter),delete h.userData.autoCentered,delete h.userData.isCentered,delete h.userData._lastCenter}else{const c=new Box3B().expandByObject(h,!0,!0).getCenter(new three_module.Pq0);h.userData._lastCenter=c,h.position.sub(c),h.userData.autoCentered=!0,h.userData.isCentered=!0}return h.dispatchEvent({type:"objectUpdate",undo:o}),h}function pivotToBBoxCenter(h){return pivotToPoint(h,new Box3B().expandByObject(h,!0,!0).getCenter(new three_module.Pq0))}function pivotToPoint(h,o){var c;const d=new three_module.Pq0().copy(o),_=new three_module.Pq0().copy(d),b=new three_module.kn4().copy(h.matrixWorld).invert(),_e=(c=h.parent)===null||c===void 0?void 0:c.matrixWorld,it=new three_module.kn4;_e!==void 0&&it.copy(_e).invert(),d.applyMatrix4(it);const nt=h.position.clone();return h.position.copy(d),_.applyMatrix4(b).negate(),h.geometry&&h.geometry.translate(_.x,_.y,_.z),h.children.forEach(at=>{at.position.add(_)}),h.dispatchEvent({type:"objectUpdate"}),()=>{h.position.copy(nt),h.geometry&&h.geometry.translate(-_.x,-_.y,-_.z),h.children.forEach(at=>{at.position.sub(_)}),h.dispatchEvent({type:"objectUpdate",undo:!0})}}function autoScaleObject3D(h,o,c,d=!1){let _=1;if(d){if(!h.userData.autoScaled||!h.userData._lastScaleRadius)return h;const b=h.userData.autoScaleRadius||o||1;if(_=h.userData._lastScaleRadius/b,!isFinite(_))return h;h.userData.autoScaled=!0,h.userData.autoScaleRadius=o,delete h.userData._lastScaleRadius}else{const b=.5*new Box3B().expandByObject(h,!0,!0).getSize(new three_module.Pq0).length();if(o===void 0&&(o=h.userData.autoScaleRadius||1),_=o/b,!isFinite(_))return h;h.userData.autoScaled=!0,h.userData.autoScaleRadius=o,h.userData._lastScaleRadius=b}return h.userData.pseudoCentered?h.children.forEach(b=>{b.scale.multiplyScalar(_)}):h.scale.multiplyScalar(_),(c||h.userData.isCentered)&&h.position.multiplyScalar(_),h.traverse(b=>{var _e,it;b.isLight&&!((it=(_e=b.shadow)===null||_e===void 0?void 0:_e.camera)===null||it===void 0)&&it.right&&(b.shadow.camera.right*=_,b.shadow.camera.left*=_,b.shadow.camera.top*=_,b.shadow.camera.bottom*=_),b.isCamera&&b.right&&(b.right*=_,b.left*=_,b.top*=_,b.bottom*=_)}),h.dispatchEvent({type:"objectUpdate",undo:d}),h}function toIndexedGeometry(h,o=-1){return mergeVertices(h,o)}function makeSamplerUi(h,o,c,d,_){return _=_??(()=>h.setDirty&&h.setDirty()),{type:"folder",label:c??o+" Sampler",hidden:()=>!h[o]||d&&d(),children:[()=>({type:"vec2",label:"Repeat",bounds:[-100,100],stepSize:.001,property:[h[o],"repeat"],onChange:_}),()=>({type:"vec2",label:"Offset",bounds:[-2,2],stepSize:.001,property:[h[o],"offset"],onChange:_}),()=>({type:"vec2",label:"Center",bounds:[-2,2],stepSize:.001,property:[h[o],"center"],onChange:_}),()=>({type:"input",label:"Rotation",stepSize:.001,bounds:[-Math.PI,Math.PI],property:[h[o],"rotation"],onChange:_}),()=>({type:"dropdown",label:"Color Space",property:[h[o],"colorSpace"],children:[["Linear",three_module.Zr2],["sRGB",three_module.er$]].map(b=>({label:b[0],value:b[1]})),onChange:[()=>{const b=h[o];b&&(b.needsUpdate=!0)},_]}),()=>({type:"checkbox",label:"Flip Y",getValue:()=>{var b,_e;return(_e=(b=h[o])===null||b===void 0?void 0:b.flipY)!==null&&_e!==void 0&&_e},setValue:b=>{const _e=h[o];if(_e&&_e.flipY!==b)if(_e.image&&ImageBitmap&&_e.image instanceof ImageBitmap){const it=_e,nt=_e.source.data;createImageBitmap(nt,{imageOrientation:"flipY"}).then(at=>{nt.close&&nt.close(),it.flipY=b,it.source.data=at,it.source.needsUpdate=!0,it.needsUpdate=!0,_&&_()})}else _e.flipY=b,_e.needsUpdate=!0,_&&_()}}),()=>({type:"dropdown",label:"Wrap S",property:[h[o],"wrapS"],children:[["ClampToEdge",three_module.ghU],["MirroredRepeat",three_module.kTW],["Repeat",three_module.GJx]].map(b=>({label:b[0],value:b[1]})),onChange:[()=>{h[o]&&(h[o].needsUpdate=!0)},_]}),()=>({type:"dropdown",label:"Wrap T",property:[h[o],"wrapT"],children:[["ClampToEdge",three_module.ghU],["MirroredRepeat",three_module.kTW],["Repeat",three_module.GJx]].map(b=>({label:b[0],value:b[1]})),onChange:[()=>{h[o]&&(h[o].needsUpdate=!0)},_]}),()=>({type:"input",label:"Anisotropy",bounds:[1,6],stepSize:1,property:[h[o],"anisotropy"],onChange:[()=>{h[o]&&(h[o].needsUpdate=!0),h.needsUpdate=!0},_]}),()=>({type:"dropdown",label:"Min Filter",property:[h[o],"minFilter"],children:[["Linear",three_module.k6q],["Nearest",three_module.hxR],["NearestMipmapNearest",three_module.pHI],["NearestMipmapLinear",three_module.a$r],["LinearMipmapNearest",three_module.kRr],["LinearMipmapLinear",three_module.$_I]].map(b=>({label:b[0],value:b[1]})),onChange:[()=>{h[o]&&(h[o].needsUpdate=!0)},_]}),()=>({type:"dropdown",label:"Mag Filter",property:[h[o],"magFilter"],children:[["Linear",three_module.k6q],["Nearest",three_module.hxR]].map(b=>({label:b[0],value:b[1]})),onChange:[()=>{h[o]&&(h[o].needsUpdate=!0)},_]})]}}const iMaterialIgnoredUserData=["appliedMeshes","imageLoadAwaiter","inverseModelMatrix","uvTransform","uuid","iMaterial"];function copyMaterialUserData(h,o,c=!0){if(!o)return h;for(const d of Object.keys(o)){if(c&&iMaterialIgnoredUserData.includes(d)||d.startsWith("__"))continue;const _=o[d];if(typeof h[d]=="function"||typeof _=="function")continue;const b=!_||_.isTexture||_.isObject3D||_.isMaterial;b||typeof _.clone!="function"?b||typeof _!="object"&&!Array.isArray(_)?h[d]=_:h[d]=copyMaterialUserData(Array.isArray(_)?[]:{},_,!1):h[d]=_.clone()}return h}const iTextureIgnoredUserData=["appliedMaterials","uuid"];function copyTextureUserData(h,o){if(o)for(const c of Object.keys(o))iTextureIgnoredUserData.includes(c)||c.startsWith("__")||typeof h[c]!="function"&&typeof o[c]!="function"&&(h[c]=o[c]);return h}function textureDataToImageData(h,o,c){var d;const _=(d=c==null?void 0:c.data)!==null&&d!==void 0?d:new Uint8ClampedArray(h.height*h.width*4),b=h.data instanceof Float32Array,_e=h.data instanceof Uint16Array;for(let it=0;it<_.length;it++)_[it]=b?255*h.data[it]:_e?255*three_module.GxU.fromHalfFloat(h.data[it]):h.data[it],o===three_module.Zr2&&(_[it]=255*ve$1(_[it]/255));return c??new ImageData(_,h.width,h.height)}function textureToCanvas(h,o,c=!1){let d;return d=h.isDataTexture?textureDataToImageData(h.image,h.colorSpace):h.image,texImageToCanvas(d,o,c)}function texImageToCanvas(h,o,c=!1){const d=document.createElement("canvas");d.width=Math.min(o,h.width),d.height=Math.floor(1+d.width*h.height/h.width);const _=d.getContext("2d");if(!_)return console.error("textureToDataUrl: could not get canvas context"),d;c===!0&&(_.translate(0,d.height),_.scale(1,-1));let b=!1;if(h.data!==void 0){const _e=h;if(h.width!==d.width||h.height!==d.height){const it=document.createElement("canvas");it.width=h.width,it.height=h.height;const nt=it.getContext("2d");nt?(nt.putImageData(_e,0,0),_.drawImage(it,0,0,d.width,d.height)):(console.error("textureToDataUrl: could not get temp canvas context"),_.putImageData(_e,0,0))}else _.putImageData(_e,0,0),c&&(b=!0)}else _.drawImage(h,0,0,d.width,d.height);return b?Ke$1(d):d}function textureToDataUrl(h,o,c,d,_){return textureToCanvas(h,o,c).toDataURL(d,_)}String.prototype.replaceAll||(String.prototype.replaceAll=function(h,o){return Object.prototype.toString.call(h).toLowerCase()==="[object regexp]"?this.replace(h,o):this.replace(new RegExp(h,"g"),o)});const typeMap=new Map;function serialize(h){return(o,c)=>{const d=o.constructor;if(d===Object)throw new Error("All properties in an object are serialized by default");typeMap.has(d)||typeMap.set(d,[]),typeMap.get(d).push([h||c,c])}}const serializers={obj:(h,o)=>Object.fromEntries(Object.entries(h).map(([c,d])=>[c,serializeObject(d,!1,o)])),vec4:h=>({x:h.x,y:h.y,z:h.z,w:h.w,isVector4:!0}),vec3:h=>({x:h.x,y:h.y,z:h.z,isVector3:!0}),vec2:h=>({x:h.x,y:h.y,isVector2:!0}),color:h=>({r:h.r,g:h.g,b:h.b,isColor:!0}),quat:h=>({x:h.x,y:h.y,z:h.z,w:h.w,isQuaternion:!0}),texture:(h,o)=>{var c;if(!(h!=null&&h.isTexture))throw new Error("Expected a texture");if(o!=null&&o.textures[h.uuid])return{uuid:h.uuid,resource:"textures"};if(h.isRenderTargetTexture&&!(!((c=h.userData)===null||c===void 0)&&c.serializableRenderTarget))return;const d=h.source.data,_=!h.isRenderTargetTexture&&h.userData.rootPath;_&&h.source.data&&(h.userData.__embedUrlImagePreviews?h.source.data=textureToCanvas(h,16,h.flipY):h.source.data=null);const b=h.userData;h.userData={};const _e={images:{}};let it={};try{it=h.toJSON(o||_e),!o&&it.image&&(it.image=_&&!h.userData.__embedUrlImagePreviews?void 0:_e.images[it.image]),it.userData=serializeObject(copyTextureUserData({},b),!1,o)}catch(nt){console.error(nt)}return h.userData=b,_&&(o&&!h.userData.__embedUrlImagePreviews&&delete o.images[h.source.uuid],h.source.data=d),o!=null&&o.textures&&!it.resource&&(o.textures[it.uuid]||(o.textures[it.uuid]=it),it={uuid:it.uuid,resource:"textures"}),it},material:(h,o)=>{var c;if(!(h!=null&&h.isMaterial))throw new Error("Expected a material");if(!((c=o==null?void 0:o.materials)===null||c===void 0)&&c[h.uuid])return{uuid:h.uuid,resource:"materials"};h.userData.rootPath&&console.error("TODO: handle material with root path with material inheritance/hierarchy");const d=o??{textures:{},images:{}},_={},b={};for(const[it,nt]of Object.entries(h))if(nt!=null&&nt.isTexture&&!it.startsWith("__")){const at=serializers.texture(nt,d);_[it]=at,b[it]=nt,h[it]=at?{isTexture:!0,toJSON:()=>at}:null}let _e=h.toJSON(o||d);for(const[it,nt]of Object.entries(b))h[it]=nt,delete b[it];if(o){for(const[it,nt]of Object.entries(_))nt&&(_e[it]=nt);o!=null&&o.materials&&(o.materials[_e.uuid]||(o.materials[_e.uuid]=_e),_e={uuid:_e.uuid,resource:"materials"})}else{for(const[it,nt]of Object.entries(_))nt&&(_e[it]=nt.uuid);_e.textures=Object.values(d.textures),_e.images=Object.values(d.images)}return _e}},copier=h=>(o,c)=>{var d,_;return(_=(d=c==null?void 0:c.copy)===null||d===void 0?void 0:d.call(c,o))!==null&&_!==void 0?_:new h().copy(o)},deserializers={obj:(h,o,c)=>Object.assign(o,Object.fromEntries(Object.entries(h).map(([d,_])=>[d,deserializeObject(_,o==null?void 0:o[d],!1,c)]))),vec4:copier(three_module.IUQ),vec3:copier(three_module.Pq0),vec2:copier(three_module.I9Y),color:copier(three_module.Q1f),quat:copier(three_module.PTz)};function serializeObject(h,o,c){var d,_;if(typeof h=="function")return;if(Array.isArray(h))return h.map(it=>serializeObject(it,!1,c));if(typeof h!="object"){if(typeof h=="number"){if(h===1/0)return"Infinity";if(h===-1/0)return"-Infinity";if(isNaN(h))return"NaN"}return h}if(!h)return h;let b=(d=h.constructor)!==null&&d!==void 0?d:Object;if(b===Object)return serializers.obj(h,c);if(h.isVector2)return serializers.vec2(h);if(h.isVector3)return serializers.vec3(h);if(h.isVector4)return serializers.vec4(h);if(h.isColor)return serializers.color(h);if(h.isQuaternion)return serializers.quat(h);if(h.isTexture)return serializers.texture(h,c);if(h.isMaterial)return serializers.material(h,c);if(!o&&typeof h.toJSON=="function"){const it=h.toJSON(c);return h.serializableClassId&&it&&(it.serializableClassId=h.serializableClassId),it}const _e={};for(;b&&b!==Object;)(_=typeMap.get(b))===null||_===void 0||_.forEach(([it,nt])=>{const at=h[nt];_e[it]=serializeObject(at,!1,c)}),b=Object.getPrototypeOf(b);return h.serializableClassId&&(_e.serializableClassId=h.serializableClassId),_e}function deserializeObject(h,o,c,d={}){var _,b,_e;let it=o;if(h===void 0)return it;if(typeof o=="number"){if(h==="Infinity")return 1/0;if(h==="-Infinity")return-1/0;if(h==="NaN")return NaN;if(typeof h=="number"||!h)return h}if(Array.isArray(h)){const ut=h.length;Array.isArray(it)||(it=[]);for(let pt=0;pt<ut;pt++){const mt=h[pt],ft=it.length>pt?deserializeObject(mt,it[pt],!1,d):deserializeObject(mt,void 0,!1,d);it.length<=pt?it.push(ft):it[pt]=ft}return it}let nt=!1;if(h&&h.resource&&typeof h.resource=="string"&&(h=(_=d[h.resource])===null||_===void 0?void 0:_[h.uuid],nt=!0),!it&&h&&!nt)if(h.serializableClassId){const ut=serializableClasses.get(h.serializableClassId);ut&&(it=ut.DataInConstructor?new ut(h):new ut)}else typeof h!="object"||h.constructor&&h.constructor!==Object||(it={});if(typeof it=="function")return console.error("cannot deserialize over function",it,h),it;if(h&&typeof h=="object"&&!nt){if(h.isVector2)return deserializers.vec2(h,it);if(h.isVector3)return deserializers.vec3(h,it);if(h.isVector4)return deserializers.vec4(h,it);if(h.isColor)return deserializers.color(h,it);if(h.isQuaternion)return deserializers.quat(h,it)}if(h==null||it==null||typeof it!="object"||it.isTexture)return nt&&(h?h.__useCount=h.__useCount?h.__useCount+1:1:console.warn("probable error deserialize: resource not found.")),h;let at=(b=it.constructor)!==null&&b!==void 0?b:Object;if(at===Object)return deserializers.obj(h,it,d);if(!c&&typeof it.fromJSON=="function")return it.isMaterial&&(Object.entries(h).forEach(([ut,pt])=>{var mt;if(!pt||!pt.resource||typeof pt.resource!="string")return;const ft=(mt=d[pt.resource])===null||mt===void 0?void 0:mt[pt.uuid];h[ut]=ft||null}),h.userData&&(h.userData=deserializeObject(h.userData,void 0,!1,d))),it.fromJSON(h,d),it;for(;at&&at!==Object;)(_e=typeMap.get(at))===null||_e===void 0||_e.forEach(([ut,pt])=>{const mt=it[pt],ft=deserializeObject(h[ut],mt,!1,d);ft!==mt&&S$2(it,pt,ft,!0)}),at=Object.getPrototypeOf(at);return it}const serializableClasses=new Map;function serializable(h){return o=>(o=class extends o{constructor(){super(...arguments),this.serializableClassId=h}},serializableClasses.set(h,o),o)}function serializeTextureInExtras(h,o,c,d){var _,b,_e;if(o!=null&&o.extras[h.uuid])return{uuid:h.uuid,resource:"extras"};let it="";if(!((_=h.source)===null||_===void 0)&&_._sourceImgBuffer||h.userData.__sourceBuffer){const at=new Uint8Array(((b=h.source)===null||b===void 0?void 0:b._sourceImgBuffer)||h.userData.__sourceBuffer),ut=d||h.userData.mimeType||"";it={data:Array.from(at),type:at.constructor.name,path:((_e=h.userData.__sourceBlob)===null||_e===void 0?void 0:_e.name)||h.userData.rootPath||"file."+ut.split("/")[1]},ut&&(it.mimeType=ut)}else h.userData.rootPath?it=h.userData.rootPath:console.error("Unable to serialize LUT texture, not loaded through asset manager.");const nt={uuid:h.uuid,url:it,userData:copyTextureUserData({},h.userData),type:h.type,name:c||h.name};return o!=null&&o.extras?(o.extras[h.uuid]=nt,{uuid:h.uuid,resource:"extras"}):nt}var __decorate=function(h,o,c,d){var _,b=arguments.length,_e=b<3?o:d===null?d=Object.getOwnPropertyDescriptor(o,c):d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_e=Reflect.decorate(h,o,c,d);else for(var it=h.length-1;it>=0;it--)(_=h[it])&&(_e=(b<3?_(_e):b>3?_(o,c,_e):_(o,c))||_e);return b>3&&_e&&Object.defineProperty(o,c,_e),_e};let BaseRenderer=class extends I$2{get composer(){return this._composer}get passes(){return this._passes}get isWebGL2(){return this._isWebGL2}get composerTarget(){return this._composerTarget}get renderSize(){return this._renderSize}get displayCanvasScaling(){return this._displayCanvasScaling}set displayCanvasScaling(h){h!==this._displayCanvasScaling&&(this._displayCanvasScaling=h,this.setSize(void 0,void 0,!0))}get frameCount(){return this._frameCount}get totalFrameCount(){return this._totalFrameCount}set pipeline(h){this._pipeline=h,this._passesNeedsUpdate=!0}get pipeline(){return this._pipeline}refreshPipeline(){var h,o,c;const d=this._passes,_=[],b={};for(const _e of d){if(_e.enabled===!1)continue;const it={after:(h=_e.after)!==null&&h!==void 0?h:[],before:(o=_e.before)!==null&&o!==void 0?o:[],dependencies:new Set((c=_e.required)!==null&&c!==void 0?c:[])};b[_e.passId]=it}for(const[_e,it]of Object.entries(b)){const nt=new Set([...it.after,...it.before]);it.dependencies.forEach(at=>nt.has(at)&&nt.delete(at)),nt.forEach(at=>{const ut=b[at];if(ut){if(ut.dependencies.has(_e))throw console.error("cyclic",_e,at),"Cyclic dependency";it.dependencies.add(at)}})}for(;;){let _e=!1;const it=[...Object.entries(b)];for(const[nt,at]of it)if(!_.includes(nt)&&Ce$1(_,at.dependencies.values())){const ut=Math.max(-1,...at.after.map(mt=>_.indexOf(mt))),pt=Math.min(_.length,...at.before.map(mt=>{const ft=_.indexOf(mt);return ft<0?_.length:ft}));if(ut>=pt)throw console.error(at,d,_,ut,pt),"Not possible";_.splice(at.after.length>0?ut+1:pt,0,nt),_e=!0,delete b[nt]}if(Object.keys(b).length<1)break;if(!_e)throw console.error(it,b,_),"Not possible 2"}return this.pipeline=_,this.pipeline}get context(){return this._context}get rendererObject(){return this._renderer}_animationLoop(h,o){const c=h-this._lastTime;this._lastTime=h,this.frameWaitTime-=c,this.frameWaitTime>0||(this.frameWaitTime=0,this.dispatchEvent({type:"animationLoop",deltaTime:c,time:h,renderer:this,xrFrame:o}))}get clock(){return this._composer.clock}registerPass(h,o=!0){var c;if(o)for(const d of[...this._passes])h.passId===d.passId&&this.unregisterPass(d);this._passes.push(h),(c=h.onRegister)===null||c===void 0||c.call(h,this),this._passesNeedsUpdate=!0,this._updated()}unregisterPass(h){var o;const c=this._passes.indexOf(h);c>=0&&((o=h.onUnregister)===null||o===void 0||o.call(h,this),this._passes.splice(c,1),this._passesNeedsUpdate=!0,this._updated())}constructor({animationLoop:h,canvas:o,alpha:c=!0,targetOptions:d,maxHDRIntensity:_}){super(),this._isWebGL2=!1,this._trackedTargets=[],this.dirty=!0,this._lastTime=0,this.frameWaitTime=0,this._passes=[],this._pipeline=[],this._passesNeedsUpdate=!0,this._displayCanvasScaling=1,this._renderSize=new three_module.I9Y(512,512),this._frameCount=0,this.defaultRenderToScreen=!0,this._tempTargets={},this.maxTempPerKey=5,this._totalFrameCount=0,this.stableNoise=!1,this._animationLoop=this._animationLoop.bind(this),this._processNewTarget=this._processNewTarget.bind(this),this._processNewTempTarget=this._processNewTempTarget.bind(this),this.trackTarget=this.trackTarget.bind(this),this.disposeTarget=this.disposeTarget.bind(this),this.createTarget=this.createTarget.bind(this),this.createTargetCustom=this.createTargetCustom.bind(this),this.maxHDRIntensity=_||120,this._renderer=new three_module.JeP({canvas:o,antialias:!1,alpha:c,premultipliedAlpha:!0,preserveDrawingBuffer:!0,powerPreference:"high-performance"}),this._renderer.baseRenderer=this,this._renderer.setAnimationLoop(this._animationLoop),this._context=this._renderer.getContext(),this._isWebGL2=this._renderer.capabilities.isWebGL2,this._isWebGL2||console.error("WebGi BaseRenderer: WebGL1 is not supported anymore. Some features may not work"),this._renderer.onContextLost=b=>{this.dispatchEvent({type:"contextLost",event:b})},this._renderer.onContextRestore=()=>{this.dispatchEvent({type:"contextRestored"})},this._renderSize=new three_module.I9Y(o.clientWidth,o.clientHeight),this._renderer.setSize(this._renderSize.width,this._renderSize.height,!1),this._renderer.setPixelRatio(this._displayCanvasScaling),this._renderer.toneMapping=three_module.y_p,this._renderer.toneMappingExposure=.1,this._renderer.outputColorSpace=three_module.jf0,this._renderer.shadowMap.enabled=!0,this._renderer.shadowMap.type=three_module.QP0,this._renderer.shadowMap.autoUpdate=!1,this.resetShadows(),this._composerTarget=this.createTarget(d,!1),this._composerTarget.texture.name="EffectComposer.rt1",this._composer=new EffectComposer2(this._renderer,this._composerTarget),h&&this.addEventListener("animationLoop",h)}setSize(h,o,c=!1){!c&&(h?Math.abs(h-this._renderSize.width):0)+(o?Math.abs(o-this._renderSize.height):0)<.1||(h&&(this._renderSize.width=h),o&&(this._renderSize.height=o),this.rendererObject.xr.enabled&&this.rendererObject.xr.isPresenting||(this._renderer.setSize(this._renderSize.width,this._renderSize.height,!1),this._renderer.setPixelRatio(this._displayCanvasScaling)),this._composer.setPixelRatio(this._displayCanvasScaling,!1),this._composer.setSize(this._renderSize.width,this._renderSize.height),this._trackedTargets.forEach(d=>{const _=d,b=_.sizeMultiplier;if(b){const _e=this._renderSize.clone().multiplyScalar(this._displayCanvasScaling*b);_.setSize(Math.floor(_e.width),Math.floor(_e.height))}}),this.dispatchEvent({type:"resize"}),this._updated(),this.reset())}blit(h,o,{viewport:c,material:d,shader:_,pass:b,clear:_e=!0}={}){const it=this._composer.copyPass,{renderToScreen:nt,material:at,uniforms:ut,clear:pt}=it;d&&(it.material=d);const mt=this._renderer.getViewport(new three_module.IUQ),ft=this._renderer.autoClear,vt=this._renderer.getRenderTarget();c&&this._renderer.setViewport(new three_module.IUQ().fromArray(c)),this._renderer.autoClear=!1,it.uniforms=it.material.uniforms,it.renderToScreen=!1,it.clear=_e,setThreeRendererMode(this._renderer,{sceneRender:!0,opaqueRender:!0,shadowMapRender:!1,backgroundRender:!1,transparentRender:!0,transmissionRender:!1},()=>{it.render(this._renderer,o??null,{texture:h},0,!1)}),it.renderToScreen=nt,it.clear=pt,it.material=at,it.uniforms=ut,this._renderer.autoClear=ft,c&&this._renderer.setViewport(mt),this._renderer.setRenderTarget(vt)}clearColor({r:h,g:o,b:c,a:d,target:_,depth:b=!0,stencil:_e=!0}){var it;const nt=this._renderer.getClearColor(new three_module.Q1f),at=this._renderer.getClearAlpha();this._renderer.setClearColor(new three_module.Q1f(h??nt.r,o??nt.g,c??nt.b),d??at);const ut=this._renderer.getRenderTarget(),pt=this._renderer.getActiveCubeFace(),mt=this._renderer.getActiveMipmapLevel();_&&typeof _.clear=="function"?_.clear(this._renderer,!0,b,_e):(this._renderer.setRenderTarget((it=_)!==null&&it!==void 0?it:null),this._renderer.clear(!0,b,_e)),this._renderer.setRenderTarget(ut,pt,mt),this._renderer.setClearColor(nt,at)}renderModel(h,o){this._renderer.render(h.modelObject,o.cameraObject)}renderScene(h){const o=h.activeCamera;o&&this.renderModel(h,o)}_updated(){this.dispatchEvent({type:"update"})}render(h){var o;this._passesNeedsUpdate&&this.refreshPasses();for(const c of this._passes)c.passObject.enabled&&((o=c.update)===null||o===void 0||o.call(c));h=h??this.defaultRenderToScreen,this._composer.renderToScreen=h,this._composer.render(),this._composer.renderToScreen=!0,h&&(this._frameCount+=1,this._totalFrameCount+=1),this.dirty=!1}updateDirty(){this.dirty=this.dirty||this._passes.findIndex(h=>h.dirty)>=0}reset(){this._frameCount=0,this.dirty=!0}resetShadows(){this._renderer.shadowMap.needsUpdate=!0}refreshPasses(){if(!this._passesNeedsUpdate)return;this._passesNeedsUpdate=!1;const h=[];for(const o of this._pipeline){const c=this._passes.find(d=>d.passId===o);c?h.push(c.passObject):console.warn("WebGi BaseRenderer: Unable to find pass: ",o)}[...this._composer.passes].forEach(o=>this._composer.removePass(o)),h.forEach(o=>this._composer.addPass(o)),this._updated()}dispose(){this._trackedTargets.forEach(h=>h.dispose()),this._trackedTargets=[],this._renderer.dispose()}trackTarget(h){this._trackedTargets.push(h)}removeTrackedTarget(h){const o=this._trackedTargets.indexOf(h);o>=0&&this._trackedTargets.splice(o,1)}createTarget({sizeMultiplier:h,samples:o=0,colorSpace:c=three_module.jf0,type:d=three_module.OUM,format:_=three_module.GWd,depthBuffer:b=!0,depthTexture:_e=!1,depthTextureType:it=three_module.bkx,depthTextureFormat:nt=three_module.zdS,size:at,textureCount:ut=1,...pt}={},mt=!0){this.isWebGL2||(o=0),h!==void 0&&at!==void 0&&console.error("Both sizeMultiplier and size are defined. sizeMultiplier will be ignored."),(at=at||this._renderSize.clone().multiplyScalar(this._displayCanvasScaling*(h=h||1))).width=Math.floor(at.width),at.height=Math.floor(at.height);const ft=_e?new three_module.VCu(at.width,at.height,it):null;ft&&(ft.format=nt);const vt=this.createTargetCustom(ut>1?{width:at.width,height:at.height,count:ut}:at,{samples:o,colorSpace:c,type:d,format:_,depthBuffer:b,depthTexture:ft},ut>1?three_module.AT1:three_module.nWS);return this._processNewTarget(vt,h,mt),this._setTargetOptions(vt,pt),vt}_processNewTarget(h,o,c){return o!==void 0&&(h.sizeMultiplier=o),c&&this.trackTarget(h),h}disposeTarget(h){if(h){if(h.isTemporary)return this.releaseTempTarget(h);this.removeTrackedTarget(h),h.dispose()}}createTargetCustom({width:h,height:o,count:c},d={},_){var b;const _e=this._processNewTarget,it=this.renderTargetToDataUrl.bind(this);this.renderTargetToBuffer.bind(this);let nt=[h,o];if(c&&c>1&&nt.push(c),(_==null?void 0:_.prototype)===three_module.o6l.prototype){if(h!==o)throw"Width and height of cube render target must be equal";nt=[h]}d={format:three_module.GWd,minFilter:three_module.k6q,magFilter:three_module.k6q,generateMipmaps:!1,type:three_module.OUM,colorSpace:three_module.jf0,...d};const at=[this,...nt,d];return new class extends((b=_)!==null&&b!==void 0?b:three_module.nWS){constructor(ut,...pt){super(...pt),this.renderer=ut,this.assetType="renderTarget",this.name="RenderTarget",Array.isArray(this.texture)?this.texture.forEach(mt=>{mt.__target=this,mt.userData||(mt.userData={}),mt.colorSpace=d.colorSpace,mt.toJSON=()=>(console.warn("WebGi RenderTarget: Multiple render target texture.toJSON not supported yet."),{})}):(this.texture.userData||(this.texture.userData={}),this.texture.__toJSON=this.texture.toJSON,this.texture.__target=this,this.texture.toJSON=function(mt){console.warn("WebGi RenderTarget: Render target texture.toJSON might be buggy."),this.source.data.url=it(this.__target,"image/png",90);const ft=this.__toJSON.call(this,mt);return delete this.source.data.url,ft.isRenderTargetTexture=!0,ft})}setSize(ut,pt,mt){super.setSize(Math.floor(ut),Math.floor(pt),mt)}clone(ut=!0){if(this.isTemporary)throw"Cloning temporary render targets not supported";if(Array.isArray(this.texture))throw"Cloning multiple render targets not supported";const pt=super.clone();return pt.texture.isRenderTargetTexture=!0,_e(pt,this.sizeMultiplier||1,ut)}}(...at)}getTempTarget(h={}){var o;const c=createRenderTargetKey(h);let d;return!((o=this._tempTargets[c])===null||o===void 0)&&o.length&&(d=this._tempTargets[c].pop()),d?this._setTargetOptions(d,h):(d=this.createTarget(h),this._processNewTempTarget(d,c)),d}_processNewTempTarget(h,o){return h.isTemporary=!0,h.targetKey=o,this._tempTargets[o]===void 0&&(this._tempTargets[o]=[]),h}releaseTempTarget(h){const o=h.targetKey;if(!o||!h.isTemporary)throw"Not a temp target";this._tempTargets[o].length>this.maxTempPerKey?(this.removeTrackedTarget(h),h.dispose()):this._tempTargets[o].push(h)}updateShaderProperties(h){return this.stableNoise?h.uniforms.frameCount?h.uniforms.frameCount.value=this._totalFrameCount:console.warn("WebGi BaseRenderer: no uniform: frameCount"):h.uniforms.frameCount?h.uniforms.frameCount.value=this.frameCount:console.warn("WebGi BaseRenderer:  no uniform: frameCount"),h.uniforms.frameCount2&&(h.uniforms.frameCount2.value=this.frameCount),this}_setTargetOptions(h,o){var c,d,_;h.texture.minFilter=(c=o.minFilter)!==null&&c!==void 0?c:three_module.k6q,h.texture.magFilter=(d=o.magFilter)!==null&&d!==void 0?d:three_module.k6q,h.texture.generateMipmaps=(_=o.generateMipmaps)!==null&&_!==void 0&&_,h.texture.generateMipmaps&&h.texture.minFilter===three_module.k6q&&(h.texture.minFilter=three_module.NZq),h.texture.generateMipmaps||h.texture.minFilter!==three_module.NZq||(h.texture.minFilter=three_module.k6q)}renderTargetToDataUrl(h,o="image/png",c=90,d=0){const _=document.createElement("canvas");_.width=h.width,_.height=h.height;const b=_.getContext("2d");if(!b)throw new Error("Unable to get 2d context");const _e=Array.isArray(h.texture)?h.texture[d]:h.texture,it=b.createImageData(h.width,h.height,{colorSpace:["display-p3","srgb"].includes(_e.colorSpace)?_e.colorSpace:void 0});if(_e.type===three_module.ix0){const at=new Uint16Array(h.width*h.height*4);this._renderer.readRenderTargetPixels(h,0,0,h.width,h.height,at,void 0,d),textureDataToImageData({data:at,width:h.width,height:h.height},_e.colorSpace,it)}else if(_e.type===three_module.RQf){const at=new Float32Array(h.width*h.height*4);this._renderer.readRenderTargetPixels(h,0,0,h.width,h.height,at,void 0,d),textureDataToImageData({data:at,width:h.width,height:h.height},_e.colorSpace,it)}else this._renderer.readRenderTargetPixels(h,0,0,h.width,h.height,it.data,void 0,d);b.putImageData(it,0,0);const nt=_.toDataURL(o,c);return _.remove(),nt}renderTargetToBuffer(h,o=0){const c=(Array.isArray(h.texture)?h.texture[o]:h.texture).type===three_module.ix0?new Uint16Array(h.width*h.height*4):new Uint8Array(h.width*h.height*4);return this._renderer.readRenderTargetPixels(h,0,0,h.width,h.height,c,void 0,o),c}get useLegacyLights(){return this.rendererObject.useLegacyLights}set useLegacyLights(h){this.rendererObject.useLegacyLights=h,this._updated(),this.resetShadows()}get useTotalFrameCount(){return console.warn("WebGi BaseRenderer: useTotalFrameCount is deprecated, use stableNoise instead"),this.stableNoise}set useTotalFrameCount(h){console.warn("WebGi BaseRenderer: useTotalFrameCount is deprecated, use stableNoise instead"),this.stableNoise=h}get renderScale(){return this.displayCanvasScaling}set renderScale(h){this.displayCanvasScaling=h}};function createRenderTargetKey(h={}){var o,c;return[h.sizeMultiplier,h.samples,h.colorSpace,h.type,h.format,h.depthBuffer,h.depthTexture,(o=h.size)===null||o===void 0?void 0:o.width,(c=h.size)===null||c===void 0?void 0:c.height].join(";")}function autoGPUInstanceMeshes(h){var o,c,d,_,b,_e,it,nt;if(!h.isMaterial&&!h.isBufferGeometry)return;const at=Array.from(h.userData.__appliedMeshes).filter(ft=>!ft.isInstancedMesh&&!!ft.parent&&ft.children.length===0&&!Array.isArray(ft.material));if(at.length<2)return;const ut=ft=>{var vt;return ft.parent.uuid+"_"+ft.geometry.uuid+"_"+((vt=ft.material)===null||vt===void 0?void 0:vt.uuid)},pt=new Map;for(const ft of at){const vt=ut(ft);pt.has(vt)||pt.set(vt,[]),pt.get(vt).push(ft),ft.updateMatrix()}const mt=pt.keys();for(const ft of mt){const vt=pt.get(ft),xt=vt[0];if(!xt||vt.length<2)continue;const At=new three_module.ZLX(xt.geometry,xt.material,vt.length),Ct=xt.userData;xt.userData={},At.copy(xt),copyObject3DUserData(At.userData,Ct);const Et=xt.parent;At.position.set(0,0,0),At.rotation.set(0,0,0),At.scale.set(1,1,1),At.updateMatrix();const Tt=new Float32Array(3*At.count),kt=new Float32Array(4*At.count),Dt=new Float32Array(3*At.count);for(let zt=0;zt<vt.length;zt++){const Bt=vt[zt],Rt=Bt.matrix;Rt.determinant()<0&&(Rt.elements[0]*=-1,Rt.elements[1]*=-1,Rt.elements[2]*=-1),At.setMatrixAt(zt,Rt),Bt.position.toArray(Tt,3*zt),Bt.quaternion.toArray(kt,4*zt),Bt.scale.toArray(Dt,3*zt),Bt.removeFromParent(),(d=(c=(o=Bt.material)===null||o===void 0?void 0:o.userData)===null||c===void 0?void 0:c.__appliedMeshes)===null||d===void 0||d.delete(Bt),(_e=(b=(_=Bt.geometry)===null||_===void 0?void 0:_.userData)===null||b===void 0?void 0:b.__appliedMeshes)===null||_e===void 0||_e.delete(Bt)}(nt=(it=At.material.userData)===null||it===void 0?void 0:it.__appliedMeshes)===null||nt===void 0||nt.add(At),At.geometry.userData.__appliedMeshes.add(At),At.sourceTrs={TRANSLATION:new three_module.THS(Tt,3),ROTATION:new three_module.THS(kt,4),SCALE:new three_module.THS(Dt,3)},At.instanceMatrix.needsUpdate=!0,Et.add(At),Et.setDirty(),console.log("autoGPUInstanceMeshes",ft,vt.length,xt,At)}}__decorate([serialize()],BaseRenderer.prototype,"stableNoise",void 0),__decorate([serialize()],BaseRenderer.prototype,"useLegacyLights",null),BaseRenderer=__decorate([serializable("RenderManager")],BaseRenderer);class GLTFMeshGpuInstancingExporter{constructor(o){this.writer=o,this.name="EXT_mesh_gpu_instancing"}writeNode(o,c){if(!o.isInstancedMesh)return;const d=this.writer,_=o;let b=_.sourceTrs;if(!b){const _e=new Float32Array(3*_.count),it=new Float32Array(4*_.count),nt=new Float32Array(3*_.count),at=new three_module.kn4,ut=new three_module.Pq0,pt=new three_module.PTz,mt=new three_module.Pq0;for(let ft=0;ft<_.count;ft++)_.getMatrixAt(ft,at),at.decompose(ut,pt,mt),ut.toArray(_e,3*ft),pt.toArray(it,4*ft),mt.toArray(nt,3*ft);b={TRANSLATION:new three_module.THS(_e,3),ROTATION:new three_module.THS(it,4),SCALE:new three_module.THS(nt,3)}}b={TRANSLATION:d.processAccessor(b.TRANSLATION),ROTATION:d.processAccessor(b.ROTATION),SCALE:d.processAccessor(b.SCALE)},_.instanceColor&&(b._COLOR_0=d.processAccessor(_.instanceColor)),d.extensionsUsed[this.name]=!0,d.extensionsRequired[this.name]=!0,c.extensions=c.extensions||{},c.extensions[this.name]={attributes:b}}}function makeObject3DUiConfig(h,o){if(h.uiConfig)return h.uiConfig;const c={type:"folder",label:()=>h.name||"unnamed",expanded:!0,limitedUi:!0,children:[{type:"checkbox",label:"Visible",property:[h,"visible"],limitedUi:!0},{type:"button",label:"Pick/Focus",value:()=>{h.dispatchEvent({type:"select",ui:!0,value:h,focusCamera:!0})}},{type:"button",label:"Pick Parent",hidden:()=>!h.parent,value:()=>{const _=h.parent;_&&_.dispatchEvent({type:"select",ui:!0,value:_})}},{type:"input",label:"Name",property:[h,"name"],onChange:_=>{var b;_.last&&((b=h.setDirty)===null||b===void 0||b.call(h,{sceneUpdate:!0,refreshUi:!0}))}},{type:"checkbox",label:"Casts Shadow",hidden:()=>!h.isMesh,property:[h,"castShadow"]},{type:"checkbox",label:"Receive Shadow",hidden:()=>!h.isMesh,property:[h,"receiveShadow"]},{type:"checkbox",label:"Frustum culled",property:[h,"frustumCulled"]},{type:"vec3",label:"Position",property:[h,"position"],limitedUi:!0},{type:"vec3",label:"Rotation",property:[h,"rotation"],limitedUi:!0},{type:"vec3",label:"Scale",property:[h,"scale"]},{type:"input",label:"Render Order",property:[h,"renderOrder"]},{type:"button",label:"Auto Scale",prompt:["Auto Scale Radius: Object will be scaled to the given radius",h.userData.autoScaleRadius||"2",!0],value:_=>{if(!_)return;const b=parseFloat(_);return Math.abs(b)>0?(autoScaleObject3D(h,b),()=>autoScaleObject3D(h,b,void 0,!0)):void 0}},{type:"button",label:"Auto Center",value:()=>{if(confirm("Auto Center: Object will be centered, are you sure you want to proceed?"))return autoCenterObject3D(h),()=>autoCenterObject3D(h,!0)}},{type:"button",label:"Pivot to Node Center",value:()=>{if(confirm("Pivot to Center: Adjust the pivot to bounding box center. The object will rotate around the new pivot, are you sure you want to proceed?"))return pivotToBBoxCenter(h)}},{type:"folder",label:"Rotate model",children:["X +","X -","Y +","Y -","Z +","Z -"].map(_=>({type:"button",label:"Rotate "+_+"90",value:()=>{var b;h.rotateOnAxis(new three_module.Pq0(_.includes("X")?1:0,_.includes("Y")?1:0,_.includes("Z")?1:0),Math.PI/2*(_.includes("-")?-1:1)),(b=h.setDirty)===null||b===void 0||b.call(h,{sceneUpdate:!0,refreshUi:!1})}}))},h.userData.license!==void 0?{type:"input",label:"License/Credits",property:[h.userData,"license"],limitedUi:!0}:{}]},d=h;if(d!=null&&d.isMesh&&o!==!1){const _=[()=>{const b=Object.entries(d.morphTargetDictionary||{});return b.length?{label:"Morph Targets",type:"folder",children:b.map(([_e,it])=>({type:"slider",label:_e,bounds:[0,1],stepSize:1e-4,property:[d.morphTargetInfluences,it],onChange:nt=>{var at;(at=h.setDirty)===null||at===void 0||at.call(h,{sceneUpdate:nt.last,frameFade:!1,refreshUi:!1})}}))}:void 0},()=>{var b;return(b=d.geometry)===null||b===void 0?void 0:b.uiConfig},()=>{var b;return Array.isArray(d.material)?d.material.length<1?void 0:{label:"Materials",type:"folder",children:d.material.map(_e=>_e==null?void 0:_e.uiConfig).filter(_e=>_e)}:(b=d.material)===null||b===void 0?void 0:b.uiConfig}];c.children.push(..._)}if(h!=null&&h.isCamera){const _=[{type:"button",label:"Set View",value:()=>{var b;h.dispatchEvent({type:"setView",ui:!0,camera:h}),(b=c.uiRefresh)===null||b===void 0||b.call(c,"postFrame",!0)}},{type:"button",label:"Activate main",hidden:()=>{var b;return(b=h.userData.iCamera)===null||b===void 0?void 0:b.isActiveCamera},value:()=>{var b;h.dispatchEvent({type:"activateMain",ui:!0,camera:h}),(b=c.uiRefresh)===null||b===void 0||b.call(c,"postFrame",!0)}},{type:"button",label:"Deactivate main",hidden:()=>{var b;return!(!((b=h.userData.iCamera)===null||b===void 0)&&b.isActiveCamera)},value:()=>{var b;h.dispatchEvent({type:"activateMain",ui:!0,camera:void 0}),(b=c.uiRefresh)===null||b===void 0||b.call(c,"postFrame",!0)}},{type:"checkbox",label:"Auto LookAt Target",getValue:()=>{var b;return(b=h.userData.autoLookAtTarget)!==null&&b!==void 0&&b},setValue:b=>{var _e;h.userData.autoLookAtTarget=b,(_e=c.uiRefresh)===null||_e===void 0||_e.call(c,"postFrame",!0)}}];c.children.push(..._)}return h.uiConfig=c,c}function makeGeometryUiConfig(h){return{label:"Geometry",type:"folder",children:[{type:"input",property:[h,"uuid"],disabled:!0},{type:"input",property:[h,"name"]},{type:"button",label:"Center Geometry",value:()=>{h.center()}},{type:"button",label:"Center Geometry (keep position)",value:()=>{const o=new three_module.Pq0;h.center(o),o.negate();const c=h.userData.__appliedMeshes;for(const d of c)d.updateMatrix(),d.position.copy(o).applyMatrix4(d.matrix),d.setDirty&&d.setDirty()}},{type:"button",label:"Compute vertex normals",value:()=>{h.computeVertexNormals()}},{type:"button",label:"Compute vertex tangents",value:()=>{h.computeTangents()}},{type:"button",label:"Normalize normals",value:()=>{h.normalizeNormals()}},{type:"button",label:"Convert to indexed",hidden:()=>!!h.index,value:()=>{var o;if(h.attributes.index)return;const c=parseFloat((o=prompt("Tolerance","-1"))!==null&&o!==void 0?o:"-1");toIndexedGeometry(h,c)}},{type:"button",label:"Convert to non-indexed",hidden:()=>!h.index,value:()=>{h.attributes.index&&h.toNonIndexed()}},{type:"button",label:"Create uv1 from uv",value:()=>{h.hasAttribute("uv1")&&!confirm("uv1 already exists, replace with uv data?")||h.setAttribute("uv1",h.getAttribute("uv"))}},{type:"button",label:"Remove vertex color attribute",hidden:()=>!h.hasAttribute("color"),value:()=>{h.hasAttribute("color")?confirm("Remove color attribute?")&&h.deleteAttribute("color"):prompt("No color attribute found")}},{type:"button",label:"Auto GPU Instances",hidden:()=>!h.userData.__appliedMeshes||h.userData.__appliedMeshes.size<2,value:()=>{autoGPUInstanceMeshes(h)}},{type:"input",label:"Mesh count",get value(){var o,c,d;return(d=(c=(o=h.userData)===null||o===void 0?void 0:o.__appliedMeshes)===null||c===void 0?void 0:c.size)!==null&&d!==void 0?d:0},set value(o){},disabled:!0}]}}function setupIModel(h,o,c){var d;if(!h)return void console.warn("WebGi: setupIModel: object is undefined");if(h.__disposed&&(console.warn("WebGi: re-init/re-add disposed object, things might not work as intended",h),delete h.__disposed),h.userData||(h.userData={}),h.userData.__iModelSetup&&h.modelObject)return h;h.userData.__iModelSetup=!0;let _=[];_.push(()=>{[...h.children].forEach(pt=>{var mt;(mt=pt==null?void 0:pt.dispose)===null||mt===void 0||mt.call(pt),h.add(pt)}),h.parent&&h.removeFromParent()}),h.isLight&&!h.assetType?(h.assetType="light",h.lightObject=h):h.isCamera?(h.assetType="camera",h.cameraObject=h):h.assetType||(h.assetType="model"),h.modelObject||(h.modelObject=h),h.setDirty||(h.setDirty=(pt={})=>{h.dispatchEvent({...pt,type:"objectUpdate",object:h})},h.userData.setDirty&&console.warn("WebGi: userData.setDirty already defined",h.userData.setDirty,h),h.userData.setDirty=pt=>{var mt;console.warn("WebGi: userData.setDirty is deprecated, use setDirty directly"),(mt=h.setDirty)===null||mt===void 0||mt.call(h,pt)}),h.addEventListener("added",pt=>{var mt,ft,vt;const xt=(ft=(mt=h.parent)===null||mt===void 0?void 0:mt.userData.parentRoot)!==null&&ft!==void 0?ft:h.parent;xt!==h.userData.parentRoot&&h.traverse(At=>{At.userData.parentRoot=xt}),(vt=h.setDirty)===null||vt===void 0||vt.call(h,{change:"addedToParent"})}),h.addEventListener("removed",()=>{var pt;(pt=h.setDirty)===null||pt===void 0||pt.call(h,{change:"removedFromParent"}),h.userData.parentRoot!==void 0&&h.traverse(mt=>{mt.userData.parentRoot=void 0})}),_.push(()=>{});const b=h.dispose;h.dispose=()=>{h.dispatchEvent({type:"dispose"}),b==null||b.call(h)},h.userData.dispose&&console.warn("WebGi: userData.dispose already defined"),h.userData.dispose=()=>{var pt;console.warn("WebGi: userData.dispose is deprecated, use dispose directly"),(pt=h.dispose)===null||pt===void 0||pt.call(h)};const _e=h;!_e.isMesh&&!_e.isLine||_e.userData.__meshSetup||(_e.userData.__meshSetup=!0,_e.setMaterial||(_e.setMaterial=pt=>setMeshMaterial(_e,pt)),_e.setGeometry||(_e.setGeometry=(pt,mt=!1)=>setMeshGeometry(_e,pt,mt),_e.setGeometry(_e.geometry,!0)),h.userData.setMaterial&&console.warn("WebGi: userData.setMaterial already defined"),h.userData.setMaterial=pt=>{var mt;console.warn("WebGi: userData.setMaterial is deprecated, use setMaterial directly"),(mt=h.setMaterial)===null||mt===void 0||mt.call(h,pt)},h.userData.setGeometry&&console.warn("WebGi: userData.setGeometry already defined"),h.userData.setGeometry=(pt,...mt)=>{var ft;console.warn("WebGi: userData.setGeometry is deprecated, use setGeometry directly"),(ft=h.setGeometry)===null||ft===void 0||ft.call(h,pt,...mt)},h.userData.__keepShadowDef||(h.castShadow=!0,h.receiveShadow=!0,h.userData.__keepShadowDef=!0),_.push(()=>{var pt,mt,ft,vt;const xt=((pt=_e.setMaterial)===null||pt===void 0?void 0:pt.call(_e,void 0))||[],At=(mt=_e.setGeometry)===null||mt===void 0?void 0:mt.call(_e,void 0);for(const Ct of xt)Ct&&Ct.userData&&Ct.userData.disposeOnIdle!==!1&&Ct.dispose();At&&At.userData&&At.userData.disposeOnIdle!==!1&&At.dispose(),(ft=_e.setMaterial)===null||ft===void 0||ft.call(_e,xt),(vt=_e.setGeometry)===null||vt===void 0||vt.call(_e,At)})),h.uiConfig||h.assetType!=="model"&&h.assetType!=="camera"||(makeObject3DUiConfig(h),_.push(()=>{})),h.addEventListener("objectUpdate",({last:pt,refreshUi:mt})=>{var ft,vt;return pt!==!1&&mt!==!1&&((vt=(ft=h.uiConfig)===null||ft===void 0?void 0:ft.uiRefresh)===null||vt===void 0?void 0:vt.call(ft,"postFrame",!0,1))}),h.userData.__autoParentDispatchEvents?console.warn("WebGi: object.userData.__autoParentDispatchEvents already set"):(h.userData.__autoParentDispatchEvents=h.userData.__autoParentDispatchEvents||["objectUpdate","materialUpdate","select","materialChanged","textureUpdate"],h.isCamera&&h.userData.__autoParentDispatchEvents.push("activateMain","setView")),o&&(h.userData.parentRoot=o);const it=h.dispatchEvent;h.dispatchEvent=pt=>{var mt;!((mt=h.userData.__autoParentDispatchEvents)===null||mt===void 0)&&mt.includes(pt.type)&&(pt.parentDispatch=!0),pt.parentDispatch&&(ft=>{var vt;const xt=(vt=h.userData.parentRoot)!==null&&vt!==void 0?vt:h.parent;xt!=null&&xt.modelObject&&xt.dispatchEvent(ft)})(pt),it.call(h,pt)};const nt=h.clone;h.clone=(...pt)=>{const mt=h.userData;h.userData={};let ft=nt.call(h,...pt);h.userData=mt,copyObject3DUserData(ft.userData,mt);const vt=h.userData.parentRoot;return vt&&vt.assetType!=="model"&&console.warn("WebGi: Cloning an object with a parent that is not an IModel is not supported"),ft=setupIModel(ft,vt,c),ft.userData.cloneParent=h.uuid,ft};const at=h.copy;h.copy=(pt,...mt)=>{const ft=pt.userData;pt.userData={};const vt=at.call(h,pt,...mt);return pt.userData=ft,copyObject3DUserData(h.userData,pt),vt};const ut=h.add;return h.add=(...pt)=>(pt.forEach(mt=>setupIModel(mt,h.userData.parentRoot||h,c)),ut.call(h,...pt)),(h=(d=c==null?void 0:c(h))!==null&&d!==void 0?d:h).addEventListener("dispose",()=>{_.forEach(pt=>pt()),_=[]}),[...h.children].forEach(pt=>setupIModel(pt,h,c)),h}function setMeshMaterial(h,o){var c,d,_,b,_e;const it=(Array.isArray(o)?o:[o]).map(mt=>mt==null?void 0:mt.materialObject).filter(mt=>mt);if(h.material==it||it.length===1&&h.material===it[0])return[];h.userData.__materialUpdater||(h.userData.__materialUpdater=()=>{h.dispatchEvent({type:"materialUpdate"})}),h.userData.__textureUpdater||(h.userData.__textureUpdater=()=>{h.dispatchEvent({type:"textureUpdate"})});let nt=[];const at=[],ut=Array.isArray(h.material)?[...h.material]:[h.material];for(const mt of ut)mt&&nt.push(mt);const pt=[];for(const mt of it)mt.userData.__appliedMeshes||(mt.userData.__appliedMeshes=new Set),pt.push(mt),mt&&(nt.includes(mt)?nt=nt.filter(ft=>ft!==mt):at.push(mt));h.material=pt.length!==1?pt:(c=pt[0])!==null&&c!==void 0?c:void 0;for(const mt of nt)mt.removeEventListener("materialUpdate",h.userData.__materialUpdater),mt.removeEventListener("textureUpdate",h.userData.__textureUpdater),(_=(d=mt.userData)===null||d===void 0?void 0:d.__appliedMeshes)===null||_===void 0||_.delete(h),mt.dispatchEvent({type:"removeFromMesh",mesh:h,object:h});for(const mt of at)mt.addEventListener("materialUpdate",h.userData.__materialUpdater),mt.addEventListener("textureUpdate",h.userData.__textureUpdater),mt.userData.__appliedMeshes.add(h),mt.dispatchEvent({type:"addToMesh",mesh:h,object:h});return h.dispatchEvent({type:"materialChanged",material:o??void 0,mesh:h}),(_e=(b=h.uiConfig)===null||b===void 0?void 0:b.uiRefresh)===null||_e===void 0||_e.call(b,"postFrame",!0),ut}function setMeshGeometry(h,o,c=!1){var d,_,b,_e,it,nt,at;h.userData.__objectUpdater||(h.userData.__objectUpdater=mt=>{h.dispatchEvent({...mt,type:"objectUpdate"})});let ut=h.geometry;const pt=ut;return(ut!==o||c)&&(ut&&(ut.removeEventListener("geometryUpdate",h.userData.__objectUpdater),(_=(d=ut.userData)===null||d===void 0?void 0:d.__appliedMeshes)===null||_===void 0||_.delete(h)),ut=o,ut&&!ut.userData.__appliedMeshes&&(ut.userData.__appliedMeshes=new Set),h.geometry=(b=ut)!==null&&b!==void 0?b:void 0,ut&&(h.updateMorphTargets(),ut.addEventListener("geometryUpdate",h.userData.__objectUpdater),(it=(_e=ut.userData)===null||_e===void 0?void 0:_e.__appliedMeshes)===null||it===void 0||it.add(h))),o&&!o.uiConfig&&(o.uiConfig=makeGeometryUiConfig(h.geometry)),h.dispatchEvent({type:"geometryChanged",geometry:o??void 0}),(at=(nt=h.uiConfig)===null||nt===void 0?void 0:nt.uiRefresh)===null||at===void 0||at.call(nt,"postFrame",!0),pt===ut?void 0:pt||void 0}const iGeometryIgnoredUserData=["appliedMeshes"],iModelIgnoredUserData=["parentRoot","iCamera","iModel"];function copyObject3DUserData(h,o){if(o)for(const c of Object.keys(o))iModelIgnoredUserData.includes(c)||c.startsWith("__")||typeof h[c]!="function"&&typeof o[c]!="function"&&(h[c]=o[c]);return h}var getRandomValues,rnds8=new Uint8Array(16);function rng(){if(!getRandomValues&&!(getRandomValues=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return getRandomValues(rnds8)}var regex=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function validate(h){return typeof h=="string"&&regex.test(h)}for(var esm_browser_validate=validate,byteToHex=[],i=0;i<256;++i)byteToHex.push((i+256).toString(16).substr(1));function stringify(h){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,c=(byteToHex[h[o+0]]+byteToHex[h[o+1]]+byteToHex[h[o+2]]+byteToHex[h[o+3]]+"-"+byteToHex[h[o+4]]+byteToHex[h[o+5]]+"-"+byteToHex[h[o+6]]+byteToHex[h[o+7]]+"-"+byteToHex[h[o+8]]+byteToHex[h[o+9]]+"-"+byteToHex[h[o+10]]+byteToHex[h[o+11]]+byteToHex[h[o+12]]+byteToHex[h[o+13]]+byteToHex[h[o+14]]+byteToHex[h[o+15]]).toLowerCase();if(!esm_browser_validate(c))throw TypeError("Stringified UUID is invalid");return c}var esm_browser_stringify=stringify;function v4(h,o,c){var d=(h=h||{}).random||(h.rng||rng)();if(d[6]=15&d[6]|64,d[8]=63&d[8]|128,o){c=c||0;for(var _=0;_<16;++_)o[c+_]=d[_];return o}return esm_browser_stringify(d)}var esm_browser_v4=v4;const uiConfigDecorators_typeMap=new Map;function uiConfig(h,o){return(c,d)=>{const _=c.constructor;if(_===Object)throw new Error("All properties in an object are serialized by default");uiConfigDecorators_typeMap.has(_)||uiConfigDecorators_typeMap.set(_,[]);const b=uiConfigDecorators_typeMap.get(_);if(!(b.findIndex(_e=>_e.propKey===d)<0))throw new Error(`Property ${d} already has a uiConfig decorator`);b.push({params:o||{},propKey:d,uiType:h})}}function uiToggle(h,o){return uiConfig("checkbox",{label:h,params:o})}function uiMonitor(h,o){return uiConfig("monitor",{label:h,params:o})}function uiSlider(h,o,c,d){return uiConfig("slider",{label:h,bounds:o,stepSize:c,params:d})}function uiVector(h,o,c,d){return uiConfig("vec",{label:h,bounds:o,stepSize:c,params:d})}function uiDropdown(h,o,c){return uiConfig("dropdown",{label:h,children:o,params:c})}function uiButton(h,o){return uiConfig("button",{label:h,params:o})}function uiInput(h,o){return uiConfig("input",{label:h,params:o})}function uiColor(h,o){return uiConfig("color",{label:h,params:o})}function uiImage(h,o){return uiConfig("image",{label:h,params:o})}function generateUiConfig(h){let o=h==null?void 0:h.constructor;if(!h||!o)return[];const c=[],d=[];for(;o&&o!==Object;)d.push(o),o=Object.getPrototypeOf(o);if(!d.length||Array.isArray(h)){const _=typeof h=="object"?Object.keys(h):Array.isArray(h)?h.map((b,_e)=>_e):[];for(const b of _){const _e=h[b];if(_e==null)continue;const it=_e==null?void 0:_e.uiConfig;if(it)c.push(it);else{const nt=valueToUiType(_e);nt==="folder"?c.push(generateUiFolder(b+"",_e,void 0,"folder",!0)):nt&&c.push({type:nt,label:b+"",property:[h,b]})}}}return d.reverse().forEach(_=>{var b;(b=uiConfigDecorators_typeMap.get(_))===null||b===void 0||b.forEach(({params:_e,propKey:it,uiType:nt})=>{let at;if(!nt){const ut=h[it];at=ut==null?void 0:ut.uiConfig,at?c.push(at):ut!=null&&((nt=valueToUiType(ut))==="folder"?at=generateUiFolder(it+"",ut,void 0,"folder",!0):nt&&(at={type:nt,label:it+"",property:[h,it]}))}if(at||(at={property:[h,it],type:nt||"input"}),_e){const ut=typeof _e.params=="function"?_e.params(h):_e.params||{};delete _e.params,Object.assign(at,{..._e,...ut})}c.push(at)})}),c}function generateUiFolder(h,o,c={},d="folder",_=!1){return{type:d,label:h,children:_?[()=>generateUiConfig(Ee$1(o))]:generateUiConfig(Ee$1(o)),uuid:esm_browser_v4(),...c}}function uiFolder(h,o,c="folder"){return d=>class extends d{constructor(){super(...arguments),this.uiConfig=generateUiFolder(h,this,o||{},c)}}}function uiPanel(h,o){return uiFolder(h,o,"panel")}function valueToUiType(h){return h==null?null:Array.isArray(h)?"folder":typeof h=="boolean"?"checkbox":typeof h=="number"?"number":typeof h=="string"?"input":typeof h=="function"?"button":typeof h.x=="number"?"vec":typeof h.r=="number"?"color":h.isTexture?"image":typeof h=="object"?"folder":null}const _changeEvent={type:"change"},_startEvent={type:"start"},_endEvent={type:"end"},_ray=new three_module.RlV,_plane=new three_module.Zcv,TILT_LIMIT=Math.cos(70*three_module.cj9.DEG2RAD);class OrbitControls extends three_module.Qev{constructor(o,c){super(),this.object=o,this.domElement=c,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new three_module.Pq0,this.minDistance=1e-5,this.maxDistance=1/0,this.autoPushTarget=!0,this.autoPullTarget=!0,this.clampMax=new three_module.Pq0(1/0,1/0,1/0),this.clampMin=new three_module.Pq0(-1/0,-1/0,-1/0),this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.maxZoomSpeed=1,this.maxZoomSpeed=1,this.dollyZoom=!1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.throttleUpdate=0,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:three_module.kBv.ROTATE,MIDDLE:three_module.kBv.DOLLY,RIGHT:three_module.kBv.PAN},this.touches={ONE:three_module.wtR.ROTATE,TWO:three_module.wtR.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return it.phi},this.getAzimuthalAngle=function(){return it.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(or){or.addEventListener("keydown",Tn),this._domElementKeyEvents=or},this.stopListenToKeyEvents=function(){this._domElementKeyEvents.removeEventListener("keydown",Tn),this._domElementKeyEvents=null},this.saveState=function(){d.target0.copy(d.target),d.position0.copy(d.object.position),d.zoom0=d.object.zoom},this.reset=function(){d.target.copy(d.target0),d.object.position.copy(d.position0),d.object.zoom=d.zoom0,d.object.updateProjectionMatrix(),d.dispatchEvent(_changeEvent),d.update(),b=_.NONE},this.update=function(){const or=new three_module.Pq0,yr=new three_module.PTz().setFromUnitVectors(o.up,new three_module.Pq0(0,1,0)),Pr=yr.clone().invert(),jr=new three_module.Pq0,Tr=new three_module.PTz,Br=new three_module.Pq0,Gr=2*Math.PI;return function(tn=null){if(this.throttleUpdate&&this.throttleUpdate>=1&&Date.now()-0<1e3/this.throttleUpdate)return;const nn=d.object.position;or.copy(nn).sub(d.target),or.applyQuaternion(yr),it.setFromVector3(or),d.autoRotate&&b===_.NONE&&Ht(function(Cn){return Cn!==null?2*Math.PI/60*d.autoRotateSpeed*Cn:2*Math.PI/60/60*d.autoRotateSpeed}(tn)),d.enableDamping?(it.theta+=nt.theta*d.dampingFactor,it.phi+=nt.phi*d.dampingFactor):(it.theta+=nt.theta,it.phi+=nt.phi);let gn=d.minAzimuthAngle,xn=d.maxAzimuthAngle;isFinite(gn)&&isFinite(xn)&&(gn<-Math.PI?gn+=Gr:gn>Math.PI&&(gn-=Gr),xn<-Math.PI?xn+=Gr:xn>Math.PI&&(xn-=Gr),it.theta=gn<=xn?Math.max(gn,Math.min(xn,it.theta)):it.theta>(gn+xn)/2?Math.max(gn,it.theta):Math.min(xn,it.theta)),it.phi=Math.max(d.minPolarAngle,Math.min(d.maxPolarAngle,it.phi)),it.makeSafe(),d.enableDamping===!0?d.target.addScaledVector(ut,d.dampingFactor):d.target.add(ut);let Mn=0;d.zoomToCursor&&zt||d.object.isOrthographicCamera||(Math.abs(nt.radius)>0&&(d.dollyZoom&&(d.object.zoom=Math.max(Math.max(d.minZoom,.1),Math.min(Math.min(d.maxZoom,20),d.object.zoom*(1+nt.radius*(d.enableDamping?d.dampingFactor:1)))),d.object.updateProjectionMatrix(),(d.object.zoom>=Math.min(d.maxZoom,20)||d.object.zoom<=Math.max(d.minZoom,.1))&&(nt.radius=0)),it.radius*=1+nt.radius*(d.enableDamping?d.dampingFactor:1)),Math.abs(at-1)>1e-5&&(d.dollyZoom&&(d.object.zoom=Math.max(Math.max(d.minZoom,.1),Math.min(Math.min(d.maxZoom,20),d.object.zoom*at)),d.object.updateProjectionMatrix(),(d.object.zoom>=Math.min(d.maxZoom,20)||d.object.zoom<=Math.max(d.minZoom,.1))&&(at=1)),it.radius*=at),d.autoPushTarget&&it.radius<d.minDistance&&(Mn=d.minDistance-it.radius),d.autoPullTarget&&it.radius>d.maxDistance&&(Mn=d.maxDistance-it.radius)),it.radius=dr(it.radius),or.setFromSpherical(it),or.applyQuaternion(Pr),nn.copy(d.target).add(or),d.target.add(or.normalize().multiplyScalar(-Mn)),nn.clamp(d.clampMin,d.clampMax),d.target.clamp(d.clampMin,d.clampMax),d.object.lookAt(d.target);let An=!1;d.enableDamping===!0&&Math.abs(nt.theta)+Math.abs(nt.phi)+Math.abs(nt.radius)+ut.length()>.001?(nt.theta*=1-d.dampingFactor,nt.phi*=1-d.dampingFactor,nt.radius*=1-d.dampingFactor,ut.multiplyScalar(1-d.dampingFactor),An=!0):(nt.set(0,0,0),ut.set(0,0,0));let vn=!1;if(d.zoomToCursor&&zt){let Cn=null;if(d.object.isPerspectiveCamera){const rn=it.radius;Cn=it.radius*at,Cn=dr(Cn);const En=rn-Cn;d.object.position.addScaledVector(kt,En),d.object.updateMatrixWorld()}else if(d.object.isOrthographicCamera){const rn=new three_module.Pq0(Dt.x,Dt.y,0);rn.unproject(d.object),d.object.zoom=Math.max(d.minZoom,Math.min(d.maxZoom,d.object.zoom/at)),d.object.updateProjectionMatrix(),vn=!0;const En=new three_module.Pq0(Dt.x,Dt.y,0);En.unproject(d.object),d.object.position.sub(En).add(rn),d.object.updateMatrixWorld(),Cn=it.radius}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),d.zoomToCursor=!1;Cn!==null&&(this.screenSpacePanning?d.target.set(0,0,-1).transformDirection(d.object.matrix).multiplyScalar(Cn).add(d.object.position):(_ray.origin.copy(d.object.position),_ray.direction.set(0,0,-1).transformDirection(d.object.matrix),Math.abs(d.object.up.dot(_ray.direction))<TILT_LIMIT?o.lookAt(d.target):(_plane.setFromNormalAndCoplanarPoint(d.object.up,d.target),_ray.intersectPlane(_plane,d.target))))}else d.object.isOrthographicCamera&&(d.object.zoom=Math.max(d.minZoom,Math.min(d.maxZoom,d.object.zoom/at)),d.object.updateProjectionMatrix(),vn=!0);return at=1,zt=!1,!!(vn||An||jr.distanceToSquared(d.object.position)>_e||8*(1-Tr.dot(d.object.quaternion))>_e||Br.distanceToSquared(d.target)>0)&&(d.dispatchEvent(_changeEvent),jr.copy(d.object.position),Tr.copy(d.object.quaternion),Br.copy(d.target),vn=!1,!0)}}(),this.stopDamping=function(){nt.set(0,0,0),ut.set(0,0,0)},this.dispose=function(){d.domElement.removeEventListener("contextmenu",yn),d.domElement.removeEventListener("pointerdown",Rr),d.domElement.removeEventListener("pointercancel",Zr),d.domElement.removeEventListener("wheel",cn),d.domElement.removeEventListener("pointermove",Yr),d.domElement.removeEventListener("pointerup",Zr),d._domElementKeyEvents!==null&&(d._domElementKeyEvents.removeEventListener("keydown",Tn),d._domElementKeyEvents=null)};const d=this,_={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let b=_.NONE;const _e=1e-6,it=new three_module.YHV,nt=new three_module.YHV(0,0,0);let at=1;const ut=new three_module.Pq0,pt=new three_module.I9Y,mt=new three_module.I9Y,ft=new three_module.I9Y,vt=new three_module.I9Y,xt=new three_module.I9Y,At=new three_module.I9Y,Ct=new three_module.I9Y,Et=new three_module.I9Y,Tt=new three_module.I9Y,kt=new three_module.Pq0,Dt=new three_module.I9Y;let zt=!1;const Bt=[],Rt={};function Ut(){return!d.enableDamping||d.zoomToCursor||d.object.isOrthographicCamera?Math.pow(.95,d.zoomSpeed):1}function Ht(or){nt.theta-=or}function Jt(or){nt.phi-=or}this.rotateUp=Jt,this.rotateLeft=Ht;const Kt=function(){const or=new three_module.Pq0;return function(yr,Pr){or.setFromMatrixColumn(Pr,0),or.multiplyScalar(-yr),ut.add(or)}}(),sr=function(){const or=new three_module.Pq0;return function(yr,Pr){d.screenSpacePanning===!0?or.setFromMatrixColumn(Pr,1):(or.setFromMatrixColumn(Pr,0),or.crossVectors(d.object.up,or)),or.multiplyScalar(yr),ut.add(or)}}(),ir=function(){const or=new three_module.Pq0;return function(yr,Pr){const jr=d.domElement;if(d.object.isPerspectiveCamera){const Tr=d.object.position;or.copy(Tr).sub(d.target);let Br=or.length();Br*=Math.tan(d.object.fov/2*Math.PI/180),Kt(2*yr*Br/jr.clientHeight,d.object.matrix),sr(2*Pr*Br/jr.clientHeight,d.object.matrix)}else d.object.isOrthographicCamera?(Kt(yr*(d.object.right-d.object.left)/d.object.zoom/jr.clientWidth,d.object.matrix),sr(Pr*(d.object.top-d.object.bottom)/d.object.zoom/jr.clientHeight,d.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),d.enablePan=!1)}}();function cr(or,yr=0){d.object.isPerspectiveCamera||d.object.isOrthographicCamera?(at/=or,nt.radius=Math.max(-d.maxZoomSpeed,Math.min(d.maxZoomSpeed,nt.radius-yr))):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),d.enableZoom=!1)}function lr(or,yr=0){d.object.isPerspectiveCamera||d.object.isOrthographicCamera?(at*=or,nt.radius=Math.max(-d.maxZoomSpeed,Math.min(d.maxZoomSpeed,nt.radius+yr))):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),d.enableZoom=!1)}function hr(or){if(!d.zoomToCursor)return;zt=!0;const yr=d.domElement.getBoundingClientRect(),Pr=or.clientX-yr.left,jr=or.clientY-yr.top,Tr=yr.width,Br=yr.height;Dt.x=Pr/Tr*2-1,Dt.y=-jr/Br*2+1,kt.set(Dt.x,Dt.y,1).unproject(d.object).sub(d.object.position).normalize()}function dr(or){return Math.max(d.minDistance,Math.min(d.maxDistance,or))}function pr(or){pt.set(or.clientX,or.clientY)}function ur(or){vt.set(or.clientX,or.clientY)}function xr(){if(Bt.length===1)pt.set(Bt[0].pageX,Bt[0].pageY);else{const or=.5*(Bt[0].pageX+Bt[1].pageX),yr=.5*(Bt[0].pageY+Bt[1].pageY);pt.set(or,yr)}}function vr(){if(Bt.length===1)vt.set(Bt[0].pageX,Bt[0].pageY);else{const or=.5*(Bt[0].pageX+Bt[1].pageX),yr=.5*(Bt[0].pageY+Bt[1].pageY);vt.set(or,yr)}}function Dr(){const or=Bt[0].pageX-Bt[1].pageX,yr=Bt[0].pageY-Bt[1].pageY,Pr=Math.sqrt(or*or+yr*yr);Ct.set(0,Pr)}function _r(or){if(Bt.length==1)mt.set(or.pageX,or.pageY);else{const Pr=gs(or),jr=.5*(or.pageX+Pr.x),Tr=.5*(or.pageY+Pr.y);mt.set(jr,Tr)}ft.subVectors(mt,pt).multiplyScalar(d.rotateSpeed);const yr=d.domElement;Ht(2*Math.PI*ft.x/yr.clientHeight),Jt(2*Math.PI*ft.y/yr.clientHeight),pt.copy(mt)}function rr(or){if(Bt.length===1)xt.set(or.pageX,or.pageY);else{const yr=gs(or),Pr=.5*(or.pageX+yr.x),jr=.5*(or.pageY+yr.y);xt.set(Pr,jr)}At.subVectors(xt,vt).multiplyScalar(d.panSpeed),ir(At.x,At.y),vt.copy(xt)}function mr(or){const yr=gs(or),Pr=or.pageX-yr.x,jr=or.pageY-yr.y,Tr=Math.sqrt(Pr*Pr+jr*jr);Et.set(0,Tr),Tt.set(0,Math.pow(Et.y/Ct.y,6*d.zoomSpeed)),cr(Tt.y),Ct.copy(Et)}function Rr(or){d.enabled!==!1&&(Bt.length===0&&(d.domElement.setPointerCapture(or.pointerId),d.domElement.addEventListener("pointermove",Yr),d.domElement.addEventListener("pointerup",Zr)),function(yr){Bt.push(yr)}(or),or.pointerType==="touch"?function(yr){switch(zn(yr),Bt.length){case 1:switch(d.touches.ONE){case three_module.wtR.ROTATE:if(d.enableRotate===!1)return;xr(),b=_.TOUCH_ROTATE;break;case three_module.wtR.PAN:if(d.enablePan===!1)return;vr(),b=_.TOUCH_PAN;break;default:b=_.NONE}break;case 2:switch(d.touches.TWO){case three_module.wtR.DOLLY_PAN:if(d.enableZoom===!1&&d.enablePan===!1)return;d.enableZoom&&Dr(),d.enablePan&&vr(),b=_.TOUCH_DOLLY_PAN;break;case three_module.wtR.DOLLY_ROTATE:if(d.enableZoom===!1&&d.enableRotate===!1)return;d.enableZoom&&Dr(),d.enableRotate&&xr(),b=_.TOUCH_DOLLY_ROTATE;break;default:b=_.NONE}break;default:b=_.NONE}b!==_.NONE&&d.dispatchEvent(_startEvent)}(or):function(yr){let Pr;switch(yr.button){case 0:Pr=d.mouseButtons.LEFT;break;case 1:Pr=d.mouseButtons.MIDDLE;break;case 2:Pr=d.mouseButtons.RIGHT;break;default:Pr=-1}switch(Pr){case three_module.kBv.DOLLY:if(d.enableZoom===!1)return;(function(jr){hr(jr),Ct.set(jr.clientX,jr.clientY)})(yr),b=_.DOLLY;break;case three_module.kBv.ROTATE:if(yr.ctrlKey||yr.metaKey||yr.shiftKey){if(d.enablePan===!1)return;ur(yr),b=_.PAN}else{if(d.enableRotate===!1)return;pr(yr),b=_.ROTATE}break;case three_module.kBv.PAN:if(yr.ctrlKey||yr.metaKey||yr.shiftKey){if(d.enableRotate===!1)return;pr(yr),b=_.ROTATE}else{if(d.enablePan===!1)return;ur(yr),b=_.PAN}break;default:b=_.NONE}b!==_.NONE&&d.dispatchEvent(_startEvent)}(or))}function Yr(or){d.enabled!==!1&&(or.pointerType==="touch"?function(yr){switch(zn(yr),b){case _.TOUCH_ROTATE:if(d.enableRotate===!1)return;_r(yr),d.update();break;case _.TOUCH_PAN:if(d.enablePan===!1)return;rr(yr),d.update();break;case _.TOUCH_DOLLY_PAN:if(d.enableZoom===!1&&d.enablePan===!1)return;(function(Pr){d.enableZoom&&mr(Pr),d.enablePan&&rr(Pr)})(yr),d.update();break;case _.TOUCH_DOLLY_ROTATE:if(d.enableZoom===!1&&d.enableRotate===!1)return;(function(Pr){d.enableZoom&&mr(Pr),d.enableRotate&&_r(Pr)})(yr),d.update();break;default:b=_.NONE}}(or):or.buttons?function(yr){switch(b){case _.ROTATE:if(d.enableRotate===!1)return;(function(Pr){mt.set(Pr.clientX,Pr.clientY),ft.subVectors(mt,pt).multiplyScalar(d.rotateSpeed);const jr=d.domElement;Ht(2*Math.PI*ft.x/jr.clientHeight),Jt(2*Math.PI*ft.y/jr.clientHeight),pt.copy(mt),d.update()})(yr);break;case _.DOLLY:if(d.enableZoom===!1)return;(function(Pr){Et.set(Pr.clientX,Pr.clientY),Tt.subVectors(Et,Ct),Tt.y>0?cr(Ut()):Tt.y<0&&lr(Ut()),Ct.copy(Et),d.update()})(yr);break;case _.PAN:if(d.enablePan===!1)return;(function(Pr){xt.set(Pr.clientX,Pr.clientY),At.subVectors(xt,vt).multiplyScalar(d.panSpeed),ir(At.x,At.y),vt.copy(xt),d.update()})(yr)}}(or):Zr(or))}function Zr(or){(function(yr){delete Rt[yr.pointerId];for(let Pr=0;Pr<Bt.length;Pr++)if(Bt[Pr].pointerId==yr.pointerId)return void Bt.splice(Pr,1)})(or),Bt.length===0&&(d.domElement.releasePointerCapture(or.pointerId),d.domElement.removeEventListener("pointermove",Yr),d.domElement.removeEventListener("pointerup",Zr)),d.dispatchEvent(_endEvent),b=_.NONE}function cn(or){d.enabled!==!1&&d.enableZoom!==!1&&b===_.NONE&&(or.preventDefault(),d.dispatchEvent(_startEvent),function(yr){hr(yr);let Pr=0;switch(yr.deltaMode){case 2:Pr+=1*yr.deltaY;break;case 1:Pr+=.4*yr.deltaY;break;default:Pr+=.01*yr.deltaY}yr.deltaY<0?d.zoomToCursor||d.object.isOrthographicCamera?lr(Ut()):lr(1,Pr*d.zoomSpeed):yr.deltaY>0&&(d.zoomToCursor||d.object.isOrthographicCamera?cr(Ut()):cr(1,-Pr*d.zoomSpeed)),d.update()}(or),d.dispatchEvent(_endEvent))}function Tn(or){d.enabled!==!1&&d.enablePan!==!1&&function(yr){let Pr=!1;switch(yr.code){case d.keys.UP:yr.ctrlKey||yr.metaKey||yr.shiftKey?Jt(2*Math.PI*d.rotateSpeed/d.domElement.clientHeight):ir(0,d.keyPanSpeed),Pr=!0;break;case d.keys.BOTTOM:yr.ctrlKey||yr.metaKey||yr.shiftKey?Jt(-2*Math.PI*d.rotateSpeed/d.domElement.clientHeight):ir(0,-d.keyPanSpeed),Pr=!0;break;case d.keys.LEFT:yr.ctrlKey||yr.metaKey||yr.shiftKey?Ht(2*Math.PI*d.rotateSpeed/d.domElement.clientHeight):ir(d.keyPanSpeed,0),Pr=!0;break;case d.keys.RIGHT:yr.ctrlKey||yr.metaKey||yr.shiftKey?Ht(-2*Math.PI*d.rotateSpeed/d.domElement.clientHeight):ir(-d.keyPanSpeed,0),Pr=!0}Pr&&(yr.preventDefault(),d.update())}(or)}function yn(or){d.enabled!==!1&&or.preventDefault()}function zn(or){let yr=Rt[or.pointerId];yr===void 0&&(yr=new three_module.I9Y,Rt[or.pointerId]=yr),yr.set(or.pageX,or.pageY)}function gs(or){const yr=or.pointerId===Bt[0].pointerId?Bt[1]:Bt[0];return Rt[yr.pointerId]}this.zoomIn=function(or){cr(1,or*d.zoomSpeed)},this.zoomOut=function(or){lr(1,or*d.zoomSpeed)},d.domElement.addEventListener("contextmenu",yn),d.domElement.addEventListener("pointerdown",Rr),d.domElement.addEventListener("pointercancel",Zr),d.domElement.addEventListener("wheel",cn,{passive:!1}),this.update()}}var OrbitControls3_decorate=function(h,o,c,d){var _,b=arguments.length,_e=b<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_e=Reflect.decorate(h,o,c,d);else for(var it=h.length-1;it>=0;it--)(_=h[it])&&(_e=(b<3?_(_e):b>3?_(o,c,_e):_(o,c))||_e);return b>3&&_e&&Object.defineProperty(o,c,_e),_e};let OrbitControls3=class extends OrbitControls{constructor(){super(...arguments),this.type="OrbitControls",this.enabled=!0,this.dollyZoom=!1,this.zoomToCursor=!1,this.enableDamping=!0,this.dampingFactor=.08,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableZoom=!0,this.zoomSpeed=.15,this.maxZoomSpeed=.2,this.enableRotate=!0,this.rotateSpeed=2,this.enablePan=!0,this.panSpeed=1,this._autoPushTarget=!1,this.autoPushTarget2=!1,this.autoPullTarget=!1,this.minDistance=.35,this.maxDistance=1e3,this.minZoom=.01,this.maxZoom=1e3,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1e6,this.maxAzimuthAngle=1e6,this.clampMin=new three_module.Pq0(-1e6,-1e6,-1e6),this.clampMax=new three_module.Pq0(1e6,1e6,1e6),this.screenSpacePanning=!0,this.keyPanSpeed=7,this.throttleUpdate=60}get autoPushTarget(){return this._autoPushTarget||this.autoPushTarget2}set autoPushTarget(h){this._autoPushTarget=h}zoomIn(h){super.zoomIn(h)}zoomOut(h){super.zoomOut(h)}dispatchEvent(h){super.dispatchEvent(h)}};OrbitControls3_decorate([serialize()],OrbitControls3.prototype,"type",void 0),OrbitControls3_decorate([uiToggle()],OrbitControls3.prototype,"enabled",void 0),OrbitControls3_decorate([uiToggle(),serialize()],OrbitControls3.prototype,"dollyZoom",void 0),OrbitControls3_decorate([uiToggle(),serialize()],OrbitControls3.prototype,"zoomToCursor",void 0),OrbitControls3_decorate([uiToggle(),serialize()],OrbitControls3.prototype,"enableDamping",void 0),OrbitControls3_decorate([uiInput(),serialize()],OrbitControls3.prototype,"dampingFactor",void 0),OrbitControls3_decorate([uiToggle(),serialize()],OrbitControls3.prototype,"autoRotate",void 0),OrbitControls3_decorate([uiInput(),serialize()],OrbitControls3.prototype,"autoRotateSpeed",void 0),OrbitControls3_decorate([uiToggle(),serialize()],OrbitControls3.prototype,"enableZoom",void 0),OrbitControls3_decorate([uiInput(),serialize()],OrbitControls3.prototype,"zoomSpeed",void 0),OrbitControls3_decorate([uiInput(),serialize()],OrbitControls3.prototype,"maxZoomSpeed",void 0),OrbitControls3_decorate([uiToggle(),serialize()],OrbitControls3.prototype,"enableRotate",void 0),OrbitControls3_decorate([uiInput(),serialize()],OrbitControls3.prototype,"rotateSpeed",void 0),OrbitControls3_decorate([uiToggle(),serialize()],OrbitControls3.prototype,"enablePan",void 0),OrbitControls3_decorate([uiInput(),serialize()],OrbitControls3.prototype,"panSpeed",void 0),OrbitControls3_decorate([uiInput(),serialize("autoPushTarget")],OrbitControls3.prototype,"_autoPushTarget",void 0),OrbitControls3_decorate([uiInput(),serialize()],OrbitControls3.prototype,"autoPullTarget",void 0),OrbitControls3_decorate([uiInput(),serialize()],OrbitControls3.prototype,"minDistance",void 0),OrbitControls3_decorate([uiInput(),serialize()],OrbitControls3.prototype,"maxDistance",void 0),OrbitControls3_decorate([uiInput(),serialize()],OrbitControls3.prototype,"minZoom",void 0),OrbitControls3_decorate([uiInput(),serialize()],OrbitControls3.prototype,"maxZoom",void 0),OrbitControls3_decorate([uiInput(),serialize()],OrbitControls3.prototype,"minPolarAngle",void 0),OrbitControls3_decorate([uiInput(),serialize()],OrbitControls3.prototype,"maxPolarAngle",void 0),OrbitControls3_decorate([uiInput(),serialize()],OrbitControls3.prototype,"minAzimuthAngle",void 0),OrbitControls3_decorate([uiInput(),serialize()],OrbitControls3.prototype,"maxAzimuthAngle",void 0),OrbitControls3_decorate([uiVector(),serialize()],OrbitControls3.prototype,"clampMin",void 0),OrbitControls3_decorate([uiVector(),serialize()],OrbitControls3.prototype,"clampMax",void 0),OrbitControls3_decorate([serialize()],OrbitControls3.prototype,"screenSpacePanning",void 0),OrbitControls3_decorate([serialize()],OrbitControls3.prototype,"keyPanSpeed",void 0),OrbitControls3=OrbitControls3_decorate([uiPanel("Orbit Controls")],OrbitControls3);var CameraController_decorate=function(h,o,c,d){var _,b=arguments.length,_e=b<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_e=Reflect.decorate(h,o,c,d);else for(var it=h.length-1;it>=0;it--)(_=h[it])&&(_e=(b<3?_(_e):b>3?_(o,c,_e):_(o,c))||_e);return b>3&&_e&&Object.defineProperty(o,c,_e),_e};class CameraController extends three_module.Qev{get controls(){return this._controls}getControls(){return this._controls}get userData(){return this._camera.modelObject.userData}set userData(o){this._camera.modelObject.userData=o}get isActiveCamera(){return this._isActiveCamera}get target(){return this._target}set target(o){const c=this._target.sub(o).length()>0;this._target.copy(o),c&&this.targetUpdated()}get position(){return this._position}set position(o){const c=this._position.sub(o).length()>0;this._position.copy(o),c&&this.positionUpdated()}get name(){return this._camera.name}set name(o){this._camera.name=o}getCameraOptions(){return{...this._options,position:this._position.toArray(),target:this._target.toArray()}}setCameraOptions(o,c=!0){var d,_;const b={...o};!((d=b.position)===null||d===void 0)&&d.isVector3&&(b.position=[b.position.x,b.position.y,b.position.z]),!((_=b.target)===null||_===void 0)&&_.isVector3&&(b.target=[b.target.x,b.target.y,b.target.z]),Object.keys(b).forEach(_e=>_e!=="frustumSize"&&b[_e]===void 0&&delete b[_e]),Object.assign(this._options,b),this._refreshCameraOptions(!1),this.refreshCameraControls(!1),c&&this.setDirty({optionsUpdate:!0})}_refreshCameraOptions(o=!0){let c=this._camera.modelObject;if(this._options.type!==c.type){const _=this._options.type==="PerspectiveCamera"?new three_module.ubm:new three_module.qUd;_.name=this._camera.name,_.near=this._camera.modelObject.near,_.far=this._camera.modelObject.far,_.zoom=this._camera.modelObject.zoom,_.scale.copy(this._camera.modelObject.scale);const b=this._isActiveCamera;b&&this.deactivateMain(),this._camera=this._setCameraObject(_),c=this._camera.modelObject,b&&this.activateMain(),this._camera.modelObject.updateProjectionMatrix()}let d=this._options.aspect;if(d==="auto"&&(d=this._container.clientWidth/this._container.clientHeight,isFinite(d)||(d=1)),this._options.position&&(this.position.set(...this._options.position),delete this._options.position),this._options.target&&(this.target.set(...this._options.target),delete this._options.target),this.positionUpdated(!1),this._options.type==="PerspectiveCamera"&&(c.fov=this._options.fov,c.focus=this._options.focus,c.aspect=d),this._options.type==="OrthographicCamera"){const _=this._options.frustumSize;_!==void 0?(c.top=_/2,c.bottom=-_/2,c.left=d*_/2,c.right=-d*_/2):(c.top=this._options.top,c.bottom=this._options.bottom,c.left=this._options.left,c.right=this._options.right)}c.zoom=this._options.zoom,this._nearFarChanged(),o&&this.setDirty()}_setCameraObject(o){return this._camera&&this._camera.removeEventListener("objectUpdate",this._cameraObjectUpdate),this._camera=setupIModel(o),this._camera.addEventListener("objectUpdate",this._cameraObjectUpdate),this._camera}get interactionsEnabled(){return this._interactionsDisabledBy.size===0&&this._isActiveCamera&&this._options.controlsEnabled&&this._options.controlsMode!==""}set interactionsEnabled(o){this.setInteractions(o,"_default")}setInteractions(o,c){const d=this._interactionsDisabledBy.size;o?this._interactionsDisabledBy.delete(c):this._interactionsDisabledBy.add(c),d!==this._interactionsDisabledBy.size&&this.refreshCameraControls(!0)}_nearFarChanged(){this._camera&&(this._camera.modelObject.near=this.near,this._camera.modelObject.far=this.far,this._camera.modelObject.updateProjectionMatrix())}constructor(o,c,d){super(),this._controlsMode="",this._isActiveCamera=!1,this._cameraObjectUpdate=_e=>{this.setDirty(_e)},this._interactionsDisabledBy=new Set,this.autoLookAtTarget=!1,this.near=.01,this.far=50,this._options={type:"PerspectiveCamera",aspect:"auto",focus:10,fov:25,zoom:1,frustumSize:1,top:1,bottom:-1,left:-1,right:1,controlsMode:"orbit",controlsEnabled:!0},this._position=new three_module.Pq0(0,0,10),this._target=new three_module.Pq0(0,0,0),this._controlsCtors=new Map([["orbit",(_e,it)=>{const nt=new OrbitControls3(_e,it.ownerDocument?it:it.documentElement);return nt.screenSpacePanning=!0,nt}]]),this._positionWorld=new three_module.Pq0,this._camUi=[{type:"vec3",label:"Position",property:[this,"position"],onChange:()=>this.positionUpdated(!0)},{type:"vec3",label:"Target",property:[this,"target"],onChange:()=>this.targetUpdated(!0)},{type:"slider",bounds:[1,180],label:"Field Of View",hidden:()=>!this._camera.modelObject.isPerspectiveCamera,property:[this._options,"fov"],onChange:()=>this.refreshCameraOptions(),limitedUi:!0},{type:"checkbox",label:"Auto Near far",getValue:()=>{var _e;return(_e=this._camera.userData.autoNearFar)===null||_e===void 0||_e},setValue:_e=>this._camera.userData.autoNearFar=_e,onChange:()=>this.setDirty()},{type:"checkbox",label:"Dolly FoV",getValue:()=>{var _e;return(_e=this._camera.userData.dollyFov)!==null&&_e!==void 0&&_e},setValue:_e=>this._camera.userData.dollyFov=_e,onChange:()=>this.setDirty()},{type:"input",label:()=>{var _e;return(_e=this._camera.userData.autoNearFar)===null||_e===void 0||_e?"Min Near":"Near"},getValue:()=>{var _e;return(_e=this._camera.userData.minNearPlane)!==null&&_e!==void 0?_e:.5},setValue:_e=>this._camera.userData.minNearPlane=_e,onChange:()=>this.setDirty()},{type:"input",label:()=>{var _e;return(_e=this._camera.userData.autoNearFar)===null||_e===void 0||_e?"Max Far":"Far"},getValue:()=>{var _e;return(_e=this._camera.userData.maxFarPlane)!==null&&_e!==void 0?_e:1e3},setValue:_e=>this._camera.userData.maxFarPlane=_e,onChange:()=>this.setDirty()},()=>({type:"dropdown",label:"Controls Mode",property:[this._options,"controlsMode"],children:["","orbit",...this._controlsCtors.keys()].map(_e=>({label:_e===""?"none":_e,value:_e})),onChange:()=>{this.refreshCameraOptions()}})],this.uiConfig={type:"folder",label:"Camera",limitedUi:!0,children:[...this._camUi,()=>{var _e;return!((_e=this._controls)===null||_e===void 0)&&_e.zoomIn?{type:"button",label:"Zoom in",value:()=>{var it;(it=this._controls)===null||it===void 0||it.zoomIn(1)}}:{}},()=>{var _e;return!((_e=this._controls)===null||_e===void 0)&&_e.zoomOut?{type:"button",label:"Zoom out",value:()=>{var it;(it=this._controls)===null||it===void 0||it.zoomOut(1)}}:{}},()=>{var _e;return(_e=this._controls)===null||_e===void 0?void 0:_e.uiConfig}]},this.assetType="model",this.uuid=three_module.cj9.generateUUID(),this.setDirty=this.setDirty.bind(this),this.targetUpdated=this.targetUpdated.bind(this),this._refreshCameraOptions=this._refreshCameraOptions.bind(this),this._container=d??document.body;const _={...c};this._camera=this._setCameraObject(o??(_.type==="OrthographicCamera"?new three_module.qUd(-1,1,1,-1):new three_module.ubm)),this._camera.modelObject.userData.iCamera=this;const b=o;o&&(b.isPerspectiveCamera?(_.fov=b.fov,_.focus=b.focus,_.aspect=b.aspect<=0||b.userData.autoAspect?"auto":b.aspect,_.zoom=b.zoom):b.isOrthographicCamera&&(_.left=b.left,_.right=b.right,_.top=b.top,_.bottom=b.bottom,_.zoom=b.zoom),this.near=b.near,this.far=b.far,this._position.copy(o.position),this.refreshTarget()),this.positionUpdated(!1),this.setCameraOptions(_)}refreshAspect(o=!0){this._options.aspect==="auto"&&this._refreshCameraOptions(o)}refreshTarget(o=4){var c;!((c=this._controls)===null||c===void 0)&&c.enabled&&this._controls.target?this._target.copy(this._controls.target):this.cameraObject.getWorldDirection(this._target).multiplyScalar(o).add(this.cameraObject.getWorldPosition(new three_module.Pq0))}setControlsCtor(o,c,d=!1){d||!this._controlsCtors.has(o)?this._controlsCtors.set(o,c):console.error(o+" already exists.")}removeControlsCtor(o){this._controlsCtors.delete(o)}_initCameraControls(){var o,c,d;const _=this._options.controlsMode;this._controls=(c=(o=this._controlsCtors.get(_))===null||o===void 0?void 0:o(this._camera.modelObject,this._container))!==null&&c!==void 0?c:void 0,this._controls||_===""||console.error("Unable to create controls with mode "+_+". Are you missing a plugin?"),(d=this._controls)===null||d===void 0||d.addEventListener("change",this.setDirty),this._controlsMode=this._controls?_:""}_disposeCameraControls(){var o,c;this._controlsMode,(o=this._controls)===null||o===void 0||o.removeEventListener("change",this.setDirty),(c=this._controls)===null||c===void 0||c.dispose(),this._controlsMode="",this._controls=void 0}refreshCameraControls(o=!0){var c,d;if(this._options.controlsEnabled){const _=this._options.controlsMode;this._controls?this._controlsMode===_&&this._camera.modelObject===this._controls.object||(this._disposeCameraControls(),this._initCameraControls()):this._initCameraControls(),this._controlsMode=_}if(this._controls){const _=this.interactionsEnabled;this._controls.enabled=_,_&&this._camera.modelObject.up.copy(three_module.B69.DEFAULT_UP)}o&&this.setDirty(),(d=(c=this.uiConfig).uiRefresh)===null||d===void 0||d.call(c,"postFrame",!0)}setDirty(o){var c,d;this._position.copy(this._camera.modelObject.position),this._controls&&this._controls.enabled&&this._controls.target&&this._target.copy(this._controls.target),this._camera.modelObject.fov!==void 0&&(this._options.fov=this._camera.modelObject.fov),this._camera.modelObject.focus!==void 0&&(this._options.focus=this._camera.modelObject.focus),this._camera.modelObject.zoom!==void 0&&(this._options.zoom=this._camera.modelObject.zoom),(d=(c=this.cameraObject).updateProjectionMatrix)===null||d===void 0||d.call(c),this.cameraObject.getWorldPosition(this._positionWorld),this.dispatchEvent({...o,type:"update"}),(o==null?void 0:o.last)!==!1&&this._camUi.forEach(_=>{var b;return(b=_==null?void 0:_.uiRefresh)===null||b===void 0?void 0:b.call(_,"postFrame",!1,1)})}activateMain(o=!0){var c,d;this._isActiveCamera||(this._isActiveCamera=!0,this._camera.modelObject.userData.__lastScale=this._camera.modelObject.scale.clone(),this._camera.modelObject.scale.divide(this._camera.modelObject.getWorldScale(new three_module.Pq0)),o&&(this.refreshCameraControls(!1),this._refreshCameraOptions(!0)),(d=(c=this._camera).setDirty)===null||d===void 0||d.call(c,{change:"activateMain"}))}deactivateMain(o=!0){this._isActiveCamera&&(this._isActiveCamera=!1,this._camera.modelObject.userData.__lastScale&&(this._camera.modelObject.scale.copy(this._camera.modelObject.userData.__lastScale),delete this._camera.modelObject.userData.__lastScale),o&&this.refreshCameraControls(!0))}get cameraObject(){return this._camera.modelObject}get modelObject(){return this._camera.modelObject}dispose(){this._disposeCameraControls()}getFittingDistance(o){const c=o.getSize(new three_module.Pq0);let d=this.cameraObject,_=1;if(d.isPerspectiveCamera&&c.length()>1e-4){const b=isFinite(d.aspect)?d.aspect:1,_e=Math.max(1,d.fov)*(Math.PI/180),it=2*Math.atan(Math.tan(_e/2)*b),nt=c.z/2+Math.abs(c.x/2/Math.tan(it/2)),at=c.z/2+Math.abs(c.y/2/Math.tan(_e/2));_=Math.max(nt,at)}return _}targetUpdated(o=!0){var c,d;const _=this.target;(d=(c=this._controls)===null||c===void 0?void 0:c.target)===null||d===void 0||d.set(_.x,_.y,_.z),this._controls&&this._controls.enabled&&this._controls.target?o&&this.setDirty():this._camera&&(this._camera.userData.autoLookAtTarget!==void 0&&(this.autoLookAtTarget=this._camera.userData.autoLookAtTarget),this.autoLookAtTarget&&this._camera.modelObject.lookAt(_),o&&this.setDirty())}positionUpdated(o=!0){const c=this.position;this._camera.modelObject.position.set(c.x,c.y,c.z),this.targetUpdated(o)}positionTargetUpdated(o=!0){this.positionUpdated(o)}copyFromCamera(o,c=4){o.getWorldPosition(this._position),o.getWorldDirection(this._target).multiplyScalar(c).add(this._position),this.positionUpdated(!1),this.setCameraOptions({fov:o.fov,focus:o.focus,zoom:o.zoom,type:o.type},!0)}updateShaderProperties(o){var c,d,_,b;return(d=(c=o.uniforms.cameraPositionWorld)===null||c===void 0?void 0:c.value)===null||d===void 0||d.copy(this._positionWorld),(b=(_=o.uniforms.cameraNearFar)===null||_===void 0?void 0:_.value)===null||b===void 0||b.set(this._camera.modelObject.near,this._camera.modelObject.far),o.uniforms.projection&&(o.uniforms.projection.value=this._camera.modelObject.projectionMatrix),o.defines.PERSPECTIVE_CAMERA=this._camera.modelObject.type==="PerspectiveCamera"?"1":"0",o.defines.ORTHOGRAPHIC_CAMERA=this._camera.modelObject.type==="OrthographicCamera"?"1":"0",this}toJSON(o){const c={};return copyObject3DUserData(c,this.userData),Object.assign({userData:c},serializeObject(this,!0,o))}fromJSON(o,c){return o.userData&&(copyObject3DUserData(this.userData,o.userData),delete(o={...o}).userData),o.camOptions&&(this.setCameraOptions(o.camOptions,!1),this.refreshCameraOptions(!1)),deserializeObject(o,this,!0,c),this.positionUpdated(!1),this.refreshCameraOptions(!1),this.setDirty({change:"deserialize"}),this}refreshCameraOptions(o=!0){this.setCameraOptions(this._options,o)}get visible(){return!0}set visible(o){console.error("Cannot set visible on camera",o)}}CameraController_decorate([serialize("camControls")],CameraController.prototype,"_controls",void 0),CameraController_decorate([x$1(CameraController.prototype._nearFarChanged)],CameraController.prototype,"near",void 0),CameraController_decorate([x$1(CameraController.prototype._nearFarChanged)],CameraController.prototype,"far",void 0),CameraController_decorate([serialize("camOptions")],CameraController.prototype,"_options",void 0),CameraController_decorate([serialize("position")],CameraController.prototype,"_position",void 0),CameraController_decorate([serialize("target")],CameraController.prototype,"_target",void 0);var RootScene_decorate=function(h,o,c,d){var _,b=arguments.length,_e=b<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_e=Reflect.decorate(h,o,c,d);else for(var it=h.length-1;it>=0;it--)(_=h[it])&&(_e=(b<3?_(_e):b>3?_(o,c,_e):_(o,c))||_e);return b>3&&_e&&Object.defineProperty(o,c,_e),_e};class RootScene extends three_module.Z58{get activeCamera(){return this._activeCamera>=0?this._cameras[this._activeCamera]:this._dummyCam}set activeCamera(o){const c=this.activeCamera;if(o||(o=this.defaultCamera),c!==o){if(c&&(c.deactivateMain(),c.removeEventListener("update",this._activeCameraUpdate)),o){o.activateMain(),o.addEventListener("update",this._activeCameraUpdate);let d=this._cameras.indexOf(o);d<0&&(this._cameras.push(o),d=this._cameras.length-1),this._activeCamera=d}else this._activeCamera=-1;this.dispatchEvent({type:"activeCameraChange",lastCamera:c,camera:o}),this.setDirty()}}get renderCamera(){var o;return(o=this._renderCamera)!==null&&o!==void 0?o:this.activeCamera}set renderCamera(o){const c=this._renderCamera;this._renderCamera=o,this.dispatchEvent({type:"renderCameraChange",lastCamera:c,camera:o})}get modelObject(){return this}constructor(o){super(),this.isRootScene=!0,this.assetType="model",this._sceneBounds=new Box3B,this._modelBounds=new Box3B,this._sceneBoundingRadius=0,this._cameras=[],this._activeCamera=-1,this.envMapIntensity=.05,this.fixedEnvMapDirection=!1,this.backgroundIntensity=1,this._dummyCam=new CameraController(new three_module.ubm,{controlsMode:"",controlsEnabled:!1}),this.deleteImportedViewerConfigOnLoad=!0,this.autoDisposeSceneMaps=!0,this.environment=null,this.textureSlots={},this.background=null,this.backgroundColor=null,this.setDirty=this.setDirty.bind(this),this.updateScene=this.updateScene.bind(this),this.refreshActiveCameraNearFar=this.refreshActiveCameraNearFar.bind(this),this._activeCameraUpdate=this._activeCameraUpdate.bind(this),this._optionsUpdate=this._optionsUpdate.bind(this),this._onSceneMaterialUpdate=this._onSceneMaterialUpdate.bind(this),this._onSceneUpdate=this._onSceneUpdate.bind(this),this.addEventListener("materialUpdate",this._onSceneMaterialUpdate),this.addEventListener("materialChanged",this._onSceneMaterialUpdate),this.addEventListener("objectUpdate",this._onSceneUpdate),this.defaultCamera=o,this.modelRoot=setupIModel(new three_module.YJl,void 0),this.modelRoot.userData.rootSceneModelRoot=!0,this.modelRoot.name="Scene",this.modelRoot.addEventListener("update",this.setDirty),this.addSceneObject(this.modelRoot,{addToRoot:!0,autoScale:!1}),this.addSceneObject(this.defaultCamera,{addToRoot:!0}),this.activeCamera=this.defaultCamera,this.boxHelper=new three_module.BND(this.getBounds())}addModel(o,c={}){return o.assetType!=="model"&&console.error("Invalid asset type for ",o,", adding anyway"),this.addSceneObject(o,c)}addWidget(o,c={}){o.assetType!=="widget"&&console.warn("Invalid asset type for ",o,", adding anyway"),this.add(o.modelObject)}_addModel(o,c={}){return this._addObject3D(o==null?void 0:o.modelObject,c)}addSceneObject(o,c){var d;if(!o)return o;const _=o.assetType;let b=!1;switch(_){case"model":b=o.modelObject.isCamera,b&&(c={...c,autoScale:!1}),this._addModel(o,c);break;case"material":break;case"texture":this.dispatchEvent({type:"textureAdded",texture:o});break;case"light":this._addLight(o,c);break;default:console.warn("WebGi RootScene: Unknown asset imported",o,_)}return this.dispatchEvent({type:"addSceneObject",object:o,options:c}),this.deleteImportedViewerConfigOnLoad&&(o.__importedViewerConfig||!((d=o.modelObject)===null||d===void 0)&&d.__importedViewerConfig)&&X$2(2e3).then(()=>{delete o.__importedViewerConfig,o.modelObject&&delete o.modelObject.__importedViewerConfig}),o}_addObject3D(o,{autoScale:c=!0,autoScaleRadius:d=2,addToRoot:_=!1}={}){const b=o;b?(c&&!b.userData.autoScaled&&autoScaleObject3D(b,b.userData.autoScaleRadius||d),b.traverse(_e=>{_e.isMesh&&!_e.userData.__keepShadowDef&&(_e.castShadow=!0,_e.receiveShadow=!0,_e.userData.__keepShadowDef=!0)}),_?this.modelObject.add(b):this.modelRoot.add(b),this.setDirty()):console.error("Invalid Model, cannot add.")}removeSceneModels(){this.modelRoot.clear(),this.modelRoot.children=[],this.setDirty({sceneUpdate:!0})}disposeSceneModels(){[...this.modelRoot.children].forEach(o=>{var c,d;((c=o.dispose)!==null&&c!==void 0?c:(d=o.modelObject)===null||d===void 0?void 0:d.removeFromParent)()}),this.setDirty({sceneUpdate:!0})}_onEnvironmentChange(){var o;((o=this.environment)===null||o===void 0?void 0:o.mapping)===three_module.UTZ&&(this.environment.mapping=three_module.wfO,this.environment.needsUpdate=!0),this.dispatchEvent({type:"environmentChanged",environment:this.environment}),this._onSceneUpdate({geometryChanged:!1})}_onBackgroundChange(){this.dispatchEvent({type:"backgroundChanged",background:this.background,backgroundColor:this.backgroundColor}),this._onSceneUpdate({geometryChanged:!1})}add(...o){return super.add(...o.map(c=>setupIModel(c))),this._onSceneUpdate(),this}setEnvironment(o){const c=this.environment;if(c===o)return;if(this.autoDisposeSceneMaps&&(c==null||c.dispose()),!o)return void(this.environment=null);if(!o.isTexture)return void console.error("Unknown Environment type",o);o.assetType!=="texture"&&console.warn("Environment asset not processed",o);const d=o.textureObject||o;this.environment=d}getEnvironment(){return this.environment}setBackground(o){let c;const d=this.background;if(d!==o){if(this.autoDisposeSceneMaps&&d instanceof three_module.gPd&&d.dispose(),!o||o.assetType==="texture"||o.isTexture||o.isColor||o==="environment")c=((o==null?void 0:o.assetType)==="texture"||o.isTexture)&&o.textureObject||o;else{if(typeof o!="string"&&typeof o!="number")return void console.error("Unknown Background type",o);c=new three_module.Q1f(o)}this.background=c}}setBackgroundColor(o){this.backgroundColor=o?new three_module.Q1f(o):null}getBackground(){return this.background}setDirty(o){return o!=null&&o.sceneUpdate||o!=null&&o.refreshScene?this._onSceneUpdate(o):this.dispatchEvent({type:"update"}),this}updateScene(o){return this._onSceneUpdate(o)}_activeCameraUpdate(o){o.optionsUpdate&&this._optionsUpdate(o),this.setDirty(),this.refreshActiveCameraNearFar(),this.dispatchEvent({...o,type:"activeCameraUpdate"})}_optionsUpdate(o){if(!this.activeCamera.userData.dollyFov)return;const c=new Box3B().expandByObject(this.modelRoot.modelObject,!1,!0),d=this.activeCamera.cameraObject,_=1.5*this.activeCamera.getFittingDistance(c),b=this.activeCamera.target,_e=new three_module.Pq0().subVectors(b,d.position).normalize();this.activeCamera.position=_e.multiplyScalar(-_).add(b)}_onSceneUpdate(o={}){var c,d,_,b;return o.sceneUpdate===!1&&o.refreshScene===!1||!((c=o.object)===null||c===void 0)&&c.isCamera?this.setDirty(o):(this.refreshActiveCameraNearFar(),this._sceneBounds=this.getBounds(!1,!0),(b=(_=(d=this.boxHelper)===null||d===void 0?void 0:d.box)===null||_===void 0?void 0:_.copy)===null||b===void 0||b.call(_,this._sceneBounds),this._modelBounds=this.getModelBounds(!1,!0),this._sceneBoundingRadius=this._modelBounds.getSize(new three_module.Pq0).length()/2,this.dispatchEvent({...o,type:"sceneUpdate",hierarchyChanged:["addedToParent","removedFromParent"].includes(o.change||"")}),this)}_onSceneMaterialUpdate(o){this.dispatchEvent({...o,type:"sceneMaterialUpdate"})}dispose(){var o;this.disposeSceneModels(),this.clear(),(o=this.environment)===null||o===void 0||o.dispose()}findObjectsByName(o,c){const d=[];return(c??this.modelObject).traverse(_=>{_.name===o&&d.push(_)}),d}addLight(o,c={}){this.addSceneObject(o,c)}_addLight(o,{addToRoot:c=!1}={}){var d;const _=o.lightObject;_&&((d=_.children)===null||d===void 0||d.length,c?this.add(_):this.modelRoot.add(_))}getBounds(o=!1,c=!0,d=!0,_){return new Box3B().expandByObject(this.modelObject,o,c,b=>{var _e;return!(!d||b.assetType!=="widget")||(_e=_==null?void 0:_(b))!==null&&_e!==void 0&&_e})}getModelBounds(o=!1,c=!0,d=!0,_){return this.modelRoot==null?new Box3B:new Box3B().expandByObject(this.modelRoot,o,c,b=>{var _e;return!(!d||b.assetType!=="widget")||(_e=_==null?void 0:_(b))!==null&&_e!==void 0&&_e})}refreshActiveCameraNearFar(){var o,c,d,_;const b=this.activeCamera;if(!b)return;if(b.cameraObject.userData.autoNearFar===!1)return b.near=(o=b.cameraObject.userData.minNearPlane)!==null&&o!==void 0?o:.5,void(b.far=(c=b.cameraObject.userData.maxFarPlane)!==null&&c!==void 0?c:1e3);const _e=this.getBounds(!1),it=b.cameraObject.getWorldPosition(new three_module.Pq0).sub(_e.getCenter(new three_module.Pq0)),nt=1.5*_e.getSize(new three_module.Pq0).length()/2,at=Math.max(.1,-it.clone().normalize().dot(b.cameraObject.getWorldDirection(new three_module.Pq0))),ut=it.length(),pt=Math.max(Math.max((d=b.cameraObject.userData.minNearPlane)!==null&&d!==void 0?d:.5,.001),at*(ut-nt)),mt=Math.min(Math.max(pt+nt,at*(ut+nt)),(_=b.cameraObject.userData.maxFarPlane)!==null&&_!==void 0?_:1e3);b.near=pt,b.far=mt}updateShaderProperties(o){return o.uniforms.sceneBoundingRadius?o.uniforms.sceneBoundingRadius.value=this._sceneBoundingRadius:console.warn("BaseRenderer: no uniform: frameCount"),this}toJSON(o){return serializeObject(this,!0,o)}fromJSON(o,c){const d=o.environment;return d!==void 0&&(this.setEnvironment(deserializeObject(d,this.getEnvironment(),!1,c)),delete o.environment),deserializeObject(o,this,!0,c),o.environment=d,this}get minNearDistance(){var o;return console.error("minNearDistance is deprecated. Use camera.userData.minNearPlane instead"),(o=this.activeCamera.userData.minNearPlane)!==null&&o!==void 0?o:.5}set minNearDistance(o){console.error("minNearDistance is deprecated. Use camera.userData.minNearPlane instead"),this.activeCamera&&(this.activeCamera.userData.minNearPlane=o)}}RootScene_decorate([serialize()],RootScene.prototype,"defaultCamera",void 0),RootScene_decorate([ze$1(RootScene.prototype.setDirty),serialize()],RootScene.prototype,"envMapIntensity",void 0),RootScene_decorate([ze$1(RootScene.prototype.setDirty),serialize()],RootScene.prototype,"fixedEnvMapDirection",void 0),RootScene_decorate([ze$1(RootScene.prototype.setDirty),serialize()],RootScene.prototype,"backgroundIntensity",void 0),RootScene_decorate([serialize(),x$1(RootScene.prototype._onEnvironmentChange.name)],RootScene.prototype,"environment",void 0),RootScene_decorate([serialize()],RootScene.prototype,"textureSlots",void 0),RootScene_decorate([serialize(),x$1(RootScene.prototype._onBackgroundChange)],RootScene.prototype,"background",void 0),RootScene_decorate([serialize(),x$1(RootScene.prototype._onBackgroundChange)],RootScene.prototype,"backgroundColor",void 0);function shaderReplaceString(h,o,c,{replaceAll:d=!1,prepend:_=!1,append:b=!1}={}){if(!h.includes(o))return console.error(`${o} not found in shader`),h;let _e=c;return _?_e=c+o:b&&(_e=o+c),d?h.replaceAll(o,_e):h.replace(o,_e)}class MaterialExtender{static ApplyMaterialExtensions(o,c,d,_){for(const b of d)this.ApplyMaterialExtension(o,c,b,_)}static ApplyMaterialExtension(o,c,d,_){var b,_e;let it=(b=Ee$1(d.parsFragmentSnippet,_,o))!==null&&b!==void 0?b:"";it.length&&(c.fragmentShader=shaderReplaceString(c.fragmentShader,this.VoidMain,`
`+it+`
`,{prepend:!0})),it=(_e=Ee$1(d.parsVertexSnippet,_,o))!==null&&_e!==void 0?_e:"",it.length&&(c.vertexShader=shaderReplaceString(c.vertexShader,this.VoidMain,`
`+it+`
`,{prepend:!0})),d.extraUniforms&&(c.uniforms=Object.assign(c.uniforms,d.extraUniforms)),d.extraDefines&&updateMaterialDefines(d.extraDefines,o),d.shaderExtender&&d.shaderExtender(c,o,_),o.lastShader=c}static CacheKeyForExtensions(o,c){let d="";for(const _ of c)d+=this.CacheKeyForExtension(o,_);return d}static CacheKeyForExtension(o,c){let d="";return c.customCacheKey&&(d+=c.customCacheKey),c.computeCacheKey&&(d+=c.computeCacheKey(o)),c.extraDefines&&Object.values(c.extraDefines).forEach(_=>d+=_),d}static RegisterExtensions(o,c){const d=[];if(c)for(const _ of c)_.isCompatible&&_.isCompatible(o)&&(d.push(_),_.uuid||(_.uuid=esm_browser_v4()),_.__setDirty||(_.__setDirty=()=>{_.updateVersion||(_.updateVersion=0),_.updateVersion++}),_.setDirty||(_.setDirty=_.__setDirty));o.materialExtensions=d,o.__ext_beforeRenderListen||(o.__ext_beforeRenderListen=!0,o.addEventListener("beforeRender",_=>materialBeforeRender(o,_))),o.__ext_afterRenderListen||(o.__ext_afterRenderListen=!0,o.addEventListener("afterRender",_=>materialAfterRender(o,_))),o.__ext_addToMeshListen||(o.__ext_addToMeshListen=!0,o.addEventListener("addToMesh",_=>{var b,_e;if(o.materialExtensions)for(const it of o.materialExtensions)(b=it.onAddToMesh)===null||b===void 0||b.call(it,(_e=_.mesh)!==null&&_e!==void 0?_e:_.object,o)})),o.__ext_removeFromMeshListen||(o.__ext_removeFromMeshListen=!0,o.addEventListener("removeFromMesh",_=>{var b,_e;if(o.materialExtensions)for(const it of o.materialExtensions)(b=it.onRemoveFromMesh)===null||b===void 0||b.call(it,(_e=_.mesh)!==null&&_e!==void 0?_e:_.object,o)})),o.__ext_materialUpdateListen||(o.__ext_materialUpdateListen=!0,o.addEventListener("materialUpdate",_=>{var b;if(o.materialExtensions)for(const _e of o.materialExtensions)(b=_e.onMaterialUpdate)===null||b===void 0||b.call(_e,o)}));for(const _ of d)_.onRegister&&_.onRegister(o);return d}}function updateMaterialDefines(h,o){let c=!1;o.materialObject&&o.materialObject.defines===void 0&&(o.materialObject.defines={});const d=Object.entries(h);for(const[_,b]of d)b===void 0?o.materialObject.defines[_]!==void 0&&(delete o.materialObject.defines[_],c=!0):o.materialObject.defines[_]!==b&&(o.materialObject.defines[_]=b,c=!0);c&&(o.materialObject.needsUpdate=!0)}function materialBeforeRender(h,{object:o,renderer:c}){var d;if(h.materialExtensions)for(const _ of h.materialExtensions){if((d=_.onObjectRender)===null||d===void 0||d.call(_,o,h,c),h.lastShader){const b=Ee$1(_.updaters)||[];for(const _e of b)_e&&_e.updateShaderProperties(h.lastShader)}_.updateVersion!==h.materialObject.userData["_"+_.uuid+"_version"]&&(h.materialObject.userData["_"+_.uuid+"_version"]=_.updateVersion,h.materialObject.needsUpdate=!0)}}function materialAfterRender(h,{object:o,renderer:c}){var d;if(h.materialExtensions)for(const _ of h.materialExtensions)(d=_.onAfterRender)===null||d===void 0||d.call(_,o,h,c)}MaterialExtender.VoidMain="void main()";var ShaderPass2_decorate=function(h,o,c,d){var _,b=arguments.length,_e=b<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_e=Reflect.decorate(h,o,c,d);else for(var it=h.length-1;it>=0;it--)(_=h[it])&&(_e=(b<3?_(_e):b>3?_(o,c,_e):_(o,c))||_e);return b>3&&_e&&Object.defineProperty(o,c,_e),_e};class AShaderMaterial2 extends three_module.BKk{constructor(o,c=!1){var d;super(o),this.typeSlug="shaderMat",this.assetType="material",this.materialObject=this,this.materialExtensions=[],this.isRawShaderMaterial=!1,this.extraUniformsToUpload={},c&&(this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"),this.materialExtensions=MaterialExtender.RegisterExtensions(this,(d=o==null?void 0:o.customMaterialExtensions)!==null&&d!==void 0?d:[])}registerMaterialExtensions(o){this.materialExtensions=[...this.materialExtensions,...MaterialExtender.RegisterExtensions(this,o)]}unregisterMaterialExtensions(o){}onBeforeCompile(o,c){MaterialExtender.ApplyMaterialExtensions(this,o,this.materialExtensions,c),this.dispatchEvent({type:"beforeCompile",shader:o,renderer:c}),o.fragmentShader=o.fragmentShader.replaceAll("#glMarker","// "),super.onBeforeCompile(o,c)}customProgramCacheKey(){return super.customProgramCacheKey()+MaterialExtender.CacheKeyForExtensions(this,this.materialExtensions)}onBeforeRender(o,c,d,_,b){super.onBeforeRender(o,c,d,_,b),this.dispatchEvent({type:"beforeRender",renderer:o,scene:c,camera:d,geometry:_,object:b})}onAfterRender(o,c,d,_,b){super.onAfterRender(o,c,d,_,b),this.dispatchEvent({type:"afterRender",renderer:o,scene:c,camera:d,geometry:_,object:b})}setDirty(o){this.needsUpdate=!0,this.dispatchEvent({...o,type:"materialUpdate"})}}class ShaderMaterial2 extends AShaderMaterial2{constructor(){super(...arguments),this.typeSlug="shaderMat"}toJSON(o){throw new Error("Method not supported for this material.")}fromJSON(o,c){throw new Error("Method not supported for this material.")}copyProps(o){throw new Error("Method not supported for this material.")}}class ShaderMaterialEncodingSupport extends ShaderMaterial2{constructor(o,c){super(o),this.typeSlug="shaderMat",this.textures=[],this.setTextureIds(c)}setTextureIds(o){this.textures.map(c=>c.id).join(";")!==o.join(";")&&(this.textures=o.map(c=>({id:c,colorSpace:three_module.jf0})),this.setDirty())}_setUniformTexSize(o,c){var d,_,b,_e;if(!c||!o)return;const it=(_=(d=c.image)===null||d===void 0?void 0:d.width)!==null&&_!==void 0?_:512,nt=(_e=(b=c.image)===null||b===void 0?void 0:b.height)!==null&&_e!==void 0?_e:512,at=o.value;at.isVector2||console.warn("uniform is not a Vector2"),at&&Math.abs(at.x-it)+Math.abs(at.y-nt)>.1&&(at.x=it,at.y=nt,this.uniformsNeedUpdate=!0)}onBeforeRender(o,c,d,_,b){var _e,it;this._setUniformTexSize(this.uniforms.screenSize,(_e=o.getRenderTarget())===null||_e===void 0?void 0:_e.texture);for(const nt of this.textures){const at=nt.id,ut=(it=this.uniforms[at])===null||it===void 0?void 0:it.value;ut&&(this._setUniformTexSize(this.uniforms[at+"Size"],ut),ut.colorSpace!==nt.colorSpace&&(nt.colorSpace=ut.colorSpace,this.needsUpdate=!0))}super.onBeforeRender(o,c,d,_,b)}onBeforeCompile(o,c){o.fragmentShader=this.textures.map(d=>{var _,b;return`uniform sampler2D ${d.id}; 
`+getTexelDecoding((_=d.id)!==null&&_!==void 0?_:"input",(b=d.colorSpace)!==null&&b!==void 0?b:three_module.jf0)}).join(`
`)+o.fragmentShader,super.onBeforeCompile(o,c)}customProgramCacheKey(){return super.customProgramCacheKey()+this.textures.map(o=>o.id+o.colorSpace).join(";")}}function patchShaderEncodingSupport(h,...o){const c=h.fragmentShader;return new ShaderMaterialEncodingSupport({defines:Object.assign({},h.defines),uniforms:h.uniforms,vertexShader:h.vertexShader,fragmentShader:c},o)}class ShaderPass2 extends ShaderPass{constructor(o,...c){super(o.isMaterial?o:patchShaderEncodingSupport(o,...c),c.length<1?ShaderPass2.DEFAULT_TEX_ID:c[0]),this.onDirty=[],this.isShaderPass2=!0,this.enabled=!0,this.setDirty=this.setDirty.bind(this)}dispose(){var o,c,d,_;(c=(o=this.material)===null||o===void 0?void 0:o.dispose)===null||c===void 0||c.call(o),(_=(d=this.fsQuad)===null||d===void 0?void 0:d.dispose)===null||_===void 0||_.call(d),this.onDirty=[]}setDirty(){this.onDirty.forEach(o=>o())}updateShaderProperties(o){o&&(Array.isArray(o)||(o=[o]),o.forEach(c=>c==null?void 0:c.updateShaderProperties(this.material)))}render(o,c,d,_,b){this.enabled&&super.render(o,c||null,d,_,b)}}ShaderPass2.DEFAULT_TEX_ID="tDiffuse",ShaderPass2_decorate([uiToggle("Enabled"),serialize()],ShaderPass2.prototype,"enabled",void 0);class RenderPass extends Pass{constructor(o,c,d=null,_=null,b=null){super(),this.scene=o,this.camera=c,this.overrideMaterial=d,this.clearColor=_,this.clearAlpha=b,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1,this._oldClearColor=new three_module.Q1f}render(o,c,d,_,b,_e){if(!this.scene||!this.camera)return;const it=o.autoClear;let nt,at;if(o.autoClear=!1,this.overrideMaterial!==null&&(at=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor!==null&&(o.getClearColor(this._oldClearColor),o.setClearColor(this.clearColor)),this.clearAlpha!==null&&(nt=o.getClearAlpha(),o.setClearAlpha(this.clearAlpha)),this.clearDepth==1&&o.clearDepth(),o.setRenderTarget(this.renderToScreen?null:d),_e){const ut=o.getContext();ut.framebufferRenderbuffer(ut.FRAMEBUFFER,ut.DEPTH_ATTACHMENT,ut.RENDERBUFFER,_e)}if(this.clear===!0&&o.clear(o.autoClearColor,o.autoClearDepth,o.autoClearStencil),o.render(this.scene,this.camera),_e){const ut=o.getContext();ut.framebufferRenderbuffer(ut.FRAMEBUFFER,ut.DEPTH_ATTACHMENT,ut.RENDERBUFFER,null)}this.clearColor!==null&&o.setClearColor(this._oldClearColor),this.clearAlpha!==null&&o.setClearAlpha(nt),this.overrideMaterial!==null&&(this.scene.overrideMaterial=at),o.autoClear=it}}class GenericBlendTexturePass extends ShaderPass2{constructor(o,c="c = a + b;",d="",_,b=120){super({vertexShader:CopyShader.vertexShader,fragmentShader:fe$1`
                varying vec2 vUv;
                
                ${d}
                
                void blend(in vec4 a, in vec4 b, inout vec4 c){
                
                ${c}
                
                }
                void main() {
                    vec4 texel = vec4(0);
                    blend(tDiffuseTexelToLinear ( texture2D( tDiffuse, vUv ) ), tDiffuse2TexelToLinear ( texture2D( tDiffuse2, vUv ) ), texel);
                    texel = clamp(texel, vec4(0), vec4(MAX_INTENSITY));
                    gl_FragColor = texel;
                    #include <colorspace_fragment>
                }
            `,uniforms:{tDiffuse:{value:null},tDiffuse2:{value:_},...o},defines:{MAX_INTENSITY:b}},"tDiffuse","tDiffuse2"),this.clear=!1,this.needsSwap=!0}}var depthNormalVert=`#define DEPTH_NORMAL 
#if IS_GLSL3 > 0
out vec3 vViewPosition;
#else
varying vec3 vViewPosition;
#endif
#ifdef USE_ALPHAMAP
#define USE_UV 
#endif
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main(){
#include <uv_vertex>
#include <beginnormal_vertex>
#include <morphnormal_vertex>
#include <skinbase_vertex>
#include <skinnormal_vertex>
#include <defaultnormal_vertex>
#include <normal_vertex>
#include <begin_vertex>
#include <morphtarget_vertex>
#include <skinning_vertex>
#include <displacementmap_vertex>
#include <project_vertex>
#include <logdepthbuf_vertex>
#include <clipping_planes_vertex>
vViewPosition=-mvPosition.xyz;}`,depthNormalFrag=`#define DEPTH_NORMAL 
#if IS_GLSL3 > 0
in vec3 vViewPosition;
#else
varying vec3 vViewPosition;
#endif
#ifdef USE_ALPHAMAP
#define USE_UV 
#include <packing>
#endif
#if IS_GLSL3 > 0
#ifndef gl_FragColor 
layout(location=0)out vec4 A;layout(location=1)out vec4 B;
#endif
#endif
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
uniform vec2 cameraNearFar;uniform vec4 flags;vec2 pack16(float value){float f=clamp(value,0.,1.)*255.;float digitLow=fract(f);float digitHigh=floor(f)/255.;return vec2(digitHigh,digitLow);}vec2 packNormal(vec3 n){float p=sqrt(n.z*8.+8.);return vec2(n.xy/p+0.5);}float linstep(float edge0,float edge1,float value){return clamp((value-edge0)/(edge1-edge0),0.,1.);}float getSSCurvature(in vec3 normal){vec3 n=normalize(normal);vec3 dx=dFdx(n);vec3 dy=dFdy(n);vec3 xneg=n-dx;vec3 xpos=n+dx;vec3 yneg=n-dy;vec3 ypos=n+dy;float curvature=(cross(xneg,xpos).y-cross(yneg,ypos).x);return curvature;}void main(){
#glMarker mainStart
#include <clipping_planes_fragment>
vec4 diffuseColor=vec4(1.);
#include <map_fragment>
#ifdef USE_ALPHAMAP
float alphaMapValue=
#ifdef ALPHA_I_RGBA_PACKING
1.-unpackRGBAToDepth(texture2D(alphaMap,vAlphaMapUv));
#else
texture2D(alphaMap,vAlphaMapUv).g;
#endif
#if defined(INVERSE_ALPHAMAP) && INVERSE_ALPHAMAP >= 1
diffuseColor.a*=1.-alphaMapValue;
#else
diffuseColor.a*=alphaMapValue;
#endif
#endif
#include <alphatest_fragment>
#include <logdepthbuf_fragment>
#include <normal_fragment_begin>
#include <normal_fragment_maps>
#ifdef FORCED_LINEAR_DEPTH
float linearZ=float(FORCED_LINEAR_DEPTH);
#else
float linearZ=linstep(-cameraNearFar.x,-cameraNearFar.y,-vViewPosition.z);
#endif
vec2 packedZ=pack16(pow(max(0.,linearZ),0.5));vec2 packedNormal=packNormal(normal);
#if IS_GLSL3 > 0
#ifndef gl_FragColor 
A=vec4(packedZ.x,packedZ.y,packedNormal.x,packedNormal.y);B=flags;B.x=getSSCurvature(normal)*0.5+0.5;
#else
gl_FragColor=vec4(packedZ.x,packedZ.y,packedNormal.x,packedNormal.y);
#endif
#else
gl_FragColor=vec4(packedZ.x,packedZ.y,packedNormal.x,packedNormal.y);
#endif
}`;class DepthNormalMaterial extends ShaderMaterial2{constructor(o=!0){super({vertexShader:depthNormalVert,fragmentShader:depthNormalFrag,uniforms:three_module.LlO.merge([three_module.fCn.common,three_module.fCn.bumpmap,three_module.fCn.normalmap,three_module.fCn.displacementmap,{cameraNearFar:{value:new three_module.I9Y(.1,1e3)},flags:{value:new three_module.IUQ(255,255,255,255)}}]),defines:{IS_GLSL3:o?"1":"0"},glslVersion:o?three_module.Wdf:three_module.Wyr}),this.normalMapType=three_module.bI3,this.flatShading=!1,this._updaters=[]}onBeforeRender(o,c,d,_,b){var _e,it,nt,at,ut,pt,mt,ft,vt,xt,At,Ct,Et;super.onBeforeRender(o,c,d,_,b);let Tt=b.material;Array.isArray(Tt)&&(Tt=Tt[0]),this.uniforms.map.value=(_e=Tt==null?void 0:Tt.map)!==null&&_e!==void 0?_e:null,this.uniforms.map.value&&o.materials.refreshTransformUniform(this.uniforms.map.value,this.uniforms.mapTransform),this.uniforms.alphaMap.value=(it=Tt==null?void 0:Tt.alphaMap)!==null&&it!==void 0?it:null,this.uniforms.alphaMap.value&&o.materials.refreshTransformUniform(this.uniforms.alphaMap.value,this.uniforms.alphaMapTransform),this.alphaTest=!Tt||!Tt.alphaTest||Tt.alphaTest<1e-7?.001:Tt.alphaTest,this.uniforms.alphaTest.value=this.alphaTest,this.uniforms.displacementMap.value=(nt=Tt==null?void 0:Tt.displacementMap)!==null&&nt!==void 0?nt:null,this.uniforms.displacementMap.value&&o.materials.refreshTransformUniform(this.uniforms.displacementMap.value,this.uniforms.displacementMapTransform),this.uniforms.displacementScale.value=(at=Tt==null?void 0:Tt.displacementScale)!==null&&at!==void 0?at:1,this.uniforms.displacementBias.value=(ut=Tt==null?void 0:Tt.displacementBias)!==null&&ut!==void 0?ut:0,this.uniforms.bumpMap.value=(pt=Tt==null?void 0:Tt.bumpMap)!==null&&pt!==void 0?pt:null,this.uniforms.bumpMap.value&&o.materials.refreshTransformUniform(this.uniforms.bumpMap.value,this.uniforms.bumpMapTransform),this.uniforms.bumpScale.value=(mt=Tt==null?void 0:Tt.bumpScale)!==null&&mt!==void 0?mt:1,this.uniforms.normalMap.value=(ft=Tt==null?void 0:Tt.normalMap)!==null&&ft!==void 0?ft:null,this.uniforms.normalMap.value&&o.materials.refreshTransformUniform(this.uniforms.normalMap.value,this.uniforms.normalMapTransform),this.uniforms.normalScale.value&&this.uniforms.normalScale.value.copy((vt=Tt==null?void 0:Tt.normalScale)!==null&&vt!==void 0?vt:new three_module.I9Y(1,1)),this.normalMapType=(xt=Tt==null?void 0:Tt.normalMapType)!==null&&xt!==void 0?xt:three_module.bI3,this.flatShading=(At=Tt==null?void 0:Tt.flatShading)!==null&&At!==void 0&&At,this.uniforms.flags.value.set(255,255,255,255),this.uniforms.flags.value.z=(Tt!=null&&Tt.userData.matId?Tt==null?void 0:Tt.userData.matId:0)/255,this._updaters.forEach(Dt=>{Dt(b,this.uniforms.flags.value)}),this.uniforms.flags.value.y/=255,this.uniforms.flags.value.w/=255,this.uniformsNeedUpdate=!0;let kt=this.uniforms.alphaMap.value?1:void 0;kt!==this.defines.USE_ALPHAMAP&&(kt===void 0?(delete this.defines.USE_ALPHAMAP,delete this.defines.ALPHAMAP_UV):(this.defines.USE_ALPHAMAP=kt,this.defines.ALPHAMAP_UV="uv"),this.needsUpdate=!0),kt=this.uniforms.map.value?1:void 0,kt!==this.defines.USE_MAP&&(kt===void 0?(delete this.defines.USE_MAP,delete this.defines.MAP_UV):(this.defines.USE_MAP=kt,this.defines.MAP_UV="uv"),this.needsUpdate=!0),kt=this.uniforms.bumpMap.value?1:void 0,kt!==this.defines.USE_BUMPMAP&&(kt===void 0?(delete this.defines.USE_BUMPMAP,delete this.defines.BUMPMAP_UV):(this.defines.USE_BUMPMAP=kt,this.defines.BUMPMAP_UV="uv"),this.needsUpdate=!0),kt=this.uniforms.normalMap.value?1:void 0,kt!==this.defines.USE_NORMALMAP&&(kt===void 0?(delete this.defines.USE_NORMALMAP,delete this.defines.NORMALMAP_UV):(this.defines.USE_NORMALMAP=kt,this.defines.NORMALMAP_UV="uv"),this.needsUpdate=!0),kt=this.uniforms.displacementMap.value?1:void 0,kt!==this.defines.USE_DISPLACEMENTMAP&&(kt===void 0?(delete this.defines.USE_DISPLACEMENTMAP,delete this.defines.DISPLACEMENTMAP_UV):(this.defines.USE_DISPLACEMENTMAP=kt,this.defines.DISPLACEMENTMAP_UV="uv"),this.needsUpdate=!0),kt=Tt.userData.ALPHA_I_RGBA_PACKING?1:void 0,kt!==this.defines.ALPHA_I_RGBA_PACKING&&(kt===void 0?delete this.defines.ALPHA_I_RGBA_PACKING:this.defines.ALPHA_I_RGBA_PACKING=kt,this.needsUpdate=!0),kt=(Ct=Tt.userData.forcedLinearDepth)!==null&&Ct!==void 0?Ct:void 0,kt!==this.defines.FORCED_LINEAR_DEPTH&&(kt===void 0?delete this.defines.FORCED_LINEAR_DEPTH:this.defines.FORCED_LINEAR_DEPTH=kt,this.needsUpdate=!0),this.side=(Et=Tt.side)!==null&&Et!==void 0?Et:three_module.$EB}addGBufferUpdater(o){this._updaters.push(o)}removeGBufferUpdater(o){const c=this._updaters.indexOf(o);c!==-1&&this._updaters.splice(c,1)}}var unpackGbuffer=`#ifndef UNPACK_GBUFFER_SNIPPET
#define UNPACK_GBUFFER_SNIPPET 
uniform sampler2D tNormalDepth;float unpack16(vec2 value){return value.x+value.y/255.;}vec3 unpackNormal(vec2 enc){vec2 fenc=enc*4.-2.;float f=dot(fenc,fenc);float g=sqrt(1.-f/4.);return vec3(fenc*g,1.-f/2.);}float unpackDepth(vec2 uncodedDepth){float x=unpack16(uncodedDepth.xy);return x*x;}float getDepth(vec2 uv){vec4 uncodedDepth=texture2D(tNormalDepth,uv);return unpackDepth(uncodedDepth.xy);}void getDepthNormal(const in vec2 uv,out float depth,out vec3 normal){vec4 uncodedDepth=texture2D(tNormalDepth,uv);depth=unpackDepth(uncodedDepth.xy);normal=unpackNormal(uncodedDepth.zw);}vec3 getViewNormal(const in vec2 uv){return unpackNormal(texture2D(tNormalDepth,uv).zw);}
#if defined(GBUFFER_HAS_FLAGS) && GBUFFER_HAS_FLAGS == 1
uniform sampler2D tGBufferFlags;
#endif
ivec4 getGBufferFlags(const in vec2 uv){
#if defined(GBUFFER_HAS_FLAGS) && GBUFFER_HAS_FLAGS == 1
return ivec4(texture2D(tGBufferFlags,uv)*255.);
#else
return ivec4(1);
#endif
}
#endif
`;class AViewerPlugin extends I$2{constructor(){super(...arguments),this._dirty=!1}get dirty(){return this.enabled&&this._dirty}set dirty(o){this._dirty=o}get viewer(){return this._viewer}async onAdded(o){this._viewer=o}async onDispose(o){}async onRemove(o){this._viewer!==o&&console.error("Wrong viewer"),this._viewer=void 0}toJSON(o){const c=serializeObject(this,!0,o);return c.type=this.constructor.PluginType,this.dispatchEvent({type:"serialize",data:c}),c}fromJSON(o,c){return o.type!==this.constructor.PluginType?null:(deserializeObject(o,this,!0,c),this.dispatchEvent({type:"deserialize",data:o,meta:c}),this)}_storeKey(o){return(o??"webgi")+"_"+(this.constructor.PluginType||this.constructor.name)}exportState(){var o,c,d,_;return(d=(c=(o=this._viewer)===null||o===void 0?void 0:o.getPluginByType("AssetManager"))===null||c===void 0?void 0:c.exportPluginPreset(this))!==null&&d!==void 0?d:(_=this.toJSON)===null||_===void 0?void 0:_.call(this)}async importState(o){var c,d;const _=(c=this._viewer)===null||c===void 0?void 0:c.getPluginByType("AssetManager");_?await _.importPluginPreset(o,this):(d=this.fromJSON)===null||d===void 0||d.call(this,o)}storeState(o,c,d){(c=c||(window?window.localStorage:void 0))?(d===void 0&&(d=this.exportState()),d&&c.setItem(this._storeKey(o),JSON.stringify(d))):console.warn("Unable to store state")}async loadState(o,c){if(!(c=c||(window?window.localStorage:void 0)))return void console.warn("Unable to load state");const d=c.getItem(this._storeKey(o));d&&await this.importState(JSON.parse(d))}}function makeFilter(h,o,c){return{...o,get dirty(){return o.dirty||!1},set dirty(d){S$2(o,"dirty",d,!0)},update(){var d,_,b;this.passObject.enabled&&((_=(d=this.passObject).updateShaderProperties)===null||_===void 0||_.call(d,Ee$1(c)),(b=o.update)===null||b===void 0||b.call(this))},onRegister(d){var _,b,_e;this.passObject.materialExtension&&((b=(_=h.getPluginByType("AssetManager"))===null||_===void 0?void 0:_.materials)===null||b===void 0||b.registerMaterialExtension(this.passObject.materialExtension)),(_e=o.onRegister)===null||_e===void 0||_e.call(this,d)},onUnregister(d){var _,b,_e;this.passObject.materialExtension&&((b=(_=h.getPluginByType("AssetManager"))===null||_===void 0?void 0:_.materials)===null||b===void 0||b.unregisterMaterialExtension(this.passObject.materialExtension)),(_e=o.onUnregister)===null||_e===void 0||_e.call(this,d)},dispose(){var d,_,b;(_=(d=this.passObject).dispose)===null||_===void 0||_.call(d),(b=o.dispose)===null||b===void 0||b.call(this)}}}var GenericFilterPlugin_decorate=function(h,o,c,d){var _,b=arguments.length,_e=b<3?o:d===null?d=Object.getOwnPropertyDescriptor(o,c):d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_e=Reflect.decorate(h,o,c,d);else for(var it=h.length-1;it>=0;it--)(_=h[it])&&(_e=(b<3?_(_e):b>3?_(o,c,_e):_(o,c))||_e);return b>3&&_e&&Object.defineProperty(o,c,_e),_e};class GenericFilterPlugin extends AViewerPlugin{_update(o){var c;return((c=this._pass)===null||c===void 0?void 0:c.enabled)&&this.enabled||!1}get enabled(){var o,c,d;return(d=(c=(o=this._pass)===null||o===void 0?void 0:o.passObject)===null||c===void 0?void 0:c.enabled)!==null&&d!==void 0?d:this._enabledTemp}set enabled(o){var c;!((c=this._pass)===null||c===void 0)&&c.passObject&&(this._pass.passObject.enabled=o),this._enabledTemp=o}constructor(){super(),this._enabledTemp=!0}async onAdded(o){await super.onAdded(o);const c={enabled:!0,passId:this.passId,passObject:this.passCtor(o),after:this._afterFilters,before:this._beforeFilters,required:this._requiredFilters,set dirty(d){d&&o.setDirty()},get dirty(){return!1},update:()=>this._update(o)};this._pass=makeFilter(o,c),c.passObject.onDirty!==void 0&&c.passObject.onDirty.push(()=>c.dirty=!0),o.renderer.registerPass(this._pass),this.enabled=this._enabledTemp}async onRemove(o){var c,d;this._pass&&o.renderer.unregisterPass(this._pass),(d=(c=this._pass)===null||c===void 0?void 0:c.dispose)===null||d===void 0||d.call(c),this._pass=void 0,await super.onRemove(o)}get pass(){return this._pass}toJSON(o){var c;const d=super.toJSON(o);if(!d.type)return d;const _=this.pass;return _&&(d.pass=serializeObject((c=_==null?void 0:_.passObject)!==null&&c!==void 0?c:_,!1,o)),d}fromJSON(o,c){var d;if(!super.fromJSON(o,c))return null;if(o.pass){const _=this.pass;_&&deserializeObject(o.pass,(d=_==null?void 0:_.passObject)!==null&&d!==void 0?d:_,!1,c)}return this}}GenericFilterPlugin_decorate([serialize()],GenericFilterPlugin.prototype,"enabled",null);class GBufferRenderPass extends RenderPass{constructor(o,c,d=new three_module.Q1f(1,1,1),_=1){super(void 0,void 0,c,d,_),this.target=o,this._transparentMats=new Set,this._transmissiveMats=new Set}render(o,c,d,_,b){var _e;const it=o.getRenderTarget(),nt=o.getActiveCubeFace(),at=o.getActiveMipmapLevel();(_e=this.scene)===null||_e===void 0||_e.traverse(({material:ut})=>{ut&&((ut.transparent&&ut.userData.renderToDepth||!ut.transparent&&ut.transmission===0&&ut.userData.renderToDepth===!1)&&(this._transparentMats.add(ut),ut.transparent=!ut.transparent),Math.abs(ut.transmission||0)>0&&ut.userData.renderToDepth&&(this._transmissiveMats.add([ut,ut.transmission]),ut.transmission=0))}),setThreeRendererMode(o,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!0,transparentRender:!1,transmissionRender:!1,mainRenderPass:!1},()=>super.render(o,c,this.target,_,b)),this._transparentMats.forEach(ut=>ut.transparent=!ut.transparent),this._transparentMats.clear(),this._transmissiveMats.forEach(([ut,pt])=>ut.transmission=pt),this._transmissiveMats.clear(),o.setRenderTarget(it,nt,at)}}class GBufferPlugin extends GenericFilterPlugin{get material(){return this._material}passCtor(o){var c,d,_;const b=((c=this._viewer)===null||c===void 0?void 0:c.renderer.isWebGL2)&&this.renderFlagsBuffer,_e=o.renderer.createTarget({depthBuffer:!0,samples:((d=this._viewer)===null||d===void 0?void 0:d.useGBufferDepth)&&((_=this._viewer)===null||_===void 0?void 0:_.renderer.composerTarget.samples)||0,type:three_module.OUM,textureCount:b?2:1,depthTexture:this.renderDepthTexture,depthTextureType:this.depthTextureType});return Array.isArray(_e.texture)?(_e.texture[0].name="gbufferDepthNormal",_e.texture[1].name="gbufferFlags",this._gbufferTextures=_e.texture):(_e.texture.name="gbufferDepthNormal",this._gbufferTextures.push(_e.texture)),this._gbufferTarget=_e,this._material=new DepthNormalMaterial(b),this._material.userData.isGBufferMaterial=!0,new GBufferRenderPass(_e,this._material)}_update(o){if(!super._update(o))return!1;const c=this.pass.passObject;return c.scene=o.scene.modelObject,o.scene.renderCamera.updateShaderProperties(c.overrideMaterial),c.camera=o.scene.renderCamera.cameraObject,!0}constructor(o=!0,c=!1,d=three_module.bkx){super(),this.renderFlagsBuffer=o,this.renderDepthTexture=c,this.depthTextureType=d,this.passId="gbuffer",this._beforeFilters=["render"],this._afterFilters=[],this._requiredFilters=["render"],this._gbufferTextures=[]}getDepthNormal(){return this._gbufferTextures.length>0?this._gbufferTextures[0]:void 0}getFlagsTexture(){return this._gbufferTextures.length>1?this._gbufferTextures[1]:void 0}async onDispose(o){}async onRemove(o){return this._gbufferTarget&&(o.renderer.disposeTarget(this._gbufferTarget),this._gbufferTarget=void 0),super.onRemove(o)}getTarget(){return this._gbufferTarget}getDepthTexture(){var o;return(o=this._gbufferTarget)===null||o===void 0?void 0:o.depthTexture}getUnpackSnippet(){return unpackGbuffer}updateShaderProperties(o){var c,d,_;if(o.uniforms.tNormalDepth?o.uniforms.tNormalDepth.value=(c=this.getDepthNormal())!==null&&c!==void 0?c:void 0:(d=this._viewer)===null||d===void 0||d.console.warn("BaseRenderer: no uniform: tNormalDepth"),o.uniforms.tGBufferFlags){o.uniforms.tGBufferFlags.value=(_=this.getFlagsTexture())!==null&&_!==void 0?_:void 0;const b=o.uniforms.tGBufferFlags.value?1:0;b!==o.defines.GBUFFER_HAS_FLAGS&&(o.defines.GBUFFER_HAS_FLAGS=b,o.needsUpdate=!0)}return this}registerGBufferUpdater(o){this._material&&this._material.addGBufferUpdater(o)}}GBufferPlugin.PluginType="GBuffer";class RenderPass2 extends RenderPass{get transparentTarget(){return this._transparentTarget||(this._transparentTarget=this._viewer.renderer.getTempTarget({sizeMultiplier:1,samples:this._viewer.renderer.composerTarget.samples||0,colorSpace:three_module.jf0,type:this._viewer.renderer.rendererObject.extensions.has("EXT_color_buffer_half_float")?three_module.ix0:three_module.OUM,format:three_module.GWd,minFilter:three_module.k6q,magFilter:three_module.k6q,depthBuffer:!1})),this._transparentTarget}_releaseTransparentTarget(){this._transparentTarget&&this._viewer.renderer.releaseTempTarget(this._transparentTarget),this._transparentTarget=void 0}constructor(o,c=!0){super(),this.blurTransmissionTarget=!0,this.preserveTransparentTarget=!1,this._viewer=o,this._doTransmissionFix=c,this.clear=!0,this.clearColor=new three_module.Q1f(0,0,0),this.clearAlpha=0,this.clearDepth=!1,this._blendPass=new GenericBlendTexturePass({},"c = vec4(a.rgb * (1. - b.a) + b.rgb * b.a, 1.);",void 0,void 0,o.renderer.maxHDRIntensity)}render(o,c,d,_,b){var _e;let it=!1;if(o.userData.mainRenderPass=!0,!this._doTransmissionFix)return super.render(o,c,d,_,b),this.needsSwap=it,void(o.userData.mainRenderPass=void 0);const nt=o.userData;nt||console.error("threejs is not patched?");const at=this._viewer.useGBufferDepth;let ut;if(at){const mt=(_e=this._viewer.getPlugin(GBufferPlugin))===null||_e===void 0?void 0:_e.getTarget();if(mt){const ft=o.properties.get(mt);ut=ft.__webglDepthRenderbuffer||ft.__webglDepthbuffer}else console.warn("No Gbuffer present for depth prepass.")}let pt=(mt=!1)=>{super.render(o,void 0,d,_,b,ut)};if(this._viewer.useRgbm){if(this._viewer.useRgbm){if(it=!1,o.info&&!o.info.autoReset)throw"renderer.info.autoReset must be true";{const mt=o.autoClearDepth;o.autoClearDepth=!at,setThreeRendererMode(o,{shadowMapRender:!0,backgroundRender:!0,opaqueRender:!0,transparentRender:!1,transmissionRender:!1},pt),o.autoClearDepth=mt}if(!at){const mt=o.properties.get(d);ut=mt.__webglDepthRenderbuffer||mt.__webglDepthbuffer}pt=()=>{super.render(o,void 0,this.transparentTarget,_,b,ut)};{const mt=this.clear,ft=o.autoClearDepth;o.autoClearDepth=!1,this.clear=!0,setThreeRendererMode(o,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!1,transparentRender:!0,transmissionRender:!1},pt),this.clear=mt,o.autoClearDepth=ft}(!o.info||o.info.render.calls>0)&&(this._blendPass.uniforms.tDiffuse2.value=this.transparentTarget.texture,this._blendPass.render(o,c,d,_,b),it=!0);{const mt=this.clear;this.clear=!1,nt.transmissionRenderTarget=it?c:d,nt.blurTransmissionTarget=this.blurTransmissionTarget&&nt.transmissionRenderTarget.samples===0,setThreeRendererMode(o,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!1,transparentRender:!1,transmissionRender:!0},pt),nt.blurTransmissionTarget=void 0,nt.transmissionRenderTarget=void 0,this.clear=mt}(!o.info||o.info.render.calls>0)&&(this._blendPass.uniforms.tDiffuse2.value=this.transparentTarget.texture,this._blendPass.render(o,c,d,_,b),it=!0)}}else{{const mt=this.clear,ft=o.autoClearDepth;o.autoClearDepth=!at,this.clear=!0,setThreeRendererMode(o,{shadowMapRender:!0,backgroundRender:!0,opaqueRender:!0,transparentRender:!0,transmissionRender:!1},pt),this.clear=mt,o.autoClearDepth=ft}{this._viewer.renderer.blit(d.texture,c,{clear:!0});const mt=this.clear;this.clear=!1,nt.transmissionRenderTarget=c,nt.blurTransmissionTarget=this.blurTransmissionTarget,setThreeRendererMode(o,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!1,transparentRender:!1,transmissionRender:!0},pt),nt.blurTransmissionTarget=void 0,nt.transmissionRenderTarget=void 0,this.clear=mt}it=!1}this.preserveTransparentTarget||this._releaseTransparentTarget(),this.needsSwap=it,o.userData.mainRenderPass=void 0}dispose(){this._releaseTransparentTarget(),super.dispose()}}function vRGBMToLinear(h,o){return h.multiplyScalar(h.w*o),h.w=1,h}function cRGBMToLinear(h,o){return vRGBMToLinear(h,o),new three_module.Q1f(h.x,h.y,h.z)}function vLinearToRGBM(h,o){const c=Math.max(h.x,Math.max(h.y,h.z));let d=Math.max(Math.min(c/o,1),0);return d=Math.ceil(255*d)/255,h.divideScalar(d*o),h.w=d,h}function cLinearToRGBM(h,o){return vLinearToRGBM(new three_module.IUQ(h.r,h.g,h.b,1),o)}const threeMaterialPropList={name:"",blending:three_module.NTi,side:three_module.hB5,vertexColors:!1,opacity:1,transparent:!1,blendSrc:three_module.ie2,blendDst:three_module.OuU,blendEquation:three_module.gO9,blendSrcAlpha:null,blendDstAlpha:null,blendEquationAlpha:null,depthFunc:three_module.xSv,depthTest:!0,depthWrite:!0,stencilWriteMask:255,stencilFunc:three_module.sKt,stencilRef:0,stencilFuncMask:255,stencilFail:three_module.VVr,stencilZFail:three_module.VVr,stencilZPass:three_module.VVr,stencilWrite:!1,clippingPlanes:null,clipIntersection:!1,clipShadows:!1,shadowSide:null,colorWrite:!0,precision:null,polygonOffset:!1,polygonOffsetFactor:0,polygonOffsetUnits:0,dithering:!1,alphaToCoverage:!1,premultipliedAlpha:!1,forceSinglePass:!1,visible:!0,toneMapped:!0,userData:{},alphaTest:0,alphaHash:!1},standardMaterialPropList={...threeMaterialPropList,color:"#ffffff",roughness:1,metalness:0,map:null,lightMap:null,lightMapIntensity:1,aoMap:null,aoMapIntensity:1,emissive:"#000000",emissiveIntensity:1,emissiveMap:null,bumpMap:null,bumpScale:1,normalMap:null,normalMapType:three_module.bI3,normalScale:new three_module.I9Y(1,1),displacementMap:null,displacementScale:1,displacementBias:0,roughnessMap:null,metalnessMap:null,alphaMap:null,envMap:null,envMapIntensity:1,wireframe:!1,wireframeLinewidth:1,wireframeLinecap:"round",wireframeLinejoin:"round",flatShading:!1,fog:!0},physicalMaterialPropList={...standardMaterialPropList,clearcoat:0,clearcoatMap:null,clearcoatRoughness:0,clearcoatRoughnessMap:null,clearcoatNormalScale:new three_module.I9Y(1,1),clearcoatNormalMap:null,reflectivity:.5,iridescence:0,iridescenceMap:null,iridescenceIOR:1.3,iridescenceThicknessRange:[100,400],iridescenceThicknessMap:null,sheen:0,sheenColor:new three_module.Q1f(0),sheenColorMap:null,sheenRoughness:1,sheenRoughnessMap:null,transmission:0,transmissionMap:null,thickness:0,thicknessMap:null,attenuationDistance:1/0,attenuationColor:new three_module.Q1f(1,1,1),specularIntensity:1,specularIntensityMap:null,specularColor:new three_module.Q1f(1,1,1),specularColorMap:null};class MeshStandardMaterial2 extends three_module.uSd{constructor(o){var c;super(o),this.typeSlug=MeshStandardMaterial2.TypeSlug,this.assetType="material",this.materialObject=this,this.isMeshStandardMaterial2=!0,this.extraUniformsToUpload={},this.setDirty=this.setDirty.bind(this),this.userData.setDirty=d=>{console.warn("userData.setDirty is deprecated. Use setDirty instead."),this.setDirty(d)},this.fog=!1,this.attenuationDistance=0,this.materialExtensions=MaterialExtender.RegisterExtensions(this,(c=o==null?void 0:o.customMaterialExtensions)!==null&&c!==void 0?c:[])}setDirty(o){var c,d;this.needsUpdate=!0,this.dispatchEvent({...o,type:"materialUpdate"}),(o==null?void 0:o.last)!==!1&&((d=(c=this._uiConfig)===null||c===void 0?void 0:c.uiRefresh)===null||d===void 0||d.call(c,"postFrame",!0,1))}registerMaterialExtensions(o){this.materialExtensions=[...this.materialExtensions,...MaterialExtender.RegisterExtensions(this,o)]}unregisterMaterialExtensions(o){}get uiConfig(){return this._uiConfigChildren||(this._uiConfigChildren=[{type:"input",property:[this,"name"]},{type:"checkbox",property:[this,"wireframe"]},{type:"checkbox",property:[this,"vertexColors"]},{type:"color",property:[this,"color"],limitedUi:!0},{type:"image",property:[this,"map"]},makeSamplerUi(this,"map"),{type:"folder",label:"Rough/Metal",limitedUi:!0,children:[{type:"slider",bounds:[0,1],property:[this,"roughness"],limitedUi:!0},{type:"slider",bounds:[0,1],property:[this,"metalness"],limitedUi:!0},{type:"image",property:[this,"roughnessMap"]},makeSamplerUi(this,"roughnessMap"),{type:"image",property:[this,"metalnessMap"]},makeSamplerUi(this,"metalnessMap")]},{type:"folder",label:"Bump/Normal",limitedUi:!0,children:[{type:"slider",bounds:[-.1,.2],stepSize:.001,property:[this,"bumpScale"],hidden:()=>!this.bumpMap},{type:"image",property:[this,"bumpMap"]},makeSamplerUi(this,"bumpMap"),{type:"image",property:[this,"normalMap"]},{type:"vec2",property:[this,"normalScale"],hidden:()=>!this.normalMap},{type:"dropdown",hidden:()=>!this.normalMap,property:[this,"normalMapType"],children:[["TangentSpace",three_module.bI3],["ObjectSpace",three_module.vyJ]].map(o=>({label:o[0],value:o[1]}))},makeSamplerUi(this,"normalMap"),{type:"input",property:[this,"displacementScale"],hidden:()=>!this.displacementMap},{type:"image",property:[this,"displacementMap"]},makeSamplerUi(this,"displacementMap")]},{type:"folder",label:"Sheen",children:[{type:"slider",bounds:[0,1],property:[this,"sheen"]},{type:"color",hidden:()=>this.sheen<.001,property:[this,"sheenColor"]},{type:"image",property:[this,"sheenColorMap"]},makeSamplerUi(this,"sheenColorMap"),{type:"slider",bounds:[0,1],property:[this,"sheenRoughness"]},{type:"image",property:[this,"sheenRoughnessMap"]},makeSamplerUi(this,"sheenRoughnessMap")]},{type:"folder",label:"Clearcoat",children:[{type:"slider",bounds:[0,1],property:[this,"clearcoat"]},{type:"slider",bounds:[0,1],hidden:()=>this.clearcoat<.001,property:[this,"clearcoatRoughness"]},{type:"image",property:[this,"clearcoatMap"]},makeSamplerUi(this,"clearcoatMap"),{type:"slider",bounds:[0,1],property:[this,"clearcoatRoughness"]},{type:"image",property:[this,"clearcoatRoughnessMap"]},makeSamplerUi(this,"clearcoatRoughnessMap"),{type:"image",property:[this,"clearcoatNormalMap"]},{type:"vec2",property:[this,"clearcoatNormalScale"],hidden:()=>!this.clearcoatNormalMap},makeSamplerUi(this,"clearcoatNormalMap")]},{type:"folder",label:"Emission",children:[{type:"color",property:[this,"emissive"]},{type:"slider",bounds:[0,10],property:[this,"emissiveIntensity"]},{type:"image",property:[this,"emissiveMap"]},makeSamplerUi(this,"emissiveMap")]},{type:"folder",label:"Refraction",children:[{type:"slider",bounds:[0,4],property:[this,"ior"]},{type:"slider",bounds:[0,1],property:[this,"transmission"],limitedUi:!0},{type:"slider",bounds:[0,1],stepSize:.001,property:[this,"thickness"]},{type:"image",property:[this,"transmissionMap"]},makeSamplerUi(this,"transmissionMap"),{type:"image",property:[this,"thicknessMap"]},makeSamplerUi(this,"thicknessMap"),{type:"input",property:[this,"attenuationDistance"]},{type:"color",property:[this,"attenuationColor"]}]},{type:"folder",label:"Blending",children:[{type:"slider",bounds:[0,1],property:[this,"opacity"]},{type:"checkbox",property:[this,"transparent"],onChange:this.setDirty},{type:"dropdown",property:[this,"depthFunc"],children:[["Never",three_module.eHc],["Always",three_module.lGu],["Less",three_module.brA],["LessEqual",three_module.xSv],["Equal",three_module.U3G],["GreaterEqual",three_module.Gwm],["Greater",three_module.K52],["NotEqual",three_module.bw0]].map(o=>({label:o[0],value:o[1]}))},{type:"checkbox",property:[this,"depthTest"],onChange:this.setDirty},{type:"checkbox",property:[this,"depthWrite"],onChange:this.setDirty},{type:"checkbox",property:[this,"colorWrite"],onChange:this.setDirty},{type:"slider",bounds:[0,1],stepSize:.001,property:[this,"alphaTest"]},{type:"checkbox",property:[this,"alphaHash"]},{type:"checkbox",property:[this,"dithering"]},{type:"dropdown",label:"Blending",property:[this,"blending"],children:[["None",three_module.XIg],["Normal",three_module.NTi],["Additive",three_module.EZo],["Subtractive",three_module.Kwu],["Multiply",three_module.EdD]].map(o=>({label:o[0],value:o[1]}))},{type:"image",property:[this,"alphaMap"]},makeSamplerUi(this,"alphaMap"),{type:"checkbox",label:"Render to Depth",getValue:()=>this.userData.renderToDepth===!0,setValue:o=>{this.userData.renderToDepth=o||void 0,this.setDirty()}},{type:"checkbox",label:"Inverse AlphaMap",hidden:()=>!this.transparent,getValue:()=>this.userData.inverseAlphaMap===!0,setValue:o=>{this.userData.inverseAlphaMap=o||void 0,this.setDirty()}},{type:"checkbox",label:"Polygon Offset",property:[this,"polygonOffset"]},{type:"slider",label:"Polygon Offset Factor",bounds:[-10,10],property:[this,"polygonOffsetFactor"]},{type:"slider",label:"Polygon Offset Units",bounds:[-10,10],property:[this,"polygonOffsetUnits"]}]},{type:"folder",label:"AO/Lightmap",children:[{type:"slider",bounds:[0,2],property:[this,"aoMapIntensity"]},{type:"image",property:[this,"aoMap"]},makeSamplerUi(this,"aoMap"),{type:"slider",bounds:[0,2],property:[this,"lightMapIntensity"]},{type:"image",property:[this,"lightMap"]},makeSamplerUi(this,"lightMap")]},{type:"folder",label:"Iridescence",children:[{type:"slider",bounds:[0,3],label:"Intensity",property:[this,"iridescence"]},{type:"slider",bounds:[0,3],label:"IOR",property:[this,"iridescenceIOR"]},{type:"slider",bounds:[0,500],label:"Thickness0",property:[this.iridescenceThicknessRange,"0"],onChange:this.setDirty},{type:"slider",bounds:[0,500],label:"Thickness1",property:[this.iridescenceThicknessRange,"1"],onChange:this.setDirty},{type:"image",property:[this,"iridescenceMap"]},makeSamplerUi(this,"iridescenceMap"),{type:"image",property:[this,"iridescenceThicknessMap"]},makeSamplerUi(this,"iridescenceThicknessMap")]},{type:"folder",label:"Environment",children:[{type:"checkbox",label:"Override Environment",getValue:()=>this.userData.separateEnvMapIntensity===!0,setValue:o=>{this.userData.separateEnvMapIntensity=o,o||delete this.userData.separateEnvMapIntensity},onChange:this.setDirty},{type:"slider",bounds:[0,10],hidden:()=>!this.userData.separateEnvMapIntensity,label:"Environment Intensity",property:[this,"envMapIntensity"]},{type:"dropdown",hidden:()=>!this.userData.separateEnvMapIntensity&&!this.userData.envMapSlotKey,label:"Environment Map",children:["","environment1","environment2"].map(o=>({label:o||"default",value:o})),getValue:()=>this.userData.envMapSlotKey||"",setValue:o=>{this.userData.envMapSlotKey=o,o||delete this.userData.envMapSlotKey,this.setDirty()}}]},{type:"dropdown",label:"Side",property:[this,"side"],children:[["Front",three_module.hB5],["Back",three_module.hsX],["Double",three_module.$EB]].map(o=>({label:o[0],value:o[1]}))},{type:"checkbox",property:[this,"flatShading"]},{type:"input",label:"Mesh count",getValue:()=>{var o,c,d;return(d=(c=(o=this.userData)===null||o===void 0?void 0:o.__appliedMeshes)===null||c===void 0?void 0:c.size)!==null&&d!==void 0?d:0},setValue:o=>{},disabled:!0},{type:"button",label:`Download ${this.typeSlug}`,value:()=>{N$2(new Blob([JSON.stringify(serializeObject(this,!1),null,2)],{type:"application/json"}),`physical-material.${this.typeSlug}`)}}]),this._uiConfig||(this._uiConfig={type:"folder",label:"Physical Material",expanded:!0,children:this._uiConfigChildren,uuid:"MSM2_"+this.uuid,limitedUi:!0}),this._uiConfig.children=[...this._uiConfigChildren,...this.materialExtensions.map(o=>{var c;return(c=o.getUiConfig)===null||c===void 0?void 0:c.call(o,this)})].filter(o=>o),this._uiConfig}onBeforeCompile(o,c){const d=[["vec3 totalDiffuse = ","afterModulation"],["#include <aomap_fragment>","beforeModulation"],["#include <lights_physical_fragment>","beforeAccumulation"],["#include <clipping_planes_fragment>","mainStart"]],_=[["#include <uv_vertex>","mainStart"]];for(const b of _)o.vertexShader=shaderReplaceString(o.vertexShader,b[0],"#glMarker "+b[1]+`
`+b[0]);for(const b of d)o.fragmentShader=shaderReplaceString(o.fragmentShader,b[0],"#glMarker "+b[1]+`
`+b[0]);MaterialExtender.ApplyMaterialExtensions(this,o,this.materialExtensions,c),o.fragmentShader=o.fragmentShader.replaceAll("#glMarker","// "),o.vertexShader=o.vertexShader.replaceAll("#glMarker","// "),o.defines.INVERSE_ALPHAMAP=this.userData.inverseAlphaMap?1:0,super.onBeforeCompile(o,c)}customProgramCacheKey(){return super.customProgramCacheKey()+MaterialExtender.CacheKeyForExtensions(this,this.materialExtensions)+this.userData.inverseAlphaMap}onBeforeRender(o,c,d,_,b){super.onBeforeRender(o,c,d,_,b),this.envMapIntensity===void 0||this.userData.separateEnvMapIntensity||c.envMapIntensity===void 0||(this.userData.__envIntensity=this.envMapIntensity,this.envMapIntensity=c.envMapIntensity),this.envMap!==void 0&&c.fixedEnvMapDirection!==void 0&&(c.fixedEnvMapDirection?this.defines.FIX_ENV_DIRECTION||(this.defines.FIX_ENV_DIRECTION="1",this.needsUpdate=!0):this.defines.FIX_ENV_DIRECTION!==void 0&&(delete this.defines.FIX_ENV_DIRECTION,this.needsUpdate=!0)),this.dispatchEvent({type:"beforeRender",renderer:o,scene:c,camera:d,geometry:_,object:b});const _e=this.userData.inverseAlphaMap?1:0;_e!==this.defines.INVERSE_ALPHAMAP&&(this.defines.INVERSE_ALPHAMAP=_e,this.needsUpdate=!0)}onAfterRender(o,c,d,_,b){super.onAfterRender(o,c,d,_,b),this.userData.__envIntensity!==void 0&&(this.envMapIntensity=this.userData.__envIntensity,delete this.userData.__envIntensity),this.dispatchEvent({type:"afterRender",renderer:o,scene:c,camera:d,geometry:_,object:b})}copyProps(o,c=!1,d=!0){if(!c&&!["MeshStandardMaterial",MeshStandardMaterial2.TYPE,"MeshPhysicalMaterial"].includes(o.type))return console.error("Material type is not supported:",o.type),this;const _={};xe$1(o,_,Array.from(Object.keys(physicalMaterialPropList)));const b=_.userData;delete _.userData;for(const _e of Object.keys(_))_[_e]===void 0&&delete _[_e];if(this.setValues(_),d)for(const _e of iMaterialIgnoredUserData)this.userData[_e]!==void 0&&this.userData[_e];return b&&copyMaterialUserData(this.userData,b),isFinite(this.attenuationDistance)||(this.attenuationDistance=0),this.setDirty(),this}toJSON(o){var c,d;const _=this.userData;this.userData={};const b=super.toJSON(o);this.userData=_,b.userData={},copyMaterialUserData(b.userData,_),b.userData.uuid=this.userData.uuid;const _e=o||{textures:Object.fromEntries(((c=b.textures)===null||c===void 0?void 0:c.map(it=>[it.uuid,it]))||[]),images:Object.fromEntries(((d=b.images)===null||d===void 0?void 0:d.map(it=>[it.uuid,it]))||[])};b.userData=serializeObject(b.userData,!1,_e),o||(Object.keys(_e.textures).length>0&&(b.textures=Object.values(_e.textures)),Object.keys(_e.images).length>0&&(b.images=Object.values(_e.images))),b.type=MeshStandardMaterial2.TYPE;for(const it of Object.keys(b))b[it]===void 0&&delete b[it];return b}fromJSON(o,c,d=!1){return this.copyProps(o,d)}clone(){return super.clone()}}MeshStandardMaterial2.TypeSlug="pmat",MeshStandardMaterial2.TYPE="MeshStandardMaterial2";const basicMaterialPropList={...threeMaterialPropList,color:"#ffffff",map:null,lightMap:null,lightMapIntensity:1,aoMap:null,aoMapIntensity:1,specularMap:null,alphaMap:null,envMap:null,combine:three_module.caT,reflectivity:1,refractionRatio:.98,wireframe:!1,wireframeLinewidth:1,wireframeLinecap:"round",wireframeLinejoin:"round",skinning:!1,fog:!0};class MeshBasicMaterial2 extends three_module.V9B{constructor(o){var c;super(o),this.typeSlug=MeshBasicMaterial2.TypeSlug,this.assetType="material",this.materialObject=this,this.isMeshBasicMaterial2=!0,this.extraUniformsToUpload={},!this.defines&&(this.defines={}),this.fog=!1,this.setDirty=this.setDirty.bind(this),this.userData.setDirty=d=>{console.warn("WebGi: userData.setDirty is deprecated. Use setDirty instead."),this.setDirty(d)},this.materialExtensions=MaterialExtender.RegisterExtensions(this,(c=o==null?void 0:o.customMaterialExtensions)!==null&&c!==void 0?c:[])}setDirty(o){var c,d;this.needsUpdate=!0,this.dispatchEvent({...o,type:"materialUpdate"}),(o==null?void 0:o.last)!==!1&&((d=(c=this._uiConfig)===null||c===void 0?void 0:c.uiRefresh)===null||d===void 0||d.call(c,"postFrame",!0,1))}registerMaterialExtensions(o){this.materialExtensions=[...this.materialExtensions,...MaterialExtender.RegisterExtensions(this,o)]}unregisterMaterialExtensions(o){}get uiConfig(){return this._uiConfigChildren||(this._uiConfigChildren=[{type:"input",property:[this,"name"]},{type:"checkbox",property:[this,"wireframe"]},{type:"color",property:[this,"color"],limitedUi:!0},{type:"image",property:[this,"map"]},makeSamplerUi(this,"map"),{type:"folder",label:"Blending",children:[{type:"slider",bounds:[0,1],property:[this,"opacity"]},{type:"checkbox",property:[this,"transparent"],onChange:this.setDirty},{type:"checkbox",property:[this,"depthWrite"],onChange:this.setDirty},{type:"checkbox",property:[this,"colorWrite"],onChange:this.setDirty},{type:"slider",bounds:[0,1],property:[this,"alphaTest"]},{type:"checkbox",property:[this,"alphaHash"]},{type:"checkbox",property:[this,"dithering"]},{type:"dropdown",label:"Blending",property:[this,"blending"],children:[["None",three_module.XIg],["Normal",three_module.NTi],["Additive",three_module.EZo],["Subtractive",three_module.Kwu],["Multiply",three_module.EdD]].map(o=>({label:o[0],value:o[1]}))},{type:"image",property:[this,"alphaMap"]},makeSamplerUi(this,"alphaMap"),{type:"checkbox",label:"Render to Depth",getValue:()=>this.userData.renderToDepth===!0,setValue:o=>{this.userData.renderToDepth=o||void 0,this.setDirty()}}]},{type:"folder",label:"AO/Lightmap",children:[{type:"slider",bounds:[0,2],property:[this,"aoMapIntensity"]},{type:"image",property:[this,"aoMap"]},makeSamplerUi(this,"aoMap"),{type:"slider",bounds:[0,2],property:[this,"lightMapIntensity"]},{type:"image",property:[this,"lightMap"]},makeSamplerUi(this,"lightMap")]},{type:"dropdown",label:"Side",property:[this,"side"],children:[["Front",three_module.hB5],["Back",three_module.hsX],["Double",three_module.$EB]].map(o=>({label:o[0],value:o[1]}))},{type:"input",label:"Mesh count",getValue:()=>{var o,c,d;return(d=(c=(o=this.userData)===null||o===void 0?void 0:o.__appliedMeshes)===null||c===void 0?void 0:c.size)!==null&&d!==void 0?d:0},setValue:o=>{},disabled:!0},{type:"button",label:`Download ${this.typeSlug}`,value:()=>{N$2(new Blob([JSON.stringify(serializeObject(this,!1),null,2)],{type:"application/json"}),`unlit-material.${this.typeSlug}`)}}]),this._uiConfig||(this._uiConfig={type:"folder",label:"Unlit Material",expanded:!0,children:this._uiConfigChildren,uuid:"MBM2_"+this.uuid,limitedUi:!0}),this._uiConfig.children=[...this._uiConfigChildren,...this.materialExtensions.map(o=>{var c;return(c=o.getUiConfig)===null||c===void 0?void 0:c.call(o,this)})].filter(o=>o),this._uiConfig}onBeforeCompile(o,c){const d=[["vec3 outgoingLight = ","afterModulation"],["#include <aomap_fragment>","beforeModulation"],["ReflectedLight reflectedLight = ","beforeAccumulation"],["#include <clipping_planes_fragment>","mainStart"]],_=[["#include <uv_vertex>","mainStart"]];for(const b of _)o.vertexShader=shaderReplaceString(o.vertexShader,b[0],"#glMarker "+b[1]+`
`+b[0]);for(const b of d)o.fragmentShader=shaderReplaceString(o.fragmentShader,b[0],"#glMarker "+b[1]+`
`+b[0]);MaterialExtender.ApplyMaterialExtensions(this,o,this.materialExtensions,c),this.dispatchEvent({type:"beforeCompile",shader:o,renderer:c}),o.fragmentShader=o.fragmentShader.replaceAll("#glMarker","// "),o.vertexShader=o.vertexShader.replaceAll("#glMarker","// "),super.onBeforeCompile(o,c)}customProgramCacheKey(){return super.customProgramCacheKey()+MaterialExtender.CacheKeyForExtensions(this,this.materialExtensions)+this.userData.inverseAlphaMap}onBeforeRender(o,c,d,_,b){super.onBeforeRender(o,c,d,_,b),this.dispatchEvent({type:"beforeRender",renderer:o,scene:c,camera:d,geometry:_,object:b})}onAfterRender(o,c,d,_,b){super.onAfterRender(o,c,d,_,b),this.dispatchEvent({type:"afterRender",renderer:o,scene:c,camera:d,geometry:_,object:b})}copyProps(o,c=!1){if(!c&&!["MeshBasicMaterial",MeshBasicMaterial2.TYPE].includes(o.type))return console.error("Material type is not supported:",o.type),this;const d={};xe$1(o,d,Array.from(Object.keys(basicMaterialPropList)));const _=d.userData;delete d.userData;for(const b of Object.keys(d))d[b]===void 0&&delete d[b];return this.setValues(d),_&&copyMaterialUserData(this.userData,_),this.setDirty(),this}toJSON(o){var c,d;const _=this.userData;this.userData={};const b=super.toJSON(o);this.userData=_,b.userData={},copyMaterialUserData(b.userData,_),b.userData.uuid=this.userData.uuid;const _e=o||{textures:Object.fromEntries(((c=b.textures)===null||c===void 0?void 0:c.map(it=>[it.uuid,it]))||[]),images:Object.fromEntries(((d=b.images)===null||d===void 0?void 0:d.map(it=>[it.uuid,it]))||[])};b.userData=serializeObject(b.userData,!1,_e),o||(Object.keys(_e.textures).length>0&&(b.textures=Object.values(_e.textures)),Object.keys(_e.images).length>0&&(b.images=Object.values(_e.images))),b.type=MeshBasicMaterial2.TYPE;for(const it of Object.keys(b))b[it]===void 0&&delete b[it];return b}fromJSON(o,c,d=!1){return this.copyProps(o,d)}clone(){return super.clone()}}MeshBasicMaterial2.TypeSlug="bmat",MeshBasicMaterial2.TYPE="MeshBasicMaterial2";const standardMaterialTemplate={materialType:MeshStandardMaterial2.TYPE,name:"standard",color:"#ffffff"},basicMaterialTemplate={materialType:MeshBasicMaterial2.TYPE,name:"basic",color:"#ffffff"},typeTemplateNameMap={[MeshStandardMaterial2.TYPE]:standardMaterialTemplate.name,MeshStandardMaterial:standardMaterialTemplate.name,MeshPhysicalMaterial:standardMaterialTemplate.name,[MeshBasicMaterial2.TYPE]:basicMaterialTemplate.name,MeshBasicMaterial:basicMaterialTemplate.name};class AMaterialManager extends I$2{constructor(){super(),this._templates=[standardMaterialTemplate,basicMaterialTemplate],this._materials=[],this._disposeMaterial=o=>{const c=o.target;if(!c||c.assetType!=="material")return;this._refreshTextureRefs();const d=this._getMapsForMaterial(c),_=[];d.forEach(b=>{const _e=b.userData.__appliedMaterials;_e==null||_e.delete(c),_e&&b.userData.disposeOnIdle!==!1&&_e.size===0&&_.push(b)}),_.forEach(b=>{b.dispose()})},this._materialExtensions=[],this.processModel=this.processModel.bind(this),this.processMaterial=this.processMaterial.bind(this)}findOrCreate(o,c){let d=this.findMaterial(o);return d||(d=this.generateFromTemplate(o,c)),d}generateFromTemplate(o,c){const d=this.findTemplate(o);if(d)return this._generateFromTemplate(d,c??{})}generateFromTemplateType(o,c){const d=this._templates.find(_=>_.materialType===o);if(d)return this._generateFromTemplate(d,c??{})}findTemplate(o){return this._templates.find(c=>c.name===o)}_refreshTextureRefs(o){(o||this.getAllMaterials()).forEach(c=>{this._getMapsForMaterial(c).forEach(d=>{let _=d.userData.__appliedMaterials;_||(d.userData.__appliedMaterials=_=new Set),d.addEventListener("update",()=>c.dispatchEvent({type:"textureUpdate",texture:d})),_.add(c)})})}_getMapsForMaterial(o){var c;const d=new Set;for(const _ of Object.values(o))_&&_.isTexture&&d.add(_);for(const _ of Object.values((c=o.userData)!==null&&c!==void 0?c:{}))_&&_.isTexture&&d.add(_);return d}registerMaterial(o){if(this._materials.includes(o))return;const c=this.findMaterial(o.uuid);c?console.warn("WebGi MaterialManager: Material UUID already exists",o,c):(o.addEventListener("dispose",this._disposeMaterial),this._materials.push(o),this._refreshTextureRefs([o]))}registerMaterialObject(o){const c=o.materialObject?o:Object.assign(o,{assetType:"material",materialObject:o});return this.registerMaterial(c),c}unregisterMaterial(o){this._materials=this._materials.filter(c=>c.uuid!==o.uuid),o.removeEventListener("dispose",this._disposeMaterial)}registerMaterialTemplate(o){o.templateUUID||(o.templateUUID=esm_browser_v4());const c=this._templates.find(d=>d.templateUUID===o.templateUUID);c?console.warn("WebGi Material Manager: MaterialTemplate already exists",o,c):this._templates.push(o)}unregisterMaterialTemplate(o){this._templates=this._templates.filter(c=>c.templateUUID!==o.templateUUID)}dispose(o=!0){const c=this._materials;this._materials=[];for(const d of c)o||!d.userData.runtimeMaterial?d.dispose():this._materials.push(d)}findMaterial(o){return o?this._materials.find(c=>c.uuid===o):void 0}findMaterialsByName(o,c=!1){return this._materials.filter(d=>typeof o!="string"||c?d.name.match(typeof o=="string"?"^"+o+"$":o)!==null:d.name===o)}getMaterialsOfType(o){return o?this._materials.filter(c=>c.typeSlug===o):[]}getAllMaterials(){return[...this._materials]}processModel(o,c){return S$2(o,"modelObject",this._processModel(o,c)),o}_processMaterial(o,c){var d,_;if(!o)return;if(!((d=o.materialObject)===null||d===void 0)&&d.isMaterial)return o;let b=o.mmMaterial;if(!b){const _e=((_=o.userData)===null||_===void 0?void 0:_.uuid)||o.uuid;if(b=this.findMaterial(_e),b)b.copyProps(o);else{const it=c.useSourceMaterial===!1||!o.isMaterial,nt=c.materialTemplate||(it?"standard":typeTemplateNameMap[o.type]||"standard");b=this.generateFromTemplate(nt,it?{}:o)}o.mmMaterial=b}return b}processMaterial(o,c){return o.materialObject||(o=this._processMaterial(o,{...c,register:!1})),c.register!==!1&&this.registerMaterial(o),o}registerMaterialExtension(o){this._materialExtensions.includes(o)||this._materialExtensions.push(o)}unregisterMaterialExtension(o){const c=this._materialExtensions.indexOf(o);c>=0&&this._materialExtensions.splice(c,1)}exportMaterial(o,c,d=!0,_=!1){const b=serializeObject(o,!1),_e=JSON.stringify(b,null,d?0:2),it=(c||o.name||"physical_material")+"."+o.typeSlug,nt=new File([_e],it,{type:"application/json"});return _&&me$1(nt),nt}applyMaterial(o,c,d=!0){let _=this.findMaterialsByName(c,d);(!_||_.length<1)&&(_=[this.findMaterial(c)]);let b=!1;for(const _e of _)_e&&(_e.userData.__isVariation||_e!==o&&this.copyMaterialProps(_e,o)&&(b=!0));return b}copyMaterialProps(o,c){var d;let _=!1;const b=Object.getPrototypeOf(c).constructor.TYPE;if(Object.getPrototypeOf(o).constructor.TYPE===b){const _e=o.name;o.copyProps(c),o.name=_e,_=!0}else{const _e=o["__"+b]||this.generateFromTemplateType(b);if(_e){const it=o.name;_e.copyProps(c),_e.name=it;const nt=o.userData.__appliedMeshes;for(const at of[...nt??[]])(d=at==null?void 0:at.setMaterial)===null||d===void 0||d.call(at,_e),at&&(_=!0);o["__"+b]=_e}}return _}}class MaterialManager extends AMaterialManager{_generateFromTemplate(o,c){var d,_,b,_e,it,nt;let at;const ut={...o};ut.customMaterialExtensions=[...(d=ut.customMaterialExtensions)!==null&&d!==void 0?d:[],...this._materialExtensions];const pt=(c==null?void 0:c.metadata)&&(c==null?void 0:c.metadata.version)<=4.5;pt&&(three_module.ppV.enabled=!1);let mt={};switch(o.materialType){case"MeshStandardMaterial2":case"standard":c&&xe$1(c,ut,Array.from(Object.keys(physicalMaterialPropList))),(c==null?void 0:c.type)==="MeshBasicMaterial"&&(ut.roughness=.5,ut.metalness=.1,!((_=ut.userData)===null||_===void 0)&&_.uuid&&delete ut.userData.uuid),mt=(b=ut.userData)===null||b===void 0?void 0:b.uuid,mt&&delete ut.userData.uuid,at=new MeshStandardMaterial2({customMaterialExtensions:ut.customMaterialExtensions}).fromJSON(ut,void 0,!0),mt&&(at.uuid=mt),at.userData.uuid=at.uuid,at.setDirty(),c!=null&&c.isMaterial&&c.userData!==void 0&&(c.userData.iMaterial=at);break;case"MeshBasicMaterial2":case"basic":case"unlit":c&&xe$1(c,ut,Array.from(Object.keys(basicMaterialPropList))),mt=(_e=ut.userData)===null||_e===void 0?void 0:_e.uuid,mt&&delete ut.userData.uuid,at=new MeshBasicMaterial2({customMaterialExtensions:ut.customMaterialExtensions}).fromJSON(ut,void 0,!0),mt&&(at.uuid=mt,ut.userData.uuid=mt),at.userData.uuid=at.uuid,at.setDirty();break;case"shadow":throw"TODO: Not implemented shadow material";default:mt=null,c&&c.userData&&(mt=c.userData,delete c.userData),at=((it=o.generator)===null||it===void 0?void 0:it.call(o,ut,c))||void 0,c&&mt&&(c.userData=mt),mt&&at&&(copyMaterialUserData(at.userData,mt),mt!=null&&mt.uuid&&(at.uuid=mt.uuid),mt=null),at&&(at.userData.uuid=at.uuid)}if(at){c.runtimeMaterial&&(at.userData.runtimeMaterial=!0);const ft=at;if(at.clone=()=>{ft.userData.cloneId||(ft.userData.cloneId="0"),ft.userData.cloneCount||(ft.userData.cloneCount=0),ft.userData.cloneCount+=1;const vt=this.generateFromTemplate(o.name);return vt&&(vt.copyProps(ft),vt.userData.cloneId=vt.userData.cloneId+"_"+ft.userData.cloneCount,vt.userData.cloneCount=0,vt.name=vt.name+"_"+vt.userData.cloneId,vt.userData.uuid=vt.uuid),vt==null?void 0:vt.materialObject},c){let vt=this.findMaterial(c==null?void 0:c.uuid);vt&&this.unregisterMaterial(vt),vt=this.findMaterial((nt=c==null?void 0:c.materialObject)===null||nt===void 0?void 0:nt.uuid),vt&&this.unregisterMaterial(vt)}}return pt&&(three_module.ppV.enabled=!0),at?this.registerMaterialObject(at):void 0}_processModel(o,c){if(!o.modelObject)return console.error("MaterialManager: No modelObject found for ",o),o;let d=o.material;if(!d&&o.geometry&&(this._defaultMaterial||(this._defaultMaterial=this.generateFromTemplate("standard")),d=this._defaultMaterial,o.material=d),d){let _=!0;Array.isArray(d)||(d=[d],_=!1);const b=[];for(const _e of d){const it=this._processMaterial(_e,c);b.push(it==null?void 0:it.materialObject)}o.setMaterial&&(o.modelObject.material=null,o.setMaterial(_?b:b[0]))}if(c.recursive!==!1)for(let _=0;_<o.modelObject.children.length;_++)o.modelObject.children[_]=this._processModel(o.modelObject.children[_],c);return o}}class Importer{ctor(o){const c=this.cls&&new this.cls(o.loadingManager);return typeof this.onCtor=="function"?this.onCtor(c,o):c}constructor(o,c,d,_){this.cls=o,this.ext=c,this.root=d,this.onCtor=_}}class Object3DModel{get visible(){return this._modelObject.visible}set visible(o){this._modelObject.visible=o}get uuid(){return this._modelObject.uuid}get modelObject(){return this._modelObject}get name(){return this._modelObject.name}set name(o){this._modelObject.name=o}constructor(o,{pseudoCenter:c=!1,autoCenter:d=!1,autoScale:_=!1,autoScaleRadius:b=2,license:_e=""}={}){if(this.assetType="model",this._modelObject=setupIModel(new three_module.B69),this.setDirty=this.setDirty.bind(this),this.updateBounds=this.updateBounds.bind(this),o||(o=this._modelObject),!c||o.userData.pseudoCentered||o.userData.isCentered)!d||o.userData.autoCentered||o.userData.isCentered||o.userData.pseudoCentered?c||d||(o.userData.isCentered=!0):autoCenterObject3D(o),this._modelObject=o;else{d&&console.error("cannot use pseudoCenter and autoCenter at the same time");const it=new Box3B().expandByObject(o,!0,!0).getCenter(new three_module.Pq0);this._modelObject.position.copy(it).negate(),this._modelObject.updateMatrix(),this._modelObject.add(o),this._modelObject.name=o.name+"-centered",this._modelObject.userData.pseudoCentered=!0,this._modelObject.userData.isCentered=!0,o.userData.iModel=this}_&&!this._modelObject.userData.autoScaled?autoScaleObject3D(this._modelObject,o.userData.autoScaleRadius||b):this._modelObject.userData.autoScaled=!0,this._modelObject.addEventListener("dispose",()=>{this.__disposed=!0}),this._modelObject.userData.iModel=this,this.license=_e}get license(){return this._modelObject.userData.license}set license(o){this._modelObject.userData.license=o}addEventListener(o,c){this._modelObject.addEventListener(o,c)}dispatchEvent(o){this._modelObject.dispatchEvent(o)}hasEventListener(o,c){return this._modelObject.hasEventListener(o,c)}removeEventListener(o,c){this._modelObject.removeEventListener(o,c)}traverse(o){this._modelObject.traverse(o)}dispose(){const o=this._modelObject.dispose;o&&typeof o=="function"?o():(console.warn("WebGi Object3DModel: no dispose in modelObject"),this._modelObject.removeFromParent())}setDirty(o){var c,d,_,b;(d=(c=this._modelObject)===null||c===void 0?void 0:c.setDirty)===null||d===void 0||d.call(c,o),(b=(_=this._uiConfig)===null||_===void 0?void 0:_.uiRefresh)===null||b===void 0||b.call(_,"postFrame",!0)}setMaterial(o){var c,d;return this._modelObject.isMesh?((d=(c=this._modelObject).setMaterial)===null||d===void 0?void 0:d.call(c,o))||[]:(console.error("setMaterial only works on meshes"),[])}get material(){return this._modelObject.material}get geometry(){return this._modelObject.geometry}setGeometry(o,c=!1){var d,_;if(this._modelObject.isMesh)return(_=(d=this._modelObject).setGeometry)===null||_===void 0?void 0:_.call(d,o,c);console.error("setGeometry only works on meshes")}get userData(){return this._modelObject.userData}set userData(o){this._modelObject.userData=o}updateBounds(){console.warn("WebGi Object3DModel: updateBounds: NOT IMPLEMENTED, don't use"),this.setDirty()}get uiConfig(){return this._uiConfig||(this._uiConfig=makeObject3DUiConfig(this._modelObject,!1)),this._uiConfig}clone(){return new Object3DModel(this._modelObject.clone(),{pseudoCenter:!1,autoScale:!1,autoCenter:!1,license:this.license})}}function setupObject3dModel(h,o){return[h.modelObject,...h.modelObject.children].forEach(c=>{setupIModel(c,c!==h.modelObject?h:void 0,o)}),h}class ObjectProcessorMap{constructor(){this._processors=new Map}add(o,c){var d;this._processors.has(o)||this._processors.set(o,[]),(d=this._processors.get(o))===null||d===void 0||d.push(c)}remove(o,c){const d=this._processors.get(o),_=(d==null?void 0:d.indexOf(c))||(d==null?void 0:d.findIndex(b=>b.process&&b.process===c.process||b.processAsync&&b.processAsync===c.processAsync));!d||!_||_<0||d.splice(_,1)}get(o){var c;return(c=this._processors.get(o))!==null&&c!==void 0?c:[]}async process(o,c,d){var _,b,_e,it;const nt=this.get(o),at=c.assetType;for(const ut of nt)ut.forAssetType===at&&(c=(b=(_=ut.process)===null||_===void 0?void 0:_.call(ut,c,d))!==null&&b!==void 0?b:c,c=(it=await((_e=ut.processAsync)===null||_e===void 0?void 0:_e.call(ut,c,d)))!==null&&it!==void 0?it:c);return c}dispose(){this._processors.clear()}}class SimpleJSONLoader extends three_module.Y9S{load(o,c,d,_){return super.load(o,b=>{try{if(typeof b!="string")throw new Error("Invalid JSON");c==null||c(JSON.parse(b))}catch(_e){_==null||_(_e)}},d,_)}}class RGBELoader extends three_module.BRH{constructor(o){super(o),this.type=three_module.ix0}parse(o){const c=function(vt,xt){switch(vt){case 1:throw new Error("THREE.RGBELoader: Read Error: "+(xt||""));case 2:throw new Error("THREE.RGBELoader: Write Error: "+(xt||""));case 3:throw new Error("THREE.RGBELoader: Bad File Format: "+(xt||""));default:throw new Error("THREE.RGBELoader: Memory Error: "+(xt||""))}},d=function(vt,xt,At){xt=xt||1024;let Ct=vt.pos,Et=-1,Tt=0,kt="",Dt=String.fromCharCode.apply(null,new Uint16Array(vt.subarray(Ct,Ct+128)));for(;0>(Et=Dt.indexOf(`
`))&&Tt<xt&&Ct<vt.byteLength;)kt+=Dt,Tt+=Dt.length,Ct+=128,Dt+=String.fromCharCode.apply(null,new Uint16Array(vt.subarray(Ct,Ct+128)));return-1<Et&&(vt.pos+=Tt+Et+1,kt+Dt.slice(0,Et))},_=function(vt,xt,At,Ct){const Et=vt[xt+3],Tt=Math.pow(2,Et-128)/255;At[Ct+0]=vt[xt+0]*Tt,At[Ct+1]=vt[xt+1]*Tt,At[Ct+2]=vt[xt+2]*Tt,At[Ct+3]=1},b=function(vt,xt,At,Ct){const Et=vt[xt+3],Tt=Math.pow(2,Et-128)/255;At[Ct+0]=three_module.GxU.toHalfFloat(Math.min(vt[xt+0]*Tt,65504)),At[Ct+1]=three_module.GxU.toHalfFloat(Math.min(vt[xt+1]*Tt,65504)),At[Ct+2]=three_module.GxU.toHalfFloat(Math.min(vt[xt+2]*Tt,65504)),At[Ct+3]=three_module.GxU.toHalfFloat(1)},_e=new Uint8Array(o);_e.pos=0;const it=function(vt){const xt=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,At=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,Ct=/^\s*FORMAT=(\S+)\s*$/,Et=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,Tt={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let kt,Dt;for((vt.pos>=vt.byteLength||!(kt=d(vt)))&&c(1,"no header found"),(Dt=kt.match(/^#\?(\S+)/))||c(3,"bad initial token"),Tt.valid|=1,Tt.programtype=Dt[1],Tt.string+=kt+`
`;kt=d(vt),kt!==!1;)if(Tt.string+=kt+`
`,kt.charAt(0)!=="#"){if((Dt=kt.match(xt))&&(Tt.gamma=parseFloat(Dt[1])),(Dt=kt.match(At))&&(Tt.exposure=parseFloat(Dt[1])),(Dt=kt.match(Ct))&&(Tt.valid|=2,Tt.format=Dt[1]),(Dt=kt.match(Et))&&(Tt.valid|=4,Tt.height=parseInt(Dt[1],10),Tt.width=parseInt(Dt[2],10)),2&Tt.valid&&4&Tt.valid)break}else Tt.comments+=kt+`
`;return 2&Tt.valid||c(3,"missing format specifier"),4&Tt.valid||c(3,"missing image size specifier"),Tt}(_e),nt=it.width,at=it.height,ut=function(vt,xt,At){const Ct=xt;if(Ct<8||Ct>32767||vt[0]!==2||vt[1]!==2||128&vt[2])return new Uint8Array(vt);Ct!==(vt[2]<<8|vt[3])&&c(3,"wrong scanline width");const Et=new Uint8Array(4*xt*At);Et.length||c(4,"unable to allocate buffer space");let Tt=0,kt=0;const Dt=4*Ct,zt=new Uint8Array(4),Bt=new Uint8Array(Dt);let Rt=At;for(;Rt>0&&kt<vt.byteLength;){kt+4>vt.byteLength&&c(1),zt[0]=vt[kt++],zt[1]=vt[kt++],zt[2]=vt[kt++],zt[3]=vt[kt++],zt[0]==2&&zt[1]==2&&(zt[2]<<8|zt[3])==Ct||c(3,"bad rgbe scanline format");let Ut,Ht=0;for(;Ht<Dt&&kt<vt.byteLength;){Ut=vt[kt++];const Kt=Ut>128;if(Kt&&(Ut-=128),(Ut===0||Ht+Ut>Dt)&&c(3,"bad scanline data"),Kt){const sr=vt[kt++];for(let ir=0;ir<Ut;ir++)Bt[Ht++]=sr}else Bt.set(vt.subarray(kt,kt+Ut),Ht),Ht+=Ut,kt+=Ut}const Jt=Ct;for(let Kt=0;Kt<Jt;Kt++){let sr=0;Et[Tt]=Bt[Kt+sr],sr+=Ct,Et[Tt+1]=Bt[Kt+sr],sr+=Ct,Et[Tt+2]=Bt[Kt+sr],sr+=Ct,Et[Tt+3]=Bt[Kt+sr],Tt+=4}Rt--}return Et}(_e.subarray(_e.pos),nt,at);let pt,mt,ft;switch(this.type){case three_module.RQf:ft=ut.length/4;const vt=new Float32Array(4*ft);for(let At=0;At<ft;At++)_(ut,4*At,vt,4*At);pt=vt,mt=three_module.RQf;break;case three_module.ix0:ft=ut.length/4;const xt=new Uint16Array(4*ft);for(let At=0;At<ft;At++)b(ut,4*At,xt,4*At);pt=xt,mt=three_module.ix0;break;default:throw new Error("THREE.RGBELoader: Unsupported type: "+this.type)}return{width:nt,height:at,data:pt,header:it.string,gamma:it.gamma,exposure:it.exposure,type:mt}}setDataType(o){return this.type=o,this}load(o,c,d,_){return super.load(o,function(b,_e){switch(b.type){case three_module.RQf:case three_module.ix0:b.colorSpace=three_module.Zr2,b.minFilter=three_module.k6q,b.magFilter=three_module.k6q,b.generateMipmaps=!1,b.flipY=!0}c&&c(b,_e)},d,_)}}function addRGBELoader(h){return new Importer(class extends RGBELoader{constructor(o){super(o),this.setDataType(getTextureDataType(h.renderer.rendererObject))}},["hdr"],!1)}class GLTFLoader extends three_module.aHM{constructor(o){super(o),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(c){return new GLTFMaterialsClearcoatExtension(c)}),this.register(function(c){return new GLTFTextureBasisUExtension(c)}),this.register(function(c){return new GLTFTextureWebPExtension(c)}),this.register(function(c){return new GLTFTextureAVIFExtension(c)}),this.register(function(c){return new GLTFMaterialsSheenExtension(c)}),this.register(function(c){return new GLTFMaterialsTransmissionExtension(c)}),this.register(function(c){return new GLTFMaterialsVolumeExtension(c)}),this.register(function(c){return new GLTFMaterialsIorExtension(c)}),this.register(function(c){return new GLTFMaterialsEmissiveStrengthExtension(c)}),this.register(function(c){return new GLTFMaterialsSpecularExtension(c)}),this.register(function(c){return new GLTFMaterialsIridescenceExtension(c)}),this.register(function(c){return new GLTFMaterialsAnisotropyExtension(c)}),this.register(function(c){return new GLTFLightsExtension(c)}),this.register(function(c){return new GLTFMeshoptCompression(c)}),this.register(function(c){return new GLTFMeshGpuInstancing(c)})}load(o,c,d,_){const b=this;let _e;_e=this.resourcePath!==""?this.resourcePath:this.path!==""?this.path:three_module.r6x.extractUrlBase(o),this.manager.itemStart(o);const it=function(at){_?_(at):console.error(at),b.manager.itemError(o),b.manager.itemEnd(o)},nt=new three_module.Y9S(this.manager);nt.setPath(this.path),nt.setResponseType("arraybuffer"),nt.setRequestHeader(this.requestHeader),nt.setWithCredentials(this.withCredentials),nt.load(o,function(at){try{b.parse(at,_e,function(ut){c(ut),b.manager.itemEnd(o)},it,o)}catch(ut){it(ut)}},d,it)}setDRACOLoader(o){return this.dracoLoader=o,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(o){return this.ktx2Loader=o,this}setMeshoptDecoder(o){return this.meshoptDecoder=o,this}register(o){return this.pluginCallbacks.indexOf(o)===-1&&this.pluginCallbacks.push(o),this}unregister(o){return this.pluginCallbacks.indexOf(o)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(o),1),this}parse(o,c,d,_,b){let _e;const it={},nt={},at=new TextDecoder;if(typeof o=="string")_e=JSON.parse(o);else if(o instanceof ArrayBuffer)if(at.decode(new Uint8Array(o,0,4))===BINARY_EXTENSION_HEADER_MAGIC){try{it[EXTENSIONS.KHR_BINARY_GLTF]=new GLTFBinaryExtension(o)}catch(pt){return void(_&&_(pt))}_e=JSON.parse(it[EXTENSIONS.KHR_BINARY_GLTF].content)}else _e=JSON.parse(at.decode(o));else _e=o;if(_e.asset===void 0||_e.asset.version[0]<2)return void(_&&_(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported.")));const ut=new GLTFParser(_e,{path:c||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});ut.fileLoader.setRequestHeader(this.requestHeader);for(let pt=0;pt<this.pluginCallbacks.length;pt++){const mt=this.pluginCallbacks[pt](ut);nt[mt.name]=mt,it[mt.name]=!0}if(_e.extensionsUsed)for(let pt=0;pt<_e.extensionsUsed.length;++pt){const mt=_e.extensionsUsed[pt],ft=_e.extensionsRequired||[];switch(mt){case EXTENSIONS.KHR_MATERIALS_UNLIT:it[mt]=new GLTFMaterialsUnlitExtension;break;case EXTENSIONS.KHR_DRACO_MESH_COMPRESSION:it[mt]=new GLTFDracoMeshCompressionExtension(_e,this.dracoLoader);break;case EXTENSIONS.KHR_TEXTURE_TRANSFORM:it[mt]=new GLTFTextureTransformExtension;break;case EXTENSIONS.KHR_MESH_QUANTIZATION:it[mt]=new GLTFMeshQuantizationExtension;break;default:ft.indexOf(mt)>=0&&nt[mt]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+mt+'".')}}ut.setExtensions(it),ut.setPlugins(nt),ut.parse(d,_)}parseAsync(o,c){const d=this;return new Promise(function(_,b){d.parse(o,c,_,b)})}}function GLTFRegistry(){let h={};return{get:function(o){return h[o]},add:function(o,c){h[o]=c},remove:function(o){delete h[o]},removeAll:function(){h={}}}}GLTFLoader.ObjectConstructors={DirectionalLight:three_module.ZyN,PointLight:three_module.HiM,SpotLight:three_module.nCl,MeshStandardMaterial:three_module._4j,MeshBasicMaterial:three_module.V9B,MeshPhysicalMaterial:three_module.uSd,LineBasicMaterial:three_module.mrM,PointsMaterial:three_module.BH$,PerspectiveCamera:three_module.ubm,OrthographicCamera:three_module.qUd};const EXTENSIONS={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class GLTFLightsExtension{constructor(o){this.parser=o,this.name=EXTENSIONS.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const o=this.parser,c=this.parser.json.nodes||[];for(let d=0,_=c.length;d<_;d++){const b=c[d];b.extensions&&b.extensions[this.name]&&b.extensions[this.name].light!==void 0&&o._addNodeRef(this.cache,b.extensions[this.name].light)}}_loadLight(o){const c=this.parser,d="light:"+o;let _=c.cache.get(d);if(_)return _;const b=c.json,_e=((b.extensions&&b.extensions[this.name]||{}).lights||[])[o];let it;const nt=new three_module.Q1f(16777215);_e.color!==void 0&&nt.setRGB(_e.color[0],_e.color[1],_e.color[2],three_module.Zr2);const at=_e.range!==void 0?_e.range:0;switch(_e.type){case"directional":it=new GLTFLoader.ObjectConstructors.DirectionalLight(nt),it.target.position.set(0,0,-1),it.add(it.target);break;case"point":it=new GLTFLoader.ObjectConstructors.PointLight(nt),it.distance=at;break;case"spot":it=new GLTFLoader.ObjectConstructors.SpotLight(nt),it.distance=at,_e.spot=_e.spot||{},_e.spot.innerConeAngle=_e.spot.innerConeAngle!==void 0?_e.spot.innerConeAngle:0,_e.spot.outerConeAngle=_e.spot.outerConeAngle!==void 0?_e.spot.outerConeAngle:Math.PI/4,it.angle=_e.spot.outerConeAngle,it.penumbra=1-_e.spot.innerConeAngle/_e.spot.outerConeAngle,it.target.position.set(0,0,-1),it.add(it.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+_e.type)}return it.position.set(0,0,0),it.decay=2,assignExtrasToUserData(it,_e),_e.intensity!==void 0&&(it.intensity=_e.intensity),it.name=c.createUniqueName(_e.name||"light_"+o),_=Promise.resolve(it),c.cache.add(d,_),_}getDependency(o,c){if(o==="light")return this._loadLight(c)}createNodeAttachment(o){const c=this,d=this.parser,_=d.json.nodes[o],b=(_.extensions&&_.extensions[this.name]||{}).light;return b===void 0?null:this._loadLight(b).then(function(_e){return d._getNodeRef(c.cache,b,_e)})}}class GLTFMaterialsUnlitExtension{constructor(){this.name=EXTENSIONS.KHR_MATERIALS_UNLIT}getMaterialType(){return GLTFLoader.ObjectConstructors.MeshBasicMaterial}extendParams(o,c,d){const _=[];o.color=new three_module.Q1f(1,1,1),o.opacity=1;const b=c.pbrMetallicRoughness;if(b){if(Array.isArray(b.baseColorFactor)){const _e=b.baseColorFactor;o.color.setRGB(_e[0],_e[1],_e[2],three_module.Zr2),o.opacity=_e[3]}b.baseColorTexture!==void 0&&_.push(d.assignTexture(o,"map",b.baseColorTexture,three_module.er$))}return Promise.all(_)}}class GLTFMaterialsEmissiveStrengthExtension{constructor(o){this.parser=o,this.name=EXTENSIONS.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(o,c){const d=this.parser.json.materials[o];if(!d.extensions||!d.extensions[this.name])return Promise.resolve();const _=d.extensions[this.name].emissiveStrength;return _!==void 0&&(c.emissiveIntensity=_),Promise.resolve()}}class GLTFMaterialsClearcoatExtension{constructor(o){this.parser=o,this.name=EXTENSIONS.KHR_MATERIALS_CLEARCOAT}getMaterialType(o){const c=this.parser.json.materials[o];return c.extensions&&c.extensions[this.name]?GLTFLoader.ObjectConstructors.MeshPhysicalMaterial:null}extendMaterialParams(o,c){const d=this.parser,_=d.json.materials[o];if(!_.extensions||!_.extensions[this.name])return Promise.resolve();const b=[],_e=_.extensions[this.name];if(_e.clearcoatFactor!==void 0&&(c.clearcoat=_e.clearcoatFactor),_e.clearcoatTexture!==void 0&&b.push(d.assignTexture(c,"clearcoatMap",_e.clearcoatTexture)),_e.clearcoatRoughnessFactor!==void 0&&(c.clearcoatRoughness=_e.clearcoatRoughnessFactor),_e.clearcoatRoughnessTexture!==void 0&&b.push(d.assignTexture(c,"clearcoatRoughnessMap",_e.clearcoatRoughnessTexture)),_e.clearcoatNormalTexture!==void 0&&(b.push(d.assignTexture(c,"clearcoatNormalMap",_e.clearcoatNormalTexture)),_e.clearcoatNormalTexture.scale!==void 0)){const it=_e.clearcoatNormalTexture.scale;c.clearcoatNormalScale=new three_module.I9Y(it,it)}return Promise.all(b)}}class GLTFMaterialsIridescenceExtension{constructor(o){this.parser=o,this.name=EXTENSIONS.KHR_MATERIALS_IRIDESCENCE}getMaterialType(o){const c=this.parser.json.materials[o];return c.extensions&&c.extensions[this.name]?GLTFLoader.ObjectConstructors.MeshPhysicalMaterial:null}extendMaterialParams(o,c){const d=this.parser,_=d.json.materials[o];if(!_.extensions||!_.extensions[this.name])return Promise.resolve();const b=[],_e=_.extensions[this.name];return _e.iridescenceFactor!==void 0&&(c.iridescence=_e.iridescenceFactor),_e.iridescenceTexture!==void 0&&b.push(d.assignTexture(c,"iridescenceMap",_e.iridescenceTexture)),_e.iridescenceIor!==void 0&&(c.iridescenceIOR=_e.iridescenceIor),c.iridescenceThicknessRange===void 0&&(c.iridescenceThicknessRange=[100,400]),_e.iridescenceThicknessMinimum!==void 0&&(c.iridescenceThicknessRange[0]=_e.iridescenceThicknessMinimum),_e.iridescenceThicknessMaximum!==void 0&&(c.iridescenceThicknessRange[1]=_e.iridescenceThicknessMaximum),_e.iridescenceThicknessTexture!==void 0&&b.push(d.assignTexture(c,"iridescenceThicknessMap",_e.iridescenceThicknessTexture)),Promise.all(b)}}class GLTFMaterialsSheenExtension{constructor(o){this.parser=o,this.name=EXTENSIONS.KHR_MATERIALS_SHEEN}getMaterialType(o){const c=this.parser.json.materials[o];return c.extensions&&c.extensions[this.name]?GLTFLoader.ObjectConstructors.MeshPhysicalMaterial:null}extendMaterialParams(o,c){const d=this.parser,_=d.json.materials[o];if(!_.extensions||!_.extensions[this.name])return Promise.resolve();const b=[];c.sheenColor=new three_module.Q1f(0,0,0),c.sheenRoughness=0,c.sheen=1;const _e=_.extensions[this.name];if(_e.sheenColorFactor!==void 0){const it=_e.sheenColorFactor;c.sheenColor.setRGB(it[0],it[1],it[2],three_module.Zr2)}return _e.sheenRoughnessFactor!==void 0&&(c.sheenRoughness=_e.sheenRoughnessFactor),_e.sheenColorTexture!==void 0&&b.push(d.assignTexture(c,"sheenColorMap",_e.sheenColorTexture,three_module.er$)),_e.sheenRoughnessTexture!==void 0&&b.push(d.assignTexture(c,"sheenRoughnessMap",_e.sheenRoughnessTexture)),_.extras&&_.extras.sheenFactor!==void 0&&(c.sheen=_.extras.sheenFactor,delete _.extras.sheenFactor),Promise.all(b)}}class GLTFMaterialsTransmissionExtension{constructor(o){this.parser=o,this.name=EXTENSIONS.KHR_MATERIALS_TRANSMISSION}getMaterialType(o){const c=this.parser.json.materials[o];return c.extensions&&c.extensions[this.name]?GLTFLoader.ObjectConstructors.MeshPhysicalMaterial:null}extendMaterialParams(o,c){const d=this.parser,_=d.json.materials[o];if(!_.extensions||!_.extensions[this.name])return Promise.resolve();const b=[],_e=_.extensions[this.name];return _e.transmissionFactor!==void 0&&(c.transmission=_e.transmissionFactor),_e.transmissionTexture!==void 0&&b.push(d.assignTexture(c,"transmissionMap",_e.transmissionTexture)),Promise.all(b)}}class GLTFMaterialsVolumeExtension{constructor(o){this.parser=o,this.name=EXTENSIONS.KHR_MATERIALS_VOLUME}getMaterialType(o){const c=this.parser.json.materials[o];return c.extensions&&c.extensions[this.name]?GLTFLoader.ObjectConstructors.MeshPhysicalMaterial:null}extendMaterialParams(o,c){const d=this.parser,_=d.json.materials[o];if(!_.extensions||!_.extensions[this.name])return Promise.resolve();const b=[],_e=_.extensions[this.name];c.thickness=_e.thicknessFactor!==void 0?_e.thicknessFactor:0,_e.thicknessTexture!==void 0&&b.push(d.assignTexture(c,"thicknessMap",_e.thicknessTexture)),c.attenuationDistance=_e.attenuationDistance||1/0;const it=_e.attenuationColor||[1,1,1];return c.attenuationColor=new three_module.Q1f().setRGB(it[0],it[1],it[2],three_module.Zr2),Promise.all(b)}}class GLTFMaterialsIorExtension{constructor(o){this.parser=o,this.name=EXTENSIONS.KHR_MATERIALS_IOR}getMaterialType(o){const c=this.parser.json.materials[o];return c.extensions&&c.extensions[this.name]?GLTFLoader.ObjectConstructors.MeshPhysicalMaterial:null}extendMaterialParams(o,c){const d=this.parser.json.materials[o];if(!d.extensions||!d.extensions[this.name])return Promise.resolve();const _=d.extensions[this.name];return c.ior=_.ior!==void 0?_.ior:1.5,Promise.resolve()}}class GLTFMaterialsSpecularExtension{constructor(o){this.parser=o,this.name=EXTENSIONS.KHR_MATERIALS_SPECULAR}getMaterialType(o){const c=this.parser.json.materials[o];return c.extensions&&c.extensions[this.name]?GLTFLoader.ObjectConstructors.MeshPhysicalMaterial:null}extendMaterialParams(o,c){const d=this.parser,_=d.json.materials[o];if(!_.extensions||!_.extensions[this.name])return Promise.resolve();const b=[],_e=_.extensions[this.name];c.specularIntensity=_e.specularFactor!==void 0?_e.specularFactor:1,_e.specularTexture!==void 0&&b.push(d.assignTexture(c,"specularIntensityMap",_e.specularTexture));const it=_e.specularColorFactor||[1,1,1];return c.specularColor=new three_module.Q1f().setRGB(it[0],it[1],it[2],three_module.Zr2),_e.specularColorTexture!==void 0&&b.push(d.assignTexture(c,"specularColorMap",_e.specularColorTexture,three_module.er$)),Promise.all(b)}}class GLTFMaterialsAnisotropyExtension{constructor(o){this.parser=o,this.name=EXTENSIONS.KHR_MATERIALS_ANISOTROPY}getMaterialType(o){const c=this.parser.json.materials[o];return c.extensions&&c.extensions[this.name]?three_module.uSd:null}extendMaterialParams(o,c){const d=this.parser,_=d.json.materials[o];if(!_.extensions||!_.extensions[this.name])return Promise.resolve();const b=[],_e=_.extensions[this.name];return _e.anisotropyStrength!==void 0&&(c.anisotropy=_e.anisotropyStrength),_e.anisotropyRotation!==void 0&&(c.anisotropyRotation=_e.anisotropyRotation),_e.anisotropyTexture!==void 0&&b.push(d.assignTexture(c,"anisotropyMap",_e.anisotropyTexture)),Promise.all(b)}}class GLTFTextureBasisUExtension{constructor(o){this.parser=o,this.name=EXTENSIONS.KHR_TEXTURE_BASISU}loadTexture(o){const c=this.parser,d=c.json,_=d.textures[o];if(!_.extensions||!_.extensions[this.name])return null;const b=_.extensions[this.name],_e=c.options.ktx2Loader;if(!_e){if(d.extensionsRequired&&d.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return c.loadTextureImage(o,b.source,_e)}}class GLTFTextureWebPExtension{constructor(o){this.parser=o,this.name=EXTENSIONS.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(o){const c=this.name,d=this.parser,_=d.json,b=_.textures[o];if(!b.extensions||!b.extensions[c])return null;const _e=b.extensions[c],it=_.images[_e.source];let nt=d.textureLoader;if(it.uri){const at=d.options.manager.getHandler(it.uri);at!==null&&(nt=at)}return this.detectSupport().then(function(at){if(at)return d.loadTextureImage(o,_e.source,nt);if(_.extensionsRequired&&_.extensionsRequired.indexOf(c)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return d.loadTexture(o)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(o){const c=new Image;c.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",c.onload=c.onerror=function(){o(c.height===1)}})),this.isSupported}}class GLTFTextureAVIFExtension{constructor(o){this.parser=o,this.name=EXTENSIONS.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(o){const c=this.name,d=this.parser,_=d.json,b=_.textures[o];if(!b.extensions||!b.extensions[c])return null;const _e=b.extensions[c],it=_.images[_e.source];let nt=d.textureLoader;if(it.uri){const at=d.options.manager.getHandler(it.uri);at!==null&&(nt=at)}return this.detectSupport().then(function(at){if(at)return d.loadTextureImage(o,_e.source,nt);if(_.extensionsRequired&&_.extensionsRequired.indexOf(c)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return d.loadTexture(o)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(o){const c=new Image;c.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",c.onload=c.onerror=function(){o(c.height===1)}})),this.isSupported}}class GLTFMeshoptCompression{constructor(o){this.name=EXTENSIONS.EXT_MESHOPT_COMPRESSION,this.parser=o}loadBufferView(o){const c=this.parser.json,d=c.bufferViews[o];if(d.extensions&&d.extensions[this.name]){const _=d.extensions[this.name],b=this.parser.getDependency("buffer",_.buffer),_e=this.parser.options.meshoptDecoder;if(!_e||!_e.supported){if(c.extensionsRequired&&c.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return b.then(function(it){const nt=_.byteOffset||0,at=_.byteLength||0,ut=_.count,pt=_.byteStride,mt=new Uint8Array(it,nt,at);return _e.decodeGltfBufferAsync?_e.decodeGltfBufferAsync(ut,pt,mt,_.mode,_.filter).then(function(ft){return ft.buffer}):_e.ready.then(function(){const ft=new ArrayBuffer(ut*pt);return _e.decodeGltfBuffer(new Uint8Array(ft),ut,pt,mt,_.mode,_.filter),ft})})}return null}}class GLTFMeshGpuInstancing{constructor(o){this.name=EXTENSIONS.EXT_MESH_GPU_INSTANCING,this.parser=o}createNodeMesh(o){const c=this.parser.json,d=c.nodes[o];if(!d.extensions||!d.extensions[this.name]||d.mesh===void 0)return null;const _=c.meshes[d.mesh];for(const nt of _.primitives)if(nt.mode!==WEBGL_CONSTANTS.TRIANGLES&&nt.mode!==WEBGL_CONSTANTS.TRIANGLE_STRIP&&nt.mode!==WEBGL_CONSTANTS.TRIANGLE_FAN&&nt.mode!==void 0)return null;const b=d.extensions[this.name].attributes,_e=[],it={};for(const nt in b)_e.push(this.parser.getDependency("accessor",b[nt]).then(at=>(it[nt]=at,it[nt])));return _e.length<1?null:(_e.push(this.parser.createNodeMesh(o)),Promise.all(_e).then(nt=>{const at=nt.pop(),ut=at.isGroup?at.children:[at],pt=nt[0].count,mt=[];for(const ft of ut){const vt=new three_module.kn4,xt=new three_module.Pq0,At=new three_module.PTz,Ct=new three_module.Pq0(1,1,1),Et=new three_module.ZLX(ft.geometry,ft.material,pt);for(let Tt=0;Tt<pt;Tt++)it.TRANSLATION&&xt.fromBufferAttribute(it.TRANSLATION,Tt),it.ROTATION&&At.fromBufferAttribute(it.ROTATION,Tt),it.SCALE&&Ct.fromBufferAttribute(it.SCALE,Tt),Et.setMatrixAt(Tt,vt.compose(xt,At,Ct));Et.sourceTrs=it;for(const Tt in it)Tt!=="TRANSLATION"&&Tt!=="ROTATION"&&Tt!=="SCALE"&&ft.geometry.setAttribute(Tt,it[Tt]);three_module.B69.prototype.copy.call(Et,ft),this.parser.assignFinalMaterial(Et),mt.push(Et)}return at.isGroup?(at.clear(),at.add(...mt),at):mt[0]}))}}const BINARY_EXTENSION_HEADER_MAGIC="glTF",BINARY_EXTENSION_HEADER_LENGTH=12,BINARY_EXTENSION_CHUNK_TYPES={JSON:1313821514,BIN:5130562};class GLTFBinaryExtension{constructor(o){this.name=EXTENSIONS.KHR_BINARY_GLTF,this.content=null,this.body=null;const c=new DataView(o,0,BINARY_EXTENSION_HEADER_LENGTH),d=new TextDecoder;if(this.header={magic:d.decode(new Uint8Array(o.slice(0,4))),version:c.getUint32(4,!0),length:c.getUint32(8,!0)},this.header.magic!==BINARY_EXTENSION_HEADER_MAGIC)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const _=this.header.length-BINARY_EXTENSION_HEADER_LENGTH,b=new DataView(o,BINARY_EXTENSION_HEADER_LENGTH);let _e=0;for(;_e<_;){const it=b.getUint32(_e,!0);_e+=4;const nt=b.getUint32(_e,!0);if(_e+=4,nt===BINARY_EXTENSION_CHUNK_TYPES.JSON){const at=new Uint8Array(o,BINARY_EXTENSION_HEADER_LENGTH+_e,it);this.content=d.decode(at)}else if(nt===BINARY_EXTENSION_CHUNK_TYPES.BIN){const at=BINARY_EXTENSION_HEADER_LENGTH+_e;this.body=o.slice(at,at+it)}_e+=it}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class GLTFDracoMeshCompressionExtension{constructor(o,c){if(!c)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=EXTENSIONS.KHR_DRACO_MESH_COMPRESSION,this.json=o,this.dracoLoader=c,this.dracoLoader.preload()}decodePrimitive(o,c){const d=this.json,_=this.dracoLoader,b=o.extensions[this.name].bufferView,_e=o.extensions[this.name].attributes,it={},nt={},at={};for(const ut in _e){const pt=ATTRIBUTES[ut]||ut.toLowerCase();it[pt]=_e[ut]}for(const ut in o.attributes){const pt=ATTRIBUTES[ut]||ut.toLowerCase();if(_e[ut]!==void 0){const mt=d.accessors[o.attributes[ut]],ft=WEBGL_COMPONENT_TYPES[mt.componentType];at[pt]=ft.name,nt[pt]=mt.normalized===!0}}return c.getDependency("bufferView",b).then(function(ut){return new Promise(function(pt){_.decodeDracoFile(ut,function(mt){for(const ft in mt.attributes){const vt=mt.attributes[ft],xt=nt[ft];xt!==void 0&&(vt.normalized=xt)}pt(mt)},it,at)})})}}class GLTFTextureTransformExtension{constructor(){this.name=EXTENSIONS.KHR_TEXTURE_TRANSFORM}extendTexture(o,c){return(c.texCoord!==void 0&&c.texCoord!==o.channel||c.offset!==void 0||c.rotation!==void 0||c.scale!==void 0)&&(o.__hasGLTFUuid||(o=o.clone()),c.texCoord!==void 0&&(o.channel=c.texCoord),c.offset!==void 0&&o.offset.fromArray(c.offset),c.rotation!==void 0&&(o.rotation=c.rotation),c.scale!==void 0&&o.repeat.fromArray(c.scale),o.needsUpdate=!0),o}}class GLTFMeshQuantizationExtension{constructor(){this.name=EXTENSIONS.KHR_MESH_QUANTIZATION}}class GLTFCubicSplineInterpolant extends three_module.lGw{constructor(o,c,d,_){super(o,c,d,_)}copySampleValue_(o){const c=this.resultBuffer,d=this.sampleValues,_=this.valueSize,b=o*_*3+_;for(let _e=0;_e!==_;_e++)c[_e]=d[b+_e];return c}interpolate_(o,c,d,_){const b=this.resultBuffer,_e=this.sampleValues,it=this.valueSize,nt=2*it,at=3*it,ut=_-c,pt=(d-c)/ut,mt=pt*pt,ft=mt*pt,vt=o*at,xt=vt-at,At=-2*ft+3*mt,Ct=ft-mt,Et=1-At,Tt=Ct-mt+pt;for(let kt=0;kt!==it;kt++){const Dt=_e[xt+kt+it],zt=_e[xt+kt+nt]*ut,Bt=_e[vt+kt+it],Rt=_e[vt+kt]*ut;b[kt]=Et*Dt+Tt*zt+At*Bt+Ct*Rt}return b}}const _q=new three_module.PTz;class GLTFCubicSplineQuaternionInterpolant extends GLTFCubicSplineInterpolant{interpolate_(o,c,d,_){const b=super.interpolate_(o,c,d,_);return _q.fromArray(b).normalize().toArray(b),b}}const WEBGL_CONSTANTS={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},WEBGL_COMPONENT_TYPES={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},WEBGL_FILTERS={9728:three_module.hxR,9729:three_module.k6q,9984:three_module.pHI,9985:three_module.kRr,9986:three_module.Cfg,9987:three_module.$_I},WEBGL_WRAPPINGS={33071:three_module.ghU,33648:three_module.kTW,10497:three_module.GJx},WEBGL_TYPE_SIZES={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},ATTRIBUTES={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},PATH_PROPERTIES={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},INTERPOLATION={CUBICSPLINE:void 0,LINEAR:three_module.PJ3,STEP:three_module.ljd},ALPHA_MODES={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function createDefaultMaterial(h){return h.DefaultMaterial===void 0&&(h.DefaultMaterial=new GLTFLoader.ObjectConstructors.MeshStandardMaterial({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:three_module.hB5})),h.DefaultMaterial}function addUnknownExtensionsToUserData(h,o,c){for(const d in c.extensions)h[d]===void 0&&(o.userData.gltfExtensions=o.userData.gltfExtensions||{},o.userData.gltfExtensions[d]=c.extensions[d])}function assignExtrasToUserData(h,o){o.extras!==void 0&&(typeof o.extras=="object"?Object.assign(h.userData,o.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+o.extras))}function addMorphTargets(h,o,c){let d=!1,_=!1,b=!1;for(let at=0,ut=o.length;at<ut;at++){const pt=o[at];if(pt.POSITION!==void 0&&(d=!0),pt.NORMAL!==void 0&&(_=!0),pt.COLOR_0!==void 0&&(b=!0),d&&_&&b)break}if(!d&&!_&&!b)return Promise.resolve(h);const _e=[],it=[],nt=[];for(let at=0,ut=o.length;at<ut;at++){const pt=o[at];if(d){const mt=pt.POSITION!==void 0?c.getDependency("accessor",pt.POSITION):h.attributes.position;_e.push(mt)}if(_){const mt=pt.NORMAL!==void 0?c.getDependency("accessor",pt.NORMAL):h.attributes.normal;it.push(mt)}if(b){const mt=pt.COLOR_0!==void 0?c.getDependency("accessor",pt.COLOR_0):h.attributes.color;nt.push(mt)}}return Promise.all([Promise.all(_e),Promise.all(it),Promise.all(nt)]).then(function(at){const ut=at[0],pt=at[1],mt=at[2];return d&&(h.morphAttributes.position=ut),_&&(h.morphAttributes.normal=pt),b&&(h.morphAttributes.color=mt),h.morphTargetsRelative=!0,h})}function updateMorphTargets(h,o){if(h.updateMorphTargets(),o.weights!==void 0)for(let c=0,d=o.weights.length;c<d;c++)h.morphTargetInfluences[c]=o.weights[c];if(o.extras&&Array.isArray(o.extras.targetNames)){const c=o.extras.targetNames;if(h.morphTargetInfluences.length===c.length){h.morphTargetDictionary={};for(let d=0,_=c.length;d<_;d++)h.morphTargetDictionary[c[d]]=d}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function createPrimitiveKey(h){let o;const c=h.extensions&&h.extensions[EXTENSIONS.KHR_DRACO_MESH_COMPRESSION];if(o=c?"draco:"+c.bufferView+":"+c.indices+":"+createAttributesKey(c.attributes):h.indices+":"+createAttributesKey(h.attributes)+":"+h.mode,h.targets!==void 0)for(let d=0,_=h.targets.length;d<_;d++)o+=":"+createAttributesKey(h.targets[d]);return o}function createAttributesKey(h){let o="";const c=Object.keys(h).sort();for(let d=0,_=c.length;d<_;d++)o+=c[d]+":"+h[c[d]]+";";return o}function getNormalizedComponentScale(h){switch(h){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function getImageURIMimeType(h){return h.search(/\.jpe?g($|\?)/i)>0||h.search(/^data\:image\/jpeg/)===0?"image/jpeg":h.search(/\.webp($|\?)/i)>0||h.search(/^data\:image\/webp/)===0?"image/webp":"image/png"}const _identityMatrix=new three_module.kn4;class GLTFParser{constructor(o={},c={}){this.json=o,this.extensions={},this.plugins={},this.options=c,this.cache=new GLTFRegistry,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let d=!1,_=!1,b=-1;typeof navigator<"u"&&(d=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!0,_=navigator.userAgent.indexOf("Firefox")>-1,b=_?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),typeof createImageBitmap>"u"||d||_&&b<98?this.textureLoader=new three_module.Tap(this.options.manager):this.textureLoader=new three_module.Kzg(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new three_module.Y9S(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(o){this.extensions=o}setPlugins(o){this.plugins=o}parse(o,c){const d=this,_=this.json,b=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(_e){return _e._markDefs&&_e._markDefs()}),Promise.all(this._invokeAll(function(_e){return _e.beforeRoot&&_e.beforeRoot()})).then(function(){return Promise.all([d.getDependencies("scene"),d.getDependencies("animation"),d.getDependencies("camera")])}).then(function(_e){const it={scene:_e[0][_.scene||0],scenes:_e[0],animations:_e[1],cameras:_e[2],asset:_.asset,parser:d,userData:{}};return addUnknownExtensionsToUserData(b,it,_),assignExtrasToUserData(it,_),Promise.all(d._invokeAll(function(nt){return nt.afterRoot&&nt.afterRoot(it)})).then(function(){o(it)})}).catch(c)}_markDefs(){const o=this.json.nodes||[],c=this.json.skins||[],d=this.json.meshes||[];for(let _=0,b=c.length;_<b;_++){const _e=c[_].joints;for(let it=0,nt=_e.length;it<nt;it++)o[_e[it]].isBone=!0}for(let _=0,b=o.length;_<b;_++){const _e=o[_];_e.mesh!==void 0&&(this._addNodeRef(this.meshCache,_e.mesh),_e.skin!==void 0&&(d[_e.mesh].isSkinnedMesh=!0)),_e.camera!==void 0&&this._addNodeRef(this.cameraCache,_e.camera)}}_addNodeRef(o,c){c!==void 0&&(o.refs[c]===void 0&&(o.refs[c]=o.uses[c]=0),o.refs[c]++)}_getNodeRef(o,c,d){if(o.refs[c]<=1)return d;const _=d.clone(),b=(_e,it)=>{const nt=this.associations.get(_e);nt!=null&&this.associations.set(it,nt);for(const[at,ut]of _e.children.entries())b(ut,it.children[at])};return b(d,_),_.name+="_instance_"+o.uses[c]++,_}_invokeOne(o){const c=Object.values(this.plugins);c.push(this);for(let d=0;d<c.length;d++){const _=o(c[d]);if(_)return _}return null}_invokeAll(o){const c=Object.values(this.plugins);c.unshift(this);const d=[];for(let _=0;_<c.length;_++){const b=o(c[_]);b&&d.push(b)}return d}getDependency(o,c){const d=o+":"+c;let _=this.cache.get(d);if(!_){switch(o){case"scene":_=this.loadScene(c);break;case"node":_=this._invokeOne(function(b){return b.loadNode&&b.loadNode(c)});break;case"mesh":_=this._invokeOne(function(b){return b.loadMesh&&b.loadMesh(c)});break;case"accessor":_=this.loadAccessor(c);break;case"bufferView":_=this._invokeOne(function(b){return b.loadBufferView&&b.loadBufferView(c)});break;case"buffer":_=this.loadBuffer(c);break;case"material":_=this._invokeOne(function(b){return b.loadMaterial&&b.loadMaterial(c)});break;case"texture":_=this._invokeOne(function(b){return b.loadTexture&&b.loadTexture(c)});break;case"skin":_=this.loadSkin(c);break;case"animation":_=this._invokeOne(function(b){return b.loadAnimation&&b.loadAnimation(c)});break;case"camera":_=this.loadCamera(c);break;default:if(_=this._invokeOne(function(b){return b!=this&&b.getDependency&&b.getDependency(o,c)}),!_)throw new Error("Unknown type: "+o)}this.cache.add(d,_)}return _}getDependencies(o){let c=this.cache.get(o);if(!c){const d=this,_=this.json[o+(o==="mesh"?"es":"s")]||[];c=Promise.all(_.map(function(b,_e){return d.getDependency(o,_e)})),this.cache.add(o,c)}return c}loadBuffer(o){const c=this.json.buffers[o],d=this.fileLoader;if(c.type&&c.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+c.type+" buffer type is not supported.");if(c.uri===void 0&&o===0)return Promise.resolve(this.extensions[EXTENSIONS.KHR_BINARY_GLTF].body);const _=this.options;return new Promise(function(b,_e){d.load(three_module.r6x.resolveURL(c.uri,_.path),b,void 0,function(){_e(new Error('THREE.GLTFLoader: Failed to load buffer "'+c.uri+'".'))})})}loadBufferView(o){const c=this.json.bufferViews[o];return this.getDependency("buffer",c.buffer).then(function(d){const _=c.byteLength||0,b=c.byteOffset||0;return d.slice(b,b+_)})}loadAccessor(o){const c=this,d=this.json,_=this.json.accessors[o];if(_.bufferView===void 0&&_.sparse===void 0){const _e=WEBGL_TYPE_SIZES[_.type],it=WEBGL_COMPONENT_TYPES[_.componentType],nt=_.normalized===!0,at=new it(_.count*_e);return Promise.resolve(new three_module.THS(at,_e,nt))}const b=[];return _.bufferView!==void 0?b.push(this.getDependency("bufferView",_.bufferView)):b.push(null),_.sparse!==void 0&&(b.push(this.getDependency("bufferView",_.sparse.indices.bufferView)),b.push(this.getDependency("bufferView",_.sparse.values.bufferView))),Promise.all(b).then(function(_e){const it=_e[0],nt=WEBGL_TYPE_SIZES[_.type],at=WEBGL_COMPONENT_TYPES[_.componentType],ut=at.BYTES_PER_ELEMENT,pt=ut*nt,mt=_.byteOffset||0,ft=_.bufferView!==void 0?d.bufferViews[_.bufferView].byteStride:void 0,vt=_.normalized===!0;let xt,At;if(ft&&ft!==pt){const Ct=Math.floor(mt/ft),Et="InterleavedBuffer:"+_.bufferView+":"+_.componentType+":"+Ct+":"+_.count;let Tt=c.cache.get(Et);Tt||(xt=new at(it,Ct*ft,_.count*ft/ut),Tt=new three_module.eB$(xt,ft/ut),c.cache.add(Et,Tt)),At=new three_module.eHs(Tt,nt,mt%ft/ut,vt)}else xt=it===null?new at(_.count*nt):new at(it,mt,_.count*nt),At=new three_module.THS(xt,nt,vt);if(_.sparse!==void 0){const Ct=WEBGL_TYPE_SIZES.SCALAR,Et=WEBGL_COMPONENT_TYPES[_.sparse.indices.componentType],Tt=_.sparse.indices.byteOffset||0,kt=_.sparse.values.byteOffset||0,Dt=new Et(_e[1],Tt,_.sparse.count*Ct),zt=new at(_e[2],kt,_.sparse.count*nt);it!==null&&(At=new three_module.THS(At.array.slice(),At.itemSize,At.normalized));for(let Bt=0,Rt=Dt.length;Bt<Rt;Bt++){const Ut=Dt[Bt];if(At.setX(Ut,zt[Bt*nt]),nt>=2&&At.setY(Ut,zt[Bt*nt+1]),nt>=3&&At.setZ(Ut,zt[Bt*nt+2]),nt>=4&&At.setW(Ut,zt[Bt*nt+3]),nt>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return At})}loadTexture(o){const c=this.json,d=this.options;if(o<0||o>=c.textures.length)return console.warn("THREE.GLTFLoader: Invalid texture index:",o),null;const _=c.textures[o].source;if(_<0||_>=c.images.length)return console.warn("THREE.GLTFLoader: Invalid source index:",_),null;const b=c.images[_];let _e=this.textureLoader;if(b.uri){const it=d.manager.getHandler(b.uri);it!==null&&(_e=it)}return this.loadTextureImage(o,_,_e)}loadTextureImage(o,c,d){const _=this,b=this.json,_e=b.textures[o],it=b.images[c],nt=(it.uri||it.bufferView)+":"+_e.sampler;if(this.textureCache[nt])return this.textureCache[nt];const at=this.loadImageSource(c,d).then(function(ut){ut.name=_e.name||it.name||"",ut.name===""&&typeof it.uri=="string"&&it.uri.startsWith("data:image/")===!1&&(ut.name=it.uri);const pt=(b.samplers||{})[_e.sampler]||{};return ut.magFilter=WEBGL_FILTERS[pt.magFilter]||three_module.k6q,ut.minFilter=WEBGL_FILTERS[pt.minFilter]||three_module.$_I,ut.wrapS=WEBGL_WRAPPINGS[pt.wrapS]||three_module.GJx,ut.wrapT=WEBGL_WRAPPINGS[pt.wrapT]||three_module.GJx,pt.extras&&pt.extras.uuid!==void 0&&(ut.uuid=pt.extras.uuid,ut.__hasGLTFUuid=!0),_.associations.set(ut,{textures:o}),ut}).catch(function(){return null});return this.textureCache[nt]=at,at}loadImageSource(o,c,d=!1,_=!1){const b=this,_e=this.json,it=this.options;if(!_&&this.sourceCache[o]!==void 0)return this.sourceCache[o].then(vt=>vt.clone());const nt=_e.images[o],at=self.URL||self.webkitURL;nt.uri===void 0&&nt.extras&&nt.extras.uri&&(nt.uri=nt.extras.uri);let ut=nt.uri||"",pt=!1,mt=null;if(nt.bufferView===void 0||d&&ut){if(nt.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+o+" is missing URI and bufferView")}else ut=b.getDependency("bufferView",nt.bufferView).then(function(vt){pt=!0;const xt=new Blob([vt],{type:nt.mimeType});return ut=at.createObjectURL(xt),mt=xt,ut});const ft=Promise.resolve(ut).then(function(vt){return new Promise(function(xt,At){let Ct=xt;c.isImageBitmapLoader===!0&&(Ct=function(Et){const Tt=new three_module.gPd(Et);Tt.needsUpdate=!0,xt(Tt)}),c.load(three_module.r6x.resolveURL(vt,it.path),Ct,void 0,function(Et){c.isImageBitmapLoader===!0?(c=new three_module.Tap(b.options.manager),Ct=xt,c.setCrossOrigin(b.options.crossOrigin),c.setRequestHeader(b.options.requestHeader),c.load(three_module.r6x.resolveURL(vt,it.path),Ct,void 0,At)):At(Et)})})}).then(function(vt){if(pt===!0&&at.revokeObjectURL(ut),vt.userData.mimeType=nt.mimeType||getImageURIMimeType(nt.uri),vt.flipY=!1,nt.extras){if(nt.extras.flipY!==void 0){if(c.isImageBitmapLoader===!0&&typeof createImageBitmap!==void 0){let xt=vt;const At=nt.extras.flipY&&!xt.flipY;createImageBitmap(xt.source.data,{imageOrientation:At?"flipY":"none"}).then(function(Ct){xt._newTex&&(xt=xt._newTex),xt.source.data.close&&xt.source.data.close(),xt.source.data=Ct,xt.source.needsUpdate=!0,xt.needsUpdate=!0})}vt.flipY=nt.extras.flipY,vt.needsUpdate=!0,delete nt.extras.flipY}nt.extras.uuid!==void 0&&(vt.source.uuid=nt.extras.uuid),nt.extras.t_uuid!==void 0&&(vt.uuid=nt.extras.t_uuid,vt.__hasGLTFUuid=!0)}return nt.uri&&typeof nt.uri=="string"&&pt===!1&&!nt.uri.startsWith("/")&&(vt.userData.rootPath=three_module.r6x.resolveURL(nt.uri,it.path)),mt&&(vt.userData.__sourceBlob=mt),!d&&nt.uri&&nt.uri!==ut&&b.loadImageSource(o,c,!0,!0).then(function(xt){vt.source.data&&vt.source.data.close&&vt.source.data.close(),vt.dispose(),vt.source=xt.source,vt.source.needsUpdate=!0,vt.needsUpdate=!0,vt.uuid=xt.uuid,xt.__hasGLTFUuid&&(vt.__hasGLTFUuid=!0),vt.flipY=xt.flipY,vt.userData=xt.userData,vt.setDirty&&vt.setDirty(),xt._newTex=vt}),vt}).catch(function(vt){throw console.error("THREE.GLTFLoader: Couldn't load texture",ut),vt});return this.sourceCache[o]=ft,ft}assignTexture(o,c,d,_){const b=this;return this.getDependency("texture",d.index).then(function(_e){if(!_e)return null;if(d.texCoord!==void 0&&d.texCoord>0&&((_e=_e.clone()).channel=d.texCoord),b.extensions[EXTENSIONS.KHR_TEXTURE_TRANSFORM]){const it=d.extensions!==void 0?d.extensions[EXTENSIONS.KHR_TEXTURE_TRANSFORM]:void 0;if(it){const nt=b.associations.get(_e);_e=b.extensions[EXTENSIONS.KHR_TEXTURE_TRANSFORM].extendTexture(_e,it),b.associations.set(_e,nt)}}return _!==void 0&&(_e.colorSpace=_),o[c]=_e,_e})}assignFinalMaterial(o){const c=o.geometry;let d=o.material;const _=c.attributes.tangent===void 0,b=c.attributes.color!==void 0,_e=c.attributes.normal===void 0;if(o.isPoints){const nt="PointsMaterial:"+d.uuid;let at=this.cache.get(nt);at||(at=new GLTFLoader.ObjectConstructors.PointsMaterial,three_module.imn.prototype.copy.call(at,d),at.color.copy(d.color),at.map=d.map,at.sizeAttenuation=!1,this.cache.add(nt,at)),d=at}else if(o.isLine){const nt="LineBasicMaterial:"+d.uuid;let at=this.cache.get(nt);at||(at=new GLTFLoader.ObjectConstructors.LineBasicMaterial,three_module.imn.prototype.copy.call(at,d),at.color.copy(d.color),at.map=d.map,this.cache.add(nt,at)),d=at}const it=!(!d.userData||!d.userData.gltfExtensions||!d.userData.gltfExtensions.WEBGI_material_extras);if((_||b||_e)&&!it){let nt="ClonedMaterial:"+d.uuid+":";_&&(nt+="derivative-tangents:"),b&&(nt+="vertex-colors:"),_e&&(nt+="flat-shading:");let at=this.cache.get(nt);at||(at=d.clone(),b&&(at.vertexColors=!0),_e&&(at.flatShading=!0),_&&(at.normalScale&&(at.normalScale.y*=-1),at.clearcoatNormalScale&&(at.clearcoatNormalScale.y*=-1)),this.cache.add(nt,at),this.associations.set(at,this.associations.get(d))),d=at}o.material=d}getMaterialType(){return GLTFLoader.ObjectConstructors.MeshStandardMaterial}loadMaterial(o){const c=this,d=this.json,_=this.extensions,b=d.materials[o];let _e;const it={},nt=[];if((b.extensions||{})[EXTENSIONS.KHR_MATERIALS_UNLIT]){const ut=_[EXTENSIONS.KHR_MATERIALS_UNLIT];_e=ut.getMaterialType(),nt.push(ut.extendParams(it,b,c))}else{const ut=b.pbrMetallicRoughness||{};if(it.color=new three_module.Q1f(1,1,1),it.opacity=1,Array.isArray(ut.baseColorFactor)){const pt=ut.baseColorFactor;it.color.setRGB(pt[0],pt[1],pt[2],three_module.Zr2),it.opacity=pt[3]}ut.baseColorTexture!==void 0&&nt.push(c.assignTexture(it,"map",ut.baseColorTexture,three_module.er$)),it.metalness=ut.metallicFactor!==void 0?ut.metallicFactor:.1,it.roughness=ut.roughnessFactor!==void 0?ut.roughnessFactor:.5,ut.metallicRoughnessTexture!==void 0&&(nt.push(c.assignTexture(it,"metalnessMap",ut.metallicRoughnessTexture)),nt.push(c.assignTexture(it,"roughnessMap",ut.metallicRoughnessTexture))),_e=this._invokeOne(function(pt){return pt.getMaterialType&&pt.getMaterialType(o)}),nt.push(Promise.all(this._invokeAll(function(pt){return pt.extendMaterialParams&&pt.extendMaterialParams(o,it)})))}b.doubleSided===!0&&(it.side=three_module.$EB);const at=b.alphaMode||ALPHA_MODES.OPAQUE;if(at===ALPHA_MODES.BLEND?(it.transparent=!0,it.depthWrite=!1):(it.transparent=!1,at===ALPHA_MODES.MASK&&(it.alphaTest=b.alphaCutoff!==void 0?b.alphaCutoff:.5)),b.normalTexture!==void 0&&_e!==GLTFLoader.ObjectConstructors.MeshBasicMaterial&&(nt.push(c.assignTexture(it,"normalMap",b.normalTexture)),it.normalScale=new three_module.I9Y(1,1),b.normalTexture.scale!==void 0)){const ut=b.normalTexture.scale;it.normalScale.set(ut,ut)}if(b.occlusionTexture!==void 0&&_e!==GLTFLoader.ObjectConstructors.MeshBasicMaterial&&(nt.push(c.assignTexture(it,"aoMap",b.occlusionTexture)),b.occlusionTexture.strength!==void 0&&(it.aoMapIntensity=b.occlusionTexture.strength)),b.emissiveFactor!==void 0&&_e!==GLTFLoader.ObjectConstructors.MeshBasicMaterial){const ut=b.emissiveFactor;it.emissive=new three_module.Q1f().setRGB(ut[0],ut[1],ut[2],three_module.Zr2)}return b.emissiveTexture!==void 0&&_e!==GLTFLoader.ObjectConstructors.MeshBasicMaterial&&nt.push(c.assignTexture(it,"emissiveMap",b.emissiveTexture,three_module.er$)),Promise.all(nt).then(function(){const ut=new _e(it);return b.extras&&b.extras.uuid&&(ut.uuid=b.extras.uuid),b.name&&(ut.name=b.name),assignExtrasToUserData(ut,b),c.associations.set(ut,{materials:o}),b.extensions&&addUnknownExtensionsToUserData(_,ut,b),ut})}createUniqueName(o){const c=three_module.Nwf.sanitizeNodeName(o||"");return c in this.nodeNamesUsed?c+"_"+ ++this.nodeNamesUsed[c]:(this.nodeNamesUsed[c]=0,c)}loadGeometries(o){const c=this,d=this.extensions,_=this.primitiveCache;function b(it){return d[EXTENSIONS.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(it,c).then(function(nt){return addPrimitiveAttributes(nt,it,c)})}const _e=[];for(let it=0,nt=o.length;it<nt;it++){const at=o[it],ut=createPrimitiveKey(at),pt=_[ut];if(pt)_e.push(pt.promise);else{let mt;mt=at.extensions&&at.extensions[EXTENSIONS.KHR_DRACO_MESH_COMPRESSION]?b(at):addPrimitiveAttributes(new three_module.LoY,at,c),_[ut]={primitive:at,promise:mt},_e.push(mt)}}return Promise.all(_e)}loadMesh(o){const c=this,d=this.json,_=this.extensions,b=d.meshes[o],_e=b.primitives,it=[];for(let nt=0,at=_e.length;nt<at;nt++){const ut=_e[nt].material===void 0?createDefaultMaterial(this.cache):this.getDependency("material",_e[nt].material);it.push(ut)}return it.push(c.loadGeometries(_e)),Promise.all(it).then(function(nt){const at=nt.slice(0,nt.length-1),ut=nt[nt.length-1],pt=[];for(let ft=0,vt=ut.length;ft<vt;ft++){const xt=ut[ft],At=_e[ft];let Ct;const Et=at[ft];if(At.mode===WEBGL_CONSTANTS.TRIANGLES||At.mode===WEBGL_CONSTANTS.TRIANGLE_STRIP||At.mode===WEBGL_CONSTANTS.TRIANGLE_FAN||At.mode===void 0)Ct=b.isSkinnedMesh===!0?new three_module.I46(xt,Et):new three_module.eaF(xt,Et),Ct.isSkinnedMesh===!0&&Ct.normalizeSkinWeights(),At.mode===WEBGL_CONSTANTS.TRIANGLE_STRIP?Ct.geometry=toTrianglesDrawMode(Ct.geometry,three_module.O49):At.mode===WEBGL_CONSTANTS.TRIANGLE_FAN&&(Ct.geometry=toTrianglesDrawMode(Ct.geometry,three_module.rYR));else if(At.mode===WEBGL_CONSTANTS.LINES)Ct=new three_module.DXC(xt,Et);else if(At.mode===WEBGL_CONSTANTS.LINE_STRIP)Ct=new three_module.N1A(xt,Et);else if(At.mode===WEBGL_CONSTANTS.LINE_LOOP)Ct=new three_module.FCc(xt,Et);else{if(At.mode!==WEBGL_CONSTANTS.POINTS)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+At.mode);Ct=new three_module.ONl(xt,Et)}Object.keys(Ct.geometry.morphAttributes).length>0&&updateMorphTargets(Ct,b),Ct.name=c.createUniqueName(b.name||"mesh_"+o),Ct.geometry&&b.extras&&b.extras.isGeometryUserData?(assignExtrasToUserData(Ct.geometry,b),At.extensions&&addUnknownExtensionsToUserData(_,Ct.geometry,At)):(assignExtrasToUserData(Ct,b),At.extensions&&addUnknownExtensionsToUserData(_,Ct,At)),c.assignFinalMaterial(Ct),pt.push(Ct)}b.extensions&&pt.forEach(ft=>addUnknownExtensionsToUserData(_,ft,b));for(let ft=0,vt=pt.length;ft<vt;ft++)c.associations.set(pt[ft],{meshes:o,primitives:ft});if(pt.length===1)return b.extensions&&addUnknownExtensionsToUserData(_,pt[0],b),pt[0];const mt=new three_module.YJl;b.extensions&&addUnknownExtensionsToUserData(_,mt,b),c.associations.set(mt,{meshes:o});for(let ft=0,vt=pt.length;ft<vt;ft++)mt.add(pt[ft]);return mt})}loadCamera(o){let c;const d=this.json.cameras[o],_=d[d.type];if(_)return d.type==="perspective"?c=new GLTFLoader.ObjectConstructors.PerspectiveCamera(three_module.cj9.radToDeg(_.yfov),_.aspectRatio||1,_.znear||1,_.zfar||2e6):d.type==="orthographic"&&(c=new GLTFLoader.ObjectConstructors.OrthographicCamera(-_.xmag,_.xmag,_.ymag,-_.ymag,_.znear,_.zfar)),d.name&&(c.name=this.createUniqueName(d.name)),assignExtrasToUserData(c,d),Promise.resolve(c);console.warn("THREE.GLTFLoader: Missing camera parameters.")}loadSkin(o){const c=this.json.skins[o],d=[];for(let _=0,b=c.joints.length;_<b;_++)d.push(this._loadNodeShallow(c.joints[_]));return c.inverseBindMatrices!==void 0?d.push(this.getDependency("accessor",c.inverseBindMatrices)):d.push(null),Promise.all(d).then(function(_){const b=_.pop(),_e=_,it=[],nt=[];for(let at=0,ut=_e.length;at<ut;at++){const pt=_e[at];if(pt){it.push(pt);const mt=new three_module.kn4;b!==null&&mt.fromArray(b.array,16*at),nt.push(mt)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',c.joints[at])}return new three_module.EAD(it,nt)})}loadAnimation(o){const c=this.json,d=this,_=c.animations[o],b=_.name?_.name:"animation_"+o,_e=[],it=[],nt=[],at=[],ut=[];for(let pt=0,mt=_.channels.length;pt<mt;pt++){const ft=_.channels[pt],vt=_.samplers[ft.sampler],xt=ft.target,At=xt.node,Ct=_.parameters!==void 0?_.parameters[vt.input]:vt.input,Et=_.parameters!==void 0?_.parameters[vt.output]:vt.output;xt.node!==void 0&&(_e.push(this.getDependency("node",At)),it.push(this.getDependency("accessor",Ct)),nt.push(this.getDependency("accessor",Et)),at.push(vt),ut.push(xt))}return Promise.all([Promise.all(_e),Promise.all(it),Promise.all(nt),Promise.all(at),Promise.all(ut)]).then(function(pt){const mt=pt[0],ft=pt[1],vt=pt[2],xt=pt[3],At=pt[4],Ct=[];for(let Et=0,Tt=mt.length;Et<Tt;Et++){const kt=mt[Et],Dt=ft[Et],zt=vt[Et],Bt=xt[Et],Rt=At[Et];if(kt===void 0)continue;kt.updateMatrix&&kt.updateMatrix();const Ut=d._createAnimationTracks(kt,Dt,zt,Bt,Rt);if(Ut)for(let Ht=0;Ht<Ut.length;Ht++)Ct.push(Ut[Ht])}return new three_module.tz3(b,void 0,Ct)})}createNodeMesh(o){const c=this.json,d=this,_=c.nodes[o];return _.mesh===void 0?null:d.getDependency("mesh",_.mesh).then(function(b){const _e=d._getNodeRef(d.meshCache,_.mesh,b);return _.weights!==void 0&&_e.traverse(function(it){if(it.isMesh)for(let nt=0,at=_.weights.length;nt<at;nt++)it.morphTargetInfluences[nt]=_.weights[nt]}),_e})}loadNode(o){const c=this,d=this.json.nodes[o],_=c._loadNodeShallow(o),b=[],_e=d.children||[];for(let nt=0,at=_e.length;nt<at;nt++)b.push(c.getDependency("node",_e[nt]));const it=d.skin===void 0?Promise.resolve(null):c.getDependency("skin",d.skin);return Promise.all([_,Promise.all(b),it]).then(function(nt){const at=nt[0],ut=nt[1],pt=nt[2];pt!==null&&at.traverse(function(mt){mt.isSkinnedMesh&&mt.bind(pt,_identityMatrix)});for(let mt=0,ft=ut.length;mt<ft;mt++)at.add(ut[mt]);return at})}_loadNodeShallow(o){const c=this.json,d=this.extensions,_=this;if(this.nodeCache[o]!==void 0)return this.nodeCache[o];const b=c.nodes[o],_e=b.name?_.createUniqueName(b.name):"",it=[],nt=_._invokeOne(function(at){return at.createNodeMesh&&at.createNodeMesh(o)});return nt&&it.push(nt),b.camera!==void 0&&it.push(_.getDependency("camera",b.camera).then(function(at){return _._getNodeRef(_.cameraCache,b.camera,at)})),_._invokeAll(function(at){return at.createNodeAttachment&&at.createNodeAttachment(o)}).forEach(function(at){it.push(at)}),this.nodeCache[o]=Promise.all(it).then(function(at){let ut;if(ut=b.isBone===!0?new three_module.$Kf:at.length>1?new three_module.YJl:at.length===1?at[0]:new three_module.B69,ut!==at[0])for(let pt=0,mt=at.length;pt<mt;pt++)ut.add(at[pt]);if(b.name&&(ut.userData.name=b.name,ut.name=_e),assignExtrasToUserData(ut,b),b.extensions&&addUnknownExtensionsToUserData(d,ut,b),b.matrix!==void 0){const pt=new three_module.kn4;pt.fromArray(b.matrix),ut.applyMatrix4(pt)}else b.translation!==void 0&&ut.position.fromArray(b.translation),b.rotation!==void 0&&ut.quaternion.fromArray(b.rotation),b.scale!==void 0&&ut.scale.fromArray(b.scale);return _.associations.has(ut)||_.associations.set(ut,{}),_.associations.get(ut).nodes=o,ut}),this.nodeCache[o]}loadScene(o){const c=this.extensions,d=this.json.scenes[o],_=this,b=new three_module.YJl;d.name&&(b.name=_.createUniqueName(d.name)),assignExtrasToUserData(b,d),d.extensions&&addUnknownExtensionsToUserData(c,b,d);const _e=d.nodes||[],it=[];for(let nt=0,at=_e.length;nt<at;nt++)it.push(_.getDependency("node",_e[nt]));return Promise.all(it).then(function(nt){for(let at=0,ut=nt.length;at<ut;at++)b.add(nt[at]);return _.associations=(at=>{const ut=new Map;for(const[pt,mt]of _.associations)(pt instanceof three_module.imn||pt instanceof three_module.gPd)&&ut.set(pt,mt);return at.traverse(pt=>{const mt=_.associations.get(pt);mt!=null&&ut.set(pt,mt)}),ut})(b),b})}_createAnimationTracks(o,c,d,_,b){const _e=[],it=o.name?o.name:o.uuid,nt=[];let at;switch(PATH_PROPERTIES[b.path]===PATH_PROPERTIES.weights?o.traverse(function(mt){mt.morphTargetInfluences&&nt.push(mt.name?mt.name:mt.uuid)}):nt.push(it),PATH_PROPERTIES[b.path]){case PATH_PROPERTIES.weights:at=three_module.Hit;break;case PATH_PROPERTIES.rotation:at=three_module.MBL;break;case PATH_PROPERTIES.position:case PATH_PROPERTIES.scale:at=three_module.RiT;break;default:at=d.itemSize===1?three_module.Hit:three_module.RiT}const ut=_.interpolation!==void 0?INTERPOLATION[_.interpolation]:three_module.PJ3,pt=this._getArrayFromAccessor(d);for(let mt=0,ft=nt.length;mt<ft;mt++){const vt=new at(nt[mt]+"."+PATH_PROPERTIES[b.path],c.array,pt,ut);_.interpolation==="CUBICSPLINE"&&this._createCubicSplineTrackInterpolant(vt),_e.push(vt)}return _e}_getArrayFromAccessor(o){let c=o.array;if(o.normalized){const d=getNormalizedComponentScale(c.constructor),_=new Float32Array(c.length);for(let b=0,_e=c.length;b<_e;b++)_[b]=c[b]*d;c=_}return c}_createCubicSplineTrackInterpolant(o){o.createInterpolant=function(c){return new(this instanceof three_module.MBL?GLTFCubicSplineQuaternionInterpolant:GLTFCubicSplineInterpolant)(this.times,this.values,this.getValueSize()/3,c)},o.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function computeBounds(h,o,c){const d=o.attributes,_=new three_module.NRn;if(d.POSITION===void 0)return;{const it=c.json.accessors[d.POSITION],nt=it.min,at=it.max;if(nt===void 0||at===void 0)return void console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");if(_.set(new three_module.Pq0(nt[0],nt[1],nt[2]),new three_module.Pq0(at[0],at[1],at[2])),it.normalized){const ut=getNormalizedComponentScale(WEBGL_COMPONENT_TYPES[it.componentType]);_.min.multiplyScalar(ut),_.max.multiplyScalar(ut)}}const b=o.targets;if(b!==void 0){const it=new three_module.Pq0,nt=new three_module.Pq0;for(let at=0,ut=b.length;at<ut;at++){const pt=b[at];if(pt.POSITION!==void 0){const mt=c.json.accessors[pt.POSITION],ft=mt.min,vt=mt.max;if(ft!==void 0&&vt!==void 0){if(nt.setX(Math.max(Math.abs(ft[0]),Math.abs(vt[0]))),nt.setY(Math.max(Math.abs(ft[1]),Math.abs(vt[1]))),nt.setZ(Math.max(Math.abs(ft[2]),Math.abs(vt[2]))),mt.normalized){const xt=getNormalizedComponentScale(WEBGL_COMPONENT_TYPES[mt.componentType]);nt.multiplyScalar(xt)}it.max(nt)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}_.expandByVector(it)}h.boundingBox=_;const _e=new three_module.iyt;_.getCenter(_e.center),_e.radius=_.min.distanceTo(_.max)/2,h.boundingSphere=_e}function addPrimitiveAttributes(h,o,c){const d=o.attributes,_=[];function b(_e,it){return c.getDependency("accessor",_e).then(function(nt){h.setAttribute(it,nt)})}for(const _e in d){const it=ATTRIBUTES[_e]||_e.toLowerCase();it in h.attributes||_.push(b(d[_e],it))}if(o.indices!==void 0&&!h.index){const _e=c.getDependency("accessor",o.indices).then(function(it){h.setIndex(it)});_.push(_e)}return three_module.ppV.workingColorSpace!==three_module.Zr2&&"COLOR_0"in d&&console.warn(`THREE.GLTFLoader: Converting vertex colors from "srgb-linear" to "${three_module.ppV.workingColorSpace}" not supported.`),assignExtrasToUserData(h,o),computeBounds(h,o,c),Promise.all(_).then(function(){return o.targets!==void 0?addMorphTargets(h,o.targets,c):h})}class GLTFLoader2 extends GLTFLoader{constructor(o){super(o),this.isGLTFLoader2=!0,this.preparsers=[],this.preparsers.push(glbEncryptionPreparser)}async preparse(o,c){for(const d of this.preparsers)o=await d.process(o,c);return o}parse(o,c,d,_,b){this.preparse.call(this,o,b||c).then(_e=>{const it=three_module.gPd.DEFAULT_IMAGE;return three_module.gPd.DEFAULT_IMAGE||(three_module.gPd.DEFAULT_IMAGE=AssetImporter.WHITE_IMAGE_DATA),_e?super.parse(_e,c,nt=>{three_module.gPd.DEFAULT_IMAGE=it,d&&d(nt)},_):_&&_(new ErrorEvent("no data"))}).catch(_e=>{console.error(_e),_&&_(_e??new ErrorEvent("unknown error"))})}transform(o,c){const d=o?o.scene||(o.scenes&&o.scenes.length>0?o.scenes[0]:void 0):void 0;return d&&o.animations.length>0&&(d.animations=o.animations),d==null||d.traverse(_=>{_.userData.gltfUUID&&(_.uuid=_.userData.gltfUUID,delete _.userData.gltfUUID)}),d}register(o){return super.register(o)}}const glbEncryptionPreparser={key:(h,o,c)=>h.key||window&&window.prompt&&window.prompt("GLTFEncryption: Please enter the password/key for the model: "+c)||"",async process(h,o){var c;if(typeof h=="string"||!new TextDecoder().decode(new Uint8Array(h,0,100)).includes("WebGiGLBWrapper"))return h;const d=new GLTFBinaryExtension(h),_=JSON.parse(d.content||"{}");let b=d.body||h;const _e=(c=_.asset)===null||c===void 0?void 0:c.encryption;if(!_e)return b;const it=_e.type,nt=_e.version;if(it==="aesgcm"&&nt===1){const at=await Ee$1(this.key,_e,_,o)||"";try{b=(await Pe$1(new Uint8Array(b),at)).buffer}catch{throw new ErrorEvent("decryption error")}}return b}};class RGBEPNGLoader extends three_module.Y9S{constructor(o){super(o),this.type=three_module.ix0}async loadAsync(o,c){const d=await this.parseAsync(o,c,!1),_=new three_module.GYF(d.data,d.width,d.height,three_module.GWd,this.type);return _.needsUpdate=!0,_.flipY=!0,_.colorSpace=three_module.er$,_.minFilter=three_module.k6q,_.magFilter=three_module.k6q,_.source.data.complete=!0,_}async parseAsync(o,c,d=!1){let _=!1;if(!o.startsWith("data:")&&!o.startsWith("blob:")){this.responseType="blob";const it=await super.loadAsync(o,c);o=URL.createObjectURL(it),_=!0}const b=await He$1(o);_&&URL.revokeObjectURL(o);let _e=Uint8Array;return this.type===three_module.ix0?_e=Uint16Array:this.type===three_module.RQf&&(_e=Uint32Array),{data:rgbeToHalfFloat(b.data,4,_e,d),width:b.width,height:b.height}}setDataType(o){return this.type=o,this}}function rgbeToHalfFloat(h,o=3,c=Uint16Array,d=!1){let _;const b=h.byteLength>>2,_e=new c(b*o);for(let it=0;it<b;it++)_=Math.pow(2,h[4*it+3]-136),d?(_e[it*o]=Math.min(h[4*it]*_,65504),_e[it*o+1]=Math.min(h[4*it+1]*_,65504),_e[it*o+2]=Math.min(h[4*it+2]*_,65504)):(_e[it*o]=three_module.GxU.toHalfFloat(Math.min(h[4*it]*_,65504)),_e[it*o+1]=three_module.GxU.toHalfFloat(Math.min(h[4*it+1]*_,65504)),_e[it*o+2]=three_module.GxU.toHalfFloat(Math.min(h[4*it+2]*_,65504))),o===4&&(_e[it*o+3]=three_module.GxU.toHalfFloat(1));return _e}class ObjectLoader2 extends three_module.XTe{constructor(o){super(o),this._imageLoader=new three_module.$NF(o)}static async LoadRootPathTextures(o,c,d,_=!0){var b;const _e=[];for(const it of Array.isArray(o)?o:Object.values(o??{})){const nt=(b=it==null?void 0:it.userData)===null||b===void 0?void 0:b.rootPath,at=_&&it.image&&c[it.image];if(!nt)continue;const ut=d.importPath(nt,{processImported:!1}).then(pt=>{const mt=pt==null?void 0:pt[0],ft=mt==null?void 0:mt.source;if(!mt||!ft)return null;const vt=new three_module.kLi(ft.data);return it.image&&(vt.uuid=it.image),it.image=vt.uuid,at||(c[vt.uuid]=vt),mt.dispose(),vt}).catch(pt=>(console.error(pt),delete it.userData.rootPath,null));at?it.rootPathPromise=ut:_e.push(ut)}await Promise.allSettled(_e)}parseTextures2(o,c,d){var _,b;for(const nt of o){const at=(_=nt==null?void 0:nt.userData)===null||_===void 0?void 0:_.rootPath;if(at&&(!nt.image||!c[nt.image])){const ut=new three_module.kLi(this._imageLoader.load(at,d));if(!ut)continue;nt.image&&(ut.uuid=nt.image),c[ut.uuid]=ut,nt.image=ut.uuid}nt.userData=deserializeObject(nt.userData,void 0,!1,{images:c})}const _e=super.parseTextures(o,c),it={..._e};for(const nt of o)(b=nt.rootPathPromise)===null||b===void 0||b.then(at=>{if(!at)return;const ut=it[nt.uuid];ut.dispose(),ut.source=at,ut.source.needsUpdate=!0,ut.needsUpdate=!0});return _e}parseMaterials2(o,c,d){const _={};return o.forEach(b=>{if(!b)return;const _e={...b},it=Object.keys(_e);for(const at of it)if(at==="map"||at.endsWith("Map")){const ut=_e[at];typeof ut=="string"&&(c[ut]?_e[at]=c[ut]:(console.warn(`Texture ${ut} not found`),delete _e[at]))}_e.userData&&(_e.userData=deserializeObject(_e.userData,void 0,!1,{textures:c}),_e.userData.cloneId&&_e.userData.uuid!==b.uuid&&(_e.userData.uuid=b.uuid));const nt=d.generateFromTemplateType(_e.type,_e);nt&&(_[b.uuid]=nt)}),_}}const viewerGLTFExtension="WEBGI_viewer",webgiLightExtrasExtension="WEBGI_light_extras",webgiObject3DExtrasExtension="WEBGI_object3d_extras",webgiMaterialExtrasExtension="WEBGI_material_extras",GLTFMaterialsBumpMapExtensionName="WEBGI_materials_bumpmap",GLTFMaterialsDisplacementMapExtensionName="WEBGI_materials_displacementmap",GLTFMaterialsAlphaMapExtensionName="WEBGI_materials_alphamap",GLTFMaterialsLightMapExtensionName="WEBGI_materials_lightmap",supportedEmbeddedFiles=["hdr","exr","webp","avif","ktx","hdrpng","svg","cube"];function addGLTFLoader(h){return new Importer(GLTFLoader2,["gltf","glb","data:model/gltf"],!0,(o,c)=>{if(!o)return o;const d=o,_=new ObjectLoader2(c.loadingManager);return d.register(gltfMaterialExtrasParser(_,h)),d.register(gltfObject3DExtrasParser()),d.register(gltfLightExtrasParser(_)),d.register(b=>new GLTFMaterialsBumpMapExtension(b)),d.register(b=>new GLTFMaterialsDisplacementMapExtension(b)),d.register(b=>new GLTFMaterialsLightMapExtension(b)),d.register(b=>new GLTFMaterialsAlphaMapExtension(b)),d.register(b=>{var _e,it,nt,at,ut,pt,mt,ft,vt;const xt=b.getDependency;b.getDependency=async(Dt,zt)=>{const Bt=await xt.call(b,Dt,zt);if(Bt&&Bt.userData){const Rt=Bt.userData.gltfExtensions;delete Bt.userData.gltfExtensions,Bt.userData=deserializeObject(Bt.userData,{},!1,{}),Bt.userData.gltfExtensions=Rt}return Bt};const At=esm_browser_v4()+".drc",Ct=esm_browser_v4()+".ktx2",Et=(nt=(it=(_e=b.json)===null||_e===void 0?void 0:_e.extensionsRequired)===null||it===void 0?void 0:it.includes)===null||nt===void 0?void 0:nt.call(it,"KHR_draco_mesh_compression");if(Et){const Dt=c.registerFile(At);Dt&&d.setDRACOLoader(Dt)}!((pt=(ut=(at=b.json)===null||at===void 0?void 0:at.extensionsUsed)===null||ut===void 0?void 0:ut.includes)===null||pt===void 0)&&pt.call(ut,"EXT_meshopt_compression")&&(window.MeshoptDecoder?(d.setMeshoptDecoder(window.MeshoptDecoder),b.options.meshoptDecoder=window.MeshoptDecoder):console.error("Add GLTFMeshOptPlugin to viewer to enable EXT_meshopt_compression decode"));const Tt=c.registerFile(Ct),kt=supportedEmbeddedFiles.map(Dt=>esm_browser_v4()+"."+Dt);return kt.forEach(Dt=>c.registerFile(Dt)),!((vt=(ft=(mt=b.json)===null||mt===void 0?void 0:mt.extensionsUsed)===null||ft===void 0?void 0:ft.includes)===null||vt===void 0)&&vt.call(ft,"KHR_texture_basisu")&&Tt&&(d.setKTX2Loader(Tt),b.options.ktx2Loader=Tt),{name:"GLTF2_HELPER_PLUGIN",afterRoot:async Dt=>{Et&&c.unregisterFile(At),Tt&&c.unregisterFile(Ct),kt.forEach(Bt=>c.unregisterFile(Bt));const zt=await importViewer(b,h,_);Dt.scene&&(Dt.scene.__importedViewerConfig=zt)}}}),d})}const gltfObject3DExtrasParser=h=>o=>({name:"__"+webgiObject3DExtrasExtension,afterRoot:async c=>{(c.scenes||(c.scene?[c.scene]:[])).forEach(d=>{d.traverse(_=>{var b,_e;if(!_||!_.isObject3D)return;const it=(_e=(b=_.userData)===null||b===void 0?void 0:b.gltfExtensions)===null||_e===void 0?void 0:_e[webgiObject3DExtrasExtension];if(!it)return void(_.isLight&&!_.isAmbientLight&&(_.castShadow=!0));const nt=it.castShadow!==void 0||it.receiveShadow!==void 0;it.castShadow!==void 0&&(_.castShadow=it.castShadow),it.receiveShadow!==void 0&&(_.receiveShadow=it.receiveShadow),it.visible!==void 0&&(_.visible=it.visible),it.frustumCulled!==void 0&&(_.frustumCulled=it.frustumCulled),it.renderOrder!==void 0&&(_.renderOrder=it.renderOrder),it.layers!==void 0&&(_.layers.mask=it.layers),nt&&(_.userData.__keepShadowDef=!0),delete _.userData.gltfExtensions[webgiObject3DExtrasExtension]})})}}),gltfMaterialExtrasParser=(h,o)=>c=>({name:"__"+webgiMaterialExtrasExtension,afterRoot:async d=>{var _,b,_e;const it=d.scenes||(d.scene?[d.scene]:[]);for(const nt of it){const at=(b=(_=nt.userData)===null||_===void 0?void 0:_.gltfExtensions)===null||b===void 0?void 0:b[webgiMaterialExtrasExtension],ut=at&&await((_e=o.getPlugin(AssetManagerPlugin))===null||_e===void 0?void 0:_e.importConfigResources(at.resources||{}))||{};nt.traverse(pt=>{var mt,ft;const vt=pt==null?void 0:pt.material;if(!(vt!=null&&vt.isMaterial))return;const xt=(ft=(mt=vt.userData)===null||mt===void 0?void 0:mt.gltfExtensions)===null||ft===void 0?void 0:ft[webgiMaterialExtrasExtension];xt&&(xt.emissiveIntensity!==void 0&&(vt.emissiveIntensity=xt.emissiveIntensity),xt.fog!==void 0&&(vt.fog=xt.fog),xt.flatShading!==void 0&&(vt.flatShading=xt.flatShading),xt.blending!==void 0&&(vt.blending=xt.blending),xt.side!==void 0&&(vt.side=xt.side),xt.shadowSide!==void 0&&(vt.shadowSide=xt.shadowSide),xt.depthFunc!==void 0&&(vt.depthFunc=xt.depthFunc),xt.depthTest!==void 0&&(vt.depthTest=xt.depthTest),xt.depthWrite!==void 0&&(vt.depthWrite=xt.depthWrite),xt.colorWrite!==void 0&&(vt.colorWrite=xt.colorWrite),xt.vertexColors!==void 0&&(vt.vertexColors=xt.vertexColors),xt.alphaTest!==void 0&&(vt.alphaTest=xt.alphaTest),xt.alphaHash!==void 0&&(vt.alphaHash=xt.alphaHash),xt.envMapIntensity!==void 0&&(vt.envMapIntensity=xt.envMapIntensity),xt.wireframe!==void 0&&(vt.wireframe=xt.wireframe),xt.wireframeLinewidth!==void 0&&(vt.wireframeLinewidth=xt.wireframeLinewidth),xt.wireframeLinecap!==void 0&&(vt.wireframeLinecap=xt.wireframeLinecap),xt.wireframeLinejoin!==void 0&&(vt.wireframeLinejoin=xt.wireframeLinejoin),xt.rotation!==void 0&&(vt.rotation=xt.rotation),xt.polygonOffset!==void 0&&(vt.polygonOffset=xt.polygonOffset),xt.polygonOffsetFactor!==void 0&&(vt.polygonOffsetFactor=xt.polygonOffsetFactor),xt.polygonOffsetUnits!==void 0&&(vt.polygonOffsetUnits=xt.polygonOffsetUnits),xt.dithering!==void 0&&(vt.dithering=xt.dithering),xt.alphaToCoverage!==void 0&&(vt.alphaToCoverage=xt.alphaToCoverage),xt.premultipliedAlpha!==void 0&&(vt.premultipliedAlpha=xt.premultipliedAlpha),xt.toneMapped!==void 0&&(vt.toneMapped=xt.toneMapped),xt.normalScale!==void 0&&vt.normalScale!==void 0&&(Array.isArray(xt.normalScale)?vt.normalScale.fromArray(xt.normalScale):typeof xt.normalScale=="number"?vt.normalScale.set(xt.normalScale,xt.normalScale):o.console.warn("normalScale is not an array or number",xt.normalScale)),xt.reflectivity!==void 0&&(vt.reflectivity=xt.reflectivity),Object.entries(xt).forEach(([At,Ct])=>{At.startsWith("_")||Ct&&Ct.resource&&typeof Ct.resource=="string"&&(vt[At]=deserializeObject(Ct,vt[At],!1,ut))}),delete vt.userData.gltfExtensions[webgiMaterialExtrasExtension])}),at&&delete nt.userData.gltfExtensions[webgiMaterialExtrasExtension]}}}),gltfLightExtrasParser=h=>o=>({name:"__"+webgiLightExtrasExtension,afterRoot:async c=>{(c.scenes||(c.scene?[c.scene]:[])).forEach(d=>{d.traverse(_=>{var b,_e;if(!_.isLight)return;const it=(_e=(b=_.userData)===null||b===void 0?void 0:b.gltfExtensions)===null||_e===void 0?void 0:_e[webgiLightExtrasExtension];it&&(!_.shadow&&it.shadow&&console.error("Light has no shadow, cannot import",_,it),it.shadow&&_.shadow&&(it.shadow.bias!==void 0&&(_.shadow.bias=it.shadow.bias),it.shadow.normalBias!==void 0&&(_.shadow.normalBias=it.shadow.normalBias),it.shadow.radius!==void 0&&(_.shadow.radius=it.shadow.radius),it.shadow.mapSize!==void 0&&_.shadow.mapSize.fromArray(it.shadow.mapSize),it.shadow.camera!==void 0&&(_.shadow.camera=h.parseObject(it.shadow.camera))),delete _.userData.gltfExtensions[webgiLightExtrasExtension])})})}});async function importViewer(h,o,c,d){var _,b,_e;if(!d){const pt=h.json.scenes||[];if(pt.length!==1){for(const mt of pt)await importViewer(h,o,c,mt);return}d=pt[0]}const it=(_=d.extensions)===null||_===void 0?void 0:_[viewerGLTFExtension];if(!it)return;const nt=[];Object.values(it.resources).forEach(pt=>{Object.values(pt).forEach(mt=>{mt.url&&(mt.url.type==="Uint16Array"&&mt.url.data&&nt.push(mt.url),mt.url.type==="Uint8Array"&&mt.url.data&&nt.push(mt.url))})});for(const pt of nt){const mt=pt.data.image,ft=h.json.images[mt],vt=await h.getDependency("bufferView",ft.bufferView);if(ft.mimeType.startsWith("image/")&&pt.type==="Uint16Array"&&pt.encoding==="rgbe"){const xt=new Blob([vt]);let At=URL.createObjectURL(xt);(pt.encodingVersion||1)<2&&(At="data:image/png;base64,"+btoa(await xt.text())),pt.data=(await new RGBEPNGLoader().parseAsync(At,void 0,!0)).data,URL.revokeObjectURL(At),delete pt.encoding,delete pt.encodingVersion}else pt.data=vt}const at={textures:{},materials:{}},ut=it.resources;if(ut.textures&&h.json.textures)for(const[pt,mt]of[...Object.entries(ut.textures)]){if(mt.uuid||!pt)continue;delete ut.textures[pt];const ft=h.json.textures.findIndex(vt=>{var xt,At,Ct,Et,Tt,kt,Dt;return((xt=vt.extras)===null||xt===void 0?void 0:xt.uuid)===pt||((Et=(Ct=(At=h.json.samplers)===null||At===void 0?void 0:At[vt.sampler])===null||Ct===void 0?void 0:Ct.extras)===null||Et===void 0?void 0:Et.uuid)===pt||((Dt=(kt=(Tt=h.json.images)===null||Tt===void 0?void 0:Tt[vt.source])===null||kt===void 0?void 0:kt.extras)===null||Dt===void 0?void 0:Dt.t_uuid)===pt});ft>=0&&(at.textures[pt]=await h.getDependency("texture",ft))}if(ut.materials&&h.json.materials)for(const[pt,mt]of[...Object.entries(ut.materials)]){if(mt.uuid||!pt)continue;delete ut.materials[pt];const ft=h.json.materials.findIndex(vt=>{var xt;return((xt=vt.extras)===null||xt===void 0?void 0:xt.uuid)===pt});ft>=0&&(at.materials[pt]=await h.getDependency("material",ft),at.materials[pt]=(_e=(b=o.getPlugin(AssetManagerPlugin))===null||b===void 0?void 0:b.materials)===null||_e===void 0?void 0:_e.processMaterial(at.materials[pt],{}))}return it.resources=await o.getPlugin(AssetManagerPlugin).importConfigResources(ut||{},c,at),it}class GLTFMaterialsBumpMapExtension{constructor(o){this.parser=o,this.name=GLTFMaterialsBumpMapExtensionName}async extendMaterialParams(o,c){const d=this.parser,_=d.json.materials[o];if(!_.extensions||!_.extensions[this.name])return Promise.resolve();const b=[],_e=_.extensions[this.name];return _e.bumpScale!==void 0&&(c.bumpScale=_e.bumpScale),_e.bumpTexture!==void 0&&b.push(d.assignTexture(c,"bumpMap",_e.bumpTexture)),Promise.all(b)}}class GLTFMaterialsDisplacementMapExtension{constructor(o){this.parser=o,this.name=GLTFMaterialsDisplacementMapExtensionName}async extendMaterialParams(o,c){const d=this.parser,_=d.json.materials[o];if(!_.extensions||!_.extensions[this.name])return Promise.resolve();const b=[],_e=_.extensions[this.name];return _e.displacementScale!==void 0&&(c.displacementScale=_e.displacementScale),_e.displacementBias!==void 0&&(c.displacementBias=_e.displacementBias),_e.displacementTexture!==void 0&&b.push(d.assignTexture(c,"displacementMap",_e.displacementTexture)),Promise.all(b)}}class GLTFMaterialsLightMapExtension{constructor(o){this.parser=o,this.name=GLTFMaterialsLightMapExtensionName}async extendMaterialParams(o,c){const d=this.parser,_=d.json.materials[o];if(!_.extensions||!_.extensions[this.name])return Promise.resolve();const b=[],_e=_.extensions[this.name];return _e.lightMapIntensity!==void 0&&(c.lightMapIntensity=_e.lightMapIntensity),_e.lightMapTexture!==void 0&&b.push(d.assignTexture(c,"lightMap",_e.lightMapTexture)),Promise.all(b)}}class GLTFMaterialsAlphaMapExtension{constructor(o){this.parser=o,this.name=GLTFMaterialsAlphaMapExtensionName}async extendMaterialParams(o,c){const d=this.parser,_=d.json.materials[o];if(!_.extensions||!_.extensions[this.name])return Promise.resolve();const b=[],_e=_.extensions[this.name];return _e.alphaTexture!==void 0&&b.push(d.assignTexture(c,"alphaMap",_e.alphaTexture)),Promise.all(b)}}var DRACOLoader2=__webpackgi_require__(957);function addDracoLoader(){return new Importer(DRACOLoader2.Z,["drc"],!0)}class DirectionalLight2 extends three_module.ZyN{get lightObject(){return this}get modelObject(){return this}constructor(o,c){super(),this.assetType="light",this.isDirectionalLight2=!0,this.color=new three_module.Q1f(o),this.intensity=c||1,this.target.position.set(0,0,-1),this.add(this.target)}copy(o,c){const d=this.target,_=o.userData;return o.userData={},super.copy(o,c),copyObject3DUserData(this.userData,_),d.position.copy(this.target.position),d.updateMatrixWorld(),this.target=d,this}get uiConfig(){return this._uiConfig?this._uiConfig:this._uiConfig={type:"folder",label:"Directional Light",children:[{type:"checkbox",label:"Enabled",property:[this,"visible"]},{type:"color",label:"Color",property:[this,"color"]},{type:"slider",label:"Intensity",bounds:[0,40],property:[this,"intensity"]},{type:"vec3",label:"Rotation",property:[this,"rotation"]},{type:"vec3",label:"Position",property:[this,"position"]},{type:"checkbox",label:"Shadow Enabled",property:[this,"castShadow"]},{type:"vec2",label:"Shadow Map Size",property:[this==null?void 0:this.shadow,"mapSize"],onChange:()=>{var o,c;(o=this.shadow.map)===null||o===void 0||o.dispose(),(c=this.shadow.mapPass)===null||c===void 0||c.dispose(),this.shadow.map=null,this.shadow.mapPass=null}},{type:"slider",bounds:[-.001,.001],stepSize:2e-5,label:"Shadow Bias",property:[this==null?void 0:this.shadow,"bias"],onChange:this.setDirty},{type:"slider",bounds:[-.1,.1],stepSize:.005,label:"Shadow Normal Bias",property:[this==null?void 0:this.shadow,"normalBias"],onChange:this.setDirty},{type:"slider",bounds:[0,5],label:"Shadow radius",property:[this==null?void 0:this.shadow,"radius"],onChange:this.setDirty},{type:"slider",bounds:[.1,50],label:"Shadow frustum",getValue:()=>2*this.shadow.camera.right,setValue:o=>{this.shadow.camera.left=-o/2,this.shadow.camera.right=o/2,this.shadow.camera.top=o/2,this.shadow.camera.bottom=-o/2},onChange:this.setDirty}]}}toJSON(o){const{userData:c,children:d}=this;this.userData={},this.children=[];const _=super.toJSON(o);return _.userData=serializeObject(copyObject3DUserData({},c),!1),this.userData=c,this.children=d,_.type="DirectionalLight2",_.target=this.target.position.toArray(),Object.assign(_,serializeObject(this,!0,o))}fromJSON(o,c){if(o.type!=="DirectionalLight2")return null;const d=o.target,_=o.object;return o.target&&(this.target.position.fromArray(o.target),this.target.updateMatrixWorld(),delete o.target),o.object&&delete o.object,deserializeObject(o,this,!0,c),d&&(o.target=d),_&&(_.color!==void 0&&this.color.set(_.color),_.intensity!==void 0&&(this.intensity=_.intensity),o.object=_),this}}class SpotLight2 extends three_module.nCl{get lightObject(){return this}get modelObject(){return this}constructor(o,c,d,_,b,_e){super(o,c,d,_,b,_e),this.assetType="light",this.target.position.set(0,0,-1),this.add(this.target)}copy(o,c){const d=this.target,_=o.userData;return o.userData={},super.copy(o,c),copyObject3DUserData(this.userData,_),d.position.copy(this.target.position),d.updateMatrixWorld(),this.target=d,this}get uiConfig(){return this._uiConfig?this._uiConfig:this._uiConfig={type:"folder",label:"Spot Light",children:[{type:"checkbox",label:"Enabled",property:[this,"visible"]},{type:"color",label:"Color",property:[this,"color"]},{type:"slider",label:"Intensity",bounds:[0,30],property:[this,"intensity"]},{type:"slider",bounds:[0,2],property:[this,"angle"]},{type:"slider",bounds:[0,.9999],property:[this,"penumbra"]},{type:"vec3",label:"Rotation",property:[this,"rotation"]},{type:"vec3",label:"Position",property:[this,"position"]},{type:"checkbox",label:"Shadow Enabled",property:[this,"castShadow"]},{type:"vec2",label:"Shadow Map Size",property:[this==null?void 0:this.shadow,"mapSize"],onChange:()=>{var o,c;(o=this.shadow.map)===null||o===void 0||o.dispose(),(c=this.shadow.mapPass)===null||c===void 0||c.dispose(),this.shadow.map=null,this.shadow.mapPass=null}},{type:"slider",bounds:[-.001,.001],stepSize:2e-5,label:"Shadow Bias",property:[this==null?void 0:this.shadow,"bias"],onChange:this.setDirty},{type:"slider",bounds:[0,5],label:"Shadow radius",property:[this==null?void 0:this.shadow,"radius"],onChange:this.setDirty}]}}toJSON(o){const{userData:c,children:d}=this;this.userData={},this.children=[];const _=super.toJSON(o);return _.userData=serializeObject(copyObject3DUserData({},c),!1),this.userData=c,this.children=d,_.type="SpotLight2",_.target=this.target.position.toArray(),Object.assign(_,serializeObject(this,!0,o))}fromJSON(o,c){return o.type!=="SpotLight2"?null:(o.target&&(this.target.position.fromArray(o.target),this.target.updateMatrixWorld()),o.object?(o.object.color!==void 0&&this.color.set(o.object.color),o.object.intensity!==void 0&&(this.intensity=o.object.intensity),o.object.distance!==void 0&&(this.distance=o.object.distance),o.object.angle!==void 0&&(this.angle=o.object.angle),o.object.decay!==void 0&&(this.decay=o.object.decay),o.object.penumbra!==void 0&&(this.penumbra=o.object.penumbra),deserializeObject(o,this,!0,c),this):this)}}class PointLight2 extends three_module.HiM{get lightObject(){return this}get modelObject(){return this}constructor(o,c,d,_){super(o,c,d,_),this.assetType="light"}copy(o,c){const d=o.userData;return o.userData={},super.copy(o,c),copyObject3DUserData(this.userData,d),this}get uiConfig(){return this._uiConfig?this._uiConfig:this._uiConfig={type:"folder",label:"Point Light",children:[{type:"checkbox",label:"Enabled",property:[this,"visible"]},{type:"color",label:"Color",property:[this,"color"]},{type:"slider",label:"Intensity",bounds:[0,20],property:[this,"intensity"]},{type:"input",label:"Distance",property:[this,"distance"]},{type:"input",property:[this,"decay"]},{type:"vec3",label:"Position",property:[this,"position"]},{type:"checkbox",label:"Shadow Enabled",property:[this,"castShadow"]},{type:"vec2",label:"Shadow Map Size",property:[this==null?void 0:this.shadow,"mapSize"],onChange:()=>{var o,c;(o=this.shadow.map)===null||o===void 0||o.dispose(),(c=this.shadow.mapPass)===null||c===void 0||c.dispose(),this.shadow.map=null,this.shadow.mapPass=null}},{type:"slider",bounds:[-.001,.001],stepSize:2e-5,label:"Shadow Bias",property:[this==null?void 0:this.shadow,"bias"],onChange:this.setDirty},{type:"slider",bounds:[0,5],label:"Shadow radius",property:[this==null?void 0:this.shadow,"radius"],onChange:this.setDirty}]}}toJSON(o){const{userData:c}=this;this.userData={};const d=super.toJSON(o);return d.userData=serializeObject(copyObject3DUserData({},c),!1),this.userData=c,d.type="PointLight2",Object.assign(d,serializeObject(this,!0,o))}fromJSON(o,c){return o.type!=="PointLight2"?null:o.object?(o.object.color!==void 0&&this.color.set(o.object.color),o.object.intensity!==void 0&&(this.intensity=o.object.intensity),o.object.distance!==void 0&&(this.distance=o.object.distance),o.object.decay!==void 0&&(this.decay=o.object.decay),deserializeObject(o,this,!0,c),this):this}}class AmbientLight2 extends three_module.$p8{get lightObject(){return this}get modelObject(){return this}constructor(o,c){super(o,c),this.assetType="light"}copy(o,c){const d=o.userData;return o.userData={},super.copy(o,c),copyObject3DUserData(this.userData,d),this}get uiConfig(){return this._uiConfig?this._uiConfig:this._uiConfig={type:"folder",label:"Ambient Light",children:[{type:"checkbox",label:"Enabled",property:[this,"visible"]},{type:"color",label:"Color",property:[this,"color"]},{type:"slider",label:"Intensity",bounds:[0,20],property:[this,"intensity"]}]}}toJSON(o){const{userData:c}=this;this.userData={};const d=super.toJSON(o);return d.userData=serializeObject(copyObject3DUserData({},c),!1),this.userData=c,d.type="AmbientLight2",Object.assign(d,serializeObject(this,!0,o))}fromJSON(o,c){return o.type!=="AmbientLight2"?null:o.object?(o.object.color!==void 0&&this.color.set(o.object.color),o.object.intensity!==void 0&&(this.intensity=o.object.intensity),deserializeObject(o,this,!0,c),this):this}}class LUTCubeLoader extends three_module.aHM{load(o,c,d,_){const b=new three_module.Y9S(this.manager);b.setPath(this.path),b.setResponseType("text"),b.load(o,_e=>{try{c(this.parse(_e))}catch(it){_?_(it):console.error(it),this.manager.itemError(o)}},d,_)}parse(o){o=o.replace(/^#.*?(\n|\r)/gm,"").replace(/^\s*?(\n|\r)/gm,"").trim();let c=null,d=null;const _=new three_module.Pq0(0,0,0),b=new three_module.Pq0(1,1,1),_e=o.split(/[\n\r]+/g);let it=null,nt=0;for(let pt=0,mt=_e.length;pt<mt;pt++){const ft=_e[pt].trim(),vt=ft.split(/\s/g);switch(vt[0]){case"TITLE":c=ft.substring(7,ft.length-1);break;case"LUT_3D_SIZE":const xt=vt[1];d=parseFloat(xt),it=new Uint8Array(d*d*d*4);break;case"DOMAIN_MIN":_.x=parseFloat(vt[1]),_.y=parseFloat(vt[2]),_.z=parseFloat(vt[3]);break;case"DOMAIN_MAX":b.x=parseFloat(vt[1]),b.y=parseFloat(vt[2]),b.z=parseFloat(vt[3]);break;default:const At=parseFloat(vt[0]),Ct=parseFloat(vt[1]),Et=parseFloat(vt[2]);if(At>1||At<0||Ct>1||Ct<0||Et>1||Et<0)throw new Error("LUTCubeLoader : Non normalized values not supported.");it[nt+0]=255*At,it[nt+1]=255*Ct,it[nt+2]=255*Et,it[nt+3]=255,nt+=4}}const at=new three_module.GYF;at.image.data=it,at.image.width=d,at.image.height=d*d,at.type=three_module.OUM,at.magFilter=three_module.k6q,at.minFilter=three_module.k6q,at.wrapS=three_module.ghU,at.wrapT=three_module.ghU,at.generateMipmaps=!1,at.needsUpdate=!0;const ut=new three_module.dYF;return ut.image.data=it,ut.image.width=d,ut.image.height=d,ut.image.depth=d,ut.type=three_module.OUM,ut.magFilter=three_module.k6q,ut.minFilter=three_module.k6q,ut.wrapS=three_module.ghU,ut.wrapT=three_module.ghU,ut.wrapR=three_module.ghU,ut.generateMipmaps=!1,ut.needsUpdate=!0,{title:c,size:d,domainMin:_,domainMax:b,texture:at,texture3D:ut}}}var LUTCubeLoader2_decorate=function(h,o,c,d){var _,b=arguments.length,_e=b<3?o:d===null?d=Object.getOwnPropertyDescriptor(o,c):d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_e=Reflect.decorate(h,o,c,d);else for(var it=h.length-1;it>=0;it--)(_=h[it])&&(_e=(b<3?_(_e):b>3?_(o,c,_e):_(o,c))||_e);return b>3&&_e&&Object.defineProperty(o,c,_e),_e};let LUTCubeTextureWrapper=class{constructor({domainMax:h,domainMin:o,size:c,texture:d,texture3D:_,title:b}){this.userData={},this.type="LUTCubeTextureWrapper",this.assetType="lutTexture",this.domainMax=h,this.domainMin=o,this.size=c,this.texture=d,this.texture3D=_,this.title=b,this.uuid=three_module.cj9.generateUUID(),this.userData.__needsSourceBuffer=!0}fromJSON(h,o){return h.type!==this.type&&console.warn("WebGi LUTCubeLoader2: type mismatch while import",h,this),console.error("not supported"),this}toJSON(h){return serializeTextureInExtras(this,h,this.texture.name)}};LUTCubeTextureWrapper=LUTCubeLoader2_decorate([serializable("LUTCubeTextureWrapper")],LUTCubeTextureWrapper);class LUTCubeLoader2 extends LUTCubeLoader{parse(o){const c=super.parse(o);return new LUTCubeTextureWrapper(c)}}var ch2={},wk$1=function(h,o,c,d,_){var b=new Worker(ch2[o]||(ch2[o]=URL.createObjectURL(new Blob([h],{type:"text/javascript"}))));return b.onerror=function(_e){return _(_e.error,null)},b.onmessage=function(_e){return _(null,_e.data)},b.postMessage(c,d),b},u8=Uint8Array,u16=Uint16Array,u32=Uint32Array,fleb=new u8([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),fdeb=new u8([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),clim=new u8([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),freb=function(h,o){for(var c=new u16(31),d=0;d<31;++d)c[d]=o+=1<<h[d-1];var _=new u32(c[30]);for(d=1;d<30;++d)for(var b=c[d];b<c[d+1];++b)_[b]=b-c[d]<<5|d;return[c,_]},_a=freb(fleb,2),fl$1=_a[0],revfl=_a[1];fl$1[28]=258,revfl[258]=28;for(var _b=freb(fdeb,0),fd$1=_b[0],revfd=_b[1],rev=new u16(32768),browser_i=0;browser_i<32768;++browser_i){var browser_x=(43690&browser_i)>>>1|(21845&browser_i)<<1;browser_x=(52428&browser_x)>>>2|(13107&browser_x)<<2,browser_x=(61680&browser_x)>>>4|(3855&browser_x)<<4,rev[browser_i]=((65280&browser_x)>>>8|(255&browser_x)<<8)>>>1}for(var hMap=function(o,c,d){for(var _=o.length,b=0,_e=new u16(c);b<_;++b)++_e[o[b]-1];var it,nt=new u16(c);for(b=0;b<c;++b)nt[b]=nt[b-1]+_e[b-1]<<1;if(d){it=new u16(1<<c);var at=15-c;for(b=0;b<_;++b)if(o[b])for(var ut=b<<4|o[b],pt=c-o[b],mt=nt[o[b]-1]++<<pt,ft=mt|(1<<pt)-1;mt<=ft;++mt)it[rev[mt]>>>at]=ut}else for(it=new u16(_),b=0;b<_;++b)o[b]&&(it[b]=rev[nt[o[b]-1]++]>>>15-o[b]);return it},flt=new u8(288),browser_i=0;browser_i<144;++browser_i)flt[browser_i]=8;for(var browser_i=144;browser_i<256;++browser_i)flt[browser_i]=9;for(var browser_i=256;browser_i<280;++browser_i)flt[browser_i]=7;for(var browser_i=280;browser_i<288;++browser_i)flt[browser_i]=8;for(var fdt=new u8(32),browser_i=0;browser_i<32;++browser_i)fdt[browser_i]=5;var flm=hMap(flt,9,0),flrm=hMap(flt,9,1),fdm=hMap(fdt,5,0),fdrm=hMap(fdt,5,1),max=function(h){for(var o=h[0],c=1;c<h.length;++c)h[c]>o&&(o=h[c]);return o},bits=function(h,o,c){var d=o/8|0;return(h[d]|h[d+1]<<8)>>(7&o)&c},bits16=function(h,o){var c=o/8|0;return(h[c]|h[c+1]<<8|h[c+2]<<16)>>(7&o)},shft=function(h){return(h/8|0)+(7&h&&1)},slc=function(h,o,c){(o==null||o<0)&&(o=0),(c==null||c>h.length)&&(c=h.length);var d=new(h instanceof u16?u16:h instanceof u32?u32:u8)(c-o);return d.set(h.subarray(o,c)),d},inflt=function(h,o,c){var d=h.length;if(!d||c&&!c.l&&d<5)return o||new u8(0);var _=!o||c,b=!c||c.i;c||(c={}),o||(o=new u8(3*d));var _e=function(mr){var Rr=o.length;if(mr>Rr){var Yr=new u8(Math.max(2*Rr,mr));Yr.set(o),o=Yr}},it=c.f||0,nt=c.p||0,at=c.b||0,ut=c.l,pt=c.d,mt=c.m,ft=c.n,vt=8*d;do{if(!ut){c.f=it=bits(h,nt,1);var xt=bits(h,nt+1,3);if(nt+=3,!xt){var At=h[(Jt=shft(nt)+4)-4]|h[Jt-3]<<8,Ct=Jt+At;if(Ct>d){if(b)throw"unexpected EOF";break}_&&_e(at+At),o.set(h.subarray(Jt,Ct),at),c.b=at+=At,c.p=nt=8*Ct;continue}if(xt==1)ut=flrm,pt=fdrm,mt=9,ft=5;else{if(xt!=2)throw"invalid block type";var Et=bits(h,nt,31)+257,Tt=bits(h,nt+10,15)+4,kt=Et+bits(h,nt+5,31)+1;nt+=14;for(var Dt=new u8(kt),zt=new u8(19),Bt=0;Bt<Tt;++Bt)zt[clim[Bt]]=bits(h,nt+3*Bt,7);nt+=3*Tt;var Rt=max(zt),Ut=(1<<Rt)-1,Ht=hMap(zt,Rt,1);for(Bt=0;Bt<kt;){var Jt,Kt=Ht[bits(h,nt,Ut)];if(nt+=15&Kt,(Jt=Kt>>>4)<16)Dt[Bt++]=Jt;else{var sr=0,ir=0;for(Jt==16?(ir=3+bits(h,nt,3),nt+=2,sr=Dt[Bt-1]):Jt==17?(ir=3+bits(h,nt,7),nt+=3):Jt==18&&(ir=11+bits(h,nt,127),nt+=7);ir--;)Dt[Bt++]=sr}}var cr=Dt.subarray(0,Et),lr=Dt.subarray(Et);mt=max(cr),ft=max(lr),ut=hMap(cr,mt,1),pt=hMap(lr,ft,1)}if(nt>vt){if(b)throw"unexpected EOF";break}}_&&_e(at+131072);for(var hr=(1<<mt)-1,dr=(1<<ft)-1,pr=nt;;pr=nt){var ur=(sr=ut[bits16(h,nt)&hr])>>>4;if((nt+=15&sr)>vt){if(b)throw"unexpected EOF";break}if(!sr)throw"invalid length/literal";if(ur<256)o[at++]=ur;else{if(ur==256){pr=nt,ut=null;break}var xr=ur-254;if(ur>264){var vr=fleb[Bt=ur-257];xr=bits(h,nt,(1<<vr)-1)+fl$1[Bt],nt+=vr}var Dr=pt[bits16(h,nt)&dr],_r=Dr>>>4;if(!Dr)throw"invalid distance";if(nt+=15&Dr,lr=fd$1[_r],_r>3&&(vr=fdeb[_r],lr+=bits16(h,nt)&(1<<vr)-1,nt+=vr),nt>vt){if(b)throw"unexpected EOF";break}_&&_e(at+131072);for(var rr=at+xr;at<rr;at+=4)o[at]=o[at-lr],o[at+1]=o[at+1-lr],o[at+2]=o[at+2-lr],o[at+3]=o[at+3-lr];at=rr}}c.l=ut,c.p=pr,c.b=at,ut&&(it=1,c.m=mt,c.d=pt,c.n=ft)}while(!it);return at==o.length?o:slc(o,0,at)},wbits=function(h,o,c){c<<=7&o;var d=o/8|0;h[d]|=c,h[d+1]|=c>>>8},wbits16=function(h,o,c){c<<=7&o;var d=o/8|0;h[d]|=c,h[d+1]|=c>>>8,h[d+2]|=c>>>16},hTree=function(h,o){for(var c=[],d=0;d<h.length;++d)h[d]&&c.push({s:d,f:h[d]});var _=c.length,b=c.slice();if(!_)return[browser_et,0];if(_==1){var _e=new u8(c[0].s+1);return _e[c[0].s]=1,[_e,1]}c.sort(function(Dt,zt){return Dt.f-zt.f}),c.push({s:-1,f:25001});var it=c[0],nt=c[1],at=0,ut=1,pt=2;for(c[0]={s:-1,f:it.f+nt.f,l:it,r:nt};ut!=_-1;)it=c[c[at].f<c[pt].f?at++:pt++],nt=c[at!=ut&&c[at].f<c[pt].f?at++:pt++],c[ut++]={s:-1,f:it.f+nt.f,l:it,r:nt};var mt=b[0].s;for(d=1;d<_;++d)b[d].s>mt&&(mt=b[d].s);var ft=new u16(mt+1),vt=ln(c[ut-1],ft,0);if(vt>o){d=0;var xt=0,At=vt-o,Ct=1<<At;for(b.sort(function(Dt,zt){return ft[zt.s]-ft[Dt.s]||Dt.f-zt.f});d<_;++d){var Et=b[d].s;if(!(ft[Et]>o))break;xt+=Ct-(1<<vt-ft[Et]),ft[Et]=o}for(xt>>>=At;xt>0;){var Tt=b[d].s;ft[Tt]<o?xt-=1<<o-ft[Tt]++-1:++d}for(;d>=0&&xt;--d){var kt=b[d].s;ft[kt]==o&&(--ft[kt],++xt)}vt=o}return[new u8(ft),vt]},ln=function(h,o,c){return h.s==-1?Math.max(ln(h.l,o,c+1),ln(h.r,o,c+1)):o[h.s]=c},lc$1=function(h){for(var o=h.length;o&&!h[--o];);for(var c=new u16(++o),d=0,_=h[0],b=1,_e=function(nt){c[d++]=nt},it=1;it<=o;++it)if(h[it]==_&&it!=o)++b;else{if(!_&&b>2){for(;b>138;b-=138)_e(32754);b>2&&(_e(b>10?b-11<<5|28690:b-3<<5|12305),b=0)}else if(b>3){for(_e(_),--b;b>6;b-=6)_e(8304);b>2&&(_e(b-3<<5|8208),b=0)}for(;b--;)_e(_);b=1,_=h[it]}return[c.subarray(0,d),o]},clen=function(h,o){for(var c=0,d=0;d<o.length;++d)c+=h[d]*o[d];return c},wfblk=function(h,o,c){var d=c.length,_=shft(o+2);h[_]=255&d,h[_+1]=d>>>8,h[_+2]=255^h[_],h[_+3]=255^h[_+1];for(var b=0;b<d;++b)h[_+b+4]=c[b];return 8*(_+4+d)},wblk=function(h,o,c,d,_,b,_e,it,nt,at,ut){wbits(o,ut++,c),++_[256];for(var pt=hTree(_,15),mt=pt[0],ft=pt[1],vt=hTree(b,15),xt=vt[0],At=vt[1],Ct=lc$1(mt),Et=Ct[0],Tt=Ct[1],kt=lc$1(xt),Dt=kt[0],zt=kt[1],Bt=new u16(19),Rt=0;Rt<Et.length;++Rt)Bt[31&Et[Rt]]++;for(Rt=0;Rt<Dt.length;++Rt)Bt[31&Dt[Rt]]++;for(var Ut=hTree(Bt,7),Ht=Ut[0],Jt=Ut[1],Kt=19;Kt>4&&!Ht[clim[Kt-1]];--Kt);var sr,ir,cr,lr,hr=at+5<<3,dr=clen(_,flt)+clen(b,fdt)+_e,pr=clen(_,mt)+clen(b,xt)+_e+14+3*Kt+clen(Bt,Ht)+(2*Bt[16]+3*Bt[17]+7*Bt[18]);if(hr<=dr&&hr<=pr)return wfblk(o,ut,h.subarray(nt,nt+at));if(wbits(o,ut,1+(pr<dr)),ut+=2,pr<dr){sr=hMap(mt,ft,0),ir=mt,cr=hMap(xt,At,0),lr=xt;var ur=hMap(Ht,Jt,0);for(wbits(o,ut,Tt-257),wbits(o,ut+5,zt-1),wbits(o,ut+10,Kt-4),ut+=14,Rt=0;Rt<Kt;++Rt)wbits(o,ut+3*Rt,Ht[clim[Rt]]);ut+=3*Kt;for(var xr=[Et,Dt],vr=0;vr<2;++vr){var Dr=xr[vr];for(Rt=0;Rt<Dr.length;++Rt){var _r=31&Dr[Rt];wbits(o,ut,ur[_r]),ut+=Ht[_r],_r>15&&(wbits(o,ut,Dr[Rt]>>>5&127),ut+=Dr[Rt]>>>12)}}}else sr=flm,ir=flt,cr=fdm,lr=fdt;for(Rt=0;Rt<it;++Rt)if(d[Rt]>255){_r=d[Rt]>>>18&31,wbits16(o,ut,sr[_r+257]),ut+=ir[_r+257],_r>7&&(wbits(o,ut,d[Rt]>>>23&31),ut+=fleb[_r]);var rr=31&d[Rt];wbits16(o,ut,cr[rr]),ut+=lr[rr],rr>3&&(wbits16(o,ut,d[Rt]>>>5&8191),ut+=fdeb[rr])}else wbits16(o,ut,sr[d[Rt]]),ut+=ir[d[Rt]];return wbits16(o,ut,sr[256]),ut+ir[256]},deo=new u32([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),browser_et=new u8(0),dflt=function(h,o,c,d,_,b){var _e=h.length,it=new u8(d+_e+5*(1+Math.ceil(_e/7e3))+_),nt=it.subarray(d,it.length-_),at=0;if(!o||_e<8)for(var ut=0;ut<=_e;ut+=65535){var pt=ut+65535;pt<_e?at=wfblk(nt,at,h.subarray(ut,pt)):(nt[ut]=b,at=wfblk(nt,at,h.subarray(ut,_e)))}else{for(var mt=deo[o-1],ft=mt>>>13,vt=8191&mt,xt=(1<<c)-1,At=new u16(32768),Ct=new u16(xt+1),Et=Math.ceil(c/3),Tt=2*Et,kt=function(yn){return(h[yn]^h[yn+1]<<Et^h[yn+2]<<Tt)&xt},Dt=new u32(25e3),zt=new u16(288),Bt=new u16(32),Rt=0,Ut=0,Ht=(ut=0,0),Jt=0,Kt=0;ut<_e;++ut){var sr=kt(ut),ir=32767&ut,cr=Ct[sr];if(At[ir]=cr,Ct[sr]=ir,Jt<=ut){var lr=_e-ut;if((Rt>7e3||Ht>24576)&&lr>423){at=wblk(h,nt,0,Dt,zt,Bt,Ut,Ht,Kt,ut-Kt,at),Ht=Rt=Ut=0,Kt=ut;for(var hr=0;hr<286;++hr)zt[hr]=0;for(hr=0;hr<30;++hr)Bt[hr]=0}var dr=2,pr=0,ur=vt,xr=ir-cr&32767;if(lr>2&&sr==kt(ut-xr))for(var vr=Math.min(ft,lr)-1,Dr=Math.min(32767,ut),_r=Math.min(258,lr);xr<=Dr&&--ur&&ir!=cr;){if(h[ut+dr]==h[ut+dr-xr]){for(var rr=0;rr<_r&&h[ut+rr]==h[ut+rr-xr];++rr);if(rr>dr){if(dr=rr,pr=xr,rr>vr)break;var mr=Math.min(xr,rr-2),Rr=0;for(hr=0;hr<mr;++hr){var Yr=ut-xr+hr+32768&32767,Zr=Yr-At[Yr]+32768&32767;Zr>Rr&&(Rr=Zr,cr=Yr)}}}xr+=(ir=cr)-(cr=At[ir])+32768&32767}if(pr){Dt[Ht++]=268435456|revfl[dr]<<18|revfd[pr];var cn=31&revfl[dr],Tn=31&revfd[pr];Ut+=fleb[cn]+fdeb[Tn],++zt[257+cn],++Bt[Tn],Jt=ut+dr,++Rt}else Dt[Ht++]=h[ut],++zt[h[ut]]}}at=wblk(h,nt,b,Dt,zt,Bt,Ut,Ht,Kt,ut-Kt,at),!b&&7&at&&(at=wfblk(nt,at+1,browser_et))}return slc(it,0,d+shft(at)+_)},crct=function(){for(var h=new Int32Array(256),o=0;o<256;++o){for(var c=o,d=9;--d;)c=(1&c&&-306674912)^c>>>1;h[o]=c}return h}(),crc=function(){var h=-1;return{p:function(o){for(var c=h,d=0;d<o.length;++d)c=crct[255&c^o[d]]^c>>>8;h=c},d:function(){return~h}}},adler=function(){var h=1,o=0;return{p:function(c){for(var d=h,_=o,b=c.length,_e=0;_e!=b;){for(var it=Math.min(_e+2655,b);_e<it;++_e)_+=d+=c[_e];d=(65535&d)+15*(d>>16),_=(65535&_)+15*(_>>16)}h=d,o=_},d:function(){return(255&(h%=65521))<<24|h>>>8<<16|(255&(o%=65521))<<8|o>>>8}}},dopt=function(h,o,c,d,_){return dflt(h,o.level==null?6:o.level,o.mem==null?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(h.length)))):12+o.mem,c,d,!_)},mrg=function(h,o){var c={};for(var d in h)c[d]=h[d];for(var d in o)c[d]=o[d];return c},wcln=function(h,o,c){for(var d=h(),_=h.toString(),b=_.slice(_.indexOf("[")+1,_.lastIndexOf("]")).replace(/ /g,"").split(","),_e=0;_e<d.length;++_e){var it=d[_e],nt=b[_e];if(typeof it=="function"){o+=";"+nt+"=";var at=it.toString();if(it.prototype)if(at.indexOf("[native code]")!=-1){var ut=at.indexOf(" ",8)+1;o+=at.slice(ut,at.indexOf("(",ut))}else for(var pt in o+=at,it.prototype)o+=";"+nt+".prototype."+pt+"="+it.prototype[pt].toString();else o+=at}else c[nt]=it}return[o,c]},ch$1=[],cbfs=function(h){var o=[];for(var c in h)(h[c]instanceof u8||h[c]instanceof u16||h[c]instanceof u32)&&o.push((h[c]=new h[c].constructor(h[c])).buffer);return o},wrkr=function(h,o,c,d){var _;if(!ch$1[c]){for(var b="",_e={},it=h.length-1,nt=0;nt<it;++nt)b=(_=wcln(h[nt],b,_e))[0],_e=_[1];ch$1[c]=wcln(h[it],b,_e)}var at=mrg({},ch$1[c][1]);return wk$1(ch$1[c][0]+";onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage="+o.toString()+"}",c,at,cbfs(at),d)},bInflt=function(){return[u8,u16,u32,fleb,fdeb,clim,fl$1,fd$1,flrm,fdrm,rev,hMap,max,bits,bits16,shft,slc,inflt,inflateSync,pbf,gu8]},bDflt=function(){return[u8,u16,u32,fleb,fdeb,clim,revfl,revfd,flm,flt,fdm,fdt,rev,deo,browser_et,hMap,wbits,wbits16,hTree,ln,lc$1,clen,wfblk,wblk,shft,slc,dflt,dopt,deflateSync,pbf]},gze=function(){return[gzh,gzhl,wbytes,crc,crct]},guze=function(){return[gzs,gzl]},zle=function(){return[zlh,wbytes,adler]},zule=function(){return[zlv]},pbf=function(h){return postMessage(h,[h.buffer])},gu8=function(h){return h&&h.size&&new u8(h.size)},cbify=function(h,o,c,d,_,b){var _e=wrkr(c,d,_,function(it,nt){_e.terminate(),b(it,nt)});return _e.postMessage([h,o],o.consume?[h.buffer]:[]),function(){_e.terminate()}},astrm=function(h){return h.ondata=function(o,c){return postMessage([o,c],[o.buffer])},function(o){return h.push(o.data[0],o.data[1])}},astrmify=function(h,o,c,d,_){var b,_e=wrkr(h,d,_,function(it,nt){it?(_e.terminate(),o.ondata.call(o,it)):(nt[1]&&_e.terminate(),o.ondata.call(o,it,nt[0],nt[1]))});_e.postMessage(c),o.push=function(it,nt){if(b)throw"stream finished";if(!o.ondata)throw"no stream handler";_e.postMessage([it,b=nt],[it.buffer])},o.terminate=function(){_e.terminate()}},b2=function(h,o){return h[o]|h[o+1]<<8},b4=function(h,o){return(h[o]|h[o+1]<<8|h[o+2]<<16|h[o+3]<<24)>>>0},b8=function(h,o){return b4(h,o)+4294967296*b4(h,o+4)},wbytes=function(h,o,c){for(;c;++o)h[o]=c,c>>>=8},gzh=function(h,o){var c=o.filename;if(h[0]=31,h[1]=139,h[2]=8,h[8]=o.level<2?4:o.level==9?2:0,h[9]=3,o.mtime!=0&&wbytes(h,4,Math.floor(new Date(o.mtime||Date.now())/1e3)),c){h[3]=8;for(var d=0;d<=c.length;++d)h[d+10]=c.charCodeAt(d)}},gzs=function(h){if(h[0]!=31||h[1]!=139||h[2]!=8)throw"invalid gzip data";var o=h[3],c=10;4&o&&(c+=h[10]|2+(h[11]<<8));for(var d=(o>>3&1)+(o>>4&1);d>0;d-=!h[c++]);return c+(2&o)},gzl=function(h){var o=h.length;return(h[o-4]|h[o-3]<<8|h[o-2]<<16|h[o-1]<<24)>>>0},gzhl=function(h){return 10+(h.filename&&h.filename.length+1||0)},zlh=function(h,o){var c=o.level,d=c==0?0:c<6?1:c==9?3:2;h[0]=120,h[1]=d<<6|(d?32-2*d:1)},zlv=function(h){if((15&h[0])!=8||h[0]>>>4>7||(h[0]<<8|h[1])%31)throw"invalid zlib data";if(32&h[1])throw"invalid zlib data: preset dictionaries not supported"};function AsyncCmpStrm(h,o){return o||typeof h!="function"||(o=h,h={}),this.ondata=o,h}var Deflate=function(){function h(o,c){c||typeof o!="function"||(c=o,o={}),this.ondata=c,this.o=o||{}}return h.prototype.p=function(o,c){this.ondata(dopt(o,this.o,0,0,!c),c)},h.prototype.push=function(o,c){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";this.d=c,this.p(o,c||!1)},h}(),AsyncDeflate=function(){return function(h,o){astrmify([bDflt,function(){return[astrm,Deflate]}],this,AsyncCmpStrm.call(this,h,o),function(c){var d=new Deflate(c.data);onmessage=astrm(d)},6)}}();function deflate(h,o,c){if(c||(c=o,o={}),typeof c!="function")throw"no callback";return cbify(h,o,[bDflt],function(d){return pbf(deflateSync(d.data[0],d.data[1]))},0,c)}function deflateSync(h,o){return dopt(h,o||{},0,0)}var Inflate=function(){function h(o){this.s={},this.p=new u8(0),this.ondata=o}return h.prototype.e=function(o){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";var c=this.p.length,d=new u8(c+o.length);d.set(this.p),d.set(o,c),this.p=d},h.prototype.c=function(o){this.d=this.s.i=o||!1;var c=this.s.b,d=inflt(this.p,this.o,this.s);this.ondata(slc(d,c,this.s.b),this.d),this.o=slc(d,this.s.b-32768),this.s.b=this.o.length,this.p=slc(this.p,this.s.p/8|0),this.s.p&=7},h.prototype.push=function(o,c){this.e(o),this.c(c)},h}(),AsyncInflate=function(){return function(h){this.ondata=h,astrmify([bInflt,function(){return[astrm,Inflate]}],this,0,function(){var o=new Inflate;onmessage=astrm(o)},7)}}();function inflate(h,o,c){if(c||(c=o,o={}),typeof c!="function")throw"no callback";return cbify(h,o,[bInflt],function(d){return pbf(inflateSync(d.data[0],gu8(d.data[1])))},1,c)}function inflateSync(h,o){return inflt(h,o)}var Gzip=function(){function h(o,c){this.c=crc(),this.l=0,this.v=1,Deflate.call(this,o,c)}return h.prototype.push=function(o,c){Deflate.prototype.push.call(this,o,c)},h.prototype.p=function(o,c){this.c.p(o),this.l+=o.length;var d=dopt(o,this.o,this.v&&gzhl(this.o),c&&8,!c);this.v&&(gzh(d,this.o),this.v=0),c&&(wbytes(d,d.length-8,this.c.d()),wbytes(d,d.length-4,this.l)),this.ondata(d,c)},h}(),AsyncGzip=function(){return function(h,o){astrmify([bDflt,gze,function(){return[astrm,Deflate,Gzip]}],this,AsyncCmpStrm.call(this,h,o),function(c){var d=new Gzip(c.data);onmessage=astrm(d)},8)}}();function gzip(h,o,c){if(c||(c=o,o={}),typeof c!="function")throw"no callback";return cbify(h,o,[bDflt,gze,function(){return[gzipSync]}],function(d){return pbf(gzipSync(d.data[0],d.data[1]))},2,c)}function gzipSync(h,o){o||(o={});var c=crc(),d=h.length;c.p(h);var _=dopt(h,o,gzhl(o),8),b=_.length;return gzh(_,o),wbytes(_,b-8,c.d()),wbytes(_,b-4,d),_}var Gunzip=function(){function h(o){this.v=1,Inflate.call(this,o)}return h.prototype.push=function(o,c){if(Inflate.prototype.e.call(this,o),this.v){var d=this.p.length>3?gzs(this.p):4;if(d>=this.p.length&&!c)return;this.p=this.p.subarray(d),this.v=0}if(c){if(this.p.length<8)throw"invalid gzip stream";this.p=this.p.subarray(0,-8)}Inflate.prototype.c.call(this,c)},h}(),AsyncGunzip=function(){return function(h){this.ondata=h,astrmify([bInflt,guze,function(){return[astrm,Inflate,Gunzip]}],this,0,function(){var o=new Gunzip;onmessage=astrm(o)},9)}}();function gunzip(h,o,c){if(c||(c=o,o={}),typeof c!="function")throw"no callback";return cbify(h,o,[bInflt,guze,function(){return[gunzipSync]}],function(d){return pbf(gunzipSync(d.data[0]))},3,c)}function gunzipSync(h,o){return inflt(h.subarray(gzs(h),-8),o||new u8(gzl(h)))}var Zlib=function(){function h(o,c){this.c=adler(),this.v=1,Deflate.call(this,o,c)}return h.prototype.push=function(o,c){Deflate.prototype.push.call(this,o,c)},h.prototype.p=function(o,c){this.c.p(o);var d=dopt(o,this.o,this.v&&2,c&&4,!c);this.v&&(zlh(d,this.o),this.v=0),c&&wbytes(d,d.length-4,this.c.d()),this.ondata(d,c)},h}(),AsyncZlib=function(){return function(h,o){astrmify([bDflt,zle,function(){return[astrm,Deflate,Zlib]}],this,AsyncCmpStrm.call(this,h,o),function(c){var d=new Zlib(c.data);onmessage=astrm(d)},10)}}();function zlib(h,o,c){if(c||(c=o,o={}),typeof c!="function")throw"no callback";return cbify(h,o,[bDflt,zle,function(){return[zlibSync]}],function(d){return pbf(zlibSync(d.data[0],d.data[1]))},4,c)}function zlibSync(h,o){o||(o={});var c=adler();c.p(h);var d=dopt(h,o,2,4);return zlh(d,o),wbytes(d,d.length-4,c.d()),d}var Unzlib=function(){function h(o){this.v=1,Inflate.call(this,o)}return h.prototype.push=function(o,c){if(Inflate.prototype.e.call(this,o),this.v){if(this.p.length<2&&!c)return;this.p=this.p.subarray(2),this.v=0}if(c){if(this.p.length<4)throw"invalid zlib stream";this.p=this.p.subarray(0,-4)}Inflate.prototype.c.call(this,c)},h}(),AsyncUnzlib=function(){return function(h){this.ondata=h,astrmify([bInflt,zule,function(){return[astrm,Inflate,Unzlib]}],this,0,function(){var o=new Unzlib;onmessage=astrm(o)},11)}}();function unzlib(h,o,c){if(c||(c=o,o={}),typeof c!="function")throw"no callback";return cbify(h,o,[bInflt,zule,function(){return[unzlibSync]}],function(d){return pbf(unzlibSync(d.data[0],gu8(d.data[1])))},5,c)}function unzlibSync(h,o){return inflt((zlv(h),h.subarray(2,-4)),o)}var Decompress=function(){function h(o){this.G=Gunzip,this.I=Inflate,this.Z=Unzlib,this.ondata=o}return h.prototype.push=function(o,c){if(!this.ondata)throw"no stream handler";if(this.s)this.s.push(o,c);else{if(this.p&&this.p.length){var d=new u8(this.p.length+o.length);d.set(this.p),d.set(o,this.p.length)}else this.p=o;if(this.p.length>2){var _=this,b=function(){_.ondata.apply(_,arguments)};this.s=this.p[0]==31&&this.p[1]==139&&this.p[2]==8?new this.G(b):(15&this.p[0])!=8||this.p[0]>>4>7||(this.p[0]<<8|this.p[1])%31?new this.I(b):new this.Z(b),this.s.push(this.p,c),this.p=null}}},h}(),AsyncDecompress=function(){function h(o){this.G=AsyncGunzip,this.I=AsyncInflate,this.Z=AsyncUnzlib,this.ondata=o}return h.prototype.push=function(o,c){Decompress.prototype.push.call(this,o,c)},h}();function decompress(h,o,c){if(c||(c=o,o={}),typeof c!="function")throw"no callback";return h[0]==31&&h[1]==139&&h[2]==8?gunzip(h,o,c):(15&h[0])!=8||h[0]>>4>7||(h[0]<<8|h[1])%31?inflate(h,o,c):unzlib(h,o,c)}function decompressSync(h,o){return h[0]==31&&h[1]==139&&h[2]==8?gunzipSync(h,o):(15&h[0])!=8||h[0]>>4>7||(h[0]<<8|h[1])%31?inflateSync(h,o):unzlibSync(h,o)}var fltn=function(h,o,c,d){for(var _ in h){var b=h[_],_e=o+_;b instanceof u8?c[_e]=[b,d]:Array.isArray(b)?c[_e]=[b[0],mrg(d,b[1])]:fltn(b,_e+"/",c,d)}},browser_te=typeof TextEncoder<"u"&&new TextEncoder,td$1=typeof TextDecoder<"u"&&new TextDecoder,tds=0;try{td$1.decode(browser_et,{stream:!0}),tds=1}catch(h){}var dutf8=function(h){for(var o="",c=0;;){var d=h[c++],_=(d>127)+(d>223)+(d>239);if(c+_>h.length)return[o,slc(h,c-1)];_?_==3?(d=((15&d)<<18|(63&h[c++])<<12|(63&h[c++])<<6|63&h[c++])-65536,o+=String.fromCharCode(55296|d>>10,56320|1023&d)):o+=1&_?String.fromCharCode((31&d)<<6|63&h[c++]):String.fromCharCode((15&d)<<12|(63&h[c++])<<6|63&h[c++]):o+=String.fromCharCode(d)}},DecodeUTF8=function(){function h(o){this.ondata=o,tds?this.t=new TextDecoder:this.p=browser_et}return h.prototype.push=function(o,c){if(!this.ondata)throw"no callback";if(c=!!c,this.t){if(this.ondata(this.t.decode(o,{stream:!0}),c),c){if(this.t.decode().length)throw"invalid utf-8 data";this.t=null}}else{if(!this.p)throw"stream finished";var d=new u8(this.p.length+o.length);d.set(this.p),d.set(o,this.p.length);var _=dutf8(d),b=_[0],_e=_[1];if(c){if(_e.length)throw"invalid utf-8 data";this.p=null}else this.p=_e;this.ondata(b,c)}},h}(),EncodeUTF8=function(){function h(o){this.ondata=o}return h.prototype.push=function(o,c){if(!this.ondata)throw"no callback";if(this.d)throw"stream finished";this.ondata(strToU8(o),this.d=c||!1)},h}();function strToU8(h,o){if(o){for(var c=new u8(h.length),d=0;d<h.length;++d)c[d]=h.charCodeAt(d);return c}if(browser_te)return browser_te.encode(h);var _=h.length,b=new u8(h.length+(h.length>>1)),_e=0,it=function(ut){b[_e++]=ut};for(d=0;d<_;++d){if(_e+5>b.length){var nt=new u8(_e+8+(_-d<<1));nt.set(b),b=nt}var at=h.charCodeAt(d);at<128||o?it(at):at<2048?(it(192|at>>6),it(128|63&at)):at>55295&&at<57344?(it(240|(at=65536+(1047552&at)|1023&h.charCodeAt(++d))>>18),it(128|at>>12&63),it(128|at>>6&63),it(128|63&at)):(it(224|at>>12),it(128|at>>6&63),it(128|63&at))}return slc(b,0,_e)}function strFromU8(h,o){if(o){for(var c="",d=0;d<h.length;d+=16384)c+=String.fromCharCode.apply(null,h.subarray(d,d+16384));return c}if(td$1)return td$1.decode(h);var _=dutf8(h),b=_[0];if(_[1].length)throw"invalid utf-8 data";return b}var dbf=function(h){return h==1?3:h<6?2:h==9?1:0},slzh=function(h,o){return o+30+b2(h,o+26)+b2(h,o+28)},zh$1=function(h,o,c){var d=b2(h,o+28),_=strFromU8(h.subarray(o+46,o+46+d),!(2048&b2(h,o+8))),b=o+46+d,_e=b4(h,o+20),it=c&&_e==4294967295?z64e(h,b):[_e,b4(h,o+24),b4(h,o+42)],nt=it[0],at=it[1],ut=it[2];return[b2(h,o+10),nt,at,_,b+b2(h,o+30)+b2(h,o+32),ut]},z64e=function(h,o){for(;b2(h,o)!=1;o+=4+b2(h,o+2));return[b8(h,o+12),b8(h,o+4),b8(h,o+20)]},exfl=function(h){var o=0;if(h)for(var c in h){var d=h[c].length;if(d>65535)throw"extra field too long";o+=d+4}return o},wzh=function(h,o,c,d,_,b,_e,it){var nt=d.length,at=c.extra,ut=it&&it.length,pt=exfl(at);wbytes(h,o,_e!=null?33639248:67324752),o+=4,_e!=null&&(h[o++]=20,h[o++]=c.os),h[o]=20,o+=2,h[o++]=c.flag<<1|(b==null&&8),h[o++]=_&&8,h[o++]=255&c.compression,h[o++]=c.compression>>8;var mt=new Date(c.mtime==null?Date.now():c.mtime),ft=mt.getFullYear()-1980;if(ft<0||ft>119)throw"date not in range 1980-2099";if(wbytes(h,o,ft<<25|mt.getMonth()+1<<21|mt.getDate()<<16|mt.getHours()<<11|mt.getMinutes()<<5|mt.getSeconds()>>>1),o+=4,b!=null&&(wbytes(h,o,c.crc),wbytes(h,o+4,b),wbytes(h,o+8,c.size)),wbytes(h,o+12,nt),wbytes(h,o+14,pt),o+=16,_e!=null&&(wbytes(h,o,ut),wbytes(h,o+6,c.attrs),wbytes(h,o+10,_e),o+=14),h.set(d,o),o+=nt,pt)for(var vt in at){var xt=at[vt],At=xt.length;wbytes(h,o,+vt),wbytes(h,o+2,At),h.set(xt,o+4),o+=4+At}return ut&&(h.set(it,o),o+=ut),o},wzf=function(h,o,c,d,_){wbytes(h,o,101010256),wbytes(h,o+8,c),wbytes(h,o+10,c),wbytes(h,o+12,d),wbytes(h,o+16,_)},ZipPassThrough=function(){function h(o){this.filename=o,this.c=crc(),this.size=0,this.compression=0}return h.prototype.process=function(o,c){this.ondata(null,o,c)},h.prototype.push=function(o,c){if(!this.ondata)throw"no callback - add to ZIP archive before pushing";this.c.p(o),this.size+=o.length,c&&(this.crc=this.c.d()),this.process(o,c||!1)},h}(),ZipDeflate=function(){function h(o,c){var d=this;c||(c={}),ZipPassThrough.call(this,o),this.d=new Deflate(c,function(_,b){d.ondata(null,_,b)}),this.compression=8,this.flag=dbf(c.level)}return h.prototype.process=function(o,c){try{this.d.push(o,c)}catch(d){this.ondata(d,null,c)}},h.prototype.push=function(o,c){ZipPassThrough.prototype.push.call(this,o,c)},h}(),AsyncZipDeflate=function(){function h(o,c){var d=this;c||(c={}),ZipPassThrough.call(this,o),this.d=new AsyncDeflate(c,function(_,b,_e){d.ondata(_,b,_e)}),this.compression=8,this.flag=dbf(c.level),this.terminate=this.d.terminate}return h.prototype.process=function(o,c){this.d.push(o,c)},h.prototype.push=function(o,c){ZipPassThrough.prototype.push.call(this,o,c)},h}(),Zip=function(){function h(o){this.ondata=o,this.u=[],this.d=1}return h.prototype.add=function(o){var c=this;if(2&this.d)throw"stream finished";var d=strToU8(o.filename),_=d.length,b=o.comment,_e=b&&strToU8(b),it=_!=o.filename.length||_e&&b.length!=_e.length,nt=_+exfl(o.extra)+30;if(_>65535)throw"filename too long";var at=new u8(nt);wzh(at,0,o,d,it);var ut=[at],pt=function(){for(var At=0,Ct=ut;At<Ct.length;At++){var Et=Ct[At];c.ondata(null,Et,!1)}ut=[]},mt=this.d;this.d=0;var ft=this.u.length,vt=mrg(o,{f:d,u:it,o:_e,t:function(){o.terminate&&o.terminate()},r:function(){if(pt(),mt){var At=c.u[ft+1];At?At.r():c.d=1}mt=1}}),xt=0;o.ondata=function(At,Ct,Et){if(At)c.ondata(At,Ct,Et),c.terminate();else if(xt+=Ct.length,ut.push(Ct),Et){var Tt=new u8(16);wbytes(Tt,0,134695760),wbytes(Tt,4,o.crc),wbytes(Tt,8,xt),wbytes(Tt,12,o.size),ut.push(Tt),vt.c=xt,vt.b=nt+xt+16,vt.crc=o.crc,vt.size=o.size,mt&&vt.r(),mt=1}else mt&&pt()},this.u.push(vt)},h.prototype.end=function(){var o=this;if(2&this.d)throw 1&this.d?"stream finishing":"stream finished";this.d?this.e():this.u.push({r:function(){1&o.d&&(o.u.splice(-1,1),o.e())},t:function(){}}),this.d=3},h.prototype.e=function(){for(var o=0,c=0,d=0,_=0,b=this.u;_<b.length;_++)d+=46+(at=b[_]).f.length+exfl(at.extra)+(at.o?at.o.length:0);for(var _e=new u8(d+22),it=0,nt=this.u;it<nt.length;it++){var at=nt[it];wzh(_e,o,at,at.f,at.u,at.c,c,at.o),o+=46+at.f.length+exfl(at.extra)+(at.o?at.o.length:0),c+=at.b}wzf(_e,o,this.u.length,d,c),this.ondata(null,_e,!0),this.d=2},h.prototype.terminate=function(){for(var o=0,c=this.u;o<c.length;o++)c[o].t();this.d=2},h}();function zip(h,o,c){if(c||(c=o,o={}),typeof c!="function")throw"no callback";var d={};fltn(h,"",d,o);var _=Object.keys(d),b=_.length,_e=0,it=0,nt=b,at=new Array(b),ut=[],pt=function(){for(var xt=0;xt<ut.length;++xt)ut[xt]()},mt=function(){var xt=new u8(it+22),At=_e,Ct=it-_e;it=0;for(var Et=0;Et<nt;++Et){var Tt=at[Et];try{var kt=Tt.c.length;wzh(xt,it,Tt,Tt.f,Tt.u,kt);var Dt=30+Tt.f.length+exfl(Tt.extra),zt=it+Dt;xt.set(Tt.c,zt),wzh(xt,_e,Tt,Tt.f,Tt.u,kt,it,Tt.m),_e+=16+Dt+(Tt.m?Tt.m.length:0),it=zt+kt}catch(Bt){return c(Bt,null)}}wzf(xt,_e,at.length,Ct,At),c(null,xt)};b||mt();for(var ft=function(xt){var At=_[xt],Ct=d[At],Et=Ct[0],Tt=Ct[1],kt=crc(),Dt=Et.length;kt.p(Et);var zt=strToU8(At),Bt=zt.length,Rt=Tt.comment,Ut=Rt&&strToU8(Rt),Ht=Ut&&Ut.length,Jt=exfl(Tt.extra),Kt=Tt.level==0?0:8,sr=function(ir,cr){if(ir)pt(),c(ir,null);else{var lr=cr.length;at[xt]=mrg(Tt,{size:Dt,crc:kt.d(),c:cr,f:zt,m:Ut,u:Bt!=At.length||Ut&&Rt.length!=Ht,compression:Kt}),_e+=30+Bt+Jt+lr,it+=76+2*(Bt+Jt)+(Ht||0)+lr,--b||mt()}};if(Bt>65535&&sr("filename too long",null),Kt)if(Dt<16e4)try{sr(null,deflateSync(Et,Tt))}catch(ir){sr(ir,null)}else ut.push(deflate(Et,Tt,sr));else sr(null,Et)},vt=0;vt<nt;++vt)ft(vt);return pt}function zipSync(h,o){o||(o={});var c={},d=[];fltn(h,"",c,o);var _=0,b=0;for(var _e in c){var it=c[_e],nt=it[0],at=it[1],ut=at.level==0?0:8,pt=(Bt=strToU8(_e)).length,mt=at.comment,ft=mt&&strToU8(mt),vt=ft&&ft.length,xt=exfl(at.extra);if(pt>65535)throw"filename too long";var At=ut?deflateSync(nt,at):nt,Ct=At.length,Et=crc();Et.p(nt),d.push(mrg(at,{size:nt.length,crc:Et.d(),c:At,f:Bt,m:ft,u:pt!=_e.length||ft&&mt.length!=vt,o:_,compression:ut})),_+=30+pt+xt+Ct,b+=76+2*(pt+xt)+(vt||0)+Ct}for(var Tt=new u8(b+22),kt=_,Dt=b-_,zt=0;zt<d.length;++zt){var Bt=d[zt];wzh(Tt,Bt.o,Bt,Bt.f,Bt.u,Bt.c.length);var Rt=30+Bt.f.length+exfl(Bt.extra);Tt.set(Bt.c,Bt.o+Rt),wzh(Tt,_,Bt,Bt.f,Bt.u,Bt.c.length,Bt.o,Bt.m),_+=16+Rt+(Bt.m?Bt.m.length:0)}return wzf(Tt,_,d.length,Dt,kt),Tt}var UnzipPassThrough=function(){function h(){}return h.prototype.push=function(o,c){this.ondata(null,o,c)},h.compression=0,h}(),UnzipInflate=function(){function h(){var o=this;this.i=new Inflate(function(c,d){o.ondata(null,c,d)})}return h.prototype.push=function(o,c){try{this.i.push(o,c)}catch(d){this.ondata(d,o,c)}},h.compression=8,h}(),AsyncUnzipInflate=function(){function h(o,c){var d=this;c<32e4?this.i=new Inflate(function(_,b){d.ondata(null,_,b)}):(this.i=new AsyncInflate(function(_,b,_e){d.ondata(_,b,_e)}),this.terminate=this.i.terminate)}return h.prototype.push=function(o,c){this.i.terminate&&(o=slc(o,0)),this.i.push(o,c)},h.compression=8,h}(),Unzip=function(){function h(o){this.onfile=o,this.k=[],this.o={0:UnzipPassThrough},this.p=browser_et}return h.prototype.push=function(o,c){var d=this;if(!this.onfile)throw"no callback";if(!this.p)throw"stream finished";if(this.c>0){var _=Math.min(this.c,o.length),b=o.subarray(0,_);if(this.c-=_,this.d?this.d.push(b,!this.c):this.k[0].push(b),(o=o.subarray(_)).length)return this.push(o,c)}else{var _e=0,it=0,nt=void 0,at=void 0;this.p.length?o.length?((at=new u8(this.p.length+o.length)).set(this.p),at.set(o,this.p.length)):at=this.p:at=o;for(var ut=at.length,pt=this.c,mt=pt&&this.d,ft=function(){var At,Ct=b4(at,it);if(Ct==67324752){_e=1,nt=it,vt.d=null,vt.c=0;var Et=b2(at,it+6),Tt=b2(at,it+8),kt=2048&Et,Dt=8&Et,zt=b2(at,it+26),Bt=b2(at,it+28);if(ut>it+30+zt+Bt){var Rt=[];vt.k.unshift(Rt),_e=2;var Ut,Ht=b4(at,it+18),Jt=b4(at,it+22),Kt=strFromU8(at.subarray(it+30,it+=30+zt),!kt);Ht==4294967295?(At=Dt?[-2]:z64e(at,it),Ht=At[0],Jt=At[1]):Dt&&(Ht=-1),it+=Bt,vt.c=Ht;var sr={name:Kt,compression:Tt,start:function(){if(!sr.ondata)throw"no callback";if(Ht){var ir=d.o[Tt];if(!ir)throw"unknown compression type "+Tt;(Ut=Ht<0?new ir(Kt):new ir(Kt,Ht,Jt)).ondata=function(dr,pr,ur){sr.ondata(dr,pr,ur)};for(var cr=0,lr=Rt;cr<lr.length;cr++){var hr=lr[cr];Ut.push(hr,!1)}d.k[0]==Rt&&d.c?d.d=Ut:Ut.push(browser_et,!0)}else sr.ondata(null,browser_et,!0)},terminate:function(){Ut&&Ut.terminate&&Ut.terminate()}};Ht>=0&&(sr.size=Ht,sr.originalSize=Jt),vt.onfile(sr)}return"break"}if(pt){if(Ct==134695760)return nt=it+=12+(pt==-2&&8),_e=3,vt.c=0,"break";if(Ct==33639248)return nt=it-=4,_e=3,vt.c=0,"break"}},vt=this;it<ut-4&&ft()!=="break";++it);if(this.p=browser_et,pt<0){var xt=_e?at.subarray(0,nt-12-(pt==-2&&8)-(b4(at,nt-16)==134695760&&4)):at.subarray(0,it);mt?mt.push(xt,!!_e):this.k[+(_e==2)].push(xt)}if(2&_e)return this.push(at.subarray(it),c);this.p=at.subarray(it)}if(c){if(this.c)throw"invalid zip file";this.p=null}},h.prototype.register=function(o){this.o[o.compression]=o},h}();function unzip(h,o){if(typeof o!="function")throw"no callback";for(var c=[],d=function(){for(var mt=0;mt<c.length;++mt)c[mt]()},_={},b=h.length-22;b4(h,b)!=101010256;--b)if(!b||h.length-b>65558)return void o("invalid zip file",null);var _e=b2(h,b+8);_e||o(null,{});var it=_e,nt=b4(h,b+16),at=nt==4294967295;if(at){if(b=b4(h,b-12),b4(h,b)!=101075792)return void o("invalid zip file",null);it=_e=b4(h,b+32),nt=b4(h,b+48)}for(var ut=function(mt){var ft=zh$1(h,nt,at),vt=ft[0],xt=ft[1],At=ft[2],Ct=ft[3],Et=ft[4],Tt=ft[5],kt=slzh(h,Tt);nt=Et;var Dt=function(Bt,Rt){Bt?(d(),o(Bt,null)):(_[Ct]=Rt,--_e||o(null,_))};if(vt)if(vt==8){var zt=h.subarray(kt,kt+xt);if(xt<32e4)try{Dt(null,inflateSync(zt,new u8(At)))}catch(Bt){Dt(Bt,null)}else c.push(inflate(zt,{size:At},Dt))}else Dt("unknown compression type "+vt,null);else Dt(null,slc(h,kt,kt+xt))},pt=0;pt<it;++pt)ut();return d}function unzipSync(h){for(var o={},c=h.length-22;b4(h,c)!=101010256;--c)if(!c||h.length-c>65558)throw"invalid zip file";var d=b2(h,c+8);if(!d)return{};var _=b4(h,c+16),b=_==4294967295;if(b){if(c=b4(h,c-12),b4(h,c)!=101075792)throw"invalid zip file";d=b4(h,c+32),_=b4(h,c+48)}for(var _e=0;_e<d;++_e){var it=zh$1(h,_,b),nt=it[0],at=it[1],ut=it[2],pt=it[3],mt=it[4],ft=it[5],vt=slzh(h,ft);if(_=mt,nt){if(nt!=8)throw"unknown compression type "+nt;o[pt]=inflateSync(h.subarray(vt,vt+at),new u8(ut))}else o[pt]=slc(h,vt,vt+at)}return o}class ZipLoader extends three_module.Y9S{load(o,c,d,_){return this.setResponseType("arraybuffer"),super.load(o,b=>{const _e=unzipSync(new Uint8Array(b)),it=new Map(Object.entries(_e).map(([nt,at])=>[nt,new File([at],nt)]));c==null||c(it)},d,_)}}class SVGTextureLoader extends three_module.aHM{constructor(o){super(o)}load(o,c,d,_){const b=SVGTextureLoader.USE_CANVAS_TEXTURE?document.createElement("canvas"):void 0,_e=SVGTextureLoader.USE_CANVAS_TEXTURE?new three_module.GOR(b):new three_module.gPd,it=new three_module.$NF(this.manager);return it.setCrossOrigin(this.crossOrigin),it.setPath(this.path),it.load(o,function(nt){b?SVGTextureLoader.CopyImageToCanvas(b,nt):_e.image=nt,_e.needsUpdate=!0,c!==void 0&&c(_e)},d,_),_e}static CopyImageToCanvas(o,c){o.width=c.naturalWidth||c.width||512,o.height=c.naturalHeight||c.height||512;const d=o.getContext("2d");d?(d.clearRect(0,0,o.width,o.height),d.drawImage(c,0,0,o.width,o.height)):console.error("SVGTextureLoader: Failed to get canvas context.")}}SVGTextureLoader.USE_CANVAS_TEXTURE=rt("svg-load-disable-canvas")!=="true";class AssetImporter extends I$2{get cachedAssets(){return this._cachedAssets}get processors(){return this._processors}get loadingManager(){return this._loadingManager}constructor(o,c=!1){super(),this._processors=new ObjectProcessorMap,this._logger=console.log,this.Importers=[new Importer(SimpleJSONLoader,["json"],!1),new Importer(three_module.Y9S,["txt"],!1),new Importer(RGBEPNGLoader,["rgbe.png","hdr.png","hdrpng"],!1),new Importer(SVGTextureLoader,["svg","data:image/svg"],!1),new Importer(three_module.Tap,["webp","png","jpeg","jpg","data:image"],!1),new Importer(LUTCubeLoader2,["cube"],!1),new Importer(ZipLoader,["zip"],!0)],this._loaderCache=[],this._fileDatabase=new Map,this._cachedAssets=[],c||(this._logger=()=>{}),this._viewer=o,this._onLoad=this._onLoad.bind(this),this._onProgress=this._onProgress.bind(this),this._onError=this._onError.bind(this),this._onStart=this._onStart.bind(this),this._urlModifier=this._urlModifier.bind(this),this._loadingManager=new three_module.KPJ(this._onLoad,this._onProgress,this._onError),this._loadingManager.onStart=this._onStart,this._loadingManager.setURLModifier(this._urlModifier),this.Importers.push(addRGBELoader(o)),this.Importers.push(addGLTFLoader(o)),this.Importers.push(addDracoLoader())}_onLoad(){this.dispatchEvent({type:"onLoad"})}_onProgress(o,c,d){this.dispatchEvent({type:"onProgress",url:o,loaded:c,total:d})}_onError(o){this.dispatchEvent({type:"onError",url:o})}_onStart(o,c,d){this.dispatchEvent({type:"onStart",url:o,loaded:c,total:d})}_urlModifier(o){var c;let d=decodeURI(o);const _=(c=this._rootContext)===null||c===void 0?void 0:c.rootUrl;d.includes("://")||!_||d.startsWith(_)||(d=_+d),d=d.replace("./",""),d=d.replace(/^(\/\/)/,"/"),d=d.replace(/\?.*$/,"");const b=this._fileDatabase.get(d);return b?b.ext?(b.objectUrl||(b.objectUrl=URL.createObjectURL(b)+"#"+d),b.objectUrl):(console.error("Unable to determine file extension",b),o):o}_createLoader(o){const c=this._getImporter(o),d=c==null?void 0:c.ctor(this);return d&&(c==null||c.ext.forEach(_=>{const b=new RegExp(_.startsWith("data:")?"^"+_+"\\/":"\\."+_+"$","i");this._loadingManager.addHandler(b,d)})),d&&(this._loaderCache.push({loader:d,files:[]}),this.dispatchEvent({type:"loaderCreate",loader:d})),d}addEventListener(o,c){if(super.addEventListener(o,c),o==="loaderCreate")for(const d of this._loaderCache)this.dispatchEvent({type:"loaderCreate",loader:d.loader})}async importFiles(o,c={}){const d=new Map;let{allowedExtensions:_}=c;if(_&&_.length<1&&(_=void 0),o.size===0)return d;this.dispatchEvent({type:"importFiles",files:Object.keys(o),state:"start"});const b=[],_e=[];if(o.forEach((it,nt)=>{var at;this.registerFile(nt,it);const ut=it.ext;ut&&((at=_==null?void 0:_.includes(ut.toLowerCase()))===null||at===void 0||at)&&(this._isRootFileExtension(ut)?b.push(nt):_e.push(nt))}),b.length>0)for(const it of b){let nt=await this._importFile(it,void 0,c);nt&&(nt=await this.processImported(nt,c)),d.set(it,nt)}else for(const it of _e){let nt=await this._importFile(it,void 0,c);nt&&(nt=await this.processImported(nt,c)),d.set(it,nt)}return this.dispatchEvent({type:"importFiles",files:Object.keys(o),state:"end"}),o.forEach((it,nt)=>{this.unregisterFile(nt)}),d}registerFile(o,c){var d,_,b;o=o.replace(/\?.*$/,"");const _e=(d=c==null?void 0:c.ext)!==null&&d!==void 0?d:(b=ae$1((_=c==null?void 0:c.name)!==null&&_!==void 0?_:o.trim()))===null||b===void 0?void 0:b.toLowerCase();c&&(c.ext||(c.ext=_e),this._fileDatabase.set(o,c));let it=this._getLoader(o);if(it||(it=this._createLoader(c??{name:o,ext:_e})),it){for(const nt of this._loaderCache)if(nt.loader===it){nt.files.push(o);break}}return it}unregisterFile(o){o=o.replace(/\?.*$/,"");const c=this._fileDatabase.get(o);c!=null&&c.objectUrl&&(URL.revokeObjectURL(c.objectUrl),c.objectUrl=void 0),c&&this._fileDatabase.delete(o)}_isRootFileExtension(o){return this.Importers.find(c=>c.root&&c.ext.includes(o.toLowerCase()))!=null}resolveURL(o){return this._loadingManager.resolveURL(o)}async _importFile(o,c,d={},_){var b,_e;if(c!=null&&c.__imported)return c.__imported;let it;this.dispatchEvent({type:"importFile",path:o,state:"downloading",progress:0});try{this.registerFile(o,c);const nt=this.resolveURL(o),at=o.replace(/\?.*$/,"").trim(),ut=(b=d.fileHandler)!==null&&b!==void 0?b:await this._loadingManager.getHandler(at)||(c?await this._loadingManager.getHandler(c.name||c.ext||""):void 0);if(!ut)throw new Error("AssetImporter: Unable to find loader for "+o);this._rootContext={path:o,url:nt,rootUrl:three_module.r6x.extractUrlBase(o),baseUrl:three_module.r6x.extractUrlBase(nt)},it=await ut.loadAsync(o+(d.queryString?(o.includes("?")?"&":"?")+d.queryString:""),pt=>{_&&_(pt),this.dispatchEvent({type:"importFile",path:o,state:"downloading",loadedBytes:pt.loaded||void 0,totalBytes:pt.total||void 0,progress:pt.total>0?pt.loaded/pt.total:1})}),ut.transform&&(it=await ut.transform(it,d)),this._rootContext=void 0,this.dispatchEvent({type:"importFile",path:o,state:"downloading",progress:1}),this.dispatchEvent({type:"importFile",path:o,state:"adding"}),c?this._logger("AssetImporter: loaded",o):this._logger("AssetImporter: downloaded",o),c&&this.unregisterFile(o)}catch(nt){return console.error("AssetImporter: Unable to import file",o,c),console.error(nt),console.error(nt==null?void 0:nt.stack),this.dispatchEvent({type:"importFile",path:o,state:"error",error:nt}),c&&this.unregisterFile(o),[]}if(this.dispatchEvent({type:"importFile",path:o,state:"done"}),c&&it){c.__imported=it;let nt=[];Array.isArray(it)?nt=it:!((_e=it.userData)===null||_e===void 0)&&_e.rootSceneModelRoot?nt.push(...it.children):nt.push(it),nt.forEach(at=>{at.addEventListener&&at.addEventListener("dispose",()=>{c.__imported=void 0})})}if(it&&typeof it=="object"){it.__rootPath=o;const nt=c||this._fileDatabase.get(o);nt&&(it.__rootBlob=nt)}return it}_getImporter(o,c=!1){return this.Importers.find(d=>{if(c&&!d.root)return!1;const _=d.ext.find(b=>{var _e,it,nt;return o.ext&&b===o.ext.toLowerCase()||((it=(_e=o.name)===null||_e===void 0?void 0:_e.toLowerCase())===null||it===void 0?void 0:it.endsWith("."+b.toLowerCase()))||(b==null?void 0:b.startsWith("data:"))&&((nt=o.name)===null||nt===void 0?void 0:nt.startsWith(b))});return!!_&&(o.ext=_,!0)})}_getLoader(o){var c;return(c=this._loadingManager.getHandler(o.trim()))!==null&&c!==void 0?c:void 0}async importAsset(o,c={},d){var _,b,_e;if(!o)return[];if(!this._cachedAssets.includes(o)){if(Object.entries(o).length===1&&o.path){const ut=this._cachedAssets.find(pt=>pt.path===o.path);ut&&Object.assign(o,ut)}const at=this._cachedAssets.findIndex(ut=>ut.path===o.path);at>=0&&this._cachedAssets.splice(at,1),this._cachedAssets.push(o)}let it;if(o!=null&&o.preImported&&(it=await o.preImported),!c.forceImport&&it){const at=await this.processImported(it,c);let ut=!1;for(const pt of at){if(!((_=pt.userData)===null||_===void 0)&&_.rootSceneModelRoot&&[...pt.children,...pt.__processedChildren||[]].find(mt=>mt.__disposed)){ut=!0;break}if(pt.__disposed){ut=!0;break}}if(!ut||c.reimportDisposed===!1)return at}const nt=c.pathOverride||o.path;if(o.preImported=this._importFile(nt,typeof((b=o.file)===null||b===void 0?void 0:b.arrayBuffer)=="function"?o.file:void 0,c,d),it=await o.preImported,it&&(this.dispatchEvent({type:"processFileStart",path:nt,result:it}),it=await this.processImported(it,c),this.dispatchEvent({type:"processFileEnd",path:nt,result:it})),it){const at=[];Array.isArray(it)?at.push(...it):!((_e=it.userData)===null||_e===void 0)&&_e.rootSceneModelRoot?at.push(...it.children):at.push(it),at.forEach(ut=>{var pt;return(pt=ut.addEventListener)===null||pt===void 0?void 0:pt.call(ut,"dispose",()=>{o!=null&&o.preImported&&(o.preImported=void 0)})})}return it}async importSingle(o,c={}){var d;return typeof o=="string"?await this.importSinglePath(o,c):(d=await this.importAsset(o,c))===null||d===void 0?void 0:d[0]}async importSinglePath(o,c){var d;return(d=await this.importPath(o,c))===null||d===void 0?void 0:d[0]}async importPath(o,c={}){const d={...c};delete d.pathOverride,delete d.forceImport,delete d.reimportDisposed,delete d.fileHandler,delete d.importedFile;const _=JSON.stringify(d),b=this._cachedAssets.find(it=>it.path===o&&it._options===_);let _e;return _e=b||{path:o},_e._options=_,c.importedFile&&(_e.file=c.importedFile),await this.importAsset(_e,c)}async processImportedSingle(o,c={}){return(await this.processImported(o,c))[0]}async processImported(o,c={}){var d,_,b,_e,it,nt,at,ut;let pt=o;if(!pt)return[];if(c.processImported===!1)return[pt];if(Array.isArray(pt)){const vt=[];for(const xt of pt)vt.push(...await this.processImported(xt,c));return vt}if(!((d=pt.userData)===null||d===void 0)&&d.rootSceneModelRoot){if(c._rootSceneImported=!0,pt.__processedChildren&&!c.forceImporterReprocess)return pt.__processedChildren;if(!(pt.children.length<1))return pt.animations&&(pt.children[0].animations||(pt.children[0].animations=[]),pt.children[0].animations.push(...pt.animations)),pt.__importedViewerConfig&&(pt.children[0].__importedViewerConfig=pt.__importedViewerConfig),pt.userData.__importData&&(pt.children[0].userData.__importData=pt.userData.__importData),pt.__processedChildren=await this.processImported([...pt.children],c),pt.__processedChildren;if(((_=pt.animations)===null||_===void 0?void 0:_.length)>0&&console.error("AssetImporter: animations in empty scene not supported yet. animations will be ignored",pt.animations),!pt.__importedViewerConfig)return[];pt=pt.__importedViewerConfig}if(!((b=pt.userData)===null||b===void 0)&&b.iModel&&(pt=pt.userData.iModel),!((_e=pt.userData)===null||_e===void 0)&&_e.iMaterial&&(pt=pt.userData.iMaterial),pt.assetImporterProcessed&&!c.forceImporterReprocess)return[pt];const mt=pt.__rootPath,ft=pt.__rootBlob;if(!pt.assetType){if(pt.isBufferGeometry&&(pt=new three_module.eaF(pt,new three_module._4j)),pt.isObject3D)if(pt.isLight)pt=upgradeThreejsLight(pt);else{const vt=[];pt.traverse(xt=>{xt!==pt&&xt.isLight&&vt.push(xt)});for(const xt of vt)upgradeThreejsLight(xt);pt=new Object3DModel(pt,c)}pt.isTexture&&(pt.assetType="texture",c._testDataTextureComplete&&(pt.isDataTexture&&!((it=pt.image)===null||it===void 0)&&it.data&&(pt.image.complete=!0),!((nt=pt.image)===null||nt===void 0)&&nt.complete&&(pt.needsUpdate=!0)),c.generateMipmaps!==void 0&&(pt.generateMipmaps=c.generateMipmaps),pt.generateMipmaps||pt.isRenderTargetTexture||(pt.minFilter=pt.minFilter===three_module.$_I?three_module.k6q:pt.minFilter,pt.magFilter=pt.magFilter===three_module.$_I?three_module.k6q:pt.magFilter)),pt.isMaterial&&(pt.assetType="material")}if(pt.assetType!=null)return pt.userData&&(pt.userData.rootPath||!mt||mt.startsWith("blob:")||mt.startsWith("/")||(pt.userData.rootPath=mt),ft&&(pt.userData.__sourceBlob=ft,pt.userData.__needsSourceBuffer&&(pt.userData.__sourceBuffer=await ft.arrayBuffer(),delete pt.userData.__needsSourceBuffer))),pt=await this._processors.process(pt.assetType,pt,{}),pt.assetImporterProcessed=!0,[pt];if(pt instanceof Map)return[...(await this.importFiles(pt,c)).values()].flat();if(pt.type&&pt.type!=="ViewerApp"&&pt.type!=="ThreeViewer"){const vt=this._viewer.getPluginByType(pt.type);if(vt){let xt=pt._importedResources||{};return pt.resources&&(xt=await((at=this._viewer.getManager())===null||at===void 0?void 0:at.importConfigResources(pt.resources)),delete pt.resources,pt._importedResources=xt),typeof vt.fromJSON=="function"&&(await Promise.resolve(vt.fromJSON(pt,xt)),pt.assetImporterProcessed=!1),[]}}return pt.plugins||pt.type==="ViewerApp"||pt.type==="ThreeViewer"?(pt.resources=await((ut=this._viewer.getManager())===null||ut===void 0?void 0:ut.importConfigResources(pt.resources)),await this._viewer.getManager().importViewerConfig(pt),pt.assetImporterProcessed=!1,[]):(console.warn("WebGi AssetImporter: unknown/null asset type: ",pt,pt.plugins),[pt])}dispose(){var o;this.clearCache(),(o=this._processors)===null||o===void 0||o.dispose()}clearLoaderCache(){this._loaderCache.forEach(o=>{o.loader.dispose&&o.loader.dispose()}),this._loaderCache=[]}clearCache(){this.clearLoaderCache(),this._cachedAssets=[]}}function getTextureDataType(h){if(!h)return three_module.OUM;const o=h.extensions.has("EXT_color_buffer_half_float")||h.capabilities.isWebGL2&&h.extensions.has("EXT_color_buffer_float"),c=h.capabilities.isWebGL2||h.extensions.has("OES_texture_float")||h.extensions.has("WEBGL_color_buffer_float");return o?three_module.ix0:c?three_module.RQf:three_module.OUM}function upgradeThreejsLight(h){var o,c;if(!h.isLight||h.assetType==="light")return h;if(h.uiConfig)return console.warn("ui config already exists, not supported",h),h;let d;if(h.children.length,h.isDirectionalLight&&(d=new DirectionalLight2),h.isAmbientLight&&(d=new AmbientLight2),h.isSpotLight&&(d=new SpotLight2),h.isPointLight&&(d=new PointLight2),d){(c=(o=d.lightObject).copy)===null||c===void 0||c.call(o,h);const _=h.parent;_!=null&&_.isObject3D&&(_.remove(h),h.dispose(),h.userData.iModel=d,_.add(d.lightObject),d.uuid=h.uuid),setupIModel(d.lightObject,_)}else console.warn("unknown light type: ",h);return d}AssetImporter.WHITE_IMAGE_DATA=new ImageData(new Uint8ClampedArray([255,255,255,255]),1,1);class ThreeMaterialLoader extends three_module.jut{constructor(o){super(o)}async loadAsync(o,c){var d,_;const b=new three_module.Y9S(this.manager);b.setPath(this.path),b.setRequestHeader(this.requestHeader),b.setWithCredentials(this.withCredentials);const _e=await b.loadAsync(o,c);try{const it=JSON.parse(_e);if(this.importer){const nt={};let at=(d=it.images)!==null&&d!==void 0?d:[];Array.isArray(at)||(at=Object.values(at));for(const ut of at){if(!ut.url||!ut.uuid)continue;const pt=(_=await this.importer.importPath(ut.url,{processImported:!1}))===null||_===void 0?void 0:_[0],mt=pt==null?void 0:pt.source;if(!pt||!mt)continue;const ft=new three_module.kLi(mt.data);ft.uuid=ut.uuid,nt[ft.uuid]=ft,pt.dispose()}return await ObjectLoader2.LoadRootPathTextures(it.textures,nt,this.importer),this.parse(it,nt)}return this.parse(it)}catch(it){throw console.error(it),this.manager.itemError(o),it}}parse(o,c){var d,_;let b;const _e={p:new Promise(ut=>{b=ut})};if(o.images||o.textures){const ut=new ObjectLoader2(this.manager);let pt={};const mt=At=>{b(),_e.p=void 0,Object.values(pt).forEach(Ct=>{var Et;Ct.isTexture&&!((Et=Ct.image)===null||Et===void 0)&&Et.complete&&(Ct.needsUpdate=!0)})};let ft=o.images||[];Array.isArray(ft)||(ft=Object.values(ft));const vt=c||ut.parseImages(ft,mt);let xt=o.textures;Array.isArray(xt)||(xt=Object.values(xt)),pt=ut.parseTextures2(xt,vt,mt),this.setTextures(pt)}this.materials||console.warn("A Material Manager is not set to import three materials, trying standard materials");const it={...o};if(Object.entries(it).forEach(([ut,pt])=>{pt&&typeof pt=="string"&&this.textures[pt]&&(it[ut]=this.textures[pt])}),o.vertexColors!==void 0&&(typeof o.vertexColors=="number"?it.vertexColors=o.vertexColors>0:it.vertexColors=o.vertexColors),o.normalScale!==void 0){const ut=o.normalScale;Array.isArray(ut)===!1&&(it.normalScale=[ut,ut])}let nt=o.type;nt!=="MeshPhysicalMaterial"&&nt!=="MeshStandardMaterial"&&nt!=="PhysicalMaterial"||(nt=MeshStandardMaterial2.TYPE),it.userData=deserializeObject(it.userData,void 0,!1,this);const at=(_=(d=this.materials)===null||d===void 0?void 0:d.generateFromTemplateType(nt,it))!==null&&_!==void 0?_:super.parse(o);return this.setTextures({}),at.userData.imageLoadAwaiter=_e,at}}class AssetManagerPlugin extends I$2{constructor(o,c,{simpleCache:d=!1,storage:_}={}){if(super(),this._sceneUpdated=this._sceneUpdated.bind(this),this.addAsset=this.addAsset.bind(this),this.addProcessedAssets=this.addProcessedAssets.bind(this),this.addImported=this.addImported.bind(this),(d||_)&&(d&&(three_module.l2R.enabled=!0),_&&window.Cache&&typeof window.Cache=="function"&&_ instanceof window.Cache)){const b={...three_module.l2R};three_module.l2R.get=(_e,it,nt)=>it?_e.startsWith("data:")||_e.startsWith("blob")||_e.startsWith("chrome-extension")?Promise.resolve(void 0):_.match(_e).then(at=>{if(at)switch(it){case"arraybuffer":return at.arrayBuffer();case"blob":return at.blob();case"document":return at.text().then(ut=>new DOMParser().parseFromString(ut,nt??"text/html"));case"json":return at.json();default:if(nt===void 0)return at.text();{const ut=/charset="?([^;"\s]*)"?/i.exec(nt),pt=ut&&ut[1]?ut[1].toLowerCase():void 0,mt=new TextDecoder(pt);return at.arrayBuffer().then(ft=>mt.decode(ft))}}}):b.get(_e),three_module.l2R.add=async(_e,it,nt)=>{if(!nt)return b.add(_e,it);_e.startsWith("data:")||_e.startsWith("blob")||_e.startsWith("chrome-extension")||(await _.match(_e)&&await _.delete(_e),await _.put(_e,new Response(it,{status:200})))},three_module.l2R.remove=(_e,it)=>{if(!it)return b.remove(_e);_.delete(_e)}}this.storage=_,this._importer=o,this._materials=c}async addAsset(o,c={}){if(!this._importer||!this._viewer)return[];const d=await this._importer.importAsset(o,c);return d?(this.addProcessedAssets(d,c),d):(console.warn("WebGi AssetManager: Unable to import",o,d),[])}async addFromPath(o,c={}){if(!this._importer||!this._viewer)return[];const d=await this._importer.importPath(o,c);return d?(this.addProcessedAssets(d,c),d):(o&&!o.split("?")[0].endsWith(".vjson")&&console.warn("WebGi AssetManager: Unable to import",o,d),[])}addProcessedAssets(o,c){return o.map(d=>{var _;return(_=this._viewer)===null||_===void 0?void 0:_.scene.addSceneObject(d,{...c,allImported:o})})}async addAssetSingle(o,c={}){var d;return o?(d=await(typeof o=="string"?this.addFromPath:this.addAsset).call(this,o,c))===null||d===void 0?void 0:d[0]:void 0}async addImported(o,c={}){var d;return(d=this._importer)===null||d===void 0?void 0:d.processImported(o,c).then(_=>(this.addProcessedAssets(_,c),_))}async addImportedSingle(o,c={}){return this.addImported(o,c).then(d=>d==null?void 0:d[0])}_sceneUpdated(o){var c;if(o.type==="addSceneObject"){const d=o.object;d.assetType==="material"&&((c=this._materials)===null||c===void 0||c.processMaterial(d,{}))}else console.error("Unexpected")}onAdded(o){this._viewer=o,this._materials||(this._materials=new MaterialManager,this._viewer.scene.addEventListener("addSceneObject",this._sceneUpdated)),this._importer||(this._importer=new AssetImporter(o,!!o.getPluginByType("debug")),this._importer.processors.add("model",{forAssetType:"model",process:(d,_)=>(setupObject3dModel(d,b=>{var _e;return(_e=this._materials)===null||_e===void 0?void 0:_e.processModel(b,{recursive:!1})}),d)}),this._importer.processors.add("model",{forAssetType:"model",process:this._materials.processModel}),this._importer.processors.add("material",{forAssetType:"material",process:(d,_)=>{var b;return!((b=this.materials)===null||b===void 0)&&b.findMaterial(d.uuid)&&(console.warn("WebGi AssetManager: Material with same UUID already exists, creating new UUID"),d.uuid=three_module.cj9.generateUUID(),d.userData.uuid&&(d.userData.uuid=d.uuid)),this._materials.processMaterial(d,_)}})),this._importer.Importers.push(new Importer(ThreeMaterialLoader,[MeshStandardMaterial2.TypeSlug],!1,d=>(d&&(d.materials=this._materials),d&&(d.importer=this._importer),d)));const c=this.importViewerConfig.bind(this);this._importer.Importers.push(new Importer(class extends SimpleJSONLoader{async loadAsync(d,_){return c(await super.loadAsync(d,_))}},[AssetManagerPlugin.ViewerTypeSlug],!0))}onRemove(o){var c,d;o===this._viewer&&((c=this._importer)===null||c===void 0||c.dispose(),this._importer=void 0,this._viewer.scene.removeEventListener("addSceneObject",this._sceneUpdated),(d=this._materials)===null||d===void 0||d.dispose(),this._materials=void 0)}get importer(){return this._importer}get exporter(){var o,c;return(c=(o=this._viewer)===null||o===void 0?void 0:o.getPluginByType("AssetExporterPlugin"))===null||c===void 0?void 0:c.exporter}get materials(){return this._materials}exportViewerConfig(o=!0,c){if(!this._viewer)return{};const d={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},extras:{},...c},_=this._viewer.toJSON(d);return o||Object.values(d).forEach(b=>{b&&Object.values(b).forEach(_e=>{_e.url&&(_e.url.data instanceof ArrayBuffer||Array.isArray(_e.url.data))&&(_e.url.type==="Uint16Array"?(_e.url.data instanceof Uint16Array||(_e.url.data=new Uint16Array(_e.url.data)),_e.url.data="data:application/octet-stream;base64,"+ie$1(_e.url.data.buffer)):_e.url.type==="Uint8Array"?(_e.url.data instanceof Uint8Array||(_e.url.data=new Uint8Array(_e.url.data)),_e.url.data="data:application/octet-stream;base64,"+ie$1(_e.url.data.buffer)):_e.url.data instanceof ArrayBuffer?_e.url.data="data:application/octet-stream;base64,"+ie$1(_e.url.data.buffer):console.warn("Unsupported buffer type",_e.url.type))})}),_.resources=d,_}exportPluginPresets(o){var c;const d={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},extras:{}};return{plugins:(c=this._viewer)===null||c===void 0?void 0:c.serializePlugins(d,o),resources:d}}exportPluginPreset(o){if(!o.toJSON)return;const c={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},extras:{}},d=o.toJSON(c);return d.resources=c,d}async importPluginPreset(o,c){var d;const _=o.type;if(!(c=c||((d=this._viewer)===null||d===void 0?void 0:d.getPluginByType(_))))return void console.warn(`WebGi: No plugin found for type ${_} to import preset`);if(!c.fromJSON)return void console.warn(`WebGi: Plugin ${_} does not support importing presets`);const b=o.resources||{};o.resources&&delete o.resources;const _e=await this.importConfigResources(b);return await c.fromJSON(o,_e),_e&&(o.resources=_e),c}async importViewerConfig(o,c){if(!this._viewer||!this._importer)return void console.warn("WebGi: No viewer or importer");const d=await this.importConfigResources(o.resources||{},c);this.applyViewerConfig(o,d)}applyViewerConfig(o,c){var d;if(this._viewer&&this._importer)if((c=c||o.resources).__isLoadedResources){this._viewer.fromJSON(o,c);for(const _ of Object.values(c.materials))_.__useCount?delete _.__useCount:(d=this._materials)===null||d===void 0||d.unregisterMaterial(_);for(const _ of Object.values(c.textures))_.__useCount&&delete _.__useCount}else console.error("Cannot load viewer config: resources not loaded",o);else console.warn("WebGi: No viewer or importer")}async importConfigResources(o,c,d){var _,b,_e;if(!this._importer)throw"Importer not initialized yet.";if(o.__isLoadedResources)return o;const it={};Object.values(o).forEach(at=>{at&&Object.values(at).forEach(ut=>{if(!ut||!ut.url||typeof ut.url.data!="string")return;const pt=ut.url.data.match(/^data:.*;base64,(.*)$/);pt!=null&&pt[1]?ut.url.data=re$1(pt==null?void 0:pt[1]):(ut.url.type!=="Uint8Array"&&console.error("Unsupported buffer type string for ",ut.url.type,"use base64"),ut.url.data=new TextEncoder().encode(ut.url.data).buffer)})}),c=c??new ObjectLoader2(this._importer.loadingManager),it.animations=o.animations?c.parseAnimations(o.animations):{},d&&d.animations&&(it.animations={...it.animations,...d.animations}),it.shapes=o.shapes?c.parseShapes(o.shapes):{},d&&d.shapes&&(it.shapes={...it.shapes,...d.shapes}),it.geometries=o.geometries?c.parseGeometries(o.geometries,it.shapes):{},d&&d.geometries&&(it.geometries={...it.geometries,...d.geometries}),it.images=o.images?await c.parseImagesAsync(Object.values(o.images)):{},d&&d.images&&(it.images={...it.images,...d.images}),await ObjectLoader2.LoadRootPathTextures(o.textures,it.images,this._importer),it.textures=o.textures?c.parseTextures2(Object.values(o.textures),it.images,()=>{Object.values(it.textures).forEach(at=>{var ut;at.isTexture&&!((ut=at.image)===null||ut===void 0)&&ut.complete&&(at.needsUpdate=!0)})}):{};for(const at of Object.entries(it.textures))at[1]=(_=await this._importer.processImported(at[1],{}))===null||_===void 0?void 0:_[0],at[1]?it.textures[at[0]]=at[1]:delete it.textures[at[0]];d&&d.textures&&(it.textures={...it.textures,...d.textures});const nt=o.materials?Object.values(o.materials):[];for(const at of nt)Object.entries(at).forEach(([ut,pt])=>{pt&&pt.resource&&pt.uuid&&pt.resource==="textures"&&(at[ut]=pt.uuid)});if(it.materials=c.parseMaterials2(nt,it.textures,this._materials),d&&d.materials&&(it.materials={...it.materials,...d.materials}),o.object&&(it.object=c.parseObject(o.object,it.geometries,it.materials,it.textures,it.animations),o.skeletons&&(it.skeletons=c.parseSkeletons(o.skeletons,it.object),c.bindSkeletons(it.object,it.skeletons))),o.extras){it.extras=o.extras;for(const at of Object.values(o.extras))if(at.uuid&&at.url)if(typeof at.url=="string"){const ut=await((b=this._importer)===null||b===void 0?void 0:b.importPath(at.url));(ut==null?void 0:ut.length)>0&&(it.extras[at.uuid]=ut[0])}else if(at.url.data){const ut=new File([se$1(at.url.type,at.url.data)],at.url.path),pt=await((_e=this._importer)===null||_e===void 0?void 0:_e.importAsset({path:ut.name,file:ut}));(pt==null?void 0:pt.length)>0&&(it.extras[at.uuid]=pt[0])}else console.warn("WebGi: invalid URL type while loading extra resource")}return d&&d.extras&&(it.extras={...it.extras,...d.extras}),it.__isLoadedResources=!0,it}}AssetManagerPlugin.PluginType="AssetManager",AssetManagerPlugin.ViewerTypeSlug="vjson";const VIEWER_VERSION="0.11.1";class Dropzone{get inputEl(){return this._inputEl}get el(){return this._el}constructor(o,c,d){this._el=o,this._inputEl=c,this._listeners={drop:[],dropstart:[],droperror:[]},this._onDragover=this._onDragover.bind(this),this._onDrop=this._onDrop.bind(this),this._onSelect=this._onSelect.bind(this),o==null||o.addEventListener("dragover",this._onDragover,!1),o==null||o.addEventListener("drop",this._onDrop,!1),c==null||c.addEventListener("change",this._onSelect),d&&Object.entries(d).forEach(([_,b])=>b&&this.on(_,b))}on(o,c){return this._listeners[o].push(c),this}_emit(o,c){return this._listeners[o].forEach(d=>d(c)),this}destroy(){const o=this._el,c=this._inputEl;o==null||o.removeEventListener("dragover",this._onDragover),o==null||o.removeEventListener("drop",this._onDrop),c==null||c.removeEventListener("change",this._onSelect)}_onDrop(o){var c,d;o.stopPropagation(),o.preventDefault(),this._emit("dropstart");const _=Array.from(((c=o.dataTransfer)===null||c===void 0?void 0:c.files)||[]),b=Array.from(((d=o.dataTransfer)===null||d===void 0?void 0:d.items)||[]);if(_.length!==0||b.length!==0)if(b.length>0){const _e=b.map(it=>it.webkitGetAsEntry());this._loadNextEntry(new Map,_e)}else this._emit("drop",{files:new Map(_.map(_e=>(_e.filePath=_e.name,[_e.filePath,_e])))});else this._fail("Required drag-and-drop APIs are not supported in this browser.")}_onDragover(o){o.stopPropagation(),o.preventDefault(),o.dataTransfer&&(o.dataTransfer.dropEffect="copy")}_onSelect(o){var c;if(!this._inputEl)return void console.warn("Invalid Dropzone event ",o);this._emit("dropstart");const d=[].slice.call((c=this._inputEl.files)!==null&&c!==void 0?c:new FileList),_=new Map;d.forEach(b=>{b.filePath=b.webkitRelativePath||b.name,_.set(b.filePath,b)}),this._emit("drop",{files:_})}_loadNextEntry(o,c){const d=c.pop();if(d)if(d.isFile)d.file(_=>{_.filePath=d.fullPath,o.set(d.fullPath,_),this._loadNextEntry(o,c)},()=>console.error("Could not load file: %s",d.fullPath));else if(d.isDirectory){const _=d.createReader(),b=_e=>{_e.length?(c=c.concat(_e),_.readEntries(b)):this._loadNextEntry(o,c)};_.readEntries(b)}else console.warn("Unknown asset type: "+d.fullPath),this._loadNextEntry(o,c);else this._emit("drop",{files:o})}_fail(o){this._emit("droperror",{message:o})}}class DropzonePlugin extends I$2{constructor(o){super(),this._domElement=o,this._allowedExtensions=void 0,this.importerParams={autoScale:!0,autoScaleRadius:2,pseudoCenter:!1,autoCenter:!0,autoImport:!0,autoAdd:!0,centerOffset:new three_module.Pq0(.5,.5,3)},this.dependencies=[AssetManagerPlugin],this.uiConfig={type:"folder",label:"Drop Options",expanded:!0,children:[{label:"Auto Center",type:"checkbox",property:[this.importerParams,"autoCenter"],limitedUi:!0},{label:"Auto Scale",type:"checkbox",property:[this.importerParams,"autoScale"],limitedUi:!0},{label:"Auto scale radius",type:"slider",bounds:[.5,100],property:[this.importerParams,"autoScaleRadius"]},{label:"Select local file",type:"button",value:()=>this.promptForFile()}]}}onAdded(o){this._inputEl=document.createElement("input"),this._viewer=o,this._inputEl.type="file",this._dropzone=new Dropzone(this._domElement||o.canvas,this._inputEl,{drop:this._onFileDrop.bind(this)})}async _onFileDrop({files:o}){var c,d,_,b,_e,it;if(!o)return;const nt=this._viewer;if(!nt)return;if(this._allowedExtensions!==void 0)for(const pt of o.keys())this._allowedExtensions.includes((d=(c=pt.split(".").pop())===null||c===void 0?void 0:c.toLowerCase())!==null&&d!==void 0?d:"")||o.delete(pt);if(o.size<1)return;const at=nt.getPlugin(AssetManagerPlugin),ut={type:"drop",files:o};if(this.importerParams.autoImport){const pt={allowedExtensions:this.allowedExtensions,...this.importerParams};if(ut.imported=await((_=at.importer)===null||_===void 0?void 0:_.importFiles(o,pt)),this.importerParams.autoAdd){const mt=(it=[...(_e=(b=ut.imported)===null||b===void 0?void 0:b.values())!==null&&_e!==void 0?_e:[]].flat(2).filter(ft=>!!ft))!==null&&it!==void 0?it:[];if(ut.assets=at.addProcessedAssets(mt,{...this.importerParams}),!pt._rootSceneImported)for(const ft of ut.assets)ft.modelObject&&ft.modelObject.dispatchEvent({type:"select",value:ft.modelObject})}}this.dispatchEvent(ut)}promptForFile(){var o;(o=this._inputEl)===null||o===void 0||o.click()}onRemove(o){var c;(c=this._dropzone)===null||c===void 0||c.destroy(),this._dropzone=void 0,this._viewer=void 0}get allowedExtensions(){return this._allowedExtensions}set allowedExtensions(o){this._allowedExtensions=o,this._inputEl&&(this._inputEl.accept=o?o.map(c=>"."+c).join(", "):"")}}function legacySeparateMapSamplerUVFix(h,o){const c=(h.version?h.version:"0.0.0").split(".").map(_=>parseInt(_));if(h.type!=="ViewerApp"||c[0]!==0||!(c[1]<7||c[1]===7&&c[2].toString()[0]<"6"))return;const d=new Set;o.forEach(_=>_.traverse(b=>{b.material&&d.add(b.material)})),d.forEach(_=>{const b=_.map;if(!b)return;const _e=b.repeat,it=b.offset,nt=b.center,at=b.rotation;["alphaMap","aoMap","bumpMap","displacementMap","emissiveMap","lightMap","metalnessMap","normalMap","roughnessMap","transmissionMap"].forEach(ut=>{const pt=_[ut];pt&&(pt.repeat.copy(_e),pt.offset.copy(it),pt.center.copy(nt),pt.rotation=at,pt.needsUpdate=!0)}),_.needsUpdate=!0})}DropzonePlugin.PluginType="Dropzone";var ViewerApp_decorate=function(h,o,c,d){var _,b=arguments.length,_e=b<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_e=Reflect.decorate(h,o,c,d);else for(var it=h.length-1;it>=0;it--)(_=h[it])&&(_e=(b<3?_(_e):b>3?_(o,c,_e):_(o,c))||_e);return b>3&&_e&&Object.defineProperty(o,c,_e),_e};function getPluginType(h){return Object.getPrototypeOf(h).constructor.PluginType}class ViewerApp extends I$2{get useRgbm(){return this._useRgbm}get screenShader(){return this._screenShader}get useGBufferDepth(){return this._useGBufferDepth}get isAntialiased(){return this._isAntialiased}constructor({isAntialiased:o=!1,useRgbm:c=!0,useGBufferDepth:d=!1,screenShader:_="",maxHDRIntensity:b,..._e}){var it,nt;super(),this.console=console,this._state=ViewerState.None,this.plugins={},this._needsResize=!1,this.resizeObserver=window.ResizeObserver?new window.ResizeObserver(vt=>this.resize()):void 0,this._lastSize=new three_module.I9Y,this._onContextRestore=vt=>{this.enabled=!0,this._canvas.width=this._lastSize.width,this._canvas.height=this._lastSize.height,this.resize(),this.scene.setDirty({sceneUpdate:!0,frameFade:!1})},this._onContextLost=vt=>{this._lastSize.set(this._canvas.width,this._canvas.height),this._canvas.width=2,this._canvas.height=2,this.resize(),this.enabled=!1},this.resize=()=>{this._needsResize=!0,this.setDirty()},this._needsReset=!0,this.enabled=!0,this.renderEnabled=!0,this._isRenderingFrame=!1,this.maxFramePerLoop=1,this.rendersPerFrame=1,this._rawBackground=null,this._sceneEnvironmentChanged=()=>{this._rawBackground===envMapBackground&&this.scene.setBackground(this.scene.getEnvironment())},this._addSceneObject=vt=>{var xt,At;if(!vt||!vt.object||vt.options&&vt.options.importConfig===!1)return;const Ct=vt.object.__importedViewerConfig||((xt=vt.object.modelObject)===null||xt===void 0?void 0:xt.__importedViewerConfig);if(!Ct)return;const Et=this.getManager();legacySeparateMapSamplerUVFix(Ct,!((At=vt.options)===null||At===void 0)&&At.allImported?vt.options.allImported:[vt.object]),Et?Et.applyViewerConfig(Ct,Ct.resources):this.fromJSON(Ct,Ct.resources)},this.serializePluginsIgnored=[],this.alert=async vt=>alert(vt),this.confirm=async vt=>confirm(vt),this.prompt=async(vt,xt,At=!0)=>prompt(vt,xt),this._useRgbm=c,this._useGBufferDepth=d,this._screenShader=_,this._canvas=_e.canvas||j();let at=_e.container;if(at&&!_e.canvas&&at.appendChild(this._canvas),at||(at=(it=this._canvas.parentElement)!==null&&it!==void 0?it:void 0),!at)throw new Error("No container.");this._container=at,this._animationLoop=this._animationLoop.bind(this),this.setDirty=this.setDirty.bind(this),this._setActiveCameraView=this._setActiveCameraView.bind(this),window.webGiViewers||(window.webGiViewers=[]),window.webGiViewers.push(this),checkVersion();const ut=new CameraController(void 0,void 0,this._canvas);ut.autoLookAtTarget=!0,this.addEventListener("postFrame",()=>{var vt,xt;const At=mt.scene.activeCamera;if(At&&At.interactionsEnabled){const Ct=(vt=this.getPluginByType("Progressive"))===null||vt===void 0?void 0:vt.postFrameConvergedRecordingDelta();if(Ct!==void 0&&Ct===0)return;(xt=At.controls)===null||xt===void 0||xt.update()}}),this.scene=new RootScene(ut),this.scene.addEventListener("environmentChanged",this._sceneEnvironmentChanged),this.scene.addEventListener("addSceneObject",this._addSceneObject),this.scene.addEventListener("setView",this._setActiveCameraView),this.scene.addEventListener("activateMain",this._setActiveCameraView),this.scene.modelRoot.modelObject.scale.setScalar((nt=_e.modelRootScale)!==null&&nt!==void 0?nt:1),this._renderer=new BaseRenderer({canvas:this._canvas,animationLoop:this._animationLoop,targetOptions:{samples:o?4:0,colorSpace:c?RGBM16ColorSpace_:three_module.jf0,type:c?three_module.OUM:three_module.ix0,depthBuffer:!d,generateMipmaps:!!o,minFilter:o?three_module.NZq:three_module.k6q},maxHDRIntensity:b||(c?16:80)}),this._isAntialiased=o&&this._renderer.isWebGL2;let pt=!0;this._renderer.rendererObject.userData||(pt=!1,this._renderer.rendererObject.userData={}),this._renderer.rendererObject.userData.renderTransmissionPass=!pt;const mt=this;this.renderFilter={passId:"render",passObject:new RenderPass2(this,pt),update(){const vt=this.passObject;vt.scene=mt.scene.modelObject,vt.camera=mt.scene.renderCamera.cameraObject}};const ft={passId:"screen",after:["render"],required:["render"],passObject:buildScreenShader(_)};[this.renderFilter,ft].forEach(vt=>this._renderer.registerPass(vt)),this._renderer.pipeline=["render","screen"],this.scene.addEventListener("textureUpdate",vt=>this.setDirty(this.scene,vt)),this.scene.addEventListener("sceneMaterialUpdate",vt=>this.setDirty(this.scene,vt)),this.scene.addEventListener("sceneUpdate",vt=>{this.setDirty(this.scene,vt),vt.geometryChanged!==!1&&this.renderer.resetShadows()}),this.scene.addEventListener("update",vt=>this.setDirty(this.scene,vt)),this._renderer.addEventListener("update",vt=>this.setDirty(this._renderer,vt)),this.resizeObserver&&this.resizeObserver.observe(this._canvas),window&&window.addEventListener("resize",this.resize),this._canvas.addEventListener("webglcontextrestored",this._onContextRestore,!1),this._canvas.addEventListener("webglcontextlost",this._onContextLost,!1),this.renderer.addEventListener("resize",()=>{this.scene.activeCamera.refreshAspect()}),this.scene.setBackgroundColor("#202020"),_e.assetManager&&this.addPluginSync(new AssetManagerPlugin(void 0,void 0,typeof _e.assetManager=="boolean"?{}:_e.assetManager)),_e.dropzone&&this.addPluginSync(new DropzonePlugin),this.console.log("WebGi Viewer instance initialized, version: ",ViewerApp.VERSION)}setDirty(o,c){this._needsReset=!0,o=o??this,this.dispatchEvent({...c??{},type:"update",source:o})}get renderer(){return this._renderer}dispose(){var o;for(const c of[...Object.values(this.plugins)])this.removePlugin(c,!0);this.scene.dispose(),this.renderer.dispose(),this._canvas.removeEventListener("webglcontextrestored",this._onContextRestore,!1),this._canvas.removeEventListener("webglcontextlost",this._onContextLost,!1),(o=window.webGiViewers)===null||o===void 0||o.splice(window.webGiViewers.indexOf(this),1),this.resizeObserver?this.resizeObserver.unobserve(this._canvas):window.removeEventListener("resize",this.resize),this.dispatchEvent({type:"dispose"})}_renderEnabledChanged(){this.dispatchEvent({type:this.renderEnabled?"renderEnabled":"renderDisabled"})}_animationLoop({time:o,deltaTime:c,xrFrame:d}){var _,b;if(this.enabled&&this.renderEnabled)if(this._isRenderingFrame)this.console.warn("animation loop: frame skip");else{this._isRenderingFrame=!0;for(let _e=0;_e<this.maxFramePerLoop;_e++){if(this._needsReset&&(this._renderer.reset(),this._needsReset=!1),this._needsResize){const at=[this._canvas.clientWidth,this._canvas.clientHeight];if(d){const ut=(b=(_=this._renderer.rendererObject.xr.getCamera())===null||_===void 0?void 0:_.cameras[0])===null||b===void 0?void 0:b.viewport;ut?(ut.x===0&&ut.y===0||this.console.warn("x and y must be 0?"),at[0]=ut.width,at[1]=ut.height,this.console.log("resize for xr",at)):this._needsResize=!1}this._needsResize&&(this._renderer.setSize(...at),this._needsResize=!1)}this.dispatchEvent({type:"preFrame",target:this,time:o,deltaTime:c,xrFrame:d});const it=Object.values(this.plugins).filter(at=>at.dirty);it.length>0&&this.setDirty(it),this._needsReset&&(this._renderer.reset(),this._needsReset=!1),this._renderer.updateDirty();const nt=this._renderer.dirty;if(nt)for(let at=0;at<this.rendersPerFrame;at++){this.dispatchEvent({type:"preRender",target:this});try{this.scene.renderCamera=this.scene.activeCamera,this._renderer.render(this._renderer.defaultRenderToScreen)}catch(ut){this.console.error(ut),this.enabled=!1}this.dispatchEvent({type:"postRender",target:this})}if(this.dispatchEvent({type:"postFrame",target:this}),!nt)break}this._isRenderingFrame=!1}}get state(){return this._state}get container(){return this._canvas.parentElement!==this._container&&this.console.error("ViewerApp: Canvas is not in the container, this might cause issues with some plugins."),this._container}get canvas(){return this._canvas}get canvasTexture(){if(!this._canvas)throw new Error("Canvas not found");return this._canvasTexture||(this._canvasTexture=new three_module.GOR(this._canvas),this._canvasTexture.flipY=!1,this._canvasTexture.needsUpdate=!0),this._canvasTexture}getPlugin(o){return typeof o=="string"?this.getPluginByType(o):this.plugins[o.PluginType]}getPluginByType(o){return this.plugins[o]}async getOrAddPlugin(o,...c){return this.getPlugin(o)||this.addPlugin(o,...c)}getOrAddPluginSync(o,...c){return this.getPlugin(o)||this.addPluginSync(o,...c)}async addPlugin(o,...c){let d;if(o.prototype){const b=this.getPlugin(o);if(b)return console.error(`Plugin of type ${getPluginType(b)} already exists, no new plugin created`,b),b;d=new o(...c)}else d=o;const _=getPluginType(d);if(!_)return this.console.error("PluginType is not defined for",d),d;for(const b of d.dependencies||[])await this.getOrAddPlugin(b);return this.plugins[_]&&(this.console.error(`Plugin of type ${_} already exists, old plugin will be removed and disposed`,this.plugins[_],d),await this.removePlugin(this.plugins[_],!0)),this.plugins[_]=d,await d.onAdded(this),this.dispatchEvent({type:"addPlugin",target:this,plugin:d}),this.setDirty(d),d}addPluginSync(o,...c){let d;if(o.prototype){const b=this.getPlugin(o);if(b)return console.error(`Plugin of type ${getPluginType(b)} already exists, no new plugin created`,b),b;d=new o(...c)}else d=o;const _=getPluginType(d);if(!_)return this.console.error("PluginType is not defined for",d),d;for(const b of d.dependencies||[])this.getOrAddPluginSync(b);return this.plugins[_]&&(this.console.error(`Plugin of type ${_} already exists, old plugin will be removed and disposed`,this.plugins[_],d),this.removePluginSync(this.plugins[_],!0)),this.plugins[_]=d,d.onAdded(this),this.dispatchEvent({type:"addPlugin",target:this,plugin:d}),this.setDirty(d),d}async addPlugins(o){for(const c of o)await this.addPlugin(c)}async addPluginsSync(o){for(const c of o)this.addPluginSync(c)}async removePlugin(o,c=!0){const d=getPluginType(o);this.plugins[d]&&(await o.onRemove(this),delete this.plugins[d],c&&o.onDispose&&await o.onDispose(this),this.setDirty(o))}removePluginSync(o,c=!0){const d=getPluginType(o);this.plugins[d]&&(o.onRemove(this),delete this.plugins[d],c&&o.onDispose&&o.onDispose(this),this.setDirty(o))}createCamera(o){var c;const d=(c=o.userData.iCamera)!==null&&c!==void 0?c:new CameraController(o,{controlsMode:"",aspect:"auto"},this._canvas);return o.userData.autoLookAtTarget===void 0?(d.autoLookAtTarget=!1,o.userData.autoLookAtTarget=!1):d.autoLookAtTarget=o.userData.autoLookAtTarget,d}setSize(o){this._canvas.style.width=o!=null&&o.width?o.width+"px":"100%",this._canvas.style.height=o!=null&&o.height?o.height+"px":"100%",this._canvas.offsetHeight,this.resize()}async doOnce(o,c){return new Promise(d=>{const _=async(...b)=>{this.removeEventListener(o,_),d(await(c==null?void 0:c(...b)))};this.addEventListener(o,_)})}setBackgroundColor(o){return console.warn("viewer.setBackground is deprecated, use viewer.scene.setBackgroundColor instead."),this.setBackgroundColor(o)}setBackground(o){if(console.warn("viewer.setBackground is deprecated, use viewer.scene.setBackground instead."),this._rawBackground=o,o==null||typeof o!="string"&&typeof o!="number"&&!o.isColor)!o&&this.useRgbm&&this.console.error("Transparent background not supported with HDR RGBM rendering mode");else if(o===envMapBackground)return this.scene.setBackground("environment");!o||o!=null&&o.isTexture?(this.scene.setBackground(o),o||this.scene.setBackgroundColor(o)):this.scene.setBackgroundColor(o)}getBackground(o=!1){var c;if(console.warn("viewer.getBackground is deprecated, use viewer.scene.background instead."),o)return this._rawBackground;let d=(c=this._rawBackground)!==null&&c!==void 0?c:this.scene.getBackground();return d?(d!=null&&d.isVector4&&(d=cRGBMToLinear(d,7).getHexString()),d!=null&&d.isColor?d.getHexString():this._rawBackground===envMapBackground?this.scene.getEnvironment():d):null}getManager(){return this.getPluginByType("AssetManager")||this.addPluginSync(AssetManagerPlugin)}resetCamera({rootObject:o,centerOffset:c=new three_module.Pq0(1,1,1),targetOffset:d=new three_module.Pq0(0,0,0),..._}={}){if(this.scene.activeCamera){this.scene.matrixWorldNeedsUpdate=!0,this.scene.updateMatrixWorld(!0);const b=o?new Box3B().expandByObject(o,!0,!0):this.scene.getBounds(!0),_e=b.getCenter(new three_module.Pq0),it=.5*b.getSize(new three_module.Pq0).length();_e.add(d.clone().multiplyScalar(it)),this.scene.activeCamera.position=new three_module.Pq0(_e.x+c.x*it,_e.y+c.y*it,_e.z+c.z*it),this.scene.activeCamera.target=_e,this.setDirty()}}async fitToView(o,c=1.5,d,_){var b,_e;const it=this.getPluginByType("CameraViews");it?await(it==null?void 0:it.animateToFitObject(o,c,d,_,{min:((_e=(b=this.scene.activeCamera.getControls())===null||b===void 0?void 0:b.minDistance)!==null&&_e!==void 0?_e:.5)+.5,max:1e3})):this.console.error("CameraViews plugin is required for fitToView to work")}async createObject3D(o,c=!1){var d;return(d=this.getManager())===null||d===void 0?void 0:d.addImportedSingle(o||new three_module.B69,{autoScale:!1,pseudoCenter:!1,addToRoot:c})}createPhysicalMaterial(o){return this.createMaterial("standard",o)}createMaterial(o,c){var d,_,b,_e;if(c!=null&&c.isMaterial){const it=(_=(d=this.getManager())===null||d===void 0?void 0:d.materials)===null||_===void 0?void 0:_.findMaterial(c.uuid);if(it)return it}return(_e=(b=this.getManager())===null||b===void 0?void 0:b.materials)===null||_e===void 0?void 0:_e.generateFromTemplate(o,c)}serializePlugins(o,c){return Object.entries(this.plugins).map(d=>{if((!c||c.includes(d[1].constructor.PluginType))&&!this.serializePluginsIgnored.includes(d[1].constructor.PluginType))return d[1].serializeWithViewer!==!1&&typeof d[1].toJSON=="function"?d[1].toJSON(o):void 0}).filter(d=>!!d)}deserializePlugins(o,c){return o.forEach(d=>{if(!d.type)return void this.console.warn("Invalid plugin to import ",d);if(this.serializePluginsIgnored.includes(d.type))return;const _=this.getPluginByType(d.type);_&&_.fromJSON&&_.fromJSON(d,c)}),this}traverseSceneObjects(o){this.scene.modelRoot.modelObject.traverse(o)}toJSON(o,c){const d=Object.assign({version:ViewerApp.VERSION,type:"ViewerApp",metadata:{generator:"WebGiViewerApp",version:1},plugins:this.serializePlugins(o,c)},serializeObject(this,!0,o));return d.backgroundIntensity=this.scene.backgroundIntensity,d.useLegacyLights=this.renderer.useLegacyLights,d.background=d.scene.background||d.scene.backgroundColor,d.background==="environment"&&(d.background="envMapBackground"),d}fromJSON(o,c){var d,_,b,_e,it;const nt={...o};return nt.backgroundIntensity!==void 0&&((d=nt.scene)===null||d===void 0?void 0:d.backgroundIntensity)===void 0&&(this.console.warn("old file format, backgroundIntensity moved to RootScene"),this.scene.backgroundIntensity=nt.backgroundIntensity,delete nt.backgroundIntensity),nt.useLegacyLights!==void 0&&((_=nt.renderManager)===null||_===void 0?void 0:_.useLegacyLights)===void 0&&(this.console.warn("old file format, useLegacyLights moved to BaseRenderer"),this.renderer.useLegacyLights=nt.useLegacyLights,delete nt.useLegacyLights),nt.background!==void 0&&((b=nt.scene)===null||b===void 0?void 0:b.background)===void 0&&(this.console.warn("old file format, background moved to RootScene"),nt.background==="envMapBackground"?nt.background="environment":typeof nt.background=="number"?nt.background=new three_module.Q1f().setHex(nt.background,three_module.Zr2):typeof nt.background=="string"?nt.background=new three_module.Q1f().setStyle(nt.background,three_module.Zr2):!((_e=nt.background)===null||_e===void 0)&&_e.isColor&&(nt.background=new three_module.Q1f(nt.background)),!((it=nt.background)===null||it===void 0)&&it.isColor?(this.scene.backgroundColor=nt.background,this.scene.background=null):nt.background?(this.scene.backgroundColor=new three_module.Q1f("#ffffff"),nt.scene.background=nt.background):(this.scene.backgroundColor=null,this.scene.background=null),delete nt.background),deserializeObject(nt,this,!0,c),Array.isArray(nt.plugins)&&this.deserializePlugins(nt.plugins,c),this}get renderManager(){return this._renderer}get assetManager(){return this.getManager()}async load(o,c){if(o)return await this.assetManager.addAssetSingle(o,c)}async setEnvironmentMap(o,{setBackground:c=!1,...d}={}){return this.scene.environment=o&&!o.isTexture?await this.assetManager.importer.importSingle(o,d)||null:o||null,c?this.setBackgroundMap(this.scene.environment):this.scene.environment}async setBackgroundMap(o,{setEnvironment:c=!1,...d}={}){return this.scene.background=o&&!o.isTexture?await this.assetManager.importer.importSingle(o,d)||null:o||null,c?this.setEnvironmentMap(this.scene.background):this.scene.background}_setActiveCameraView(o={}){if(o.type==="setView"){if(!o.camera)return void this.console.warn("Cannot find camera",o);this.scene.activeCamera.copyFromCamera(o.camera)}else o.type==="activateMain"&&(this.scene.activeCamera=o.camera?this.createCamera(o.camera):void 0)}}async function checkVersion(){var h;const o=window.location.href,c="https://dev-sandbox.pixotronics.com/webgi/";if(!o.startsWith(c)||rt("noUpdate")!==null)return!0;const d=(h=o.match(/\/webgi\/([0-9.a-zA-Z-]+)/))===null||h===void 0?void 0:h[1],_=(await(await fetch(c+"version.txt")).text()).split(`
`)[0];if(d&&d!==_){if(confirm(`New version ${_} is available, do you want to open?`)){const b=window.location.href.replace(d,_);return window.location.href=b,!1}window.location.href.includes("noUpdate")||(window.location.href+=(window.location.href.includes("?")?"&":"?")+"noUpdate")}return!0}ViewerApp.VERSION=VIEWER_VERSION,ViewerApp_decorate([serialize("renderManager")],ViewerApp.prototype,"_renderer",void 0),ViewerApp_decorate([serialize()],ViewerApp.prototype,"scene",void 0),ViewerApp_decorate([x$1(ViewerApp.prototype._renderEnabledChanged)],ViewerApp.prototype,"renderEnabled",void 0);const envMapBackground="envMapBackground";function buildScreenShader(h){return h!=null&&h.isShaderPass2?h:new ShaderPass2({...CopyShader,fragmentShader:`
                       varying vec2 vUv;
                       
                       ${Array.isArray(h)?h[0]:(h==null?void 0:h.pars)||""}
                       
                       void main() {

                            gl_FragColor = tDiffuseTexelToLinear (texture2D(tDiffuse, vUv));
                            
                            ${Array.isArray(h)?h[1]:typeof h=="string"?h:(h==null?void 0:h.main)||""}
                            
                        }`,uniforms:{tDiffuse:{value:null}}},"tDiffuse")}var tonemapping=`int getToneMapBit(in int number){
#ifdef WebGL2Context
return(number/2)%2;
#else
return int(mod(floor(float(number)/2.),2.));
#endif
}vec3 TonemappingSaturation(vec3 rgb){const vec3 W=vec3(0.2125,0.7154,0.0721);vec3 intensity=vec3(dot(rgb,W));return mix(intensity,rgb,toneMappingSaturation);}vec3 TonemappingContrast(vec3 color){return(color-vec3(0.5))*toneMappingContrast+vec3(0.5);}vec4 ToneMapping(in vec4 color){vec4 outColor=opacity*color;
#if USE_DEPTH_TONEMAP > 0
bool doTonemap=getToneMapBit(getGBufferFlags(vUv).a)>0;float depth=getDepth(vUv);vec4 transparentCol=tTransparentTexelToLinear(texture2D(tTransparent,vUv));
#if TONEMAP_BACKGROUND < 1 || TRANSPARENT_BACKGROUND > 0
bool isBackground=depth>0.99&&transparentCol.a<0.001;if(isBackground)doTonemap=false;
#endif
if(doTonemap){
#endif
#if defined( TONE_MAPPING )
outColor.rgb=toneMapping(outColor.rgb);outColor.rgb=TonemappingContrast(outColor.rgb);outColor.rgb=TonemappingSaturation(outColor.rgb);
#endif
#if USE_DEPTH_TONEMAP > 0
}
#if TRANSPARENT_BACKGROUND > 0
if(isBackground)outColor.a=0.;if(depth>0.99&&transparentCol.a>=0.001)outColor.a=transparentCol.a;
#endif
if(depth<0.00001)outColor.a=0.;
#if defined(DEBUG_DEPTH) && DEBUG_DEPTH > 0
outColor.rgb=vec3(sRGBToLinear(vec4((1.-depth))).x);
#endif
#endif
return outColor;}`;class CombinedPostPass extends ShaderPass2{constructor(o){super({vertexShader:CopyShader.vertexShader,uniforms:{tDiffuse:{value:null},tNormalDepth:{value:null},tGBufferFlags:{value:null},tTransparent:{value:null}},defines:{},fragmentShader:`
                varying vec2 vUv;
                ${o[0]}
                void main() {
                    gl_FragColor = tDiffuseTexelToLinear (texture2D(tDiffuse, vUv));
                    #glMarker
                    ${o[1]}
                    
                    gl_FragColor.rgb *= gl_FragColor.a; // premultiply alpha
                }
                `},"tDiffuse","tTransparent"),this.uiConfig=void 0,this.material.transparent=!1,this.material.side=three_module.hB5}render(o,c,d,_,b){super.render(o,c,d,_,b),this._lastReadBuffer=d,this.needsSwap=!0}reRender(o,c,d,_){this._lastReadBuffer&&this.render(o,c,this._lastReadBuffer,d,_)}dispose(){this._lastReadBuffer=void 0,super.dispose()}}class CombinedPostPlugin extends GenericFilterPlugin{get renderToScreen(){return this._renderToScreen}constructor(o=!0,c=!0){super(),this.depthTonemap=o,this.passId="combinedPost",this.dependencies=[GBufferPlugin],this.toJSON=void 0,this._beforeFilters=[],this._afterFilters=["render","screen"],this._requiredFilters=["render"],this._renderToScreen=!0,this._postFrame=()=>{var d,_;this._needsReRender&&this._renderToScreen&&this._viewer&&this.pass&&(this._needsReRender=!1,(_=(d=this.pass).update)===null||_===void 0||_.call(d),this.pass.passObject.reRender(this._viewer.renderer.rendererObject,null))},this._needsReRender=!1,this._setDirty=this._setDirty.bind(this),this._renderToScreen=c}async onAdded(o){var c,d;return!((d=(c=this._viewer)===null||c===void 0?void 0:c.screenShader)===null||d===void 0)&&d.isShaderPass2&&(this._renderToScreen=!1),this._renderToScreen&&S$2(o.renderer.passes.find(_=>_.passId==="screen"),"enabled",!1,!0,!0),o.addEventListener("postFrame",this._postFrame),super.onAdded(o)}async onRemove(o){return this._renderToScreen&&S$2(o.renderer.passes.find(c=>c.passId==="screen"),"enabled",!0,!0,!0),super.onRemove(o)}passCtor(o){var c,d;const _=o.screenShader,b=["",""];this._renderToScreen&&!_.isShaderPass2&&(b[0]=Array.isArray(_)?_[0]:(_==null?void 0:_.pars)||"",b[1]=Array.isArray(_)?_[1]:typeof _=="string"?_:(_==null?void 0:_.main)||"");const _e=new CombinedPostPass(b);return S$2((d=(c=_e.uiConfig)===null||c===void 0?void 0:c.children)===null||d===void 0?void 0:d.find(it=>(it==null?void 0:it.label)==="Enabled"),"hidden",!0,!0),_e}_update(o){var c,d,_;return!!super._update(o)&&(this._pass.passObject.updateShaderProperties((c=this._viewer)===null||c===void 0?void 0:c.getPlugin(GBufferPlugin)),this._pass.passObject.material.uniforms.tTransparent.value=((_=(d=this._viewer)===null||d===void 0?void 0:d.renderFilter.passObject.transparentTarget)===null||_===void 0?void 0:_.texture)||null,!0)}_setDirty(){this.pass&&(this.pass.dirty=!0)}get uiConfig(){var o,c,d;return(d=(c=(o=this.pass)===null||o===void 0?void 0:o.passObject)===null||c===void 0?void 0:c.uiConfig)!==null&&d!==void 0?d:{}}addExtension(o){this.pass.passObject.material.registerMaterialExtensions([o])}reRender(){this._renderToScreen?this._needsReRender=!0:this._setDirty()}}CombinedPostPlugin.PluginType="CombinedPostPlugin";var GenericExtensionPlugin_decorate=function(h,o,c,d){var _,b=arguments.length,_e=b<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_e=Reflect.decorate(h,o,c,d);else for(var it=h.length-1;it>=0;it--)(_=h[it])&&(_e=(b<3?_(_e):b>3?_(o,c,_e):_(o,c))||_e);return b>3&&_e&&Object.defineProperty(o,c,_e),_e};class GenericExtensionPlugin extends AViewerPlugin{constructor(){super(...arguments),this.enabled=!0,this.dependencies=[CombinedPostPlugin]}get uiConfig(){var o;return(o=this._extension)===null||o===void 0?void 0:o.uiConfig}get config(){return this._extension}disposeExtension(){}async onAdded(o){var c;await super.onAdded(o),this._extension=this.generateExtension(o),(c=o.getPlugin(CombinedPostPlugin))===null||c===void 0||c.addExtension(this._extension)}async onRemove(o){this.disposeExtension(),this._extension=void 0,await super.onRemove(o)}}function updateBit(h,o,c){return h&~(1<<o)|(c?1:0)<<o}function clearBit(h,o){return h&~(1<<o)}GenericExtensionPlugin_decorate([serialize("extension")],GenericExtensionPlugin.prototype,"_extension",void 0),GenericExtensionPlugin_decorate([serialize()],GenericExtensionPlugin.prototype,"enabled",void 0);var TonemapPlugin_decorate=function(h,o,c,d){var _,b=arguments.length,_e=b<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_e=Reflect.decorate(h,o,c,d);else for(var it=h.length-1;it>=0;it--)(_=h[it])&&(_e=(b<3?_(_e):b>3?_(o,c,_e):_(o,c))||_e);return b>3&&_e&&Object.defineProperty(o,c,_e),_e};const Uncharted2Tonemapping=three_module.g7M;let TonemapExtension=class{constructor(h,o=!0){this.depthTonemap=o,this.toneMapping=three_module.FV,this.tonemapBackground=!0,this.clipBackground=!1,this.exposure=1,this.saturation=1,this.contrast=1,this.renderDepth=!1,this.enabled=!0,this._rendererState={},this.extraUniforms={opacity:{value:1},toneMappingContrast:{value:1},toneMappingSaturation:{value:1}},this.parsFragmentSnippet=(c,d)=>this.enabled?fe$1`
            ${this.depthTonemap?unpackGbuffer:""}
            #define USE_DEPTH_TONEMAP ${this.depthTonemap?"1":"0"}
            uniform float opacity;
            uniform float toneMappingContrast;
            uniform float toneMappingSaturation;
            ${tonemapping}
        `:"",this._combinedPostPlugin=h.getPlugin(CombinedPostPlugin),this._setDirty=this._setDirty.bind(this),this.depthTonemap=o}shaderExtender(h,o,c){this.enabled&&(h.fragmentShader=shaderReplaceString(h.fragmentShader,"#glMarker",`
gl_FragColor = ToneMapping(gl_FragColor);
`,{prepend:!0}))}onObjectRender(h,o,c){if(!this.enabled)return;const{toneMapping:d,toneMappingExposure:_,outputColorSpace:b}=c;this._rendererState.toneMapping=d,this._rendererState.toneMappingExposure=_,this._rendererState.outputColorSpace=b;let _e=this.tonemapBackground?"1":"0";o.materialObject.defines.TONEMAP_BACKGROUND!==_e&&(o.materialObject.defines.TONEMAP_BACKGROUND=_e,o.materialObject.needsUpdate=!0),_e=this.clipBackground?"1":"0",o.materialObject.defines.TRANSPARENT_BACKGROUND!==_e&&(o.materialObject.defines.TRANSPARENT_BACKGROUND=_e,o.materialObject.needsUpdate=!0),_e=this.renderDepth?"1":"0",o.materialObject.defines.DEBUG_DEPTH!==_e&&(o.materialObject.defines.DEBUG_DEPTH=_e,o.materialObject.needsUpdate=!0),c.toneMapping=this.toneMapping,c.toneMappingExposure=this.exposure,c.outputColorSpace=three_module.er$,o.materialObject.toneMapped=!0,o.materialObject.needsUpdate=!0,this.extraUniforms.toneMappingContrast.value=this.contrast,this.extraUniforms.toneMappingSaturation.value=this.saturation}onAfterRender(h,o,c){c.toneMapping=this._rendererState.toneMapping,c.toneMappingExposure=this._rendererState.toneMappingExposure,c.outputColorSpace=this._rendererState.outputColorSpace}getUiConfig(){return this.uiConfig}computeCacheKey(h){return this.enabled?"1":"0"}isCompatible(h){return!0}_setDirty(){this._combinedPostPlugin&&(this._combinedPostPlugin.pass.dirty=!0)}setDirty(){var h;(h=this.__setDirty)===null||h===void 0||h.call(this),this._setDirty()}};TonemapExtension.PluginType="Tonemap",TonemapPlugin_decorate([uiDropdown("Mode",[["Linear",three_module.kyO],["Reinhard",three_module.Mjd],["Cineon",three_module.nNL],["ACESFilmic",three_module.FV],["Uncharted2",Uncharted2Tonemapping]].map(h=>({label:h[0],value:h[1]})),{limitedUi:!0}),x$1(TonemapExtension.prototype._setDirty),serialize()],TonemapExtension.prototype,"toneMapping",void 0),TonemapPlugin_decorate([x$1(TonemapExtension.prototype._setDirty),uiToggle("Tonemap Background",{limitedUi:!0}),serialize()],TonemapExtension.prototype,"tonemapBackground",void 0),TonemapPlugin_decorate([x$1(TonemapExtension.prototype._setDirty),uiToggle("Clip Background"),serialize()],TonemapExtension.prototype,"clipBackground",void 0),TonemapPlugin_decorate([x$1(TonemapExtension.prototype._setDirty),uiSlider("Exposure",[0,2*Math.PI],.01,{limitedUi:!0}),serialize()],TonemapExtension.prototype,"exposure",void 0),TonemapPlugin_decorate([x$1(TonemapExtension.prototype._setDirty),uiSlider("Saturation",[0,2],.01,{limitedUi:!0}),serialize()],TonemapExtension.prototype,"saturation",void 0),TonemapPlugin_decorate([x$1(TonemapExtension.prototype._setDirty),uiSlider("Contrast",[0,2],.01,{limitedUi:!0}),serialize()],TonemapExtension.prototype,"contrast",void 0),TonemapPlugin_decorate([x$1(TonemapExtension.prototype._setDirty),uiToggle("Render Depth")],TonemapExtension.prototype,"renderDepth",void 0),TonemapExtension=TonemapPlugin_decorate([uiFolder("Tonemapping")],TonemapExtension);class TonemapPlugin extends GenericExtensionPlugin{constructor(o=!0){super(),this.depthTonemap=o,this.depthTonemap=o,this.updateGBuffer=this.updateGBuffer.bind(this)}fromJSON(o,c){return o.pass&&((o={...o}).extension={...o.pass},delete o.extension.enabled,delete o.pass),super.fromJSON(o,c)}async onAdded(o){var c;await super.onAdded(o),(c=o.getPlugin(GBufferPlugin))===null||c===void 0||c.registerGBufferUpdater(this.updateGBuffer)}generateExtension(o){return new TonemapExtension(o,this.depthTonemap)}get exposure(){var o,c;return(c=(o=this._extension)===null||o===void 0?void 0:o.exposure)!==null&&c!==void 0?c:1}set exposure(o){this._extension&&(this._extension.exposure=o,this._extension.setDirty())}get saturation(){var o,c;return(c=(o=this._extension)===null||o===void 0?void 0:o.saturation)!==null&&c!==void 0?c:1}set saturation(o){this._extension&&(this._extension.saturation=o,this._extension.setDirty())}get contrast(){var o,c;return(c=(o=this._extension)===null||o===void 0?void 0:o.contrast)!==null&&c!==void 0?c:1}set contrast(o){this._extension&&(this._extension.contrast=o,this._extension.setDirty())}get toneMapping(){var o,c;return(c=(o=this._extension)===null||o===void 0?void 0:o.toneMapping)!==null&&c!==void 0?c:three_module.kyO}set toneMapping(o){this._extension&&(this._extension.toneMapping=o,this._extension.setDirty())}updateGBuffer(o,c){var d,_;if(o instanceof three_module.eaF&&!((d=o.material)===null||d===void 0)&&d.userData){const b=((_=o.material)===null||_===void 0?void 0:_.userData.postTonemap)===!1?0:1;c.w=updateBit(c.w,1,b)}}}TonemapPlugin.PluginType="Tonemap",three_module.vxI.tonemapping_pars_fragment=three_module.vxI.tonemapping_pars_fragment.replace("vec3 CustomToneMapping( vec3 color ) { return color; }",`

// source: http://filmicworlds.com/blog/filmic-tonemapping-operators/
#define Uncharted2Helper( x ) max( ( ( x * ( 0.15 * x + 0.10 * 0.50 ) + 0.20 * 0.02 ) / ( x * ( 0.15 * x + 0.50 ) + 0.20 * 0.30 ) ) - 0.02 / 0.30, vec3( 0.0 ) )
vec3 Uncharted2ToneMapping( vec3 color ) {

	// John Hable's filmic operator from Uncharted 2 video game
	color *= toneMappingExposure;
	return saturate( Uncharted2Helper( color ) / Uncharted2Helper( vec3( 1.0 ) ) );

}

vec3 CustomToneMapping( vec3 color ) { return Uncharted2ToneMapping( color ); }

`);var chromaticAberration="vec4 chromaticAberration(){vec2 distFromCenter=vUv-0.5;vec2 aberrated=aberrationIntensity*pow(abs(distFromCenter),vec2(2.));vec4 color=tDiffuseTexelToLinear(texture2D(tDiffuse,vUv));vec4 outColor=vec4(tDiffuseTexelToLinear(texture2D(tDiffuse,vUv+aberrated)).r,color.g,tDiffuseTexelToLinear(texture2D(tDiffuse,vUv-aberrated)).b,color.a);return outColor;}",ChromaticAberrationPlugin_decorate=function(h,o,c,d){var _,b=arguments.length,_e=b<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_e=Reflect.decorate(h,o,c,d);else for(var it=h.length-1;it>=0;it--)(_=h[it])&&(_e=(b<3?_(_e):b>3?_(o,c,_e):_(o,c))||_e);return b>3&&_e&&Object.defineProperty(o,c,_e),_e};let ChromaticAberrationExtension=class{constructor(h){this.enabled=!1,this.aberrationIntensity=.01,this.extraUniforms={aberrationIntensity:{value:1}},this.parsFragmentSnippet=(o,c)=>this.enabled?fe$1`
            uniform float aberrationIntensity;
            ${chromaticAberration}
        `:"",this._combinedPostPlugin=h.getPlugin(CombinedPostPlugin),this._setDirty=this._setDirty.bind(this)}shaderExtender(h,o,c){this.enabled&&(h.fragmentShader=shaderReplaceString(h.fragmentShader,"#glMarker",` 
            gl_FragColor = chromaticAberration();
            #glMarker
        `))}onObjectRender(h,o,c){this.enabled&&(this.extraUniforms.aberrationIntensity.value=this.aberrationIntensity)}getUiConfig(){return this.uiConfig}computeCacheKey(h){return this.enabled?"1":"0"}isCompatible(h){return!0}_setDirty(){this._combinedPostPlugin&&(this._combinedPostPlugin.pass.dirty=!0)}setDirty(){var h;(h=this.__setDirty)===null||h===void 0||h.call(this),this._setDirty()}};ChromaticAberrationExtension.PluginType="ChromaticAberration",ChromaticAberrationPlugin_decorate([x$1(ChromaticAberrationExtension.prototype._setDirty),uiToggle("Enable"),serialize()],ChromaticAberrationExtension.prototype,"enabled",void 0),ChromaticAberrationPlugin_decorate([x$1(ChromaticAberrationExtension.prototype._setDirty),uiSlider("Intensity",[0,.1],.001,{limitedUi:!0}),serialize()],ChromaticAberrationExtension.prototype,"aberrationIntensity",void 0),ChromaticAberrationExtension=ChromaticAberrationPlugin_decorate([uiFolder("ChromaticAberration")],ChromaticAberrationExtension);class ChromaticAberrationPlugin extends GenericExtensionPlugin{constructor(){super()}generateExtension(o){return new ChromaticAberrationExtension(o)}get intensity(){var o,c;return(c=(o=this._extension)===null||o===void 0?void 0:o.aberrationIntensity)!==null&&c!==void 0?c:1}set intensity(o){this._extension&&(this._extension.aberrationIntensity=o,this._extension.setDirty())}}ChromaticAberrationPlugin.PluginType="ChromaticAberration";class MultiFilterPlugin extends AViewerPlugin{get passes(){if(!this._passes)throw"Plugin not yet added to the viewer";return this._passes}get pipeline(){return this._pipeline}set pipeline(o){this._pipeline=o}constructor(){super(),this._pipeline=[]}async onAdded(o){await super.onAdded(o);const c=this.createPasses(o);this._passes=Object.fromEntries(c.map(d=>(d.passId||(console.warn("no id found for pass",d),d.passId=esm_browser_v4()),o.renderer.registerPass(d,!0),[d.passId,d])))}async onRemove(o){var c;if(this._passes){for(const d of[...Object.values(this._passes)]){const _=d;o.renderer.unregisterPass(_),(c=_==null?void 0:_.dispose)===null||c===void 0||c.call(_)}this._passes=void 0}await super.onRemove(o)}toJSON(o){var c;const d=super.toJSON(o);if(!d.type)return d;const _=Object.entries(this.passes);d.passes={};for(const[b,_e]of _)d.passes[b]=serializeObject((c=_e==null?void 0:_e.passObject)!==null&&c!==void 0?c:_e,!1,o);return d}fromJSON(o,c){var d;if(!super.fromJSON(o,c))return null;if(o.passes){const _=Object.entries(this.passes);for(const[b,_e]of _)deserializeObject(o.passes[b],(d=_e==null?void 0:_e.passObject)!==null&&d!==void 0?d:_e,!1,c)}return this}}var ssaoBilateral=`uniform vec2 tDiffuseSize;uniform vec2 bilDirection;varying vec2 vUv;uniform bool smoothEnabled;uniform float edgeSharpness;vec4 bilaterialAO(){vec4 color=clamp((texture2D(tDiffuse,vUv.xy)).B_SRC_ACCESSOR,0.,5.);if(!smoothEnabled)return color;float depth;vec3 normal;getDepthNormal(vUv.xy,depth,normal);float gaussianWeights[4];gaussianWeights[0]=0.153170;gaussianWeights[1]=0.144893;gaussianWeights[2]=0.122649;gaussianWeights[3]=0.092902;float Z=gaussianWeights[0]+0.03;vec4 final_colour=Z*color;vec2 nuv;vec4 cc;float dp;vec3 nor;vec2 direction=bilDirection/tDiffuseSize.xy;
#pragma unroll_loop_start
for(int i=0;i<6;i++){direction*=-1.;nuv=vUv+2.*direction*float(UNROLLED_LOOP_INDEX/2+1);getDepthNormal(nuv,dp,nor);if(dp<0.999){float normalCloseness=dot(normal,nor);normalCloseness*=normalCloseness;float normalError=(1.-normalCloseness)*8.;float normalWeight=max((1.-normalError*edgeSharpness),0.00);float depthWeight=max(0.,1.-edgeSharpness*4000.*abs(depth-dp));float kernelWeight=gaussianWeights[UNROLLED_LOOP_INDEX/2]+0.03;float bilateralWeight=kernelWeight*depthWeight*normalWeight;Z+=bilateralWeight;cc=clamp((texture2D(tDiffuse,nuv)).B_SRC_ACCESSOR,0.,5.);final_colour+=bilateralWeight*cc;}}
#pragma unroll_loop_end
final_colour/=Z;return final_colour;}void main(){vec4 ao=clamp(bilaterialAO(),vec4(0.),vec4(1.));gl_FragColor=ao;}`,BilateralFilterPass_decorate=function(h,o,c,d){var _,b=arguments.length,_e=b<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_e=Reflect.decorate(h,o,c,d);else for(var it=h.length-1;it>=0;it--)(_=h[it])&&(_e=(b<3?_(_e):b>3?_(o,c,_e):_(o,c))||_e);return b>3&&_e&&Object.defineProperty(o,c,_e),_e};class BilateralFilterPass extends ShaderPass2{constructor(o,c,d="rgba"){super({vertexShader:CopyShader.vertexShader,fragmentShader:c+ssaoBilateral,uniforms:{bilDirection:{value:new three_module.I9Y(1,0)},tNormalDepth:{value:null},tDiffuse:{value:o.texture},tDiffuseSize:{value:new three_module.I9Y}},defines:{B_SRC_ACCESSOR:d}},"tDiffuse"),this.smoothEnabled=!0,this.edgeSharpness=.1,this._target=o,this.clear=!1,this.needsSwap=!1}render(o,c,d,_,b){var _e,it,nt,at;this.enabled&&(this.uniforms.bilDirection.value.set(1,0),this.uniforms.tDiffuse.value=this._target.texture,this.uniforms.tDiffuseSize.value.set(((_e=this.uniforms.tDiffuse.value)===null||_e===void 0?void 0:_e.image.width)||0,((it=this.uniforms.tDiffuse.value)===null||it===void 0?void 0:it.image.height)||0),super.render(o,c,this._target,_,b),this.uniforms.bilDirection.value.set(0,1),this.uniforms.tDiffuse.value=c.texture,this.uniforms.tDiffuseSize.value.set(((nt=this.uniforms.tDiffuse.value)===null||nt===void 0?void 0:nt.image.width)||0,((at=this.uniforms.tDiffuse.value)===null||at===void 0?void 0:at.image.height)||0),super.render(o,this._target,c,_,b))}}BilateralFilterPass_decorate([serialize(),uniform()],BilateralFilterPass.prototype,"smoothEnabled",void 0),BilateralFilterPass_decorate([serialize(),uniform()],BilateralFilterPass.prototype,"edgeSharpness",void 0);var defaultVertex="varying vec2 vUv;void main(){vUv=uv;gl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.);}",randomHelpers=`#ifndef BASIC_RANDOM_HELPERS
#define BASIC_RANDOM_HELPERS 
uniform float frameCount;float random(float n){return fract(sin(n)*43758.5453123);}float random2(vec2 n,float x){n+=x;return fract(sin(dot(n.xy,vec2(12.9898,78.233)))*43758.5453);}float random3(vec3 v){v=fract(v*443.8975);v+=dot(v,v.yzx+19.19);return fract((v.x+v.y)*v.z);}float interleavedGradientNoise(const in vec2 fragCoord,const in float seed){vec3 magic=vec3(0.06711056,0.00583715,52.9829189);return fract(magic.z*fract(dot(fragCoord.xy+seed*vec2(2.083,4.867),magic.xy)));}vec3 hash3(vec2 p){vec3 q=vec3(dot(p,vec2(127.1,311.7)),dot(p,vec2(269.5,183.3)),dot(p,vec2(419.2,371.9)));return fract(sin(q)*43758.5453);}
#endif
`,ssao=`#include <common>
#include <packing>
varying vec2 vUv;uniform vec2 cameraNearFar;uniform mat4 projection;uniform sampler2D tLastThis;uniform vec4 saoData;uniform vec4 saoBiasEpsilon;uniform vec2 screenSize;const float INV_NUM_SAMPLES=1./float(NUM_SAMPLES);int getSelectionBit(in int number){
#ifdef WebGL2Context
return(number/8)%2;
#else
return int(mod(floor(float(number)/4.),2.));
#endif
}float getViewZFromNDCZ(const in float depth){
#if PERSPECTIVE_CAMERA == 1
return perspectiveDepthToViewZ(depth,cameraNearFar.x,cameraNearFar.y);
#else
return orthographicDepthToViewZ(depth,cameraNearFar.x,cameraNearFar.y);
#endif
}vec3 packFloatToRGB(const in float x){const vec3 code=vec3(1.,255.,65025.);vec3 pack=vec3(code*x);pack.gb=fract(pack.gb);pack.rg-=pack.gb*(1./256.);return pack;}vec3 getViewPositionFromViewZ(const in vec2 uv,const in float viewDepth){vec2 uv_=2.*uv-1.;float xe=-(uv_.x+projection[2][0])*viewDepth/projection[0][0];float ye=-(uv_.y+projection[2][1])*viewDepth/projection[1][1];return vec3(xe,ye,viewDepth);}float decodeDepth(const in vec2 uv){vec4 uncodedDepth;
#if DEPTH_PACKING_MODE == 2
uncodedDepth=texture2D(tNormalDepth,uv);
#else
uncodedDepth=texture2D(tDepth,uv);
#endif
#if DEPTH_PACKING_MODE == 0
return uncodedDepth.x;
#elif DEPTH_PACKING_MODE == 1
#if LINEAR_DEPTH == 1
return pow2(unpackRGBAToDepth(uncodedDepth));
#else
return unpackRGBAToDepth(uncodedDepth);
#endif
#else
return pow2(unpack16(uncodedDepth.xy));
#endif
}vec3 getPositionFromOffset(const in vec2 uvOffset){float d=decodeDepth(uvOffset);
#if LINEAR_DEPTH == 0
float centerViewZ=getViewZFromNDCZ(d);return getViewPositionFromViewZ(uvOffset,centerViewZ);
#else
d=mix(-cameraNearFar.x,-cameraNearFar.y,d);return getViewPositionFromViewZ(uvOffset,d);
#endif
}float getCavityAO(){float cutoff=-0.65;float curvature=float(getGBufferFlags(vUv).r)/255.;curvature=2.*curvature-1.;curvature=curvature*4.;float smoothCurvature=smoothstep(0.,1.,curvature-cutoff);smoothCurvature+=saoData.x;smoothCurvature=clamp(smoothCurvature,0.,1.);return 1.-smoothCurvature;}float getOcclusion(const in vec2 uv,const in int id,const in float randomAngle,const in float occlusionSphereRadius,const in vec3 centerPosition,const in vec3 centerNormal){float screenSpaceRadius=(float(id)+mod(randomAngle,1.)+0.5)*INV_NUM_SAMPLES;float angle=screenSpaceRadius*(float(NUM_SPIRAL_TURNS)*6.28318)+randomAngle;screenSpaceRadius=(screenSpaceRadius*occlusionSphereRadius);vec2 uvOffset=uv+floor(screenSpaceRadius*vec2(cos(angle),sin(angle)))/screenSize;
#if CHECK_GBUFFER_FLAG == 1
if(getSelectionBit(getGBufferFlags(uvOffset.xy).a)<1)return 0.;
#endif
vec3 samplePosition=getPositionFromOffset(uvOffset);vec3 direction=samplePosition-centerPosition;float d2=dot(direction,direction)/(saoBiasEpsilon.w*saoBiasEpsilon.w);float ao=max((dot(centerNormal,direction)/saoBiasEpsilon.w-saoBiasEpsilon.x)/(saoBiasEpsilon.z*d2+saoBiasEpsilon.y),0.);return ao;}void main(){float centerDepth;vec3 centerNormal;getDepthNormal(vUv,centerDepth,centerNormal);
#if LINEAR_DEPTH == 0
float centerViewZ=getViewZFromNDCZ(centerDepth);
#else
float centerViewZ=mix(-cameraNearFar.x,-cameraNearFar.y,centerDepth);
#endif
vec3 centerPosition=getViewPositionFromViewZ(vUv,centerViewZ);float occlusionSphereScreenRadius=0.09*saoData.z*saoBiasEpsilon.w/(-centerPosition.z);float randomAngle=6.2*random3(vec3(vUv,frameCount*0.1));float sum=0.;sum+=getOcclusion(vUv,0,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#if NUM_SAMPLES > 1
sum+=getOcclusion(vUv,1,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 2
sum+=getOcclusion(vUv,2,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 3
sum+=getOcclusion(vUv,3,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 4
sum+=getOcclusion(vUv,4,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 5
sum+=getOcclusion(vUv,5,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 6
sum+=getOcclusion(vUv,6,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 7
sum+=getOcclusion(vUv,7,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 8
sum+=getOcclusion(vUv,8,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 9
sum+=getOcclusion(vUv,9,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 10
sum+=getOcclusion(vUv,10,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
float aoValue=sum*saoData.y*INV_NUM_SAMPLES;float cavityAO=getCavityAO();aoValue=saoData.w>0.?max(aoValue,cavityAO):aoValue;aoValue=clamp(1.-max(aoValue,0.),0.,1.);gl_FragColor.gba=packFloatToRGB(centerDepth);gl_FragColor.r=(vec4(aoValue)).r;}`,ssaoPatch=`#ifndef USE_TRANSMISSION
#if defined(SSAO_ENABLED) && SSAO_ENABLED > 0
float ambientOcclusion=tSSAOMapTexelToLinear(texture2D(tSSAOMap,viewToScreen(vViewPosition.xyz).xy)).r;reflectedLight.indirectDiffuse*=ambientOcclusion;
#if defined( USE_ENVMAP )
float dotNV=saturate(dot(geometryNormal,geometryViewDir));reflectedLight.indirectSpecular*=computeSpecularOcclusion(dotNV,ambientOcclusion,material.roughness);
#endif
#else
#include <aomap_fragment>
#endif
#endif
`,simpleCameraHelpers=`#ifndef SIMPLE_CAMERA_HELPERS
#define SIMPLE_CAMERA_HELPERS 
#ifndef USE_TRANSMISSION
uniform mat4 projectionMatrix;
#endif
vec3 viewToScreen(const in vec3 pos){vec4 projected=projectionMatrix*vec4(pos,1.);return vec3(0.5+0.5*projected.xy/projected.w,projected.w);}
#endif
`,SSAOPass_decorate=function(h,o,c,d){var _,b=arguments.length,_e=b<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_e=Reflect.decorate(h,o,c,d);else for(var it=h.length-1;it>=0;it--)(_=h[it])&&(_e=(b<3?_(_e):b>3?_(o,c,_e):_(o,c))||_e);return b>3&&_e&&Object.defineProperty(o,c,_e),_e};class SSAOPass extends ShaderPass2{constructor(o,c,d){super({defines:{LINEAR_DEPTH:1,NUM_SAMPLES:11,NUM_SPIRAL_TURNS:3,DEPTH_NORMAL_TEXTURE:1,DEPTH_PACKING_MODE:2,PERSPECTIVE_CAMERA:1,CHECK_GBUFFER_FLAG:0},uniforms:{tLastThis:{value:null},tNormalDepth:{value:null},tGBufferFlags:{value:null},screenSize:{value:new three_module.I9Y(512,512)},saoData:{value:new three_module.IUQ},frameCount:{value:0},cameraNearFar:{value:new three_module.I9Y(.1,1e3)},projection:{value:new three_module.kn4},saoBiasEpsilon:{value:new three_module.IUQ(1,1,1,1)},sceneBoundingRadius:{value:0}},vertexShader:defaultVertex,fragmentShader:`

${randomHelpers}

${d}

${ssao}

            `},"tDiffuse"),this.parameters={intensity:.25,occlusionWorldRadius:1,bias:.001,falloff:1.3,useSmallScaleAO:!1,intensitySmallAO:.2,autoRadius:!1,projScale:1},this._smoothEnabled=!0,this.materialExtension={shaderExtender:(_,b,_e)=>{_.defines.SSAO_ENABLED&&(_.fragmentShader=shaderReplaceString(_.fragmentShader,"#include <aomap_fragment>",ssaoPatch))},onObjectRender:(_,b,_e)=>{var it,nt;this.materialExtension.extraUniforms.tSSAOMap.value=(it=this._target)===null||it===void 0?void 0:it.texture;const at=b.materialObject;let ut=this.enabled&&_e.userData.screenSpaceRendering!==!1&&!(!((nt=b.userData)===null||nt===void 0)&&nt.ssaoDisabled)?1:0;at.defines.SSAO_ENABLED!==ut&&(at.defines.SSAO_ENABLED=ut,at.needsUpdate=!0),ut=this._target.texture,this.materialExtension.extraUniforms.tSSAOMap.value!==ut&&(this.materialExtension.extraUniforms.tSSAOMap.value=ut,at.needsUpdate=!0)},parsFragmentSnippet:_=>{var b,_e;return fe$1`
             uniform sampler2D tSSAOMap;
             ${getTexelDecoding("tSSAOMap",(_e=(b=this._target)===null||b===void 0?void 0:b.texture)===null||_e===void 0?void 0:_e.colorSpace)}
            ${simpleCameraHelpers}
        `},extraUniforms:{tSSAOMap:{value:null}},computeCacheKey:_=>{var b,_e;return this.enabled?"1":"0"+((_e=(b=this._target)===null||b===void 0?void 0:b.texture)===null||_e===void 0?void 0:_e.colorSpace)},isCompatible:_=>{var b;return!(!((b=_.materialObject.userData)===null||b===void 0)&&b.ssaoDisabled)&&_.isMeshStandardMaterial2}},this._renderer=o,this._target=c,this.needsSwap=!1,this.clear=!0,this.bilateralPass=new BilateralFilterPass(this._target,d,"rrrr")}get smoothEnabled(){return this._smoothEnabled}set smoothEnabled(o){this._smoothEnabled=o,this.bilateralPass.enabled=o,this.bilateralPass.uniforms.smoothEnabled.value=o}render(o,c,d,_,b){this.enabled&&(this._updateParameters(),this._renderer.blit(this._target.texture,c,{}),this.uniforms.tLastThis.value=c.texture,super.render(o,this._target,d,_,b),this._smoothEnabled&&this.bilateralPass.render(o,c,d,_,b))}_updateParameters(){const o=this.material.uniforms.saoData.value;o.x=this.parameters.intensitySmallAO,o.y=this.parameters.intensity,o.z=this.parameters.occlusionWorldRadius,o.w=this.parameters.useSmallScaleAO,o.z*=this.parameters.projScale;const c=this.material.uniforms.saoBiasEpsilon.value;if(c.x=this.parameters.bias,c.y=.001,c.z=this.parameters.falloff,this.parameters.autoRadius){const d=this.material.uniforms.sceneBoundingRadius.value;c.w=d}else c.w=1}}SSAOPass_decorate([serialize()],SSAOPass.prototype,"bilateralPass",void 0),SSAOPass_decorate([serialize()],SSAOPass.prototype,"parameters",void 0);class SSAOPlugin extends MultiFilterPlugin{get aoTarget(){return this._aoTarget}constructor(){super(),this.dependencies=[AssetManagerPlugin,GBufferPlugin],this.setDirty=this.setDirty.bind(this),this.updateGBuffer=this.updateGBuffer.bind(this)}async onAdded(o){var c;return o.getPluginByType("Ground")&&console.error("GroundPlugin must be added after SSAOPlugin"),(c=o.getPlugin(GBufferPlugin))===null||c===void 0||c.registerGBufferUpdater(this.updateGBuffer),super.onAdded(o)}updateGBuffer(o,c){var d;if(o instanceof three_module.eaF&&!((d=o.material)===null||d===void 0)&&d.userData){const _=o.material.userData.ssaoCastDisabled||o.material.userData.pluginsDisabled,b=_?0:1;c.w=updateBit(c.w,3,b),_&&this.passes.ssao.passObject&&this.passes.ssao.passObject.material.defines.CHECK_GBUFFER_FLAG!==1&&(this.passes.ssao.passObject.material.defines.CHECK_GBUFFER_FLAG=1,this.passes.ssao.passObject.material.needsUpdate=!0)}}createPasses(o){var c,d;return this._aoTarget=o.renderer.createTarget({sizeMultiplier:1}),[makeFilter(o,{passId:"ssao",after:["gbuffer"],before:["render"],required:["render","gbuffer"],passObject:new SSAOPass(o.renderer,this._aoTarget,(d=(c=o.getPlugin(GBufferPlugin))===null||c===void 0?void 0:c.getUnpackSnippet())!==null&&d!==void 0?d:""),update(){var _;const b=Math.max(1,(_=(o==null?void 0:o.scene.activeCamera.modelObject).fov)!==null&&_!==void 0?_:1),_e=((o==null?void 0:o.canvas.height)||1)/(2*Math.tan(.5*b*three_module.cj9.DEG2RAD));this.passObject.parameters.projScale=_e,this.passObject.bilateralPass.updateShaderProperties([o.getPlugin(GBufferPlugin)])}},()=>[o.getPlugin(GBufferPlugin),o.scene.activeCamera,o.renderer,o.scene])]}async onRemove(o){return o.renderer.disposeTarget(this._aoTarget),super.onRemove(o)}setDirty(){var o;(o=this._viewer)===null||o===void 0||o.setDirty()}get enabled(){var o,c;return((c=(o=this.passes.ssao)===null||o===void 0?void 0:o.passObject)===null||c===void 0?void 0:c.enabled)||!1}set enabled(o){var c;!((c=this.passes.ssao)===null||c===void 0)&&c.passObject&&(this.passes.ssao.passObject.enabled=o)}get uiConfig(){var o;if(this._uiConfig)return this._uiConfig;const c=this,d=c.passes.ssao.passObject;return this._uiConfig={type:"folder",label:"SS Ambient Occlusion",children:[{type:"checkbox",label:"Enabled",property:[d,"enabled"],onChange:c.setDirty},{type:"checkbox",label:"Enable Cavity",property:[d.parameters,"useSmallScaleAO"],onChange:c.setDirty},{type:"slider",label:"Cavity Brightness",bounds:[0,.5],stepSize:.01,property:[d.parameters,"intensitySmallAO"],onChange:c.setDirty},{type:"slider",label:"Intensity",bounds:[0,5],property:[d.parameters,"intensity"],onChange:c.setDirty},{type:"slider",label:"Radius",bounds:[.1,20],property:[d.parameters,"occlusionWorldRadius"],onChange:c.setDirty},{type:"slider",label:"Bias",bounds:[1e-5,.01],property:[d.parameters,"bias"],onChange:c.setDirty},{type:"slider",label:"Falloff",bounds:[.01,3],property:[d.parameters,"falloff"],onChange:c.setDirty},{type:"slider",label:"Num samples",stepSize:1,bounds:[1,11],property:[(o=d.material)===null||o===void 0?void 0:o.defines,"NUM_SAMPLES"],onChange:[()=>d.material.needsUpdate=!0,c.setDirty]},{type:"checkbox",property:[d.bilateralPass,"smoothEnabled"],onChange:c.setDirty},{type:"checkbox",property:[d.parameters,"autoRadius"],onChange:c.setDirty},{type:"vec4",property:[d.bilateralPass,"edgeSharpness"],onChange:c.setDirty}]}}}SSAOPlugin.PluginType="SSAO";var hdrBloom=`uniform float intensity;uniform float opacity;uniform vec2 tDiffuseSize;varying vec2 vUv;uniform float weight;
#if PASS_STEP == 0
uniform vec4 prefilter;vec4 Prefilter(vec4 c){if(getDepth(vUv)>0.999){return vec4(0.);}float brightness=max(c.r,max(c.g,c.b));float soft=brightness+prefilter.x*(prefilter.y-1.);soft=clamp(soft,0.,prefilter.z);soft=soft*soft*prefilter.w;float contribution=max(soft,brightness-prefilter.x);contribution/=max(brightness,0.001);return vec4(c.rgb*contribution,c.a);}
#endif
vec4 Sample(vec2 uv){return min(vec4(MAX_INTENSITY,MAX_INTENSITY,MAX_INTENSITY,1.),tDiffuseTexelToLinear(texture2D(tDiffuse,uv)));}vec4 SampleBox(vec2 uv,float delta){vec4 o=vec2(-delta,delta).xxyy/tDiffuseSize.xyxy;vec4 s=Sample(uv+o.xy)+Sample(uv+o.zy)+Sample(uv+o.xw)+Sample(uv+o.zw);return s*0.25;}int getBloomBit(in int number){
#ifdef WebGL2Context
return(number/4)%2;
#else
return int(mod(floor(float(number)/4.),2.));
#endif
}void main(){
#if PASS_STEP == 0 
int doBloom=getBloomBit(getGBufferFlags(vUv).a);gl_FragColor=float(doBloom)*weight*Prefilter(SampleBox(vUv,1.));gl_FragColor.a=1.;
#elif PASS_STEP == 1 
gl_FragColor=weight*(SampleBox(vUv,1.));gl_FragColor.a=1.;
#elif PASS_STEP == 2 
gl_FragColor=(SampleBox(vUv,0.5));gl_FragColor.a=1.;
#elif PASS_STEP == 3 
vec4 texel=tSourceTexelToLinear(texture2D(tSource,vUv));vec4 bloom=intensity*SampleBox(vUv,0.5).rgba;float brightness=max(bloom.r,max(bloom.g,bloom.b));texel.rgb+=bloom.rgb;texel.a=min(1.,texel.a+brightness);gl_FragColor=texel;
#elif PASS_STEP == 4 
vec4 texel=vec4(0.);texel.rgb+=intensity*SampleBox(vUv,0.5).rgb;texel.a=1.;gl_FragColor=texel;
#endif
#include <colorspace_fragment>
}`,BloomPass_decorate=function(h,o,c,d){var _,b=arguments.length,_e=b<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_e=Reflect.decorate(h,o,c,d);else for(var it=h.length-1;it>=0;it--)(_=h[it])&&(_e=(b<3?_(_e):b>3?_(o,c,_e):_(o,c))||_e);return b>3&&_e&&Object.defineProperty(o,c,_e),_e};let BloomPass=class extends ShaderPass2{constructor(h=16){super({vertexShader:CopyShader.vertexShader,defines:{PASS_STEP:1,MAX_INTENSITY:Math.min(h,16)},uniforms:{tSource:{value:null},tDiffuse:{value:null},opacity:{value:1},tDiffuseSize:{value:new three_module.I9Y},weight:{value:1},tNormalDepth:{value:null},tGBufferFlags:{value:null}},fragmentShader:unpackGbuffer+`
`+hdrBloom},"tDiffuse","tSource"),this.uiConfig=void 0,this.prefilter=new three_module.IUQ(2,.5,0,0),this.threshold=2,this.softThreshold=.5,this.intensity=.2,this.bloomIterations=4,this.radius=.6,this.power=1,this.bloomDebug=!1,this._weights=[],this._updateWeights=this._updateWeights.bind(this),this._thresholdsUpdated=this._thresholdsUpdated.bind(this),this._updateWeights(),this._thresholdsUpdated(),this.clear=!0,this.userData={setDirty:()=>{this.setDirty()}}}_thresholdsUpdated(){this.prefilter.x=this.threshold,this.prefilter.y=this.softThreshold,this.prefilter.z=2*this.prefilter.x*this.prefilter.y,this.prefilter.w=.125/(this.uniforms.prefilter.value.z+1e-5)}render(h,o,c,d,_){const b=h.baseRenderer;this.material.defines.PASS_STEP=0,this.clear=!0;const _e=c;let it=.5,nt=_e.width*it,at=_e.height*it;const ut=[];let pt=b.getTempTarget({sizeMultiplier:1,type:three_module.ix0});ut.push(pt);let mt=_e;this.material.needsUpdate=!0,this.material.uniforms.weight.value=this._weights[0],super.render(h,pt,mt,d,_),mt=pt;let ft=1;for(;ft<this.bloomIterations&&(nt/=2,at/=2,it/=2,!(at<2||nt<2));ft++){pt=b.getTempTarget({sizeMultiplier:it,type:three_module.ix0}),ut.push(pt),this.material.defines.PASS_STEP=1;let xt=this._weights[ft];xt=this._weights[ft-1]!==0?this._weights[ft]/this._weights[ft-1]:this._weights[ft],this.material.uniforms.weight.value=xt,this.material.needsUpdate=!0,super.render(h,pt,mt,d,_),mt=pt}this.clear=!1;const vt=h.autoClear;for(h.autoClear=!1,ft-=2;ft>=0;ft--)pt=ut[ft],ut[ft]=void 0,this.material.defines.PASS_STEP=2,this.material.transparent=!0,this.material.blending=three_module.EZo,this.material.needsUpdate=!0,h.autoClear=!1,super.render(h,pt,mt,d,_),this.material.blending=three_module.XIg,b.releaseTempTarget(mt),mt=pt;this.clear=!0,h.autoClear=vt,h.autoClear=!0,this.bloomDebug?(this.material.defines.PASS_STEP=4,this.material.needsUpdate=!0,super.render(h,o,mt,d,_)):(this.uniforms.tSource.value=_e.texture,this.material.defines.PASS_STEP=3,this.material.needsUpdate=!0,super.render(h,o,mt,d,_),this.uniforms.tSource.value=null),b.releaseTempTarget(mt)}_updateWeights(){if(!this._weights)return;const h=Math.max(Math.min(this.radius,1),0),o=1/(this.bloomIterations-1);for(let c=0;c<this.bloomIterations;c++){let d=c*o+.1,_=1.2-d;d=Math.pow(d,this.power),_=Math.pow(_,this.power),this._weights[c]=_*(1-h)+d*h}this.setDirty()}};function addBloomData(h){const o=h==null?void 0:h.userData;return!!o&&(o[BloomPlugin.PluginType]||(o[BloomPlugin.PluginType]={}),o[BloomPlugin.PluginType].enable=!0,h.isMaterial&&(h.needsUpdate=!0),!0)}BloomPass_decorate([uniform()],BloomPass.prototype,"prefilter",void 0),BloomPass_decorate([uiSlider("Threshold",[0,2]),x$1(BloomPass.prototype._thresholdsUpdated),serialize()],BloomPass.prototype,"threshold",void 0),BloomPass_decorate([uiSlider("Soft Threshold",[0,1]),x$1(BloomPass.prototype._thresholdsUpdated),serialize()],BloomPass.prototype,"softThreshold",void 0),BloomPass_decorate([uiSlider("Intensity",[0,3]),serialize(),uniform()],BloomPass.prototype,"intensity",void 0),BloomPass_decorate([uiSlider("Iterations",[0,7],1),x$1(BloomPass.prototype._updateWeights),serialize()],BloomPass.prototype,"bloomIterations",void 0),BloomPass_decorate([uiSlider("Radius",[0,1],.01),x$1(BloomPass.prototype._updateWeights),serialize()],BloomPass.prototype,"radius",void 0),BloomPass_decorate([uiSlider("Power",[.2,10],.01),x$1(BloomPass.prototype._updateWeights),serialize()],BloomPass.prototype,"power",void 0),BloomPass_decorate([uiToggle("Debug")],BloomPass.prototype,"bloomDebug",void 0),BloomPass=BloomPass_decorate([uiFolder("Bloom")],BloomPass);class BloomPlugin extends GenericFilterPlugin{constructor(){super(...arguments),this.passId="bloom",this._beforeFilters=["combinedPost","screen"],this._afterFilters=["render","progressive"],this._requiredFilters=["render"],this.materialExtension={uuid:esm_browser_v4(),getUiConfig:o=>{if(o.__uiConfigs||(o.__uiConfigs={}),o.__uiConfigs[this.materialExtension.uuid])return o.__uiConfigs[this.materialExtension.uuid];const c=this._getUiConfig(o);return o.__uiConfigs[this.materialExtension.uuid]=c,c},isCompatible:o=>!0}}setDirty(){this.pass.dirty=!0}_getUiConfig(o){const c={type:"folder",label:"Bloom",children:[{type:"checkbox",label:"Enabled",get value(){var d,_;return(_=(d=o.materialObject.userData[BloomPlugin.PluginType])===null||d===void 0?void 0:d.enable)===null||_===void 0||_},set value(d){var _;const b=o.materialObject.userData[BloomPlugin.PluginType];d!==(b==null?void 0:b.enable)&&(b||addBloomData(o.materialObject),o.materialObject.userData[BloomPlugin.PluginType].enable=d,(_=c.uiRefresh)===null||_===void 0||_.call(c,"postFrame",!0))},onChange:this.setDirty}]};return c}passCtor(o){const c=new BloomPass(o.renderer.maxHDRIntensity);return this.updateGBuffer=this.updateGBuffer.bind(this),this.setDirty=this.setDirty.bind(this),c}async onAdded(o){var c,d;await super.onAdded(o),(c=o.getPlugin(GBufferPlugin))===null||c===void 0||c.registerGBufferUpdater(this.updateGBuffer);const _=o.getPlugin(AssetManagerPlugin);(d=_==null?void 0:_.materials)===null||d===void 0||d.registerMaterialExtension(this.materialExtension)}updateGBuffer(o,c){var d,_,b,_e;if(o instanceof three_module.eaF&&!((d=o.material)===null||d===void 0)&&d.userData){const it=((b=(_=o.material)===null||_===void 0?void 0:_.userData[BloomPlugin.PluginType])===null||b===void 0?void 0:b.enable)===!1||!((_e=o.material)===null||_e===void 0)&&_e.userData.pluginsDisabled?0:1;c.w=updateBit(c.w,2,it)}}_update(o){var c,d;return(c=o.getPlugin(GBufferPlugin))===null||c===void 0||c.updateShaderProperties((d=this.pass)===null||d===void 0?void 0:d.passObject.material),super._update(o)}get uiConfig(){var o;return(o=this.pass)===null||o===void 0?void 0:o.passObject.uiConfig}}BloomPlugin.PluginType="Bloom";var combineDepthOfField=`#include <common>
#include <packing>
varying vec2 vUv;uniform vec2 cocTextureSize;uniform vec2 nearFarBlurScale;uniform vec2 cameraNearFar;uniform vec2 focalDepthRange;uniform vec2 crossCenter;uniform float crossRadius;uniform float crossAlpha;uniform vec3 crossColor;float smoothBoundary(float d,float smooothFactor){smooothFactor*=0.5;float value=smoothstep(-smooothFactor,smooothFactor,d);return value;}float circle(vec2 p,float r){return min((length(p)-r),-(length(p)-r-0.01));}float computeCoc(){float depth=getDepth(vUv);if(depth>1.-0.01)return max(nearFarBlurScale.x,nearFarBlurScale.y);depth=mix(cameraNearFar.x,cameraNearFar.y,depth);float coc=(depth-focalDepthRange.x)/focalDepthRange.y;coc=clamp(coc,-1.,1.);return(coc>0.?coc*nearFarBlurScale.y:coc*nearFarBlurScale.x);}void main(){vec4 blur=blurTextureTexelToLinear(texture2D(blurTexture,vUv));float scale=0.5;blur+=blurTextureTexelToLinear(texture2D(blurTexture,vUv+scale*vec2(1.,1.)/cocTextureSize));blur+=blurTextureTexelToLinear(texture2D(blurTexture,vUv+scale*vec2(-1.,1.)/cocTextureSize));blur+=blurTextureTexelToLinear(texture2D(blurTexture,vUv+scale*vec2(-1.,-1.)/cocTextureSize));blur+=blurTextureTexelToLinear(texture2D(blurTexture,vUv+scale*vec2(1.,-1.)/cocTextureSize));blur/=5.;vec2 uvNearest=(floor(vUv*cocTextureSize)+0.5)/cocTextureSize;float coc=abs(min(2.*cocTextureTexelToLinear(texture2D(cocTexture,uvNearest)).a-1.,computeCoc()));float cocLower=0.005;float cocHigher=0.3;vec4 outColor=vec4(mix(colorTextureTexelToLinear(texture2D(colorTexture,vUv)).rgb,blur.rgb,smoothstep(cocLower,cocHigher,coc)),1.);vec2 d=vUv-crossCenter;if(length(d)>crossRadius+0.05){float dist=circle(d,crossRadius);gl_FragColor=outColor;}else{d.x*=cocTextureSize.x/cocTextureSize.y;float dist=circle(d,crossRadius);dist=smoothBoundary(dist,2.*fwidth(dist));vec4 color=outColor;vec3 dofCircleColor=mix(crossColor,color.rgb,1.-crossAlpha);gl_FragColor=vec4(mix(color.rgb,dofCircleColor,dist),color.a);}
#include <colorspace_fragment>
}`,computeCoCDoF=`#include <common>
#include <packing>
varying vec2 vUv;uniform vec2 nearFarBlurScale;uniform vec2 cameraNearFar;uniform vec2 focalDepthRange;float computeCoc(){float depth=getDepth(vUv);if(depth==1.)return max(nearFarBlurScale.x,nearFarBlurScale.y);depth=mix(cameraNearFar.x,cameraNearFar.y,depth);float coc=(depth-focalDepthRange.x)/focalDepthRange.y;coc=clamp(coc,-1.,1.);return(coc>0.?coc*nearFarBlurScale.y:coc*nearFarBlurScale.x);}void main(){gl_FragColor=vec4(colorTextureTexelToLinear(texture2D(colorTexture,vUv)).rgb,0.5*computeCoc()+0.5);
#include <colorspace_fragment>
}`,expandCoCDoF=`#include <common>
varying vec2 vUv;uniform vec2 colorTextureSize;uniform vec2 direction;uniform vec2 nearFarBlurScale;const float MAXIMUM_BLUR_SIZE=4.;float expandNear(const in vec2 offset,const in bool isBackground){float coc=0.;vec2 sampleOffsets=MAXIMUM_BLUR_SIZE*offset/5.;float coc0=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv)).a-1.;float coc1=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv-5.*sampleOffsets)).a-1.;float coc2=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv-4.*sampleOffsets)).a-1.;float coc3=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv-3.*sampleOffsets)).a-1.;float coc4=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv-2.*sampleOffsets)).a-1.;float coc5=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv-1.*sampleOffsets)).a-1.;float coc6=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv+1.*sampleOffsets)).a-1.;float coc7=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv+2.*sampleOffsets)).a-1.;float coc8=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv+3.*sampleOffsets)).a-1.;float coc9=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv+4.*sampleOffsets)).a-1.;float coc10=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv+5.*sampleOffsets)).a-1.;if(isBackground){coc=abs(coc0)*0.095474+(abs(coc1)+abs(coc10))*0.084264+(abs(coc2)+abs(coc9))*0.088139+(abs(coc3)+abs(coc8))*0.091276+(abs(coc4)+abs(coc7))*0.093585+(abs(coc5)+abs(coc6))*0.094998;}else{coc=min(coc0,0.);coc=min(coc1*0.3,coc);coc=min(coc2*0.5,coc);coc=min(coc3*0.75,coc);coc=min(coc4*0.8,coc);coc=min(coc5*0.95,coc);coc=min(coc6*0.95,coc);coc=min(coc7*0.8,coc);coc=min(coc8*0.75,coc);coc=min(coc9*0.5,coc);coc=min(coc10*0.3,coc);if(abs(coc0)>abs(coc))coc=coc0;}return coc;}void main(){vec2 offset=2.*direction/colorTextureSize;bool isBackground=getDepth(vUv)>1.-0.001;float coc=expandNear(offset,isBackground);gl_FragColor=vec4(colorTextureTexelToLinear(texture2D(colorTexture,vUv)).rgb,0.5*coc+0.5);
#include <colorspace_fragment>
}`,boxBlurDoF=`#include <common>
varying vec2 vUv;uniform vec2 colorTextureSize;uniform vec2 direction;const float MAXIMUM_BLUR_SIZE=16.;const float SIGMA=5.;const int NUM_SAMPLES=4;float normpdf(in float x,in float sigma){return 0.39894*exp(-0.5*x*x/(sigma*sigma))/sigma;}vec3 weightedBlur(){float cocIn=2.*cocTextureTexelToLinear(texture2D(cocTexture,vUv)).a-1.;float kernelRadius=MAXIMUM_BLUR_SIZE*cocIn;vec2 invSize=1./colorTextureSize;cocIn*=cocIn*cocIn;float centerSpaceWeight=normpdf(0.,SIGMA)*abs(cocIn);float weightSum=centerSpaceWeight;vec3 centerSample=colorTextureTexelToLinear(texture2D(colorTexture,vUv)).rgb;vec3 diffuseSum=centerSample*weightSum;vec2 delta=invSize*kernelRadius/float(NUM_SAMPLES);for(int i=1;i<=NUM_SAMPLES;i++){float spaceWeight=normpdf(float(i),SIGMA);vec2 texcoord=direction*delta*float(i);vec4 rightSample=colorTextureTexelToLinear(texture2D(colorTexture,vUv+texcoord));vec4 leftSample=colorTextureTexelToLinear(texture2D(colorTexture,vUv-texcoord));float leftCocWeight=abs(2.*cocTextureTexelToLinear(texture2D(cocTexture,vUv-texcoord)).a-1.);float rightCocWeight=abs(2.*cocTextureTexelToLinear(texture2D(cocTexture,vUv+texcoord)).a-1.);leftCocWeight*=leftCocWeight*leftCocWeight;rightCocWeight*=rightCocWeight*rightCocWeight;diffuseSum+=((leftSample.rgb*leftCocWeight)+(rightSample.rgb*rightCocWeight))*spaceWeight;weightSum+=(spaceWeight*(leftCocWeight+rightCocWeight));}return diffuseSum/weightSum;}void main(){gl_FragColor=vec4(weightedBlur(),1.);
#include <colorspace_fragment>
}`,poissonBlurDoF=`#include <common>
varying vec2 vUv;uniform vec2 colorTextureSize;uniform float blurRadius;vec4 CircularBlur(){vec4 color=colorTextureTexelToLinear(texture2D(colorTexture,vUv));
#ifdef DOF_MODE
float blurDist=blurRadius*(2.*color.a-1.);
#else
float blurDist=blurRadius*color.a;
#endif
float rnd=PI2*random3(vec3(vUv,frameCount*0.1));float costheta=cos(rnd);float sintheta=sin(rnd);vec4 rotationMatrix=vec4(costheta,-sintheta,sintheta,costheta);vec3 colorSum=vec3(0.);float weightSum=0.001;vec2 ofs;vec4 sampleColor;setPds();
#pragma unroll_loop_start
for(int i=0;i<16;i++){ofs=poisson_disk_samples[UNROLLED_LOOP_INDEX];ofs=vec2(dot(ofs,rotationMatrix.xy),dot(ofs,rotationMatrix.zw));sampleColor=colorTextureTexelToLinear(texture2D(colorTexture,vUv+blurDist*ofs/colorTextureSize.xy));
#ifdef DOF_MODE
sampleColor.a=abs(sampleColor.a*2.-1.);sampleColor.a*=sampleColor.a*sampleColor.a;
#endif
colorSum+=sampleColor.rgb*sampleColor.a;weightSum+=sampleColor.a;}
#pragma unroll_loop_end
colorSum/=weightSum;return vec4(min(vec3(72.),max(vec3(0.),colorSum)),1.);}void main(){gl_FragColor=CircularBlur();
#include <colorspace_fragment>
}`,poissonDiskSamples="vec2 poisson_disk_samples[16];void setPds(){poisson_disk_samples[0]=vec2(-0.399691779231,0.728591545584);poisson_disk_samples[1]=vec2(-0.48622557676,-0.84016533712);poisson_disk_samples[2]=vec2(0.770309468987,-0.24906070432);poisson_disk_samples[3]=vec2(0.556596796154,0.820359876432);poisson_disk_samples[4]=vec2(-0.933902004071,0.0600539051593);poisson_disk_samples[5]=vec2(0.330144964342,0.207477293384);poisson_disk_samples[6]=vec2(0.289013230975,-0.686749271417);poisson_disk_samples[7]=vec2(-0.0832470893559,-0.187351643125);poisson_disk_samples[8]=vec2(-0.296314525615,0.254474834305);poisson_disk_samples[9]=vec2(-0.850977666059,0.484642744689);poisson_disk_samples[10]=vec2(0.829287915319,0.2345063545);poisson_disk_samples[11]=vec2(-0.773042143899,-0.543741521254);poisson_disk_samples[12]=vec2(0.0561133030864,0.928419742597);poisson_disk_samples[13]=vec2(-0.205799249508,-0.562072714492);poisson_disk_samples[14]=vec2(-0.526991665882,-0.193690188118);poisson_disk_samples[15]=vec2(-0.051789270667,-0.935374050821);}",DepthOfFieldPass_decorate=function(h,o,c,d){var _,b=arguments.length,_e=b<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_e=Reflect.decorate(h,o,c,d);else for(var it=h.length-1;it>=0;it--)(_=h[it])&&(_e=(b<3?_(_e):b>3?_(o,c,_e):_(o,c))||_e);return b>3&&_e&&Object.defineProperty(o,c,_e),_e};const combineDofShader={uniforms:{colorTexture:{value:null},tNormalDepth:{value:null},blurTexture:{value:null},cocTexture:{value:null},cocTextureSize:{value:new three_module.I9Y},cameraNearFar:{value:new three_module.I9Y}},vertexShader:defaultVertex,fragmentShader:unpackGbuffer+`
`+combineDepthOfField};patchShaderEncodingSupport({uniforms:{cocTexture:{value:null},colorTexture:{value:null},colorTextureSize:{value:new three_module.I9Y},direction:{value:new three_module.I9Y}},vertexShader:defaultVertex,fragmentShader:boxBlurDoF},"colorTexture","cocTexture");const dofBlurMaterialPoisson=patchShaderEncodingSupport({uniforms:{colorTexture:{value:null},colorTextureSize:{value:new three_module.I9Y},direction:{value:new three_module.I9Y},frameCount:{value:0},blurRadius:{value:16}},vertexShader:defaultVertex,fragmentShader:randomHelpers+`
`+poissonDiskSamples+`
`+poissonBlurDoF,defines:{DOF_MODE:1}},"colorTexture");class DepthOfFieldPass extends ShaderPass2{constructor(){super(combineDofShader,"colorTexture","cocTexture","blurTexture"),this.dofBlurMaterial=dofBlurMaterialPoisson,this.nearFarBlurScale=new three_module.I9Y(.25,.25),this.focalDepthRange=new three_module.I9Y(.5,1.5),this.crossCenter=new three_module.I9Y(.5,.5),this.crossRadius=.04,this.crossAlpha=1,this.crossColor=new three_module.Q1f(16750848),this.uiConfig={type:"folder",label:"Depth of Field",children:[{type:"checkbox",label:"Enabled",limitedUi:!0,property:[this,"enabled"]},{type:"slider",label:"Depth Range",bounds:[.5,3],property:[this.focalDepthRange,"y"]},{type:"slider",label:"Near Blur scale",bounds:[0,1],property:[this.nearFarBlurScale,"x"]},{type:"slider",label:"Far Blur scale",bounds:[0,1],property:[this.nearFarBlurScale,"y"]}]},this.material.extensions.derivatives=!0,this.computeCocMaterial=patchShaderEncodingSupport({uniforms:{colorTexture:{value:null},tNormalDepth:this.uniforms.tNormalDepth,cameraNearFar:this.uniforms.cameraNearFar,nearFarBlurScale:this.uniforms.nearFarBlurScale,focalDepthRange:this.uniforms.focalDepthRange},vertexShader:defaultVertex,fragmentShader:unpackGbuffer+`
`+computeCoCDoF},"colorTexture"),this.expandCocMaterial=patchShaderEncodingSupport({uniforms:{colorTexture:{value:null},colorTextureSize:{value:new three_module.I9Y},direction:{value:new three_module.I9Y},tNormalDepth:this.uniforms.tNormalDepth,nearFarBlurScale:this.uniforms.nearFarBlurScale},vertexShader:defaultVertex,fragmentShader:unpackGbuffer+`
`+expandCoCDoF},"colorTexture")}render(o,c,d,_,b){if(!this.enabled)return;const _e=o.baseRenderer,it={minFilter:three_module.hxR,magFilter:three_module.hxR,type:three_module.ix0,colorSpace:three_module.Zr2,sizeMultiplier:.5,format:three_module.GWd,depthBuffer:!1,generateMipmaps:!1},nt=_e.getTempTarget(it),at=_e.getTempTarget(it);if(this.computeCocMaterial.uniforms.colorTexture.value=d.texture,_e.blit(void 0,nt,{material:this.computeCocMaterial}),this.expandCocMaterial.uniforms.colorTexture.value=nt.texture,this.expandCocMaterial.uniforms.direction.value.set(1,0),_e.blit(void 0,at,{material:this.expandCocMaterial}),this.expandCocMaterial.uniforms.colorTexture.value=at.texture,this.expandCocMaterial.uniforms.direction.value.set(0,1),_e.blit(void 0,nt,{material:this.expandCocMaterial}),this.dofBlurMaterial.uniforms.frameCount)this.dofBlurMaterial.uniforms.colorTexture.value=nt.texture,_e.blit(void 0,at,{material:this.dofBlurMaterial});else{const ut=_e.getTempTarget(it);this.dofBlurMaterial.uniforms.cocTexture.value=nt.texture,this.dofBlurMaterial.uniforms.colorTexture.value=nt.texture,this.dofBlurMaterial.uniforms.direction.value.set(1,0),_e.blit(void 0,ut,{material:this.dofBlurMaterial}),this.dofBlurMaterial.uniforms.colorTexture.value=ut.texture,this.dofBlurMaterial.uniforms.direction.value.set(0,1),_e.blit(void 0,at,{material:this.dofBlurMaterial}),_e.releaseTempTarget(ut)}this.material.uniforms.blurTexture.value=at.texture,this.material.uniforms.cocTexture.value=nt.texture,super.render(o,c,d,_,b),_e.releaseTempTarget(nt),_e.releaseTempTarget(at)}}DepthOfFieldPass_decorate([serialize(),uniform()],DepthOfFieldPass.prototype,"nearFarBlurScale",void 0),DepthOfFieldPass_decorate([serialize(),uniform()],DepthOfFieldPass.prototype,"focalDepthRange",void 0),DepthOfFieldPass_decorate([uniform()],DepthOfFieldPass.prototype,"crossCenter",void 0),DepthOfFieldPass_decorate([uniform()],DepthOfFieldPass.prototype,"crossRadius",void 0),DepthOfFieldPass_decorate([uniform()],DepthOfFieldPass.prototype,"crossAlpha",void 0),DepthOfFieldPass_decorate([uniform()],DepthOfFieldPass.prototype,"crossColor",void 0);class AddBlendPass extends ShaderPass2{constructor(o,c=120){super({vertexShader:CopyShader.vertexShader,fragmentShader:fe$1`
                uniform vec4 weight;
                uniform vec4 weight2;
                varying vec2 vUv;
                void main() {
                    vec4 texel = clamp(weight * tDiffuseTexelToLinear ( texture2D( tDiffuse, vUv ) ) + weight2 * tDiffuse2TexelToLinear ( texture2D( tDiffuse2, vUv ) ), vec4(0), vec4(MAX_INTENSITY));
                    gl_FragColor = texel;
                    #include <colorspace_fragment>
                }
            `,uniforms:{tDiffuse:{value:null},tDiffuse2:{value:o},weight:{value:new three_module.IUQ(1,1,1,1)},weight2:{value:new three_module.IUQ(1,1,1,1)}},defines:{MAX_INTENSITY:c}},"tDiffuse","tDiffuse2"),this.clear=!1,this.needsSwap=!0}set weights2(o){this.uniforms.weight2.value.copy(o)}get weights2(){return this.uniforms.weight2.value}set weights1(o){this.uniforms.weight.value.copy(o)}get weights1(){return this.uniforms.weight.value}set blendTexture(o){this.uniforms.tDiffuse2.value=o}}var ProgressivePlugin_decorate=function(h,o,c,d){var _,b=arguments.length,_e=b<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_e=Reflect.decorate(h,o,c,d);else for(var it=h.length-1;it>=0;it--)(_=h[it])&&(_e=(b<3?_(_e):b>3?_(o,c,_e):_(o,c))||_e);return b>3&&_e&&Object.defineProperty(o,c,_e),_e};const offsets=[{x:0,y:0},{x:-.5,y:0},{x:-.375,y:-.25},{x:-.1875,y:-.125},{x:-.125,y:-.375},{x:.0625,y:-.0625},{x:.125,y:-.3125},{x:.375,y:-.4375},{x:.3125,y:-.1875},{x:.25,y:.0625},{x:.4375,y:.25},{x:.1875,y:.3125},{x:0,y:.4375},{x:-.0625,y:.1875},{x:-.25,y:.375},{x:-.4375,y:.5},{x:-.3125,y:.125}];class ProgressivePlugin extends MultiFilterPlugin{constructor(o=2*offsets.length){super(),this._lastFrames=new Map,this.enabled=!0,this.jitter=!0,this._hasSetOffset=!1,this.trackedJitterCameras=new Set,this._addSceneObject=c=>{const d=c.object;(d.modelObject||d.lightObject)&&(d.modelObject||d.lightObject).traverse(_=>{var b;!((b=_==null?void 0:_.shadow)===null||b===void 0)&&b.camera&&_.shadow.mapSize&&this.trackedJitterCameras.add([_.shadow.camera,_.shadow.mapSize])})},this._jitterCamera=c=>{var d;const _=c.target;if(this.jitter&&_.renderer.frameCount>1){const b=(it,nt)=>{const at={...offsets[_.renderer.frameCount%offsets.length]};it.setViewOffset(nt.width,nt.height,at.x,at.y,nt.width,nt.height)},_e=_.scene.activeCamera.cameraObject;b(_e,{width:_.canvas.clientWidth*_.renderer.displayCanvasScaling,height:_.canvas.clientHeight*_.renderer.displayCanvasScaling}),this.trackedJitterCameras.forEach(it=>b(...it)),this._hasSetOffset=!0,(d=this._viewer)===null||d===void 0||d.renderer.resetShadows()}},this._resetCameraJitter=c=>{const d=c.target;this._hasSetOffset&&(d.scene.activeCamera.cameraObject.clearViewOffset(),this._hasSetOffset=!1)},this.uiConfig=generateUiFolder("Progressive",this),this.maxFrameCount=o}async onAdded(o){return await super.onAdded(o)}async onRemove(o){o.removeEventListener("preRender",this._jitterCamera),o.removeEventListener("postRender",this._resetCameraJitter),o.scene.removeEventListener("addSceneObject",this._addSceneObject),this._lastFrames.forEach(c=>o.renderer.disposeTarget(c)),this._lastFrames.clear(),await super.onRemove(o)}get lastFrame(){var o;return this._lastFrames.get((o=this._viewer)===null||o===void 0?void 0:o.scene.renderCamera.cameraObject.uuid)}getLastFrame(o){return o?this._lastFrames.get(o.cameraObject.uuid):this.lastFrame}createPasses(o){o.addEventListener("preRender",this._jitterCamera),o.addEventListener("postRender",this._resetCameraJitter),o.scene.addEventListener("addSceneObject",this._addSceneObject);const c=this;return[makeFilter(o,{passId:"progressive",get dirty(){var d;return c.jitter&&(((d=c._viewer)===null||d===void 0?void 0:d.renderer.frameCount)||0)<c.maxFrameCount},after:["render"],before:["combinedPost","screen"],required:["render"],passObject:new class extends AddBlendPass{render(d,_,b,_e,it){if(c.lastFrame){if(o.renderer.frameCount<1)return this.needsSwap=!1,void((b==null?void 0:b.texture)&&o.renderer.blit(b.texture,c.lastFrame,{}));this.needsSwap=!0,super.render(d,_,b,_e,it),o.renderer.blit(_.texture,c.lastFrame,{})}else o.console.error("lastFrame render target undefined")}}(void 0,o.renderer.maxHDRIntensity||120),update(){if(!c.lastFrame&&o.scene.renderCamera&&c._lastFrames.set(o.scene.renderCamera.cameraObject.uuid,o.renderer.composerTarget.clone(!0)),!c.lastFrame)return void console.error("lastFrame render target undefined");let d=1/(Math.max(o.renderer.frameCount,0)+1);this.passObject.weights1.set(d,d,d,d),d=1-d,this.passObject.weights2.set(d,d,d,d),this.passObject.blendTexture=c.lastFrame.texture,this.passObject.material.uniformsNeedUpdate=!0}})]}isConverged(o=!1){var c;return(((c=this._viewer)===null||c===void 0?void 0:c.renderer.frameCount)||0)>=this.maxFrameCount-1+(o?1:0)}updateShaderProperties(o){var c,d;return o.uniforms.tLastFrame&&(o.uniforms.tLastFrame.value=(d=(c=this.lastFrame)===null||c===void 0?void 0:c.texture)!==null&&d!==void 0?d:void 0),this}postFrameConvergedRecordingDelta(o="CanvasRecorder"){const c=this._viewer.getPluginByType(o);return c&&c.isRecording()&&c.convergeMode?this.isConverged(!0)?1/c.videoFrameRate:0:-1}}ProgressivePlugin.PluginType="Progressive",ProgressivePlugin_decorate([serialize(),uiInput("Frame count")],ProgressivePlugin.prototype,"maxFrameCount",void 0),ProgressivePlugin_decorate([serialize(),uiToggle("Jitter")],ProgressivePlugin.prototype,"jitter",void 0);class FrameFadePlugin extends GenericFilterPlugin{async startTransition(o){this._viewer&&this._pass&&!this.isDisabled()&&(this._target||(this._target=this._viewer.renderer.getTempTarget({sizeMultiplier:1,minFilter:three_module.k6q,magFilter:three_module.k6q,colorSpace:this._viewer.renderer.composerTarget.texture.colorSpace})),this._fadeTimeState<500&&(this._toSaveFrame=!0),this._fadeTimeState=Math.max(o,this._fadeTimeState),this._fadeTime=this._fadeTimeState,this.setDirty(),await X$2(o))}stopTransition(){this._fadeTimeState=0}constructor(){super(),this.passId="frameFade",this._fadeTime=0,this._fadeTimeState=0,this._toSaveFrame=!1,this._beforeFilters=["progressive","taa"],this._afterFilters=["render"],this._requiredFilters=["render","progressive"],this.dependencies=[ProgressivePlugin],this.isEditor=!1,this.fadeOnActiveCameraChange=!0,this.fadeOnMaterialUpdate=!0,this.fadeOnSceneUpdate=!0,this.pointerEnabled=!0,this._fadeCam=o=>o.frameFade!==!1&&!this.isEditor&&this.fadeOnActiveCameraChange&&this.startTransition(o.fadeDuration||1e3),this._fadeMat=o=>{o.frameFade!==!1&&!this.isEditor&&this.fadeOnMaterialUpdate&&this.startTransition(o.fadeDuration||200)},this._fadeScene=o=>{o.frameFade!==!1&&!this.isEditor&&this.fadeOnSceneUpdate&&this.startTransition(o.fadeDuration||500)},this._onPointerMove=o=>{var c;const d=(c=this._viewer)===null||c===void 0?void 0:c.canvas;if(!d)return void(this.pointerEnabled=!1);if(!o.buttons||o.target!==d)return void(this.pointerEnabled=!0);const _=d.getBoundingClientRect(),b=(o.clientX-_.left)/_.width,_e=(o.clientY-_.top)/_.height;this.pointerEnabled=b<0||b>1||_e<0||_e>1},this._disabledBy=[],this.startTransition=this.startTransition.bind(this),this.stopTransition=this.stopTransition.bind(this),this._fadeCam=this._fadeCam.bind(this),this._fadeMat=this._fadeMat.bind(this)}async onAdded(o){await super.onAdded(o),o.scene.addEventListener("activeCameraChange",this._fadeCam),o.scene.addEventListener("activeCameraUpdate",this.stopTransition),o.scene.addEventListener("sceneMaterialUpdate",this._fadeMat),o.scene.addEventListener("sceneUpdate",this._fadeScene),window.addEventListener("pointermove",this._onPointerMove)}async onRemove(o){return o.scene.removeEventListener("activeCameraChange",this._fadeCam),o.scene.removeEventListener("activeCameraUpdate",this.stopTransition),o.scene.removeEventListener("sceneMaterialUpdate",this._fadeMat),o.scene.removeEventListener("sceneUpdate",this._fadeScene),window.removeEventListener("pointermove",this._onPointerMove),super.onRemove(o)}passCtor(o){const c=this,d=o.getPlugin(ProgressivePlugin),_=new class extends AddBlendPass{constructor(){super(...arguments),this._lastTime=0,this._saveNextFrame=!1,this.uiConfig=generateUiFolder("Frame Fade",this)}render(b,_e,it,nt,at){this.needsSwap=!1;const ut=c._target;if(!ut||!c.pointerEnabled||!this.enabled||!c.dirty||c._fadeTimeState<.001||o.scene.renderCamera!==o.scene.activeCamera)return;c._toSaveFrame&&(this._saveNextFrame=!0,c._toSaveFrame=!1),this._saveNextFrame&&d.lastFrame&&(o.renderer.blit(d.lastFrame.texture,ut),this._lastTime=0,this._saveNextFrame=!1),this.blendTexture=ut==null?void 0:ut.texture;const pt=c._fadeTimeState/c._fadeTime;this.weights2.setScalar(pt),this.weights2.w=1,this.weights1.setScalar(1-pt),this.weights1.w=1,super.render(b,_e,it,nt,at),this.needsSwap=!0;const mt=g();this._lastTime<10&&(this._lastTime=mt-10);const ft=mt-this._lastTime;this._lastTime=mt,c._fadeTimeState-=ft}}(void 0,o.renderer.maxHDRIntensity);return _.enabled=!0,_}setDirty(){var o;this.enabled&&((o=this._viewer)===null||o===void 0||o.setDirty())}get dirty(){return this.enabled&&this._fadeTimeState>0}set dirty(o){console.warn("FrameFadePlugin.dirty is readonly")}_update(o){return!!super._update(o)&&(this.isDisabled()&&this.stopTransition(),this._fadeTimeState<1&&(this._toSaveFrame=!1,this._target&&this._viewer&&(this._viewer.renderer.releaseTempTarget(this._target),this._target=void 0)),!0)}get uiConfig(){var o,c;return(c=(o=this.pass)===null||o===void 0?void 0:o.passObject)===null||c===void 0?void 0:c.uiConfig}disable(o){this._disabledBy.includes(o)||this._disabledBy.push(o)}enable(o){const c=this._disabledBy.indexOf(o);c>=0&&this._disabledBy.splice(c,1)}isDisabled(){return!this.pointerEnabled||this._disabledBy.length>0||!this.enabled}}FrameFadePlugin.PluginType="FrameFade";var DepthOfFieldPlugin_decorate=function(h,o,c,d){var _,b=arguments.length,_e=b<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_e=Reflect.decorate(h,o,c,d);else for(var it=h.length-1;it>=0;it--)(_=h[it])&&(_e=(b<3?_(_e):b>3?_(o,c,_e):_(o,c))||_e);return b>3&&_e&&Object.defineProperty(o,c,_e),_e};class DepthOfFieldPlugin extends GenericFilterPlugin{passCtor(o){return new DepthOfFieldPass}constructor(o=!0,c=!1){super(),this.passId="depthOfField",this._beforeFilters=["progressive","tonemap","screen"],this._afterFilters=["render"],this._requiredFilters=["render"],this.dependencies=[GBufferPlugin],this.enableEdit=!1,this._focalPointHit=new three_module.Pq0(0,0,0),this.crossFadeTime=200,this._focalPointHitTime=0,this._tempVec=new three_module.Pq0,this.enabled=o,this.enableEdit=c,this._onObjectHit=this._onObjectHit.bind(this),this.setDirty=this.setDirty.bind(this)}setFocalPoint(o,c=!0,d=!1){var _,b;this._focalPointHit.copy(o),c&&((b=(_=this._viewer)===null||_===void 0?void 0:_.getPlugin(FrameFadePlugin))===null||b===void 0||b.startTransition(this._frameFadeTime)),d&&(this._focalPointHitTime=g()),this.setDirty()}getFocalPoint(){return this._focalPointHit}get depthRange(){var o,c;return(c=(o=this.pass)===null||o===void 0?void 0:o.passObject.focalDepthRange.y)!==null&&c!==void 0?c:0}set depthRange(o){this.pass&&(this.pass.passObject.focalDepthRange.y=o),this.setDirty()}get nearBlurScale(){var o,c;return(c=(o=this.pass)===null||o===void 0?void 0:o.passObject.nearFarBlurScale.x)!==null&&c!==void 0?c:0}set nearBlurScale(o){this.pass&&(this.pass.passObject.nearFarBlurScale.x=o),this.setDirty()}get farBlurScale(){var o,c;return(c=(o=this.pass)===null||o===void 0?void 0:o.passObject.nearFarBlurScale.y)!==null&&c!==void 0?c:0}set farBlurScale(o){this.pass&&(this.pass.passObject.nearFarBlurScale.y=o),this.setDirty()}get _frameFadeTime(){return 2.5*this.crossFadeTime}_onObjectHit(o){var c,d;this._pass&&o.intersects.intersect&&this.enabled&&this.enableEdit&&(this._focalPointHit.copy(o.intersects.intersect.point),this._focalPointHitTime=o.time,o.intersects.selectedObject=null,(d=(c=this._viewer)===null||c===void 0?void 0:c.getPlugin(FrameFadePlugin))===null||d===void 0||d.startTransition(this._frameFadeTime),this.setDirty())}async onAdded(o){var c;await super.onAdded(o),(c=o.getPluginByType("Picking"))===null||c===void 0||c.addEventListener("hitObject",this._onObjectHit)}async onRemove(o){var c;return(c=o.getPluginByType("Picking"))===null||c===void 0||c.removeEventListener("hitObject",this._onObjectHit),super.onRemove(o)}setDirty(){var o;(o=this._viewer)===null||o===void 0||o.setDirty()}_update(o){var c,d;if(!super._update(o))return!1;const _=(c=this.pass)===null||c===void 0?void 0:c.passObject;if(!_)return!1;const b=o.getPlugin(GBufferPlugin);b==null||b.updateShaderProperties(_.material),_.dofBlurMaterial.uniforms.frameCount&&((d=o.renderer)===null||d===void 0||d.updateShaderProperties(_.dofBlurMaterial));const _e=o.scene.renderCamera;if(!_e)return!1;_e.cameraObject.updateMatrixWorld(!0),_e.updateShaderProperties(_.material),_e.cameraObject.getWorldPosition(this._tempVec),this._tempVec.subVectors(this._focalPointHit,this._tempVec),_.focalDepthRange.x=this._tempVec.length(),_.focalDepthRange.x*=_e.cameraObject.getWorldDirection(new three_module.Pq0).dot(this._tempVec.normalize());let it=(g()-this._focalPointHitTime)/this.crossFadeTime;if(it=1-Math.min(1,Math.max(0,it)),Math.abs(it-_.crossAlpha)>.01&&(_.crossAlpha=it,this.setDirty()),it>0){const nt=this._tempVec.copy(this._focalPointHit).project(_e.cameraObject).addScalar(1).divideScalar(2);_.crossCenter.set(nt.x,nt.y),_.computeCocMaterial.uniformsNeedUpdate=!0,_.expandCocMaterial.uniformsNeedUpdate=!0}return!0}get uiConfig(){var o,c,d,_,b;if(this._uiConfig)return this._uiConfig;const _e=(c=(o=this._pass)===null||o===void 0?void 0:o.passObject)===null||c===void 0?void 0:c.uiConfig;return _e?((_=(d=_e.children)===null||d===void 0?void 0:d.map(it=>Ee$1(it)))===null||_===void 0||_.flat(2).forEach(it=>it&&(it.onChange=this.setDirty)),(b=_e.children)===null||b===void 0||b.push({type:"checkbox",label:"Enable Edit",limitedUi:!0,property:[this,"enableEdit"]}),this._uiConfig=_e,_e):{}}}DepthOfFieldPlugin.PluginType="DepthOfField",DepthOfFieldPlugin_decorate([serialize()],DepthOfFieldPlugin.prototype,"enableEdit",void 0),DepthOfFieldPlugin_decorate([serialize("focalPoint")],DepthOfFieldPlugin.prototype,"_focalPointHit",void 0),DepthOfFieldPlugin_decorate([serialize()],DepthOfFieldPlugin.prototype,"crossFadeTime",void 0);var voronoise=`#ifndef VORONOISE_HELPER
#define VORONOISE_HELPER 
float voronoise(in vec2 p,float u,float v){float k=1.+63.*pow(max(0.,1.-v),6.);vec2 i=floor(p);vec2 f=fract(p);vec2 a=vec2(0.,0.);for(int y=-2;y<=2;y++)for(int x=-2;x<=2;x++){vec2 g=vec2(x,y);vec3 o=hash3(i+g)*vec3(u,u,1.);vec2 d=g-f+o.xy;float w=pow(max(0.,1.-smoothstep(0.,1.414,length(d))),k);a+=vec2(o.z*w,w);}return a.x/a.y;}vec3 voronoise3(vec2 p,float u,float v){return vec3(voronoise(p,u,v),voronoise(p+vec2(0.435,0.23),u,v),voronoise(p-vec2(0.83,0.45),u,v));}vec3 voronoiseNormal(vec2 p,float u,float v){return vec3(voronoise(p,u,v),voronoise(p+vec2(0.435,0.23),u,v),1.);}
#endif
`,thinFilmLayer="vec3 incident=normalize(vViewPosition.xyz);float hWeight=1.-dot(normal,incident);vec3 noiseV=voronoise3(vUv.xy*thinColorNoiseParams.xy*60.,thinColorNoiseParams.z,thinColorNoiseParams.w);float hWeight2=1.-dot(normalize(noiseV),incident);vec3 film=hsv2rgb(vec3(fract(hWeight+thinBaseLayerFactors.x),thinBaseLayerFactors.y,thinBaseLayerFactors.z))*thinBaseLayerFactors.a;vec3 film2=hsv2rgb(vec3(fract(hWeight2+thinNoiseLayerFactors.x),thinNoiseLayerFactors.y,thinNoiseLayerFactors.z))*thinNoiseLayerFactors.a;film=(film+film2)/(thinBaseLayerFactors.a+thinNoiseLayerFactors.a);diffuseColor.rgb=mix(diffuseColor.rgb,film,thinFilmFactor);",hsvHelpers=`#ifndef HSV_HELPERS
#define HSV_HELPERS 
vec3 hsv2rgb(vec3 c){vec4 K=vec4(1.,2./3.,1./3.,3.);vec3 p=abs(fract(c.xxx+K.xyz)*6.-K.www);return c.z*mix(K.xxx,clamp(p-K.xxx,0.,1.),c.y);}vec3 rgb2hsv(vec3 c){vec4 K=vec4(0.,-1./3.,2./3.,-1.);vec4 p=c.g<c.b?vec4(c.bg,K.wz):vec4(c.gb,K.xy);vec4 q=c.r<p.x?vec4(p.xyw,c.r):vec4(c.r,p.yzx);float d=q.x-min(q.w,q.y);float e=1.0e-10;return vec3(abs(q.z+(q.w-q.y)/(6.*d+e)),d/(q.x+e),q.x);}
#endif 
`,ThinFilmLayerPlugin_decorate=function(h,o,c,d){var _,b=arguments.length,_e=b<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_e=Reflect.decorate(h,o,c,d);else for(var it=h.length-1;it>=0;it--)(_=h[it])&&(_e=(b<3?_(_e):b>3?_(o,c,_e):_(o,c))||_e);return b>3&&_e&&Object.defineProperty(o,c,_e),_e};let ThinFilmLayerPlugin=class extends AViewerPlugin{addThinFilmLayer(h){return addThinFilmLayer(h.materialObject)}_loaderCreate({loader:h}){h.isGLTFLoader2&&h.register(o=>new GLTFMaterialsThinFilmLayerExtensionImport(o))}constructor(){super(),this.enabled=!0,this.dependencies=[AssetManagerPlugin],this._defines={},this._uniforms={thinBaseLayerFactors:{value:new three_module.IUQ},thinNoiseLayerFactors:{value:new three_module.IUQ},thinColorNoiseParams:{value:new three_module.IUQ},thinFilmFactor:{value:.8}},this.materialExtension={parsFragmentSnippet:(h,o)=>{var c;return this.enabled&&!((c=o==null?void 0:o.materialObject.userData._thinFilmLayer)===null||c===void 0)&&c.hasThinFilm?randomHelpers+`
`+voronoise+`
`+hsvHelpers+`
uniform vec4 thinBaseLayerFactors;
uniform vec4 thinNoiseLayerFactors;
uniform vec4 thinColorNoiseParams;
uniform float thinFilmFactor;
        `:""},shaderExtender:(h,o,c)=>{var d;if(!this.enabled||!(!((d=o.materialObject.userData._thinFilmLayer)===null||d===void 0)&&d.hasThinFilm))return;const _="#glMarker beforeAccumulation";h.fragmentShader=h.fragmentShader.replace(_,thinFilmLayer+_),h.defines.USE_UV=""},onObjectRender:(h,o)=>{var c;const d=(c=o.materialObject.userData)===null||c===void 0?void 0:c._thinFilmLayer;if(!(d!=null&&d.hasThinFilm))return;this._uniforms.thinBaseLayerFactors.value.fromArray(d.baseLayerFactors),this._uniforms.thinNoiseLayerFactors.value.fromArray(d.noiseLayerFactors),this._uniforms.thinColorNoiseParams.value.fromArray(d.colorNoiseParams),this._uniforms.thinFilmFactor.value=d.filmFactor;const _=this.enabled?1:0;o.materialObject.defines.THIN_FILM_LAYER_ENABLED!==_&&(o.materialObject.defines.THIN_FILM_LAYER_ENABLED=_,o.materialObject.needsUpdate=!0)},extraUniforms:{...this._uniforms},computeCacheKey:h=>{var o,c;return(this.enabled?"1":"0")+(!((c=(o=h.materialObject.userData)===null||o===void 0?void 0:o._thinFilmLayer)===null||c===void 0)&&c.hasThinFilm?"1":"0")},isCompatible:h=>h.isMeshStandardMaterial2||h.isDiamondMaterial,updaters:()=>[],getUiConfig:h=>{const o=this._viewer,c={type:"folder",label:"ThinFilmLayer",children:[{type:"checkbox",label:"Enabled",get value(){var d;return((d=h.materialObject.userData._thinFilmLayer)===null||d===void 0?void 0:d.hasThinFilm)||!1},set value(d){var _,b;d!==((_=h.materialObject.userData._thinFilmLayer)===null||_===void 0?void 0:_.hasThinFilm)&&(d?addThinFilmLayer(h.materialObject)||o.alert("Cannot add thin film."):h.materialObject.userData._thinFilmLayer&&(h.materialObject.userData._thinFilmLayer.hasThinFilm=!1,h.materialObject.needsUpdate=!0),(b=c.uiRefresh)===null||b===void 0||b.call(c,"postFrame",!0))},onChange:this.setDirty},()=>({type:"slider",bounds:[0,1],label:"Intensity",hidden:()=>{var d;return!(!((d=h.materialObject.userData._thinFilmLayer)===null||d===void 0)&&d.hasThinFilm)},property:[h.materialObject.userData._thinFilmLayer,"filmFactor"],onChange:this.setDirty}),()=>({type:"vec4",label:"Base Layer",bounds:[0,1],hidden:()=>{var d;return!(!((d=h.materialObject.userData._thinFilmLayer)===null||d===void 0)&&d.hasThinFilm)},property:[h.materialObject.userData._thinFilmLayer,"baseLayerFactors"],onChange:this.setDirty}),()=>({type:"vec4",label:"Noise Layer",bounds:[0,1],hidden:()=>{var d;return!(!((d=h.materialObject.userData._thinFilmLayer)===null||d===void 0)&&d.hasThinFilm)},property:[h.materialObject.userData._thinFilmLayer,"noiseLayerFactors"],onChange:this.setDirty}),()=>({type:"vec4",label:"Noise Params",bounds:[0,1],hidden:()=>{var d;return!(!((d=h.materialObject.userData._thinFilmLayer)===null||d===void 0)&&d.hasThinFilm)},property:[h.materialObject.userData._thinFilmLayer,"colorNoiseParams"],onChange:this.setDirty})]};return c}},this.setDirty=()=>{var h;(h=this._viewer)===null||h===void 0||h.setDirty()},this._loaderCreate=this._loaderCreate.bind(this)}async onAdded(h){var o,c,d,_,b;await super.onAdded(h);const _e=h.getPlugin(AssetManagerPlugin);(o=_e==null?void 0:_e.materials)===null||o===void 0||o.registerMaterialExtension(this.materialExtension),(c=_e==null?void 0:_e.importer)===null||c===void 0||c.addEventListener("loaderCreate",this._loaderCreate),(b=(_=(d=_e==null?void 0:_e.exporter)===null||d===void 0?void 0:d.getExporter("gltf","glb"))===null||_===void 0?void 0:_.extensions)===null||b===void 0||b.push(glTFMaterialsThinFilmLayerExtensionExport)}async onRemove(h){var o,c,d,_;return(c=(o=h.getPlugin(AssetManagerPlugin))===null||o===void 0?void 0:o.materials)===null||c===void 0||c.unregisterMaterialExtension(this.materialExtension),(_=(d=h.getPlugin(AssetManagerPlugin))===null||d===void 0?void 0:d.importer)===null||_===void 0||_.removeEventListener("loaderCreate",this._loaderCreate),super.onRemove(h)}};function addThinFilmLayer(h){const o=h==null?void 0:h.userData;if(!o)return!1;o._thinFilmLayer||(o._thinFilmLayer={});const c=o._thinFilmLayer;return c.hasThinFilm=!0,c.baseLayerFactors===void 0&&(c.baseLayerFactors=[.3,.6,1,.9]),c.noiseLayerFactors===void 0&&(c.noiseLayerFactors=[.7,.5,.9,.7]),c.colorNoiseParams===void 0&&(c.colorNoiseParams=[.5,.5,.5,.7]),c.filmFactor===void 0&&(c.filmFactor=.3),h.isMaterial&&(h.needsUpdate=!0),!0}ThinFilmLayerPlugin.PluginType="ThinFilmLayerPlugin",ThinFilmLayerPlugin.THIN_FILM_LAYER_GLTF_EXTENSION="WEBGI_materials_thin_film_layer",ThinFilmLayerPlugin_decorate([uiToggle("Enabled",h=>({onChange:h.setDirty})),serialize()],ThinFilmLayerPlugin.prototype,"enabled",void 0),ThinFilmLayerPlugin=ThinFilmLayerPlugin_decorate([uiFolder("ThinFilmLayer Materials")],ThinFilmLayerPlugin);class GLTFMaterialsThinFilmLayerExtensionImport{constructor(o){this.parser=o,this.name=ThinFilmLayerPlugin.THIN_FILM_LAYER_GLTF_EXTENSION}async extendMaterialParams(o,c){const d=this.parser.json.materials[o];if(!d.extensions||!d.extensions[this.name])return Promise.resolve();const _=d.extensions[this.name];return c.userData||(c.userData={}),addThinFilmLayer(c),c.userData._thinFilmLayer=deserializeObject(_,c.userData._thinFilmLayer,!1,{}),Promise.resolve()}}const glTFMaterialsThinFilmLayerExtensionExport=h=>({writeMaterial:(o,c)=>{if(!o.isMeshStandardMaterial||!o.userData._thinFilmLayer||!o.userData._thinFilmLayer.hasThinFilm)return;c.extensions=c.extensions||{};const d=serializeObject(o.userData._thinFilmLayer,!1);c.extensions[ThinFilmLayerPlugin.THIN_FILM_LAYER_GLTF_EXTENSION]=d,h.extensionsUsed[ThinFilmLayerPlugin.THIN_FILM_LAYER_GLTF_EXTENSION]=!0}});function match(h,o){const c=typeof h=="string"?h:h.path;return c===(typeof o=="string"?o:o.path)&&c||typeof h!="string"&&typeof o!="string"&&h.id&&h.id===o.id}class PresetGroup{async apply(o,c,d){var _,b,_e,it;if(!c)return void(this.selected=void 0);let nt=this.presets.find(at=>match(at,c));return nt||(this.presets.push(c),nt=c),this.selected=nt,typeof nt!="string"?(b=(_=o.getManager())===null||_===void 0?void 0:_.importer)===null||b===void 0?void 0:b.importAsset(nt,d):(it=(_e=o.getManager())===null||_e===void 0?void 0:_e.importer)===null||it===void 0?void 0:it.importPath(nt,d)}addPresets(o){this.presets.push(...o.filter(c=>{const d=this.presets.find(_=>match(_,c));return!d||(typeof d=="string"?(this.presets=this.presets.filter(_=>_!==d),!0):(typeof c=="string"||Object.assign(d,c),!1))}))}clear(){this.selected=void 0}constructor(o){this.presets=[],this.name="",this.selected=void 0,o&&(this.name=o)}}class BackgroundPresetGroup extends PresetGroup{constructor(){super(...arguments),this.name="Background"}async apply(o,c){const d=await super.apply(o,c),_=d==null?void 0:d[0];return _&&(_.colorSpace=three_module.er$,o.scene.background=_,o.scene.backgroundColor=new three_module.Q1f(1,1,1)),_}}class EnvironmentPresetGroup extends PresetGroup{constructor(){super(...arguments),this.name="Environment"}async apply(o,c){const d=await super.apply(o,c),_=d==null?void 0:d[0];return _&&(o.scene.environment=_),_}}class GemEnvironmentPresetGroup extends PresetGroup{constructor(o="envMap"){super(),this.key=o,this.name="GemEnvironment",this.name+=o.split("Map")[1]}async apply(o,c){const d=await super.apply(o,c),_=d==null?void 0:d[0];return S$2(o.getPluginByType("Diamond"),this.key,_),_}}class PluginPresetGroup extends PresetGroup{async apply(o,c){var d,_;const b=await super.apply(o,c,{processImported:!1});return b?(_=(d=o.getManager())===null||d===void 0?void 0:d.importer)===null||_===void 0?void 0:_.processImported(b):void 0}}class ModelStagePresetGroup extends PresetGroup{constructor(){super(...arguments),this.name="ModelStage"}async apply(o,c){var d;const _=typeof c=="string"?c:c.path;let b=!1;try{b=new URL(_.includes("://")?_:"https://example.com/"+_).pathname.endsWith(".json")}catch{b=_.endsWith(".json")}if(b)return super.apply(o,c);{const _e=o.getPluginByType("ModelStagePlugin");return _e==null?void 0:_e.setModel((d=c.file)!==null&&d!==void 0?d:_)}}}class MaterialLibPresetGroupPresetGroup extends PluginPresetGroup{constructor(){super(...arguments),this.name="MaterialLibraries"}async apply(o,c){const d=await super.apply(o,c);return d&&await o.alert("Material Library successfully imported."),d}}class VJSONPresetGroup extends PresetGroup{constructor(){super(...arguments),this.name="VJSON",this.usePresetCamera=!1,this.usePresetLoadingPlugin=!1,this.usePresetInteractionPlugin=!1,this.usePresetParallaxMappingPlugin=!1,this.usePresetRendererUiPlugin=!1,this.usePresetCameraViewPlugin=!1,this.usePresetMaterialConfiguratorPlugin=!1,this.usePresetSwitchNodePlugin=!1}async apply(o,c){const d=o.scene.activeCamera.toJSON(),_=o.serializePluginsIgnored;o.serializePluginsIgnored=[..._,this.usePresetLoadingPlugin?null:"LoadingScreenPlugin",this.usePresetInteractionPlugin?null:"InteractionPromptPlugin",this.usePresetParallaxMappingPlugin?null:"ReliefParallaxMapping",this.usePresetRendererUiPlugin?null:"RendererParamsUiPlugin",this.usePresetCameraViewPlugin?null:"CameraViews",this.usePresetMaterialConfiguratorPlugin?null:"MaterialConfiguratorPlugin",this.usePresetSwitchNodePlugin?null:"SwitchNodePlugin","FrameFade","GLTFAnimationPlugin","ModelStagePlugin","AssetExporterPlugin"].filter(_e=>_e);const b=await super.apply(o,c);return o.serializePluginsIgnored=_,this.usePresetCamera||o.scene.activeCamera.fromJSON(d),b}}class PresetLibraryPlugin extends AViewerPlugin{constructor(){super(...arguments),this.toJSON=null,this.enabled=!0,this.presetGroups=[],this.uiConfig={type:"folder",label:"Presets",expanded:!0,limitedUi:!0,children:[()=>this.presetGroups.map(o=>({type:"dropdown",label:o.name,limitedUi:!0,children:[{value:"",label:"none"},...o.presets.map(c=>{var d;return{label:((d=tPresetToString(c))===null||d===void 0?void 0:d.split("/").pop())||"",value:tPresetToString(c)}})],getValue:()=>tPresetToString(o.selected)||"",setValue:c=>{o.apply(this._viewer,o.presets.find(d=>tPresetToString(d)===c))}})),{type:"button",label:"Download Selection",limitedUi:!0,value:()=>{const o=this.exportPresets();me$1(new File([JSON.stringify(o,null,2)],"preset.template.json",{type:"application/json"}))}},{type:"button",label:"Export Preset Groups",limitedUi:!1,value:()=>{const o=this.exportPresetGroups();me$1(new File([JSON.stringify(o,null,2)],"presetGroups.json",{type:"application/json"}))}}]}}async onAdded(o){var c,d;await super.onAdded(o),this.presetGroups.push(new BackgroundPresetGroup),this.presetGroups.push(new EnvironmentPresetGroup),this.presetGroups.push(new GemEnvironmentPresetGroup),this.presetGroups.push(new GemEnvironmentPresetGroup("envMap2")),this.presetGroups.push(new GemEnvironmentPresetGroup("envMap3")),this.presetGroups.push(new PluginPresetGroup("Ground")),this.presetGroups.push(new PluginPresetGroup("CameraViews")),this.presetGroups.push(new PluginPresetGroup("MaterialConfiguration")),this.presetGroups.push(new ModelStagePresetGroup),this.presetGroups.push(new MaterialLibPresetGroupPresetGroup),this.presetGroups.push(new VJSONPresetGroup),(d=(c=this.uiConfig).uiRefresh)===null||d===void 0||d.call(c,"postFrame",!0)}exportPresets(){const o=Object.fromEntries(this.presetGroups.map(c=>[c.name,c.selected?cleanAsset(c.selected):void 0]).filter(([,c])=>c));return o.type=PresetLibraryPlugin.PluginType,o}async fromJSON(o,c){var d,_;if(!super.fromJSON(o,c))return null;const b={...o};if(delete b.type,b.VJSON&&this._viewer){const it=this.presetGroups.find(at=>at.name==="VJSON"),nt=it==null?void 0:it.presets;it&&nt&&await it.apply(this._viewer,b.VJSON),delete b.VJSON}const _e=[];for(const[it,nt]of Object.entries(b)){const at=this.presetGroups.find(mt=>mt.name===it),ut=at==null?void 0:at.presets;if(!at||!ut)continue;const pt=nt;_e.push(at.apply(this._viewer,pt))}return await Promise.all(_e),(_=(d=this.uiConfig).uiRefresh)===null||_===void 0||_.call(d,"postFrame",!0),this}async loadPresetGroups(o){typeof o=="string"&&o.startsWith("http")&&(o=await fetch(o).then(async c=>c.json()));for(const[c,d]of Object.entries(o)){const _=this.presetGroups.find(b=>b.name===c);_==null||_.addPresets(d)}}exportPresetGroups(){return Object.fromEntries(this.presetGroups.map(o=>[o.name,o.presets.map(cleanAsset)]).filter(([,o])=>o.length>0))}clear(){this.presetGroups.forEach(o=>{o.clear()})}}function tPresetToString(h){return h&&typeof h!="string"?h.path||h.id:h}PresetLibraryPlugin.PluginType="PresetLibraryPlugin";const cleanAsset=h=>(h.preImported&&delete(h={...h}).preImported,h);var grain="vec4 grain(in vec4 color){float x=(vUv.x+4.)*(vUv.y+4.)*(10.);vec4 grain=vec4(mod((mod(x,13.)+1.)*(mod(x,123.)+1.),0.01)-0.005)*grainIntensity;vec4 outColor=color;if(grainMultiply){grain=1.-grain;outColor.rgb=color.rgb*vec3(grain);}else{outColor.rgb=color.rgb+vec3(grain);}return outColor;}",FilmicGrainPlugin_decorate=function(h,o,c,d){var _,b=arguments.length,_e=b<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_e=Reflect.decorate(h,o,c,d);else for(var it=h.length-1;it>=0;it--)(_=h[it])&&(_e=(b<3?_(_e):b>3?_(o,c,_e):_(o,c))||_e);return b>3&&_e&&Object.defineProperty(o,c,_e),_e};let FilmicGrainExtension=class{constructor(h){this.enabled=!1,this.grainMultiply=!1,this.grainIntensity=10,this.extraUniforms={grainIntensity:{value:1},grainMultiply:{value:1}},this.parsFragmentSnippet=(o,c)=>this.enabled?fe$1`
            uniform float grainIntensity;
            uniform bool grainMultiply;
            ${grain}
        `:"",this._combinedPostPlugin=h.getPlugin(CombinedPostPlugin),this._setDirty=this._setDirty.bind(this)}shaderExtender(h,o,c){this.enabled&&(h.fragmentShader=shaderReplaceString(h.fragmentShader,"#glMarker",` 
            gl_FragColor = grain(gl_FragColor);
            #glMarker
        `))}onObjectRender(h,o,c){this.enabled&&(this.extraUniforms.grainIntensity.value=this.grainIntensity,this.extraUniforms.grainMultiply.value=this.grainMultiply)}getUiConfig(){return this.uiConfig}computeCacheKey(h){return this.enabled?"1":"0"}isCompatible(h){return!0}_setDirty(){this._combinedPostPlugin&&(this._combinedPostPlugin.pass.dirty=!0)}setDirty(){var h;(h=this.__setDirty)===null||h===void 0||h.call(this),this._setDirty()}};FilmicGrainPlugin_decorate([x$1(FilmicGrainExtension.prototype._setDirty),uiToggle("Enable"),serialize()],FilmicGrainExtension.prototype,"enabled",void 0),FilmicGrainPlugin_decorate([x$1(FilmicGrainExtension.prototype._setDirty),uiToggle("Multiply"),serialize()],FilmicGrainExtension.prototype,"grainMultiply",void 0),FilmicGrainPlugin_decorate([x$1(FilmicGrainExtension.prototype._setDirty),uiSlider("Intensity",[0,20],.01,{limitedUi:!0}),serialize()],FilmicGrainExtension.prototype,"grainIntensity",void 0),FilmicGrainExtension=FilmicGrainPlugin_decorate([uiFolder("FilmicGrain")],FilmicGrainExtension);class FilmicGrainPlugin extends GenericExtensionPlugin{constructor(){super()}generateExtension(o){return new FilmicGrainExtension(o)}get intensity(){var o,c;return(c=(o=this._extension)===null||o===void 0?void 0:o.grainIntensity)!==null&&c!==void 0?c:1}set intensity(o){this._extension&&(this._extension.grainIntensity=o,this._extension.setDirty())}get multiply(){var o,c;return(c=(o=this._extension)===null||o===void 0?void 0:o.grainMultiply)!==null&&c!==void 0&&c}set multiply(o){this._extension&&(this._extension.grainMultiply=o,this._extension.setDirty())}}FilmicGrainPlugin.PluginType="FilmicGrain";class ObjectPicker extends I$2{get scene(){return this._scene}set scene(o){var c;(c=this._scene)===null||c===void 0||c.removeEventListener("activeCameraChange",this._activeCameraChange),this._scene=o,this._scene.addEventListener("activeCameraChange",this._activeCameraChange)}constructor(o,c,d,_){super(),this.hoverEnabled=!1,this._mouseDownPos=new three_module.I9Y,this._scene=o,this._camera=d??this._scene.activeCamera,this.domElement=c,this._time=this.time,this._mouseDownTime=0,this._mouseUpTime=1,this.selectionCondition=_??(b=>b.userData.userSelectable!==!1&&b.userData.bboxVisible!==!1&&b.material!=null&&b.material.type!=="ShadowMaterial"),this.raycaster=new three_module.tBo,this.mouse=new three_module.I9Y,this._selected=[],this._hovering=[],this.cursorStyles={default:"grab",down:"grabbing"},this._activeCameraChange=this._activeCameraChange.bind(this),this._scene.addEventListener("activeCameraChange",this._activeCameraChange),this.domElement.style.touchAction="none",this.domElement.style.cursor=this.cursorStyles.default,this.domElement.addEventListener("pointermove",b=>this.onPointerMove(b)),this.domElement.addEventListener("pointerleave",b=>this.onPointerLeave(b)),this.domElement.addEventListener("pointerout",b=>this.onPointerLeave(b)),this.domElement.addEventListener("pointercancel",b=>this.onPointerCancel(b)),this.domElement.addEventListener("pointerenter",b=>this.onPointerEnter(b)),this.domElement.addEventListener("pointerdown",b=>this.onPointerDown(b)),this.domElement.addEventListener("pointerup",b=>this.onPointerUp(b))}_activeCameraChange(){this.camera=this._scene.activeCamera}get camera(){return this._camera}set camera(o){this._camera=o}get selectedObject(){return this._selected.length>0?this._selected[0]:null}set selectedObject(o){this._selected.length===1&&this._selected[0]===o||(this._selected=o?Array.isArray(o)?[...o]:[o]:[],this.dispatchEvent({type:"selectedObjectChanged",object:this.selectedObject}))}get hoverObject(){return this._hovering.length>0?this._hovering[0]:null}set hoverObject(o){this._hovering=o?Array.isArray(o)?[...o]:[o]:[],this.dispatchEvent({type:"hoverObjectChanged",object:this.hoverObject})}get time(){return this._time=g(),this._time}get isMouseDown(){return this.mouseDownDeltaTime<0}get mouseDownDeltaTime(){return this._mouseUpTime-this._mouseDownTime}onPointerMove(o){var c,d;o.isPrimary!==!1&&(this.updateMouseFromEvent(o),this.hoverEnabled&&(this.hoverObject=(d=(c=this.checkIntersection())===null||c===void 0?void 0:c.intersects[0].object)!==null&&d!==void 0?d:null))}onPointerLeave(o){o.isPrimary!==!1&&(this.domElement.style.cursor=this.cursorStyles.default,(this.hoverEnabled||this.hoverObject)&&(this.hoverObject=null))}onPointerEnter(o){}onPointerCancel(o){}updateMouseFromEvent(o){const c=this.domElement.getBoundingClientRect();this.mouse.x=(o.clientX-c.x)/c.width*2-1,this.mouse.y=-(o.clientY-c.y)/c.height*2+1}onPointerDown(o){o.isPrimary!==!1&&(this.domElement.style.cursor=this.cursorStyles.down,this._mouseDownTime=this.time,this._mouseDownPos.copy(this.mouse))}onDoubleClick(o){console.log("double click")}onPointerUp(o){if(o.isPrimary===!1)return;this.domElement.style.cursor=this.cursorStyles.default,this._mouseUpTime=this.time;const c=this.mouseDownDeltaTime,d=this._mouseDownPos.distanceTo(this.mouse);c<ObjectPicker.PointerClickMaxTime&&d<ObjectPicker.PointerClickMaxDistance&&this.onPointerClick(o)}onPointerClick(o){if(o.isPrimary===!1)return;this.updateMouseFromEvent(o);const c=this.checkIntersection();c&&this.dispatchEvent({type:"hitObject",time:this._mouseUpTime,intersects:c}),this.selectedObject=(c==null?void 0:c.selectedObject)||null}addPasses(){}checkIntersection(){var o;const c=(o=this._camera)===null||o===void 0?void 0:o.cameraObject;if(!c)return null;this.raycaster.setFromCamera(this.mouse,c);let d=this.raycaster.intersectObject(this._scene.modelRoot.modelObject,!0);const _=[];d=d.filter(nt=>!_.includes(nt.object.id)&&(_.push(nt.object.id),!0));let b,_e=null;const it=[];for(const nt of d){for(_e=nt.object,b=nt;!(_e==null||_e.visible&&this.selectionCondition(_e));)_e=_e.parent;_e!=null&&it.push(nt)}if(d=it,d.length>0){if(_e=d[0].object,b=d[0],this._firstHit&&_e.id!==this._firstHit.id)_e=b.object;else for(let nt=0;nt<d.length;nt++)if(this.selectedObject&&this.selectedObject.id===d[nt].object.id){const at=nt+1;if(!(at<d.length))return null;b=d[at],_e=b.object}this._firstHit=d[0].object}return _e&&b&&_e?{selectedObject:_e,intersect:b,intersects:d,mouse:this.mouse.toArray()}:null}isHovering(){return this.hoverObject!=null}isSelected(){return this.selectedObject!=null}}ObjectPicker.PointerClickMaxTime=200,ObjectPicker.PointerClickMaxDistance=.1;const LineSegmentsGeometry_box=new three_module.NRn,LineSegmentsGeometry_vector=new three_module.Pq0;class LineSegmentsGeometry extends three_module.CmU{constructor(){super(),this.isLineSegmentsGeometry=!0,this.type="LineSegmentsGeometry",this.setIndex([0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5]),this.setAttribute("position",new three_module.qtW([-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],3)),this.setAttribute("uv",new three_module.qtW([-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],2))}applyMatrix4(o){const c=this.attributes.instanceStart,d=this.attributes.instanceEnd;return c!==void 0&&(c.applyMatrix4(o),d.applyMatrix4(o),c.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}setPositions(o){let c;o instanceof Float32Array?c=o:Array.isArray(o)&&(c=new Float32Array(o));const d=new three_module.LuO(c,6,1);return this.setAttribute("instanceStart",new three_module.eHs(d,3,0)),this.setAttribute("instanceEnd",new three_module.eHs(d,3,3)),this.computeBoundingBox(),this.computeBoundingSphere(),this}setColors(o){let c;o instanceof Float32Array?c=o:Array.isArray(o)&&(c=new Float32Array(o));const d=new three_module.LuO(c,6,1);return this.setAttribute("instanceColorStart",new three_module.eHs(d,3,0)),this.setAttribute("instanceColorEnd",new three_module.eHs(d,3,3)),this}fromWireframeGeometry(o){return this.setPositions(o.attributes.position.array),this}fromEdgesGeometry(o){return this.setPositions(o.attributes.position.array),this}fromMesh(o){return this.fromWireframeGeometry(new three_module.XJ7(o.geometry)),this}fromLineSegments(o){const c=o.geometry;return this.setPositions(c.attributes.position.array),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new three_module.NRn);const o=this.attributes.instanceStart,c=this.attributes.instanceEnd;o!==void 0&&c!==void 0&&(this.boundingBox.setFromBufferAttribute(o),LineSegmentsGeometry_box.setFromBufferAttribute(c),this.boundingBox.union(LineSegmentsGeometry_box))}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new three_module.iyt),this.boundingBox===null&&this.computeBoundingBox();const o=this.attributes.instanceStart,c=this.attributes.instanceEnd;if(o!==void 0&&c!==void 0){const d=this.boundingSphere.center;this.boundingBox.getCenter(d);let _=0;for(let b=0,_e=o.count;b<_e;b++)LineSegmentsGeometry_vector.fromBufferAttribute(o,b),_=Math.max(_,d.distanceToSquared(LineSegmentsGeometry_vector)),LineSegmentsGeometry_vector.fromBufferAttribute(c,b),_=Math.max(_,d.distanceToSquared(LineSegmentsGeometry_vector));this.boundingSphere.radius=Math.sqrt(_),isNaN(this.boundingSphere.radius)&&console.error("THREE.LineSegmentsGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}toJSON(){}applyMatrix(o){return console.warn("THREE.LineSegmentsGeometry: applyMatrix() has been renamed to applyMatrix4()."),this.applyMatrix4(o)}}class WireframeGeometry2 extends LineSegmentsGeometry{constructor(o){super(),this.isWireframeGeometry2=!0,this.type="WireframeGeometry2",this.fromWireframeGeometry(new three_module.XJ7(o))}}three_module.fCn.line={worldUnits:{value:1},linewidth:{value:1},resolution:{value:new three_module.I9Y(1,1)},dashOffset:{value:0},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1}},three_module.zkh.line={uniforms:three_module.LlO.merge([three_module.fCn.common,three_module.fCn.fog,three_module.fCn.line]),vertexShader:`
		#include <common>
		#include <color_pars_vertex>
		#include <fog_pars_vertex>
		#include <logdepthbuf_pars_vertex>
		#include <clipping_planes_pars_vertex>

		uniform float linewidth;
		uniform vec2 resolution;

		attribute vec3 instanceStart;
		attribute vec3 instanceEnd;

		attribute vec3 instanceColorStart;
		attribute vec3 instanceColorEnd;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#ifdef USE_DASH

			uniform float dashScale;
			attribute float instanceDistanceStart;
			attribute float instanceDistanceEnd;
			varying float vLineDistance;

		#endif

		void trimSegment( const in vec4 start, inout vec4 end ) {

			// trim end segment so it terminates between the camera plane and the near plane

			// conservative estimate of the near plane
			float a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column
			float b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column
			float nearEstimate = - 0.5 * b / a;

			float alpha = ( nearEstimate - start.z ) / ( end.z - start.z );

			end.xyz = mix( start.xyz, end.xyz, alpha );

		}

		void main() {

			#ifdef USE_COLOR

				vColor.xyz = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;

			#endif

			#ifdef USE_DASH

				vLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;
				vUv = uv;

			#endif

			float aspect = resolution.x / resolution.y;

			// camera space
			vec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );
			vec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );

			#ifdef WORLD_UNITS

				worldStart = start.xyz;
				worldEnd = end.xyz;

			#else

				vUv = uv;

			#endif

			// special case for perspective projection, and segments that terminate either in, or behind, the camera plane
			// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space
			// but we need to perform ndc-space calculations in the shader, so we must address this issue directly
			// perhaps there is a more elegant solution -- WestLangley

			bool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column

			if ( perspective ) {

				if ( start.z < 0.0 && end.z >= 0.0 ) {

					trimSegment( start, end );

				} else if ( end.z < 0.0 && start.z >= 0.0 ) {

					trimSegment( end, start );

				}

			}

			// clip space
			vec4 clipStart = projectionMatrix * start;
			vec4 clipEnd = projectionMatrix * end;

			// ndc space
			vec3 ndcStart = clipStart.xyz / clipStart.w;
			vec3 ndcEnd = clipEnd.xyz / clipEnd.w;

			// direction
			vec2 dir = ndcEnd.xy - ndcStart.xy;

			// account for clip-space aspect ratio
			dir.x *= aspect;
			dir = normalize( dir );

			#ifdef WORLD_UNITS

				// get the offset direction as perpendicular to the view vector
				vec3 worldDir = normalize( end.xyz - start.xyz );
				vec3 offset;
				if ( position.y < 0.5 ) {

					offset = normalize( cross( start.xyz, worldDir ) );

				} else {

					offset = normalize( cross( end.xyz, worldDir ) );

				}

				// sign flip
				if ( position.x < 0.0 ) offset *= - 1.0;

				float forwardOffset = dot( worldDir, vec3( 0.0, 0.0, 1.0 ) );

				// don't extend the line if we're rendering dashes because we
				// won't be rendering the endcaps
				#ifndef USE_DASH

					// extend the line bounds to encompass  endcaps
					start.xyz += - worldDir * linewidth * 0.5;
					end.xyz += worldDir * linewidth * 0.5;

					// shift the position of the quad so it hugs the forward edge of the line
					offset.xy -= dir * forwardOffset;
					offset.z += 0.5;

				#endif

				// endcaps
				if ( position.y > 1.0 || position.y < 0.0 ) {

					offset.xy += dir * 2.0 * forwardOffset;

				}

				// adjust for linewidth
				offset *= linewidth * 0.5;

				// set the world position
				worldPos = ( position.y < 0.5 ) ? start : end;
				worldPos.xyz += offset;

				// project the worldpos
				vec4 clip = projectionMatrix * worldPos;

				// shift the depth of the projected points so the line
				// segments overlap neatly
				vec3 clipPose = ( position.y < 0.5 ) ? ndcStart : ndcEnd;
				clip.z = clipPose.z * clip.w;

			#else

				vec2 offset = vec2( dir.y, - dir.x );
				// undo aspect ratio adjustment
				dir.x /= aspect;
				offset.x /= aspect;

				// sign flip
				if ( position.x < 0.0 ) offset *= - 1.0;

				// endcaps
				if ( position.y < 0.0 ) {

					offset += - dir;

				} else if ( position.y > 1.0 ) {

					offset += dir;

				}

				// adjust for linewidth
				offset *= linewidth;

				// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...
				offset /= resolution.y;

				// select end
				vec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;

				// back to clip space
				offset *= clip.w;

				clip.xy += offset;

			#endif

			gl_Position = clip;

			vec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation

			#include <logdepthbuf_vertex>
			#include <clipping_planes_vertex>
			#include <fog_vertex>

		}
		`,fragmentShader:`
		uniform vec3 diffuse;
		uniform float opacity;
		uniform float linewidth;

		#ifdef USE_DASH

			uniform float dashOffset;
			uniform float dashSize;
			uniform float gapSize;

		#endif

		varying float vLineDistance;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#include <common>
		#include <color_pars_fragment>
		#include <fog_pars_fragment>
		#include <logdepthbuf_pars_fragment>
		#include <clipping_planes_pars_fragment>

		vec2 closestLineToLine(vec3 p1, vec3 p2, vec3 p3, vec3 p4) {

			float mua;
			float mub;

			vec3 p13 = p1 - p3;
			vec3 p43 = p4 - p3;

			vec3 p21 = p2 - p1;

			float d1343 = dot( p13, p43 );
			float d4321 = dot( p43, p21 );
			float d1321 = dot( p13, p21 );
			float d4343 = dot( p43, p43 );
			float d2121 = dot( p21, p21 );

			float denom = d2121 * d4343 - d4321 * d4321;

			float numer = d1343 * d4321 - d1321 * d4343;

			mua = numer / denom;
			mua = clamp( mua, 0.0, 1.0 );
			mub = ( d1343 + d4321 * ( mua ) ) / d4343;
			mub = clamp( mub, 0.0, 1.0 );

			return vec2( mua, mub );

		}

		void main() {

			#include <clipping_planes_fragment>

			#ifdef USE_DASH

				if ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps

				if ( mod( vLineDistance + dashOffset, dashSize + gapSize ) > dashSize ) discard; // todo - FIX

			#endif

			float alpha = opacity;

			#ifdef WORLD_UNITS

				// Find the closest points on the view ray and the line segment
				vec3 rayEnd = normalize( worldPos.xyz ) * 1e5;
				vec3 lineDir = worldEnd - worldStart;
				vec2 params = closestLineToLine( worldStart, worldEnd, vec3( 0.0, 0.0, 0.0 ), rayEnd );

				vec3 p1 = worldStart + lineDir * params.x;
				vec3 p2 = rayEnd * params.y;
				vec3 delta = p1 - p2;
				float len = length( delta );
				float norm = len / linewidth;

				#ifndef USE_DASH

					#ifdef USE_ALPHA_TO_COVERAGE

						float dnorm = fwidth( norm );
						alpha = 1.0 - smoothstep( 0.5 - dnorm, 0.5 + dnorm, norm );

					#else

						if ( norm > 0.5 ) {

							discard;

						}

					#endif

				#endif

			#else

				#ifdef USE_ALPHA_TO_COVERAGE

					// artifacts appear on some hardware if a derivative is taken within a conditional
					float a = vUv.x;
					float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
					float len2 = a * a + b * b;
					float dlen = fwidth( len2 );

					if ( abs( vUv.y ) > 1.0 ) {

						alpha = 1.0 - smoothstep( 1.0 - dlen, 1.0 + dlen, len2 );

					}

				#else

					if ( abs( vUv.y ) > 1.0 ) {

						float a = vUv.x;
						float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
						float len2 = a * a + b * b;

						if ( len2 > 1.0 ) discard;

					}

				#endif

			#endif

			vec4 diffuseColor = vec4( diffuse, alpha );

			#include <logdepthbuf_fragment>
			#include <color_fragment>

			gl_FragColor = vec4( diffuseColor.rgb, alpha );

			#include <tonemapping_fragment>
			#include <colorspace_fragment>
			#include <fog_fragment>
			#include <premultiplied_alpha_fragment>

		}
		`};class LineMaterial extends three_module.BKk{constructor(o){super({type:"LineMaterial",uniforms:three_module.LlO.clone(three_module.zkh.line.uniforms),vertexShader:three_module.zkh.line.vertexShader,fragmentShader:three_module.zkh.line.fragmentShader,clipping:!0}),this.isLineMaterial=!0,this.setValues(o)}get color(){return this.uniforms.diffuse.value}set color(o){this.uniforms.diffuse.value=o}get worldUnits(){return"WORLD_UNITS"in this.defines}set worldUnits(o){o===!0?this.defines.WORLD_UNITS="":delete this.defines.WORLD_UNITS}get linewidth(){return this.uniforms.linewidth.value}set linewidth(o){this.uniforms.linewidth&&(this.uniforms.linewidth.value=o)}get dashed(){return"USE_DASH"in this.defines}set dashed(o){o===!0!==this.dashed&&(this.needsUpdate=!0),o===!0?this.defines.USE_DASH="":delete this.defines.USE_DASH}get dashScale(){return this.uniforms.dashScale.value}set dashScale(o){this.uniforms.dashScale.value=o}get dashSize(){return this.uniforms.dashSize.value}set dashSize(o){this.uniforms.dashSize.value=o}get dashOffset(){return this.uniforms.dashOffset.value}set dashOffset(o){this.uniforms.dashOffset.value=o}get gapSize(){return this.uniforms.gapSize.value}set gapSize(o){this.uniforms.gapSize.value=o}get opacity(){return this.uniforms.opacity.value}set opacity(o){this.uniforms&&(this.uniforms.opacity.value=o)}get resolution(){return this.uniforms.resolution.value}set resolution(o){this.uniforms.resolution.value.copy(o)}get alphaToCoverage(){return"USE_ALPHA_TO_COVERAGE"in this.defines}set alphaToCoverage(o){this.defines&&(o===!0!==this.alphaToCoverage&&(this.needsUpdate=!0),o===!0?(this.defines.USE_ALPHA_TO_COVERAGE="",this.extensions.derivatives=!0):(delete this.defines.USE_ALPHA_TO_COVERAGE,this.extensions.derivatives=!1))}}const _start=new three_module.Pq0,_end=new three_module.Pq0;class Wireframe extends three_module.eaF{constructor(o=new LineSegmentsGeometry,c=new LineMaterial({color:16777215*Math.random()})){super(o,c),this.isWireframe=!0,this.type="Wireframe"}computeLineDistances(){const o=this.geometry,c=o.attributes.instanceStart,d=o.attributes.instanceEnd,_=new Float32Array(2*c.count);for(let _e=0,it=0,nt=c.count;_e<nt;_e++,it+=2)_start.fromBufferAttribute(c,_e),_end.fromBufferAttribute(d,_e),_[it]=it===0?0:_[it-1],_[it+1]=_[it]+_start.distanceTo(_end);const b=new three_module.LuO(_,2,1);return o.setAttribute("instanceDistanceStart",new three_module.eHs(b,1,0)),o.setAttribute("instanceDistanceEnd",new three_module.eHs(b,1,1)),this}}class SelectionWidget extends three_module.YJl{_updater(){const o=this._object;if(o){const c=new Box3B().expandByObject(o,!1);c.getCenter(this.position);const d=c.getBoundingSphere(new three_module.iyt).radius;this.scale.setScalar(d*this.boundingScaleMultiplier),this.setVisible(!0)}else this.setVisible(!1)}constructor(){super(),this.assetType="widget",this.modelObject=this,this._object=null,this.boundingScaleMultiplier=1,this.position.set(0,0,0),this.visible=!1,this.renderOrder=1,this.userData.bboxVisible=!1,this._updater=this._updater.bind(this)}_initGeometry(o){if(this._geometry)return;const c=new WireframeGeometry2(o);this._geometry=c;const d=new LineMaterial({color:"#ff2222",transparent:!0,opacity:.9,linewidth:5,resolution:new three_module.I9Y(1024,1024),dashed:!1,toneMapped:!1}),_=new Wireframe(c,d);_.computeLineDistances(),_.scale.set(1,1,1),_.visible=!0,this.add(_)}setVisible(o){var c;o!==this.visible&&(this.visible=o,(c=this.setDirty)===null||c===void 0||c.call(this,{sceneUpdate:!1}))}attach(o){return this.detach(),o?(this._object=o,this._object.addEventListener("objectUpdate",this._updater),this._updater(),this):this}detach(){var o;return this._object?((o=this._object)===null||o===void 0||o.removeEventListener("objectUpdate",this._updater),this._object=null,this._updater(),this):this}get object(){return this._object}}class BoxSelectionWidget extends SelectionWidget{constructor(){super(),this.boundingScaleMultiplier=1/1.7,this._initGeometry(new three_module.iNn(2,2,2,1,1,1))}_updater(){super._updater();const o=this.object;o&&(new Box3B().expandByObject(o,!1).getSize(this.scale).multiplyScalar(this.boundingScaleMultiplier).clampScalar(.1,100),this.setVisible(!0))}}var PickingPlugin_decorate=function(h,o,c,d){var _,b=arguments.length,_e=b<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_e=Reflect.decorate(h,o,c,d);else for(var it=h.length-1;it>=0;it--)(_=h[it])&&(_e=(b<3?_(_e):b>3?_(o,c,_e):_(o,c))||_e);return b>3&&_e&&Object.defineProperty(o,c,_e),_e};class PickingPlugin extends AViewerPlugin{get widgetEnabled(){return this._enableWidget}get picker(){return this._picker}setDirty(){var o;(o=this._viewer)===null||o===void 0||o.setDirty()}constructor(o=BoxSelectionWidget,c=!1,d=!0,_=!1){super(),this.enabled=!0,this._enableWidget=!0,this.autoFocus=!1,this._onObjectHit=b=>{this._viewer&&(this.enabled?this.dispatchEvent(b):b.intersects.selectedObject=null)},this._uiConfigChildren=[{label:"Enabled",type:"checkbox",property:[this,"enabled"]},{label:"AutoFocus",type:"checkbox",property:[this,"autoFocus"],onChange:()=>{const b=this.getSelectedObject();this.autoFocus&&b&&this.setSelectedObject(b,!0)}}],o&&(this._widget=new o),c&&console.error("PickingPlugin - controls removed. Use the new TransformControlsPlugin"),this._pickUi=d,this.autoFocus=_}getSelectedObject(){var o;if(this.enabled)return((o=this._picker)===null||o===void 0?void 0:o.selectedObject)||void 0}setSelectedObject(o,c=!1){if(!this.enabled||!this._picker)return;const d=this.autoFocus;this.autoFocus=!1,this._picker.selectedObject=o||null,this.autoFocus=d,(d||c)&&this.focusObject(o)}async onAdded(o){await super.onAdded(o),this._picker=new ObjectPicker(o.scene,o.canvas,void 0,c=>{var d,_;if(!c.material)return!1;let b=c,_e=!1;for(;b;){if(!b.visible||(((d=b.userData.iModel)!==null&&d!==void 0?d:b).assetType==="model"&&(_e=!0),((_=b.userData.iModel)!==null&&_!==void 0?_:b).assetType==="widget")||b.userData.userSelectable===!1||b.userData.bboxVisible===!1)return!1;b=b.parent}return _e}),this._widget&&o.scene.addWidget(this._widget),this._picker.addEventListener("selectedObjectChanged",c=>{var d,_;this.dispatchEvent(c);const b=((d=this._picker)===null||d===void 0?void 0:d.selectedObject)||void 0;if(this._pickUi){const it=b==null?void 0:b.uiConfig,nt=this.uiConfig;nt.children=[...this._uiConfigChildren],it&&nt.children.push(it),(_=nt.uiRefresh)===null||_===void 0||_.call(nt)}const _e=this._widget;_e&&this._enableWidget&&(b?_e.attach(b):_e.detach()),o.setDirty(),this.autoFocus&&this.focusObject(b)}),this._picker.addEventListener("hoverObjectChanged",this.dispatchEvent),this._picker.addEventListener("hitObject",this._onObjectHit),o.scene.addEventListener("select",c=>{c.value===void 0?console.warn("WebGi: e.value must be set for picking, can be null to unselect"):c.value.isObject3D&&this.setSelectedObject(c.value,this.autoFocus||c.focusCamera)}),o.scene.addEventListener("addSceneObject",async c=>{var d,_,b;const _e=c.object,it=this.getSelectedObject();if(it&&(_e==null?void 0:_e.assetType)==="material"&&typeof(it==null?void 0:it.setMaterial)=="function"&&!((d=it==null?void 0:it.modelObject)===null||d===void 0)&&d.isMesh&&await o.confirm("Applying material: Apply material to the selected object?")){const nt=it.material;if(Array.isArray(nt))console.warn("WebGi: Dropping on material array not yet fully supported."),it.setMaterial(_e);else{let at=Array.from((_=nt==null?void 0:nt.userData.__appliedMeshes)!==null&&_!==void 0?_:[]);(at.length>1?!await o.confirm("Applying material: Apply to all objects using this material?"):at.length<1)&&(at=[it]);for(const ut of at)ut&&((b=ut.setMaterial)===null||b===void 0||b.call(ut,_e))}}}),o.scene.addEventListener("sceneUpdate",c=>{if(!c.hierarchyChanged)return;const d=this.getSelectedObject();let _=!1;d==null||d.traverseAncestors(b=>{b===o.scene.modelObject&&(_=!0)}),_||this.setSelectedObject(void 0)})}async focusObject(o){var c,d,_,b;const _e=(c=this._viewer)===null||c===void 0?void 0:c.getPluginByType("CameraViews");await(_e==null?void 0:_e.animateToFitObject(o,1.25,1e3,"easeOut",{min:((b=(_=(d=this._viewer)===null||d===void 0?void 0:d.scene.activeCamera.getControls())===null||_===void 0?void 0:_.minDistance)!==null&&b!==void 0?b:.5)+.5,max:50}))}enableWidget(o){var c,d,_;if(this._enableWidget=o,o){const b=((c=this._picker)===null||c===void 0?void 0:c.selectedObject)||void 0;b&&((d=this._widget)===null||d===void 0||d.attach(b))}else(_=this._widget)===null||_===void 0||_.detach()}get uiConfig(){return this._pickUi?this._uiConfig?this._uiConfig:this._uiConfig={type:"panel",label:"Picker",expanded:!0,children:[...this._uiConfigChildren]}:{}}get widget(){return this._widget}}PickingPlugin.PluginType="Picking",PickingPlugin_decorate([serialize()],PickingPlugin.prototype,"enabled",void 0),PickingPlugin_decorate([serialize()],PickingPlugin.prototype,"autoFocus",void 0);var customBumpMat=`#if defined(CUSTOM_BUMP_MAP_ENABLED) && CUSTOM_BUMP_MAP_ENABLED > 0
#if CUSTOM_BUMP_MAP_BICUBIC > 0  
vec4 cubic_cb(float v){vec4 n=vec4(1.,2.,3.,4.)-v;vec4 s=n*n*n;float x=s.x;float y=s.y-4.*s.x;float z=s.z-4.*s.y+6.*s.x;float w=6.-x-y-z;return vec4(x,y,z,w)*(1./6.);}vec4 textureBicubic_cb(sampler2D sampler,vec2 texCoords){vec2 texSize=vec2(textureSize(sampler,0));vec2 invTexSize=1./texSize;texCoords=texCoords*texSize-0.5;vec2 fxy=fract(texCoords);texCoords-=fxy;vec4 xcubic=cubic_cb(fxy.x);vec4 ycubic=cubic_cb(fxy.y);vec4 c=texCoords.xxyy+vec2(-0.5,+1.5).xyxy;vec4 s=vec4(xcubic.xz+xcubic.yw,ycubic.xz+ycubic.yw);vec4 offset=c+vec4(xcubic.yw,ycubic.yw)/s;offset*=invTexSize.xxyy;vec4 sample0=texture(sampler,offset.xz);vec4 sample1=texture(sampler,offset.yz);vec4 sample2=texture(sampler,offset.xw);vec4 sample3=texture(sampler,offset.yw);float sx=s.x/(s.x+s.y);float sy=s.z/(s.z+s.w);return mix(mix(sample3,sample2,sx),mix(sample1,sample0,sx),sy);}
#endif
varying vec2 vCustomBumpUv;uniform sampler2D customBumpMap;uniform float customBumpScale;vec2 dHdxy_fwd_cb(){vec2 dSTdx=dFdx(vCustomBumpUv);vec2 dSTdy=dFdy(vCustomBumpUv);
#if CUSTOM_BUMP_MAP_BICUBIC > 0
float Hll=customBumpScale*textureBicubic_cb(customBumpMap,vCustomBumpUv).x;float dBx=customBumpScale*textureBicubic_cb(customBumpMap,vCustomBumpUv+dSTdx).x-Hll;float dBy=customBumpScale*textureBicubic_cb(customBumpMap,vCustomBumpUv+dSTdy).x-Hll;
#else
float Hll=customBumpScale*texture2D(customBumpMap,vCustomBumpUv).x;float dBx=customBumpScale*texture2D(customBumpMap,vCustomBumpUv+dSTdx).x-Hll;float dBy=customBumpScale*texture2D(customBumpMap,vCustomBumpUv+dSTdy).x-Hll;
#endif
return vec2(dBx,dBy);}
#ifndef USE_BUMPMAP
vec3 perturbNormalArb(vec3 surf_pos,vec3 surf_norm,vec2 dHdxy,float faceDirection){vec3 vSigmaX=dFdx(surf_pos.xyz);vec3 vSigmaY=dFdy(surf_pos.xyz);vec3 vN=surf_norm;vec3 R1=cross(vSigmaY,vN);vec3 R2=cross(vN,vSigmaX);float fDet=dot(vSigmaX,R1)*faceDirection;vec3 vGrad=sign(fDet)*(dHdxy.x*R1+dHdxy.y*R2);return normalize(abs(fDet)*surf_norm-vGrad);}
#endif
#endif
`,CustomBumpMapPlugin_decorate=function(h,o,c,d){var _,b=arguments.length,_e=b<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_e=Reflect.decorate(h,o,c,d);else for(var it=h.length-1;it>=0;it--)(_=h[it])&&(_e=(b<3?_(_e):b>3?_(o,c,_e):_(o,c))||_e);return b>3&&_e&&Object.defineProperty(o,c,_e),_e};let CustomBumpMapPlugin=class extends AViewerPlugin{enableCustomBump(h,o,c){var d,_;const b=(d=h.materialObject)===null||d===void 0?void 0:d.userData;if(!b)return!1;if(b._hasCustomBump===void 0){const _e=b.__appliedMeshes;let it=!0;if(_e)for(const{geometry:nt}of _e)!nt||nt.attributes.position&&nt.attributes.normal&&nt.attributes.uv||(it=!1);if(!it)return!1}return b._hasCustomBump=!0,b._customBumpScale=(_=c??b._customBumpScale)!==null&&_!==void 0?_:.001,b._customBumpMap=o??b._customBumpMap,h.materialObject.needsUpdate=!0,!0}_loaderCreate({loader:h}){h.isGLTFLoader2&&h.register(o=>new GLTFMaterialsCustomBumpMapExtensionImport(o))}constructor(){super(),this.enabled=!0,this.dependencies=[AssetManagerPlugin],this.bicubicFiltering=!0,this._defines={CUSTOM_BUMP_MAP_DEBUG:!1,CUSTOM_BUMP_MAP_BICUBIC:!0},this._uniforms={customBumpUvTransform:{value:new three_module.dwI},customBumpScale:{value:.001},customBumpMap:{value:null}},this.materialExtension={parsFragmentSnippet:(h,o)=>this.enabled&&o!=null&&o.materialObject.userData._hasCustomBump?customBumpMat:"",shaderExtender:(h,o,c)=>{var d;this.enabled&&o.materialObject.userData._hasCustomBump&&!((d=o.materialObject.userData)===null||d===void 0)&&d._customBumpMap&&(h.fragmentShader=shaderReplaceString(h.fragmentShader,"#glMarker beforeAccumulation",`
#if defined(CUSTOM_BUMP_MAP_ENABLED) && CUSTOM_BUMP_MAP_ENABLED > 0
    normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd_cb(), faceDirection );
#endif
                `,{prepend:!0}),h.vertexShader=shaderReplaceString(h.vertexShader,"#include <uv_pars_vertex>",`
#if defined(CUSTOM_BUMP_MAP_ENABLED) && CUSTOM_BUMP_MAP_ENABLED > 0
                varying vec2 vCustomBumpUv;
                uniform mat3 customBumpUvTransform;
#endif
                `,{prepend:!0}),h.vertexShader=shaderReplaceString(h.vertexShader,"#include <uv_vertex>",`
#if defined(CUSTOM_BUMP_MAP_ENABLED) && CUSTOM_BUMP_MAP_ENABLED > 0
                vCustomBumpUv = ( customBumpUvTransform * vec3( uv, 1 ) ).xy;
#endif
                `,{prepend:!0}),h.defines.USE_UV="")},onObjectRender:(h,o)=>{var c;const d=o.materialObject.userData;if(!(d!=null&&d._hasCustomBump))return;const _=h;if(!_.isMesh||!_.geometry)return;const b=!((c=d._customBumpMap)===null||c===void 0)&&c.isTexture?d._customBumpMap:null;this._uniforms.customBumpMap.value=b,this._uniforms.customBumpScale.value=b?d._customBumpScale:0,b&&(b.updateMatrix(),this._uniforms.customBumpUvTransform.value.copy(b.matrix));let _e=this.enabled&&b?1:0;o.materialObject.defines.CUSTOM_BUMP_MAP_ENABLED!==_e&&(o.materialObject.defines.CUSTOM_BUMP_MAP_ENABLED=_e,o.materialObject.needsUpdate=!0),_e=+this._defines.CUSTOM_BUMP_MAP_DEBUG,o.materialObject.defines.CUSTOM_BUMP_MAP_DEBUG!==_e&&(o.materialObject.defines.CUSTOM_BUMP_MAP_DEBUG=_e,o.materialObject.needsUpdate=!0),_e=+this._defines.CUSTOM_BUMP_MAP_BICUBIC,o.materialObject.defines.CUSTOM_BUMP_MAP_BICUBIC!==_e&&(o.materialObject.defines.CUSTOM_BUMP_MAP_BICUBIC=_e,o.materialObject.needsUpdate=!0)},extraUniforms:{...this._uniforms},computeCacheKey:h=>{var o,c,d;return(this.enabled?"1":"0")+(!((o=h.materialObject.userData)===null||o===void 0)&&o._hasCustomBump?"1":"0")+((d=(c=h.materialObject.userData)===null||c===void 0?void 0:c._customBumpMap)===null||d===void 0?void 0:d.uuid)},isCompatible:h=>h.isMeshStandardMaterial2,updaters:()=>[],getUiConfig:h=>{const o=this._viewer,c=this.enableCustomBump,d={type:"folder",label:"CustomBumpMap",children:[{type:"checkbox",label:"Enabled",get value(){return h.materialObject.userData._hasCustomBump||!1},set value(_){var b;_!==h.materialObject.userData._hasCustomBump&&(_?c(h)||o.alert("One or more geometries cannot be made anisotropic."):(h.materialObject.userData._hasCustomBump=!1,h.materialObject.needsUpdate=!0),(b=d.uiRefresh)===null||b===void 0||b.call(d,"postFrame",!0))},onChange:this.setDirty},{type:"slider",label:"Bump Scale",bounds:[-1,1],hidden:()=>!h.materialObject.userData._hasCustomBump,property:[h.materialObject.userData,"_customBumpScale"],onChange:this.setDirty},{type:"image",label:"Bump Map",hidden:()=>!h.materialObject.userData._hasCustomBump,property:[h.materialObject.userData,"_customBumpMap"],onChange:()=>{h.materialObject.needsUpdate=!0,this.setDirty()}},makeSamplerUi(h.materialObject.userData,"_customBumpMap")]};return d}},this.setDirty=()=>{var h,o,c;(o=(h=this.materialExtension).setDirty)===null||o===void 0||o.call(h),(c=this._viewer)===null||c===void 0||c.setDirty()},this.enableCustomBumpSelected=()=>{var h,o,c;const d=(c=(o=(h=this._viewer)===null||h===void 0?void 0:h.getPlugin(PickingPlugin))===null||o===void 0?void 0:o.getSelectedObject())===null||c===void 0?void 0:c.material;return(d==null?void 0:d.assetType)==="material"&&this.enableCustomBump(d)},this._loaderCreate=this._loaderCreate.bind(this)}async onAdded(h){var o,c,d,_,b;await super.onAdded(h);const _e=h.getPlugin(AssetManagerPlugin);(o=_e==null?void 0:_e.materials)===null||o===void 0||o.registerMaterialExtension(this.materialExtension),(c=_e==null?void 0:_e.importer)===null||c===void 0||c.addEventListener("loaderCreate",this._loaderCreate),(b=(_=(d=_e==null?void 0:_e.exporter)===null||d===void 0?void 0:d.getExporter("gltf","glb"))===null||_===void 0?void 0:_.extensions)===null||b===void 0||b.push(glTFMaterialsCustomBumpMapExtensionExport)}async onRemove(h){var o,c,d,_,b,_e,it,nt,at,ut,pt,mt;(c=(o=h.getPlugin(AssetManagerPlugin))===null||o===void 0?void 0:o.materials)===null||c===void 0||c.unregisterMaterialExtension(this.materialExtension),(_=(d=h.getPlugin(AssetManagerPlugin))===null||d===void 0?void 0:d.importer)===null||_===void 0||_.removeEventListener("loaderCreate",this._loaderCreate);const ft=(nt=(it=(_e=(b=h.getPlugin(AssetManagerPlugin))===null||b===void 0?void 0:b.exporter)===null||_e===void 0?void 0:_e.getExporter("gltf","glb"))===null||it===void 0?void 0:it.extensions)===null||nt===void 0?void 0:nt.indexOf(glTFMaterialsCustomBumpMapExtensionExport);return ft!==void 0&&ft!==-1&&((mt=(pt=(ut=(at=h.getPlugin(AssetManagerPlugin))===null||at===void 0?void 0:at.exporter)===null||ut===void 0?void 0:ut.getExporter("gltf","glb"))===null||pt===void 0?void 0:pt.extensions)===null||mt===void 0||mt.splice(ft,1)),super.onRemove(h)}};CustomBumpMapPlugin.PluginType="CustomBumpMapPlugin",CustomBumpMapPlugin.CUSTOM_BUMP_MAP_GLTF_EXTENSION="WEBGI_materials_custom_bump_map",CustomBumpMapPlugin_decorate([uiToggle("Enabled",h=>({onChange:h.setDirty})),serialize()],CustomBumpMapPlugin.prototype,"enabled",void 0),CustomBumpMapPlugin_decorate([uiToggle("Bicubic",h=>({onChange:h.setDirty})),matDefine("CUSTOM_BUMP_MAP_BICUBIC",void 0,!0,CustomBumpMapPlugin.prototype.setDirty),serialize()],CustomBumpMapPlugin.prototype,"bicubicFiltering",void 0),CustomBumpMapPlugin_decorate([uiButton("Enable CustomBumpMap",h=>({hidden:()=>{var o;return!(!((o=h._viewer)===null||o===void 0)&&o.getPlugin(PickingPlugin))}}))],CustomBumpMapPlugin.prototype,"enableCustomBumpSelected",void 0),CustomBumpMapPlugin=CustomBumpMapPlugin_decorate([uiFolder("CustomBumpMap Materials")],CustomBumpMapPlugin);class GLTFMaterialsCustomBumpMapExtensionImport{constructor(o){this.parser=o,this.name=CustomBumpMapPlugin.CUSTOM_BUMP_MAP_GLTF_EXTENSION}async extendMaterialParams(o,c){var d;const _=this.parser,b=_.json.materials[o];if(!b.extensions||!b.extensions[this.name])return Promise.resolve();const _e=[],it=b.extensions[this.name];c.userData||(c.userData={}),c.userData._hasCustomBump=!0,c.userData._customBumpScale=(d=it.customBumpScale)!==null&&d!==void 0?d:0;const nt=it.customBumpMap;return nt&&_e.push(_.assignTexture(c.userData,"_customBumpMap",nt).then(at=>{at.colorSpace=three_module.er$})),Promise.all(_e)}}const glTFMaterialsCustomBumpMapExtensionExport=h=>({writeMaterial:(o,c)=>{if(!o.isMeshStandardMaterial||!o.userData._hasCustomBump||(o.userData._customBumpScale||0)<.001)return;c.extensions=c.extensions||{};const d={};if(d.customBumpScale=o.userData._customBumpScale||1,h.checkEmptyMap(o.userData._customBumpMap)){const _={index:h.processTexture(o.userData._customBumpMap)};h.applyTextureTransform(_,o.userData._customBumpMap),d.customBumpMap=_}c.extensions[CustomBumpMapPlugin.CUSTOM_BUMP_MAP_GLTF_EXTENSION]=d,h.extensionsUsed[CustomBumpMapPlugin.CUSTOM_BUMP_MAP_GLTF_EXTENSION]=!0}});var GLTFAnimationPlugin_decorate=function(h,o,c,d){var _,b=arguments.length,_e=b<3?o:d===null?d=Object.getOwnPropertyDescriptor(o,c):d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_e=Reflect.decorate(h,o,c,d);else for(var it=h.length-1;it>=0;it--)(_=h[it])&&(_e=(b<3?_(_e):b>3?_(o,c,_e):_(o,c))||_e);return b>3&&_e&&Object.defineProperty(o,c,_e),_e},GLTFAnimationPlugin_1;let GLTFAnimationPlugin=GLTFAnimationPlugin_1=class extends AViewerPlugin{get animationState(){return this._animationState}get animationTime(){return this._animationTime}get animationDuration(){return this._animationDuration}setTime(h){this._animationTime=Math.max(0,Math.min(h,this._animationDuration))}_wheel({deltaY:h}){this.enabled&&Math.abs(h)>.001&&(this._scrollAnimationState=-1*Math.sign(h))}_drag(h){this.enabled&&this._viewer&&(this.dragAxis==="x"?this._dragAnimationState=h.delta.x*this._viewer.canvas.width/4:this._dragAnimationState=h.delta.y*this._viewer.canvas.height/4)}_postFrame(){var h,o;if(!this._viewer)return;const c=this._viewer,d=this.animateOnScroll,_=this.animateOnDrag;if(!this.enabled||this.animations.length<1||this._animationState!=="playing"&&!d&&!_)return this._lastFrameTime=0,void(this._fadeDisabled&&((h=this._viewer.getPluginByType("FrameFade"))===null||h===void 0||h.enable(GLTFAnimationPlugin_1.PluginType),this._fadeDisabled=!1));if(this._animationTime<1e-4&&this.dispatchEvent({type:"checkpointBegin"}),this.autoIncrementTime){const it=g()/1e3;this._lastFrameTime<1&&(this._lastFrameTime=it-1/30);let nt=it-this._lastFrameTime;if(nt*=this.animationSpeed,this._lastFrameTime=it,d&&_?nt*=et(this._scrollAnimationState,this._dragAnimationState):d?nt*=this._scrollAnimationState:_&&(nt*=this._dragAnimationState),Math.abs(nt)<1e-4)return;const at=(o=this._viewer.getPluginByType("Progressive"))===null||o===void 0?void 0:o.postFrameConvergedRecordingDelta();if(at&&at>0&&(nt=at),at===0)return;const ut=Math.abs(this.timeScale);this._animationTime+=nt*(ut>0?ut:1)}const b=this._animationTime-this._lastAnimationTime;this._lastAnimationTime=this._animationTime;const _e=this.timeScale<0?(isFinite(this._animationDuration)?this._animationDuration:0)-this._animationTime:this._animationTime;if(this.animations.map(it=>{it.mixer.setTime(_e)}),!(Math.abs(b)<1e-5)){if(Math.abs(this._scrollAnimationState)<.001?this._scrollAnimationState=0:this._scrollAnimationState*=1-this.scrollAnimationDamping,Math.abs(this._dragAnimationState)<.001?this._dragAnimationState=0:this._dragAnimationState*=1-this.dragAnimationDamping,this.dispatchEvent({type:"animationStep",delta:b,time:_e}),c.scene.activeCamera.cameraObject.userData.__animatingCamera&&c.scene.activeCamera.setDirty(),c.scene.refreshActiveCameraNearFar(),c.renderer.resetShadows(),c.setDirty(),!this._fadeDisabled){const it=this._viewer.getPluginByType("FrameFade");it&&(it.disable(GLTFAnimationPlugin_1.PluginType),this._fadeDisabled=!0)}this._animationTime>=this._animationDuration&&this.dispatchEvent({type:"checkpointEnd"})}}constructor(){super(),this.enabled=!0,this._lastAnimationTime=0,this.autoIncrementTime=!0,this.animations=[],this.loopAnimations=!0,this.loopRepetitions=1/0,this.timeScale=1,this.animationSpeed=1,this.animateOnScroll=!1,this._scrollAnimationState=0,this.scrollAnimationDamping=.1,this.animateOnDrag=!1,this.dragAxis="y",this.autoplayOnLoad=!1,this.syncMaxDuration=!1,this._dragAnimationState=0,this.dragAnimationDamping=.3,this.dependencies=[AssetManagerPlugin],this._pointerDragHelper=new Z$1,this._lastFrameTime=0,this._fadeDisabled=!1,this._objectAdded=h=>{var o;const c=h.object;if(c.assetType!=="model"||!c.modelObject||!this._viewer)return;let d=!1;const _=(o=h.options)===null||o===void 0?void 0:o.addToRoot;c.modelObject.traverse(b=>{var _e;const it=b.animations;if(it.length<1)return;const nt=Math.max(...it.map(pt=>pt.duration));((_e=c.modelObject.userData.gltfAnim_SyncMaxDuration)!==null&&_e!==void 0?_e:this.syncMaxDuration)&&(it.forEach(pt=>pt.duration=nt),c.modelObject.userData.gltfAnim_SyncMaxDuration=!0);const at=new three_module.Iw4(_?this._viewer.scene.modelObject:this._viewer.scene.modelRoot.modelObject),ut=it.map(pt=>at.clipAction(pt).setLoop(this.loopAnimations?three_module.aMy:three_module.G3T,this.loopRepetitions));ut.forEach(pt=>pt.clampWhenFinished=!0),this.animations.push({mixer:at,clips:it,actions:ut,duration:nt}),d=!0}),d&&(this._onPropertyChange(!this.autoplayOnLoad),this.autoplayOnLoad&&this.playAnimation())},this._animationTime=0,this._animationDuration=0,this._animationState="none",this.uiConfig=void 0,this._lastAnimId="",this.timelineMarkers=[],this._postFrame=this._postFrame.bind(this),this._wheel=this._wheel.bind(this),this.playClips=this.playClips.bind(this),this.playClip=this.playClip.bind(this),this.playAnimation=this.playAnimation.bind(this),this.playPauseAnimation=this.playPauseAnimation.bind(this),this.pauseAnimation=this.pauseAnimation.bind(this),this.stopAnimation=this.stopAnimation.bind(this),this.resetAnimation=this.resetAnimation.bind(this),this._onPropertyChange=this._onPropertyChange.bind(this),this._loaderCreate=this._loaderCreate.bind(this),this._pointerDragHelper.addEventListener("drag",this._drag.bind(this))}_loaderCreate({loader:h}){h.isGLTFLoader2&&h.register(o=>new GLTFTimelineMarkersExtensionImport(o,this))}async onAdded(h){var o,c,d,_,b,_e;(c=(o=h.getPlugin(AssetManagerPlugin))===null||o===void 0?void 0:o.importer)===null||c===void 0||c.addEventListener("loaderCreate",this._loaderCreate),h.scene.addEventListener("addSceneObject",this._objectAdded),(_e=(b=(_=(d=h.getPlugin(AssetManagerPlugin))===null||d===void 0?void 0:d.exporter)===null||_===void 0?void 0:_.getExporter("gltf","glb"))===null||b===void 0?void 0:b.extensions)===null||_e===void 0||_e.push(glTFTimelineMarkersExtensionExport),h.addEventListener("postFrame",this._postFrame),window.addEventListener("wheel",this._wheel),this._pointerDragHelper.element=h.canvas;let it=-1;return Object.defineProperty(h.scene.modelRoot,"currentTimelineMarker",{get:()=>it,set:nt=>h.scene.modelRoot.dispatchEvent({type:"animationTimelineMarker",marker:this.timelineMarkers[it=nt]})}),h.scene.modelRoot.addEventListener("animationTimelineMarker",({marker:nt})=>{var at;if(!this._viewer)return;if(!nt)return this._viewer.scene.activeCamera=(at=this._viewer)===null||at===void 0?void 0:at.scene.defaultCamera,void this._viewer.setDirty();const ut=nt.camera;ut&&(ut.userData.__animatingCamera=!0,this._viewer.scene.activeCamera=this._viewer.createCamera(ut))}),super.onAdded(h)}async onRemove(h){for(var o,c;this.animations.length;)this.animations.pop();return h.scene.removeEventListener("addSceneObject",this._objectAdded),(c=(o=h.getPlugin(AssetManagerPlugin))===null||o===void 0?void 0:o.importer)===null||c===void 0||c.addEventListener("loaderCreate",this._loaderCreate),h.removeEventListener("postFrame",this._postFrame),window.removeEventListener("wheel",this._wheel),this._pointerDragHelper.element=void 0,super.onRemove(h)}_onPropertyChange(h=!0){this._animationDuration=Math.max(...this.animations.map(({duration:o})=>o))*(this.loopAnimations?this.loopRepetitions:1),this._animationState==="playing"&&h&&this.playAnimation()}onStateChange(){var h,o;(o=(h=this.uiConfig)===null||h===void 0?void 0:h.children)===null||o===void 0||o.map(c=>c&&Ee$1(c)).flat(2).forEach(c=>{var d;return(d=c==null?void 0:c.uiRefresh)===null||d===void 0?void 0:d.call(c)})}playPauseAnimation(){this._animationState==="playing"?this.pauseAnimation():this.playAnimation()}async playClip(h,o=!1){return this.playClips([h],o)}async playClips(h,o=!1){const c=[];return this.animations.forEach(({actions:d})=>{d.forEach(_=>{h.includes(_.getClip().name)&&c.push(_)})}),this.playAnimation(o,c)}async playAnimation(h=!1,o){var c;if(!this.enabled)return;let d=!1;this._animationState==="playing"&&(this.stopAnimation(!1),d=!0);let _=0;const b=!o;o||(o=[],this.animations.forEach(({mixer:it,actions:nt,clips:at})=>{o.push(...nt)})),d?this.resetAnimation():this.animationState!=="paused"&&(o.forEach(it=>{it.reset()}),this._animationTime=0);const _e=esm_browser_v4();this._lastAnimId=_e;for(const it of o)it.setLoop(this.loopAnimations?three_module.aMy:three_module.G3T,this.loopRepetitions),it.play(),_=Math.max(_,it.getClip().duration/Math.abs(it.timeScale));if(this._animationState="playing",(c=this._viewer)===null||c===void 0||c.setDirty(),b){if(!isFinite(this._animationDuration))return;await new Promise((it,nt)=>{const at=()=>{this.removeEventListener("checkpointEnd",at),it()};this.addEventListener("checkpointEnd",at)})}else{const it=this.loopAnimations?this.loopRepetitions:1;if(_*=it,!isFinite(_))return;await new Promise((nt,at)=>{const ut=pt=>{pt.time>=_&&(this.removeEventListener("animationStep",ut),nt())};this.addEventListener("animationStep",ut)})}_e===this._lastAnimId&&this.stopAnimation(h)}pauseAnimation(){var h;this._animationState==="playing"?(this._animationState="paused",(h=this._viewer)===null||h===void 0||h.setDirty()):console.warn("pauseAnimation called when animation was not playing.")}resumeAnimation(){var h;this._animationState==="paused"?(this._animationState="playing",(h=this._viewer)===null||h===void 0||h.setDirty()):console.warn("resumeAnimation called when animation was not paused.")}stopAnimation(h=!1){var o,c;this._animationState="stopped",h?this.resetAnimation():(o=this._viewer)===null||o===void 0||o.setDirty(),this._lastAnimId="",this._viewer&&this._fadeDisabled&&((c=this._viewer.getPluginByType("FrameFade"))===null||c===void 0||c.enable(GLTFAnimationPlugin_1.PluginType),this._fadeDisabled=!1)}resetAnimation(){var h;this._animationState==="stopped"||this._animationState==="none"?(this.animations.forEach(({mixer:o,actions:c,clips:d})=>{o.stopAllAction(),o.setTime(0)}),this._animationTime=0,(h=this._viewer)===null||h===void 0||h.setDirty()):this.stopAnimation(!0)}};GLTFAnimationPlugin.PluginType="GLTFAnimation",GLTFAnimationPlugin.AnimationMarkersExtension="WEBGI_animation_markers",GLTFAnimationPlugin_decorate([serialize()],GLTFAnimationPlugin.prototype,"autoIncrementTime",void 0),GLTFAnimationPlugin_decorate([uiMonitor()],GLTFAnimationPlugin.prototype,"animationState",null),GLTFAnimationPlugin_decorate([uiMonitor()],GLTFAnimationPlugin.prototype,"animationTime",null),GLTFAnimationPlugin_decorate([uiMonitor()],GLTFAnimationPlugin.prototype,"animationDuration",null),GLTFAnimationPlugin_decorate([ze$1(GLTFAnimationPlugin.prototype._onPropertyChange),uiToggle("Loop",{limitedUi:!0}),serialize()],GLTFAnimationPlugin.prototype,"loopAnimations",void 0),GLTFAnimationPlugin_decorate([ze$1(GLTFAnimationPlugin.prototype._onPropertyChange),serialize()],GLTFAnimationPlugin.prototype,"loopRepetitions",void 0),GLTFAnimationPlugin_decorate([uiSlider("Timescale",[-2,2],.01),serialize()],GLTFAnimationPlugin.prototype,"timeScale",void 0),GLTFAnimationPlugin_decorate([uiSlider("Speed",[.1,4],.1,{limitedUi:!0}),serialize()],GLTFAnimationPlugin.prototype,"animationSpeed",void 0),GLTFAnimationPlugin_decorate([uiToggle(),serialize()],GLTFAnimationPlugin.prototype,"animateOnScroll",void 0),GLTFAnimationPlugin_decorate([uiToggle(),serialize()],GLTFAnimationPlugin.prototype,"animateOnDrag",void 0),GLTFAnimationPlugin_decorate([uiDropdown("Drag Axis",[{label:"x"},{label:"y"}]),serialize()],GLTFAnimationPlugin.prototype,"dragAxis",void 0),GLTFAnimationPlugin_decorate([uiToggle(),serialize()],GLTFAnimationPlugin.prototype,"autoplayOnLoad",void 0),GLTFAnimationPlugin_decorate([uiToggle("syncMaxDuration(dev)"),serialize()],GLTFAnimationPlugin.prototype,"syncMaxDuration",void 0),GLTFAnimationPlugin_decorate([x$1(GLTFAnimationPlugin.prototype.onStateChange)],GLTFAnimationPlugin.prototype,"_animationState",void 0),GLTFAnimationPlugin_decorate([uiButton("Play/Pause",h=>({label:()=>h.animationState==="playing"?"Pause":"Play",limitedUi:!0}))],GLTFAnimationPlugin.prototype,"playPauseAnimation",null),GLTFAnimationPlugin_decorate([uiButton("Stop",{limitedUi:!0})],GLTFAnimationPlugin.prototype,"stopAnimation",null),GLTFAnimationPlugin_decorate([uiButton("Reset",{limitedUi:!0})],GLTFAnimationPlugin.prototype,"resetAnimation",null),GLTFAnimationPlugin=GLTFAnimationPlugin_1=GLTFAnimationPlugin_decorate([uiFolder("GLTF Animations")],GLTFAnimationPlugin);class GLTFTimelineMarkersExtensionImport{constructor(o,c){this.parser=o,this.name=GLTFAnimationPlugin.AnimationMarkersExtension,this.plugin=c}async afterRoot(o){var c;let d=[];for(const mt of this.parser.json.scenes||[]){if(!mt.extensions)continue;const ft=mt.extensions[this.name];for(const vt of(ft==null?void 0:ft.markers)||[]){const xt=vt.camera!==void 0?await this.parser.getDependency("camera",vt.camera):void 0;vt.time===void 0&&(vt.time=vt.frame/30,console.error("Update timeline markers plugin for correct times.")),d.push({name:vt.name,frame:vt.frame,time:vt.time,camera:xt})}}if(d.length<1)return;d=d.sort((mt,ft)=>mt.frame-ft.frame);const _=(c=o.scene)!==null&&c!==void 0?c:o.scenes[0];if(!_)return;_.userData.__markers=d;const b=this.plugin.timelineMarkers,_e=d.map(mt=>mt.time);let it=b.length;const nt=d.map(mt=>it++),at=Math.max(..._e)+.01;b.push(...d);const ut=new three_module.Hit(".currentTimelineMarker",_e,nt,three_module.ljd),pt=new three_module.tz3("animationTimelineMarker",at,[ut]);pt.__gltfExport=!1,o.animations.push(pt)}}const glTFTimelineMarkersExtensionExport=h=>({afterParse(o){const c=h.json.scenes[h.json.scene||0];c.extensions=c.extensions||{};const d={markers:[]},_=[];if((Array.isArray(o)?o:[o]).forEach(b=>b.traverse(_e=>{_e.userData.__markers&&_.push(..._e.userData.__markers)})),_.sort((b,_e)=>b.frame-_e.frame),!(_.length<1)){for(const b of _){const _e=b.camera;if(_e){const it=h.nodeMap.get(_e);if(it===void 0){console.warn("Camera not found in gltf export",_e,h.nodeMap);continue}const nt=h.json.nodes[it].camera;b.camera=nt,d.markers.push(b)}}c.extensions[GLTFAnimationPlugin.AnimationMarkersExtension]=d,h.extensionsUsed[GLTFAnimationPlugin.AnimationMarkersExtension]=!0}}});var giPatch=`#if defined(SSRTAO_ENABLED) && SSRTAO_ENABLED > 0
vec4 ssgi=tSSGIMapTexelToLinear(texture2D(tSSGIMap,viewToScreen(vViewPosition.xyz).xy));float ambientOcclusion=1.-ssgi.a;ambientOcclusion=max(0.,ambientOcclusion);ambientOcclusion=pow(ambientOcclusion,ssaoPower);ambientOcclusion=min(1.,ambientOcclusion);reflectedLight.indirectDiffuse*=ambientOcclusion;
#if defined(SSGI_ENABLED) && SSGI_ENABLED > 0
vec3 ssgiColor=ssgi.rgb*ssgiIntensity;reflectedLight.indirectDiffuse+=ssgiColor*(material.diffuseColor.rgb);
#endif
#if defined( USE_ENVMAP )
float dotNV=saturate(dot(geometryNormal,geometryViewDir));float specularOcclusion=saturate(pow(dotNV+ambientOcclusion,exp2(-16.*material.roughness-1.))-1.+ambientOcclusion);reflectedLight.indirectSpecular*=specularOcclusion;
#if defined(SSGI_ENABLED) && SSGI_ENABLED > 0
#if !defined(SSR_ENABLED) || SSR_ENABLED < 1
reflectedLight.indirectSpecular+=ssgiColor*material.specularColor;
#endif
#endif
#endif
#endif
`,cameraHelpers=`#ifndef BASIC_CAMERA_HELPERS
#define BASIC_CAMERA_HELPERS 
uniform vec2 cameraNearFar;uniform vec3 cameraPositionWorld;uniform mat4 projection;
#ifndef THREE_PACKING_INCLUDED
#define THREE_PACKING_INCLUDED 
#include <packing>
#endif
float linstep(float edge0,float edge1,float value){return clamp((value-edge0)/(edge1-edge0),0.,1.);}float depthToViewZ(const in float depth){return(depth>0.999)?-cameraNearFar.y*1000.:-mix(cameraNearFar.x,cameraNearFar.y,depth);}float viewZToDepth(const in float viewZ){return linstep(-cameraNearFar.x,-cameraNearFar.y,viewZ);}vec4 viewToScreen3(const in vec3 pos){vec4 projected=projection*vec4(pos,1.);projected.z=pos.z;projected.w=1./projected.w;projected.xyz*=projected.w;projected.xy=0.5+0.5*projected.xy;return projected;}vec3 screenToView(const in vec2 uv,const in float viewZ){vec2 uv_=2.*uv-1.;float xe=-(uv_.x+projection[2][0])*viewZ/projection[0][0];float ye=-(uv_.y+projection[2][1])*viewZ/projection[1][1];return vec3(xe,ye,viewZ);}
#endif
`,samplePointHelpers=`#define PI  3.141592653589793
mat3 GetTangentBasis(vec3 TangentZ){vec3 up=vec3(0.,0.,1.);vec3 TangentX=normalize(cross(dot(TangentZ,up)<0.8?up:vec3(1.,0.,0.),TangentZ));vec3 TangentY=cross(TangentZ,TangentX);return mat3(TangentX,TangentY,TangentZ);}vec4 CosineSampleHemisphere(vec2 E){float Phi=2.*PI*E.x;float CosTheta=sqrt(E.y);float SinTheta=sqrt(1.-CosTheta*CosTheta);vec3 H;H.x=SinTheta*cos(Phi);H.y=SinTheta*sin(Phi);H.z=CosTheta;float PDF=CosTheta*(1./PI);return vec4(H,PDF);}vec4 UniformSampleHemisphere(vec2 E){float Phi=2.*PI*E.x;float CosTheta=E.y;float SinTheta=sqrt(1.-CosTheta*CosTheta);vec3 H;H.x=SinTheta*cos(Phi);H.y=SinTheta*sin(Phi);H.z=CosTheta;float PDF=1./(2.*PI);return vec4(H,PDF);}vec2 UniformSampleDiskConcentric(vec2 E){vec2 p=2.*E-1.;float Radius;float Phi;if(abs(p.x)>abs(p.y)){Radius=p.x;Phi=(PI/4.)*(p.y/p.x);}else{Radius=p.y;Phi=(PI/2.)-(PI/4.)*(p.x/p.y);}return vec2(Radius*cos(Phi),Radius*sin(Phi));}vec2 UniformSampleDiskConcentricApprox(vec2 E){vec2 sf=E*sqrt(2.)-sqrt(0.5);vec2 sq=sf*sf;float root=sqrt(2.*max(sq.x,sq.y)-min(sq.x,sq.y));if(sq.x>sq.y){sf.x=sf.x>0.?root:-root;}else{sf.y=sf.y>0.?root:-root;}return sf;}`,ssrt=`#ifndef SSRT_PARS_SNIP
#define SSRT_PARS_SNIP 
#define pow2(a)a*a
float getDepth2(const in vec2 uv,const in float lod){float viewDepth=getDepth(uv);return depthToViewZ(viewDepth);}
#define LOD_DEPTH  1.0
#define LOD_COLOR  5.0
void _traceRay(in vec4 ray_origin,in vec4 ray_dir,in float tolerance,inout vec3 state,in int loopMax,in float iStepCount){vec4 sample_uv;float d,hit;float dLod=0.;
#pragma unroll_loop_start
for(int i=0;i<8;i++){if(UNROLLED_LOOP_INDEX<loopMax){sample_uv=ray_origin+ray_dir*state.y;d=getDepth2(sample_uv.xy,dLod);d=sample_uv.z/sample_uv.w-d;if(abs(d+tolerance)<tolerance){hit=clamp(state.x/(state.x-d),0.,1.)-1.;hit=(state.y+hit*iStepCount);state.z=min(state.z,hit);}state.x=d;state.y+=1.*iStepCount;}}
#pragma unroll_loop_end
}vec3 traceRay(in vec3 ray_origin_view,in vec3 ray_dir_view,in float tolerance,inout vec3 state,in int _STEP_COUNT){vec4 sample_uv;vec4 ray_origin=viewToScreen3(ray_origin_view);vec3 ray_end_view=ray_origin_view+ray_dir_view;vec4 ray_dir=viewToScreen3(ray_end_view);vec2 clamp_end=clamp(ray_dir.xy,vec2(0.),vec2(1.));vec2 correction=abs(ray_dir.xy-clamp_end);correction=(step(0.01,correction)*correction/(abs(clamp_end-ray_origin.xy)+0.01))+1.;correction.x=1./min(max(correction.y,correction.x),10.);ray_dir=ray_dir-ray_origin;ray_dir.xyw*=correction.x;float iStepCount=1./float(_STEP_COUNT);tolerance*=0.125;_traceRay(ray_origin,ray_dir,tolerance,state,_STEP_COUNT,iStepCount);if(_STEP_COUNT>8&&state.z>0.98)_traceRay(ray_origin,ray_dir,tolerance,state,_STEP_COUNT-8,iStepCount);if(_STEP_COUNT>15&&state.z>0.98)_traceRay(ray_origin,ray_dir,tolerance,state,_STEP_COUNT-16,iStepCount);if(_STEP_COUNT>23&&state.z>0.98)_traceRay(ray_origin,ray_dir,tolerance,state,_STEP_COUNT-16,iStepCount);sample_uv=ray_origin+ray_dir*state.z;sample_uv.z/=sample_uv.w;state.z=state.z<0.999?state.z:9999999.;return sample_uv.xyz;}
#endif
`,basicHelpers=`#ifndef BASIC_HELPERS
#define BASIC_HELPERS 
float saturate2(float v,float mx){return max(0.,min(mx,v));}vec3 saturate2(vec3 v){return max(vec3(0.),min(vec3(1.),v));}
#endif
`,ssrtao=`varying vec2 vUv;uniform float frameCount2;uniform float intensity;uniform float objectRadius;uniform float rayCount;uniform float power;uniform float bias;uniform float falloff;uniform float tolerance;uniform bool autoRadius;uniform vec2 screenSize;vec3 ComputeUniformL(vec3 N,vec2 E){vec3 L;L.xy=E;L.z=interleavedGradientNoise(gl_FragCoord.xy,frameCount2*5.);L=L*2.-1.;return L;}vec2 GetRandomE(float seed){vec2 rand_e;rand_e.x=random3(vec3(gl_FragCoord.xy,frameCount2+seed));rand_e.y=random3(vec3(gl_FragCoord.yx,rand_e.x+(frameCount2)*7.));return rand_e;}vec4 calculateGI(in float seed,in vec3 screenPos,in vec3 normal,in float radiusFactor){vec3 viewPos=screenToView(screenPos.xy,screenPos.z);normal=normalize(normal);vec2 E=GetRandomE(seed);vec3 L=ComputeUniformL(normal,E);L=normalize(L);L*=sign(dot(L,normal));float cameraDist=length(cameraPositionWorld);float rayLen=autoRadius?length(viewPos-screenToView(screenPos.xy+objectRadius/10.,screenPos.z)):mix((cameraNearFar.y)+viewPos.z,-viewPos.z-cameraNearFar.x,L.z*0.5+0.5)*objectRadius;rayLen*=radiusFactor;float r=interleavedGradientNoise(gl_FragCoord.xy,frameCount2*14.+seed)+0.05;rayLen=max(rayLen,0.001);vec3 state=vec3(1.,(r+0.5)/float(RTAO_STEP_COUNT),2.);viewPos+=normal*max(-0.01*viewPos.z,0.001);vec3 screenHitP=traceRay(viewPos,L*rayLen,tolerance*rayLen,state,RTAO_STEP_COUNT);vec3 viewHitP=screenToView(screenHitP.xy,screenHitP.z);vec3 LRes=viewHitP-viewPos;if(state.z>1.)LRes=vec3(9999999.);float dist=length(LRes)*falloff;float EPS=0.01;float zBias=(viewPos.z)*bias;float ao=(max(dot(normal,L)+zBias,0.))/(dist*dist+EPS);
#if defined(SSGI_ENABLED) && SSGI_ENABLED > 0
vec3 hitColor=tLastFrameTexelToLinear(texture2D(tLastFrame,screenHitP.xy)).rgb;vec3 hitNormal=getViewNormal(screenHitP.xy);float giWeight=1.;giWeight=saturate2(giWeight/(dist+EPS),1.);giWeight*=saturate2((dot(normal,L)),1.);giWeight*=saturate2((dot(hitNormal,-L)),1.);return vec4(hitColor*giWeight,ao);
#endif
return vec4(0,0,0,ao);}float normpdf(in float x,in float sigma){return exp(-0.5*x*x/(sigma*sigma));}vec4 getLastThis(sampler2D tex,float depth,vec3 normal){vec2 direction=vec2(1,1);vec4 color=clamp(tLastThisTexelToLinear(texture2D(tex,vUv.xy)),0.,5.);return color;}void main(){float depth;vec3 normal;getDepthNormal(vUv,depth,normal);if(depth>0.99){discard;gl_FragColor=getLastThis(tLastThis,depth,normal);return;}float viewZ=depthToViewZ(depth);vec3 screenPos=vec3(vUv.x,vUv.y,viewZ);vec4 gi=vec4(0.);gi+=calculateGI(8.,screenPos,normal,1.);if(rayCount>1.5)gi=max(gi,calculateGI(2.,screenPos,normal,0.4));if(rayCount>2.5)gi=max(gi,calculateGI(3.,screenPos,normal,1.5));if(rayCount>3.5)gi=max(gi,calculateGI(1.,screenPos,normal,0.6));if(rayCount>4.5)gi=max(gi,calculateGI(3.,screenPos,normal,1.));gi.a=min(1.,gi.a);gi.a=max(0.,gi.a);gi.rgb=min(vec3(3.),gi.rgb);gi.rgb=max(vec3(0.),gi.rgb);if(frameCount2<3.){gl_FragColor=gi;return;}gl_FragColor=(texture2D(tLastThis,vUv));gl_FragColor=((gi+(gl_FragColor)*frameCount2)/(frameCount2+1.));}`,SSRTAOPass_decorate=function(h,o,c,d){var _,b=arguments.length,_e=b<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_e=Reflect.decorate(h,o,c,d);else for(var it=h.length-1;it>=0;it--)(_=h[it])&&(_e=(b<3?_(_e):b>3?_(o,c,_e):_(o,c))||_e);return b>3&&_e&&Object.defineProperty(o,c,_e),_e};class SSRTAOPass extends ShaderPass2{get ssgiEnabled(){return parseInt(this.material.defines.SSGI_ENABLED)>.5}set ssgiEnabled(o){o=o&&this._giActivated,this.material.defines.SSGI_ENABLED=o?1:0,this.material.needsUpdate=!0}constructor(o,c,d,_=!1){super({vertexShader:defaultVertex,fragmentShader:`

${basicHelpers}
${cameraHelpers}
${randomHelpers}
${samplePointHelpers}
${d}

${ssrt}

${ssrtao}

            `,uniforms:{tLastThis:{value:null},tDiffuse:{value:null},tNormalDepth:{value:null},tLastFrame:{value:null},opacity:{value:1},intensity:{value:2.14},rayCount:{value:.1},objectRadius:{value:1},autoRadius:{value:!_},power:{value:1.1},bias:{value:.015},falloff:{value:.7},tolerance:{value:1.5},frameCount:{value:0},frameCount2:{value:0},projection:{value:new three_module.kn4},screenSize:{value:new three_module.I9Y},cameraPositionWorld:{value:new three_module.Pq0},cameraNearFar:{value:new three_module.I9Y(.1,1e3)}},defines:{PERSPECTIVE_CAMERA:1,SSGI_ENABLED:_?1:0}},"tDiffuse","tLastFrame","tLastThis"),this.materialExtension={shaderExtender:(b,_e,it)=>{var nt;if(!b.defines.SSRTAO_ENABLED)return;this.materialExtension.extraUniforms.tSSGIMap.value=(nt=this._target)===null||nt===void 0?void 0:nt.texture;const at=_e.materialObject;let ut=this.material.defines.SSGI_ENABLED;at.defines.SSGI_ENABLED!==ut&&(at.defines.SSGI_ENABLED=ut,at.needsUpdate=!0),ut=this._target.texture,this.materialExtension.extraUniforms.tSSGIMap.value!==ut&&(this.materialExtension.extraUniforms.tSSGIMap.value=ut,at.needsUpdate=!0);const pt="vec3 totalDiffuse =",mt=`
            
            ${giPatch}
            
            // reflectedLight.directDiffuse = vec3(0.);
            // reflectedLight.indirectDiffuse = vec3(0.);
            // reflectedLight.directSpecular = vec3(0.);
            // reflectedLight.indirectSpecular = vec3(0.);
            
            `;b.fragmentShader=b.fragmentShader.replace(pt,`
${mt}
${pt}`),b.fragmentShader=b.fragmentShader.replace("#include <aomap_fragment>",""),b.defines.USE_UV=""},onObjectRender:(b,_e,it)=>{var nt,at,ut;const pt=_e.materialObject,mt=!pt.transparent&&pt.transmission<.001,ft=this.enabled&&mt&&(this.renderWithCamera||this._renderer.frameCount>1)&&it.userData.screenSpaceRendering!==!1&&!(!((nt=pt.userData)===null||nt===void 0)&&nt.ssrtaoDisabled)&&!(!((at=pt.userData)===null||at===void 0)&&at.ssaoDisabled)&&!(!((ut=pt.userData)===null||ut===void 0)&&ut.pluginsDisabled)?1:0;pt.defines.SSRTAO_ENABLED!==ft&&(pt.defines.SSRTAO_ENABLED=ft,pt.needsUpdate=!0)},parsFragmentSnippet:b=>{var _e;return fe$1`
            uniform float ssaoPower;
            uniform float ssgiIntensity;
            uniform sampler2D tSSGIMap;
            ${getTexelDecoding("tSSGIMap",(_e=this._target)===null||_e===void 0?void 0:_e.texture.colorSpace)}

            ${simpleCameraHelpers}

        `},extraUniforms:{tSSGIMap:{value:null},ssaoPower:this.material.uniforms.power,ssgiIntensity:this.material.uniforms.intensity},computeCacheKey:b=>{var _e,it,nt,at;return this.enabled?"1":"0"+((it=(_e=this._target)===null||_e===void 0?void 0:_e.texture)===null||it===void 0?void 0:it.colorSpace)+((at=(nt=this._target)===null||nt===void 0?void 0:nt.texture)===null||at===void 0?void 0:at.uuid)+this.material.defines.SSGI_ENABLED},isCompatible:b=>{var _e;return!(!((_e=b.materialObject.userData)===null||_e===void 0)&&_e.ssaoDisabled)&&b.isMeshStandardMaterial2}},this.intensity=2,this.power=1.1,this.autoRadius=!0,this.objectRadius=2,this.tolerance=1,this.bias=.15,this.falloff=.7,this.rayCount=2,this.stepCount=4,this.smoothEnabled=!0,this.renderWithCamera=!0,this.uiConfig={type:"folder",label:"SS Global illumination (Dev)",children:[...generateUiConfig(this),{type:"checkbox",label:"GI Enabled",hidden:()=>!this._giActivated,property:[this,"ssgiEnabled"]}]},this._renderer=o,this._target=c,this.needsSwap=!0,this._giActivated=_,this.ssgiEnabled=_,this.bilateralPass=new BilateralFilterPass(this._target,d,"rgba")}render(o,c,d,_,b){this.needsSwap=!1,!this.renderWithCamera&&this._renderer.frameCount<2||(this._renderer.blit(this._target.texture,c),this.uniforms.tLastThis.value=c.texture,super.render(o,this._target,d,_,b),this.smoothEnabled&&this.bilateralPass.render(o,c,d,_,b))}}SSRTAOPass_decorate([serialize()],SSRTAOPass.prototype,"bilateralPass",void 0),SSRTAOPass_decorate([uiSlider("Intensity",[0,4]),serialize(),uniform()],SSRTAOPass.prototype,"intensity",void 0),SSRTAOPass_decorate([uiSlider("Power",[0,3]),serialize(),uniform()],SSRTAOPass.prototype,"power",void 0),SSRTAOPass_decorate([uiToggle("Auto radius"),serialize(),uniform()],SSRTAOPass.prototype,"autoRadius",void 0),SSRTAOPass_decorate([uiSlider("Object Radius",[.01,10]),serialize(),uniform()],SSRTAOPass.prototype,"objectRadius",void 0),SSRTAOPass_decorate([uiSlider("Tolerance",[.1,5]),serialize(),uniform()],SSRTAOPass.prototype,"tolerance",void 0),SSRTAOPass_decorate([uiSlider("Bias",[-.3,.3]),serialize(),uniform()],SSRTAOPass.prototype,"bias",void 0),SSRTAOPass_decorate([uiSlider("Falloff",[1e-4,4]),serialize(),uniform()],SSRTAOPass.prototype,"falloff",void 0),SSRTAOPass_decorate([uiSlider("Ray Count",[1,5],1),serialize(),uniform()],SSRTAOPass.prototype,"rayCount",void 0),SSRTAOPass_decorate([uiSlider("Step count",[1,16],1),serialize(),matDefine("RTAO_STEP_COUNT")],SSRTAOPass.prototype,"stepCount",void 0),SSRTAOPass_decorate([uiToggle("Smooth Enabled"),serialize()],SSRTAOPass.prototype,"smoothEnabled",void 0),SSRTAOPass_decorate([uiToggle("Render with Camera")],SSRTAOPass.prototype,"renderWithCamera",void 0);class SSGIPlugin extends MultiFilterPlugin{get rtgiTarget(){return this._rtgiTarget}constructor(o=!0){super(),this.dependencies=[AssetManagerPlugin,GBufferPlugin,ProgressivePlugin],this._initEnabled=!1,this.setDirty=this.setDirty.bind(this),this._initEnabled=o}async onAdded(o){var c,d;await super.onAdded(o),this.enabled=this._initEnabled,(d=(c=this.uiConfig).uiRefresh)===null||d===void 0||d.call(c,"postFrame",!0)}get enabled(){var o,c;return((c=(o=this.passes.ssrtgi)===null||o===void 0?void 0:o.passObject)===null||c===void 0?void 0:c.enabled)||!1}set enabled(o){var c;!((c=this.passes.ssrtgi)===null||c===void 0)&&c.passObject&&(this.passes.ssrtgi.passObject.enabled=o)}createPasses(o){var c,d,_;return this._rtgiTarget=o.renderer.createTarget({sizeMultiplier:1}),(c=this._viewer)===null||c===void 0||c.getPluginByType("debug"),[makeFilter(o,{passId:"ssrtgi",after:["gbuffer"],before:["render"],required:["render","gbuffer","progressive"],passObject:new SSRTAOPass(o.renderer,this._rtgiTarget,(_=(d=o.getPlugin(GBufferPlugin))===null||d===void 0?void 0:d.getUnpackSnippet())!==null&&_!==void 0?_:"",!0),update:()=>{var b;const _e=this.enabled;if(_e){const it=(b=this._viewer)===null||b===void 0?void 0:b.getPluginByType("SSAO");it!=null&&it.enabled&&(it.enabled=!1)}_e&&this.passes.ssrtgi.passObject.bilateralPass.updateShaderProperties([o.getPlugin(GBufferPlugin)])}},()=>[o.getPlugin(GBufferPlugin),o.getPlugin(ProgressivePlugin),o.scene.activeCamera,o.renderer])]}async onRemove(o){return o.renderer.disposeTarget(this._rtgiTarget),super.onRemove(o)}setDirty(){var o;(o=this._viewer)===null||o===void 0||o.setDirty()}get uiConfig(){var o,c,d,_,b;const _e=(d=(c=(o=this.passes.ssrtgi)===null||o===void 0?void 0:o.passObject)===null||c===void 0?void 0:c.uiConfig)!==null&&d!==void 0?d:{};return(b=(_=_e.children)===null||_===void 0?void 0:_.map(it=>Ee$1(it)))===null||b===void 0||b.flat(2).forEach(it=>it&&(it.onChange=this.setDirty)),_e}}SSGIPlugin.PluginType="SSGI";var NormalRenderPass_decorate=function(h,o,c,d){var _,b=arguments.length,_e=b<3?o:d===null?d=Object.getOwnPropertyDescriptor(o,c):d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_e=Reflect.decorate(h,o,c,d);else for(var it=h.length-1;it>=0;it--)(_=h[it])&&(_e=(b<3?_(_e):b>3?_(o,c,_e):_(o,c))||_e);return b>3&&_e&&Object.defineProperty(o,c,_e),_e};let NormalRenderPass=class extends RenderPass{constructor(h,o,c){super(h,o,c??new NormalMaterial,new three_module.Q1f(0,0,0),1),this.enabled=!0,this._firstCall=!0}render(h,o,c,d,_){this.enabled&&super.render(h,o,c,d,_)}};NormalRenderPass=NormalRenderPass_decorate([uiFolder("High Precision Normal Buffer")],NormalRenderPass);class NormalMaterial extends three_module.qBx{constructor(){super()}onBeforeRender(o,c,d,_,b){var _e,it,nt;let at=b.material;Array.isArray(at)&&(at=at[0]),this.normalMap=(_e=at==null?void 0:at.normalMap)!==null&&_e!==void 0?_e:null,this.bumpMap=(it=at==null?void 0:at.bumpMap)!==null&&it!==void 0?it:null,this.bumpScale=at==null?void 0:at.bumpScale,at!=null&&at.normalScale&&this.normalScale.copy(at==null?void 0:at.normalScale),this.needsUpdate=!0,this.side=(nt=at.side)!==null&&nt!==void 0?nt:three_module.$EB}}class NormalBufferPlugin extends GenericFilterPlugin{passCtor(o){this._normalTarget=o.renderer.createTarget({depthBuffer:!0,type:three_module.ix0,minFilter:three_module.hxR,magFilter:three_module.hxR,generateMipmaps:!1}),this._normalTarget.texture.name="normalBuffer",this._normalTarget.texture.generateMipmaps=!1;const c=this._normalTarget,d=new Set,_=new Set;return new class extends NormalRenderPass{render(b,_e,it,nt,at){const ut=b.getRenderTarget(),pt=b.getActiveCubeFace(),mt=b.getActiveMipmapLevel();this.scene&&(this.scene.traverse(({material:ft})=>{ft&&((ft.transparent&&ft.userData.renderToDepth||!ft.transparent&&ft.transmission===0&&ft.userData.renderToDepth===!1)&&(d.add(ft),ft.transparent=!ft.transparent),Math.abs(ft.transmission||0)>0&&ft.userData.renderToDepth&&(_.add([ft,ft.transmission]),ft.transmission=0))}),setThreeRendererMode(b,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!0,transparentRender:!1,transmissionRender:!1,mainRenderPass:!1},()=>super.render(b,_e,c,nt,at)),d.forEach(ft=>ft.transparent=!ft.transparent),d.clear(),_.forEach(([ft,vt])=>ft.transmission=vt),_.clear(),b.setRenderTarget(ut,pt,mt))}}}_update(o){if(!super._update(o))return!1;const c=this.pass.passObject;return c.scene=o.scene.modelObject,c.camera=o.scene.activeCamera.cameraObject,!0}constructor(o=!0){super(),this.passId="normalBuffer",this._beforeFilters=["render"],this._afterFilters=[],this._requiredFilters=["render"],this.enabled=o}getNormalBuffer(){return this._normalTarget}async onDispose(o){}async onRemove(o){var c,d;return o.renderer.disposeTarget((d=(c=this._normalTarget)===null||c===void 0?void 0:c.dispose)===null||d===void 0?void 0:d.call(c)),super.onRemove(o)}updateShaderProperties(o){var c,d;return o.uniforms.tNormalBuffer?o.uniforms.tNormalBuffer.value=this.enabled&&(d=(c=this.getNormalBuffer())===null||c===void 0?void 0:c.texture)!==null&&d!==void 0?d:null:console.warn("BaseRenderer: no uniform: tNormalBuffer"),this}get uiConfig(){var o;return(o=this.pass)===null||o===void 0?void 0:o.passObject.uiConfig}}NormalBufferPlugin.PluginType="NormalBufferPlugin";class e{static _xfnv1a(o){let c=2166136261;for(let d=0;d<o.length;d++)c=Math.imul(c^o.charCodeAt(d),16777619);return()=>(c+=c<<13,c^=c>>>7,c+=c<<3,c^=c>>>17,(c+=c<<5)>>>0)}}let t$1=class bw extends e{constructor(o){super(),Object.defineProperty(this,"a",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.a=bw._xfnv1a(o)()}next(){let o=this.a+=1831565813;return o=Math.imul(o^o>>>15,1|o),o^=o+Math.imul(o^o>>>7,61|o),((o^o>>>14)>>>0)/4294967296}};class es_i extends e{constructor(o){super(),Object.defineProperty(this,"a",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"b",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"c",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"d",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const c=es_i._xfnv1a(o);this.a=c(),this.b=c(),this.c=c(),this.d=c()}next(){this.a>>>=0,this.b>>>=0,this.c>>>=0,this.d>>>=0;let o=this.a+this.b|0;return this.a=this.b^this.b>>>9,this.b=this.c+(this.c<<3)|0,this.c=this.c<<21|this.c>>>11,this.d=this.d+1|0,o=o+this.d|0,this.c=this.c+o|0,(o>>>0)/4294967296}}let r$1=class xw extends e{constructor(o){super(),Object.defineProperty(this,"a",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"b",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"c",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"d",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const c=xw._xfnv1a(o);this.a=c(),this.b=c(),this.c=c(),this.d=c()}next(){const o=this.b<<9;let c=5*this.b;return c=9*(c<<7|c>>>25),this.c^=this.a,this.d^=this.b,this.b^=this.c,this.a^=this.d,this.c^=o,this.d=this.d<<11|this.d>>>21,(c>>>0)/4294967296}};var s;(function(h){h.sfc32="sfc32",h.mulberry32="mulberry32",h.xoshiro128ss="xoshiro128ss"})(s||(s={}));class a{constructor(o,c=s.sfc32){Object.defineProperty(this,"str",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"prng",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"generator",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.str=o,this.prng=c,this.generator=this._initializeGenerator()}next(){return this.generator.next()}_initializeGenerator(){if((c=>c===null)(o=this.str)||(c=>c===void 0)(o))return this.wrap();var o;switch(this.prng){case"sfc32":return new es_i(this.str);case"mulberry32":return new t$1(this.str);case"xoshiro128ss":return new r$1(this.str);default:return this.wrap()}}wrap(){return{next:()=>Math.random()}}}var RandomizedDirectionalLight_decorate=function(h,o,c,d){var _,b=arguments.length,_e=b<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_e=Reflect.decorate(h,o,c,d);else for(var it=h.length-1;it>=0;it--)(_=h[it])&&(_e=(b<3?_(_e):b>3?_(o,c,_e):_(o,c))||_e);return b>3&&_e&&Object.defineProperty(o,c,_e),_e};class RandomizedDirectionalLight extends DirectionalLight2{constructor(o,c,d,_){super(o,c),this._shadowParams={enabled:!0,radius:2,width:1024,height:1024,bias:-.001,normalBias:0,near:1.5,far:4,frustumSize:4},this._randomParams={focus:1,spread:.01,distanceScale:50,minDistanceScale:new three_module.Pq0(10,10,10),normalDirection:new three_module.Pq0(.01,.98,.01).normalize(),direction:new three_module.Pq0(-.9,.5,-1)},this.isRandomizedDirectionalLight=!0,this.shadowParams=d??{},this.randomParams=_??{},this.updateShadowParams=this.updateShadowParams.bind(this)}get shadowParams(){return this._shadowParams}set shadowParams(o){Object.keys(o).forEach(c=>o[c]===void 0&&delete o[c]),this._shadowParams={...this._shadowParams,...o},this.updateShadowParams()}get randomParams(){return this._randomParams}set randomParams(o){Object.keys(o).forEach(c=>o[c]===void 0&&delete o[c]),Object.assign(this._randomParams,o)}updateShadowParams(){this.castShadow=this._shadowParams.enabled,this.shadow.mapSize.x=this._shadowParams.width,this.shadow.mapSize.y=this._shadowParams.height,this.shadow.bias=this._shadowParams.bias,this.shadow.normalBias=this._shadowParams.normalBias,this.refreshShadowCamNearFar(),this.shadow.radius=this._shadowParams.radius,this.shadow.camera.right=this._shadowParams.frustumSize/2,this.shadow.camera.left=-this._shadowParams.frustumSize/2,this.shadow.camera.top=this._shadowParams.frustumSize/2,this.shadow.camera.bottom=-this._shadowParams.frustumSize/2,this.shadow.camera.updateProjectionMatrix(),this.matrixWorldNeedsUpdate=!0}randomizePosition(o,c=null,d=null){const _=new a(o.toString()),b=new three_module.I9Y(_.next()*Math.PI*2,Math.asin(2*_.next()-1));let _e=new three_module.Pq0(Math.cos(b.x)*Math.cos(b.y),Math.sin(b.y),Math.sin(b.x)*Math.cos(b.y));const it=new three_module.I9Y;for(let nt=0;nt<5;nt++){it.set(_.next(),_.next()),_e=getSample(it,this._randomParams.normalDirection,.4),_.next()<Math.sqrt(c??this._randomParams.focus)&&(it.set(_.next(),_.next()),_e=getSample(it,this._randomParams.direction,Math.pow((d??this._randomParams.spread)/2,2)));const at=_e.dot(this._randomParams.normalDirection);if(at>0&&at<.4)break}_e.normalize(),_e.multiplyScalar(this._randomParams.distanceScale),this.position.set(0,0,0),this.target.position.copy(_e.normalize().negate()),this.target.updateMatrixWorld(),this.refreshShadowCamNearFar(),this.updateMatrixWorld()}refreshShadowCamNearFar(){const o=new three_module.Pq0().subVectors(this.target.position,this.shadow.camera.position).length();this.shadow.camera.near=o-this._shadowParams.near*this._shadowParams.frustumSize/2,this.shadow.camera.far=o+this._shadowParams.far*this._shadowParams.frustumSize/2}dispose(){}get uiConfig(){if(this._uiConfig)return this._uiConfig}fromJSON(o,c){return super.fromJSON(o,c)?(this.updateShadowParams(),this):null}}function getSample(h,o,c){o=o.clone().normalize();const d=new three_module.Pq0(0,-o.z,o.y).normalize(),_=new three_module.Pq0().crossVectors(o,d).normalize(),b=h;b.x=2*b.x*Math.PI,b.y=1-b.y*c;const _e=Math.sqrt(1-b.y*b.y);return d.multiplyScalar(Math.cos(b.x)*_e).add(_.multiplyScalar(Math.sin(b.x)*_e)).add(o.multiplyScalar(b.y))}RandomizedDirectionalLight_decorate([serialize("shadowParams")],RandomizedDirectionalLight.prototype,"_shadowParams",void 0),RandomizedDirectionalLight_decorate([serialize("randomParams")],RandomizedDirectionalLight.prototype,"_randomParams",void 0);var RandomizedDirectionalLightPlugin_decorate=function(h,o,c,d){var _,b=arguments.length,_e=b<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_e=Reflect.decorate(h,o,c,d);else for(var it=h.length-1;it>=0;it--)(_=h[it])&&(_e=(b<3?_(_e):b>3?_(o,c,_e):_(o,c))||_e);return b>3&&_e&&Object.defineProperty(o,c,_e),_e};class RandomizedDirectionalLightPlugin extends AViewerPlugin{get cameraHelper(){return this._cameraHelper}constructor(o=!0){super(),this.enabled=!0,this.light=new RandomizedDirectionalLight("#cceeff",.3),this.lightLayers=1,this._preRender=()=>{var c,d,_;if(!this.enabled)return void(this.light.layers.mask=0);const b=(d=(c=this._viewer)===null||c===void 0?void 0:c.renderer.frameCount)!==null&&d!==void 0?d:0;this.light.randomizePosition(b<5?0:b),this.light.layers.mask=this.lightLayers,this.light.updateShadowParams(),(_=this._cameraHelper)===null||_===void 0||_.update()},this._setDirty=this._setDirty.bind(this),this.enabled=o}async onAdded(o){await super.onAdded(o),this._cameraHelper=new three_module.WTh(this.light.shadow.camera),this._cameraHelper.visible=!1,this._cameraHelper.userData.bboxVisible=!1,o.scene.add(this._cameraHelper),o.scene.addLight(this.light,{addToRoot:!0}),o.addEventListener("preRender",this._preRender)}async onRemove(o){return o.removeEventListener("preRender",this._preRender),this.light.removeFromParent(),super.onRemove(o)}_setDirty(o=!1){var c,d;o?(c=this._viewer)===null||c===void 0||c.scene.setDirty():(d=this._viewer)===null||d===void 0||d.setDirty()}get uiConfig(){return this._uiConfig?this._uiConfig:this._uiConfig={type:"folder",label:"Progressive Shadow",children:[{type:"checkbox",label:"Enabled",property:[this,"enabled"],onChange:this._setDirty},{type:"folder",label:"Directional Light",children:[{type:"checkbox",label:"Visible",property:[this.light,"visible"],onChange:this._setDirty},{type:"slider",label:"Intensity",bounds:[0,50],property:[this.light,"intensity"],onChange:this._setDirty},{type:"color",label:"Color",property:[this.light,"color"],onChange:this._setDirty},{type:"checkbox",label:"Shadow Enabled",property:[this.light.shadowParams,"enabled"],onChange:[this.light.updateShadowParams,this._setDirty]},{type:"slider",bounds:[0,1],property:[this.light.randomParams,"focus"],onChange:this._setDirty},{type:"slider",bounds:[0,1],property:[this.light.randomParams,"spread"],onChange:this._setDirty},{type:"slider",bounds:[.01,60],property:[this.light.randomParams,"distanceScale"],onChange:this._setDirty},{type:"vec3",bounds:[-5,5],property:[this.light.randomParams,"direction"],onChange:this._setDirty},{type:"slider",bounds:[.01,10],property:[this.light.shadowParams,"radius"],onChange:[this.light.updateShadowParams,this._setDirty]},{type:"slider",bounds:[.01,30],property:[this.light.shadowParams,"frustumSize"],onChange:[this.light.updateShadowParams,this._setDirty]},{type:"slider",bounds:[-.01,.01],property:[this.light.shadowParams,"bias"],onChange:[this.light.updateShadowParams,this._setDirty]},{type:"slider",bounds:[-.05,.05],property:[this.light.shadowParams,"normalBias"],onChange:[this.light.updateShadowParams,this._setDirty]}]}]}}}RandomizedDirectionalLightPlugin.PluginType="RandomizedDirectionalLight",RandomizedDirectionalLightPlugin_decorate([serialize()],RandomizedDirectionalLightPlugin.prototype,"enabled",void 0),RandomizedDirectionalLightPlugin_decorate([serialize("rdLight")],RandomizedDirectionalLightPlugin.prototype,"light",void 0),RandomizedDirectionalLightPlugin_decorate([serialize()],RandomizedDirectionalLightPlugin.prototype,"lightLayers",void 0);var ssrPatch=`#if defined(SSR_ENABLED) && SSR_ENABLED > 0
vec3 screenPos=viewToScreen(geometryPosition);vec4 ssrColor=vec4(0,0,0,0);float alphaModifier=1.-clamp(material.roughness*.3,0.,1.);alphaModifier*=ssrIntensity;
#if defined(SSR_MASK_FRONT_RAYS) && SSR_MASK_FRONT_RAYS > 0
alphaModifier*=clamp(-4.*dot(geometryViewDir,normal)+(4.+ssrMaskFrontFactor),0.,1.);
#endif
#ifdef USE_TRANSMISSION
alphaModifier*=1.-transmission;
#endif
float vignette=1.;if(true){float fadeStrength=0.1;float dist=max(0.,min(min(1.-screenPos.x,1.-screenPos.y),min(screenPos.x,screenPos.y)));float fade=dist*dist/(fadeStrength+0.001);fade=clamp(fade,0.,1.);fade=pow(fade,0.3);vignette=fade;}alphaModifier*=vignette;vec3 specularColor=EnvironmentBRDF(geometryNormal,geometryViewDir,material.specularColor.rgb,material.specularF90,material.roughness);if(length(specularColor.rgb)*alphaModifier>0.01&&roughnessFactor<0.9){
#if defined(SSR_INLINE) && SSR_INLINE > 0
ssrColor=calculateSSR(8.,vec3(screenPos.xy,geometryPosition.z),geometryNormal,1.,material.roughness);
#else
ssrColor=tSSRMapTexelToLinear(texture2D(tSSRMap,screenPos.xy));
#endif 
}ssrColor.rgb*=ssrBoost;ssrColor.a*=alphaModifier;ssrColor.a=min(ssrColor.a,1.);
#if defined(SSR_NON_PHYSICAL) && SSR_NON_PHYSICAL > 0
diffuseColor.a=max(ssrColor.a,diffuseColor.a*diffuseColor.a);reflectedLight.indirectSpecular=mix(reflectedLight.indirectSpecular,saturate(diffuseColor.rgb*ssrColor.rgb),1.);reflectedLight.indirectDiffuse=diffuseColor.rgb*(1.-ssrColor.a);reflectedLight.directDiffuse=vec3(0.);reflectedLight.directSpecular=vec3(0.);
#else
reflectedLight.indirectSpecular=mix(reflectedLight.indirectSpecular,saturate(specularColor.rgb*ssrColor.rgb),ssrColor.a);
#endif
#endif
`,ssreflection=`uniform float objectRadius;uniform float radius;uniform float tolerance;uniform bool autoRadius;
#ifndef D_sceneBoundingRadius
#define D_sceneBoundingRadius 
uniform float sceneBoundingRadius;
#endif
vec3 ComputeReflectionL(vec3 N,vec2 E,vec3 V,float rough){float rough4=rough*rough*rough*rough;float phi=2.*PI*E.x;float cos_theta=pow(max(E.y,0.000001),rough4/(2.-rough4));float sin_theta=sqrt(max(0.,1.-cos_theta*cos_theta));vec3 half_vec=vec3(sin_theta*cos(phi),sin_theta*sin(phi),cos_theta);vec3 tangentX=normalize(cross(abs(N.z)<0.999?vec3(0.,0.,1.):vec3(1.,0.,0.),N));vec3 tangentY=cross(N,tangentX);half_vec=half_vec.x*tangentX+half_vec.y*tangentY+half_vec.z*N;vec3 ray_dir=(2.*dot(V,half_vec))*half_vec-V;return ray_dir;}vec2 GetRandomE(float seed){vec2 rand_e;rand_e.x=interleavedGradientNoise(gl_FragCoord.xy,frameCount*117.);rand_e.y=fract(rand_e.x*38.65435);rand_e.y=mix(rand_e.y,1.,0.7);return rand_e;}vec4 calculateSSR(in float seed,in vec3 screenPos,in vec3 normal,in float radiusFactor,in float roughness){vec3 viewPos=screenToView(screenPos.xy,screenPos.z);normal=normalize(normal);vec2 E=GetRandomE(seed);vec3 L=ComputeReflectionL(normal,E,-normalize(viewPos),roughness);L=normalize(L);float cameraDist=length(cameraPositionWorld);float rayLen=objectRadius*sceneBoundingRadius;rayLen=autoRadius?min(max(mix(max(0.,(cameraDist+rayLen)+viewPos.z),max(0.,-viewPos.z-max(0.,cameraDist-rayLen)),L.z*0.5+0.5),rayLen*0.1),rayLen*5.):rayLen;rayLen*=radiusFactor;float r=interleavedGradientNoise(gl_FragCoord.xy,frameCount+seed);rayLen=max(rayLen,0.001);int steps=SSR_STEP_COUNT/(frameCount<float(SSR_LOW_QUALITY_FRAMES)?2:1);vec3 state=vec3(0.,(r+0.5)/float(steps),2.);viewPos+=normal*max(-0.0001*viewPos.z,0.001);vec3 screenHitP=traceRay(viewPos,L*rayLen,tolerance*rayLen,state,steps);if(state.z<0.9999){vec3 hitColor=(tLastFrameTexelToLinear(texture2D(tLastFrame,screenHitP.xy))).rgb;float ssrWeight=1.;return vec4(hitColor*ssrWeight,1.);}return vec4(0.);}`,ssreflectionMain=`uniform sampler2D tLastThis;void main(){vec4 texel=tDiffuseTexelToLinear(texture2D(tDiffuse,vUv));vec4 lastAO=tLastThisTexelToLinear(texture2D(tLastThis,vUv));float depth;vec3 normal;getDepthNormal(vUv,depth,normal);if(depth>=0.999){discard;}float viewZ=depthToViewZ(depth);vec3 screenPos=vec3(vUv.x,vUv.y,viewZ);vec3 viewPos=screenToView(screenPos.xy,screenPos.z);viewPos.z=viewZ/viewPos.z;vec4 ao=vec4(0.);ao+=calculateSSR(8.,screenPos,normal,1.,0.1);ao.rgb=min(vec3(3.),ao.rgb);ao.rgb=max(vec3(0.),ao.rgb);if(frameCount<1.){gl_FragColor=ao;return;}if(ao.a<0.01){gl_FragColor.rgb=lastAO.rgb;gl_FragColor.a=(((lastAO.a)*frameCount)/(frameCount+1.));}else{gl_FragColor=((ao+(lastAO)*frameCount)/(frameCount+1.));}
#include <colorspace_fragment>
}`,SSRPass_decorate=function(h,o,c,d){var _,b=arguments.length,_e=b<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_e=Reflect.decorate(h,o,c,d);else for(var it=h.length-1;it>=0;it--)(_=h[it])&&(_e=(b<3?_(_e):b>3?_(o,c,_e):_(o,c))||_e);return b>3&&_e&&Object.defineProperty(o,c,_e),_e};let SSRPass=class extends ShaderPass2{constructor(h,o,c,d=!0){super({vertexShader:defaultVertex,fragmentShader:`

varying vec2 vUv;

${basicHelpers}
${cameraHelpers}
${randomHelpers}
${samplePointHelpers}
${c}

${ssrt}

${ssreflection}

${ssreflectionMain}


            `,uniforms:{tLastThis:{value:null},tDiffuse:{value:null},tNormalDepth:{value:null},tLastFrame:{value:null},opacity:{value:1},intensity:{value:0},boost:{value:new three_module.Pq0(0,0,0)},objectRadius:{value:0},autoRadius:{value:!1},power:{value:0},maskFrontFactor:{value:-.1},tolerance:{value:0},frameCount:{value:0},projection:{value:new three_module.kn4},cameraPositionWorld:{value:new three_module.Pq0},cameraNearFar:{value:new three_module.I9Y(.1,1e3)},sceneBoundingRadius:{value:0}},defines:{PERSPECTIVE_CAMERA:1,SSR_STEP_COUNT:16,SSR_LOW_QUALITY_FRAMES:2,SSR_MASK_FRONT_RAYS:!0,SSR_INLINE:d?"1":"0",SSR_NON_PHYSICAL:"0"}},"tDiffuse","tLastThis","tLastFrame"),this.uiConfig=void 0,this.materialExtension={shaderExtender:(_,b,_e)=>{var it,nt,at,ut,pt;let mt=!this.enabled||_e.userData.screenSpaceRendering===!1||!((it=b.materialObject.userData)===null||it===void 0)&&it.pluginsDisabled||!((nt=b.materialObject.userData)===null||nt===void 0)&&nt.ssreflDisabled?0:1;if(b.materialObject.defines.SSR_ENABLED!==mt&&(b.materialObject.defines.SSR_ENABLED=mt,b.materialObject.needsUpdate=!0),!_.defines.SSR_ENABLED)return;mt=this.material.defines.SSR_STEP_COUNT,b.materialObject.defines.SSR_STEP_COUNT!==mt&&(b.materialObject.defines.SSR_STEP_COUNT=mt,b.materialObject.needsUpdate=!0),mt=this.material.defines.SSR_LOW_QUALITY_FRAMES,b.materialObject.defines.SSR_LOW_QUALITY_FRAMES!==mt&&(b.materialObject.defines.SSR_LOW_QUALITY_FRAMES=mt,b.materialObject.needsUpdate=!0),mt=this.material.defines.PERSPECTIVE_CAMERA,b.materialObject.defines.PERSPECTIVE_CAMERA!==mt&&(b.materialObject.defines.PERSPECTIVE_CAMERA=mt,b.materialObject.needsUpdate=!0),mt=this.material.defines.SSR_INLINE,b.materialObject.defines.SSR_INLINE!==mt&&(b.materialObject.defines.SSR_INLINE=mt,b.materialObject.needsUpdate=!0),mt=this.material.defines.SSR_MASK_FRONT_RAYS?1:0,b.materialObject.defines.SSR_MASK_FRONT_RAYS!==mt&&(b.materialObject.defines.SSR_MASK_FRONT_RAYS=mt,b.materialObject.needsUpdate=!0),mt=!((at=b.materialObject.userData)===null||at===void 0)&&at.ssreflNonPhysical?"1":"0",b.materialObject.defines.SSR_NON_PHYSICAL!==mt&&(b.materialObject.defines.SSR_NON_PHYSICAL=mt,b.materialObject.needsUpdate=!0),mt=(pt=(ut=this._target)===null||ut===void 0?void 0:ut.texture)!==null&&pt!==void 0?pt:null,this.materialExtension.extraUniforms.tSSRMap.value!==mt&&(this.materialExtension.extraUniforms.tSSRMap.value=mt,b.materialObject.needsUpdate=!0);const ft="#glMarker beforeModulation",vt=`
            
            ${ssrPatch}
            
            // reflectedLight.directDiffuse = vec3(0.);
            // reflectedLight.indirectDiffuse = vec3(0.);
            // reflectedLight.directSpecular = vec3(0.);
            // reflectedLight.indirectSpecular = vec3(0.);
            
            `;_.fragmentShader=_.fragmentShader.replace(ft,`
${vt}
${ft}`)},onObjectRender:(_,b,_e)=>{var it,nt;const at=!this.enabled||_e.userData.screenSpaceRendering===!1||!((it=b.materialObject.userData)===null||it===void 0)&&it.pluginsDisabled||!((nt=b.materialObject.userData)===null||nt===void 0)&&nt.ssreflDisabled?0:1;b.materialObject.defines.SSR_ENABLED!==at&&(b.materialObject.defines.SSR_ENABLED=at,b.materialObject.needsUpdate=!0)},parsFragmentSnippet:(_,b)=>{var _e,it,nt,at;return!this.enabled||_.userData.screenSpaceRendering===!1||!((_e=b==null?void 0:b.materialObject.userData)===null||_e===void 0)&&_e.ssreflDisabled||!((it=b==null?void 0:b.materialObject.userData)===null||it===void 0)&&it.pluginsDisabled?"":`
uniform float ssrPower;
uniform float ssrIntensity;
uniform float ssrMaskFrontFactor;
uniform vec3 ssrBoost;
uniform sampler2D tSSRMap;
uniform sampler2D tLastFrame;
`+getTexelDecoding("tSSRMap",(nt=this._target)===null||nt===void 0?void 0:nt.texture.colorSpace)+getTexelDecoding("tLastFrame",(at=this.materialExtension.extraUniforms.tLastFrame.value)===null||at===void 0?void 0:at.colorSpace)+(this._inline?`
#if 1
// #if SSR_INLINE
    ${basicHelpers}
    
    #define THREE_PACKING_INCLUDED
    ${cameraHelpers}
    
    ${randomHelpers}
    ${samplePointHelpers}
    ${unpackGbuffer}
    
    ${ssrt}
    
    ${ssreflection}
// #endif // SSR_INLINE
#endif
`:"")+`
${simpleCameraHelpers}
        `},extraUniforms:{tSSRMap:{value:null},ssrPower:this.material.uniforms.power,ssrIntensity:this.material.uniforms.intensity,ssrMaskFrontFactor:this.material.uniforms.maskFrontFactor,ssrBoost:this.material.uniforms.boost,tNormalDepth:this.material.uniforms.tNormalDepth,tLastFrame:this.material.uniforms.tLastFrame,objectRadius:this.material.uniforms.objectRadius,autoRadius:this.material.uniforms.autoRadius,tolerance:this.material.uniforms.tolerance,frameCount:this.material.uniforms.frameCount,projection:this.material.uniforms.projection,cameraPositionWorld:this.material.uniforms.cameraPositionWorld,cameraNearFar:this.material.uniforms.cameraNearFar,sceneBoundingRadius:this.material.uniforms.sceneBoundingRadius},computeCacheKey:_=>{var b,_e,it;return this.enabled?"1":"0"+((_e=(b=this._target)===null||b===void 0?void 0:b.texture)===null||_e===void 0?void 0:_e.colorSpace)+(this.enabled&&!(!((it=_.materialObject.userData)===null||it===void 0)&&it.ssreflDisabled)?1:0)+Object.values(this.material.defines).map(nt=>nt+"").join(",")},isCompatible:_=>{var b;return!(!((b=_.materialObject.userData)===null||b===void 0)&&b.ssreflDisabled)&&_.isMeshStandardMaterial2}},this.intensity=1,this.boost=new three_module.Pq0(1,1,1),this.objectRadius=1,this.autoRadius=!0,this.power=1.1,this.tolerance=.5,this.stepCount=16,this.lowQualityFrames=0,this.maskFrontRays=!0,this.maskFrontFactor=-.2,this._renderer=h,this._target=o,this.needsSwap=!1,this._inline=d}render(h,o,c,d,_){if(this._inline)this.needsSwap=!1;else{if(!this._target)throw"Target must be set when inline = false";this._renderer.blit(this._target.texture,o,{}),this.uniforms.tLastThis.value=o.texture,super.render(h,this._target,c,d,_),this.needsSwap=!1}}};SSRPass_decorate([uiSlider("Intensity",[0,4]),serialize(),uniform()],SSRPass.prototype,"intensity",void 0),SSRPass_decorate([uiVector("Boost"),serialize(),uniform()],SSRPass.prototype,"boost",void 0),SSRPass_decorate([uiSlider("Object Radius",[.01,2]),serialize(),uniform()],SSRPass.prototype,"objectRadius",void 0),SSRPass_decorate([uiToggle("Auto radius"),serialize(),uniform()],SSRPass.prototype,"autoRadius",void 0),SSRPass_decorate([uiSlider("Power",[0,3]),serialize(),uniform()],SSRPass.prototype,"power",void 0),SSRPass_decorate([uiSlider("Tolerance",[.1,5]),serialize(),uniform()],SSRPass.prototype,"tolerance",void 0),SSRPass_decorate([uiSlider("Step count",[1,32],1),serialize(),matDefine("SSR_STEP_COUNT")],SSRPass.prototype,"stepCount",void 0),SSRPass_decorate([uiSlider("Low Quality Frames",[0,4],1),serialize(),matDefine("SSR_LOW_QUALITY_FRAMES")],SSRPass.prototype,"lowQualityFrames",void 0),SSRPass_decorate([uiToggle("Ignore front rays"),serialize(),matDefine("SSR_MASK_FRONT_RAYS")],SSRPass.prototype,"maskFrontRays",void 0),SSRPass_decorate([uiSlider("Mask front rays factor",[-1,1],.01,h=>({hidden:()=>!h.maskFrontRays})),serialize(),uniform()],SSRPass.prototype,"maskFrontFactor",void 0),SSRPass=SSRPass_decorate([uiFolder("Screen Space Reflections")],SSRPass);class SSRPlugin extends MultiFilterPlugin{get ssrTarget(){return this._ssrTarget}constructor(){super(),this.dependencies=[AssetManagerPlugin,GBufferPlugin,ProgressivePlugin],this.inlineSSR=!0,this.setDirty=this.setDirty.bind(this)}get enabled(){var o,c;return((c=(o=this.passes.ssr)===null||o===void 0?void 0:o.passObject)===null||c===void 0?void 0:c.enabled)||!1}set enabled(o){var c;!((c=this.passes.ssr)===null||c===void 0)&&c.passObject&&(this.passes.ssr.passObject.enabled=o)}async onAdded(o){var c,d;o.getPluginByType("Ground")&&console.error("GroundPlugin must be added after SSRPlugin"),await super.onAdded(o),(d=(c=this.uiConfig).uiRefresh)===null||d===void 0||d.call(c,"postFrame",!0)}createPasses(o){var c,d;return this._ssrTarget=this.inlineSSR?void 0:o.renderer.createTarget({sizeMultiplier:1}),[makeFilter(o,{passId:"ssr",after:["gbuffer"],before:["render"],required:["render","gbuffer","progressive"],passObject:new SSRPass(o.renderer,this._ssrTarget,(d=(c=o.getPlugin(GBufferPlugin))===null||c===void 0?void 0:c.getUnpackSnippet())!==null&&d!==void 0?d:"",this.inlineSSR)},()=>[o.getPlugin(GBufferPlugin),o.getPlugin(ProgressivePlugin),o.scene.activeCamera,o.renderer,o.scene])]}async onRemove(o){return this._ssrTarget&&o.renderer.disposeTarget(this._ssrTarget),super.onRemove(o)}setDirty(){var o;(o=this._viewer)===null||o===void 0||o.setDirty()}get uiConfig(){var o,c,d,_,b;const _e=(d=(c=(o=this.passes.ssr)===null||o===void 0?void 0:o.passObject)===null||c===void 0?void 0:c.uiConfig)!==null&&d!==void 0?d:{};return(b=(_=_e.children)===null||_===void 0?void 0:_.map(it=>Ee$1(it)))===null||b===void 0||b.flat(2).forEach(it=>it&&(it.onChange=this.setDirty)),_e}}SSRPlugin.PluginType="SSReflection";var anisotropyBsdf=`uniform float anisotropyFactor;uniform float anisotropyNoise;
#if ANISOTROPY_TEX_MODE == 0
uniform float anisotropyDirection;
#else
uniform sampler2D anisotropyDirectionMap;varying vec2 vAnisotropy2MapUv;
#endif
const float MIN_ROUGHNESS=0.05;vec3 indirectAnisotropyBentNormal(const in vec3 normal,const in vec3 viewDir,const in float roughness,const in vec3 anisotropicT,const in vec3 anisotropicB){vec3 aDirection=anisotropyFactor>=0.?anisotropicB:anisotropicT;vec3 aTangent=cross(aDirection,viewDir);vec3 aNormal=cross(aTangent,aDirection);float bendFactor=abs(anisotropyFactor)*saturate(5.*max(roughness,MIN_ROUGHNESS));return normalize(mix(normal,aNormal,bendFactor));}vec3 BRDF_GGX_Anisotropy(const in vec3 lightDir,const in vec3 viewDir,const in vec3 normal,const in vec3 f0,const in float f90,const in float roughness,const in vec3 anisotropicT,const in vec3 anisotropicB){float alpha=pow2(roughness);vec3 halfDir=normalize(lightDir+viewDir);float dotNL=saturate(dot(normal,lightDir));float dotNV=saturate(dot(normal,viewDir));float dotNH=saturate(dot(normal,halfDir));float dotVH=saturate(dot(viewDir,halfDir));float dotTV=dot(anisotropicT,viewDir);float dotBV=dot(anisotropicB,viewDir);float dotTL=dot(anisotropicT,lightDir);float dotBL=dot(anisotropicB,lightDir);float dotTH=dot(anisotropicT,halfDir);float dotBH=dot(anisotropicB,halfDir);float aspect=sqrt(1.-min(1.-MIN_ROUGHNESS,abs(anisotropyFactor)*0.9));if(anisotropyFactor>0.)aspect=1./aspect;float at=roughness*aspect;float ab=roughness/aspect;vec3 F=F_Schlick(f0,f90,dotVH);float V=V_GGX_SmithCorrelated_Anisotropic(at,ab,dotTV,dotBV,dotTL,dotBL,dotNV,dotNL);float D=D_GGX_Anisotropic(at,ab,dotTH,dotBH,dotNH);return F*(V*D);}`,anisotropyTBN=`float rnd=(random2(vUv.xy,frameCount)-0.5)*anisotropyNoise*material.roughness;
#if ANISOTROPY_TEX_MODE < 2
#if ANISOTROPY_TEX_MODE == 0 
float rot=saturate(anisotropyDirection);
#else 
float rot=(anisotropyDirectionMapTexelToLinear(texture2D(anisotropyDirectionMap,vAnisotropy2MapUv)).r);
#endif
rot=rot*2.*PI+rnd;vec2 rot2=vec2(sin(rot),cos(rot));
#else 
vec2 rot2=(anisotropyDirectionMapTexelToLinear(texture2D(anisotropyDirectionMap,vAnisotropy2MapUv)).rg*2.-1.)+vec2(rnd,rnd);rot2=normalize(rot2);const float anisoSpecMultiplier=0.25;float matSpecAniso=(length(material.specularColor.rgb))*2.*PI;rot2=mix(rot2,vec2(sin(matSpecAniso),cos(matSpecAniso)),anisoSpecMultiplier);rot2=normalize(rot2);
#endif
vec3 anisotropicT=(tbn[0]*rot2.x+tbn[1]*rot2.y);anisotropicT=normalize(anisotropicT-normal*dot(anisotropicT,normal));vec3 anisotropicB=normalize(cross(normal,anisotropicT));`,AnisotropyPlugin_decorate=function(h,o,c,d){var _,b=arguments.length,_e=b<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_e=Reflect.decorate(h,o,c,d);else for(var it=h.length-1;it>=0;it--)(_=h[it])&&(_e=(b<3?_(_e):b>3?_(o,c,_e):_(o,c))||_e);return b>3&&_e&&Object.defineProperty(o,c,_e),_e};let AnisotropyPlugin=class extends AViewerPlugin{makeAnisotropic(h){var o;const c=(o=h.materialObject)===null||o===void 0?void 0:o.userData;if(!c)return!1;if(c._isAnisotropic===void 0){const d=c.__appliedMeshes;let _=!0;if(d)for(const{geometry:b}of d)!b||b.index&&b.attributes.position&&b.attributes.normal&&b.attributes.uv||(_=!1),_&&!b.attributes.tangent&&b.computeTangents();if(!_)return!1}return c._isAnisotropic=!0,c._anisotropyFactor===void 0&&(c._anisotropyFactor=1),c._anisotropyNoise===void 0&&(c._anisotropyNoise=0),c._anisotropyDirectionMode===void 0&&(c._anisotropyDirectionMode="DIRECTION"),h.materialObject.needsUpdate=!0,!0}tryComputeTangents(h,o){if(h.geometry&&!h.geometry.attributes.tangent){let c=!0;h.geometry.index&&h.geometry.attributes.position&&h.geometry.attributes.normal&&h.geometry.attributes.uv||(c=!1),c?h.geometry.computeTangents():o.map(d=>{var _;!((_=d==null?void 0:d.userData)===null||_===void 0)&&_._isAnisotropic&&(d.userData._isAnisotropic=!1)})}}_loaderCreate({loader:h}){h.isGLTFLoader2&&h.register(o=>new GLTFMaterialsAnisotropyExtensionImport(o))}constructor(){super(),this.enabled=!0,this.dependencies=[AssetManagerPlugin],this._defines={ANISOTROPY_DEBUG:!1},this._uniforms={anisotropyFactor:{value:1},anisotropyNoise:{value:1},anisotropyDirection:{value:1},anisotropyDirectionMap:{value:null},anisotropy2MapUvTransform:{value:new three_module.dwI},frameCount:{value:0}},this.materialExtension={shaderExtender:(h,o,c)=>{var d;if(!this.enabled||!o.materialObject.userData._isAnisotropic)return;const _=(d=o.materialObject.userData)===null||d===void 0?void 0:d._anisotropyDirectionMap,b=fe$1`
                //#if ANISOTROPY_ENABLED
                ${randomHelpers}
            `+(_?getTexelDecoding("anisotropyDirectionMap",_.colorSpace):"")+`
`;h.fragmentShader=shaderReplaceString(h.fragmentShader,"#include <common>",b,{append:!0}),h.fragmentShader=h.fragmentShader.replace("#include <lights_fragment_begin>",three_module.vxI.lights_fragment_begin),h.fragmentShader=shaderReplaceString(shaderReplaceString(h.fragmentShader,"IncidentLight directLight;",anisotropyTBN,{prepend:!0}),"RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight )","RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight, anisotropicT, anisotropicB )",{replaceAll:!0});let _e=shaderReplaceString(three_module.vxI.lights_physical_pars_fragment,"void RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {","void RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight, const in vec3 anisotropicT, const in vec3 anisotropicB ) {");_e=shaderReplaceString(_e,"vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {",anisotropyBsdf+`
`,{prepend:!0}),_e=shaderReplaceString(_e,"BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material )","BRDF_GGX_Anisotropy( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularF90, material.roughness, anisotropicT, anisotropicB )"),h.fragmentShader=shaderReplaceString(h.fragmentShader,"#include <lights_physical_pars_fragment>",_e),h.fragmentShader=shaderReplaceString(h.fragmentShader,"#include <normal_fragment_begin>",three_module.vxI.normal_fragment_begin),h.fragmentShader=shaderReplaceString(h.fragmentShader,"#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )","#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) || defined( USE_TANGENT )");let it=fe$1`
                #if defined( USE_ENVMAP )
                vec3 anisotropyBentNormal = indirectAnisotropyBentNormal(geometryNormal, geometryViewDir, material.roughness, anisotropicT, anisotropicB);
                #endif
            `+three_module.vxI.lights_fragment_maps;it=shaderReplaceString(it,"getIBLIrradiance( geometryNormal )","getIBLIrradiance( anisotropyBentNormal )"),it=shaderReplaceString(it,"getIBLRadiance( geometryViewDir, geometryNormal, material.roughness )","getIBLRadiance( geometryViewDir, anisotropyBentNormal, material.roughness )"),h.fragmentShader=shaderReplaceString(h.fragmentShader,"#include <lights_fragment_maps>",it),h.vertexShader=shaderReplaceString(h.vertexShader,"#include <uv_pars_vertex>",`
#if defined(ANISOTROPY_ENABLED) && ANISOTROPY_ENABLED > 0
    varying vec2 vAnisotropy2MapUv;
    uniform mat3 anisotropy2MapUvTransform;
#endif
                `,{prepend:!0}),h.vertexShader=shaderReplaceString(h.vertexShader,"#include <uv_vertex>",`
#if defined(ANISOTROPY_ENABLED) && ANISOTROPY_ENABLED > 0
    vAnisotropy2MapUv = ( anisotropy2MapUvTransform * vec3( uv, 1 ) ).xy;
#endif
                `,{prepend:!0}),h.defines.USE_ANISOTROPY_BRDF="",h.defines.USE_UV="",h.vertexTangents=!0},onObjectRender:(h,o)=>{var c;const d=o.materialObject.userData;if(!(d!=null&&d._isAnisotropic))return;const _=h;if(!_.isMesh||!_.geometry)return;_.geometry.attributes.tangent?_.geometry.userData.__forceUseTangent=!0:console.error("WebGi AnisotropyPlugin - No tangents on the geometry, cannot use anisotropy. Make sure the tangents are computed before rendering the model. The model will render as black.",_),this._uniforms.anisotropyFactor.value=d._anisotropyFactor,this._uniforms.anisotropyNoise.value=d._anisotropyNoise,this._uniforms.anisotropyDirection.value=d._anisotropyDirection;const b=!((c=d._anisotropyDirectionMap)===null||c===void 0)&&c.isTexture?d._anisotropyDirectionMap:null;this._uniforms.anisotropyDirectionMap.value=b,b&&(b.updateMatrix(),this._uniforms.anisotropy2MapUvTransform.value.copy(b.matrix));let _e=this.enabled?1:0;o.materialObject.defines.ANISOTROPY_ENABLED!==_e&&(o.materialObject.defines.ANISOTROPY_ENABLED=_e,o.materialObject.needsUpdate=!0),_e=+this._defines.ANISOTROPY_DEBUG,o.materialObject.defines.ANISOTROPY_DEBUG!==_e&&(o.materialObject.defines.ANISOTROPY_DEBUG=_e,o.materialObject.needsUpdate=!0),_e=d._anisotropyDirectionMode,this._uniforms.anisotropyDirectionMap.value||(_e="CONSTANT"),_e=_e==="DIRECTION"?2:_e==="ROTATION"?1:0,o.materialObject.defines.ANISOTROPY_TEX_MODE!==_e&&(o.materialObject.defines.ANISOTROPY_TEX_MODE=_e,o.materialObject.needsUpdate=!0)},extraUniforms:{...this._uniforms},computeCacheKey:h=>{var o,c,d;return(this.enabled?"1":"0")+(!((o=h.materialObject.userData)===null||o===void 0)&&o._isAnisotropic?"1":"0")+((d=(c=h.materialObject.userData)===null||c===void 0?void 0:c._anisotropyDirectionMap)===null||d===void 0?void 0:d.uuid)},isCompatible:h=>h.isMeshStandardMaterial2,updaters:()=>{var h;return[(h=this._viewer)===null||h===void 0?void 0:h.renderer]},getUiConfig:h=>{const o=this._viewer,c=this.makeAnisotropic,d={type:"folder",label:"Anisotropy",children:[{type:"checkbox",label:"Enabled",get value(){return h.materialObject.userData._isAnisotropic||!1},set value(_){var b;_!==h.materialObject.userData._isAnisotropic&&(_?c(h)||o.alert("One or more geometries cannot be made anisotropic."):(h.materialObject.userData._isAnisotropic=!1,h.materialObject.needsUpdate=!0),(b=d.uiRefresh)===null||b===void 0||b.call(d,"postFrame",!0))},onChange:this.setDirty},{type:"slider",label:"Factor",bounds:[-2,2],hidden:()=>!h.materialObject.userData._isAnisotropic,property:[h.materialObject.userData,"_anisotropyFactor"],onChange:this.setDirty},{type:"slider",label:"Noise",bounds:[0,2],hidden:()=>!h.materialObject.userData._isAnisotropic,property:[h.materialObject.userData,"_anisotropyNoise"],onChange:this.setDirty},{type:"image",label:"Texture",hidden:()=>!h.materialObject.userData._isAnisotropic,property:[h.materialObject.userData,"_anisotropyDirectionMap"],onChange:()=>{h.materialObject.needsUpdate=!0,this.setDirty()}},makeSamplerUi(h.materialObject.userData,"_anisotropyDirectionMap","Sampler",()=>!h.materialObject.userData._isAnisotropic||h.materialObject.userData._anisotropyDirectionMode==="CONSTANT",()=>h.setDirty&&h.setDirty()),{type:"dropdown",label:"Mode",hidden:()=>!h.materialObject.userData._isAnisotropic,property:[h.materialObject.userData,"_anisotropyDirectionMode"],children:["CONSTANT","ROTATION","DIRECTION"].map(_=>({label:_})),onChange:()=>{h.materialObject.needsUpdate=!0,this.setDirty()}}]};return d},onMaterialUpdate:h=>{var o,c;!((o=h.userData)===null||o===void 0)&&o._isAnisotropic&&((c=h.userData.__appliedMeshes)===null||c===void 0||c.forEach(d=>this.tryComputeTangents(d,[h])))},onRegister:h=>{var o,c;!((o=h.userData)===null||o===void 0)&&o._isAnisotropic&&((c=h.userData.__appliedMeshes)===null||c===void 0||c.forEach(d=>this.tryComputeTangents(d,[h])))},onAddToMesh:h=>{const o=h,c=Array.isArray(o.material)?o.material:[o.material];c.find(d=>{var _;return(_=d==null?void 0:d.userData)===null||_===void 0?void 0:_._isAnisotropic})&&this.tryComputeTangents(o,c)}},this.setDirty=()=>{var h,o,c;(o=(h=this.materialExtension).setDirty)===null||o===void 0||o.call(h),(c=this._viewer)===null||c===void 0||c.setDirty()},this.makeSelectedAnisotropic=()=>{var h,o,c;const d=(c=(o=(h=this._viewer)===null||h===void 0?void 0:h.getPlugin(PickingPlugin))===null||o===void 0?void 0:o.getSelectedObject())===null||c===void 0?void 0:c.material;return(d==null?void 0:d.assetType)==="material"&&this.makeAnisotropic(d)},this._loaderCreate=this._loaderCreate.bind(this)}async onAdded(h){var o,c,d,_,b;await super.onAdded(h);const _e=h.getPlugin(AssetManagerPlugin);(o=_e==null?void 0:_e.materials)===null||o===void 0||o.registerMaterialExtension(this.materialExtension),(c=_e==null?void 0:_e.importer)===null||c===void 0||c.addEventListener("loaderCreate",this._loaderCreate),(b=(_=(d=_e==null?void 0:_e.exporter)===null||d===void 0?void 0:d.getExporter("gltf","glb"))===null||_===void 0?void 0:_.extensions)===null||b===void 0||b.push(glTFMaterialsAnisotropyExtensionExport)}async onRemove(h){var o,c,d,_;return(c=(o=h.getPlugin(AssetManagerPlugin))===null||o===void 0?void 0:o.materials)===null||c===void 0||c.unregisterMaterialExtension(this.materialExtension),(_=(d=h.getPlugin(AssetManagerPlugin))===null||d===void 0?void 0:d.importer)===null||_===void 0||_.removeEventListener("loaderCreate",this._loaderCreate),super.onRemove(h)}};AnisotropyPlugin.PluginType="AnisotropyPlugin",AnisotropyPlugin.ANISOTROPY_GLTF_EXTENSION="WEBGI_materials_anisotropy",AnisotropyPlugin_decorate([uiToggle("Enabled",h=>({onChange:h.setDirty})),serialize()],AnisotropyPlugin.prototype,"enabled",void 0),AnisotropyPlugin_decorate([uiButton("Make Anisotropy",h=>({hidden:()=>{var o;return!(!((o=h._viewer)===null||o===void 0)&&o.getPlugin(PickingPlugin))}}))],AnisotropyPlugin.prototype,"makeSelectedAnisotropic",void 0),AnisotropyPlugin=AnisotropyPlugin_decorate([uiFolder("Anisotropy Materials")],AnisotropyPlugin);class GLTFMaterialsAnisotropyExtensionImport{constructor(o){this.parser=o,this.name=AnisotropyPlugin.ANISOTROPY_GLTF_EXTENSION}async extendMaterialParams(o,c){var d,_,b;const _e=this.parser,it=_e.json.materials[o];if(!it.extensions||!it.extensions[this.name])return Promise.resolve();const nt=[],at=it.extensions[this.name];c.userData||(c.userData={}),c.userData._isAnisotropic=!0,c.userData._anisotropyFactor=(d=at.anisotropyFactor)!==null&&d!==void 0?d:0,c.userData._anisotropyNoise=(b=(_=at.anisotropyNoiseFactor)!==null&&_!==void 0?_:at.anisotropyNoise)!==null&&b!==void 0?b:0;let{anisotropyDirectionMode:ut,anisotropyDirection:pt}=at;return ut||(ut=at.anisotropyTextureMode),pt||(pt=at.anisotropyRotation),c.userData._anisotropyDirectionMode=ut&&typeof(pt==null?void 0:pt.index)=="number"?ut:"CONSTANT",ut==="ROTATION"||ut==="DIRECTION"?nt.push(_e.assignTexture(c.userData,"_anisotropyDirectionMap",pt).then(mt=>{mt.colorSpace=three_module.er$})):c.userData._anisotropyDirection=pt??0,Promise.all(nt)}afterRoot(o){var c;return(c=o.scene)===null||c===void 0||c.traverse(d=>{var _,b;if(!(!((b=(_=d.material)===null||_===void 0?void 0:_.userData)===null||b===void 0)&&b._isAnisotropic))return;const _e=d.geometry;_e.attributes.tangent||(_e.computeTangents(),_e.attributes.tangent.needsUpdate=!0)}),null}}const glTFMaterialsAnisotropyExtensionExport=h=>({writeMaterial:(o,c)=>{if(!o.isMeshStandardMaterial||!o.userData._isAnisotropic||(o.userData._anisotropyFactor||0)<.001)return;c.extensions=c.extensions||{};const d={};if(d.anisotropyFactor=o.userData._anisotropyFactor||1,d.anisotropyNoiseFactor=o.userData._anisotropyNoise||0,d.anisotropyDirectionMode=o.userData._anisotropyDirectionMode||"CONSTANT",h.checkEmptyMap(o.userData._anisotropyDirectionMap)&&d.anisotropyDirectionMode!=="CONSTANT"){const _={index:h.processTexture(o.userData._anisotropyDirectionMap)};h.applyTextureTransform(_,o.userData._anisotropyDirectionMap),d.anisotropyDirection=_}else d.anisotropyDirectionMode="CONSTANT",d.anisotropyDirection=o.userData._anisotropyDirection||0;c.extensions[AnisotropyPlugin.ANISOTROPY_GLTF_EXTENSION]=d,h.extensionsUsed[AnisotropyPlugin.ANISOTROPY_GLTF_EXTENSION]=!0}});var FragmentClippingExtensionPlugin_decorate=function(h,o,c,d){var _,b=arguments.length,_e=b<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_e=Reflect.decorate(h,o,c,d);else for(var it=h.length-1;it>=0;it--)(_=h[it])&&(_e=(b<3?_(_e):b>3?_(o,c,_e):_(o,c))||_e);return b>3&&_e&&Object.defineProperty(o,c,_e),_e},FragmentClippingExtensionPlugin_1;let FragmentClippingExtensionPlugin=FragmentClippingExtensionPlugin_1=class extends AViewerPlugin{static AddFragmentClipping(h,o,c,d,_){var b,_e,it;const nt=(b=h.materialObject)===null||b===void 0?void 0:b.userData;if(!nt)return!1;nt._fragmentClippingExt||(nt._fragmentClippingExt={});const at=nt._fragmentClippingExt;return at.clipEnabled=!0,at.clipPosition===void 0&&(at.clipPosition=(_e=o==null?void 0:o.toArray())!==null&&_e!==void 0?_e:[0,0,0,0]),at.clipParams===void 0&&(at.clipParams=(it=c==null?void 0:c.toArray())!==null&&it!==void 0?it:[1,0,0,0]),at.clipMode===void 0&&(at.clipMode=d??FragmentClippingMode.Circle),at.clipInvert===void 0&&(at.clipInvert=_!=null&&_),h.materialObject.isMaterial&&(h.needsUpdate=!0),!0}_loaderCreate({loader:h}){h.isGLTFLoader2&&h.register(o=>new GLTFMaterialsFragmentClippingExtensionImport(o))}constructor(){super(),this.enabled=!0,this.dependencies=[AssetManagerPlugin,GBufferPlugin],this._plane=new three_module.Zcv,this._viewNormalMatrix=new three_module.dwI,this._defines={FRAG_CLIPPING_DEBUG:!1},this._uniforms={fragClippingPosition:{value:new three_module.IUQ},fragClippingParams:{value:new three_module.IUQ},fragClippingCamAspect:{value:1}},this.materialExtension={parsFragmentSnippet:(h,o)=>{var c;return this.enabled&&!((c=o==null?void 0:o.materialObject.userData._fragmentClippingExt)===null||c===void 0)&&c.clipEnabled?simpleCameraHelpers+fe$1`
uniform vec4 fragClippingPosition;
uniform vec4 fragClippingParams;
uniform float fragClippingCamAspect;
#if FRAG_CLIPPING_MODE == ${FragmentClippingMode.Circle}
float fragClippingCircle(){
    vec2 pos = viewToScreen(vViewPosition.xyz).xy;
    float radius = fragClippingParams.x;
    vec2 center = fragClippingPosition.xy;
    pos.y /= fragClippingCamAspect;
    center.y /= fragClippingCamAspect;
    return length(pos - center) - radius;
}
#elif FRAG_CLIPPING_MODE == ${FragmentClippingMode.Ellipse}
float fragClippingEllipse(){
    vec2 pos = viewToScreen(vViewPosition.xyz).xy;
    vec2 radius = fragClippingParams.xy;
    vec2 center = fragClippingPosition.xy;
    pos.y /= fragClippingCamAspect;
    center.y /= fragClippingCamAspect;
    return length((pos - center) / radius) - 1.0;
}
#elif FRAG_CLIPPING_MODE == ${FragmentClippingMode.Rectangle}
float fragClippingRectangle(){
    vec2 pos = viewToScreen(vViewPosition.xyz).xy;
    vec2 radius = fragClippingParams.xy;
    vec2 center = fragClippingPosition.xy;
    pos.y /= fragClippingCamAspect;
    center.y /= fragClippingCamAspect;
    vec2 d = abs(pos - center) - radius;
    return min(max(d.x,d.y),0.0) + length(max(d,0.0));
}
#elif FRAG_CLIPPING_MODE == ${FragmentClippingMode.Plane}
float fragClippingPlane(){
    vec3 pos = vViewPosition.xyz;
    vec3 normal = fragClippingParams.xyz;
    float d = dot(pos, normal) - fragClippingParams.w;
    return d;
}
#elif FRAG_CLIPPING_MODE == ${FragmentClippingMode.Sphere}
float fragClippingSphere(){
    vec3 pos = vViewPosition.xyz;
    vec3 center = fragClippingPosition.xyz;
    float radius = fragClippingParams.x;
    pos.y /= fragClippingCamAspect;
    center.y /= fragClippingCamAspect;
    return length(pos - center) - radius;
}
#endif
        `:""},shaderExtender:(h,o,c)=>{var d;this.enabled&&!((d=o.materialObject.userData._fragmentClippingExt)===null||d===void 0)&&d.clipEnabled&&(h.fragmentShader=shaderReplaceString(h.fragmentShader,"#glMarker mainStart",fe$1`
    float fragClippingDist = 0.0;
    #if FRAG_CLIPPING_MODE == ${FragmentClippingMode.Circle}
    fragClippingDist = fragClippingCircle();
    #elif FRAG_CLIPPING_MODE == ${FragmentClippingMode.Ellipse}
    fragClippingDist = fragClippingEllipse();
    #elif FRAG_CLIPPING_MODE == ${FragmentClippingMode.Rectangle}
    fragClippingDist = fragClippingRectangle();
    #elif FRAG_CLIPPING_MODE == ${FragmentClippingMode.Plane}
    fragClippingDist = fragClippingPlane();
    #elif FRAG_CLIPPING_MODE == ${FragmentClippingMode.Sphere}
    fragClippingDist = fragClippingSphere();
    #endif
    #if FRAG_CLIPPING_DEBUG
    gl_FragColor = vec4(max(fragClippingDist, 0.0), 0.0, 0.0, 1.0); 
//    gl_FragColor = vec4(vViewPosition.xyz, 1.0);
    #include <colorspace_fragment>
    return;
    #endif
    
    #if FRAG_CLIPPING_INVERSE == 1
    if (fragClippingDist > 0.0) discard;
    #else
    if (fragClippingDist < 0.0) discard;
    #endif
            `,{append:!0}))},onObjectRender:(h,o)=>{var c,d,_,b,_e,it;let nt=(c=o.materialObject.userData)===null||c===void 0?void 0:c._fragmentClippingExt;if(o.materialObject.userData.isGBufferMaterial&&h&&(nt=(_=(d=h.material)===null||d===void 0?void 0:d.userData)===null||_===void 0?void 0:_._fragmentClippingExt),!(nt!=null&&nt.clipEnabled))return;if(this._uniforms.fragClippingPosition.value.fromArray(nt.clipPosition),nt.clipMode===FragmentClippingMode.Plane){const ut=(b=this._viewer)===null||b===void 0?void 0:b.scene.activeCamera.cameraObject.matrixWorldInverse;this._plane.normal.set(nt.clipParams[0],nt.clipParams[1],nt.clipParams[2]),this._plane.constant=nt.clipParams[3],this._viewNormalMatrix.getNormalMatrix(ut),this._plane.applyMatrix4(ut,this._viewNormalMatrix),this._uniforms.fragClippingParams.value.set(this._plane.normal.x,this._plane.normal.y,this._plane.normal.z,this._plane.constant)}else this._uniforms.fragClippingParams.value.fromArray(nt.clipParams);((_e=this._viewer)===null||_e===void 0?void 0:_e.scene.activeCamera.cameraObject)instanceof three_module.ubm?this._uniforms.fragClippingCamAspect.value=(it=this._viewer)===null||it===void 0?void 0:it.scene.activeCamera.cameraObject.aspect:this._uniforms.fragClippingCamAspect.value=1;let at=this.enabled?1:0;at=+this._defines.FRAG_CLIPPING_DEBUG,o.materialObject.defines.FRAG_CLIPPING_DEBUG!==at&&(o.materialObject.defines.FRAG_CLIPPING_DEBUG=at,o.materialObject.needsUpdate=!0),at=+nt.clipMode,o.materialObject.defines.FRAG_CLIPPING_MODE!==at&&(o.materialObject.defines.FRAG_CLIPPING_MODE=at,o.materialObject.needsUpdate=!0),at=+nt.clipInvert,o.materialObject.defines.FRAG_CLIPPING_INVERSE!==at&&(o.materialObject.defines.FRAG_CLIPPING_INVERSE=at,o.materialObject.needsUpdate=!0)},extraUniforms:{...this._uniforms},computeCacheKey:h=>{var o,c;return(this.enabled?"1":"0")+(!((c=(o=h.materialObject.userData)===null||o===void 0?void 0:o._fragmentClippingExt)===null||c===void 0)&&c.clipEnabled?"1":"0")},isCompatible:h=>h.isMeshStandardMaterial2||h.userData.isGBufferMaterial,updaters:()=>[],getUiConfig:h=>{const o=this._viewer,c={type:"folder",label:"FragmentClipping",children:[{type:"checkbox",label:"Enabled",getValue:()=>{var d;return((d=h.materialObject.userData._fragmentClippingExt)===null||d===void 0?void 0:d.clipEnabled)||!1},setValue:d=>{var _,b;d!==((_=h.materialObject.userData._fragmentClippingExt)===null||_===void 0?void 0:_.clipEnabled)&&(d?FragmentClippingExtensionPlugin_1.AddFragmentClipping(h.materialObject)||o.alert("Cannot add fragment clipping extension."):h.materialObject.userData._fragmentClippingExt&&(h.materialObject.userData._fragmentClippingExt.clipEnabled=!1,h.materialObject.needsUpdate=!0),(b=c.uiRefresh)===null||b===void 0||b.call(c,"postFrame",!0))},onChange:this.setDirty},()=>({type:"dropdown",label:"Mode",children:Object.entries(FragmentClippingMode).map(d=>({label:d[0],value:d[1]})),hidden:()=>{var d;return!(!((d=h.materialObject.userData._fragmentClippingExt)===null||d===void 0)&&d.clipEnabled)},property:[h.materialObject.userData._fragmentClippingExt,"clipMode"],onChange:this.setDirty}),()=>({type:"vec4",label:"Position",hidden:()=>{var d;return!(!((d=h.materialObject.userData._fragmentClippingExt)===null||d===void 0)&&d.clipEnabled)},property:[h.materialObject.userData._fragmentClippingExt,"clipPosition"],onChange:this.setDirty}),()=>({type:"vec4",label:"Params",hidden:()=>{var d;return!(!((d=h.materialObject.userData._fragmentClippingExt)===null||d===void 0)&&d.clipEnabled)},property:[h.materialObject.userData._fragmentClippingExt,"clipParams"],onChange:this.setDirty}),()=>({type:"toggle",label:"Invert",hidden:()=>{var d;return!(!((d=h.materialObject.userData._fragmentClippingExt)===null||d===void 0)&&d.clipEnabled)},property:[h.materialObject.userData._fragmentClippingExt,"clipInvert"],onChange:this.setDirty})]};return c}},this.setDirty=()=>{var h,o,c;(o=(h=this.materialExtension).setDirty)===null||o===void 0||o.call(h),(c=this._viewer)===null||c===void 0||c.setDirty()},this._loaderCreate=this._loaderCreate.bind(this)}async onAdded(h){var o,c,d,_,b,_e,it;await super.onAdded(h);const nt=h.getPlugin(AssetManagerPlugin);(o=nt==null?void 0:nt.materials)===null||o===void 0||o.registerMaterialExtension(this.materialExtension),(c=nt==null?void 0:nt.importer)===null||c===void 0||c.addEventListener("loaderCreate",this._loaderCreate),(b=(_=(d=nt==null?void 0:nt.exporter)===null||d===void 0?void 0:d.getExporter("gltf","glb"))===null||_===void 0?void 0:_.extensions)===null||b===void 0||b.push(glTFMaterialsFragmentClippingExtensionExport),(it=(_e=h.getPlugin(GBufferPlugin))===null||_e===void 0?void 0:_e.material)===null||it===void 0||it.registerMaterialExtensions([this.materialExtension])}async onRemove(h){var o,c,d,_;return(c=(o=h.getPlugin(AssetManagerPlugin))===null||o===void 0?void 0:o.materials)===null||c===void 0||c.unregisterMaterialExtension(this.materialExtension),(_=(d=h.getPlugin(AssetManagerPlugin))===null||d===void 0?void 0:d.importer)===null||_===void 0||_.removeEventListener("loaderCreate",this._loaderCreate),super.onRemove(h)}};var FragmentClippingMode;FragmentClippingExtensionPlugin.PluginType="FragmentClippingExtensionPlugin1",FragmentClippingExtensionPlugin.FRAGMENT_CLIPPING_EXTENSION_GLTF_EXTENSION="WEBGI_materials_fragment_clipping_extension",FragmentClippingExtensionPlugin_decorate([uiToggle("Enabled",h=>({onChange:h.setDirty})),serialize()],FragmentClippingExtensionPlugin.prototype,"enabled",void 0),FragmentClippingExtensionPlugin=FragmentClippingExtensionPlugin_1=FragmentClippingExtensionPlugin_decorate([uiFolder("FragmentClipping Materials")],FragmentClippingExtensionPlugin),function(h){h[h.Circle=0]="Circle",h[h.Ellipse=1]="Ellipse",h[h.Rectangle=2]="Rectangle",h[h.Plane=3]="Plane",h[h.Sphere=4]="Sphere"}(FragmentClippingMode||(FragmentClippingMode={}));class GLTFMaterialsFragmentClippingExtensionImport{constructor(o){this.parser=o,this.name=FragmentClippingExtensionPlugin.FRAGMENT_CLIPPING_EXTENSION_GLTF_EXTENSION}async extendMaterialParams(o,c){const d=this.parser.json.materials[o];if(!d.extensions||!d.extensions[this.name])return Promise.resolve();const _=d.extensions[this.name];return c.userData||(c.userData={}),FragmentClippingExtensionPlugin.AddFragmentClipping(c),c.userData._fragmentClippingExt=deserializeObject(_,c.userData._fragmentClippingExt,!1,{}),Promise.resolve()}}const glTFMaterialsFragmentClippingExtensionExport=h=>({writeMaterial:(o,c)=>{if(!o.isMeshStandardMaterial||!o.userData._fragmentClippingExt||!o.userData._fragmentClippingExt.clipEnabled)return;c.extensions=c.extensions||{};const d=serializeObject(o.userData._fragmentClippingExt,!1);c.extensions[FragmentClippingExtensionPlugin.FRAGMENT_CLIPPING_EXTENSION_GLTF_EXTENSION]=d,h.extensionsUsed[FragmentClippingExtensionPlugin.FRAGMENT_CLIPPING_EXTENSION_GLTF_EXTENSION]=!0}});var hdriGroundProj=`#ifdef HDRi_GROUND_PROJ
float intersectPlane1(const in vec3 r0,const in vec3 rd,const in vec3 n,const in vec3 p0){float t=dot(p0-r0,n)/(dot(n,rd)+1e-6);return t<0.?1000.:t;}float intersectSphere1(in vec3 ro,in vec3 rd,in vec3 sph,in float rad){vec3 oc=ro-sph;float b=dot(oc,rd);float c=dot(oc,oc)-rad*rad;float t=b*b-c;return t<0.?t:-b+sqrt(t);}
#define PI_HALF  1.5707963267948966
uniform float worldRadius;uniform float tripodHeight;uniform vec3 originPosition;vec3 hdriProject(){vec3 p=normalize(vWorldDirection);vec3 camPos=cameraPosition;camPos.y-=tripodHeight;float t=intersectSphere1(camPos,p,originPosition,worldRadius);if(t>0.){float t2=intersectPlane1(camPos,p,vec3(0,-1,0),originPosition+vec3(0.,-tripodHeight,0.));p=(camPos+min(t,t2)*p)/worldRadius;}else p=vec3(0.,1.,0.);return p;}
#endif
`,HDRiGroundPlugin_decorate=function(h,o,c,d){var _,b=arguments.length,_e=b<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_e=Reflect.decorate(h,o,c,d);else for(var it=h.length-1;it>=0;it--)(_=h[it])&&(_e=(b<3?_(_e):b>3?_(o,c,_e):_(o,c))||_e);return b>3&&_e&&Object.defineProperty(o,c,_e),_e};let HDRiGroundPlugin=class extends AViewerPlugin{constructor(h=!1){super(),this.enabled=!1,this.worldRadius=100,this.tripodHeight=10,this.originPosition=new three_module.Pq0(0,0,0),this._paramsChanged=this._paramsChanged.bind(this),this.enabled=h,this.addEventListener("deserialize",this._paramsChanged)}_paramsChanged(){var h,o,c,d;if(!this._viewer)return;const _=this._viewer.scene.background;if(this.enabled&&_!==this._viewer.scene.environment&&_!=="environment")if(_&&_.isDataTexture)_.mapping=three_module.wfO;else if(confirm("Background must be same as environment, do you want to change it?")){const it=this._viewer.getPluginByType("SimpleBackgroundEnvUiPlugin1");it?(it.envmapBg=!0,(o=(h=it.uiConfig).uiRefresh)===null||o===void 0||o.call(h,"postFrame",!0)):this._viewer.scene.setBackground("environment")}else this.enabled=!1;const b=(c=this._viewer.renderer.rendererObject.background.getBoxMesh2())===null||c===void 0?void 0:c.material,_e=(d=b==null?void 0:b.uniforms)!==null&&d!==void 0?d:three_module.zkh.backgroundCube.uniforms;_e.tripodHeight||(_e.tripodHeight={value:1}),_e.worldRadius||(_e.worldRadius={value:1}),_e.originPosition||(_e.originPosition={value:new three_module.Pq0}),_e.tripodHeight.value=this.tripodHeight,_e.worldRadius.value=this.worldRadius,_e.originPosition.value.copy(this.originPosition),b&&(!this.enabled&&b.defines.HDRi_GROUND_PROJ?delete b.defines.HDRi_GROUND_PROJ:this.enabled&&(b.defines.HDRi_GROUND_PROJ="1"),b.needsUpdate=!0),this._viewer.setDirty()}async onAdded(h){var o,c,d;await super.onAdded(h),!((d=(c=(o=this._viewer)===null||o===void 0?void 0:o.renderer)===null||c===void 0?void 0:c.rendererObject)===null||d===void 0)&&d.background.getBoxMesh()&&h.console.error("HDRi Ground Plugin must be added before setting any cube or env map"),three_module.zkh.backgroundCube.fragmentShader.includes("#ifdef HDRi_GROUND_PROJ")||(three_module.zkh.backgroundCube.fragmentShader=shaderReplaceString(three_module.zkh.backgroundCube.fragmentShader,"void main() {",hdriGroundProj,{prepend:!0}),three_module.zkh.backgroundCube.fragmentShader=shaderReplaceString(three_module.zkh.backgroundCube.fragmentShader,"vec3 vReflect = vWorldDirection;",`
vec3 vReflect = 
#ifdef HDRi_GROUND_PROJ
hdriProject()
#else
vWorldDirection
#endif
;
`)),h.scene.addEventListener("environmentChanged",this._paramsChanged)}};HDRiGroundPlugin.PluginType="HDRiGroundPlugin",HDRiGroundPlugin_decorate([serialize(),x$1(HDRiGroundPlugin.prototype._paramsChanged),uiToggle("Enabled")],HDRiGroundPlugin.prototype,"enabled",void 0),HDRiGroundPlugin_decorate([serialize(),x$1(HDRiGroundPlugin.prototype._paramsChanged),uiSlider("World Radius",[1,1e3],.01)],HDRiGroundPlugin.prototype,"worldRadius",void 0),HDRiGroundPlugin_decorate([serialize(),x$1(HDRiGroundPlugin.prototype._paramsChanged),uiSlider("Tripod height",[0,50],.01)],HDRiGroundPlugin.prototype,"tripodHeight",void 0),HDRiGroundPlugin_decorate([serialize(),x$1(HDRiGroundPlugin.prototype._paramsChanged),uiVector("Origin Position",void 0,.001,h=>({onChange:h._paramsChanged}))],HDRiGroundPlugin.prototype,"originPosition",void 0),HDRiGroundPlugin=HDRiGroundPlugin_decorate([uiFolder("HDRi Ground")],HDRiGroundPlugin);var SSContactShadows_decorate=function(h,o,c,d){var _,b=arguments.length,_e=b<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_e=Reflect.decorate(h,o,c,d);else for(var it=h.length-1;it>=0;it--)(_=h[it])&&(_e=(b<3?_(_e):b>3?_(o,c,_e):_(o,c))||_e);return b>3&&_e&&Object.defineProperty(o,c,_e),_e},SSContactShadows_1;let SSContactShadows=SSContactShadows_1=class extends AViewerPlugin{constructor(h=!0){super(),this.enabled=!0,this.radius=.015,this.intensity=1,this.tolerance=1.5,this._defines={},this.onlySSCSDebug=!1,this.stepCount=2,this.dependencies=[GBufferPlugin,AssetManagerPlugin],this.materialExtension={shaderExtender:(o,c,d)=>{if(!o.defines.SSCS_ENABLED)return;const _=fe$1`
                #ifndef D_sceneBoundingRadius
                #define D_sceneBoundingRadius
                uniform float sceneBoundingRadius;
                #endif
                float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, vec3 lightDirection ) {
                    vec3 ray_origin_view = -vViewPosition;
                    float rnd = interleavedGradientNoise(gl_FragCoord.xy, frameCount+34.);
                    float cameraDist = length(cameraPositionWorld);
//                    float radius = mix((cameraNearFar.y) + ray_origin_view.z, -ray_origin_view.z - cameraNearFar.x, rnd * 0.5 + 0.5)*sscsRadius;
                    float radius = mix((cameraDist + sceneBoundingRadius) + ray_origin_view.z, -ray_origin_view.z - max(0.0, cameraDist - sceneBoundingRadius), rnd * 0.5 + 0.5)*sscsRadius;
                    vec3 state = vec3(1.,(rnd+0.5)/float(SSCS_STEP_COUNT),2.);
                    traceRay(ray_origin_view, normalize(lightDirection) * radius, sscsTolerance * radius * 2., state, SSCS_STEP_COUNT);
                    state.z = state.z > 0.99 ? 1. : max(0.,min(state.z * state.z * (1.-sscsIntensity), 1.));
                    
                #if defined(SSCS_DEBUG) && SSCS_DEBUG > 0
                    return state.z;
                #endif
            `,b=`
#if SSCS_ENABLED

    uniform float sscsIntensity;
    uniform float sscsRadius;
    uniform float sscsTolerance;

    ${basicHelpers}
    
    #define THREE_PACKING_INCLUDED
    ${cameraHelpers}
    
    ${unpackGbuffer}
    ${randomHelpers}
    
    ${ssrt}

#endif
            
            `+three_module.vxI.shadowmap_pars_fragment.replace("float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {",`${_}
`).replace("return shadow;","return min(shadow, state.z);");o.fragmentShader=o.fragmentShader.replace("#include <shadowmap_pars_fragment>",b),o.fragmentShader=o.fragmentShader.replace("#include <lights_fragment_begin>",three_module.vxI.lights_fragment_begin),o.fragmentShader=shaderReplaceString(o.fragmentShader,"directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;","directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ], directLight.direction ) : 1.0;"),o.fragmentShader=shaderReplaceString(o.fragmentShader,"directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;","directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ], directLight.direction ) : 1.0;")},onObjectRender:(o,c,d)=>{var _,b;const _e=c.materialObject;let it=!this.enabled||d.userData.screenSpaceRendering===!1||!((_=_e.userData)===null||_===void 0)&&_.sscsDisabled||!((b=_e.userData)===null||b===void 0)&&b.pluginsDisabled?0:1;_e.defines.SSCS_ENABLED!==it&&(_e.defines.SSCS_ENABLED=it,_e.needsUpdate=!0),it=this._defines.SSCS_STEP_COUNT,_e.defines.SSCS_STEP_COUNT!==it&&(_e.defines.SSCS_STEP_COUNT=it,_e.needsUpdate=!0),it=+this._defines.SSCS_DEBUG,_e.defines.SSCS_DEBUG!==it&&(_e.defines.SSCS_DEBUG=it,_e.needsUpdate=!0)},parsFragmentSnippet:()=>`
`,extraUniforms:{...SSContactShadows_1._uniforms},computeCacheKey:o=>this.enabled?"1":"0",isCompatible:o=>o.isMeshStandardMaterial2,updaters:()=>{var o,c,d,_,b;return[(o=this._viewer)===null||o===void 0?void 0:o.getPlugin(GBufferPlugin),(c=this._viewer)===null||c===void 0?void 0:c.getPlugin(ProgressivePlugin),(d=this._viewer)===null||d===void 0?void 0:d.scene.renderCamera,(_=this._viewer)===null||_===void 0?void 0:_.renderer,(b=this._viewer)===null||b===void 0?void 0:b.scene]}},this.enabled=h,this.userData={setDirty:()=>{var o;(o=this._viewer)===null||o===void 0||o.setDirty()}}}async onAdded(h){var o,c;await super.onAdded(h),(c=(o=h.getPlugin(AssetManagerPlugin))===null||o===void 0?void 0:o.materials)===null||c===void 0||c.registerMaterialExtension(this.materialExtension)}async onRemove(h){var o,c;return(c=(o=h.getPlugin(AssetManagerPlugin))===null||o===void 0?void 0:o.materials)===null||c===void 0||c.unregisterMaterialExtension(this.materialExtension),super.onRemove(h)}};SSContactShadows.PluginType="SSContactShadows",SSContactShadows._uniforms={tNormalDepth:{value:null},frameCount:{value:0},projection:{value:new three_module.kn4},cameraPositionWorld:{value:new three_module.Pq0},cameraNearFar:{value:new three_module.I9Y(.1,1e3)},sceneBoundingRadius:{value:0}},SSContactShadows_decorate([uiToggle("Enabled"),serialize()],SSContactShadows.prototype,"enabled",void 0),SSContactShadows_decorate([uniform({uniforms:SSContactShadows._uniforms,propKey:"sscsRadius"}),uiSlider("Radius",[1e-4,.1],1e-4),serialize()],SSContactShadows.prototype,"radius",void 0),SSContactShadows_decorate([uniform({uniforms:SSContactShadows._uniforms,propKey:"sscsIntensity"}),uiSlider("Intensity",[1e-4,1],1e-4),serialize()],SSContactShadows.prototype,"intensity",void 0),SSContactShadows_decorate([uniform({uniforms:SSContactShadows._uniforms,propKey:"sscsTolerance"}),uiSlider("Tolerance",[.1,5]),serialize()],SSContactShadows.prototype,"tolerance",void 0),SSContactShadows_decorate([matDefine("SSCS_DEBUG",void 0,!0),uiToggle("Debug only SSCS"),serialize()],SSContactShadows.prototype,"onlySSCSDebug",void 0),SSContactShadows_decorate([matDefine("SSCS_STEP_COUNT",void 0,!0),uiSlider("Step count",[1,8],1),serialize()],SSContactShadows.prototype,"stepCount",void 0),SSContactShadows=SSContactShadows_1=SSContactShadows_decorate([uiFolder("Screen Space Contact Shadows")],SSContactShadows);var cubeNormalVert=`varying vec3 vNormal;varying vec3 vecPosition;uniform mat4 offsetMatrixInv;uniform vec3 offsetCenter;
#include <morphtarget_pars_vertex>
void main(){vNormal=normalize((offsetMatrixInv*vec4(normal,0.)).xyz);
#include <begin_vertex>
transformed-=offsetCenter;
#include <morphtarget_vertex>
vec4 offsetPos=offsetMatrixInv*vec4(transformed,1.);vecPosition=(modelMatrix*offsetPos).xyz;gl_Position=projectionMatrix*modelViewMatrix*offsetPos;}`,cubeNormalFrag="varying vec3 vNormal;varying vec3 vecPosition;uniform float radius;void main(){vec3 color=normalize(vNormal);color=color*0.5+0.5;gl_FragColor=vec4(color.x,color.y,color.z,length(vecPosition)/radius);}";class CubeNormalsCaptureHelper{constructor(o){this._normalsCache={},this._renderer=o,this._scene=new three_module.Z58,this._mesh=new three_module.eaF,this._mesh.frustumCulled=!1,this._scene.add(this._mesh),this._mesh.position.set(0,0,0),this._mesh.material=new NormalCaptureMaterial}dispose(){var o;(o=this._mesh.geometry)===null||o===void 0||o.dispose(),this._mesh.material.dispose(),this.disposeAllTargets()}disposeTarget(o){o.split(";").forEach(c=>{var d;return(d=this._normalsCache[c])===null||d===void 0?void 0:d.dispose()})}disposeAllTargets(){Object.values(this._normalsCache).forEach(o=>o.dispose()),this._normalsCache={}}hasCapturedNormalMap(o){return!!o.userData._normalsCaptureMap}_getPrecisionType(o){return o==="low"?three_module.OUM:o==="medium"?three_module.ix0:o==="high"?three_module.RQf:three_module.ix0}captureNormalMap(o,c,d=512,_="medium",b){if(!o)throw"No geometry";if(this.hasCapturedNormalMap(o))return!1;const _e=c==null?void 0:c.split(";").find(at=>this._normalsCache[at]);if(_e){const at=this._normalsCache[_e];return c==null||c.split(";").forEach(ut=>ut!==_e&&(this._normalsCache[ut]=at)),at.width!==d&&console.warn("last cacheKey normalMapRes mismatch, check model",d),o.userData._normalsCaptureMap=at,!1}const it=this._renderer.createTargetCustom({width:d,height:d},{minFilter:three_module.hxR,magFilter:three_module.hxR,generateMipmaps:!1,type:this._getPrecisionType(_)},three_module.o6l);if(it.attachedGeometries=[],it.autoDispose=CubeNormalsCaptureHelper.AutoDisposeTargets,!it)throw"Unable to create render target";const nt=()=>{var at;const ut=new three_module.F1T(1e-4,100,it);this._scene.add(ut);const pt=o.userData.normalsCaptureOffsets;pt.center!==void 0&&this._mesh.material.uniforms.offsetCenter.value.fromArray(pt.center),pt.offsetMatrixInv!==void 0&&this._mesh.material.uniforms.offsetMatrixInv.value.fromArray(pt.offsetMatrixInv),pt.radius!==void 0&&(this._mesh.material.uniforms.radius.value=pt.radius),this._mesh.geometry=o,b!=null&&b.morphTargetInfluences&&!((at=o.morphAttributes)===null||at===void 0)&&at.position&&(this._mesh.morphTargetInfluences=b.morphTargetInfluences,this._mesh.morphTargetDictionary=b.morphTargetDictionary);const mt=this._renderer.rendererObject.getClearColor(new three_module.Q1f),ft=this._renderer.rendererObject.getClearAlpha();this._renderer.rendererObject.setClearColor(new three_module.Q1f(0,0,0),1),ut.update(this._renderer.rendererObject,this._scene),this._renderer.rendererObject.setClearColor(mt,ft),this._mesh.morphTargetInfluences=void 0,this._mesh.morphTargetDictionary=void 0,this._scene.remove(ut),this._mesh.geometry=void 0,o.userData._normalsCaptureMap=it};return nt(),this._renderer.addEventListener("contextRestored",nt),it.attachedGeometries.push(o),o.addEventListener("dispose",()=>{var at,ut;it.attachedGeometries=(ut=(at=it.attachedGeometries)===null||at===void 0?void 0:at.filter(pt=>pt!==o))!==null&&ut!==void 0?ut:[],delete o.userData._normalsCaptureMap,this._renderer.removeEventListener("contextRestored",nt),it.autoDispose&&!it.attachedGeometries.length&&it.dispose()}),c==null||c.split(";").forEach(at=>this._normalsCache[at]=it),it.addEventListener("dispose",()=>{var at;c==null||c.split(";").forEach(ut=>delete this._normalsCache[ut]),this._renderer.removeEventListener("contextRestored",nt),(at=it.attachedGeometries)===null||at===void 0||at.forEach(ut=>delete ut.userData._normalsCaptureMap)}),!0}removeNormalMap(o){o.userData._normalsCaptureMap&&(o.userData._normalsCaptureMap.dispose(),delete o.userData._normalsCaptureMap)}}CubeNormalsCaptureHelper.AutoDisposeTargets=!0;class NormalCaptureMaterial extends three_module.BKk{constructor(){super({vertexShader:cubeNormalVert,fragmentShader:cubeNormalFrag,side:three_module.$EB,clipping:!1,uniforms:{radius:{value:1},offsetMatrixInv:{value:new three_module.kn4().identity()},offsetCenter:{value:new three_module.Pq0}}})}}var diamond_frag=`varying vec3 vWorldNormal;varying vec3 vWorldPosition;varying vec3 vViewPosition;varying vec3 vNormal;varying vec2 vUv;uniform float radius;uniform vec3 centerOffset;
#ifdef USE_INSTANCING
varying mat4 vModelInstanceOffsetMatrix;varying mat4 vModelInstanceOffsetMatrixInv;
#define MODEL_OFFSET_MATRIX  vModelInstanceOffsetMatrix
#define INV_MODEL_OFFSET_MATRIX  vModelInstanceOffsetMatrixInv
#else
uniform mat4 modelOffsetMatrixInv;uniform mat4 modelOffsetMatrix;
#define MODEL_OFFSET_MATRIX  modelOffsetMatrix
#define INV_MODEL_OFFSET_MATRIX  modelOffsetMatrixInv
#endif
#ifdef USE_MORPHTARGETS
varying vec3 vCenterOffset;
#define CENTER_OFFSET  (centerOffset + vCenterOffset)
#else
#define CENTER_OFFSET  (centerOffset) 
#endif
uniform mat4 projectionMatrix;uniform samplerCube tCubeMapNormals;
#if ENV_MAP_TYPE == 0
uniform samplerCube envMap;
#elif ENV_MAP_TYPE == 1
uniform sampler2D envMap;
#endif
uniform float envMapIntensity;uniform float transmission;uniform vec2 transmissionSamplerSize;uniform sampler2D transmissionSamplerMap;uniform float refractiveIndex;uniform float rIndexDelta;uniform float squashFactor;uniform float geometryFactor;uniform vec3 color;uniform vec3 colorCorrection;uniform vec3 boostFactors;uniform float gammaFactor;uniform float absorptionFactor;uniform float envMapRotation;uniform vec4 envMapRotationQuat;uniform float reflectivity;vec3 BRDF_Specular_GGX_Environment(const in vec3 viewDir,const in vec3 normal,const in vec3 specularColor,const in float roughness){float dotNV=abs(dot(normal,viewDir));const vec4 c0=vec4(-1,-0.0275,-0.572,0.022);const vec4 c1=vec4(1,0.0425,1.04,-0.04);vec4 r=roughness*c0+c1;float a004=min(r.x*r.x,exp2(-9.28*dotNV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec2 cartesianToPolar(vec3 n){vec2 uv;uv.x=atan(n.z,n.x)/(PI*2.)+0.5;uv.y=asin(n.y)/PI+0.5;return uv;}vec4 sampleEnvMap(vec3 direction){
#if !defined(USE_ENVMAP)
return vec4(direction,1);
#else
float cs=cos(envMapRotation);float sn=sin(envMapRotation);float temp=cs*direction.x+sn*direction.z;direction.z=-sn*direction.x+cs*direction.z;direction.x=temp;direction.x*=-1.;direction.y*=-1.;direction.z*=-1.;vec3 t=2.*cross(envMapRotationQuat.xyz,direction);direction+=envMapRotationQuat.w*t+cross(envMapRotationQuat.xyz,t);
#if ENV_MAP_TYPE == 0
return(textureCube(envMap,direction));
#elif ENV_MAP_TYPE == 1
return(texture2D(envMap,cartesianToPolar(direction)));
#endif
return vec4(1,0,1,1);
#endif
}vec4 SampleSpecularReflection(vec3 direction){
#if defined(FIX_ENV_DIRECTION)
direction=(viewMatrix*vec4(direction,0.)).xyz;
#endif
return envMapIntensity*(sampleEnvMap(direction));}vec4 SampleSpecularContribution(vec3 direction){
#if DIA_ORIENT_ENVMAP < 1
direction=mat3(MODEL_OFFSET_MATRIX)*direction;
#endif
#if defined(FIX_ENV_DIRECTION)
direction=(viewMatrix*vec4(direction,0.)).xyz;
#endif
direction=normalize(direction);direction.x*=-1.;direction.z*=-1.;return envMapIntensity*(sampleEnvMap(direction));}vec4 SampleSpecularContributionRef(vec3 origin,int i){vec4 ndcPos=projectionMatrix*viewMatrix*vec4(origin,1.);vec2 refractionCoords=ndcPos.xy/ndcPos.w;refractionCoords+=1.;refractionCoords/=2.;return transmissionSamplerMapTexelToLinear(texture2D(transmissionSamplerMap,refractionCoords));}vec3 intersectSphere(vec3 origin,vec3 direction){origin-=CENTER_OFFSET;direction.y/=squashFactor;float A=dot(direction,direction);float B=2.*dot(origin,direction);float C=dot(origin,origin)-radius*radius;float disc=B*B-4.*A*C;if(disc>0.){disc=sqrt(disc);float t1=(-B+disc)*geometryFactor/A;float t2=(-B-disc)*geometryFactor/A;float t=(t1>t2)?t1:t2;direction.y*=squashFactor;return vec3(origin+CENTER_OFFSET+direction*t);}return vec3(0.);}vec3 linePlaneIntersect(in vec3 pointOnLine,in vec3 lineDirection,in vec3 pointOnPlane,in vec3 planeNormal){return lineDirection*(dot(planeNormal,pointOnPlane-pointOnLine)/dot(planeNormal,lineDirection))+pointOnLine;}vec4 getNormalDistance(vec3 d){return textureCube(tCubeMapNormals,d);}vec3 getSurfaceNormal(vec4 surfaceInfos){vec3 surfaceNormal=surfaceInfos.rgb;surfaceNormal=surfaceNormal*2.-1.;return-normalize(surfaceNormal);}vec3 intersect(vec3 rayOrigin,vec3 rayDirection){vec3 sphereHitPoint=intersectSphere(rayOrigin,rayDirection);vec3 direction1=normalize(sphereHitPoint-CENTER_OFFSET);vec4 normalDistanceData1=getNormalDistance(direction1);float distance1=normalDistanceData1.a*radius;vec3 pointOnPlane1=CENTER_OFFSET+direction1*distance1;vec3 planeNormal1=getSurfaceNormal(normalDistanceData1);vec3 hitPoint1=linePlaneIntersect(rayOrigin,rayDirection,pointOnPlane1,planeNormal1);vec3 direction2=normalize(hitPoint1-CENTER_OFFSET);vec4 normalDistanceData2=getNormalDistance(direction2);float distance2=normalDistanceData2.a*radius;vec3 pointOnPlane2=CENTER_OFFSET+direction2*distance2;vec3 hitPoint=hitPoint1;vec3 planeNormal2=getSurfaceNormal(normalDistanceData2);hitPoint=linePlaneIntersect(rayOrigin,rayDirection,pointOnPlane2,planeNormal2);return hitPoint;}vec3 debugBounces(int count){vec3 color=vec3(1.,1.,1.);if(count==1)color=vec3(0.,1.,0.);else if(count==2)color=vec3(0.,0.,1.);else if(count==3)color=vec3(1.,1.,0.);else if(count==4)color=vec3(0.,1.,1.);else color=vec3(0.,1.,0.);if(count==0)color=vec3(1.,0.,0.);return color;}vec3 getRefractionColor(vec3 origin,vec3 direction,vec3 normal){vec3 outColor=vec3(0.);const float n1=1.;const float epsilon=1e-4;float f0=(2.4-n1)/(2.4+n1);f0*=f0;vec3 attenuationFactor=vec3(1.);vec3 newDirection=refract(direction,normal,n1/refractiveIndex);vec3 brdfRefracted=BRDF_Specular_GGX_Environment(newDirection,-normal,vec3(f0),0.);attenuationFactor*=(vec3(1.)-brdfRefracted);int count=0;mat4 invModelOffsetMatrix=INV_MODEL_OFFSET_MATRIX;newDirection=normalize((invModelOffsetMatrix*vec4(newDirection,0.)).xyz);origin=(invModelOffsetMatrix*vec4(origin,1.)).xyz;for(int i=0;i<RAY_BOUNCES;i++){vec3 intersectedPos=intersect(origin,newDirection);vec3 dist=intersectedPos-origin;vec3 d=normalize(intersectedPos-CENTER_OFFSET);vec3 mappedNormal=getNormalDistance(d).rgb;mappedNormal=2.*mappedNormal-1.;mappedNormal=-normalize(mappedNormal);float r=length(dist)/radius*absorptionFactor;attenuationFactor*=exp(-r*(1.-color));origin=intersectedPos;vec3 origin2=(MODEL_OFFSET_MATRIX*vec4(intersectedPos,1)).xyz;vec3 oldDir=newDirection;newDirection=refract(newDirection,mappedNormal,refractiveIndex/n1);if(dot(newDirection,newDirection)<epsilon){newDirection=reflect(oldDir,mappedNormal);if(i==RAY_BOUNCES-1){vec3 brdfReflected=BRDF_Specular_GGX_Environment(-oldDir,mappedNormal,vec3(f0),0.);vec3 d1=mat3(MODEL_OFFSET_MATRIX)*oldDir;d1=normalize(d1);float cosT=1.-dot(direction,d1);outColor+=((transmission>0.&&cosT<transmission)?SampleSpecularContributionRef(origin2+0.5*d1*cosT,i).rgb:SampleSpecularContribution(oldDir).rgb)*attenuationFactor*colorCorrection*boostFactors*(vec3(1.)-min(vec3(1.),brdfReflected));}}else{vec3 brdfRefracted=vec3(1.)-min(vec3(1.),BRDF_Specular_GGX_Environment(newDirection,-mappedNormal,vec3(f0),0.));vec3 d1=normalize(mat3(MODEL_OFFSET_MATRIX)*newDirection);float cosT=1.-dot(direction,d1);if(transmission>0.&&cosT<transmission){outColor+=SampleSpecularContributionRef(origin2+0.5*d1*cosT,i).rgb*brdfRefracted*attenuationFactor*colorCorrection*boostFactors;}else{vec3 dir0=newDirection;vec3 dir1=refract(oldDir,mappedNormal,(refractiveIndex+rIndexDelta)/n1);vec3 dir2=refract(oldDir,mappedNormal,(refractiveIndex-rIndexDelta)/n1);outColor+=vec3(SampleSpecularContribution(dir1).r,SampleSpecularContribution(dir0).g,SampleSpecularContribution(dir2).b)*brdfRefracted*attenuationFactor*colorCorrection*boostFactors;}newDirection=reflect(oldDir,mappedNormal);vec3 brdfReflected=BRDF_Specular_GGX_Environment(newDirection,mappedNormal,vec3(f0),0.);attenuationFactor*=brdfReflected*boostFactors;count++;}}return outColor;}void main(){vec3 normalizedNormal=normalize(vWorldNormal);vec3 viewVector=normalize(vWorldPosition-cameraPosition);const float n1=1.;const float epsilon=1e-4;float f0=(2.4-n1)/(2.4+n1);f0*=f0;vec3 attenuationFactor=vec3(1.);vec3 reflectedDirection=reflect(viewVector,normalizedNormal);vec3 brdfReflected=BRDF_Specular_GGX_Environment(reflectedDirection,normalizedNormal,vec3(f0),0.);vec3 reflectionColor=SampleSpecularReflection(reflectedDirection).rgb*brdfReflected*reflectivity*2.;vec3 refractionColor=getRefractionColor(vWorldPosition,viewVector,normalizedNormal);vec3 normal=normalize(vNormal);vec3 diffuseColor=vec3(1.);
#glMarker beforeAccumulation
gl_FragColor=vec4((refractionColor.rgb+reflectionColor.rgb)*diffuseColor,1.);gl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(gammaFactor));gl_FragColor.rgb=max(gl_FragColor.rgb,0.);
#include <colorspace_fragment>
}`,diamond_vert=`#ifndef USE_ENVMAP
#define USE_ENVMAP  
#endif
varying vec3 vWorldPosition;varying vec3 vWorldNormal;varying vec3 vViewPosition;varying vec3 vNormal;varying vec2 vUv;
#ifdef USE_INSTANCING
uniform mat4 inverseModelMatrix;uniform mat4 modelOffsetMatrix;varying mat4 vModelInstanceOffsetMatrix;varying mat4 vModelInstanceOffsetMatrixInv;
#endif
#include <morphtarget_pars_vertex>
#ifdef USE_MORPHTARGETS
varying vec3 vCenterOffset;
#ifndef USE_INSTANCING
uniform mat4 modelOffsetMatrixInv;
#endif
#endif
void main(){
#ifdef USE_INSTANCING
vWorldNormal=(modelMatrix*instanceMatrix*vec4(normal,0.)).xyz;
#else
vWorldNormal=(modelMatrix*vec4(normal,0.)).xyz;
#endif
#include <beginnormal_vertex>
#include <defaultnormal_vertex>
#include <normal_vertex>
#include <begin_vertex>
#ifdef USE_MORPHTARGETS
vCenterOffset=transformed;
#include <morphtarget_vertex>
vCenterOffset=transformed-vCenterOffset;
#ifndef USE_INSTANCING
vCenterOffset=(modelOffsetMatrixInv*modelMatrix*vec4(vCenterOffset,1.)).xyz;
#endif
#endif
#include <project_vertex>
vViewPosition=-mvPosition.xyz;vUv=uv;
#include <worldpos_vertex>
vWorldPosition=worldPosition.xyz;
#ifdef USE_INSTANCING
vModelInstanceOffsetMatrix=modelMatrix*instanceMatrix*inverseModelMatrix*modelOffsetMatrix;vModelInstanceOffsetMatrixInv=inverse(vModelInstanceOffsetMatrix);
#ifdef USE_MORPHTARGETS
vCenterOffset=(vModelInstanceOffsetMatrixInv*modelMatrix*vec4(vCenterOffset,1.)).xyz;
#endif
#endif
}`,pca=__webpackgi_require__(391);function computeOffsetMatrix(h){const o=new three_module.Pq0(0,0,0),c=new three_module.Pq0(0,0,0),d=new three_module.Pq0(0,0,0),_=new three_module.Pq0(0,0,0),b=h.getAttribute("position"),_e=h.index;if(_e)for(let mt=Math.max(0,h.drawRange.start),ft=Math.min(_e.count,h.drawRange.start+h.drawRange.count)-1;mt<ft/3;mt+=3){const vt=_e.getX(mt),xt=_e.getX(mt+1),At=_e.getX(mt+2);c.set(b.getX(vt),b.getY(vt),b.getZ(vt)),d.set(b.getX(xt),b.getY(xt),b.getZ(xt)),_.set(b.getX(At),b.getY(At),b.getZ(At)),d.sub(c),_.sub(c),_.cross(d),_.normalize(),o.add(_)}else for(let mt=0;mt<b.count;mt+=3)c.set(b.getX(mt),b.getY(mt),b.getZ(mt)),d.set(b.getX(mt+1),b.getY(mt+1),b.getZ(mt+1)),_.set(b.getX(mt+2),b.getY(mt+2),b.getZ(mt+2)),d.sub(c),_.sub(c),_.cross(d),_.normalize(),o.add(_);o.normalize();let it=!1,nt=0;for(;!it;){const mt=nt/3,ft=_e?_e.getX(mt):mt,vt=_e?_e.getX(mt+1):mt+1;c.set(b.getX(ft),b.getY(ft),b.getZ(ft)),d.set(b.getX(vt),b.getY(vt),b.getZ(vt)),c.sub(d),c.normalize();const xt=o.dot(c);Math.abs(xt-1)>.001&&c.length()>.5&&(it=!0),nt+=3}d.crossVectors(c,o),d.normalize(),c.crossVectors(o,d),c.normalize();const at=new three_module.kn4;at.elements[0]=c.x,at.elements[1]=c.y,at.elements[2]=c.z,at.elements[3]=0,at.elements[4]=o.x,at.elements[5]=o.y,at.elements[6]=o.z,at.elements[7]=0,at.elements[8]=d.x,at.elements[9]=d.y,at.elements[10]=d.z,at.elements[11]=0,at.elements[12]=0,at.elements[13]=0,at.elements[14]=0,at.elements[15]=1,h.computeBoundingSphere();const ut=h.boundingSphere.radius,pt=new three_module.kn4().makeScale(ut,ut,ut);return at.multiply(pt),at}function SignedTetrahedronVolume(h,o,c){const d=new three_module.Pq0().copy(h),_=new three_module.Pq0().copy(o),b=new three_module.Pq0().copy(c);return d.dot(_.cross(b))/6}function TriangleArea(h,o,c){const d=new three_module.Pq0().copy(h),_=new three_module.Pq0().copy(o),b=new three_module.Pq0().copy(c);return _.sub(d),b.sub(d),b.cross(_),.5*b.length()}function computeCenterAndCOM(h,o){const c=new three_module.Pq0;for(let pt=0;pt<h.length;pt+=3)c.x+=h[pt],c.y+=h[pt+1],c.z+=h[pt+2];c.multiplyScalar(1/(h.length/3));const d=new three_module.Pq0,_=new three_module.Pq0,b=new three_module.Pq0,_e=new three_module.Pq0,it=new three_module.Pq0;let nt=0,at=0,ut=o.length;ut%3!=0&&(ut-=ut%3);for(let pt=0;pt<ut;pt+=3){d.set(o[pt][0],o[pt][1],o[pt][2]),_.set(o[pt+1][0],o[pt+1][1],o[pt+1][2]),b.set(o[pt+2][0],o[pt+2][1],o[pt+2][2]),it.copy(d).add(_).add(b);const mt=TriangleArea(d,_,b);it.multiplyScalar(mt/3),_e.add(it),nt+=mt,at+=SignedTetrahedronVolume(d,_,b)}return _e.multiplyScalar(1/nt),{center:c,com:_e,volume:at,area:nt}}function computeEigenVectors(h){const o=h.getAttribute("position"),c=h.getAttribute("normal");if(o.count/3>1500)return console.warn("DiamondPlugin:: Too many faces. Mirror/Topology issues will not be fixed",o.count/3),computeOffsetMatrix(h);const d=new three_module.Pq0(0,0,0),_=new three_module.Pq0(0,0,0),b=new three_module.Pq0(0,0,0),_e=h.index,it=[];if(_e)for(let Ct=Math.max(0,h.drawRange.start),Et=Math.min(_e.count,h.drawRange.start+h.drawRange.count)-1;Ct<Et;Ct+=3){const Tt=_e.getX(Ct),kt=_e.getX(Ct+1),Dt=_e.getX(Ct+2);d.set(o.getX(Tt),o.getY(Tt),o.getZ(Tt)),_.set(o.getX(kt),o.getY(kt),o.getZ(kt)),b.set(o.getX(Dt),o.getY(Dt),o.getZ(Dt)),it.push(d.toArray(),_.toArray(),b.toArray())}else for(let Ct=0;Ct<o.count;Ct++)d.set(o.getX(Ct),o.getY(Ct),o.getZ(Ct)),it.push(d.toArray());const nt=computeCenterAndCOM(o.array,it);if(nt.volume<0){console.warn("DiamondPlugin:: Negative Volume, Fixing Normals");for(let Ct=0;Ct<c.count;Ct++)c.setX(Ct,-c.getX(Ct)),c.setY(Ct,-c.getY(Ct)),c.setZ(Ct,-c.getZ(Ct));c.needsUpdate=!0}const at=[];for(let Ct=0;Ct<o.array.length;Ct+=3)at.push([o.array[Ct],o.array[Ct+1],o.array[Ct+2]]);const ut=console.log;console.log=()=>{};const pt=(0,pca.getEigenVectors)(at);console.log=ut;const mt=new three_module.kn4;mt.elements[0]=pt[0].vector[0],mt.elements[1]=pt[0].vector[1],mt.elements[2]=pt[0].vector[2],mt.elements[3]=0,mt.elements[4]=pt[1].vector[0],mt.elements[5]=pt[1].vector[1],mt.elements[6]=pt[1].vector[2],mt.elements[7]=0,mt.elements[8]=pt[2].vector[0],mt.elements[9]=pt[2].vector[1],mt.elements[10]=pt[2].vector[2],mt.elements[11]=0,mt.elements[12]=0,mt.elements[13]=0,mt.elements[14]=0,mt.elements[15]=1;const ft=new three_module.Pq0;ft.copy(nt.com).sub(nt.center),ft.normalize();const vt=new three_module.Pq0(pt[2].vector[0],pt[2].vector[1],pt[2].vector[2]);ft.dot(vt)<0&&(mt.elements[4]=-pt[1].vector[0],mt.elements[5]=-pt[1].vector[1],mt.elements[6]=-pt[1].vector[2],mt.elements[8]=-pt[2].vector[0],mt.elements[9]=-pt[2].vector[1],mt.elements[10]=-pt[2].vector[2]),h.computeBoundingSphere();const xt=h.boundingSphere.radius,At=new three_module.kn4().makeScale(xt,xt,xt);return mt.multiply(At),mt}const diamondMaterialPropList={...threeMaterialPropList,color:new three_module.Q1f(1,1,1),envMapIntensity:1,envMapRotation:0,dispersion:.012,squashFactor:.98,geometryFactor:.5,gammaFactor:2.2,absorptionFactor:1,reflectivity:.5,refractiveIndex:2.4,boostFactors:new three_module.Pq0(.892,.892,.98595025),wireframe:!1,envMapRotationOffset:0,wireframeLinewidth:0,skinning:!1,transmission:0,morphTargets:!1,morphNormals:!1,rayBounces:1,diamondOrientedEnvMap:0,envMapIndex:0};var diamondMaterial_decorate=function(h,o,c,d){var _,b=arguments.length,_e=b<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_e=Reflect.decorate(h,o,c,d);else for(var it=h.length-1;it>=0;it--)(_=h[it])&&(_e=(b<3?_(_e):b>3?_(o,c,_e):_(o,c))||_e);return b>3&&_e&&Object.defineProperty(o,c,_e),_e};class DiamondMaterial extends three_module.BKk{get mmMaterial(){return this}get materialObject(){return this}onBeforeRender(o,c,d,_,b){var _e,it;super.onBeforeRender(o,c,d,_,b),this.envMapIntensity===void 0||this.userData.separateEnvMapIntensity||c.envMapIntensity===void 0||(this.userData.__envIntensity=this.envMapIntensity,this.envMapIntensity=c.envMapIntensity),this.envMap!==void 0&&c.fixedEnvMapDirection!==void 0&&(c.fixedEnvMapDirection?this.defines.FIX_ENV_DIRECTION||(this.defines.FIX_ENV_DIRECTION="1",this.needsUpdate=!0):this.defines.FIX_ENV_DIRECTION!==void 0&&(delete this.defines.FIX_ENV_DIRECTION,this.needsUpdate=!0)),this.uniforms.envMapRotation.value=(((_e=this.envMap)===null||_e===void 0?void 0:_e.rotation)||0)+this.envMapRotationOffset,this.uniforms.envMapRotationQuat.value.setFromEuler(new three_module.O9p(this.envMapRotationOffsetX,this.envMapRotationOffsetY,this.envMapRotationOffsetZ)),this.extraUniformsToUpload.inverseModelMatrix.value.copy(b.matrixWorld).invert();const nt=_.userData.normalsCaptureOffsets;nt&&(this.extraUniformsToUpload.centerOffset.value.fromArray(nt.centerOffset),this.extraUniformsToUpload.modelOffsetMatrix.value.fromArray(nt.offsetMatrix).premultiply(b.matrixWorld),this.extraUniformsToUpload.modelOffsetMatrixInv.value.copy(this.extraUniformsToUpload.modelOffsetMatrix.value).invert(),this.extraUniformsToUpload.radius.value=nt.radius);const at=(it=_.userData._normalsCaptureMap)===null||it===void 0?void 0:it.texture;this.normalsCaptureMap!==at&&(this.normalsCaptureMap=at),this.dispatchEvent({type:"beforeRender",renderer:o,scene:c,camera:d,geometry:_,object:b})}onAfterRender(o,c,d,_,b){super.onAfterRender(o,c,d,_,b),this.userData.__envIntensity!==void 0&&(this.envMapIntensity=this.userData.__envIntensity,delete this.userData.__envIntensity),this.dispatchEvent({type:"afterRender",renderer:o,scene:c,camera:d,geometry:_,object:b})}constructor(o){var c;super({side:three_module.$EB,defines:{DIA_ORIENT_ENVMAP:0,RAY_BOUNCES:5,ENV_MAP_TYPE:0,PI:3.1428},vertexShader:diamond_vert,fragmentShader:diamond_frag,uniforms:{envMap:{value:(o==null?void 0:o.envMap)||null},envMapRotation:{value:0},envMapRotationQuat:{value:new three_module.PTz},transmission:{value:0},transmissionSamplerMap:{value:null},transmissionSamplerSize:{value:new three_module.I9Y},normalOffset:{value:0},distanceOffset:{value:0},colorCorrection:{value:new three_module.Pq0(1,1,1)}}}),this.typeSlug=DiamondMaterial.TypeSlug,this.assetType="material",this.__envMap=[],this.isDiamondMaterial=!0,this.color=new three_module.Q1f(1,1,1),this.envMapIntensity=.05,this.envMapRotationOffset=0,this.envMapRotationOffsetX=0,this.envMapRotationOffsetY=0,this.envMapRotationOffsetZ=0,this.dispersion=.012,this.absorptionFactor=1,this.refractiveIndex=2.4,this.squashFactor=.98,this.geometryFactor=.5,this.gammaFactor=2.2,this.boostFactors=new three_module.Pq0(.892,.892,.98595025),this.transmission=0,this.reflectivity=.5,this.rayBounces=5,this.diamondOrientedEnvMap=0,this.normalsCaptureMap=null,this.extraUniformsToUpload={inverseModelMatrix:{value:new three_module.kn4().identity()},radius:{value:1},centerOffset:{value:new three_module.Pq0(0,0,0)},modelOffsetMatrix:{value:new three_module.kn4().identity()},modelOffsetMatrixInv:{value:new three_module.kn4().identity()}},this.envMapIndex=0,this.setDirty=this.setDirty.bind(this),this.userData.setDirty=d=>{console.warn("WebGi DiamondMaterial: userData.setDirty is deprecated. Use setDirty instead."),this.setDirty(d)},this.userData.separateEnvMapIntensity=!0,o&&this.setValues(o),this.materialExtensions=MaterialExtender.RegisterExtensions(this,(c=o==null?void 0:o.customMaterialExtensions)!==null&&c!==void 0?c:[])}registerMaterialExtensions(o){this.materialExtensions=[...this.materialExtensions,...MaterialExtender.RegisterExtensions(this,o)]}unregisterMaterialExtensions(o){}onBeforeCompile(o,c){MaterialExtender.ApplyMaterialExtensions(this,o,this.materialExtensions,c),this.dispatchEvent({type:"beforeCompile",shader:o,renderer:c}),o.fragmentShader=o.fragmentShader.replaceAll("#glMarker","// "),o.vertexShader=o.vertexShader.replaceAll("#glMarker","// "),super.onBeforeCompile(o,c)}customProgramCacheKey(){return super.customProgramCacheKey()+MaterialExtender.CacheKeyForExtensions(this,this.materialExtensions)}setDirty(o){var c,d;this.needsUpdate=!0,this.dispatchEvent({...o,type:"materialUpdate",frameFade:o==null?void 0:o.last}),(o==null?void 0:o.last)!==!1&&((d=(c=this._uiConfig)===null||c===void 0?void 0:c.uiRefresh)===null||d===void 0||d.call(c,"postFrame",!0,1))}set envMaps(o){this.__envMap=o,this.refreshEnvUniform()}refreshEnvUniform(){var o;this.uniforms.envMap.value=this.envMap,this.defines.ENV_MAP_TYPE=!((o=this.uniforms.envMap.value)===null||o===void 0)&&o.isCubeTexture?0:1,this.needsUpdate=!0}get envMap(){var o,c;return(c=(o=this.__envMap[this.envMapIndex])!==null&&o!==void 0?o:this.__envMap[0])!==null&&c!==void 0?c:null}set envMap(o){console.error("Setting separate envmap for individual diamond material not supported yet.")}clone(){return super.clone()}toJSON(o){const c={metadata:{version:4.6,type:"DiamondMaterial",generator:"DiamondMaterial.toJSON"}};return c.name=this.name,c.uuid=this.uuid,c.color=this.color.getHex(),c.envMapIntensity=this.envMapIntensity,c.envMapIndex=this.envMapIndex,c.envMapRotationOffset=this.envMapRotationOffset,c.dispersion=this.dispersion,c.squashFactor=this.squashFactor,c.geometryFactor=this.geometryFactor,c.gammaFactor=this.gammaFactor,c.absorptionFactor=this.absorptionFactor,c.reflectivity=this.reflectivity,c.refractiveIndex=this.refractiveIndex,c.rayBounces=this.rayBounces,c.diamondOrientedEnvMap=this.diamondOrientedEnvMap,c.boostFactors={x:this.boostFactors.x,y:this.boostFactors.y,z:this.boostFactors.z,isVector3:!0},c.transmission=this.transmission,c.isDiamondMaterialParameters=!0,c.type=DiamondMaterial.TYPE,c.userData={},copyMaterialUserData(c.userData,this.userData),c.userData.uuid=this.userData.uuid,c}get uiConfig(){const o=this;return this._uiConfigChildren||(this._uiConfigChildren=[{type:"input",property:[this,"name"]},{type:"checkbox",property:[this,"wireframe"]},{type:"dropdown",label:"Environment",property:[this,"envMapIndex"],children:[0,1,2].map(c=>({label:"env"+(c+1),value:c}))},...generateUiConfig(this),{type:"input",label:"Mesh count",get value(){var c,d,_;return(_=(d=(c=o.userData)===null||c===void 0?void 0:c.__appliedMeshes)===null||d===void 0?void 0:d.size)!==null&&_!==void 0?_:0},set value(c){},disabled:!0},{type:"input",label:"uuid",get value(){return o.uuid},set value(c){},disabled:!0},{type:"checkbox",label:"Render to Depth",hidden:()=>this.transmission===0,get value(){return o.userData.renderToDepth===!0},set value(c){o.userData.renderToDepth=c||void 0}},{type:"button",label:"Download .dmat",value:()=>{N$2(new Blob([JSON.stringify(o.toJSON(),null,2)],{type:"application/json"}),"diamond-material.dmat")}}]),this._uiConfig||(this._uiConfig={type:"folder",label:"Diamond Material",expanded:!0,children:this._uiConfigChildren,limitedUi:!0}),this._uiConfig.children=[...this._uiConfigChildren,...this.materialExtensions.map(c=>{var d;return(d=c.getUiConfig)===null||d===void 0?void 0:d.call(c,this)})].filter(c=>c),this._uiConfig}copyProps(o){if(!o.isDiamondMaterialParameters&&!o.isDiamondMaterial&&!o.isDiamond&&o.type!==DiamondMaterial.TYPE)return console.warn("WebGi DiamondMaterial: Material type is not supported",o),this;const c={};xe$1(o,c,Array.from(Object.keys(diamondMaterialPropList)));const d=c.userData;return delete c.userData,this.setValues(c),copyMaterialUserData(this.userData,d),this.setDirty(),this}fromJSON(o,c){return this.copyProps(o)}}DiamondMaterial.TypeSlug="dmat",DiamondMaterial.TYPE="DiamondMaterial",diamondMaterial_decorate([uiColor("Color",{limitedUi:!0}),uniform()],DiamondMaterial.prototype,"color",void 0),diamondMaterial_decorate([uiSlider("Env Intensity",[0,5],.01,{limitedUi:!0}),uniform()],DiamondMaterial.prototype,"envMapIntensity",void 0),diamondMaterial_decorate([uiSlider("Env Rotation Offset",[-Math.PI,Math.PI],.01),ze$1(DiamondMaterial.prototype.setDirty)],DiamondMaterial.prototype,"envMapRotationOffset",void 0),diamondMaterial_decorate([uiSlider("Env Rotation Offset X",[-Math.PI,Math.PI],.01),ze$1(DiamondMaterial.prototype.setDirty)],DiamondMaterial.prototype,"envMapRotationOffsetX",void 0),diamondMaterial_decorate([uiSlider("Env Rotation Offset Y",[-Math.PI,Math.PI],.01),ze$1(DiamondMaterial.prototype.setDirty)],DiamondMaterial.prototype,"envMapRotationOffsetY",void 0),diamondMaterial_decorate([uiSlider("Env Rotation Offset Z",[-Math.PI,Math.PI],.01),ze$1(DiamondMaterial.prototype.setDirty)],DiamondMaterial.prototype,"envMapRotationOffsetZ",void 0),diamondMaterial_decorate([uiSlider("Dispersion",[0,.1],1e-4,{limitedUi:!0}),uniform({propKey:"rIndexDelta"})],DiamondMaterial.prototype,"dispersion",void 0),diamondMaterial_decorate([uiSlider("Absorption",[0,15],.01,{limitedUi:!0}),uniform()],DiamondMaterial.prototype,"absorptionFactor",void 0),diamondMaterial_decorate([uiSlider("Refractive Index",[0,4],.01,{limitedUi:!0}),uniform()],DiamondMaterial.prototype,"refractiveIndex",void 0),diamondMaterial_decorate([uniform()],DiamondMaterial.prototype,"squashFactor",void 0),diamondMaterial_decorate([uniform()],DiamondMaterial.prototype,"geometryFactor",void 0),diamondMaterial_decorate([uiSlider("Gamma",[.1,4],.01,{limitedUi:!0}),uniform()],DiamondMaterial.prototype,"gammaFactor",void 0),diamondMaterial_decorate([uiVector("RGB Boost",void 0,void 0,{limitedUi:!0}),uniform()],DiamondMaterial.prototype,"boostFactors",void 0),diamondMaterial_decorate([uiSlider("Transmission",[0,1],.01,{limitedUi:!0}),uniform()],DiamondMaterial.prototype,"transmission",void 0),diamondMaterial_decorate([uiSlider("Reflectivity",[0,2],.01,{limitedUi:!0}),uniform()],DiamondMaterial.prototype,"reflectivity",void 0),diamondMaterial_decorate([matDefine("RAY_BOUNCES",void 0,!0),uiSlider("Ray Bounces",[1,16],1)],DiamondMaterial.prototype,"rayBounces",void 0),diamondMaterial_decorate([matDefine("DIA_ORIENT_ENVMAP",void 0,!0),uiSlider("Diamond Oriented Lighting",[0,1],1)],DiamondMaterial.prototype,"diamondOrientedEnvMap",void 0),diamondMaterial_decorate([uniform({propKey:"tCubeMapNormals"})],DiamondMaterial.prototype,"normalsCaptureMap",void 0),diamondMaterial_decorate([x$1(DiamondMaterial.prototype.refreshEnvUniform)],DiamondMaterial.prototype,"envMapIndex",void 0);const algorithms={ES256:{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}},ES384:{name:"ECDSA",namedCurve:"P-384",hash:{name:"SHA-384"}},ES512:{name:"ECDSA",namedCurve:"P-521",hash:{name:"SHA-512"}},HS256:{name:"HMAC",hash:{name:"SHA-256"}},HS384:{name:"HMAC",hash:{name:"SHA-384"}},HS512:{name:"HMAC",hash:{name:"SHA-512"}},RS256:{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},RS384:{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-384"}},RS512:{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-512"}}};function decode(h){return JSON.parse(atob(h.split(".")[1]))}async function verify(h,o,c){const d=algorithms[c.algorithm||"RS512"],_=await crypto.subtle.importKey("jwk",o,d,!0,["verify"]),b=h.split("."),_e=new Uint8Array(atob(b[2].replace(/-/g,"+").replace(/_/g,"/").replace(/\s/g,"")).split("").map(nt=>nt.charCodeAt(0))),it=new Uint8Array((b[0]+"."+b[1]).split("").map(nt=>nt.charCodeAt(0)));return await crypto.subtle.verify(d,_,_e,it)}const jwt={decode,verify};class LicenseVerification{constructor(o,c){this.PRODUCT_ID="IJewel3D_WebGi_V0",this.KEY_TYPE_ID="online-v1",this.TOKEN_FILE="0.txt",this.PUBLIC_KEY_FILE="1.json",this.KEY_SERVER="https://license.ijewel3d.com",this.KEY_SERVER_VERIFY="/api/v1/verify",this.KEY_SERVER_CERTS="/api/v1/certs/"+this.KEY_TYPE_ID,this.id="",this.idHash="",this.appVersion="",this.appName="",this._storage={getItem:async d=>localStorage.getItem(d),setItem:async(d,_)=>(localStorage.setItem(d,_),_)},this.silent=!0,this.appVersion=c,this.appName=o}_getOriginId(){const o=getCurrentDomain(window);if(!o||!(o!=null&&o[0]))throw new Error("Failed to get id");return"\\\\"+o.map(c=>btoa(c)).join("\\\\")}_getStorage(){return this._storage}async init(){var o,c;if(this.id=this.id||this._getOriginId(),!this.id)throw new Error("Failed to get machine id");this.idHash=await hash(this.id);const d=this._getStorage(),_=this.idHash+this.TOKEN_FILE;let b=(o=await d.getItem(_))!==null&&o!==void 0?o:await d.setItem(_,"");const _e=this.idHash+this.PUBLIC_KEY_FILE,it=(c=await d.getItem(_e))!==null&&c!==void 0?c:null;let nt=await this.getPublicKey().catch(()=>null);return!nt&&it&&(nt=JSON.parse(it)),nt!==it&&await d.setItem(_e,JSON.stringify(nt)),nt||this._throw(new Error("Failed to get public key")),{token:b,publicKey:nt}}async verify(o,c){var d;try{let _,b=(c=c??await this.init()).token;b&&!await jwt.verify(b,c.publicKey,{algorithm:"RS512",throwError:!1})&&(b=""),b&&(_=jwt.decode(b),((d=_.payload)===null||d===void 0?void 0:d.key)!==o&&(b="")),b&&b.length||(b=await this.setLicenseKey(o)),_=b?jwt.decode(b):void 0;let _e=!1;return _e=_e||b&&await jwt.verify(b,c.publicKey,{algorithm:"RS512",throwError:!1}),_e=_e||!!_&&await this.verifyData(_),_e}catch(_){return this.silent||console.error(_),!1}}async writeToken(o){const c=this.idHash+this.TOKEN_FILE;await this._getStorage().setItem(c,o)}async verifyData(o){var c,d,_;return((c=o.payload)===null||c===void 0?void 0:c.sub)===this.id&&((d=o.payload)===null||d===void 0?void 0:d.app)===this.appName+"_"+this.appVersion&&((_=o.payload)===null||_===void 0?void 0:_.pid)===this.PRODUCT_ID}async _getPublicKeyFromServer(){return fetch(this.KEY_SERVER+this.KEY_SERVER_CERTS).then(o=>o.json()).catch(o=>({status:o==null?void 0:o.status,error:o}))}async _validateKeyFromServer(o){return await fetch(this.KEY_SERVER+this.KEY_SERVER_VERIFY,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({key:o,id:this.id,app:{name:this.appName,version:this.appVersion},pid:this.PRODUCT_ID})}).then(c=>c.json()).catch(c=>({status:c==null?void 0:c.status,error:c}))}_throw(o){if(!this.silent)throw o;return null}async setLicenseKey(o){const c=await this._validateKeyFromServer(o);if(c.error)return this._throw((c.status?c.status+": ":"")+ +c.error);const d=c.token;return d?(await this.writeToken(d),d):this._throw(new Error("Invalid license key, no token"))}async getPublicKey(){const o=await this._getPublicKeyFromServer();return o.error?this._throw(o.error):o.jwk||this._throw(new Error("Invalid public key"))}}async function hash(h){const o=new TextEncoder().encode(h),c=await crypto.subtle.digest("SHA-256",o);return Array.from(new Uint8Array(c)).map(d=>d.toString(16).padStart(2,"0")).join("")}function getCurrentDomain(h){let o,c,d,_,b,_e;const it=function(vt,xt,At){if(vt.length!=xt)return!1;for(let Ct=0;Ct<xt;Ct++)for(let Et=0;Et<At.length;Et+=2)if(Ct==At[Et]&&vt.charCodeAt(Ct)!=At[Et+1])return!1;return!0},nt=function(vt,xt,At){return it(xt,At,vt)},at=function(vt,xt,At){return nt(xt,vt,At)};for(let vt in h)if(it(vt,8,[7,116,5,101,3,117,0,100])){o=vt;break}for(let vt in h)if(it(vt,6,[5,116,0,112,4,110,2,114])){b=vt;break}for(let vt in h[o])if(at(vt,[5,110,0,100],6)){c=vt;break}for(let vt in h[o])if(at(vt,[7,110,0,108],8)){d=vt;break}for(let vt in h[o])if(at(vt,[7,114,0,114],8)){_e=vt;break}if(!("~">c)){for(let vt in h[o][d])if(nt([7,101,0,104],vt,8)){_=vt;break}}if(!o||!h[o])return;const ut=h[b]!==h,pt=h[o][c],mt=!!h[o][d]&&h[o][d][_],ft=ut&&_e?h[o][_e]:pt||mt;return ft?[ft,pt||mt]:void 0}var injectStylesIntoStyleTag=__webpackgi_require__(186),injectStylesIntoStyleTag_default=__webpackgi_require__.n(injectStylesIntoStyleTag),styleDomAPI=__webpackgi_require__(155),styleDomAPI_default=__webpackgi_require__.n(styleDomAPI),setAttributesWithoutAttributes=__webpackgi_require__(626),setAttributesWithoutAttributes_default=__webpackgi_require__.n(setAttributesWithoutAttributes),insertStyleElement=__webpackgi_require__(990),insertStyleElement_default=__webpackgi_require__.n(insertStyleElement),styleTagTransform=__webpackgi_require__(827),styleTagTransform_default=__webpackgi_require__.n(styleTagTransform),loadingScreen=__webpackgi_require__(646),exported={};loadingScreen.A&&loadingScreen.A.locals&&(exported.locals=loadingScreen.A.locals);var refs=0,update,options={};options.styleTagTransform=styleTagTransform_default(),options.setAttributes=setAttributesWithoutAttributes_default(),options.insert=function(h,o){(o.target||document.head).appendChild(h)},options.domAPI=styleDomAPI_default(),options.insertStyleElement=insertStyleElement_default(),exported.use=function(h){return options.options=h||{},refs++||(update=injectStylesIntoStyleTag_default()(loadingScreen.A,options)),exported},exported.unuse=function(){refs>0&&!--refs&&(update(),update=null)};var styles_loadingScreen=exported,spinner1=__webpackgi_require__(611),spinner1_exported={};spinner1.A&&spinner1.A.locals&&(spinner1_exported.locals=spinner1.A.locals);var spinner1_refs=0,spinner1_update,spinner1_options={};spinner1_options.styleTagTransform=styleTagTransform_default(),spinner1_options.setAttributes=setAttributesWithoutAttributes_default(),spinner1_options.insert=function(h,o){(o.target||document.head).appendChild(h)},spinner1_options.domAPI=styleDomAPI_default(),spinner1_options.insertStyleElement=insertStyleElement_default(),spinner1_exported.use=function(h){return spinner1_options.options=h||{},spinner1_refs++||(spinner1_update=injectStylesIntoStyleTag_default()(spinner1.A,spinner1_options)),spinner1_exported},spinner1_exported.unuse=function(){spinner1_refs>0&&!--spinner1_refs&&(spinner1_update(),spinner1_update=null)};var loaders_spinner1=spinner1_exported,AAssetManagerProcessStatePlugin_decorate=function(h,o,c,d){var _,b=arguments.length,_e=b<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_e=Reflect.decorate(h,o,c,d);else for(var it=h.length-1;it>=0;it--)(_=h[it])&&(_e=(b<3?_(_e):b>3?_(o,c,_e):_(o,c))||_e);return b>3&&_e&&Object.defineProperty(o,c,_e),_e};class AAssetManagerProcessStatePlugin extends AViewerPlugin{_onEnabledChange(){this.enabled||(this._mainDiv.style.display="none")}constructor(o,c){super(),this.container=c,this.enabled=!0,this.dependencies=[AssetManagerPlugin],this.processState=new Map,this._mainDiv=ee$1({id:"assetManager"+o,addToBody:!1,innerHTML:""}),this._contentDiv=ee$1({id:"assetManager"+o+"Content",addToBody:!1,innerHTML:""}),this.enabled||(this._mainDiv.style.display="none"),this._mainDiv.appendChild(this._contentDiv)}async onAdded(o){var c,d,_,b,_e,it,nt,at,ut,pt,mt,ft,vt;await super.onAdded(o),((c=this.container)!==null&&c!==void 0?c:o.container).appendChild(this._mainDiv),this._updateMainDiv(this.processState),(_=(d=o.getManager())===null||d===void 0?void 0:d.importer)===null||_===void 0||_.addEventListener("importFile",xt=>{xt.state!=="done"?this.processState.set(xt.path,{state:xt.state,progress:xt.progress?100*xt.progress:void 0}):this.processState.delete(xt.path),this._updateMainDiv(this.processState)}),(_e=(b=o.getManager())===null||b===void 0?void 0:b.importer)===null||_e===void 0||_e.addEventListener("processFileStart",xt=>{this.processState.set(xt.path,{state:"processing",progress:void 0}),this._updateMainDiv(this.processState)}),(nt=(it=o.getManager())===null||it===void 0?void 0:it.importer)===null||nt===void 0||nt.addEventListener("processFileEnd",xt=>{this.processState.delete(xt.path),this._updateMainDiv(this.processState)}),(ut=(at=o.getManager())===null||at===void 0?void 0:at.exporter)===null||ut===void 0||ut.addEventListener("exportFile",xt=>{xt.state!=="done"?this.processState.set(xt.obj.name,{state:xt.state,progress:xt.progress?100*xt.progress:void 0}):this.processState.delete(xt.obj.name),this._updateMainDiv(this.processState)}),(pt=o.getPluginByType("FileTransferPlugin"))===null||pt===void 0||pt.addEventListener("transferFile",xt=>{xt.state!=="done"?this.processState.set(xt.path,{state:xt.state,progress:xt.progress?100*xt.progress:void 0}):this.processState.delete(xt.path),this._updateMainDiv(this.processState)}),(mt=o.getPluginByType("MaterialConfiguratorPlugin"))===null||mt===void 0||mt.addEventListener("progress",xt=>{xt.state!=="done"?this.processState.set("MatpreviewGeneration",{state:xt.state,progress:0}):this.processState.delete("MatpreviewGeneration"),this._updateMainDiv(this.processState)}),(ft=o.getPluginByType("SwitchNodePlugin"))===null||ft===void 0||ft.addEventListener("progress",xt=>{xt.state!=="done"?this.processState.set("SwitchNodeGeneration",{state:xt.state,progress:0}):this.processState.delete("SwitchNodeGeneration"),this._updateMainDiv(this.processState)}),(vt=o.getPluginByType("ThemePlugin"))===null||vt===void 0||vt.addEventListener("progress",xt=>{xt.state!=="done"?this.processState.set("ThemeInit",{state:xt.state,progress:0}):this.processState.delete("ThemeInit"),this._updateMainDiv(this.processState)})}async onRemove(o){var c;return this._mainDiv.remove(),(c=this._contentDiv)===null||c===void 0||c.remove(),this.processState.clear(),super.onRemove(o)}}AAssetManagerProcessStatePlugin_decorate([uiToggle("Enabled"),x$1(AAssetManagerProcessStatePlugin.prototype._onEnabledChange),serialize()],AAssetManagerProcessStatePlugin.prototype,"enabled",void 0);var LoadingScreenPlugin_decorate=function(h,o,c,d){var _,b=arguments.length,_e=b<3?o:d===null?d=Object.getOwnPropertyDescriptor(o,c):d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_e=Reflect.decorate(h,o,c,d);else for(var it=h.length-1;it>=0;it--)(_=h[it])&&(_e=(b<3?_(_e):b>3?_(o,c,_e):_(o,c))||_e);return b>3&&_e&&Object.defineProperty(o,c,_e),_e},LoadingScreenPlugin_1;let LoadingScreenPlugin=LoadingScreenPlugin_1=class extends AAssetManagerProcessStatePlugin{refresh(){this._updateMainDiv(this._isPreviewing?this._previewState:this.processState,!1)}togglePreview(){this.maximize(),this._isPreviewing=!this._isPreviewing,this.refresh(),this._isPreviewing?this.show():this.hideWithDelay()}constructor(h){super("LoadingScreen",h),this.styles=styles_loadingScreen,this.spinners=[{styles:loaders_spinner1,html:'<span class="loader"></span>'}],this.loader=0,this.loadingTextHeader="Loading Files",this.errorTextHeader="Error Loading Files",this.showFileNames=!0,this.showProcessStates=!0,this.showProgress=!0,this.hideOnOnlyErrors=!0,this.hideOnFilesLoad=!0,this.hideOnSceneObjectLoad=!1,this.minimizeOnSceneObjectLoad=!0,this.showOnFilesLoading=!0,this.showOnSceneEmpty=!0,this.hideDelay=500,this.backgroundOpacity=.5,this.backgroundBlur=24,this.background="#ffffff",this.textColor="#222222",this.logoImage=LoadingScreenPlugin_1.LS_DEFAULT_LOGO,this._isPreviewing=!1,this._previewState=new Map([["file.glb",{state:"downloading",progress:50}],["1_metal_whitegold_polished_0db3fb834b.pmat",{state:"adding"}]]),this.loadingElement=ee$1({classList:["loadingScreenLoadingElement"],addToBody:!1}),this.filesElement=ee$1({classList:["loadingScreenFilesElement"],addToBody:!1}),this.logoElement=ee$1({classList:["loadingScreenLogoElement"],addToBody:!1}),this._isHidden=!1,this._temp=document.createElement("template"),this.isEditor=!1,this._sceneUpdate=o=>{if(!this._viewer||!o.hierarchyChanged)return;const c=this._viewer.scene.modelRoot.children;c.length===0&&this.showOnSceneEmpty&&!this.isEditor&&this.show(),c.length>0?this.hideOnSceneObjectLoad?this.hideWithDelay():this.minimizeOnSceneObjectLoad&&this._viewer.scene.environment&&X$2(this.hideDelay+300).then(()=>this.minimize()):this.minimizeOnSceneObjectLoad&&this.maximize()},this._mainDiv.prepend(this.loadingElement),this._mainDiv.prepend(this.logoElement),this._mainDiv.appendChild(this.filesElement)}get visible(){return!this._isHidden}async hide(){this._isHidden=!0,this._mainDiv.style.opacity="0",await X$2(502),this._isHidden&&(this._mainDiv.style.display="none",this._showMainDiv())}async hideWithDelay(){if(this._isHidden=!0,await X$2(this.hideDelay),this._isHidden)return this.hide()}show(){this._isHidden&&(this._isHidden=!1,this._showMainDiv(),this._mainDiv.style.display="flex")}_showMainDiv(){this._mainDiv.style.opacity="1"}minimize(){this._mainDiv.classList.add("minimizedLoadingScreen"),this.showFileNames||(this.loadingElement.style.display="block")}maximize(){this._mainDiv.classList.remove("minimizedLoadingScreen"),this.loadingElement.style.display=""}_setHTML(h,o){this._temp.innerHTML=o,this._temp.innerHTML.trim()==h.innerHTML.trim()||(h.innerHTML=o)}_updateMainDiv(h,o=!0){if(!this._viewer||!this._contentDiv)return;if(!this.enabled)return void(this._mainDiv.style.display="none");if(this.showFileNames){let d="";h.forEach((_,b)=>{let _e=(b||"").split("/").pop();if(_e&&_e.length>16){const it=_e.split(".").pop();_e=it===_e?_e.slice(0,16):_e.slice(0,-it.length-1).slice(0,16)+"..."+it}d+=(this.showProcessStates?`<span class="loadingScreenProcessState">${_.state}</span>: `:"")+_e+(this.showProgress&&_.progress?" - "+_.progress.toFixed(0)+"%":"")+"<br>"}),this._setHTML(this.filesElement,d)}else this._setHTML(this.filesElement,"");const c=[...h.values()].filter(d=>d.state==="error");c.length>0&&c.length===h.size&&!this.hideOnOnlyErrors?this._setHTML(this._contentDiv,this.errorTextHeader):this._setHTML(this._contentDiv,this.loadingTextHeader),this._setHTML(this.loadingElement,this.spinners[this.loader].html),this._mainDiv.style.setProperty("--b-opacity",this.backgroundOpacity.toString()),this._mainDiv.style.setProperty("--b-background",this.background),this._mainDiv.style.backdropFilter=`blur(${this.backgroundBlur}px)`,this._mainDiv.style.color=this.textColor,this._setHTML(this.logoElement,this.logoImage?`<img class="loadingScreenLogoImage" src="${this.logoImage}"/>`:""),o&&(this.hideOnFilesLoad&&(h.size===0||c.length===h.size&&this.hideOnOnlyErrors)?this.hideDelay?this.hideWithDelay():this.hide():h.size>0&&this.showOnFilesLoading&&(this._viewer.scene.modelRoot.children.length>0&&this.minimizeOnSceneObjectLoad&&this._viewer.scene.environment?this.minimize():this.maximize(),this.show()))}async onAdded(h){var o;this.styles.use({target:(o=this.container)!==null&&o!==void 0?o:h.container}),this.spinners.forEach(c=>{var d;c.styles.use({target:(d=this.container)!==null&&d!==void 0?d:h.container})}),h.scene.addEventListener("sceneUpdate",this._sceneUpdate),await super.onAdded(h)}async onRemove(h){h.scene.removeEventListener("sceneUpdate",this._sceneUpdate),await super.onRemove(h)}};LoadingScreenPlugin.PluginType="LoadingScreenPlugin",LoadingScreenPlugin.LS_DEFAULT_LOGO="https://tiexbrasil.com.br/logo.svg",LoadingScreenPlugin_decorate([uiDropdown("Loader",["Spinner 1"].map((h,o)=>({value:o,label:h}))),serialize()],LoadingScreenPlugin.prototype,"loader",void 0),LoadingScreenPlugin_decorate([uiInput("Loading text header"),x$1(LoadingScreenPlugin.prototype.refresh),serialize()],LoadingScreenPlugin.prototype,"loadingTextHeader",void 0),LoadingScreenPlugin_decorate([uiInput("Error text header"),serialize()],LoadingScreenPlugin.prototype,"errorTextHeader",void 0),LoadingScreenPlugin_decorate([uiToggle("Show file names"),serialize(),x$1(LoadingScreenPlugin.prototype.refresh)],LoadingScreenPlugin.prototype,"showFileNames",void 0),LoadingScreenPlugin_decorate([uiToggle("Show process states"),serialize(),x$1(LoadingScreenPlugin.prototype.refresh)],LoadingScreenPlugin.prototype,"showProcessStates",void 0),LoadingScreenPlugin_decorate([uiToggle("Show progress"),serialize(),x$1(LoadingScreenPlugin.prototype.refresh)],LoadingScreenPlugin.prototype,"showProgress",void 0),LoadingScreenPlugin_decorate([uiToggle("Hide on only errors"),serialize()],LoadingScreenPlugin.prototype,"hideOnOnlyErrors",void 0),LoadingScreenPlugin_decorate([uiToggle("Hide on files load"),serialize()],LoadingScreenPlugin.prototype,"hideOnFilesLoad",void 0),LoadingScreenPlugin_decorate([uiToggle("Hide on scene object load"),serialize()],LoadingScreenPlugin.prototype,"hideOnSceneObjectLoad",void 0),LoadingScreenPlugin_decorate([uiToggle("Minimize on scene object load"),serialize()],LoadingScreenPlugin.prototype,"minimizeOnSceneObjectLoad",void 0),LoadingScreenPlugin_decorate([uiToggle("Show when files start loading"),serialize()],LoadingScreenPlugin.prototype,"showOnFilesLoading",void 0),LoadingScreenPlugin_decorate([uiToggle("Show when scene empty"),serialize()],LoadingScreenPlugin.prototype,"showOnSceneEmpty",void 0),LoadingScreenPlugin_decorate([uiInput("Hide delay (ms)"),serialize()],LoadingScreenPlugin.prototype,"hideDelay",void 0),LoadingScreenPlugin_decorate([uiSlider("Background Opacity",[0,1]),x$1(LoadingScreenPlugin.prototype.refresh),serialize()],LoadingScreenPlugin.prototype,"backgroundOpacity",void 0),LoadingScreenPlugin_decorate([uiSlider("Background Blur",[0,100]),x$1(LoadingScreenPlugin.prototype.refresh),serialize()],LoadingScreenPlugin.prototype,"backgroundBlur",void 0),LoadingScreenPlugin_decorate([uiInput("Background Color"),x$1(LoadingScreenPlugin.prototype.refresh),serialize()],LoadingScreenPlugin.prototype,"background",void 0),LoadingScreenPlugin_decorate([uiInput("Text Color"),x$1(LoadingScreenPlugin.prototype.refresh),serialize()],LoadingScreenPlugin.prototype,"textColor",void 0),LoadingScreenPlugin_decorate([uiInput("Logo Image"),x$1(LoadingScreenPlugin.prototype.refresh),serialize()],LoadingScreenPlugin.prototype,"logoImage",void 0),LoadingScreenPlugin_decorate([uiButton("Toggle preview")],LoadingScreenPlugin.prototype,"togglePreview",null),LoadingScreenPlugin_decorate([uiButton("Minimize")],LoadingScreenPlugin.prototype,"minimize",null),LoadingScreenPlugin_decorate([uiButton("Maximize")],LoadingScreenPlugin.prototype,"maximize",null),LoadingScreenPlugin=LoadingScreenPlugin_1=LoadingScreenPlugin_decorate([uiFolder("Loading Screen")],LoadingScreenPlugin);const APP_NAME="iJewel3dSDK_WebGi",APP_VERSION=ViewerApp.VERSION,logoSvgUrl="https://playground.ijewel3d.com/logo_black.svg",console1={error:h=>setTimeout(()=>console.error(new Error(h)),612)};class BaseIJewel3DKeyPlugin extends AViewerPlugin{setKey(o){this._checking||this._checkPromise||(this._checking=Date.now(),this._checkPromise=this._check(o),this._checkPromise.then(()=>this._checkPromise=void 0))}async _check(o){await new LicenseVerification(APP_NAME,APP_VERSION).verify(o)||(console1.error(this._errMessage),this._logoContainer=this._createContainerLogo())}_createContainerLogo(){const o=document.createElement("div");o.innerHTML=logoSvg,o.style.position="absolute",o.style.padding="1rem",o.style.left="0",o.style.bottom="0",o.style.width="100%",o.style.height="auto",o.style.display="flex",o.style.alignItems="center",o.style.backgroundColor="rgba(0, 0, 0, 0)",o.style.zIndex="9999",o.style.pointerEvents="none";const c=o.children[0];c&&c.style&&(c.style.width="calc(min(20%, 150px))",c.style.height="auto",c.onclick=()=>{window.open("https://ijewel3d.com/","_top")}),this._logoContainer=o;const d=document.getElementById("webgi-logo");return d&&d.remove(),o}constructor(){super(),this._errMessage=`iJewel3D ${APP_NAME} ${APP_VERSION}. FOR EVALUATION PURPOSES ONLY. For more information visit: https://ijewel3d.com/`,this._checking=0,this._licenseInUse=!1,this._autoKey=!0,setInterval(()=>{var o;if(this._checkPromise&&Date.now()-this._checking>15e3&&(console1.error(this._errMessage),this._logoContainer=this._createContainerLogo(),typeof this._checkPromise.cancel=="function"&&this._checkPromise.cancel(),this._checkPromise=void 0),this._logoContainer&&!this._logoContainer.parentElement&&this._viewer&&this._licenseInUse){this._lContainer.appendChild(this._logoContainer);const c=(o=this._viewer)===null||o===void 0?void 0:o.getPlugin(LoadingScreenPlugin);c&&(c.logoImage=logoSvgUrl,LoadingScreenPlugin.LS_DEFAULT_LOGO=logoSvgUrl)}},5e3)}get _lContainer(){var o;const c=(o=this._viewer)===null||o===void 0?void 0:o.container;if(!c)return document.body;const d=window.getComputedStyle(c).position;return d!=="absolute"&&d!=="relative"&&d!=="fixed"?document.body:c}use(){var o;if(!this._licenseInUse&&(this._licenseInUse=!0,!this._checking))if(this._autoKey)this.setKey("auto");else{console1.error(this._errMessage),this._logoContainer=this._createContainerLogo(),this._lContainer.appendChild(this._logoContainer);const c=(o=this._viewer)===null||o===void 0?void 0:o.getPlugin(LoadingScreenPlugin);c&&(LoadingScreenPlugin.LS_DEFAULT_LOGO=logoSvgUrl,c.logoImage=logoSvgUrl)}}unuse(){}async onAdded(o){await super.onAdded(o)}}const logoSvg=`
`;var diamondPlugin_decorate=function(h,o,c,d){var _,b=arguments.length,_e=b<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_e=Reflect.decorate(h,o,c,d);else for(var it=h.length-1;it>=0;it--)(_=h[it])&&(_e=(b<3?_(_e):b>3?_(o,c,_e):_(o,c))||_e);return b>3&&_e&&Object.defineProperty(o,c,_e),_e};class DiamondPlugin extends BaseIJewel3DKeyPlugin{get envMapRotation(){var o,c;return(c=(o=this.envMap)===null||o===void 0?void 0:o.rotation)!==null&&c!==void 0?c:0}set envMapRotation(o){var c;const d=[this.envMap,this.envMap2,this.envMap3];for(const _ of d)_&&(_.rotation=o,(c=this._viewer)===null||c===void 0||c.scene.setDirty())}refreshEnvMaps(){var o,c,d;if(!this._viewer)return;const _=this.getEnvMaps(),b=((c=(o=this._viewer.getPlugin(AssetManagerPlugin))===null||o===void 0?void 0:o.materials)===null||c===void 0?void 0:c.getMaterialsOfType(DiamondMaterial.TypeSlug))||[];for(const _e of b)_e&&(_e.envMaps=_);(d=this._viewer)===null||d===void 0||d.scene.setDirty()}constructor(){super(),this.offsetCache={},this.enabled=!0,this.envMap=null,this.envMap2=null,this.envMap3=null,this.forceSceneEnvMap=!1,this.getEnvMaps=()=>{var o;if(!this.forceSceneEnvMap&&this.envMap)return[this.envMap,this.envMap2,this.envMap3];const c=((o=this._viewer)===null||o===void 0?void 0:o.scene.environment)||null;return[c,c,c]},this._modelProcessor={forAssetType:"model",processAsync:async(o,c)=>{const d=[];return o.modelObject.traverse(_=>{var b,_e,it,nt;const at=(_e=(b=_.userData)===null||b===void 0?void 0:b.gltfExtensions)===null||_e===void 0?void 0:_e[DiamondPlugin.DIAMOND_GLTF_EXTENSION];at&&_.geometry&&(this.prepareDiamondMesh(_,at),delete _.userData.gltfExtensions[DiamondPlugin.DIAMOND_GLTF_EXTENSION]),_.material&&!d.includes(_.material)&&!((nt=(it=_.material.userData)===null||it===void 0?void 0:it.gltfExtensions)===null||nt===void 0)&&nt[DiamondPlugin.DIAMOND_GLTF_EXTENSION]&&(_.material.materialObject||console.warn("WebGi DiamondPlugin: material not processed",_.material),d.push(_.material))}),d.forEach(_=>{const b=_.userData.gltfExtensions[DiamondPlugin.DIAMOND_GLTF_EXTENSION];b&&this._convertToDiamondMaterial(_,b)}),o}},this.uiConfig={type:"folder",label:"Diamonds",children:[{type:"checkbox",label:"Use Scene Environment",property:[this,"forceSceneEnvironment"],limitedUi:!0},{type:"image",label:"Environment",hidden:()=>this.forceSceneEnvMap,property:[this,"envMap"],limitedUi:!0},{type:"slider",bounds:[0,2*Math.PI],hidden:()=>this.forceSceneEnvMap,label:"Env Rotation",property:[this,"envMapRotation"],limitedUi:!0},{type:"image",label:"Environment 2",hidden:()=>this.forceSceneEnvMap,property:[this,"envMap2"]},{type:"image",label:"Environment 3",hidden:()=>this.forceSceneEnvMap,property:[this,"envMap3"]},{type:"button",label:"Make Diamond",hidden:()=>{var o,c,d;const _=(d=(c=(o=this._viewer)===null||o===void 0?void 0:o.getPlugin(PickingPlugin))===null||c===void 0?void 0:c.getSelectedObject())===null||d===void 0?void 0:d.material;return!!Array.isArray(_)||(_==null?void 0:_.typeSlug)!==MeshStandardMaterial2.TypeSlug},value:async()=>{var o,c,d,_,b,_e;const it=(c=(o=this._viewer)===null||o===void 0?void 0:o.getPlugin(PickingPlugin))===null||c===void 0?void 0:c.getSelectedObject();if(!(it!=null&&it.material))return;const nt=await((d=this._viewer)===null||d===void 0?void 0:d.prompt("Cache key: Enter optional cache key unique to the diamond shape.","",!1)),at=(await((_=this._viewer)===null||_===void 0?void 0:_.prompt("Cache size: Enter size of the cache [64-1024]","512",!1))||"512").toLowerCase(),ut=at.endsWith("high")?"high":at.endsWith("low")?"low":"medium";let pt=parseInt(at);isFinite(pt)||(pt=512),pt<64&&(pt=64),((b=it.material.userData)===null||b===void 0?void 0:b.__appliedMeshes.size)>1&&await((_e=this._viewer)===null||_e===void 0?void 0:_e.confirm("Convert all: Apply diamond material to all the meshes with the same material?"))?this.makeDiamond(it.material,{cacheKey:nt||void 0,normalMapRes:pt,normalMapPrecision:ut},{}):this.makeDiamondMesh(it,{cacheKey:nt||void 0,normalMapRes:pt,normalMapPrecision:ut},{}),this.refreshUi()},limitedUi:!0},{type:"button",label:"Make Standard",hidden:()=>{var o,c,d;const _=(d=(c=(o=this._viewer)===null||o===void 0?void 0:o.getPlugin(PickingPlugin))===null||c===void 0?void 0:c.getSelectedObject())===null||d===void 0?void 0:d.material;return!!Array.isArray(_)||(_==null?void 0:_.typeSlug)!==DiamondMaterial.TypeSlug},value:async()=>{var o,c,d,_,b,_e,it,nt;const at=(c=(o=this._viewer)===null||o===void 0?void 0:o.getPlugin(PickingPlugin))===null||c===void 0?void 0:c.getSelectedObject(),ut=at==null?void 0:at.material;if(!ut)return;const pt=ut.userData.__baseMaterial;let mt=(b=(_=(d=this._viewer)===null||d===void 0?void 0:d.getManager())===null||_===void 0?void 0:_.materials)===null||b===void 0?void 0:b.findMaterial(pt);if(mt&&!mt.isDiamondMaterial||(mt=(_e=this._viewer)===null||_e===void 0?void 0:_e.createPhysicalMaterial({color:ut.color})),mt){const ft=ut.userData.__appliedMeshes.size>1&&await((it=this._viewer)===null||it===void 0?void 0:it.confirm("Convert all with this material?"))?Array.from(ut.userData.__appliedMeshes):[at];for(const vt of ft)(nt=vt==null?void 0:vt.setMaterial)===null||nt===void 0||nt.call(vt,mt),this.unprepareDiamondMesh(vt)}this.refreshUi()},limitedUi:!0},{type:"button",label:"Auto Instance Diamonds (dev)",hidden:()=>{var o,c,d,_;const b=(d=(c=(o=this._viewer)===null||o===void 0?void 0:o.getPlugin(PickingPlugin))===null||c===void 0?void 0:c.getSelectedObject())===null||d===void 0?void 0:d.material;return!!Array.isArray(b)||(b==null?void 0:b.typeSlug)!==DiamondMaterial.TypeSlug||((_=b.userData.__appliedMeshes)===null||_===void 0?void 0:_.size)<2},value:async()=>{var o,c;const d=(c=(o=this._viewer)===null||o===void 0?void 0:o.getPlugin(PickingPlugin))===null||c===void 0?void 0:c.getSelectedObject();if(!d)return;const _=d.material;_&&!Array.isArray(_)&&autoGPUInstanceMeshes(_)}},{type:"button",label:"Clear Cache",value:()=>{this.disposeAllCacheMaps()}}]},this.refreshEnvMaps=this.refreshEnvMaps.bind(this),this.refreshUi=this.refreshUi.bind(this)}refreshUi(){var o,c,d;(o=this._viewer)===null||o===void 0||o.setDirty(),(d=(c=this.uiConfig)===null||c===void 0?void 0:c.uiRefresh)===null||d===void 0||d.call(c,"postFrame",!0)}async onAdded(o){var c,d,_,b,_e,it,nt;this._normalCapture=new CubeNormalsCaptureHelper(o.renderer),this.offsetCache={},o.scene.addEventListener("materialChanged",mt=>{var ft,vt,xt,At,Ct;if(!((ft=mt.material)===null||ft===void 0)&&ft.isDiamondMaterial){const Et=mt.material,Tt=mt.mesh||mt.object;if(Tt.geometry&&!(!((vt=this._normalCapture)===null||vt===void 0)&&vt.hasCapturedNormalMap(Tt.geometry))){const Dt=(Ct=(At=(xt=Et==null?void 0:Et.userData)===null||xt===void 0?void 0:xt.gltfExtensions)===null||At===void 0?void 0:At[DiamondPlugin.DIAMOND_GLTF_EXTENSION])!==null&&Ct!==void 0?Ct:{};Dt.cacheKey===void 0&&!Tt.userData._diamondCacheKey&&Et!=null&&Et.name&&(Dt.cacheKey=Et.name),this.prepareDiamondMesh(Tt,Dt)}const kt=this.getEnvMaps();Et.envMaps=kt}}),o.scene.addEventListener("environmentChanged",this.refreshEnvMaps);const at=o.getPlugin(AssetManagerPlugin);(c=at==null?void 0:at.importer)===null||c===void 0||c.processors.add("model",this._modelProcessor),(d=o.getPlugin(PickingPlugin))===null||d===void 0||d.addEventListener("selectedObjectChanged",this.refreshUi);const ut=this.getEnvMaps,pt=new Importer(class extends SimpleJSONLoader{async loadAsync(mt,ft){var vt;const xt=await super.loadAsync(mt,ft);return xt.type===DiamondMaterial.TYPE||xt.isDiamondMaterialParameters?(xt.envMap=ut(),(vt=at==null?void 0:at.materials)===null||vt===void 0?void 0:vt.generateFromTemplate("diamond",xt)):(console.error("Invalid material type for Diamond Material.",xt),null)}},[DiamondMaterial.TypeSlug],!1);return(_=at==null?void 0:at.importer)===null||_===void 0||_.Importers.push(pt),(it=(_e=(b=at==null?void 0:at.exporter)===null||b===void 0?void 0:b.getExporter("gltf","glb"))===null||_e===void 0?void 0:_e.extensions)===null||it===void 0||it.push(diamondMaterialGLTFExportExtension),(nt=at==null?void 0:at.materials)===null||nt===void 0||nt.registerMaterialTemplate({name:"diamond",materialType:DiamondMaterial.TYPE,isDiamondMaterialParameters:!0,generator:(mt,ft)=>{const vt=!(ft!=null&&ft.metadata||!ft.isDiamondMaterialParameters)||(ft==null?void 0:ft.metadata)&&(ft==null?void 0:ft.metadata.version)<=4.5,xt=ft==null?void 0:ft.color;vt&&typeof ft.color=="number"&&(ft.color=new three_module.Q1f().setHex(ft.color,three_module.Zr2).getHex());const At=new DiamondMaterial(mt);return At.envMaps=this.getEnvMaps(),!ft||ft.isMeshStandardMaterial||ft.isMeshPhysicalMaterial||At.copyProps(ft),ft.color=xt,At}}),super.onAdded(o)}async onRemove(o){var c,d,_,b;return(c=this._normalCapture)===null||c===void 0||c.dispose(),this._normalCapture=void 0,this.offsetCache={},(_=(d=o.getPlugin(AssetManagerPlugin))===null||d===void 0?void 0:d.importer)===null||_===void 0||_.processors.remove("model",this._modelProcessor),(b=o.getPlugin(PickingPlugin))===null||b===void 0||b.removeEventListener("selectedObjectChanged",this.refreshUi),super.onRemove(o)}unprepareDiamondMesh(o){var c;o.userData&&(delete o.userData._diamondCacheKey,delete o.userData._diamondNormalMapRes,delete o.userData._diamondNormalMapPrecision,o.geometry&&(this._removeOffsets(o.geometry),(c=this._normalCapture)===null||c===void 0||c.removeNormalMap(o.geometry)))}prepareDiamondMesh(o,{cacheKey:c,normalMapRes:d,normalMapPrecision:_}){var b,_e,it;this.use(),o.userData._diamondCacheKey=c??o.userData._diamondCacheKey,o.userData._diamondNormalMapRes=d??o.userData._diamondNormalMapRes,o.userData._diamondNormalMapPrecision=_??o.userData._diamondNormalMapPrecision,c=c&&c.length>0?c.includes(";"+o.geometry.uuid)?c:c+";"+o.geometry.uuid:o.geometry.uuid,this._computeOffsets(o.geometry,o.geometry.uuid);const nt=(_e=(b=this._normalCapture)===null||b===void 0?void 0:b.captureNormalMap(o.geometry,c,d,_,o))!==null&&_e!==void 0?_e:[void 0,!1],at=(it=this._viewer)===null||it===void 0?void 0:it.getPluginByType("debug");at&&nt&&(at.counters.normalsCapture||(at.counters.normalsCapture=0),at.counters.normalsCapture++,console.log("DEBUG: new normal map captured",at.counters.normalsCapture,c),at.addTexture("normal"+at.counters.normalsCapture,()=>{var ut,pt;return(pt=(ut=o.geometry)===null||ut===void 0?void 0:ut.userData._normalsCaptureMap)===null||pt===void 0?void 0:pt.texture},[40,110*at.counters.normalsCapture-100,200,100],void 0,void 0,"postRender",!0))}makeDiamond(o,c,d){var _,b;Array.from((_=o==null?void 0:o.userData.__appliedMeshes)!==null&&_!==void 0?_:[]).forEach(_e=>{_e!=null&&_e.isMesh&&_e.geometry&&this.prepareDiamondMesh(_e,c)}),this._convertToDiamondMaterial(o,d),(b=this._viewer)===null||b===void 0||b.setDirty()}makeDiamondMesh(o,c,d){if(!o.modelObject.isMesh||!o.geometry||!o.setMaterial)return;this.prepareDiamondMesh(o.modelObject,c);const _=Array.isArray(o.material)?o.material[0]:o.material,b=this._convertToDiamondMaterial(_,d,!1);o.setMaterial(b)}_convertToDiamondMaterial(o,c={isDiamond:!0},d=!0){var _,b,_e,it,nt,at,ut,pt;let mt={...c??{}};mt.isDiamond||mt.isDiamondMaterialParameters?Array.isArray(mt.boostFactors)&&(mt.boostFactors=new three_module.Pq0().fromArray(mt.boostFactors)):mt={isDiamondMaterialParameters:!0},mt.color=(b=(_=mt.color)!==null&&_!==void 0?_:o==null?void 0:o.color)!==null&&b!==void 0?b:new three_module.Q1f(1,1,1),mt.name=(it=(_e=mt.name)!==null&&_e!==void 0?_e:o==null?void 0:o.name)!==null&&it!==void 0?it:"diamond";const ft=(ut=(at=(nt=this._viewer)===null||nt===void 0?void 0:nt.getManager())===null||at===void 0?void 0:at.materials)===null||ut===void 0?void 0:ut.generateFromTemplate("diamond",mt);if(ft&&o&&!o.isDiamondMaterial&&(ft.userData.__baseMaterial=o.uuid),d){const vt=xt=>{var At;return(At=xt.setMaterial)!==null&&At!==void 0?At:Ct=>{xt.material=Ct.materialObject}};Array.from((pt=o==null?void 0:o.userData.__appliedMeshes)!==null&&pt!==void 0?pt:[]).forEach(xt=>{vt(xt)(ft),this.prepareDiamondMesh(xt,c)})}return ft}_computeOffsets(o,c,d=!1){var _;if(o.userData.normalsCaptureOffsets){if(rt("recomputeOffsets")===null)return o.userData.normalsCaptureOffsets;console.warn("WebGi DiamondPlugin: recomputeOffsets",o.userData.normalsCaptureOffsets)}let b;!((_=o.morphAttributes)===null||_===void 0)&&_.position&&(b=o.morphAttributes,o.morphAttributes={}),o.computeBoundingBox();const _e=o.boundingBox.getCenter(new three_module.Pq0).toArray(),it=computeEigenVectors(o).toArray(),nt=new three_module.kn4().fromArray(it).invert(),at=new three_module.Pq0().fromArray(_e).applyMatrix4(nt).toArray(),ut={center:_e,offsetMatrix:it,offsetMatrixInv:nt.toArray(),radius:1,centerOffset:at};return o.userData.normalsCaptureOffsets=ut,b&&(o.morphAttributes=b,o.computeBoundingBox()),rt("recomputeOffsets")!==null&&console.warn("WebGi DiamondPlugin: recomputeOffsets",ut),ut}_removeOffsets(o){delete o.userData.normalsCaptureOffsets}getAllCacheMaps(){var o;const c=new Set;return(o=this._viewer)===null||o===void 0||o.scene.modelObject.traverse(d=>{d.geometry&&d.geometry.userData._normalsCaptureMap&&c.add(d.geometry.userData._normalsCaptureMap)}),[...c]}disposeCacheMap(o){var c;(c=this._normalCapture)===null||c===void 0||c.disposeTarget(o)}disposeAllCacheMaps(){var o;(o=this._normalCapture)===null||o===void 0||o.disposeAllTargets()}}DiamondPlugin.PluginType="Diamond",DiamondPlugin.DIAMOND_GLTF_EXTENSION="WEBGI_materials_diamond",diamondPlugin_decorate([x$1(DiamondPlugin.prototype.refreshEnvMaps),serialize()],DiamondPlugin.prototype,"envMap",void 0),diamondPlugin_decorate([x$1(DiamondPlugin.prototype.refreshEnvMaps),serialize()],DiamondPlugin.prototype,"envMap2",void 0),diamondPlugin_decorate([x$1(DiamondPlugin.prototype.refreshEnvMaps),serialize()],DiamondPlugin.prototype,"envMap3",void 0),diamondPlugin_decorate([x$1(DiamondPlugin.prototype.refreshEnvMaps),serialize()],DiamondPlugin.prototype,"forceSceneEnvMap",void 0);const diamondMaterialGLTFExportExtension=h=>({writeMaterial:(o,c)=>{o.isDiamondMaterial&&(c.extensions=c.extensions||{},c.extensions[DiamondPlugin.DIAMOND_GLTF_EXTENSION]=o.toJSON(),h.extensionsUsed[DiamondPlugin.DIAMOND_GLTF_EXTENSION]=!0)},writeMesh:(o,c)=>{var d,_;if(!(o!=null&&o.material.isDiamondMaterial))return;c.extensions=c.extensions||{};const b={};(_=(d=o.userData)===null||d===void 0?void 0:d.gltfExtensions)===null||_===void 0||delete _[DiamondPlugin.DIAMOND_GLTF_EXTENSION],o.userData._diamondNormalMapRes&&(b.normalMapRes=o.userData._diamondNormalMapRes),o.userData._diamondNormalMapPrecision&&(b.normalMapPrecision=o.userData._diamondNormalMapPrecision),o.userData._diamondCacheKey&&(b.cacheKey=o.userData._diamondCacheKey),c.extensions[DiamondPlugin.DIAMOND_GLTF_EXTENSION]=b,h.extensionsUsed[DiamondPlugin.DIAMOND_GLTF_EXTENSION]=!0}});var __assign=function(){return __assign=Object.assign||function(h){for(var o,c=1,d=arguments.length;c<d;c++)for(var _ in o=arguments[c])Object.prototype.hasOwnProperty.call(o,_)&&(h[_]=o[_]);return h},__assign.apply(this,arguments)};function __rest(h,o){var c={};for(var d in h)Object.prototype.hasOwnProperty.call(h,d)&&o.indexOf(d)<0&&(c[d]=h[d]);if(h!=null&&typeof Object.getOwnPropertySymbols=="function"){var _=0;for(d=Object.getOwnPropertySymbols(h);_<d.length;_++)o.indexOf(d[_])<0&&Object.prototype.propertyIsEnumerable.call(h,d[_])&&(c[d[_]]=h[d[_]])}return c}function __spreadArray(h,o,c){if(c||arguments.length===2)for(var d,_=0,b=o.length;_<b;_++)!d&&_ in o||(d||(d=Array.prototype.slice.call(o,0,_)),d[_]=o[_]);return h.concat(d||Array.prototype.slice.call(o))}var invariant$1=function(){},clamp$1=function(h,o,c){return Math.min(Math.max(c,h),o)},safeMin$1=.001,minDuration$1=.01,maxDuration$2=10,minDamping$1=.05,maxDamping$1=1;function findSpring$1(h){var o,c,d=h.duration,_=d===void 0?800:d,b=h.bounce,_e=b===void 0?.25:b,it=h.velocity,nt=it===void 0?0:it,at=h.mass,ut=at===void 0?1:at,pt=1-_e;pt=clamp$1(minDamping$1,maxDamping$1,pt),_=clamp$1(minDuration$1,maxDuration$2,_/1e3),pt<1?(o=function(vt){var xt=vt*pt,At=xt*_,Ct=xt-nt,Et=calcAngularFreq$1(vt,pt),Tt=Math.exp(-At);return safeMin$1-Ct/Et*Tt},c=function(vt){var xt=vt*pt*_,At=xt*nt+nt,Ct=Math.pow(pt,2)*Math.pow(vt,2)*_,Et=Math.exp(-xt),Tt=calcAngularFreq$1(Math.pow(vt,2),pt);return(-o(vt)+safeMin$1>0?-1:1)*((At-Ct)*Et)/Tt}):(o=function(vt){return Math.exp(-vt*_)*((vt-nt)*_+1)-safeMin$1},c=function(vt){return Math.exp(-vt*_)*(_*_*(nt-vt))});var mt=approximateRoot$1(o,c,5/_);if(_*=1e3,isNaN(mt))return{stiffness:100,damping:10,duration:_};var ft=Math.pow(mt,2)*ut;return{stiffness:ft,damping:2*pt*Math.sqrt(ut*ft),duration:_}}var rootIterations$1=12;function approximateRoot$1(h,o,c){for(var d=c,_=1;_<rootIterations$1;_++)d-=h(d)/o(d);return d}function calcAngularFreq$1(h,o){return h*Math.sqrt(1-o*o)}var durationKeys$1=["duration","bounce"],physicsKeys$1=["stiffness","damping","mass"];function isSpringType$1(h,o){return o.some(function(c){return h[c]!==void 0})}function getSpringOptions$1(h){var o=__assign({velocity:0,stiffness:100,damping:10,mass:1,isResolvedFromDuration:!1},h);if(!isSpringType$1(h,physicsKeys$1)&&isSpringType$1(h,durationKeys$1)){var c=findSpring$1(h);(o=__assign(__assign(__assign({},o),c),{velocity:0,mass:1})).isResolvedFromDuration=!0}return o}function spring$1(h){var o=h.from,c=o===void 0?0:o,d=h.to,_=d===void 0?1:d,b=h.restSpeed,_e=b===void 0?2:b,it=h.restDelta,nt=__rest(h,["from","to","restSpeed","restDelta"]),at={done:!1,value:c},ut=getSpringOptions$1(nt),pt=ut.stiffness,mt=ut.damping,ft=ut.mass,vt=ut.velocity,xt=ut.duration,At=ut.isResolvedFromDuration,Ct=zero,Et=zero;function Tt(){var kt=vt?-vt/1e3:0,Dt=_-c,zt=mt/(2*Math.sqrt(pt*ft)),Bt=Math.sqrt(pt/ft)/1e3;if(it!=null||(it=Math.abs(_-c)<=1?.01:.4),zt<1){var Rt=calcAngularFreq$1(Bt,zt);Ct=function(Ht){var Jt=Math.exp(-zt*Bt*Ht);return _-Jt*((kt+zt*Bt*Dt)/Rt*Math.sin(Rt*Ht)+Dt*Math.cos(Rt*Ht))},Et=function(Ht){var Jt=Math.exp(-zt*Bt*Ht);return zt*Bt*Jt*(Math.sin(Rt*Ht)*(kt+zt*Bt*Dt)/Rt+Dt*Math.cos(Rt*Ht))-Jt*(Math.cos(Rt*Ht)*(kt+zt*Bt*Dt)-Rt*Dt*Math.sin(Rt*Ht))}}else if(zt===1)Ct=function(Ht){return _-Math.exp(-Bt*Ht)*(Dt+(kt+Bt*Dt)*Ht)};else{var Ut=Bt*Math.sqrt(zt*zt-1);Ct=function(Ht){var Jt=Math.exp(-zt*Bt*Ht),Kt=Math.min(Ut*Ht,300);return _-Jt*((kt+zt*Bt*Dt)*Math.sinh(Kt)+Ut*Dt*Math.cosh(Kt))/Ut}}}return Tt(),{next:function(kt){var Dt=Ct(kt);if(At)at.done=kt>=xt;else{var zt=1e3*Et(kt),Bt=Math.abs(zt)<=_e,Rt=Math.abs(_-Dt)<=it;at.done=Bt&&Rt}return at.value=at.done?_:Dt,at},flipTarget:function(){var kt;vt=-vt,c=(kt=[_,c])[0],_=kt[1],Tt()}}}spring$1.needsInterpolation=function(h,o){return typeof h=="string"||typeof o=="string"};var zero=function(h){return 0},progress$1=function(h,o,c){var d=o-h;return d===0?1:(c-h)/d},mix$1=function(h,o,c){return-c*h+c*o+h},utils_clamp=function(h,o){return function(c){return Math.max(Math.min(c,o),h)}},sanitize$1=function(h){return h%1?Number(h.toFixed(5)):h},floatRegex$1=/(-)?([\d]*\.?[\d])+/g,colorRegex$1=/(#[0-9a-f]{6}|#[0-9a-f]{3}|#(?:[0-9a-f]{2}){2,4}|(rgb|hsl)a?\((-?[\d\.]+%?[,\s]+){2,3}\s*\/*\s*[\d\.]+%?\))/gi,singleColorRegex$1=/^(#[0-9a-f]{3}|#(?:[0-9a-f]{2}){2,4}|(rgb|hsl)a?\((-?[\d\.]+%?[,\s]+){2,3}\s*\/*\s*[\d\.]+%?\))$/i;function isString$1(h){return typeof h=="string"}var number$1={test:function(h){return typeof h=="number"},parse:parseFloat,transform:function(h){return h}},alpha$1=__assign(__assign({},number$1),{transform:utils_clamp(0,1)});__assign(__assign({},number$1),{default:1});var isColorString$1=function(h,o){return function(c){return!!(isString$1(c)&&singleColorRegex$1.test(c)&&c.startsWith(h)||o&&Object.prototype.hasOwnProperty.call(c,o))}},splitColor$1=function(h,o,c){return function(d){var _;if(!isString$1(d))return d;var b=d.match(floatRegex$1),_e=b[0],it=b[1],nt=b[2],at=b[3];return(_={})[h]=parseFloat(_e),_[o]=parseFloat(it),_[c]=parseFloat(nt),_.alpha=at!==void 0?parseFloat(at):1,_}},clampRgbUnit$1=utils_clamp(0,255),rgbUnit$1=__assign(__assign({},number$1),{transform:function(h){return Math.round(clampRgbUnit$1(h))}}),rgba$1={test:isColorString$1("rgb","red"),parse:splitColor$1("red","green","blue"),transform:function(h){var o=h.red,c=h.green,d=h.blue,_=h.alpha,b=_===void 0?1:_;return"rgba("+rgbUnit$1.transform(o)+", "+rgbUnit$1.transform(c)+", "+rgbUnit$1.transform(d)+", "+sanitize$1(alpha$1.transform(b))+")"}};function parseHex$1(h){var o="",c="",d="",_="";return h.length>5?(o=h.substr(1,2),c=h.substr(3,2),d=h.substr(5,2),_=h.substr(7,2)):(o=h.substr(1,1),c=h.substr(2,1),d=h.substr(3,1),_=h.substr(4,1),o+=o,c+=c,d+=d,_+=_),{red:parseInt(o,16),green:parseInt(c,16),blue:parseInt(d,16),alpha:_?parseInt(_,16)/255:1}}var hex$1={test:isColorString$1("#"),parse:parseHex$1,transform:rgba$1.transform},createUnitType$1=function(h){return{test:function(o){return isString$1(o)&&o.endsWith(h)&&o.split(" ").length===1},parse:parseFloat,transform:function(o){return""+o+h}}},percent$1=createUnitType$1("%");__assign(__assign({},percent$1),{parse:function(h){return percent$1.parse(h)/100},transform:function(h){return percent$1.transform(100*h)}});var hsla$1={test:isColorString$1("hsl","hue"),parse:splitColor$1("hue","saturation","lightness"),transform:function(h){var o=h.hue,c=h.saturation,d=h.lightness,_=h.alpha,b=_===void 0?1:_;return"hsla("+Math.round(o)+", "+percent$1.transform(sanitize$1(c))+", "+percent$1.transform(sanitize$1(d))+", "+sanitize$1(alpha$1.transform(b))+")"}},mixLinearColor$1=function(h,o,c){var d=h*h,_=o*o;return Math.sqrt(Math.max(0,c*(_-d)+d))},colorTypes$1=[hex$1,rgba$1,hsla$1],getColorType$1=function(h){return colorTypes$1.find(function(o){return o.test(h)})},mixColor$1=function(h,o){var c=getColorType$1(h),d=getColorType$1(o);if(invariant$1(c.transform===d.transform),!c||!d||c.transform!==d.transform)return function(nt){return""+(nt>0?o:h)};var _=c.parse(h),b=d.parse(o),_e=__assign({},_),it=c===hsla$1?mix$1:mixLinearColor$1;return function(nt){for(var at in _e)at!=="alpha"&&(_e[at]=it(_[at],b[at],nt));return _e.alpha=mix$1(_.alpha,b.alpha,nt),c.transform(_e)}},color$1={test:function(h){return rgba$1.test(h)||hex$1.test(h)||hsla$1.test(h)},parse:function(h){return rgba$1.test(h)?rgba$1.parse(h):hsla$1.test(h)?hsla$1.parse(h):hex$1.parse(h)},transform:function(h){return isString$1(h)?h:h.hasOwnProperty("red")?rgba$1.transform(h):hsla$1.transform(h)}},colorToken="${c}",numberToken="${n}";function test$1(h){var o,c,d,_;return isNaN(h)&&isString$1(h)&&((c=(o=h.match(floatRegex$1))===null||o===void 0?void 0:o.length)!==null&&c!==void 0?c:0)+((_=(d=h.match(colorRegex$1))===null||d===void 0?void 0:d.length)!==null&&_!==void 0?_:0)>0}function analyse(h){typeof h=="number"&&(h=""+h);var o=[],c=0,d=h.match(colorRegex$1);d&&(c=d.length,h=h.replace(colorRegex$1,colorToken),o.push.apply(o,d.map(color$1.parse)));var _=h.match(floatRegex$1);return _&&(h=h.replace(floatRegex$1,numberToken),o.push.apply(o,_.map(number$1.parse))),{values:o,numColors:c,tokenised:h}}function parse(h){return analyse(h).values}function createTransformer$1(h){var o=analyse(h),c=o.values,d=o.numColors,_=o.tokenised,b=c.length;return function(_e){for(var it=_,nt=0;nt<b;nt++)it=it.replace(nt<d?colorToken:numberToken,nt<d?color$1.transform(_e[nt]):sanitize$1(_e[nt]));return it}}var convertNumbersToZero$1=function(h){return typeof h=="number"?0:h};function getAnimatableNone$2(h){var o=parse(h);return createTransformer$1(h)(o.map(convertNumbersToZero$1))}var complex$1={test:test$1,parse,createTransformer:createTransformer$1,getAnimatableNone:getAnimatableNone$2},zeroPoint={x:0,y:0,z:0},isNum=function(h){return typeof h=="number"},combineFunctions$1=function(h,o){return function(c){return o(h(c))}},pipe$1=function(){for(var h=[],o=0;o<arguments.length;o++)h[o]=arguments[o];return h.reduce(combineFunctions$1)};function getMixer$2(h,o){return isNum(h)?function(c){return mix$1(h,o,c)}:color$1.test(h)?mixColor$1(h,o):mixComplex$1(h,o)}var mixArray$1=function(h,o){var c=__spreadArray([],h),d=c.length,_=h.map(function(b,_e){return getMixer$2(b,o[_e])});return function(b){for(var _e=0;_e<d;_e++)c[_e]=_[_e](b);return c}},mixObject$1=function(h,o){var c=__assign(__assign({},h),o),d={};for(var _ in c)h[_]!==void 0&&o[_]!==void 0&&(d[_]=getMixer$2(h[_],o[_]));return function(b){for(var _e in d)c[_e]=d[_e](b);return c}};function mix_complex_analyse(h){for(var o=complex$1.parse(h),c=o.length,d=0,_=0,b=0,_e=0;_e<c;_e++)d||typeof o[_e]=="number"?d++:o[_e].hue!==void 0?b++:_++;return{parsed:o,numNumbers:d,numRGB:_,numHSL:b}}var mixComplex$1=function(h,o){var c=complex$1.createTransformer(o),d=mix_complex_analyse(h),_=mix_complex_analyse(o);return d.numHSL===_.numHSL&&d.numRGB===_.numRGB&&d.numNumbers>=_.numNumbers?pipe$1(mixArray$1(d.parsed,_.parsed),c):function(b){return""+(b>0?o:h)}},mixNumber$2=function(h,o){return function(c){return mix$1(h,o,c)}};function detectMixerFactory(h){return typeof h=="number"?mixNumber$2:typeof h=="string"?color$1.test(h)?mixColor$1:mixComplex$1:Array.isArray(h)?mixArray$1:typeof h=="object"?mixObject$1:void 0}function createMixers$1(h,o,c){for(var d=[],_=c||detectMixerFactory(h[0]),b=h.length-1,_e=0;_e<b;_e++){var it=_(h[_e],h[_e+1]);if(o){var nt=Array.isArray(o)?o[_e]:o;it=pipe$1(nt,it)}d.push(it)}return d}function fastInterpolate(h,o){var c=h[0],d=h[1],_=o[0];return function(b){return _(progress$1(c,d,b))}}function slowInterpolate(h,o){var c=h.length,d=c-1;return function(_){var b=0,_e=!1;if(_<=h[0]?_e=!0:_>=h[d]&&(b=d-1,_e=!0),!_e){for(var it=1;it<c&&!(h[it]>_||it===d);it++);b=it-1}var nt=progress$1(h[b],h[b+1],_);return o[b](nt)}}function interpolate$1(h,o,c){var d=c===void 0?{}:c,_=d.clamp,b=_===void 0||_,_e=d.ease,it=d.mixer,nt=h.length;invariant$1(nt===o.length),invariant$1(!_e||!Array.isArray(_e)||_e.length===nt-1),h[0]>h[nt-1]&&(h=[].concat(h),o=[].concat(o),h.reverse(),o.reverse());var at=createMixers$1(o,_e,it),ut=nt===2?fastInterpolate(h,at):slowInterpolate(h,at);return b?function(pt){return ut(clamp$1(h[0],h[nt-1],pt))}:ut}var reverseEasing$1=function(h){return function(o){return 1-h(1-o)}},mirrorEasing$1=function(h){return function(o){return o<=.5?h(2*o)/2:(2-h(2*(1-o)))/2}},createExpoIn=function(h){return function(o){return Math.pow(o,h)}},createBackIn=function(h){return function(o){return o*o*((h+1)*o-h)}},createAnticipate=function(h){var o=createBackIn(h);return function(c){return(c*=2)<1?.5*o(c):.5*(2-Math.pow(2,-10*(c-1)))}},DEFAULT_OVERSHOOT_STRENGTH=1.525,BOUNCE_FIRST_THRESHOLD=4/11,BOUNCE_SECOND_THRESHOLD=8/11,BOUNCE_THIRD_THRESHOLD=.9,linear=function(h){return h},easeIn$1=createExpoIn(2),easeOut$1=reverseEasing$1(easeIn$1),easeInOut$1=mirrorEasing$1(easeIn$1),circIn$1=function(h){return 1-Math.sin(Math.acos(h))},circOut$1=reverseEasing$1(circIn$1),circInOut$1=mirrorEasing$1(circOut$1),backIn$1=createBackIn(DEFAULT_OVERSHOOT_STRENGTH),backOut$1=reverseEasing$1(backIn$1),backInOut$1=mirrorEasing$1(backIn$1),anticipate$1=createAnticipate(DEFAULT_OVERSHOOT_STRENGTH),ca$1=4356/361,cb$1=35442/1805,cc$1=16061/1805,bounceOut=function(h){if(h===1||h===0)return h;var o=h*h;return h<BOUNCE_FIRST_THRESHOLD?7.5625*o:h<BOUNCE_SECOND_THRESHOLD?9.075*o-9.9*h+3.4:h<BOUNCE_THIRD_THRESHOLD?ca$1*o-cb$1*h+cc$1:10.8*h*h-20.52*h+10.72},bounceIn=reverseEasing$1(bounceOut),bounceInOut=function(h){return h<.5?.5*(1-bounceOut(1-2*h)):.5*bounceOut(2*h-1)+.5};function defaultEasing$1(h,o){return h.map(function(){return o||easeInOut$1}).splice(0,h.length-1)}function defaultOffset$1(h){var o=h.length;return h.map(function(c,d){return d!==0?d/(o-1):0})}function convertOffsetToTimes$1(h,o){return h.map(function(c){return c*o})}function keyframes$1(h){var o=h.from,c=o===void 0?0:o,d=h.to,_=d===void 0?1:d,b=h.ease,_e=h.offset,it=h.duration,nt=it===void 0?300:it,at={done:!1,value:c},ut=Array.isArray(_)?_:[c,_],pt=convertOffsetToTimes$1(_e&&_e.length===ut.length?_e:defaultOffset$1(ut),nt);function mt(){return interpolate$1(pt,ut,{ease:Array.isArray(b)?b:defaultEasing$1(ut,b)})}var ft=mt();return{next:function(vt){return at.value=ft(vt),at.done=vt>=nt,at},flipTarget:function(){ut.reverse(),ft=mt()}}}function decay(h){var o=h.velocity,c=o===void 0?0:o,d=h.from,_=d===void 0?0:d,b=h.power,_e=b===void 0?.8:b,it=h.timeConstant,nt=it===void 0?350:it,at=h.restDelta,ut=at===void 0?.5:at,pt=h.modifyTarget,mt={done:!1,value:_},ft=_e*c,vt=_+ft,xt=pt===void 0?vt:pt(vt);return xt!==vt&&(ft=xt-_),{next:function(At){var Ct=-ft*Math.exp(-At/nt);return mt.done=!(Ct>ut||Ct<-ut),mt.value=mt.done?xt:xt+Ct,mt},flipTarget:function(){}}}var types={keyframes:keyframes$1,spring:spring$1,decay};function detectAnimationFromOptions(h){if(Array.isArray(h.to))return keyframes$1;if(types[h.type])return types[h.type];var o=new Set(Object.keys(h));return o.has("ease")||o.has("duration")&&!o.has("dampingRatio")?keyframes$1:o.has("dampingRatio")||o.has("stiffness")||o.has("mass")||o.has("damping")||o.has("restSpeed")||o.has("restDelta")?spring$1:keyframes$1}var defaultTimestep=1/60*1e3,getCurrentTime=typeof performance<"u"?function(){return performance.now()}:function(){return Date.now()},onNextFrame=typeof window<"u"?function(h){return window.requestAnimationFrame(h)}:function(h){return setTimeout(function(){return h(getCurrentTime())},defaultTimestep)};function createRenderStep$1(h){var o=[],c=[],d=0,_=!1,b=new WeakSet,_e={schedule:function(it,nt,at){nt===void 0&&(nt=!1),at===void 0&&(at=!1);var ut=at&&_,pt=ut?o:c;return nt&&b.add(it),pt.indexOf(it)===-1&&(pt.push(it),ut&&_&&(d=o.length)),it},cancel:function(it){var nt=c.indexOf(it);nt!==-1&&c.splice(nt,1),b.delete(it)},process:function(it){var nt;if(_=!0,o=(nt=[c,o])[0],(c=nt[1]).length=0,d=o.length)for(var at=0;at<d;at++){var ut=o[at];ut(it),b.has(ut)&&(_e.schedule(ut),h())}_=!1}};return _e}var maxElapsed$1=40,useDefaultElapsed=!0,runNextFrame=!1,isProcessing=!1,es_frame={delta:0,timestamp:0},stepsOrder$1=["read","update","preRender","render","postRender"],steps$1=stepsOrder$1.reduce(function(h,o){return h[o]=createRenderStep$1(function(){return runNextFrame=!0}),h},{}),sync=stepsOrder$1.reduce(function(h,o){var c=steps$1[o];return h[o]=function(d,_,b){return _===void 0&&(_=!1),b===void 0&&(b=!1),runNextFrame||startLoop(),c.schedule(d,_,b)},h},{}),cancelSync=stepsOrder$1.reduce(function(h,o){return h[o]=steps$1[o].cancel,h},{});stepsOrder$1.reduce(function(h,o){return h[o]=function(){return steps$1[o].process(es_frame)},h},{});var processStep=function(h){return steps$1[h].process(es_frame)},processFrame=function(h){runNextFrame=!1,es_frame.delta=useDefaultElapsed?defaultTimestep:Math.max(Math.min(h-es_frame.timestamp,maxElapsed$1),1),es_frame.timestamp=h,isProcessing=!0,stepsOrder$1.forEach(processStep),isProcessing=!1,runNextFrame&&(useDefaultElapsed=!1,onNextFrame(processFrame))},startLoop=function(){runNextFrame=!0,useDefaultElapsed=!0,isProcessing||onNextFrame(processFrame)},getFrameData=function(){return es_frame},es=sync;function loopElapsed(h,o,c){return c===void 0&&(c=0),h-o-c}function reverseElapsed(h,o,c,d){return c===void 0&&(c=0),d===void 0&&(d=!0),d?loopElapsed(o+-h,o,c):o-(h-o)+c}function hasRepeatDelayElapsed(h,o,c,d){return d?h>=o+c:h<=-c}var framesync=function(h){var o=function(c){var d=c.delta;return h(d)};return{start:function(){return es.update(o,!0)},stop:function(){return cancelSync.update(o)}}};function animate(h){var o,c,d,_,b,_e=h.from,it=h.autoplay,nt=it===void 0||it,at=h.driver,ut=at===void 0?framesync:at,pt=h.elapsed,mt=pt===void 0?0:pt,ft=h.repeat,vt=ft===void 0?0:ft,xt=h.repeatType,At=xt===void 0?"loop":xt,Ct=h.repeatDelay,Et=Ct===void 0?0:Ct,Tt=h.onPlay,kt=h.onStop,Dt=h.onComplete,zt=h.onRepeat,Bt=h.onUpdate,Rt=__rest(h,["from","autoplay","driver","elapsed","repeat","repeatType","repeatDelay","onPlay","onStop","onComplete","onRepeat","onUpdate"]),Ut=Rt.to,Ht=0,Jt=Rt.duration,Kt=!1,sr=!0,ir=detectAnimationFromOptions(Rt);!((c=(o=ir).needsInterpolation)===null||c===void 0)&&c.call(o,_e,Ut)&&(b=interpolate$1([0,100],[_e,Ut],{clamp:!1}),_e=0,Ut=100);var cr=ir(__assign(__assign({},Rt),{from:_e,to:Ut}));return nt&&(Tt==null||Tt(),(d=ut(function(lr){if(sr||(lr=-lr),mt+=lr,!Kt){var hr=cr.next(Math.max(0,mt));_=hr.value,b&&(_=b(_)),Kt=sr?hr.done:mt<=0}Bt==null||Bt(_),Kt&&(Ht===0&&(Jt!=null||(Jt=mt)),Ht<vt?hasRepeatDelayElapsed(mt,Jt,Et,sr)&&(Ht++,At==="reverse"?mt=reverseElapsed(mt,Jt,Et,sr=Ht%2==0):(mt=loopElapsed(mt,Jt,Et),At==="mirror"&&cr.flipTarget()),Kt=!1,zt&&zt()):(d.stop(),Dt&&Dt()))})).start()),{stop:function(){kt==null||kt(),d.stop()}}}const easeInOutSine=h=>-(Math.cos(Math.PI*h)-1)/2,EasingFunctions={linear,easeIn:easeIn$1,easeOut:easeOut$1,easeInOut:easeInOut$1,circIn:circIn$1,circOut:circOut$1,circInOut:circInOut$1,backIn:backIn$1,backOut:backOut$1,backInOut:backInOut$1,anticipate:anticipate$1,bounceOut,bounceIn,bounceInOut,easeInOutSine};function makeSetterFor(h,o,c){const d=h[o],_=()=>{c==null||c()};return d&&d.isColor?b=>{d.set(b),_()}:d&&typeof d.copy=="function"?b=>{d.copy(b),_()}:b=>{h[o]=b,_()}}function isAnimatableType(h){return typeof h!="boolean"}async function animateTarget$1(h,o,c,d,_=!1){o in h||console.error("invalid key",o,h);const b=makeSetterFor(h,o),_e=_||c.from===void 0?h[o]:c.from,it=nt=>{var at;b(nt),(at=c.onUpdate)===null||at===void 0||at.call(c,nt)};if(isAnimatableType(_e))return typeof c.to=="function"&&(c={...c,to:c.to(_e,h)}),animateAsync({...c,from:_e,onUpdate:it},d);{const{duration:nt}=c;return X$2(nt??0).then(()=>it(c.to))}}async function animateAsync(h,o){const c=h.onComplete,d=h.onStop,_=h.onEnd;return h={...h},new Promise((b,_e)=>{h.onComplete=()=>{try{c==null||c()}catch(nt){return _==null||_(),void _e(nt)}_==null||_(),b()},h.onStop=()=>{try{d==null||d()}catch(nt){return _==null||_(),void _e(nt)}_==null||_(),b()};const it=animate(h);o&&o.push(it)})}var InteractionPromptPlugin_decorate=function(h,o,c,d){var _,b=arguments.length,_e=b<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_e=Reflect.decorate(h,o,c,d);else for(var it=h.length-1;it>=0;it--)(_=h[it])&&(_e=(b<3?_(_e):b>3?_(o,c,_e):_(o,c))||_e);return b>3&&_e&&Object.defineProperty(o,c,_e),_e},InteractionPromptPlugin_1;let InteractionPromptPlugin=InteractionPromptPlugin_1=class extends AViewerPlugin{constructor(h=!0){super(),this.animationRunning=!1,this.animationDuration=2e3,this.animationDistance=80,this.animationPauseDuration=6e3,this.rotationDistance=.3,this.yOffset=0,this.autoStart=!0,this.autoStartDelay=3e4,this.autoStop=!0,this.autoStartOnObjectLoad=!0,this.autoStartOnObjectLoadDelay=3e3,this.currentTime=0,this.lastActionTime=1/0,this._xDamper=new k$1(50),this.pointerIcon=`<svg xmlns="http://www.w3.org/2000/svg" style="transform: translate(-50%, -25%);" width="25" height="36">
    <defs>
        <path id="A" d="M.001.232h24.997V36H.001z"></path>
    </defs>
    <g transform="translate(-11 -4)" fill="none" fill-rule="evenodd">
        <path fill-opacity="0" fill="#fff" d="M0 0h44v44H0z"></path>
        <g transform="translate(11 3)">
            <path d="M8.733 11.165c.04-1.108.766-2.027 1.743-2.307a2.54 2.54 0 0 1 .628-.089c.16 0 .314.017.463.044 1.088.2 1.9 1.092 1.9 2.16v8.88h1.26c2.943-1.39 5-4.45 5-8.025a9.01 9.01 0 0 0-1.9-5.56l-.43-.5c-.765-.838-1.683-1.522-2.712-2-1.057-.49-2.226-.77-3.46-.77s-2.4.278-3.46.77c-1.03.478-1.947 1.162-2.71 2l-.43.5a9.01 9.01 0 0 0-1.9 5.56 9.04 9.04 0 0 0 .094 1.305c.03.21.088.41.13.617l.136.624c.083.286.196.56.305.832l.124.333a8.78 8.78 0 0 0 .509.953l.065.122a8.69 8.69 0 0 0 3.521 3.191l1.11.537v-9.178z" fill-opacity=".5" fill="#e4e4e4"></path>
            <path d="M22.94 26.218l-2.76 7.74c-.172.485-.676.8-1.253.8H12.24c-1.606 0-3.092-.68-3.98-1.82-1.592-2.048-3.647-3.822-6.11-5.27-.095-.055-.15-.137-.152-.23-.004-.1.046-.196.193-.297.56-.393 1.234-.6 1.926-.6a3.43 3.43 0 0 1 .691.069l4.922.994V10.972c0-.663.615-1.203 1.37-1.203s1.373.54 1.373 1.203v9.882h2.953c.273 0 .533.073.757.21l6.257 3.874c.027.017.045.042.07.06.41.296.586.77.426 1.22M4.1 16.614c-.024-.04-.042-.083-.065-.122a8.69 8.69 0 0 1-.509-.953c-.048-.107-.08-.223-.124-.333l-.305-.832c-.058-.202-.09-.416-.136-.624l-.13-.617a9.03 9.03 0 0 1-.094-1.305c0-2.107.714-4.04 1.9-5.56l.43-.5c.764-.84 1.682-1.523 2.71-2 1.058-.49 2.226-.77 3.46-.77s2.402.28 3.46.77c1.03.477 1.947 1.16 2.712 2l.428.5a9 9 0 0 1 1.901 5.559c0 3.577-2.056 6.636-5 8.026h-1.26v-8.882c0-1.067-.822-1.96-1.9-2.16-.15-.028-.304-.044-.463-.044-.22 0-.427.037-.628.09-.977.28-1.703 1.198-1.743 2.306v9.178l-1.11-.537C6.18 19.098 4.96 18 4.1 16.614M22.97 24.09l-6.256-3.874c-.102-.063-.218-.098-.33-.144 2.683-1.8 4.354-4.855 4.354-8.243 0-.486-.037-.964-.104-1.43a9.97 9.97 0 0 0-1.57-4.128l-.295-.408-.066-.092a10.05 10.05 0 0 0-.949-1.078c-.342-.334-.708-.643-1.094-.922-1.155-.834-2.492-1.412-3.94-1.65l-.732-.088-.748-.03a9.29 9.29 0 0 0-1.482.119c-1.447.238-2.786.816-3.94 1.65a9.33 9.33 0 0 0-.813.686 9.59 9.59 0 0 0-.845.877l-.385.437-.36.5-.288.468-.418.778-.04.09c-.593 1.28-.93 2.71-.93 4.222 0 3.832 2.182 7.342 5.56 8.938l1.437.68v4.946L5 25.64a4.44 4.44 0 0 0-.888-.086c-.017 0-.034.003-.05.003-.252.004-.503.033-.75.08a5.08 5.08 0 0 0-.237.056c-.193.046-.382.107-.568.18-.075.03-.15.057-.225.1-.25.114-.494.244-.723.405a1.31 1.31 0 0 0-.566 1.122 1.28 1.28 0 0 0 .645 1.051C4 29.925 5.96 31.614 7.473 33.563a5.06 5.06 0 0 0 .434.491c1.086 1.082 2.656 1.713 4.326 1.715h6.697c.748-.001 1.43-.333 1.858-.872.142-.18.256-.38.336-.602l2.757-7.74c.094-.26.13-.53.112-.794s-.088-.52-.203-.76a2.19 2.19 0 0 0-.821-.91" fill-opacity=".6" fill="#000"></path>
            <path d="M22.444 24.94l-6.257-3.874a1.45 1.45 0 0 0-.757-.211h-2.953v-9.88c0-.663-.616-1.203-1.373-1.203s-1.37.54-1.37 1.203v16.643l-4.922-.994a3.44 3.44 0 0 0-.692-.069 3.35 3.35 0 0 0-1.925.598c-.147.102-.198.198-.194.298.004.094.058.176.153.23 2.462 1.448 4.517 3.22 6.11 5.27.887 1.14 2.373 1.82 3.98 1.82h6.686c.577 0 1.08-.326 1.253-.8l2.76-7.74c.16-.448-.017-.923-.426-1.22-.025-.02-.043-.043-.07-.06z" fill="#fff"></path>
            <g transform="translate(0 .769)">
                <mask id="B" fill="#fff">
                    <use xlink:href="#A"></use>
                </mask>
                <path d="M23.993 24.992a1.96 1.96 0 0 1-.111.794l-2.758 7.74c-.08.22-.194.423-.336.602-.427.54-1.11.87-1.857.872h-6.698c-1.67-.002-3.24-.633-4.326-1.715-.154-.154-.3-.318-.434-.49C5.96 30.846 4 29.157 1.646 27.773c-.385-.225-.626-.618-.645-1.05a1.31 1.31 0 0 1 .566-1.122 4.56 4.56 0 0 1 .723-.405l.225-.1a4.3 4.3 0 0 1 .568-.18l.237-.056c.248-.046.5-.075.75-.08.018 0 .034-.003.05-.003.303-.001.597.027.89.086l3.722.752V20.68l-1.436-.68c-3.377-1.596-5.56-5.106-5.56-8.938 0-1.51.336-2.94.93-4.222.015-.03.025-.06.04-.09.127-.267.268-.525.418-.778.093-.16.186-.316.288-.468.063-.095.133-.186.2-.277L3.773 5c.118-.155.26-.29.385-.437.266-.3.544-.604.845-.877a9.33 9.33 0 0 1 .813-.686C6.97 2.167 8.31 1.59 9.757 1.35a9.27 9.27 0 0 1 1.481-.119 8.82 8.82 0 0 1 .748.031c.247.02.49.05.733.088 1.448.238 2.786.816 3.94 1.65.387.28.752.588 1.094.922a9.94 9.94 0 0 1 .949 1.078l.066.092c.102.133.203.268.295.408a9.97 9.97 0 0 1 1.571 4.128c.066.467.103.945.103 1.43 0 3.388-1.67 6.453-4.353 8.243.11.046.227.08.33.144l6.256 3.874c.37.23.645.55.82.9.115.24.185.498.203.76m.697-1.195c-.265-.55-.677-1.007-1.194-1.326l-5.323-3.297c2.255-2.037 3.564-4.97 3.564-8.114 0-2.19-.637-4.304-1.84-6.114-.126-.188-.26-.37-.4-.552-.645-.848-1.402-1.6-2.252-2.204C15.472.91 13.393.232 11.238.232A10.21 10.21 0 0 0 5.23 2.19c-.848.614-1.606 1.356-2.253 2.205-.136.18-.272.363-.398.55C1.374 6.756.737 8.87.737 11.06c0 4.218 2.407 8.08 6.133 9.842l.863.41v3.092l-2.525-.51c-.356-.07-.717-.106-1.076-.106a5.45 5.45 0 0 0-3.14.996c-.653.46-1.022 1.202-.99 1.983a2.28 2.28 0 0 0 1.138 1.872c2.24 1.318 4.106 2.923 5.543 4.772 1.26 1.62 3.333 2.59 5.55 2.592h6.698c1.42-.001 2.68-.86 3.134-2.138l2.76-7.74c.272-.757.224-1.584-.134-2.325" fill-opacity=".05" fill="#000" mask="url(#B)"></path>
            </g>
        </g>
    </g>
</svg>`,this._activeCameraUpdate=o=>{this.isDisabled()||(o.change==="deserialize"&&this.animationRunning?(this.stopAnimation({reset:!1}),this.startAnimation()):this.lastActionTime=g())},this._addSceneObject=()=>{this.autoStartOnObjectLoad&&(this.lastActionTime=g()-this.autoStartDelay+this.autoStartOnObjectLoadDelay)},this.onlyOnOrbitControls=!0,this._orbitWarning=!1,this.startAnimation=()=>{var o;if(this._viewer&&this.cursorEl&&!this.isDisabled())return((o=this._viewer.scene.activeCamera.controls)===null||o===void 0?void 0:o.type)!=="OrbitControls"&&this.onlyOnOrbitControls?(this._orbitWarning||console.warn("WebGi InteractionPromptPlugin requires OrbitControls, to run anyway, set onlyOnOrbitControls to false"),void(this._orbitWarning=!0)):void(this._viewer.scene.modelRoot.children.length!==0&&(this.currentSphericalPosition=new three_module.YHV().setFromVector3(new three_module.Pq0().subVectors(this._viewer.scene.activeCamera.position,this._viewer.scene.activeCamera.target)),this.cursorEl.style.opacity="1",this.currentTime=0,this.animationRunning=!0,this._viewer.scene.activeCamera.setInteractions(!1,InteractionPromptPlugin_1.PluginType)))},this.stopAnimation=({reset:o=!0}={})=>{if(this._viewer&&this.cursorEl)return this.animationRunning=!1,this.cursorEl.style.opacity="0",this.currentSphericalPosition&&o&&(this._viewer.scene.activeCamera.position.setFromSpherical(this.currentSphericalPosition).add(this._viewer.scene.activeCamera.target),this._viewer.scene.activeCamera.positionUpdated(),this.currentSphericalPosition=void 0),this._viewer.scene.activeCamera.setInteractions(!0,InteractionPromptPlugin_1.PluginType),this._viewer.doOnce("postFrame")},this._pointerDown=()=>{this.isDisabled()||(this.autoStop&&this.stopAnimation({reset:!1}),this.lastActionTime=g())},this._x=0,this._preFrame=async o=>{if(!this._viewer||!this.cursorEl||(this.isDisabled()&&this.animationRunning&&this.stopAnimation(),this.isDisabled())||(!this.animationRunning&&this.autoStart&&this.lastActionTime+this.autoStartDelay<g()&&this.startAnimation(),!this.animationRunning))return;if(this.currentTime<=this.animationDuration){this.cursorEl.style.opacity="1";const b=this.currentTime/this.animationDuration;this._x=Math.sin(2*Math.PI*b),(b<.25||b>.75)&&(this._x*=this._x*Math.sign(this._x))}else this.cursorEl.style.opacity="0",this._x=0;if(this.currentTime<=this.animationDuration+50){const b=this.currentSphericalPosition.clone();b.theta+=this._x*this.rotationDistance,this._viewer.scene.activeCamera.position.setFromSpherical(b).add(this._viewer.scene.activeCamera.target),this._viewer.scene.activeCamera.positionUpdated()}const c=this._viewer.container.getBoundingClientRect(),d=c.width/2+-this._x*Math.min(this.animationDistance,c.width/4),_=c.height/2+this.yOffset*c.height/2;this.cursorEl.style.transform=`translate(${Math.floor(d)}px, ${Math.floor(_)}px)`,this.currentTime+=o.deltaTime,this.currentTime>this.animationDuration+this.animationPauseDuration&&(this.currentTime=0)},this._disabledBy=new Set,this.disable=o=>{this._disabledBy.size,this._disabledBy.add(o)},this.enable=o=>{this._disabledBy.size,this._disabledBy.delete(o)},this.isDisabled=()=>this._disabledBy.size>0||!this.enabled,this.enabled=h}async onAdded(h){await super.onAdded(h);{Object.hasOwn(h.plugins,"InteractionPointerPlugin")&&delete h.plugins.InteractionPointerPlugin;const o=this;Object.defineProperty(h.plugins,"InteractionPointerPlugin",{get(){return console.warn("WebGi InteractionPromptPlugin: PluginType renamed from InteractionPointerPlugin to InteractionPromptPlugin. Please update your code/vjson."),o},configurable:!0})}this.lastActionTime=1/0,h.addEventListener("preFrame",this._preFrame),h.container.addEventListener("pointerdown",this._pointerDown,!0),h.container.addEventListener("wheel",this._pointerDown,!0),h.scene.addEventListener("addSceneObject",this._addSceneObject),h.scene.addEventListener("activeCameraUpdate",this._activeCameraUpdate),this._initializeCursor()}async onRemove(h){return this.stopAnimation(),h.removeEventListener("preFrame",this._preFrame),h.container.removeEventListener("pointerdown",this._pointerDown,!0),h.container.removeEventListener("wheel",this._pointerDown,!0),h.scene.removeEventListener("addSceneObject",this._addSceneObject),h.scene.removeEventListener("activeCameraUpdate",this._activeCameraUpdate),this.cursorEl&&this.cursorEl.remove(),super.onRemove(h)}_initializeCursor(){this.cursorEl=document.createElement("div"),this.cursorEl.style.position="absolute",this.cursorEl.style.top="0",this.cursorEl.style.left="0",this.cursorEl.style.width="10px",this.cursorEl.style.height="10px",this.cursorEl.style.opacity="0",this.cursorEl.innerHTML=this.pointerIcon,this._viewer.container.appendChild(this.cursorEl)}};InteractionPromptPlugin.PluginType="InteractionPromptPlugin",InteractionPromptPlugin_decorate([serialize(),uiToggle()],InteractionPromptPlugin.prototype,"enabled",void 0),InteractionPromptPlugin_decorate([serialize(),uiInput()],InteractionPromptPlugin.prototype,"animationDuration",void 0),InteractionPromptPlugin_decorate([serialize(),uiInput()],InteractionPromptPlugin.prototype,"animationDistance",void 0),InteractionPromptPlugin_decorate([serialize(),uiInput()],InteractionPromptPlugin.prototype,"animationPauseDuration",void 0),InteractionPromptPlugin_decorate([serialize(),uiInput()],InteractionPromptPlugin.prototype,"rotationDistance",void 0),InteractionPromptPlugin_decorate([serialize(),uiInput()],InteractionPromptPlugin.prototype,"yOffset",void 0),InteractionPromptPlugin_decorate([serialize(),uiToggle()],InteractionPromptPlugin.prototype,"autoStart",void 0),InteractionPromptPlugin_decorate([serialize(),uiInput()],InteractionPromptPlugin.prototype,"autoStartDelay",void 0),InteractionPromptPlugin_decorate([serialize(),uiToggle()],InteractionPromptPlugin.prototype,"autoStop",void 0),InteractionPromptPlugin_decorate([serialize(),uiToggle()],InteractionPromptPlugin.prototype,"autoStartOnObjectLoad",void 0),InteractionPromptPlugin_decorate([serialize(),uiToggle()],InteractionPromptPlugin.prototype,"autoStartOnObjectLoadDelay",void 0),InteractionPromptPlugin_decorate([uiMonitor()],InteractionPromptPlugin.prototype,"currentTime",void 0),InteractionPromptPlugin_decorate([uiMonitor()],InteractionPromptPlugin.prototype,"lastActionTime",void 0),InteractionPromptPlugin_decorate([serialize()],InteractionPromptPlugin.prototype,"onlyOnOrbitControls",void 0),InteractionPromptPlugin_decorate([uiButton()],InteractionPromptPlugin.prototype,"startAnimation",void 0),InteractionPromptPlugin_decorate([uiButton()],InteractionPromptPlugin.prototype,"stopAnimation",void 0),InteractionPromptPlugin=InteractionPromptPlugin_1=InteractionPromptPlugin_decorate([uiFolder("Interaction Prompt")],InteractionPromptPlugin);var CameraViewPlugin_decorate=function(h,o,c,d){var _,b=arguments.length,_e=b<3?o:d===null?d=Object.getOwnPropertyDescriptor(o,c):d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_e=Reflect.decorate(h,o,c,d);else for(var it=h.length-1;it>=0;it--)(_=h[it])&&(_e=(b<3?_(_e):b>3?_(o,c,_e):_(o,c))||_e);return b>3&&_e&&Object.defineProperty(o,c,_e),_e};let viewId=1,CameraView=class{constructor(h,o,c,d,_=1){this.position=new three_module.Pq0,this.target=new three_module.Pq0,this.quaternion=new three_module.PTz,this.up=new three_module.Pq0,this.duration=1,this.name="Camera View",this.focusView=()=>{},this.deleteView=()=>{},this.updateView=()=>{},this.uiConfig=generateUiFolder(this.name,this),h&&(this.position=h),o&&(this.target=o),c&&(this.up=c),d&&(this.quaternion=d),_!==void 0&&_!==0&&(this.duration=_),this.name="#view"+viewId++}_nameChanged(){var h,o;this.uiConfig&&(this.uiConfig.label=this.name,(o=(h=this.uiConfig).uiRefresh)===null||o===void 0||o.call(h))}};CameraViewPlugin_decorate([serialize(),uiVector()],CameraView.prototype,"position",void 0),CameraViewPlugin_decorate([serialize(),uiVector()],CameraView.prototype,"target",void 0),CameraViewPlugin_decorate([serialize(),uiVector()],CameraView.prototype,"quaternion",void 0),CameraViewPlugin_decorate([serialize(),uiVector()],CameraView.prototype,"up",void 0),CameraViewPlugin_decorate([serialize(),uiInput()],CameraView.prototype,"duration",void 0),CameraViewPlugin_decorate([serialize(),uiInput()],CameraView.prototype,"name",void 0),CameraViewPlugin_decorate([uiButton()],CameraView.prototype,"focusView",void 0),CameraViewPlugin_decorate([uiButton()],CameraView.prototype,"deleteView",void 0),CameraViewPlugin_decorate([uiButton()],CameraView.prototype,"updateView",void 0),CameraView=CameraViewPlugin_decorate([serializable("CameraView")],CameraView);class CameraViewPlugin extends AViewerPlugin{get animationLooping(){return this._animationLooping}get animating(){return this._animating}constructor(){super(),this.enabled=!0,this._cameraViews=[],this.viewLooping=!1,this.viewPauseTime=200,this.animEase="easeInOutSine",this.animDuration=1e3,this.rotationOffset=.25,this.interpolateMode="spherical",this.splineCurve="chordal",this.animateOnScroll=!1,this.seekOnScroll=!1,this._animating=!1,this.dependencies=[],this._scrollAnimationState=0,this.scrollAnimationDamping=.1,this._updaters=[],this._lastFrameTime=0,this._fadeDisabled=!1,this._viewQueue=[],this._animationLooping=!1,this._infiniteLooping=!0,this._driver=o=>({start:()=>this._updaters.push({u:o,time:0}),stop:()=>this._updaters.splice(this._updaters.findIndex(c=>c.u===o),1)}),this.focusNext=(o=!0)=>{if(this._animating||this._cameraViews.length<2)return;let c=this._cameraViews.findIndex(d=>d===this._currentView);c<0&&(c=-1),c+=1,o?c%=this._cameraViews.length:c=Math.min(c,this._cameraViews.length-1),this.focusView(this._cameraViews[c])},this.focusPrevious=(o=!0)=>{if(this._animating||this._cameraViews.length<2||!this._currentView)return;let c=this._cameraViews.findIndex(d=>d===this._currentView);c<0&&(c=0),c-=1,c=o?(c+this._cameraViews.length)%this._cameraViews.length:Math.max(c,0),this.focusView(this._cameraViews[c])},this._popAnimations=[],this.uiConfig={type:"folder",label:"Camera Views",children:[()=>[...this._cameraViews.map(o=>o.uiConfig)],...generateUiConfig(this)]},this.addCurrentView=this.addCurrentView.bind(this),this.animateAllViews=this.animateAllViews.bind(this),this.recordAllViews=this.recordAllViews.bind(this),this.resetToFirstView=this.resetToFirstView.bind(this),this._wheel=this._wheel.bind(this),this._pointerMove=this._pointerMove.bind(this),this._postFrame=this._postFrame.bind(this)}get camViews(){return this._cameraViews}_wheel(o){this.enabled&&(this.seekOnScroll&&!this._animating||Math.abs(o.deltaY)>.001&&(this._scrollAnimationState=-1*Math.sign(o.deltaY)))}_pointerMove(o){var c;if(this.enabled&&!this._animating&&this.seekOnScroll){const d=(c=this._viewer)===null||c===void 0?void 0:c.scene.activeCamera;if(!d)return;const _=new three_module.YHV,b=d.position,_e=d.target,it=new three_module.PTz().setFromUnitVectors(d.cameraObject.up,new three_module.Pq0(0,1,0)),nt=it.clone().invert(),at=b.clone().sub(_e);at.applyQuaternion(it),_.setFromVector3(at),_.theta+=this.rotationOffset*o.movementX/this._viewer.canvas.clientWidth,_.phi+=this.rotationOffset*o.movementY/this._viewer.canvas.clientHeight,_.makeSafe(),at.setFromSpherical(_),at.applyQuaternion(nt),b.copy(_e).add(at),d.positionUpdated(!1),d.targetUpdated()}}async onAdded(o){await super.onAdded(o),o.addEventListener("preFrame",c=>{this.seekOnScroll||this._animating?this._viewer.scene.activeCamera.setInteractions(!1,CameraViewPlugin.PluginType):this._viewer.scene.activeCamera.setInteractions(!0,CameraViewPlugin.PluginType)}),o.addEventListener("postFrame",this._postFrame),window.addEventListener("wheel",this._wheel),window.addEventListener("pointermove",this._pointerMove)}_postFrame(){var o,c;if(!this._viewer)return;if(!this.enabled||!this._animating)return this._lastFrameTime=0,void(this._fadeDisabled&&((o=this._viewer.getPluginByType("FrameFade"))===null||o===void 0||o.enable(CameraViewPlugin.PluginType),this._fadeDisabled=!1));const d=g()/1e3;this._lastFrameTime<1&&(this._lastFrameTime=d-1/60);let _=d-this._lastFrameTime;this._lastFrameTime=d,_*=this.animateOnScroll?this._scrollAnimationState:1;const b=(c=this._viewer.getPluginByType("Progressive"))===null||c===void 0?void 0:c.postFrameConvergedRecordingDelta();if(b&&b>0&&(_=b),b!==0&&(_*=1e3,!(_<=0||(this._updaters.forEach(_e=>{let it=_;_e.time+it<0&&(it=-_e.time),_e.time+=it,Math.abs(it)>.001&&_e.u(it)}),this._scrollAnimationState<.001?this._scrollAnimationState=0:this._scrollAnimationState*=1-this.scrollAnimationDamping,this._fadeDisabled)))){const _e=this._viewer.getPluginByType("FrameFade");_e&&(_e.disable(CameraViewPlugin.PluginType),this._fadeDisabled=!0)}}async onRemove(o){return o.removeEventListener("postFrame",this._postFrame),window.removeEventListener("wheel",this._wheel),window.removeEventListener("pointermove",this._pointerMove),super.onRemove(o)}async _animationLoop(){if(!this._animationLooping){for(this._animationLooping=!0;(this.viewLooping||!this._infiniteLooping)&&this.enabled&&!(this._cameraViews.length<1);){if(this._viewQueue.length===0){if(!this._infiniteLooping)break;this._viewQueue.push(...this._cameraViews)}await this.animateToView(this._viewQueue.shift()),await X$2(2+this.viewPauseTime)}this._animationLooping=!1}}async animateAllViews(){if(this.enabled&&!(this.viewLooping||this._cameraViews.length<2)){for(;this._viewQueue.length>0;)this._viewQueue.pop();this._viewQueue.push(...this._cameraViews),this._viewQueue.push(this._viewQueue.shift()),this._infiniteLooping=!1,await this._animationLoop(),this._infiniteLooping=!0}}async resetToFirstView(o=100){this.enabled&&(this._currentView=void 0,await this.animateToView(this._cameraViews[0],o),await X$2(2))}async recordAllViews(o,c=!0){var d;if(!this.enabled)return;const _=(d=this._viewer)===null||d===void 0?void 0:d.getPluginByType("CanvasRecorder");if(!_||!_.enabled||this._cameraViews.length<1)return;if(_.isRecording())return void console.error("CanvasRecorderPlugin is already recording");let b=!1;return this.viewLooping&&(b=!0,this.viewLooping=!1),await this.resetToFirstView(),new Promise((_e,it)=>{const nt=()=>{_.removeEventListener("start",at),_.removeEventListener("stop",nt),_.removeEventListener("error",ut)},at=async()=>{var pt;nt(),o==null||o(),await this.animateAllViews();const mt=await _.stopRecording();if(b&&(this.viewLooping=!0),c){const ft=await((pt=this._viewer)===null||pt===void 0?void 0:pt.prompt("Canvas Recorder: Save file as","recording.mp4"));ft!==null&&mt&&await this._downloadBlob(mt,ft||"recording.mp4")}_e(mt)},ut=async()=>{nt(),it()};_.addEventListener("start",at),_.addEventListener("stop",nt),_.addEventListener("error",ut),_.startRecording()||console.error("cannot start recording")})}async addCurrentView(){if(!this.enabled)return;const o=this.getCurrentCameraView();this.addView(o)}addView(o){var c,d;this._cameraViews.push(o),(d=(c=this.uiConfig).uiRefresh)===null||d===void 0||d.call(c),this.dispatchEvent({type:"viewAdd",view:o})}getCurrentCameraView(o,c=!0,d){var _,b,_e;if(o||(o=(_=this._viewer)===null||_===void 0?void 0:_.scene.activeCamera),!o)return new CameraView;const it=new three_module.Pq0;o.cameraObject.updateWorldMatrix(!0,!1);const nt=o.cameraObject.matrixWorld;it.x=nt.elements[4],it.y=nt.elements[5],it.z=nt.elements[6],it.normalize();const at=o.target.clone(),ut=o.position.clone(),pt=o.cameraObject.parent;pt&&(c?ut.applyMatrix4(pt.matrixWorld):it.transformDirection(pt.matrixWorld.clone().invert()));const mt=c?o.cameraObject.getWorldQuaternion(new three_module.PTz):o.cameraObject.quaternion.clone();return d?(d.position.copy(ut),d.target.copy(at),d.up.copy(it),d.quaternion.copy(mt)):((d=new CameraView(ut,at,it,mt,1)).focusView=async()=>d&&this.focusView(d),d.deleteView=()=>d&&this.deleteView(d),d.updateView=()=>this.getCurrentCameraView(o,c,d)),(_e=(b=d.uiConfig).uiRefresh)===null||_e===void 0||_e.call(b,"postFrame",!0),d}setCurrentCameraView(o){var c;const d=(c=this._viewer)===null||c===void 0?void 0:c.scene.activeCamera;d&&(d.position.copy(o.position),d.target.copy(o.target),d.cameraObject.quaternion.copy(o.quaternion),d.positionUpdated())}async focusView(o){return this.animateToView(o)}deleteView(o){var c,d;const _=this._cameraViews.indexOf(o);_>=0&&this._cameraViews.splice(_,1),(d=(c=this.uiConfig).uiRefresh)===null||d===void 0||d.call(c),this.dispatchEvent({type:"viewDelete",view:o})}async stopAllAnimations(){for(this.viewLooping=!1,this._popAnimations.forEach(o=>{var c;return(c=o==null?void 0:o.stop)===null||c===void 0?void 0:c.call(o)}),this._popAnimations=[];this._animating||this._animationLooping;)await X$2(100)}async animateToView(o,c,d,_=!1){var b,_e,it;const nt=(b=this._viewer)===null||b===void 0?void 0:b.scene.activeCamera;if(!nt)return;if(this._animating){this._popAnimations.forEach(Ct=>(Ct==null?void 0:Ct.stop)&&Ct.stop()),this._popAnimations=[];let At=0;for(;this._animating&&(await X$2(100),!(At++>20)););if(this._animating)return void console.warn("Unable to stop all animations, maybe because of viewLooping?")}const at=(_e=this._viewer)===null||_e===void 0?void 0:_e.getPlugin(InteractionPromptPlugin);at&&at.animationRunning&&await at.stopAnimation({reset:!0}),this._currentView=o,this._animating=!0,this.dispatchEvent({type:"startViewChange",view:o}),c===void 0&&(c=this.animDuration),c=Math.max(10,c);const ut=typeof d=="function"?d:EasingFunctions[d||this.animEase],pt=this._driver,mt=[];this._popAnimations=[];const ft=this._popAnimations,vt=this.camViews.indexOf(o);let xt=this.interpolateMode;if(vt<0&&xt==="spline"&&(console.warn("CameraViewPlugin - Cannot animate along a spline with external camera view, fallback to spherical"),xt="spherical"),xt==="spherical")mt.push(animateCameraToViewSpherical(nt,o,c*o.duration,ut,pt,ft));else if(xt==="linear"){mt.push(animateAsync({from:nt.position.clone(),to:o.position.clone(),duration:c*o.duration,ease:ut,driver:pt,onUpdate:Et=>nt.position=Et,onComplete:()=>nt.position=o.position,onStop:()=>{throw new Error("Animation stopped")}},ft)),mt.push(animateAsync({from:nt.target.clone(),to:o.target.clone(),duration:c*o.duration,ease:ut,driver:pt,onUpdate:Et=>{nt.target=Et,nt.targetUpdated()},onComplete:()=>{nt.target=o.target,nt.targetUpdated()}},ft));const At=nt.cameraObject.quaternion.clone(),Ct=new three_module.PTz;mt.push(animateAsync({from:0,to:1,duration:c*o.duration,ease:ut,driver:pt,onUpdate:Et=>{Ct.copy(At).slerp(o.quaternion,Et),nt.cameraObject.quaternion.copy(Ct),nt.cameraObject.updateProjectionMatrix()},onComplete:()=>{nt.cameraObject.quaternion.copy(o.quaternion),nt.cameraObject.updateProjectionMatrix()}},ft))}else if(xt==="spline"){const At=this.camViews.map(Tt=>Tt.position.clone()),Ct=new three_module.B6O(At,!0,this.splineCurve,.75),Et=Tt=>{const kt=new three_module.Pq0,Dt=1/At.length,zt=((vt===0?At.length:vt)-1)*Dt;return Ct.getPointAt(zt+Tt*Dt,kt),kt};mt.push(animateAsync({from:0,to:1,duration:c*o.duration,ease:ut,driver:pt,onUpdate:Tt=>nt.position=Et(Tt),onComplete:()=>nt.position=Et(1),onStop:()=>{throw new Error("Animation stopped")}},ft)),mt.push(animateAsync({from:nt.target.clone(),to:o.target.clone(),duration:c*o.duration,ease:ut,driver:pt,onUpdate:Tt=>{nt.target=Tt,nt.targetUpdated()},onComplete:()=>{nt.target=o.target,nt.targetUpdated()}},ft))}await Promise.allSettled(mt).catch(At=>{if(_)throw At}),(it=this._viewer)===null||it===void 0||it.setDirty(),this._animating=!1,this.dispatchEvent({type:"viewChange",view:o}),await X$2(10)}fromJSON(o,c){var d,_;return this._cameraViews.forEach(b=>this.deleteView(b)),super.fromJSON(o,c)?(this._cameraViews.forEach(b=>b.focusView=async()=>this.focusView(b)),this._cameraViews.forEach(b=>b.deleteView=()=>this.deleteView(b)),this._cameraViews.forEach(b=>b.updateView=()=>this.getCurrentCameraView(void 0,void 0,b)),(_=(d=this.uiConfig).uiRefresh)===null||_===void 0||_.call(d),this):null}async animateToObject(o,c=4,d,_,b={min:.5,max:5}){if(!this._viewer)return;const _e=new Box3B().expandByObject(o||this._viewer.scene.modelRoot.modelObject,!1,!0),it=_e.getCenter(new three_module.Pq0),nt=_e.getSize(new three_module.Pq0).length()/2;await this.animateToTarget(Math.min(b.max,Math.max(b.min,nt*c)),it,d,_)}async animateToFitObject(o,c=1.5,d=1e3,_,b={min:.5,max:50}){if(!this._viewer)return;const _e=new Box3B().expandByObject(o||this._viewer.scene.modelRoot.modelObject,!1,!0),it=_e.getCenter(new three_module.Pq0),nt=this._viewer.scene.activeCamera.getFittingDistance(_e);await this.animateToTarget(Math.min(b.max,Math.max(b.min,nt*c)),it,d,_)}async animateToTarget(o,c,d,_){const b=this.getCurrentCameraView();b.target.copy(c);const _e=new three_module.Pq0().subVectors(b.target,b.position).normalize();b.position.copy(_e.multiplyScalar(-o).add(b.target)),await this.animateToView(b,d,_)}async _downloadBlob(o,c){var d,_;const b=(d=this._viewer)===null||d===void 0?void 0:d.getPluginByType("FileTransferPlugin");b?await b.exportFile(o,c):(_=this._viewer)===null||_===void 0||_.console.error("FileTransferPlugin required to export/download file")}}function sphericalFromObject(h,o){const c=h.position.clone();c.sub(o);const d=new three_module.YHV().setFromVector3(c);return d.makeSafe(),d}async function animateCameraToViewSpherical(h,o,c,d,_,b,_e){const it=h.target.clone(),nt=new three_module.Pq0,at=new three_module.Pq0,ut=h.cameraObject.parent,pt=h.cameraObject.up.clone(),mt=sphericalFromObject({position:h.cameraObject.getWorldPosition(new three_module.Pq0),up:ut?pt.transformDirection(ut.matrixWorld):pt},it),ft=sphericalFromObject(o,o.target),vt=new three_module.YHV;function xt(){h.position.copy(ut?ut.worldToLocal(at):at),h.target.copy(nt),h.positionUpdated()}return animateAsync({from:0,to:1,duration:c,ease:d,driver:_,..._e,onUpdate:At=>{vt.phi=lerpAngle(mt.phi,ft.phi,At),vt.theta=lerpAngle(mt.theta,ft.theta,At),vt.radius=three_module.cj9.lerp(mt.radius,ft.radius,At),nt.copy(it).lerp(o.target,At),at.setFromSpherical(vt),at.add(nt),xt()},onComplete:()=>{at.copy(o.position),nt.copy(o.target),xt()},onStop:()=>{throw new Error("Animation Stopped")}},b)}function lerpAngle(h,o,c){const d=o-h;return d>=Math.PI?h+(d-2*Math.PI)*c:d<=-Math.PI?h+(d+2*Math.PI)*c:h+d*c}function lerpAngle2(h,o,c){const d=(1-c)*Math.cos(h)+c*Math.cos(o),_=(1-c)*Math.sin(h)+c*Math.sin(o);return Math.atan2(_,d)}CameraViewPlugin.PluginType="CameraViews",CameraViewPlugin_decorate([serialize("cameraViews")],CameraViewPlugin.prototype,"_cameraViews",void 0),CameraViewPlugin_decorate([x$1(CameraViewPlugin.prototype._animationLoop),serialize(),uiToggle("Loop All Views",{limitedUi:!0})],CameraViewPlugin.prototype,"viewLooping",void 0),CameraViewPlugin_decorate([serialize(),uiInput("View Pause Time")],CameraViewPlugin.prototype,"viewPauseTime",void 0),CameraViewPlugin_decorate([serialize(),uiDropdown("Ease",Object.keys(EasingFunctions).map(h=>({label:h})))],CameraViewPlugin.prototype,"animEase",void 0),CameraViewPlugin_decorate([serialize(),uiSlider("Duration",[10,1e4],10,{limitedUi:!0})],CameraViewPlugin.prototype,"animDuration",void 0),CameraViewPlugin_decorate([serialize(),uiSlider("RotationOffset",[.2,.75],.01)],CameraViewPlugin.prototype,"rotationOffset",void 0),CameraViewPlugin_decorate([serialize(),uiDropdown("Interpolation",["spherical","linear","spline (dev)"].map(h=>({label:h,value:h.split(" ")[0]})))],CameraViewPlugin.prototype,"interpolateMode",void 0),CameraViewPlugin_decorate([serialize(),uiDropdown("Spline Curve",["centripetal","chordal","catmullrom"].map(h=>({label:h})),h=>({hidden:()=>h.interpolateMode!=="spline",onChange:()=>{var o,c;return(c=(o=h.uiConfig)===null||o===void 0?void 0:o.uiRefresh)===null||c===void 0?void 0:c.call(o)}}))],CameraViewPlugin.prototype,"splineCurve",void 0),CameraViewPlugin_decorate([uiToggle(),serialize()],CameraViewPlugin.prototype,"seekOnScroll",void 0),CameraViewPlugin_decorate([uiButton("Animate All Views",{limitedUi:!0})],CameraViewPlugin.prototype,"animateAllViews",null),CameraViewPlugin_decorate([uiButton("Record All Views")],CameraViewPlugin.prototype,"recordAllViews",null),CameraViewPlugin_decorate([uiButton("Add Current View")],CameraViewPlugin.prototype,"addCurrentView",null),CameraViewPlugin_decorate([uiButton("Focus Next")],CameraViewPlugin.prototype,"focusNext",void 0),CameraViewPlugin_decorate([uiButton("Focus Previous")],CameraViewPlugin.prototype,"focusPrevious",void 0);const tempVec=new three_module.Pq0;function slerp(h,o,c){let d=h.dot(o);d=Math.min(Math.max(d,-1),1);const _=Math.acos(d)*c;return tempVec.copy(h).multiplyScalar(d).sub(o).negate().normalize(),h.multiplyScalar(Math.cos(_)).add(tempVec.multiplyScalar(Math.sin(_)))}var vignette="vec4 Vignette(in vec4 color){vec2 uv=vUv*(1.-vUv);float vig=uv.x*uv.y*16.;vig=pow(abs(vig),power);return vec4(mix(color.rgb,vec3(bgcolor),1.-vig),color.a);}",VignettePlugin_decorate=function(h,o,c,d){var _,b=arguments.length,_e=b<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_e=Reflect.decorate(h,o,c,d);else for(var it=h.length-1;it>=0;it--)(_=h[it])&&(_e=(b<3?_(_e):b>3?_(o,c,_e):_(o,c))||_e);return b>3&&_e&&Object.defineProperty(o,c,_e),_e};let VignetteExtension=class{constructor(h){this.enabled=!1,this.power=.5,this.bgcolor=new three_module.Q1f(0),this.extraUniforms={power:{value:.5},bgcolor:{value:new three_module.Q1f}},this.parsFragmentSnippet=(o,c)=>this.enabled?fe$1`
            uniform float power;
            uniform vec3 bgcolor;
            ${vignette}
        `:"",this._combinedPostPlugin=h.getPlugin(CombinedPostPlugin),this._setDirty=this._setDirty.bind(this)}shaderExtender(h,o,c){this.enabled&&(h.fragmentShader=shaderReplaceString(h.fragmentShader,"#glMarker",` 
            gl_FragColor = Vignette(gl_FragColor);
            #glMarker
        `))}onObjectRender(h,o,c){this.enabled&&(this.extraUniforms.power.value=this.power,this.extraUniforms.bgcolor.value.copy(this.bgcolor))}getUiConfig(){return this.uiConfig}computeCacheKey(h){return this.enabled?"1":"0"}isCompatible(h){return!0}_setDirty(){this._combinedPostPlugin&&(this._combinedPostPlugin.pass.dirty=!0)}setDirty(){var h;(h=this.__setDirty)===null||h===void 0||h.call(this),this._setDirty()}};VignetteExtension.PluginType="Vignette",VignettePlugin_decorate([x$1(VignetteExtension.prototype._setDirty),uiToggle("Enable"),serialize()],VignetteExtension.prototype,"enabled",void 0),VignettePlugin_decorate([x$1(VignetteExtension.prototype._setDirty),uiSlider("Power",[.1,4],.01,{limitedUi:!0}),serialize()],VignetteExtension.prototype,"power",void 0),VignettePlugin_decorate([x$1(VignetteExtension.prototype._setDirty),uiColor("Color"),serialize()],VignetteExtension.prototype,"bgcolor",void 0),VignetteExtension=VignettePlugin_decorate([uiFolder("Vignette")],VignetteExtension);class VignettePlugin extends GenericExtensionPlugin{constructor(){super()}generateExtension(o){return new VignetteExtension(o)}get power(){var o,c;return(c=(o=this._extension)===null||o===void 0?void 0:o.power)!==null&&c!==void 0?c:1}set power(o){this._extension&&(this._extension.power=o,this._extension.setDirty())}get color(){var o,c;return(c=(o=this._extension)===null||o===void 0?void 0:o.bgcolor)!==null&&c!==void 0?c:new three_module.Q1f}set color(o){this._extension&&(this._extension.bgcolor.set(o),this._extension.setDirty())}}VignettePlugin.PluginType="Vignette";var ssVelocityVert=`#ifdef USE_ALPHAMAP
#define USE_UV 
#endif
#include <uv_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec3 vWorldPosition;varying vec3 vWorldPositionPrevious;uniform mat4 modelMatrixPrevious;void main(){
#include <uv_vertex>
#include <skinbase_vertex>
#include <begin_vertex>
#include <morphtarget_vertex>
#include <skinning_vertex>
#include <displacementmap_vertex>
vec4 mvPosition=vec4(transformed,1.);
#ifdef USE_INSTANCING
mvPosition=instanceMatrix*mvPosition;
#endif
vWorldPosition=(modelMatrix*mvPosition).xyz;vWorldPositionPrevious=(modelMatrixPrevious*mvPosition).xyz;mvPosition=modelViewMatrix*mvPosition;gl_Position=projectionMatrix*mvPosition;
#include <logdepthbuf_vertex>
#include <clipping_planes_vertex>
}`,ssVelocityFrag="varying vec3 vWorldPosition;varying vec3 vWorldPositionPrevious;uniform mat4 currentProjectionViewMatrix;uniform mat4 lastProjectionViewMatrix;vec2 computeScreenSpaceVelocity2(){vec4 currentPositionClip=currentProjectionViewMatrix*vec4(vWorldPosition,1.);vec4 prevPositionClip=lastProjectionViewMatrix*vec4(vWorldPositionPrevious,1.);vec2 currentPositionNDC=currentPositionClip.xy/currentPositionClip.w;vec2 prevPositionNDC=prevPositionClip.xy/prevPositionClip.w;if(prevPositionNDC.x>=1.||prevPositionNDC.x<=-1.||prevPositionNDC.x>=1.||prevPositionNDC.y<=-1.){return vec2(0.);}return 0.5*(currentPositionNDC-prevPositionNDC);}void main(){vec2 velocity=clamp(computeScreenSpaceVelocity2(),-1.,1.);velocity=sign(velocity)*pow(abs(velocity),vec2(1./4.));velocity=velocity*0.5+0.5;gl_FragColor=vec4(velocity.x,velocity.y,1.,1.);}",SSVelocityPass_decorate=function(h,o,c,d){var _,b=arguments.length,_e=b<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_e=Reflect.decorate(h,o,c,d);else for(var it=h.length-1;it>=0;it--)(_=h[it])&&(_e=(b<3?_(_e):b>3?_(o,c,_e):_(o,c))||_e);return b>3&&_e&&Object.defineProperty(o,c,_e),_e};let SSVelocityPass=class extends RenderPass{constructor(h,o,c){super(h,o,c??new SSVelocityMaterial,new three_module.Q1f(.5,.5,.5),1),this.enabled=!0,this._firstCall=!0}render(h,o,c,d,_){if(!this.enabled||!this.camera)return;const b=this.overrideMaterial;b.uniforms.currentProjectionViewMatrix.value.copy(this.camera.projectionMatrix).multiply(this.camera.matrixWorldInverse),this._firstCall&&(b.uniforms.lastProjectionViewMatrix.value.copy(b.uniforms.currentProjectionViewMatrix.value),this._firstCall=!1),super.render(h,o,c,d,_),b.uniforms.lastProjectionViewMatrix.value.copy(b.uniforms.currentProjectionViewMatrix.value)}};SSVelocityPass_decorate([uiToggle("Enabled")],SSVelocityPass.prototype,"enabled",void 0),SSVelocityPass=SSVelocityPass_decorate([uiFolder("Velocity Buffer (TAA)")],SSVelocityPass);class SSVelocityMaterial extends three_module.BKk{constructor(){super({vertexShader:ssVelocityVert,fragmentShader:ssVelocityFrag,uniforms:{cameraNearFar:{value:new three_module.I9Y(.1,1e3)},alphaMap:{value:null},alphaTest:{value:null},alphaMapTransform:{value:new three_module.dwI},currentProjectionViewMatrix:{value:new three_module.kn4},lastProjectionViewMatrix:{value:new three_module.kn4}}}),this.extraUniformsToUpload={modelMatrixPrevious:{value:new three_module.kn4().identity()}},this._previousWorldMatrices={}}onBeforeRender(o,c,d,_,b){var _e,it;const nt=this._previousWorldMatrices[b.uuid];this.extraUniformsToUpload.modelMatrixPrevious.value.copy(nt??b.matrixWorld),nt?nt.copy(b.matrixWorld):this._previousWorldMatrices[b.uuid]=b.matrixWorld.clone();let at=b.material;Array.isArray(at)&&(at=at[0]),this.uniforms.alphaMap.value=(_e=at==null?void 0:at.alphaMap)!==null&&_e!==void 0?_e:null,this.uniforms.alphaTest.value=!at||!at.alphaTest||at.alphaTest<1e-7?.001:at.alphaTest;let ut=this.uniforms.alphaMap.value?1:void 0;ut!==this.defines.USE_ALPHAMAP&&(ut===void 0?delete this.defines.USE_ALPHAMAP:this.defines.USE_ALPHAMAP=ut,this.needsUpdate=!0),ut=at.userData.ALPHA_I_RGBA_PACKING?1:void 0,ut!==this.defines.ALPHA_I_RGBA_PACKING&&(ut===void 0?delete this.defines.ALPHA_I_RGBA_PACKING:this.defines.ALPHA_I_RGBA_PACKING=ut,this.needsUpdate=!0),this.side=(it=at.side)!==null&&it!==void 0?it:three_module.$EB}}class VelocityBufferPlugin extends GenericFilterPlugin{passCtor(o){const c=o.renderer.createTarget({depthBuffer:!0,type:three_module.OUM});c.texture.name="velocityBuffer",this._velocityBuffers.push(c),o.getPluginByType("debug");const d=new Set,_=new Set;return new class extends SSVelocityPass{render(b,_e,it,nt,at){var ut;if(o.renderer.frameCount>0)return;const pt=b.getRenderTarget(),mt=b.getActiveCubeFace(),ft=b.getActiveMipmapLevel();(ut=this.scene)===null||ut===void 0||ut.traverse(({material:vt})=>{var xt,At;if(!vt)return;const Ct=vt.userData.renderToDepth&&!vt.userData.pluginsDisabled&&!(!((xt=vt.userData[VelocityBufferPlugin.PluginType])===null||xt===void 0)&&xt.disabled),Et=vt.userData.renderToDepth===!1||vt.userData.pluginsDisabled||((At=vt.userData[VelocityBufferPlugin.PluginType])===null||At===void 0?void 0:At.disabled);(vt.transparent&&Ct||!vt.transparent&&!vt.transmission&&Et)&&(d.add(vt),vt.transparent=!vt.transparent),Math.abs(vt.transmission||0)>0&&Ct&&(_.add([vt,vt.transmission]),vt.transmission=0)}),setThreeRendererMode(b,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!0,transparentRender:!1,transmissionRender:!1,mainRenderPass:!1},()=>super.render(b,_e,c,nt,at)),d.forEach(vt=>vt.transparent=!vt.transparent),d.clear(),_.forEach(([vt,xt])=>vt.transmission=xt),_.clear(),b.setRenderTarget(pt,mt,ft)}}}_update(o){if(!super._update(o)||o.renderer.frameCount>0)return!1;const c=this.pass.passObject;return c.scene=o.scene.modelObject,o.scene.renderCamera.updateShaderProperties(c.overrideMaterial),c.camera=o.scene.renderCamera.cameraObject,!0}constructor(o=!0){super(),this.passId="velocityBuffer",this._beforeFilters=["render"],this._afterFilters=[],this._requiredFilters=["render"],this._velocityBuffers=[],this.enabled=o}getVelocityBuffer(){return this._velocityBuffers.length>0?this._velocityBuffers[0]:void 0}async onDispose(o){}async onRemove(o){return this._velocityBuffers.forEach(c=>{var d;return o.renderer.disposeTarget((d=c==null?void 0:c.dispose)===null||d===void 0?void 0:d.call(c))}),super.onRemove(o)}updateShaderProperties(o){var c,d;return o.uniforms.tVelocity?o.uniforms.tVelocity.value=this.enabled&&(d=(c=this.getVelocityBuffer())===null||c===void 0?void 0:c.texture)!==null&&d!==void 0?d:null:console.warn("BaseRenderer: no uniform: tVelocity"),this}get uiConfig(){var o;return(o=this.pass)===null||o===void 0?void 0:o.passObject.uiConfig}}VelocityBufferPlugin.PluginType="VelocityBuffer";var lut=`#if (USE_LUT == 1 || USE_LUT1 == 1 || USE_LUT2 == 1)
uniform float lutSize;uniform float lutSize1;uniform float lutSize2;uniform float intensity;
#if USE_3DTEXTURE == 1
precision highp sampler3D;
#if USE_LUT == 1
uniform sampler3D lut3d;
#endif
#if USE_LUT1 == 1
uniform sampler3D lut3d1;
#endif
#if USE_LUT2 == 1
uniform sampler3D lut3d2;
#endif
#else
#if USE_LUT == 1
uniform sampler2D lut2d;
#endif
#if USE_LUT1 == 1
uniform sampler2D lut2d1;
#endif
#if USE_LUT2 == 1
uniform sampler2D lut2d2;
#endif
vec3 lutLookup(sampler2D tex,float size,vec3 rgb){float sliceHeight=1./size;float yPixelHeight=1./(size*size);float slice=rgb.b*size;float interp=fract(slice);float slice0=slice-interp;float centeredInterp=interp-0.5;float slice1=slice0+sign(centeredInterp);float greenOffset=clamp(rgb.g*sliceHeight,yPixelHeight*0.5,sliceHeight-yPixelHeight*0.5);vec2 uv0=vec2(rgb.r,slice0*sliceHeight+greenOffset);vec2 uv1=vec2(rgb.r,slice1*sliceHeight+greenOffset);vec3 sample0=texture2D(tex,uv0).rgb;vec3 sample1=texture2D(tex,uv1).rgb;return mix(sample0,sample1,abs(centeredInterp));}
#endif
int getLUTBit(in int number){
#ifdef WebGL2Context
return number%2;
#else
return int(mod(float(number),2.));
#endif
}int getLUTIndex(in int number){
#ifdef WebGL2Context
return number%8;
#else
return int(mod(float(number),8.));
#endif
}vec3 getUVW(in float lutSize,in vec4 color){float pixelWidth=1./lutSize;float halfPixelWidth=0.5/lutSize;vec3 uvw=vec3(halfPixelWidth)+color.rgb*(1.-pixelWidth);return uvw;}vec4 colorLookUp(in vec4 color){vec4 outColor;float lutFac=float(getLUTBit(getGBufferFlags(vUv).a));float lutIndex=float(getLUTIndex(getGBufferFlags(vUv).g));
#if USE_3DTEXTURE == 1
if(lutIndex==0.){
#if USE_LUT == 1
outColor=vec4(texture(lut3d,getUVW(lutSize,color)).rgb,color.a);
#endif
}else if(lutIndex==1.){
#if USE_LUT1 == 1
outColor=vec4(texture(lut3d1,getUVW(lutSize1,color)).rgb,color.a);
#endif
}else if(lutIndex==2.){
#if USE_LUT2 == 1
outColor=vec4(texture(lut3d2,getUVW(lutSize2,color)).rgb,color.a);
#endif
}else{
#if USE_LUT == 1
outColor=vec4(texture(lut3d,getUVW(lutSize,color)).rgb,color.a);
#endif
}
#else
if(lutIndex==0.){outColor=vec4(lutLookup(lut2d,lutSize,getUVW(lutSize,color)),color.a);}else if(lutIndex==1.){
#if USE_LUT1 == 1
outColor=vec4(lutLookup(lut2d1,lutSize,getUVW(lutSize1,color)),color.a);
#endif
}else if(lutIndex==2.){
#if USE_LUT2 == 1
outColor=vec4(lutLookup(lut2d2,lutSize,getUVW(lutSize2,color)),color.a);
#endif
}else{outColor=vec4(lutLookup(lut2d,lutSize,getUVW(lutSize,color)),color.a);}
#endif
outColor=mix(color,outColor,lutFac);return vec4(mix(color,outColor,intensity));}
#endif
`,LUTPlugin_decorate=function(h,o,c,d){var _,b=arguments.length,_e=b<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_e=Reflect.decorate(h,o,c,d);else for(var it=h.length-1;it>=0;it--)(_=h[it])&&(_e=(b<3?_(_e):b>3?_(o,c,_e):_(o,c))||_e);return b>3&&_e&&Object.defineProperty(o,c,_e),_e};let LUTExtension=class{constructor(h){this.enabled=!1,this.lutBackground=!0,this.intensity=1,this.lutMap=void 0,this.lutMap1=void 0,this.lutMap2=void 0,this.extraUniforms={intensity:{value:1},lutSize:{value:1},lutSize1:{value:1},lutSize2:{value:1},lut3d:{value:null},lut3d1:{value:null},lut3d2:{value:null},lut2d:{value:null},lut2d1:{value:null},lut2d2:{value:null}},this.extraDefines={USE_LUT:0,USE_LUT1:0,USE_LUT2:0,USE_3DTEXTURE:0,LUT_BACKGROUND:0},this.parsFragmentSnippet=(o,c)=>this.enabled?lut:"",this._viewer=h,this._combinedPostPlugin=h.getPlugin(CombinedPostPlugin),this._setDirty=this._setDirty.bind(this),this.setDirty=this.setDirty.bind(this)}_updateParams(){if(!this.enabled)return;const h=this._viewer.renderer.rendererObject.capabilities.isWebGL2?1:0;let o=h?this.extraUniforms.lut3d:this.extraUniforms.lut2d;this._updateLUTMap(this.lutMap,o,this.extraUniforms.lutSize,h),this.extraDefines.USE_LUT=this.lutMap?1:0,o=h?this.extraUniforms.lut3d1:this.extraUniforms.lut2d1,this._updateLUTMap(this.lutMap1,o,this.extraUniforms.lutSize1,h),this.extraDefines.USE_LUT1=this.lutMap1?1:0,o=h?this.extraUniforms.lut3d2:this.extraUniforms.lut2d2,this._updateLUTMap(this.lutMap2,o,this.extraUniforms.lutSize2,h),this.extraDefines.USE_LUT2=this.lutMap2?1:0,this.extraUniforms.intensity.value=this.intensity,this.extraDefines.LUT_BACKGROUND=this.lutBackground?1:0,this.extraDefines.USE_3DTEXTURE=h,this._setDirty()}_updateLUTMap(h,o,c,d){if(h){let _=1;d==1?(o.value=h.texture3D,_=h.texture3D.image.width):h.texture&&(o.value=h.texture,_=h.texture.image.width),o.value.needsUpdate=!0,c.value=_}}shaderExtender(h,o,c){this.enabled&&(h.fragmentShader=shaderReplaceString(h.fragmentShader,"#glMarker",` 
            #if USE_LUT == 1
                bool isBackground = getDepth(vUv)>0.9999;
                #if LUT_BACKGROUND == 1
                    gl_FragColor = colorLookUp(gl_FragColor);
                #else
                    gl_FragColor = isBackground ? gl_FragColor : colorLookUp(gl_FragColor);
                #endif
            #endif
            #glMarker
        `))}computeCacheKey(h){return this.enabled?"1":"0"}isCompatible(h){return!0}_setDirty(){var h;(h=this.__setDirty)===null||h===void 0||h.call(this),this._combinedPostPlugin&&(this._combinedPostPlugin.pass.dirty=!0)}setDirty(){this._setDirty()}};function addLUTData(h){const o=h==null?void 0:h.userData;if(!o)return!1;o[LUTPlugin.PluginType]||(o[LUTPlugin.PluginType]={});const c=o[LUTPlugin.PluginType];return c.enable=!0,c.index===void 0&&(c.index=0),h.isMaterial&&(h.needsUpdate=!0),!0}LUTPlugin_decorate([serialize(),x$1(LUTExtension.prototype._updateParams),uiToggle("Enable")],LUTExtension.prototype,"enabled",void 0),LUTPlugin_decorate([serialize(),x$1(LUTExtension.prototype._updateParams),uiToggle("LUT Background")],LUTExtension.prototype,"lutBackground",void 0),LUTPlugin_decorate([serialize(),x$1(LUTExtension.prototype._updateParams),uiSlider("Intensity")],LUTExtension.prototype,"intensity",void 0),LUTPlugin_decorate([x$1(LUTExtension.prototype._updateParams),uiImage("LUT"),serialize()],LUTExtension.prototype,"lutMap",void 0),LUTPlugin_decorate([x$1(LUTExtension.prototype._updateParams),uiImage("LUT1"),serialize()],LUTExtension.prototype,"lutMap1",void 0),LUTPlugin_decorate([x$1(LUTExtension.prototype._updateParams),uiImage("LUT2"),serialize()],LUTExtension.prototype,"lutMap2",void 0),LUTExtension=LUTPlugin_decorate([uiFolder("LUT")],LUTExtension);class LUTPlugin extends GenericExtensionPlugin{_getUiConfig(o){var c,d;const _={type:"folder",label:"LUT",children:[{type:"checkbox",label:"Enabled",get value(){var b,_e;return(_e=(b=o.materialObject.userData[LUTPlugin.PluginType])===null||b===void 0?void 0:b.enable)===null||_e===void 0||_e},set value(b){var _e;const it=o.materialObject.userData[LUTPlugin.PluginType];b!==(it==null?void 0:it.enable)&&(it||addLUTData(o.materialObject),o.materialObject.userData[LUTPlugin.PluginType].enable=b,(_e=_.uiRefresh)===null||_e===void 0||_e.call(_,"postFrame",!0))},onChange:(c=this._extension)===null||c===void 0?void 0:c.setDirty},{type:"dropdown",children:[["LUT 0",0],["LUT 1",1],["LUT 2",2]].map(b=>({label:b[0],value:b[1]})),label:"index",hidden:()=>{const b=o.materialObject.userData[LUTPlugin.PluginType];return!!b&&!b.enable},get value(){var b,_e;return(_e=(b=o.materialObject.userData[LUTPlugin.PluginType])===null||b===void 0?void 0:b.index)!==null&&_e!==void 0?_e:0},set value(b){var _e;o.materialObject.userData[LUTPlugin.PluginType]||addLUTData(o.materialObject),o.materialObject.userData[LUTPlugin.PluginType].index=b,(_e=_.uiRefresh)===null||_e===void 0||_e.call(_,"postFrame",!0)},onChange:(d=this._extension)===null||d===void 0?void 0:d.setDirty}]};return _}constructor(){super(),this.materialExtension={uuid:esm_browser_v4(),getUiConfig:o=>{if(o.__uiConfigs||(o.__uiConfigs={}),o.__uiConfigs[this.materialExtension.uuid])return o.__uiConfigs[this.materialExtension.uuid];const c=this._getUiConfig(o);return o.__uiConfigs[this.materialExtension.uuid]=c,c},computeCacheKey:o=>{var c;return(this.enabled?"1":"0")+(!((c=o.materialObject.userData[LUTPlugin.PluginType])===null||c===void 0)&&c.enable?"1":"0")},isCompatible:o=>!0},this.updateGBuffer=this.updateGBuffer.bind(this)}async onAdded(o){var c,d;await super.onAdded(o),(c=o.getPlugin(GBufferPlugin))===null||c===void 0||c.registerGBufferUpdater(this.updateGBuffer);const _=o.getPlugin(AssetManagerPlugin);(d=_==null?void 0:_.materials)===null||d===void 0||d.registerMaterialExtension(this.materialExtension)}generateExtension(o){return new LUTExtension(o)}updateGBuffer(o,c){var d,_;if(o instanceof three_module.eaF&&!((d=o.material)===null||d===void 0)&&d.userData){const b=(_=o.material)===null||_===void 0?void 0:_.userData[LUTPlugin.PluginType];if(b){const _e=b.enable===!1?0:1;c.w=updateBit(c.w,0,_e);for(let nt=0;nt<3;nt++)c.y=clearBit(c.y,nt);let it=b.enable?b.index:0;it=Math.min(it,7),c.y=c.y|it}else c.w=updateBit(c.w,0,1)}}}LUTPlugin.PluginType="LUTPlugin1";class GyroInputDevice{constructor(o){this._zee=new three_module.Pq0(0,0,1),this._euler=new three_module.O9p,this._q0=new three_module.PTz,this._q1=new three_module.PTz(-Math.sqrt(.5),0,0,Math.sqrt(.5)),this._q2=new three_module.PTz,this._initQuaternionDest=new three_module.PTz,this.onScreenOrientationChangeEvent=()=>{this.screenOrientation=screen.orientation},this.onDeviceOrientationChangeEvent=c=>{this.deviceOrientation=c},this._isConnected=!1,this._viewer=o}getOffsetFromCenter(o=!0){if(!this.deviceOrientation)return new three_module.I9Y;this.getQuaternion(o,this._q2);const c=new three_module.Pq0(0,0,1);return c.applyQuaternion(this._q2),new three_module.I9Y(c.x,c.y)}getQuaternion(o,c){if(c||(c=new three_module.PTz),!this.deviceOrientation)return c.identity();const d=this.deviceOrientation,_=d.alpha!==null?three_module.cj9.degToRad(d.alpha):0,b=d.beta!==null?three_module.cj9.degToRad(d.beta):0,_e=d.gamma!==null?three_module.cj9.degToRad(d.gamma):0,it=this.screenOrientation?three_module.cj9.degToRad(this.screenOrientation.angle):0;return this._toQuaternion(c,_,b,_e,it,o),c}_toQuaternion(o,c,d,_,b,_e){this._euler.set(d,c,-_,"YXZ"),o.setFromEuler(this._euler),o.multiply(this._q1);const it=document.getElementById("debug");return it&&(it.textContent=b+""),o.multiply(this._q0.setFromAxisAngle(this._zee,-b)),this._initQuaternionDest.__init||(this._initQuaternionDest.copy(o).invert(),this._initQuaternionDest.__init=!0),_e&&o.premultiply(this._initQuaternionDest),o}static IsCompatible(){return window.DeviceOrientationEvent!==void 0&&"ontouchstart"in window}addPermissionMessage(){this.permissionMessage=document.createElement("div"),this.permissionMessage.innerHTML="Tap on the screen to allow gyroscope",this.permissionMessage.style.visibility="visible",this.permissionMessage.style.width="100%",this.permissionMessage.style.height="40px",this.permissionMessage.style.color="black",this.permissionMessage.style.position="absolute",this.permissionMessage.style.textAlign="center",this.permissionMessage.style.fontSize="12px",this.permissionMessage.style.bottom="20%",this._viewer.container.appendChild(this.permissionMessage)}connect(){var o;if(!this._isConnected)return this._isConnected=!0,this.onScreenOrientationChangeEvent(),!!window.DeviceOrientationEvent&&(this.askPermission(),(o=this._viewer)===null||o===void 0||o.renderer.rendererObject.domElement.addEventListener("click",this.askPermission.bind(this)),window.addEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.addEventListener("deviceorientation",this.onDeviceOrientationChangeEvent),!0)}askPermission(){this.onScreenOrientationChangeEvent(),typeof DeviceMotionEvent.requestPermission=="function"&&(this.addPermissionMessage(),DeviceOrientationEvent.requestPermission().then(o=>{o=="granted"&&(window.addEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.addEventListener("deviceorientation",this.onDeviceOrientationChangeEvent),this._viewer.container.removeChild(this.permissionMessage))}).catch(o=>{console.error("DeviceOrientationControls2: Unable to use DeviceOrientation API:",o)}))}disconnect(){this._isConnected&&(this._isConnected=!1,window.removeEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.removeEventListener("deviceorientation",this.onDeviceOrientationChangeEvent),this._initQuaternionDest=new three_module.PTz)}}class MouseInputDevice{constructor(){this._mousePos=new three_module.I9Y(0,0),this._isConnected=!1}getOffsetFromCenter(){return new three_module.I9Y(this._mousePos.x/window.innerWidth*2-1,-(this._mousePos.y/window.innerHeight*2-1))}connect(){this._isConnected||(this._isConnected=!0,window.addEventListener("mousemove",this._onMouseMove.bind(this)))}disconnect(){this._isConnected&&(this._isConnected=!1,window.removeEventListener("mousemove",this._onMouseMove.bind(this)))}_onMouseMove(o){this._mousePos.set(o.clientX,o.clientY)}}var ParallaxCameraControllerPlugin_decorate=function(h,o,c,d){var _,b=arguments.length,_e=b<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_e=Reflect.decorate(h,o,c,d);else for(var it=h.length-1;it>=0;it--)(_=h[it])&&(_e=(b<3?_(_e):b>3?_(o,c,_e):_(o,c))||_e);return b>3&&_e&&Object.defineProperty(o,c,_e),_e},ParallaxCameraControllerPlugin_1;let ParallaxCameraControllerPlugin=ParallaxCameraControllerPlugin_1=class extends AViewerPlugin{constructor(){super(),this.enabled=!1,this.enableEdit=!1,this.invert=!1,this.sensitivity=.5,this.focalPointHit=new three_module.Pq0(0,0,0),this.damping=.5,this.cameraView="",this._target=new three_module.Pq0,this._center=new three_module.Pq0,this._pointerDown=!1,this._focalDistance=100,this._updateProjectionMatrix=()=>{var h,o;if(!this.enabled)return void((o=(h=this._object)._updateProjectionMatrixParallax)===null||o===void 0||o.call(h));const c=this._object,d=c.near;let _=d*Math.tan(.5*three_module.cj9.DEG2RAD*c.fov)/c.zoom,b=2*_,_e=c.aspect*b,it=-.5*_e;if(c.view!==null&&c.view.enabled){const at=c.view.fullWidth,ut=c.view.fullHeight;it+=c.view.offsetX*_e/at,_-=c.view.offsetY*b/ut,_e*=c.view.width/at,b*=c.view.height/ut}it-=this._offX*d/this._focalDistance,_-=this._offY*d/this._focalDistance;const nt=c.filmOffset;nt!==0&&(it+=d*nt/c.getFilmWidth()),c.projectionMatrix.makePerspective(it,it+_e,_,_-b,d,c.far),c.projectionMatrixInverse.copy(c.projectionMatrix).invert()},this._preFrame=h=>{this.update(h.deltaTime)},this._offX=0,this._offY=0,this._xDamper=new k$1,this._yDamper=new k$1,this._onEnabledChange=this._onEnabledChange.bind(this),this._onDampingChange=this._onDampingChange.bind(this),this._onObjectHit=this._onObjectHit.bind(this),this._onActiveCameraChange=this._onActiveCameraChange.bind(this)}async onAdded(h){var o,c,d;await super.onAdded(h),GyroInputDevice.IsCompatible()?this._input=new GyroInputDevice(h):this._input=new MouseInputDevice,h.scene.addEventListener("activeCameraChange",this._onActiveCameraChange),this.addIndicator(),h.addEventListener("preFrame",this._preFrame),(o=this._viewer)===null||o===void 0||o.container.addEventListener("pointerdown",this.onPointerDown.bind(this)),(c=this._viewer)===null||c===void 0||c.container.addEventListener("pointerup",this.onPointerUp.bind(this)),(d=h.getPluginByType("Picking"))===null||d===void 0||d.addEventListener("hitObject",this._onObjectHit),this._onEnabledChange()}_onActiveCameraChange(){var h,o,c,d;this._object&&!((h=this._object)===null||h===void 0)&&h._updateProjectionMatrixParallax&&(this._object.updateProjectionMatrix=this._object._updateProjectionMatrixParallax,delete this._object._updateProjectionMatrixParallax),this._focalDistance=.01,this._object=(o=this._viewer)===null||o===void 0?void 0:o.scene.activeCamera.cameraObject,!((c=this._object)===null||c===void 0)&&c.isOrthographicCamera?(d=this._viewer)===null||d===void 0||d.console.warn("ParallaxCameraControllerPlugin: Orthographic camera is not supported"):this.enabled&&(this._object._updateProjectionMatrixParallax=this._object.updateProjectionMatrix,this._object.updateProjectionMatrix=this._updateProjectionMatrix)}addIndicator(){var h;this._viewer&&(this._indicator&&this._indicator.remove(),this._indicator=document.createElement("div"),this._indicator.style.width="40px",this._indicator.style.height="40px",this._indicator.style.borderRadius="100%",this._indicator.style.border="4px solid #ff4444",this._indicator.style.transform="translate(-50%, -50%)",this._indicator.style.position="absolute",this._indicator.style.top="0",this._indicator.style.left="0",this._indicator.style.zIndex="10000",this._indicator.style.opacity="0",this._indicator.style.transition="opacity 0.5s",this._indicator.style.pointerEvents="none",(h=this._viewer)===null||h===void 0||h.container.appendChild(this._indicator))}onPointerDown(h){this.enabled&&this._viewer&&(this._pointerDown=!0,this.enableEdit&&this._indicator&&(this._indicator.style.top=h.clientY-this._viewer.container.offsetTop+"px",this._indicator.style.left=h.clientX-this._viewer.container.offsetLeft+"px"))}onPointerUp(){this._pointerDown=!1}update(h){if(!this.enabled||this._pointerDown||!this._input||!this._object||!this._viewer)return;this._viewer.scene.activeCamera.setInteractions(!1,ParallaxCameraControllerPlugin_1.PluginType),this._updateFocalDistance();const o=this._object.matrixWorld.elements,c=new three_module.Pq0(o[0],o[1],o[2]),d=new three_module.Pq0(o[4],o[5],o[6]);this._object.position.copy(this._center),this._viewer.scene.activeCamera.positionUpdated();let _=this.sensitivity;this.invert&&(_*=-1),this._offX=this._xDamper.update(this._offX,this._input.getOffsetFromCenter().x*_,h,1),this._offY=this._yDamper.update(this._offY,this._input.getOffsetFromCenter().y*_,h,1);const b=this._object;b.position.add(d.multiplyScalar(this._offY)).add(c.multiplyScalar(this._offX)),b.updateProjectionMatrix(),b.updateMatrixWorld(),this._dirty=!0}_onObjectHit(h){var o,c;h.intersects.intersect&&this.enableEdit&&(this.focalPointHit.copy(h.intersects.intersect.point),h.intersects.selectedObject=null,(c=(o=this.uiConfig)===null||o===void 0?void 0:o.uiRefresh)===null||c===void 0||c.call(o,"postFrame",!0),this._indicator&&(this._indicator.style.display="block",this._indicator.style.opacity="1",setTimeout(()=>{var d,_;this._indicator.style.opacity="0",setTimeout(()=>this._indicator.style.display="none",600),(_=(d=this.uiConfig)===null||d===void 0?void 0:d.uiRefresh)===null||_===void 0||_.call(d,"postFrame",!0)},200)))}_updateFocalDistance(){if(!this._object)return;const h=this._object,o=new three_module.Pq0;h.getWorldDirection(o),o.normalize(),this._focalDistance=this.focalPointHit.clone().sub(h.position).dot(o)}_onEnabledChange(){var h,o,c;if(this._viewer){if(this.enabled){if((h=this._input)===null||h===void 0||h.connect(),this._onActiveCameraChange(),!this._object)return;this._viewer.scene.activeCamera.setInteractions(!1,ParallaxCameraControllerPlugin_1.PluginType);const d=this._viewer.getPluginByType("CameraViews"),_=d==null?void 0:d.camViews.find(b=>b.name===this.cameraView);d&&_&&d.setCurrentCameraView(_),this._updateFocalDistance(),this._center.copy(this._object.position),this._object.lookAt(this._viewer.scene.activeCamera.target)}else if(this._object){this._onActiveCameraChange(),this._viewer.scene.activeCamera.setInteractions(!0,ParallaxCameraControllerPlugin_1.PluginType),this._object.position.copy(this._center),this._object.lookAt(this._viewer.scene.activeCamera.target);const d=this._object;d.updateProjectionMatrix(),d.updateMatrixWorld()}(c=(o=this.uiConfig)===null||o===void 0?void 0:o.uiRefresh)===null||c===void 0||c.call(o,"postFrame",!0)}}_onDampingChange(){this._xDamper&&this._yDamper&&(this._xDamper.setDecayTime(100*this.damping),this._yDamper.setDecayTime(100*this.damping))}dispose(){var h;(h=this._input)===null||h===void 0||h.disconnect()}};ParallaxCameraControllerPlugin.PluginType="ParallaxCameraControllerPlugin",ParallaxCameraControllerPlugin_decorate([x$1(ParallaxCameraControllerPlugin.prototype._onEnabledChange),serialize(),uiToggle("Enabled")],ParallaxCameraControllerPlugin.prototype,"enabled",void 0),ParallaxCameraControllerPlugin_decorate([serialize(),uiToggle("enableEdit")],ParallaxCameraControllerPlugin.prototype,"enableEdit",void 0),ParallaxCameraControllerPlugin_decorate([serialize(),uiToggle("Invert")],ParallaxCameraControllerPlugin.prototype,"invert",void 0),ParallaxCameraControllerPlugin_decorate([serialize(),uiSlider("Sensitivity",[.1,2],.01)],ParallaxCameraControllerPlugin.prototype,"sensitivity",void 0),ParallaxCameraControllerPlugin_decorate([serialize("focalPoint"),uiVector("Focal Point Hit",void 0,.001)],ParallaxCameraControllerPlugin.prototype,"focalPointHit",void 0),ParallaxCameraControllerPlugin_decorate([x$1(ParallaxCameraControllerPlugin.prototype._onDampingChange),serialize(),uiSlider("Damping",[0,1],.001)],ParallaxCameraControllerPlugin.prototype,"damping",void 0),ParallaxCameraControllerPlugin_decorate([serialize(),uiInput("Camera View")],ParallaxCameraControllerPlugin.prototype,"cameraView",void 0),ParallaxCameraControllerPlugin=ParallaxCameraControllerPlugin_1=ParallaxCameraControllerPlugin_decorate([uiFolder("Parallax Camera Controller")],ParallaxCameraControllerPlugin);var voronoi=`#ifndef VORONOI_HELPER
#define VORONOI_HELPER 
float voronoi_distance(vec2 a,vec2 b,float metric){return distance(a,b);}float voronoi_f1_2d(in vec2 coord,in float randomness,in float flakeClamp,in float flakeRadius,inout vec3 outColor){vec2 cellPosition=floor(coord);vec2 localPosition=coord-cellPosition;float minDistance=8.;vec2 targetOffset,targetPosition;for(int j=-1;j<=1;j++){for(int i=-1;i<=1;i++){vec2 cellOffset=vec2(i,j);vec2 pointPosition=cellOffset+hash3(cellPosition+cellOffset).xy*randomness;float distanceToPoint=voronoi_distance(pointPosition,localPosition,1.);if(distanceToPoint<minDistance){targetOffset=cellOffset;minDistance=distanceToPoint;targetPosition=pointPosition;}}}float outDistance=minDistance;float dist=step(flakeRadius,outDistance);outColor=hash3(cellPosition+hash3(cellPosition+targetOffset).xy*randomness+targetOffset);vec3 outColor1=minDistance<flakeRadius?outColor:vec3(0.5,0.5,1.);outDistance=mix(dist,minDistance,flakeClamp);outColor=mix(outColor1,outColor,flakeClamp);return outDistance;}
#endif
`,noiseBumpMatPars="uniform vec2 noiseBumpParams;uniform float noiseBumpScale;uniform float noiseBumpFlakeScale;uniform float noiseFlakeClamp;uniform float noiseFlakeRadius;uniform bool useColorFlakes;uniform vec4 flakeParams;uniform vec3 flakeFallOffParams;vec3 perturbNormalArb_nb(vec3 surf_pos,vec3 surf_norm,vec2 dHdxy,float faceDirection){vec3 vSigmaX=dFdx(surf_pos.xyz);vec3 vSigmaY=dFdy(surf_pos.xyz);vec3 vN=surf_norm;vec3 R1=cross(vSigmaY,vN);vec3 R2=cross(vN,vSigmaX);float fDet=dot(vSigmaX,R1)*faceDirection;vec3 vGrad=sign(fDet)*(dHdxy.x*R1+dHdxy.y*R2);return normalize(abs(fDet)*surf_norm-vGrad);}",noiseBumpMat=`vec3 outColor,outColor1,outColor2,outColor3,outColor4,outColor5;float distFac=length(vViewPosition.xyz);float level=1.;vec2 uvMod=noiseBumpFlakeScale*noiseBumpParams.xy*vUv*level;float voronoiDist=clamp(voronoi_f1_2d(uvMod,1.,noiseFlakeClamp,noiseFlakeRadius,outColor),0.,1.);vec3 oldNormal=normal;normal=perturbNormalArb_nb(-vViewPosition,normal,(2.*outColor.xy-1.)*noiseBumpScale,faceDirection);float oldRoughnessFactor=roughnessFactor;float oldMetalnessFactor=metalnessFactor;roughnessFactor=mix(roughnessFactor,flakeParams.x,1.-voronoiDist);metalnessFactor=mix(metalnessFactor,flakeParams.y,1.-voronoiDist);
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
vec3 sparkleRadiance=getIBLRadiance(normalize(vViewPosition),normal,roughnessFactor);float sparkleIntensity=length(sparkleRadiance);float sparkleIntensityMultiplier=sparkleIntensity>1.3?flakeParams.z:1.;vec3 oldDiffuseColor=diffuseColor.rgb;vec2 cellPosition_=floor(uvMod);vec3 colorRGB=useColorFlakes?hash3(cellPosition_):vec3(1.);float fallOff_=mix(1.,1./(1.+flakeFallOffParams.y*distFac+flakeFallOffParams.z*distFac*distFac),flakeFallOffParams.x);diffuseColor.rgb*=mix(vec3(1.),sparkleIntensityMultiplier*colorRGB*fallOff_,vec3(1.-voronoiDist));if(sparkleIntensity<flakeParams.w){float mixFactor=1.;roughnessFactor=mix(roughnessFactor,oldRoughnessFactor,mixFactor);metalnessFactor=mix(metalnessFactor,oldMetalnessFactor,mixFactor);normal=normalize(mix(normal,oldNormal,mixFactor));diffuseColor.rgb=mix(diffuseColor.rgb,oldDiffuseColor,mixFactor);}
#endif
`,NoiseBumpMaterialPlugin_decorate=function(h,o,c,d){var _,b=arguments.length,_e=b<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_e=Reflect.decorate(h,o,c,d);else for(var it=h.length-1;it>=0;it--)(_=h[it])&&(_e=(b<3?_(_e):b>3?_(o,c,_e):_(o,c))||_e);return b>3&&_e&&Object.defineProperty(o,c,_e),_e};let NoiseBumpMaterialPlugin=class extends AViewerPlugin{addNoiseBumpMaterial(h){return addNoiseBumpMaterial(h.materialObject)}_loaderCreate({loader:h}){h.isGLTFLoader2&&h.register(o=>new GLTFMaterialsNoiseBumpMaterialExtensionImport(o))}constructor(){super(),this.enabled=!0,this.dependencies=[AssetManagerPlugin],this._uniforms={noiseBumpParams:{value:new three_module.I9Y},noiseBumpScale:{value:.05},noiseBumpFlakeScale:{value:1e3},noiseFlakeClamp:{value:1},noiseFlakeRadius:{value:.5},flakeParams:{value:new three_module.IUQ(0,1,3,0)},flakeFallOffParams:{value:new three_module.Pq0(0,1,0)},useColorFlakes:{value:!1}},this.materialExtension={parsFragmentSnippet:(h,o)=>{var c;return this.enabled&&!((c=o==null?void 0:o.materialObject.userData._noiseBumpMat)===null||c===void 0)&&c.hasBump?randomHelpers+`
`+voronoi+`
`+noiseBumpMatPars+`
`:""},shaderExtender:(h,o,c)=>{var d;if(!this.enabled||!(!((d=o.materialObject.userData._noiseBumpMat)===null||d===void 0)&&d.hasBump))return;const _="#glMarker beforeAccumulation",b=noiseBumpMat;h.fragmentShader=h.fragmentShader.replace(_,b+`
`+_),h.defines.USE_UV="",h.extensionDerivatives=!0},onObjectRender:(h,o)=>{var c;const d=(c=o.materialObject.userData)===null||c===void 0?void 0:c._noiseBumpMat;if(!(d!=null&&d.hasBump))return;this._uniforms.noiseBumpParams.value.fromArray(d.bumpNoiseParams),this._uniforms.noiseBumpScale.value=d.bumpScale,this._uniforms.noiseBumpFlakeScale.value=d.flakeScale,this._uniforms.noiseFlakeClamp.value=d.flakeClamp,this._uniforms.noiseFlakeRadius.value=d.flakeRadius,d.flakeParams&&this._uniforms.flakeParams.value.copy(d.flakeParams),d.flakeFallOffParams&&this._uniforms.flakeFallOffParams.value.copy(d.flakeFallOffParams),this._uniforms.useColorFlakes.value=d.useColorFlakes;const _=this.enabled?1:0;o.materialObject.defines.NOISE_BUMP_MATERIAL_ENABLED!==_&&(o.materialObject.defines.NOISE_BUMP_MATERIAL_ENABLED=_,o.materialObject.needsUpdate=!0)},extraUniforms:{...this._uniforms},computeCacheKey:h=>{var o,c;return(this.enabled?"1":"0")+(!((c=(o=h.materialObject.userData)===null||o===void 0?void 0:o._noiseBumpMat)===null||c===void 0)&&c.hasBump?"1":"0")},isCompatible:h=>h.isMeshStandardMaterial2,updaters:()=>[],getUiConfig:h=>{const o=this._viewer,c={type:"folder",label:"SparkleBump (NoiseBump)",children:[{type:"checkbox",label:"Enabled",get value(){var d;return((d=h.materialObject.userData._noiseBumpMat)===null||d===void 0?void 0:d.hasBump)||!1},set value(d){var _,b;d!==((_=h.materialObject.userData._noiseBumpMat)===null||_===void 0?void 0:_.hasBump)&&(d?addNoiseBumpMaterial(h.materialObject)||o.alert("Cannot add noise bump."):h.materialObject.userData._noiseBumpMat&&(h.materialObject.userData._noiseBumpMat.hasBump=!1,h.materialObject.needsUpdate=!0),(b=c.uiRefresh)===null||b===void 0||b.call(c,"postFrame",!0))},onChange:this.setDirty},()=>({type:"vec4",label:"Bump Noise Params",bounds:[0,1],hidden:()=>{var d;return!(!((d=h.materialObject.userData._noiseBumpMat)===null||d===void 0)&&d.hasBump)},property:[h.materialObject.userData._noiseBumpMat,"bumpNoiseParams"],onChange:this.setDirty}),()=>({type:"slider",label:"Bump Scale",bounds:[0,.001],stepSize:1e-5,hidden:()=>{var d;return!(!((d=h.materialObject.userData._noiseBumpMat)===null||d===void 0)&&d.hasBump)},property:[h.materialObject.userData._noiseBumpMat,"bumpScale"],onChange:this.setDirty}),()=>({type:"slider",label:"Flake Scale",bounds:[100,1e4],stepSize:1e-4,hidden:()=>{var d;return!(!((d=h.materialObject.userData._noiseBumpMat)===null||d===void 0)&&d.hasBump)},property:[h.materialObject.userData._noiseBumpMat,"flakeScale"],onChange:this.setDirty}),()=>({type:"slider",label:"Flake Clamp",bounds:[0,1],stepSize:1,hidden:()=>{var d;return!(!((d=h.materialObject.userData._noiseBumpMat)===null||d===void 0)&&d.hasBump)},property:[h.materialObject.userData._noiseBumpMat,"flakeClamp"],onChange:this.setDirty}),()=>({type:"slider",label:"Flake Radius",bounds:[.01,1],stepSize:.001,hidden:()=>{var d;return!(!((d=h.materialObject.userData._noiseBumpMat)===null||d===void 0)&&d.hasBump)},property:[h.materialObject.userData._noiseBumpMat,"flakeRadius"],onChange:this.setDirty}),()=>{var d;return{type:"slider",label:"Flake Roughness",bounds:[0,1],stepSize:.01,hidden:()=>{var _;return!(!((_=h.materialObject.userData._noiseBumpMat)===null||_===void 0)&&_.hasBump)},property:[(d=h.materialObject.userData._noiseBumpMat)===null||d===void 0?void 0:d.flakeParams,"x"],onChange:this.setDirty}},()=>{var d;return{type:"slider",label:"Flake Metalness",bounds:[0,1],stepSize:.01,hidden:()=>{var _;return!(!((_=h.materialObject.userData._noiseBumpMat)===null||_===void 0)&&_.hasBump)},property:[(d=h.materialObject.userData._noiseBumpMat)===null||d===void 0?void 0:d.flakeParams,"y"],onChange:this.setDirty}},()=>{var d;return{type:"slider",label:"Flake Strength",bounds:[0,100],stepSize:.001,hidden:()=>{var _;return!(!((_=h.materialObject.userData._noiseBumpMat)===null||_===void 0)&&_.hasBump)},property:[(d=h.materialObject.userData._noiseBumpMat)===null||d===void 0?void 0:d.flakeParams,"z"],onChange:this.setDirty}},()=>{var d;return{type:"slider",label:"Flake Threshold",bounds:[.1,10],stepSize:.001,hidden:()=>{var _;return!(!((_=h.materialObject.userData._noiseBumpMat)===null||_===void 0)&&_.hasBump)},property:[(d=h.materialObject.userData._noiseBumpMat)===null||d===void 0?void 0:d.flakeParams,"w"],onChange:this.setDirty}},()=>{var d;return{type:"slider",label:"Falloff",stepSize:1,bounds:[0,1],hidden:()=>{var _;return!(!((_=h.materialObject.userData._noiseBumpMat)===null||_===void 0)&&_.hasBump)},property:[(d=h.materialObject.userData._noiseBumpMat)===null||d===void 0?void 0:d.flakeFallOffParams,"x"],onChange:this.setDirty}},()=>{var d;return{type:"slider",label:"Linear falloff factor",bounds:[0,10],stepSize:.001,hidden:()=>{var _;return!(!((_=h.materialObject.userData._noiseBumpMat)===null||_===void 0)&&_.hasBump)},property:[(d=h.materialObject.userData._noiseBumpMat)===null||d===void 0?void 0:d.flakeFallOffParams,"y"],onChange:this.setDirty}},()=>{var d;return{type:"slider",label:"Quadratic falloff factor",bounds:[0,10],stepSize:.001,hidden:()=>{var _;return!(!((_=h.materialObject.userData._noiseBumpMat)===null||_===void 0)&&_.hasBump)},property:[(d=h.materialObject.userData._noiseBumpMat)===null||d===void 0?void 0:d.flakeFallOffParams,"z"],onChange:this.setDirty}},()=>({type:"checkbox",label:"Colored Flakes",hidden:()=>{var d;return!(!((d=h.materialObject.userData._noiseBumpMat)===null||d===void 0)&&d.hasBump)},property:[h.materialObject.userData._noiseBumpMat,"useColorFlakes"],onChange:this.setDirty})]};return c}},this.setDirty=()=>{var h,o,c;(o=(h=this.materialExtension).setDirty)===null||o===void 0||o.call(h),(c=this._viewer)===null||c===void 0||c.setDirty()},this._loaderCreate=this._loaderCreate.bind(this)}async onAdded(h){var o,c,d,_,b;await super.onAdded(h);const _e=h.getPlugin(AssetManagerPlugin);(o=_e==null?void 0:_e.materials)===null||o===void 0||o.registerMaterialExtension(this.materialExtension),(c=_e==null?void 0:_e.importer)===null||c===void 0||c.addEventListener("loaderCreate",this._loaderCreate),(b=(_=(d=_e==null?void 0:_e.exporter)===null||d===void 0?void 0:d.getExporter("gltf","glb"))===null||_===void 0?void 0:_.extensions)===null||b===void 0||b.push(glTFMaterialsNoiseBumpMaterialExtensionExport)}async onRemove(h){var o,c,d,_;return(c=(o=h.getPlugin(AssetManagerPlugin))===null||o===void 0?void 0:o.materials)===null||c===void 0||c.unregisterMaterialExtension(this.materialExtension),(_=(d=h.getPlugin(AssetManagerPlugin))===null||d===void 0?void 0:d.importer)===null||_===void 0||_.removeEventListener("loaderCreate",this._loaderCreate),super.onRemove(h)}};function addNoiseBumpMaterial(h){const o=h==null?void 0:h.userData;if(!o)return!1;o._noiseBumpMat||(o._noiseBumpMat={});const c=o._noiseBumpMat;return c.hasBump=!0,c.bumpNoiseParams===void 0&&(c.bumpNoiseParams=[.5,.5]),c.bumpScale===void 0&&(c.bumpScale=.05),c.flakeScale===void 0&&(c.flakeScale=.05),c.flakeClamp===void 0&&(c.flakeClamp=1),c.flakeRadius===void 0&&(c.flakeRadius=.3),c.useColorFlakes===void 0&&(c.useColorFlakes=!1),c.flakeParams===void 0&&(c.flakeParams=new three_module.IUQ(0,1,3,0)),c.flakeFallOffParams===void 0&&(c.flakeFallOffParams=new three_module.Pq0(0,1,0)),h.isMaterial&&(h.needsUpdate=!0),!0}NoiseBumpMaterialPlugin.PluginType="NoiseBumpMaterialPlugin",NoiseBumpMaterialPlugin.NOISE_BUMP_MATERIAL_GLTF_EXTENSION="WEBGI_materials_noise_bump",NoiseBumpMaterialPlugin_decorate([uiToggle("Enabled",h=>({onChange:h.setDirty})),serialize()],NoiseBumpMaterialPlugin.prototype,"enabled",void 0),NoiseBumpMaterialPlugin=NoiseBumpMaterialPlugin_decorate([uiFolder("NoiseBump Materials")],NoiseBumpMaterialPlugin);class GLTFMaterialsNoiseBumpMaterialExtensionImport{constructor(o){this.parser=o,this.name=NoiseBumpMaterialPlugin.NOISE_BUMP_MATERIAL_GLTF_EXTENSION}async extendMaterialParams(o,c){const d=this.parser.json.materials[o];if(!d.extensions||!d.extensions[this.name])return Promise.resolve();const _=d.extensions[this.name];return c.userData||(c.userData={}),addNoiseBumpMaterial(c),c.userData._noiseBumpMat=deserializeObject(_,c.userData._noiseBumpMat,!1,{}),Promise.resolve()}}const glTFMaterialsNoiseBumpMaterialExtensionExport=h=>({writeMaterial:(o,c)=>{if(!o.isMeshStandardMaterial||!o.userData._noiseBumpMat||!o.userData._noiseBumpMat.hasBump)return;c.extensions=c.extensions||{};const d=serializeObject(o.userData._noiseBumpMat,!1);c.extensions[NoiseBumpMaterialPlugin.NOISE_BUMP_MATERIAL_GLTF_EXTENSION]=d,h.extensionsUsed[NoiseBumpMaterialPlugin.NOISE_BUMP_MATERIAL_GLTF_EXTENSION]=!0}});var taa=`#include <common>
varying vec2 vUv;uniform vec2 previousRTSize;uniform mat4 lastProjectionViewMatrix;uniform mat4 currentProjectionViewMatrix;uniform mat4 inverseViewMatrix;uniform vec2 jitterSample;uniform vec2 feedBack;uniform bool firstFrame;
#if HAS_VELOCITY_BUFFER == 1
uniform sampler2D tVelocity;
#endif
vec3 find_closest_fragment_3x3(const in vec2 uv){const vec3 offset=vec3(-1.,1.,0.);vec2 texelSize=1./previousRTSize;vec3 dtr=vec3(1,1,getDepth(uv+offset.yy*texelSize));vec3 dtc=vec3(0,1,getDepth(uv+offset.zy*texelSize));vec3 dtl=vec3(-1,1,getDepth(uv+offset.xy*texelSize));vec3 dml=vec3(-1,0,getDepth(uv+offset.xz*texelSize));vec3 dmc=vec3(0,0,getDepth(uv));vec3 dmr=vec3(1,0,getDepth(uv+offset.yz*texelSize));vec3 dbl=vec3(-1,-1,getDepth(uv+offset.xx*texelSize));vec3 dbc=vec3(0,-1,getDepth(uv+offset.zx*texelSize));vec3 dbr=vec3(1,-1,getDepth(uv+offset.yx*texelSize));vec3 dmin=dtl;if(dmin.z>dtc.z)dmin=dtc;if(dmin.z>dtr.z)dmin=dtr;if(dmin.z>dml.z)dmin=dml;if(dmin.z>dmc.z)dmin=dmc;if(dmin.z>dmr.z)dmin=dmr;if(dmin.z>dbl.z)dmin=dbl;if(dmin.z>dbc.z)dmin=dbc;if(dmin.z>dbr.z)dmin=dbr;return vec3(uv+texelSize.xy*dmin.xy,dmin.z);}vec3 find_closest_fragment_5tap(const in vec2 uv){vec2 texelSize=1./previousRTSize;vec2 offset=vec2(1.,-1.);vec3 dtl=vec3(-1,1,getDepth(uv+offset.yx*texelSize));vec3 dtr=vec3(1,1,getDepth(uv+offset.xx*texelSize));vec3 dmc=vec3(0,0,getDepth(uv));vec3 dbl=vec3(-1,-1,getDepth(uv+offset.yy*texelSize));vec3 dbr=vec3(1,-1,getDepth(uv+offset.xy*texelSize));vec3 dmin=dtl;if(dmin.z>dtr.z)dmin=dtr;if(dmin.z>dmc.z)dmin=dmc;if(dmin.z>dbl.z)dmin=dbl;if(dmin.z>dbr.z)dmin=dbr;return vec3(uv+dmin.xy*texelSize,dmin.z);}vec4 clip_aabb(const in vec4 aabb_min,const in vec4 aabb_max,vec4 p){const float FLT_EPS=1e-8;vec4 p_clip=0.5*(aabb_max+aabb_min);vec4 e_clip=0.5*(aabb_max-aabb_min)+FLT_EPS;vec4 v_clip=p-p_clip;vec4 v_unit=abs(v_clip/e_clip);float ma_unit=max(v_unit.x,max(v_unit.y,v_unit.z));if(ma_unit>1.)return p_clip+v_clip/ma_unit;else return p;}
#if HAS_VELOCITY_BUFFER == 0
vec2 computeScreenSpaceVelocity(const in vec3 worldPosition){vec4 currentPositionClip=currentProjectionViewMatrix*vec4(worldPosition,1.);vec4 prevPositionClip=lastProjectionViewMatrix*vec4(worldPosition,1.);vec2 currentPositionNDC=currentPositionClip.xy/currentPositionClip.w;vec2 prevPositionNDC=prevPositionClip.xy/prevPositionClip.w;if(prevPositionNDC.x>=1.||prevPositionNDC.x<=-1.||prevPositionNDC.x>=1.||prevPositionNDC.y<=-1.){return vec2(0.);}return 0.5*(currentPositionNDC-prevPositionNDC);}
#endif
vec4 computeTAA(const in vec2 uv,const in vec2 screenSpaceVelocity,const in float feedbackScale){vec2 uvUnJitter=uv;vec4 currentColor=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter));vec4 previousColor=previousRTTexelToLinear(texture2D(previousRT,uv-screenSpaceVelocity));const vec3 offset=vec3(1.,-1.,0.);vec2 texelSize=1./previousRTSize;float texelSpeed=length(screenSpaceVelocity);vec4 tl=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.yx*texelSize));vec4 tc=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.zx*texelSize));vec4 tr=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.xx*texelSize));vec4 ml=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.yz*texelSize));vec4 mc=currentColor;vec4 mr=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.xz*texelSize));vec4 bl=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.yy*texelSize));vec4 bc=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.zy*texelSize));vec4 br=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.xy*texelSize));vec4 corners=2.*(tr+bl+br+tl)-2.*mc;mc+=(mc-(corners*0.166667))*2.718282*0.3;mc=max(vec4(0.),mc);vec4 min5=min(tc,min(ml,min(mc,min(mr,bc))));vec4 max5=max(tc,max(ml,max(mc,max(mr,bc))));vec4 cmin=min(min5,min(tl,min(tr,min(bl,br))));vec4 cmax=max(min5,max(tl,max(tr,max(bl,br))));;cmin=0.5*(cmin+min5);cmax=0.5*(cmax+max5);previousColor=clip_aabb(cmin,cmax,previousColor);float lum0=luminance(currentColor.rgb);float lum1=luminance(previousColor.rgb);float unbiased_diff=abs(lum0-lum1)/max(lum0,max(lum1,0.2));float unbiased_weight=1.-unbiased_diff;float unbiased_weight_sqr=unbiased_weight*unbiased_weight;float k_feedback=mix(feedBack.x,feedBack.y,unbiased_weight_sqr);return mix(currentColor,previousColor,clamp(k_feedback*feedbackScale,0.,1.));}vec3 getWorldPositionFromViewZ(const in vec2 uv,const in float viewDepth){vec2 uv_=2.*uv-1.;float xe=-(uv_.x+projection[2][0])*viewDepth/projection[0][0];float ye=-(uv_.y+projection[2][1])*viewDepth/projection[1][1];return(inverseViewMatrix*vec4(xe,ye,viewDepth,1.)).xyz;}void main(){
#if HAS_VELOCITY_BUFFER == 0
#if QUALITY == 1
vec3 c_frag=find_closest_fragment_3x3(vUv);
#else
vec3 c_frag=find_closest_fragment_5tap(vUv);
#endif
#else
vec3 c_frag=vec3(vUv,0.);
#endif
bool bg=firstFrame;
#if BACKGROUND_TAA 
float d=c_frag.z;float edgef=min(1.,max(0.,1.-(d*100.-99.)));
#else
bg=bg||c_frag.z>0.999;
#endif
if(firstFrame){gl_FragColor=currentRTTexelToLinear(texture2D(currentRT,vUv));}else{
#if HAS_VELOCITY_BUFFER == 0
float sampleViewZ=mix(-cameraNearFar.x,-cameraNearFar.y,c_frag.z);vec3 worldPosition=getWorldPositionFromViewZ(c_frag.xy,sampleViewZ);vec2 screenSpaceVelocity=computeScreenSpaceVelocity(worldPosition);
#else
vec2 screenSpaceVelocity=texture2D(tVelocity,c_frag.xy).xy*2.-1.;screenSpaceVelocity=sign(screenSpaceVelocity)*pow(abs(screenSpaceVelocity),vec2(4.));
#endif
#if BACKGROUND_TAA
gl_FragColor=computeTAA(vUv,screenSpaceVelocity*edgef,edgef);
#else
gl_FragColor=computeTAA(vUv,screenSpaceVelocity,1.);
#endif
}
#include <colorspace_fragment>
#ifdef DEBUG_VELOCITY
float sampleViewZ=mix(-cameraNearFar.x,-cameraNearFar.y,c_frag.z);vec3 worldPosition=getWorldPositionFromViewZ(c_frag.xy,sampleViewZ);vec2 screenSpaceVelocity=computeScreenSpaceVelocity(worldPosition);gl_FragColor=vec4(10.*length(screenSpaceVelocity),0.,0.,1.);
#endif
}`,TAAPass_decorate=function(h,o,c,d){var _,b=arguments.length,_e=b<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_e=Reflect.decorate(h,o,c,d);else for(var it=h.length-1;it>=0;it--)(_=h[it])&&(_e=(b<3?_(_e):b>3?_(o,c,_e):_(o,c))||_e);return b>3&&_e&&Object.defineProperty(o,c,_e),_e};class TAAPass extends ShaderPass2{constructor(o,c,d=!1){super({vertexShader:CopyShader.vertexShader,fragmentShader:c+`
`+cameraHelpers+`
`+taa,uniforms:{currentRT:{value:null},previousRT:{value:null},previousRTSize:{value:new three_module.I9Y},cameraNearFar:{value:new three_module.I9Y},lastProjectionViewMatrix:{value:new three_module.kn4},currentProjectionViewMatrix:{value:new three_module.kn4},projection:{value:new three_module.kn4},inverseViewMatrix:{value:new three_module.kn4},jitterSample:{value:new three_module.I9Y},firstFrame:{value:!0},tNormalDepth:{value:null},tVelocity:{value:null}},defines:{HAS_VELOCITY_BUFFER:0,QUALITY:1,UNJITTER:0,BACKGROUND_TAA:d?1:0}},"currentRT","previousRT"),this.taaEnabled=!0,this.feedBack=new three_module.I9Y(.88,.97),this.uiConfig={type:"folder",label:"Temporal AA",children:[{type:"checkbox",label:"Enabled",property:[this,"enabled"],onChange:()=>this.onSizeUpdate()},{type:"input",label:"Feedback",stepSize:1e-4,property:[this,"feedBack"],onChange:this.setDirty}]},this.onSizeUpdate=this.onSizeUpdate.bind(this),this.target=o,this.clear=!1,this.needsSwap=!0}render(o,c,d,_,b){var _e,it;if(!this.taaEnabled||!this.enabled)return void(this.needsSwap=!1);this.needsSwap=!0;const nt=this.uniforms.tVelocity.value?1:0;nt!==this.material.defines.HAS_VELOCITY_BUFFER&&(this.material.defines.HAS_VELOCITY_BUFFER=nt,this.material.needsUpdate=!0),this.uniforms.previousRT.value=(it=(_e=Ee$1(this.target))===null||_e===void 0?void 0:_e.texture)!==null&&it!==void 0?it:null,super.render(o,c,d,_,b),this.uniforms.lastProjectionViewMatrix.value.copy(this.uniforms.currentProjectionViewMatrix.value),this.uniforms.firstFrame.value=!1}updateCameraProperties(o){o&&(this.uniforms.currentProjectionViewMatrix.value.multiplyMatrices(o.projectionMatrix,o.matrixWorldInverse),this.uniforms.inverseViewMatrix.value.copy(o.matrixWorld))}onSizeUpdate(){this.uniforms.firstFrame.value=!0,this.setDirty()}setSize(o,c){super.setSize(o,c),this.onSizeUpdate()}}TAAPass_decorate([serialize(),uniform()],TAAPass.prototype,"feedBack",void 0);class TemporalAAPlugin extends GenericFilterPlugin{constructor(){super(...arguments),this.passId="taa",this._beforeFilters=["progressive"],this._afterFilters=[],this._requiredFilters=["render","progressive"],this.dependencies=[GBufferPlugin],this._stableNoise=!0,this._stableNoiseConfig={label:"Stable Noise (Use Total Frame Count)",type:"checkbox",property:[this,"stableNoise"]}}passCtor(o){if(!o.getPlugin(ProgressivePlugin))throw"Add ProgressivePlugin before TAA";const c=o.isAntialiased,d=new TAAPass(()=>{var _;return(_=o.getPlugin(ProgressivePlugin))===null||_===void 0?void 0:_.lastFrame},o.getPlugin(GBufferPlugin).getUnpackSnippet(),c);return o.renderer.addEventListener("resize",d.onSizeUpdate),d}setDirty(){var o;(o=this._viewer)===null||o===void 0||o.setDirty()}async onDispose(o){return this.pass&&o.renderer.removeEventListener("resize",this.pass.passObject.onSizeUpdate),super.onDispose(o)}_update(o){if(!super._update(o))return!1;const c=o.renderer.frameCount,d=this._pass.passObject;if(d.taaEnabled=c<=1&&o.scene.renderCamera===o.scene.activeCamera,!d.taaEnabled)return!1;const _=o.scene.renderCamera;return d.updateShaderProperties([o.getPlugin(GBufferPlugin),_,o.getPluginByType("VelocityBuffer")]),d.target=o.getPlugin(ProgressivePlugin).lastFrame,d.updateCameraProperties(_==null?void 0:_.cameraObject),!0}async onAdded(o){await super.onAdded(o),this.stableNoise=this._stableNoise}get stableNoise(){var o,c;return(c=(o=this._viewer)===null||o===void 0?void 0:o.renderer.stableNoise)!==null&&c!==void 0?c:this._stableNoise}set stableNoise(o){this._viewer&&(this._viewer.renderer.stableNoise=o),this._stableNoise=o}get uiConfig(){var o;const c=(o=this.pass)===null||o===void 0?void 0:o.passObject.uiConfig;if(c&&c.children)return c.children.includes(this._stableNoiseConfig)||c.children.push(this._stableNoiseConfig),c}}TemporalAAPlugin.PluginType="TAA";var FullScreenPlugin_decorate=function(h,o,c,d){var _,b=arguments.length,_e=b<3?o:d===null?d=Object.getOwnPropertyDescriptor(o,c):d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_e=Reflect.decorate(h,o,c,d);else for(var it=h.length-1;it>=0;it--)(_=h[it])&&(_e=(b<3?_(_e):b>3?_(o,c,_e):_(o,c))||_e);return b>3&&_e&&Object.defineProperty(o,c,_e),_e};let FullScreenPlugin=class extends AViewerPlugin{constructor(){super(),this.toJSON=void 0,this.enabled=!0,this._lastSize=["100%","100%"],this._lastFsElement=null,this._fsChangeHandler=h=>{var o;if(this.isFullScreen())this.dispatchEvent({type:"enter"});else{const c=this._lastFsElement||((o=this._viewer)===null||o===void 0?void 0:o.canvas);c&&(c.style.width=this._lastSize[0],c.style.height=this._lastSize[1]),document.removeEventListener("webkitfullscreenchange",this._fsChangeHandler,!1),document.removeEventListener("mozfullscreenchange",this._fsChangeHandler,!1),document.removeEventListener("fullscreenchange",this._fsChangeHandler,!1),document.removeEventListener("MSFullscreenChange",this._fsChangeHandler,!1),this.dispatchEvent({type:"exit"})}},this.enter=this.enter.bind(this),this.exit=this.exit.bind(this)}async enter(h){var o;if(this.isFullScreen())return;const c=h||((o=this._viewer)===null||o===void 0?void 0:o.canvas);return c?(this._lastFsElement=c,document.addEventListener&&(document.addEventListener("webkitfullscreenchange",this._fsChangeHandler,!1),document.addEventListener("mozfullscreenchange",this._fsChangeHandler,!1),document.addEventListener("fullscreenchange",this._fsChangeHandler,!1),document.addEventListener("MSFullscreenChange",this._fsChangeHandler,!1)),this._lastSize=[c.style.width,c.style.height],c.style.width="100%",c.style.height="100%",c.requestFullscreen?c.requestFullscreen():c.mozRequestFullScreen?c.mozRequestFullScreen():c.webkitRequestFullscreen?c.webkitRequestFullscreen():c.msRequestFullscreen?c.msRequestFullscreen():void 0):void 0}async exit(){return document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen?document.msExitFullscreen():void 0}async toggle(h){return this.isFullScreen()?this.exit():this.enter(h)}isFullScreen(){return document.webkitIsFullScreen||document.mozFullScreen||document.msFullscreenElement!==void 0}};FullScreenPlugin.PluginType="FullScreenPlugin",FullScreenPlugin_decorate([uiButton("Enter FullScreen")],FullScreenPlugin.prototype,"enter",null),FullScreenPlugin_decorate([uiButton("Exit FullScreen")],FullScreenPlugin.prototype,"exit",null),FullScreenPlugin_decorate([uiButton("Toggle FullScreen")],FullScreenPlugin.prototype,"toggle",null),FullScreenPlugin=FullScreenPlugin_decorate([uiFolder("Full Screen")],FullScreenPlugin);const ensureUniqueNames=h=>{const o=[],c=new Set;for(const d of h){let _=d,b=0;for(;c.has(_);)_=d+"."+ ++b;c.add(_),o.push(_)}return o},mappingsArrayToTable=(h,o)=>{const c={};for(const d of h.mappings)for(const _ of d.variants)c[o[_]]={material:null,gltfMaterialIndex:d.material};return c},compatibleObject=h=>h.material!==void 0&&h.userData&&h.userData._variantMaterials,khrMaterialsVariantsGLTF="KHR_materials_variants";class GLTFMaterialsVariantsExtensionImport{constructor(o){this.parser=o,this.name=khrMaterialsVariantsGLTF}async afterRoot(o){const c=this.parser,d=c.json;if(!d.extensions||!d.extensions[this.name])return;const _=d.extensions[this.name].variants||[],b=ensureUniqueNames(_.map(_e=>_e.name));for(const _e of o.scenes)_e.traverse(it=>{const nt=c.associations.get(it);if(!nt||nt.meshes===void 0||nt.primitives===void 0)return;const at=d.meshes[nt.meshes].primitives[nt.primitives].extensions;at&&at[this.name]&&(it.userData._variantMaterials=mappingsArrayToTable(at[this.name],b))});await Promise.all(o.scenes.map(async _e=>{const it=[];return _e.traverse(nt=>compatibleObject(nt)&&it.push((async at=>{const ut=at.material,pt=at.userData._variantMaterials,mt=[];for(const ft in pt){const vt=pt[ft];if(vt.material)continue;const xt=vt.gltfMaterialIndex;mt.push(c.getDependency("material",xt).then(At=>{at.material=At,c.assignFinalMaterial(at),pt[ft].material=at.material}))}return Promise.all(mt).then(()=>{at.material=ut})})(nt))),_e.userData.__importData||(_e.userData.__importData={}),_e.userData.__importData[khrMaterialsVariantsGLTF]={names:b},Promise.all(it)}))}}const GLTFMaterialsVariantsExtensionExport_compatibleObject=h=>h.material!==void 0&&h.userData&&h.userData._variantMaterials&&!!Object.values(h.userData._variantMaterials).filter(o=>compatibleMaterial(o==null?void 0:o.material)),compatibleMaterial=h=>h&&h.isMaterial&&!Array.isArray(h);class GLTFExporterMaterialsVariantsExtensionExport{constructor(o){this.writer=o,this.name=khrMaterialsVariantsGLTF,this.variantNames=[]}beforeParse(o){const c=new Set;for(const d of o)d.traverse(_=>{if(!GLTFMaterialsVariantsExtensionExport_compatibleObject(_))return;const b=_.userData._variantMaterials;for(const _e in b){const it=b[_e];compatibleMaterial(it.material)&&c.add(_e)}});c.forEach(d=>this.variantNames.push(d))}writeMesh(o,c){var d;if(!GLTFMaterialsVariantsExtensionExport_compatibleObject(o))return;const _=o.userData,b=_._variantMaterials,_e={};for(const at in b){const ut=b[at].material;if(!compatibleMaterial(ut))continue;const pt=this.variantNames.indexOf(at),mt=this.writer.processMaterial(ut);_e[mt]||(_e[mt]={material:mt,variants:[]}),_e[mt].variants.push(pt)}const it=Object.values(_e).map(at=>at.variants.sort((ut,pt)=>ut-pt)&&at).sort((at,ut)=>at.material-ut.material);if(it.length===0)return;const nt=compatibleMaterial(_._originalMaterial)&&(d=this.writer.processMaterial(_._originalMaterial))!==null&&d!==void 0?d:-1;for(const at of c.primitives)nt>=0&&(at.material=nt),at.extensions=at.extensions||{},at.extensions[this.name]={mappings:it}}afterParse(o){if(this.variantNames.length===0)return;const c=this.writer.json;c.extensions=c.extensions||{};const d=this.variantNames.map(_=>({name:_}));c.extensions[this.name]={variants:d},this.writer.extensionsUsed[this.name]=!0}}function gltfExporterMaterialsVariantsExtensionExport(h){return new GLTFExporterMaterialsVariantsExtensionExport(h)}var GLTFKHRMaterialVariantsPlugin_decorate=function(h,o,c,d){var _,b=arguments.length,_e=b<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_e=Reflect.decorate(h,o,c,d);else for(var it=h.length-1;it>=0;it--)(_=h[it])&&(_e=(b<3?_(_e):b>3?_(o,c,_e):_(o,c))||_e);return b>3&&_e&&Object.defineProperty(o,c,_e),_e};class GLTFKHRMaterialVariantsPlugin extends AViewerPlugin{constructor(){super(),this.enabled=!0,this.toJSON=void 0,this.dependencies=[AssetManagerPlugin],this.variants={},this.selectedVariant="",this._objectAdded=o=>{var c,d;const _=o.object;(_==null?void 0:_.assetType)==="model"&&_.modelObject&&this._viewer&&(_.modelObject.traverse(b=>{var _e,it,nt,at,ut;if(b.userData._variantMaterials)for(const ft of Object.values(b.userData._variantMaterials))ft!=null&&ft.material&&(ft.material=((nt=(it=(_e=this._viewer)===null||_e===void 0?void 0:_e.getManager())===null||it===void 0?void 0:it.materials)===null||nt===void 0?void 0:nt.processMaterial(ft.material,{}))||ft.material);const pt=(ut=(at=b.userData)===null||at===void 0?void 0:at.__importData)===null||ut===void 0?void 0:ut[khrMaterialsVariantsGLTF];if(!pt)return;const mt=pt.names||[];for(const ft of mt)this.variants[ft]||(this.variants[ft]=[]),this.variants[ft].push(b);delete b.userData.__importData[khrMaterialsVariantsGLTF]}),(d=(c=this.uiConfig).uiRefresh)===null||d===void 0||d.call(c))},this.uiConfig={type:"folder",label:"KHR Material Variants",children:[()=>({children:[null,...Object.keys(this.variants)].map(o=>o?{label:o}:{label:"none",value:""}),type:"dropdown",label:"Variant",property:[this,"selectedVariant"]})]},this._loaderCreate=this._loaderCreate.bind(this)}async onAdded(o){var c,d,_,b;await super.onAdded(o),o.scene.addEventListener("addSceneObject",this._objectAdded);const _e=o.getPlugin(AssetManagerPlugin);(c=_e==null?void 0:_e.importer)===null||c===void 0||c.addEventListener("loaderCreate",this._loaderCreate),(b=(_=(d=_e==null?void 0:_e.exporter)===null||d===void 0?void 0:d.getExporter("gltf","glb"))===null||_===void 0?void 0:_.extensions)===null||b===void 0||b.push(gltfExporterMaterialsVariantsExtensionExport)}_loaderCreate({loader:o}){o.isGLTFLoader2&&o.register(c=>new GLTFMaterialsVariantsExtensionImport(c))}async onRemove(o){var c,d,_,b,_e,it;o.scene.removeEventListener("addSceneObject",this._objectAdded);const nt=o.getPlugin(AssetManagerPlugin);(c=nt.importer)===null||c===void 0||c.removeEventListener("loaderCreate",this._loaderCreate);const at=(b=(_=(d=nt.exporter)===null||d===void 0?void 0:d.getExporter("gltf","glb"))===null||_===void 0?void 0:_.extensions)===null||b===void 0?void 0:b.indexOf(gltfExporterMaterialsVariantsExtensionExport);return at!==void 0&&at!==-1&&((it=(_e=nt.exporter.getExporter("gltf","glb"))===null||_e===void 0?void 0:_e.extensions)===null||it===void 0||it.splice(at,1)),this.variants={},super.onRemove(o)}_variantChanged(){this.applyVariant(this.selectedVariant||"",!0)}applyVariant(o,c=!1,d,_=!0){if(!c&&!d&&this.selectedVariant===o||!o)return;d||(this.selectedVariant=o);const b=d?Array.isArray(d)?d:[d]:o?this.variants[o]||[]:Object.values(this.variants).flat();for(const _e of b){const it=new Set,nt=at=>{var ut,pt;if(!at.userData._variantMaterials||it.has(at))return;const mt=o?(ut=at.userData._variantMaterials[o])===null||ut===void 0?void 0:ut.material:at.userData._originalMaterial;mt&&(at.userData._originalMaterial||(at.userData._originalMaterial=at.material),(pt=at==null?void 0:at.setMaterial)===null||pt===void 0||pt.call(at,mt)),it.add(at)};_?_e.traverse(nt):nt(_e)}}}GLTFKHRMaterialVariantsPlugin.PluginType="GLTFKHRMaterialVariantsPlugin",GLTFKHRMaterialVariantsPlugin_decorate([x$1(GLTFKHRMaterialVariantsPlugin.prototype._variantChanged)],GLTFKHRMaterialVariantsPlugin.prototype,"selectedVariant",void 0);var edgeMask="uniform vec2 screenSize;uniform sampler2D tNormalDepth;uniform sampler2D tNormalBuffer;uniform sampler2D tGBufferFlags;uniform float radius;uniform vec2 cameraNearFar;uniform vec3 cameraPositionWorld;const float depthStep=0.2;const float normalThreshold=0.9;float unpack16(vec2 value){return(value.x*0.996108949416342426275150501169264316558837890625+value.y*0.00389105058365758760263730664519243873655796051025390625);}vec3 unpackNormal(vec2 enc){vec2 fenc=enc*4.-2.;float f=dot(fenc,fenc);float g=sqrt(1.-f/4.);return vec3(fenc*g,1.-f/2.);}void lookupNormalDepth(out float depth,out vec3 normal,vec2 off){vec2 uv=(gl_FragCoord.st+off)/screenSize;vec4 texel=texture2D(tNormalDepth,uv);depth=mix(cameraNearFar.x,cameraNearFar.y,pow(unpack16(texel.xy),2.));normal=2.*texture2D(tNormalBuffer,uv).rgb-1.;}float getBorderWeight(){float depth1,depth2,depth3,depth4;vec3 normal1,normal2,normal3,normal4;float d_=dot(cameraPositionWorld,cameraPositionWorld);float radiusModifier=clamp(3./(1.+pow(abs(d_),0.5)),0.,1.);float modRad=radius;lookupNormalDepth(depth1,normal1,vec2(0.,modRad));lookupNormalDepth(depth2,normal2,vec2(0.,-modRad));lookupNormalDepth(depth3,normal3,vec2(modRad,0.));lookupNormalDepth(depth4,normal4,vec2(-modRad,0.));vec2 uv=(gl_FragCoord.st)/screenSize;float mask=step(0.0001,texture2D(tGBufferFlags,uv).g);float mask1=texture2D(tGBufferFlags,uv+vec2(0.,modRad)/screenSize).b*255.;float mask2=texture2D(tGBufferFlags,uv+vec2(0.,-modRad)/screenSize).b*255.;float mask3=texture2D(tGBufferFlags,uv+vec2(modRad,0.)/screenSize).b*255.;float mask4=texture2D(tGBufferFlags,uv+vec2(-modRad,0.)/screenSize).b*255.;float maskWeight=max(abs(mask1-mask2),abs(mask3-mask4))*255.;maskWeight=(step(maskWeight,0.01));float a1=dot(normal1,normal2);float a2=dot(normal3,normal4);float normalWeight=min(abs(a1),abs(a2));normalWeight=1.-step(normalThreshold,normalWeight);float depthWeight=max(abs(depth1-depth2),abs(depth3-depth4));depthWeight=(step(depthWeight,depthStep));return normalWeight*depthWeight*maskWeight*mask;}void main(){float weight=getBorderWeight();vec2 uv=gl_FragCoord.st/screenSize;vec4 texel=texture2D(tNormalDepth,uv);float depth=pow(unpack16(texel.xy),2.);vec3 outColor=vec3(0.);if(depth>0.999){weight=0.;}else{outColor=vec3(weight);}gl_FragColor=vec4(outColor,1.);}",seperableBlurShaderMasked="varying vec2 vUv;uniform sampler2D colorTexture;uniform sampler2D maskTexture;uniform vec2 texSize;uniform vec2 direction;float gaussianPdf(in float x,in float sigma){return 0.39894*exp(-0.5*x*x/(sigma*sigma))/sigma;}void main(){vec2 invSize=1./texSize;float fSigma=float(SIGMA);float weightSum=gaussianPdf(0.,fSigma);vec4 mask=texture2D(maskTexture,vUv);vec3 diffuseSum=texture2D(colorTexture,vUv).rgb*weightSum;for(int i=1;i<KERNEL_RADIUS;i++){float x=float(i);float w=gaussianPdf(x,fSigma);vec2 uvOffset=direction*invSize*x;vec3 sample1=texture2D(colorTexture,vUv+uvOffset).rgb;vec3 sample2=texture2D(colorTexture,vUv-uvOffset).rgb;diffuseSum+=(sample1+sample2)*w;weightSum+=2.*w;}gl_FragColor=vec4(diffuseSum/weightSum,1.);}",blurNormal=`uniform sampler2D tNormalBuffer;uniform sampler2D edgeMaskBuffer;uniform vec2 screenSize;uniform float dpr;const float depthStep=0.02;uniform vec2 samples[NUM_SAMPLES];uniform vec3 cameraPositionWorld;varying vec2 vUv;
#include <common>
float getBevelRadius(in float number){return floor(number/8.);}vec3 smoothNormal(){vec2 uv=gl_FragCoord.xy/screenSize;vec4 texel=texture2D(tNormalDepth,uv);vec4 edgeMask=texture2D(edgeMaskBuffer,uv);vec3 avgNormal=2.*texture2D(tNormalBuffer,uv).rgb-1.;float depth=pow(unpack16(texel.xy),2.);vec2 invScreenSize=vec2(1.)/screenSize;vec4 mask=texture2D(tGBufferFlags,uv);float weightSum=0.;float radius=getBevelRadius(mask.g*255.)*2.*dpr;float randomAngle=6.2*random(frameCount*0.1);float theta=randomAngle;float snTheta=sin(theta);float csTheta=cos(theta);mat2 randomRotationMatrix=mat2(csTheta,snTheta,-snTheta,csTheta);float d_=dot(cameraPositionWorld,cameraPositionWorld);float radiusModifier=clamp(1./(1.+pow(abs(d_),0.5)),0.,1.);for(int i=0;i<5;i++){float x=float(i)-2.;for(int j=0;j<5;j++){float y=float(j)-2.;vec2 offset=randomRotationMatrix*vec2(x,y)*radius*radiusModifier*invScreenSize;vec4 texel=texture2D(tNormalDepth,uv+offset);float offsetDepth=pow(unpack16(texel.xy),2.);float depthWeight=abs(offsetDepth-depth);depthWeight=(1.-step(depthStep,depthWeight));vec3 offsetNormal=2.*texture2D(tNormalBuffer,uv+offset).rgb-1.;if(dot(offsetNormal,offsetNormal)>0.){avgNormal+=offsetNormal*depthWeight;}}}return normalize(avgNormal);}void main(){vec2 uv=gl_FragCoord.xy/screenSize;vec4 edgeMask=texture2D(edgeMaskBuffer,uv);vec3 normal=vec3(0.);if(edgeMask.x>0.){normal=smoothNormal();}else{normal=2.*texture2D(tNormalBuffer,uv).rgb-1.;}gl_FragColor=vec4(vec3(0.5*normal+0.5),1.);}`,SSBevelPass_decorate=function(h,o,c,d){var _,b=arguments.length,_e=b<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_e=Reflect.decorate(h,o,c,d);else for(var it=h.length-1;it>=0;it--)(_=h[it])&&(_e=(b<3?_(_e):b>3?_(o,c,_e):_(o,c))||_e);return b>3&&_e&&Object.defineProperty(o,c,_e),_e};function addSSBevel(h){const o=h==null?void 0:h.userData;if(!o)return!1;o._ssBevel||(o._ssBevel={});const c=o._ssBevel;return c.hasSSBevel=!0,c.radius===void 0&&(c.radius=0),h.isMaterial&&(h.needsUpdate=!0),!0}let SSBevelPass=class extends ShaderPass2{constructor(h,o,c,d){super({defines:{NUM_SAMPLES:16},uniforms:{tNormalDepth:{value:null},tNormalBuffer:{value:null},tGBufferFlags:{value:null},edgeMaskBuffer:{value:null},screenSize:{value:new three_module.I9Y},radius:{value:1},samples:{value:null},frameCount:{value:0},dpr:{value:1},cameraPositionWorld:{value:new three_module.Pq0(1,1,1)}},vertexShader:defaultVertex,fragmentShader:`

            ${c}

            ${randomHelpers}

            ${blurNormal}
            
            `},"tDiffuse"),this.uiConfig=void 0,this.sceneBevel=!1,this.sceneBevelRadius=2,this.materialExtension={shaderExtender:(_,b,_e)=>{var it,nt;const at=(nt=(it=b.materialObject.userData)===null||it===void 0?void 0:it._ssBevel)===null||nt===void 0?void 0:nt.hasSSBevel;!this.enabled||this.sceneBevel&&at===!1||!this.sceneBevel&&!at||(_.fragmentShader=shaderReplaceString(_.fragmentShader,"#include <normal_fragment_maps>",` 
                normal = 2. * texture2D(tSSBevelMap, viewToScreen(vViewPosition.xyz).xy).rgb - 1.;
                normal = normalize(normal);
            `))},onObjectRender:(_,b,_e)=>{var it,nt;const at=(nt=(it=b.materialObject.userData)===null||it===void 0?void 0:it._ssBevel)===null||nt===void 0?void 0:nt.hasSSBevel;if(!this.enabled||this.sceneBevel&&at===!1||!this.sceneBevel&&!at)return;const ut=b.materialObject,pt=this._target.texture;this.materialExtension.extraUniforms.tSSBevelMap.value!==pt&&(this.materialExtension.extraUniforms.tSSBevelMap.value=pt,ut.needsUpdate=!0)},getUiConfig:_=>{const b={type:"folder",label:"SSBevel (Dev)",children:[{type:"checkbox",label:"Enabled",get value(){var _e;return((_e=_.materialObject.userData._ssBevel)===null||_e===void 0?void 0:_e.hasSSBevel)||!1},set value(_e){var it,nt;_e!==((it=_.materialObject.userData._ssBevel)===null||it===void 0?void 0:it.hasSSBevel)&&(_e?addSSBevel(_.materialObject)||alert("Cannot add screen space bevel."):_.materialObject.userData._ssBevel&&(_.materialObject.userData._ssBevel.hasSSBevel=!1,_.materialObject.needsUpdate=!0),(nt=b.uiRefresh)===null||nt===void 0||nt.call(b,"postFrame",!0))},onChange:this.setDirty},()=>({type:"slider",bounds:[0,16],label:"radius",hidden:()=>{var _e;return!(!((_e=_.materialObject.userData._ssBevel)===null||_e===void 0)&&_e.hasSSBevel)},property:[_.materialObject.userData._ssBevel,"radius"],onChange:this.setDirty})]};return b},parsFragmentSnippet:(_,b)=>{var _e,it;const nt=(it=(_e=b==null?void 0:b.materialObject.userData)===null||_e===void 0?void 0:_e._ssBevel)===null||it===void 0?void 0:it.hasSSBevel;return!this.enabled||this.sceneBevel&&nt===!1||!this.sceneBevel&&!nt?"":fe$1`
            uniform sampler2D tSSBevelMap;
            ${simpleCameraHelpers}
            `},extraUniforms:{tSSBevelMap:{value:null}},computeCacheKey:_=>{var b,_e;return(this.enabled?"1":"0")+(this.sceneBevel?"1":"0")+(!((_e=(b=_.materialObject.userData)===null||b===void 0?void 0:b._ssBevel)===null||_e===void 0)&&_e.hasSSBevel?"1":"0")},isCompatible:_=>_.isMeshStandardMaterial2},this._target=o,this.needsSwap=!1,this.clear=!0,this._viewerApp=d,this._edgeMaterial=new ShaderMaterial2({uniforms:{tNormalDepth:{value:null},tNormalBuffer:{value:null},tGBufferFlags:{value:null},screenSize:{value:null},radius:{value:10},cameraNearFar:{value:new three_module.I9Y(1,1)},cameraPositionWorld:{value:new three_module.Pq0(1,1,1)}},vertexShader:defaultVertex,fragmentShader:edgeMask}),this._separableBlurMaterial=new ShaderMaterial2({defines:{KERNEL_RADIUS:3,SIGMA:3},uniforms:{colorTexture:{value:null},maskTexture:{value:null},texSize:{value:new three_module.I9Y(.5,.5)},direction:{value:new three_module.I9Y(.5,.5)}},vertexShader:defaultVertex,fragmentShader:seperableBlurShaderMasked})}render(h,o,c,d,_){var b,_e;if(!this.enabled)return;const it=h.baseRenderer,nt={minFilter:three_module.k6q,magFilter:three_module.k6q,isAntialiased:!1,format:three_module.GWd,depthBuffer:!1,generateMipmaps:!1},at=it.getTempTarget(nt);this._renderEdges(it,at),this._blurEdges(it,at),this._viewerApp.scene.renderCamera.updateShaderProperties(this.material),(b=this._viewerApp.getPlugin(GBufferPlugin))===null||b===void 0||b.updateShaderProperties(this.material),(_e=this._viewerApp.getPlugin(NormalBufferPlugin))===null||_e===void 0||_e.updateShaderProperties(this.material),this._viewerApp.renderer.updateShaderProperties(this.material),this.uniforms.edgeMaskBuffer.value=at.texture,this.uniforms.dpr.value=this._viewerApp.renderer.displayCanvasScaling,super.render(h,this._target,at,d,_),it.releaseTempTarget(at)}_initsamples(){const h=[];return h.push(new three_module.I9Y(-8,0).multiplyScalar(.125)),h.push(new three_module.I9Y(-6,-4).multiplyScalar(.125)),h.push(new three_module.I9Y(-3,-2).multiplyScalar(.125)),h.push(new three_module.I9Y(-2,-6).multiplyScalar(.125)),h.push(new three_module.I9Y(1,-1).multiplyScalar(.125)),h.push(new three_module.I9Y(2,-5).multiplyScalar(.125)),h.push(new three_module.I9Y(6,-7).multiplyScalar(.125)),h.push(new three_module.I9Y(5,-3).multiplyScalar(.125)),h.push(new three_module.I9Y(4,1).multiplyScalar(.125)),h.push(new three_module.I9Y(7,4).multiplyScalar(.125)),h.push(new three_module.I9Y(3,5).multiplyScalar(.125)),h.push(new three_module.I9Y(0,7).multiplyScalar(.125)),h.push(new three_module.I9Y(-1,3).multiplyScalar(.125)),h.push(new three_module.I9Y(-4,6).multiplyScalar(.125)),h.push(new three_module.I9Y(-7,8).multiplyScalar(.125)),h.push(new three_module.I9Y(-5,2).multiplyScalar(.125)),h}_blurEdges(h,o){var c,d;const _={minFilter:three_module.k6q,magFilter:three_module.k6q,isAntialiased:!1,format:three_module.GWd,depthBuffer:!1,generateMipmaps:!1,sizeMultiplier:.5},b=h.getTempTarget(_),_e=((c=o.texture.image)===null||c===void 0?void 0:c.width)||1,it=((d=o.texture.image)===null||d===void 0?void 0:d.height)||1;this._separableBlurMaterial.uniforms.texSize.value=new three_module.I9Y(_e,it),this._separableBlurMaterial.uniforms.colorTexture.value=o.texture,this._separableBlurMaterial.uniforms.direction.value=new three_module.I9Y(1,0),h.blit(void 0,b,{material:this._separableBlurMaterial}),this._separableBlurMaterial.uniforms.texSize.value=new three_module.I9Y(_e/2,it/2),this._separableBlurMaterial.uniforms.colorTexture.value=b.texture,this._separableBlurMaterial.uniforms.direction.value=new three_module.I9Y(0,1),h.blit(void 0,o,{material:this._separableBlurMaterial}),h.releaseTempTarget(b)}_renderEdges(h,o){var c,d,_,b;const _e=((c=o.texture.image)===null||c===void 0?void 0:c.width)||1,it=((d=o.texture.image)===null||d===void 0?void 0:d.height)||1;this._edgeMaterial.uniforms.screenSize.value=new three_module.I9Y(_e,it),this._viewerApp.scene.renderCamera.updateShaderProperties(this._edgeMaterial),(_=this._viewerApp.getPlugin(GBufferPlugin))===null||_===void 0||_.updateShaderProperties(this._edgeMaterial),(b=this._viewerApp.getPlugin(NormalBufferPlugin))===null||b===void 0||b.updateShaderProperties(this._edgeMaterial),h.blit(void 0,o,{material:this._edgeMaterial})}};SSBevelPass_decorate([uiToggle("Scene Bevel"),serialize(),x$1(SSBevelPass.prototype.setDirty)],SSBevelPass.prototype,"sceneBevel",void 0),SSBevelPass_decorate([uiSlider("Scene Bevel Radius",[0,8],.1),serialize(),x$1(SSBevelPass.prototype.setDirty)],SSBevelPass.prototype,"sceneBevelRadius",void 0),SSBevelPass=SSBevelPass_decorate([uiFolder("SSBevel")],SSBevelPass);class SSBevelPlugin extends GenericFilterPlugin{get bevelTarget(){return this._bevelTarget}constructor(o=!0){super(),this.passId="ssBevel",this._beforeFilters=["render"],this._afterFilters=["gbuffer","normalBuffer"],this._requiredFilters=["render","gbuffer","normalBuffer"],this._lastEnabled=!1,this.dependencies=[AssetManagerPlugin,GBufferPlugin,NormalBufferPlugin],this.enabled=o,this.setDirty=this.setDirty.bind(this),this._loaderCreate=this._loaderCreate.bind(this),this.updateGBuffer=this.updateGBuffer.bind(this)}_loaderCreate({loader:o}){o.isGLTFLoader2&&o.register(c=>new GLTFMaterialsSSBevelExtensionImport(c))}passCtor(o){var c,d;return this._bevelTarget=o.renderer.createTarget({depthBuffer:!0,type:three_module.ix0,minFilter:three_module.hxR,magFilter:three_module.hxR,generateMipmaps:!1}),this._bevelTarget.texture.name="bevelBuffer",this._bevelTarget.texture.generateMipmaps=!1,o.getPluginByType("debug"),new SSBevelPass(o.renderer,this._bevelTarget,(d=(c=o.getPlugin(GBufferPlugin))===null||c===void 0?void 0:c.getUnpackSnippet())!==null&&d!==void 0?d:"",o)}async onAdded(o){var c,d,_,b,_e,it,nt,at;await super.onAdded(o);const ut=o.getPlugin(AssetManagerPlugin);return!((c=this.pass)===null||c===void 0)&&c.passObject.materialExtension&&((d=ut==null?void 0:ut.materials)===null||d===void 0||d.registerMaterialExtension((_=this.pass)===null||_===void 0?void 0:_.passObject.materialExtension)),(b=ut==null?void 0:ut.importer)===null||b===void 0||b.addEventListener("loaderCreate",this._loaderCreate),(nt=(it=(_e=ut==null?void 0:ut.exporter)===null||_e===void 0?void 0:_e.getExporter("gltf","glb"))===null||it===void 0?void 0:it.extensions)===null||nt===void 0||nt.push(glTFMaterialsSSBevelExtensionExport),(at=o.getPlugin(GBufferPlugin))===null||at===void 0||at.registerGBufferUpdater(this.updateGBuffer),super.onAdded(o)}async onRemove(o){return o.renderer.disposeTarget(this._bevelTarget),super.onRemove(o)}setDirty(){var o,c,d,_;(o=this._viewer)===null||o===void 0||o.setDirty(),(_=(c=this.pass)===null||c===void 0?void 0:(d=c.passObject.materialExtension).setDirty)===null||_===void 0||_.call(d)}_update(o){var c,d;let _=this.enabled;if(_&&!this._lastEnabled){const b=(c=this._viewer)===null||c===void 0?void 0:c.getPluginByType("NormalBufferPlugin");b&&!b.enabled&&(b.enabled=!0),b||(d=this._viewer)===null||d===void 0||d.console.error("SSBevelPlugin needs NormalBufferPlugin")}return this._lastEnabled=_,_}get uiConfig(){var o,c,d,_,b;const _e=(d=(c=(o=this.pass)===null||o===void 0?void 0:o.passObject)===null||c===void 0?void 0:c.uiConfig)!==null&&d!==void 0?d:{};return(b=(_=_e.children)===null||_===void 0?void 0:_.map(it=>Ee$1(it)))===null||b===void 0||b.flat(2).forEach(it=>it&&(it.onChange=this.setDirty)),_e}updateGBuffer(o,c){var d,_,b,_e;if(!((d=this._pass)===null||d===void 0)&&d.passObject&&o.isMesh&&!((_=o.material)===null||_===void 0)&&_.userData){for(let at=3;at<8;at++)c.y=clearBit(c.y,at);const it=(_e=(b=o.material)===null||b===void 0?void 0:b.userData)===null||_e===void 0?void 0:_e._ssBevel;let nt=this._pass.passObject.sceneBevel&&!(it!=null&&it.hasSSBevel)?this._pass.passObject.sceneBevelRadius:(it==null?void 0:it.radius)||0;nt=Math.min(nt,31),nt<<=3,c.y=c.y|nt}}getBevelMaterials(){var o;const c=new Set;return(o=this._viewer)===null||o===void 0||o.scene.modelRoot.traverse(d=>{var _,b;!((b=(_=d.material)===null||_===void 0?void 0:_.userData)===null||b===void 0)&&b._ssBevel.hasSSBevel&&c.add(d.material)}),Array.from(c)}}SSBevelPlugin.PluginType="SSBevelPlugin",SSBevelPlugin.SSBEVEL_GLTF_EXTENSION="WEBGI_materials_ssbevel";class GLTFMaterialsSSBevelExtensionImport{constructor(o){this.parser=o,this.name=SSBevelPlugin.SSBEVEL_GLTF_EXTENSION}async extendMaterialParams(o,c){const d=this.parser.json.materials[o];if(!d.extensions||!d.extensions[this.name])return Promise.resolve();const _=d.extensions[this.name];return c.userData||(c.userData={}),addSSBevel(c),c.userData._ssBevel=deserializeObject(_,c.userData._ssBevel,!1,{}),Promise.resolve()}}const glTFMaterialsSSBevelExtensionExport=h=>({writeMaterial:(o,c)=>{if(!o.isMeshStandardMaterial||!o.userData._ssBevel||!o.userData._ssBevel.hasSSBevel)return;c.extensions=c.extensions||{};const d=serializeObject(o.userData._ssBevel,!1);c.extensions[SSBevelPlugin.SSBEVEL_GLTF_EXTENSION]=d,h.extensionsUsed[SSBevelPlugin.SSBEVEL_GLTF_EXTENSION]=!0}});class GammaCorrectionExtension{constructor(){this.uiConfig=void 0,this.enabled=!0}shaderExtender(o,c,d){this.enabled&&(o.fragmentShader=shaderReplaceString(o.fragmentShader,"#glMarker",` 
            gl_FragColor = LinearTosRGB(gl_FragColor);
            #glMarker
        `))}computeCacheKey(o){return this.enabled?"1":"0"}isCompatible(o){return!0}}class GammaCorrectionPlugin extends GenericExtensionPlugin{generateExtension(o){return new GammaCorrectionExtension}}GammaCorrectionPlugin.PluginType="GammaCorrection";var triplanarmapping="struct TriplanarUV{vec2 x;vec2 y;vec2 z;};uniform float triplanarScale;uniform float triplanarBlend;uniform float triplanarOffset;vec3 getTriplanarWeights(in vec3 position,in vec3 normal){vec3 triW=abs(normal);triW=clamp(triW-vec3(triplanarOffset),vec3(0.),vec3(1.));triW=pow(triW,vec3(triplanarBlend));return triW/(triW.x+triW.y+triW.z);}TriplanarUV getTriplanarUV(in vec3 position,in vec3 normal){TriplanarUV triUV;triUV.x=position.zy*triplanarScale;triUV.y=position.xz*triplanarScale;triUV.z=position.xy*triplanarScale;if(normal.x<0.){triUV.x.x=-triUV.x.x;}if(normal.y<0.){triUV.y.x=-triUV.y.x;}if(normal.z>=0.){triUV.z.x=-triUV.z.x;}return triUV;}vec4 textureTriplanar(in sampler2D tex,in vec3 position,in vec3 normal){TriplanarUV triUV=getTriplanarUV(position,normal);vec4 texX=texture2D(tex,triUV.x);vec4 texY=texture2D(tex,triUV.y);vec4 texZ=texture2D(tex,triUV.z);vec3 triW=getTriplanarWeights(position,normal);return texX*triW.x+texY*triW.y+texZ*triW.z;}",TriplanarUVMappingPlugin_decorate=function(h,o,c,d){var _,b=arguments.length,_e=b<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_e=Reflect.decorate(h,o,c,d);else for(var it=h.length-1;it>=0;it--)(_=h[it])&&(_e=(b<3?_(_e):b>3?_(o,c,_e):_(o,c))||_e);return b>3&&_e&&Object.defineProperty(o,c,_e),_e};let TriplanarUVMappingPlugin=class extends AViewerPlugin{addTriplanarMapping(h){var o;const c=(o=h.materialObject)===null||o===void 0?void 0:o.userData;return!!c&&(c._triplanarMapping||(c._triplanarMapping={}),c._triplanarMapping.enable=!0,c._triplanarMapping.scaleFactor===void 0&&(c._triplanarMapping.scaleFactor=1),c._triplanarMapping.blendFactor===void 0&&(c._triplanarMapping.blendFactor=1),c._triplanarMapping.offsetFactor===void 0&&(c._triplanarMapping.offsetFactor=0),h.materialObject.needsUpdate=!0,!0)}_loaderCreate({loader:h}){h.isGLTFLoader2&&h.register(o=>new GLTFMaterialsTriplanarMappingExtensionImport(o))}constructor(){super(),this.enabled=!0,this.dependencies=[AssetManagerPlugin],this._uniforms={triplanarScale:{value:1},triplanarBlend:{value:1},triplanarOffset:{value:0}},this.materialExtension={shaderExtender:(h,o,c)=>{var d,_;if(!this.enabled||!(!((_=(d=o.materialObject.userData)===null||d===void 0?void 0:d._triplanarMapping)===null||_===void 0)&&_.enable))return;const b=fe$1`
                #ifndef USE_TRANSMISSION
                    varying vec3 vWorldPosition;
                #endif
                varying vec3 vWorldNormal;
            `;h.vertexShader=shaderReplaceString(h.vertexShader,"#include <common>",b,{prepend:!0});const _e=fe$1`
                // same as worldpos_vertex.glsl.js but added a !
                #if !(defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0)
                vec4 worldPosition = vec4( transformed, 1.0 );
                #ifdef USE_INSTANCING
                worldPosition = instanceMatrix * worldPosition;
                #endif
                worldPosition = modelMatrix * worldPosition;
                #endif
                
                #ifndef USE_TRANSMISSION
                    vWorldPosition = worldPosition.xyz; 
                #endif
                vWorldNormal = normalize((modelMatrix * vec4(objectNormal, 0.)).xyz);
            `;h.vertexShader=shaderReplaceString(h.vertexShader,"#include <worldpos_vertex>",_e,{append:!0});const it=fe$1`
                ${triplanarmapping}
                #ifndef USE_TRANSMISSION
                    varying vec3 vWorldPosition;
                #endif
                varying vec3 vWorldNormal;
            `;h.fragmentShader=shaderReplaceString(h.fragmentShader,"#include <common>",it,{prepend:!0});const nt=fe$1`

            #ifdef USE_BUMPMAP

            uniform sampler2D bumpMap;
            uniform float bumpScale;

            // Bump Mapping Unparametrized Surfaces on the GPU by Morten S. Mikkelsen
            // https://mmikk.github.io/papers3d/mm_sfgrad_bump.pdf

            // Evaluate the derivative of the height w.r.t. screen-space using forward differencing (listing 2)

            vec2 dHdxy_fwd() {

                vec3 dSTdx = dFdx( vWorldPosition );
                vec3 dSTdy = dFdy( vWorldPosition );

                vec3 normal_ = normalize(vWorldNormal);
                float Hll = bumpScale * textureTriplanar( bumpMap, vWorldPosition, normal_ ).x;
                float dBx = bumpScale * textureTriplanar( bumpMap, vWorldPosition + dSTdx, normal_ ).x - Hll;
                float dBy = bumpScale * textureTriplanar( bumpMap, vWorldPosition + dSTdy, normal_ ).x - Hll;

                return vec2( dBx, dBy );

            }

            vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {

                vec3 vSigmaX = dFdx( surf_pos.xyz );
                vec3 vSigmaY = dFdy( surf_pos.xyz );
                vec3 vN = surf_norm; // normalized

                vec3 R1 = cross( vSigmaY, vN );
                vec3 R2 = cross( vN, vSigmaX );

                float fDet = dot( vSigmaX, R1 ) * faceDirection;

                vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
                return normalize( abs( fDet ) * surf_norm - vGrad );

            }

        #endif
            `;h.fragmentShader=shaderReplaceString(h.fragmentShader,"#include <bumpmap_pars_fragment>",nt);let at=shaderReplaceString(three_module.vxI.map_fragment,"texture2D( map, vMapUv );","textureTriplanar( map, vWorldPosition, normalize(vWorldNormal) );");h.fragmentShader=shaderReplaceString(h.fragmentShader,"#include <map_fragment>",at),at=shaderReplaceString(three_module.vxI.roughnessmap_fragment,"texture2D( roughnessMap, vRoughnessMapUv );","textureTriplanar( roughnessMap, vWorldPosition, normalize(vWorldNormal));"),h.fragmentShader=shaderReplaceString(h.fragmentShader,"#include <roughnessmap_fragment>",at),at=shaderReplaceString(three_module.vxI.metalnessmap_fragment,"texture2D( metalnessMap, vMetalnessMapUv );","textureTriplanar( metalnessMap, vWorldPosition, normalize(vWorldNormal));"),h.fragmentShader=shaderReplaceString(h.fragmentShader,"#include <metalnessmap_fragment>",at),at=shaderReplaceString(three_module.vxI.normal_fragment_maps,"vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;","vec3 mapN = textureTriplanar( normalMap, vWorldPosition, normalize(vWorldNormal) ).xyz * 2.0 - 1.0;"),h.fragmentShader=shaderReplaceString(h.fragmentShader,"#include <normal_fragment_maps>",at),h.defines.USE_UV=""},onObjectRender:(h,o)=>{var c,d,_,b;const _e=o.materialObject.userData;if(!(!((c=_e==null?void 0:_e._triplanarMapping)===null||c===void 0)&&c.enable))return;const it=h;it.isMesh&&it.geometry&&(this._uniforms.triplanarScale.value=(d=_e._triplanarMapping)===null||d===void 0?void 0:d.scaleFactor,this._uniforms.triplanarBlend.value=(_=_e._triplanarMapping)===null||_===void 0?void 0:_.blendFactor,this._uniforms.triplanarOffset.value=(b=_e._triplanarMapping)===null||b===void 0?void 0:b.offsetFactor)},extraUniforms:{...this._uniforms},computeCacheKey:h=>{var o,c;return(this.enabled?"1":"0")+(!((c=(o=h.materialObject.userData)===null||o===void 0?void 0:o._triplanarMapping)===null||c===void 0)&&c.enable?"1":"0")},isCompatible:h=>h.isMeshStandardMaterial2,updaters:()=>{var h;return[(h=this._viewer)===null||h===void 0?void 0:h.renderer]},getUiConfig:h=>{const o=this._viewer,c=this.addTriplanarMapping,d={type:"folder",label:"Triplanar",children:[{type:"checkbox",label:"Enabled",get value(){var _;return((_=h.materialObject.userData._triplanarMapping)===null||_===void 0?void 0:_.enable)||!1},set value(_){var b,_e;_!==((b=h.materialObject.userData._triplanarMapping)===null||b===void 0?void 0:b.enable)&&(_?c(h)||o.alert("Cannot add Triplanar mapping."):h.materialObject.userData._triplanarMapping&&(h.materialObject.userData._triplanarMapping.enable=!1,h.materialObject.needsUpdate=!0),(_e=d.uiRefresh)===null||_e===void 0||_e.call(d,"postFrame",!0))},onChange:this.setDirty},()=>({type:"slider",bounds:[.1,10],label:"Scale",hidden:()=>{var _;return!(!((_=h.materialObject.userData._triplanarMapping)===null||_===void 0)&&_.enable)},property:[h.materialObject.userData._triplanarMapping,"scaleFactor"],onChange:this.setDirty}),()=>({type:"slider",bounds:[1,10],label:"Blend",hidden:()=>{var _;return!(!((_=h.materialObject.userData._triplanarMapping)===null||_===void 0)&&_.enable)},property:[h.materialObject.userData._triplanarMapping,"blendFactor"],onChange:this.setDirty}),()=>({type:"slider",bounds:[0,.5],stepSize:.01,label:"Offset",hidden:()=>{var _;return!(!((_=h.materialObject.userData._triplanarMapping)===null||_===void 0)&&_.enable)},property:[h.materialObject.userData._triplanarMapping,"offsetFactor"],onChange:this.setDirty})]};return d}},this.setDirty=()=>{var h,o,c;(o=(h=this.materialExtension).setDirty)===null||o===void 0||o.call(h),(c=this._viewer)===null||c===void 0||c.setDirty()},this._loaderCreate=this._loaderCreate.bind(this)}async onAdded(h){var o,c,d,_,b;await super.onAdded(h);const _e=h.getPlugin(AssetManagerPlugin);(o=_e==null?void 0:_e.materials)===null||o===void 0||o.registerMaterialExtension(this.materialExtension),(c=_e==null?void 0:_e.importer)===null||c===void 0||c.addEventListener("loaderCreate",this._loaderCreate),(b=(_=(d=_e==null?void 0:_e.exporter)===null||d===void 0?void 0:d.getExporter("gltf","glb"))===null||_===void 0?void 0:_.extensions)===null||b===void 0||b.push(glTFMaterialsTriplanarMappingExtensionExport)}async onRemove(h){var o,c,d,_;return(c=(o=h.getPlugin(AssetManagerPlugin))===null||o===void 0?void 0:o.materials)===null||c===void 0||c.unregisterMaterialExtension(this.materialExtension),(_=(d=h.getPlugin(AssetManagerPlugin))===null||d===void 0?void 0:d.importer)===null||_===void 0||_.removeEventListener("loaderCreate",this._loaderCreate),super.onRemove(h)}};TriplanarUVMappingPlugin.PluginType="TriplanarUVMappingPlugin",TriplanarUVMappingPlugin.TRIPLANAR_GLTF_EXTENSION="WEBGI_materials_triplanar",TriplanarUVMappingPlugin_decorate([uiToggle("Enabled",h=>({onChange:h.setDirty})),serialize()],TriplanarUVMappingPlugin.prototype,"enabled",void 0),TriplanarUVMappingPlugin=TriplanarUVMappingPlugin_decorate([uiFolder("Triplanar Mapping")],TriplanarUVMappingPlugin);class GLTFMaterialsTriplanarMappingExtensionImport{constructor(o){this.parser=o,this.name=TriplanarUVMappingPlugin.TRIPLANAR_GLTF_EXTENSION}async extendMaterialParams(o,c){const d=this.parser.json.materials[o];if(!d.extensions||!d.extensions[this.name])return Promise.resolve();const _=d.extensions[this.name];c.userData||(c.userData={});const b=c.userData;return b._triplanarMapping||(b._triplanarMapping={}),b._triplanarMapping.enable=!0,b._triplanarMapping.scaleFactor===void 0&&(b._triplanarMapping.scaleFactor=1),b._triplanarMapping.blendFactor===void 0&&(b._triplanarMapping.blendFactor=1),b._triplanarMapping.offsetFactor===void 0&&(b._triplanarMapping.offsetFactor=0),c.userData._triplanarMapping=deserializeObject(_,c.userData._triplanarMapping,!1,{}),Promise.resolve()}}const glTFMaterialsTriplanarMappingExtensionExport=h=>({writeMaterial:(o,c)=>{var d;if(!o.isMeshStandardMaterial||!(!((d=o.userData._triplanarMapping)===null||d===void 0)&&d.enable))return;c.extensions=c.extensions||{};const _=serializeObject(o.userData._triplanarMapping,!1);c.extensions[TriplanarUVMappingPlugin.TRIPLANAR_GLTF_EXTENSION]=_,h.extensionsUsed[TriplanarUVMappingPlugin.TRIPLANAR_GLTF_EXTENSION]=!0}});var sscurvature="uniform float cutoff;uniform vec3 cavityColor;uniform float cavityRoughness;uniform float cavityMetalness;uniform float cavityScale;uniform float stepSize;uniform sampler2D cavityMap;float getSSCurvature(in vec3 position,in vec3 normal){vec3 n=normalize(normal);vec3 dx=dFdx(n);vec3 dy=dFdy(n);vec3 xneg=n-stepSize*dx;vec3 xpos=n+stepSize*dx;vec3 yneg=n-stepSize*dy;vec3 ypos=n+stepSize*dy;float depth=length(position);float curvature=(cross(xneg,xpos).y-cross(yneg,ypos).x)*4./depth;return curvature;}",LayeredMaterialPlugin_decorate=function(h,o,c,d){var _,b=arguments.length,_e=b<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_e=Reflect.decorate(h,o,c,d);else for(var it=h.length-1;it>=0;it--)(_=h[it])&&(_e=(b<3?_(_e):b>3?_(o,c,_e):_(o,c))||_e);return b>3&&_e&&Object.defineProperty(o,c,_e),_e};let LayeredMaterialPlugin=class extends AViewerPlugin{addLayeredMaterial(h){var o;const c=(o=h.materialObject)===null||o===void 0?void 0:o.userData;return!!c&&(c._layeredMaterial||(c._layeredMaterial={}),c._layeredMaterial.enable=!0,c._layeredMaterial.cutoff===void 0&&(c._layeredMaterial.cutoff=-.65),c._layeredMaterial.cavityColor===void 0&&(c._layeredMaterial.cavityColor=new three_module.Q1f(5789527)),c._layeredMaterial.cavityRoughness===void 0&&(c._layeredMaterial.cavityRoughness=.5),c._layeredMaterial.cavityMetalness===void 0&&(c._layeredMaterial.cavityMetalness=.5),c._layeredMaterial.cavityScale===void 0&&(c._layeredMaterial.cavityScale=1),c._layeredMaterial.stepSize===void 0&&(c._layeredMaterial.stepSize=5),h.materialObject.needsUpdate=!0,!0)}_loaderCreate({loader:h}){h.isGLTFLoader2&&h.register(o=>new GLTFLayeredMaterialsExtensionImport(o))}constructor(){super(),this.enabled=!0,this.dependencies=[AssetManagerPlugin],this._uniforms={cutoff:{value:0},cavityColor:{value:new three_module.Q1f},cavityRoughness:{value:0},cavityMetalness:{value:0},cavityScale:{value:1},stepSize:{value:1}},this.materialExtension={shaderExtender:(h,o,c)=>{var d,_;if(!this.enabled||!(!((_=(d=o.materialObject.userData)===null||d===void 0?void 0:d._layeredMaterial)===null||_===void 0)&&_.enable))return;const b=fe$1`
                ${sscurvature}
            `;h.fragmentShader=shaderReplaceString(h.fragmentShader,"#include <common>",b,{prepend:!0});const _e=fe$1`
                material.roughness = min( material.roughness, 1.0 );
                float curvature = getSSCurvature(vViewPosition, normal);
                float smoothCurvature = smoothstep(0., 1., curvature - cutoff);
                material.roughness = min( material.roughness, 1.0 );
                curvature = curvature * cavityScale;
                smoothCurvature = smoothCurvature * cavityScale;
                smoothCurvature = min(smoothCurvature, 1.);
                vec3 finalCavityColor = mix(cavityColor, cavityColor*0.5, vec3(smoothCurvature));
                material.roughness = mix(cavityRoughness, material.roughness, smoothCurvature);
                material.diffuseColor = mix(finalCavityColor, material.diffuseColor, smoothCurvature);
            `,it=fe$1`
                material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
                material.specularColor = mix(material.specularColor, finalCavityColor, (1. - smoothCurvature) * cavityMetalness);
            `;let nt=three_module.vxI.lights_physical_fragment.replace("material.roughness = min( material.roughness, 1.0 );",_e);nt=nt.replace("material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );",it),h.fragmentShader=shaderReplaceString(h.fragmentShader,"#include <lights_physical_fragment>",nt);const at=fe$1`
                vec3 debugCurvatureColor = vec3(0., 0., 1.);
                float _epsilon = 1e-4;
                vec3 green = vec3(0., 0., 0.);
                vec3 red = vec3(1., 1., 1.);
                //if(curvature > cutoff)debugCurvatureColor = green;
                //if(curvature < cutoff)debugCurvatureColor = red;
                // curvature /= 2.;
                // curvature = curvature * 0.5 + 0.5;
                debugCurvatureColor = smoothstep(green, red, vec3(curvature - cutoff));
                //debugCurvatureColor = step(red, vec3(curvature - cutoff));
                //debugCurvatureColor = step(green, vec3(curvature - cutoff));
                //gl_FragColor = vec4(vec3(curvature), 1./16.);
            `;h.fragmentShader=shaderReplaceString(h.fragmentShader,"#include <dithering_fragment>",at),h.vertexUvs=!0},onObjectRender:(h,o)=>{var c,d,_,b,_e,it,nt;const at=o.materialObject.userData;if(!(!((c=at==null?void 0:at._layeredMaterial)===null||c===void 0)&&c.enable))return;const ut=h;ut.isMesh&&ut.geometry&&(this._uniforms.cutoff.value=(d=at._layeredMaterial)===null||d===void 0?void 0:d.cutoff,this._uniforms.cavityRoughness.value=(_=at._layeredMaterial)===null||_===void 0?void 0:_.cavityRoughness,this._uniforms.cavityMetalness.value=(b=at._layeredMaterial)===null||b===void 0?void 0:b.cavityMetalness,this._uniforms.cavityScale.value=(_e=at._layeredMaterial)===null||_e===void 0?void 0:_e.cavityScale,this._uniforms.stepSize.value=(it=at._layeredMaterial)===null||it===void 0?void 0:it.stepSize,this._uniforms.cavityColor.value.copy((nt=at._layeredMaterial)===null||nt===void 0?void 0:nt.cavityColor))},extraUniforms:{...this._uniforms},computeCacheKey:h=>{var o,c;return(this.enabled?"1":"0")+(!((c=(o=h.materialObject.userData)===null||o===void 0?void 0:o._layeredMaterial)===null||c===void 0)&&c.enable?"1":"0")},isCompatible:h=>h.isMeshStandardMaterial2,updaters:()=>{var h;return[(h=this._viewer)===null||h===void 0?void 0:h.renderer]},getUiConfig:h=>{const o=this._viewer,c=this.addLayeredMaterial,d={type:"folder",label:"LayeredMaterial",children:[{type:"checkbox",label:"Enabled",get value(){var _;return((_=h.materialObject.userData._layeredMaterial)===null||_===void 0?void 0:_.enable)||!1},set value(_){var b,_e;_!==((b=h.materialObject.userData._layeredMaterial)===null||b===void 0?void 0:b.enable)&&(_?c(h)||o.alert("Cannot add Triplanar mapping."):(h.materialObject.userData._layeredMaterial.enable=!1,h.materialObject.needsUpdate=!0),(_e=d.uiRefresh)===null||_e===void 0||_e.call(d,"postFrame",!0))},onChange:this.setDirty},()=>({type:"slider",bounds:[-1,1],stepSize:.001,label:"cutoff",hidden:()=>{var _;return!(!((_=h.materialObject.userData._layeredMaterial)===null||_===void 0)&&_.enable)},property:[h.materialObject.userData._layeredMaterial,"cutoff"],onChange:this.setDirty}),()=>({type:"color",label:"color",hidden:()=>{var _;return!(!((_=h.materialObject.userData._layeredMaterial)===null||_===void 0)&&_.enable)},property:[h.materialObject.userData._layeredMaterial,"cavityColor"],onChange:this.setDirty}),()=>({type:"slider",bounds:[0,1],stepSize:.01,label:"roughness",hidden:()=>{var _;return!(!((_=h.materialObject.userData._layeredMaterial)===null||_===void 0)&&_.enable)},property:[h.materialObject.userData._layeredMaterial,"cavityRoughness"],onChange:this.setDirty}),()=>({type:"slider",bounds:[.1,20],stepSize:.01,label:"Scale",hidden:()=>{var _;return!(!((_=h.materialObject.userData._layeredMaterial)===null||_===void 0)&&_.enable)},property:[h.materialObject.userData._layeredMaterial,"cavityScale"],onChange:this.setDirty}),()=>({type:"slider",bounds:[.1,100],stepSize:.01,label:"StepSize",hidden:()=>{var _;return!(!((_=h.materialObject.userData._layeredMaterial)===null||_===void 0)&&_.enable)},property:[h.materialObject.userData._layeredMaterial,"stepSize"],onChange:this.setDirty}),()=>({type:"slider",bounds:[0,1],stepSize:.01,label:"metalness",hidden:()=>{var _;return!(!((_=h.materialObject.userData._layeredMaterial)===null||_===void 0)&&_.enable)},property:[h.materialObject.userData._layeredMaterial,"cavityMetalness"],onChange:this.setDirty})]};return d}},this.setDirty=()=>{var h;(h=this._viewer)===null||h===void 0||h.setDirty()},this._loaderCreate=this._loaderCreate.bind(this)}async onAdded(h){var o,c,d,_,b;await super.onAdded(h);const _e=h.getPlugin(AssetManagerPlugin);(o=_e==null?void 0:_e.materials)===null||o===void 0||o.registerMaterialExtension(this.materialExtension),(c=_e==null?void 0:_e.importer)===null||c===void 0||c.addEventListener("loaderCreate",this._loaderCreate),(b=(_=(d=_e==null?void 0:_e.exporter)===null||d===void 0?void 0:d.getExporter("gltf","glb"))===null||_===void 0?void 0:_.extensions)===null||b===void 0||b.push(glTFLayeredMaterialsExtensionExport)}async onRemove(h){var o,c,d,_;return(c=(o=h.getPlugin(AssetManagerPlugin))===null||o===void 0?void 0:o.materials)===null||c===void 0||c.unregisterMaterialExtension(this.materialExtension),(_=(d=h.getPlugin(AssetManagerPlugin))===null||d===void 0?void 0:d.importer)===null||_===void 0||_.removeEventListener("loaderCreate",this._loaderCreate),super.onRemove(h)}};LayeredMaterialPlugin.PluginType="LayeredMaterialPlugin",LayeredMaterialPlugin.LAYERED_MATERIAL_GLTF_EXTENSION="WEBGI_materials_layered",LayeredMaterialPlugin_decorate([uiToggle("Enabled",h=>({onChange:h.setDirty})),serialize()],LayeredMaterialPlugin.prototype,"enabled",void 0),LayeredMaterialPlugin=LayeredMaterialPlugin_decorate([uiFolder("Layered Metal")],LayeredMaterialPlugin);class GLTFLayeredMaterialsExtensionImport{constructor(o){this.parser=o,this.name=LayeredMaterialPlugin.LAYERED_MATERIAL_GLTF_EXTENSION}async extendMaterialParams(o,c){const d=this.parser.json.materials[o];if(!d.extensions||!d.extensions[this.name])return Promise.resolve();const _=d.extensions[this.name];c.userData||(c.userData={});const b=c.userData;return b._layeredMaterial||(b._layeredMaterial={}),b._layeredMaterial.enable=!0,c.userData._layeredMaterial=deserializeObject(_,c.userData._layeredMaterial,!1,{}),Promise.resolve()}}const glTFLayeredMaterialsExtensionExport=h=>({writeMaterial:(o,c)=>{var d;if(!o.isMeshStandardMaterial||!(!((d=o.userData._layeredMaterial)===null||d===void 0)&&d.enable))return;c.extensions=c.extensions||{};const _=serializeObject(o.userData._layeredMaterial,!1);c.extensions[LayeredMaterialPlugin.LAYERED_MATERIAL_GLTF_EXTENSION]=_,h.extensionsUsed[LayeredMaterialPlugin.LAYERED_MATERIAL_GLTF_EXTENSION]=!0}});var ClearcoatTintPlugin_decorate=function(h,o,c,d){var _,b=arguments.length,_e=b<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_e=Reflect.decorate(h,o,c,d);else for(var it=h.length-1;it>=0;it--)(_=h[it])&&(_e=(b<3?_(_e):b>3?_(o,c,_e):_(o,c))||_e);return b>3&&_e&&Object.defineProperty(o,c,_e),_e};let ClearcoatTintPlugin=class extends AViewerPlugin{addClearcoatTint(h){return addClearcoatTint(h.materialObject)}_loaderCreate({loader:h}){h.isGLTFLoader2&&h.register(o=>new GLTFMaterialsClearcoatTintExtensionImport(o))}constructor(){super(),this.enabled=!0,this.dependencies=[AssetManagerPlugin],this._defines={},this._uniforms={ccTintColor:{value:new three_module.Q1f},ccThickness:{value:0},ccIor:{value:0}},this.materialExtension={parsFragmentSnippet:(h,o)=>{var c;return this.enabled&&!((c=o==null?void 0:o.materialObject.userData._clearcoatTint)===null||c===void 0)&&c.enableTint&&o.materialObject.clearcoat>0?`
uniform vec3 ccTintColor;
uniform float ccThickness;
uniform float ccIor;
vec3 clearcoatTint(const in float dotNV, const in float dotNL, const in float clearcoat) {
    vec3 tint = ( ccThickness > 0. ? 1. - ccTintColor : ccTintColor); // Set thickness < 0 for glow.
    tint = exp(tint * -(ccThickness * ((dotNL + dotNV) / max(dotNL * dotNV, 1e-3)))); // beer's law
    return mix(vec3(1.0), tint, clearcoat);
}
        `:""},shaderExtender:(h,o,c)=>{var d;if(!(this.enabled&&!((d=o==null?void 0:o.materialObject.userData._clearcoatTint)===null||d===void 0)&&d.enableTint&&o.materialObject.clearcoat>0))return;const _="outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;",b="float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );";h.fragmentShader.includes(b)&&h.fragmentShader.includes(_)||console.error("ClearcoatTintPlugin: shaderExtender cannot patch shader, version changed?"),h.fragmentShader=h.fragmentShader.replace(b,`
            float dotNVcc = saturate( dot( geometryClearcoatNormal, -refract(geometryViewDir, geometryClearcoatNormal, 1./ccIor) ) );
            `),h.fragmentShader=h.fragmentShader.replace(_,`
            outgoingLight *= clearcoatTint(dotNVcc, dotNVcc, material.clearcoat);
            `+_),h.defines.USE_UV=""},onObjectRender:(h,o)=>{var c;const d=(c=o.materialObject.userData)===null||c===void 0?void 0:c._clearcoatTint;if(!(d!=null&&d.enableTint))return;this._uniforms.ccTintColor.value.set(d.tintColor),this._uniforms.ccThickness.value=d.thickness,this._uniforms.ccIor.value=d.ior;const _=this.enabled?1:0;o.materialObject.defines.CLEARCOAT_TINT_ENABLED!==_&&(o.materialObject.defines.CLEARCOAT_TINT_ENABLED=_,o.materialObject.needsUpdate=!0)},extraUniforms:{...this._uniforms},computeCacheKey:h=>{var o,c;return(this.enabled?"1":"0")+(!((c=(o=h.materialObject.userData)===null||o===void 0?void 0:o._clearcoatTint)===null||c===void 0)&&c.enableTint?"1":"0")+(h.materialObject.clearcoat>0?"1":"0")},isCompatible:h=>h.isMeshStandardMaterial2,updaters:()=>[],getUiConfig:h=>{const o=this._viewer,c={type:"folder",label:"ClearcoatTint",children:[{type:"checkbox",label:"Enabled",get value(){var d;return((d=h.materialObject.userData._clearcoatTint)===null||d===void 0?void 0:d.enableTint)||!1},set value(d){var _,b;d!==((_=h.materialObject.userData._clearcoatTint)===null||_===void 0?void 0:_.enableTint)&&(d?addClearcoatTint(h.materialObject)||o.alert("Cannot add clearcoat tint."):h.materialObject.userData._clearcoatTint&&(h.materialObject.userData._clearcoatTint.enableTint=!1,h.materialObject.needsUpdate=!0),(b=c.uiRefresh)===null||b===void 0||b.call(c,"postFrame",!0))},onChange:this.setDirty},()=>({type:"color",label:"Tint color",hidden:()=>{var d;return!(!((d=h.materialObject.userData._clearcoatTint)===null||d===void 0)&&d.enableTint)},property:[h.materialObject.userData._clearcoatTint,"tintColor"],onChange:this.setDirty}),()=>({type:"input",label:"Thickness",hidden:()=>{var d;return!(!((d=h.materialObject.userData._clearcoatTint)===null||d===void 0)&&d.enableTint)},property:[h.materialObject.userData._clearcoatTint,"thickness"],onChange:this.setDirty}),()=>({type:"slider",bounds:[.8,2.5],label:"IOR",hidden:()=>{var d;return!(!((d=h.materialObject.userData._clearcoatTint)===null||d===void 0)&&d.enableTint)},property:[h.materialObject.userData._clearcoatTint,"ior"],onChange:this.setDirty})]};return c}},this.setDirty=()=>{var h,o,c;(o=(h=this.materialExtension).setDirty)===null||o===void 0||o.call(h),(c=this._viewer)===null||c===void 0||c.setDirty()},this._loaderCreate=this._loaderCreate.bind(this)}async onAdded(h){var o,c,d,_,b;await super.onAdded(h);const _e=h.getPlugin(AssetManagerPlugin);(o=_e==null?void 0:_e.materials)===null||o===void 0||o.registerMaterialExtension(this.materialExtension),(c=_e==null?void 0:_e.importer)===null||c===void 0||c.addEventListener("loaderCreate",this._loaderCreate),(b=(_=(d=_e==null?void 0:_e.exporter)===null||d===void 0?void 0:d.getExporter("gltf","glb"))===null||_===void 0?void 0:_.extensions)===null||b===void 0||b.push(glTFMaterialsClearcoatTintExtensionExport)}async onRemove(h){var o,c,d,_;return(c=(o=h.getPlugin(AssetManagerPlugin))===null||o===void 0?void 0:o.materials)===null||c===void 0||c.unregisterMaterialExtension(this.materialExtension),(_=(d=h.getPlugin(AssetManagerPlugin))===null||d===void 0?void 0:d.importer)===null||_===void 0||_.removeEventListener("loaderCreate",this._loaderCreate),super.onRemove(h)}};function addClearcoatTint(h){const o=h==null?void 0:h.userData;if(!o)return!1;o._clearcoatTint||(o._clearcoatTint={});const c=o._clearcoatTint;return c.enableTint=!0,c.tintColor===void 0&&(c.tintColor=16777215),c.thickness===void 0&&(c.thickness=.1),c.ior===void 0&&(c.ior=1.5),h.isMaterial&&(h.needsUpdate=!0),!0}ClearcoatTintPlugin.PluginType="ClearcoatTintPlugin",ClearcoatTintPlugin.CLEARCOAT_TINT_GLTF_EXTENSION="WEBGI_materials_clearcoat_tint",ClearcoatTintPlugin_decorate([uiToggle("Enabled",h=>({onChange:h.setDirty})),serialize()],ClearcoatTintPlugin.prototype,"enabled",void 0),ClearcoatTintPlugin=ClearcoatTintPlugin_decorate([uiFolder("ClearcoatTint Materials")],ClearcoatTintPlugin);class GLTFMaterialsClearcoatTintExtensionImport{constructor(o){this.parser=o,this.name=ClearcoatTintPlugin.CLEARCOAT_TINT_GLTF_EXTENSION}async extendMaterialParams(o,c){const d=this.parser.json.materials[o];if(!d.extensions||!d.extensions[this.name])return Promise.resolve();const _=d.extensions[this.name];return c.userData||(c.userData={}),addClearcoatTint(c),deserializeObject(_,c.userData._clearcoatTint,!1,{}),Promise.resolve()}}const glTFMaterialsClearcoatTintExtensionExport=h=>({writeMaterial:(o,c)=>{if(!o.isMeshStandardMaterial||!o.userData._clearcoatTint||!o.userData._clearcoatTint.enableTint)return;c.extensions=c.extensions||{};const d=serializeObject(o.userData._clearcoatTint,!1);c.extensions[ClearcoatTintPlugin.CLEARCOAT_TINT_GLTF_EXTENSION]=d,h.extensionsUsed[ClearcoatTintPlugin.CLEARCOAT_TINT_GLTF_EXTENSION]=!0}});class WorkerPool{constructor(o=4){this.pool=o,this.queue=[],this.workers=[],this.workersResolve=[],this.workerStatus=0}_initWorker(o){if(!this.workers[o]){const c=this.workerCreator();c.addEventListener("message",this._onMessage.bind(this,o)),this.workers[o]=c}}_getIdleWorker(){for(let o=0;o<this.pool;o++)if(!(this.workerStatus&1<<o))return o;return-1}_onMessage(o,c){const d=this.workersResolve[o];if(d&&d(c),this.queue.length){const{resolve:_,msg:b,transfer:_e}=this.queue.shift();this.workersResolve[o]=_,this.workers[o].postMessage(b,_e)}else this.workerStatus^=1<<o}setWorkerCreator(o){this.workerCreator=o}setWorkerLimit(o){this.pool=o}postMessage(o,c){return new Promise(d=>{const _=this._getIdleWorker();_!==-1?(this._initWorker(_),this.workerStatus|=1<<_,this.workersResolve[_]=d,this.workers[_].postMessage(o,c)):this.queue.push({resolve:d,msg:o,transfer:c})})}dispose(){this.workers.forEach(o=>o.terminate()),this.workersResolve.length=0,this.workers.length=0,this.queue.length=0,this.workerStatus=0}}const ktx_parse_module_t=0,n$2=2,ktx_parse_module_p=1,ktx_parse_module_x=2,ktx_parse_module_E=0,ktx_parse_module_F=1,ktx_parse_module_X=10,ktx_parse_module_nt=0,ktx_parse_module_ct=9,gt=15,yt=16,dt=22,Ot=37,Ft=43,$t=76,ktx_parse_module_se=83,ktx_parse_module_pe=97,ktx_parse_module_xe=100,ktx_parse_module_de=103,ktx_parse_module_Ae=109,Sn=165,In=166;let Si$1=class{constructor(){this.vkFormat=0,this.typeSize=1,this.pixelWidth=0,this.pixelHeight=0,this.pixelDepth=0,this.layerCount=0,this.faceCount=1,this.supercompressionScheme=0,this.levels=[],this.dataFormatDescriptor=[{vendorId:0,descriptorType:0,descriptorBlockSize:0,versionNumber:2,colorModel:0,colorPrimaries:1,transferFunction:2,flags:0,texelBlockDimension:[0,0,0,0],bytesPlane:[0,0,0,0,0,0,0,0],samples:[]}],this.keyValue={},this.globalData=null}},Ii$1=class{constructor(h,o,c,d){this._dataView=new DataView(h.buffer,h.byteOffset+o,c),this._littleEndian=d,this._offset=0}_nextUint8(){const h=this._dataView.getUint8(this._offset);return this._offset+=1,h}_nextUint16(){const h=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,h}_nextUint32(){const h=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,h}_nextUint64(){const h=this._dataView.getUint32(this._offset,this._littleEndian)+4294967296*this._dataView.getUint32(this._offset+4,this._littleEndian);return this._offset+=8,h}_nextInt32(){const h=this._dataView.getInt32(this._offset,this._littleEndian);return this._offset+=4,h}_skip(h){return this._offset+=h,this}_scan(h,o=0){const c=this._offset;let d=0;for(;this._dataView.getUint8(this._offset)!==o&&d<h;)d++,this._offset++;return d<h&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+c,d)}};const Ti$1=[171,75,84,88,32,50,48,187,13,10,26,10];function Ei$1(h){return typeof TextDecoder<"u"?new TextDecoder().decode(h):Buffer.from(h).toString("utf8")}function Pi$1(h){const o=new Uint8Array(h.buffer,h.byteOffset,Ti$1.length);if(o[0]!==Ti$1[0]||o[1]!==Ti$1[1]||o[2]!==Ti$1[2]||o[3]!==Ti$1[3]||o[4]!==Ti$1[4]||o[5]!==Ti$1[5]||o[6]!==Ti$1[6]||o[7]!==Ti$1[7]||o[8]!==Ti$1[8]||o[9]!==Ti$1[9]||o[10]!==Ti$1[10]||o[11]!==Ti$1[11])throw new Error("Missing KTX 2.0 identifier.");const c=new Si$1,d=17*Uint32Array.BYTES_PER_ELEMENT,_=new Ii$1(h,Ti$1.length,d,!0);c.vkFormat=_._nextUint32(),c.typeSize=_._nextUint32(),c.pixelWidth=_._nextUint32(),c.pixelHeight=_._nextUint32(),c.pixelDepth=_._nextUint32(),c.layerCount=_._nextUint32(),c.faceCount=_._nextUint32();const b=_._nextUint32();c.supercompressionScheme=_._nextUint32();const _e=_._nextUint32(),it=_._nextUint32(),nt=_._nextUint32(),at=_._nextUint32(),ut=_._nextUint64(),pt=_._nextUint64(),mt=new Ii$1(h,Ti$1.length+d,3*b*8,!0);for(let hr=0;hr<b;hr++)c.levels.push({levelData:new Uint8Array(h.buffer,h.byteOffset+mt._nextUint64(),mt._nextUint64()),uncompressedByteLength:mt._nextUint64()});const ft=new Ii$1(h,_e,it,!0),vt={vendorId:ft._skip(4)._nextUint16(),descriptorType:ft._nextUint16(),versionNumber:ft._nextUint16(),descriptorBlockSize:ft._nextUint16(),colorModel:ft._nextUint8(),colorPrimaries:ft._nextUint8(),transferFunction:ft._nextUint8(),flags:ft._nextUint8(),texelBlockDimension:[ft._nextUint8(),ft._nextUint8(),ft._nextUint8(),ft._nextUint8()],bytesPlane:[ft._nextUint8(),ft._nextUint8(),ft._nextUint8(),ft._nextUint8(),ft._nextUint8(),ft._nextUint8(),ft._nextUint8(),ft._nextUint8()],samples:[]},xt=(vt.descriptorBlockSize/4-6)/4;for(let hr=0;hr<xt;hr++){const dr={bitOffset:ft._nextUint16(),bitLength:ft._nextUint8(),channelType:ft._nextUint8(),samplePosition:[ft._nextUint8(),ft._nextUint8(),ft._nextUint8(),ft._nextUint8()],sampleLower:-1/0,sampleUpper:1/0};64&dr.channelType?(dr.sampleLower=ft._nextInt32(),dr.sampleUpper=ft._nextInt32()):(dr.sampleLower=ft._nextUint32(),dr.sampleUpper=ft._nextUint32()),vt.samples[hr]=dr}c.dataFormatDescriptor.length=0,c.dataFormatDescriptor.push(vt);const At=new Ii$1(h,nt,at,!0);for(;At._offset<at;){const hr=At._nextUint32(),dr=At._scan(hr),pr=Ei$1(dr),ur=At._scan(hr-dr.byteLength);c.keyValue[pr]=pr.match(/^ktx/i)?Ei$1(ur):ur,At._offset%4&&At._skip(4-At._offset%4)}if(pt<=0)return c;const Ct=new Ii$1(h,ut,pt,!0),Et=Ct._nextUint16(),Tt=Ct._nextUint16(),kt=Ct._nextUint32(),Dt=Ct._nextUint32(),zt=Ct._nextUint32(),Bt=Ct._nextUint32(),Rt=[];for(let hr=0;hr<b;hr++)Rt.push({imageFlags:Ct._nextUint32(),rgbSliceByteOffset:Ct._nextUint32(),rgbSliceByteLength:Ct._nextUint32(),alphaSliceByteOffset:Ct._nextUint32(),alphaSliceByteLength:Ct._nextUint32()});const Ut=ut+Ct._offset,Ht=Ut+kt,Jt=Ht+Dt,Kt=Jt+zt,sr=new Uint8Array(h.buffer,h.byteOffset+Ut,kt),ir=new Uint8Array(h.buffer,h.byteOffset+Ht,Dt),cr=new Uint8Array(h.buffer,h.byteOffset+Jt,zt),lr=new Uint8Array(h.buffer,h.byteOffset+Kt,Bt);return c.globalData={endpointCount:Et,selectorCount:Tt,imageDescs:Rt,endpointsData:sr,selectorsData:ir,tablesData:cr,extendedData:lr},c}let zstddec_module_A,zstddec_module_I,zstddec_module_B;const zstddec_module_g={env:{emscripten_notify_memory_growth:function(h){zstddec_module_B=new Uint8Array(zstddec_module_I.exports.memory.buffer)}}};class zstddec_module_Q{init(){return zstddec_module_A||(zstddec_module_A=typeof fetch<"u"?fetch("data:application/wasm;base64,"+zstddec_module_C).then(o=>o.arrayBuffer()).then(o=>WebAssembly.instantiate(o,zstddec_module_g)).then(this._init):WebAssembly.instantiate(Buffer.from(zstddec_module_C,"base64"),zstddec_module_g).then(this._init),zstddec_module_A)}_init(o){zstddec_module_I=o.instance,zstddec_module_g.env.emscripten_notify_memory_growth(0)}decode(o,c=0){if(!zstddec_module_I)throw new Error("ZSTDDecoder: Await .init() before decoding.");const d=o.byteLength,_=zstddec_module_I.exports.malloc(d);zstddec_module_B.set(o,_),c=c||Number(zstddec_module_I.exports.ZSTD_findDecompressedSize(_,d));const b=zstddec_module_I.exports.malloc(c),_e=zstddec_module_I.exports.ZSTD_decompress(b,c,_,d),it=zstddec_module_B.slice(b,b+_e);return zstddec_module_I.exports.free(_),zstddec_module_I.exports.free(b),it}}const zstddec_module_C="AGFzbQEAAAABpQEVYAF/AX9gAn9/AGADf39/AX9gBX9/f39/AX9gAX8AYAJ/fwF/YAR/f39/AX9gA39/fwBgBn9/f39/fwF/YAd/f39/f39/AX9gAn9/AX5gAn5+AX5gAABgBX9/f39/AGAGf39/f39/AGAIf39/f39/f38AYAl/f39/f39/f38AYAABf2AIf39/f39/f38Bf2ANf39/f39/f39/f39/fwF/YAF/AX4CJwEDZW52H2Vtc2NyaXB0ZW5fbm90aWZ5X21lbW9yeV9ncm93dGgABANpaAEFAAAFAgEFCwACAQABAgIFBQcAAwABDgsBAQcAEhMHAAUBDAQEAAANBwQCAgYCBAgDAwMDBgEACQkHBgICAAYGAgQUBwYGAwIGAAMCAQgBBwUGCgoEEQAEBAEIAwgDBQgDEA8IAAcABAUBcAECAgUEAQCAAgYJAX8BQaCgwAILB2AHBm1lbW9yeQIABm1hbGxvYwAoBGZyZWUAJgxaU1REX2lzRXJyb3IAaBlaU1REX2ZpbmREZWNvbXByZXNzZWRTaXplAFQPWlNURF9kZWNvbXByZXNzAEoGX3N0YXJ0ACQJBwEAQQELASQKussBaA8AIAAgACgCBCABajYCBAsZACAAKAIAIAAoAgRBH3F0QQAgAWtBH3F2CwgAIABBiH9LC34BBH9BAyEBIAAoAgQiA0EgTQRAIAAoAggiASAAKAIQTwRAIAAQDQ8LIAAoAgwiAiABRgRAQQFBAiADQSBJGw8LIAAgASABIAJrIANBA3YiBCABIARrIAJJIgEbIgJrIgQ2AgggACADIAJBA3RrNgIEIAAgBCgAADYCAAsgAQsUAQF/IAAgARACIQIgACABEAEgAgv3AQECfyACRQRAIABCADcCACAAQQA2AhAgAEIANwIIQbh/DwsgACABNgIMIAAgAUEEajYCECACQQRPBEAgACABIAJqIgFBfGoiAzYCCCAAIAMoAAA2AgAgAUF/ai0AACIBBEAgAEEIIAEQFGs2AgQgAg8LIABBADYCBEF/DwsgACABNgIIIAAgAS0AACIDNgIAIAJBfmoiBEEBTQRAIARBAWtFBEAgACABLQACQRB0IANyIgM2AgALIAAgAS0AAUEIdCADajYCAAsgASACakF/ai0AACIBRQRAIABBADYCBEFsDwsgAEEoIAEQFCACQQN0ams2AgQgAgsWACAAIAEpAAA3AAAgACABKQAINwAICy8BAX8gAUECdEGgHWooAgAgACgCAEEgIAEgACgCBGprQR9xdnEhAiAAIAEQASACCyEAIAFCz9bTvtLHq9lCfiAAfEIfiUKHla+vmLbem55/fgsdAQF/IAAoAgggACgCDEYEfyAAKAIEQSBGBUEACwuCBAEDfyACQYDAAE8EQCAAIAEgAhBnIAAPCyAAIAJqIQMCQCAAIAFzQQNxRQRAAkAgAkEBSARAIAAhAgwBCyAAQQNxRQRAIAAhAgwBCyAAIQIDQCACIAEtAAA6AAAgAUEBaiEBIAJBAWoiAiADTw0BIAJBA3ENAAsLAkAgA0F8cSIEQcAASQ0AIAIgBEFAaiIFSw0AA0AgAiABKAIANgIAIAIgASgCBDYCBCACIAEoAgg2AgggAiABKAIMNgIMIAIgASgCEDYCECACIAEoAhQ2AhQgAiABKAIYNgIYIAIgASgCHDYCHCACIAEoAiA2AiAgAiABKAIkNgIkIAIgASgCKDYCKCACIAEoAiw2AiwgAiABKAIwNgIwIAIgASgCNDYCNCACIAEoAjg2AjggAiABKAI8NgI8IAFBQGshASACQUBrIgIgBU0NAAsLIAIgBE8NAQNAIAIgASgCADYCACABQQRqIQEgAkEEaiICIARJDQALDAELIANBBEkEQCAAIQIMAQsgA0F8aiIEIABJBEAgACECDAELIAAhAgNAIAIgAS0AADoAACACIAEtAAE6AAEgAiABLQACOgACIAIgAS0AAzoAAyABQQRqIQEgAkEEaiICIARNDQALCyACIANJBEADQCACIAEtAAA6AAAgAUEBaiEBIAJBAWoiAiADRw0ACwsgAAsMACAAIAEpAAA3AAALQQECfyAAKAIIIgEgACgCEEkEQEEDDwsgACAAKAIEIgJBB3E2AgQgACABIAJBA3ZrIgE2AgggACABKAAANgIAQQALDAAgACABKAIANgAAC/cCAQJ/AkAgACABRg0AAkAgASACaiAASwRAIAAgAmoiBCABSw0BCyAAIAEgAhALDwsgACABc0EDcSEDAkACQCAAIAFJBEAgAwRAIAAhAwwDCyAAQQNxRQRAIAAhAwwCCyAAIQMDQCACRQ0EIAMgAS0AADoAACABQQFqIQEgAkF/aiECIANBAWoiA0EDcQ0ACwwBCwJAIAMNACAEQQNxBEADQCACRQ0FIAAgAkF/aiICaiIDIAEgAmotAAA6AAAgA0EDcQ0ACwsgAkEDTQ0AA0AgACACQXxqIgJqIAEgAmooAgA2AgAgAkEDSw0ACwsgAkUNAgNAIAAgAkF/aiICaiABIAJqLQAAOgAAIAINAAsMAgsgAkEDTQ0AIAIhBANAIAMgASgCADYCACABQQRqIQEgA0EEaiEDIARBfGoiBEEDSw0ACyACQQNxIQILIAJFDQADQCADIAEtAAA6AAAgA0EBaiEDIAFBAWohASACQX9qIgINAAsLIAAL8wICAn8BfgJAIAJFDQAgACACaiIDQX9qIAE6AAAgACABOgAAIAJBA0kNACADQX5qIAE6AAAgACABOgABIANBfWogAToAACAAIAE6AAIgAkEHSQ0AIANBfGogAToAACAAIAE6AAMgAkEJSQ0AIABBACAAa0EDcSIEaiIDIAFB/wFxQYGChAhsIgE2AgAgAyACIARrQXxxIgRqIgJBfGogATYCACAEQQlJDQAgAyABNgIIIAMgATYCBCACQXhqIAE2AgAgAkF0aiABNgIAIARBGUkNACADIAE2AhggAyABNgIUIAMgATYCECADIAE2AgwgAkFwaiABNgIAIAJBbGogATYCACACQWhqIAE2AgAgAkFkaiABNgIAIAQgA0EEcUEYciIEayICQSBJDQAgAa0iBUIghiAFhCEFIAMgBGohAQNAIAEgBTcDGCABIAU3AxAgASAFNwMIIAEgBTcDACABQSBqIQEgAkFgaiICQR9LDQALCyAACy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAIajYCACADCy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAFajYCACADCx8AIAAgASACKAIEEAg2AgAgARAEGiAAIAJBCGo2AgQLCAAgAGdBH3MLugUBDX8jAEEQayIKJAACfyAEQQNNBEAgCkEANgIMIApBDGogAyAEEAsaIAAgASACIApBDGpBBBAVIgBBbCAAEAMbIAAgACAESxsMAQsgAEEAIAEoAgBBAXRBAmoQECENQVQgAygAACIGQQ9xIgBBCksNABogAiAAQQVqNgIAIAMgBGoiAkF8aiEMIAJBeWohDiACQXtqIRAgAEEGaiELQQQhBSAGQQR2IQRBICAAdCIAQQFyIQkgASgCACEPQQAhAiADIQYCQANAIAlBAkggAiAPS3JFBEAgAiEHAkAgCARAA0AgBEH//wNxQf//A0YEQCAHQRhqIQcgBiAQSQR/IAZBAmoiBigAACAFdgUgBUEQaiEFIARBEHYLIQQMAQsLA0AgBEEDcSIIQQNGBEAgBUECaiEFIARBAnYhBCAHQQNqIQcMAQsLIAcgCGoiByAPSw0EIAVBAmohBQNAIAIgB0kEQCANIAJBAXRqQQA7AQAgAkEBaiECDAELCyAGIA5LQQAgBiAFQQN1aiIHIAxLG0UEQCAHKAAAIAVBB3EiBXYhBAwCCyAEQQJ2IQQLIAYhBwsCfyALQX9qIAQgAEF/anEiBiAAQQF0QX9qIgggCWsiEUkNABogBCAIcSIEQQAgESAEIABIG2shBiALCyEIIA0gAkEBdGogBkF/aiIEOwEAIAlBASAGayAEIAZBAUgbayEJA0AgCSAASARAIABBAXUhACALQX9qIQsMAQsLAn8gByAOS0EAIAcgBSAIaiIFQQN1aiIGIAxLG0UEQCAFQQdxDAELIAUgDCIGIAdrQQN0awshBSACQQFqIQIgBEUhCCAGKAAAIAVBH3F2IQQMAQsLQWwgCUEBRyAFQSBKcg0BGiABIAJBf2o2AgAgBiAFQQdqQQN1aiADawwBC0FQCyEAIApBEGokACAACwkAQQFBBSAAGwsMACAAIAEoAAA2AAALqgMBCn8jAEHwAGsiCiQAIAJBAWohDiAAQQhqIQtBgIAEIAVBf2p0QRB1IQxBACECQQEhBkEBIAV0IglBf2oiDyEIA0AgAiAORkUEQAJAIAEgAkEBdCINai8BACIHQf//A0YEQCALIAhBA3RqIAI2AgQgCEF/aiEIQQEhBwwBCyAGQQAgDCAHQRB0QRB1ShshBgsgCiANaiAHOwEAIAJBAWohAgwBCwsgACAFNgIEIAAgBjYCACAJQQN2IAlBAXZqQQNqIQxBACEAQQAhBkEAIQIDQCAGIA5GBEADQAJAIAAgCUYNACAKIAsgAEEDdGoiASgCBCIGQQF0aiICIAIvAQAiAkEBajsBACABIAUgAhAUayIIOgADIAEgAiAIQf8BcXQgCWs7AQAgASAEIAZBAnQiAmooAgA6AAIgASACIANqKAIANgIEIABBAWohAAwBCwsFIAEgBkEBdGouAQAhDUEAIQcDQCAHIA1ORQRAIAsgAkEDdGogBjYCBANAIAIgDGogD3EiAiAISw0ACyAHQQFqIQcMAQsLIAZBAWohBgwBCwsgCkHwAGokAAsjAEIAIAEQCSAAhUKHla+vmLbem55/fkLj3MqV/M7y9YV/fAsQACAAQn43AwggACABNgIACyQBAX8gAARAIAEoAgQiAgRAIAEoAgggACACEQEADwsgABAmCwsfACAAIAEgAi8BABAINgIAIAEQBBogACACQQRqNgIEC0oBAX9BoCAoAgAiASAAaiIAQX9MBEBBiCBBMDYCAEF/DwsCQCAAPwBBEHRNDQAgABBmDQBBiCBBMDYCAEF/DwtBoCAgADYCACABC9cBAQh/Qbp/IQoCQCACKAIEIgggAigCACIJaiIOIAEgAGtLDQBBbCEKIAkgBCADKAIAIgtrSw0AIAAgCWoiBCACKAIIIgxrIQ0gACABQWBqIg8gCyAJQQAQKSADIAkgC2o2AgACQAJAIAwgBCAFa00EQCANIQUMAQsgDCAEIAZrSw0CIAcgDSAFayIAaiIBIAhqIAdNBEAgBCABIAgQDxoMAgsgBCABQQAgAGsQDyEBIAIgACAIaiIINgIEIAEgAGshBAsgBCAPIAUgCEEBECkLIA4hCgsgCgubAgEBfyMAQYABayINJAAgDSADNgJ8AkAgAkEDSwRAQX8hCQwBCwJAAkACQAJAIAJBAWsOAwADAgELIAZFBEBBuH8hCQwEC0FsIQkgBS0AACICIANLDQMgACAHIAJBAnQiAmooAgAgAiAIaigCABA7IAEgADYCAEEBIQkMAwsgASAJNgIAQQAhCQwCCyAKRQRAQWwhCQwCC0EAIQkgC0UgDEEZSHINAUEIIAR0QQhqIQBBACECA0AgAiAATw0CIAJBQGshAgwAAAsAC0FsIQkgDSANQfwAaiANQfgAaiAFIAYQFSICEAMNACANKAJ4IgMgBEsNACAAIA0gDSgCfCAHIAggAxAYIAEgADYCACACIQkLIA1BgAFqJAAgCQsLACAAIAEgAhALGgsQACAALwAAIAAtAAJBEHRyCy8AAn9BuH8gAUEISQ0AGkFyIAAoAAQiAEF3Sw0AGkG4fyAAQQhqIgAgACABSxsLCwkAIAAgATsAAAsDAAELigYBBX8gACAAKAIAIgVBfnE2AgBBACAAIAVBAXZqQYQgKAIAIgQgAEYbIQECQAJAIAAoAgQiAkUNACACKAIAIgNBAXENACACQQhqIgUgA0EBdkF4aiIDQQggA0EISxtnQR9zQQJ0QYAfaiIDKAIARgRAIAMgAigCDDYCAAsgAigCCCIDBEAgAyACKAIMNgIECyACKAIMIgMEQCADIAIoAgg2AgALIAIgAigCACAAKAIAQX5xajYCAEGEICEAAkACQCABRQ0AIAEgAjYCBCABKAIAIgNBAXENASADQQF2QXhqIgNBCCADQQhLG2dBH3NBAnRBgB9qIgMoAgAgAUEIakYEQCADIAEoAgw2AgALIAEoAggiAwRAIAMgASgCDDYCBAsgASgCDCIDBEAgAyABKAIINgIAQYQgKAIAIQQLIAIgAigCACABKAIAQX5xajYCACABIARGDQAgASABKAIAQQF2akEEaiEACyAAIAI2AgALIAIoAgBBAXZBeGoiAEEIIABBCEsbZ0Efc0ECdEGAH2oiASgCACEAIAEgBTYCACACIAA2AgwgAkEANgIIIABFDQEgACAFNgIADwsCQCABRQ0AIAEoAgAiAkEBcQ0AIAJBAXZBeGoiAkEIIAJBCEsbZ0Efc0ECdEGAH2oiAigCACABQQhqRgRAIAIgASgCDDYCAAsgASgCCCICBEAgAiABKAIMNgIECyABKAIMIgIEQCACIAEoAgg2AgBBhCAoAgAhBAsgACAAKAIAIAEoAgBBfnFqIgI2AgACQCABIARHBEAgASABKAIAQQF2aiAANgIEIAAoAgAhAgwBC0GEICAANgIACyACQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgIoAgAhASACIABBCGoiAjYCACAAIAE2AgwgAEEANgIIIAFFDQEgASACNgIADwsgBUEBdkF4aiIBQQggAUEISxtnQR9zQQJ0QYAfaiICKAIAIQEgAiAAQQhqIgI2AgAgACABNgIMIABBADYCCCABRQ0AIAEgAjYCAAsLDgAgAARAIABBeGoQJQsLgAIBA38CQCAAQQ9qQXhxQYQgKAIAKAIAQQF2ayICEB1Bf0YNAAJAQYQgKAIAIgAoAgAiAUEBcQ0AIAFBAXZBeGoiAUEIIAFBCEsbZ0Efc0ECdEGAH2oiASgCACAAQQhqRgRAIAEgACgCDDYCAAsgACgCCCIBBEAgASAAKAIMNgIECyAAKAIMIgFFDQAgASAAKAIINgIAC0EBIQEgACAAKAIAIAJBAXRqIgI2AgAgAkEBcQ0AIAJBAXZBeGoiAkEIIAJBCEsbZ0Efc0ECdEGAH2oiAygCACECIAMgAEEIaiIDNgIAIAAgAjYCDCAAQQA2AgggAkUNACACIAM2AgALIAELtwIBA38CQAJAIABBASAAGyICEDgiAA0AAkACQEGEICgCACIARQ0AIAAoAgAiA0EBcQ0AIAAgA0EBcjYCACADQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgEoAgAgAEEIakYEQCABIAAoAgw2AgALIAAoAggiAQRAIAEgACgCDDYCBAsgACgCDCIBBEAgASAAKAIINgIACyACECchAkEAIQFBhCAoAgAhACACDQEgACAAKAIAQX5xNgIAQQAPCyACQQ9qQXhxIgMQHSICQX9GDQIgAkEHakF4cSIAIAJHBEAgACACaxAdQX9GDQMLAkBBhCAoAgAiAUUEQEGAICAANgIADAELIAAgATYCBAtBhCAgADYCACAAIANBAXRBAXI2AgAMAQsgAEUNAQsgAEEIaiEBCyABC7kDAQJ/IAAgA2ohBQJAIANBB0wEQANAIAAgBU8NAiAAIAItAAA6AAAgAEEBaiEAIAJBAWohAgwAAAsACyAEQQFGBEACQCAAIAJrIgZBB00EQCAAIAItAAA6AAAgACACLQABOgABIAAgAi0AAjoAAiAAIAItAAM6AAMgAEEEaiACIAZBAnQiBkHAHmooAgBqIgIQFyACIAZB4B5qKAIAayECDAELIAAgAhAMCyACQQhqIQIgAEEIaiEACwJAAkACQAJAIAUgAU0EQCAAIANqIQEgBEEBRyAAIAJrQQ9Kcg0BA0AgACACEAwgAkEIaiECIABBCGoiACABSQ0ACwwFCyAAIAFLBEAgACEBDAQLIARBAUcgACACa0EPSnINASAAIQMgAiEEA0AgAyAEEAwgBEEIaiEEIANBCGoiAyABSQ0ACwwCCwNAIAAgAhAHIAJBEGohAiAAQRBqIgAgAUkNAAsMAwsgACEDIAIhBANAIAMgBBAHIARBEGohBCADQRBqIgMgAUkNAAsLIAIgASAAa2ohAgsDQCABIAVPDQEgASACLQAAOgAAIAFBAWohASACQQFqIQIMAAALAAsLQQECfyAAIAAoArjgASIDNgLE4AEgACgCvOABIQQgACABNgK84AEgACABIAJqNgK44AEgACABIAQgA2tqNgLA4AELpgEBAX8gACAAKALs4QEQFjYCyOABIABCADcD+OABIABCADcDuOABIABBwOABakIANwMAIABBqNAAaiIBQYyAgOAANgIAIABBADYCmOIBIABCADcDiOEBIABCAzcDgOEBIABBrNABakHgEikCADcCACAAQbTQAWpB6BIoAgA2AgAgACABNgIMIAAgAEGYIGo2AgggACAAQaAwajYCBCAAIABBEGo2AgALYQEBf0G4fyEDAkAgAUEDSQ0AIAIgABAhIgFBA3YiADYCCCACIAFBAXE2AgQgAiABQQF2QQNxIgM2AgACQCADQX9qIgFBAksNAAJAIAFBAWsOAgEAAgtBbA8LIAAhAwsgAwsMACAAIAEgAkEAEC4LiAQCA38CfiADEBYhBCAAQQBBKBAQIQAgBCACSwRAIAQPCyABRQRAQX8PCwJAAkAgA0EBRg0AIAEoAAAiBkGo6r5pRg0AQXYhAyAGQXBxQdDUtMIBRw0BQQghAyACQQhJDQEgAEEAQSgQECEAIAEoAAQhASAAQQE2AhQgACABrTcDAEEADwsgASACIAMQLyIDIAJLDQAgACADNgIYQXIhAyABIARqIgVBf2otAAAiAkEIcQ0AIAJBIHEiBkUEQEFwIQMgBS0AACIFQacBSw0BIAVBB3GtQgEgBUEDdkEKaq2GIgdCA4h+IAd8IQggBEEBaiEECyACQQZ2IQMgAkECdiEFAkAgAkEDcUF/aiICQQJLBEBBACECDAELAkACQAJAIAJBAWsOAgECAAsgASAEai0AACECIARBAWohBAwCCyABIARqLwAAIQIgBEECaiEEDAELIAEgBGooAAAhAiAEQQRqIQQLIAVBAXEhBQJ+AkACQAJAIANBf2oiA0ECTQRAIANBAWsOAgIDAQtCfyAGRQ0DGiABIARqMQAADAMLIAEgBGovAACtQoACfAwCCyABIARqKAAArQwBCyABIARqKQAACyEHIAAgBTYCICAAIAI2AhwgACAHNwMAQQAhAyAAQQA2AhQgACAHIAggBhsiBzcDCCAAIAdCgIAIIAdCgIAIVBs+AhALIAMLWwEBf0G4fyEDIAIQFiICIAFNBH8gACACakF/ai0AACIAQQNxQQJ0QaAeaigCACACaiAAQQZ2IgFBAnRBsB5qKAIAaiAAQSBxIgBFaiABRSAAQQV2cWoFQbh/CwsdACAAKAKQ4gEQWiAAQQA2AqDiASAAQgA3A5DiAQu1AwEFfyMAQZACayIKJABBuH8hBgJAIAVFDQAgBCwAACIIQf8BcSEHAkAgCEF/TARAIAdBgn9qQQF2IgggBU8NAkFsIQYgB0GBf2oiBUGAAk8NAiAEQQFqIQdBACEGA0AgBiAFTwRAIAUhBiAIIQcMAwUgACAGaiAHIAZBAXZqIgQtAABBBHY6AAAgACAGQQFyaiAELQAAQQ9xOgAAIAZBAmohBgwBCwAACwALIAcgBU8NASAAIARBAWogByAKEFMiBhADDQELIAYhBEEAIQYgAUEAQTQQECEJQQAhBQNAIAQgBkcEQCAAIAZqIggtAAAiAUELSwRAQWwhBgwDBSAJIAFBAnRqIgEgASgCAEEBajYCACAGQQFqIQZBASAILQAAdEEBdSAFaiEFDAILAAsLQWwhBiAFRQ0AIAUQFEEBaiIBQQxLDQAgAyABNgIAQQFBASABdCAFayIDEBQiAXQgA0cNACAAIARqIAFBAWoiADoAACAJIABBAnRqIgAgACgCAEEBajYCACAJKAIEIgBBAkkgAEEBcXINACACIARBAWo2AgAgB0EBaiEGCyAKQZACaiQAIAYLxhEBDH8jAEHwAGsiBSQAQWwhCwJAIANBCkkNACACLwAAIQogAi8AAiEJIAIvAAQhByAFQQhqIAQQDgJAIAMgByAJIApqakEGaiIMSQ0AIAUtAAohCCAFQdgAaiACQQZqIgIgChAGIgsQAw0BIAVBQGsgAiAKaiICIAkQBiILEAMNASAFQShqIAIgCWoiAiAHEAYiCxADDQEgBUEQaiACIAdqIAMgDGsQBiILEAMNASAAIAFqIg9BfWohECAEQQRqIQZBASELIAAgAUEDakECdiIDaiIMIANqIgIgA2oiDiEDIAIhBCAMIQcDQCALIAMgEElxBEAgACAGIAVB2ABqIAgQAkECdGoiCS8BADsAACAFQdgAaiAJLQACEAEgCS0AAyELIAcgBiAFQUBrIAgQAkECdGoiCS8BADsAACAFQUBrIAktAAIQASAJLQADIQogBCAGIAVBKGogCBACQQJ0aiIJLwEAOwAAIAVBKGogCS0AAhABIAktAAMhCSADIAYgBUEQaiAIEAJBAnRqIg0vAQA7AAAgBUEQaiANLQACEAEgDS0AAyENIAAgC2oiCyAGIAVB2ABqIAgQAkECdGoiAC8BADsAACAFQdgAaiAALQACEAEgAC0AAyEAIAcgCmoiCiAGIAVBQGsgCBACQQJ0aiIHLwEAOwAAIAVBQGsgBy0AAhABIActAAMhByAEIAlqIgkgBiAFQShqIAgQAkECdGoiBC8BADsAACAFQShqIAQtAAIQASAELQADIQQgAyANaiIDIAYgBUEQaiAIEAJBAnRqIg0vAQA7AAAgBUEQaiANLQACEAEgACALaiEAIAcgCmohByAEIAlqIQQgAyANLQADaiEDIAVB2ABqEA0gBUFAaxANciAFQShqEA1yIAVBEGoQDXJFIQsMAQsLIAQgDksgByACS3INAEFsIQsgACAMSw0BIAxBfWohCQNAQQAgACAJSSAFQdgAahAEGwRAIAAgBiAFQdgAaiAIEAJBAnRqIgovAQA7AAAgBUHYAGogCi0AAhABIAAgCi0AA2oiACAGIAVB2ABqIAgQAkECdGoiCi8BADsAACAFQdgAaiAKLQACEAEgACAKLQADaiEADAEFIAxBfmohCgNAIAVB2ABqEAQgACAKS3JFBEAgACAGIAVB2ABqIAgQAkECdGoiCS8BADsAACAFQdgAaiAJLQACEAEgACAJLQADaiEADAELCwNAIAAgCk0EQCAAIAYgBUHYAGogCBACQQJ0aiIJLwEAOwAAIAVB2ABqIAktAAIQASAAIAktAANqIQAMAQsLAkAgACAMTw0AIAAgBiAFQdgAaiAIEAIiAEECdGoiDC0AADoAACAMLQADQQFGBEAgBUHYAGogDC0AAhABDAELIAUoAlxBH0sNACAFQdgAaiAGIABBAnRqLQACEAEgBSgCXEEhSQ0AIAVBIDYCXAsgAkF9aiEMA0BBACAHIAxJIAVBQGsQBBsEQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiIAIAYgBUFAayAIEAJBAnRqIgcvAQA7AAAgBUFAayAHLQACEAEgACAHLQADaiEHDAEFIAJBfmohDANAIAVBQGsQBCAHIAxLckUEQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiEHDAELCwNAIAcgDE0EQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiEHDAELCwJAIAcgAk8NACAHIAYgBUFAayAIEAIiAEECdGoiAi0AADoAACACLQADQQFGBEAgBUFAayACLQACEAEMAQsgBSgCREEfSw0AIAVBQGsgBiAAQQJ0ai0AAhABIAUoAkRBIUkNACAFQSA2AkQLIA5BfWohAgNAQQAgBCACSSAFQShqEAQbBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2oiACAGIAVBKGogCBACQQJ0aiIELwEAOwAAIAVBKGogBC0AAhABIAAgBC0AA2ohBAwBBSAOQX5qIQIDQCAFQShqEAQgBCACS3JFBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2ohBAwBCwsDQCAEIAJNBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2ohBAwBCwsCQCAEIA5PDQAgBCAGIAVBKGogCBACIgBBAnRqIgItAAA6AAAgAi0AA0EBRgRAIAVBKGogAi0AAhABDAELIAUoAixBH0sNACAFQShqIAYgAEECdGotAAIQASAFKAIsQSFJDQAgBUEgNgIsCwNAQQAgAyAQSSAFQRBqEAQbBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2oiACAGIAVBEGogCBACQQJ0aiICLwEAOwAAIAVBEGogAi0AAhABIAAgAi0AA2ohAwwBBSAPQX5qIQIDQCAFQRBqEAQgAyACS3JFBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2ohAwwBCwsDQCADIAJNBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2ohAwwBCwsCQCADIA9PDQAgAyAGIAVBEGogCBACIgBBAnRqIgItAAA6AAAgAi0AA0EBRgRAIAVBEGogAi0AAhABDAELIAUoAhRBH0sNACAFQRBqIAYgAEECdGotAAIQASAFKAIUQSFJDQAgBUEgNgIUCyABQWwgBUHYAGoQCiAFQUBrEApxIAVBKGoQCnEgBUEQahAKcRshCwwJCwAACwALAAALAAsAAAsACwAACwALQWwhCwsgBUHwAGokACALC7UEAQ5/IwBBEGsiBiQAIAZBBGogABAOQVQhBQJAIARB3AtJDQAgBi0ABCEHIANB8ARqQQBB7AAQECEIIAdBDEsNACADQdwJaiIJIAggBkEIaiAGQQxqIAEgAhAxIhAQA0UEQCAGKAIMIgQgB0sNASADQdwFaiEPIANBpAVqIREgAEEEaiESIANBqAVqIQEgBCEFA0AgBSICQX9qIQUgCCACQQJ0aigCAEUNAAsgAkEBaiEOQQEhBQNAIAUgDk9FBEAgCCAFQQJ0IgtqKAIAIQwgASALaiAKNgIAIAVBAWohBSAKIAxqIQoMAQsLIAEgCjYCAEEAIQUgBigCCCELA0AgBSALRkUEQCABIAUgCWotAAAiDEECdGoiDSANKAIAIg1BAWo2AgAgDyANQQF0aiINIAw6AAEgDSAFOgAAIAVBAWohBQwBCwtBACEBIANBADYCqAUgBEF/cyAHaiEJQQEhBQNAIAUgDk9FBEAgCCAFQQJ0IgtqKAIAIQwgAyALaiABNgIAIAwgBSAJanQgAWohASAFQQFqIQUMAQsLIAcgBEEBaiIBIAJrIgRrQQFqIQgDQEEBIQUgBCAIT0UEQANAIAUgDk9FBEAgBUECdCIJIAMgBEE0bGpqIAMgCWooAgAgBHY2AgAgBUEBaiEFDAELCyAEQQFqIQQMAQsLIBIgByAPIAogESADIAIgARBkIAZBAToABSAGIAc6AAYgACAGKAIENgIACyAQIQULIAZBEGokACAFC8ENAQt/IwBB8ABrIgUkAEFsIQkCQCADQQpJDQAgAi8AACEKIAIvAAIhDCACLwAEIQYgBUEIaiAEEA4CQCADIAYgCiAMampBBmoiDUkNACAFLQAKIQcgBUHYAGogAkEGaiICIAoQBiIJEAMNASAFQUBrIAIgCmoiAiAMEAYiCRADDQEgBUEoaiACIAxqIgIgBhAGIgkQAw0BIAVBEGogAiAGaiADIA1rEAYiCRADDQEgACABaiIOQX1qIQ8gBEEEaiEGQQEhCSAAIAFBA2pBAnYiAmoiCiACaiIMIAJqIg0hAyAMIQQgCiECA0AgCSADIA9JcQRAIAYgBUHYAGogBxACQQF0aiIILQAAIQsgBUHYAGogCC0AARABIAAgCzoAACAGIAVBQGsgBxACQQF0aiIILQAAIQsgBUFAayAILQABEAEgAiALOgAAIAYgBUEoaiAHEAJBAXRqIggtAAAhCyAFQShqIAgtAAEQASAEIAs6AAAgBiAFQRBqIAcQAkEBdGoiCC0AACELIAVBEGogCC0AARABIAMgCzoAACAGIAVB2ABqIAcQAkEBdGoiCC0AACELIAVB2ABqIAgtAAEQASAAIAs6AAEgBiAFQUBrIAcQAkEBdGoiCC0AACELIAVBQGsgCC0AARABIAIgCzoAASAGIAVBKGogBxACQQF0aiIILQAAIQsgBUEoaiAILQABEAEgBCALOgABIAYgBUEQaiAHEAJBAXRqIggtAAAhCyAFQRBqIAgtAAEQASADIAs6AAEgA0ECaiEDIARBAmohBCACQQJqIQIgAEECaiEAIAkgBUHYAGoQDUVxIAVBQGsQDUVxIAVBKGoQDUVxIAVBEGoQDUVxIQkMAQsLIAQgDUsgAiAMS3INAEFsIQkgACAKSw0BIApBfWohCQNAIAVB2ABqEAQgACAJT3JFBEAgBiAFQdgAaiAHEAJBAXRqIggtAAAhCyAFQdgAaiAILQABEAEgACALOgAAIAYgBUHYAGogBxACQQF0aiIILQAAIQsgBUHYAGogCC0AARABIAAgCzoAASAAQQJqIQAMAQsLA0AgBUHYAGoQBCAAIApPckUEQCAGIAVB2ABqIAcQAkEBdGoiCS0AACEIIAVB2ABqIAktAAEQASAAIAg6AAAgAEEBaiEADAELCwNAIAAgCkkEQCAGIAVB2ABqIAcQAkEBdGoiCS0AACEIIAVB2ABqIAktAAEQASAAIAg6AAAgAEEBaiEADAELCyAMQX1qIQADQCAFQUBrEAQgAiAAT3JFBEAgBiAFQUBrIAcQAkEBdGoiCi0AACEJIAVBQGsgCi0AARABIAIgCToAACAGIAVBQGsgBxACQQF0aiIKLQAAIQkgBUFAayAKLQABEAEgAiAJOgABIAJBAmohAgwBCwsDQCAFQUBrEAQgAiAMT3JFBEAgBiAFQUBrIAcQAkEBdGoiAC0AACEKIAVBQGsgAC0AARABIAIgCjoAACACQQFqIQIMAQsLA0AgAiAMSQRAIAYgBUFAayAHEAJBAXRqIgAtAAAhCiAFQUBrIAAtAAEQASACIAo6AAAgAkEBaiECDAELCyANQX1qIQADQCAFQShqEAQgBCAAT3JFBEAgBiAFQShqIAcQAkEBdGoiAi0AACEKIAVBKGogAi0AARABIAQgCjoAACAGIAVBKGogBxACQQF0aiICLQAAIQogBUEoaiACLQABEAEgBCAKOgABIARBAmohBAwBCwsDQCAFQShqEAQgBCANT3JFBEAgBiAFQShqIAcQAkEBdGoiAC0AACECIAVBKGogAC0AARABIAQgAjoAACAEQQFqIQQMAQsLA0AgBCANSQRAIAYgBUEoaiAHEAJBAXRqIgAtAAAhAiAFQShqIAAtAAEQASAEIAI6AAAgBEEBaiEEDAELCwNAIAVBEGoQBCADIA9PckUEQCAGIAVBEGogBxACQQF0aiIALQAAIQIgBUEQaiAALQABEAEgAyACOgAAIAYgBUEQaiAHEAJBAXRqIgAtAAAhAiAFQRBqIAAtAAEQASADIAI6AAEgA0ECaiEDDAELCwNAIAVBEGoQBCADIA5PckUEQCAGIAVBEGogBxACQQF0aiIALQAAIQIgBUEQaiAALQABEAEgAyACOgAAIANBAWohAwwBCwsDQCADIA5JBEAgBiAFQRBqIAcQAkEBdGoiAC0AACECIAVBEGogAC0AARABIAMgAjoAACADQQFqIQMMAQsLIAFBbCAFQdgAahAKIAVBQGsQCnEgBUEoahAKcSAFQRBqEApxGyEJDAELQWwhCQsgBUHwAGokACAJC8oCAQR/IwBBIGsiBSQAIAUgBBAOIAUtAAIhByAFQQhqIAIgAxAGIgIQA0UEQCAEQQRqIQIgACABaiIDQX1qIQQDQCAFQQhqEAQgACAET3JFBEAgAiAFQQhqIAcQAkEBdGoiBi0AACEIIAVBCGogBi0AARABIAAgCDoAACACIAVBCGogBxACQQF0aiIGLQAAIQggBUEIaiAGLQABEAEgACAIOgABIABBAmohAAwBCwsDQCAFQQhqEAQgACADT3JFBEAgAiAFQQhqIAcQAkEBdGoiBC0AACEGIAVBCGogBC0AARABIAAgBjoAACAAQQFqIQAMAQsLA0AgACADT0UEQCACIAVBCGogBxACQQF0aiIELQAAIQYgBUEIaiAELQABEAEgACAGOgAAIABBAWohAAwBCwsgAUFsIAVBCGoQChshAgsgBUEgaiQAIAILtgMBCX8jAEEQayIGJAAgBkEANgIMIAZBADYCCEFUIQQCQAJAIANBQGsiDCADIAZBCGogBkEMaiABIAIQMSICEAMNACAGQQRqIAAQDiAGKAIMIgcgBi0ABEEBaksNASAAQQRqIQogBkEAOgAFIAYgBzoABiAAIAYoAgQ2AgAgB0EBaiEJQQEhBANAIAQgCUkEQCADIARBAnRqIgEoAgAhACABIAU2AgAgACAEQX9qdCAFaiEFIARBAWohBAwBCwsgB0EBaiEHQQAhBSAGKAIIIQkDQCAFIAlGDQEgAyAFIAxqLQAAIgRBAnRqIgBBASAEdEEBdSILIAAoAgAiAWoiADYCACAHIARrIQhBACEEAkAgC0EDTQRAA0AgBCALRg0CIAogASAEakEBdGoiACAIOgABIAAgBToAACAEQQFqIQQMAAALAAsDQCABIABPDQEgCiABQQF0aiIEIAg6AAEgBCAFOgAAIAQgCDoAAyAEIAU6AAIgBCAIOgAFIAQgBToABCAEIAg6AAcgBCAFOgAGIAFBBGohAQwAAAsACyAFQQFqIQUMAAALAAsgAiEECyAGQRBqJAAgBAutAQECfwJAQYQgKAIAIABHIAAoAgBBAXYiAyABa0F4aiICQXhxQQhHcgR/IAIFIAMQJ0UNASACQQhqC0EQSQ0AIAAgACgCACICQQFxIAAgAWpBD2pBeHEiASAAa0EBdHI2AgAgASAANgIEIAEgASgCAEEBcSAAIAJBAXZqIAFrIgJBAXRyNgIAQYQgIAEgAkH/////B3FqQQRqQYQgKAIAIABGGyABNgIAIAEQJQsLygIBBX8CQAJAAkAgAEEIIABBCEsbZ0EfcyAAaUEBR2oiAUEESSAAIAF2cg0AIAFBAnRB/B5qKAIAIgJFDQADQCACQXhqIgMoAgBBAXZBeGoiBSAATwRAIAIgBUEIIAVBCEsbZ0Efc0ECdEGAH2oiASgCAEYEQCABIAIoAgQ2AgALDAMLIARBHksNASAEQQFqIQQgAigCBCICDQALC0EAIQMgAUEgTw0BA0AgAUECdEGAH2ooAgAiAkUEQCABQR5LIQIgAUEBaiEBIAJFDQEMAwsLIAIgAkF4aiIDKAIAQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgEoAgBGBEAgASACKAIENgIACwsgAigCACIBBEAgASACKAIENgIECyACKAIEIgEEQCABIAIoAgA2AgALIAMgAygCAEEBcjYCACADIAAQNwsgAwvhCwINfwV+IwBB8ABrIgckACAHIAAoAvDhASIINgJcIAEgAmohDSAIIAAoAoDiAWohDwJAAkAgBUUEQCABIQQMAQsgACgCxOABIRAgACgCwOABIREgACgCvOABIQ4gAEEBNgKM4QFBACEIA0AgCEEDRwRAIAcgCEECdCICaiAAIAJqQazQAWooAgA2AkQgCEEBaiEIDAELC0FsIQwgB0EYaiADIAQQBhADDQEgB0EsaiAHQRhqIAAoAgAQEyAHQTRqIAdBGGogACgCCBATIAdBPGogB0EYaiAAKAIEEBMgDUFgaiESIAEhBEEAIQwDQCAHKAIwIAcoAixBA3RqKQIAIhRCEIinQf8BcSEIIAcoAkAgBygCPEEDdGopAgAiFUIQiKdB/wFxIQsgBygCOCAHKAI0QQN0aikCACIWQiCIpyEJIBVCIIghFyAUQiCIpyECAkAgFkIQiKdB/wFxIgNBAk8EQAJAIAZFIANBGUlyRQRAIAkgB0EYaiADQSAgBygCHGsiCiAKIANLGyIKEAUgAyAKayIDdGohCSAHQRhqEAQaIANFDQEgB0EYaiADEAUgCWohCQwBCyAHQRhqIAMQBSAJaiEJIAdBGGoQBBoLIAcpAkQhGCAHIAk2AkQgByAYNwNIDAELAkAgA0UEQCACBEAgBygCRCEJDAMLIAcoAkghCQwBCwJAAkAgB0EYakEBEAUgCSACRWpqIgNBA0YEQCAHKAJEQX9qIgMgA0VqIQkMAQsgA0ECdCAHaigCRCIJIAlFaiEJIANBAUYNAQsgByAHKAJINgJMCwsgByAHKAJENgJIIAcgCTYCRAsgF6chAyALBEAgB0EYaiALEAUgA2ohAwsgCCALakEUTwRAIAdBGGoQBBoLIAgEQCAHQRhqIAgQBSACaiECCyAHQRhqEAQaIAcgB0EYaiAUQhiIp0H/AXEQCCAUp0H//wNxajYCLCAHIAdBGGogFUIYiKdB/wFxEAggFadB//8DcWo2AjwgB0EYahAEGiAHIAdBGGogFkIYiKdB/wFxEAggFqdB//8DcWo2AjQgByACNgJgIAcoAlwhCiAHIAk2AmggByADNgJkAkACQAJAIAQgAiADaiILaiASSw0AIAIgCmoiEyAPSw0AIA0gBGsgC0Egak8NAQsgByAHKQNoNwMQIAcgBykDYDcDCCAEIA0gB0EIaiAHQdwAaiAPIA4gESAQEB4hCwwBCyACIARqIQggBCAKEAcgAkERTwRAIARBEGohAgNAIAIgCkEQaiIKEAcgAkEQaiICIAhJDQALCyAIIAlrIQIgByATNgJcIAkgCCAOa0sEQCAJIAggEWtLBEBBbCELDAILIBAgAiAOayICaiIKIANqIBBNBEAgCCAKIAMQDxoMAgsgCCAKQQAgAmsQDyEIIAcgAiADaiIDNgJkIAggAmshCCAOIQILIAlBEE8EQCADIAhqIQMDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALDAELAkAgCUEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgCUECdCIDQcAeaigCAGoiAhAXIAIgA0HgHmooAgBrIQIgBygCZCEDDAELIAggAhAMCyADQQlJDQAgAyAIaiEDIAhBCGoiCCACQQhqIgJrQQ9MBEADQCAIIAIQDCACQQhqIQIgCEEIaiIIIANJDQAMAgALAAsDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALCyAHQRhqEAQaIAsgDCALEAMiAhshDCAEIAQgC2ogAhshBCAFQX9qIgUNAAsgDBADDQFBbCEMIAdBGGoQBEECSQ0BQQAhCANAIAhBA0cEQCAAIAhBAnQiAmpBrNABaiACIAdqKAJENgIAIAhBAWohCAwBCwsgBygCXCEIC0G6fyEMIA8gCGsiACANIARrSw0AIAQEfyAEIAggABALIABqBUEACyABayEMCyAHQfAAaiQAIAwLkRcCFn8FfiMAQdABayIHJAAgByAAKALw4QEiCDYCvAEgASACaiESIAggACgCgOIBaiETAkACQCAFRQRAIAEhAwwBCyAAKALE4AEhESAAKALA4AEhFSAAKAK84AEhDyAAQQE2AozhAUEAIQgDQCAIQQNHBEAgByAIQQJ0IgJqIAAgAmpBrNABaigCADYCVCAIQQFqIQgMAQsLIAcgETYCZCAHIA82AmAgByABIA9rNgJoQWwhECAHQShqIAMgBBAGEAMNASAFQQQgBUEESBshFyAHQTxqIAdBKGogACgCABATIAdBxABqIAdBKGogACgCCBATIAdBzABqIAdBKGogACgCBBATQQAhBCAHQeAAaiEMIAdB5ABqIQoDQCAHQShqEARBAksgBCAXTnJFBEAgBygCQCAHKAI8QQN0aikCACIdQhCIp0H/AXEhCyAHKAJQIAcoAkxBA3RqKQIAIh5CEIinQf8BcSEJIAcoAkggBygCREEDdGopAgAiH0IgiKchCCAeQiCIISAgHUIgiKchAgJAIB9CEIinQf8BcSIDQQJPBEACQCAGRSADQRlJckUEQCAIIAdBKGogA0EgIAcoAixrIg0gDSADSxsiDRAFIAMgDWsiA3RqIQggB0EoahAEGiADRQ0BIAdBKGogAxAFIAhqIQgMAQsgB0EoaiADEAUgCGohCCAHQShqEAQaCyAHKQJUISEgByAINgJUIAcgITcDWAwBCwJAIANFBEAgAgRAIAcoAlQhCAwDCyAHKAJYIQgMAQsCQAJAIAdBKGpBARAFIAggAkVqaiIDQQNGBEAgBygCVEF/aiIDIANFaiEIDAELIANBAnQgB2ooAlQiCCAIRWohCCADQQFGDQELIAcgBygCWDYCXAsLIAcgBygCVDYCWCAHIAg2AlQLICCnIQMgCQRAIAdBKGogCRAFIANqIQMLIAkgC2pBFE8EQCAHQShqEAQaCyALBEAgB0EoaiALEAUgAmohAgsgB0EoahAEGiAHIAcoAmggAmoiCSADajYCaCAKIAwgCCAJSxsoAgAhDSAHIAdBKGogHUIYiKdB/wFxEAggHadB//8DcWo2AjwgByAHQShqIB5CGIinQf8BcRAIIB6nQf//A3FqNgJMIAdBKGoQBBogB0EoaiAfQhiIp0H/AXEQCCEOIAdB8ABqIARBBHRqIgsgCSANaiAIazYCDCALIAg2AgggCyADNgIEIAsgAjYCACAHIA4gH6dB//8DcWo2AkQgBEEBaiEEDAELCyAEIBdIDQEgEkFgaiEYIAdB4ABqIRogB0HkAGohGyABIQMDQCAHQShqEARBAksgBCAFTnJFBEAgBygCQCAHKAI8QQN0aikCACIdQhCIp0H/AXEhCyAHKAJQIAcoAkxBA3RqKQIAIh5CEIinQf8BcSEIIAcoAkggBygCREEDdGopAgAiH0IgiKchCSAeQiCIISAgHUIgiKchDAJAIB9CEIinQf8BcSICQQJPBEACQCAGRSACQRlJckUEQCAJIAdBKGogAkEgIAcoAixrIgogCiACSxsiChAFIAIgCmsiAnRqIQkgB0EoahAEGiACRQ0BIAdBKGogAhAFIAlqIQkMAQsgB0EoaiACEAUgCWohCSAHQShqEAQaCyAHKQJUISEgByAJNgJUIAcgITcDWAwBCwJAIAJFBEAgDARAIAcoAlQhCQwDCyAHKAJYIQkMAQsCQAJAIAdBKGpBARAFIAkgDEVqaiICQQNGBEAgBygCVEF/aiICIAJFaiEJDAELIAJBAnQgB2ooAlQiCSAJRWohCSACQQFGDQELIAcgBygCWDYCXAsLIAcgBygCVDYCWCAHIAk2AlQLICCnIRQgCARAIAdBKGogCBAFIBRqIRQLIAggC2pBFE8EQCAHQShqEAQaCyALBEAgB0EoaiALEAUgDGohDAsgB0EoahAEGiAHIAcoAmggDGoiGSAUajYCaCAbIBogCSAZSxsoAgAhHCAHIAdBKGogHUIYiKdB/wFxEAggHadB//8DcWo2AjwgByAHQShqIB5CGIinQf8BcRAIIB6nQf//A3FqNgJMIAdBKGoQBBogByAHQShqIB9CGIinQf8BcRAIIB+nQf//A3FqNgJEIAcgB0HwAGogBEEDcUEEdGoiDSkDCCIdNwPIASAHIA0pAwAiHjcDwAECQAJAAkAgBygCvAEiDiAepyICaiIWIBNLDQAgAyAHKALEASIKIAJqIgtqIBhLDQAgEiADayALQSBqTw0BCyAHIAcpA8gBNwMQIAcgBykDwAE3AwggAyASIAdBCGogB0G8AWogEyAPIBUgERAeIQsMAQsgAiADaiEIIAMgDhAHIAJBEU8EQCADQRBqIQIDQCACIA5BEGoiDhAHIAJBEGoiAiAISQ0ACwsgCCAdpyIOayECIAcgFjYCvAEgDiAIIA9rSwRAIA4gCCAVa0sEQEFsIQsMAgsgESACIA9rIgJqIhYgCmogEU0EQCAIIBYgChAPGgwCCyAIIBZBACACaxAPIQggByACIApqIgo2AsQBIAggAmshCCAPIQILIA5BEE8EQCAIIApqIQoDQCAIIAIQByACQRBqIQIgCEEQaiIIIApJDQALDAELAkAgDkEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgDkECdCIKQcAeaigCAGoiAhAXIAIgCkHgHmooAgBrIQIgBygCxAEhCgwBCyAIIAIQDAsgCkEJSQ0AIAggCmohCiAIQQhqIgggAkEIaiICa0EPTARAA0AgCCACEAwgAkEIaiECIAhBCGoiCCAKSQ0ADAIACwALA0AgCCACEAcgAkEQaiECIAhBEGoiCCAKSQ0ACwsgCxADBEAgCyEQDAQFIA0gDDYCACANIBkgHGogCWs2AgwgDSAJNgIIIA0gFDYCBCAEQQFqIQQgAyALaiEDDAILAAsLIAQgBUgNASAEIBdrIQtBACEEA0AgCyAFSARAIAcgB0HwAGogC0EDcUEEdGoiAikDCCIdNwPIASAHIAIpAwAiHjcDwAECQAJAAkAgBygCvAEiDCAepyICaiIKIBNLDQAgAyAHKALEASIJIAJqIhBqIBhLDQAgEiADayAQQSBqTw0BCyAHIAcpA8gBNwMgIAcgBykDwAE3AxggAyASIAdBGGogB0G8AWogEyAPIBUgERAeIRAMAQsgAiADaiEIIAMgDBAHIAJBEU8EQCADQRBqIQIDQCACIAxBEGoiDBAHIAJBEGoiAiAISQ0ACwsgCCAdpyIGayECIAcgCjYCvAEgBiAIIA9rSwRAIAYgCCAVa0sEQEFsIRAMAgsgESACIA9rIgJqIgwgCWogEU0EQCAIIAwgCRAPGgwCCyAIIAxBACACaxAPIQggByACIAlqIgk2AsQBIAggAmshCCAPIQILIAZBEE8EQCAIIAlqIQYDQCAIIAIQByACQRBqIQIgCEEQaiIIIAZJDQALDAELAkAgBkEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgBkECdCIGQcAeaigCAGoiAhAXIAIgBkHgHmooAgBrIQIgBygCxAEhCQwBCyAIIAIQDAsgCUEJSQ0AIAggCWohBiAIQQhqIgggAkEIaiICa0EPTARAA0AgCCACEAwgAkEIaiECIAhBCGoiCCAGSQ0ADAIACwALA0AgCCACEAcgAkEQaiECIAhBEGoiCCAGSQ0ACwsgEBADDQMgC0EBaiELIAMgEGohAwwBCwsDQCAEQQNHBEAgACAEQQJ0IgJqQazQAWogAiAHaigCVDYCACAEQQFqIQQMAQsLIAcoArwBIQgLQbp/IRAgEyAIayIAIBIgA2tLDQAgAwR/IAMgCCAAEAsgAGoFQQALIAFrIRALIAdB0AFqJAAgEAslACAAQgA3AgAgAEEAOwEIIABBADoACyAAIAE2AgwgACACOgAKC7QFAQN/IwBBMGsiBCQAIABB/wFqIgVBfWohBgJAIAMvAQIEQCAEQRhqIAEgAhAGIgIQAw0BIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahASOgAAIAMgBEEIaiAEQRhqEBI6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0FIAEgBEEQaiAEQRhqEBI6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBSABIARBCGogBEEYahASOgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEjoAACABIAJqIABrIQIMAwsgAyAEQRBqIARBGGoQEjoAAiADIARBCGogBEEYahASOgADIANBBGohAwwAAAsACyAEQRhqIAEgAhAGIgIQAw0AIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahAROgAAIAMgBEEIaiAEQRhqEBE6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0EIAEgBEEQaiAEQRhqEBE6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBCABIARBCGogBEEYahAROgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEToAACABIAJqIABrIQIMAgsgAyAEQRBqIARBGGoQEToAAiADIARBCGogBEEYahAROgADIANBBGohAwwAAAsACyAEQTBqJAAgAgtpAQF/An8CQAJAIAJBB00NACABKAAAQbfIwuF+Rw0AIAAgASgABDYCmOIBQWIgAEEQaiABIAIQPiIDEAMNAhogAEKBgICAEDcDiOEBIAAgASADaiACIANrECoMAQsgACABIAIQKgtBAAsLrQMBBn8jAEGAAWsiAyQAQWIhCAJAIAJBCUkNACAAQZjQAGogAUEIaiIEIAJBeGogAEGY0AAQMyIFEAMiBg0AIANBHzYCfCADIANB/ABqIANB+ABqIAQgBCAFaiAGGyIEIAEgAmoiAiAEaxAVIgUQAw0AIAMoAnwiBkEfSw0AIAMoAngiB0EJTw0AIABBiCBqIAMgBkGAC0GADCAHEBggA0E0NgJ8IAMgA0H8AGogA0H4AGogBCAFaiIEIAIgBGsQFSIFEAMNACADKAJ8IgZBNEsNACADKAJ4IgdBCk8NACAAQZAwaiADIAZBgA1B4A4gBxAYIANBIzYCfCADIANB/ABqIANB+ABqIAQgBWoiBCACIARrEBUiBRADDQAgAygCfCIGQSNLDQAgAygCeCIHQQpPDQAgACADIAZBwBBB0BEgBxAYIAQgBWoiBEEMaiIFIAJLDQAgAiAFayEFQQAhAgNAIAJBA0cEQCAEKAAAIgZBf2ogBU8NAiAAIAJBAnRqQZzQAWogBjYCACACQQFqIQIgBEEEaiEEDAELCyAEIAFrIQgLIANBgAFqJAAgCAtGAQN/IABBCGohAyAAKAIEIQJBACEAA0AgACACdkUEQCABIAMgAEEDdGotAAJBFktqIQEgAEEBaiEADAELCyABQQggAmt0C4YDAQV/Qbh/IQcCQCADRQ0AIAItAAAiBEUEQCABQQA2AgBBAUG4fyADQQFGGw8LAn8gAkEBaiIFIARBGHRBGHUiBkF/Sg0AGiAGQX9GBEAgA0EDSA0CIAUvAABBgP4BaiEEIAJBA2oMAQsgA0ECSA0BIAItAAEgBEEIdHJBgIB+aiEEIAJBAmoLIQUgASAENgIAIAVBAWoiASACIANqIgNLDQBBbCEHIABBEGogACAFLQAAIgVBBnZBI0EJIAEgAyABa0HAEEHQEUHwEiAAKAKM4QEgACgCnOIBIAQQHyIGEAMiCA0AIABBmCBqIABBCGogBUEEdkEDcUEfQQggASABIAZqIAgbIgEgAyABa0GAC0GADEGAFyAAKAKM4QEgACgCnOIBIAQQHyIGEAMiCA0AIABBoDBqIABBBGogBUECdkEDcUE0QQkgASABIAZqIAgbIgEgAyABa0GADUHgDkGQGSAAKAKM4QEgACgCnOIBIAQQHyIAEAMNACAAIAFqIAJrIQcLIAcLrQMBCn8jAEGABGsiCCQAAn9BUiACQf8BSw0AGkFUIANBDEsNABogAkEBaiELIABBBGohCUGAgAQgA0F/anRBEHUhCkEAIQJBASEEQQEgA3QiB0F/aiIMIQUDQCACIAtGRQRAAkAgASACQQF0Ig1qLwEAIgZB//8DRgRAIAkgBUECdGogAjoAAiAFQX9qIQVBASEGDAELIARBACAKIAZBEHRBEHVKGyEECyAIIA1qIAY7AQAgAkEBaiECDAELCyAAIAQ7AQIgACADOwEAIAdBA3YgB0EBdmpBA2ohBkEAIQRBACECA0AgBCALRkUEQCABIARBAXRqLgEAIQpBACEAA0AgACAKTkUEQCAJIAJBAnRqIAQ6AAIDQCACIAZqIAxxIgIgBUsNAAsgAEEBaiEADAELCyAEQQFqIQQMAQsLQX8gAg0AGkEAIQIDfyACIAdGBH9BAAUgCCAJIAJBAnRqIgAtAAJBAXRqIgEgAS8BACIBQQFqOwEAIAAgAyABEBRrIgU6AAMgACABIAVB/wFxdCAHazsBACACQQFqIQIMAQsLCyEFIAhBgARqJAAgBQvjBgEIf0FsIQcCQCACQQNJDQACQAJAAkACQCABLQAAIgNBA3EiCUEBaw4DAwEAAgsgACgCiOEBDQBBYg8LIAJBBUkNAkEDIQYgASgAACEFAn8CQAJAIANBAnZBA3EiCEF+aiIEQQFNBEAgBEEBaw0BDAILIAVBDnZB/wdxIQQgBUEEdkH/B3EhAyAIRQwCCyAFQRJ2IQRBBCEGIAVBBHZB//8AcSEDQQAMAQsgBUEEdkH//w9xIgNBgIAISw0DIAEtAARBCnQgBUEWdnIhBEEFIQZBAAshBSAEIAZqIgogAksNAgJAIANBgQZJDQAgACgCnOIBRQ0AQQAhAgNAIAJBg4ABSw0BIAJBQGshAgwAAAsACwJ/IAlBA0YEQCABIAZqIQEgAEHw4gFqIQIgACgCDCEGIAUEQCACIAMgASAEIAYQXwwCCyACIAMgASAEIAYQXQwBCyAAQbjQAWohAiABIAZqIQEgAEHw4gFqIQYgAEGo0ABqIQggBQRAIAggBiADIAEgBCACEF4MAQsgCCAGIAMgASAEIAIQXAsQAw0CIAAgAzYCgOIBIABBATYCiOEBIAAgAEHw4gFqNgLw4QEgCUECRgRAIAAgAEGo0ABqNgIMCyAAIANqIgBBiOMBakIANwAAIABBgOMBakIANwAAIABB+OIBakIANwAAIABB8OIBakIANwAAIAoPCwJ/AkACQAJAIANBAnZBA3FBf2oiBEECSw0AIARBAWsOAgACAQtBASEEIANBA3YMAgtBAiEEIAEvAABBBHYMAQtBAyEEIAEQIUEEdgsiAyAEaiIFQSBqIAJLBEAgBSACSw0CIABB8OIBaiABIARqIAMQCyEBIAAgAzYCgOIBIAAgATYC8OEBIAEgA2oiAEIANwAYIABCADcAECAAQgA3AAggAEIANwAAIAUPCyAAIAM2AoDiASAAIAEgBGo2AvDhASAFDwsCfwJAAkACQCADQQJ2QQNxQX9qIgRBAksNACAEQQFrDgIAAgELQQEhByADQQN2DAILQQIhByABLwAAQQR2DAELIAJBBEkgARAhIgJBj4CAAUtyDQFBAyEHIAJBBHYLIQIgAEHw4gFqIAEgB2otAAAgAkEgahAQIQEgACACNgKA4gEgACABNgLw4QEgB0EBaiEHCyAHC0sAIABC+erQ0OfJoeThADcDICAAQgA3AxggAELP1tO+0ser2UI3AxAgAELW64Lu6v2J9eAANwMIIABCADcDACAAQShqQQBBKBAQGgviAgICfwV+IABBKGoiASAAKAJIaiECAn4gACkDACIDQiBaBEAgACkDECIEQgeJIAApAwgiBUIBiXwgACkDGCIGQgyJfCAAKQMgIgdCEol8IAUQGSAEEBkgBhAZIAcQGQwBCyAAKQMYQsXP2bLx5brqJ3wLIAN8IQMDQCABQQhqIgAgAk0EQEIAIAEpAAAQCSADhUIbiUKHla+vmLbem55/fkLj3MqV/M7y9YV/fCEDIAAhAQwBCwsCQCABQQRqIgAgAksEQCABIQAMAQsgASgAAK1Ch5Wvr5i23puef34gA4VCF4lCz9bTvtLHq9lCfkL5893xmfaZqxZ8IQMLA0AgACACSQRAIAAxAABCxc/ZsvHluuonfiADhUILiUKHla+vmLbem55/fiEDIABBAWohAAwBCwsgA0IhiCADhULP1tO+0ser2UJ+IgNCHYggA4VC+fPd8Zn2masWfiIDQiCIIAOFC+8CAgJ/BH4gACAAKQMAIAKtfDcDAAJAAkAgACgCSCIDIAJqIgRBH00EQCABRQ0BIAAgA2pBKGogASACECAgACgCSCACaiEEDAELIAEgAmohAgJ/IAMEQCAAQShqIgQgA2ogAUEgIANrECAgACAAKQMIIAQpAAAQCTcDCCAAIAApAxAgACkAMBAJNwMQIAAgACkDGCAAKQA4EAk3AxggACAAKQMgIABBQGspAAAQCTcDICAAKAJIIQMgAEEANgJIIAEgA2tBIGohAQsgAUEgaiACTQsEQCACQWBqIQMgACkDICEFIAApAxghBiAAKQMQIQcgACkDCCEIA0AgCCABKQAAEAkhCCAHIAEpAAgQCSEHIAYgASkAEBAJIQYgBSABKQAYEAkhBSABQSBqIgEgA00NAAsgACAFNwMgIAAgBjcDGCAAIAc3AxAgACAINwMICyABIAJPDQEgAEEoaiABIAIgAWsiBBAgCyAAIAQ2AkgLCy8BAX8gAEUEQEG2f0EAIAMbDwtBun8hBCADIAFNBH8gACACIAMQEBogAwVBun8LCy8BAX8gAEUEQEG2f0EAIAMbDwtBun8hBCADIAFNBH8gACACIAMQCxogAwVBun8LC6gCAQZ/IwBBEGsiByQAIABB2OABaikDAEKAgIAQViEIQbh/IQUCQCAEQf//B0sNACAAIAMgBBBCIgUQAyIGDQAgACgCnOIBIQkgACAHQQxqIAMgAyAFaiAGGyIKIARBACAFIAYbayIGEEAiAxADBEAgAyEFDAELIAcoAgwhBCABRQRAQbp/IQUgBEEASg0BCyAGIANrIQUgAyAKaiEDAkAgCQRAIABBADYCnOIBDAELAkACQAJAIARBBUgNACAAQdjgAWopAwBCgICACFgNAAwBCyAAQQA2ApziAQwBCyAAKAIIED8hBiAAQQA2ApziASAGQRRPDQELIAAgASACIAMgBSAEIAgQOSEFDAELIAAgASACIAMgBSAEIAgQOiEFCyAHQRBqJAAgBQtnACAAQdDgAWogASACIAAoAuzhARAuIgEQAwRAIAEPC0G4fyECAkAgAQ0AIABB7OABaigCACIBBEBBYCECIAAoApjiASABRw0BC0EAIQIgAEHw4AFqKAIARQ0AIABBkOEBahBDCyACCycBAX8QVyIERQRAQUAPCyAEIAAgASACIAMgBBBLEE8hACAEEFYgAAs/AQF/AkACQAJAIAAoAqDiAUEBaiIBQQJLDQAgAUEBaw4CAAECCyAAEDBBAA8LIABBADYCoOIBCyAAKAKU4gELvAMCB38BfiMAQRBrIgkkAEG4fyEGAkAgBCgCACIIQQVBCSAAKALs4QEiBRtJDQAgAygCACIHQQFBBSAFGyAFEC8iBRADBEAgBSEGDAELIAggBUEDakkNACAAIAcgBRBJIgYQAw0AIAEgAmohCiAAQZDhAWohCyAIIAVrIQIgBSAHaiEHIAEhBQNAIAcgAiAJECwiBhADDQEgAkF9aiICIAZJBEBBuH8hBgwCCyAJKAIAIghBAksEQEFsIQYMAgsgB0EDaiEHAn8CQAJAAkAgCEEBaw4CAgABCyAAIAUgCiAFayAHIAYQSAwCCyAFIAogBWsgByAGEEcMAQsgBSAKIAVrIActAAAgCSgCCBBGCyIIEAMEQCAIIQYMAgsgACgC8OABBEAgCyAFIAgQRQsgAiAGayECIAYgB2ohByAFIAhqIQUgCSgCBEUNAAsgACkD0OABIgxCf1IEQEFsIQYgDCAFIAFrrFINAQsgACgC8OABBEBBaiEGIAJBBEkNASALEEQhDCAHKAAAIAynRw0BIAdBBGohByACQXxqIQILIAMgBzYCACAEIAI2AgAgBSABayEGCyAJQRBqJAAgBgsuACAAECsCf0EAQQAQAw0AGiABRSACRXJFBEBBYiAAIAEgAhA9EAMNARoLQQALCzcAIAEEQCAAIAAoAsTgASABKAIEIAEoAghqRzYCnOIBCyAAECtBABADIAFFckUEQCAAIAEQWwsL0QIBB38jAEEQayIGJAAgBiAENgIIIAYgAzYCDCAFBEAgBSgCBCEKIAUoAgghCQsgASEIAkACQANAIAAoAuzhARAWIQsCQANAIAQgC0kNASADKAAAQXBxQdDUtMIBRgRAIAMgBBAiIgcQAw0EIAQgB2shBCADIAdqIQMMAQsLIAYgAzYCDCAGIAQ2AggCQCAFBEAgACAFEE5BACEHQQAQA0UNAQwFCyAAIAogCRBNIgcQAw0ECyAAIAgQUCAMQQFHQQAgACAIIAIgBkEMaiAGQQhqEEwiByIDa0EAIAMQAxtBCkdyRQRAQbh/IQcMBAsgBxADDQMgAiAHayECIAcgCGohCEEBIQwgBigCDCEDIAYoAgghBAwBCwsgBiADNgIMIAYgBDYCCEG4fyEHIAQNASAIIAFrIQcMAQsgBiADNgIMIAYgBDYCCAsgBkEQaiQAIAcLRgECfyABIAAoArjgASICRwRAIAAgAjYCxOABIAAgATYCuOABIAAoArzgASEDIAAgATYCvOABIAAgASADIAJrajYCwOABCwutAgIEfwF+IwBBQGoiBCQAAkACQCACQQhJDQAgASgAAEFwcUHQ1LTCAUcNACABIAIQIiEBIABCADcDCCAAQQA2AgQgACABNgIADAELIARBGGogASACEC0iAxADBEAgACADEBoMAQsgAwRAIABBuH8QGgwBCyACIAQoAjAiA2shAiABIANqIQMDQAJAIAAgAyACIARBCGoQLCIFEAMEfyAFBSACIAVBA2oiBU8NAUG4fwsQGgwCCyAGQQFqIQYgAiAFayECIAMgBWohAyAEKAIMRQ0ACyAEKAI4BEAgAkEDTQRAIABBuH8QGgwCCyADQQRqIQMLIAQoAighAiAEKQMYIQcgAEEANgIEIAAgAyABazYCACAAIAIgBmytIAcgB0J/URs3AwgLIARBQGskAAslAQF/IwBBEGsiAiQAIAIgACABEFEgAigCACEAIAJBEGokACAAC30BBH8jAEGQBGsiBCQAIARB/wE2AggCQCAEQRBqIARBCGogBEEMaiABIAIQFSIGEAMEQCAGIQUMAQtBVCEFIAQoAgwiB0EGSw0AIAMgBEEQaiAEKAIIIAcQQSIFEAMNACAAIAEgBmogAiAGayADEDwhBQsgBEGQBGokACAFC4cBAgJ/An5BABAWIQMCQANAIAEgA08EQAJAIAAoAABBcHFB0NS0wgFGBEAgACABECIiAhADRQ0BQn4PCyAAIAEQVSIEQn1WDQMgBCAFfCIFIARUIQJCfiEEIAINAyAAIAEQUiICEAMNAwsgASACayEBIAAgAmohAAwBCwtCfiAFIAEbIQQLIAQLPwIBfwF+IwBBMGsiAiQAAn5CfiACQQhqIAAgARAtDQAaQgAgAigCHEEBRg0AGiACKQMICyEDIAJBMGokACADC40BAQJ/IwBBMGsiASQAAkAgAEUNACAAKAKI4gENACABIABB/OEBaigCADYCKCABIAApAvThATcDICAAEDAgACgCqOIBIQIgASABKAIoNgIYIAEgASkDIDcDECACIAFBEGoQGyAAQQA2AqjiASABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALKgECfyMAQRBrIgAkACAAQQA2AgggAEIANwMAIAAQWCEBIABBEGokACABC4cBAQN/IwBBEGsiAiQAAkAgACgCAEUgACgCBEVzDQAgAiAAKAIINgIIIAIgACkCADcDAAJ/IAIoAgAiAQRAIAIoAghBqOMJIAERBQAMAQtBqOMJECgLIgFFDQAgASAAKQIANwL04QEgAUH84QFqIAAoAgg2AgAgARBZIAEhAwsgAkEQaiQAIAMLywEBAn8jAEEgayIBJAAgAEGBgIDAADYCtOIBIABBADYCiOIBIABBADYC7OEBIABCADcDkOIBIABBADYCpOMJIABBADYC3OIBIABCADcCzOIBIABBADYCvOIBIABBADYCxOABIABCADcCnOIBIABBpOIBakIANwIAIABBrOIBakEANgIAIAFCADcCECABQgA3AhggASABKQMYNwMIIAEgASkDEDcDACABKAIIQQh2QQFxIQIgAEEANgLg4gEgACACNgKM4gEgAUEgaiQAC3YBA38jAEEwayIBJAAgAARAIAEgAEHE0AFqIgIoAgA2AiggASAAKQK80AE3AyAgACgCACEDIAEgAigCADYCGCABIAApArzQATcDECADIAFBEGoQGyABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALzAEBAX8gACABKAK00AE2ApjiASAAIAEoAgQiAjYCwOABIAAgAjYCvOABIAAgAiABKAIIaiICNgK44AEgACACNgLE4AEgASgCuNABBEAgAEKBgICAEDcDiOEBIAAgAUGk0ABqNgIMIAAgAUGUIGo2AgggACABQZwwajYCBCAAIAFBDGo2AgAgAEGs0AFqIAFBqNABaigCADYCACAAQbDQAWogAUGs0AFqKAIANgIAIABBtNABaiABQbDQAWooAgA2AgAPCyAAQgA3A4jhAQs7ACACRQRAQbp/DwsgBEUEQEFsDwsgAiAEEGAEQCAAIAEgAiADIAQgBRBhDwsgACABIAIgAyAEIAUQZQtGAQF/IwBBEGsiBSQAIAVBCGogBBAOAn8gBS0ACQRAIAAgASACIAMgBBAyDAELIAAgASACIAMgBBA0CyEAIAVBEGokACAACzQAIAAgAyAEIAUQNiIFEAMEQCAFDwsgBSAESQR/IAEgAiADIAVqIAQgBWsgABA1BUG4fwsLRgEBfyMAQRBrIgUkACAFQQhqIAQQDgJ/IAUtAAkEQCAAIAEgAiADIAQQYgwBCyAAIAEgAiADIAQQNQshACAFQRBqJAAgAAtZAQF/QQ8hAiABIABJBEAgAUEEdCAAbiECCyAAQQh2IgEgAkEYbCIAQYwIaigCAGwgAEGICGooAgBqIgJBA3YgAmogAEGACGooAgAgAEGECGooAgAgAWxqSQs3ACAAIAMgBCAFQYAQEDMiBRADBEAgBQ8LIAUgBEkEfyABIAIgAyAFaiAEIAVrIAAQMgVBuH8LC78DAQN/IwBBIGsiBSQAIAVBCGogAiADEAYiAhADRQRAIAAgAWoiB0F9aiEGIAUgBBAOIARBBGohAiAFLQACIQMDQEEAIAAgBkkgBUEIahAEGwRAIAAgAiAFQQhqIAMQAkECdGoiBC8BADsAACAFQQhqIAQtAAIQASAAIAQtAANqIgQgAiAFQQhqIAMQAkECdGoiAC8BADsAACAFQQhqIAAtAAIQASAEIAAtAANqIQAMAQUgB0F+aiEEA0AgBUEIahAEIAAgBEtyRQRAIAAgAiAFQQhqIAMQAkECdGoiBi8BADsAACAFQQhqIAYtAAIQASAAIAYtAANqIQAMAQsLA0AgACAES0UEQCAAIAIgBUEIaiADEAJBAnRqIgYvAQA7AAAgBUEIaiAGLQACEAEgACAGLQADaiEADAELCwJAIAAgB08NACAAIAIgBUEIaiADEAIiA0ECdGoiAC0AADoAACAALQADQQFGBEAgBUEIaiAALQACEAEMAQsgBSgCDEEfSw0AIAVBCGogAiADQQJ0ai0AAhABIAUoAgxBIUkNACAFQSA2AgwLIAFBbCAFQQhqEAobIQILCwsgBUEgaiQAIAILkgIBBH8jAEFAaiIJJAAgCSADQTQQCyEDAkAgBEECSA0AIAMgBEECdGooAgAhCSADQTxqIAgQIyADQQE6AD8gAyACOgA+QQAhBCADKAI8IQoDQCAEIAlGDQEgACAEQQJ0aiAKNgEAIARBAWohBAwAAAsAC0EAIQkDQCAGIAlGRQRAIAMgBSAJQQF0aiIKLQABIgtBAnRqIgwoAgAhBCADQTxqIAotAABBCHQgCGpB//8DcRAjIANBAjoAPyADIAcgC2siCiACajoAPiAEQQEgASAKa3RqIQogAygCPCELA0AgACAEQQJ0aiALNgEAIARBAWoiBCAKSQ0ACyAMIAo2AgAgCUEBaiEJDAELCyADQUBrJAALowIBCX8jAEHQAGsiCSQAIAlBEGogBUE0EAsaIAcgBmshDyAHIAFrIRADQAJAIAMgCkcEQEEBIAEgByACIApBAXRqIgYtAAEiDGsiCGsiC3QhDSAGLQAAIQ4gCUEQaiAMQQJ0aiIMKAIAIQYgCyAPTwRAIAAgBkECdGogCyAIIAUgCEE0bGogCCAQaiIIQQEgCEEBShsiCCACIAQgCEECdGooAgAiCEEBdGogAyAIayAHIA4QYyAGIA1qIQgMAgsgCUEMaiAOECMgCUEBOgAPIAkgCDoADiAGIA1qIQggCSgCDCELA0AgBiAITw0CIAAgBkECdGogCzYBACAGQQFqIQYMAAALAAsgCUHQAGokAA8LIAwgCDYCACAKQQFqIQoMAAALAAs0ACAAIAMgBCAFEDYiBRADBEAgBQ8LIAUgBEkEfyABIAIgAyAFaiAEIAVrIAAQNAVBuH8LCyMAIAA/AEEQdGtB//8DakEQdkAAQX9GBEBBAA8LQQAQAEEBCzsBAX8gAgRAA0AgACABIAJBgCAgAkGAIEkbIgMQCyEAIAFBgCBqIQEgAEGAIGohACACIANrIgINAAsLCwYAIAAQAwsLqBUJAEGICAsNAQAAAAEAAAACAAAAAgBBoAgLswYBAAAAAQAAAAIAAAACAAAAJgAAAIIAAAAhBQAASgAAAGcIAAAmAAAAwAEAAIAAAABJBQAASgAAAL4IAAApAAAALAIAAIAAAABJBQAASgAAAL4IAAAvAAAAygIAAIAAAACKBQAASgAAAIQJAAA1AAAAcwMAAIAAAACdBQAASgAAAKAJAAA9AAAAgQMAAIAAAADrBQAASwAAAD4KAABEAAAAngMAAIAAAABNBgAASwAAAKoKAABLAAAAswMAAIAAAADBBgAATQAAAB8NAABNAAAAUwQAAIAAAAAjCAAAUQAAAKYPAABUAAAAmQQAAIAAAABLCQAAVwAAALESAABYAAAA2gQAAIAAAABvCQAAXQAAACMUAABUAAAARQUAAIAAAABUCgAAagAAAIwUAABqAAAArwUAAIAAAAB2CQAAfAAAAE4QAAB8AAAA0gIAAIAAAABjBwAAkQAAAJAHAACSAAAAAAAAAAEAAAABAAAABQAAAA0AAAAdAAAAPQAAAH0AAAD9AAAA/QEAAP0DAAD9BwAA/Q8AAP0fAAD9PwAA/X8AAP3/AAD9/wEA/f8DAP3/BwD9/w8A/f8fAP3/PwD9/38A/f//AP3//wH9//8D/f//B/3//w/9//8f/f//P/3//38AAAAAAQAAAAIAAAADAAAABAAAAAUAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAABEAAAASAAAAEwAAABQAAAAVAAAAFgAAABcAAAAYAAAAGQAAABoAAAAbAAAAHAAAAB0AAAAeAAAAHwAAAAMAAAAEAAAABQAAAAYAAAAHAAAACAAAAAkAAAAKAAAACwAAAAwAAAANAAAADgAAAA8AAAAQAAAAEQAAABIAAAATAAAAFAAAABUAAAAWAAAAFwAAABgAAAAZAAAAGgAAABsAAAAcAAAAHQAAAB4AAAAfAAAAIAAAACEAAAAiAAAAIwAAACUAAAAnAAAAKQAAACsAAAAvAAAAMwAAADsAAABDAAAAUwAAAGMAAACDAAAAAwEAAAMCAAADBAAAAwgAAAMQAAADIAAAA0AAAAOAAAADAAEAQeAPC1EBAAAAAQAAAAEAAAABAAAAAgAAAAIAAAADAAAAAwAAAAQAAAAEAAAABQAAAAcAAAAIAAAACQAAAAoAAAALAAAADAAAAA0AAAAOAAAADwAAABAAQcQQC4sBAQAAAAIAAAADAAAABAAAAAUAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAABIAAAAUAAAAFgAAABgAAAAcAAAAIAAAACgAAAAwAAAAQAAAAIAAAAAAAQAAAAIAAAAEAAAACAAAABAAAAAgAAAAQAAAAIAAAAAAAQBBkBIL5gQBAAAAAQAAAAEAAAABAAAAAgAAAAIAAAADAAAAAwAAAAQAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAAAEAAAAEAAAACAAAAAAAAAABAAEBBgAAAAAAAAQAAAAAEAAABAAAAAAgAAAFAQAAAAAAAAUDAAAAAAAABQQAAAAAAAAFBgAAAAAAAAUHAAAAAAAABQkAAAAAAAAFCgAAAAAAAAUMAAAAAAAABg4AAAAAAAEFEAAAAAAAAQUUAAAAAAABBRYAAAAAAAIFHAAAAAAAAwUgAAAAAAAEBTAAAAAgAAYFQAAAAAAABwWAAAAAAAAIBgABAAAAAAoGAAQAAAAADAYAEAAAIAAABAAAAAAAAAAEAQAAAAAAAAUCAAAAIAAABQQAAAAAAAAFBQAAACAAAAUHAAAAAAAABQgAAAAgAAAFCgAAAAAAAAULAAAAAAAABg0AAAAgAAEFEAAAAAAAAQUSAAAAIAABBRYAAAAAAAIFGAAAACAAAwUgAAAAAAADBSgAAAAAAAYEQAAAABAABgRAAAAAIAAHBYAAAAAAAAkGAAIAAAAACwYACAAAMAAABAAAAAAQAAAEAQAAACAAAAUCAAAAIAAABQMAAAAgAAAFBQAAACAAAAUGAAAAIAAABQgAAAAgAAAFCQAAACAAAAULAAAAIAAABQwAAAAAAAAGDwAAACAAAQUSAAAAIAABBRQAAAAgAAIFGAAAACAAAgUcAAAAIAADBSgAAAAgAAQFMAAAAAAAEAYAAAEAAAAPBgCAAAAAAA4GAEAAAAAADQYAIABBgBcLhwIBAAEBBQAAAAAAAAUAAAAAAAAGBD0AAAAAAAkF/QEAAAAADwX9fwAAAAAVBf3/HwAAAAMFBQAAAAAABwR9AAAAAAAMBf0PAAAAABIF/f8DAAAAFwX9/38AAAAFBR0AAAAAAAgE/QAAAAAADgX9PwAAAAAUBf3/DwAAAAIFAQAAABAABwR9AAAAAAALBf0HAAAAABEF/f8BAAAAFgX9/z8AAAAEBQ0AAAAQAAgE/QAAAAAADQX9HwAAAAATBf3/BwAAAAEFAQAAABAABgQ9AAAAAAAKBf0DAAAAABAF/f8AAAAAHAX9//8PAAAbBf3//wcAABoF/f//AwAAGQX9//8BAAAYBf3//wBBkBkLhgQBAAEBBgAAAAAAAAYDAAAAAAAABAQAAAAgAAAFBQAAAAAAAAUGAAAAAAAABQgAAAAAAAAFCQAAAAAAAAULAAAAAAAABg0AAAAAAAAGEAAAAAAAAAYTAAAAAAAABhYAAAAAAAAGGQAAAAAAAAYcAAAAAAAABh8AAAAAAAAGIgAAAAAAAQYlAAAAAAABBikAAAAAAAIGLwAAAAAAAwY7AAAAAAAEBlMAAAAAAAcGgwAAAAAACQYDAgAAEAAABAQAAAAAAAAEBQAAACAAAAUGAAAAAAAABQcAAAAgAAAFCQAAAAAAAAUKAAAAAAAABgwAAAAAAAAGDwAAAAAAAAYSAAAAAAAABhUAAAAAAAAGGAAAAAAAAAYbAAAAAAAABh4AAAAAAAAGIQAAAAAAAQYjAAAAAAABBicAAAAAAAIGKwAAAAAAAwYzAAAAAAAEBkMAAAAAAAUGYwAAAAAACAYDAQAAIAAABAQAAAAwAAAEBAAAABAAAAQFAAAAIAAABQcAAAAgAAAFCAAAACAAAAUKAAAAIAAABQsAAAAAAAAGDgAAAAAAAAYRAAAAAAAABhQAAAAAAAAGFwAAAAAAAAYaAAAAAAAABh0AAAAAAAAGIAAAAAAAEAYDAAEAAAAPBgOAAAAAAA4GA0AAAAAADQYDIAAAAAAMBgMQAAAAAAsGAwgAAAAACgYDBABBpB0L2QEBAAAAAwAAAAcAAAAPAAAAHwAAAD8AAAB/AAAA/wAAAP8BAAD/AwAA/wcAAP8PAAD/HwAA/z8AAP9/AAD//wAA//8BAP//AwD//wcA//8PAP//HwD//z8A//9/AP///wD///8B////A////wf///8P////H////z////9/AAAAAAEAAAACAAAABAAAAAAAAAACAAAABAAAAAgAAAAAAAAAAQAAAAIAAAABAAAABAAAAAQAAAAEAAAABAAAAAgAAAAIAAAACAAAAAcAAAAIAAAACQAAAAoAAAALAEGgIAsDwBBQ",_taskCache=new WeakMap;let _activeLoaders=0,_zstd;class KTX2Loader extends three_module.aHM{constructor(o){super(o),this.transcoderPath="",this.transcoderBinary=null,this.transcoderPending=null,this.workerPool=new WorkerPool,this.workerSourceURL="",this.workerConfig=null,typeof MSC_TRANSCODER<"u"&&console.warn('THREE.KTX2Loader: Please update to latest "basis_transcoder". "msc_basis_transcoder" is no longer supported in three.js r125+.')}setTranscoderPath(o){return this.transcoderPath=o,this}setWorkerLimit(o){return this.workerPool.setWorkerLimit(o),this}detectSupport(o){return o.isWebGPURenderer===!0?this.workerConfig={astcSupported:o.hasFeature("texture-compression-astc"),etc1Supported:!1,etc2Supported:o.hasFeature("texture-compression-etc2"),dxtSupported:o.hasFeature("texture-compression-bc"),bptcSupported:!1,pvrtcSupported:!1}:(this.workerConfig={astcSupported:o.extensions.has("WEBGL_compressed_texture_astc"),etc1Supported:o.extensions.has("WEBGL_compressed_texture_etc1"),etc2Supported:o.extensions.has("WEBGL_compressed_texture_etc"),dxtSupported:o.extensions.has("WEBGL_compressed_texture_s3tc"),bptcSupported:o.extensions.has("EXT_texture_compression_bptc"),pvrtcSupported:o.extensions.has("WEBGL_compressed_texture_pvrtc")||o.extensions.has("WEBKIT_WEBGL_compressed_texture_pvrtc")},o.capabilities.isWebGL2&&(this.workerConfig.etc1Supported=!1)),this}init(){if(!this.transcoderPending){const o=new three_module.Y9S(this.manager);o.setPath(this.transcoderPath),o.setWithCredentials(this.withCredentials);const c=o.loadAsync("basis_transcoder.js"),d=new three_module.Y9S(this.manager);d.setPath(this.transcoderPath),d.setResponseType("arraybuffer"),d.setWithCredentials(this.withCredentials);const _=d.loadAsync("basis_transcoder.wasm");this.transcoderPending=Promise.all([c,_]).then(([b,_e])=>{const it=KTX2Loader.BasisWorker,nt=["/* constants */","let _EngineFormat = "+JSON.stringify(KTX2Loader.EngineFormat),"let _TranscoderFormat = "+JSON.stringify(KTX2Loader.TranscoderFormat),"let _BasisFormat = "+JSON.stringify(KTX2Loader.BasisFormat),"/* basis_transcoder.js */",b,"/* worker */",it.substring(it.indexOf("{")+1,it.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([nt])),this.transcoderBinary=_e,this.workerPool.setWorkerCreator(()=>{const at=new Worker(this.workerSourceURL),ut=this.transcoderBinary.slice(0);return at.postMessage({type:"init",config:this.workerConfig,transcoderBinary:ut},[ut]),at})}),_activeLoaders>0&&console.warn("THREE.KTX2Loader: Multiple active KTX2 loaders may cause performance issues. Use a single KTX2Loader instance, or call .dispose() on old instances."),_activeLoaders++}return this.transcoderPending}load(o,c,d,_){if(this.workerConfig===null)throw new Error("THREE.KTX2Loader: Missing initialization with `.detectSupport( renderer )`.");const b=new three_module.Y9S(this.manager);b.setResponseType("arraybuffer"),b.setCrossOrigin(this.crossOrigin),b.setWithCredentials(this.withCredentials),b.load(o,_e=>{if(_taskCache.has(_e))return _taskCache.get(_e).promise.then(c).catch(_);this.createTexture(_e).then(it=>c?c(it):null).catch(_)},d,_)}_createTextureFrom(o,c){const{faces:d,width:_,height:b,format:_e,type:it,error:nt,dfdFlags:at}=o;if(it==="error")return Promise.reject(nt);let ut;if(c.faceCount===6)ut=new three_module.c5h(d,_e,three_module.OUM);else{const pt=d[0].mipmaps;ut=c.layerCount>1?new three_module.iOZ(pt,_,b,c.layerCount,_e,three_module.OUM):new three_module.FvD(pt,_,b,_e,three_module.OUM)}return ut.minFilter=d[0].mipmaps.length===1?three_module.k6q:three_module.$_I,ut.magFilter=three_module.k6q,ut.generateMipmaps=!1,ut.needsUpdate=!0,ut.colorSpace=parseColorSpace(c),ut.premultiplyAlpha=!!(at&ktx_parse_module_p),ut}async createTexture(o,c={}){const d=Pi$1(new Uint8Array(o));if(d.vkFormat!==ktx_parse_module_nt)return createRawTexture(d);const _=c,b=this.init().then(()=>this.workerPool.postMessage({type:"transcode",buffer:o,taskConfig:_},[o])).then(_e=>this._createTextureFrom(_e.data,d));return _taskCache.set(o,{promise:b}),b}dispose(){return this.workerPool.dispose(),this.workerSourceURL&&URL.revokeObjectURL(this.workerSourceURL),_activeLoaders--,this}}KTX2Loader.BasisFormat={ETC1S:0,UASTC_4x4:1},KTX2Loader.TranscoderFormat={ETC1:0,ETC2:1,BC1:2,BC3:3,BC4:4,BC5:5,BC7_M6_OPAQUE_ONLY:6,BC7_M5:7,PVRTC1_4_RGB:8,PVRTC1_4_RGBA:9,ASTC_4x4:10,ATC_RGB:11,ATC_RGBA_INTERPOLATED_ALPHA:12,RGBA32:13,RGB565:14,BGR565:15,RGBA4444:16},KTX2Loader.EngineFormat={RGBAFormat:three_module.GWd,RGBA_ASTC_4x4_Format:three_module.qa3,RGBA_BPTC_Format:three_module.Fn,RGBA_ETC2_EAC_Format:three_module.KDk,RGBA_PVRTC_4BPPV1_Format:three_module.HXV,RGBA_S3TC_DXT5_Format:three_module.BXX,RGB_ETC1_Format:three_module.CVz,RGB_ETC2_Format:three_module.Riy,RGB_PVRTC_4BPPV1_Format:three_module.k6Q,RGB_S3TC_DXT1_Format:three_module.IE4},KTX2Loader.BasisWorker=`function () {

	let config;
	let transcoderPending;
	let BasisModule;

	const EngineFormat = _EngineFormat; // eslint-disable-line no-undef
	const TranscoderFormat = _TranscoderFormat; // eslint-disable-line no-undef
	const BasisFormat = _BasisFormat; // eslint-disable-line no-undef

	self.addEventListener( 'message', function ( e ) {

		const message = e.data;

		switch ( message.type ) {

			case 'init':
				config = message.config;
				init( message.transcoderBinary );
				break;

			case 'transcode':
				transcoderPending.then( () => {

					try {

						const { faces, buffers, width, height, hasAlpha, format, dfdFlags } = transcode( message.buffer );

						self.postMessage( { type: 'transcode', id: message.id, faces, width, height, hasAlpha, format, dfdFlags }, buffers );

					} catch ( error ) {

						console.error( error );

						self.postMessage( { type: 'error', id: message.id, error: error.message } );

					}

				} );
				break;

		}

	} );

	function init( wasmBinary ) {

		transcoderPending = new Promise( ( resolve ) => {

			BasisModule = { wasmBinary, onRuntimeInitialized: resolve };
			BASIS( BasisModule ); // eslint-disable-line no-undef

		} ).then( () => {

			BasisModule.initializeBasis();

			if ( BasisModule.KTX2File === undefined ) {

				console.warn( 'THREE.KTX2Loader: Please update Basis Universal transcoder.' );

			}

		} );

	}

	function transcode( buffer ) {

		const ktx2File = new BasisModule.KTX2File( new Uint8Array( buffer ) );

		function cleanup() {

			ktx2File.close();
			ktx2File.delete();

		}

		if ( ! ktx2File.isValid() ) {

			cleanup();
			throw new Error( 'THREE.KTX2Loader:	Invalid or unsupported .ktx2 file' );

		}

		const basisFormat = ktx2File.isUASTC() ? BasisFormat.UASTC_4x4 : BasisFormat.ETC1S;
		const width = ktx2File.getWidth();
		const height = ktx2File.getHeight();
		const layerCount = ktx2File.getLayers() || 1;
		const levelCount = ktx2File.getLevels();
		const faceCount = ktx2File.getFaces();
		const hasAlpha = ktx2File.getHasAlpha();
		const dfdFlags = ktx2File.getDFDFlags();

		const { transcoderFormat, engineFormat } = getTranscoderFormat( basisFormat, width, height, hasAlpha );

		if ( ! width || ! height || ! levelCount ) {

			cleanup();
			throw new Error( 'THREE.KTX2Loader:	Invalid texture' );

		}

		if ( ! ktx2File.startTranscoding() ) {

			cleanup();
			throw new Error( 'THREE.KTX2Loader: .startTranscoding failed' );

		}

		const faces = [];
		const buffers = [];

		for ( let face = 0; face < faceCount; face ++ ) {

			const mipmaps = [];

			for ( let mip = 0; mip < levelCount; mip ++ ) {

				const layerMips = [];

				let mipWidth, mipHeight;

				for ( let layer = 0; layer < layerCount; layer ++ ) {

					const levelInfo = ktx2File.getImageLevelInfo( mip, layer, face );

					if ( face === 0 && mip === 0 && layer === 0 && ( levelInfo.origWidth % 4 !== 0 || levelInfo.origHeight % 4 !== 0 ) ) {

						console.warn( 'THREE.KTX2Loader: ETC1S and UASTC textures should use multiple-of-four dimensions.' );

					}

					if ( levelCount > 1 ) {

						mipWidth = levelInfo.origWidth;
						mipHeight = levelInfo.origHeight;

					} else {

						// Handles non-multiple-of-four dimensions in textures without mipmaps. Textures with
						// mipmaps must use multiple-of-four dimensions, for some texture formats and APIs.
						// See mrdoob/three.js#25908.
						mipWidth = levelInfo.width;
						mipHeight = levelInfo.height;

					}

					const dst = new Uint8Array( ktx2File.getImageTranscodedSizeInBytes( mip, layer, 0, transcoderFormat ) );
					const status = ktx2File.transcodeImage( dst, mip, layer, face, transcoderFormat, 0, - 1, - 1 );

					if ( ! status ) {

						cleanup();
						throw new Error( 'THREE.KTX2Loader: .transcodeImage failed.' );

					}

					layerMips.push( dst );

				}

				const mipData = concat( layerMips );

				mipmaps.push( { data: mipData, width: mipWidth, height: mipHeight } );
				buffers.push( mipData.buffer );

			}

			faces.push( { mipmaps, width, height, format: engineFormat } );

		}

		cleanup();

		return { faces, buffers, width, height, hasAlpha, format: engineFormat, dfdFlags };

	}

	//

	// Optimal choice of a transcoder target format depends on the Basis format (ETC1S or UASTC),
	// device capabilities, and texture dimensions. The list below ranks the formats separately
	// for ETC1S and UASTC.
	//
	// In some cases, transcoding UASTC to RGBA32 might be preferred for higher quality (at
	// significant memory cost) compared to ETC1/2, BC1/3, and PVRTC. The transcoder currently
	// chooses RGBA32 only as a last resort and does not expose that option to the caller.
	const FORMAT_OPTIONS = [
		{
			if: 'astcSupported',
			basisFormat: [ BasisFormat.UASTC_4x4 ],
			transcoderFormat: [ TranscoderFormat.ASTC_4x4, TranscoderFormat.ASTC_4x4 ],
			engineFormat: [ EngineFormat.RGBA_ASTC_4x4_Format, EngineFormat.RGBA_ASTC_4x4_Format ],
			priorityETC1S: Infinity,
			priorityUASTC: 1,
			needsPowerOfTwo: false,
		},
		{
			if: 'bptcSupported',
			basisFormat: [ BasisFormat.ETC1S, BasisFormat.UASTC_4x4 ],
			transcoderFormat: [ TranscoderFormat.BC7_M5, TranscoderFormat.BC7_M5 ],
			engineFormat: [ EngineFormat.RGBA_BPTC_Format, EngineFormat.RGBA_BPTC_Format ],
			priorityETC1S: 3,
			priorityUASTC: 2,
			needsPowerOfTwo: false,
		},
		{
			if: 'dxtSupported',
			basisFormat: [ BasisFormat.ETC1S, BasisFormat.UASTC_4x4 ],
			transcoderFormat: [ TranscoderFormat.BC1, TranscoderFormat.BC3 ],
			engineFormat: [ EngineFormat.RGB_S3TC_DXT1_Format, EngineFormat.RGBA_S3TC_DXT5_Format ],
			priorityETC1S: 4,
			priorityUASTC: 5,
			needsPowerOfTwo: false,
		},
		{
			if: 'etc2Supported',
			basisFormat: [ BasisFormat.ETC1S, BasisFormat.UASTC_4x4 ],
			transcoderFormat: [ TranscoderFormat.ETC1, TranscoderFormat.ETC2 ],
			engineFormat: [ EngineFormat.RGB_ETC2_Format, EngineFormat.RGBA_ETC2_EAC_Format ],
			priorityETC1S: 1,
			priorityUASTC: 3,
			needsPowerOfTwo: false,
		},
		{
			if: 'etc1Supported',
			basisFormat: [ BasisFormat.ETC1S, BasisFormat.UASTC_4x4 ],
			transcoderFormat: [ TranscoderFormat.ETC1 ],
			engineFormat: [ EngineFormat.RGB_ETC1_Format ],
			priorityETC1S: 2,
			priorityUASTC: 4,
			needsPowerOfTwo: false,
		},
		{
			if: 'pvrtcSupported',
			basisFormat: [ BasisFormat.ETC1S, BasisFormat.UASTC_4x4 ],
			transcoderFormat: [ TranscoderFormat.PVRTC1_4_RGB, TranscoderFormat.PVRTC1_4_RGBA ],
			engineFormat: [ EngineFormat.RGB_PVRTC_4BPPV1_Format, EngineFormat.RGBA_PVRTC_4BPPV1_Format ],
			priorityETC1S: 5,
			priorityUASTC: 6,
			needsPowerOfTwo: true,
		},
	];

	const ETC1S_OPTIONS = FORMAT_OPTIONS.sort( function ( a, b ) {

		return a.priorityETC1S - b.priorityETC1S;

	} );
	const UASTC_OPTIONS = FORMAT_OPTIONS.sort( function ( a, b ) {

		return a.priorityUASTC - b.priorityUASTC;

	} );

	function getTranscoderFormat( basisFormat, width, height, hasAlpha ) {

		let transcoderFormat;
		let engineFormat;

		const options = basisFormat === BasisFormat.ETC1S ? ETC1S_OPTIONS : UASTC_OPTIONS;

		for ( let i = 0; i < options.length; i ++ ) {

			const opt = options[ i ];

			if ( ! config[ opt.if ] ) continue;
			if ( ! opt.basisFormat.includes( basisFormat ) ) continue;
			if ( hasAlpha && opt.transcoderFormat.length < 2 ) continue;
			if ( opt.needsPowerOfTwo && ! ( isPowerOfTwo( width ) && isPowerOfTwo( height ) ) ) continue;

			transcoderFormat = opt.transcoderFormat[ hasAlpha ? 1 : 0 ];
			engineFormat = opt.engineFormat[ hasAlpha ? 1 : 0 ];

			return { transcoderFormat, engineFormat };

		}

		console.warn( 'THREE.KTX2Loader: No suitable compressed texture format found. Decoding to RGBA32.' );

		transcoderFormat = TranscoderFormat.RGBA32;
		engineFormat = EngineFormat.RGBAFormat;

		return { transcoderFormat, engineFormat };

	}

	function isPowerOfTwo( value ) {

		if ( value <= 2 ) return true;

		return ( value & ( value - 1 ) ) === 0 && value !== 0;

	}

	/** Concatenates N byte arrays. */
	function concat( arrays ) {

		if ( arrays.length === 1 ) return arrays[ 0 ];

		let totalByteLength = 0;

		for ( let i = 0; i < arrays.length; i ++ ) {

			const array = arrays[ i ];
			totalByteLength += array.byteLength;

		}

		const result = new Uint8Array( totalByteLength );

		let byteOffset = 0;

		for ( let i = 0; i < arrays.length; i ++ ) {

			const array = arrays[ i ];
			result.set( array, byteOffset );

			byteOffset += array.byteLength;

		}

		return result;

	}

}`;const UNCOMPRESSED_FORMATS=new Set([three_module.GWd,three_module.paN,three_module.VT0]),FORMAT_MAP={[ktx_parse_module_Ae]:three_module.GWd,[ktx_parse_module_pe]:three_module.GWd,[Ot]:three_module.GWd,[Ft]:three_module.GWd,[ktx_parse_module_de]:three_module.paN,[ktx_parse_module_se]:three_module.paN,[yt]:three_module.paN,[dt]:three_module.paN,[ktx_parse_module_xe]:three_module.VT0,[$t]:three_module.VT0,[gt]:three_module.VT0,[ktx_parse_module_ct]:three_module.VT0,[In]:three_module.Qrf,[Sn]:three_module.Qrf},TYPE_MAP={[ktx_parse_module_Ae]:three_module.RQf,[ktx_parse_module_pe]:three_module.ix0,[Ot]:three_module.OUM,[Ft]:three_module.OUM,[ktx_parse_module_de]:three_module.RQf,[ktx_parse_module_se]:three_module.ix0,[yt]:three_module.OUM,[dt]:three_module.OUM,[ktx_parse_module_xe]:three_module.RQf,[$t]:three_module.ix0,[gt]:three_module.OUM,[ktx_parse_module_ct]:three_module.OUM,[In]:three_module.OUM,[Sn]:three_module.OUM};async function createRawTexture(h){const{vkFormat:o}=h;if(FORMAT_MAP[o]===void 0)throw new Error("THREE.KTX2Loader: Unsupported vkFormat.");let c;h.supercompressionScheme===n$2&&(_zstd||(_zstd=new Promise(async b=>{const _e=new zstddec_module_Q;await _e.init(),b(_e)})),c=await _zstd);const d=[];for(let b=0;b<h.levels.length;b++){const _e=Math.max(1,h.pixelWidth>>b),it=Math.max(1,h.pixelHeight>>b),nt=h.pixelDepth?Math.max(1,h.pixelDepth>>b):0,at=h.levels[b];let ut,pt;if(h.supercompressionScheme===ktx_parse_module_t)ut=at.levelData;else{if(h.supercompressionScheme!==n$2)throw new Error("THREE.KTX2Loader: Unsupported supercompressionScheme.");ut=c.decode(at.levelData,at.uncompressedByteLength)}pt=TYPE_MAP[o]===three_module.RQf?new Float32Array(ut.buffer,ut.byteOffset,ut.byteLength/Float32Array.BYTES_PER_ELEMENT):TYPE_MAP[o]===three_module.ix0?new Uint16Array(ut.buffer,ut.byteOffset,ut.byteLength/Uint16Array.BYTES_PER_ELEMENT):ut,d.push({data:pt,width:_e,height:it,depth:nt})}let _;if(UNCOMPRESSED_FORMATS.has(FORMAT_MAP[o]))_=h.pixelDepth===0?new three_module.GYF(d[0].data,h.pixelWidth,h.pixelHeight):new three_module.dYF(d[0].data,h.pixelWidth,h.pixelHeight,h.pixelDepth);else{if(h.pixelDepth>0)throw new Error("THREE.KTX2Loader: Unsupported pixelDepth.");_=new three_module.FvD(d,h.pixelWidth,h.pixelHeight)}return _.mipmaps=d,_.type=TYPE_MAP[o],_.format=FORMAT_MAP[o],_.colorSpace=parseColorSpace(h),_.needsUpdate=!0,Promise.resolve(_)}function parseColorSpace(h){const o=h.dataFormatDescriptor[0];return o.colorPrimaries===ktx_parse_module_F?o.transferFunction===ktx_parse_module_x?three_module.er$:three_module.Zr2:o.colorPrimaries===ktx_parse_module_X?o.transferFunction===ktx_parse_module_x?three_module.V5c:three_module.qIQ:(o.colorPrimaries===ktx_parse_module_E||console.warn(`THREE.KTX2Loader: Unsupported color primaries, "${o.colorPrimaries}"`),three_module.jf0)}const KHR_TEXTURE_BASISU="KHR_texture_basisu";class KTX2LoadPlugin extends I$2{constructor(){super(...arguments),this.dependencies=[AssetManagerPlugin]}async onAdded(o){var c,d,_,b,_e,it;this._importer||(this._importer=new Importer(class extends KTX2Loader{constructor(nt){super(nt),this.setTranscoderPath(KTX2LoadPlugin.TRANSCODER_LIBRARY_PATH).detectSupport(o.renderer.rendererObject)}async createTexture(nt,at){const ut=KTX2LoadPlugin.SAVE_SOURCE_BLOBS?new Uint8Array(nt.slice(0)):void 0,pt=await super.createTexture(nt,at);return KTX2LoadPlugin.SAVE_SOURCE_BLOBS&&ut&&(pt.source._sourceImgBuffer=ut,pt.userData.mimeType="image/ktx2",pt.source._canSerialize=!0,pt.toJSON=mt=>serializeTextureInExtras(pt,mt,pt.name,"image/ktx2"),pt.clone=()=>{throw new Error("ktx2 texture cloning not supported")}),pt}},["ktx2"],!1)),(d=(c=o.getManager())===null||c===void 0?void 0:c.importer)===null||d===void 0||d.Importers.push(this._importer),(it=(_e=(b=(_=o.getManager())===null||_===void 0?void 0:_.exporter)===null||b===void 0?void 0:b.getExporter("gltf","glb"))===null||_e===void 0?void 0:_e.extensions)===null||it===void 0||it.push(glTFTextureBasisUExtensionExport)}async onDispose(o){this._importer=void 0}async onRemove(o){var c,d;this._importer&&!((d=(c=o.getManager())===null||c===void 0?void 0:c.importer)===null||d===void 0)&&d.Importers&&o.getManager().importer.Importers.splice(o.getManager().importer.Importers.indexOf(this._importer),1),this._importer=void 0}}KTX2LoadPlugin.PluginType="KTX2LoadPlugin",KTX2LoadPlugin.TRANSCODER_LIBRARY_PATH="https://cdn.jsdelivr.net/gh/BinomialLLC/basis_universal@master/webgl/transcoder/build/",KTX2LoadPlugin.SAVE_SOURCE_BLOBS=!1;const glTFTextureBasisUExtensionExport=h=>({writeTexture:(o,c)=>{if(o.userData.mimeType!=="image/ktx2")return;if(c.source!==void 0&&c.source!==null)return void console.warn("ktx2 export: source already set");const d=o.source._sourceImgBuffer||o.userData.__sourceBuffer;if(!d)return void console.warn("ktx2 export: no source buffer for ktx2");c.extensions=c.extensions||{};const _={},b=new Blob([d],{type:"image/ktx2"});_.source=h.processImageBlob(b,o),c.extensions[KHR_TEXTURE_BASISU]=_,h.extensionsUsed[KHR_TEXTURE_BASISU]=!0}});class DebugPlugin extends I$2{constructor(){super(...arguments),this.dirty=!1,this.counters={},this._generators=new Map,this._preRender=()=>this._showDebug("preRender"),this._postRender=()=>this._showDebug("postRender")}async onAdded(o){this._viewer=o,o.addEventListener("preRender",this._preRender),o.addEventListener("postFrame",this._postRender)}addTexture(o,c,d,_,b,_e="postRender",it=!1){var nt;this._generators.has(_e)||this._generators.set(_e,[]),(nt=this._generators.get(_e))===null||nt===void 0||nt.push({key:o,fn:c,rect:d?[...d]:void 0,frag:b||_||it?new three_module.BKk({vertexShader:CopyShader.vertexShader,uniforms:{tDiffuse:{value:null},opacity:{value:1}},fragmentShader:b??`
        #include <common>
        #include <packing>
        uniform float opacity;
		uniform ${it?"samplerCube":"sampler2D"} tDiffuse;
		varying vec2 vUv;
		void main() {
			vec4 texel = ${it?"textureCube( tDiffuse, vec3(cos(vUv.y * PI2) * cos(vUv.x * PI2), sin(vUv.y * PI2), cos(vUv.y * PI2) * sin(vUv.x * PI2)) )":"texture2D( tDiffuse, vUv )"};
			${_??""}
			gl_FragColor = opacity * texel;
		}
            `}):void 0})}removeTexture(o,c="postRender"){var d,_;this._generators.set(c,(_=(d=this._generators.get(c))===null||d===void 0?void 0:d.filter(b=>b.key!==o))!==null&&_!==void 0?_:[])}async onDispose(o){return Promise.resolve(void 0)}async onRemove(o){return o.removeEventListener("preRender",this._preRender),o.removeEventListener("postRender",this._postRender),this._viewer=void 0,Promise.resolve(void 0)}_showDebug(o){var c;const d=this._viewer,_=d==null?void 0:d.renderer;_&&d&&((c=this._generators.get(o))===null||c===void 0||c.forEach(({key:b,fn:_e,rect:it,frag:nt})=>{const at=_e(d);if(at){if(at.image&&it){const ut=at.image.width/at.image.height;it[2]<1&&it[3]<1&&(it[2]=200),it[2]<1&&(it[2]=it[3]*ut),it[3]<1&&(it[3]=it[2]/ut)}_.blit(at,void 0,{viewport:it,clear:!1,material:nt})}}))}}DebugPlugin.PluginType="debug";class MTLLoader2 extends three_module.aHM{constructor(o){super(o)}load(o,c,d,_){const b=this,_e=this.path===""?three_module.r6x.extractUrlBase(o):this.path,it=new three_module.Y9S(this.manager);it.setPath(this.path),it.setRequestHeader(this.requestHeader),it.setWithCredentials(this.withCredentials),it.load(o,function(nt){try{c(b.parse(nt,_e))}catch(at){_?_(at):console.error(at),b.manager.itemError(o)}},d,_)}setMaterialOptions(o){return this.materialOptions=o,this}parse(o,c){const d=o.split(`
`);let _={};const b=/\s+/,_e={};for(let nt=0;nt<d.length;nt++){let at=d[nt];if(at=at.trim(),at.length===0||at.charAt(0)==="#")continue;const ut=at.indexOf(" ");let pt=ut>=0?at.substring(0,ut):at;pt=pt.toLowerCase();let mt=ut>=0?at.substring(ut+1):"";if(mt=mt.trim(),pt==="newmtl")_={name:mt},_e[mt]=_;else if(pt==="ka"||pt==="kd"||pt==="ks"||pt==="ke"){const ft=mt.split(b,3);_[pt]=[parseFloat(ft[0]),parseFloat(ft[1]),parseFloat(ft[2])]}else _[pt]=mt}const it=new MaterialCreator(this.resourcePath||c,this.materialOptions);return it.setCrossOrigin(this.crossOrigin),it.setManager(this.manager),it.setMaterials(_e),it}}class MaterialCreator{constructor(o="",c={}){this.baseUrl=o,this.options=c,this.materialsInfo={},this.materials={},this.materialsArray=[],this.nameLookup={},this.crossOrigin="anonymous",this.side=this.options.side!==void 0?this.options.side:three_module.hB5,this.wrap=this.options.wrap!==void 0?this.options.wrap:three_module.GJx}setCrossOrigin(o){return this.crossOrigin=o,this}setManager(o){this.manager=o}setMaterials(o){this.materialsInfo=this.convert(o),this.materials={},this.materialsArray=[],this.nameLookup={}}convert(o){if(!this.options)return o;const c={};for(const d in o){const _=o[d],b={};c[d]=b;for(const _e in _){let it=!0,nt=_[_e];const at=_e.toLowerCase();switch(at){case"kd":case"ka":case"ks":this.options&&this.options.normalizeRGB&&(nt=[nt[0]/255,nt[1]/255,nt[2]/255]),this.options&&this.options.ignoreZeroRGBs&&nt[0]===0&&nt[1]===0&&nt[2]===0&&(it=!1)}it&&(b[at]=nt)}}return c}async preload(){for(const o in this.materialsInfo)await this.create(o)}getIndex(o){return this.nameLookup[o]}async getAsArray(){let o=0;for(const c in this.materialsInfo)this.materialsArray[o]=await this.create(c),this.nameLookup[c]=o,o++;return this.materialsArray}async create(o){return this.materials[o]===void 0&&await this.createMaterial_(o),this.materials[o]}async createMaterial_(o){const c=this,d=this.materialsInfo[o],_={name:o,side:this.side};async function b(nt,at){if(_[nt])return;const ut=c.getTextureParams(at,_);return new Promise((pt,mt)=>{let ft=!1,vt=()=>!ft&&(ft=!0)&&pt();const xt=c.loadTexture((At=c.baseUrl,typeof(Ct=ut.url)!="string"||Ct===""?"":/^https?:\/\//i.test(Ct)?Ct:At+Ct),void 0,Et=>{_[nt]=Et,vt()},void 0,vt);var At,Ct;setTimeout(vt,50),xt.repeat.copy(ut.scale),xt.offset.copy(ut.offset),xt.wrapS=c.wrap,xt.wrapT=c.wrap,nt!=="map"&&nt!=="emissiveMap"||(xt.colorSpace=three_module.er$)})}const _e=Array.from(Object.keys(d||{}));let it=_e.includes("d")||_e.includes("D");for(const nt of _e){const at=d[nt];let ut;if(at!=="")switch(nt.toLowerCase()){case"kd":_.color=new three_module.Q1f().fromArray(at).convertSRGBToLinear();break;case"ks":_.specular=new three_module.Q1f().fromArray(at).convertSRGBToLinear();break;case"ke":_.emissive=new three_module.Q1f().fromArray(at).convertSRGBToLinear();break;case"map_kd":await b("map",at);break;case"map_ks":await b("specularMap",at);break;case"map_ke":await b("emissiveMap",at);break;case"norm":await b("normalMap",at);break;case"map_bump":case"bump":await b("bumpMap",at);break;case"map_d":await b("alphaMap",at),_.transparent=!0;break;case"ns":_.shininess=parseFloat(at);break;case"d":ut=parseFloat(at),ut<1&&(_.opacity=ut,_.transparent=!0);break;case"tr":if(it)break;ut=parseFloat(at),this.options&&this.options.invertTrProperty&&(ut=1-ut),ut>0&&(_.opacity=1-ut,_.transparent=!0)}}return this.materials[o]=new three_module.tXL(_),this.materials[o]}getTextureParams(o,c){const d={scale:new three_module.I9Y(1,1),offset:new three_module.I9Y(0,0)},_=o.split(/\s+/);let b;return b=_.indexOf("-bm"),b>=0&&(c.bumpScale=parseFloat(_[b+1]),_.splice(b,2)),b=_.indexOf("-s"),b>=0&&(d.scale.set(parseFloat(_[b+1]),parseFloat(_[b+2])),_.splice(b,4)),b=_.indexOf("-o"),b>=0&&(d.offset.set(parseFloat(_[b+1]),parseFloat(_[b+2])),_.splice(b,4)),d.url=_.join(" ").trim(),d}loadTexture(o,c,d,_,b){const _e=this.manager!==void 0?this.manager:three_module.h_9;let it=_e.getHandler(o);it===null&&(it=new three_module.Tap(_e)),it.setCrossOrigin&&it.setCrossOrigin(this.crossOrigin);const nt=it.load(o,d,_,b);return c!==void 0&&(nt.mapping=c),nt}}const _object_pattern=/^[og]\s*(.+)?/,_material_library_pattern=/^mtllib /,_material_use_pattern=/^usemtl /,_map_use_pattern=/^usemap /,_face_vertex_data_separator_pattern=/\s+/,_vA=new three_module.Pq0,_vB=new three_module.Pq0,_vC=new three_module.Pq0,_ab=new three_module.Pq0,_cb=new three_module.Pq0,_color=new three_module.Q1f;function ParserState(){const h={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materials:{},materialLibraries:[],startObject:function(o,c){if(this.object&&this.object.fromDeclaration===!1)return this.object.name=o,void(this.object.fromDeclaration=c!==!1);const d=this.object&&typeof this.object.currentMaterial=="function"?this.object.currentMaterial():void 0;if(this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0),this.object={name:o||"",fromDeclaration:c!==!1,geometry:{vertices:[],normals:[],colors:[],uvs:[],hasUVIndices:!1},materials:[],smooth:!0,startMaterial:function(_,b){const _e=this._finalize(!1);_e&&(_e.inherited||_e.groupCount<=0)&&this.materials.splice(_e.index,1);const it={index:this.materials.length,name:_||"",mtllib:Array.isArray(b)&&b.length>0?b[b.length-1]:"",smooth:_e!==void 0?_e.smooth:this.smooth,groupStart:_e!==void 0?_e.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(nt){const at={index:typeof nt=="number"?nt:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return at.clone=this.clone.bind(at),at}};return this.materials.push(it),it},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(_){const b=this.currentMaterial();if(b&&b.groupEnd===-1&&(b.groupEnd=this.geometry.vertices.length/3,b.groupCount=b.groupEnd-b.groupStart,b.inherited=!1),_&&this.materials.length>1)for(let _e=this.materials.length-1;_e>=0;_e--)this.materials[_e].groupCount<=0&&this.materials.splice(_e,1);return _&&this.materials.length===0&&this.materials.push({name:"",smooth:this.smooth}),b}},d&&d.name&&typeof d.clone=="function"){const _=d.clone(0);_.inherited=!0,this.object.materials.push(_)}this.objects.push(this.object)},finalize:function(){this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0)},parseVertexIndex:function(o,c){const d=parseInt(o,10);return 3*(d>=0?d-1:d+c/3)},parseNormalIndex:function(o,c){const d=parseInt(o,10);return 3*(d>=0?d-1:d+c/3)},parseUVIndex:function(o,c){const d=parseInt(o,10);return 2*(d>=0?d-1:d+c/2)},addVertex:function(o,c,d){const _=this.vertices,b=this.object.geometry.vertices;b.push(_[o+0],_[o+1],_[o+2]),b.push(_[c+0],_[c+1],_[c+2]),b.push(_[d+0],_[d+1],_[d+2])},addVertexPoint:function(o){const c=this.vertices;this.object.geometry.vertices.push(c[o+0],c[o+1],c[o+2])},addVertexLine:function(o){const c=this.vertices;this.object.geometry.vertices.push(c[o+0],c[o+1],c[o+2])},addNormal:function(o,c,d){const _=this.normals,b=this.object.geometry.normals;b.push(_[o+0],_[o+1],_[o+2]),b.push(_[c+0],_[c+1],_[c+2]),b.push(_[d+0],_[d+1],_[d+2])},addFaceNormal:function(o,c,d){const _=this.vertices,b=this.object.geometry.normals;_vA.fromArray(_,o),_vB.fromArray(_,c),_vC.fromArray(_,d),_cb.subVectors(_vC,_vB),_ab.subVectors(_vA,_vB),_cb.cross(_ab),_cb.normalize(),b.push(_cb.x,_cb.y,_cb.z),b.push(_cb.x,_cb.y,_cb.z),b.push(_cb.x,_cb.y,_cb.z)},addColor:function(o,c,d){const _=this.colors,b=this.object.geometry.colors;_[o]!==void 0&&b.push(_[o+0],_[o+1],_[o+2]),_[c]!==void 0&&b.push(_[c+0],_[c+1],_[c+2]),_[d]!==void 0&&b.push(_[d+0],_[d+1],_[d+2])},addUV:function(o,c,d){const _=this.uvs,b=this.object.geometry.uvs;b.push(_[o+0],_[o+1]),b.push(_[c+0],_[c+1]),b.push(_[d+0],_[d+1])},addDefaultUV:function(){const o=this.object.geometry.uvs;o.push(0,0),o.push(0,0),o.push(0,0)},addUVLine:function(o){const c=this.uvs;this.object.geometry.uvs.push(c[o+0],c[o+1])},addFace:function(o,c,d,_,b,_e,it,nt,at){const ut=this.vertices.length;let pt=this.parseVertexIndex(o,ut),mt=this.parseVertexIndex(c,ut),ft=this.parseVertexIndex(d,ut);if(this.addVertex(pt,mt,ft),this.addColor(pt,mt,ft),it!==void 0&&it!==""){const vt=this.normals.length;pt=this.parseNormalIndex(it,vt),mt=this.parseNormalIndex(nt,vt),ft=this.parseNormalIndex(at,vt),this.addNormal(pt,mt,ft)}else this.addFaceNormal(pt,mt,ft);if(_!==void 0&&_!==""){const vt=this.uvs.length;pt=this.parseUVIndex(_,vt),mt=this.parseUVIndex(b,vt),ft=this.parseUVIndex(_e,vt),this.addUV(pt,mt,ft),this.object.geometry.hasUVIndices=!0}else this.addDefaultUV()},addPointGeometry:function(o){this.object.geometry.type="Points";const c=this.vertices.length;for(let d=0,_=o.length;d<_;d++){const b=this.parseVertexIndex(o[d],c);this.addVertexPoint(b),this.addColor(b)}},addLineGeometry:function(o,c){this.object.geometry.type="Line";const d=this.vertices.length,_=this.uvs.length;for(let b=0,_e=o.length;b<_e;b++)this.addVertexLine(this.parseVertexIndex(o[b],d));for(let b=0,_e=c.length;b<_e;b++)this.addUVLine(this.parseUVIndex(c[b],_))}};return h.startObject("",!1),h}class OBJLoader2 extends three_module.aHM{constructor(o){super(o),this.materials=null}load(o,c,d,_){const b=this,_e=new three_module.Y9S(this.manager);_e.setPath(this.path),_e.setRequestHeader(this.requestHeader),_e.setWithCredentials(this.withCredentials),_e.load(o,async function(it){try{c(await b.parse(it))}catch(nt){_?_(nt):console.error(nt),b.manager.itemError(o)}},d,_)}setMaterials(o){return this.materials=o,this}async parse(o){const c=new ParserState;o.indexOf(`\r
`)!==-1&&(o=o.replace(/\r\n/g,`
`)),o.indexOf(`\\
`)!==-1&&(o=o.replace(/\\\n/g,""));const d=o.split(`
`);let _=[];for(let _e=0,it=d.length;_e<it;_e++){const nt=d[_e].trimStart();if(nt.length===0)continue;const at=nt.charAt(0);if(at!=="#")if(at==="v"){const ut=nt.split(_face_vertex_data_separator_pattern);switch(ut[0]){case"v":c.vertices.push(parseFloat(ut[1]),parseFloat(ut[2]),parseFloat(ut[3])),ut.length>=7?(_color.setRGB(parseFloat(ut[4]),parseFloat(ut[5]),parseFloat(ut[6])).convertSRGBToLinear(),c.colors.push(_color.r,_color.g,_color.b)):c.colors.push(void 0,void 0,void 0);break;case"vn":c.normals.push(parseFloat(ut[1]),parseFloat(ut[2]),parseFloat(ut[3]));break;case"vt":c.uvs.push(parseFloat(ut[1]),parseFloat(ut[2]))}}else if(at==="f"){const ut=nt.slice(1).trim().split(_face_vertex_data_separator_pattern),pt=[];for(let ft=0,vt=ut.length;ft<vt;ft++){const xt=ut[ft];if(xt.length>0){const At=xt.split("/");pt.push(At)}}const mt=pt[0];for(let ft=1,vt=pt.length-1;ft<vt;ft++){const xt=pt[ft],At=pt[ft+1];c.addFace(mt[0],xt[0],At[0],mt[1],xt[1],At[1],mt[2],xt[2],At[2])}}else if(at==="l"){const ut=nt.substring(1).trim().split(" ");let pt=[];const mt=[];if(nt.indexOf("/")===-1)pt=ut;else for(let ft=0,vt=ut.length;ft<vt;ft++){const xt=ut[ft].split("/");xt[0]!==""&&pt.push(xt[0]),xt[1]!==""&&mt.push(xt[1])}c.addLineGeometry(pt,mt)}else if(at==="p"){const ut=nt.slice(1).trim().split(" ");c.addPointGeometry(ut)}else if((_=_object_pattern.exec(nt))!==null){const ut=(" "+_[0].slice(1).trim()).slice(1);c.startObject(ut)}else if(_material_use_pattern.test(nt))c.object.startMaterial(nt.substring(7).trim(),c.materialLibraries);else if(_material_library_pattern.test(nt)){c.materialLibraries.push(nt.substring(7).trim());const ut=nt.substring(7).trim(),pt=this.manager.getHandler(ut);if(pt){const mt=await pt.loadAsync(ut).catch(ft=>{console.warn(ft)});mt&&this.setMaterials(mt)}else console.warn("OBJLoader2: Set MTLLoader to loading manager to load materials.")}else if(_map_use_pattern.test(nt))console.warn('OBJLoader2: Rendering identifier "usemap" not supported. Textures must be defined in MTL files.');else if(at==="s"){if(_=nt.split(" "),_.length>1){const pt=_[1].trim().toLowerCase();c.object.smooth=pt!=="0"&&pt!=="off"}else c.object.smooth=!0;const ut=c.object.currentMaterial();ut&&(ut.smooth=c.object.smooth)}else{if(nt==="\0")continue;console.warn('THREE.OBJLoader: Unexpected line: "'+nt+'"')}}c.finalize();const b=new three_module.YJl;if(b.materialLibraries=[].concat(c.materialLibraries),!(c.objects.length===1&&c.objects[0].geometry.vertices.length===0))for(let _e=0,it=c.objects.length;_e<it;_e++){const nt=c.objects[_e],at=nt.geometry,ut=nt.materials,pt=at.type==="Line",mt=at.type==="Points";let ft=!1;if(at.vertices.length===0)continue;const vt=new three_module.LoY;vt.setAttribute("position",new three_module.qtW(at.vertices,3)),at.normals.length>0&&vt.setAttribute("normal",new three_module.qtW(at.normals,3)),at.colors.length>0&&(ft=!0,vt.setAttribute("color",new three_module.qtW(at.colors,3))),at.hasUVIndices===!0&&vt.setAttribute("uv",new three_module.qtW(at.uvs,2));const xt=[];for(let Ct=0,Et=ut.length;Ct<Et;Ct++){const Tt=ut[Ct],kt=Tt.name+"_"+Tt.smooth+"_"+ft;let Dt=c.materials[kt];if(this.materials!==null)if(Dt=await this.materials.create(Tt.name),!pt||!Dt||Dt instanceof three_module.mrM){if(mt&&Dt&&!(Dt instanceof three_module.BH$)){const zt=new three_module.BH$({size:10,sizeAttenuation:!1});three_module.imn.prototype.copy.call(zt,Dt),zt.color.copy(Dt.color),zt.map=Dt.map,Dt=zt}}else{const zt=new three_module.mrM;three_module.imn.prototype.copy.call(zt,Dt),zt.color.copy(Dt.color),Dt=zt}Dt===void 0&&(Dt=pt?new three_module.mrM:mt?new three_module.BH$({size:1,sizeAttenuation:!1}):new three_module.tXL,Dt.name=Tt.name,Dt.flatShading=!Tt.smooth,Dt.vertexColors=ft,c.materials[kt]=Dt),xt.push(Dt)}let At;if(xt.length>1){for(let Ct=0,Et=ut.length;Ct<Et;Ct++){const Tt=ut[Ct];vt.addGroup(Tt.groupStart,Tt.groupCount,Ct)}At=pt?new three_module.DXC(vt,xt):mt?new three_module.ONl(vt,xt):new three_module.eaF(vt,xt)}else At=pt?new three_module.DXC(vt,xt[0]):mt?new three_module.ONl(vt,xt[0]):new three_module.eaF(vt,xt[0]);At.name=nt.name,b.add(At)}else if(c.vertices.length>0){const _e=new three_module.BH$({size:1,sizeAttenuation:!1}),it=new three_module.LoY;it.setAttribute("position",new three_module.qtW(c.vertices,3)),c.colors.length>0&&c.colors[0]!==void 0&&(it.setAttribute("color",new three_module.qtW(c.colors,3)),_e.vertexColors=!0);const nt=new three_module.ONl(it,_e);b.add(nt)}return b}}class ObjMtlLoadPlugin extends I$2{constructor(){super(...arguments),this.dependencies=[AssetManagerPlugin],this._importer1=new Importer(OBJLoader2,["obj"],!0),this._importer2=new Importer(MTLLoader2,["mtl"],!1)}async onAdded(o){var c,d,_,b;(d=(c=o.getManager())===null||c===void 0?void 0:c.importer)===null||d===void 0||d.Importers.push(this._importer1),(b=(_=o.getManager())===null||_===void 0?void 0:_.importer)===null||b===void 0||b.Importers.push(this._importer2)}async onDispose(o){}async onRemove(o){var c,d;!((d=(c=o.getManager())===null||c===void 0?void 0:c.importer)===null||d===void 0)&&d.Importers&&(o.getManager().importer.Importers.splice(o.getManager().importer.Importers.indexOf(this._importer1),1),o.getManager().importer.Importers.splice(o.getManager().importer.Importers.indexOf(this._importer2),1))}}ObjMtlLoadPlugin.PluginType="ObjMtlLoadPlugin";var durl=function(h){return URL.createObjectURL(new Blob([h],{type:"text/javascript"}))};try{URL.revokeObjectURL(durl(""))}catch(h){durl=function(o){return"data:application/javascript;charset=UTF-8,"+encodeURI(o)}}var fflate_module_u8=Uint8Array,fflate_module_u16=Uint16Array,fflate_module_u32=Uint32Array,fflate_module_fleb=new fflate_module_u8([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),fflate_module_fdeb=new fflate_module_u8([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),fflate_module_clim=new fflate_module_u8([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),fflate_module_freb=function(h,o){for(var c=new fflate_module_u16(31),d=0;d<31;++d)c[d]=o+=1<<h[d-1];var _=new fflate_module_u32(c[30]);for(d=1;d<30;++d)for(var b=c[d];b<c[d+1];++b)_[b]=b-c[d]<<5|d;return[c,_]},fflate_module_a=fflate_module_freb(fflate_module_fleb,2),fflate_module_fl=fflate_module_a[0],fflate_module_revfl=fflate_module_a[1];fflate_module_fl[28]=258,fflate_module_revfl[258]=28;for(var fflate_module_b=fflate_module_freb(fflate_module_fdeb,0),fflate_module_fd=fflate_module_b[0],fflate_module_revfd=fflate_module_b[1],fflate_module_rev=new fflate_module_u16(32768),fflate_module_i=0;fflate_module_i<32768;++fflate_module_i){var fflate_module_x=(43690&fflate_module_i)>>>1|(21845&fflate_module_i)<<1;fflate_module_x=(52428&fflate_module_x)>>>2|(13107&fflate_module_x)<<2,fflate_module_x=(61680&fflate_module_x)>>>4|(3855&fflate_module_x)<<4,fflate_module_rev[fflate_module_i]=((65280&fflate_module_x)>>>8|(255&fflate_module_x)<<8)>>>1}for(var fflate_module_hMap=function(o,c,d){for(var _=o.length,b=0,_e=new fflate_module_u16(c);b<_;++b)++_e[o[b]-1];var it,nt=new fflate_module_u16(c);for(b=0;b<c;++b)nt[b]=nt[b-1]+_e[b-1]<<1;if(d){it=new fflate_module_u16(1<<c);var at=15-c;for(b=0;b<_;++b)if(o[b])for(var ut=b<<4|o[b],pt=c-o[b],mt=nt[o[b]-1]++<<pt,ft=mt|(1<<pt)-1;mt<=ft;++mt)it[fflate_module_rev[mt]>>>at]=ut}else for(it=new fflate_module_u16(_),b=0;b<_;++b)o[b]&&(it[b]=fflate_module_rev[nt[o[b]-1]++]>>>15-o[b]);return it},fflate_module_flt=new fflate_module_u8(288),fflate_module_i=0;fflate_module_i<144;++fflate_module_i)fflate_module_flt[fflate_module_i]=8;for(var fflate_module_i=144;fflate_module_i<256;++fflate_module_i)fflate_module_flt[fflate_module_i]=9;for(var fflate_module_i=256;fflate_module_i<280;++fflate_module_i)fflate_module_flt[fflate_module_i]=7;for(var fflate_module_i=280;fflate_module_i<288;++fflate_module_i)fflate_module_flt[fflate_module_i]=8;for(var fflate_module_fdt=new fflate_module_u8(32),fflate_module_i=0;fflate_module_i<32;++fflate_module_i)fflate_module_fdt[fflate_module_i]=5;var fflate_module_flm=fflate_module_hMap(fflate_module_flt,9,0),fflate_module_flrm=fflate_module_hMap(fflate_module_flt,9,1),fflate_module_fdm=fflate_module_hMap(fflate_module_fdt,5,0),fflate_module_fdrm=fflate_module_hMap(fflate_module_fdt,5,1),fflate_module_max=function(h){for(var o=h[0],c=1;c<h.length;++c)h[c]>o&&(o=h[c]);return o},fflate_module_bits=function(h,o,c){var d=o/8|0;return(h[d]|h[d+1]<<8)>>(7&o)&c},fflate_module_bits16=function(h,o){var c=o/8|0;return(h[c]|h[c+1]<<8|h[c+2]<<16)>>(7&o)},fflate_module_shft=function(h){return(h/8|0)+(7&h&&1)},fflate_module_slc=function(h,o,c){(c==null||c>h.length)&&(c=h.length);var d=new(h instanceof fflate_module_u16?fflate_module_u16:h instanceof fflate_module_u32?fflate_module_u32:fflate_module_u8)(c-o);return d.set(h.subarray(o,c)),d},fflate_module_inflt=function(h,o,c){var d=h.length;if(!d||c&&!c.l&&d<5)return o||new fflate_module_u8(0);var _=!o||c,b=!c||c.i;c||(c={}),o||(o=new fflate_module_u8(3*d));var _e=function(mr){var Rr=o.length;if(mr>Rr){var Yr=new fflate_module_u8(Math.max(2*Rr,mr));Yr.set(o),o=Yr}},it=c.f||0,nt=c.p||0,at=c.b||0,ut=c.l,pt=c.d,mt=c.m,ft=c.n,vt=8*d;do{if(!ut){c.f=it=fflate_module_bits(h,nt,1);var xt=fflate_module_bits(h,nt+1,3);if(nt+=3,!xt){var At=h[(Jt=fflate_module_shft(nt)+4)-4]|h[Jt-3]<<8,Ct=Jt+At;if(Ct>d){if(b)throw"unexpected EOF";break}_&&_e(at+At),o.set(h.subarray(Jt,Ct),at),c.b=at+=At,c.p=nt=8*Ct;continue}if(xt==1)ut=fflate_module_flrm,pt=fflate_module_fdrm,mt=9,ft=5;else{if(xt!=2)throw"invalid block type";var Et=fflate_module_bits(h,nt,31)+257,Tt=fflate_module_bits(h,nt+10,15)+4,kt=Et+fflate_module_bits(h,nt+5,31)+1;nt+=14;for(var Dt=new fflate_module_u8(kt),zt=new fflate_module_u8(19),Bt=0;Bt<Tt;++Bt)zt[fflate_module_clim[Bt]]=fflate_module_bits(h,nt+3*Bt,7);nt+=3*Tt;var Rt=fflate_module_max(zt),Ut=(1<<Rt)-1,Ht=fflate_module_hMap(zt,Rt,1);for(Bt=0;Bt<kt;){var Jt,Kt=Ht[fflate_module_bits(h,nt,Ut)];if(nt+=15&Kt,(Jt=Kt>>>4)<16)Dt[Bt++]=Jt;else{var sr=0,ir=0;for(Jt==16?(ir=3+fflate_module_bits(h,nt,3),nt+=2,sr=Dt[Bt-1]):Jt==17?(ir=3+fflate_module_bits(h,nt,7),nt+=3):Jt==18&&(ir=11+fflate_module_bits(h,nt,127),nt+=7);ir--;)Dt[Bt++]=sr}}var cr=Dt.subarray(0,Et),lr=Dt.subarray(Et);mt=fflate_module_max(cr),ft=fflate_module_max(lr),ut=fflate_module_hMap(cr,mt,1),pt=fflate_module_hMap(lr,ft,1)}if(nt>vt){if(b)throw"unexpected EOF";break}}_&&_e(at+131072);for(var hr=(1<<mt)-1,dr=(1<<ft)-1,pr=nt;;pr=nt){var ur=(sr=ut[fflate_module_bits16(h,nt)&hr])>>>4;if((nt+=15&sr)>vt){if(b)throw"unexpected EOF";break}if(!sr)throw"invalid length/literal";if(ur<256)o[at++]=ur;else{if(ur==256){pr=nt,ut=null;break}var xr=ur-254;if(ur>264){var vr=fflate_module_fleb[Bt=ur-257];xr=fflate_module_bits(h,nt,(1<<vr)-1)+fflate_module_fl[Bt],nt+=vr}var Dr=pt[fflate_module_bits16(h,nt)&dr],_r=Dr>>>4;if(!Dr)throw"invalid distance";if(nt+=15&Dr,lr=fflate_module_fd[_r],_r>3&&(vr=fflate_module_fdeb[_r],lr+=fflate_module_bits16(h,nt)&(1<<vr)-1,nt+=vr),nt>vt){if(b)throw"unexpected EOF";break}_&&_e(at+131072);for(var rr=at+xr;at<rr;at+=4)o[at]=o[at-lr],o[at+1]=o[at+1-lr],o[at+2]=o[at+2-lr],o[at+3]=o[at+3-lr];at=rr}}c.l=ut,c.p=pr,c.b=at,ut&&(it=1,c.m=mt,c.d=pt,c.n=ft)}while(!it);return at==o.length?o:fflate_module_slc(o,0,at)},fflate_module_wbits=function(h,o,c){c<<=7&o;var d=o/8|0;h[d]|=c,h[d+1]|=c>>>8},fflate_module_wbits16=function(h,o,c){c<<=7&o;var d=o/8|0;h[d]|=c,h[d+1]|=c>>>8,h[d+2]|=c>>>16},fflate_module_hTree=function(h,o){for(var c=[],d=0;d<h.length;++d)h[d]&&c.push({s:d,f:h[d]});var _=c.length,b=c.slice();if(!_)return[fflate_module_et,0];if(_==1){var _e=new fflate_module_u8(c[0].s+1);return _e[c[0].s]=1,[_e,1]}c.sort(function(Dt,zt){return Dt.f-zt.f}),c.push({s:-1,f:25001});var it=c[0],nt=c[1],at=0,ut=1,pt=2;for(c[0]={s:-1,f:it.f+nt.f,l:it,r:nt};ut!=_-1;)it=c[c[at].f<c[pt].f?at++:pt++],nt=c[at!=ut&&c[at].f<c[pt].f?at++:pt++],c[ut++]={s:-1,f:it.f+nt.f,l:it,r:nt};var mt=b[0].s;for(d=1;d<_;++d)b[d].s>mt&&(mt=b[d].s);var ft=new fflate_module_u16(mt+1),vt=fflate_module_ln(c[ut-1],ft,0);if(vt>o){d=0;var xt=0,At=vt-o,Ct=1<<At;for(b.sort(function(Dt,zt){return ft[zt.s]-ft[Dt.s]||Dt.f-zt.f});d<_;++d){var Et=b[d].s;if(!(ft[Et]>o))break;xt+=Ct-(1<<vt-ft[Et]),ft[Et]=o}for(xt>>>=At;xt>0;){var Tt=b[d].s;ft[Tt]<o?xt-=1<<o-ft[Tt]++-1:++d}for(;d>=0&&xt;--d){var kt=b[d].s;ft[kt]==o&&(--ft[kt],++xt)}vt=o}return[new fflate_module_u8(ft),vt]},fflate_module_ln=function(h,o,c){return h.s==-1?Math.max(fflate_module_ln(h.l,o,c+1),fflate_module_ln(h.r,o,c+1)):o[h.s]=c},fflate_module_lc=function(h){for(var o=h.length;o&&!h[--o];);for(var c=new fflate_module_u16(++o),d=0,_=h[0],b=1,_e=function(nt){c[d++]=nt},it=1;it<=o;++it)if(h[it]==_&&it!=o)++b;else{if(!_&&b>2){for(;b>138;b-=138)_e(32754);b>2&&(_e(b>10?b-11<<5|28690:b-3<<5|12305),b=0)}else if(b>3){for(_e(_),--b;b>6;b-=6)_e(8304);b>2&&(_e(b-3<<5|8208),b=0)}for(;b--;)_e(_);b=1,_=h[it]}return[c.subarray(0,d),o]},fflate_module_clen=function(h,o){for(var c=0,d=0;d<o.length;++d)c+=h[d]*o[d];return c},fflate_module_wfblk=function(h,o,c){var d=c.length,_=fflate_module_shft(o+2);h[_]=255&d,h[_+1]=d>>>8,h[_+2]=255^h[_],h[_+3]=255^h[_+1];for(var b=0;b<d;++b)h[_+b+4]=c[b];return 8*(_+4+d)},fflate_module_wblk=function(h,o,c,d,_,b,_e,it,nt,at,ut){fflate_module_wbits(o,ut++,c),++_[256];for(var pt=fflate_module_hTree(_,15),mt=pt[0],ft=pt[1],vt=fflate_module_hTree(b,15),xt=vt[0],At=vt[1],Ct=fflate_module_lc(mt),Et=Ct[0],Tt=Ct[1],kt=fflate_module_lc(xt),Dt=kt[0],zt=kt[1],Bt=new fflate_module_u16(19),Rt=0;Rt<Et.length;++Rt)Bt[31&Et[Rt]]++;for(Rt=0;Rt<Dt.length;++Rt)Bt[31&Dt[Rt]]++;for(var Ut=fflate_module_hTree(Bt,7),Ht=Ut[0],Jt=Ut[1],Kt=19;Kt>4&&!Ht[fflate_module_clim[Kt-1]];--Kt);var sr,ir,cr,lr,hr=at+5<<3,dr=fflate_module_clen(_,fflate_module_flt)+fflate_module_clen(b,fflate_module_fdt)+_e,pr=fflate_module_clen(_,mt)+fflate_module_clen(b,xt)+_e+14+3*Kt+fflate_module_clen(Bt,Ht)+(2*Bt[16]+3*Bt[17]+7*Bt[18]);if(hr<=dr&&hr<=pr)return fflate_module_wfblk(o,ut,h.subarray(nt,nt+at));if(fflate_module_wbits(o,ut,1+(pr<dr)),ut+=2,pr<dr){sr=fflate_module_hMap(mt,ft,0),ir=mt,cr=fflate_module_hMap(xt,At,0),lr=xt;var ur=fflate_module_hMap(Ht,Jt,0);for(fflate_module_wbits(o,ut,Tt-257),fflate_module_wbits(o,ut+5,zt-1),fflate_module_wbits(o,ut+10,Kt-4),ut+=14,Rt=0;Rt<Kt;++Rt)fflate_module_wbits(o,ut+3*Rt,Ht[fflate_module_clim[Rt]]);ut+=3*Kt;for(var xr=[Et,Dt],vr=0;vr<2;++vr){var Dr=xr[vr];for(Rt=0;Rt<Dr.length;++Rt){var _r=31&Dr[Rt];fflate_module_wbits(o,ut,ur[_r]),ut+=Ht[_r],_r>15&&(fflate_module_wbits(o,ut,Dr[Rt]>>>5&127),ut+=Dr[Rt]>>>12)}}}else sr=fflate_module_flm,ir=fflate_module_flt,cr=fflate_module_fdm,lr=fflate_module_fdt;for(Rt=0;Rt<it;++Rt)if(d[Rt]>255){_r=d[Rt]>>>18&31,fflate_module_wbits16(o,ut,sr[_r+257]),ut+=ir[_r+257],_r>7&&(fflate_module_wbits(o,ut,d[Rt]>>>23&31),ut+=fflate_module_fleb[_r]);var rr=31&d[Rt];fflate_module_wbits16(o,ut,cr[rr]),ut+=lr[rr],rr>3&&(fflate_module_wbits16(o,ut,d[Rt]>>>5&8191),ut+=fflate_module_fdeb[rr])}else fflate_module_wbits16(o,ut,sr[d[Rt]]),ut+=ir[d[Rt]];return fflate_module_wbits16(o,ut,sr[256]),ut+ir[256]},fflate_module_deo=new fflate_module_u32([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),fflate_module_et=new fflate_module_u8(0),fflate_module_dflt=function(h,o,c,d,_,b){var _e=h.length,it=new fflate_module_u8(d+_e+5*(1+Math.ceil(_e/7e3))+_),nt=it.subarray(d,it.length-_),at=0;if(!o||_e<8)for(var ut=0;ut<=_e;ut+=65535){var pt=ut+65535;pt<_e?at=fflate_module_wfblk(nt,at,h.subarray(ut,pt)):(nt[ut]=b,at=fflate_module_wfblk(nt,at,h.subarray(ut,_e)))}else{for(var mt=fflate_module_deo[o-1],ft=mt>>>13,vt=8191&mt,xt=(1<<c)-1,At=new fflate_module_u16(32768),Ct=new fflate_module_u16(xt+1),Et=Math.ceil(c/3),Tt=2*Et,kt=function(yn){return(h[yn]^h[yn+1]<<Et^h[yn+2]<<Tt)&xt},Dt=new fflate_module_u32(25e3),zt=new fflate_module_u16(288),Bt=new fflate_module_u16(32),Rt=0,Ut=0,Ht=(ut=0,0),Jt=0,Kt=0;ut<_e;++ut){var sr=kt(ut),ir=32767&ut,cr=Ct[sr];if(At[ir]=cr,Ct[sr]=ir,Jt<=ut){var lr=_e-ut;if((Rt>7e3||Ht>24576)&&lr>423){at=fflate_module_wblk(h,nt,0,Dt,zt,Bt,Ut,Ht,Kt,ut-Kt,at),Ht=Rt=Ut=0,Kt=ut;for(var hr=0;hr<286;++hr)zt[hr]=0;for(hr=0;hr<30;++hr)Bt[hr]=0}var dr=2,pr=0,ur=vt,xr=ir-cr&32767;if(lr>2&&sr==kt(ut-xr))for(var vr=Math.min(ft,lr)-1,Dr=Math.min(32767,ut),_r=Math.min(258,lr);xr<=Dr&&--ur&&ir!=cr;){if(h[ut+dr]==h[ut+dr-xr]){for(var rr=0;rr<_r&&h[ut+rr]==h[ut+rr-xr];++rr);if(rr>dr){if(dr=rr,pr=xr,rr>vr)break;var mr=Math.min(xr,rr-2),Rr=0;for(hr=0;hr<mr;++hr){var Yr=ut-xr+hr+32768&32767,Zr=Yr-At[Yr]+32768&32767;Zr>Rr&&(Rr=Zr,cr=Yr)}}}xr+=(ir=cr)-(cr=At[ir])+32768&32767}if(pr){Dt[Ht++]=268435456|fflate_module_revfl[dr]<<18|fflate_module_revfd[pr];var cn=31&fflate_module_revfl[dr],Tn=31&fflate_module_revfd[pr];Ut+=fflate_module_fleb[cn]+fflate_module_fdeb[Tn],++zt[257+cn],++Bt[Tn],Jt=ut+dr,++Rt}else Dt[Ht++]=h[ut],++zt[h[ut]]}}at=fflate_module_wblk(h,nt,b,Dt,zt,Bt,Ut,Ht,Kt,ut-Kt,at)}return fflate_module_slc(it,0,d+fflate_module_shft(at)+_)},fflate_module_adler=function(){var h=1,o=0;return{p:function(c){for(var d=h,_=o,b=c.length,_e=0;_e!=b;){for(var it=Math.min(_e+2655,b);_e<it;++_e)_+=d+=c[_e];d=(65535&d)+15*(d>>16),_=(65535&_)+15*(_>>16)}h=d,o=_},d:function(){return(255&(h%=65521))<<24|h>>>8<<16|(255&(o%=65521))<<8|o>>>8}}},fflate_module_dopt=function(h,o,c,d,_){return fflate_module_dflt(h,o.level==null?6:o.level,o.mem==null?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(h.length)))):12+o.mem,c,d,!_)},fflate_module_wbytes=function(h,o,c){for(;c;++o)h[o]=c,c>>>=8},fflate_module_zlh=function(h,o){var c=o.level,d=c==0?0:c<6?1:c==9?3:2;h[0]=120,h[1]=d<<6|(d?32-2*d:1)},fflate_module_zlv=function(h){if((15&h[0])!=8||h[0]>>>4>7||(h[0]<<8|h[1])%31)throw"invalid zlib data";if(32&h[1])throw"invalid zlib data: preset dictionaries not supported"};function fflate_module_zlibSync(h,o){o||(o={});var c=fflate_module_adler();c.p(h);var d=fflate_module_dopt(h,o,2,4);return fflate_module_zlh(d,o),fflate_module_wbytes(d,d.length-4,c.d()),d}function fflate_module_unzlibSync(h,o){return fflate_module_inflt((fflate_module_zlv(h),h.subarray(2,-4)),o)}typeof TextEncoder<"u"&&new TextEncoder;var fflate_module_td=typeof TextDecoder<"u"&&new TextDecoder,fflate_module_tds=0;try{fflate_module_td.decode(fflate_module_et,{stream:!0}),fflate_module_tds=1}catch(h){}function findSpan(h,o,c){const d=c.length-h-1;if(o>=c[d])return d-1;if(o<=c[h])return h;let _=h,b=d,_e=Math.floor((_+b)/2);for(;o<c[_e]||o>=c[_e+1];)o<c[_e]?b=_e:_=_e,_e=Math.floor((_+b)/2);return _e}function calcBasisFunctions(h,o,c,d){const _=[],b=[],_e=[];_[0]=1;for(let it=1;it<=c;++it){b[it]=o-d[h+1-it],_e[it]=d[h+it]-o;let nt=0;for(let at=0;at<it;++at){const ut=_e[at+1],pt=b[it-at],mt=_[at]/(ut+pt);_[at]=nt+ut*mt,nt=pt*mt}_[it]=nt}return _}function calcBSplinePoint(h,o,c,d){const _=findSpan(h,d,o),b=calcBasisFunctions(_,d,h,o),_e=new three_module.IUQ(0,0,0,0);for(let it=0;it<=h;++it){const nt=c[_-h+it],at=b[it],ut=nt.w*at;_e.x+=nt.x*ut,_e.y+=nt.y*ut,_e.z+=nt.z*ut,_e.w+=nt.w*at}return _e}function calcBasisFunctionDerivatives(h,o,c,d,_){const b=[];for(let pt=0;pt<=c;++pt)b[pt]=0;const _e=[];for(let pt=0;pt<=d;++pt)_e[pt]=b.slice(0);const it=[];for(let pt=0;pt<=c;++pt)it[pt]=b.slice(0);it[0][0]=1;const nt=b.slice(0),at=b.slice(0);for(let pt=1;pt<=c;++pt){nt[pt]=o-_[h+1-pt],at[pt]=_[h+pt]-o;let mt=0;for(let ft=0;ft<pt;++ft){const vt=at[ft+1],xt=nt[pt-ft];it[pt][ft]=vt+xt;const At=it[ft][pt-1]/it[pt][ft];it[ft][pt]=mt+vt*At,mt=xt*At}it[pt][pt]=mt}for(let pt=0;pt<=c;++pt)_e[0][pt]=it[pt][c];for(let pt=0;pt<=c;++pt){let mt=0,ft=1;const vt=[];for(let xt=0;xt<=c;++xt)vt[xt]=b.slice(0);vt[0][0]=1;for(let xt=1;xt<=d;++xt){let At=0;const Ct=pt-xt,Et=c-xt;pt>=xt&&(vt[ft][0]=vt[mt][0]/it[Et+1][Ct],At=vt[ft][0]*it[Ct][Et]);const Tt=pt-1<=Et?xt-1:c-pt;for(let Dt=Ct>=-1?1:-Ct;Dt<=Tt;++Dt)vt[ft][Dt]=(vt[mt][Dt]-vt[mt][Dt-1])/it[Et+1][Ct+Dt],At+=vt[ft][Dt]*it[Ct+Dt][Et];pt<=Et&&(vt[ft][xt]=-vt[mt][xt-1]/it[Et+1][pt],At+=vt[ft][xt]*it[pt][Et]),_e[xt][pt]=At;const kt=mt;mt=ft,ft=kt}}let ut=c;for(let pt=1;pt<=d;++pt){for(let mt=0;mt<=c;++mt)_e[pt][mt]*=ut;ut*=c-pt}return _e}function calcBSplineDerivatives(h,o,c,d,_){const b=_<h?_:h,_e=[],it=findSpan(h,d,o),nt=calcBasisFunctionDerivatives(it,d,h,b,o),at=[];for(let ut=0;ut<c.length;++ut){const pt=c[ut].clone(),mt=pt.w;pt.x*=mt,pt.y*=mt,pt.z*=mt,at[ut]=pt}for(let ut=0;ut<=b;++ut){const pt=at[it-h].clone().multiplyScalar(nt[ut][0]);for(let mt=1;mt<=h;++mt)pt.add(at[it-h+mt].clone().multiplyScalar(nt[ut][mt]));_e[ut]=pt}for(let ut=b+1;ut<=_+1;++ut)_e[ut]=new three_module.IUQ(0,0,0);return _e}function calcKoverI(h,o){let c=1;for(let _=2;_<=h;++_)c*=_;let d=1;for(let _=2;_<=o;++_)d*=_;for(let _=2;_<=h-o;++_)d*=_;return c/d}function calcRationalCurveDerivatives(h){const o=h.length,c=[],d=[];for(let b=0;b<o;++b){const _e=h[b];c[b]=new three_module.Pq0(_e.x,_e.y,_e.z),d[b]=_e.w}const _=[];for(let b=0;b<o;++b){const _e=c[b].clone();for(let it=1;it<=b;++it)_e.sub(_[b-it].clone().multiplyScalar(calcKoverI(b,it)*d[it]));_[b]=_e.divideScalar(d[0])}return _}function calcNURBSDerivatives(h,o,c,d,_){return calcRationalCurveDerivatives(calcBSplineDerivatives(h,o,c,d,_))}class NURBSCurve extends three_module.Ipv{constructor(o,c,d,_,b){super(),this.degree=o,this.knots=c,this.controlPoints=[],this.startKnot=_||0,this.endKnot=b||this.knots.length-1;for(let _e=0;_e<d.length;++_e){const it=d[_e];this.controlPoints[_e]=new three_module.IUQ(it.x,it.y,it.z,it.w)}}getPoint(o,c=new three_module.Pq0){const d=c,_=this.knots[this.startKnot]+o*(this.knots[this.endKnot]-this.knots[this.startKnot]),b=calcBSplinePoint(this.degree,this.knots,this.controlPoints,_);return b.w!==1&&b.divideScalar(b.w),d.set(b.x,b.y,b.z)}getTangent(o,c=new three_module.Pq0){const d=c,_=this.knots[0]+o*(this.knots[this.knots.length-1]-this.knots[0]),b=calcNURBSDerivatives(this.degree,this.knots,this.controlPoints,_,1);return d.copy(b[1]).normalize(),d}}let fbxTree,connections,sceneGraph;class FBXLoader extends three_module.aHM{constructor(o){super(o)}load(o,c,d,_){const b=this,_e=b.path===""?three_module.r6x.extractUrlBase(o):b.path,it=new three_module.Y9S(this.manager);it.setPath(b.path),it.setResponseType("arraybuffer"),it.setRequestHeader(b.requestHeader),it.setWithCredentials(b.withCredentials),it.load(o,function(nt){try{c(b.parse(nt,_e))}catch(at){_?_(at):console.error(at),b.manager.itemError(o)}},d,_)}parse(o,c){if(isFbxFormatBinary(o))fbxTree=new BinaryParser().parse(o);else{const b=convertArrayBufferToString(o);if(!isFbxFormatASCII(b))throw new Error("THREE.FBXLoader: Unknown format.");if(getFbxVersion(b)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+getFbxVersion(b));fbxTree=new TextParser().parse(b)}const d=new three_module.Tap(this.manager).setPath(this.resourcePath||c).setCrossOrigin(this.crossOrigin),_=new FBXTreeParser(d,this.manager).parse(fbxTree);return fbxTree=null,connections=null,sceneGraph=null,_}}class FBXTreeParser{constructor(o,c){this.textureLoader=o,this.manager=c}parse(){connections=this.parseConnections();const o=this.parseImages(),c=this.parseTextures(o),d=this.parseMaterials(c),_=this.parseDeformers(),b=new GeometryParser().parse(_);return this.parseScene(_,b,d),sceneGraph}parseConnections(){const o=new Map;return"Connections"in fbxTree&&fbxTree.Connections.connections.forEach(function(c){const d=c[0],_=c[1],b=c[2];o.has(d)||o.set(d,{parents:[],children:[]});const _e={ID:_,relationship:b};o.get(d).parents.push(_e),o.has(_)||o.set(_,{parents:[],children:[]});const it={ID:d,relationship:b};o.get(_).children.push(it)}),o}parseImages(){const o={},c={};if("Video"in fbxTree.Objects){const d=fbxTree.Objects.Video;for(const _ in d){const b=d[_];if(o[parseInt(_)]=b.RelativeFilename||b.Filename,"Content"in b){const _e=b.Content instanceof ArrayBuffer&&b.Content.byteLength>0,it=typeof b.Content=="string"&&b.Content!=="";if(_e||it){const nt=this.parseImage(d[_]);c[b.RelativeFilename||b.Filename]=nt}}}}for(const d in o){const _=o[d];c[_]!==void 0?o[d]=c[_]:o[d]=o[d].split("\\").pop()}return o}parseImage(o){const c=o.Content,d=o.RelativeFilename||o.Filename,_=d.slice(d.lastIndexOf(".")+1).toLowerCase();let b;switch(_){case"bmp":b="image/bmp";break;case"jpg":case"jpeg":b="image/jpeg";break;case"png":b="image/png";break;case"tif":b="image/tiff";break;case"tga":this.manager.getHandler(".tga")===null&&console.warn("FBXLoader: TGA loader not found, skipping ",d),b="image/tga";break;default:return void console.warn('FBXLoader: Image type "'+_+'" is not supported.')}if(typeof c=="string")return"data:"+b+";base64,"+c;{const _e=new Uint8Array(c);return window.URL.createObjectURL(new Blob([_e],{type:b}))}}parseTextures(o){const c=new Map;if("Texture"in fbxTree.Objects){const d=fbxTree.Objects.Texture;for(const _ in d){const b=this.parseTexture(d[_],o);c.set(parseInt(_),b)}}return c}parseTexture(o,c){const d=this.loadTexture(o,c);d.ID=o.id,d.name=o.attrName;const _=o.WrapModeU,b=o.WrapModeV,_e=_!==void 0?_.value:0,it=b!==void 0?b.value:0;if(d.wrapS=_e===0?three_module.GJx:three_module.ghU,d.wrapT=it===0?three_module.GJx:three_module.ghU,"Scaling"in o){const nt=o.Scaling.value;d.repeat.x=nt[0],d.repeat.y=nt[1]}if("Translation"in o){const nt=o.Translation.value;d.offset.x=nt[0],d.offset.y=nt[1]}return d}loadTexture(o,c){let d;const _=this.textureLoader.path,b=connections.get(o.id).children;let _e;b!==void 0&&b.length>0&&c[b[0].ID]!==void 0&&(d=c[b[0].ID],d.indexOf("blob:")!==0&&d.indexOf("data:")!==0||this.textureLoader.setPath(void 0));const it=o.FileName.slice(-3).toLowerCase();if(it==="tga"){const nt=this.manager.getHandler(".tga");nt===null?(console.warn("FBXLoader: TGA loader not found, creating placeholder texture for",o.RelativeFilename),_e=new three_module.gPd):(nt.setPath(this.textureLoader.path),_e=nt.load(d))}else it==="psd"?(console.warn("FBXLoader: PSD textures are not supported, creating placeholder texture for",o.RelativeFilename),_e=new three_module.gPd):_e=this.textureLoader.load(d);return this.textureLoader.setPath(_),_e}parseMaterials(o){const c=new Map;if("Material"in fbxTree.Objects){const d=fbxTree.Objects.Material;for(const _ in d){const b=this.parseMaterial(d[_],o);b!==null&&c.set(parseInt(_),b)}}return c}parseMaterial(o,c){const d=o.id,_=o.attrName;let b=o.ShadingModel;if(typeof b=="object"&&(b=b.value),!connections.has(d))return null;const _e=this.parseParameters(o,c,d);let it;switch(b.toLowerCase()){case"phong":it=new three_module.tXL;break;case"lambert":it=new three_module.G_z;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',b),it=new three_module.tXL}return it.setValues(_e),it.name=_,it}parseParameters(o,c,d){const _={};o.BumpFactor&&(_.bumpScale=o.BumpFactor.value),o.Diffuse?_.color=new three_module.Q1f().fromArray(o.Diffuse.value).convertSRGBToLinear():!o.DiffuseColor||o.DiffuseColor.type!=="Color"&&o.DiffuseColor.type!=="ColorRGB"||(_.color=new three_module.Q1f().fromArray(o.DiffuseColor.value).convertSRGBToLinear()),o.DisplacementFactor&&(_.displacementScale=o.DisplacementFactor.value),o.Emissive?_.emissive=new three_module.Q1f().fromArray(o.Emissive.value).convertSRGBToLinear():!o.EmissiveColor||o.EmissiveColor.type!=="Color"&&o.EmissiveColor.type!=="ColorRGB"||(_.emissive=new three_module.Q1f().fromArray(o.EmissiveColor.value).convertSRGBToLinear()),o.EmissiveFactor&&(_.emissiveIntensity=parseFloat(o.EmissiveFactor.value)),o.Opacity&&(_.opacity=parseFloat(o.Opacity.value)),_.opacity<1&&(_.transparent=!0),o.ReflectionFactor&&(_.reflectivity=o.ReflectionFactor.value),o.Shininess&&(_.shininess=o.Shininess.value),o.Specular?_.specular=new three_module.Q1f().fromArray(o.Specular.value).convertSRGBToLinear():o.SpecularColor&&o.SpecularColor.type==="Color"&&(_.specular=new three_module.Q1f().fromArray(o.SpecularColor.value).convertSRGBToLinear());const b=this;return connections.get(d).children.forEach(function(_e){const it=_e.relationship;switch(it){case"Bump":_.bumpMap=b.getTexture(c,_e.ID);break;case"Maya|TEX_ao_map":_.aoMap=b.getTexture(c,_e.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":_.map=b.getTexture(c,_e.ID),_.map!==void 0&&(_.map.colorSpace=three_module.er$);break;case"DisplacementColor":_.displacementMap=b.getTexture(c,_e.ID);break;case"EmissiveColor":_.emissiveMap=b.getTexture(c,_e.ID),_.emissiveMap!==void 0&&(_.emissiveMap.colorSpace=three_module.er$);break;case"NormalMap":case"Maya|TEX_normal_map":_.normalMap=b.getTexture(c,_e.ID);break;case"ReflectionColor":_.envMap=b.getTexture(c,_e.ID),_.envMap!==void 0&&(_.envMap.mapping=three_module.wfO,_.envMap.colorSpace=three_module.er$);break;case"SpecularColor":_.specularMap=b.getTexture(c,_e.ID),_.specularMap!==void 0&&(_.specularMap.colorSpace=three_module.er$);break;case"TransparentColor":case"TransparencyFactor":_.alphaMap=b.getTexture(c,_e.ID),_.transparent=!0;break;default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",it)}}),_}getTexture(o,c){return"LayeredTexture"in fbxTree.Objects&&c in fbxTree.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),c=connections.get(c).children[0].ID),o.get(c)}parseDeformers(){const o={},c={};if("Deformer"in fbxTree.Objects){const d=fbxTree.Objects.Deformer;for(const _ in d){const b=d[_],_e=connections.get(parseInt(_));if(b.attrType==="Skin"){const it=this.parseSkeleton(_e,d);it.ID=_,_e.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),it.geometryID=_e.parents[0].ID,o[_]=it}else if(b.attrType==="BlendShape"){const it={id:_};it.rawTargets=this.parseMorphTargets(_e,d),it.id=_,_e.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),c[_]=it}}}return{skeletons:o,morphTargets:c}}parseSkeleton(o,c){const d=[];return o.children.forEach(function(_){const b=c[_.ID];if(b.attrType!=="Cluster")return;const _e={ID:_.ID,indices:[],weights:[],transformLink:new three_module.kn4().fromArray(b.TransformLink.a)};"Indexes"in b&&(_e.indices=b.Indexes.a,_e.weights=b.Weights.a),d.push(_e)}),{rawBones:d,bones:[]}}parseMorphTargets(o,c){const d=[];for(let _=0;_<o.children.length;_++){const b=o.children[_],_e=c[b.ID],it={name:_e.attrName,initialWeight:_e.DeformPercent,id:_e.id,fullWeights:_e.FullWeights.a};if(_e.attrType!=="BlendShapeChannel")return;it.geoID=connections.get(parseInt(b.ID)).children.filter(function(nt){return nt.relationship===void 0})[0].ID,d.push(it)}return d}parseScene(o,c,d){sceneGraph=new three_module.YJl;const _=this.parseModels(o.skeletons,c,d),b=fbxTree.Objects.Model,_e=this;_.forEach(function(nt){const at=b[nt.ID];_e.setLookAtProperties(nt,at),connections.get(nt.ID).parents.forEach(function(ut){const pt=_.get(ut.ID);pt!==void 0&&pt.add(nt)}),nt.parent===null&&sceneGraph.add(nt)}),this.bindSkeleton(o.skeletons,c,_),this.createAmbientLight(),sceneGraph.traverse(function(nt){if(nt.userData.transformData){nt.parent&&(nt.userData.transformData.parentMatrix=nt.parent.matrix,nt.userData.transformData.parentMatrixWorld=nt.parent.matrixWorld);const at=generateTransform(nt.userData.transformData);nt.applyMatrix4(at),nt.updateWorldMatrix()}});const it=new AnimationParser().parse();sceneGraph.children.length===1&&sceneGraph.children[0].isGroup&&(sceneGraph.children[0].animations=it,sceneGraph=sceneGraph.children[0]),sceneGraph.animations=it}parseModels(o,c,d){const _=new Map,b=fbxTree.Objects.Model;for(const _e in b){const it=parseInt(_e),nt=b[_e],at=connections.get(it);let ut=this.buildSkeleton(at,o,it,nt.attrName);if(!ut){switch(nt.attrType){case"Camera":ut=this.createCamera(at);break;case"Light":ut=this.createLight(at);break;case"Mesh":ut=this.createMesh(at,c,d);break;case"NurbsCurve":ut=this.createCurve(at,c);break;case"LimbNode":case"Root":ut=new three_module.$Kf;break;default:ut=new three_module.YJl}ut.name=nt.attrName?three_module.Nwf.sanitizeNodeName(nt.attrName):"",ut.userData.originalName=nt.attrName,ut.ID=it}this.getTransformData(ut,nt),_.set(it,ut)}return _}buildSkeleton(o,c,d,_){let b=null;return o.parents.forEach(function(_e){for(const it in c){const nt=c[it];nt.rawBones.forEach(function(at,ut){if(at.ID===_e.ID){const pt=b;b=new three_module.$Kf,b.matrixWorld.copy(at.transformLink),b.name=_?three_module.Nwf.sanitizeNodeName(_):"",b.userData.originalName=_,b.ID=d,nt.bones[ut]=b,pt!==null&&b.add(pt)}})}}),b}createCamera(o){let c,d;if(o.children.forEach(function(_){const b=fbxTree.Objects.NodeAttribute[_.ID];b!==void 0&&(d=b)}),d===void 0)c=new three_module.B69;else{let _=0;d.CameraProjectionType!==void 0&&d.CameraProjectionType.value===1&&(_=1);let b=1;d.NearPlane!==void 0&&(b=d.NearPlane.value/1e3);let _e=1e3;d.FarPlane!==void 0&&(_e=d.FarPlane.value/1e3);let it=window.innerWidth,nt=window.innerHeight;d.AspectWidth!==void 0&&d.AspectHeight!==void 0&&(it=d.AspectWidth.value,nt=d.AspectHeight.value);const at=it/nt;let ut=45;d.FieldOfView!==void 0&&(ut=d.FieldOfView.value);const pt=d.FocalLength?d.FocalLength.value:null;switch(_){case 0:c=new three_module.ubm(ut,at,b,_e),pt!==null&&c.setFocalLength(pt);break;case 1:c=new three_module.qUd(-it/2,it/2,nt/2,-nt/2,b,_e);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+_+"."),c=new three_module.B69}}return c}createLight(o){let c,d;if(o.children.forEach(function(_){const b=fbxTree.Objects.NodeAttribute[_.ID];b!==void 0&&(d=b)}),d===void 0)c=new three_module.B69;else{let _;_=d.LightType===void 0?0:d.LightType.value;let b=16777215;d.Color!==void 0&&(b=new three_module.Q1f().fromArray(d.Color.value).convertSRGBToLinear());let _e=d.Intensity===void 0?1:d.Intensity.value/100;d.CastLightOnObject!==void 0&&d.CastLightOnObject.value===0&&(_e=0);let it=0;d.FarAttenuationEnd!==void 0&&(it=d.EnableFarAttenuation!==void 0&&d.EnableFarAttenuation.value===0?0:d.FarAttenuationEnd.value);const nt=1;switch(_){case 0:c=new three_module.HiM(b,_e,it,nt);break;case 1:c=new three_module.ZyN(b,_e);break;case 2:let at=Math.PI/3;d.InnerAngle!==void 0&&(at=three_module.cj9.degToRad(d.InnerAngle.value));let ut=0;d.OuterAngle!==void 0&&(ut=three_module.cj9.degToRad(d.OuterAngle.value),ut=Math.max(ut,1)),c=new three_module.nCl(b,_e,it,at,ut,nt);break;default:console.warn("THREE.FBXLoader: Unknown light type "+d.LightType.value+", defaulting to a PointLight."),c=new three_module.HiM(b,_e)}d.CastShadows!==void 0&&d.CastShadows.value===1&&(c.castShadow=!0)}return c}createMesh(o,c,d){let _,b=null,_e=null;const it=[];return o.children.forEach(function(nt){c.has(nt.ID)&&(b=c.get(nt.ID)),d.has(nt.ID)&&it.push(d.get(nt.ID))}),it.length>1?_e=it:it.length>0?_e=it[0]:(_e=new three_module.tXL({name:three_module.aHM.DEFAULT_MATERIAL_NAME,color:13421772}),it.push(_e)),"color"in b.attributes&&it.forEach(function(nt){nt.vertexColors=!0}),b.FBX_Deformer?(_=new three_module.I46(b,_e),_.normalizeSkinWeights()):_=new three_module.eaF(b,_e),_}createCurve(o,c){const d=o.children.reduce(function(b,_e){return c.has(_e.ID)&&(b=c.get(_e.ID)),b},null),_=new three_module.mrM({name:three_module.aHM.DEFAULT_MATERIAL_NAME,color:3342591,linewidth:1});return new three_module.N1A(d,_)}getTransformData(o,c){const d={};"InheritType"in c&&(d.inheritType=parseInt(c.InheritType.value)),d.eulerOrder="RotationOrder"in c?getEulerOrder(c.RotationOrder.value):"ZYX","Lcl_Translation"in c&&(d.translation=c.Lcl_Translation.value),"PreRotation"in c&&(d.preRotation=c.PreRotation.value),"Lcl_Rotation"in c&&(d.rotation=c.Lcl_Rotation.value),"PostRotation"in c&&(d.postRotation=c.PostRotation.value),"Lcl_Scaling"in c&&(d.scale=c.Lcl_Scaling.value),"ScalingOffset"in c&&(d.scalingOffset=c.ScalingOffset.value),"ScalingPivot"in c&&(d.scalingPivot=c.ScalingPivot.value),"RotationOffset"in c&&(d.rotationOffset=c.RotationOffset.value),"RotationPivot"in c&&(d.rotationPivot=c.RotationPivot.value),o.userData.transformData=d}setLookAtProperties(o,c){"LookAtProperty"in c&&connections.get(o.ID).children.forEach(function(d){if(d.relationship==="LookAtProperty"){const _=fbxTree.Objects.Model[d.ID];if("Lcl_Translation"in _){const b=_.Lcl_Translation.value;o.target!==void 0?(o.target.position.fromArray(b),sceneGraph.add(o.target)):o.lookAt(new three_module.Pq0().fromArray(b))}}})}bindSkeleton(o,c,d){const _=this.parsePoseNodes();for(const b in o){const _e=o[b];connections.get(parseInt(_e.ID)).parents.forEach(function(it){if(c.has(it.ID)){const nt=it.ID;connections.get(nt).parents.forEach(function(at){d.has(at.ID)&&d.get(at.ID).bind(new three_module.EAD(_e.bones),_[at.ID])})}})}}parsePoseNodes(){const o={};if("Pose"in fbxTree.Objects){const c=fbxTree.Objects.Pose;for(const d in c)if(c[d].attrType==="BindPose"&&c[d].NbPoseNodes>0){const _=c[d].PoseNode;Array.isArray(_)?_.forEach(function(b){o[b.Node]=new three_module.kn4().fromArray(b.Matrix.a)}):o[_.Node]=new three_module.kn4().fromArray(_.Matrix.a)}}return o}createAmbientLight(){if("GlobalSettings"in fbxTree&&"AmbientColor"in fbxTree.GlobalSettings){const o=fbxTree.GlobalSettings.AmbientColor.value,c=o[0],d=o[1],_=o[2];if(c!==0||d!==0||_!==0){const b=new three_module.Q1f(c,d,_).convertSRGBToLinear();sceneGraph.add(new three_module.$p8(b,1))}}}}class GeometryParser{constructor(){this.negativeMaterialIndices=!1}parse(o){const c=new Map;if("Geometry"in fbxTree.Objects){const d=fbxTree.Objects.Geometry;for(const _ in d){const b=connections.get(parseInt(_)),_e=this.parseGeometry(b,d[_],o);c.set(parseInt(_),_e)}}return this.negativeMaterialIndices===!0&&console.warn("THREE.FBXLoader: The FBX file contains invalid (negative) material indices. The asset might not render as expected."),c}parseGeometry(o,c,d){switch(c.attrType){case"Mesh":return this.parseMeshGeometry(o,c,d);case"NurbsCurve":return this.parseNurbsGeometry(c)}}parseMeshGeometry(o,c,d){const _=d.skeletons,b=[],_e=o.parents.map(function(pt){return fbxTree.Objects.Model[pt.ID]});if(_e.length===0)return;const it=o.children.reduce(function(pt,mt){return _[mt.ID]!==void 0&&(pt=_[mt.ID]),pt},null);o.children.forEach(function(pt){d.morphTargets[pt.ID]!==void 0&&b.push(d.morphTargets[pt.ID])});const nt=_e[0],at={};"RotationOrder"in nt&&(at.eulerOrder=getEulerOrder(nt.RotationOrder.value)),"InheritType"in nt&&(at.inheritType=parseInt(nt.InheritType.value)),"GeometricTranslation"in nt&&(at.translation=nt.GeometricTranslation.value),"GeometricRotation"in nt&&(at.rotation=nt.GeometricRotation.value),"GeometricScaling"in nt&&(at.scale=nt.GeometricScaling.value);const ut=generateTransform(at);return this.genGeometry(c,it,b,ut)}genGeometry(o,c,d,_){const b=new three_module.LoY;o.attrName&&(b.name=o.attrName);const _e=this.parseGeoNode(o,c),it=this.genBuffers(_e),nt=new three_module.qtW(it.vertex,3);if(nt.applyMatrix4(_),b.setAttribute("position",nt),it.colors.length>0&&b.setAttribute("color",new three_module.qtW(it.colors,3)),c&&(b.setAttribute("skinIndex",new three_module.A$4(it.weightsIndices,4)),b.setAttribute("skinWeight",new three_module.qtW(it.vertexWeights,4)),b.FBX_Deformer=c),it.normal.length>0){const at=new three_module.dwI().getNormalMatrix(_),ut=new three_module.qtW(it.normal,3);ut.applyNormalMatrix(at),b.setAttribute("normal",ut)}if(it.uvs.forEach(function(at,ut){const pt=ut===0?"uv":`uv${ut}`;b.setAttribute(pt,new three_module.qtW(it.uvs[ut],2))}),_e.material&&_e.material.mappingType!=="AllSame"){let at=it.materialIndex[0],ut=0;if(it.materialIndex.forEach(function(pt,mt){pt!==at&&(b.addGroup(ut,mt-ut,at),at=pt,ut=mt)}),b.groups.length>0){const pt=b.groups[b.groups.length-1],mt=pt.start+pt.count;mt!==it.materialIndex.length&&b.addGroup(mt,it.materialIndex.length-mt,at)}b.groups.length===0&&b.addGroup(0,it.materialIndex.length,it.materialIndex[0])}return this.addMorphTargets(b,o,d,_),b}parseGeoNode(o,c){const d={};if(d.vertexPositions=o.Vertices!==void 0?o.Vertices.a:[],d.vertexIndices=o.PolygonVertexIndex!==void 0?o.PolygonVertexIndex.a:[],o.LayerElementColor&&(d.color=this.parseVertexColors(o.LayerElementColor[0])),o.LayerElementMaterial&&(d.material=this.parseMaterialIndices(o.LayerElementMaterial[0])),o.LayerElementNormal&&(d.normal=this.parseNormals(o.LayerElementNormal[0])),o.LayerElementUV){d.uv=[];let _=0;for(;o.LayerElementUV[_];)o.LayerElementUV[_].UV&&d.uv.push(this.parseUVs(o.LayerElementUV[_])),_++}return d.weightTable={},c!==null&&(d.skeleton=c,c.rawBones.forEach(function(_,b){_.indices.forEach(function(_e,it){d.weightTable[_e]===void 0&&(d.weightTable[_e]=[]),d.weightTable[_e].push({id:b,weight:_.weights[it]})})})),d}genBuffers(o){const c={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]};let d=0,_=0,b=!1,_e=[],it=[],nt=[],at=[],ut=[],pt=[];const mt=this;return o.vertexIndices.forEach(function(ft,vt){let xt,At=!1;ft<0&&(ft=~ft,At=!0);let Ct=[],Et=[];if(_e.push(3*ft,3*ft+1,3*ft+2),o.color){const Tt=getData(vt,d,ft,o.color);nt.push(Tt[0],Tt[1],Tt[2])}if(o.skeleton){if(o.weightTable[ft]!==void 0&&o.weightTable[ft].forEach(function(Tt){Et.push(Tt.weight),Ct.push(Tt.id)}),Et.length>4){b||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),b=!0);const Tt=[0,0,0,0],kt=[0,0,0,0];Et.forEach(function(Dt,zt){let Bt=Dt,Rt=Ct[zt];kt.forEach(function(Ut,Ht,Jt){if(Bt>Ut){Jt[Ht]=Bt,Bt=Ut;const Kt=Tt[Ht];Tt[Ht]=Rt,Rt=Kt}})}),Ct=Tt,Et=kt}for(;Et.length<4;)Et.push(0),Ct.push(0);for(let Tt=0;Tt<4;++Tt)ut.push(Et[Tt]),pt.push(Ct[Tt])}if(o.normal){const Tt=getData(vt,d,ft,o.normal);it.push(Tt[0],Tt[1],Tt[2])}o.material&&o.material.mappingType!=="AllSame"&&(xt=getData(vt,d,ft,o.material)[0],xt<0&&(mt.negativeMaterialIndices=!0,xt=0)),o.uv&&o.uv.forEach(function(Tt,kt){const Dt=getData(vt,d,ft,Tt);at[kt]===void 0&&(at[kt]=[]),at[kt].push(Dt[0]),at[kt].push(Dt[1])}),_++,At&&(_>4&&console.warn("THREE.FBXLoader: Polygons with more than four sides are not supported. Make sure to triangulate the geometry during export."),mt.genFace(c,o,_e,xt,it,nt,at,ut,pt,_),d++,_=0,_e=[],it=[],nt=[],at=[],ut=[],pt=[])}),c}genFace(o,c,d,_,b,_e,it,nt,at,ut){for(let pt=2;pt<ut;pt++)o.vertex.push(c.vertexPositions[d[0]]),o.vertex.push(c.vertexPositions[d[1]]),o.vertex.push(c.vertexPositions[d[2]]),o.vertex.push(c.vertexPositions[d[3*(pt-1)]]),o.vertex.push(c.vertexPositions[d[3*(pt-1)+1]]),o.vertex.push(c.vertexPositions[d[3*(pt-1)+2]]),o.vertex.push(c.vertexPositions[d[3*pt]]),o.vertex.push(c.vertexPositions[d[3*pt+1]]),o.vertex.push(c.vertexPositions[d[3*pt+2]]),c.skeleton&&(o.vertexWeights.push(nt[0]),o.vertexWeights.push(nt[1]),o.vertexWeights.push(nt[2]),o.vertexWeights.push(nt[3]),o.vertexWeights.push(nt[4*(pt-1)]),o.vertexWeights.push(nt[4*(pt-1)+1]),o.vertexWeights.push(nt[4*(pt-1)+2]),o.vertexWeights.push(nt[4*(pt-1)+3]),o.vertexWeights.push(nt[4*pt]),o.vertexWeights.push(nt[4*pt+1]),o.vertexWeights.push(nt[4*pt+2]),o.vertexWeights.push(nt[4*pt+3]),o.weightsIndices.push(at[0]),o.weightsIndices.push(at[1]),o.weightsIndices.push(at[2]),o.weightsIndices.push(at[3]),o.weightsIndices.push(at[4*(pt-1)]),o.weightsIndices.push(at[4*(pt-1)+1]),o.weightsIndices.push(at[4*(pt-1)+2]),o.weightsIndices.push(at[4*(pt-1)+3]),o.weightsIndices.push(at[4*pt]),o.weightsIndices.push(at[4*pt+1]),o.weightsIndices.push(at[4*pt+2]),o.weightsIndices.push(at[4*pt+3])),c.color&&(o.colors.push(_e[0]),o.colors.push(_e[1]),o.colors.push(_e[2]),o.colors.push(_e[3*(pt-1)]),o.colors.push(_e[3*(pt-1)+1]),o.colors.push(_e[3*(pt-1)+2]),o.colors.push(_e[3*pt]),o.colors.push(_e[3*pt+1]),o.colors.push(_e[3*pt+2])),c.material&&c.material.mappingType!=="AllSame"&&(o.materialIndex.push(_),o.materialIndex.push(_),o.materialIndex.push(_)),c.normal&&(o.normal.push(b[0]),o.normal.push(b[1]),o.normal.push(b[2]),o.normal.push(b[3*(pt-1)]),o.normal.push(b[3*(pt-1)+1]),o.normal.push(b[3*(pt-1)+2]),o.normal.push(b[3*pt]),o.normal.push(b[3*pt+1]),o.normal.push(b[3*pt+2])),c.uv&&c.uv.forEach(function(mt,ft){o.uvs[ft]===void 0&&(o.uvs[ft]=[]),o.uvs[ft].push(it[ft][0]),o.uvs[ft].push(it[ft][1]),o.uvs[ft].push(it[ft][2*(pt-1)]),o.uvs[ft].push(it[ft][2*(pt-1)+1]),o.uvs[ft].push(it[ft][2*pt]),o.uvs[ft].push(it[ft][2*pt+1])})}addMorphTargets(o,c,d,_){if(d.length===0)return;o.morphTargetsRelative=!0,o.morphAttributes.position=[];const b=this;d.forEach(function(_e){_e.rawTargets.forEach(function(it){const nt=fbxTree.Objects.Geometry[it.geoID];nt!==void 0&&b.genMorphGeometry(o,c,nt,_,it.name)})})}genMorphGeometry(o,c,d,_,b){const _e=c.PolygonVertexIndex!==void 0?c.PolygonVertexIndex.a:[],it=d.Vertices!==void 0?d.Vertices.a:[],nt=d.Indexes!==void 0?d.Indexes.a:[],at=3*o.attributes.position.count,ut=new Float32Array(at);for(let vt=0;vt<nt.length;vt++){const xt=3*nt[vt];ut[xt]=it[3*vt],ut[xt+1]=it[3*vt+1],ut[xt+2]=it[3*vt+2]}const pt={vertexIndices:_e,vertexPositions:ut},mt=this.genBuffers(pt),ft=new three_module.qtW(mt.vertex,3);ft.name=b||d.attrName,ft.applyMatrix4(_),o.morphAttributes.position.push(ft)}parseNormals(o){const c=o.MappingInformationType,d=o.ReferenceInformationType,_=o.Normals.a;let b=[];return d==="IndexToDirect"&&("NormalIndex"in o?b=o.NormalIndex.a:"NormalsIndex"in o&&(b=o.NormalsIndex.a)),{dataSize:3,buffer:_,indices:b,mappingType:c,referenceType:d}}parseUVs(o){const c=o.MappingInformationType,d=o.ReferenceInformationType,_=o.UV.a;let b=[];return d==="IndexToDirect"&&(b=o.UVIndex.a),{dataSize:2,buffer:_,indices:b,mappingType:c,referenceType:d}}parseVertexColors(o){const c=o.MappingInformationType,d=o.ReferenceInformationType,_=o.Colors.a;let b=[];d==="IndexToDirect"&&(b=o.ColorIndex.a);for(let _e=0,it=new three_module.Q1f;_e<_.length;_e+=4)it.fromArray(_,_e).convertSRGBToLinear().toArray(_,_e);return{dataSize:4,buffer:_,indices:b,mappingType:c,referenceType:d}}parseMaterialIndices(o){const c=o.MappingInformationType,d=o.ReferenceInformationType;if(c==="NoMappingInformation")return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:d};const _=o.Materials.a,b=[];for(let _e=0;_e<_.length;++_e)b.push(_e);return{dataSize:1,buffer:_,indices:b,mappingType:c,referenceType:d}}parseNurbsGeometry(o){const c=parseInt(o.Order);if(isNaN(c))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",o.Order,o.id),new three_module.LoY;const d=c-1,_=o.KnotVector.a,b=[],_e=o.Points.a;for(let ut=0,pt=_e.length;ut<pt;ut+=4)b.push(new three_module.IUQ().fromArray(_e,ut));let it,nt;if(o.Form==="Closed")b.push(b[0]);else if(o.Form==="Periodic"){it=d,nt=_.length-1-it;for(let ut=0;ut<d;++ut)b.push(b[ut])}const at=new NURBSCurve(d,_,b,it,nt).getPoints(12*b.length);return new three_module.LoY().setFromPoints(at)}}class AnimationParser{parse(){const o=[],c=this.parseClips();if(c!==void 0)for(const d in c){const _=c[d],b=this.addClip(_);o.push(b)}return o}parseClips(){if(fbxTree.Objects.AnimationCurve===void 0)return;const o=this.parseAnimationCurveNodes();this.parseAnimationCurves(o);const c=this.parseAnimationLayers(o);return this.parseAnimStacks(c)}parseAnimationCurveNodes(){const o=fbxTree.Objects.AnimationCurveNode,c=new Map;for(const d in o){const _=o[d];if(_.attrName.match(/S|R|T|DeformPercent/)!==null){const b={id:_.id,attr:_.attrName,curves:{}};c.set(b.id,b)}}return c}parseAnimationCurves(o){const c=fbxTree.Objects.AnimationCurve;for(const d in c){const _={id:c[d].id,times:c[d].KeyTime.a.map(convertFBXTimeToSeconds),values:c[d].KeyValueFloat.a},b=connections.get(_.id);if(b!==void 0){const _e=b.parents[0].ID,it=b.parents[0].relationship;it.match(/X/)?o.get(_e).curves.x=_:it.match(/Y/)?o.get(_e).curves.y=_:it.match(/Z/)?o.get(_e).curves.z=_:it.match(/DeformPercent/)&&o.has(_e)&&(o.get(_e).curves.morph=_)}}}parseAnimationLayers(o){const c=fbxTree.Objects.AnimationLayer,d=new Map;for(const _ in c){const b=[],_e=connections.get(parseInt(_));_e!==void 0&&(_e.children.forEach(function(it,nt){if(o.has(it.ID)){const at=o.get(it.ID);if(at.curves.x!==void 0||at.curves.y!==void 0||at.curves.z!==void 0){if(b[nt]===void 0){const ut=connections.get(it.ID).parents.filter(function(pt){return pt.relationship!==void 0})[0].ID;if(ut!==void 0){const pt=fbxTree.Objects.Model[ut.toString()];if(pt===void 0)return void console.warn("THREE.FBXLoader: Encountered a unused curve.",it);const mt={modelName:pt.attrName?three_module.Nwf.sanitizeNodeName(pt.attrName):"",ID:pt.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};sceneGraph.traverse(function(ft){ft.ID===pt.id&&(mt.transform=ft.matrix,ft.userData.transformData&&(mt.eulerOrder=ft.userData.transformData.eulerOrder))}),mt.transform||(mt.transform=new three_module.kn4),"PreRotation"in pt&&(mt.preRotation=pt.PreRotation.value),"PostRotation"in pt&&(mt.postRotation=pt.PostRotation.value),b[nt]=mt}}b[nt]&&(b[nt][at.attr]=at)}else if(at.curves.morph!==void 0){if(b[nt]===void 0){const ut=connections.get(it.ID).parents.filter(function(At){return At.relationship!==void 0})[0].ID,pt=connections.get(ut).parents[0].ID,mt=connections.get(pt).parents[0].ID,ft=connections.get(mt).parents[0].ID,vt=fbxTree.Objects.Model[ft],xt={modelName:vt.attrName?three_module.Nwf.sanitizeNodeName(vt.attrName):"",morphName:fbxTree.Objects.Deformer[ut].attrName};b[nt]=xt}b[nt][at.attr]=at}}}),d.set(parseInt(_),b))}return d}parseAnimStacks(o){const c=fbxTree.Objects.AnimationStack,d={};for(const _ in c){const b=connections.get(parseInt(_)).children;b.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");const _e=o.get(b[0].ID);d[_]={name:c[_].attrName,layer:_e}}return d}addClip(o){let c=[];const d=this;return o.layer.forEach(function(_){c=c.concat(d.generateTracks(_))}),new three_module.tz3(o.name,-1,c)}generateTracks(o){const c=[];let d=new three_module.Pq0,_=new three_module.PTz,b=new three_module.Pq0;if(o.transform&&o.transform.decompose(d,_,b),d=d.toArray(),_=new three_module.O9p().setFromQuaternion(_,o.eulerOrder).toArray(),b=b.toArray(),o.T!==void 0&&Object.keys(o.T.curves).length>0){const _e=this.generateVectorTrack(o.modelName,o.T.curves,d,"position");_e!==void 0&&c.push(_e)}if(o.R!==void 0&&Object.keys(o.R.curves).length>0){const _e=this.generateRotationTrack(o.modelName,o.R.curves,_,o.preRotation,o.postRotation,o.eulerOrder);_e!==void 0&&c.push(_e)}if(o.S!==void 0&&Object.keys(o.S.curves).length>0){const _e=this.generateVectorTrack(o.modelName,o.S.curves,b,"scale");_e!==void 0&&c.push(_e)}if(o.DeformPercent!==void 0){const _e=this.generateMorphTrack(o);_e!==void 0&&c.push(_e)}return c}generateVectorTrack(o,c,d,_){const b=this.getTimesForAllAxes(c),_e=this.getKeyframeTrackValues(b,c,d);return new three_module.RiT(o+"."+_,b,_e)}generateRotationTrack(o,c,d,_,b,_e){c.x!==void 0&&(this.interpolateRotations(c.x),c.x.values=c.x.values.map(three_module.cj9.degToRad)),c.y!==void 0&&(this.interpolateRotations(c.y),c.y.values=c.y.values.map(three_module.cj9.degToRad)),c.z!==void 0&&(this.interpolateRotations(c.z),c.z.values=c.z.values.map(three_module.cj9.degToRad));const it=this.getTimesForAllAxes(c),nt=this.getKeyframeTrackValues(it,c,d);_!==void 0&&((_=_.map(three_module.cj9.degToRad)).push(_e),_=new three_module.O9p().fromArray(_),_=new three_module.PTz().setFromEuler(_)),b!==void 0&&((b=b.map(three_module.cj9.degToRad)).push(_e),b=new three_module.O9p().fromArray(b),b=new three_module.PTz().setFromEuler(b).invert());const at=new three_module.PTz,ut=new three_module.O9p,pt=[];for(let mt=0;mt<nt.length;mt+=3)ut.set(nt[mt],nt[mt+1],nt[mt+2],_e),at.setFromEuler(ut),_!==void 0&&at.premultiply(_),b!==void 0&&at.multiply(b),at.toArray(pt,mt/3*4);return new three_module.MBL(o+".quaternion",it,pt)}generateMorphTrack(o){const c=o.DeformPercent.curves.morph,d=c.values.map(function(b){return b/100}),_=sceneGraph.getObjectByName(o.modelName).morphTargetDictionary[o.morphName];return new three_module.Hit(o.modelName+".morphTargetInfluences["+_+"]",c.times,d)}getTimesForAllAxes(o){let c=[];if(o.x!==void 0&&(c=c.concat(o.x.times)),o.y!==void 0&&(c=c.concat(o.y.times)),o.z!==void 0&&(c=c.concat(o.z.times)),c=c.sort(function(d,_){return d-_}),c.length>1){let d=1,_=c[0];for(let b=1;b<c.length;b++){const _e=c[b];_e!==_&&(c[d]=_e,_=_e,d++)}c=c.slice(0,d)}return c}getKeyframeTrackValues(o,c,d){const _=d,b=[];let _e=-1,it=-1,nt=-1;return o.forEach(function(at){if(c.x&&(_e=c.x.times.indexOf(at)),c.y&&(it=c.y.times.indexOf(at)),c.z&&(nt=c.z.times.indexOf(at)),_e!==-1){const ut=c.x.values[_e];b.push(ut),_[0]=ut}else b.push(_[0]);if(it!==-1){const ut=c.y.values[it];b.push(ut),_[1]=ut}else b.push(_[1]);if(nt!==-1){const ut=c.z.values[nt];b.push(ut),_[2]=ut}else b.push(_[2])}),b}interpolateRotations(o){for(let c=1;c<o.values.length;c++){const d=o.values[c-1],_=o.values[c]-d,b=Math.abs(_);if(b>=180){const _e=b/180,it=_/_e;let nt=d+it;const at=o.times[c-1],ut=(o.times[c]-at)/_e;let pt=at+ut;const mt=[],ft=[];for(;pt<o.times[c];)mt.push(pt),pt+=ut,ft.push(nt),nt+=it;o.times=inject(o.times,c,mt),o.values=inject(o.values,c,ft)}}}}class TextParser{getPrevNode(){return this.nodeStack[this.currentIndent-2]}getCurrentNode(){return this.nodeStack[this.currentIndent-1]}getCurrentProp(){return this.currentProp}pushStack(o){this.nodeStack.push(o),this.currentIndent+=1}popStack(){this.nodeStack.pop(),this.currentIndent-=1}setCurrentProp(o,c){this.currentProp=o,this.currentPropName=c}parse(o){this.currentIndent=0,this.allNodes=new FBXTree,this.nodeStack=[],this.currentProp=[],this.currentPropName="";const c=this,d=o.split(/[\r\n]+/);return d.forEach(function(_,b){const _e=_.match(/^[\s\t]*;/),it=_.match(/^[\s\t]*$/);if(_e||it)return;const nt=_.match("^\\t{"+c.currentIndent+"}(\\w+):(.*){",""),at=_.match("^\\t{"+c.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),ut=_.match("^\\t{"+(c.currentIndent-1)+"}}");nt?c.parseNodeBegin(_,nt):at?c.parseNodeProperty(_,at,d[++b]):ut?c.popStack():_.match(/^[^\s\t}]/)&&c.parseNodePropertyContinued(_)}),this.allNodes}parseNodeBegin(o,c){const d=c[1].trim().replace(/^"/,"").replace(/"$/,""),_=c[2].split(",").map(function(nt){return nt.trim().replace(/^"/,"").replace(/"$/,"")}),b={name:d},_e=this.parseNodeAttr(_),it=this.getCurrentNode();this.currentIndent===0?this.allNodes.add(d,b):d in it?(d==="PoseNode"?it.PoseNode.push(b):it[d].id!==void 0&&(it[d]={},it[d][it[d].id]=it[d]),_e.id!==""&&(it[d][_e.id]=b)):typeof _e.id=="number"?(it[d]={},it[d][_e.id]=b):d!=="Properties70"&&(it[d]=d==="PoseNode"?[b]:b),typeof _e.id=="number"&&(b.id=_e.id),_e.name!==""&&(b.attrName=_e.name),_e.type!==""&&(b.attrType=_e.type),this.pushStack(b)}parseNodeAttr(o){let c=o[0];o[0]!==""&&(c=parseInt(o[0]),isNaN(c)&&(c=o[0]));let d="",_="";return o.length>1&&(d=o[1].replace(/^(\w+)::/,""),_=o[2]),{id:c,name:d,type:_}}parseNodeProperty(o,c,d){let _=c[1].replace(/^"/,"").replace(/"$/,"").trim(),b=c[2].replace(/^"/,"").replace(/"$/,"").trim();_==="Content"&&b===","&&(b=d.replace(/"/g,"").replace(/,$/,"").trim());const _e=this.getCurrentNode();if(_e.name!=="Properties70"){if(_==="C"){const it=b.split(",").slice(1),nt=parseInt(it[0]),at=parseInt(it[1]);let ut=b.split(",").slice(3);ut=ut.map(function(pt){return pt.trim().replace(/^"/,"")}),_="connections",b=[nt,at],append(b,ut),_e[_]===void 0&&(_e[_]=[])}_==="Node"&&(_e.id=b),_ in _e&&Array.isArray(_e[_])?_e[_].push(b):_!=="a"?_e[_]=b:_e.a=b,this.setCurrentProp(_e,_),_==="a"&&b.slice(-1)!==","&&(_e.a=parseNumberArray(b))}else this.parseNodeSpecialProperty(o,_,b)}parseNodePropertyContinued(o){const c=this.getCurrentNode();c.a+=o,o.slice(-1)!==","&&(c.a=parseNumberArray(c.a))}parseNodeSpecialProperty(o,c,d){const _=d.split('",').map(function(ut){return ut.trim().replace(/^\"/,"").replace(/\s/,"_")}),b=_[0],_e=_[1],it=_[2],nt=_[3];let at=_[4];switch(_e){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":at=parseFloat(at);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":at=parseNumberArray(at)}this.getPrevNode()[b]={type:_e,type2:it,flag:nt,value:at},this.setCurrentProp(this.getPrevNode(),b)}}class BinaryParser{parse(o){const c=new BinaryReader(o);c.skip(23);const d=c.getUint32();if(d<6400)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+d);const _=new FBXTree;for(;!this.endOfContent(c);){const b=this.parseNode(c,d);b!==null&&_.add(b.name,b)}return _}endOfContent(o){return o.size()%16==0?(o.getOffset()+160+16&-16)>=o.size():o.getOffset()+160+16>=o.size()}parseNode(o,c){const d={},_=c>=7500?o.getUint64():o.getUint32(),b=c>=7500?o.getUint64():o.getUint32();c>=7500?o.getUint64():o.getUint32();const _e=o.getUint8(),it=o.getString(_e);if(_===0)return null;const nt=[];for(let mt=0;mt<b;mt++)nt.push(this.parseProperty(o));const at=nt.length>0?nt[0]:"",ut=nt.length>1?nt[1]:"",pt=nt.length>2?nt[2]:"";for(d.singleProperty=b===1&&o.getOffset()===_;_>o.getOffset();){const mt=this.parseNode(o,c);mt!==null&&this.parseSubNode(it,d,mt)}return d.propertyList=nt,typeof at=="number"&&(d.id=at),ut!==""&&(d.attrName=ut),pt!==""&&(d.attrType=pt),it!==""&&(d.name=it),d}parseSubNode(o,c,d){if(d.singleProperty===!0){const _=d.propertyList[0];Array.isArray(_)?(c[d.name]=d,d.a=_):c[d.name]=_}else if(o==="Connections"&&d.name==="C"){const _=[];d.propertyList.forEach(function(b,_e){_e!==0&&_.push(b)}),c.connections===void 0&&(c.connections=[]),c.connections.push(_)}else if(d.name==="Properties70")Object.keys(d).forEach(function(_){c[_]=d[_]});else if(o==="Properties70"&&d.name==="P"){let _=d.propertyList[0],b=d.propertyList[1];const _e=d.propertyList[2],it=d.propertyList[3];let nt;_.indexOf("Lcl ")===0&&(_=_.replace("Lcl ","Lcl_")),b.indexOf("Lcl ")===0&&(b=b.replace("Lcl ","Lcl_")),nt=b==="Color"||b==="ColorRGB"||b==="Vector"||b==="Vector3D"||b.indexOf("Lcl_")===0?[d.propertyList[4],d.propertyList[5],d.propertyList[6]]:d.propertyList[4],c[_]={type:b,type2:_e,flag:it,value:nt}}else c[d.name]===void 0?typeof d.id=="number"?(c[d.name]={},c[d.name][d.id]=d):c[d.name]=d:d.name==="PoseNode"?(Array.isArray(c[d.name])||(c[d.name]=[c[d.name]]),c[d.name].push(d)):c[d.name][d.id]===void 0&&(c[d.name][d.id]=d)}parseProperty(o){const c=o.getString(1);let d;switch(c){case"C":return o.getBoolean();case"D":return o.getFloat64();case"F":return o.getFloat32();case"I":return o.getInt32();case"L":return o.getInt64();case"R":return d=o.getUint32(),o.getArrayBuffer(d);case"S":return d=o.getUint32(),o.getString(d);case"Y":return o.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":const _=o.getUint32(),b=o.getUint32(),_e=o.getUint32();if(b===0)switch(c){case"b":case"c":return o.getBooleanArray(_);case"d":return o.getFloat64Array(_);case"f":return o.getFloat32Array(_);case"i":return o.getInt32Array(_);case"l":return o.getInt64Array(_)}const it=fflate_module_unzlibSync(new Uint8Array(o.getArrayBuffer(_e))),nt=new BinaryReader(it.buffer);switch(c){case"b":case"c":return nt.getBooleanArray(_);case"d":return nt.getFloat64Array(_);case"f":return nt.getFloat32Array(_);case"i":return nt.getInt32Array(_);case"l":return nt.getInt64Array(_)}break;default:throw new Error("THREE.FBXLoader: Unknown property type "+c)}}}class BinaryReader{constructor(o,c){this.dv=new DataView(o),this.offset=0,this.littleEndian=c===void 0||c,this._textDecoder=new TextDecoder}getOffset(){return this.offset}size(){return this.dv.buffer.byteLength}skip(o){this.offset+=o}getBoolean(){return!(1&~this.getUint8())}getBooleanArray(o){const c=[];for(let d=0;d<o;d++)c.push(this.getBoolean());return c}getUint8(){const o=this.dv.getUint8(this.offset);return this.offset+=1,o}getInt16(){const o=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,o}getInt32(){const o=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,o}getInt32Array(o){const c=[];for(let d=0;d<o;d++)c.push(this.getInt32());return c}getUint32(){const o=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,o}getInt64(){let o,c;return this.littleEndian?(o=this.getUint32(),c=this.getUint32()):(c=this.getUint32(),o=this.getUint32()),2147483648&c?(c=4294967295&~c,o=4294967295&~o,o===4294967295&&(c=c+1&4294967295),o=o+1&4294967295,-(4294967296*c+o)):4294967296*c+o}getInt64Array(o){const c=[];for(let d=0;d<o;d++)c.push(this.getInt64());return c}getUint64(){let o,c;return this.littleEndian?(o=this.getUint32(),c=this.getUint32()):(c=this.getUint32(),o=this.getUint32()),4294967296*c+o}getFloat32(){const o=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,o}getFloat32Array(o){const c=[];for(let d=0;d<o;d++)c.push(this.getFloat32());return c}getFloat64(){const o=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,o}getFloat64Array(o){const c=[];for(let d=0;d<o;d++)c.push(this.getFloat64());return c}getArrayBuffer(o){const c=this.dv.buffer.slice(this.offset,this.offset+o);return this.offset+=o,c}getString(o){const c=this.offset;let d=new Uint8Array(this.dv.buffer,c,o);this.skip(o);const _=d.indexOf(0);return _>=0&&(d=new Uint8Array(this.dv.buffer,c,_)),this._textDecoder.decode(d)}}class FBXTree{add(o,c){this[o]=c}}function isFbxFormatBinary(h){return h.byteLength>=21&&convertArrayBufferToString(h,0,21)==="Kaydara FBX Binary  \0"}function isFbxFormatASCII(h){const o=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"];let c=0;function d(_){const b=h[_-1];return h=h.slice(c+_),c++,b}for(let _=0;_<o.length;++_)if(d(1)===o[_])return!1;return!0}function getFbxVersion(h){const o=h.match(/FBXVersion: (\d+)/);if(o)return parseInt(o[1]);throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function convertFBXTimeToSeconds(h){return h/46186158e3}const dataArray=[];function getData(h,o,c,d){let _;switch(d.mappingType){case"ByPolygonVertex":_=h;break;case"ByPolygon":_=o;break;case"ByVertice":_=c;break;case"AllSame":_=d.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+d.mappingType)}d.referenceType==="IndexToDirect"&&(_=d.indices[_]);const b=_*d.dataSize,_e=b+d.dataSize;return slice(dataArray,d.buffer,b,_e)}const tempEuler=new three_module.O9p,FBXLoader_tempVec=new three_module.Pq0;function generateTransform(h){const o=new three_module.kn4,c=new three_module.kn4,d=new three_module.kn4,_=new three_module.kn4,b=new three_module.kn4,_e=new three_module.kn4,it=new three_module.kn4,nt=new three_module.kn4,at=new three_module.kn4,ut=new three_module.kn4,pt=new three_module.kn4,mt=new three_module.kn4,ft=h.inheritType?h.inheritType:0;if(h.translation&&o.setPosition(FBXLoader_tempVec.fromArray(h.translation)),h.preRotation){const Ht=h.preRotation.map(three_module.cj9.degToRad);Ht.push(h.eulerOrder||three_module.O9p.DEFAULT_ORDER),c.makeRotationFromEuler(tempEuler.fromArray(Ht))}if(h.rotation){const Ht=h.rotation.map(three_module.cj9.degToRad);Ht.push(h.eulerOrder||three_module.O9p.DEFAULT_ORDER),d.makeRotationFromEuler(tempEuler.fromArray(Ht))}if(h.postRotation){const Ht=h.postRotation.map(three_module.cj9.degToRad);Ht.push(h.eulerOrder||three_module.O9p.DEFAULT_ORDER),_.makeRotationFromEuler(tempEuler.fromArray(Ht)),_.invert()}h.scale&&b.scale(FBXLoader_tempVec.fromArray(h.scale)),h.scalingOffset&&it.setPosition(FBXLoader_tempVec.fromArray(h.scalingOffset)),h.scalingPivot&&_e.setPosition(FBXLoader_tempVec.fromArray(h.scalingPivot)),h.rotationOffset&&nt.setPosition(FBXLoader_tempVec.fromArray(h.rotationOffset)),h.rotationPivot&&at.setPosition(FBXLoader_tempVec.fromArray(h.rotationPivot)),h.parentMatrixWorld&&(pt.copy(h.parentMatrix),ut.copy(h.parentMatrixWorld));const vt=c.clone().multiply(d).multiply(_),xt=new three_module.kn4;xt.extractRotation(ut);const At=new three_module.kn4;At.copyPosition(ut);const Ct=At.clone().invert().multiply(ut),Et=xt.clone().invert().multiply(Ct),Tt=b,kt=new three_module.kn4;if(ft===0)kt.copy(xt).multiply(vt).multiply(Et).multiply(Tt);else if(ft===1)kt.copy(xt).multiply(Et).multiply(vt).multiply(Tt);else{const Ht=new three_module.kn4().scale(new three_module.Pq0().setFromMatrixScale(pt)).clone().invert(),Jt=Et.clone().multiply(Ht);kt.copy(xt).multiply(vt).multiply(Jt).multiply(Tt)}const Dt=at.clone().invert(),zt=_e.clone().invert();let Bt=o.clone().multiply(nt).multiply(at).multiply(c).multiply(d).multiply(_).multiply(Dt).multiply(it).multiply(_e).multiply(b).multiply(zt);const Rt=new three_module.kn4().copyPosition(Bt),Ut=ut.clone().multiply(Rt);return mt.copyPosition(Ut),Bt=mt.clone().multiply(kt),Bt.premultiply(ut.invert()),Bt}function getEulerOrder(h){const o=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return(h=h||0)===6?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),o[0]):o[h]}function parseNumberArray(h){return h.split(",").map(function(o){return parseFloat(o)})}function convertArrayBufferToString(h,o,c){return o===void 0&&(o=0),c===void 0&&(c=h.byteLength),new TextDecoder().decode(new Uint8Array(h,o,c))}function append(h,o){for(let c=0,d=h.length,_=o.length;c<_;c++,d++)h[d]=o[c]}function slice(h,o,c,d){for(let _=c,b=0;_<d;_++,b++)h[b]=o[_];return h}function inject(h,o,c){return h.slice(0,o).concat(c).concat(h.slice(o))}class FBXLoader2 extends FBXLoader{async loadAsync(o,c){const d=three_module.gPd.DEFAULT_IMAGE;three_module.gPd.DEFAULT_IMAGE||(three_module.gPd.DEFAULT_IMAGE=AssetImporter.WHITE_IMAGE_DATA);const _=await super.loadAsync(o,c);return three_module.gPd.DEFAULT_IMAGE=d,_}}class FBXLoadPlugin extends I$2{constructor(){super(...arguments),this.dependencies=[AssetManagerPlugin],this._importer=new Importer(FBXLoader2,["fbx"],!0)}async onAdded(o){var c,d;(d=(c=o.getManager())===null||c===void 0?void 0:c.importer)===null||d===void 0||d.Importers.push(this._importer)}async onDispose(o){}async onRemove(o){var c,d,_,b;!((d=(c=o.getManager())===null||c===void 0?void 0:c.importer)===null||d===void 0)&&d.Importers&&((b=(_=o.getManager())===null||_===void 0?void 0:_.importer)===null||b===void 0||b.Importers.splice(o.getManager().importer.Importers.indexOf(this._importer),1))}}FBXLoadPlugin.PluginType="FBXLoadPlugin";const camera=new three_module.ubm(45,1,.1,1e3);function snapObject(h,o,c,d=7,_=new three_module.Pq0(0,0,1.5)){c=c??h.scene.modelObject;const b=new Box3B().expandByObject(c??o,!0,!0),_e=b.getCenter(new three_module.Pq0),it=b.getSize(new three_module.Pq0);camera.position.copy(_e).add(_.clone().multiplyScalar(Math.max(it.x,it.y,it.z))),camera.lookAt(_e),o&&o.traverseVisible(ut=>{ut.layers.enable(d)}),d>0?camera.layers.set(d):camera.layers.enableAll();const nt=o==null?void 0:o.visible;o&&(o.visible=!0),h.renderer.rendererObject.setRenderTarget(null),h.renderer.rendererObject.render(c,camera);const at=h.renderer.rendererObject.domElement.toDataURL("image/png");return o&&(o.visible=nt,o.traverseVisible(ut=>{ut.layers.disable(d)}),camera.layers.enableAll()),h.setDirty(),at}class MaterialPreviewGenerator{constructor(o){this.viewer=o,this._lights=[],this.shapes={sphere:new three_module.eaF(new three_module.Gu$(1)),cube:new three_module.eaF(new three_module.iNn(1,1,1)),cylinder:new three_module.eaF(new three_module.Ho_(.5,.5,1))};const c=new three_module.Z58;this._channel=7;const d=new three_module.dth(16777215,4473924,1);d.position.set(0,10,0),d.layers.set(this._channel),c.add(d),this._lights.push(d),this._scene=c}dispose(){[...this._lights].forEach(o=>o.dispose()),Object.values(this.shapes).forEach(o=>{o.geometry&&o.geometry.dispose()})}generate(o,c="sphere"){const d=this.shapes[c]||new three_module.eaF(new three_module.Gu$(1));d.material=o.materialObject,d.geometry.attributes.tangent||d.geometry.computeTangents(),this._scene.add(d),this._scene.environment=this.viewer.scene.environment;const _=d.material.envMapIntensity;typeof _=="number"&&(d.material.envMapIntensity=Math.min(_,.5));const b=snapObject(this.viewer,d,this._scene,this._channel,new three_module.Pq0(0,0,1.5));return typeof _=="number"&&(d.material.envMapIntensity=_),this._scene.remove(d),d.material=void 0,b}}var MaterialConfiguratorBasePlugin_decorate=function(h,o,c,d){var _,b=arguments.length,_e=b<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_e=Reflect.decorate(h,o,c,d);else for(var it=h.length-1;it>=0;it--)(_=h[it])&&(_e=(b<3?_(_e):b>3?_(o,c,_e):_(o,c))||_e);return b>3&&_e&&Object.defineProperty(o,c,_e),_e};class MaterialConfiguratorBasePlugin extends AViewerPlugin{constructor(){super(),this.enabled=!0,this._uiNeedRefresh=!1,this.applyOnLoad=!0,this._refreshUiConfig=()=>{var o,c;this.enabled&&((c=(o=this.uiConfig).uiRefresh)===null||c===void 0||c.call(o))},this.dependencies=[AssetManagerPlugin],this.variations=[],this._selectedMaterial=()=>{var o,c;return((c=(o=this._picking)===null||o===void 0?void 0:o.getSelectedObject())===null||c===void 0?void 0:c.material)||void 0},this.uiConfig={label:"Material Configurator",type:"folder",children:[()=>{var o;return[{type:"input",label:"uuid",property:[this._selectedMaterial(),"uuid"],hidden:()=>!this._selectedMaterial(),disabled:!0},{type:"input",label:"mapping",hidden:()=>!this._selectedMaterial(),property:()=>[this.getSelectedVariation(),"uuid"],onChange:async()=>this.refreshUi()},{type:"input",label:"title",hidden:()=>!this._selectedMaterial(),property:()=>[this.getSelectedVariation(),"title"],onChange:async()=>this.refreshUi()},{type:"dropdown",label:"Preview Type",hidden:()=>!this._selectedMaterial(),property:()=>[this.getSelectedVariation(),"preview"],onChange:async()=>this.refreshUi(),children:["generate:sphere","generate:cube","color","map","emissive",...Object.keys(standardMaterialPropList).filter(c=>c.endsWith("Map"))].map(c=>({label:c,value:c}))},...((o=this.getSelectedVariation())===null||o===void 0?void 0:o.materials.map(c=>c.uiConfig?Object.assign(c.uiConfig,{expanded:!1}):{}))||[],{type:"button",label:"Clear variations",hidden:()=>!this._selectedMaterial(),value:async()=>{const c=this.getSelectedVariation();c&&await this._viewer.confirm("Material configurator: Remove all variations for this material?")&&(c.materials=[]),this.refreshUi()}},{type:"button",label:"Remove completely",hidden:()=>!this._selectedMaterial(),value:async()=>{const c=this.getSelectedVariation();c&&await this._viewer.confirm("Material configurator: Remove this variation?")&&this.removeVariation(c)}},{type:"button",label:"Add Variation",hidden:()=>!this._selectedMaterial(),value:async()=>{var c;const d=this._selectedMaterial();d&&(d.name||await((c=this._viewer)===null||c===void 0?void 0:c.confirm("Material configurator: Material has no name. Use uuid instead?")))&&this.addVariation(d)}},{type:"button",label:"Refresh Ui",value:()=>this.refreshUi()},{type:"button",label:"Apply All",value:()=>{this.variations.forEach(async c=>this.applyVariation(c,c.materials[0].uuid))}}]}]},this.addEventListener("deserialize",this.refreshUi),this.refreshUi=this.refreshUi.bind(this),this._refreshUi=this._refreshUi.bind(this)}async onAdded(o){var c,d;await super.onAdded(o),this._picking=(c=this._viewer)===null||c===void 0?void 0:c.getPluginByType("Picking"),this._previewGenerator=new MaterialPreviewGenerator(this._viewer),(d=this._picking)===null||d===void 0||d.addEventListener("selectedObjectChanged",this._refreshUiConfig),o.addEventListener("preFrame",this._refreshUi)}reapplyAll(){this.variations.forEach(async o=>{var c;return this.applyVariation(o,o.materials[(c=o.selectedIndex)!==null&&c!==void 0?c:0].uuid)})}fromJSON(o,c){return this.variations=[],super.fromJSON(o,c)?(o.applyOnLoad===void 0&&(this.applyOnLoad=!1),this.applyOnLoad&&this.reapplyAll(),this):null}async onRemove(o){var c,d;return(c=this._previewGenerator)===null||c===void 0||c.dispose(),this._previewGenerator=void 0,(d=this._picking)===null||d===void 0||d.removeEventListener("selectedObjectChanged",this._refreshUiConfig),this.removeEventListener("deserialize",this.refreshUi),o.removeEventListener("preFrame",this._refreshUi),this._picking=void 0,super.onRemove(o)}findVariation(o){return o?this.variations.find(c=>c.uuid===o):void 0}getSelectedVariation(){var o,c;return this.findVariation((o=this._selectedMaterial())===null||o===void 0?void 0:o.uuid)||this.findVariation((c=this._selectedMaterial())===null||c===void 0?void 0:c.name)}applyVariation(o,c){var d,_;const b=(_=(d=this._viewer)===null||d===void 0?void 0:d.getManager())===null||_===void 0?void 0:_.materials;if(!b)return!1;const _e=typeof c=="string"?o.materials.find(it=>it.uuid===c):o.materials[c];return!!_e&&(o.selectedIndex=o.materials.indexOf(_e),b.applyMaterial(_e,o.uuid))}getPreview(o,c,d=!0){if(!this._viewer)return"";const _=o;if(!_)return"";let b="";if(c.startsWith("generate:"))b=this._previewGenerator.generate(_,c.split(":")[1]);else{const _e=_[c]||"#ff00ff";b=_e.image?Ne$1(_e.image,100):"",b.length||(b=Ge$1(_e.isColor?_e.getHexString():_e))}return d&&this._viewer.setDirty(),b}refreshUi(){this.enabled&&this._viewer&&(this._uiNeedRefresh=!0)}async _refreshUi(){return!(!this.enabled||!this._viewer||!this._uiNeedRefresh||(this._uiNeedRefresh=!1,this._refreshUiConfig(),0))}removeVariationForMaterial(o){let c=this.findVariation(o.uuid);!c&&o.name.length>0&&(c=this.findVariation(o.name)),c&&this.removeVariation(c)}removeVariation(o){o&&(this.variations.splice(this.variations.indexOf(o),1),this.refreshUi())}addVariation(o,c,d=!0){var _;const b=d?(_=o==null?void 0:o.clone)===null||_===void 0?void 0:_.call(o):o;if(o&&b){let _e=this.findVariation(c??o.uuid);!_e&&!c&&o.name.length>0&&(_e=this.findVariation(o.name)),_e||(_e=this.createVariation(o,c)),_e.materials.push(b),this.refreshUi()}}createVariation(o,c){return this.variations.push({uuid:c??o.name.length>0?o.name:o.uuid,title:o.name.length>0?o.name:"No Name",preview:"generate:sphere",materials:[]}),this.variations[this.variations.length-1]}}MaterialConfiguratorBasePlugin.PluginType="MaterialConfiguratorPlugin",MaterialConfiguratorBasePlugin_decorate([serialize()],MaterialConfiguratorBasePlugin.prototype,"variations",void 0);class CustomContextGrid{static _initializeStyles(){P$2($`
  .customContextGrid {
    background: #eeeeee55;
    border: 0.5px solid rgba(220, 220, 220, 0.2);
    width: auto;
    height: auto;
    position: absolute;
    display: flex;
    flex-direction: row;
    flex-wrap: wrap;
    z-index: 200;
    padding: 0.35rem 0.35rem;
    border-radius: 0.375rem;
    min-width: 5rem;
    pointer-events: auto;
    box-shadow: 0px 2px 6px rgba(12, 12, 12, 0.2);

    color: #111111;
    font-size: 0.65rem;
    font-family: Inter, "Roboto Mono", "Source Code Pro", Menlo, Courier, monospace;
    backdrop-filter: blur(20px);
  }
  .customContextGridItems {
    background-color: transparent;
    cursor: pointer;
    border-radius: 0.25rem;
    line-height: 1rem;
    font-weight: 500;
    overflow: hidden;
    margin: 0.12rem;
  }

  .customContextGridItems:hover {
    color: white;
    //background-color: #017AFF;
    box-shadow: 0 0 7px 0px rgba(64, 64, 64, 0.3);
  }
  .customContextGridItemImage{
    width: 100%;
    height: 100%;
  }
  .customContextGridHeading{
    width: 100%;
    padding: 5px;
    font-size: 0.85rem;
  }
  .customContextGridParent{
    position: absolute;
    top: 0;
    left: 0;
    width: 270px;
    height: calc(100% - 100px);
    overflow-y: scroll;
    z-index: 100;
    display: flex;
    flex-direction: column;
    margin-bottom: 50px;
    margin-top: 50px;
  }
  /* Hide scrollbar for Chrome, Safari and Opera */
  .customContextGridParent::-webkit-scrollbar {
    display: none;
  }
  /* Hide scrollbar for IE, Edge and Firefox */
  .customContextGridParent {
    -ms-overflow-style: none;  /* IE and Edge */
    scrollbar-width: none;  /* Firefox */
  }

        `,this._container),this._container.style.position="absolute",this._container.style.top="0",this._container.style.left="0",this._container.style.width="270px",this._container.style.height="100%",this._container.style.pointerEvents="none",this._container.style.zIndex="100",this._container.style.overflowY="auto"}static Create(o,c,d,_,b,_e,it){var nt;const at=we$1(),ut=at?.15:.25,pt=at?1.5:2.5,mt=ee$1({classList:["customContextGrid"],addToBody:!1,innerHTML:`
            <div class="customContextGridHeading"> ${c} </div>
            `});mt.style.top=b+"px",mt.style.left=_+"px",mt.style.gap=ut+"rem",mt.style.width=(pt+ut)*d-ut+"rem",mt.dataset.tag=o;for(const ft of _e){const vt=ee$1({classList:["customContextGridItems"],addToBody:!1,innerHTML:`
            <img src="${ft.image}" class="customContextGridItemImage">
            `});vt.style.width=pt+"rem",vt.style.height=pt+"rem",mt.appendChild(vt),vt.onclick=()=>{var xt;return(xt=ft.onClick)===null||xt===void 0?void 0:xt.call(ft,ft.id)},it(vt,ft,mt)}return(nt=this.Elements)===null||nt===void 0||nt.push(mt),mt}static RemoveAll(o){if(o){const c=this.Elements.filter(d=>d.dataset.tag===o);for(const d of c)d.remove();this.Elements=this.Elements.filter(d=>d.dataset.tag!==o)}else{for(const c of this.Elements)c.remove();this.Elements=[]}}static RebuildUi(o){if(this.Elements.length===0)return;o||(o=ee$1({addToBody:!0,classList:["customContextGridParent"]}));for(const d of this.Elements)d.remove();this._container.innerHTML="",this._initializeStyles();let c=20;o.appendChild(this._container);for(const d of this.Elements)d.style.top=c+"px",this._container.appendChild(d),c+=d.clientHeight+20}}function getWindow(h){if(h==null)return window;if(h.toString()!=="[object Window]"){var o=h.ownerDocument;return o&&o.defaultView||window}return h}function isElement(h){return h instanceof getWindow(h).Element||h instanceof Element}function isHTMLElement(h){return h instanceof getWindow(h).HTMLElement||h instanceof HTMLElement}function isShadowRoot(h){return typeof ShadowRoot<"u"&&(h instanceof getWindow(h).ShadowRoot||h instanceof ShadowRoot)}CustomContextGrid.Elements=[],CustomContextGrid._container=document.createElement("div");var math_max=Math.max,math_min=Math.min,round=Math.round;function getUAString(){var h=navigator.userAgentData;return h!=null&&h.brands&&Array.isArray(h.brands)?h.brands.map(function(o){return o.brand+"/"+o.version}).join(" "):navigator.userAgent}function isLayoutViewport(){return!/^((?!chrome|android).)*safari/i.test(getUAString())}function getBoundingClientRect(h,o,c){o===void 0&&(o=!1),c===void 0&&(c=!1);var d=h.getBoundingClientRect(),_=1,b=1;o&&isHTMLElement(h)&&(_=h.offsetWidth>0&&round(d.width)/h.offsetWidth||1,b=h.offsetHeight>0&&round(d.height)/h.offsetHeight||1);var _e=(isElement(h)?getWindow(h):window).visualViewport,it=!isLayoutViewport()&&c,nt=(d.left+(it&&_e?_e.offsetLeft:0))/_,at=(d.top+(it&&_e?_e.offsetTop:0))/b,ut=d.width/_,pt=d.height/b;return{width:ut,height:pt,top:at,right:nt+ut,bottom:at+pt,left:nt,x:nt,y:at}}function getWindowScroll(h){var o=getWindow(h);return{scrollLeft:o.pageXOffset,scrollTop:o.pageYOffset}}function getHTMLElementScroll(h){return{scrollLeft:h.scrollLeft,scrollTop:h.scrollTop}}function getNodeScroll(h){return h!==getWindow(h)&&isHTMLElement(h)?getHTMLElementScroll(h):getWindowScroll(h)}function getNodeName(h){return h?(h.nodeName||"").toLowerCase():null}function getDocumentElement(h){return((isElement(h)?h.ownerDocument:h.document)||window.document).documentElement}function getWindowScrollBarX(h){return getBoundingClientRect(getDocumentElement(h)).left+getWindowScroll(h).scrollLeft}function getComputedStyle$1(h){return getWindow(h).getComputedStyle(h)}function isScrollParent(h){var o=getComputedStyle$1(h),c=o.overflow,d=o.overflowX,_=o.overflowY;return/auto|scroll|overlay|hidden/.test(c+_+d)}function isElementScaled(h){var o=h.getBoundingClientRect(),c=round(o.width)/h.offsetWidth||1,d=round(o.height)/h.offsetHeight||1;return c!==1||d!==1}function getCompositeRect(h,o,c){c===void 0&&(c=!1);var d=isHTMLElement(o),_=isHTMLElement(o)&&isElementScaled(o),b=getDocumentElement(o),_e=getBoundingClientRect(h,_,c),it={scrollLeft:0,scrollTop:0},nt={x:0,y:0};return(d||!d&&!c)&&((getNodeName(o)!=="body"||isScrollParent(b))&&(it=getNodeScroll(o)),isHTMLElement(o)?((nt=getBoundingClientRect(o,!0)).x+=o.clientLeft,nt.y+=o.clientTop):b&&(nt.x=getWindowScrollBarX(b))),{x:_e.left+it.scrollLeft-nt.x,y:_e.top+it.scrollTop-nt.y,width:_e.width,height:_e.height}}function getLayoutRect(h){var o=getBoundingClientRect(h),c=h.offsetWidth,d=h.offsetHeight;return Math.abs(o.width-c)<=1&&(c=o.width),Math.abs(o.height-d)<=1&&(d=o.height),{x:h.offsetLeft,y:h.offsetTop,width:c,height:d}}function getParentNode(h){return getNodeName(h)==="html"?h:h.assignedSlot||h.parentNode||(isShadowRoot(h)?h.host:null)||getDocumentElement(h)}function getScrollParent(h){return["html","body","#document"].indexOf(getNodeName(h))>=0?h.ownerDocument.body:isHTMLElement(h)&&isScrollParent(h)?h:getScrollParent(getParentNode(h))}function listScrollParents(h,o){var c;o===void 0&&(o=[]);var d=getScrollParent(h),_=d===((c=h.ownerDocument)==null?void 0:c.body),b=getWindow(d),_e=_?[b].concat(b.visualViewport||[],isScrollParent(d)?d:[]):d,it=o.concat(_e);return _?it:it.concat(listScrollParents(getParentNode(_e)))}function isTableElement(h){return["table","td","th"].indexOf(getNodeName(h))>=0}function getTrueOffsetParent(h){return isHTMLElement(h)&&getComputedStyle$1(h).position!=="fixed"?h.offsetParent:null}function getContainingBlock(h){var o=/firefox/i.test(getUAString());if(/Trident/i.test(getUAString())&&isHTMLElement(h)&&getComputedStyle$1(h).position==="fixed")return null;var c=getParentNode(h);for(isShadowRoot(c)&&(c=c.host);isHTMLElement(c)&&["html","body"].indexOf(getNodeName(c))<0;){var d=getComputedStyle$1(c);if(d.transform!=="none"||d.perspective!=="none"||d.contain==="paint"||["transform","perspective"].indexOf(d.willChange)!==-1||o&&d.willChange==="filter"||o&&d.filter&&d.filter!=="none")return c;c=c.parentNode}return null}function getOffsetParent(h){for(var o=getWindow(h),c=getTrueOffsetParent(h);c&&isTableElement(c)&&getComputedStyle$1(c).position==="static";)c=getTrueOffsetParent(c);return c&&(getNodeName(c)==="html"||getNodeName(c)==="body"&&getComputedStyle$1(c).position==="static")?o:c||getContainingBlock(h)||o}var enums_top="top",bottom="bottom",right="right",left="left",auto$1="auto",basePlacements=[enums_top,bottom,right,left],start="start",end="end",clippingParents="clippingParents",viewport="viewport",popper="popper",reference="reference",variationPlacements=basePlacements.reduce(function(h,o){return h.concat([o+"-"+start,o+"-"+end])},[]),enums_placements=[].concat(basePlacements,[auto$1]).reduce(function(h,o){return h.concat([o,o+"-"+start,o+"-"+end])},[]),beforeRead="beforeRead",enums_read="read",afterRead="afterRead",beforeMain="beforeMain",main$1="main",afterMain="afterMain",beforeWrite="beforeWrite",write="write",afterWrite="afterWrite",modifierPhases=[beforeRead,enums_read,afterRead,beforeMain,main$1,afterMain,beforeWrite,write,afterWrite];function order(h){var o=new Map,c=new Set,d=[];function _(b){c.add(b.name),[].concat(b.requires||[],b.requiresIfExists||[]).forEach(function(_e){if(!c.has(_e)){var it=o.get(_e);it&&_(it)}}),d.push(b)}return h.forEach(function(b){o.set(b.name,b)}),h.forEach(function(b){c.has(b.name)||_(b)}),d}function orderModifiers(h){var o=order(h);return modifierPhases.reduce(function(c,d){return c.concat(o.filter(function(_){return _.phase===d}))},[])}function debounce(h){var o;return function(){return o||(o=new Promise(function(c){Promise.resolve().then(function(){o=void 0,c(h())})})),o}}function mergeByName(h){var o=h.reduce(function(c,d){var _=c[d.name];return c[d.name]=_?Object.assign({},_,d,{options:Object.assign({},_.options,d.options),data:Object.assign({},_.data,d.data)}):d,c},{});return Object.keys(o).map(function(c){return o[c]})}var DEFAULT_OPTIONS={placement:"bottom",modifiers:[],strategy:"absolute"};function areValidElements(){for(var h=arguments.length,o=new Array(h),c=0;c<h;c++)o[c]=arguments[c];return!o.some(function(d){return!(d&&typeof d.getBoundingClientRect=="function")})}function popperGenerator(h){h===void 0&&(h={});var o=h,c=o.defaultModifiers,d=c===void 0?[]:c,_=o.defaultOptions,b=_===void 0?DEFAULT_OPTIONS:_;return function(_e,it,nt){nt===void 0&&(nt=b);var at={placement:"bottom",orderedModifiers:[],options:Object.assign({},DEFAULT_OPTIONS,b),modifiersData:{},elements:{reference:_e,popper:it},attributes:{},styles:{}},ut=[],pt=!1,mt={state:at,setOptions:function(vt){var xt=typeof vt=="function"?vt(at.options):vt;ft(),at.options=Object.assign({},b,at.options,xt),at.scrollParents={reference:isElement(_e)?listScrollParents(_e):_e.contextElement?listScrollParents(_e.contextElement):[],popper:listScrollParents(it)};var At=orderModifiers(mergeByName([].concat(d,at.options.modifiers)));return at.orderedModifiers=At.filter(function(Ct){return Ct.enabled}),at.orderedModifiers.forEach(function(Ct){var Et=Ct.name,Tt=Ct.options,kt=Tt===void 0?{}:Tt,Dt=Ct.effect;if(typeof Dt=="function"){var zt=Dt({state:at,name:Et,instance:mt,options:kt});ut.push(zt||function(){})}}),mt.update()},forceUpdate:function(){if(!pt){var vt=at.elements,xt=vt.reference,At=vt.popper;if(areValidElements(xt,At)){at.rects={reference:getCompositeRect(xt,getOffsetParent(At),at.options.strategy==="fixed"),popper:getLayoutRect(At)},at.reset=!1,at.placement=at.options.placement,at.orderedModifiers.forEach(function(Bt){return at.modifiersData[Bt.name]=Object.assign({},Bt.data)});for(var Ct=0;Ct<at.orderedModifiers.length;Ct++)if(at.reset!==!0){var Et=at.orderedModifiers[Ct],Tt=Et.fn,kt=Et.options,Dt=kt===void 0?{}:kt,zt=Et.name;typeof Tt=="function"&&(at=Tt({state:at,options:Dt,name:zt,instance:mt})||at)}else at.reset=!1,Ct=-1}}},update:debounce(function(){return new Promise(function(vt){mt.forceUpdate(),vt(at)})}),destroy:function(){ft(),pt=!0}};if(!areValidElements(_e,it))return mt;function ft(){ut.forEach(function(vt){return vt()}),ut=[]}return mt.setOptions(nt).then(function(vt){!pt&&nt.onFirstUpdate&&nt.onFirstUpdate(vt)}),mt}}var createPopper=popperGenerator(),passive={passive:!0};function effect(h){var o=h.state,c=h.instance,d=h.options,_=d.scroll,b=_===void 0||_,_e=d.resize,it=_e===void 0||_e,nt=getWindow(o.elements.popper),at=[].concat(o.scrollParents.reference,o.scrollParents.popper);return b&&at.forEach(function(ut){ut.addEventListener("scroll",c.update,passive)}),it&&nt.addEventListener("resize",c.update,passive),function(){b&&at.forEach(function(ut){ut.removeEventListener("scroll",c.update,passive)}),it&&nt.removeEventListener("resize",c.update,passive)}}var eventListeners={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect,data:{}};function getBasePlacement(h){return h.split("-")[0]}function getVariation(h){return h.split("-")[1]}function getMainAxisFromPlacement(h){return["top","bottom"].indexOf(h)>=0?"x":"y"}function computeOffsets(h){var o,c=h.reference,d=h.element,_=h.placement,b=_?getBasePlacement(_):null,_e=_?getVariation(_):null,it=c.x+c.width/2-d.width/2,nt=c.y+c.height/2-d.height/2;switch(b){case enums_top:o={x:it,y:c.y-d.height};break;case bottom:o={x:it,y:c.y+c.height};break;case right:o={x:c.x+c.width,y:nt};break;case left:o={x:c.x-d.width,y:nt};break;default:o={x:c.x,y:c.y}}var at=b?getMainAxisFromPlacement(b):null;if(at!=null){var ut=at==="y"?"height":"width";switch(_e){case start:o[at]=o[at]-(c[ut]/2-d[ut]/2);break;case end:o[at]=o[at]+(c[ut]/2-d[ut]/2)}}return o}function popperOffsets(h){var o=h.state,c=h.name;o.modifiersData[c]=computeOffsets({reference:o.rects.reference,element:o.rects.popper,strategy:"absolute",placement:o.placement})}var modifiers_popperOffsets={name:"popperOffsets",enabled:!0,phase:"read",fn:popperOffsets,data:{}},unsetSides={top:"auto",right:"auto",bottom:"auto",left:"auto"};function roundOffsetsByDPR(h,o){var c=h.x,d=h.y,_=o.devicePixelRatio||1;return{x:round(c*_)/_||0,y:round(d*_)/_||0}}function mapToStyles(h){var o,c=h.popper,d=h.popperRect,_=h.placement,b=h.variation,_e=h.offsets,it=h.position,nt=h.gpuAcceleration,at=h.adaptive,ut=h.roundOffsets,pt=h.isFixed,mt=_e.x,ft=mt===void 0?0:mt,vt=_e.y,xt=vt===void 0?0:vt,At=typeof ut=="function"?ut({x:ft,y:xt}):{x:ft,y:xt};ft=At.x,xt=At.y;var Ct=_e.hasOwnProperty("x"),Et=_e.hasOwnProperty("y"),Tt=left,kt=enums_top,Dt=window;if(at){var zt=getOffsetParent(c),Bt="clientHeight",Rt="clientWidth";zt===getWindow(c)&&getComputedStyle$1(zt=getDocumentElement(c)).position!=="static"&&it==="absolute"&&(Bt="scrollHeight",Rt="scrollWidth"),(_===enums_top||(_===left||_===right)&&b===end)&&(kt=bottom,xt-=(pt&&zt===Dt&&Dt.visualViewport?Dt.visualViewport.height:zt[Bt])-d.height,xt*=nt?1:-1),_!==left&&(_!==enums_top&&_!==bottom||b!==end)||(Tt=right,ft-=(pt&&zt===Dt&&Dt.visualViewport?Dt.visualViewport.width:zt[Rt])-d.width,ft*=nt?1:-1)}var Ut,Ht=Object.assign({position:it},at&&unsetSides),Jt=ut===!0?roundOffsetsByDPR({x:ft,y:xt},getWindow(c)):{x:ft,y:xt};return ft=Jt.x,xt=Jt.y,nt?Object.assign({},Ht,((Ut={})[kt]=Et?"0":"",Ut[Tt]=Ct?"0":"",Ut.transform=(Dt.devicePixelRatio||1)<=1?"translate("+ft+"px, "+xt+"px)":"translate3d("+ft+"px, "+xt+"px, 0)",Ut)):Object.assign({},Ht,((o={})[kt]=Et?xt+"px":"",o[Tt]=Ct?ft+"px":"",o.transform="",o))}function computeStyles(h){var o=h.state,c=h.options,d=c.gpuAcceleration,_=d===void 0||d,b=c.adaptive,_e=b===void 0||b,it=c.roundOffsets,nt=it===void 0||it,at={placement:getBasePlacement(o.placement),variation:getVariation(o.placement),popper:o.elements.popper,popperRect:o.rects.popper,gpuAcceleration:_,isFixed:o.options.strategy==="fixed"};o.modifiersData.popperOffsets!=null&&(o.styles.popper=Object.assign({},o.styles.popper,mapToStyles(Object.assign({},at,{offsets:o.modifiersData.popperOffsets,position:o.options.strategy,adaptive:_e,roundOffsets:nt})))),o.modifiersData.arrow!=null&&(o.styles.arrow=Object.assign({},o.styles.arrow,mapToStyles(Object.assign({},at,{offsets:o.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:nt})))),o.attributes.popper=Object.assign({},o.attributes.popper,{"data-popper-placement":o.placement})}var modifiers_computeStyles={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:computeStyles,data:{}};function applyStyles(h){var o=h.state;Object.keys(o.elements).forEach(function(c){var d=o.styles[c]||{},_=o.attributes[c]||{},b=o.elements[c];isHTMLElement(b)&&getNodeName(b)&&(Object.assign(b.style,d),Object.keys(_).forEach(function(_e){var it=_[_e];it===!1?b.removeAttribute(_e):b.setAttribute(_e,it===!0?"":it)}))})}function applyStyles_effect(h){var o=h.state,c={popper:{position:o.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(o.elements.popper.style,c.popper),o.styles=c,o.elements.arrow&&Object.assign(o.elements.arrow.style,c.arrow),function(){Object.keys(o.elements).forEach(function(d){var _=o.elements[d],b=o.attributes[d]||{},_e=Object.keys(o.styles.hasOwnProperty(d)?o.styles[d]:c[d]).reduce(function(it,nt){return it[nt]="",it},{});isHTMLElement(_)&&getNodeName(_)&&(Object.assign(_.style,_e),Object.keys(b).forEach(function(it){_.removeAttribute(it)}))})}}var modifiers_applyStyles={name:"applyStyles",enabled:!0,phase:"write",fn:applyStyles,effect:applyStyles_effect,requires:["computeStyles"]};function distanceAndSkiddingToXY(h,o,c){var d=getBasePlacement(h),_=[left,enums_top].indexOf(d)>=0?-1:1,b=typeof c=="function"?c(Object.assign({},o,{placement:h})):c,_e=b[0],it=b[1];return _e=_e||0,it=(it||0)*_,[left,right].indexOf(d)>=0?{x:it,y:_e}:{x:_e,y:it}}function offset(h){var o=h.state,c=h.options,d=h.name,_=c.offset,b=_===void 0?[0,0]:_,_e=enums_placements.reduce(function(ut,pt){return ut[pt]=distanceAndSkiddingToXY(pt,o.rects,b),ut},{}),it=_e[o.placement],nt=it.x,at=it.y;o.modifiersData.popperOffsets!=null&&(o.modifiersData.popperOffsets.x+=nt,o.modifiersData.popperOffsets.y+=at),o.modifiersData[d]=_e}var modifiers_offset={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:offset},getOppositePlacement_hash={left:"right",right:"left",bottom:"top",top:"bottom"};function getOppositePlacement(h){return h.replace(/left|right|bottom|top/g,function(o){return getOppositePlacement_hash[o]})}var getOppositeVariationPlacement_hash={start:"end",end:"start"};function getOppositeVariationPlacement(h){return h.replace(/start|end/g,function(o){return getOppositeVariationPlacement_hash[o]})}function getViewportRect(h,o){var c=getWindow(h),d=getDocumentElement(h),_=c.visualViewport,b=d.clientWidth,_e=d.clientHeight,it=0,nt=0;if(_){b=_.width,_e=_.height;var at=isLayoutViewport();(at||!at&&o==="fixed")&&(it=_.offsetLeft,nt=_.offsetTop)}return{width:b,height:_e,x:it+getWindowScrollBarX(h),y:nt}}function getDocumentRect(h){var o,c=getDocumentElement(h),d=getWindowScroll(h),_=(o=h.ownerDocument)==null?void 0:o.body,b=math_max(c.scrollWidth,c.clientWidth,_?_.scrollWidth:0,_?_.clientWidth:0),_e=math_max(c.scrollHeight,c.clientHeight,_?_.scrollHeight:0,_?_.clientHeight:0),it=-d.scrollLeft+getWindowScrollBarX(h),nt=-d.scrollTop;return getComputedStyle$1(_||c).direction==="rtl"&&(it+=math_max(c.clientWidth,_?_.clientWidth:0)-b),{width:b,height:_e,x:it,y:nt}}function contains(h,o){var c=o.getRootNode&&o.getRootNode();if(h.contains(o))return!0;if(c&&isShadowRoot(c)){var d=o;do{if(d&&h.isSameNode(d))return!0;d=d.parentNode||d.host}while(d)}return!1}function rectToClientRect(h){return Object.assign({},h,{left:h.x,top:h.y,right:h.x+h.width,bottom:h.y+h.height})}function getInnerBoundingClientRect(h,o){var c=getBoundingClientRect(h,!1,o==="fixed");return c.top=c.top+h.clientTop,c.left=c.left+h.clientLeft,c.bottom=c.top+h.clientHeight,c.right=c.left+h.clientWidth,c.width=h.clientWidth,c.height=h.clientHeight,c.x=c.left,c.y=c.top,c}function getClientRectFromMixedType(h,o,c){return o===viewport?rectToClientRect(getViewportRect(h,c)):isElement(o)?getInnerBoundingClientRect(o,c):rectToClientRect(getDocumentRect(getDocumentElement(h)))}function getClippingParents(h){var o=listScrollParents(getParentNode(h)),c=["absolute","fixed"].indexOf(getComputedStyle$1(h).position)>=0&&isHTMLElement(h)?getOffsetParent(h):h;return isElement(c)?o.filter(function(d){return isElement(d)&&contains(d,c)&&getNodeName(d)!=="body"}):[]}function getClippingRect(h,o,c,d){var _=o==="clippingParents"?getClippingParents(h):[].concat(o),b=[].concat(_,[c]),_e=b[0],it=b.reduce(function(nt,at){var ut=getClientRectFromMixedType(h,at,d);return nt.top=math_max(ut.top,nt.top),nt.right=math_min(ut.right,nt.right),nt.bottom=math_min(ut.bottom,nt.bottom),nt.left=math_max(ut.left,nt.left),nt},getClientRectFromMixedType(h,_e,d));return it.width=it.right-it.left,it.height=it.bottom-it.top,it.x=it.left,it.y=it.top,it}function getFreshSideObject(){return{top:0,right:0,bottom:0,left:0}}function mergePaddingObject(h){return Object.assign({},getFreshSideObject(),h)}function expandToHashMap(h,o){return o.reduce(function(c,d){return c[d]=h,c},{})}function detectOverflow(h,o){o===void 0&&(o={});var c=o,d=c.placement,_=d===void 0?h.placement:d,b=c.strategy,_e=b===void 0?h.strategy:b,it=c.boundary,nt=it===void 0?clippingParents:it,at=c.rootBoundary,ut=at===void 0?viewport:at,pt=c.elementContext,mt=pt===void 0?popper:pt,ft=c.altBoundary,vt=ft!==void 0&&ft,xt=c.padding,At=xt===void 0?0:xt,Ct=mergePaddingObject(typeof At!="number"?At:expandToHashMap(At,basePlacements)),Et=mt===popper?reference:popper,Tt=h.rects.popper,kt=h.elements[vt?Et:mt],Dt=getClippingRect(isElement(kt)?kt:kt.contextElement||getDocumentElement(h.elements.popper),nt,ut,_e),zt=getBoundingClientRect(h.elements.reference),Bt=computeOffsets({reference:zt,element:Tt,strategy:"absolute",placement:_}),Rt=rectToClientRect(Object.assign({},Tt,Bt)),Ut=mt===popper?Rt:zt,Ht={top:Dt.top-Ut.top+Ct.top,bottom:Ut.bottom-Dt.bottom+Ct.bottom,left:Dt.left-Ut.left+Ct.left,right:Ut.right-Dt.right+Ct.right},Jt=h.modifiersData.offset;if(mt===popper&&Jt){var Kt=Jt[_];Object.keys(Ht).forEach(function(sr){var ir=[right,bottom].indexOf(sr)>=0?1:-1,cr=[enums_top,bottom].indexOf(sr)>=0?"y":"x";Ht[sr]+=Kt[cr]*ir})}return Ht}function computeAutoPlacement(h,o){o===void 0&&(o={});var c=o,d=c.placement,_=c.boundary,b=c.rootBoundary,_e=c.padding,it=c.flipVariations,nt=c.allowedAutoPlacements,at=nt===void 0?enums_placements:nt,ut=getVariation(d),pt=ut?it?variationPlacements:variationPlacements.filter(function(vt){return getVariation(vt)===ut}):basePlacements,mt=pt.filter(function(vt){return at.indexOf(vt)>=0});mt.length===0&&(mt=pt);var ft=mt.reduce(function(vt,xt){return vt[xt]=detectOverflow(h,{placement:xt,boundary:_,rootBoundary:b,padding:_e})[getBasePlacement(xt)],vt},{});return Object.keys(ft).sort(function(vt,xt){return ft[vt]-ft[xt]})}function getExpandedFallbackPlacements(h){if(getBasePlacement(h)===auto$1)return[];var o=getOppositePlacement(h);return[getOppositeVariationPlacement(h),o,getOppositeVariationPlacement(o)]}function flip(h){var o=h.state,c=h.options,d=h.name;if(!o.modifiersData[d]._skip){for(var _=c.mainAxis,b=_===void 0||_,_e=c.altAxis,it=_e===void 0||_e,nt=c.fallbackPlacements,at=c.padding,ut=c.boundary,pt=c.rootBoundary,mt=c.altBoundary,ft=c.flipVariations,vt=ft===void 0||ft,xt=c.allowedAutoPlacements,At=o.options.placement,Ct=getBasePlacement(At),Et=nt||(Ct!==At&&vt?getExpandedFallbackPlacements(At):[getOppositePlacement(At)]),Tt=[At].concat(Et).reduce(function(xr,vr){return xr.concat(getBasePlacement(vr)===auto$1?computeAutoPlacement(o,{placement:vr,boundary:ut,rootBoundary:pt,padding:at,flipVariations:vt,allowedAutoPlacements:xt}):vr)},[]),kt=o.rects.reference,Dt=o.rects.popper,zt=new Map,Bt=!0,Rt=Tt[0],Ut=0;Ut<Tt.length;Ut++){var Ht=Tt[Ut],Jt=getBasePlacement(Ht),Kt=getVariation(Ht)===start,sr=[enums_top,bottom].indexOf(Jt)>=0,ir=sr?"width":"height",cr=detectOverflow(o,{placement:Ht,boundary:ut,rootBoundary:pt,altBoundary:mt,padding:at}),lr=sr?Kt?right:left:Kt?bottom:enums_top;kt[ir]>Dt[ir]&&(lr=getOppositePlacement(lr));var hr=getOppositePlacement(lr),dr=[];if(b&&dr.push(cr[Jt]<=0),it&&dr.push(cr[lr]<=0,cr[hr]<=0),dr.every(function(xr){return xr})){Rt=Ht,Bt=!1;break}zt.set(Ht,dr)}if(Bt)for(var pr=function(xr){var vr=Tt.find(function(Dr){var _r=zt.get(Dr);if(_r)return _r.slice(0,xr).every(function(rr){return rr})});if(vr)return Rt=vr,"break"},ur=vt?3:1;ur>0&&pr(ur)!=="break";ur--);o.placement!==Rt&&(o.modifiersData[d]._skip=!0,o.placement=Rt,o.reset=!0)}}var modifiers_flip={name:"flip",enabled:!0,phase:"main",fn:flip,requiresIfExists:["offset"],data:{_skip:!1}};function getAltAxis(h){return h==="x"?"y":"x"}function within(h,o,c){return math_max(h,math_min(o,c))}function withinMaxClamp(h,o,c){var d=within(h,o,c);return d>c?c:d}function preventOverflow(h){var o=h.state,c=h.options,d=h.name,_=c.mainAxis,b=_===void 0||_,_e=c.altAxis,it=_e!==void 0&&_e,nt=c.boundary,at=c.rootBoundary,ut=c.altBoundary,pt=c.padding,mt=c.tether,ft=mt===void 0||mt,vt=c.tetherOffset,xt=vt===void 0?0:vt,At=detectOverflow(o,{boundary:nt,rootBoundary:at,padding:pt,altBoundary:ut}),Ct=getBasePlacement(o.placement),Et=getVariation(o.placement),Tt=!Et,kt=getMainAxisFromPlacement(Ct),Dt=getAltAxis(kt),zt=o.modifiersData.popperOffsets,Bt=o.rects.reference,Rt=o.rects.popper,Ut=typeof xt=="function"?xt(Object.assign({},o.rects,{placement:o.placement})):xt,Ht=typeof Ut=="number"?{mainAxis:Ut,altAxis:Ut}:Object.assign({mainAxis:0,altAxis:0},Ut),Jt=o.modifiersData.offset?o.modifiersData.offset[o.placement]:null,Kt={x:0,y:0};if(zt){if(b){var sr,ir=kt==="y"?enums_top:left,cr=kt==="y"?bottom:right,lr=kt==="y"?"height":"width",hr=zt[kt],dr=hr+At[ir],pr=hr-At[cr],ur=ft?-Rt[lr]/2:0,xr=Et===start?Bt[lr]:Rt[lr],vr=Et===start?-Rt[lr]:-Bt[lr],Dr=o.elements.arrow,_r=ft&&Dr?getLayoutRect(Dr):{width:0,height:0},rr=o.modifiersData["arrow#persistent"]?o.modifiersData["arrow#persistent"].padding:getFreshSideObject(),mr=rr[ir],Rr=rr[cr],Yr=within(0,Bt[lr],_r[lr]),Zr=Tt?Bt[lr]/2-ur-Yr-mr-Ht.mainAxis:xr-Yr-mr-Ht.mainAxis,cn=Tt?-Bt[lr]/2+ur+Yr+Rr+Ht.mainAxis:vr+Yr+Rr+Ht.mainAxis,Tn=o.elements.arrow&&getOffsetParent(o.elements.arrow),yn=Tn?kt==="y"?Tn.clientTop||0:Tn.clientLeft||0:0,zn=(sr=Jt==null?void 0:Jt[kt])!=null?sr:0,gs=hr+cn-zn,or=within(ft?math_min(dr,hr+Zr-zn-yn):dr,hr,ft?math_max(pr,gs):pr);zt[kt]=or,Kt[kt]=or-hr}if(it){var yr,Pr=kt==="x"?enums_top:left,jr=kt==="x"?bottom:right,Tr=zt[Dt],Br=Dt==="y"?"height":"width",Gr=Tr+At[Pr],tn=Tr-At[jr],nn=[enums_top,left].indexOf(Ct)!==-1,gn=(yr=Jt==null?void 0:Jt[Dt])!=null?yr:0,xn=nn?Gr:Tr-Bt[Br]-Rt[Br]-gn+Ht.altAxis,Mn=nn?Tr+Bt[Br]+Rt[Br]-gn-Ht.altAxis:tn,An=ft&&nn?withinMaxClamp(xn,Tr,Mn):within(ft?xn:Gr,Tr,ft?Mn:tn);zt[Dt]=An,Kt[Dt]=An-Tr}o.modifiersData[d]=Kt}}var modifiers_preventOverflow={name:"preventOverflow",enabled:!0,phase:"main",fn:preventOverflow,requiresIfExists:["offset"]},toPaddingObject=function(h,o){return mergePaddingObject(typeof(h=typeof h=="function"?h(Object.assign({},o.rects,{placement:o.placement})):h)!="number"?h:expandToHashMap(h,basePlacements))};function arrow(h){var o,c=h.state,d=h.name,_=h.options,b=c.elements.arrow,_e=c.modifiersData.popperOffsets,it=getBasePlacement(c.placement),nt=getMainAxisFromPlacement(it),at=[left,right].indexOf(it)>=0?"height":"width";if(b&&_e){var ut=toPaddingObject(_.padding,c),pt=getLayoutRect(b),mt=nt==="y"?enums_top:left,ft=nt==="y"?bottom:right,vt=c.rects.reference[at]+c.rects.reference[nt]-_e[nt]-c.rects.popper[at],xt=_e[nt]-c.rects.reference[nt],At=getOffsetParent(b),Ct=At?nt==="y"?At.clientHeight||0:At.clientWidth||0:0,Et=vt/2-xt/2,Tt=ut[mt],kt=Ct-pt[at]-ut[ft],Dt=Ct/2-pt[at]/2+Et,zt=within(Tt,Dt,kt),Bt=nt;c.modifiersData[d]=((o={})[Bt]=zt,o.centerOffset=zt-Dt,o)}}function arrow_effect(h){var o=h.state,c=h.options.element,d=c===void 0?"[data-popper-arrow]":c;d!=null&&(typeof d!="string"||(d=o.elements.popper.querySelector(d)))&&contains(o.elements.popper,d)&&(o.elements.arrow=d)}var modifiers_arrow={name:"arrow",enabled:!0,phase:"main",fn:arrow,effect:arrow_effect,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function getSideOffsets(h,o,c){return c===void 0&&(c={x:0,y:0}),{top:h.top-o.height-c.y,right:h.right-o.width+c.x,bottom:h.bottom-o.height+c.y,left:h.left-o.width-c.x}}function isAnySideFullyClipped(h){return[enums_top,right,bottom,left].some(function(o){return h[o]>=0})}function hide(h){var o=h.state,c=h.name,d=o.rects.reference,_=o.rects.popper,b=o.modifiersData.preventOverflow,_e=detectOverflow(o,{elementContext:"reference"}),it=detectOverflow(o,{altBoundary:!0}),nt=getSideOffsets(_e,d),at=getSideOffsets(it,_,b),ut=isAnySideFullyClipped(nt),pt=isAnySideFullyClipped(at);o.modifiersData[c]={referenceClippingOffsets:nt,popperEscapeOffsets:at,isReferenceHidden:ut,hasPopperEscaped:pt},o.attributes.popper=Object.assign({},o.attributes.popper,{"data-popper-reference-hidden":ut,"data-popper-escaped":pt})}var modifiers_hide={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:hide},defaultModifiers=[eventListeners,modifiers_popperOffsets,modifiers_computeStyles,modifiers_applyStyles,modifiers_offset,modifiers_flip,modifiers_preventOverflow,modifiers_arrow,modifiers_hide],popper_createPopper=popperGenerator({defaultModifiers}),BOX_CLASS="tippy-box",CONTENT_CLASS="tippy-content",BACKDROP_CLASS="tippy-backdrop",ARROW_CLASS="tippy-arrow",SVG_ARROW_CLASS="tippy-svg-arrow",TOUCH_OPTIONS={passive:!0,capture:!0},TIPPY_DEFAULT_APPEND_TO=function(){return document.body};function getValueAtIndexOrReturn(h,o,c){if(Array.isArray(h)){var d=h[o];return d??(Array.isArray(c)?c[o]:c)}return h}function isType(h,o){var c={}.toString.call(h);return c.indexOf("[object")===0&&c.indexOf(o+"]")>-1}function invokeWithArgsOrReturn(h,o){return typeof h=="function"?h.apply(void 0,o):h}function tippy_esm_debounce(h,o){return o===0?h:function(d){clearTimeout(c),c=setTimeout(function(){h(d)},o)};var c}function removeProperties(h,o){var c=Object.assign({},h);return o.forEach(function(d){delete c[d]}),c}function splitBySpaces(h){return h.split(/\s+/).filter(Boolean)}function normalizeToArray(h){return[].concat(h)}function pushIfUnique(h,o){h.indexOf(o)===-1&&h.push(o)}function unique(h){return h.filter(function(o,c){return h.indexOf(o)===c})}function tippy_esm_getBasePlacement(h){return h.split("-")[0]}function arrayFrom(h){return[].slice.call(h)}function removeUndefinedProps(h){return Object.keys(h).reduce(function(o,c){return h[c]!==void 0&&(o[c]=h[c]),o},{})}function div(){return document.createElement("div")}function tippy_esm_isElement(h){return["Element","Fragment"].some(function(o){return isType(h,o)})}function isNodeList(h){return isType(h,"NodeList")}function isMouseEvent(h){return isType(h,"MouseEvent")}function isReferenceElement(h){return!(!h||!h._tippy||h._tippy.reference!==h)}function getArrayOfElements(h){return tippy_esm_isElement(h)?[h]:isNodeList(h)?arrayFrom(h):Array.isArray(h)?h:arrayFrom(document.querySelectorAll(h))}function setTransitionDuration(h,o){h.forEach(function(c){c&&(c.style.transitionDuration=o+"ms")})}function setVisibilityState(h,o){h.forEach(function(c){c&&c.setAttribute("data-state",o)})}function getOwnerDocument(h){var o,c=normalizeToArray(h)[0];return c!=null&&(o=c.ownerDocument)!=null&&o.body?c.ownerDocument:document}function isCursorOutsideInteractiveBorder(h,o){var c=o.clientX,d=o.clientY;return h.every(function(_){var b=_.popperRect,_e=_.popperState,it=_.props.interactiveBorder,nt=tippy_esm_getBasePlacement(_e.placement),at=_e.modifiersData.offset;if(!at)return!0;var ut=nt==="bottom"?at.top.y:0,pt=nt==="top"?at.bottom.y:0,mt=nt==="right"?at.left.x:0,ft=nt==="left"?at.right.x:0,vt=b.top-d+ut>it,xt=d-b.bottom-pt>it,At=b.left-c+mt>it,Ct=c-b.right-ft>it;return vt||xt||At||Ct})}function updateTransitionEndListener(h,o,c){var d=o+"EventListener";["transitionend","webkitTransitionEnd"].forEach(function(_){h[d](_,c)})}function actualContains(h,o){for(var c=o;c;){var d;if(h.contains(c))return!0;c=c.getRootNode==null||(d=c.getRootNode())==null?void 0:d.host}return!1}var currentInput={isTouch:!1},lastMouseMoveTime=0;function onDocumentTouchStart(){currentInput.isTouch||(currentInput.isTouch=!0,window.performance&&document.addEventListener("mousemove",onDocumentMouseMove))}function onDocumentMouseMove(){var h=performance.now();h-lastMouseMoveTime<20&&(currentInput.isTouch=!1,document.removeEventListener("mousemove",onDocumentMouseMove)),lastMouseMoveTime=h}function onWindowBlur(){var h=document.activeElement;if(isReferenceElement(h)){var o=h._tippy;h.blur&&!o.state.isVisible&&h.blur()}}function bindGlobalEventListeners(){document.addEventListener("touchstart",onDocumentTouchStart,TOUCH_OPTIONS),window.addEventListener("blur",onWindowBlur)}var isBrowser$1=typeof window<"u"&&typeof document<"u",isIE11=!!isBrowser$1&&!!window.msCrypto,pluginProps={animateFill:!1,followCursor:!1,inlinePositioning:!1,sticky:!1},renderProps={allowHTML:!1,animation:"fade",arrow:!0,content:"",inertia:!1,maxWidth:350,role:"tooltip",theme:"",zIndex:9999},defaultProps$1=Object.assign({appendTo:TIPPY_DEFAULT_APPEND_TO,aria:{content:"auto",expanded:"auto"},delay:0,duration:[300,250],getReferenceClientRect:null,hideOnClick:!0,ignoreAttributes:!1,interactive:!1,interactiveBorder:2,interactiveDebounce:0,moveTransition:"",offset:[0,10],onAfterUpdate:function(){},onBeforeUpdate:function(){},onCreate:function(){},onDestroy:function(){},onHidden:function(){},onHide:function(){},onMount:function(){},onShow:function(){},onShown:function(){},onTrigger:function(){},onUntrigger:function(){},onClickOutside:function(){},placement:"top",plugins:[],popperOptions:{},render:null,showOnCreate:!1,touch:!0,trigger:"mouseenter focus",triggerTarget:null},pluginProps,renderProps),defaultKeys=Object.keys(defaultProps$1),setDefaultProps=function(h){Object.keys(h).forEach(function(o){defaultProps$1[o]=h[o]})};function getExtendedPassedProps(h){var o=(h.plugins||[]).reduce(function(c,d){var _,b=d.name,_e=d.defaultValue;return b&&(c[b]=h[b]!==void 0?h[b]:(_=defaultProps$1[b])!=null?_:_e),c},{});return Object.assign({},h,o)}function getDataAttributeProps(h,o){return(o?Object.keys(getExtendedPassedProps(Object.assign({},defaultProps$1,{plugins:o}))):defaultKeys).reduce(function(c,d){var _=(h.getAttribute("data-tippy-"+d)||"").trim();if(!_)return c;if(d==="content")c[d]=_;else try{c[d]=JSON.parse(_)}catch{c[d]=_}return c},{})}function evaluateProps(h,o){var c=Object.assign({},o,{content:invokeWithArgsOrReturn(o.content,[h])},o.ignoreAttributes?{}:getDataAttributeProps(h,o.plugins));return c.aria=Object.assign({},defaultProps$1.aria,c.aria),c.aria={expanded:c.aria.expanded==="auto"?o.interactive:c.aria.expanded,content:c.aria.content==="auto"?o.interactive?null:"describedby":c.aria.content},c}var innerHTML=function(){return"innerHTML"};function dangerouslySetInnerHTML(h,o){h[innerHTML()]=o}function createArrowElement(h){var o=div();return h===!0?o.className=ARROW_CLASS:(o.className=SVG_ARROW_CLASS,tippy_esm_isElement(h)?o.appendChild(h):dangerouslySetInnerHTML(o,h)),o}function setContent(h,o){tippy_esm_isElement(o.content)?(dangerouslySetInnerHTML(h,""),h.appendChild(o.content)):typeof o.content!="function"&&(o.allowHTML?dangerouslySetInnerHTML(h,o.content):h.textContent=o.content)}function getChildren(h){var o=h.firstElementChild,c=arrayFrom(o.children);return{box:o,content:c.find(function(d){return d.classList.contains(CONTENT_CLASS)}),arrow:c.find(function(d){return d.classList.contains(ARROW_CLASS)||d.classList.contains(SVG_ARROW_CLASS)}),backdrop:c.find(function(d){return d.classList.contains(BACKDROP_CLASS)})}}function render(h){var o=div(),c=div();c.className=BOX_CLASS,c.setAttribute("data-state","hidden"),c.setAttribute("tabindex","-1");var d=div();function _(b,_e){var it=getChildren(o),nt=it.box,at=it.content,ut=it.arrow;_e.theme?nt.setAttribute("data-theme",_e.theme):nt.removeAttribute("data-theme"),typeof _e.animation=="string"?nt.setAttribute("data-animation",_e.animation):nt.removeAttribute("data-animation"),_e.inertia?nt.setAttribute("data-inertia",""):nt.removeAttribute("data-inertia"),nt.style.maxWidth=typeof _e.maxWidth=="number"?_e.maxWidth+"px":_e.maxWidth,_e.role?nt.setAttribute("role",_e.role):nt.removeAttribute("role"),b.content===_e.content&&b.allowHTML===_e.allowHTML||setContent(at,h.props),_e.arrow?ut?b.arrow!==_e.arrow&&(nt.removeChild(ut),nt.appendChild(createArrowElement(_e.arrow))):nt.appendChild(createArrowElement(_e.arrow)):ut&&nt.removeChild(ut)}return d.className=CONTENT_CLASS,d.setAttribute("data-state","hidden"),setContent(d,h.props),o.appendChild(c),c.appendChild(d),_(h.props,h.props),{popper:o,onUpdate:_}}render.$$tippy=!0;var idCounter=1,mouseMoveListeners=[],mountedInstances=[];function createTippy(h,o){var c,d,_,b,_e,it,nt,at=evaluateProps(h,Object.assign({},defaultProps$1,getExtendedPassedProps(removeUndefinedProps(o)))),ut=!1,pt=!1,mt=!1,ft=!1,vt=[],xt=tippy_esm_debounce(cn,at.interactiveDebounce),At=idCounter++,Ct=unique(at.plugins),Et={id:At,reference:h,popper:div(),popperInstance:null,props:at,state:{isEnabled:!0,isVisible:!1,isDestroyed:!1,isMounted:!1,isShown:!1},plugins:Ct,clearDelayTimeouts:function(){clearTimeout(c),clearTimeout(d),cancelAnimationFrame(_)},setProps:function(Tr){if(!Et.state.isDestroyed){lr("onBeforeUpdate",[Et,Tr]),Yr();var Br=Et.props,Gr=evaluateProps(h,Object.assign({},Br,removeUndefinedProps(Tr),{ignoreAttributes:!0}));Et.props=Gr,Rr(),Br.interactiveDebounce!==Gr.interactiveDebounce&&(pr(),xt=tippy_esm_debounce(cn,Gr.interactiveDebounce)),Br.triggerTarget&&!Gr.triggerTarget?normalizeToArray(Br.triggerTarget).forEach(function(tn){tn.removeAttribute("aria-expanded")}):Gr.triggerTarget&&h.removeAttribute("aria-expanded"),dr(),cr(),Dt&&Dt(Br,Gr),Et.popperInstance&&(gs(),yr().forEach(function(tn){requestAnimationFrame(tn._tippy.popperInstance.forceUpdate)})),lr("onAfterUpdate",[Et,Tr])}},setContent:function(Tr){Et.setProps({content:Tr})},show:function(){var Tr=Et.state.isVisible,Br=Et.state.isDestroyed,Gr=!Et.state.isEnabled,tn=currentInput.isTouch&&!Et.props.touch,nn=getValueAtIndexOrReturn(Et.props.duration,0,defaultProps$1.duration);if(!(Tr||Br||Gr||tn||Jt().hasAttribute("disabled")||(lr("onShow",[Et],!1),Et.props.onShow(Et)===!1))){if(Et.state.isVisible=!0,Ht()&&(kt.style.visibility="visible"),cr(),Dr(),Et.state.isMounted||(kt.style.transition="none"),Ht()){var gn=sr();setTransitionDuration([gn.box,gn.content],0)}var xn,Mn,An;it=function(){var vn;if(Et.state.isVisible&&!ft){if(ft=!0,kt.offsetHeight,kt.style.transition=Et.props.moveTransition,Ht()&&Et.props.animation){var Cn=sr(),rn=Cn.box,En=Cn.content;setTransitionDuration([rn,En],nn),setVisibilityState([rn,En],"visible")}hr(),dr(),pushIfUnique(mountedInstances,Et),(vn=Et.popperInstance)==null||vn.forceUpdate(),lr("onMount",[Et]),Et.props.animation&&Ht()&&function(Hn){rr(Hn,function(){Et.state.isShown=!0,lr("onShown",[Et])})}(nn)}},Mn=Et.props.appendTo,An=Jt(),(xn=Et.props.interactive&&Mn===TIPPY_DEFAULT_APPEND_TO||Mn==="parent"?An.parentNode:invokeWithArgsOrReturn(Mn,[An])).contains(kt)||xn.appendChild(kt),Et.state.isMounted=!0,gs()}},hide:function(){var Tr=!Et.state.isVisible,Br=Et.state.isDestroyed,Gr=!Et.state.isEnabled,tn=getValueAtIndexOrReturn(Et.props.duration,1,defaultProps$1.duration);if(!(Tr||Br||Gr)&&(lr("onHide",[Et],!1),Et.props.onHide(Et)!==!1)){if(Et.state.isVisible=!1,Et.state.isShown=!1,ft=!1,ut=!1,Ht()&&(kt.style.visibility="hidden"),pr(),_r(),cr(!0),Ht()){var nn=sr(),gn=nn.box,xn=nn.content;Et.props.animation&&(setTransitionDuration([gn,xn],tn),setVisibilityState([gn,xn],"hidden"))}hr(),dr(),Et.props.animation?Ht()&&function(Mn,An){rr(Mn,function(){!Et.state.isVisible&&kt.parentNode&&kt.parentNode.contains(kt)&&An()})}(tn,Et.unmount):Et.unmount()}},hideWithInteractivity:function(Tr){Kt().addEventListener("mousemove",xt),pushIfUnique(mouseMoveListeners,xt),xt(Tr)},enable:function(){Et.state.isEnabled=!0},disable:function(){Et.hide(),Et.state.isEnabled=!1},unmount:function(){Et.state.isVisible&&Et.hide(),Et.state.isMounted&&(or(),yr().forEach(function(Tr){Tr._tippy.unmount()}),kt.parentNode&&kt.parentNode.removeChild(kt),mountedInstances=mountedInstances.filter(function(Tr){return Tr!==Et}),Et.state.isMounted=!1,lr("onHidden",[Et]))},destroy:function(){Et.state.isDestroyed||(Et.clearDelayTimeouts(),Et.unmount(),Yr(),delete h._tippy,Et.state.isDestroyed=!0,lr("onDestroy",[Et]))}};if(!at.render)return Et;var Tt=at.render(Et),kt=Tt.popper,Dt=Tt.onUpdate;kt.setAttribute("data-tippy-root",""),kt.id="tippy-"+Et.id,Et.popper=kt,h._tippy=Et,kt._tippy=Et;var zt=Ct.map(function(Tr){return Tr.fn(Et)}),Bt=h.hasAttribute("aria-expanded");return Rr(),dr(),cr(),lr("onCreate",[Et]),at.showOnCreate&&Pr(),kt.addEventListener("mouseenter",function(){Et.props.interactive&&Et.state.isVisible&&Et.clearDelayTimeouts()}),kt.addEventListener("mouseleave",function(){Et.props.interactive&&Et.props.trigger.indexOf("mouseenter")>=0&&Kt().addEventListener("mousemove",xt)}),Et;function Rt(){var Tr=Et.props.touch;return Array.isArray(Tr)?Tr:[Tr,0]}function Ut(){return Rt()[0]==="hold"}function Ht(){var Tr;return!((Tr=Et.props.render)==null||!Tr.$$tippy)}function Jt(){return nt||h}function Kt(){var Tr=Jt().parentNode;return Tr?getOwnerDocument(Tr):document}function sr(){return getChildren(kt)}function ir(Tr){return Et.state.isMounted&&!Et.state.isVisible||currentInput.isTouch||b&&b.type==="focus"?0:getValueAtIndexOrReturn(Et.props.delay,Tr?0:1,defaultProps$1.delay)}function cr(Tr){Tr===void 0&&(Tr=!1),kt.style.pointerEvents=Et.props.interactive&&!Tr?"":"none",kt.style.zIndex=""+Et.props.zIndex}function lr(Tr,Br,Gr){var tn;Gr===void 0&&(Gr=!0),zt.forEach(function(nn){nn[Tr]&&nn[Tr].apply(nn,Br)}),Gr&&(tn=Et.props)[Tr].apply(tn,Br)}function hr(){var Tr=Et.props.aria;if(Tr.content){var Br="aria-"+Tr.content,Gr=kt.id;normalizeToArray(Et.props.triggerTarget||h).forEach(function(tn){var nn=tn.getAttribute(Br);if(Et.state.isVisible)tn.setAttribute(Br,nn?nn+" "+Gr:Gr);else{var gn=nn&&nn.replace(Gr,"").trim();gn?tn.setAttribute(Br,gn):tn.removeAttribute(Br)}})}}function dr(){!Bt&&Et.props.aria.expanded&&normalizeToArray(Et.props.triggerTarget||h).forEach(function(Tr){Et.props.interactive?Tr.setAttribute("aria-expanded",Et.state.isVisible&&Tr===Jt()?"true":"false"):Tr.removeAttribute("aria-expanded")})}function pr(){Kt().removeEventListener("mousemove",xt),mouseMoveListeners=mouseMoveListeners.filter(function(Tr){return Tr!==xt})}function ur(Tr){if(!currentInput.isTouch||!mt&&Tr.type!=="mousedown"){var Br=Tr.composedPath&&Tr.composedPath()[0]||Tr.target;if(!Et.props.interactive||!actualContains(kt,Br)){if(normalizeToArray(Et.props.triggerTarget||h).some(function(Gr){return actualContains(Gr,Br)})){if(currentInput.isTouch||Et.state.isVisible&&Et.props.trigger.indexOf("click")>=0)return}else lr("onClickOutside",[Et,Tr]);Et.props.hideOnClick===!0&&(Et.clearDelayTimeouts(),Et.hide(),pt=!0,setTimeout(function(){pt=!1}),Et.state.isMounted||_r())}}}function xr(){mt=!0}function vr(){mt=!1}function Dr(){var Tr=Kt();Tr.addEventListener("mousedown",ur,!0),Tr.addEventListener("touchend",ur,TOUCH_OPTIONS),Tr.addEventListener("touchstart",vr,TOUCH_OPTIONS),Tr.addEventListener("touchmove",xr,TOUCH_OPTIONS)}function _r(){var Tr=Kt();Tr.removeEventListener("mousedown",ur,!0),Tr.removeEventListener("touchend",ur,TOUCH_OPTIONS),Tr.removeEventListener("touchstart",vr,TOUCH_OPTIONS),Tr.removeEventListener("touchmove",xr,TOUCH_OPTIONS)}function rr(Tr,Br){var Gr=sr().box;function tn(nn){nn.target===Gr&&(updateTransitionEndListener(Gr,"remove",tn),Br())}if(Tr===0)return Br();updateTransitionEndListener(Gr,"remove",_e),updateTransitionEndListener(Gr,"add",tn),_e=tn}function mr(Tr,Br,Gr){Gr===void 0&&(Gr=!1),normalizeToArray(Et.props.triggerTarget||h).forEach(function(tn){tn.addEventListener(Tr,Br,Gr),vt.push({node:tn,eventType:Tr,handler:Br,options:Gr})})}function Rr(){Ut()&&(mr("touchstart",Zr,{passive:!0}),mr("touchend",Tn,{passive:!0})),splitBySpaces(Et.props.trigger).forEach(function(Tr){if(Tr!=="manual")switch(mr(Tr,Zr),Tr){case"mouseenter":mr("mouseleave",Tn);break;case"focus":mr(isIE11?"focusout":"blur",yn);break;case"focusin":mr("focusout",yn)}})}function Yr(){vt.forEach(function(Tr){var Br=Tr.node,Gr=Tr.eventType,tn=Tr.handler,nn=Tr.options;Br.removeEventListener(Gr,tn,nn)}),vt=[]}function Zr(Tr){var Br,Gr=!1;if(Et.state.isEnabled&&!zn(Tr)&&!pt){var tn=((Br=b)==null?void 0:Br.type)==="focus";b=Tr,nt=Tr.currentTarget,dr(),!Et.state.isVisible&&isMouseEvent(Tr)&&mouseMoveListeners.forEach(function(nn){return nn(Tr)}),Tr.type==="click"&&(Et.props.trigger.indexOf("mouseenter")<0||ut)&&Et.props.hideOnClick!==!1&&Et.state.isVisible?Gr=!0:Pr(Tr),Tr.type==="click"&&(ut=!Gr),Gr&&!tn&&jr(Tr)}}function cn(Tr){var Br=Tr.target,Gr=Jt().contains(Br)||kt.contains(Br);if(Tr.type!=="mousemove"||!Gr){var tn=yr().concat(kt).map(function(nn){var gn,xn=(gn=nn._tippy.popperInstance)==null?void 0:gn.state;return xn?{popperRect:nn.getBoundingClientRect(),popperState:xn,props:at}:null}).filter(Boolean);isCursorOutsideInteractiveBorder(tn,Tr)&&(pr(),jr(Tr))}}function Tn(Tr){zn(Tr)||Et.props.trigger.indexOf("click")>=0&&ut||(Et.props.interactive?Et.hideWithInteractivity(Tr):jr(Tr))}function yn(Tr){Et.props.trigger.indexOf("focusin")<0&&Tr.target!==Jt()||Et.props.interactive&&Tr.relatedTarget&&kt.contains(Tr.relatedTarget)||jr(Tr)}function zn(Tr){return!!currentInput.isTouch&&Ut()!==Tr.type.indexOf("touch")>=0}function gs(){or();var Tr=Et.props,Br=Tr.popperOptions,Gr=Tr.placement,tn=Tr.offset,nn=Tr.getReferenceClientRect,gn=Tr.moveTransition,xn=Ht()?getChildren(kt).arrow:null,Mn=nn?{getBoundingClientRect:nn,contextElement:nn.contextElement||Jt()}:h,An=[{name:"offset",options:{offset:tn}},{name:"preventOverflow",options:{padding:{top:2,bottom:2,left:5,right:5}}},{name:"flip",options:{padding:5}},{name:"computeStyles",options:{adaptive:!gn}},{name:"$$tippy",enabled:!0,phase:"beforeWrite",requires:["computeStyles"],fn:function(vn){var Cn=vn.state;if(Ht()){var rn=sr().box;["placement","reference-hidden","escaped"].forEach(function(En){En==="placement"?rn.setAttribute("data-placement",Cn.placement):Cn.attributes.popper["data-popper-"+En]?rn.setAttribute("data-"+En,""):rn.removeAttribute("data-"+En)}),Cn.attributes.popper={}}}}];Ht()&&xn&&An.push({name:"arrow",options:{element:xn,padding:3}}),An.push.apply(An,(Br==null?void 0:Br.modifiers)||[]),Et.popperInstance=popper_createPopper(Mn,kt,Object.assign({},Br,{placement:Gr,onFirstUpdate:it,modifiers:An}))}function or(){Et.popperInstance&&(Et.popperInstance.destroy(),Et.popperInstance=null)}function yr(){return arrayFrom(kt.querySelectorAll("[data-tippy-root]"))}function Pr(Tr){Et.clearDelayTimeouts(),Tr&&lr("onTrigger",[Et,Tr]),Dr();var Br=ir(!0),Gr=Rt(),tn=Gr[0],nn=Gr[1];currentInput.isTouch&&tn==="hold"&&nn&&(Br=nn),Br?c=setTimeout(function(){Et.show()},Br):Et.show()}function jr(Tr){if(Et.clearDelayTimeouts(),lr("onUntrigger",[Et,Tr]),Et.state.isVisible){if(!(Et.props.trigger.indexOf("mouseenter")>=0&&Et.props.trigger.indexOf("click")>=0&&["mouseleave","mousemove"].indexOf(Tr.type)>=0&&ut)){var Br=ir(!1);Br?d=setTimeout(function(){Et.state.isVisible&&Et.hide()},Br):_=requestAnimationFrame(function(){Et.hide()})}}else _r()}}function tippy(h,o){o===void 0&&(o={});var c=defaultProps$1.plugins.concat(o.plugins||[]);bindGlobalEventListeners();var d=Object.assign({},o,{plugins:c}),_=getArrayOfElements(h).reduce(function(b,_e){var it=_e&&createTippy(_e,d);return it&&b.push(it),b},[]);return tippy_esm_isElement(h)?_[0]:_}tippy.defaultProps=defaultProps$1,tippy.setDefaultProps=setDefaultProps,tippy.currentInput=currentInput;var applyStylesModifier=Object.assign({},modifiers_applyStyles,{effect:function(h){var o=h.state,c={popper:{position:o.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};Object.assign(o.elements.popper.style,c.popper),o.styles=c,o.elements.arrow&&Object.assign(o.elements.arrow.style,c.arrow)}}),createSingleton=function(h,o){var c;o===void 0&&(o={});var d,_=h,b=[],_e=[],it=o.overrides,nt=[],at=!1;function ut(){_e=_.map(function(Tt){return normalizeToArray(Tt.props.triggerTarget||Tt.reference)}).reduce(function(Tt,kt){return Tt.concat(kt)},[])}function pt(){b=_.map(function(Tt){return Tt.reference})}function mt(Tt){_.forEach(function(kt){Tt?kt.enable():kt.disable()})}function ft(Tt){return _.map(function(kt){var Dt=kt.setProps;return kt.setProps=function(zt){Dt(zt),kt.reference===d&&Tt.setProps(zt)},function(){kt.setProps=Dt}})}function vt(Tt,kt){var Dt=_e.indexOf(kt);if(kt!==d){d=kt;var zt=(it||[]).concat("content").reduce(function(Bt,Rt){return Bt[Rt]=_[Dt].props[Rt],Bt},{});Tt.setProps(Object.assign({},zt,{getReferenceClientRect:typeof zt.getReferenceClientRect=="function"?zt.getReferenceClientRect:function(){var Bt;return(Bt=b[Dt])==null?void 0:Bt.getBoundingClientRect()}}))}}mt(!1),pt(),ut();var xt={fn:function(){return{onDestroy:function(){mt(!0)},onHidden:function(){d=null},onClickOutside:function(Tt){Tt.props.showOnCreate&&!at&&(at=!0,d=null)},onShow:function(Tt){Tt.props.showOnCreate&&!at&&(at=!0,vt(Tt,b[0]))},onTrigger:function(Tt,kt){vt(Tt,kt.currentTarget)}}}},At=tippy(div(),Object.assign({},removeProperties(o,["overrides"]),{plugins:[xt].concat(o.plugins||[]),triggerTarget:_e,popperOptions:Object.assign({},o.popperOptions,{modifiers:[].concat(((c=o.popperOptions)==null?void 0:c.modifiers)||[],[applyStylesModifier])})})),Ct=At.show;At.show=function(Tt){if(Ct(),!d&&Tt==null)return vt(At,b[0]);if(!d||Tt!=null){if(typeof Tt=="number")return b[Tt]&&vt(At,b[Tt]);if(_.indexOf(Tt)>=0){var kt=Tt.reference;return vt(At,kt)}return b.indexOf(Tt)>=0?vt(At,Tt):void 0}},At.showNext=function(){var Tt=b[0];if(!d)return At.show(0);var kt=b.indexOf(d);At.show(b[kt+1]||Tt)},At.showPrevious=function(){var Tt=b[b.length-1];if(!d)return At.show(Tt);var kt=b.indexOf(d),Dt=b[kt-1]||Tt;At.show(Dt)};var Et=At.setProps;return At.setProps=function(Tt){it=Tt.overrides||it,Et(Tt)},At.setInstances=function(Tt){mt(!0),nt.forEach(function(kt){return kt()}),_=Tt,mt(!1),pt(),ut(),nt=ft(At),At.setProps({triggerTarget:_e})},nt=ft(At),At};tippy.setDefaultProps({render});var tippy_esm=tippy;class CustomContextMenu{static _initialize(){this._inited=!0,P$2($`
          #customContextMenu {
            background: #2c2c2e99;
            backdrop-filter: blur(8px);
            border: 0.5px solid rgba(20, 20, 20, 0.3);
            width: auto;
            height: auto;
            position: absolute;
            display: flex;
            flex-direction: column;
            z-index: 9999;
            padding: 0.35rem 0.20rem;
            border-radius: 0.375rem;
            min-width: 6rem;
            pointer-events: auto;
            box-shadow: 0px 2px 10px rgba(12, 12, 12, 0.2);
          }

          .customContextMenuItems {
            color: white;
            font-size: 0.65rem;
            font-family: "Roboto Mono", "Source Code Pro", Menlo, Courier, monospace;
            background-color: transparent;
            cursor: pointer;
            padding: 0.12rem 0.35rem;
            border-radius: 0.25rem;
            line-height: 1rem;
            font-weight: 500;
          }

          .customContextMenuItems:hover {
            color: white;
            background-color: #017AFF;
          }
        `),document.addEventListener("mouseup",o=>{this.Element&&!this.Element.contains(o.target)&&o.button===0&&this.Remove()})}static Create(o,c,d){this._inited||this._initialize(),this.Element&&this.Remove();const _=ee$1({id:"customContextMenu",addToBody:!1});_.style.top=d+"px",_.style.left=c+"px";for(const[b,_e]of Object.entries(o)){const it=ee$1({classList:["customContextMenuItems"],addToBody:!1,innerHTML:b});_.appendChild(it),it.onclick=_e}return this.Element=_,_}static Remove(){var o;(o=this.Element)===null||o===void 0||o.remove(),this.Element=void 0}}CustomContextMenu.Element=void 0,CustomContextMenu._inited=!1;class MaterialConfiguratorPlugin extends MaterialConfiguratorBasePlugin{constructor(){super(...arguments),this.enableEditContextMenus=!1}async _refreshUi(){var o;if(!await super._refreshUi())return!1;CustomContextGrid.RemoveAll(MaterialConfiguratorPlugin.PluginType);for(const c of this.variations)CustomContextGrid.Create(MaterialConfiguratorPlugin.PluginType,c.title+(this.enableEditContextMenus?" ("+c.uuid+")":""),5,20,0,c.materials.map(d=>{let _;if(c.preview.startsWith("generate:"))_=this._previewGenerator.generate(d,c.preview.split(":")[1]);else{const b=d[c.preview]||"#ff00ff";_=b.image?Ne$1(b.image,100):void 0,_||(_=Ge$1(b!=null&&b.isColor?b.getHexString():b))}return{id:d.uuid,image:_,onClick:b=>this.applyVariation(c,b),tooltip:d.name||d.uuid}}),(d,_,b)=>{tippy_esm(d,{placement:"bottom",content:_.tooltip}),d.oncontextmenu=_e=>{if(!this.enableEditContextMenus)return;_e.preventDefault(),_e.stopPropagation();const it=CustomContextMenu.Create({Remove:async()=>{var nt;await((nt=this._viewer)===null||nt===void 0?void 0:nt.confirm("Remove material: Remove material from this variation list?"))&&(c.materials=c.materials.filter(at=>at.uuid!==_.id),this.refreshUi(),CustomContextMenu.Remove())},"Remove All":async()=>{var nt;await((nt=this._viewer)===null||nt===void 0?void 0:nt.confirm("Remove all: Remove all materials from this variation list?"))&&(c.materials=[],this.refreshUi(),CustomContextMenu.Remove())}},_e.clientX,_e.clientY);document.body.appendChild(it)},b.oncontextmenu=_e=>{if(!this.enableEditContextMenus)return;_e.preventDefault(),_e.stopPropagation();const it=CustomContextMenu.Create({"Rename mapping":async()=>{var nt;const at=await((nt=this._viewer)===null||nt===void 0?void 0:nt.prompt("Change name: New material name to map to",c.uuid,!0));at&&(c.uuid=at,this.refreshUi())},"Rename title":async()=>{var nt;const at=await((nt=this._viewer)===null||nt===void 0?void 0:nt.prompt("Change name: New material name to map to",c.title,!0));at&&(c.title=at,this.refreshUi())},"Remove Section":async()=>{var nt;await((nt=this._viewer)===null||nt===void 0?void 0:nt.confirm("Remove variations: Remove this category of variations?"))&&(this.removeVariation(c),CustomContextMenu.Remove())}},_e.clientX,_e.clientY);document.body.appendChild(it)}});return CustomContextGrid.RebuildUi((o=this._viewer)===null||o===void 0?void 0:o.container),!0}}MaterialConfiguratorPlugin.PluginType="MaterialConfiguratorPlugin";var SwitchNodeBasePlugin_decorate=function(h,o,c,d){var _,b=arguments.length,_e=b<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_e=Reflect.decorate(h,o,c,d);else for(var it=h.length-1;it>=0;it--)(_=h[it])&&(_e=(b<3?_(_e):b>3?_(o,c,_e):_(o,c))||_e);return b>3&&_e&&Object.defineProperty(o,c,_e),_e};class SwitchNodeBasePlugin extends AViewerPlugin{constructor(){super(),this.enabled=!0,this._uiNeedRefresh=!1,this._isVisibleChanged=!1,this._postFrame=()=>{this._uiNeedRefresh&&this._refreshUi()},this._preRender=()=>{if(this._viewer&&this.enabled){for(const o of this.variations){if(!o.name)continue;const c=this._viewer.scene.getObjectByName(o.name);if(!c||c.children.length<1)return;o.selected||(o.selected=c.children[0].name||c.children[0].uuid);for(const d of c.children)d.userData.__oldVisible=d.visible,d.visible=(d.name||d.uuid)===o.selected}this._isVisibleChanged=!0}},this._postRender=()=>{if(this._viewer&&this._isVisibleChanged){for(const o of this.variations){if(!o.name)continue;const c=this._viewer.scene.getObjectByName(o.name);if(!c||c.children.length<1)return;for(const d of c.children){if(d.userData.__oldVisible===void 0)return;d.visible=d.userData.__oldVisible,delete d.userData.__oldVisible}}this._isVisibleChanged=!1}},this.autoSnapIcons=!1,this.dependencies=[AssetManagerPlugin],this.variations=[],this._selectedSwitchNode=()=>{var o;const c=(o=this._picking)===null||o===void 0?void 0:o.getSelectedObject();if(!c)return;const d=this.variations.map(b=>b.name);let _;return c.traverseAncestors(b=>{_||b.name&&d.includes(b.name)&&(_=b)}),_},this.uiConfig={label:"Switch Node",type:"folder",children:[{type:"checkbox",label:"Enabled",property:[this,"enabled"]},()=>[{type:"folder",label:"All nodes",expanded:!0,children:[this.variations.map(o=>({type:"input",label:o.title,property:[o,"name"],onChange:()=>this.refreshUi()}))]},{type:"button",label:"Add Node",value:()=>{this.variations.push({name:"switch_node",selected:"",title:"Switch Node",camView:"front",camDistance:1}),this.refreshUi()}},{type:"button",label:"Refresh UI",value:()=>this.refreshUi()},{type:"input",label:"Selected node title",hidden:()=>!this._selectedSwitchNode(),property:()=>{const o=this._selectedSwitchNode();return o?[this.variations.find(c=>c.name===o.name),"title"]:[]},onChange:()=>this.refreshUi()},{type:"slider",bounds:[.01,2],stepSize:.01,label:"Cam Distance",hidden:()=>!this._selectedSwitchNode(),property:()=>{const o=this._selectedSwitchNode();return o?[this.variations.find(c=>c.name===o.name),"camDistance"]:[]}},{type:"dropdown",label:"Cam View",hidden:()=>!this._selectedSwitchNode(),property:()=>{const o=this._selectedSwitchNode();return o?[this.variations.find(c=>c.name===o.name),"camView"]:[]},onChange:()=>this.refreshUi(),children:["top","bottom","front","back","left","right"].map(o=>({label:o,value:o}))}]]},this.refreshUi=this.refreshUi.bind(this),this._refreshUi=this._refreshUi.bind(this)}async onAdded(o){var c,d;await super.onAdded(o),this._picking=(c=this._viewer)===null||c===void 0?void 0:c.getPluginByType("Picking"),(d=this._picking)===null||d===void 0||d.addEventListener("selectedObjectChanged",this._refreshUi),o.addEventListener("postFrame",this._postFrame),o.addEventListener("preRender",this._preRender),o.addEventListener("postRender",this._postRender),this.addEventListener("deserialize",this.refreshUi)}async onRemove(o){var c;return(c=this._picking)===null||c===void 0||c.removeEventListener("selectedObjectChanged",this._refreshUi),o.removeEventListener("postFrame",this._postFrame),o.removeEventListener("preRender",this._preRender),o.removeEventListener("postRender",this._postRender),this._picking=void 0,super.onRemove(o)}refreshUi(){this.enabled&&(this._uiNeedRefresh=!0)}_refreshUi(){var o,c;return!!this.enabled&&!!this._viewer&&(this._uiNeedRefresh=!1,(c=(o=this.uiConfig).uiRefresh)===null||c===void 0||c.call(o),this.autoSnapIcons&&this.snapIcons(),!0)}snapIcons(){for(const o of this.variations){const c=this._viewer.scene.getObjectByName(o.name);if(c){c.children.length<1&&console.warn("SwitchNode does not have enough children",o);for(const d of c.children){if(d.userData.__icon)return;const _=o.camView,b=new three_module.Pq0((_.includes("right")?1:0)-(_.includes("left")?1:0),(_.includes("top")?1:0)-(_.includes("bottom")?1:0),(_.includes("front")?1:0)-(_.includes("back")?1:0));o.camDistance||(o.camDistance=1);const _e=snapObject(this._viewer,d,void 0,7,b.multiplyScalar(.5*o.camDistance));d.userData.__icon=_e}}else console.warn("no object found for variation, skipping",o)}}}SwitchNodeBasePlugin_decorate([serialize()],SwitchNodeBasePlugin.prototype,"variations",void 0);class SwitchNodePlugin extends SwitchNodeBasePlugin{_refreshUi(){var o;if(!super._refreshUi())return!1;CustomContextGrid.RemoveAll(SwitchNodePlugin.PluginType);for(const c of this.variations){const d=this._viewer.scene.getObjectByName(c.name);d?(d.children.length<1&&console.warn("SwitchNode does not have enough children",c),CustomContextGrid.Create(SwitchNodePlugin.PluginType,c.title,Math.min(5,d.children.length),20,0,d.children.map(_=>{const b=c.camView,_e=new three_module.Pq0((b.includes("right")?1:0)-(b.includes("left")?1:0),(b.includes("top")?1:0)-(b.includes("bottom")?1:0),(b.includes("front")?1:0)-(b.includes("back")?1:0));c.camDistance||(c.camDistance=1);const it=snapObject(this._viewer,_,void 0,7,_e.multiplyScalar(.5*c.camDistance));return{id:_.uuid,image:it,onClick:()=>{var nt;c.selected=_.name||_.uuid,(nt=this._viewer)===null||nt===void 0||nt.scene.setDirty({sceneUpdate:!0,frameFade:!0})},tooltip:_.name||_.uuid}}),(_,b)=>tippy_esm(_,{placement:"bottom",content:b.tooltip}))):console.warn("no object found for variation, skipping",c)}return CustomContextGrid.RebuildUi((o=this._viewer)===null||o===void 0?void 0:o.container),!0}}SwitchNodePlugin.PluginType="SwitchNodePlugin";var MaterialLibraryBasePlugin_decorate=function(h,o,c,d){var _,b=arguments.length,_e=b<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_e=Reflect.decorate(h,o,c,d);else for(var it=h.length-1;it>=0;it--)(_=h[it])&&(_e=(b<3?_(_e):b>3?_(o,c,_e):_(o,c))||_e);return b>3&&_e&&Object.defineProperty(o,c,_e),_e};class MaterialLibraryBasePlugin extends AViewerPlugin{constructor(){super(...arguments),this.enabled=!0,this._uiNeedRefresh=!1,this._refreshUiConfig=()=>{var o,c;this.enabled&&((c=(o=this.uiConfig)===null||o===void 0?void 0:o.uiRefresh)===null||c===void 0||c.call(o,"postFrame",!0))},this.dependencies=[AssetManagerPlugin],this._selectedObject=()=>{var o;return((o=this._picking)===null||o===void 0?void 0:o.getSelectedObject())||void 0},this._selectedMaterial=()=>{var o;return((o=this._selectedObject())===null||o===void 0?void 0:o.material)||void 0}}async onAdded(o){var c,d;await super.onAdded(o),this.refreshUi=this.refreshUi.bind(this),this._refreshUi=this._refreshUi.bind(this),this._picking=(c=this._viewer)===null||c===void 0?void 0:c.getPluginByType("Picking"),this._previewGenerator=new MaterialPreviewGenerator(this._viewer),(d=this._picking)===null||d===void 0||d.addEventListener("selectedObjectChanged",this._refreshUiConfig),o.addEventListener("preFrame",this._refreshUi),this.addEventListener("deserialize",this.refreshUi)}async onRemove(o){var c,d;return(c=this._previewGenerator)===null||c===void 0||c.dispose(),this._previewGenerator=void 0,(d=this._picking)===null||d===void 0||d.removeEventListener("selectedObjectChanged",this._refreshUiConfig),this.removeEventListener("deserialize",this.refreshUi),o.removeEventListener("preFrame",this._refreshUi),this._picking=void 0,super.onRemove(o)}refreshUi(){this.enabled&&(this._uiNeedRefresh=!0)}async _refreshUi(){return this._uiNeedRefresh&&this.enabled&&this._refreshUiConfig(),this._uiNeedRefresh=!1,!1}}MaterialLibraryBasePlugin.PluginType="MaterialLibraryBasePlugin",MaterialLibraryBasePlugin_decorate([uiToggle("Enabled")],MaterialLibraryBasePlugin.prototype,"enabled",void 0);var MaterialLibraryPlugin_decorate=function(h,o,c,d){var _,b=arguments.length,_e=b<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_e=Reflect.decorate(h,o,c,d);else for(var it=h.length-1;it>=0;it--)(_=h[it])&&(_e=(b<3?_(_e):b>3?_(o,c,_e):_(o,c))||_e);return b>3&&_e&&Object.defineProperty(o,c,_e),_e};class MaterialLibraryPlugin extends MaterialLibraryBasePlugin{constructor(){super(...arguments),this.replaceMaterial=!1,this.uiConfig={type:"folder",label:"Material Library",uuid:esm_browser_v4(),children:[...generateUiConfig(this),()=>({type:"dropdown",label:"Apply Material",limitedUi:!0,hidden:()=>!this._selectedObject(),children:[{label:"select one",value:""},[...this._viewer.getPlugin(AssetManagerPlugin).materials.getAllMaterials().map(o=>({label:o.name||o.uuid,value:o.uuid}))||[]]],getValue:()=>{var o;return(o=this._selectedMaterial())===null||o===void 0?void 0:o.uuid},setValue:o=>{var c,d,_,b,_e;const it=(_=(d=(c=this._viewer)===null||c===void 0?void 0:c.getPlugin(AssetManagerPlugin))===null||d===void 0?void 0:d.materials)===null||_===void 0?void 0:_.findMaterial(o);if(it)if(this.replaceMaterial)(_e=(b=this._selectedObject())===null||b===void 0?void 0:b.setMaterial)===null||_e===void 0||_e.call(b,it);else{const nt=this._selectedMaterial();if(nt){const at=nt.name,ut=nt.uuid;nt.copyProps(it),nt.name=at,nt.uuid=ut,nt.userData.uuid&&(nt.userData.uuid=ut)}}this._refreshUi()}})]}}async _refreshUi(){var o,c,d;if(!await super._refreshUi())return!1;const _=[MeshStandardMaterial2.TypeSlug,DiamondMaterial.TypeSlug],b=(c=(o=this._viewer)===null||o===void 0?void 0:o.getPlugin(AssetManagerPlugin))===null||c===void 0?void 0:c.materials,_e=_.map(it=>[it,b==null?void 0:b.getMaterialsOfType(it)]);CustomContextGrid.RemoveAll(MaterialLibraryPlugin.PluginType);for(const[it,nt]of _e)CustomContextGrid.Create(MaterialLibraryPlugin.PluginType,it,5,20,0,nt==null?void 0:nt.filter(at=>!at.userData.runtimeMaterial).map(at=>{let ut;const pt="generate:sphere";if(pt.startsWith("generate:"))ut=this._previewGenerator.generate(at,pt.split(":")[1]);else{const mt=at[pt]||"#ff00ff";ut=mt.image?Ne$1(mt.image,100):void 0,ut||(ut=Je$1(mt))}return{id:at.uuid,image:ut,onClick:mt=>{const ft=b==null?void 0:b.findMaterial(mt);if(ft){const vt=ft.userData.__appliedMeshes;if(vt!=null&&vt.size){const xt=vt.keys().next().value;xt==null||xt.dispatchEvent({type:"select",value:xt})}}},tooltip:at.name||at.uuid}}),(at,ut)=>tippy_esm(at,{placement:"bottom",content:ut.tooltip}));return CustomContextGrid.RebuildUi((d=this._viewer)===null||d===void 0?void 0:d.container),!0}}MaterialLibraryPlugin.PluginType="MaterialLibraryPlugin",MaterialLibraryPlugin_decorate([uiToggle("Replace Material")],MaterialLibraryPlugin.prototype,"replaceMaterial",void 0);var FSShadowMaterial_decorate=function(h,o,c,d){var _,b=arguments.length,_e=b<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_e=Reflect.decorate(h,o,c,d);else for(var it=h.length-1;it>=0;it--)(_=h[it])&&(_e=(b<3?_(_e):b>3?_(o,c,_e):_(o,c))||_e);return b>3&&_e&&Object.defineProperty(o,c,_e),_e};class FSShadowMaterial extends three_module.q2{constructor(){super(...arguments),this.typeSlug="fsShadow",this.assetType="material",this._uniforms={},this.lastFrameTexture=null}get materialObject(){return this}onBeforeCompile(o,c){o.vertexShader=o.vertexShader.replace("#include <project_vertex>",`
#include <project_vertex>
gl_Position = vec4(uv*2.-1., 0, 1.); 
        `),o.vertexShader=o.vertexShader.replace("void main() {",`
varying vec2 vUv;
void main() {
    vUv = uv;
        `),o.fragmentShader=o.fragmentShader.replace("void main() {",`
varying vec2 vUv;
uniform sampler2D tLastThis;
void main() {
        `),o.fragmentShader=o.fragmentShader.replace("gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );",fe$1`
float shadow = getShadowMask();

//shift the color by dither_shift
shadow = clamp(shadow + mix(-1./512., 1./512., rand( gl_FragCoord.xy )), 0., 1.);

float last = unpackRGBAToDepth(texture2D(tLastThis, vUv));
gl_FragColor = packDepthToRGBA(mix(last, shadow, opacity));
//if not useMovingAverage:
//gl_FragColor = packDepthToRGBA(shadow * opacity + last);
        `),Object.assign(o.uniforms,this._uniforms),super.onBeforeCompile(o,c)}customProgramCacheKey(){return super.customProgramCacheKey()}toJSON(o){throw new Error("Method not supported for this material.")}fromJSON(o,c){throw new Error("Method not supported for this material.")}copyProps(o){throw new Error("Method not supported for this material.")}setDirty(o){this.needsUpdate=!0,this.dispatchEvent({...o,type:"materialUpdate"})}}FSShadowMaterial_decorate([uniform({propKey:"tLastThis"})],FSShadowMaterial.prototype,"lastFrameTexture",void 0);var seperableShadowBlur=`#include <packing>
uniform sampler2D colorTexture;uniform vec2 size;uniform vec2 direction;uniform float step;varying vec2 vUv;void main(){float sum=0.;vec2 uvDelta=step*direction/size;sum+=unpackRGBAToDepth(texture2D(colorTexture,vUv-1.*uvDelta))*0.3333;sum+=unpackRGBAToDepth(texture2D(colorTexture,vec2(vUv.x,vUv.y)))*0.3333;sum+=unpackRGBAToDepth(texture2D(colorTexture,vUv+1.*uvDelta))*0.3333;gl_FragColor=packDepthToRGBA(sum);}`,ShadowMapBaker_decorate=function(h,o,c,d){var _,b=arguments.length,_e=b<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_e=Reflect.decorate(h,o,c,d);else for(var it=h.length-1;it>=0;it--)(_=h[it])&&(_e=(b<3?_(_e):b>3?_(o,c,_e):_(o,c))||_e);return b>3&&_e&&Object.defineProperty(o,c,_e),_e};class ShadowMapBaker extends I$2{get attachedMesh(){return this._attachedMesh}set attachedMesh(o){this._attachedMesh!==o&&(this._attachedMesh&&this.cleanupMaterial(),this._attachedMesh=o,this._attachedMesh&&this._updateMaterial())}get target(){return this._target}get light(){return this._light}constructor(o){super(),this.enabled=!0,this._lightLayer=5,this._frameNumber=0,this.maxFrameNumber=400,this.smoothShadow=!1,this.shadowMapType=three_module.bTm,this.groundMapMode="aoMap",this.alphaVignette=!0,this.alphaVignetteAxis="xy",this.shadowAutoUpdate=!0,this._bakeCounter=0,this.maxBakeCount=1/0,this.materialExtension={parsFragmentSnippet:(d,_)=>fe$1`
            uniform float transitionOpacity;
            `,extraUniforms:{transitionOpacity:{value:1}},shaderExtender:(d,_,b)=>{this.groundMapMode==="aoMap"?d.fragmentShader=shaderReplaceString(d.fragmentShader,"#include <aomap_fragment>",shaderReplaceString(three_module.vxI.aomap_fragment,"float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;","float ambientOcclusion = ( mix(1., unpackRGBAToDepth(texture2D( aoMap, vAoMapUv ) ), transitionOpacity) - 1.0) * aoMapIntensity + 1.0;")):this.groundMapMode==="map"?d.fragmentShader=shaderReplaceString(d.fragmentShader,"#include <map_fragment>",shaderReplaceString(three_module.vxI.map_fragment,"diffuseColor *= sampledDiffuseColor","float groundShadow = mix(1., unpackRGBAToDepth(sampledDiffuseColor), transitionOpacity); diffuseColor.rgb *= groundShadow; diffuseColor.a *= max(0., 1.-groundShadow) * transitionOpacity;")):this.groundMapMode==="alphaMap"&&(d.fragmentShader=shaderReplaceString(d.fragmentShader,"#include <alphamap_fragment>",shaderReplaceString(three_module.vxI.alphamap_fragment,"texture2D( alphaMap, vAlphaMapUv ).g","1. - unpackRGBAToDepth( texture2D( alphaMap, vAlphaMapUv ) )",{replaceAll:!0}))),d.fragmentShader=shaderReplaceString(d.fragmentShader,"#include <opaque_fragment>",fe$1`#include <opaque_fragment>
                #ifndef OPAQUE
                    #ifdef USE_AOMAP
                        #if NUM_DIR_LIGHT_SHADOWS > 0
                            // TODO find a better solution
                            float alphaMod = length(reflectedLight.directDiffuse)*4./float(NUM_DIR_LIGHT_SHADOWS);
                        #else
                            float alphaMod = 1.;
                        #endif
                        float t1 = 1. - ambientOcclusion;
                        float t2 = max(1. - alphaMod, 0.);
                        float t = t1 + t2;
                        gl_FragColor.a *= max(t, 0.);
                    #endif
                #endif
            `),this.alphaVignette&&b.capabilities.isWebGL2&&(d.defines.USE_UV="",d.fragmentShader=shaderReplaceString(d.fragmentShader,"#include <opaque_fragment>",fe$1`#include <opaque_fragment>
                    #ifndef OPAQUE
                    float weight = 0.;
                    #ifdef USE_UV // why are we checking for this? this is always supposed to be true
                    weight = 2.*abs(length(0.5 - vUv.${this.alphaVignetteAxis}));
                    #endif
                    #if defined(USE_LIGHTMAP) || defined(USE_AOMAP)
                    weight = 2.*abs(length(0.5 - vAoMapUv.${this.alphaVignetteAxis}));
                    #endif
                    weight = min(1., max(0., weight))-0.5;
                    weight = min(1., max(0., 1.0-2.*weight));
                    weight = pow(weight, 1.5);
                    gl_FragColor.a *= weight;
                    //gl_FragColor.rgb /= max(0.01, weight);
                    gl_FragColor = saturate(gl_FragColor);
                    //gl_FragColor.a = 0.5;
                    #endif
                    `))},computeCacheKey:()=>this.groundMapMode+"."+this.alphaVignette+"."+this.alphaVignetteAxis,onObjectRender:(d,_)=>{_.materialObject.userData.gMapMode!==this.groundMapMode&&(_.materialObject.userData.gMapMode=this.groundMapMode,_.materialObject.needsUpdate=!0)},isCompatible:d=>d.isMeshStandardMaterial2},this._viewer=o;const c=new RandomizedDirectionalLight(16777215,10,{near:1.5,far:20,bias:0,frustumSize:4,width:1024,height:1024,enabled:!0,radius:10,normalBias:0},{direction:new three_module.Pq0(.2,1,.2).normalize(),spread:.9,focus:1,distanceScale:20,minDistanceScale:new three_module.Pq0(10,10,10),normalDirection:new three_module.Pq0(0,1,0)});c.shadow.camera.updateProjectionMatrix(),c.layers.disableAll(),c.layers.set(this._lightLayer),this._light=c,o.scene.addLight(this._light,{addToRoot:!0}),this._shadowMat=new FSShadowMaterial({color:"#ffffff",toneMapped:!1,depthWrite:!1,depthTest:!1,premultipliedAlpha:!1,opacity:1,transparent:!1,blending:three_module.XIg}),this._shadowBlurMat=new ShaderMaterial2({uniforms:{colorTexture:{value:null},step:{value:.1},size:{value:new three_module.I9Y(.5,.5)},direction:{value:new three_module.I9Y(.5,.5)}},vertexShader:defaultVertex,fragmentShader:seperableShadowBlur})}dispose(){this._shadowMat.dispose(),this._target=void 0,this.reset()}cleanupMaterial(){this._updateMaterial(!0)}_groundMapModeChanged(){this._attachedMesh&&(this.cleanupMaterial(),this._updateMaterial(),this.groundMapMode==="alphaMap"?this._attachedMesh.material.transparent=!0:this._attachedMesh.material.transparent=!1),this.reset()}_alphaVignetteChanged(){var o,c,d;(c=(o=this.materialExtension)===null||o===void 0?void 0:o.setDirty)===null||c===void 0||c.call(o),(d=this._viewer)===null||d===void 0||d.setDirty()}fromJSON(o,c){return deserializeObject(o,this,!0,c),this.reset(),this}reset(){this._frameNumber=0}get frameNumber(){return this._frameNumber}autoUpdateShadow(){return!(!this.shadowAutoUpdate||this._bakeCounter>=this.maxBakeCount||!this.updateShadow()||(this._frameNumber===this.maxFrameNumber?this.dispatchEvent({type:"shadowBaked",bakeCount:++this._bakeCounter}):this._frameNumber>0&&this._frameNumber<this.maxFrameNumber&&this.dispatchEvent({type:"shadowBaking",progress:this._frameNumber/this.maxFrameNumber,bakeCount:this._bakeCounter}),0))}updateShadow(){if(!this.enabled)return!1;const o=this._attachedMesh;if(!o||++this._frameNumber>this.maxFrameNumber)return!1;const c=1024;this._target||(this._target=this._viewer.renderer.createTarget({type:three_module.OUM,depthBuffer:!1,size:new three_module.I9Y(c,c),sizeMultiplier:void 0,colorSpace:three_module.jf0,format:three_module.GWd})),this._frameNumber<3?this._light.randomizePosition(0,1,0):this._light.randomizePosition(this._frameNumber),o.castShadow=!1;const d=this._viewer.renderer.rendererObject,_=d.shadowMap,b=_.type,_e=_.needsUpdate,it=_.autoUpdate;_.type=this.shadowMapType,_.needsUpdate=!0,_.autoUpdate=!1;const nt=this._viewer.scene,at=new three_module.zgK;at.disableAll(),nt.modelObject.traverse(vt=>{vt.isLight&&vt!==this._light.lightObject&&(vt.userData.__gp_layers=vt.layers,vt.layers=at)});const ut=nt.activeCamera.cameraObject;if(ut.layers.mask&1<<this._lightLayer)throw"Camera can render pseudo directional light, check layers";ut.layers.enable(this._lightLayer),o.layers.disable(this._lightLayer),setThreeRendererMode(d,{shadowMapRender:!0,backgroundRender:!1,sceneRender:!1},()=>this._viewer.renderer.renderScene(nt)),ut.layers.disable(this._lightLayer);const pt=ut.layers.mask;ut.layers.set(this._lightLayer),o.layers.enable(this._lightLayer);const mt=this._viewer.renderer.getTempTarget({type:three_module.OUM,depthBuffer:!1,size:new three_module.I9Y(c,c),colorSpace:three_module.jf0,format:three_module.GWd}),ft=mt.texture.colorSpace;mt.texture.colorSpace=three_module.jf0,this._viewer.renderer.blit(this._target.texture,mt,{clear:!0});{const vt=o.material,xt=o.frustumCulled,At=d.getRenderTarget(),Ct=d.getActiveCubeFace(),Et=d.getActiveMipmapLevel();o.material=this._shadowMat,o.frustumCulled=!1,d.setRenderTarget(this._target),this._shadowMat.opacity=Math.max(1/this.maxFrameNumber,1/this._frameNumber),this._shadowMat.lastFrameTexture=mt.texture,this._shadowMat.needsUpdate=!0,setThreeRendererMode(d,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!0,transparentRender:!1,transmissionRender:!1},()=>this._viewer.renderer.renderScene(nt)),d.setRenderTarget(At,Ct,Et),o.frustumCulled=xt,o.material=vt,this.smoothShadow&&this._applySmoothFilter(this._target,mt)}return mt.texture.colorSpace=ft,this._viewer.renderer.releaseTempTarget(mt),o.layers.disable(this._lightLayer),ut.layers.mask=pt,nt.modelObject.traverse(vt=>{vt.isLight&&vt!==this._light.lightObject&&(vt.layers=vt.userData.__gp_layers,delete vt.userData.__gp_layers)}),_.type=b,_.needsUpdate=_e,_.autoUpdate=it,o.castShadow=!0,(this._frameNumber<3||this._frameNumber>Math.min(100,this.maxFrameNumber)&&this._frameNumber%4==0)&&(this._updateMaterial(),this._viewer.setDirty(),o.dispatchEvent({type:"materialUpdate"})),!0}_updateMaterial(o=!1){var c,d,_;this._attachedMesh&&(o?(this._attachedMesh.material.alphaMap===((c=this._target)===null||c===void 0?void 0:c.texture)&&(this._attachedMesh.material.alphaMap=null),this._attachedMesh.material.aoMap===((d=this._target)===null||d===void 0?void 0:d.texture)&&(this._attachedMesh.material.aoMap=null),this._attachedMesh.material.map===((_=this._target)===null||_===void 0?void 0:_.texture)&&(this._attachedMesh.material.map=null)):this._target&&(this.groundMapMode==="alphaMap"&&(this._attachedMesh.material.alphaMap=this._target.texture),this.groundMapMode==="aoMap"&&(this._attachedMesh.material.aoMap=this._target.texture),this.groundMapMode==="map"&&(this._attachedMesh.material.map=this._target.texture)),this._attachedMesh.material&&(this._attachedMesh.material.userData.ALPHA_I_RGBA_PACKING=!o&&this.groundMapMode==="alphaMap",this._attachedMesh.material.alphaTest=o||this.groundMapMode!=="alphaMap"?0:.01,this._attachedMesh.material.needsUpdate=!0))}_applySmoothFilter(o,c){this._shadowBlurMat.uniforms.colorTexture.value=o.texture,this._shadowBlurMat.uniforms.direction.value.set(1,0),this._shadowBlurMat.uniforms.size.value.set(o.width,o.height),this._viewer.renderer.blit(void 0,c,{material:this._shadowBlurMat}),this._shadowBlurMat.uniforms.colorTexture.value=c.texture,this._shadowBlurMat.uniforms.direction.value.set(0,1),this._shadowBlurMat.uniforms.size.value.set(c.width,c.height),this._viewer.renderer.blit(void 0,o,{material:this._shadowBlurMat})}}ShadowMapBaker_decorate([serialize("randomizedLight")],ShadowMapBaker.prototype,"_light",void 0),ShadowMapBaker_decorate([x$1(ShadowMapBaker.prototype.reset),serialize()],ShadowMapBaker.prototype,"maxFrameNumber",void 0),ShadowMapBaker_decorate([x$1(ShadowMapBaker.prototype.reset),serialize()],ShadowMapBaker.prototype,"smoothShadow",void 0),ShadowMapBaker_decorate([serialize(),x$1(ShadowMapBaker.prototype.reset)],ShadowMapBaker.prototype,"shadowMapType",void 0),ShadowMapBaker_decorate([x$1(ShadowMapBaker.prototype._groundMapModeChanged),serialize()],ShadowMapBaker.prototype,"groundMapMode",void 0),ShadowMapBaker_decorate([serialize(),x$1(ShadowMapBaker.prototype._alphaVignetteChanged)],ShadowMapBaker.prototype,"alphaVignette",void 0),ShadowMapBaker_decorate([serialize(),x$1(ShadowMapBaker.prototype._alphaVignetteChanged)],ShadowMapBaker.prototype,"alphaVignetteAxis",void 0),ShadowMapBaker_decorate([serialize()],ShadowMapBaker.prototype,"maxBakeCount",void 0);var reflectorSample=`#ifndef D_sceneBoundingRadius
#define D_sceneBoundingRadius 
uniform float sceneBoundingRadius;
#endif
varying vec4 vRefUv;uniform sampler2D tRefDiffuse;uniform vec2 tRefDiffuseSize;float getSpecularMIPLevel(const in float roughness,const in float maxMIPLevel){float sigma=PI*roughness*roughness/(1.+roughness);float desiredMIPLevel=maxMIPLevel+log2(sigma);return clamp(desiredMIPLevel,0.,maxMIPLevel);}vec4 getReflectionColor(const in float roughness,const in float depthModifier){float mip=getSpecularMIPLevel(roughness+depthModifier,5.);vec4 color=texture2D(tRefDiffuse,vRefUv.xy/vRefUv.w,mip);float blurDist=saturate(2./(1.+pow(abs(vViewPosition.z),0.25)))*mip*32.*color.a;float rnd=PI2*interleavedGradientNoise(vUv.xy,frameCount);vec4 rotationMatrix=vec4(cos(rnd),-sin(rnd),0.,0.);rotationMatrix.z=-rotationMatrix.y;rotationMatrix.w=rotationMatrix.x;vec3 colorSum=color.rgb*color.a;float weightSum=0.001+color.a;vec2 ofs;setPds();
#pragma unroll_loop_start
for(int i=0;i<16;i++){ofs=poisson_disk_samples[UNROLLED_LOOP_INDEX];ofs=vec2(dot(ofs,rotationMatrix.xy),dot(ofs,rotationMatrix.zw));ofs=vRefUv.xy+vRefUv.w*blurDist*ofs/tRefDiffuseSize.xy;color=texture2D(tRefDiffuse,ofs/vRefUv.w,mip);colorSum+=color.rgb*color.a;weightSum+=color.a;}
#pragma unroll_loop_end
return vec4(colorSum/weightSum,1.);}`,Reflector2_decorate=function(h,o,c,d){var _,b=arguments.length,_e=b<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_e=Reflect.decorate(h,o,c,d);else for(var it=h.length-1;it>=0;it--)(_=h[it])&&(_e=(b<3?_(_e):b>3?_(o,c,_e):_(o,c))||_e);return b>3&&_e&&Object.defineProperty(o,c,_e),_e};class Reflector2 extends three_module.eaF{_updateExtension(){var o,c;this.transparentReflectionBackground=this.reflectorModePhysical,(c=(o=this.materialExtension)===null||o===void 0?void 0:o.setDirty)===null||c===void 0||c.call(o)}constructor(o,c,d=0){super(o),this.type="Reflector",this.isReflector2=!0,this.enabled=!0,this.reflectorModePhysical=!0,this.reflectionTargetNeedsUpdate=!0,this.transparentReflectionBackground=!0,this.materialExtension={extraUniforms:{tRefDiffuse:{value:null},tRefDiffuseSize:{value:new three_module.I9Y},refTextureMatrix:{value:null},frameCount:{value:0},sceneBoundingRadius:{value:0}},extraDefines:{USE_UV:""},updaters:[],shaderExtender:(At,Ct,Et)=>{if(this.enabled){At.vertexShader=shaderReplaceString(At.vertexShader,"void main() {",`void main() {
vRefUv = refTextureMatrix * vec4( position, 1.0 );`);const Tt="#glMarker beforeModulation";At.fragmentShader=shaderReplaceString(At.fragmentShader,Tt,`
                    if(roughnessFactor < 0.95) {
                        float d = 0.;//textureProj(tRefDepth, vRefUv).r;
                        // d = min(2., max(0., (d-0.06) * ((7./3.-ior)) * sceneBoundingRadius));
                        vec4 refBaseColor = getReflectionColor(material.roughness, material.roughness * d);
                        // refBaseColor.rgb = vec3(refBaseColor.a);
                        // refBaseColor.a *= 1.0 - clamp(material.roughness * .3, 0., 1.);
                        `+(this.reflectorModePhysical?`
                        #if !defined(SSR_ENABLED) || SSR_ENABLED < 1 
                        vec3 specularColor = EnvironmentBRDF(geometryNormal, geometryViewDir, material.specularColor.rgb, material.specularF90, material.roughness);
                        #endif
                        reflectedLight.indirectSpecular = mix(vec3(reflectedLight.indirectSpecular), saturate(specularColor.rgb * refBaseColor.rgb), refBaseColor.a);
                        `:`
                        reflectedLight.indirectSpecular = saturate(diffuseColor.rgb * refBaseColor.rgb);
                        diffuseColor.a *= refBaseColor.a;
                        `)+`}
`+Tt)}},parsVertexSnippet:()=>this.enabled?`
		uniform mat4 refTextureMatrix;
		varying vec4 vRefUv;
`:"",parsFragmentSnippet:()=>this.enabled?poissonDiskSamples+`
`+randomHelpers+`
`+reflectorSample:"",computeCacheKey:At=>this.enabled+" "+At.materialObject.transparent+" "+this.reflectorModePhysical+" ",onObjectRender:(At,{materialObject:Ct})=>{Ct.userData.__lastTransparent!==Ct.transparent&&(Ct.needsUpdate=!0,Ct.userData.__lastTransparent=Ct.transparent)},isCompatible:At=>At.isMeshStandardMaterial2},this.material=void 0,this._renderTarget=c;const _=new three_module.Zcv,b=new three_module.Pq0,_e=new three_module.Pq0,it=new three_module.Pq0,nt=new three_module.kn4,at=new three_module.Pq0(0,0,-1),ut=new three_module.IUQ,pt=new three_module.Pq0,mt=new three_module.Pq0,ft=new three_module.IUQ,vt=new three_module.kn4,xt=new three_module.ubm;three_module.cj9.isPowerOfTwo(c.texture.image.width)&&three_module.cj9.isPowerOfTwo(c.texture.image.height)||(this._renderTarget.texture.generateMipmaps=!1),this.onBeforeRender=(At,Ct,Et)=>{if(!this.enabled||!At.userData.mainRenderPass||!this.reflectionTargetNeedsUpdate)return;const Tt=Et.view?Object.assign({},Et.view):null;if(Tt&&Et.clearViewOffset&&Et.clearViewOffset(),_e.setFromMatrixPosition(this.matrixWorld),it.setFromMatrixPosition(Et.matrixWorld),nt.extractRotation(this.matrixWorld),b.set(0,0,1),b.applyMatrix4(nt),pt.subVectors(_e,it),pt.dot(b)>0)return;pt.reflect(b).negate(),pt.add(_e),nt.extractRotation(Et.matrixWorld),at.set(0,0,-1),at.applyMatrix4(nt),at.add(it),mt.subVectors(_e,at),mt.reflect(b).negate(),mt.add(_e),xt.position.copy(pt),xt.up.set(0,1,0),xt.up.applyMatrix4(nt),xt.up.reflect(b),xt.lookAt(mt),xt.far=2,xt.near=0,xt.updateMatrixWorld(),xt.projectionMatrix.copy(Et.projectionMatrix),vt.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),vt.multiply(xt.projectionMatrix),vt.multiply(xt.matrixWorldInverse),vt.multiply(this.matrixWorld),_.setFromNormalAndCoplanarPoint(b,_e),_.applyMatrix4(xt.matrixWorldInverse),ut.set(_.normal.x,_.normal.y,_.normal.z,_.constant);const kt=xt.projectionMatrix;ft.x=(Math.sign(ut.x)+kt.elements[8])/kt.elements[0],ft.y=(Math.sign(ut.y)+kt.elements[9])/kt.elements[5],ft.z=-1,ft.w=(1+kt.elements[10])/kt.elements[14],ut.multiplyScalar(2/ut.dot(ft)),kt.elements[2]=ut.x,kt.elements[6]=ut.y,kt.elements[10]=ut.z+1-d,kt.elements[14]=ut.w,this.visible=!1;const Dt=At.getRenderTarget(),zt=At.xr.enabled,Bt=At.shadowMap.autoUpdate;At.xr.enabled=!1,At.shadowMap.autoUpdate=!1,At.setRenderTarget(this._renderTarget),At.state.buffers.depth.setMask(!0),At.autoClear===!1&&At.clear();const Rt=Ct.background;this.transparentReflectionBackground&&(Ct.background=null);const Ut=!this.transparentReflectionBackground;Rt!=null&&Rt.isTexture&&Ut&&(Rt.userData||(Rt.userData={}),Rt.userData.flipX=!Rt.userData.flipX),setThreeRendererMode(At,{shadowMapRender:!1,backgroundRender:Ut,opaqueRender:!0,transparentRender:!0,transmissionRender:!1,screenSpaceRendering:!1},()=>At.render(Ct,xt)),Rt!=null&&Rt.isTexture&&Ut&&(Rt.userData.flipX=!Rt.userData.flipX||void 0),this.transparentReflectionBackground&&(Ct.background=Rt),At.xr.enabled=zt,At.shadowMap.autoUpdate=Bt,At.setRenderTarget(Dt),Tt!=null&&Tt.enabled&&Et.setViewOffset&&Et.setViewOffset(Tt.fullWidth,Tt.fullHeight,Tt.offsetX,Tt.offsetY,Tt.width,Tt.height);const Ht=Et.viewport;Ht!==void 0&&At.state.viewport(Ht),this.visible=!0,this.reflectionTargetNeedsUpdate=!1},this.textureMatrix=vt,this.materialExtension.extraUniforms.tRefDiffuse.value=this._renderTarget.texture,this.materialExtension.extraUniforms.tRefDiffuseSize.value=new three_module.I9Y(this._renderTarget.width,this._renderTarget.height),this.materialExtension.extraUniforms.refTextureMatrix.value=vt}getRenderTarget(){return this._renderTarget}}Reflector2_decorate([x$1(Reflector2.prototype._updateExtension)],Reflector2.prototype,"enabled",void 0),Reflector2_decorate([x$1(Reflector2.prototype._updateExtension)],Reflector2.prototype,"reflectorModePhysical",void 0),Reflector2.prototype.isReflector=!0;var BaseGroundPlugin_decorate=function(h,o,c,d){var _,b=arguments.length,_e=b<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_e=Reflect.decorate(h,o,c,d);else for(var it=h.length-1;it>=0;it--)(_=h[it])&&(_e=(b<3?_(_e):b>3?_(o,c,_e):_(o,c))||_e);return b>3&&_e&&Object.defineProperty(o,c,_e),_e};class BaseGroundPlugin extends AViewerPlugin{get enabled(){return this.visible}set enabled(o){this.visible=o}get material(){return this._material}get mesh(){return this._iMesh}constructor(o={}){super(),this._transformNeedRefresh=!0,this.dependencies=[AssetManagerPlugin],this.visible=!0,this.size=8,this.yOffset=0,this.renderToDepth=!0,this.tonemapGround=!0,this.limitCameraAboveGround=!1,this.enableRefreshTransform=!0,this._cameraLimitsSet=!1,this._cameraLastMaxPolarAngle=Math.PI,this.useModelBounds=!1,this._refreshMaterial=this._refreshMaterial.bind(this),this._refreshTransform=this._refreshTransform.bind(this),this._refreshCameraLimits=this._refreshCameraLimits.bind(this),this.refreshOptions=this.refreshOptions.bind(this),this._refreshOptions2=this._refreshOptions2.bind(this),this._onSceneUpdate=this._onSceneUpdate.bind(this),this._preRender=this._preRender.bind(this),this._postFrame=this._postFrame.bind(this),this._geometry=new three_module.bdM(1,1,1,1),this._geometry.attributes.uv2=this._geometry.attributes.uv.clone(),this._geometry.attributes.uv2.needsUpdate=!0,this._options={shape:"",up:[0,100,0],autoAdjustTransform:!0},this.setOptions(o)}get autoAdjustTransform(){return this._options.autoAdjustTransform}set autoAdjustTransform(o){this._options.autoAdjustTransform=o,this.refreshTransform()}_createMesh(){return new three_module.eaF(this._geometry)}setGeometry(o){o?this._geometry&&this._geometry.dispose():o=this._geometry,o&&(o.attributes.uv2||(o.attributes.uv2=o.attributes.uv.clone(),o.attributes.uv2.needsUpdate=!0),this._mesh&&(this._mesh.geometry=o))}async onAdded(o){var c,d;await super.onAdded(o),o.getPluginByType("TweakpaneUi")&&console.error("TweakpaneUiPlugin must be added after Ground Plugin"),this._manager=o.getPlugin(AssetManagerPlugin);const _=this._createMesh();_.userData.physicsMass=0,_.userData.isGroundMesh=!0,this._iMesh=await((c=this._manager)===null||c===void 0?void 0:c.addImportedSingle(_,{pseudoCenter:!1,autoScale:!1,addToRoot:!0})),this._mesh=(d=this._iMesh)===null||d===void 0?void 0:d.modelObject,this._mesh&&(this._mesh.userData.userSelectable=!1,this._mesh.castShadow=!0,this._mesh.receiveShadow=!0,this._mesh.name="Ground Plane"),o.scene.addEventListener("sceneUpdate",this._onSceneUpdate),o.scene.addEventListener("addSceneObject",this._onSceneUpdate),o.addEventListener("preRender",this._preRender),o.addEventListener("postFrame",this._postFrame),this.refreshOptions()}_postFrame(){this._transformNeedRefresh&&this._refreshTransform(),this._viewer}_preRender(){this._viewer}async onDispose(o){var c,d,_;return this._removeMaterial(),this._geometry.dispose(),(c=this._material)===null||c===void 0||c.dispose(),(_=(d=this._iMesh)===null||d===void 0?void 0:d.dispose)===null||_===void 0||_.call(d),super.onDispose(o)}async onRemove(o){return this._removeMaterial(),o.scene.removeEventListener("sceneUpdate",this._onSceneUpdate),o.scene.removeEventListener("addSceneObject",this._onSceneUpdate),o.removeEventListener("postFrame",this._postFrame),o.removeEventListener("preRender",this._preRender),this._manager=void 0,super.onRemove(o)}_removeMaterial(){this._material&&(this._material.userData.renderToDepth=this._material.userData.__renderToDepth,this._material.userData.__renderToDepth=void 0,this._material=void 0)}_onSceneUpdate(o){(o==null?void 0:o.geometryChanged)!==!1&&(o==null?void 0:o.updateGround)!==!1&&this.refreshTransform()}refreshTransform(){this.enableRefreshTransform&&(this._transformNeedRefresh=!0)}_refreshOptions2(){this.refreshOptions()}refreshOptions(){this._viewer&&(this._refreshMaterial(),this.refreshTransform(),this._refreshCameraLimits())}_refreshCameraLimits(){var o;const c=(o=this._viewer)===null||o===void 0?void 0:o.scene.activeCamera.controls;c&&(c.maxPolarAngle!==void 0?this.limitCameraAboveGround?(this._cameraLimitsSet||(this._cameraLastMaxPolarAngle=c.maxPolarAngle),c.maxPolarAngle=Math.PI/2,this._cameraLimitsSet=!0):this._cameraLimitsSet&&(c.maxPolarAngle=this._cameraLastMaxPolarAngle,this._cameraLimitsSet=!1):console.warn("refreshCameraLimits only available with orbit controls."))}_refreshTransform(){var o,c,d;if(!this._mesh||!this._viewer)return;let _=!1;if(this.visible!==this._mesh.visible&&(this._mesh.visible=this.visible,_=!0),this.enabled){if(this._options.autoAdjustTransform){this._mesh.userData.bboxVisible=!1;const b=this.useModelBounds?this._viewer.scene.getModelBounds(!0,!0,!0):this._viewer.scene.getBounds(!0,!0,!0);this._mesh.userData.bboxVisible=!0;const _e=b.getCenter(new three_module.Pq0).sub(new three_module.Pq0(0,b.getSize(new three_module.Pq0).y/2+this.yOffset,0));_=_||_e.clone().sub(this._mesh.position).length()>1e-4,_&&this._mesh.position.copy(_e)}_=_||Math.abs(this._mesh.scale.x-this.size)>1e-4,_&&(this._mesh.scale.setScalar(this.size),this._mesh.setRotationFromEuler(new three_module.O9p(-Math.PI/2,0,this._mesh.rotation.z)),this._mesh.matrixWorldNeedsUpdate=!0,(d=(c=this._mesh).setDirty)===null||d===void 0||d.call(c)),this._transformNeedRefresh=!1}else _&&((o=this._viewer)===null||o===void 0||o.scene.setDirty())}_refreshMaterial(){var o,c,d,_,b,_e;if(!this._viewer||!this.enabled)return!1;this._manager||console.error("GroundPlugin requires asset manager");const it=(o=this._material)!==null&&o!==void 0?o:(d=(c=this._manager)===null||c===void 0?void 0:c.materials)===null||d===void 0?void 0:d.findOrCreate("standard",{name:"BaseGroundMaterial",runtimeMaterial:!0,color:16777215,roughness:.75,metalness:.5});it&&it.userData.runtimeMaterial;let nt=!1;return it!==this._material&&(this._removeMaterial(),it&&(this._material=it),!((_=this._material)===null||_===void 0)&&_.uuid||console.warn("No material found for ground"),this._viewer.scene.setDirty(),this._mesh&&this._material&&(this._material.roughness=.75,this._material.metalness=.5,((_e=(b=this._mesh)===null||b===void 0?void 0:b.setMaterial)!==null&&_e!==void 0?_e:at=>{this._mesh&&(this._mesh.material=at.materialObject)})(this._material)),nt=!0),this._material&&(this._material.userData.__renderToDepth===void 0&&(this._material.userData.__renderToDepth=this._material.userData.renderToDepth),this._material.userData.renderToDepth!==this.renderToDepth&&(this._material.userData.renderToDepth=this.renderToDepth),this._material.userData.__postTonemap===void 0&&(this._material.userData.__postTonemap=this._material.userData.postTonemap),this._material.userData.postTonemap!==this.tonemapGround&&(this._material.userData.postTonemap=this.tonemapGround),this._material.materialObject.userData.ssaoDisabled=!0,this._material.materialObject.userData.sscsDisabled=!0),this._viewer.setDirty(this),nt}setOptions(o){Object.assign(this._options,o),this.refreshOptions()}fromJSON(o,c){return super.fromJSON(o,c)?(this.refreshOptions(),this):null}_extraUiConfig(){return[()=>{var o;return(o=this._material)===null||o===void 0?void 0:o.uiConfig}]}get uiConfig(){return this._uiConfig?this._uiConfig:this._uiConfig={type:"folder",label:"Ground",children:[{label:"Visible",type:"checkbox",property:[this,"visible"],limitedUi:!0},{label:"Size",type:"input",property:[this,"size"],limitedUi:!0},{label:"Render to Depth",type:"checkbox",property:[this,"renderToDepth"]},{label:"Limit Camera",type:"checkbox",property:[this,"limitCameraAboveGround"]},{label:"Tonemap",type:"checkbox",property:[this,"tonemapGround"]},{label:"Height",type:"slider",bounds:[-2,2],property:[this,"yOffset"]},{label:"Auto adjust transform",type:"checkbox",property:[this,"autoAdjustTransform"]},...this._extraUiConfig()]}}}BaseGroundPlugin_decorate([serialize("material")],BaseGroundPlugin.prototype,"_material",void 0),BaseGroundPlugin_decorate([x$1(BaseGroundPlugin.prototype.refreshTransform),serialize()],BaseGroundPlugin.prototype,"visible",void 0),BaseGroundPlugin_decorate([ze$1(BaseGroundPlugin.prototype._onSceneUpdate),serialize()],BaseGroundPlugin.prototype,"size",void 0),BaseGroundPlugin_decorate([ze$1(BaseGroundPlugin.prototype._onSceneUpdate),serialize()],BaseGroundPlugin.prototype,"yOffset",void 0),BaseGroundPlugin_decorate([x$1(BaseGroundPlugin.prototype._refreshOptions2),serialize()],BaseGroundPlugin.prototype,"renderToDepth",void 0),BaseGroundPlugin_decorate([x$1(BaseGroundPlugin.prototype._refreshOptions2),serialize()],BaseGroundPlugin.prototype,"tonemapGround",void 0),BaseGroundPlugin_decorate([x$1(BaseGroundPlugin.prototype._refreshCameraLimits),serialize()],BaseGroundPlugin.prototype,"limitCameraAboveGround",void 0);var GroundPlugin_decorate=function(h,o,c,d){var _,b=arguments.length,_e=b<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_e=Reflect.decorate(h,o,c,d);else for(var it=h.length-1;it>=0;it--)(_=h[it])&&(_e=(b<3?_(_e):b>3?_(o,c,_e):_(o,c))||_e);return b>3&&_e&&Object.defineProperty(o,c,_e),_e};class GroundPlugin extends BaseGroundPlugin{get shadowBaker(){return this._shadowBaker}bakeShadows(){var o;(o=this._shadowBaker)===null||o===void 0||o.reset()}constructor(o={},c=!1){super(o),this.bakedShadows=!0,this.groundReflection=!1,this.physicalReflections=!1,this.autoFrustumSize=!0,this.autoBakeShadows=!0,this._showDebug=c,c&&this.dependencies.push(DebugPlugin),this._onSceneUpdate=this._onSceneUpdate.bind(this)}_createMesh(){const o=new Reflector2(this._geometry,this._viewer.renderer.createTarget({type:three_module.OUM,format:three_module.GWd,colorSpace:three_module.jf0,size:{width:1024,height:1024},generateMipmaps:!0,depthBuffer:!0,minFilter:three_module.$_I,magFilter:three_module.k6q})),c=o.onBeforeRender;return o.onBeforeRender=(...d)=>{var _,b,_e,it,nt;let at=(b=(_=this._viewer)===null||_===void 0?void 0:_.getPluginByType("SSReflection"))===null||b===void 0?void 0:b.passes.ssr.passObject;at&&!at.enabled&&(at=void 0),at&&(at.enabled=!1);let ut=(nt=(it=(_e=this._viewer)===null||_e===void 0?void 0:_e.getPluginByType("SSBevelPlugin"))===null||it===void 0?void 0:it.pass)===null||nt===void 0?void 0:nt.passObject;ut&&!ut.enabled&&(ut=void 0),ut&&(ut.enabled=!1),c(...d),at&&(at.enabled=!0),ut&&(ut.enabled=!0)},o}async onAdded(o){var c,d;await super.onAdded(o),this._showDebug&&((c=o.getPlugin(DebugPlugin))===null||c===void 0||c.addTexture("bake_ground_1",()=>{var _,b;return(b=(_=this._shadowBaker)===null||_===void 0?void 0:_.light.shadow.map)===null||b===void 0?void 0:b.texture},[100,100,200,200]),(d=o.getPlugin(DebugPlugin))===null||d===void 0||d.addTexture("bake_ground_2",()=>{var _,b;return(b=(_=this._shadowBaker)===null||_===void 0?void 0:_.target)===null||b===void 0?void 0:b.texture},[100,400,400,400],"texel = vec4(vec3(unpackRGBAToDepth(texel)), 1.0);"))}_postFrame(){super._postFrame(),this._viewer&&this.enabled&&this._shadowBaker&&this.bakedShadows&&this._shadowBaker.autoUpdateShadow()}_preRender(){super._preRender(),this._viewer&&(this._mesh.reflectionTargetNeedsUpdate=this._viewer.renderer.frameCount<1)}async onDispose(o){return super.onDispose(o)}async onRemove(o){return super.onRemove(o)}_removeMaterial(){var o,c,d,_;if(this._material){if(this._shadowBaker&&this._material.groundMatExtension&&((c=(o=this._material).unregisterMaterialExtensions)===null||c===void 0||c.call(o,[this._shadowBaker.materialExtension]),delete this._material.groundMatExtension),this._material.reflectorMatExtension){const b=this._mesh.materialExtension;b||console.warn("WebGi GroundPlugin: unable to find the extension to unregister"),(_=(d=this._material).unregisterMaterialExtensions)===null||_===void 0||_.call(d,[b]),delete this._material.reflectorMatExtension}super._removeMaterial()}}_onSceneUpdate(o){var c;super._onSceneUpdate(o),o.geometryChanged!==!1&&this.autoBakeShadows&&((c=this._shadowBaker)===null||c===void 0||c.reset())}refreshOptions(){if(!this._viewer)return;this.bakedShadows&&!this._shadowBaker?(this._shadowBaker=new ShadowMapBaker(this._viewer),this._shadowBaker.attachedMesh=this._mesh):!this.bakedShadows&&this._shadowBaker&&(this._shadowBaker.reset(),this._shadowBaker.cleanupMaterial());const o=this._mesh;o.isReflector2&&(o.enabled=this.groundReflection,o.reflectorModePhysical=this.physicalReflections),super.refreshOptions(),this._viewer.setDirty(this)}_refreshTransform(){if(this.autoFrustumSize){const o=this.shadowBaker;if(o){const c=this.size/2;c!==o.light.shadowParams.frustumSize&&(o.light.shadowParams.frustumSize=c,o.light.updateShadowParams(),o.reset())}}super._refreshTransform()}fromJSON(o,c){return super.fromJSON(o,c)?(o.autoFrustumSize===void 0&&(this.autoFrustumSize=!1),this):null}_refreshMaterial(){var o,c,d,_;if(!this._viewer)return!1;const b=super._refreshMaterial();if(!this._material)return b;if(this.groundReflection&&this._mesh.isReflector2&&!this._material.reflectorMatExtension){const _e=this._mesh.materialExtension;_e.updaters=[this._viewer.scene,this._viewer.renderer],(c=(o=this._material).registerMaterialExtensions)===null||c===void 0||c.call(o,[_e]),this._material.reflectorMatExtension=!0}return this.bakedShadows&&this._shadowBaker&&!this._material.groundMatExtension&&((_=(d=this._material).registerMaterialExtensions)===null||_===void 0||_.call(d,[this._shadowBaker.materialExtension]),this._material.groundMatExtension=!0),this._material.materialObject.userData.ssreflDisabled=this.groundReflection,this._material.materialObject.userData.ssreflNonPhysical=!this.physicalReflections,this._viewer.setDirty(this),b}_extraUiConfig(){var o,c,d,_,b,_e,it,nt,at,ut,pt,mt,ft,vt,xt,At,Ct,Et,Tt,kt,Dt,zt,Bt,Rt,Ut,Ht,Jt,Kt,sr,ir;return[{label:"Baked Shadows",type:"checkbox",property:[this,"bakedShadows"]},{label:"Shadow Frames",type:"input",hidden:()=>!this._shadowBaker,stepSize:1,bounds:[1,1e3],property:[this._shadowBaker,"maxFrameNumber"]},{label:"Alpha Vignette",type:"checkbox",hidden:()=>!this._material||this._material.transmission<1e-4&&!this._material.transparent,property:[this._shadowBaker,"alphaVignette"],limitedUi:!0,onChange:()=>{var cr,lr;return(lr=(cr=this._uiConfig)===null||cr===void 0?void 0:cr.uiRefresh)===null||lr===void 0?void 0:lr.call(cr,"postFrame",!0)}},{label:"Alpha Vignette Axis",type:"dropdown",hidden:()=>{var cr;return!(!((cr=this._shadowBaker)===null||cr===void 0)&&cr.alphaVignette)||!this._material||this._material.transmission<1e-4&&!this._material.transparent},property:[this._shadowBaker,"alphaVignetteAxis"],children:["x","y","xy"].map(cr=>({label:cr,value:cr})),limitedUi:!0},{label:"Planar Reflections",type:"checkbox",property:[this,"groundReflection"]},{label:"Auto Frustum Size",type:"checkbox",property:[this,"autoFrustumSize"]},{label:"Physical Reflections",type:"checkbox",property:[this,"physicalReflections"],limitedUi:!0},{label:"Shadow type",type:"dropdown",hidden:()=>!this._shadowBaker,property:[this._shadowBaker,"groundMapMode"],children:[{label:"aoMap"},{label:"map"},{label:"alphaMap"}],limitedUi:!0},{label:"Smooth Shadow",type:"checkbox",property:[this._shadowBaker,"smoothShadow"]},{label:"Baked shadow type",type:"dropdown",children:[["Basic",three_module.bTm],["PCF",three_module.QP0],["PCFSoft",three_module.Wk7],["VSM",three_module.RyA]].map(cr=>({label:cr[0].toString(),value:cr[1]})),property:[this._shadowBaker,"shadowMapType"]},{type:"folder",label:"Randomized Light",hidden:()=>!this._shadowBaker,limitedUi:!0,children:[{type:"color",label:"Color",property:[(o=this._shadowBaker)===null||o===void 0?void 0:o.light,"color"]},{type:"slider",label:"Intensity",bounds:[0,100],property:[(c=this._shadowBaker)===null||c===void 0?void 0:c.light,"intensity"]},{type:"checkbox",label:"Shadow Enabled",property:[(_=(d=this._shadowBaker)===null||d===void 0?void 0:d.light)===null||_===void 0?void 0:_.shadowParams,"enabled"],onChange:[(_e=(b=this._shadowBaker)===null||b===void 0?void 0:b.light)===null||_e===void 0?void 0:_e.updateShadowParams,this._onSceneUpdate]},{type:"slider",bounds:[0,1],property:[(nt=(it=this._shadowBaker)===null||it===void 0?void 0:it.light)===null||nt===void 0?void 0:nt.randomParams,"focus"],onChange:[this._onSceneUpdate]},{type:"slider",bounds:[0,1],property:[(ut=(at=this._shadowBaker)===null||at===void 0?void 0:at.light)===null||ut===void 0?void 0:ut.randomParams,"spread"],onChange:[this._onSceneUpdate],limitedUi:!0},{type:"slider",bounds:[.01,60],property:[(mt=(pt=this._shadowBaker)===null||pt===void 0?void 0:pt.light)===null||mt===void 0?void 0:mt.randomParams,"distanceScale"],onChange:[(vt=(ft=this._shadowBaker)===null||ft===void 0?void 0:ft.light)===null||vt===void 0?void 0:vt.updateShadowParams,this._onSceneUpdate]},{type:"vec3",bounds:[-1,1],property:[(At=(xt=this._shadowBaker)===null||xt===void 0?void 0:xt.light)===null||At===void 0?void 0:At.randomParams,"direction"],onChange:[this._onSceneUpdate],limitedUi:!0},{type:"vec3",bounds:[-1,1],property:[(Et=(Ct=this._shadowBaker)===null||Ct===void 0?void 0:Ct.light)===null||Et===void 0?void 0:Et.randomParams,"normalDirection"],onChange:[this._onSceneUpdate],limitedUi:!0},{type:"slider",bounds:[.01,10],property:[(kt=(Tt=this._shadowBaker)===null||Tt===void 0?void 0:Tt.light)===null||kt===void 0?void 0:kt.shadowParams,"radius"],onChange:[(zt=(Dt=this._shadowBaker)===null||Dt===void 0?void 0:Dt.light)===null||zt===void 0?void 0:zt.updateShadowParams,this._onSceneUpdate]},{type:"input",property:[(Rt=(Bt=this._shadowBaker)===null||Bt===void 0?void 0:Bt.light)===null||Rt===void 0?void 0:Rt.shadowParams,"frustumSize"],hidden:()=>this.autoFrustumSize,onChange:[(Ht=(Ut=this._shadowBaker)===null||Ut===void 0?void 0:Ut.light)===null||Ht===void 0?void 0:Ht.updateShadowParams,this._onSceneUpdate]},{type:"slider",bounds:[-.1,.1],property:[(Kt=(Jt=this._shadowBaker)===null||Jt===void 0?void 0:Jt.light)===null||Kt===void 0?void 0:Kt.shadowParams,"bias"],onChange:[(ir=(sr=this._shadowBaker)===null||sr===void 0?void 0:sr.light)===null||ir===void 0?void 0:ir.updateShadowParams,this._onSceneUpdate]}]},...super._extraUiConfig()]}}GroundPlugin.PluginType="Ground",GroundPlugin_decorate([x$1(GroundPlugin.prototype.refreshOptions),serialize()],GroundPlugin.prototype,"bakedShadows",void 0),GroundPlugin_decorate([x$1(GroundPlugin.prototype.refreshOptions),serialize()],GroundPlugin.prototype,"groundReflection",void 0),GroundPlugin_decorate([x$1(GroundPlugin.prototype.refreshOptions),serialize()],GroundPlugin.prototype,"physicalReflections",void 0),GroundPlugin_decorate([x$1(GroundPlugin.prototype.refreshOptions),serialize()],GroundPlugin.prototype,"autoFrustumSize",void 0),GroundPlugin_decorate([serialize("shadowBaker")],GroundPlugin.prototype,"_shadowBaker",void 0);class EXRLoader extends three_module.BRH{constructor(o){super(o),this.type=three_module.ix0}parse(o){const c=Math.pow(2.7182818,2.2),d={l:0,c:0,lc:0};function _(or,yr,Pr,jr,Tr){for(;Pr<or;)yr=yr<<8|pr(jr,Tr),Pr+=8;Pr-=or,d.l=yr>>Pr&(1<<or)-1,d.c=yr,d.lc=Pr}const b=new Array(59);function _e(or){return 63&or}function it(or){return or>>6}const nt={c:0,lc:0};function at(or,yr,Pr,jr){or=or<<8|pr(Pr,jr),yr+=8,nt.c=or,nt.lc=yr}const ut={c:0,lc:0};function pt(or,yr,Pr,jr,Tr,Br,Gr,tn,nn){if(or==yr){jr<8&&(at(Pr,jr,Tr,Br),Pr=nt.c,jr=nt.lc);let gn=Pr>>(jr-=8);if(gn=new Uint8Array([gn])[0],tn.value+gn>nn)return!1;const xn=Gr[tn.value-1];for(;gn-- >0;)Gr[tn.value++]=xn}else{if(!(tn.value<nn))return!1;Gr[tn.value++]=or}ut.c=Pr,ut.lc=jr}function mt(or){return 65535&or}function ft(or){const yr=mt(or);return yr>32767?yr-65536:yr}const vt={a:0,b:0};function xt(or,yr){const Pr=ft(or),jr=ft(yr),Tr=Pr+(1&jr)+(jr>>1),Br=Tr,Gr=Tr-jr;vt.a=Br,vt.b=Gr}function At(or,yr){const Pr=mt(or),jr=mt(yr),Tr=Pr-(jr>>1)&65535,Br=jr+Tr-32768&65535;vt.a=Br,vt.b=Tr}function Ct(or,yr,Pr,jr,Tr,Br,Gr){const tn=Gr<16384,nn=Pr>Tr?Tr:Pr;let gn,xn,Mn=1;for(;Mn<=nn;)Mn<<=1;for(Mn>>=1,gn=Mn,Mn>>=1;Mn>=1;){xn=0;const An=xn+Br*(Tr-gn),vn=Br*Mn,Cn=Br*gn,rn=jr*Mn,En=jr*gn;let Hn,Qn,ks,Wn;for(;xn<=An;xn+=Cn){let Gn=xn;const Xn=xn+jr*(Pr-gn);for(;Gn<=Xn;Gn+=En){const Jn=Gn+rn,Vs=Gn+vn,Gs=Vs+rn;tn?(xt(or[Gn+yr],or[Vs+yr]),Hn=vt.a,ks=vt.b,xt(or[Jn+yr],or[Gs+yr]),Qn=vt.a,Wn=vt.b,xt(Hn,Qn),or[Gn+yr]=vt.a,or[Jn+yr]=vt.b,xt(ks,Wn),or[Vs+yr]=vt.a,or[Gs+yr]=vt.b):(At(or[Gn+yr],or[Vs+yr]),Hn=vt.a,ks=vt.b,At(or[Jn+yr],or[Gs+yr]),Qn=vt.a,Wn=vt.b,At(Hn,Qn),or[Gn+yr]=vt.a,or[Jn+yr]=vt.b,At(ks,Wn),or[Vs+yr]=vt.a,or[Gs+yr]=vt.b)}if(Pr&Mn){const Jn=Gn+vn;tn?xt(or[Gn+yr],or[Jn+yr]):At(or[Gn+yr],or[Jn+yr]),Hn=vt.a,or[Jn+yr]=vt.b,or[Gn+yr]=Hn}}if(Tr&Mn){let Gn=xn;const Xn=xn+jr*(Pr-gn);for(;Gn<=Xn;Gn+=En){const Jn=Gn+rn;tn?xt(or[Gn+yr],or[Jn+yr]):At(or[Gn+yr],or[Jn+yr]),Hn=vt.a,or[Jn+yr]=vt.b,or[Gn+yr]=Hn}}gn=Mn,Mn>>=1}return xn}function Et(or,yr,Pr,jr,Tr,Br){const Gr=Pr.value,tn=dr(yr,Pr),nn=dr(yr,Pr);Pr.value+=4;const gn=dr(yr,Pr);if(Pr.value+=4,tn<0||tn>=65537||nn<0||nn>=65537)throw new Error("Something wrong with HUF_ENCSIZE");const xn=new Array(65537),Mn=new Array(16384);if(function(An){for(let vn=0;vn<16384;vn++)An[vn]={},An[vn].len=0,An[vn].lit=0,An[vn].p=null}(Mn),function(An,vn,Cn,rn,En,Hn){const Qn=vn;let ks=0,Wn=0;for(;rn<=En;rn++){if(Qn.value-vn.value>Cn)return!1;_(6,ks,Wn,An,Qn);const Gn=d.l;if(ks=d.c,Wn=d.lc,Hn[rn]=Gn,Gn==63){if(Qn.value-vn.value>Cn)throw new Error("Something wrong with hufUnpackEncTable");_(8,ks,Wn,An,Qn);let Xn=d.l+6;if(ks=d.c,Wn=d.lc,rn+Xn>En+1)throw new Error("Something wrong with hufUnpackEncTable");for(;Xn--;)Hn[rn++]=0;rn--}else if(Gn>=59){let Xn=Gn-59+2;if(rn+Xn>En+1)throw new Error("Something wrong with hufUnpackEncTable");for(;Xn--;)Hn[rn++]=0;rn--}}(function(Gn){for(let Jn=0;Jn<=58;++Jn)b[Jn]=0;for(let Jn=0;Jn<65537;++Jn)b[Gn[Jn]]+=1;let Xn=0;for(let Jn=58;Jn>0;--Jn){const Vs=Xn+b[Jn]>>1;b[Jn]=Xn,Xn=Vs}for(let Jn=0;Jn<65537;++Jn){const Vs=Gn[Jn];Vs>0&&(Gn[Jn]=Vs|b[Vs]++<<6)}})(Hn)}(or,Pr,jr-(Pr.value-Gr),tn,nn,xn),gn>8*(jr-(Pr.value-Gr)))throw new Error("Something wrong with hufUncompress");(function(An,vn,Cn,rn){for(;vn<=Cn;vn++){const En=it(An[vn]),Hn=_e(An[vn]);if(En>>Hn)throw new Error("Invalid table entry");if(Hn>14){const Qn=rn[En>>Hn-14];if(Qn.len)throw new Error("Invalid table entry");if(Qn.lit++,Qn.p){const ks=Qn.p;Qn.p=new Array(Qn.lit);for(let Wn=0;Wn<Qn.lit-1;++Wn)Qn.p[Wn]=ks[Wn]}else Qn.p=new Array(1);Qn.p[Qn.lit-1]=vn}else if(Hn){let Qn=0;for(let ks=1<<14-Hn;ks>0;ks--){const Wn=rn[(En<<14-Hn)+Qn];if(Wn.len||Wn.p)throw new Error("Invalid table entry");Wn.len=Hn,Wn.lit=vn,Qn++}}}})(xn,tn,nn,Mn),function(An,vn,Cn,rn,En,Hn,Qn,ks,Wn){let Gn=0,Xn=0;const Jn=Qn,Vs=Math.trunc(rn.value+(En+7)/8);for(;rn.value<Vs;)for(at(Gn,Xn,Cn,rn),Gn=nt.c,Xn=nt.lc;Xn>=14;){const $s=vn[Gn>>Xn-14&16383];if($s.len)Xn-=$s.len,pt($s.lit,Hn,Gn,Xn,Cn,rn,ks,Wn,Jn),Gn=ut.c,Xn=ut.lc;else{if(!$s.p)throw new Error("hufDecode issues");let to;for(to=0;to<$s.lit;to++){const Mo=_e(An[$s.p[to]]);for(;Xn<Mo&&rn.value<Vs;)at(Gn,Xn,Cn,rn),Gn=nt.c,Xn=nt.lc;if(Xn>=Mo&&it(An[$s.p[to]])==(Gn>>Xn-Mo&(1<<Mo)-1)){Xn-=Mo,pt($s.p[to],Hn,Gn,Xn,Cn,rn,ks,Wn,Jn),Gn=ut.c,Xn=ut.lc;break}}if(to==$s.lit)throw new Error("hufDecode issues")}}const Gs=8-En&7;for(Gn>>=Gs,Xn-=Gs;Xn>0;){const $s=vn[Gn<<14-Xn&16383];if(!$s.len)throw new Error("hufDecode issues");Xn-=$s.len,pt($s.lit,Hn,Gn,Xn,Cn,rn,ks,Wn,Jn),Gn=ut.c,Xn=ut.lc}}(xn,Mn,or,Pr,gn,nn,Br,Tr,{value:0})}function Tt(or){for(let yr=1;yr<or.length;yr++){const Pr=or[yr-1]+or[yr]-128;or[yr]=Pr}}function kt(or,yr){let Pr=0,jr=Math.floor((or.length+1)/2),Tr=0;const Br=or.length-1;for(;!(Tr>Br||(yr[Tr++]=or[Pr++],Tr>Br));)yr[Tr++]=or[jr++]}function Dt(or){let yr=or.byteLength;const Pr=new Array;let jr=0;const Tr=new DataView(or);for(;yr>0;){const Br=Tr.getInt8(jr++);if(Br<0){const Gr=-Br;yr-=Gr+1;for(let tn=0;tn<Gr;tn++)Pr.push(Tr.getUint8(jr++))}else{const Gr=Br;yr-=2;const tn=Tr.getUint8(jr++);for(let nn=0;nn<Gr+1;nn++)Pr.push(tn)}}return Pr}function zt(or,yr,Pr){let jr,Tr=1;for(;Tr<64;)jr=yr[or.value],jr==65280?Tr=64:jr>>8==255?Tr+=255&jr:(Pr[Tr]=jr,Tr++),or.value++}function Bt(or){const yr=.5*Math.cos(.7853975),Pr=.5*Math.cos(3.14159/16),jr=.5*Math.cos(3.14159/8),Tr=.5*Math.cos(3*3.14159/16),Br=.5*Math.cos(.981746875),Gr=.5*Math.cos(3*3.14159/8),tn=.5*Math.cos(1.374445625),nn=new Array(4),gn=new Array(4),xn=new Array(4),Mn=new Array(4);for(let An=0;An<8;++An){const vn=8*An;nn[0]=jr*or[vn+2],nn[1]=Gr*or[vn+2],nn[2]=jr*or[vn+6],nn[3]=Gr*or[vn+6],gn[0]=Pr*or[vn+1]+Tr*or[vn+3]+Br*or[vn+5]+tn*or[vn+7],gn[1]=Tr*or[vn+1]-tn*or[vn+3]-Pr*or[vn+5]-Br*or[vn+7],gn[2]=Br*or[vn+1]-Pr*or[vn+3]+tn*or[vn+5]+Tr*or[vn+7],gn[3]=tn*or[vn+1]-Br*or[vn+3]+Tr*or[vn+5]-Pr*or[vn+7],xn[0]=yr*(or[vn+0]+or[vn+4]),xn[3]=yr*(or[vn+0]-or[vn+4]),xn[1]=nn[0]+nn[3],xn[2]=nn[1]-nn[2],Mn[0]=xn[0]+xn[1],Mn[1]=xn[3]+xn[2],Mn[2]=xn[3]-xn[2],Mn[3]=xn[0]-xn[1],or[vn+0]=Mn[0]+gn[0],or[vn+1]=Mn[1]+gn[1],or[vn+2]=Mn[2]+gn[2],or[vn+3]=Mn[3]+gn[3],or[vn+4]=Mn[3]-gn[3],or[vn+5]=Mn[2]-gn[2],or[vn+6]=Mn[1]-gn[1],or[vn+7]=Mn[0]-gn[0]}for(let An=0;An<8;++An)nn[0]=jr*or[16+An],nn[1]=Gr*or[16+An],nn[2]=jr*or[48+An],nn[3]=Gr*or[48+An],gn[0]=Pr*or[8+An]+Tr*or[24+An]+Br*or[40+An]+tn*or[56+An],gn[1]=Tr*or[8+An]-tn*or[24+An]-Pr*or[40+An]-Br*or[56+An],gn[2]=Br*or[8+An]-Pr*or[24+An]+tn*or[40+An]+Tr*or[56+An],gn[3]=tn*or[8+An]-Br*or[24+An]+Tr*or[40+An]-Pr*or[56+An],xn[0]=yr*(or[An]+or[32+An]),xn[3]=yr*(or[An]-or[32+An]),xn[1]=nn[0]+nn[3],xn[2]=nn[1]-nn[2],Mn[0]=xn[0]+xn[1],Mn[1]=xn[3]+xn[2],Mn[2]=xn[3]-xn[2],Mn[3]=xn[0]-xn[1],or[0+An]=Mn[0]+gn[0],or[8+An]=Mn[1]+gn[1],or[16+An]=Mn[2]+gn[2],or[24+An]=Mn[3]+gn[3],or[32+An]=Mn[3]-gn[3],or[40+An]=Mn[2]-gn[2],or[48+An]=Mn[1]-gn[1],or[56+An]=Mn[0]-gn[0]}function Rt(or){for(let yr=0;yr<64;++yr){const Pr=or[0][yr],jr=or[1][yr],Tr=or[2][yr];or[0][yr]=Pr+1.5747*Tr,or[1][yr]=Pr-.1873*jr-.4682*Tr,or[2][yr]=Pr+1.8556*jr}}function Ut(or,yr,Pr){for(let Tr=0;Tr<64;++Tr)yr[Pr+Tr]=three_module.GxU.toHalfFloat((jr=or[Tr])<=1?Math.sign(jr)*Math.pow(Math.abs(jr),2.2):Math.sign(jr)*Math.pow(c,Math.abs(jr)-1));var jr}function Ht(or){return new DataView(or.array.buffer,or.offset.value,or.size)}function Jt(or){const yr=or.viewer.buffer.slice(or.offset.value,or.offset.value+or.size),Pr=new Uint8Array(Dt(yr)),jr=new Uint8Array(Pr.length);return Tt(Pr),kt(Pr,jr),new DataView(jr.buffer)}function Kt(or){const yr=fflate_module_unzlibSync(or.array.slice(or.offset.value,or.offset.value+or.size)),Pr=new Uint8Array(yr.length);return Tt(yr),kt(yr,Pr),new DataView(Pr.buffer)}function sr(or){const yr=or.viewer,Pr={value:or.offset.value},jr=new Uint16Array(or.width*or.scanlineBlockSize*(or.channels*or.type)),Tr=new Uint8Array(8192);let Br=0;const Gr=new Array(or.channels);for(let Cn=0;Cn<or.channels;Cn++)Gr[Cn]={},Gr[Cn].start=Br,Gr[Cn].end=Gr[Cn].start,Gr[Cn].nx=or.width,Gr[Cn].ny=or.lines,Gr[Cn].size=or.type,Br+=Gr[Cn].nx*Gr[Cn].ny*Gr[Cn].size;const tn=rr(yr,Pr),nn=rr(yr,Pr);if(nn>=8192)throw new Error("Something is wrong with PIZ_COMPRESSION BITMAP_SIZE");if(tn<=nn)for(let Cn=0;Cn<nn-tn+1;Cn++)Tr[Cn+tn]=ur(yr,Pr);const gn=new Uint16Array(65536),xn=function(Cn,rn){let En=0;for(let Qn=0;Qn<65536;++Qn)(Qn==0||Cn[Qn>>3]&1<<(7&Qn))&&(rn[En++]=Qn);const Hn=En-1;for(;En<65536;)rn[En++]=0;return Hn}(Tr,gn),Mn=dr(yr,Pr);Et(or.array,yr,Pr,Mn,jr,Br);for(let Cn=0;Cn<or.channels;++Cn){const rn=Gr[Cn];for(let En=0;En<Gr[Cn].size;++En)Ct(jr,rn.start+En,rn.nx,rn.size,rn.ny,rn.nx*rn.size,xn)}(function(Cn,rn,En){for(let Hn=0;Hn<En;++Hn)rn[Hn]=Cn[rn[Hn]]})(gn,jr,Br);let An=0;const vn=new Uint8Array(jr.buffer.byteLength);for(let Cn=0;Cn<or.lines;Cn++)for(let rn=0;rn<or.channels;rn++){const En=Gr[rn],Hn=En.nx*En.size,Qn=new Uint8Array(jr.buffer,2*En.end,2*Hn);vn.set(Qn,An),An+=2*Hn,En.end+=Hn}return new DataView(vn.buffer)}function ir(or){const yr=fflate_module_unzlibSync(or.array.slice(or.offset.value,or.offset.value+or.size)),Pr=or.lines*or.channels*or.width,jr=or.type==1?new Uint16Array(Pr):new Uint32Array(Pr);let Tr=0,Br=0;const Gr=new Array(4);for(let tn=0;tn<or.lines;tn++)for(let nn=0;nn<or.channels;nn++){let gn=0;switch(or.type){case 1:Gr[0]=Tr,Gr[1]=Gr[0]+or.width,Tr=Gr[1]+or.width;for(let xn=0;xn<or.width;++xn)gn+=yr[Gr[0]++]<<8|yr[Gr[1]++],jr[Br]=gn,Br++;break;case 2:Gr[0]=Tr,Gr[1]=Gr[0]+or.width,Gr[2]=Gr[1]+or.width,Tr=Gr[2]+or.width;for(let xn=0;xn<or.width;++xn)gn+=yr[Gr[0]++]<<24|yr[Gr[1]++]<<16|yr[Gr[2]++]<<8,jr[Br]=gn,Br++}}return new DataView(jr.buffer)}function cr(or){const yr=or.viewer,Pr={value:or.offset.value},jr=new Uint8Array(or.width*or.lines*(or.channels*or.type*2)),Tr={version:xr(yr,Pr),unknownUncompressedSize:xr(yr,Pr),unknownCompressedSize:xr(yr,Pr),acCompressedSize:xr(yr,Pr),dcCompressedSize:xr(yr,Pr),rleCompressedSize:xr(yr,Pr),rleUncompressedSize:xr(yr,Pr),rleRawSize:xr(yr,Pr),totalAcUncompressedCount:xr(yr,Pr),totalDcUncompressedCount:xr(yr,Pr),acCompression:xr(yr,Pr)};if(Tr.version<2)throw new Error("EXRLoader.parse: "+Tn.compression+" version "+Tr.version+" is unsupported");const Br=new Array;let Gr=rr(yr,Pr)-2;for(;Gr>0;){const rn=lr(yr.buffer,Pr),En=ur(yr,Pr),Hn=En>>2&3,Qn=new Int8Array([(En>>4)-1])[0],ks=ur(yr,Pr);Br.push({name:rn,index:Qn,type:ks,compression:Hn}),Gr-=rn.length+3}const tn=Tn.channels,nn=new Array(or.channels);for(let rn=0;rn<or.channels;++rn){const En=nn[rn]={},Hn=tn[rn];En.name=Hn.name,En.compression=0,En.decoded=!1,En.type=Hn.pixelType,En.pLinear=Hn.pLinear,En.width=or.width,En.height=or.lines}const gn={idx:new Array(3)};for(let rn=0;rn<or.channels;++rn){const En=nn[rn];for(let Hn=0;Hn<Br.length;++Hn){const Qn=Br[Hn];En.name==Qn.name&&(En.compression=Qn.compression,Qn.index>=0&&(gn.idx[Qn.index]=rn),En.offset=rn)}}let xn,Mn,An;if(Tr.acCompressedSize>0)switch(Tr.acCompression){case 0:xn=new Uint16Array(Tr.totalAcUncompressedCount),Et(or.array,yr,Pr,Tr.acCompressedSize,xn,Tr.totalAcUncompressedCount);break;case 1:const rn=fflate_module_unzlibSync(or.array.slice(Pr.value,Pr.value+Tr.totalAcUncompressedCount));xn=new Uint16Array(rn.buffer),Pr.value+=Tr.totalAcUncompressedCount}if(Tr.dcCompressedSize>0){const rn={array:or.array,offset:Pr,size:Tr.dcCompressedSize};Mn=new Uint16Array(Kt(rn).buffer),Pr.value+=Tr.dcCompressedSize}Tr.rleRawSize>0&&(An=Dt(fflate_module_unzlibSync(or.array.slice(Pr.value,Pr.value+Tr.rleCompressedSize)).buffer),Pr.value+=Tr.rleCompressedSize);let vn=0;const Cn=new Array(nn.length);for(let rn=0;rn<Cn.length;++rn)Cn[rn]=new Array;for(let rn=0;rn<or.lines;++rn)for(let En=0;En<nn.length;++En)Cn[En].push(vn),vn+=nn[En].width*or.type*2;(function(rn,En,Hn,Qn,ks,Wn){let Gn=new DataView(Wn.buffer);const Xn=Hn[rn.idx[0]].width,Jn=Hn[rn.idx[0]].height,Vs=Math.floor(Xn/8),Gs=Math.ceil(Xn/8),$s=Math.ceil(Jn/8),to=Xn-8*(Gs-1),Mo=Jn-8*($s-1),rp={value:0},ho=new Array(3),ro=new Array(3),xa=new Array(3),io=new Array(3),Ml=new Array(3);for(let Ss=0;Ss<3;++Ss)Ml[Ss]=En[rn.idx[Ss]],ho[Ss]=Ss<1?0:ho[Ss-1]+Gs*$s,ro[Ss]=new Float32Array(64),xa[Ss]=new Uint16Array(64),io[Ss]=new Uint16Array(64*Gs);for(let Ss=0;Ss<$s;++Ss){let Il=8;Ss==$s-1&&(Il=Mo);let mo=8;for(let As=0;As<Gs;++As){As==Gs-1&&(mo=to);for(let Ps=0;Ps<3;++Ps)xa[Ps].fill(0),xa[Ps][0]=ks[ho[Ps]++],zt(rp,Qn,xa[Ps]),kn=xa[Ps],(Nn=ro[Ps])[0]=_r(kn[0]),Nn[1]=_r(kn[1]),Nn[2]=_r(kn[5]),Nn[3]=_r(kn[6]),Nn[4]=_r(kn[14]),Nn[5]=_r(kn[15]),Nn[6]=_r(kn[27]),Nn[7]=_r(kn[28]),Nn[8]=_r(kn[2]),Nn[9]=_r(kn[4]),Nn[10]=_r(kn[7]),Nn[11]=_r(kn[13]),Nn[12]=_r(kn[16]),Nn[13]=_r(kn[26]),Nn[14]=_r(kn[29]),Nn[15]=_r(kn[42]),Nn[16]=_r(kn[3]),Nn[17]=_r(kn[8]),Nn[18]=_r(kn[12]),Nn[19]=_r(kn[17]),Nn[20]=_r(kn[25]),Nn[21]=_r(kn[30]),Nn[22]=_r(kn[41]),Nn[23]=_r(kn[43]),Nn[24]=_r(kn[9]),Nn[25]=_r(kn[11]),Nn[26]=_r(kn[18]),Nn[27]=_r(kn[24]),Nn[28]=_r(kn[31]),Nn[29]=_r(kn[40]),Nn[30]=_r(kn[44]),Nn[31]=_r(kn[53]),Nn[32]=_r(kn[10]),Nn[33]=_r(kn[19]),Nn[34]=_r(kn[23]),Nn[35]=_r(kn[32]),Nn[36]=_r(kn[39]),Nn[37]=_r(kn[45]),Nn[38]=_r(kn[52]),Nn[39]=_r(kn[54]),Nn[40]=_r(kn[20]),Nn[41]=_r(kn[22]),Nn[42]=_r(kn[33]),Nn[43]=_r(kn[38]),Nn[44]=_r(kn[46]),Nn[45]=_r(kn[51]),Nn[46]=_r(kn[55]),Nn[47]=_r(kn[60]),Nn[48]=_r(kn[21]),Nn[49]=_r(kn[34]),Nn[50]=_r(kn[37]),Nn[51]=_r(kn[47]),Nn[52]=_r(kn[50]),Nn[53]=_r(kn[56]),Nn[54]=_r(kn[59]),Nn[55]=_r(kn[61]),Nn[56]=_r(kn[35]),Nn[57]=_r(kn[36]),Nn[58]=_r(kn[48]),Nn[59]=_r(kn[49]),Nn[60]=_r(kn[57]),Nn[61]=_r(kn[58]),Nn[62]=_r(kn[62]),Nn[63]=_r(kn[63]),Bt(ro[Ps]);Rt(ro);for(let Ps=0;Ps<3;++Ps)Ut(ro[Ps],io[Ps],64*As)}let Ws=0;for(let As=0;As<3;++As){const Ps=Hn[rn.idx[As]].type;for(let Fo=8*Ss;Fo<8*Ss+Il;++Fo){Ws=Ml[As][Fo];for(let Io=0;Io<Vs;++Io){const xo=64*Io+8*(7&Fo);Gn.setUint16(Ws+0*Ps,io[As][xo+0],!0),Gn.setUint16(Ws+2*Ps,io[As][xo+1],!0),Gn.setUint16(Ws+4*Ps,io[As][xo+2],!0),Gn.setUint16(Ws+6*Ps,io[As][xo+3],!0),Gn.setUint16(Ws+8*Ps,io[As][xo+4],!0),Gn.setUint16(Ws+10*Ps,io[As][xo+5],!0),Gn.setUint16(Ws+12*Ps,io[As][xo+6],!0),Gn.setUint16(Ws+14*Ps,io[As][xo+7],!0),Ws+=16*Ps}}if(Vs!=Gs)for(let Fo=8*Ss;Fo<8*Ss+Il;++Fo){const Io=Ml[As][Fo]+8*Vs*2*Ps,xo=64*Vs+8*(7&Fo);for(let yl=0;yl<mo;++yl)Gn.setUint16(Io+2*yl*Ps,io[As][xo+yl],!0)}}}var kn,Nn;const no=new Uint16Array(Xn);Gn=new DataView(Wn.buffer);for(let Ss=0;Ss<3;++Ss){Hn[rn.idx[Ss]].decoded=!0;const Il=Hn[rn.idx[Ss]].type;if(Hn[Ss].type==2)for(let mo=0;mo<Jn;++mo){const Ws=Ml[Ss][mo];for(let As=0;As<Xn;++As)no[As]=Gn.getUint16(Ws+2*As*Il,!0);for(let As=0;As<Xn;++As)Gn.setFloat32(Ws+2*As*Il,_r(no[As]),!0)}}})(gn,Cn,nn,xn,Mn,jr);for(let rn=0;rn<nn.length;++rn){const En=nn[rn];if(!En.decoded){if(En.compression!==2)throw new Error("EXRLoader.parse: unsupported channel compression");{let Hn=0,Qn=0;for(let ks=0;ks<or.lines;++ks){let Wn=Cn[rn][Hn];for(let Gn=0;Gn<En.width;++Gn){for(let Xn=0;Xn<2*En.type;++Xn)jr[Wn++]=An[Qn+Xn*En.width*En.height];Qn++}Hn++}}}}return new DataView(jr.buffer)}function lr(or,yr){const Pr=new Uint8Array(or);let jr=0;for(;Pr[yr.value+jr]!=0;)jr+=1;const Tr=new TextDecoder().decode(Pr.slice(yr.value,yr.value+jr));return yr.value=yr.value+jr+1,Tr}function hr(or,yr){const Pr=or.getInt32(yr.value,!0);return yr.value=yr.value+4,Pr}function dr(or,yr){const Pr=or.getUint32(yr.value,!0);return yr.value=yr.value+4,Pr}function pr(or,yr){const Pr=or[yr.value];return yr.value=yr.value+1,Pr}function ur(or,yr){const Pr=or.getUint8(yr.value);return yr.value=yr.value+1,Pr}const xr=function(or,yr){let Pr;return Pr="getBigInt64"in DataView.prototype?Number(or.getBigInt64(yr.value,!0)):or.getUint32(yr.value+4,!0)+Number(or.getUint32(yr.value,!0)<<32),yr.value+=8,Pr};function vr(or,yr){const Pr=or.getFloat32(yr.value,!0);return yr.value+=4,Pr}function Dr(or,yr){return three_module.GxU.toHalfFloat(vr(or,yr))}function _r(or){const yr=(31744&or)>>10,Pr=1023&or;return(or>>15?-1:1)*(yr?yr===31?Pr?NaN:1/0:Math.pow(2,yr-15)*(1+Pr/1024):Pr/1024*6103515625e-14)}function rr(or,yr){const Pr=or.getUint16(yr.value,!0);return yr.value+=2,Pr}function mr(or,yr){return _r(rr(or,yr))}function Rr(or,yr,Pr,jr,Tr){return jr==="string"||jr==="stringvector"||jr==="iccProfile"?function(Br,Gr,tn){const nn=new TextDecoder().decode(new Uint8Array(Br).slice(Gr.value,Gr.value+tn));return Gr.value=Gr.value+tn,nn}(yr,Pr,Tr):jr==="chlist"?function(Br,Gr,tn,nn){const gn=tn.value,xn=[];for(;tn.value<gn+nn-1;){const Mn=lr(Gr,tn),An=hr(Br,tn),vn=ur(Br,tn);tn.value+=3;const Cn=hr(Br,tn),rn=hr(Br,tn);xn.push({name:Mn,pixelType:An,pLinear:vn,xSampling:Cn,ySampling:rn})}return tn.value+=1,xn}(or,yr,Pr,Tr):jr==="chromaticities"?function(Br,Gr){return{redX:vr(Br,Gr),redY:vr(Br,Gr),greenX:vr(Br,Gr),greenY:vr(Br,Gr),blueX:vr(Br,Gr),blueY:vr(Br,Gr),whiteX:vr(Br,Gr),whiteY:vr(Br,Gr)}}(or,Pr):jr==="compression"?function(Br,Gr){return["NO_COMPRESSION","RLE_COMPRESSION","ZIPS_COMPRESSION","ZIP_COMPRESSION","PIZ_COMPRESSION","PXR24_COMPRESSION","B44_COMPRESSION","B44A_COMPRESSION","DWAA_COMPRESSION","DWAB_COMPRESSION"][ur(Br,Gr)]}(or,Pr):jr==="box2i"?function(Br,Gr){return{xMin:dr(Br,Gr),yMin:dr(Br,Gr),xMax:dr(Br,Gr),yMax:dr(Br,Gr)}}(or,Pr):jr==="lineOrder"?function(Br,Gr){return["INCREASING_Y"][ur(Br,Gr)]}(or,Pr):jr==="float"?vr(or,Pr):jr==="v2f"?function(Br,Gr){return[vr(Br,Gr),vr(Br,Gr)]}(or,Pr):jr==="v3f"?function(Br,Gr){return[vr(Br,Gr),vr(Br,Gr),vr(Br,Gr)]}(or,Pr):jr==="int"?hr(or,Pr):jr==="rational"?function(Br,Gr){return[hr(Br,Gr),dr(Br,Gr)]}(or,Pr):jr==="timecode"?function(Br,Gr){return[dr(Br,Gr),dr(Br,Gr)]}(or,Pr):jr==="preview"?(Pr.value+=Tr,"skipped"):void(Pr.value+=Tr)}const Yr=new DataView(o),Zr=new Uint8Array(o),cn={value:0},Tn=function(or,yr,Pr){const jr={};if(or.getUint32(0,!0)!=20000630)throw new Error("THREE.EXRLoader: Provided file doesn't appear to be in OpenEXR format.");jr.version=or.getUint8(4);const Tr=or.getUint8(5);jr.spec={singleTile:!!(2&Tr),longName:!!(4&Tr),deepFormat:!!(8&Tr),multiPart:!!(16&Tr)},Pr.value=8;let Br=!0;for(;Br;){const Gr=lr(yr,Pr);if(Gr==0)Br=!1;else{const tn=lr(yr,Pr),nn=Rr(or,yr,Pr,tn,dr(or,Pr));nn===void 0?console.warn(`THREE.EXRLoader: Skipped unknown header attribute type '${tn}'.`):jr[Gr]=nn}}if(-5&Tr)throw console.error("THREE.EXRHeader:",jr),new Error("THREE.EXRLoader: Provided file is currently unsupported.");return jr}(Yr,o,cn),yn=function(or,yr,Pr,jr,Tr){const Br={size:0,viewer:yr,array:Pr,offset:jr,width:or.dataWindow.xMax-or.dataWindow.xMin+1,height:or.dataWindow.yMax-or.dataWindow.yMin+1,channels:or.channels.length,bytesPerLine:null,lines:null,inputSize:null,type:or.channels[0].pixelType,uncompress:null,getter:null,format:null,colorSpace:three_module.Zr2};switch(or.compression){case"NO_COMPRESSION":Br.lines=1,Br.uncompress=Ht;break;case"RLE_COMPRESSION":Br.lines=1,Br.uncompress=Jt;break;case"ZIPS_COMPRESSION":Br.lines=1,Br.uncompress=Kt;break;case"ZIP_COMPRESSION":Br.lines=16,Br.uncompress=Kt;break;case"PIZ_COMPRESSION":Br.lines=32,Br.uncompress=sr;break;case"PXR24_COMPRESSION":Br.lines=16,Br.uncompress=ir;break;case"DWAA_COMPRESSION":Br.lines=32,Br.uncompress=cr;break;case"DWAB_COMPRESSION":Br.lines=256,Br.uncompress=cr;break;default:throw new Error("EXRLoader.parse: "+or.compression+" is unsupported")}if(Br.scanlineBlockSize=Br.lines,Br.type==1)switch(Tr){case three_module.RQf:Br.getter=mr,Br.inputSize=2;break;case three_module.ix0:Br.getter=rr,Br.inputSize=2}else{if(Br.type!=2)throw new Error("EXRLoader.parse: unsupported pixelType "+Br.type+" for "+or.compression+".");switch(Tr){case three_module.RQf:Br.getter=vr,Br.inputSize=4;break;case three_module.ix0:Br.getter=Dr,Br.inputSize=4}}Br.blockCount=(or.dataWindow.yMax+1)/Br.scanlineBlockSize;for(let tn=0;tn<Br.blockCount;tn++)xr(yr,jr);Br.outputChannels=Br.channels==3?4:Br.channels;const Gr=Br.width*Br.height*Br.outputChannels;switch(Tr){case three_module.RQf:Br.byteArray=new Float32Array(Gr),Br.channels<Br.outputChannels&&Br.byteArray.fill(1,0,Gr);break;case three_module.ix0:Br.byteArray=new Uint16Array(Gr),Br.channels<Br.outputChannels&&Br.byteArray.fill(15360,0,Gr);break;default:console.error("THREE.EXRLoader: unsupported type: ",Tr)}return Br.bytesPerLine=Br.width*Br.inputSize*Br.channels,Br.outputChannels==4?(Br.format=three_module.GWd,Br.colorSpace=three_module.Zr2):(Br.format=three_module.VT0,Br.colorSpace=three_module.jf0),Br}(Tn,Yr,Zr,cn,this.type),zn={value:0},gs={R:0,G:1,B:2,A:3,Y:0};for(let or=0;or<yn.height/yn.scanlineBlockSize;or++){const yr=dr(Yr,cn);yn.size=dr(Yr,cn),yn.lines=yr+yn.scanlineBlockSize>yn.height?yn.height-yr:yn.scanlineBlockSize;const Pr=yn.size<yn.lines*yn.bytesPerLine?yn.uncompress(yn):Ht(yn);cn.value+=yn.size;for(let jr=0;jr<yn.scanlineBlockSize;jr++){const Tr=jr+or*yn.scanlineBlockSize;if(Tr>=yn.height)break;for(let Br=0;Br<yn.channels;Br++){const Gr=gs[Tn.channels[Br].name];for(let tn=0;tn<yn.width;tn++){zn.value=(jr*(yn.channels*yn.width)+Br*yn.width+tn)*yn.inputSize;const nn=(yn.height-1-Tr)*(yn.width*yn.outputChannels)+tn*yn.outputChannels+Gr;yn.byteArray[nn]=yn.getter(Pr,zn)}}}}return{header:Tn,width:yn.width,height:yn.height,data:yn.byteArray,format:yn.format,colorSpace:yn.colorSpace,type:this.type}}setDataType(o){return this.type=o,this}load(o,c,d,_){return super.load(o,function(b,_e){b.colorSpace=_e.colorSpace,b.minFilter=three_module.k6q,b.magFilter=three_module.k6q,b.generateMipmaps=!1,b.flipY=!1,c&&c(b,_e)},d,_)}}class EXRLoadPlugin extends I$2{constructor(){super(...arguments),this.dependencies=[AssetManagerPlugin]}async onAdded(o){var c,d;this._importer||(this._importer=new Importer(class extends EXRLoader{constructor(_){super(_),this.setDataType(getTextureDataType(o.renderer.rendererObject))}},["exr"],!1)),(d=(c=o.getManager())===null||c===void 0?void 0:c.importer)===null||d===void 0||d.Importers.push(this._importer)}async onDispose(o){this._importer=void 0}async onRemove(o){var c,d;this._importer&&!((d=(c=o.getManager())===null||c===void 0?void 0:c.importer)===null||d===void 0)&&d.Importers&&o.getManager().importer.Importers.splice(o.getManager().importer.Importers.indexOf(this._importer),1),this._importer=void 0}}EXRLoadPlugin.PluginType="EXRLoadPlugin";const _3DMLoader_taskCache=new WeakMap;class Rhino3dmLoader extends three_module.aHM{constructor(o){super(o),this.libraryPath="",this.libraryPending=null,this.libraryBinary=null,this.libraryConfig={},this.url="",this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.workerConfig={},this.materials=[],this.warnings=[]}setLibraryPath(o){return this.libraryPath=o,this}setWorkerLimit(o){return this.workerLimit=o,this}load(o,c,d,_){const b=new three_module.Y9S(this.manager);b.setPath(this.path),b.setResponseType("arraybuffer"),b.setRequestHeader(this.requestHeader),this.url=o,b.load(o,_e=>{if(_3DMLoader_taskCache.has(_e))return _3DMLoader_taskCache.get(_e).promise.then(c).catch(_);this.decodeObjects(_e,o).then(it=>{it.userData.warnings=this.warnings,this.warnings=[],c(it)}).catch(it=>_(it))},d,_)}debug(){console.log("Task load: ",this.workerPool.map(o=>o._taskLoad))}decodeObjects(o,c){let d,_;const b=o.byteLength,_e=this._getWorker(b).then(it=>(d=it,_=this.workerNextTaskID++,new Promise((nt,at)=>{d._callbacks[_]={resolve:nt,reject:at},d.postMessage({type:"decode",id:_,buffer:o},[o])}))).then(it=>this._createGeometry(it.data)).catch(it=>{throw it});return _e.catch(()=>!0).then(()=>{d&&_&&this._releaseTask(d,_)}),_3DMLoader_taskCache.set(o,{url:c,promise:_e}),_e}parse(o,c,d){this.decodeObjects(o,"").then(_=>{_.userData.warnings=this.warnings,c(_)}).catch(_=>d(_))}_compareMaterials(o){if(this.materials.includes(o))return o;const c={};c.name=o.name,c.color={},c.color.r=o.color.r,c.color.g=o.color.g,c.color.b=o.color.b,c.type=o.type,c.vertexColors=o.vertexColors;const d=JSON.stringify(c);for(let _=0;_<this.materials.length;_++){const b=this.materials[_],_e={};if(_e.name=b.name,_e.color={},_e.color.r=b.color.r,_e.color.g=b.color.g,_e.color.b=b.color.b,_e.type=b.type,_e.vertexColors=b.vertexColors,JSON.stringify(_e)===d)return b}return this.materials.push(o),o}_createMaterial(o,c){if(o===void 0)return new three_module._4j({color:new three_module.Q1f(1,1,1),metalness:.8,name:three_module.aHM.DEFAULT_MATERIAL_NAME,side:three_module.$EB});const d=new three_module.uSd({color:new three_module.Q1f(o.diffuseColor.r/255,o.diffuseColor.g/255,o.diffuseColor.b/255),emissive:new three_module.Q1f(o.emissionColor.r,o.emissionColor.g,o.emissionColor.b),flatShading:o.disableLighting,ior:o.indexOfRefraction,name:o.name,reflectivity:o.reflectivity,opacity:1-o.transparency,side:three_module.$EB,specularColor:o.specularColor,transparent:o.transparency>0});if(d.userData.id=o.id,o.pbrSupported){const b=o.pbr;d.anisotropy=b.anisotropic,d.anisotropyRotation=b.anisotropicRotation,d.color=new three_module.Q1f(b.baseColor.r,b.baseColor.g,b.baseColor.b),d.clearcoat=b.clearcoat,d.clearcoatRoughness=b.clearcoatRoughness,d.metalness=b.metallic,d.transmission=1-b.opacity,d.roughness=b.roughness,d.sheen=b.sheen,d.specularIntensity=b.specular,d.thickness=b.subsurface}o.pbrSupported&&o.pbr.opacity===0&&o.transparency===1&&(d.opacity=.2,d.transmission=1);const _=new three_module.Tap;for(let b=0;b<o.textures.length;b++){const _e=o.textures[b];if(_e.image!==null){const it=_.load(_e.image);switch(_e.type){case"Bump":d.bumpMap=it;break;case"Diffuse":case"PBR_BaseColor":d.map=it;break;case"Emap":d.envMap=it;break;case"Opacity":d.transmissionMap=it;break;case"Transparency":case"PBR_Alpha":d.alphaMap=it,d.transparent=!0;break;case"PBR_AmbientOcclusion":d.aoMap=it;break;case"PBR_Anisotropic":d.anisotropyMap=it;break;case"PBR_Clearcoat":d.clearcoatMap=it;break;case"PBR_ClearcoatBump":d.clearcoatNormalMap=it;break;case"PBR_ClearcoatRoughness":d.clearcoatRoughnessMap=it;break;case"PBR_Displacement":d.displacementMap=it;break;case"PBR_Emission":d.emissiveMap=it;break;case"PBR_Metallic":d.metalnessMap=it;break;case"PBR_Roughness":d.roughnessMap=it;break;case"PBR_Sheen":d.sheenColorMap=it;break;case"PBR_Specular":d.specularColorMap=it;break;case"PBR_Subsurface":d.thicknessMap=it;break;default:this.warnings.push({message:`THREE.3DMLoader: No conversion exists for 3dm ${_e.type}.`,type:"no conversion"})}it.wrapS=_e.wrapU===0?three_module.GJx:three_module.ghU,it.wrapT=_e.wrapV===0?three_module.GJx:three_module.ghU,_e.repeat&&it.repeat.set(_e.repeat[0],_e.repeat[1])}}return c&&new EXRLoader().load(c.image,function(b){b.mapping=THREE.EquirectangularReflectionMapping,d.envMap=b}),d}_createGeometry(o){const c=new three_module.B69,d=[],_=[],b=[];c.userData.layers=o.layers,c.userData.groups=o.groups,c.userData.settings=o.settings,c.userData.settings.renderSettings=o.renderSettings,c.userData.strings=o.strings,c.userData.objectType="File3dm",c.userData.materials=null,c.name=this.url;let _e=o.objects;const it=o.materials;for(let nt=0;nt<_e.length;nt++){const at=_e[nt],ut=at.attributes;switch(at.objectType){case"InstanceDefinition":_.push(at);break;case"InstanceReference":b.push(at);break;default:let pt,mt=null;switch(ut.materialSource.name){case"ObjectMaterialSource_MaterialFromLayer":ut.layerIndex>=0&&(mt=o.layers[ut.layerIndex].renderMaterialIndex);break;case"ObjectMaterialSource_MaterialFromObject":mt=ut.materialIndex>=0?ut.materialIndex:null}if(mt>=0){const xt=it[mt];pt=this._createMaterial(xt,o.renderEnvironment)}else pt=this._createMaterial();pt=this._compareMaterials(pt);const ft=this._createObject(at,pt);if(ft===void 0)continue;const vt=o.layers[ut.layerIndex];ft.visible=!vt||vt.visible,ut.isInstanceDefinitionObject?d.push(ft):c.add(ft)}}for(let nt=0;nt<_.length;nt++){const at=_[nt];_e=[];for(let ut=0;ut<at.attributes.objectIds.length;ut++){const pt=at.attributes.objectIds[ut];for(let mt=0;mt<d.length;mt++)pt===d[mt].userData.attributes.id&&_e.push(d[mt])}for(let ut=0;ut<b.length;ut++){const pt=b[ut];if(pt.geometry.parentIdefId===at.attributes.id){const mt=pt.geometry.xform.array,ft=new three_module.kn4;if(ft.set(...mt),_e.length===1){const vt=_e[0].clone(!0);if(vt.name=pt.attributes.name||vt.name,vt.applyMatrix4(ft),pt.attributes.materialIndex>=0&&pt.attributes.materialIndex!==_e[0].userData.attributes.materialIndex){const xt=it[pt.attributes.materialIndex],At=this._createMaterial(xt);vt.material=this._compareMaterials(At)}if(vt.userData.defAttributes=vt.userData.attributes,vt.userData.defObjectType=vt.userData.objectType,vt.userData.attributes={...vt.userData.attributes,...pt.attributes},vt.userData.objectType=pt.objectType,pt.attributes.layerIndex!==void 0){const xt=o.layers[pt.attributes.layerIndex];vt.visible=xt?xt.visible:vt.visible}c.add(vt)}else{console.warn("THREE.Rhino3dmLoader: InstanceReference with multiple/no objects, not all properties will be copied.");const vt=new three_module.B69;vt.applyMatrix4(ft);for(let xt=0;xt<_e.length;xt++)vt.add(_e[xt].clone(!0));c.add(vt)}}}}return c.userData.materials=this.materials,c.name="",c}_createObject(o,c){const d=new three_module.SUR,_=o.attributes;let b,_e,it,nt;switch(o.objectType){case"Point":case"PointSet":b=d.parse(o.geometry),b.attributes.hasOwnProperty("color")?_e=new three_module.BH$({vertexColors:!0,sizeAttenuation:!1,size:2}):(it=_.drawColor,nt=new three_module.Q1f(it.r/255,it.g/255,it.b/255),_e=new three_module.BH$({color:nt,sizeAttenuation:!1,size:2})),_e=this._compareMaterials(_e);const at=new three_module.ONl(b,_e);return at.userData.attributes=_,at.userData.objectType=o.objectType,_.name&&(at.name=_.name),at;case"Mesh":case"Extrusion":case"SubD":case"Brep":if(o.geometry===null)return;b=d.parse(o.geometry),c===null&&(c=this._createMaterial(),c=this._compareMaterials(c)),b.attributes.hasOwnProperty("color")&&(c.vertexColors=!0);const ut=new three_module.eaF(b,c);return ut.castShadow=_.castsShadows,ut.receiveShadow=_.receivesShadows,ut.userData.attributes=_,ut.userData.objectType=o.objectType,_.name&&(ut.name=_.name,b.name=_.name),ut;case"Curve":b=d.parse(o.geometry),it=_.drawColor,nt=new three_module.Q1f(it.r/255,it.g/255,it.b/255),_e=new three_module.mrM({color:nt}),_e=this._compareMaterials(_e);const pt=new three_module.N1A(b,_e);return pt.userData.attributes=_,pt.userData.objectType=o.objectType,_.name&&(pt.name=_.name),pt;case"TextDot":b=o.geometry;const mt=document.createElement("canvas").getContext("2d"),ft=`${b.fontHeight}px ${b.fontFace}`;mt.font=ft;const vt=mt.measureText(b.text).width+10,xt=b.fontHeight+10,At=window.devicePixelRatio;mt.canvas.width=vt*At,mt.canvas.height=xt*At,mt.canvas.style.width=vt+"px",mt.canvas.style.height=xt+"px",mt.setTransform(At,0,0,At,0,0),mt.font=ft,mt.textBaseline="middle",mt.textAlign="center",nt=_.drawColor,mt.fillStyle=`rgba(${nt.r},${nt.g},${nt.b},${nt.a})`,mt.fillRect(0,0,vt,xt),mt.fillStyle="white",mt.fillText(b.text,vt/2,xt/2);const Ct=new three_module.GOR(mt.canvas);Ct.minFilter=three_module.k6q,Ct.generateMipmaps=!1,Ct.wrapS=three_module.ghU,Ct.wrapT=three_module.ghU,_e=new three_module.RoJ({map:Ct,depthTest:!1});const Et=new three_module.kxk(_e);return Et.position.set(b.point[0],b.point[1],b.point[2]),Et.scale.set(vt/10,xt/10,1),Et.userData.attributes=_,Et.userData.objectType=o.objectType,_.name&&(Et.name=_.name),Et;case"Light":let Tt;switch(b=o.geometry,b.lightStyle.name){case"LightStyle_WorldPoint":Tt=new three_module.HiM,Tt.castShadow=_.castsShadows,Tt.position.set(b.location[0],b.location[1],b.location[2]),Tt.shadow.normalBias=.1;break;case"LightStyle_WorldSpot":Tt=new three_module.nCl,Tt.castShadow=_.castsShadows,Tt.position.set(b.location[0],b.location[1],b.location[2]),Tt.target.position.set(b.direction[0],b.direction[1],b.direction[2]),Tt.angle=b.spotAngleRadians,Tt.shadow.normalBias=.1;break;case"LightStyle_WorldRectangular":Tt=new three_module.ure;const kt=Math.abs(b.width[2]),Dt=Math.abs(b.length[0]);Tt.position.set(b.location[0]-Dt/2,b.location[1],b.location[2]-kt/2),Tt.height=Dt,Tt.width=kt,Tt.lookAt(b.direction[0],b.direction[1],b.direction[2]);break;case"LightStyle_WorldDirectional":Tt=new three_module.ZyN,Tt.castShadow=_.castsShadows,Tt.position.set(b.location[0],b.location[1],b.location[2]),Tt.target.position.set(b.direction[0],b.direction[1],b.direction[2]),Tt.shadow.normalBias=.1}return Tt&&(Tt.intensity=b.intensity,it=b.diffuse,nt=new three_module.Q1f(it.r/255,it.g/255,it.b/255),Tt.color=nt,Tt.userData.attributes=_,Tt.userData.objectType=o.objectType),Tt}}_initLibrary(){if(!this.libraryPending){const o=new three_module.Y9S(this.manager);o.setPath(this.libraryPath);const c=new Promise((b,_e)=>{o.load("rhino3dm.js",b,void 0,_e)}),d=new three_module.Y9S(this.manager);d.setPath(this.libraryPath),d.setResponseType("arraybuffer");const _=new Promise((b,_e)=>{d.load("rhino3dm.wasm",b,void 0,_e)});this.libraryPending=Promise.all([c,_]).then(([b,_e])=>{this.libraryConfig.wasmBinary=_e;const it=DRACOWorkerStr,nt=["/* rhino3dm.js */",b,"/* worker */",it.substring(it.indexOf("{")+1,it.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([nt]))})}return this.libraryPending}_getWorker(o){return this._initLibrary().then(()=>{if(this.workerPool.length<this.workerLimit){const d=new Worker(this.workerSourceURL);d._callbacks={},d._taskCosts={},d._taskLoad=0,d.postMessage({type:"init",libraryConfig:this.libraryConfig}),d.onmessage=_=>{const b=_.data;switch(b.type){case"warning":this.warnings.push(b.data),console.warn(b.data);break;case"decode":d._callbacks[b.id].resolve(b);break;case"error":d._callbacks[b.id].reject(b);break;default:console.error('THREE.Rhino3dmLoader: Unexpected message, "'+b.type+'"')}},this.workerPool.push(d)}else this.workerPool.sort(function(d,_){return d._taskLoad>_._taskLoad?-1:1});const c=this.workerPool[this.workerPool.length-1];return c._taskLoad+=o,c})}_releaseTask(o,c){o._taskLoad-=o._taskCosts[c],delete o._callbacks[c],delete o._taskCosts[c]}dispose(){for(let o=0;o<this.workerPool.length;++o)this.workerPool[o].terminate();return this.workerPool.length=0,this}}const DRACOWorkerStr=`
function Rhino3dmWorker() {

	let libraryPending;
	let libraryConfig;
	let rhino;
	let taskID;

	onmessage = function ( e ) {

		const message = e.data;

		switch ( message.type ) {

			case 'init':

				libraryConfig = message.libraryConfig;
				const wasmBinary = libraryConfig.wasmBinary;
				let RhinoModule;
				libraryPending = new Promise( function ( resolve ) {

					/* Like Basis Loader */
					RhinoModule = { wasmBinary, onRuntimeInitialized: resolve };

					rhino3dm( RhinoModule ); // eslint-disable-line no-undef

				 } ).then( () => {

					rhino = RhinoModule;

				 } );

				break;

			case 'decode':

				taskID = message.id;
				const buffer = message.buffer;
				libraryPending.then( () => {

					try {

						const data = decodeObjects( rhino, buffer );
						self.postMessage( { type: 'decode', id: message.id, data } );

					} catch ( error ) {

						self.postMessage( { type: 'error', id: message.id, error } );

					}

				} );

				break;

		}

	};

	function decodeObjects( rhino, buffer ) {

		const arr = new Uint8Array( buffer );
		const doc = rhino.File3dm.fromByteArray( arr );

		const objects = [];
		const materials = [];
		const layers = [];
		const views = [];
		const namedViews = [];
		const groups = [];
		const strings = [];

		//Handle objects

		const objs = doc.objects();
		const cnt = objs.count;

		for ( let i = 0; i < cnt; i ++ ) {

			const _object = objs.get( i );

			const object = extractObjectData( _object, doc );

			_object.delete();

			if ( object ) {

				objects.push( object );

			}

		}

		// Handle instance definitions
		// console.log( \`Instance Definitions Count: \${doc.instanceDefinitions().count()}\` );

		for ( let i = 0; i < doc.instanceDefinitions().count; i ++ ) {

			const idef = doc.instanceDefinitions().get( i );
			const idefAttributes = extractProperties( idef );
			idefAttributes.objectIds = idef.getObjectIds();

			objects.push( { geometry: null, attributes: idefAttributes, objectType: 'InstanceDefinition' } );

		}

		// Handle materials

		const textureTypes = [
			// rhino.TextureType.Bitmap,
			rhino.TextureType.Diffuse,
			rhino.TextureType.Bump,
			rhino.TextureType.Transparency,
			rhino.TextureType.Opacity,
			rhino.TextureType.Emap
		];

		const pbrTextureTypes = [
			rhino.TextureType.PBR_BaseColor,
			rhino.TextureType.PBR_Subsurface,
			rhino.TextureType.PBR_SubsurfaceScattering,
			rhino.TextureType.PBR_SubsurfaceScatteringRadius,
			rhino.TextureType.PBR_Metallic,
			rhino.TextureType.PBR_Specular,
			rhino.TextureType.PBR_SpecularTint,
			rhino.TextureType.PBR_Roughness,
			rhino.TextureType.PBR_Anisotropic,
			rhino.TextureType.PBR_Anisotropic_Rotation,
			rhino.TextureType.PBR_Sheen,
			rhino.TextureType.PBR_SheenTint,
			rhino.TextureType.PBR_Clearcoat,
			rhino.TextureType.PBR_ClearcoatBump,
			rhino.TextureType.PBR_ClearcoatRoughness,
			rhino.TextureType.PBR_OpacityIor,
			rhino.TextureType.PBR_OpacityRoughness,
			rhino.TextureType.PBR_Emission,
			rhino.TextureType.PBR_AmbientOcclusion,
			rhino.TextureType.PBR_Displacement
		];

		for ( let i = 0; i < doc.materials().count; i ++ ) {

			const _material = doc.materials().get( i );

			let material = extractProperties( _material );

			const textures = [];

			textures.push( ...extractTextures( _material, textureTypes, doc ) );

			material.pbrSupported = _material.physicallyBased().supported;

			if ( material.pbrSupported ) {

				textures.push( ...extractTextures( _material, pbrTextureTypes, doc ) );
				material.pbr = extractProperties( _material.physicallyBased() );

			}

			material.textures = textures;

			materials.push( material );

			_material.delete();

		}

		// Handle layers

		for ( let i = 0; i < doc.layers().count; i ++ ) {

			const _layer = doc.layers().get( i );
			const layer = extractProperties( _layer );

			layers.push( layer );

			_layer.delete();

		}

		// Handle views

		for ( let i = 0; i < doc.views().count; i ++ ) {

			const _view = doc.views().get( i );
			const view = extractProperties( _view );

			views.push( view );

			_view.delete();

		}

		// Handle named views

		for ( let i = 0; i < doc.namedViews().count; i ++ ) {

			const _namedView = doc.namedViews().get( i );
			const namedView = extractProperties( _namedView );

			namedViews.push( namedView );

			_namedView.delete();

		}

		// Handle groups

		for ( let i = 0; i < doc.groups().count; i ++ ) {

			const _group = doc.groups().get( i );
			const group = extractProperties( _group );

			groups.push( group );

			_group.delete();

		}

		// Handle settings

		const settings = extractProperties( doc.settings() );

		//TODO: Handle other document stuff like dimstyles, instance definitions, bitmaps etc.

		// Handle dimstyles
		// console.log( \`Dimstyle Count: \${doc.dimstyles().count()}\` );

		// Handle bitmaps
		// console.log( \`Bitmap Count: \${doc.bitmaps().count()}\` );

		// Handle strings
		// console.log( \`Document Strings Count: \${doc.strings().count()}\` );
		// Note: doc.strings().documentUserTextCount() counts any doc.strings defined in a section
		// console.log( \`Document User Text Count: \${doc.strings().documentUserTextCount()}\` );

		const strings_count = doc.strings().count;

		for ( let i = 0; i < strings_count; i ++ ) {

			strings.push( doc.strings().get( i ) );

		}

		// Handle Render Environments for Material Environment

		// get the id of the active render environment skylight, which we'll use for environment texture
		const reflectionId = doc.settings().renderSettings().renderEnvironments.reflectionId;

		const rc = doc.renderContent();

		let renderEnvironment = null;

		for( let i = 0; i < rc.count; i++ ) {

			const content = rc.get(i);

			switch( content.kind ) {

				case 'environment':

					const id = content.id;

					// there could be multiple render environments in a 3dm file
					if ( id !== reflectionId ) break;

					const renderTexture = content.findChild( 'texture' );
					const fileName = renderTexture.fileName;

					for ( let j = 0; j < doc.embeddedFiles().count; j ++ ) {

						const _fileName = doc.embeddedFiles().get( j ).fileName;

						if ( fileName === _fileName ) {

							const background = doc.getEmbeddedFileAsBase64( fileName );
							const backgroundImage = 'data:image/png;base64,' + background;
							renderEnvironment = { type: 'renderEnvironment', image: backgroundImage, name: fileName };

						}

					}

					break;

			}

		}

		// Handle Render Settings

		const renderSettings = {
			ambientLight: doc.settings().renderSettings().ambientLight,
			backgroundColorTop: doc.settings().renderSettings().backgroundColorTop,
			backgroundColorBottom: doc.settings().renderSettings().backgroundColorBottom,
			useHiddenLights: doc.settings().renderSettings().useHiddenLights,
			depthCue: doc.settings().renderSettings().depthCue,
			flatShade: doc.settings().renderSettings().flatShade,
			renderBackFaces: doc.settings().renderSettings().renderBackFaces,
			renderPoints: doc.settings().renderSettings().renderPoints,
			renderCurves: doc.settings().renderSettings().renderCurves,
			renderIsoParams: doc.settings().renderSettings().renderIsoParams,
			renderMeshEdges: doc.settings().renderSettings().renderMeshEdges,
			renderAnnotations: doc.settings().renderSettings().renderAnnotations,
			useViewportSize: doc.settings().renderSettings().useViewportSize,
			scaleBackgroundToFit: doc.settings().renderSettings().scaleBackgroundToFit,
			transparentBackground: doc.settings().renderSettings().transparentBackground,
			imageDpi: doc.settings().renderSettings().imageDpi,
			shadowMapLevel: doc.settings().renderSettings().shadowMapLevel,
			namedView: doc.settings().renderSettings().namedView,
			snapShot: doc.settings().renderSettings().snapShot,
			specificViewport: doc.settings().renderSettings().specificViewport,
			groundPlane: extractProperties( doc.settings().renderSettings().groundPlane ),
			safeFrame: extractProperties( doc.settings().renderSettings().safeFrame ),
			dithering: extractProperties( doc.settings().renderSettings().dithering ),
			skylight: extractProperties( doc.settings().renderSettings().skylight ),
			linearWorkflow: extractProperties( doc.settings().renderSettings().linearWorkflow ),
			renderChannels: extractProperties( doc.settings().renderSettings().renderChannels ),
			sun: extractProperties( doc.settings().renderSettings().sun ),
			renderEnvironments: extractProperties( doc.settings().renderSettings().renderEnvironments ),
			postEffects: extractProperties( doc.settings().renderSettings().postEffects ),

		};

		doc.delete();

		return { objects, materials, layers, views, namedViews, groups, strings, settings, renderSettings, renderEnvironment };

	}

	function extractTextures( m, tTypes, d ) {

		const textures = [];

		for ( let i = 0; i < tTypes.length; i ++ ) {

			const _texture = m.getTexture( tTypes[ i ] );
			if ( _texture ) {

				let textureType = tTypes[ i ].constructor.name;
				textureType = textureType.substring( 12, textureType.length );
				const texture = extractTextureData( _texture, textureType, d );
				textures.push( texture );
				_texture.delete();

			}

		}

		return textures;

	}

	function extractTextureData( t, tType, d ) {

		const texture = { type: tType };

		const image = d.getEmbeddedFileAsBase64( t.fileName );

		texture.wrapU = t.wrapU;
		texture.wrapV = t.wrapV;
		texture.wrapW = t.wrapW;
		const uvw = t.uvwTransform.toFloatArray( true );

		texture.repeat = [ uvw[ 0 ], uvw[ 5 ] ];

		if ( image ) {

			texture.image = 'data:image/png;base64,' + image;

		} else {

			self.postMessage( { type: 'warning', id: taskID, data: {
				message: \`THREE.3DMLoader: Image for \${tType} texture not embedded in file.\`,
				type: 'missing resource'
			}

			} );

			texture.image = null;

		}

		return texture;

	}

	function extractObjectData( object, doc ) {

		const _geometry = object.geometry();
		const _attributes = object.attributes();
		let objectType = _geometry.objectType;
		let geometry, attributes, position, data, mesh;

		// skip instance definition objects
		//if( _attributes.isInstanceDefinitionObject ) { continue; }

		// TODO: handle other geometry types
		switch ( objectType ) {

			case rhino.ObjectType.Curve:

				const pts = curveToPoints( _geometry, 100 );

				position = {};
				attributes = {};
				data = {};

				position.itemSize = 3;
				position.type = 'Float32Array';
				position.array = [];

				for ( let j = 0; j < pts.length; j ++ ) {

					position.array.push( pts[ j ][ 0 ] );
					position.array.push( pts[ j ][ 1 ] );
					position.array.push( pts[ j ][ 2 ] );

				}

				attributes.position = position;
				data.attributes = attributes;

				geometry = { data };

				break;

			case rhino.ObjectType.Point:

				const pt = _geometry.location;

				position = {};
				const color = {};
				attributes = {};
				data = {};

				position.itemSize = 3;
				position.type = 'Float32Array';
				position.array = [ pt[ 0 ], pt[ 1 ], pt[ 2 ] ];

				const _color = _attributes.drawColor( doc );

				color.itemSize = 3;
				color.type = 'Float32Array';
				color.array = [ _color.r / 255.0, _color.g / 255.0, _color.b / 255.0 ];

				attributes.position = position;
				attributes.color = color;
				data.attributes = attributes;

				geometry = { data };

				break;

			case rhino.ObjectType.PointSet:
			case rhino.ObjectType.Mesh:

				geometry = _geometry.toThreejsJSON();

				break;

			case rhino.ObjectType.Brep:

				const faces = _geometry.faces();
				mesh = new rhino.Mesh();

				for ( let faceIndex = 0; faceIndex < faces.count; faceIndex ++ ) {

					const face = faces.get( faceIndex );
					const _mesh = face.getMesh( rhino.MeshType.Any );

					if ( _mesh ) {

						mesh.append( _mesh );
						_mesh.delete();

					}

					face.delete();

				}

				if ( mesh.faces().count > 0 ) {

					mesh.compact();
					geometry = mesh.toThreejsJSON();
					faces.delete();

				}

				mesh.delete();

				break;

			case rhino.ObjectType.Extrusion:

				mesh = _geometry.getMesh( rhino.MeshType.Any );

				if ( mesh ) {

					geometry = mesh.toThreejsJSON();
					mesh.delete();

				}

				break;

			case rhino.ObjectType.TextDot:

				geometry = extractProperties( _geometry );

				break;

			case rhino.ObjectType.Light:

				geometry = extractProperties( _geometry );

				if ( geometry.lightStyle.name === 'LightStyle_WorldLinear' ) {

					self.postMessage( { type: 'warning', id: taskID, data: {
						message: \`THREE.3DMLoader: No conversion exists for \${objectType.constructor.name} \${geometry.lightStyle.name}\`,
						type: 'no conversion',
						guid: _attributes.id
					}

					} );

				}

				break;

			case rhino.ObjectType.InstanceReference:

				geometry = extractProperties( _geometry );
				geometry.xform = extractProperties( _geometry.xform );
				geometry.xform.array = _geometry.xform.toFloatArray( true );

				break;

			case rhino.ObjectType.SubD:

				// TODO: precalculate resulting vertices and faces and warn on excessive results
				_geometry.subdivide( 3 );
				mesh = rhino.Mesh.createFromSubDControlNet( _geometry, false );
				if ( mesh ) {

					geometry = mesh.toThreejsJSON();
					mesh.delete();

				}

				break;

				/*
				case rhino.ObjectType.Annotation:
				case rhino.ObjectType.Hatch:
				case rhino.ObjectType.ClipPlane:
				*/

			default:

				self.postMessage( { type: 'warning', id: taskID, data: {
					message: \`THREE.3DMLoader: Conversion not implemented for \${objectType.constructor.name}\`,
					type: 'not implemented',
					guid: _attributes.id
				}

				} );

				break;

		}

		if ( geometry ) {

			attributes = extractProperties( _attributes );
			attributes.geometry = extractProperties( _geometry );

			if ( _attributes.groupCount > 0 ) {

				attributes.groupIds = _attributes.getGroupList();

			}

			if ( _attributes.userStringCount > 0 ) {

				attributes.userStrings = _attributes.getUserStrings();

			}

			if ( _geometry.userStringCount > 0 ) {

				attributes.geometry.userStrings = _geometry.getUserStrings();

			}

			if ( _attributes.decals().count > 0 ) {

				self.postMessage( { type: 'warning', id: taskID, data: {
					message: \`THREE.3DMLoader: No conversion exists for the decals associated with this object.\`,
					type: 'no conversion',
					guid: _attributes.id
				}

				} );

			}

			attributes.drawColor = _attributes.drawColor( doc );

			objectType = objectType.constructor.name;
			objectType = objectType.substring( 11, objectType.length );

			return { geometry, attributes, objectType };

		} else {

			self.postMessage( { type: 'warning', id: taskID, data: {
				message: \`THREE.3DMLoader: \${objectType.constructor.name} has no associated mesh geometry.\`,
				type: 'missing mesh',
				guid: _attributes.id
			}

			} );

		}

	}

	function extractProperties( object ) {

		const result = {};

		for ( const property in object ) {

			const value = object[ property ];

			if ( typeof value !== 'function' ) {

				if ( typeof value === 'object' && value !== null && value.hasOwnProperty( 'constructor' ) ) {

					result[ property ] = { name: value.constructor.name, value: value.value };

				} else if ( typeof value === 'object' && value !== null ) {

					result[ property ] = extractProperties( value );

				} else {

					result[ property ] = value;

				}

			} else {

				// these are functions that could be called to extract more data.
				//console.log( \`\${property}: \${object[ property ].constructor.name}\` );

			}

		}

		return result;

	}

	function curveToPoints( curve, pointLimit ) {

		let pointCount = pointLimit;
		let rc = [];
		const ts = [];

		if ( curve instanceof rhino.LineCurve ) {

			return [ curve.pointAtStart, curve.pointAtEnd ];

		}

		if ( curve instanceof rhino.PolylineCurve ) {

			pointCount = curve.pointCount;
			for ( let i = 0; i < pointCount; i ++ ) {

				rc.push( curve.point( i ) );

			}

			return rc;

		}

		if ( curve instanceof rhino.PolyCurve ) {

			const segmentCount = curve.segmentCount;

			for ( let i = 0; i < segmentCount; i ++ ) {

				const segment = curve.segmentCurve( i );
				const segmentArray = curveToPoints( segment, pointCount );
				rc = rc.concat( segmentArray );
				segment.delete();

			}

			return rc;

		}

		if ( curve instanceof rhino.ArcCurve ) {

			pointCount = Math.floor( curve.angleDegrees / 5 );
			pointCount = pointCount < 2 ? 2 : pointCount;
			// alternative to this hardcoded version: https://stackoverflow.com/a/18499923/2179399

		}

		if ( curve instanceof rhino.NurbsCurve && curve.degree === 1 ) {

			const pLine = curve.tryGetPolyline();

			for ( let i = 0; i < pLine.count; i ++ ) {

				rc.push( pLine.get( i ) );

			}

			pLine.delete();

			return rc;

		}

		const domain = curve.domain;
		const divisions = pointCount - 1.0;

		for ( let j = 0; j < pointCount; j ++ ) {

			const t = domain[ 0 ] + ( j / divisions ) * ( domain[ 1 ] - domain[ 0 ] );

			if ( t === domain[ 0 ] || t === domain[ 1 ] ) {

				ts.push( t );
				continue;

			}

			const tan = curve.tangentAt( t );
			const prevTan = curve.tangentAt( ts.slice( - 1 )[ 0 ] );

			// Duplicated from THREE.Vector3
			// How to pass imports to worker?

			const tS = tan[ 0 ] * tan[ 0 ] + tan[ 1 ] * tan[ 1 ] + tan[ 2 ] * tan[ 2 ];
			const ptS = prevTan[ 0 ] * prevTan[ 0 ] + prevTan[ 1 ] * prevTan[ 1 ] + prevTan[ 2 ] * prevTan[ 2 ];

			const denominator = Math.sqrt( tS * ptS );

			let angle;

			if ( denominator === 0 ) {

				angle = Math.PI / 2;

			} else {

				const theta = ( tan.x * prevTan.x + tan.y * prevTan.y + tan.z * prevTan.z ) / denominator;
				angle = Math.acos( Math.max( - 1, Math.min( 1, theta ) ) );

			}

			if ( angle < 0.1 ) continue;

			ts.push( t );

		}

		rc = ts.map( t => curve.pointAt( t ) );
		return rc;

	}

}
`;var rhino3dm_decorate=function(h,o,c,d){var _,b=arguments.length,_e=b<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_e=Reflect.decorate(h,o,c,d);else for(var it=h.length-1;it>=0;it--)(_=h[it])&&(_e=(b<3?_(_e):b>3?_(o,c,_e):_(o,c))||_e);return b>3&&_e&&Object.defineProperty(o,c,_e),_e};class Rhino3dmLoader2 extends Rhino3dmLoader{constructor(o){super(o),this.materials=[],this.setLibraryPath(Rhino3dmLoader2.LIBRARY_PATH)}_createMaterial(o){return Rhino3dmLoader2.ImportMaterials?super._createMaterial(o):this.materials[0]||new three_module._4j({color:new three_module.Q1f(1,1,1),metalness:.8,name:three_module.aHM.DEFAULT_MATERIAL_NAME,side:three_module.$EB})}async loadAsync(o,c){const d=await super.loadAsync(o,c);d.rotateX(-Math.PI/2),d.userData.materials&&delete d.userData.materials;const _=d.userData.layers;return d.traverse(b=>{var _e,it,nt,at,ut;const pt=(_e=b.userData.attributes)===null||_e===void 0?void 0:_e.castsShadows,mt=(it=b.userData.attributes)===null||it===void 0?void 0:it.receivesShadows;b.castShadow=pt,b.receiveShadow=mt;const ft=(at=(nt=b.userData.attributes)===null||nt===void 0?void 0:nt.layerIndex)!==null&&at!==void 0?at:(ut=b.userData.defAttributes)===null||ut===void 0?void 0:ut.layerIndex,vt=_[ft];vt&&(b.userData.rhinoLayer=vt),b.userData.rhino3dmRoot=d.uuid,Rhino3dmLoader2.LoadUserDataStrings||(b.userData.strings=[]),Rhino3dmLoader2.LoadUserDataWarnings||delete b.userData.warnings,this._hideLineMesh(b),this._useInstancedMesh(b),this._useMaterialSource(b,vt)}),this.materials=[],d}_useMaterialSource(o,c){var d,_,b,_e,it;if(!Rhino3dmLoader2.ImportMaterials)return;const nt=o;if(((d=nt.material)===null||d===void 0?void 0:d.name)==="default"||Rhino3dmLoader2.ForceLayerMaterials){const at=((_=nt.userData.attributes)===null||_===void 0?void 0:_.materialSource)||((b=nt.userData.defAttributes)===null||b===void 0?void 0:b.materialSource),ut=((_e=nt.userData.attributes)===null||_e===void 0?void 0:_e.colorSource)||((it=nt.userData.defAttributes)===null||it===void 0?void 0:it.colorSource);if(!Rhino3dmLoader2.ForceLayerMaterials&&!at&&!ut)return;Rhino3dmLoader2.ForceLayerMaterials||(at==null?void 0:at.value)===0||(at==null?void 0:at.value)===1&&(ut==null?void 0:ut.value)===0?c&&(nt.material=this._compareMaterials(this._createMaterial({diffuseColor:c.color,name:c.name,emissionColor:{r:0,g:0,b:0},disableLighting:!1,indexOfRefraction:1.5,reflectivity:1,transparency:0,specularColor:{r:0,g:0,b:0},textures:[]}))):(at==null?void 0:at.value)===3||(at==null?void 0:at.value)===1&&(ut==null?void 0:ut.value)===3?nt.traverseAncestors(pt=>{pt!=null&&pt.material&&(nt.material=pt.material)}):at&&at.value!==1&&console.warn("Unknown material source",at,nt,nt.userData.attributes)}}_useInstancedMesh(o){if(!Rhino3dmLoader2.ReplaceWithInstancedMesh||o.children.length<=0)return;const c=o.children,d=c.map(_=>_.geometry);d.filter((_,b)=>d.indexOf(_)===b).forEach(_=>{var b;const _e=c.filter(nt=>nt.geometry===_),it=_e.length>0?_e.filter(nt=>nt.material===_e[0].material):[];if(it.length>1){const nt=new three_module.ZLX(_,it[0].material,it.length);nt.userData={...it[0].userData},nt.userData.instanceUserData=[],nt.userData.attributes=nt.userData.defAttributes||nt.userData.attributes,nt.userData.defAttributes&&delete nt.userData.defAttributes,nt.name=((b=nt.userData.attributes)===null||b===void 0?void 0:b.name)||it[0].name,it.forEach((at,ut)=>{nt.setMatrixAt(ut,at.matrix),o.remove(at),nt.userData.instanceUserData.push(at.userData)}),o.add(nt)}})}_hideLineMesh(o){if(!Rhino3dmLoader2.HideLineMesh&&!Rhino3dmLoader2.HidePointMesh||o.children.length<=0)return;const c=[];o.traverse(d=>{(d&&Rhino3dmLoader2.HideLineMesh&&(d.isLine||d.isLineSegments)||Rhino3dmLoader2.HidePointMesh&&d.isPoints)&&c.push(d)}),c.forEach(d=>{d.userData.visible_3dm=d.visible,d.visible=!1})}}Rhino3dmLoader2.LIBRARY_PATH="https://cdn.jsdelivr.net/npm/rhino3dm@8.9.0/",Rhino3dmLoader2.ImportMaterials=!0,Rhino3dmLoader2.ForceLayerMaterials=!1,Rhino3dmLoader2.ReplaceWithInstancedMesh=!1,Rhino3dmLoader2.HideLineMesh=!1,Rhino3dmLoader2.HidePointMesh=!1,Rhino3dmLoader2.LoadUserDataStrings=!0,Rhino3dmLoader2.LoadUserDataWarnings=!0;let Rhino3dmLoadPlugin=class extends I$2{constructor(){super(...arguments),this.dependencies=[AssetManagerPlugin],this._importer=new Importer(Rhino3dmLoader2,["3dm"],!0),this.importMaterials=!0,this.forceLayerMaterials=!1,this.replaceWithInstancedMesh=!1,this.hideLineMesh=!1,this.hidePointMesh=!0,this.loadUserDataStrings=!0}_refresh(){Rhino3dmLoader2.ImportMaterials=this.importMaterials,Rhino3dmLoader2.ForceLayerMaterials=this.forceLayerMaterials,Rhino3dmLoader2.ReplaceWithInstancedMesh=this.replaceWithInstancedMesh,Rhino3dmLoader2.HideLineMesh=this.hideLineMesh,Rhino3dmLoader2.HidePointMesh=this.hidePointMesh,Rhino3dmLoader2.LoadUserDataStrings=this.loadUserDataStrings,Rhino3dmLoader2.LoadUserDataWarnings=!1}async onAdded(h){var o,c;(c=(o=h.getManager())===null||o===void 0?void 0:o.importer)===null||c===void 0||c.Importers.push(this._importer),this._refresh()}async onDispose(h){}async onRemove(h){var o,c;!((c=(o=h.getManager())===null||o===void 0?void 0:o.importer)===null||c===void 0)&&c.Importers&&h.getManager().importer.Importers.splice(h.getManager().importer.Importers.indexOf(this._importer),1)}};Rhino3dmLoadPlugin.PluginType="Rhino3dmLoadPlugin",rhino3dm_decorate([x$1(Rhino3dmLoadPlugin.prototype._refresh),uiToggle()],Rhino3dmLoadPlugin.prototype,"importMaterials",void 0),rhino3dm_decorate([x$1(Rhino3dmLoadPlugin.prototype._refresh),uiToggle()],Rhino3dmLoadPlugin.prototype,"forceLayerMaterials",void 0),rhino3dm_decorate([x$1(Rhino3dmLoadPlugin.prototype._refresh),uiToggle()],Rhino3dmLoadPlugin.prototype,"replaceWithInstancedMesh",void 0),rhino3dm_decorate([x$1(Rhino3dmLoadPlugin.prototype._refresh),uiToggle()],Rhino3dmLoadPlugin.prototype,"hideLineMesh",void 0),rhino3dm_decorate([x$1(Rhino3dmLoadPlugin.prototype._refresh),uiToggle()],Rhino3dmLoadPlugin.prototype,"hidePointMesh",void 0),rhino3dm_decorate([x$1(Rhino3dmLoadPlugin.prototype._refresh),uiToggle()],Rhino3dmLoadPlugin.prototype,"loadUserDataStrings",void 0),Rhino3dmLoadPlugin=rhino3dm_decorate([uiFolder("Rhino 3dm loader")],Rhino3dmLoadPlugin);class STLLoader extends three_module.aHM{constructor(o){super(o)}load(o,c,d,_){const b=this,_e=new three_module.Y9S(this.manager);_e.setPath(this.path),_e.setResponseType("arraybuffer"),_e.setRequestHeader(this.requestHeader),_e.setWithCredentials(this.withCredentials),_e.load(o,function(it){try{c(b.parse(it))}catch(nt){_?_(nt):console.error(nt),b.manager.itemError(o)}},d,_)}parse(o){function c(b,_e,it){for(let nt=0,at=b.length;nt<at;nt++)if(b[nt]!==_e.getUint8(it+nt))return!1;return!0}const d=function(b){if(typeof b=="string"){const _e=new Uint8Array(b.length);for(let it=0;it<b.length;it++)_e[it]=255&b.charCodeAt(it);return _e.buffer||_e}return b}(o);return function(b){const _e=new DataView(b);if(84+50*_e.getUint32(80,!0)===_e.byteLength)return!0;const it=[115,111,108,105,100];for(let nt=0;nt<5;nt++)if(c(it,_e,nt))return!1;return!0}(d)?function(b){const _e=new DataView(b),it=_e.getUint32(80,!0);let nt,at,ut,pt,mt,ft,vt,xt,At=!1;for(let Dt=0;Dt<70;Dt++)_e.getUint32(Dt,!1)==1129270351&&_e.getUint8(Dt+4)==82&&_e.getUint8(Dt+5)==61&&(At=!0,pt=new Float32Array(3*it*3),mt=_e.getUint8(Dt+6)/255,ft=_e.getUint8(Dt+7)/255,vt=_e.getUint8(Dt+8)/255,xt=_e.getUint8(Dt+9)/255);const Ct=new three_module.LoY,Et=new Float32Array(3*it*3),Tt=new Float32Array(3*it*3),kt=new three_module.Q1f;for(let Dt=0;Dt<it;Dt++){const zt=84+50*Dt,Bt=_e.getFloat32(zt,!0),Rt=_e.getFloat32(zt+4,!0),Ut=_e.getFloat32(zt+8,!0);if(At){const Ht=_e.getUint16(zt+48,!0);32768&Ht?(nt=mt,at=ft,ut=vt):(nt=(31&Ht)/31,at=(Ht>>5&31)/31,ut=(Ht>>10&31)/31)}for(let Ht=1;Ht<=3;Ht++){const Jt=zt+12*Ht,Kt=3*Dt*3+3*(Ht-1);Et[Kt]=_e.getFloat32(Jt,!0),Et[Kt+1]=_e.getFloat32(Jt+4,!0),Et[Kt+2]=_e.getFloat32(Jt+8,!0),Tt[Kt]=Bt,Tt[Kt+1]=Rt,Tt[Kt+2]=Ut,At&&(kt.set(nt,at,ut).convertSRGBToLinear(),pt[Kt]=kt.r,pt[Kt+1]=kt.g,pt[Kt+2]=kt.b)}}return Ct.setAttribute("position",new three_module.THS(Et,3)),Ct.setAttribute("normal",new three_module.THS(Tt,3)),At&&(Ct.setAttribute("color",new three_module.THS(pt,3)),Ct.hasColors=!0,Ct.alpha=xt),Ct}(d):function(b){const _e=new three_module.LoY,it=/solid([\s\S]*?)endsolid/g,nt=/facet([\s\S]*?)endfacet/g,at=/solid\s(.+)/;let ut=0;const pt=/[\s]+([+-]?(?:\d*)(?:\.\d*)?(?:[eE][+-]?\d+)?)/.source,mt=new RegExp("vertex"+pt+pt+pt,"g"),ft=new RegExp("normal"+pt+pt+pt,"g"),vt=[],xt=[],At=[],Ct=new three_module.Pq0;let Et,Tt=0,kt=0,Dt=0;for(;(Et=it.exec(b))!==null;){kt=Dt;const zt=Et[0],Bt=(Et=at.exec(zt))!==null?Et[1]:"";for(At.push(Bt);(Et=nt.exec(zt))!==null;){let Ht=0,Jt=0;const Kt=Et[0];for(;(Et=ft.exec(Kt))!==null;)Ct.x=parseFloat(Et[1]),Ct.y=parseFloat(Et[2]),Ct.z=parseFloat(Et[3]),Jt++;for(;(Et=mt.exec(Kt))!==null;)vt.push(parseFloat(Et[1]),parseFloat(Et[2]),parseFloat(Et[3])),xt.push(Ct.x,Ct.y,Ct.z),Ht++,Dt++;Jt!==1&&console.error("THREE.STLLoader: Something isn't right with the normal of face number "+ut),Ht!==3&&console.error("THREE.STLLoader: Something isn't right with the vertices of face number "+ut),ut++}const Rt=kt,Ut=Dt-kt;_e.userData.groupNames=At,_e.addGroup(Rt,Ut,Tt),Tt++}return _e.setAttribute("position",new three_module.qtW(vt,3)),_e.setAttribute("normal",new three_module.qtW(xt,3)),_e}(typeof(_=o)!="string"?new TextDecoder().decode(_):_);var _}}class STLLoadPlugin extends I$2{constructor(){super(...arguments),this.dependencies=[AssetManagerPlugin]}async onAdded(o){var c,d;this._importer||(this._importer=new Importer(STLLoader,["stl"],!0)),(d=(c=o.getManager())===null||c===void 0?void 0:c.importer)===null||d===void 0||d.Importers.push(this._importer)}async onDispose(o){this._importer=void 0}async onRemove(o){var c,d;this._importer&&!((d=(c=o.getManager())===null||c===void 0?void 0:c.importer)===null||d===void 0)&&d.Importers&&o.getManager().importer.Importers.splice(o.getManager().importer.Importers.indexOf(this._importer),1),this._importer=void 0}}STLLoadPlugin.PluginType="STLLoadPlugin";class GLTFMeshOptPlugin extends I$2{constructor(){super(...arguments),this.dependencies=[AssetManagerPlugin]}async onAdded(o){const c=document.createElement("script");c.type="module",c.innerHTML=`
import { MeshoptDecoder } from '${GLTFMeshOptPlugin.DECODER_URL}';
window.MeshoptDecoder = MeshoptDecoder
`,document.head.appendChild(c),this._script=c}async onDispose(o){}async onRemove(o){this._script&&(document.head.removeChild(this._script),this._script=void 0)}}GLTFMeshOptPlugin.PluginType="GLTFMeshOptPlugin",GLTFMeshOptPlugin.DECODER_URL="https://unpkg.com/meshoptimizer@0.20.0/meshopt_decoder.module.js";var SnowFallPlugin_decorate=function(h,o,c,d){var _,b=arguments.length,_e=b<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_e=Reflect.decorate(h,o,c,d);else for(var it=h.length-1;it>=0;it--)(_=h[it])&&(_e=(b<3?_(_e):b>3?_(o,c,_e):_(o,c))||_e);return b>3&&_e&&Object.defineProperty(o,c,_e),_e},SnowFallPlugin_1;let SnowFallPlugin=SnowFallPlugin_1=class extends AViewerPlugin{constructor(){super(),this.enabled=!1,this.maxRange=maxRange,this.particleSize=.35,this.particleSpeed=.35,this.minRangeY=1,this.paused=!1,this._needsReset=!0,this._preFrame=()=>{var b,_e;if(!this._viewer||!this.enabled)return;const it=this.maxRange,nt=it/2;if(this._viewer.scene.fog){const mt=this._viewer.scene.activeCamera;this._viewer.scene.fog.near=Math.max(0,mt.near-2),this._viewer.scene.fog.far=mt.far}if(this._viewer.scene.backgroundColor&&((b=this._viewer.scene.fog)===null||b===void 0||b.color.set(this._viewer.scene.backgroundColor)),this.paused)return;const at=this.particles;at.material.size=this.particleSize;const ut=at.geometry.getAttribute("position"),pt=at.geometry.velocities;if(this._needsReset){for(let mt=0;mt<particleNum;mt++){const ft=Math.random()*it-nt,vt=Math.random()*it-nt,xt=Math.random()*it-nt;ut.setXYZ(mt,ft,vt,xt);const At=.005*(6*Math.random()-3),Ct=-.002*(10*Math.random()+3),Et=.005*(6*Math.random()-3);pt[mt].set(At,Ct,Et).multiplyScalar(this.particleSpeed)}this._needsReset=!1}for(let mt=0;mt<ut.count;mt++){const ft=pt[mt];if(!ft)return;const vt=g(),xt=.001*Math.sin(.001*vt*ft.x),At=.001*Math.cos(.0015*vt*ft.z);let Ct=ut.getX(mt)+xt,Et=ut.getY(mt)+ft.y,Tt=ut.getZ(mt)+At;Ct<-nt?Ct=nt:Ct>nt&&(Ct=-nt),Et<Math.max(-nt,-this.minRangeY)&&(Et=nt),Tt<-nt?Tt=nt:Tt>nt&&(Tt=-nt),ut.setX(mt,Ct),ut.setY(mt,Et),ut.setZ(mt,Tt)}ut.needsUpdate=!0,(_e=this._viewer)===null||_e===void 0||_e.setDirty()};const h=new three_module.LoY,o=[];for(let b=0;b<particleNum;b++){const _e=Math.random()*maxRange-minRange,it=Math.random()*maxRange-minRange,nt=Math.random()*maxRange-minRange;o.push(_e,it,nt)}h.setAttribute("position",new three_module.qtW(o,3));const c=new three_module.BH$({size:.75,color:16777215,vertexColors:!1,map:getTexture(),transparent:!0,fog:!0,depthWrite:!1});c.userData.renderToDepth=!1;const d=[];for(let b=0;b<particleNum;b++){const _e=.005*(6*Math.random()-3),it=-.002*(10*Math.random()+3),nt=.005*(6*Math.random()-3),at=new three_module.Pq0(_e,it,nt);d.push(at)}const _=new three_module.ONl(h,c);_.userData.bboxVisible=!1,_.geometry.velocities=d,this.particles=_}async onAdded(h){await super.onAdded(h),h.addEventListener("preFrame",this._preFrame),this.enabled&&await this.onEnable()}async onEnable(){var h,o;const c=this._viewer;if(!c)return;const d=c.getPlugin(FrameFadePlugin);if(!this.enabled)return this.particles.visible=!1,this.particles.geometry.dispose(),this.particles.material.dispose(),void(d&&d.enable(SnowFallPlugin_1.PluginType));c.scene.fog=new three_module.jUj((h=c.scene.backgroundColor)!==null&&h!==void 0?h:54,0,maxRange);const _=(o=c.scene.getObjectByName("SnowFallPlugin_root"))!==null&&o!==void 0?o:(await c.createObject3D(void 0,!0)).modelObject;_.name="SnowFallPlugin_root",_.clear(),d&&d.disable(SnowFallPlugin_1.PluginType),_.add(this.particles),this.particles.visible=!0,this._needsReset=!0}async onRemove(h){return h.removeEventListener("preFrame",this._preFrame),this.particles.removeFromParent(),super.onRemove(h)}reset(){this._needsReset=!0}};SnowFallPlugin.PluginType="SnowFallPlugin",SnowFallPlugin_decorate([uiToggle(),serialize(),x$1(SnowFallPlugin.prototype.onEnable)],SnowFallPlugin.prototype,"enabled",void 0),SnowFallPlugin_decorate([uiSlider("Bounds size",[1,50]),x$1(SnowFallPlugin.prototype.reset),serialize()],SnowFallPlugin.prototype,"maxRange",void 0),SnowFallPlugin_decorate([uiSlider("Particle size",[.01,2]),serialize()],SnowFallPlugin.prototype,"particleSize",void 0),SnowFallPlugin_decorate([uiSlider("Particle speed",[0,2]),x$1(SnowFallPlugin.prototype.reset),serialize()],SnowFallPlugin.prototype,"particleSpeed",void 0),SnowFallPlugin_decorate([uiSlider("Bottom clamp",[0,30]),serialize()],SnowFallPlugin.prototype,"minRangeY",void 0),SnowFallPlugin_decorate([uiToggle("Paused"),serialize()],SnowFallPlugin.prototype,"paused",void 0),SnowFallPlugin=SnowFallPlugin_1=SnowFallPlugin_decorate([uiFolder("Snow Fall Particles")],SnowFallPlugin);const particleNum=4e3,maxRange=17,minRange=maxRange/2,textureSize=64,drawRadialGradation=(h,o,c,d)=>{h.save();const _=h.createRadialGradient(o,o,0,o,o,o);_.addColorStop(0,"rgba(255,255,255,1.0)"),_.addColorStop(.5,"rgba(255,255,255,0.5)"),_.addColorStop(1,"rgba(255,255,255,0)"),h.fillStyle=_,h.fillRect(0,0,c,d),h.restore()},getTexture=()=>{const h=document.createElement("canvas"),o=h.getContext("2d");if(!o)throw new Error("no context");const c=textureSize;h.width=c,h.height=c,drawRadialGradation(o,c/2,h.width,h.height);const d=new three_module.gPd(h);return d.type=three_module.RQf,d.colorSpace="srgb-linear",d.needsUpdate=!0,d};class SnowFlakes extends three_module.B69{constructor(){super(),this.snowList=[],this.angle=0;const o=new three_module.LoY,c=[],d=new three_module.Tap,_=d.load("https://dl.dropbox.com/s/13ec3ht27adnu1l/snowflake1.png?dl=0"),b=d.load("https://dl.dropbox.com/s/rczse8o8zt5mxe6/snowflake2.png?dl=0"),_e=d.load("https://dl.dropbox.com/s/cs17pph4bu096k7/snowflake3.png?dl=0"),it=d.load("https://dl.dropbox.com/s/plwtcfvokuoz931/snowflake4.png?dl=0"),nt=d.load("https://dl.dropbox.com/s/uhh77omqdwqo2z5/snowflake5.png?dl=0"),at=[];for(let pt=0;pt<10;pt++){const mt=getRandom(0,500),ft=getRandom(0,500),vt=getRandom(0,500);at.push(mt,ft,vt)}o.setAttribute("position",new three_module.qtW(at,3));const ut=[["#FFFFFF",b,getRandom(10,10)],["#FFFFFF",_e,getRandom(10,15)],["#FFFFFF",_,getRandom(10,15)],["#FFFFFF",nt,getRandom(5,10)],["#FFFFFF",it,getRandom(5,10)]];for(let pt=0;pt<ut.length;pt++){const mt=ut[pt][1],ft=ut[pt][2];c[pt]=new three_module.BH$({size:ft,map:mt,blending:three_module.EZo,depthTest:!1,transparent:!0});const vt=new three_module.ONl(o,c[pt]);vt.rotation.x=360*Math.random(),vt.rotation.y=360*Math.random(),vt.rotation.z=360*Math.random(),vt.vx=0,vt.vy=0,vt.material.opacity=0,this.add(vt),this.snowList.push(vt)}}update(){this.angle+=.001;for(let o=0;o<this.snowList.length;o++)this.snowList[o].material.opacity+=.01,this.snowList[o].vy-=1,this.snowList[o].vx=Math.sin(this.angle)*Math.cos(this.angle)*10,this.snowList[o].vx*=.2,this.snowList[o].vy*=.6,this.snowList[o].position.x+=this.snowList[o].vx,this.snowList[o].position.y+=this.snowList[o].vy,this.snowList[o].position.y<-1e3&&(this.snowList[o].material.opacity+=.1,this.remove(this.snowList[o]),this.snowList.splice(o,1),o-=1);return this.snowList.length}}function getRandom(h,o){return Math.random()*(o-h)+h}var ModelStagePlugin_decorate=function(h,o,c,d){var _,b=arguments.length,_e=b<3?o:d===null?d=Object.getOwnPropertyDescriptor(o,c):d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_e=Reflect.decorate(h,o,c,d);else for(var it=h.length-1;it>=0;it--)(_=h[it])&&(_e=(b<3?_(_e):b>3?_(o,c,_e):_(o,c))||_e);return b>3&&_e&&Object.defineProperty(o,c,_e),_e};let ModelStagePlugin=class extends AViewerPlugin{constructor(){super(...arguments),this.enabled=!0,this.model="",this.dependencies=[AssetManagerPlugin],this._sceneUpdate=h=>{h.hierarchyChanged&&this.refreshTransform()},this._lastPhysicalGroundProps=void 0,this._animationStep=h=>{},this._animationStep2=h=>{this._animationStep(h)},this.groundBelowModel=!1}async promptLoadModel(){if(!this._viewer)return void console.warn("ModelStagePlugin: No viewer");const h=await ge$1(!1,!1);if(!h.length)return;const o=h[0];await this.setModel(o)}async promptLoadModelUrl(){if(!this._viewer)return void console.warn("ModelStagePlugin: No viewer");const h=await this._viewer.prompt("Model Stage Plugin: Enter URL for the 3d model (glb, gltf, obj, fbx, etc)");h&&await this.setModel(h)}async setModel(h){var o,c,d;if(!this._viewer)return void console.warn("ModelStagePlugin: No viewer");const _=this.modelRef,b=h?await this._viewer.load(typeof h=="string"?h:{path:h.name,file:h},{autoCenter:!1,autoScale:!1,addToRoot:!0,importConfig:!1}):void 0;if(!b&&h)return void console.warn("ModelStagePlugin: Unable to load stage model");this.model=h||"",this.modelRef=b,_&&_.modelObject!==((o=this.modelRef)===null||o===void 0?void 0:o.modelObject)&&_.dispose(),this.refreshTransform();const _e=this._viewer.getPlugin(LoadingScreenPlugin);return _e!=null&&_e.visible&&await _e.hideWithDelay(),(d=(c=this.uiConfig).uiRefresh)===null||d===void 0||d.call(c,"postRender",!0,1),this.model}refreshTransform(){var h,o,c,d,_,b;const _e=this.modelRef;if(!_e||!this._viewer)return;const it=this._viewer.getPluginByType("Ground");if(it){it.useModelBounds=this.groundBelowModel;const Et=this._viewer.getPlugin(GroundPlugin);Et&&(this.groundBelowModel?(this._lastPhysicalGroundProps={renderToDepth:Et.renderToDepth,physicalReflections:Et.physicalReflections,groundReflection:Et.groundReflection,material:{transparent:(h=Et.material)===null||h===void 0?void 0:h.transparent}},Et.renderToDepth=!1,Et.physicalReflections=!1,Et.groundReflection=!1,Et.material&&(Et.material.transparent=!0)):this._lastPhysicalGroundProps&&(Et.renderToDepth=this._lastPhysicalGroundProps.renderToDepth,Et.physicalReflections=this._lastPhysicalGroundProps.physicalReflections,Et.groundReflection=this._lastPhysicalGroundProps.groundReflection,Et.material&&this._lastPhysicalGroundProps.material&&(Et.material.transparent=this._lastPhysicalGroundProps.material.transparent),this._lastPhysicalGroundProps=void 0))}const nt=this._getPlaceholders(),at=nt[0];if(nt.forEach(Et=>Et.visible=!1),!at)return void console.warn("ModelStagePlugin: No placeholder found");const ut=this._viewer.scene.modelRoot.children[0];if(!ut)return void console.warn("ModelStagePlugin: No object in scene");const pt=new Box3B().expandByObject(ut,!0,!0),mt=new Box3B().expandByObject(at,!0,!1),ft=pt.getSize(new three_module.Pq0),vt=mt.getSize(new three_module.Pq0),xt=pt.getCenter(new three_module.Pq0),At=mt.getCenter(new three_module.Pq0),Ct=Math.max(ft.x/vt.x,ft.y/vt.y,ft.z/vt.z);if(isFinite(Ct)&&Ct!==0){_e.modelObject.scale.multiplyScalar(Ct),At.multiplyScalar(Ct),_e.modelObject.position.add(xt).sub(At),_e.modelObject.position.y+=(vt.y*Ct-ft.y)/2,(c=(o=_e.modelObject).setDirty)===null||c===void 0||c.call(o);for(let Et=1;Et<this._viewer.scene.modelRoot.children.length;Et++){const Tt=nt[Et%nt.length],kt=this._viewer.scene.modelRoot.children[Et];Tt.updateMatrixWorld(!0),kt.updateMatrixWorld(!0);const Dt=Tt.getWorldQuaternion(new three_module.PTz);kt.applyQuaternion(Dt),kt.updateMatrixWorld(!0);const zt=new Box3B().expandByObject(Tt,!0,!1),Bt=new Box3B().expandByObject(kt,!0,!0),Rt=zt.getSize(new three_module.Pq0),Ut=Bt.getSize(new three_module.Pq0),Ht=zt.getCenter(new three_module.Pq0),Jt=Bt.getCenter(new three_module.Pq0),Kt=Math.min(Rt.x/Ut.x,Rt.y/Ut.y,Rt.z/Ut.z);isFinite(Kt)&&Kt!==0&&(kt.scale.multiplyScalar(Kt),Jt.multiplyScalar(Kt),kt.position.add(Ht).sub(Jt),kt.position.y+=(Ut.y*Kt-Rt.y)/2,(_=(d=kt).setDirty)===null||_===void 0||_.call(d))}if(at.updateMatrixWorld(!0),_e.modelObject.animations.length){let Et=at.matrixWorld.clone();this._animationStep=()=>{const Tt=at.matrixWorld.clone(),kt=Et.invert().premultiply(Tt);ut.applyMatrix4(kt),Et=Tt}}else this._animationStep=()=>{};if(!this.groundBelowModel){const Et=this._viewer.getPluginByType("Ground");if(!((b=Et==null?void 0:Et.mesh)===null||b===void 0)&&b.modelObject&&Et){const Tt=new Box3B().expandByObject(_e.modelObject,!0,!1).getSize(new three_module.Pq0),kt=Math.max(Tt.x,Tt.z);Et.autoFrustumSize=!1,Et.size=kt;const Dt=Et.shadowBaker;Dt&&(Dt.light.shadowParams.frustumSize=2*kt,Dt.light.updateShadowParams())}}}}_getPlaceholders(h){var o;const c=[];return(o=h??this.modelRef)===null||o===void 0||o.modelObject.traverse(d=>{d.name.toLowerCase().startsWith("placeholder")&&c.push(d)}),c}async onAdded(h){var o;await super.onAdded(h),h.scene.addEventListener("sceneUpdate",this._sceneUpdate),(o=h.getPlugin(GLTFAnimationPlugin))===null||o===void 0||o.addEventListener("animationStep",this._animationStep2)}async onRemove(h){var o;return this.modelRef&&this.modelRef.dispose(),h.scene.removeEventListener("sceneUpdate",this._sceneUpdate),(o=h.getPlugin(GLTFAnimationPlugin))===null||o===void 0||o.removeEventListener("animationStep",this._animationStep2),super.onRemove(h)}fromJSON(h,o){return h.model!==void 0&&this.setModel(h.model),super.fromJSON(h,o)}loadSampleModel(){console.log("Sample model loading disabled - using local assets only")}togglePlaceholders(){var h;this._getPlaceholders().forEach(o=>{o.material&&(o.material.opacity=Math.min(.75,o.material.opacity||1),o.material.transparent=!0),o.visible=!o.visible}),(h=this._viewer)===null||h===void 0||h.setDirty()}importStageViewerConfig(){var h,o,c;const d=((h=this.modelRef)===null||h===void 0?void 0:h.modelObject).__importedViewerConfig;if(!d||typeof d!="object"||!this._viewer)return;const _=this._viewer.scene.activeCamera.toJSON(),b=this._viewer.serializePluginsIgnored;this._viewer.serializePluginsIgnored=[...b,LoadingScreenPlugin.PluginType,InteractionPromptPlugin.PluginType,"ReliefParallaxMapping","RendererParamsUiPlugin",CameraViewPlugin.PluginType,"MaterialConfiguratorPlugin","SwitchNodePlugin","FrameFade","GLTFAnimationPlugin","ModelStagePlugin",SnowFallPlugin.PluginType],(c=(o=this._viewer)===null||o===void 0?void 0:o.assetManager)===null||c===void 0||c.applyViewerConfig(d,d.resources),this._viewer.serializePluginsIgnored=b,this._viewer.scene.activeCamera.fromJSON(_)}};ModelStagePlugin.PluginType="ModelStagePlugin",ModelStagePlugin_decorate([serialize()],ModelStagePlugin.prototype,"model",void 0),ModelStagePlugin_decorate([uiButton("Prompt Local File")],ModelStagePlugin.prototype,"promptLoadModel",null),ModelStagePlugin_decorate([uiButton("Prompt URL")],ModelStagePlugin.prototype,"promptLoadModelUrl",null),ModelStagePlugin_decorate([uiButton("Refresh Placeholder Transform")],ModelStagePlugin.prototype,"refreshTransform",null),ModelStagePlugin_decorate([serialize(),x$1(ModelStagePlugin.prototype.refreshTransform),uiToggle()],ModelStagePlugin.prototype,"groundBelowModel",void 0),ModelStagePlugin_decorate([uiButton("Load sample model")],ModelStagePlugin.prototype,"loadSampleModel",null),ModelStagePlugin_decorate([uiButton("Toggle Placeholders")],ModelStagePlugin.prototype,"togglePlaceholders",null),ModelStagePlugin_decorate([uiButton("Import Stage Config",h=>({hidden:()=>{var o,c;return!(!((c=(o=h.modelRef)===null||o===void 0?void 0:o.modelObject)===null||c===void 0)&&c.__importedViewerConfig)}}))],ModelStagePlugin.prototype,"importStageViewerConfig",null),ModelStagePlugin=ModelStagePlugin_decorate([uiFolder("Model Stage")],ModelStagePlugin);class CoreViewerApp extends ViewerApp{constructor(o){super(o),this.licenseKey=o.licenseKey}async initialize({caching:o=!0,ground:c=!0,bloom:d=!0,depthTonemap:_=!0,enableDrop:b=!1,importPopup:_e=!0,debug:it=!1,interactionPrompt:nt=!0}={}){it&&await this.addPlugin(DebugPlugin),this.getPlugin(AssetManagerPlugin)||this.addPluginSync(AssetManagerPlugin,void 0,void 0,{storage:o&&window.caches?await caches.open("webgi-cache-storage"):void 0}),await addBasePlugins(this,{ground:c,bloom:d,depthTonemap:_,enableDrop:b,importPopup:_e,interactionPrompt:nt}),await this.getOrAddPlugin(PresetLibraryPlugin);const at=await this.getOrAddPlugin(DiamondPlugin);return this.licenseKey&&at.setKey(this.licenseKey),await this.addPlugin(MaterialConfiguratorPlugin),await this.addPlugin(SwitchNodePlugin),await this.addPlugin(MaterialLibraryPlugin),this}}async function addBasePlugins(h,{ground:o=!0,bloom:c=!0,depthTonemap:d=!0,enableDrop:_=!1,importPopup:b=!1,interactionPrompt:_e=!0}={}){await h.getOrAddPlugin(AssetManagerPlugin),b&&await h.getOrAddPlugin(LoadingScreenPlugin),await h.getOrAddPlugin(GBufferPlugin),await h.getOrAddPlugin(FullScreenPlugin),_&&await h.getOrAddPlugin(DropzonePlugin),await h.addPlugin(new ProgressivePlugin(32)),await h.getOrAddPlugin(CombinedPostPlugin),await h.getOrAddPlugin(ChromaticAberrationPlugin),await h.addPlugin(new TonemapPlugin(d||!h.useRgbm)),await h.getOrAddPlugin(LUTPlugin),await h.getOrAddPlugin(VignettePlugin),await h.getOrAddPlugin(FilmicGrainPlugin),await h.getOrAddPlugin(GammaCorrectionPlugin),await h.getOrAddPlugin(SSRPlugin),await h.getOrAddPlugin(SSAOPlugin),await h.getOrAddPlugin(FrameFadePlugin),await h.getOrAddPlugin(GLTFAnimationPlugin),await h.getOrAddPlugin(AnisotropyPlugin),await h.getOrAddPlugin(TriplanarUVMappingPlugin),await h.getOrAddPlugin(ThinFilmLayerPlugin),await h.getOrAddPlugin(FragmentClippingExtensionPlugin),await h.getOrAddPlugin(NoiseBumpMaterialPlugin),await h.getOrAddPlugin(CustomBumpMapPlugin),await h.getOrAddPlugin(ClearcoatTintPlugin),await h.getOrAddPlugin(GLTFKHRMaterialVariantsPlugin),await h.getOrAddPlugin(VelocityBufferPlugin,!1),await h.getOrAddPlugin(TemporalAAPlugin),await h.getOrAddPlugin(CameraViewPlugin),await h.getOrAddPlugin(RandomizedDirectionalLightPlugin,!1),await h.getOrAddPlugin(HDRiGroundPlugin,!1),await h.getOrAddPlugin(DepthOfFieldPlugin,!1),await h.getOrAddPlugin(SSContactShadows,!1),await h.getOrAddPlugin(SSGIPlugin,!1),await h.getOrAddPlugin(NormalBufferPlugin,!1),await h.getOrAddPlugin(SSBevelPlugin,!1),await h.getOrAddPlugin(KTX2LoadPlugin),await h.getOrAddPlugin(ObjMtlLoadPlugin),await h.getOrAddPlugin(FBXLoadPlugin),await h.getOrAddPlugin(Rhino3dmLoadPlugin),await h.getOrAddPlugin(STLLoadPlugin),await h.getOrAddPlugin(EXRLoadPlugin),await h.getOrAddPlugin(GLTFMeshOptPlugin),await h.getOrAddPlugin(ModelStagePlugin),await h.getOrAddPlugin(ParallaxCameraControllerPlugin),c&&await h.getOrAddPlugin(BloomPlugin),o&&await h.getOrAddPlugin(GroundPlugin),_e&&await h.getOrAddPlugin(InteractionPromptPlugin),await h.getOrAddPlugin(LayeredMaterialPlugin),h.renderer.refreshPipeline()}var dist_tippy=__webpackgi_require__(774),tippy_exported={};dist_tippy.A&&dist_tippy.A.locals&&(tippy_exported.locals=dist_tippy.A.locals);var tippy_refs=0,tippy_update,tippy_options={};tippy_options.styleTagTransform=styleTagTransform_default(),tippy_options.setAttributes=setAttributesWithoutAttributes_default(),tippy_options.insert=function(h,o){(o.target||document.head).appendChild(h)},tippy_options.domAPI=styleDomAPI_default(),tippy_options.insertStyleElement=insertStyleElement_default(),tippy_exported.use=function(h){return tippy_options.options=h||{},tippy_refs++||(tippy_update=injectStylesIntoStyleTag_default()(dist_tippy.A,tippy_options)),tippy_exported},tippy_exported.unuse=function(){tippy_refs>0&&!--tippy_refs&&(tippy_update(),tippy_update=null)};var tippy_js_dist_tippy=tippy_exported;const placeholderModel="",placeholderEnvironment="";let id$3=0;class WebGiViewerElement extends HTMLElement{constructor(){super(),this._initialized=!1,this._state={src:"",environment:""},this._models={},this._refreshingModels=!1,this._refreshingEnvironment=!1,this._environmentFromSource=null,this.viewerIndex=id$3++,this.canvasId="webgi-viewer-"+this.viewerIndex,window.freeViewers||(window.freeViewers=[]),this.attachShadow({mode:"open"}),this.wrapper=document.createElement("div"),this.wrapper.style.width="100%",this.wrapper.style.height="100%",this.wrapper.style.display="block";const o=window.freeViewers.pop(),c=document.createElement("style");c.textContent=$`
            #${this.canvasId}{
              width: 100%; height: 100%; z-index: 1;
              display: block;
            }
            //.tippy-box[data-theme~='editor']{
            //    margin: 0.25rem !important;
            //    background-color: hsla(230, 10%, 30%, 1.00) !important;
            //    font-size: 0.9rem !important;
            //    color: hsla(230, 5%, 90%, 1.00) !important;
            //}
        `,tippy_js_dist_tippy.use({target:this.wrapper}),tippy_esm.setDefaultProps({duration:300,arrow:!0,appendTo:()=>this.wrapper}),this.shadowRoot.append(c,this.wrapper),this._initialized=!0,this._initialize(o).then(async()=>this.refreshAll())}async refreshAll(){this.viewer&&(this.viewer.renderer.displayCanvasScaling=parseFloat(this.getAttribute("renderScale")||this.getAttribute("renderscale")||this.viewer.renderer.displayCanvasScaling.toString())),await Promise.all([this.refreshModelSource(),this.refreshEnvironment()])}async _initialize(o){o!=null&&o._lastState&&(this._state.src=o._lastState.src||this._state.src,this._state.environment=o._lastState.environment||this._state.environment,delete o._lastState),o!=null&&o.__models&&(this._models={...this._models,...o.__models},delete o.__models),this.canvas=(o==null?void 0:o.canvas)||j(),this.canvas.setAttribute("id",this.canvasId),this.wrapper.append(this.canvas),this.viewer=o??new CoreViewerApp({canvas:this.canvas,useRgbm:this._getAttr("rgbm","true")==="true",useGBufferDepth:this._getAttr("depth-prepass","true")==="true",assetManager:{storage:window.caches?await caches.open("webgi-cache-storage"):void 0}}),this.viewer&&(this.viewer.renderer.displayCanvasScaling=parseFloat(this.getAttribute("renderScale")||this.getAttribute("renderscale")||this.viewer.renderer.displayCanvasScaling.toString())),o||await this.viewer.initialize({debug:this._getAttr("debug","false")==="true",ground:this._getAttr("ground","baked")==="baked",bloom:this._getAttr("bloom","true")==="true",depthTonemap:!0}),this.dispatchEvent(new Event("initialized"))}connectedCallback(){this._initialized&&this.viewer&&(this.viewer.resize(),this.viewer.enabled=!0,this.dispatchEvent(new Event("connected")))}disconnectedCallback(){var o,c;this.viewer&&(this.getAttribute("disposeOnRemove")==="true"||this.getAttribute("disposeonremove")==="true"?((o=this.canvas)===null||o===void 0||o.remove(),this.clearViewer(),this.viewer.dispose(),this.viewer=void 0,this.canvas=void 0,this._initialized=!1):this.getAttribute("autoManageViewers")==="true"||this.getAttribute("automanageviewers")==="true"?((c=this.canvas)===null||c===void 0||c.remove(),this.viewer._lastState={...this._state},this.viewer._lastState.src="",this.clearViewer(),window.freeViewers.push(this.viewer),this.viewer=void 0,this.canvas=void 0,this._initialized=!1):this.viewer.enabled=!1,this.dispatchEvent(new Event("disconnected")))}adoptedCallback(){this.viewer&&(this.viewer.resize(),this.viewer.enabled=!0)}static get observedAttributes(){return["src","environment","renderScale"]}attributeChangedCallback(o,c,d){this.refreshAll()}clearViewer(){var o,c;(o=this.viewer)===null||o===void 0||o.scene.disposeSceneModels(),(c=this.viewer)===null||c===void 0||c.scene.setEnvironment(null),Object.values(this._models).forEach(async d=>d.then(_=>_.forEach(b=>b.dispose&&b.dispose()))),this._models={}}async refreshModelSource(){if(!this.viewer)return;const o=this._getAttr("src",placeholderModel);if(o===this._state.src||this._refreshingModels)return;this._refreshingModels=!0;const c=[o],d=[],_=[],b=this.viewer.scene.environment;this.viewer.scene.environment=null,this._environmentFromSource=null;for(const it of c)!this._models[it]&&it&&(this._models[it]=this.viewer.getManager().importer.importPath(it,{autoScale:this._getAttr("auto-scale","true")==="true",autoCenter:this._getAttr("auto-center","true")==="true",processImported:!0,pathOverride:this._getAttr("filename","")||void 0}));const _e=this.viewer.scene.environment;_e?this._environmentFromSource=_e:this.viewer.scene.environment=b;for(const[it,nt]of Object.entries(this._models))c.includes(it)?d.push(nt.then(at=>[it,at])):_.push(nt);await Promise.all([Promise.all(d).then(async it=>Promise.all(it.map(async nt=>(this._models[nt[0]]=this.viewer.getManager().importer.processImported(nt[1]),this._models[nt[0]])))).then(it=>{for(const nt of it)for(const at of nt)at&&at.assetType==="model"&&this.viewer.scene.addSceneObject(at)}),Promise.all(_).then(it=>{for(const nt of it)for(const at of nt)at&&at.assetType==="model"&&at.modelObject.removeFromParent()})]),this._state.src=o,this._refreshingModels=!1}async refreshEnvironment(){if(!this.viewer)return;if(!this.hasAttribute("environment"))return void(this._state.environment=null);if(this._environmentFromSource)return void this.viewer.console.warn("Environment is already set by model source, ignoring environment attribute.");const o=this._getAttr("environment",placeholderEnvironment);if(o===this._state.src||this._refreshingEnvironment)return;this._refreshingEnvironment=!0;const c=this.viewer.scene.getEnvironment(),d=o?await this.viewer.getManager().importer.importSinglePath(o):void 0;this._environmentFromSource?this.viewer.console.warn("Environment is already set by model source, ignoring environment attribute."):(d&&d.assetType!=="texture"||await this.viewer.scene.setEnvironment(d),c==null||c.dispose(),this.dispatchEvent(new CustomEvent("environment-loaded",{detail:{src:o}})),this._state.environment=o,this._refreshingEnvironment=!1)}_getAttr(o,c){return this.hasAttribute(o)?this.getAttribute(o):c}addEventListener(o,c,d){super.addEventListener(o,c,d),o==="initialized"&&this._initialized&&this.dispatchEvent(new Event("initialized"))}}window&&window.customElements&&!window.customElements.get("webgi-viewer")&&window.customElements.define("webgi-viewer",WebGiViewerElement);var popup=__webpackgi_require__(636),popup_exported={};popup.A&&popup.A.locals&&(popup_exported.locals=popup.A.locals);var popup_refs=0,popup_update,popup_options={};popup_options.styleTagTransform=styleTagTransform_default(),popup_options.setAttributes=setAttributesWithoutAttributes_default(),popup_options.insert=function(h,o){(o.target||document.head).appendChild(h)},popup_options.domAPI=styleDomAPI_default(),popup_options.insertStyleElement=insertStyleElement_default(),popup_exported.use=function(h){return popup_options.options=h||{},popup_refs++||(popup_update=injectStylesIntoStyleTag_default()(popup.A,popup_options)),popup_exported},popup_exported.unuse=function(){popup_refs>0&&!--popup_refs&&(popup_update(),popup_update=null)};var styles_popup=popup_exported,AssetManagerPopupPlugin_decorate=function(h,o,c,d){var _,b=arguments.length,_e=b<3?o:d===null?d=Object.getOwnPropertyDescriptor(o,c):d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_e=Reflect.decorate(h,o,c,d);else for(var it=h.length-1;it>=0;it--)(_=h[it])&&(_e=(b<3?_(_e):b>3?_(o,c,_e):_(o,c))||_e);return b>3&&_e&&Object.defineProperty(o,c,_e),_e};let AssetManagerBasicPopupPlugin=class extends AAssetManagerProcessStatePlugin{constructor(){super("Popup");const h=ee$1({id:"assetManagerPopupClose",addToBody:!1,innerHTML:"&#10005"});h.addEventListener("click",()=>{this._mainDiv.style.display="none"}),this._mainDiv.appendChild(h)}_updateMainDiv(h){if(!this._contentDiv)return;if(!this.enabled)return void(this._mainDiv.style.display="none");let o="";h.forEach((c,d)=>{o+=`<span class="processState">${c.state}</span>: ${(d||"").split("/").pop()} ${c.progress?" - "+c.progress.toFixed(0)+"%":""}<br>`}),this._contentDiv.innerHTML=o,h.size===0?this._mainDiv.style.display="none":this._mainDiv.style.display="block"}async onAdded(h){styles_popup.use({target:h.container}),await super.onAdded(h)}};AssetManagerBasicPopupPlugin.PluginType="AssetManagerBasicPopupPlugin",AssetManagerBasicPopupPlugin=AssetManagerPopupPlugin_decorate([uiFolder("Asset manager popup")],AssetManagerBasicPopupPlugin);var loadingBar=__webpackgi_require__(223),loadingBar_exported={};loadingBar.A&&loadingBar.A.locals&&(loadingBar_exported.locals=loadingBar.A.locals);var loadingBar_refs=0,loadingBar_update,loadingBar_options={};loadingBar_options.styleTagTransform=styleTagTransform_default(),loadingBar_options.setAttributes=setAttributesWithoutAttributes_default(),loadingBar_options.insert=function(h,o){(o.target||document.head).appendChild(h)},loadingBar_options.domAPI=styleDomAPI_default(),loadingBar_options.insertStyleElement=insertStyleElement_default(),loadingBar_exported.use=function(h){return loadingBar_options.options=h||{},loadingBar_refs++||(loadingBar_update=injectStylesIntoStyleTag_default()(loadingBar.A,loadingBar_options)),loadingBar_exported},loadingBar_exported.unuse=function(){loadingBar_refs>0&&!--loadingBar_refs&&(loadingBar_update(),loadingBar_update=null)};var styles_loadingBar=loadingBar_exported,AssetManagerLoadingBarPlugin_decorate=function(h,o,c,d){var _,b=arguments.length,_e=b<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_e=Reflect.decorate(h,o,c,d);else for(var it=h.length-1;it>=0;it--)(_=h[it])&&(_e=(b<3?_(_e):b>3?_(o,c,_e):_(o,c))||_e);return b>3&&_e&&Object.defineProperty(o,c,_e),_e};let AssetManagerLoadingBarPlugin=class extends AAssetManagerProcessStatePlugin{constructor(h=!0){super("LoadingBar"),this.showText=h,this.hideOnOnlyErrors=!0}_updateMainDiv(h){if(!this._contentDiv)return;if(!this.enabled)return void(this._mainDiv.style.display="none");let o=1,c=1;h.forEach((_,b)=>{var _e;o+=(_e=_.progress)!==null&&_e!==void 0?_e:99,c+=100}),this._contentDiv.innerHTML=this.showText?(100*o/c).toFixed(0)+"%":"&nbsp;",this._contentDiv.style.width=(100*o/c).toFixed(0)+"%";const d=[...h.values()].filter(_=>_.state==="error");d.length>0&&d.length===h.size&&this.hideOnOnlyErrors||h.size===0?this._mainDiv.style.display="none":this._mainDiv.style.display="block"}async onAdded(h){styles_loadingBar.use({target:h.container}),await super.onAdded(h)}};AssetManagerLoadingBarPlugin.PluginType="AssetManagerLoadingBarPlugin",AssetManagerLoadingBarPlugin_decorate([uiToggle("Hide on only errors"),serialize()],AssetManagerLoadingBarPlugin.prototype,"hideOnOnlyErrors",void 0),AssetManagerLoadingBarPlugin=AssetManagerLoadingBarPlugin_decorate([uiFolder("Asset manager loading bar")],AssetManagerLoadingBarPlugin);class SimpleAssetList{get basePath(){return this._basePath}get assets(){return this._assets}constructor(o){var c,d,_;this._basePath=(c=o==null?void 0:o.basePath)!==null&&c!==void 0?c:"",this._assets=(_=(d=o==null?void 0:o.assets)===null||d===void 0?void 0:d.map(b=>this._resolveAsset(b)))!==null&&_!==void 0?_:[]}find(o){return this._assets.find(o)??void 0}_resolveAsset(o){return{...o,path:ot([this._basePath,o.path])}}}class SimpleDataSource extends I$2{constructor(...o){super(),this._assets=o}addAssetList(o){this._assets.push(o)}removeAssetList(o){const c=this._assets.indexOf(o);c>=0&&this._assets.splice(c,1)}async findAssetRegex(o){for(const c of this._assets){const d=c.find(_=>{var b,_e;return _&&(o.test(_.path)||o.test((_e=(b=_.file)===null||b===void 0?void 0:b.name)!==null&&_e!==void 0?_e:""))});if(d)return d}console.warn("Asset not found:",o)}async findAsset(o){return this.findAssetRegex(o.query)}async findAssetSimple(o,c=!1){return this.findAssetRegex(new RegExp(o,c?"i":""))}}const LineSegments2_start=new three_module.Pq0,LineSegments2_end=new three_module.Pq0,_start4=new three_module.IUQ,_end4=new three_module.IUQ,_ssOrigin=new three_module.IUQ,_ssOrigin3=new three_module.Pq0,_mvMatrix=new three_module.kn4,_line=new three_module.cZY,_closestPoint=new three_module.Pq0,LineSegments2_box=new three_module.NRn,_sphere=new three_module.iyt,_clipToWorldVector=new three_module.IUQ;let LineSegments2_ray,_lineWidth;function getWorldSpaceHalfWidth(h,o,c){return _clipToWorldVector.set(0,0,-o,1).applyMatrix4(h.projectionMatrix),_clipToWorldVector.multiplyScalar(1/_clipToWorldVector.w),_clipToWorldVector.x=_lineWidth/c.width,_clipToWorldVector.y=_lineWidth/c.height,_clipToWorldVector.applyMatrix4(h.projectionMatrixInverse),_clipToWorldVector.multiplyScalar(1/_clipToWorldVector.w),Math.abs(Math.max(_clipToWorldVector.x,_clipToWorldVector.y))}function raycastWorldUnits(h,o){const c=h.matrixWorld,d=h.geometry,_=d.attributes.instanceStart,b=d.attributes.instanceEnd;for(let _e=0,it=Math.min(d.instanceCount,_.count);_e<it;_e++){_line.start.fromBufferAttribute(_,_e),_line.end.fromBufferAttribute(b,_e),_line.applyMatrix4(c);const nt=new three_module.Pq0,at=new three_module.Pq0;LineSegments2_ray.distanceSqToSegment(_line.start,_line.end,at,nt),at.distanceTo(nt)<.5*_lineWidth&&o.push({point:at,pointOnLine:nt,distance:LineSegments2_ray.origin.distanceTo(at),object:h,face:null,faceIndex:_e,uv:null,uv1:null})}}function raycastScreenSpace(h,o,c){const d=o.projectionMatrix,_=h.material.resolution,b=h.matrixWorld,_e=h.geometry,it=_e.attributes.instanceStart,nt=_e.attributes.instanceEnd,at=Math.min(_e.instanceCount,it.count),ut=-o.near;LineSegments2_ray.at(1,_ssOrigin),_ssOrigin.w=1,_ssOrigin.applyMatrix4(o.matrixWorldInverse),_ssOrigin.applyMatrix4(d),_ssOrigin.multiplyScalar(1/_ssOrigin.w),_ssOrigin.x*=_.x/2,_ssOrigin.y*=_.y/2,_ssOrigin.z=0,_ssOrigin3.copy(_ssOrigin),_mvMatrix.multiplyMatrices(o.matrixWorldInverse,b);for(let pt=0,mt=at;pt<mt;pt++){if(_start4.fromBufferAttribute(it,pt),_end4.fromBufferAttribute(nt,pt),_start4.w=1,_end4.w=1,_start4.applyMatrix4(_mvMatrix),_end4.applyMatrix4(_mvMatrix),_start4.z>ut&&_end4.z>ut)continue;if(_start4.z>ut){const Ct=_start4.z-_end4.z,Et=(_start4.z-ut)/Ct;_start4.lerp(_end4,Et)}else if(_end4.z>ut){const Ct=_end4.z-_start4.z,Et=(_end4.z-ut)/Ct;_end4.lerp(_start4,Et)}_start4.applyMatrix4(d),_end4.applyMatrix4(d),_start4.multiplyScalar(1/_start4.w),_end4.multiplyScalar(1/_end4.w),_start4.x*=_.x/2,_start4.y*=_.y/2,_end4.x*=_.x/2,_end4.y*=_.y/2,_line.start.copy(_start4),_line.start.z=0,_line.end.copy(_end4),_line.end.z=0;const ft=_line.closestPointToPointParameter(_ssOrigin3,!0);_line.at(ft,_closestPoint);const vt=three_module.cj9.lerp(_start4.z,_end4.z,ft),xt=vt>=-1&&vt<=1,At=_ssOrigin3.distanceTo(_closestPoint)<.5*_lineWidth;if(xt&&At){_line.start.fromBufferAttribute(it,pt),_line.end.fromBufferAttribute(nt,pt),_line.start.applyMatrix4(b),_line.end.applyMatrix4(b);const Ct=new three_module.Pq0,Et=new three_module.Pq0;LineSegments2_ray.distanceSqToSegment(_line.start,_line.end,Et,Ct),c.push({point:Et,pointOnLine:Ct,distance:LineSegments2_ray.origin.distanceTo(Et),object:h,face:null,faceIndex:pt,uv:null,uv1:null})}}}class LineSegments2 extends three_module.eaF{constructor(o=new LineSegmentsGeometry,c=new LineMaterial({color:16777215*Math.random()})){super(o,c),this.isLineSegments2=!0,this.type="LineSegments2"}computeLineDistances(){const o=this.geometry,c=o.attributes.instanceStart,d=o.attributes.instanceEnd,_=new Float32Array(2*c.count);for(let _e=0,it=0,nt=c.count;_e<nt;_e++,it+=2)LineSegments2_start.fromBufferAttribute(c,_e),LineSegments2_end.fromBufferAttribute(d,_e),_[it]=it===0?0:_[it-1],_[it+1]=_[it]+LineSegments2_start.distanceTo(LineSegments2_end);const b=new three_module.LuO(_,2,1);return o.setAttribute("instanceDistanceStart",new three_module.eHs(b,1,0)),o.setAttribute("instanceDistanceEnd",new three_module.eHs(b,1,1)),this}raycast(o,c){const d=this.material.worldUnits,_=o.camera;_!==null||d||console.error('LineSegments2: "Raycaster.camera" needs to be set in order to raycast against LineSegments2 while worldUnits is set to false.');const b=o.params.Line2!==void 0&&o.params.Line2.threshold||0;LineSegments2_ray=o.ray;const _e=this.matrixWorld,it=this.geometry,nt=this.material;let at,ut;_lineWidth=nt.linewidth+b,it.boundingSphere===null&&it.computeBoundingSphere(),_sphere.copy(it.boundingSphere).applyMatrix4(_e),at=d?.5*_lineWidth:getWorldSpaceHalfWidth(_,Math.max(_.near,_sphere.distanceToPoint(LineSegments2_ray.origin)),nt.resolution),_sphere.radius+=at,LineSegments2_ray.intersectsSphere(_sphere)!==!1&&(it.boundingBox===null&&it.computeBoundingBox(),LineSegments2_box.copy(it.boundingBox).applyMatrix4(_e),ut=d?.5*_lineWidth:getWorldSpaceHalfWidth(_,Math.max(_.near,LineSegments2_box.distanceToPoint(LineSegments2_ray.origin)),nt.resolution),LineSegments2_box.expandByScalar(ut),LineSegments2_ray.intersectsBox(LineSegments2_box)!==!1&&(d?raycastWorldUnits(this,c):raycastScreenSpace(this,_,c)))}}class LineGeometry extends LineSegmentsGeometry{constructor(){super(),this.isLineGeometry=!0,this.type="LineGeometry"}setPositions(o){const c=o.length-3,d=new Float32Array(2*c);for(let _=0;_<c;_+=3)d[2*_]=o[_],d[2*_+1]=o[_+1],d[2*_+2]=o[_+2],d[2*_+3]=o[_+3],d[2*_+4]=o[_+4],d[2*_+5]=o[_+5];return super.setPositions(d),this}setColors(o){const c=o.length-3,d=new Float32Array(2*c);for(let _=0;_<c;_+=3)d[2*_]=o[_],d[2*_+1]=o[_+1],d[2*_+2]=o[_+2],d[2*_+3]=o[_+3],d[2*_+4]=o[_+4],d[2*_+5]=o[_+5];return super.setColors(d),this}fromLine(o){const c=o.geometry;return this.setPositions(c.attributes.position.array),this}}class Line2 extends LineSegments2{constructor(o=new LineGeometry,c=new LineMaterial({color:16777215*Math.random()})){super(o,c),this.isLine2=!0,this.type="Line2"}}class KTXLoader extends three_module.YRT{constructor(o){super(o)}parse(o,c){const d=new KhronosTextureContainer(o,1);return{mipmaps:d.mipmaps(c),width:d.pixelWidth,height:d.pixelHeight,format:d.glInternalFormat,isCubemap:d.numberOfFaces===6,mipmapCount:d.numberOfMipmapLevels}}}const HEADER_LEN=64,COMPRESSED_2D=0;class KhronosTextureContainer{constructor(o,c){this.arrayBuffer=o;const d=new Uint8Array(this.arrayBuffer,0,12);if(d[0]!==171||d[1]!==75||d[2]!==84||d[3]!==88||d[4]!==32||d[5]!==49||d[6]!==49||d[7]!==187||d[8]!==13||d[9]!==10||d[10]!==26||d[11]!==10)return void console.error("texture missing KTX identifier");const _=Uint32Array.BYTES_PER_ELEMENT,b=new DataView(this.arrayBuffer,12,13*_),_e=b.getUint32(0,!0)===67305985;this.glType=b.getUint32(1*_,_e),this.glTypeSize=b.getUint32(2*_,_e),this.glFormat=b.getUint32(3*_,_e),this.glInternalFormat=b.getUint32(4*_,_e),this.glBaseInternalFormat=b.getUint32(5*_,_e),this.pixelWidth=b.getUint32(6*_,_e),this.pixelHeight=b.getUint32(7*_,_e),this.pixelDepth=b.getUint32(8*_,_e),this.numberOfArrayElements=b.getUint32(9*_,_e),this.numberOfFaces=b.getUint32(10*_,_e),this.numberOfMipmapLevels=b.getUint32(11*_,_e),this.bytesOfKeyValueData=b.getUint32(12*_,_e),this.glType===0?(this.numberOfMipmapLevels=Math.max(1,this.numberOfMipmapLevels),this.pixelHeight!==0&&this.pixelDepth===0?this.numberOfArrayElements===0?this.numberOfFaces===c?this.loadType=COMPRESSED_2D:console.warn("number of faces expected"+c+", but found "+this.numberOfFaces):console.warn("texture arrays not currently supported"):console.warn("only 2D textures currently supported")):console.warn("only compressed formats currently supported")}mipmaps(o){const c=[];let d=HEADER_LEN+this.bytesOfKeyValueData,_=this.pixelWidth,b=this.pixelHeight;const _e=o?this.numberOfMipmapLevels:1;for(let it=0;it<_e;it++){const nt=new Int32Array(this.arrayBuffer,d,1)[0];d+=4;for(let at=0;at<this.numberOfFaces;at++){const ut=new Uint8Array(this.arrayBuffer,d,nt);c.push({data:ut,width:_,height:b}),d+=nt,d+=3-(nt+3)%4}_=Math.max(1,.5*_),b=Math.max(1,.5*b)}return c}}class KTXLoadPlugin extends I$2{constructor(){super(...arguments),this.dependencies=[AssetManagerPlugin]}async onAdded(o){var c,d;this._importer||(this._importer=new Importer(KTXLoader,["ktx"],!1)),(d=(c=o.getManager())===null||c===void 0?void 0:c.importer)===null||d===void 0||d.Importers.push(this._importer)}async onDispose(o){this._importer=void 0}async onRemove(o){var c,d;this._importer&&!((d=(c=o.getManager())===null||c===void 0?void 0:c.importer)===null||d===void 0)&&d.Importers&&o.getManager().importer.Importers.splice(o.getManager().importer.Importers.indexOf(this._importer),1),this._importer=void 0}}KTXLoadPlugin.PluginType="KTXLoadPlugin";class BlobLoader extends three_module.Y9S{constructor(o){super(o),this.responseType="blob"}}class DataUrlLoader extends three_module.Y9S{constructor(o){super(o),this.responseType="blob"}load(o,c,d,_){return super.load(o,b=>{try{c==null||c(q$2(b))}catch(_e){_==null||_(_e)}},d,_)}}class SimpleJSONExporter{async parseAsync(o,c){var d;return new Blob([JSON.stringify(o,null,(d=c.jsonSpaces)!==null&&d!==void 0?d:2)],{type:"application/json"})}}class SimpleTextExporter{async parseAsync(o,c){return new Blob([o],{type:"text/plain"})}}let _renderer,fullscreenQuadGeometry,fullscreenQuadMaterial,fullscreenQuad;function TextureUtils_decompress(h,o=1/0,c=null){fullscreenQuadGeometry||(fullscreenQuadGeometry=new three_module.bdM(2,2,1,1)),fullscreenQuadMaterial||(fullscreenQuadMaterial=new three_module.BKk({uniforms:{blitTexture:new three_module.nc$(h)},vertexShader:`
            varying vec2 vUv;
            void main(){
                vUv = uv;
                gl_Position = vec4(position.xy * 1.0,0.,.999999);
            }`,fragmentShader:`
            uniform sampler2D blitTexture; 
            varying vec2 vUv;

            void main(){ 
                gl_FragColor = vec4(vUv.xy, 0, 1);
                
                #ifdef IS_SRGB
                gl_FragColor = LinearTosRGB( texture2D( blitTexture, vUv) );
                #else
                gl_FragColor = texture2D( blitTexture, vUv);
                #endif
            }`})),fullscreenQuadMaterial.uniforms.blitTexture.value=h,fullscreenQuadMaterial.defines.IS_SRGB=h.colorSpace==three_module.er$,fullscreenQuadMaterial.needsUpdate=!0,fullscreenQuad||(fullscreenQuad=new three_module.eaF(fullscreenQuadGeometry,fullscreenQuadMaterial),fullscreenQuad.frustrumCulled=!1);const d=new three_module.ubm,_=new three_module.Z58;_.add(fullscreenQuad),c||(c=_renderer=new three_module.JeP({antialias:!1})),c.setSize(Math.min(h.image.width,o),Math.min(h.image.height,o)),c.clear(),c.render(_,d);const b=new three_module.gPd(c.domElement);return b.minFilter=h.minFilter,b.magFilter=h.magFilter,b.wrapS=h.wrapS,b.wrapT=h.wrapT,b.name=h.name,_renderer&&(_renderer.dispose(),_renderer=null),b}const KHR_mesh_quantization_ExtraAttrTypes={POSITION:["byte","byte normalized","unsigned byte","unsigned byte normalized","short","short normalized","unsigned short","unsigned short normalized"],NORMAL:["byte normalized","short normalized"],TANGENT:["byte normalized","short normalized"],TEXCOORD:["byte","byte normalized","unsigned byte","short","short normalized","unsigned short"]};class GLTFExporter{constructor(){this.pluginCallbacks=[],this.register(function(o){return new GLTFLightExtension(o)}),this.register(function(o){return new GLTFExporter_GLTFMaterialsUnlitExtension(o)}),this.register(function(o){return new GLTFExporter_GLTFMaterialsTransmissionExtension(o)}),this.register(function(o){return new GLTFExporter_GLTFMaterialsVolumeExtension(o)}),this.register(function(o){return new GLTFExporter_GLTFMaterialsIorExtension(o)}),this.register(function(o){return new GLTFExporter_GLTFMaterialsSpecularExtension(o)}),this.register(function(o){return new GLTFExporter_GLTFMaterialsClearcoatExtension(o)}),this.register(function(o){return new GLTFExporter_GLTFMaterialsIridescenceExtension(o)}),this.register(function(o){return new GLTFExporter_GLTFMaterialsSheenExtension(o)}),this.register(function(o){return new GLTFExporter_GLTFMaterialsAnisotropyExtension(o)}),this.register(function(o){return new GLTFExporter_GLTFMaterialsEmissiveStrengthExtension(o)})}register(o){return this.pluginCallbacks.indexOf(o)===-1&&this.pluginCallbacks.push(o),this}unregister(o){return this.pluginCallbacks.indexOf(o)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(o),1),this}parse(o,c,d,_,b){const _e=b||new GLTFWriter,it=[];for(let nt=0,at=this.pluginCallbacks.length;nt<at;nt++)it.push(this.pluginCallbacks[nt](_e));_e.setPlugins(it),_e.write(o,c,_).catch(d)}parseAsync(o,c){const d=this;return new Promise(function(_,b){d.parse(o,_,b,c)})}}const GLTFExporter_WEBGL_CONSTANTS={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,ARRAY_BUFFER:34962,ELEMENT_ARRAY_BUFFER:34963,NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,REPEAT:10497},KHR_MESH_QUANTIZATION="KHR_mesh_quantization",THREE_TO_WEBGL={};THREE_TO_WEBGL[three_module.hxR]=GLTFExporter_WEBGL_CONSTANTS.NEAREST,THREE_TO_WEBGL[three_module.pHI]=GLTFExporter_WEBGL_CONSTANTS.NEAREST_MIPMAP_NEAREST,THREE_TO_WEBGL[three_module.Cfg]=GLTFExporter_WEBGL_CONSTANTS.NEAREST_MIPMAP_LINEAR,THREE_TO_WEBGL[three_module.k6q]=GLTFExporter_WEBGL_CONSTANTS.LINEAR,THREE_TO_WEBGL[three_module.kRr]=GLTFExporter_WEBGL_CONSTANTS.LINEAR_MIPMAP_NEAREST,THREE_TO_WEBGL[three_module.$_I]=GLTFExporter_WEBGL_CONSTANTS.LINEAR_MIPMAP_LINEAR,THREE_TO_WEBGL[three_module.ghU]=GLTFExporter_WEBGL_CONSTANTS.CLAMP_TO_EDGE,THREE_TO_WEBGL[three_module.GJx]=GLTFExporter_WEBGL_CONSTANTS.REPEAT,THREE_TO_WEBGL[three_module.kTW]=GLTFExporter_WEBGL_CONSTANTS.MIRRORED_REPEAT;const GLTFExporter_PATH_PROPERTIES={scale:"scale",position:"translation",quaternion:"rotation",morphTargetInfluences:"weights"},DEFAULT_SPECULAR_COLOR=new three_module.Q1f,GLB_HEADER_BYTES=12,GLB_HEADER_MAGIC=1179937895,GLB_VERSION=2,GLB_CHUNK_PREFIX_BYTES=8,GLB_CHUNK_TYPE_JSON=1313821514,GLB_CHUNK_TYPE_BIN=5130562;function equalArray(h,o){return h.length===o.length&&h.every(function(c,d){return c===o[d]})}function stringToArrayBuffer(h){return new TextEncoder().encode(h).buffer}function isIdentityMatrix(h){return equalArray(h.elements,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}function getMinMax(h,o,c){const d={min:new Array(h.itemSize).fill(Number.POSITIVE_INFINITY),max:new Array(h.itemSize).fill(Number.NEGATIVE_INFINITY)};for(let _=o;_<o+c;_++)for(let b=0;b<h.itemSize;b++){let _e;h.itemSize>4?_e=h.array[_*h.itemSize+b]:(b===0?_e=h.getX(_):b===1?_e=h.getY(_):b===2?_e=h.getZ(_):b===3&&(_e=h.getW(_)),h.normalized===!0&&(_e=three_module.cj9.normalize(_e,h.array))),d.min[b]=Math.min(d.min[b],_e),d.max[b]=Math.max(d.max[b],_e)}return d}function getPaddedBufferSize(h){return 4*Math.ceil(h/4)}function getPaddedArrayBuffer(h,o=0){const c=getPaddedBufferSize(h.byteLength);if(c!==h.byteLength){const d=new Uint8Array(c);if(d.set(new Uint8Array(h)),o!==0)for(let _=h.byteLength;_<c;_++)d[_]=o;return d.buffer}return h}function getCanvas(){return typeof document>"u"&&typeof OffscreenCanvas<"u"?new OffscreenCanvas(1,1):document.createElement("canvas")}function getToBlobPromise(h,o){if(h.toBlob!==void 0)return new Promise(d=>h.toBlob(d,o));let c;return o==="image/jpeg"?c=.92:o==="image/webp"&&(c=.8),h.convertToBlob({type:o,quality:c})}class GLTFWriter{constructor(){this.plugins=[],this.options={},this.pending=[],this.buffers=[],this.byteOffset=0,this.buffers=[],this.nodeMap=new Map,this.skins=[],this.extensionsUsed={},this.extensionsRequired={},this.uids=new Map,this.uid=0,this.json={asset:{version:"2.0",generator:"THREE.GLTFExporter"}},this.cache={meshes:new Map,attributes:new Map,attributesNormalized:new Map,materials:new Map,textures:new Map,images:new Map}}setPlugins(o){this.plugins=o}async write(o,c,d={}){this.options=Object.assign({binary:!1,trs:!1,onlyVisible:!0,maxTextureSize:1/0,animations:[],includeCustomExtensions:!1,ignoreInvalidMorphTargetTracks:!1,ignoreEmptyTextures:!1},d),this.options.animations.length>0&&(this.options.trs=!0),this.processInput(o),await Promise.all(this.pending);const _=this,b=_.buffers,_e=_.json;d=_.options;const it=_.extensionsUsed,nt=_.extensionsRequired,at=new Blob(b,{type:"application/octet-stream"}),ut=Object.keys(it),pt=Object.keys(nt);if(ut.length>0&&(_e.extensionsUsed=ut),pt.length>0&&(_e.extensionsRequired=pt),_e.buffers&&_e.buffers.length>0&&(_e.buffers[0].byteLength=at.size),d.binary===!0){const mt=new FileReader;mt.readAsArrayBuffer(at),mt.onloadend=function(){const ft=getPaddedArrayBuffer(mt.result),vt=new DataView(new ArrayBuffer(GLB_CHUNK_PREFIX_BYTES));vt.setUint32(0,ft.byteLength,!0),vt.setUint32(4,GLB_CHUNK_TYPE_BIN,!0);const xt=getPaddedArrayBuffer(stringToArrayBuffer(JSON.stringify(_e)),32),At=new DataView(new ArrayBuffer(GLB_CHUNK_PREFIX_BYTES));At.setUint32(0,xt.byteLength,!0),At.setUint32(4,GLB_CHUNK_TYPE_JSON,!0);const Ct=new ArrayBuffer(GLB_HEADER_BYTES),Et=new DataView(Ct);Et.setUint32(0,GLB_HEADER_MAGIC,!0),Et.setUint32(4,GLB_VERSION,!0);const Tt=GLB_HEADER_BYTES+At.byteLength+xt.byteLength+vt.byteLength+ft.byteLength;Et.setUint32(8,Tt,!0);const kt=new Blob([Ct,At,xt,vt,ft],{type:"application/octet-stream"}),Dt=new FileReader;Dt.readAsArrayBuffer(kt),Dt.onloadend=function(){c(Dt.result)}}}else if(_e.buffers&&_e.buffers.length>0){const mt=new FileReader;mt.readAsDataURL(at),mt.onloadend=function(){const ft=mt.result;_e.buffers[0].uri=ft,c(_e)}}else c(_e)}serializeUserData(o,c){if(Object.keys(o.userData).length===0)return;const d=this.options,_=this.extensionsUsed;try{const b=JSON.parse(JSON.stringify(o.userData));if(d.includeCustomExtensions&&b.gltfExtensions){c.extensions===void 0&&(c.extensions={});for(const _e in b.gltfExtensions)c.extensions[_e]=b.gltfExtensions[_e],_[_e]=!0;delete b.gltfExtensions}Object.keys(b).length>0&&(c.extras=b)}catch(b){console.warn("THREE.GLTFExporter: userData of '"+o.name+"' won't be serialized because of JSON.stringify error - "+b.message),console.warn({...o.userData})}}getUID(o,c=!1){if(this.uids.has(o)===!1){const d=new Map;d.set(!0,this.uid++),d.set(!1,this.uid++),this.uids.set(o,d)}return this.uids.get(o).get(c)}isNormalizedNormalAttribute(o){if(this.cache.attributesNormalized.has(o))return!1;const c=new three_module.Pq0;for(let d=0,_=o.count;d<_;d++)if(Math.abs(c.fromBufferAttribute(o,d).length()-1)>5e-4)return!1;return!0}createNormalizedNormalAttribute(o){const c=this.cache;if(c.attributesNormalized.has(o))return c.attributesNormalized.get(o);const d=o.clone(),_=new three_module.Pq0;for(let b=0,_e=d.count;b<_e;b++)_.fromBufferAttribute(d,b),_.x===0&&_.y===0&&_.z===0?_.setX(1):_.normalize(),d.setXYZ(b,_.x,_.y,_.z);return c.attributesNormalized.set(o,d),d}applyTextureTransform(o,c){let d=!1;const _={};c.offset.x===0&&c.offset.y===0||(_.offset=c.offset.toArray(),d=!0),c.rotation!==0&&(_.rotation=c.rotation,d=!0),c.repeat.x===1&&c.repeat.y===1||(_.scale=c.repeat.toArray(),d=!0),d&&(o.extensions=o.extensions||{},o.extensions.KHR_texture_transform=_,this.extensionsUsed.KHR_texture_transform=!0)}buildMetalRoughTexture(o,c){if(o===c)return o;function d(mt){return mt.colorSpace===three_module.er$?function(ft){return ft<.04045?.0773993808*ft:Math.pow(.9478672986*ft+.0521327014,2.4)}:function(ft){return ft}}console.warn("THREE.GLTFExporter: Merged metalnessMap and roughnessMap textures."),o instanceof three_module.FvD&&(o=TextureUtils_decompress(o)),c instanceof three_module.FvD&&(c=TextureUtils_decompress(c));const _=o?o.image:null,b=c?c.image:null,_e=Math.max(_?_.width:0,b?b.width:0),it=Math.max(_?_.height:0,b?b.height:0),nt=getCanvas();nt.width=_e,nt.height=it;const at=nt.getContext("2d");at.fillStyle="#00ffff",at.fillRect(0,0,_e,it);const ut=at.getImageData(0,0,_e,it);if(_){at.drawImage(_,0,0,_e,it);const mt=d(o),ft=at.getImageData(0,0,_e,it).data;for(let vt=2;vt<ft.length;vt+=4)ut.data[vt]=256*mt(ft[vt]/256)}if(b){at.drawImage(b,0,0,_e,it);const mt=d(c),ft=at.getImageData(0,0,_e,it).data;for(let vt=1;vt<ft.length;vt+=4)ut.data[vt]=256*mt(ft[vt]/256)}at.putImageData(ut,0,0);const pt=(o||c).clone();return pt.source=new three_module.kLi(nt),pt.colorSpace=three_module.jf0,pt.channel=(o||c).channel,o&&c&&o.channel!==c.channel&&console.warn("THREE.GLTFExporter: UV channels for metalnessMap and roughnessMap textures must match."),pt}processBuffer(o){const c=this.json,d=this.buffers;return c.buffers||(c.buffers=[{byteLength:0}]),d.push(o),0}processBufferView(o,c,d,_,b){const _e=this.json;let it;switch(_e.bufferViews||(_e.bufferViews=[]),c){case GLTFExporter_WEBGL_CONSTANTS.BYTE:case GLTFExporter_WEBGL_CONSTANTS.UNSIGNED_BYTE:it=1;break;case GLTFExporter_WEBGL_CONSTANTS.SHORT:case GLTFExporter_WEBGL_CONSTANTS.UNSIGNED_SHORT:it=2;break;default:it=4}const nt=getPaddedBufferSize(_*o.itemSize*it),at=new DataView(new ArrayBuffer(nt));let ut=0;for(let mt=d;mt<d+_;mt++)for(let ft=0;ft<o.itemSize;ft++){let vt;o.itemSize>4?vt=o.array[mt*o.itemSize+ft]:(ft===0?vt=o.getX(mt):ft===1?vt=o.getY(mt):ft===2?vt=o.getZ(mt):ft===3&&(vt=o.getW(mt)),o.normalized===!0&&(vt=three_module.cj9.normalize(vt,o.array))),c===GLTFExporter_WEBGL_CONSTANTS.FLOAT?at.setFloat32(ut,vt,!0):c===GLTFExporter_WEBGL_CONSTANTS.INT?at.setInt32(ut,vt,!0):c===GLTFExporter_WEBGL_CONSTANTS.UNSIGNED_INT?at.setUint32(ut,vt,!0):c===GLTFExporter_WEBGL_CONSTANTS.SHORT?at.setInt16(ut,vt,!0):c===GLTFExporter_WEBGL_CONSTANTS.UNSIGNED_SHORT?at.setUint16(ut,vt,!0):c===GLTFExporter_WEBGL_CONSTANTS.BYTE?at.setInt8(ut,vt):c===GLTFExporter_WEBGL_CONSTANTS.UNSIGNED_BYTE&&at.setUint8(ut,vt),ut+=it}const pt={buffer:this.processBuffer(at.buffer),byteOffset:this.byteOffset,byteLength:nt};return b!==void 0&&(pt.target=b),b===GLTFExporter_WEBGL_CONSTANTS.ARRAY_BUFFER&&(pt.byteStride=o.itemSize*it),this.byteOffset+=nt,_e.bufferViews.push(pt),{id:_e.bufferViews.length-1,byteLength:0}}processBufferViewImage(o){const c=this,d=c.json;return d.bufferViews||(d.bufferViews=[]),new Promise(function(_){const b=new FileReader;b.readAsArrayBuffer(o),b.onloadend=function(){const _e=getPaddedArrayBuffer(b.result),it={buffer:c.processBuffer(_e),byteOffset:c.byteOffset,byteLength:_e.byteLength};c.byteOffset+=_e.byteLength,_(d.bufferViews.push(it)-1)}})}processBufferViewImageBuffer(o){const c=this,d=c.json;d.bufferViews||(d.bufferViews=[]),o=getPaddedArrayBuffer(o);const _={buffer:c.processBuffer(o),byteOffset:c.byteOffset,byteLength:o.byteLength};return c.byteOffset+=o.byteLength,d.bufferViews.push(_)-1}processAccessor(o,c,d,_){const b=this.json;let _e;if(o.array.constructor===Float32Array)_e=GLTFExporter_WEBGL_CONSTANTS.FLOAT;else if(o.array.constructor===Int32Array)_e=GLTFExporter_WEBGL_CONSTANTS.INT;else if(o.array.constructor===Uint32Array)_e=GLTFExporter_WEBGL_CONSTANTS.UNSIGNED_INT;else if(o.array.constructor===Int16Array)_e=GLTFExporter_WEBGL_CONSTANTS.SHORT;else if(o.array.constructor===Uint16Array)_e=GLTFExporter_WEBGL_CONSTANTS.UNSIGNED_SHORT;else if(o.array.constructor===Int8Array)_e=GLTFExporter_WEBGL_CONSTANTS.BYTE;else{if(o.array.constructor!==Uint8Array)throw new Error("THREE.GLTFExporter: Unsupported bufferAttribute component type: "+o.array.constructor.name);_e=GLTFExporter_WEBGL_CONSTANTS.UNSIGNED_BYTE}if(d===void 0&&(d=0),_===void 0&&(_=o.count),_===0)return null;const it=getMinMax(o,d,_);let nt;c!==void 0&&(nt=o===c.index?GLTFExporter_WEBGL_CONSTANTS.ELEMENT_ARRAY_BUFFER:GLTFExporter_WEBGL_CONSTANTS.ARRAY_BUFFER);const at=this.processBufferView(o,_e,d,_,nt),ut={bufferView:at.id,byteOffset:at.byteOffset,componentType:_e,count:_,max:it.max,min:it.min,type:{1:"SCALAR",2:"VEC2",3:"VEC3",4:"VEC4",9:"MAT3",16:"MAT4"}[o.itemSize]};return o.normalized===!0&&(ut.normalized=!0),b.accessors||(b.accessors=[]),b.accessors.push(ut)-1}processImage(o,c,d,_="image/png",b=void 0,_e=void 0){if(o!==null){const it=this,nt=it.cache,at=it.json,ut=it.options,pt=it.pending;nt.images.has(o)||nt.images.set(o,{});const mt=nt.images.get(o),ft=_+":flipY/"+d.toString()+(b||_e?";"+b+";"+_e:"");if(mt[ft]!==void 0)return mt[ft];at.images||(at.images=[]);const vt={mimeType:_},xt=getCanvas();xt.width=Math.min(b||o.width,ut.maxTextureSize),xt.height=Math.min(_e||o.height,ut.maxTextureSize);const At=xt.getContext("2d");if(d===!0&&(At.translate(0,xt.height),At.scale(1,-1)),o.data!==void 0){c!==three_module.GWd&&console.error("GLTFExporter: Only RGBAFormat is supported.",c),(o.width>ut.maxTextureSize||o.height>ut.maxTextureSize)&&console.warn("GLTFExporter: Image size is bigger than maxTextureSize",o);const Et=new Uint8ClampedArray(o.height*o.width*4);for(let Tt=0;Tt<Et.length;Tt+=4)Et[Tt+0]=o.data[Tt+0],Et[Tt+1]=o.data[Tt+1],Et[Tt+2]=o.data[Tt+2],Et[Tt+3]=o.data[Tt+3];At.putImageData(new ImageData(Et,o.width,o.height),0,0)}else At.drawImage(o,0,0,xt.width,xt.height);ut.binary===!0?pt.push(getToBlobPromise(xt,_).then(Et=>it.processBufferViewImage(Et)).then(Et=>{vt.bufferView=Et})):xt.toDataURL!==void 0?vt.uri=xt.toDataURL(_):pt.push(getToBlobPromise(xt,_).then(Et=>new FileReader().readAsDataURL(Et)).then(Et=>{vt.uri=Et}));const Ct=at.images.push(vt)-1;return mt[ft]=Ct,Ct}throw new Error("THREE.GLTFExporter: No valid image data found. Unable to process texture.")}processSampler(o){const c=this.json;c.samplers||(c.samplers=[]);const d={magFilter:THREE_TO_WEBGL[o.magFilter],minFilter:THREE_TO_WEBGL[o.minFilter],wrapS:THREE_TO_WEBGL[o.wrapS],wrapT:THREE_TO_WEBGL[o.wrapT]};return c.samplers.push(d)-1}processTexture(o){const c=this.options,d=this.cache,_=this.json;if(d.textures.has(o))return d.textures.get(o);_.textures||(_.textures=[]),o instanceof three_module.FvD&&!o.source._canSerialize&&(o=TextureUtils_decompress(o,c.maxTextureSize));let b=o.userData.mimeType;b==="image/webp"&&(b="image/png"),b==="image/jpg"&&(b="image/jpeg");const _e={sampler:this.processSampler(o),source:!b||["image/jpeg","image/png"].includes(b)?this.processImage(o.image,o.format,o.flipY,b):null};o.name&&(_e.name=o.name),this._invokeAll(function(nt){nt.writeTexture&&nt.writeTexture(o,_e)}),_e.source===null&&console.error("GLTFExporter: Unsupported mime type: "+b+". Cannot export texture.",o);const it=_.textures.push(_e)-1;return d.textures.set(o,it),it}processMaterial(o){const c=this.cache,d=this.json;if(c.materials.has(o))return c.materials.get(o);if(o.isShaderMaterial)return console.warn("GLTFExporter: THREE.ShaderMaterial not supported."),null;d.materials||(d.materials=[]);const _={pbrMetallicRoughness:{}};o.isMeshStandardMaterial!==!0&&o.isMeshBasicMaterial!==!0&&console.warn("GLTFExporter: Use MeshStandardMaterial or MeshBasicMaterial for best results.");const b=o.color.toArray().concat([o.opacity]);if(equalArray(b,[1,1,1,1])||(_.pbrMetallicRoughness.baseColorFactor=b),o.isMeshStandardMaterial?(_.pbrMetallicRoughness.metallicFactor=o.metalness,_.pbrMetallicRoughness.roughnessFactor=o.roughness):(_.pbrMetallicRoughness.metallicFactor=.5,_.pbrMetallicRoughness.roughnessFactor=.5),this.checkEmptyMap(o.metalnessMap)||this.checkEmptyMap(o.roughnessMap)){const it=this.buildMetalRoughTexture(o.metalnessMap,o.roughnessMap),nt={index:this.processTexture(it),channel:it.channel};this.applyTextureTransform(nt,it),_.pbrMetallicRoughness.metallicRoughnessTexture=nt}if(this.checkEmptyMap(o.map)){const it={index:this.processTexture(o.map),texCoord:o.map.channel};this.applyTextureTransform(it,o.map),_.pbrMetallicRoughness.baseColorTexture=it}if(o.emissive){const it=o.emissive;if(Math.max(it.r,it.g,it.b)>0&&(_.emissiveFactor=o.emissive.toArray()),this.checkEmptyMap(o.emissiveMap)){const nt={index:this.processTexture(o.emissiveMap),texCoord:o.emissiveMap.channel};this.applyTextureTransform(nt,o.emissiveMap),_.emissiveTexture=nt}}if(this.checkEmptyMap(o.normalMap)){const it={index:this.processTexture(o.normalMap),texCoord:o.normalMap.channel};o.normalScale&&o.normalScale.x!==1&&(it.scale=o.normalScale.x),this.applyTextureTransform(it,o.normalMap),_.normalTexture=it}if(this.checkEmptyMap(o.aoMap)){const it={index:this.processTexture(o.aoMap),texCoord:o.aoMap.channel};o.aoMapIntensity!==1&&(it.strength=o.aoMapIntensity),this.applyTextureTransform(it,o.aoMap),_.occlusionTexture=it}o.transparent?_.alphaMode="BLEND":o.alphaTest>0&&(_.alphaMode="MASK",_.alphaCutoff=o.alphaTest),o.side===three_module.$EB&&(_.doubleSided=!0),o.name!==""&&(_.name=o.name),this.serializeUserData(o,_),this._invokeAll(function(it){it.writeMaterial&&it.writeMaterial(o,_)});const _e=d.materials.push(_)-1;return c.materials.set(o,_e),_e}processMesh(o){const c=this.cache,d=this.json,_=[o.geometry.uuid];if(Array.isArray(o.material))for(let Tt=0,kt=o.material.length;Tt<kt;Tt++)_.push(o.material[Tt].uuid);else _.push(o.material.uuid);const b=_.join(":");if(c.meshes.has(b))return c.meshes.get(b);const _e=o.geometry;let it;it=o.isLineSegments?GLTFExporter_WEBGL_CONSTANTS.LINES:o.isLineLoop?GLTFExporter_WEBGL_CONSTANTS.LINE_LOOP:o.isLine?GLTFExporter_WEBGL_CONSTANTS.LINE_STRIP:o.isPoints?GLTFExporter_WEBGL_CONSTANTS.POINTS:o.material.wireframe?GLTFExporter_WEBGL_CONSTANTS.LINES:GLTFExporter_WEBGL_CONSTANTS.TRIANGLES;const nt={},at={},ut=[],pt=[],mt={uv:"TEXCOORD_0",uv1:"TEXCOORD_1",color:"COLOR_0",skinWeight:"WEIGHTS_0",skinIndex:"JOINTS_0"},ft=_e.getAttribute("normal");ft===void 0||this.isNormalizedNormalAttribute(ft)||(console.warn("THREE.GLTFExporter: Creating normalized normal attribute from the non-normalized one."),_e.setAttribute("normal",this.createNormalizedNormalAttribute(ft)));let vt=null;for(let Tt in _e.attributes){if(Tt.slice(0,5)==="morph")continue;const kt=_e.attributes[Tt];if(Tt=mt[Tt]||Tt.toUpperCase(),/^(POSITION|NORMAL|TANGENT|TEXCOORD_\d+|COLOR_\d+|JOINTS_\d+|WEIGHTS_\d+)$/.test(Tt)||(Tt="_"+Tt),c.attributes.has(this.getUID(kt))){at[Tt]=c.attributes.get(this.getUID(kt));continue}vt=null;const Dt=kt.array;Tt!=="JOINTS_0"||Dt instanceof Uint16Array||Dt instanceof Uint8Array||(console.warn('GLTFExporter: Attribute "skinIndex" converted to type UNSIGNED_SHORT.'),vt=new three_module.THS(new Uint16Array(Dt),kt.itemSize,kt.normalized));const zt=this.processAccessor(vt||kt,_e);zt!==null&&(Tt.startsWith("_")||this.detectMeshQuantization(Tt,kt),at[Tt]=zt,c.attributes.set(this.getUID(kt),zt))}if(ft!==void 0&&_e.setAttribute("normal",ft),Object.keys(at).length===0)return null;if(o.morphTargetInfluences!==void 0&&o.morphTargetInfluences.length>0){const Tt=[],kt=[],Dt={};if(o.morphTargetDictionary!==void 0)for(const zt in o.morphTargetDictionary)Dt[o.morphTargetDictionary[zt]]=zt;for(let zt=0;zt<o.morphTargetInfluences.length;++zt){const Bt={};let Rt=!1;for(const Ut in _e.morphAttributes){if(Ut!=="position"&&Ut!=="normal"){Rt||(console.warn("GLTFExporter: Only POSITION and NORMAL morph are supported."),Rt=!0);continue}const Ht=_e.morphAttributes[Ut][zt],Jt=Ut.toUpperCase(),Kt=_e.attributes[Ut];if(c.attributes.has(this.getUID(Ht,!0))){Bt[Jt]=c.attributes.get(this.getUID(Ht,!0));continue}const sr=Ht.clone();if(!_e.morphTargetsRelative)for(let ir=0,cr=Ht.count;ir<cr;ir++)for(let lr=0;lr<Ht.itemSize;lr++)lr===0&&sr.setX(ir,Ht.getX(ir)-Kt.getX(ir)),lr===1&&sr.setY(ir,Ht.getY(ir)-Kt.getY(ir)),lr===2&&sr.setZ(ir,Ht.getZ(ir)-Kt.getZ(ir)),lr===3&&sr.setW(ir,Ht.getW(ir)-Kt.getW(ir));Bt[Jt]=this.processAccessor(sr,_e),c.attributes.set(this.getUID(Kt,!0),Bt[Jt])}pt.push(Bt),Tt.push(o.morphTargetInfluences[zt]),o.morphTargetDictionary!==void 0&&kt.push(Dt[zt])}nt.weights=Tt,kt.length>0&&(nt.extras={},nt.extras.targetNames=kt)}const xt=Array.isArray(o.material);if(xt&&_e.groups.length===0)return null;const At=xt?o.material:[o.material],Ct=xt?_e.groups:[{materialIndex:0,start:void 0,count:void 0}];for(let Tt=0,kt=Ct.length;Tt<kt;Tt++){const Dt={mode:it,attributes:at};if(this.serializeUserData(_e,Dt),pt.length>0&&(Dt.targets=pt),_e.index!==null){let Bt=this.getUID(_e.index);Ct[Tt].start===void 0&&Ct[Tt].count===void 0||(Bt+=":"+Ct[Tt].start+":"+Ct[Tt].count),c.attributes.has(Bt)?Dt.indices=c.attributes.get(Bt):(Dt.indices=this.processAccessor(_e.index,_e,Ct[Tt].start,Ct[Tt].count),c.attributes.set(Bt,Dt.indices)),Dt.indices===null&&delete Dt.indices}const zt=this.processMaterial(At[Ct[Tt].materialIndex]);zt!==null&&(Dt.material=zt),ut.push(Dt)}nt.primitives=ut,d.meshes||(d.meshes=[]),this._invokeAll(function(Tt){Tt.writeMesh&&Tt.writeMesh(o,nt)});const Et=d.meshes.push(nt)-1;return c.meshes.set(b,Et),Et}detectMeshQuantization(o,c){if(this.extensionsUsed[KHR_MESH_QUANTIZATION])return;let d;switch(c.array.constructor){case Int8Array:d="byte";break;case Uint8Array:d="unsigned byte";break;case Int16Array:d="short";break;case Uint16Array:d="unsigned short";break;default:return}c.normalized&&(d+=" normalized");const _=o.split("_",1)[0];KHR_mesh_quantization_ExtraAttrTypes[_]&&KHR_mesh_quantization_ExtraAttrTypes[_].includes(d)&&(this.extensionsUsed[KHR_MESH_QUANTIZATION]=!0,this.extensionsRequired[KHR_MESH_QUANTIZATION]=!0)}processCamera(o){const c=this.json;c.cameras||(c.cameras=[]);const d=o.isOrthographicCamera,_={type:d?"orthographic":"perspective"};return d?_.orthographic={xmag:2*o.right,ymag:2*o.top,zfar:o.far<=0?.001:o.far,znear:o.near<0?0:o.near}:_.perspective={aspectRatio:o.aspect,yfov:three_module.cj9.degToRad(o.fov),zfar:o.far<=0?.001:o.far,znear:o.near<0?0:o.near},o.name!==""&&(_.name=o.type),c.cameras.push(_)-1}processAnimation(o,c){const d=this.json,_=this.nodeMap;d.animations||(d.animations=[]);try{o=GLTFExporter.Utils.mergeMorphTargetTracks(o.clone(),c)}catch(nt){if(console.warn('THREE.GLTFExporter: Could not export animation clip "%s".',o.name),!this.options.ignoreInvalidMorphTargetTracks)throw nt;return console.error(nt),null}const b=o.tracks,_e=[],it=[];for(let nt=0;nt<b.length;++nt){const at=b[nt],ut=three_module.Nwf.parseTrackName(at.name);let pt=three_module.Nwf.findNode(c,ut.nodeName);const mt=GLTFExporter_PATH_PROPERTIES[ut.propertyName];if(ut.objectName==="bones"&&(pt=pt.isSkinnedMesh===!0?pt.skeleton.getBoneByName(ut.objectIndex):void 0),!pt||!mt)return console.warn('THREE.GLTFExporter: Could not export animation track "%s".',at.name),null;const ft=1;let vt,xt=at.values.length/at.times.length;mt===GLTFExporter_PATH_PROPERTIES.morphTargetInfluences&&(xt/=pt.morphTargetInfluences.length),at.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline===!0?(vt="CUBICSPLINE",xt/=3):vt=at.getInterpolation()===three_module.ljd?"STEP":"LINEAR",it.push({input:this.processAccessor(new three_module.THS(at.times,ft)),output:this.processAccessor(new three_module.THS(at.values,xt)),interpolation:vt}),_e.push({sampler:it.length-1,target:{node:_.get(pt),path:mt}})}return d.animations.push({name:o.name||"clip_"+d.animations.length,samplers:it,channels:_e}),d.animations.length-1}processSkin(o){const c=this.json,d=this.nodeMap,_=c.nodes[d.get(o)],b=o.skeleton;if(b===void 0)return null;const _e=o.skeleton.bones[0];if(_e===void 0)return null;const it=[],nt=new Float32Array(16*b.bones.length),at=new three_module.kn4;for(let ut=0;ut<b.bones.length;++ut)it.push(d.get(b.bones[ut])),at.copy(b.boneInverses[ut]),at.multiply(o.bindMatrix).toArray(nt,16*ut);return c.skins===void 0&&(c.skins=[]),c.skins.push({inverseBindMatrices:this.processAccessor(new three_module.THS(nt,16)),joints:it,skeleton:d.get(_e)}),_.skin=c.skins.length-1}processNode(o){const c=this.json,d=this.options,_=this.nodeMap;c.nodes||(c.nodes=[]);const b={};if(d.trs){const it=o.quaternion.toArray(),nt=o.position.toArray(),at=o.scale.toArray();equalArray(it,[0,0,0,1])||(b.rotation=it),equalArray(nt,[0,0,0])||(b.translation=nt),equalArray(at,[1,1,1])||(b.scale=at)}else o.matrixAutoUpdate&&o.updateMatrix(),isIdentityMatrix(o.matrix)===!1&&(b.matrix=o.matrix.elements);if(o.name!==""&&(b.name=String(o.name)),this.serializeUserData(o,b),o.isMesh||o.isLine||o.isPoints){const it=this.processMesh(o);it!==null&&(b.mesh=it)}else o.isCamera&&(b.camera=this.processCamera(o));if(o.isSkinnedMesh&&this.skins.push(o),o.children.length>0){const it=[];for(let nt=0,at=o.children.length;nt<at;nt++){const ut=o.children[nt];if(ut.visible||d.onlyVisible===!1){const pt=this.processNode(ut);pt!==null&&it.push(pt)}}it.length>0&&(b.children=it)}this._invokeAll(function(it){it.writeNode&&it.writeNode(o,b)});const _e=c.nodes.push(b)-1;return _.set(o,_e),_e}processScene(o){const c=this.json,d=this.options;c.scenes||(c.scenes=[],c.scene=0);const _={};o.name!==""&&(_.name=o.name),c.scenes.push(_);const b=[];for(let _e=0,it=o.children.length;_e<it;_e++){const nt=o.children[_e];if(nt.visible||d.onlyVisible===!1){const at=this.processNode(nt);at!==null&&b.push(at)}}b.length>0&&(_.nodes=b),this.serializeUserData(o,_)}processObjects(o){const c=new three_module.Z58;c.name="AuxScene";for(let d=0;d<o.length;d++)c.children.push(o[d]);this.processScene(c)}processInput(o){const c=this.options;o=o instanceof Array?o:[o],this._invokeAll(function(_){_.beforeParse&&_.beforeParse(o)});const d=[];for(let _=0;_<o.length;_++)o[_]instanceof three_module.Z58?this.processScene(o[_]):d.push(o[_]);d.length>0&&this.processObjects(d);for(let _=0;_<this.skins.length;++_)this.processSkin(this.skins[_]);for(let _=0;_<c.animations.length;++_)this.processAnimation(c.animations[_],o[0]);this._invokeAll(function(_){_.afterParse&&_.afterParse(o)})}_invokeAll(o){for(let c=0,d=this.plugins.length;c<d;c++)o(this.plugins[c])}checkEmptyMap(o){return!(!o||this.options.ignoreEmptyTextures&&!o.image)}}class GLTFLightExtension{constructor(o){this.writer=o,this.name="KHR_lights_punctual"}writeNode(o,c){if(!o.isLight)return;if(!o.isDirectionalLight&&!o.isPointLight&&!o.isSpotLight)return void console.warn("THREE.GLTFExporter: Only directional, point, and spot lights are supported.",o);const d=this.writer,_=d.json,b=d.extensionsUsed,_e={};o.name&&(_e.name=o.name),_e.color=o.color.toArray(),_e.intensity=o.intensity,o.isDirectionalLight?_e.type="directional":o.isPointLight?(_e.type="point",o.distance>0&&(_e.range=o.distance)):o.isSpotLight&&(_e.type="spot",o.distance>0&&(_e.range=o.distance),_e.spot={},_e.spot.innerConeAngle=(1-o.penumbra)*o.angle,_e.spot.outerConeAngle=o.angle),o.decay!==void 0&&o.decay!==2&&console.warn("THREE.GLTFExporter: Light decay may be lost. glTF is physically-based, and expects light.decay=2."),!o.target||o.target.parent===o&&o.target.position.x===0&&o.target.position.y===0&&o.target.position.z===-1||console.warn("THREE.GLTFExporter: Light direction may be lost. For best results, make light.target a child of the light with position 0,0,-1."),b[this.name]||(_.extensions=_.extensions||{},_.extensions[this.name]={lights:[]},b[this.name]=!0);const it=_.extensions[this.name].lights;it.push(_e),c.extensions=c.extensions||{},c.extensions[this.name]={light:it.length-1}}}class GLTFExporter_GLTFMaterialsUnlitExtension{constructor(o){this.writer=o,this.name="KHR_materials_unlit"}writeMaterial(o,c){if(!o.isMeshBasicMaterial)return;const d=this.writer.extensionsUsed;c.extensions=c.extensions||{},c.extensions[this.name]={},d[this.name]=!0,c.pbrMetallicRoughness.metallicFactor=0,c.pbrMetallicRoughness.roughnessFactor=.9}}class GLTFExporter_GLTFMaterialsClearcoatExtension{constructor(o){this.writer=o,this.name="KHR_materials_clearcoat"}writeMaterial(o,c){if(!o.isMeshPhysicalMaterial||o.clearcoat===0)return;const d=this.writer,_=d.extensionsUsed,b={};if(b.clearcoatFactor=o.clearcoat,d.checkEmptyMap(o.clearcoatMap)){const _e={index:d.processTexture(o.clearcoatMap),texCoord:o.clearcoatMap.channel};d.applyTextureTransform(_e,o.clearcoatMap),b.clearcoatTexture=_e}if(b.clearcoatRoughnessFactor=o.clearcoatRoughness,d.checkEmptyMap(o.clearcoatRoughnessMap)){const _e={index:d.processTexture(o.clearcoatRoughnessMap),texCoord:o.clearcoatRoughnessMap.channel};d.applyTextureTransform(_e,o.clearcoatRoughnessMap),b.clearcoatRoughnessTexture=_e}if(d.checkEmptyMap(o.clearcoatNormalMap)){const _e={index:d.processTexture(o.clearcoatNormalMap),texCoord:o.clearcoatNormalMap.channel};d.applyTextureTransform(_e,o.clearcoatNormalMap),b.clearcoatNormalTexture=_e}c.extensions=c.extensions||{},c.extensions[this.name]=b,_[this.name]=!0}}class GLTFExporter_GLTFMaterialsIridescenceExtension{constructor(o){this.writer=o,this.name="KHR_materials_iridescence"}writeMaterial(o,c){if(!o.isMeshPhysicalMaterial||o.iridescence===0)return;const d=this.writer,_=d.extensionsUsed,b={};if(b.iridescenceFactor=o.iridescence,d.checkEmptyMap(o.iridescenceMap)){const _e={index:d.processTexture(o.iridescenceMap),texCoord:o.iridescenceMap.channel};d.applyTextureTransform(_e,o.iridescenceMap),b.iridescenceTexture=_e}if(b.iridescenceIor=o.iridescenceIOR,b.iridescenceThicknessMinimum=o.iridescenceThicknessRange[0],b.iridescenceThicknessMaximum=o.iridescenceThicknessRange[1],d.checkEmptyMap(o.iridescenceThicknessMap)){const _e={index:d.processTexture(o.iridescenceThicknessMap),texCoord:o.iridescenceThicknessMap.channel};d.applyTextureTransform(_e,o.iridescenceThicknessMap),b.iridescenceThicknessTexture=_e}c.extensions=c.extensions||{},c.extensions[this.name]=b,_[this.name]=!0}}class GLTFExporter_GLTFMaterialsTransmissionExtension{constructor(o){this.writer=o,this.name="KHR_materials_transmission"}writeMaterial(o,c){if(!o.isMeshPhysicalMaterial||o.transmission===0)return;const d=this.writer,_=d.extensionsUsed,b={};if(b.transmissionFactor=o.transmission,d.checkEmptyMap(o.transmissionMap)){const _e={index:d.processTexture(o.transmissionMap),texCoord:o.transmissionMap.channel};d.applyTextureTransform(_e,o.transmissionMap),b.transmissionTexture=_e}c.extensions=c.extensions||{},c.extensions[this.name]=b,_[this.name]=!0}}class GLTFExporter_GLTFMaterialsVolumeExtension{constructor(o){this.writer=o,this.name="KHR_materials_volume"}writeMaterial(o,c){if(!o.isMeshPhysicalMaterial||o.transmission===0)return;const d=this.writer,_=d.extensionsUsed,b={};if(b.thicknessFactor=o.thickness,d.checkEmptyMap(o.thicknessMap)){const _e={index:d.processTexture(o.thicknessMap),texCoord:o.thicknessMap.channel};d.applyTextureTransform(_e,o.thicknessMap),b.thicknessTexture=_e}b.attenuationDistance=o.attenuationDistance,b.attenuationColor=o.attenuationColor.toArray(),c.extensions=c.extensions||{},c.extensions[this.name]=b,_[this.name]=!0}}class GLTFExporter_GLTFMaterialsIorExtension{constructor(o){this.writer=o,this.name="KHR_materials_ior"}writeMaterial(o,c){if(!o.isMeshPhysicalMaterial||o.ior===1.5)return;const d=this.writer.extensionsUsed,_={};_.ior=o.ior,c.extensions=c.extensions||{},c.extensions[this.name]=_,d[this.name]=!0}}class GLTFExporter_GLTFMaterialsSpecularExtension{constructor(o){this.writer=o,this.name="KHR_materials_specular"}writeMaterial(o,c){if(!o.isMeshPhysicalMaterial||o.specularIntensity===1&&o.specularColor.equals(DEFAULT_SPECULAR_COLOR)&&!o.specularIntensityMap&&!o.specularColorTexture)return;const d=this.writer,_=d.extensionsUsed,b={};if(d.checkEmptyMap(o.specularIntensityMap)){const _e={index:d.processTexture(o.specularIntensityMap),texCoord:o.specularIntensityMap.channel};d.applyTextureTransform(_e,o.specularIntensityMap),b.specularTexture=_e}if(d.checkEmptyMap(o.specularColorMap)){const _e={index:d.processTexture(o.specularColorMap),texCoord:o.specularColorMap.channel};d.applyTextureTransform(_e,o.specularColorMap),b.specularColorTexture=_e}b.specularFactor=o.specularIntensity,b.specularColorFactor=o.specularColor.toArray(),c.extensions=c.extensions||{},c.extensions[this.name]=b,_[this.name]=!0}}class GLTFExporter_GLTFMaterialsSheenExtension{constructor(o){this.writer=o,this.name="KHR_materials_sheen"}writeMaterial(o,c){if(!o.isMeshPhysicalMaterial||o.sheen<.001)return;const d=this.writer,_=d.extensionsUsed,b={};if(d.checkEmptyMap(o.sheenRoughnessMap)){const _e={index:d.processTexture(o.sheenRoughnessMap),texCoord:o.sheenRoughnessMap.channel};d.applyTextureTransform(_e,o.sheenRoughnessMap),b.sheenRoughnessTexture=_e}if(d.checkEmptyMap(o.sheenColorMap)){const _e={index:d.processTexture(o.sheenColorMap),texCoord:o.sheenColorMap.channel};d.applyTextureTransform(_e,o.sheenColorMap),b.sheenColorTexture=_e}b.sheenRoughnessFactor=o.sheenRoughness,b.sheenColorFactor=o.sheenColor.toArray(),c.extensions=c.extensions||{},c.extensions[this.name]=b,c.extras=c.extras||{},c.extras.sheenFactor=o.sheen,_[this.name]=!0}}class GLTFExporter_GLTFMaterialsAnisotropyExtension{constructor(o){this.writer=o,this.name="KHR_materials_anisotropy"}writeMaterial(o,c){if(!o.isMeshPhysicalMaterial||o.anisotropy==0)return;const d=this.writer,_=d.extensionsUsed,b={};if(d.checkEmptyMap(o.anisotropyMap)){const _e={index:d.processTexture(o.anisotropyMap)};d.applyTextureTransform(_e,o.anisotropyMap),b.anisotropyTexture=_e}b.anisotropyStrength=o.anisotropy,b.anisotropyRotation=o.anisotropyRotation,c.extensions=c.extensions||{},c.extensions[this.name]=b,_[this.name]=!0}}class GLTFExporter_GLTFMaterialsEmissiveStrengthExtension{constructor(o){this.writer=o,this.name="KHR_materials_emissive_strength"}writeMaterial(o,c){if(!o.isMeshStandardMaterial||o.emissiveIntensity===1)return;const d=this.writer.extensionsUsed,_={};_.emissiveStrength=o.emissiveIntensity,c.extensions=c.extensions||{},c.extensions[this.name]=_,d[this.name]=!0}}GLTFExporter.Utils={GLTFWriter,insertKeyframe:function(h,o){const c=h.getValueSize(),d=new h.TimeBufferType(h.times.length+1),_=new h.ValueBufferType(h.values.length+c),b=h.createInterpolant(new h.ValueBufferType(c));let _e;if(h.times.length===0){d[0]=o;for(let it=0;it<c;it++)_[it]=0;_e=0}else if(o<h.times[0]){if(Math.abs(h.times[0]-o)<.001)return 0;d[0]=o,d.set(h.times,1),_.set(b.evaluate(o),0),_.set(h.values,c),_e=0}else if(o>h.times[h.times.length-1]){if(Math.abs(h.times[h.times.length-1]-o)<.001)return h.times.length-1;d[d.length-1]=o,d.set(h.times,0),_.set(h.values,0),_.set(b.evaluate(o),h.values.length),_e=d.length-1}else for(let it=0;it<h.times.length;it++){if(Math.abs(h.times[it]-o)<.001)return it;if(h.times[it]<o&&h.times[it+1]>o){d.set(h.times.slice(0,it+1),0),d[it+1]=o,d.set(h.times.slice(it+1),it+2),_.set(h.values.slice(0,(it+1)*c),0),_.set(b.evaluate(o),(it+1)*c),_.set(h.values.slice((it+1)*c),(it+2)*c),_e=it+1;break}}return h.times=d,h.values=_,_e},mergeMorphTargetTracks:function(h,o){const c=[],d={},_=h.tracks;for(let b=0;b<_.length;++b){let _e=_[b];const it=three_module.Nwf.parseTrackName(_e.name),nt=three_module.Nwf.findNode(o,it.nodeName);if(it.propertyName!=="morphTargetInfluences"||it.propertyIndex===void 0){c.push(_e);continue}if(_e.createInterpolant!==_e.InterpolantFactoryMethodDiscrete&&_e.createInterpolant!==_e.InterpolantFactoryMethodLinear){if(_e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline)throw new Error("THREE.GLTFExporter: Cannot merge tracks with glTF CUBICSPLINE interpolation.");console.warn("THREE.GLTFExporter: Morph target interpolation mode not yet supported. Using LINEAR instead."),_e=_e.clone(),_e.setInterpolation(three_module.PJ3)}const at=nt.morphTargetInfluences.length,ut=nt.morphTargetDictionary[it.propertyIndex];if(ut===void 0)throw new Error("THREE.GLTFExporter: Morph target name not found: "+it.propertyIndex);let pt;if(d[nt.uuid]===void 0){pt=_e.clone();const ft=new pt.ValueBufferType(at*pt.times.length);for(let vt=0;vt<pt.times.length;vt++)ft[vt*at+ut]=pt.values[vt];pt.name=(it.nodeName||"")+".morphTargetInfluences",pt.values=ft,d[nt.uuid]=pt,c.push(pt);continue}const mt=_e.createInterpolant(new _e.ValueBufferType(1));pt=d[nt.uuid];for(let ft=0;ft<pt.times.length;ft++)pt.values[ft*at+ut]=mt.evaluate(pt.times[ft]);for(let ft=0;ft<_e.times.length;ft++){const vt=this.insertKeyframe(pt,_e.times[ft]);pt.values[vt*at+ut]=_e.values[ft]}}return h.tracks=c,h}};class GLTFWriter2 extends GLTFExporter.Utils.GLTFWriter{constructor(){super(...arguments),this._defaultMaterial=new three_module._4j}serializeUserData(o,c){const d=o.userData,_={};d.__disposed&&console.error("Serializing a disposed object",o),Object.entries(d).forEach(([_e,it])=>{(!it||typeof it=="function"||it.isObject3D||it.isTexture||it.isMaterial||it.assetType!=null||_e.startsWith("_")||_e!=="uuid"&&(iGeometryIgnoredUserData.includes(_e)||iModelIgnoredUserData.includes(_e)||iMaterialIgnoredUserData.includes(_e)))&&(_[_e]=it,delete d[_e])});const b=serializeObject(d,!1);Object.entries(_).forEach(([_e,it])=>{d[_e]=it,delete _[_e]}),o.userData=b,super.serializeUserData(o,c),o.userData=d}processObjects(o){var c;o.length===1&&!((c=o[0])===null||c===void 0)&&c.userData.rootSceneModelRoot?this.processScene(o[0]):super.processObjects(o)}processMaterial(o){if(this.cache.materials.has(o))return this.cache.materials.get(o);let c=o;c&&!c.isShaderMaterial||(c=this._defaultMaterial);const d=super.processMaterial(c);if(d===null)return console.error("GLTFWriter2: Unexpected error: Failed to process material",o),null;if(!o||c===o)return d;const _=JSON.stringify(this.json.materials[d]),b=JSON.parse(_);this.serializeUserData(o,b),this._invokeAll(it=>{it.writeMaterial&&it.writeMaterial(o,b)});const _e=this.json.materials.push(b)-1;return this.cache.materials.set(o,_e),_e}processImageBlob(o,c){if(!o)return-1;const d=this.cache,_=this.options,b=this.pending,_e=this.json,it=c.image;d.images.has(it)||d.images.set(it,{});const nt=d.images.get(it),at=o.type+":flipY/"+c.flipY.toString();if(nt[at]!==void 0)return nt[at];_e.images||(_e.images=[]);const ut={mimeType:o.type};_.binary===!0?b.push(new Promise(mt=>{this.processBufferViewImage(o).then(ft=>{ut.bufferView=ft,mt()})})):b.push(q$2(o).then(mt=>{ut.uri=mt}));const pt=_e.images.push(ut)-1;return nt[at]=pt,pt}processSampler(o){return super.processSampler(o)}processTexture(o){const c=this.cache,d=this.json;if(c.textures.has(o))return c.textures.get(o);const _=o.source.data,b=o.userData.mimeType;o.userData.rootPath&&!this.options.embedUrlImages&&(o.userData.rootPath.startsWith("http")||o.userData.rootPath.startsWith("data:"))&&(o.source.data&&(!this.options.exporterOptions.embedUrlImagePreviews||o.isDataTexture?o.source.data=null:o.source.data._savePreview=!0),delete o.userData.mimeType);const _e=super.processTexture(o),it=d.textures[_e];if(!it)return console.error("No texture def",_e,o),_e;const nt=d.images?d.images[it.source]:null;if(nt&&(nt.extras||(nt.extras={}),o.source&&(nt.extras.uuid=o.source.uuid),nt.extras.t_uuid=o.uuid),o.userData.rootPath&&!this.options.embedUrlImages&&(o.userData.rootPath.startsWith("http")||o.userData.rootPath.startsWith("data:"))){if(o.source.data?delete o.source.data._savePreview:o.source.data=_,o.userData.mimeType=b,!it)return console.error("textureDef is null",_e,o),_e;if(it.source>=0){const at=this.json.images[it.source];at.uri?console.warn("GLTFWriter2: uri already set",at.uri):(at.uri=o.userData.rootPath,at.mimeType=b,at.extras||(at.extras={}),at.extras.flipY=o.flipY,at.extras.uri=o.userData.rootPath)}else it.source=this.processImageUri(o.image,o.userData.rootPath,o.flipY,b)}return it.source<0&&(console.error("textureDef.source cannot be saved",it,o),delete it.source),_e}processImage(o,c,d,_="image/png"){return o?super.processImage(o,c,d,_,o._savePreview?32:void 0,o._savePreview?32:void 0):-1}processImageUri(o,c,d,_="image/png"){const b=this.cache,_e=this.json;b.images.has(o)||b.images.set(o,{});const it=b.images.get(o),nt=_+":flipY/"+d.toString();if(it[nt]!==void 0)return it[nt];_e.images||(_e.images=[]);const at={mimeType:_,uri:c,extras:{flipY:d}},ut=_e.images.push(at)-1;return it[nt]=ut,ut}}async function setInnerHTMLWithScripts(h,o){var c;h.innerHTML=o;const d=h.getElementsByTagName("script");for(let _=0;_<d.length;_++){const b=d[_],_e=cloneScriptTag(b);let it=!1;await new Promise(nt=>{_e.onload=nt,_e.onerror=()=>{it=!0,nt(void 0)}}),it||(c=b.parentNode)===null||c===void 0||c.replaceChild(_e,b)}}function cloneScriptTag(h,o){(o=o??document.createElement("script")).type=h.type||"text/javascript",o.text=h.text;for(let c=0;c<h.attributes.length;c++){const d=h.attributes[c];o.setAttribute(d.name,d.value)}return o}function dom_getPaddedArrayBuffer(h,o=0){const c=dom_getPaddedBufferSize(h.byteLength);if(c!==h.byteLength){const d=new Uint8Array(c);if(d.set(new Uint8Array(h)),o!==0)for(let _=h.byteLength;_<c;_++)d[_]=o;return d.buffer}return h}function dom_getPaddedBufferSize(h){return 4*Math.ceil(h/4)}ArrayBuffer.prototype.slice||(ArrayBuffer.prototype.slice=function(h,o){const c=new Uint8Array(this);o==null&&(o=c.length);const d=new ArrayBuffer(o-(h||0)),_=new Uint8Array(d);for(let b=0;b<_.length;b++)_[b]=c[b+(h||0)];return d});const dom_GLB_HEADER_BYTES=12,dom_GLB_HEADER_MAGIC=1179937895,dom_GLB_VERSION=2,dom_GLB_CHUNK_PREFIX_BYTES=8,dom_GLB_CHUNK_TYPE_JSON=1313821514,dom_GLB_CHUNK_TYPE_BIN=5130562;function makeGLBFile(h,o){const c=dom_getPaddedArrayBuffer(h),d=new DataView(new ArrayBuffer(dom_GLB_CHUNK_PREFIX_BYTES));d.setUint32(0,c.byteLength,!0),d.setUint32(4,dom_GLB_CHUNK_TYPE_BIN,!0);const _=dom_getPaddedArrayBuffer(new TextEncoder().encode(JSON.stringify(o||{})).buffer,32),b=new DataView(new ArrayBuffer(dom_GLB_CHUNK_PREFIX_BYTES));b.setUint32(0,_.byteLength,!0),b.setUint32(4,dom_GLB_CHUNK_TYPE_JSON,!0);const _e=new ArrayBuffer(dom_GLB_HEADER_BYTES),it=new DataView(_e);it.setUint32(0,dom_GLB_HEADER_MAGIC,!0),it.setUint32(4,dom_GLB_VERSION,!0);const nt=dom_GLB_HEADER_BYTES+b.byteLength+_.byteLength+d.byteLength+c.byteLength;it.setUint32(8,nt,!0);const at=new Blob([_e,b,_,d,c],{type:"application/octet-stream"});return at.ext="glb",at}class GLTFExporter2 extends GLTFExporter{register(o){return super.register(o)}async parseAsync(o,c){var d;if(!o)throw new Error("No object to export");const _=o.__isGLTFOutput||!Array.isArray(o)&&!o.isObject3D?o:await new Promise((b,_e)=>this.parse(o,b,_e,c));if(_&&typeof _=="object"&&!_.byteLength)return new Blob([JSON.stringify(_,(b,_e)=>b.startsWith("__")?void 0:_e,(d=c.jsonSpaces)!==null&&d!==void 0?d:2)],{type:"model/gltf+json"});if(_){let b=null;return c.encrypt&&(!c.encryptKey&&window.prompt&&(c.encryptKey=window.prompt("GLTFEncryption: Enter encryption key")||""),c.encryptKey?b=makeGLBFile(await Te$1(new Uint8Array(_),c.encryptKey),{asset:{version:"2.0",generator:"WebGiGLBWrapper",encryption:{type:"aesgcm",version:1}}}):console.warn("WebGi GLTF Export: encryption key not provided, skipping encryption")),b||(b=new Blob([_],{type:"model/gltf+binary"})),b}throw new Error("GLTFExporter2.parse() failed")}parse(o,c,d,_={}){var b,_e,it,nt,at,ut,pt;const mt={binary:!1,trs:(b=_.trs)!==null&&b!==void 0&&b,onlyVisible:(_e=_.onlyVisible)!==null&&_e!==void 0&&_e,truncateDrawRange:(it=_.truncateDrawRange)===null||it===void 0||it,externalImagesInExtras:!_.embedUrlImages&&_.externalImagesInExtras||!1,embedUrlImages:(nt=_.embedUrlImages)!==null&&nt!==void 0&&nt,maxTextureSize:(at=_.maxTextureSize)!==null&&at!==void 0?at:1/0,animations:(ut=_.animations)!==null&&ut!==void 0?ut:[],includeCustomExtensions:(pt=_.includeCustomExtensions)===null||pt===void 0||pt,exporterOptions:_,ignoreInvalidMorphTargetTracks:_.ignoreInvalidMorphTargetTracks,ignoreEmptyTextures:_.ignoreEmptyTextures};return _.exportExt==="glb"&&(mt.binary=!0),_.preserveUUIDs!==!1&&(Array.isArray(o)?o:[o]).forEach(ft=>ft.traverse(vt=>{vt.uuid&&(vt.userData.gltfUUID=vt.uuid)})),(Array.isArray(o)?o:[o]).forEach(ft=>ft.traverse(vt=>{if(vt.animations)for(const xt of vt.animations)xt.__gltfExport===!1||mt.animations.includes(xt)||mt.animations.push(...vt.animations)})),super.parse(o,ft=>{_.preserveUUIDs!==!1&&(Array.isArray(o)?o:[o]).forEach(vt=>vt.traverse(xt=>{delete xt.userData.gltfUUID})),c(Object.assign(ft,{__isGLTFOutput:!0}))},d,mt,new GLTFWriter2)}}function processViewer(h,o){const c=h.getPlugin(AssetManagerPlugin).exportViewerConfig();o.json.textures&&o.json.samplers&&o.json.images&&c.resources.textures&&[...Object.entries(c.resources.textures)].forEach(([_,b])=>{o.json.textures.find(_e=>{var it,nt,at,ut,pt;return((it=_e.extras)===null||it===void 0?void 0:it.uuid)===_||((at=(nt=o.json.samplers[_e.sampler])===null||nt===void 0?void 0:nt.extras)===null||at===void 0?void 0:at.uuid)===_||((pt=(ut=o.json.images[_e.source])===null||ut===void 0?void 0:ut.extras)===null||pt===void 0?void 0:pt.t_uuid)===_})&&(b.image&&c.resources.images&&c.resources.images[b.image]&&delete c.resources.images[b.image],c.resources.textures[_]={})}),o.json.materials&&c.resources.materials&&[...Object.entries(c.resources.materials)].forEach(([_,b])=>{o.json.materials.find(_e=>{var it;return((it=_e.extras)===null||it===void 0?void 0:it.uuid)===_})&&(c.resources.materials[_]={})});const d=[];Object.values(c.resources).forEach(_=>{_&&Object.values(_).forEach(b=>{b.url&&(b.url.type==="Uint16Array"&&b.url.data?(b.url.data instanceof Uint16Array||(b.url.data=new Uint16Array(b.url.data)),d.push(b.url)):b.url.type==="Uint8Array"&&b.url.data&&(b.url.data instanceof Uint8Array||(b.url.data=new Uint8Array(b.url.data)),d.push(b.url)))})});for(const _ of d){let b="application/octet-stream";if(_.mimeType&&(b=_.mimeType),o.options.exporterOptions.encodeUint16Rgbe&&_.type==="Uint16Array"&&_.width>0&&_.height>0){const at=halfFloatToRgbe(_.data,4),ut=new ImageData(at,_.width,_.height),pt=three_module.HgN.getDataURL(ut,!0).split(",")[1],mt=2;b="image/png",_.data=Uint8Array.from(atob(pt),ft=>ft.charCodeAt(0)),_.encoding="rgbe",_.encodingVersion=mt}o.json.images||(o.json.images=[]);const _e={mimeType:b},it=o.json.images.push(_e)-1,nt=_.data;_e.bufferView=o.processBufferViewImageBuffer(nt),_.data={image:it}}return c}function halfFloatToRgbe(h,o=3,c){let d,_,b,_e,it;const nt=h.byteLength/(2*o)|0;c=c||new Uint8ClampedArray(4*nt);for(let at=0;at<nt;at++){d=h[at*o],_=h[at*o+1],b=h[at*o+2],_e=Math.max(Math.max(d,_),b);const ut=Math.ceil(Math.log2(_e));it=Math.pow(2,ut-8),c[4*at]=d/it|0,c[4*at+1]=_/it|0,c[4*at+2]=b/it|0,c[4*at+3]=ut+128}return c}function addGLTFExporter(h,o,c=GLTFExporter2,d){var _;if(!o)return;const b=h.Exporters.findIndex(it=>it.ext.includes("gltf")||it.ext.includes("glb")),_e=[];b>=0?(_e.push(...(_=h.Exporters[b].extensions)!==null&&_!==void 0?_:[]),h.Exporters.splice(b,1)):(_e.push(gltfMaterialExtrasWriter),_e.push(gltfObject3DExtrasWriter),_e.push(gltfLightExtrasWriter),_e.push(it=>new GLTFMeshGpuInstancingExporter(it)),_e.push(it=>new GLTFMaterialsBumpMapExtensionExport(it)),_e.push(it=>new GLTFMaterialsDisplacementMapExtensionExport(it)),_e.push(it=>new GLTFMaterialsLightMapExtensionExport(it)),_e.push(it=>new GLTFMaterialsAlphaMapExtensionExport(it))),h.Exporters.push({ctor:()=>{const it=new c;return _e.forEach(nt=>it.register(nt)),it.register(nt=>({afterParse:at=>{var ut,pt;if(!(!((ut=(at=Array.isArray(at)?at[0]:at)==null?void 0:at.userData)===null||ut===void 0)&&ut.rootSceneModelRoot)||((pt=at==null?void 0:at.userData)===null||pt===void 0?void 0:pt.__exportViewerConfig)===!1)return;const mt=nt.json.scenes[nt.json.scene||0];mt.extensions||(mt.extensions={}),mt.extensions[viewerGLTFExtension]=processViewer(o,nt),nt.extensionsUsed[viewerGLTFExtension]=!0}})),d==null||d(it),it},ext:["gltf","glb"],extensions:_e})}const gltfLightExtrasWriter=h=>({writeNode:(o,c)=>{if(!(o!=null&&o.isLight))return;c.extensions||(c.extensions={});const d={};o.shadow&&(d.shadow=o.shadow.toJSON()),Object.keys(d).length>0&&(c.extensions[webgiLightExtrasExtension]=d,h.extensionsUsed[webgiLightExtrasExtension]=!0)}}),gltfObject3DExtrasWriter=h=>({writeNode:(o,c)=>{if(!(o!=null&&o.isObject3D))return;c.extensions||(c.extensions={});const d={};o.castShadow!==void 0&&(d.castShadow=o.castShadow),o.receiveShadow!==void 0&&(d.receiveShadow=o.receiveShadow),o.visible===!1&&(d.visible=!1),o.frustumCulled===!1&&(d.frustumCulled=!1),o.renderOrder!==0&&(d.renderOrder=o.renderOrder),o.layers.mask!==1&&(d.layers=o.layers.mask),o.matrixAutoUpdate===!1&&(d.matrixAutoUpdate=!1),Object.keys(d).length>0&&(c.extensions[webgiObject3DExtrasExtension]=d,h.extensionsUsed[webgiObject3DExtrasExtension]=!0)}}),gltfMaterialExtrasWriter=h=>({writeMaterial(o,c){if(!(o!=null&&o.isMaterial))return;c.extensions||(c.extensions={});const d={};o.fog!==void 0&&(d.fog=o.fog),o.flatShading!==void 0&&(d.flatShading=o.flatShading),o.blending!==void 0&&(d.blending=o.blending),o.side!==void 0&&o.side!==three_module.$EB&&(d.side=o.side),o.shadowSide!==void 0&&(d.shadowSide=o.shadowSide),o.depthFunc!==void 0&&(d.depthFunc=o.depthFunc),o.depthTest!==void 0&&(d.depthTest=o.depthTest),o.depthWrite!==void 0&&(d.depthWrite=o.depthWrite),o.colorWrite!==void 0&&(d.colorWrite=o.colorWrite),o.vertexColors!==void 0&&(d.vertexColors=o.vertexColors),o.alphaTest!==void 0&&(d.alphaTest=o.alphaTest),o.alphaHash!==void 0&&(d.alphaHash=o.alphaHash),o.envMapIntensity!==void 0&&(d.envMapIntensity=o.envMapIntensity),o.wireframe!==void 0&&(d.wireframe=o.wireframe),o.wireframeLinewidth!==void 0&&(d.wireframeLinewidth=o.wireframeLinewidth),o.wireframeLinecap!==void 0&&(d.wireframeLinecap=o.wireframeLinecap),o.wireframeLinejoin!==void 0&&(d.wireframeLinejoin=o.wireframeLinejoin),o.rotation!==void 0&&(d.rotation=o.rotation),o.polygonOffset!==void 0&&(d.polygonOffset=o.polygonOffset),o.polygonOffsetFactor!==void 0&&(d.polygonOffsetFactor=o.polygonOffsetFactor),o.polygonOffsetUnits!==void 0&&(d.polygonOffsetUnits=o.polygonOffsetUnits),o.dithering!==void 0&&(d.dithering=o.dithering),o.alphaToCoverage!==void 0&&(d.alphaToCoverage=o.alphaToCoverage),o.premultipliedAlpha!==void 0&&(d.premultipliedAlpha=o.premultipliedAlpha),o.toneMapped!==void 0&&(d.toneMapped=o.toneMapped),o.normalScale!==void 0&&(d.normalScale=[o.normalScale.x,o.normalScale.y]);const _=this.materialExternalResources[o.uuid];_&&Object.entries(_).forEach(([b,_e])=>{var it;b.startsWith("_")||(_e!=null&&_e.userData&&(_e.userData.__embedUrlImagePreviews=(it=h.options.exporterOptions)===null||it===void 0?void 0:it.embedUrlImagePreviews),d[b]=serializeObject(_e,!1,this.serializedMeta),_e!=null&&_e.userData&&delete _e.userData.__embedUrlImagePreviews)}),Object.keys(d).length>0&&(c.extensions[webgiMaterialExtrasExtension]=d,h.extensionsUsed[webgiMaterialExtrasExtension]=!0)},materialExternalResources:{},serializedMeta:{images:{},textures:{}},beforeParse(o){if(this.materialExternalResources={},!h.options.externalImagesInExtras)return;const c=[];(Array.isArray(o)?o:[o]).forEach(d=>{d==null||d.traverse(_=>{var b;_&&!((b=_.material)===null||b===void 0)&&b.isMaterial&&c.push(_.material)})}),c.forEach(d=>{d&&(this.materialExternalResources[d.uuid]||(this.materialExternalResources[d.uuid]={}),this.materialExternalResources[d.uuid].__materialRef=d,Object.entries(d).forEach(([_,b])=>{_.startsWith("_")||b&&b.isTexture&&b.userData.rootPath&&(b.userData.rootPath.startsWith("http")||b.userData.rootPath.startsWith("data:"))&&(d[_]=null,this.materialExternalResources[d.uuid][_]=b)}))})},afterParse(o){const c=Object.values(this.materialExternalResources);if(c.length<1)return;c.forEach(_=>{const b=_.__materialRef;b&&(Object.entries(_).forEach(([_e,it])=>{_e.startsWith("_")||it&&(b[_e]=it)}),delete this.materialExternalResources[b.uuid])});const d=h.json.scenes[h.json.scene||0];d.extensions||(d.extensions={}),d.extensions[webgiMaterialExtrasExtension]={resources:this.serializedMeta},h.extensionsUsed[webgiMaterialExtrasExtension]=!0}});class GLTFMaterialsBumpMapExtensionExport{constructor(o){this.writer=o,this.name=GLTFMaterialsBumpMapExtensionName}writeMaterial(o,c){if(!o.isMeshStandardMaterial||o.bumpScale===0)return;const d=this.writer,_=d.extensionsUsed,b={};if(b.bumpScale=o.bumpScale,o.bumpMap&&d.checkEmptyMap(o.bumpMap)){const _e={index:d.processTexture(o.bumpMap)};d.applyTextureTransform(_e,o.bumpMap),b.bumpTexture=_e}c.extensions=c.extensions||{},c.extensions[this.name]=b,_[this.name]=!0}}class GLTFMaterialsDisplacementMapExtensionExport{constructor(o){this.writer=o,this.name=GLTFMaterialsDisplacementMapExtensionName}writeMaterial(o,c){if(!o.isMeshStandardMaterial||o.displacementScale===0)return;const d=this.writer,_=d.extensionsUsed,b={};if(b.displacementScale=o.displacementScale,b.displacementBias=o.displacementBias,o.displacementMap&&d.checkEmptyMap(o.displacementMap)){const _e={index:d.processTexture(o.displacementMap)};d.applyTextureTransform(_e,o.displacementMap),b.displacementTexture=_e}c.extensions=c.extensions||{},c.extensions[this.name]=b,_[this.name]=!0}}class GLTFMaterialsLightMapExtensionExport{constructor(o){this.writer=o,this.name=GLTFMaterialsLightMapExtensionName}writeMaterial(o,c){if(!o.isMeshStandardMaterial||o.lightMapIntensity===0)return;const d=this.writer,_=d.extensionsUsed,b={};if(b.lightMapIntensity=o.lightMapIntensity,o.lightMap&&d.checkEmptyMap(o.lightMap)){const _e={index:d.processTexture(o.lightMap)};d.applyTextureTransform(_e,o.lightMap),b.lightMapTexture=_e}c.extensions=c.extensions||{},c.extensions[this.name]=b,_[this.name]=!0}}class GLTFMaterialsAlphaMapExtensionExport{constructor(o){this.writer=o,this.name=GLTFMaterialsAlphaMapExtensionName}writeMaterial(o,c){if(!o.isMeshStandardMaterial||!o.alphaMap)return;const d=this.writer,_=d.extensionsUsed,b={};if(d.checkEmptyMap(o.alphaMap)){const _e={index:d.processTexture(o.alphaMap)};d.applyTextureTransform(_e,o.alphaMap),b.alphaTexture=_e}c.extensions=c.extensions||{},c.extensions[this.name]=b,_[this.name]=!0}}const textEncoder=new TextEncoder,ZIP_COMPRESSION=3;class EXRExporter{parse(o,c,d){if(!o||!o.isWebGLRenderer&&!o.isDataTexture)throw Error("EXRExporter.parse: Unsupported first parameter, expected instance of WebGLRenderer or DataTexture.");if(o.isWebGLRenderer){const _=o,b=c,_e=d;supportedRTT(b);const it=buildInfoRTT(b,_e);return fillData(compressData(reorganizeDataBuffer(getPixelData(_,b,it),it),it),it)}if(o.isDataTexture){const _=o,b=c;supportedDT(_);const _e=buildInfoDT(_,b);return fillData(compressData(reorganizeDataBuffer(_.image.data,_e),_e),_e)}}}function supportedRTT(h){if(!h||!h.isWebGLRenderTarget)throw Error("EXRExporter.parse: Unsupported second parameter, expected instance of WebGLRenderTarget.");if(h.isWebGLCubeRenderTarget||h.isWebGL3DRenderTarget||h.isWebGLArrayRenderTarget)throw Error("EXRExporter.parse: Unsupported render target type, expected instance of WebGLRenderTarget.");if(h.texture.type!==three_module.RQf&&h.texture.type!==three_module.ix0)throw Error("EXRExporter.parse: Unsupported WebGLRenderTarget texture type.");if(h.texture.format!==three_module.GWd)throw Error("EXRExporter.parse: Unsupported WebGLRenderTarget texture format, expected RGBAFormat.")}function supportedDT(h){if(h.type!==three_module.RQf&&h.type!==three_module.ix0)throw Error("EXRExporter.parse: Unsupported DataTexture texture type.");if(h.format!==three_module.GWd)throw Error("EXRExporter.parse: Unsupported DataTexture texture format, expected RGBAFormat.");if(!h.image.data)throw Error("EXRExporter.parse: Invalid DataTexture image data.");if(h.type===three_module.RQf&&h.image.data.constructor.name!=="Float32Array")throw Error("EXRExporter.parse: DataTexture image data doesn't match type, expected 'Float32Array'.");if(h.type===three_module.ix0&&h.image.data.constructor.name!=="Uint16Array")throw Error("EXRExporter.parse: DataTexture image data doesn't match type, expected 'Uint16Array'.")}function buildInfoRTT(h,o={}){const c=h.width,d=h.height,_=h.texture.type,b=h.texture.format,_e=(texture.colorSpace,o.compression!==void 0?o.compression:ZIP_COMPRESSION),it=(o.type!==void 0?o.type:three_module.ix0)===three_module.RQf?2:1,nt={0:1,2:1,3:16}[_e];return{width:c,height:d,type:_,format:b,compression:_e,blockLines:nt,dataType:it,dataSize:2*it,numBlocks:Math.ceil(d/nt),numInputChannels:4,numOutputChannels:4,textureIndex:o.textureIndex||0}}function buildInfoDT(h,o={}){const c=h.image.width,d=h.image.height,_=h.type,b=h.format,_e=h.colorSpace,it=o.compression!==void 0?o.compression:ZIP_COMPRESSION,nt=(o.type!==void 0?o.type:three_module.ix0)===three_module.RQf?2:1,at={0:1,2:1,3:16}[it];return{width:c,height:d,type:_,format:b,colorSpace:_e,compression:it,blockLines:at,dataType:nt,dataSize:2*nt,numBlocks:Math.ceil(d/at),numInputChannels:4,numOutputChannels:4,flipY:h.isDataTexture&&h.flipY,textureIndex:o.textureIndex||0}}function getPixelData(h,o,c){let d;return d=c.type===three_module.RQf?new Float32Array(c.width*c.height*c.numInputChannels):new Uint16Array(c.width*c.height*c.numInputChannels),h.readRenderTargetPixels(o,0,0,c.width,c.height,d,void 0,c.textureIndex),d}function reorganizeDataBuffer(h,o){const c=o.width,d=o.height,_={r:0,g:0,b:0,a:0},b={value:0},_e=o.numOutputChannels==4?1:0,it=o.type==three_module.RQf?getFloat32:getFloat16,nt=o.dataType==1?setFloat16:setFloat32,at=new Uint8Array(o.width*o.height*o.numOutputChannels*o.dataSize),ut=new DataView(at.buffer);for(let pt=0;pt<d;++pt)for(let mt=0;mt<c;++mt){const ft=pt*c*4+4*mt,vt=it(h,ft),xt=it(h,ft+1),At=it(h,ft+2),Ct=it(h,ft+3),Et=(o.flipY?pt:d-pt-1)*c*(3+_e)*o.dataSize;decodeLinear(_,vt,xt,At,Ct),b.value=Et+mt*o.dataSize,nt(ut,_.a,b),b.value=Et+_e*c*o.dataSize+mt*o.dataSize,nt(ut,_.b,b),b.value=Et+(1+_e)*c*o.dataSize+mt*o.dataSize,nt(ut,_.g,b),b.value=Et+(2+_e)*c*o.dataSize+mt*o.dataSize,nt(ut,_.r,b)}return at}function compressData(h,o){let c,d,_=0;const b={data:new Array,totalSize:0},_e=o.width*o.numOutputChannels*o.blockLines*o.dataSize;switch(o.compression){case 0:c=compressNONE;break;case 2:case 3:c=compressZIP}o.compression!==0&&(d=new Uint8Array(_e));for(let it=0;it<o.numBlocks;++it){const nt=c(h.subarray(_e*it,_e*(it+1)),d);_+=nt.length,b.data.push({dataChunk:nt,size:nt.length})}return b.totalSize=_,b}function compressNONE(h){return h}function compressZIP(h,o){let c=0,d=Math.floor((h.length+1)/2),_=0;const b=h.length-1;for(;!(_>b||(o[c++]=h[_++],_>b));)o[d++]=h[_++];let _e=o[0];for(let it=1;it<o.length;it++){const nt=o[it]-_e+384;_e=o[it],o[it]=nt}return fflate_module_zlibSync(o)}function fillHeader(h,o,c){const d={value:0},_=new DataView(h.buffer);setUint32(_,20000630,d),setUint32(_,2,d),setString(_,"compression",d),setString(_,"compression",d),setUint32(_,1,d),setUint8(_,c.compression,d),setString(_,"screenWindowCenter",d),setString(_,"v2f",d),setUint32(_,8,d),setUint32(_,0,d),setUint32(_,0,d),setString(_,"screenWindowWidth",d),setString(_,"float",d),setUint32(_,4,d),setFloat32(_,1,d),setString(_,"pixelAspectRatio",d),setString(_,"float",d),setUint32(_,4,d),setFloat32(_,1,d),setString(_,"lineOrder",d),setString(_,"lineOrder",d),setUint32(_,1,d),setUint8(_,0,d),setString(_,"dataWindow",d),setString(_,"box2i",d),setUint32(_,16,d),setUint32(_,0,d),setUint32(_,0,d),setUint32(_,c.width-1,d),setUint32(_,c.height-1,d),setString(_,"displayWindow",d),setString(_,"box2i",d),setUint32(_,16,d),setUint32(_,0,d),setUint32(_,0,d),setUint32(_,c.width-1,d),setUint32(_,c.height-1,d),setString(_,"channels",d),setString(_,"chlist",d),setUint32(_,18*c.numOutputChannels+1,d),setString(_,"A",d),setUint32(_,c.dataType,d),d.value+=4,setUint32(_,1,d),setUint32(_,1,d),setString(_,"B",d),setUint32(_,c.dataType,d),d.value+=4,setUint32(_,1,d),setUint32(_,1,d),setString(_,"G",d),setUint32(_,c.dataType,d),d.value+=4,setUint32(_,1,d),setUint32(_,1,d),setString(_,"R",d),setUint32(_,c.dataType,d),d.value+=4,setUint32(_,1,d),setUint32(_,1,d),setUint8(_,0,d),setUint8(_,0,d);let b=d.value+8*c.numBlocks;for(let _e=0;_e<o.data.length;++_e)setUint64(_,b,d),b+=o.data[_e].size+8}function fillData(h,o){const c=8*o.numBlocks,d=259+18*o.numOutputChannels,_={value:d+c},b=new Uint8Array(d+c+h.totalSize+8*o.numBlocks),_e=new DataView(b.buffer);fillHeader(b,h,o);for(let it=0;it<h.data.length;++it){const nt=h.data[it].dataChunk,at=h.data[it].size;setUint32(_e,it*o.blockLines,_),setUint32(_e,at,_),b.set(nt,_.value),_.value+=at}return b}function decodeLinear(h,o,c,d,_){h.r=o,h.g=c,h.b=d,h.a=_}function setUint8(h,o,c){h.setUint8(c.value,o),c.value+=1}function setUint32(h,o,c){h.setUint32(c.value,o,!0),c.value+=4}function setFloat16(h,o,c){h.setUint16(c.value,three_module.GxU.toHalfFloat(o),!0),c.value+=2}function setFloat32(h,o,c){h.setFloat32(c.value,o,!0),c.value+=4}function setUint64(h,o,c){h.setBigUint64(c.value,BigInt(o),!0),c.value+=8}function setString(h,o,c){const d=textEncoder.encode(o+"\0");for(let _=0;_<d.length;++_)setUint8(h,d[_],c)}function decodeFloat16(h){const o=(31744&h)>>10,c=1023&h;return(h>>15?-1:1)*(o?o===31?c?NaN:1/0:Math.pow(2,o-15)*(1+c/1024):c/1024*6103515625e-14)}function getFloat16(h,o){return decodeFloat16(h[o])}function getFloat32(h,o){return h[o]}class EXRExporter2 extends EXRExporter{async parseAsync(o,c){const d=o;if(d.isWebGLRenderTarget&&!o.renderer)throw new Error("No renderManager on renderTarget");if(!d.isWebGLRenderTarget&&!o.isDataTexture)throw new Error("Invalid object type");d.isWebGLMultipleRenderTargets&&c.textureIndex===void 0&&console.warn("No textureIndex specified for WebGLMultipleRenderTargets");const _=d.isWebGLRenderTarget?this.parse(o.renderer.rendererObject,d,c):this.parse(o,c);return new Blob([_],{type:"image/x-exr"})}}class AssetExporter extends I$2{get processors(){return this._processors}getExporter(...o){return this.Exporters.find(c=>c.ext.some(d=>o.includes(d)))}constructor(o,c={}){super(),this._processors=new ObjectProcessorMap,this.Exporters=[{ctor:()=>new SimpleJSONExporter,ext:["json"]},{ctor:()=>new SimpleTextExporter,ext:["txt","text"]},{ctor:()=>new EXRExporter2,ext:["exr"]}],this._cachedParsers=[],addGLTFExporter(this,o)}async exportObject(o,c={}){var d,_;if(!(o!=null&&o.assetType))return void console.error("Object has no asset type");!((d=o==null?void 0:o.userData)===null||d===void 0)&&d.rootSceneModelRoot&&c.viewerConfig===!1&&(o.userData.__exportViewerConfig=!1);const b=[];o.assetType==="model"&&o.modelObject.traverse(it=>{it.userData.excludeFromExport&&it.visible&&(it.visible=!1,b.push(it))});const _e=await this._exportFile(o,c);return o.assetType==="model"&&b.forEach(it=>it.visible=!0),!((_=o==null?void 0:o.userData)===null||_===void 0)&&_.rootSceneModelRoot&&c.viewerConfig===!1&&delete o.userData.__exportViewerConfig,_e}async _exportFile(o,c={}){var d,_,b;let _e;this.dispatchEvent({type:"exportFile",obj:o,state:"processing"});try{const it=await this.processBeforeExport(o,c),nt=(_=(d=c.exportExt)!==null&&d!==void 0?d:it==null?void 0:it.typeExt)!==null&&_!==void 0?_:it==null?void 0:it.ext;if(!it||!nt)throw new Error(`Unable to preprocess before export ${nt}`);const at=this._getParser(nt);this.dispatchEvent({type:"exportFile",obj:o,state:"exporting"});const ut=await at.parseAsync(it.obj,{exportExt:(b=it.ext)!==null&&b!==void 0?b:nt,...c});ut.ext=it.ext,_e=ut}catch(it){return console.error("AssetExporter: Unable to Export file",o),console.error(it),void this.dispatchEvent({type:"exportFile",obj:o,state:"error",error:it})}return this.dispatchEvent({type:"exportFile",obj:o,state:"done"}),_e}_createParser(o){const c=this.Exporters.find(_=>_.ext.includes(o));if(!c)throw new Error(`No exporter found for extension ${o}`);const d=c==null?void 0:c.ctor(this);if(!d)throw new Error(`Unable to create parser for extension ${o}`);return this._cachedParsers.push({ext:c.ext,parser:d}),this.dispatchEvent({type:"exporterCreate",exporter:c,parser:d}),d}_getParser(o){var c,d;return(d=(c=this._cachedParsers.find(_=>_.ext.includes(o)))===null||c===void 0?void 0:c.parser)!==null&&d!==void 0?d:this._createParser(o)}async processBeforeExport(o,c={}){if(o.assetType!=null&&o.assetType!=="renderTarget"&&(o=await this._processors.process(o.assetType,o,c)),o.isWebGLRenderTarget)return{obj:o,ext:"exr"};switch(o.assetType){case"light":return void console.error("AssetExporter: light export not implemented");case"model":return{obj:o,ext:"glb"};case"material":return{obj:o.toJSON(),ext:o.typeSlug||"json",typeExt:"json"};case"texture":return{obj:o.toJSON(),ext:"json"};case"renderTarget":return{obj:o,ext:"exr"};default:console.error("AssetExporter: unknown asset type",o.assetType)}}dispose(){var o;(o=this._processors)===null||o===void 0||o.dispose()}}var AssetExporterPlugin_decorate=function(h,o,c,d){var _,b=arguments.length,_e=b<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_e=Reflect.decorate(h,o,c,d);else for(var it=h.length-1;it>=0;it--)(_=h[it])&&(_e=(b<3?_(_e):b>3?_(o,c,_e):_(o,c))||_e);return b>3&&_e&&Object.defineProperty(o,c,_e),_e},EncoderMethod;(function(h){h[h.EDGEBREAKER=1]="EDGEBREAKER",h[h.SEQUENTIAL=0]="SEQUENTIAL"})(EncoderMethod||(EncoderMethod={}));class AssetExporterPlugin extends AViewerPlugin{constructor(o){super(),this.enabled=!0,this.exportOptions={compress:!1,name:"scene",viewerConfig:!0,encodeUint16Rgbe:!1,convertMeshToIndexed:!1,embedUrlImagePreviews:!1,embedUrlImages:!1,dracoOptions:{encodeSpeed:5,method:EncoderMethod.EDGEBREAKER,quantizationVolume:"mesh",quantizationBits:{POSITION:14,NORMAL:10,COLOR:8,TEX_COORD:12,GENERIC:12}},encrypt:!1,encryptKey:"",ignoreInvalidMorphTargetTracks:!0,ignoreEmptyTextures:!0},this.exporter=o,this.exportScene=this.exportScene.bind(this)}async onAdded(o){await super.onAdded(o),this.exporter||(this.exporter=new AssetExporter(o)),this.exporter.processors.add("model",{forAssetType:"model",processAsync:async(c,d)=>{var _;return d.convertMeshToIndexed&&((_=c.modelObject)===null||_===void 0||_.traverse(b=>{if(b.geometry&&!b.geometry.attributes.index)try{const _e=toIndexedGeometry(b.geometry);b.setGeometry&&b.setGeometry(_e)}catch(_e){console.error("AssetExporterPlugin.convertMeshToIndexed: Error converting geometry to indexed",_e)}})),c}})}async onRemove(o){return super.onRemove(o)}async exportScene(o){var c,d;return(c=this.exporter)===null||c===void 0?void 0:c.exportObject((d=this._viewer)===null||d===void 0?void 0:d.scene.modelRoot,o||{...this.exportOptions})}async downloadSceneGlb(){const o=await this.exportScene(this.exportOptions);o&&await this._downloadBlob(o,this.exportOptions.name+"."+o.ext)}async _downloadBlob(o,c){var d,_;const b=(d=this._viewer)===null||d===void 0?void 0:d.getPluginByType("FileTransferPlugin");b?await b.exportFile(o,c):(_=this._viewer)===null||_===void 0||_.console.error("FileTransferPlugin required to export/download file")}get uiConfig(){if(this._uiConfig)return this._uiConfig;const o=this._viewer;o.addEventListener("addPlugin",d=>{var _;typeof((_=d.plugin)===null||_===void 0?void 0:_.toJSON)=="function"&&console.error("Add all plugins before setting up the export UI, or use `toJSON: any = null` in the plugin ")});const c=Object.entries(o.plugins).filter(([d,_])=>typeof(_==null?void 0:_.toJSON)=="function"&&(_==null?void 0:_.serializeWithViewer)!==!1).map(([d,_])=>({label:d,type:"checkbox",value:!0}));return this._uiConfig={type:"folder",label:"Asset Export",limitedUi:!0,children:[{type:"input",property:[this.exportOptions,"name"],limitedUi:!0},{type:"folder",label:"GLB Export",limitedUi:!0,children:[{type:"checkbox",label:"DRACO Compress",property:[this.exportOptions,"compress"],limitedUi:!0,onChange:()=>{var d,_;return(_=(d=this._uiConfig)===null||d===void 0?void 0:d.uiRefresh)===null||_===void 0?void 0:_.call(d,"postFrame",!0)}},this.exportOptions.dracoOptions?{type:"folder",hidden:()=>!this.exportOptions.compress,label:"DRACO Options",children:[{type:"slider",label:"Encode Speed",bounds:[1,10],property:[this.exportOptions.dracoOptions,"encodeSpeed"]},{type:"dropdown",label:"Encoder Method",property:[this.exportOptions.dracoOptions,"method"],children:Object.entries(EncoderMethod).map(([d,_])=>({label:d,value:_}))},{type:"dropdown",label:"Quantization Volume",property:[this.exportOptions.dracoOptions,"quantizationVolume"],children:["mesh","scene","bbox"].map(d=>({label:d}))},{type:"folder",label:"Quantization Bits",children:Object.keys(this.exportOptions.dracoOptions.quantizationBits).map(d=>({type:"slider",label:d,bounds:[1,16],stepSize:1,property:[this.exportOptions.dracoOptions.quantizationBits,d]}))}]}:{},{type:"checkbox",label:"Scene Settings",property:[this.exportOptions,"viewerConfig"],limitedUi:!0,onChange:()=>{var d,_;return(_=(d=this._uiConfig)===null||d===void 0?void 0:d.uiRefresh)===null||_===void 0?void 0:_.call(d,"postFrame",!0)}},{type:"checkbox",label:"Embed Image Previews",property:[this.exportOptions,"embedUrlImagePreviews"]},{type:"checkbox",label:"Encrypt",property:[this.exportOptions,"encrypt"],onChange:()=>{var d,_;return(_=(d=this._uiConfig)===null||d===void 0?void 0:d.uiRefresh)===null||_===void 0?void 0:_.call(d,"postFrame",!0)}},{type:"checkbox",label:"Encrypt Password",hidden:()=>!this.exportOptions.encrypt,property:[this.exportOptions,"encryptKey"]},{type:"checkbox",label:"Compress hdr env maps",hidden:()=>!this.exportOptions.viewerConfig,property:[this.exportOptions,"encodeUint16Rgbe"]},{type:"checkbox",label:"Convert to indexed",property:[this.exportOptions,"convertMeshToIndexed"]},{type:"checkbox",label:"Ignore invalid animations",property:[this.exportOptions,"ignoreInvalidMorphTargetTracks"]},{type:"checkbox",label:"Ignore invalid textures",property:[this.exportOptions,"ignoreInvalidTextures"]},{type:"button",label:"Export GLB",limitedUi:!0,value:async()=>this.downloadSceneGlb()}]},{type:"folder",label:"Preset/Config export",children:[{type:"folder",label:"Plugins",children:c},{type:"button",label:"Select none",value:()=>{c.forEach(d=>{var _;d.value=!1,(_=d.uiRefresh)===null||_===void 0||_.call(d)})}},{type:"button",label:"Select all",value:()=>{c.forEach(d=>{var _;d.value=!0,(_=d.uiRefresh)===null||_===void 0||_.call(d)})}},{type:"button",label:"Export Plugins",limitedUi:!0,value:async()=>{const d=new Blob([JSON.stringify(o.getPlugin(AssetManagerPlugin).exportPluginPresets(c.filter(_=>!!_.value).map(_=>Ee$1(_.label)||"")),null,2)],{type:"application/json"});d&&await this._downloadBlob(d,this.exportOptions.name+"."+AssetManagerPlugin.ViewerTypeSlug)}},{type:"button",label:"Export All Viewer Config",limitedUi:!0,value:async()=>{const d=new Blob([JSON.stringify(o.getPlugin(AssetManagerPlugin).exportViewerConfig(!1),null,2)],{type:"application/json"});d&&await this._downloadBlob(d,this.exportOptions.name+"."+AssetManagerPlugin.ViewerTypeSlug)}}]}]}}}AssetExporterPlugin.PluginType="AssetExporterPlugin",AssetExporterPlugin_decorate([serialize()],AssetExporterPlugin.prototype,"exportOptions",void 0);class EventDispatcher{constructor(){this._listeners={}}addEventListener(o,c){const d=this._listeners;return d[o]===void 0&&(d[o]=[]),d[o].indexOf(c)===-1&&d[o].push(c),this}removeEventListener(o,c){const d=this._listeners[o];if(d!==void 0){const _=d.indexOf(c);_!==-1&&d.splice(_,1)}return this}dispatchEvent(o){const c=this._listeners[o.type];if(c!==void 0){const d=c.slice(0);for(let _=0,b=d.length;_<b;_++)d[_].call(this,o)}return this}dispose(){for(const o in this._listeners)delete this._listeners[o]}}class GraphEdge{constructor(o,c,d,_={}){if(this._name=void 0,this._parent=void 0,this._child=void 0,this._attributes=void 0,this._disposed=!1,this._name=o,this._parent=c,this._child=d,this._attributes=_,!c.isOnGraph(d))throw new Error("Cannot connect disconnected graphs.")}getName(){return this._name}getParent(){return this._parent}getChild(){return this._child}setChild(o){return this._child=o,this}getAttributes(){return this._attributes}dispose(){this._disposed||(this._parent._destroyRef(this),this._disposed=!0)}isDisposed(){return this._disposed}}class Graph extends EventDispatcher{constructor(...o){super(...o),this._emptySet=new Set,this._edges=new Set,this._parentEdges=new Map,this._childEdges=new Map}listEdges(){return Array.from(this._edges)}listParentEdges(o){return Array.from(this._childEdges.get(o)||this._emptySet)}listParents(o){const c=new Set;for(const d of this.listParentEdges(o))c.add(d.getParent());return Array.from(c)}listChildEdges(o){return Array.from(this._parentEdges.get(o)||this._emptySet)}listChildren(o){const c=new Set;for(const d of this.listChildEdges(o))c.add(d.getChild());return Array.from(c)}disconnectParents(o,c){for(const d of this.listParentEdges(o))c&&!c(d.getParent())||d.dispose();return this}_createEdge(o,c,d,_){const b=new GraphEdge(o,c,d,_);this._edges.add(b);const _e=b.getParent();this._parentEdges.has(_e)||this._parentEdges.set(_e,new Set),this._parentEdges.get(_e).add(b);const it=b.getChild();return this._childEdges.has(it)||this._childEdges.set(it,new Set),this._childEdges.get(it).add(b),b}_destroyEdge(o){return this._edges.delete(o),this._parentEdges.get(o.getParent()).delete(o),this._childEdges.get(o.getChild()).delete(o),this}}function _extends(){return _extends=Object.assign||function(h){for(var o=1;o<arguments.length;o++){var c=arguments[o];for(var d in c)Object.prototype.hasOwnProperty.call(c,d)&&(h[d]=c[d])}return h},_extends.apply(this,arguments)}class RefList{constructor(o){if(this.list=[],o)for(const c of o)this.list.push(c)}add(o){this.list.push(o)}remove(o){const c=this.list.indexOf(o);c>=0&&this.list.splice(c,1)}removeChild(o){const c=[];for(const d of this.list)d.getChild()===o&&c.push(d);for(const d of c)this.remove(d);return c}listRefsByChild(o){const c=[];for(const d of this.list)d.getChild()===o&&c.push(d);return c}values(){return this.list}}class RefSet{constructor(o){if(this.set=new Set,this.map=new Map,o)for(const c of o)this.add(c)}add(o){const c=o.getChild();this.removeChild(c),this.set.add(o),this.map.set(c,o)}remove(o){this.set.delete(o),this.map.delete(o.getChild())}removeChild(o){const c=this.map.get(o)||null;return c&&this.remove(c),c}getRefByChild(o){return this.map.get(o)||null}values(){return Array.from(this.set)}}class RefMap{constructor(o){this.map={},o&&Object.assign(this.map,o)}set(o,c){this.map[o]=c}delete(o){delete this.map[o]}get(o){return this.map[o]||null}keys(){return Object.keys(this.map)}values(){return Object.values(this.map)}}const $attributes=Symbol("attributes"),$immutableKeys=Symbol("immutableKeys");class GraphNode extends EventDispatcher{constructor(o){super(),this._disposed=!1,this.graph=void 0,this[$attributes]=void 0,this[$immutableKeys]=void 0,this.graph=o,this[$immutableKeys]=new Set,this[$attributes]=this._createAttributes()}getDefaults(){return{}}_createAttributes(){const o=this.getDefaults(),c={};for(const d in o){const _=o[d];if(_ instanceof GraphNode){const b=this.graph._createEdge(d,this,_);this[$immutableKeys].add(d),c[d]=b}else c[d]=_}return c}isOnGraph(o){return this.graph===o.graph}isDisposed(){return this._disposed}dispose(){this._disposed||(this.graph.listChildEdges(this).forEach(o=>o.dispose()),this.graph.disconnectParents(this),this._disposed=!0,this.dispatchEvent({type:"dispose"}))}detach(){return this.graph.disconnectParents(this),this}swap(o,c){for(const d in this[$attributes]){const _=this[$attributes][d];if(_ instanceof GraphEdge){const b=_;b.getChild()===o&&this.setRef(d,c,b.getAttributes())}else if(_ instanceof RefList)for(const b of _.listRefsByChild(o)){const _e=b.getAttributes();this.removeRef(d,o),this.addRef(d,c,_e)}else if(_ instanceof RefSet){const b=_.getRefByChild(o);if(b){const _e=b.getAttributes();this.removeRef(d,o),this.addRef(d,c,_e)}}else if(_ instanceof RefMap)for(const b of _.keys()){const _e=_.get(b);_e.getChild()===o&&this.setRefMap(d,b,c,_e.getAttributes())}}return this}get(o){return this[$attributes][o]}set(o,c){return this[$attributes][o]=c,this.dispatchEvent({type:"change",attribute:o})}getRef(o){const c=this[$attributes][o];return c?c.getChild():null}setRef(o,c,d){if(this[$immutableKeys].has(o))throw new Error(`Cannot overwrite immutable attribute, "${o}".`);const _=this[$attributes][o];if(_&&_.dispose(),!c)return this;const b=this.graph._createEdge(o,this,c,d);return this[$attributes][o]=b,this.dispatchEvent({type:"change",attribute:o})}listRefs(o){return this.assertRefList(o).values().map(c=>c.getChild())}addRef(o,c,d){const _=this.graph._createEdge(o,this,c,d);return this.assertRefList(o).add(_),this.dispatchEvent({type:"change",attribute:o})}removeRef(o,c){const d=this.assertRefList(o);if(d instanceof RefList)for(const _ of d.listRefsByChild(c))_.dispose();else{const _=d.getRefByChild(c);_&&_.dispose()}return this}assertRefList(o){const c=this[$attributes][o];if(c instanceof RefList||c instanceof RefSet)return c;throw new Error(`Expected RefList or RefSet for attribute "${o}"`)}listRefMapKeys(o){return this.assertRefMap(o).keys()}listRefMapValues(o){return this.assertRefMap(o).values().map(c=>c.getChild())}getRefMap(o,c){const d=this.assertRefMap(o).get(c);return d?d.getChild():null}setRefMap(o,c,d,_){const b=this.assertRefMap(o),_e=b.get(c);if(_e&&_e.dispose(),!d)return this;_=Object.assign(_||{},{key:c});const it=this.graph._createEdge(o,this,d,_extends({},_,{key:c}));return b.set(c,it),this.dispatchEvent({type:"change",attribute:o,key:c})}assertRefMap(o){const c=this[$attributes][o];if(c instanceof RefMap)return c;throw new Error(`Expected RefMap for attribute "${o}"`)}dispatchEvent(o){return super.dispatchEvent(_extends({},o,{target:this})),this.graph.dispatchEvent(_extends({},o,{target:this,type:`node:${o.type}`})),this}_destroyRef(o){const c=o.getName();if(this[$attributes][c]===o)this[$attributes][c]=null,this[$immutableKeys].has(c)&&o.getChild().dispose();else if(this[$attributes][c]instanceof RefList)this[$attributes][c].remove(o);else if(this[$attributes][c]instanceof RefSet)this[$attributes][c].remove(o);else{if(!(this[$attributes][c]instanceof RefMap))return;{const d=this[$attributes][c];for(const _ of d.keys())d.get(_)===o&&d.delete(_)}}this.graph._destroyEdge(o),this.dispatchEvent({type:"change",attribute:c})}}const VERSION="v4.1.1",GLB_BUFFER="@glb.bin";var index_modern_PropertyType,VertexLayout,BufferViewUsage$1,index_modern_TextureChannel,Format;(function(h){h.ACCESSOR="Accessor",h.ANIMATION="Animation",h.ANIMATION_CHANNEL="AnimationChannel",h.ANIMATION_SAMPLER="AnimationSampler",h.BUFFER="Buffer",h.CAMERA="Camera",h.MATERIAL="Material",h.MESH="Mesh",h.PRIMITIVE="Primitive",h.PRIMITIVE_TARGET="PrimitiveTarget",h.NODE="Node",h.ROOT="Root",h.SCENE="Scene",h.SKIN="Skin",h.TEXTURE="Texture",h.TEXTURE_INFO="TextureInfo"})(index_modern_PropertyType||(index_modern_PropertyType={})),function(h){h.INTERLEAVED="interleaved",h.SEPARATE="separate"}(VertexLayout||(VertexLayout={})),function(h){h.ARRAY_BUFFER="ARRAY_BUFFER",h.ELEMENT_ARRAY_BUFFER="ELEMENT_ARRAY_BUFFER",h.INVERSE_BIND_MATRICES="INVERSE_BIND_MATRICES",h.OTHER="OTHER",h.SPARSE="SPARSE"}(BufferViewUsage$1||(BufferViewUsage$1={})),function(h){h[h.R=4096]="R",h[h.G=256]="G",h[h.B=16]="B",h[h.A=1]="A"}(index_modern_TextureChannel||(index_modern_TextureChannel={})),function(h){h.GLTF="GLTF",h.GLB="GLB"}(Format||(Format={}));const index_modern_ComponentTypeToTypedArray={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};var ARRAY_TYPE=typeof Float32Array<"u"?Float32Array:Array,_Logger,Verbosity;function create(){var h=new ARRAY_TYPE(3);return ARRAY_TYPE!=Float32Array&&(h[0]=0,h[1]=0,h[2]=0),h}function index_modern_length(h){var o=h[0],c=h[1],d=h[2];return Math.hypot(o,c,d)}function transformMat4(h,o,c){var d=o[0],_=o[1],b=o[2],_e=c[3]*d+c[7]*_+c[11]*b+c[15];return _e=_e||1,h[0]=(c[0]*d+c[4]*_+c[8]*b+c[12])/_e,h[1]=(c[1]*d+c[5]*_+c[9]*b+c[13])/_e,h[2]=(c[2]*d+c[6]*_+c[10]*b+c[14])/_e,h}function getBounds(h){const o=createBounds(),c=h.propertyType===index_modern_PropertyType.NODE?[h]:h.listChildren();for(const d of c)d.traverse(_=>{const b=_.getMesh();if(!b)return;const _e=getMeshBounds(b,_.getWorldMatrix());_e.min.every(isFinite)&&_e.max.every(isFinite)&&(expandBounds(_e.min,o),expandBounds(_e.max,o))});return o}function getMeshBounds(h,o){const c=createBounds();for(const d of h.listPrimitives()){const _=d.getAttribute("POSITION"),b=d.getIndices();if(!_)continue;let _e=[0,0,0],it=[0,0,0];for(let nt=0,at=b?b.getCount():_.getCount();nt<at;nt++){const ut=b?b.getScalar(nt):nt;_e=_.getElement(ut,_e),it=transformMat4(it,_e,o),expandBounds(it,c)}}return c}function expandBounds(h,o){for(let c=0;c<3;c++)o.min[c]=Math.min(h[c],o.min[c]),o.max[c]=Math.max(h[c],o.max[c])}function createBounds(){return{min:[1/0,1/0,1/0],max:[-1/0,-1/0,-1/0]}}Math.hypot||(Math.hypot=function(){for(var h=0,o=arguments.length;o--;)h+=arguments[o]*arguments[o];return Math.sqrt(h)}),create();class index_modern_BufferUtils{static createBufferFromDataURI(o){if(typeof Buffer>"u"){const c=atob(o.split(",")[1]),d=new Uint8Array(c.length);for(let _=0;_<c.length;_++)d[_]=c.charCodeAt(_);return d}{const c=o.split(",")[1],d=o.indexOf("base64")>=0;return Buffer.from(c,d?"base64":"utf8")}}static encodeText(o){return new TextEncoder().encode(o)}static decodeText(o){return new TextDecoder().decode(o)}static concat(o){let c=0;for(const b of o)c+=b.byteLength;const d=new Uint8Array(c);let _=0;for(const b of o)d.set(b,_),_+=b.byteLength;return d}static pad(o,c=0){const d=this.padNumber(o.byteLength);if(d===o.byteLength)return o;const _=new Uint8Array(d);if(_.set(o),c!==0)for(let b=o.byteLength;b<d;b++)_[b]=c;return _}static padNumber(o){return 4*Math.ceil(o/4)}static equals(o,c){if(o===c)return!0;if(o.byteLength!==c.byteLength)return!1;let d=o.byteLength;for(;d--;)if(o[d]!==c[d])return!1;return!0}static toView(o,c=0,d=1/0){return new Uint8Array(o.buffer,o.byteOffset+c,Math.min(o.byteLength,d))}static assertView(o){if(o&&!ArrayBuffer.isView(o))throw new Error(`Method requires Uint8Array parameter; received "${typeof o}".`);return o}}class JPEGImageUtils{match(o){return o.length>=3&&o[0]===255&&o[1]===216&&o[2]===255}getSize(o){let c,d,_=new DataView(o.buffer,o.byteOffset+4);for(;_.byteLength;){if(c=_.getUint16(0,!1),validateJPEGBuffer(_,c),d=_.getUint8(c+1),d===192||d===193||d===194)return[_.getUint16(c+7,!1),_.getUint16(c+5,!1)];_=new DataView(o.buffer,_.byteOffset+c+2)}throw new TypeError("Invalid JPG, no size found")}getChannels(o){return 3}}class PNGImageUtils{match(o){return o.length>=8&&o[0]===137&&o[1]===80&&o[2]===78&&o[3]===71&&o[4]===13&&o[5]===10&&o[6]===26&&o[7]===10}getSize(o){const c=new DataView(o.buffer,o.byteOffset);return index_modern_BufferUtils.decodeText(o.slice(12,16))===PNGImageUtils.PNG_FRIED_CHUNK_NAME?[c.getUint32(32,!1),c.getUint32(36,!1)]:[c.getUint32(16,!1),c.getUint32(20,!1)]}getChannels(o){return 4}}PNGImageUtils.PNG_FRIED_CHUNK_NAME="CgBI";class index_modern_ImageUtils{static registerFormat(o,c){this.impls[o]=c}static getMimeType(o){for(const c in this.impls)if(this.impls[c].match(o))return c;return null}static getSize(o,c){return this.impls[c]?this.impls[c].getSize(o):null}static getChannels(o,c){return this.impls[c]?this.impls[c].getChannels(o):null}static getVRAMByteLength(o,c){if(!this.impls[c])return null;if(this.impls[c].getVRAMByteLength)return this.impls[c].getVRAMByteLength(o);let d=0;const _=this.getSize(o,c);if(!_)return null;for(;_[0]>1||_[1]>1;)d+=_[0]*_[1]*4,_[0]=Math.max(Math.floor(_[0]/2),1),_[1]=Math.max(Math.floor(_[1]/2),1);return d+=4,d}static mimeTypeToExtension(o){return o==="image/jpeg"?"jpg":o.split("/").pop()}static extensionToMimeType(o){return o==="jpg"?"image/jpeg":o?`image/${o}`:""}}function validateJPEGBuffer(h,o){if(o>h.byteLength)throw new TypeError("Corrupt JPG, exceeded buffer limits");if(h.getUint8(o)!==255)throw new TypeError("Invalid JPG, marker table corrupted");return h}index_modern_ImageUtils.impls={"image/jpeg":new JPEGImageUtils,"image/png":new PNGImageUtils};class index_modern_FileUtils{static basename(o){const c=o.split(/[\\/]/).pop();return c.substring(0,c.lastIndexOf("."))}static extension(o){if(o.startsWith("data:image/")){const c=o.match(/data:(image\/\w+)/)[1];return index_modern_ImageUtils.mimeTypeToExtension(c)}return o.startsWith("data:model/gltf+json")?"gltf":o.startsWith("data:model/gltf-binary")?"glb":o.startsWith("data:application/")?"bin":o.split(/[\\/]/).pop().split(/[.]/).pop()}}function isObject(h){return Object.prototype.toString.call(h)==="[object Object]"}function isPlainObject(h){if(isObject(h)===!1)return!1;const o=h.constructor;if(o===void 0)return!0;const c=o.prototype;return isObject(c)!==!1&&Object.prototype.hasOwnProperty.call(c,"isPrototypeOf")!==!1}(function(h){h[h.SILENT=4]="SILENT",h[h.ERROR=3]="ERROR",h[h.WARN=2]="WARN",h[h.INFO=1]="INFO",h[h.DEBUG=0]="DEBUG"})(Verbosity||(Verbosity={}));class Logger{constructor(o){this.verbosity=void 0,this.verbosity=o}debug(o){this.verbosity<=Logger.Verbosity.DEBUG&&console.debug(o)}info(o){this.verbosity<=Logger.Verbosity.INFO&&console.info(o)}warn(o){this.verbosity<=Logger.Verbosity.WARN&&console.warn(o)}error(o){this.verbosity<=Logger.Verbosity.ERROR&&console.error(o)}}function determinant(h){var o=h[0],c=h[1],d=h[2],_=h[3],b=h[4],_e=h[5],it=h[6],nt=h[7],at=h[8],ut=h[9],pt=h[10],mt=h[11],ft=h[12],vt=h[13],xt=h[14],At=h[15];return(o*_e-c*b)*(pt*At-mt*xt)-(o*it-d*b)*(ut*At-mt*vt)+(o*nt-_*b)*(ut*xt-pt*vt)+(c*it-d*_e)*(at*At-mt*ft)-(c*nt-_*_e)*(at*xt-pt*ft)+(d*nt-_*it)*(at*vt-ut*ft)}function multiply(h,o,c){var d=o[0],_=o[1],b=o[2],_e=o[3],it=o[4],nt=o[5],at=o[6],ut=o[7],pt=o[8],mt=o[9],ft=o[10],vt=o[11],xt=o[12],At=o[13],Ct=o[14],Et=o[15],Tt=c[0],kt=c[1],Dt=c[2],zt=c[3];return h[0]=Tt*d+kt*it+Dt*pt+zt*xt,h[1]=Tt*_+kt*nt+Dt*mt+zt*At,h[2]=Tt*b+kt*at+Dt*ft+zt*Ct,h[3]=Tt*_e+kt*ut+Dt*vt+zt*Et,Tt=c[4],kt=c[5],Dt=c[6],zt=c[7],h[4]=Tt*d+kt*it+Dt*pt+zt*xt,h[5]=Tt*_+kt*nt+Dt*mt+zt*At,h[6]=Tt*b+kt*at+Dt*ft+zt*Ct,h[7]=Tt*_e+kt*ut+Dt*vt+zt*Et,Tt=c[8],kt=c[9],Dt=c[10],zt=c[11],h[8]=Tt*d+kt*it+Dt*pt+zt*xt,h[9]=Tt*_+kt*nt+Dt*mt+zt*At,h[10]=Tt*b+kt*at+Dt*ft+zt*Ct,h[11]=Tt*_e+kt*ut+Dt*vt+zt*Et,Tt=c[12],kt=c[13],Dt=c[14],zt=c[15],h[12]=Tt*d+kt*it+Dt*pt+zt*xt,h[13]=Tt*_+kt*nt+Dt*mt+zt*At,h[14]=Tt*b+kt*at+Dt*ft+zt*Ct,h[15]=Tt*_e+kt*ut+Dt*vt+zt*Et,h}function getScaling(h,o){var c=o[0],d=o[1],_=o[2],b=o[4],_e=o[5],it=o[6],nt=o[8],at=o[9],ut=o[10];return h[0]=Math.hypot(c,d,_),h[1]=Math.hypot(b,_e,it),h[2]=Math.hypot(nt,at,ut),h}function getRotation(h,o){var c=new ARRAY_TYPE(3);getScaling(c,o);var d=1/c[0],_=1/c[1],b=1/c[2],_e=o[0]*d,it=o[1]*_,nt=o[2]*b,at=o[4]*d,ut=o[5]*_,pt=o[6]*b,mt=o[8]*d,ft=o[9]*_,vt=o[10]*b,xt=_e+ut+vt,At=0;return xt>0?(At=2*Math.sqrt(xt+1),h[3]=.25*At,h[0]=(pt-ft)/At,h[1]=(mt-nt)/At,h[2]=(it-at)/At):_e>ut&&_e>vt?(At=2*Math.sqrt(1+_e-ut-vt),h[3]=(pt-ft)/At,h[0]=.25*At,h[1]=(it+at)/At,h[2]=(mt+nt)/At):ut>vt?(At=2*Math.sqrt(1+ut-_e-vt),h[3]=(mt-nt)/At,h[0]=(it+at)/At,h[1]=.25*At,h[2]=(pt+ft)/At):(At=2*Math.sqrt(1+vt-_e-ut),h[3]=(it-at)/At,h[0]=(mt+nt)/At,h[1]=(pt+ft)/At,h[2]=.25*At),h}_Logger=Logger,Logger.Verbosity=Verbosity,Logger.DEFAULT_INSTANCE=new _Logger(_Logger.Verbosity.INFO);class index_modern_MathUtils{static identity(o){return o}static eq(o,c,d=1e-5){if(o.length!==c.length)return!1;for(let _=0;_<o.length;_++)if(Math.abs(o[_]-c[_])>d)return!1;return!0}static clamp(o,c,d){return o<c?c:o>d?d:o}static decodeNormalizedInt(o,c){switch(c){case 5126:return o;case 5123:return o/65535;case 5121:return o/255;case 5122:return Math.max(o/32767,-1);case 5120:return Math.max(o/127,-1);default:throw new Error("Invalid component type.")}}static encodeNormalizedInt(o,c){switch(c){case 5126:return o;case 5123:return Math.round(65535*index_modern_MathUtils.clamp(o,0,1));case 5121:return Math.round(255*index_modern_MathUtils.clamp(o,0,1));case 5122:return Math.round(32767*index_modern_MathUtils.clamp(o,-1,1));case 5120:return Math.round(127*index_modern_MathUtils.clamp(o,-1,1));default:throw new Error("Invalid component type.")}}static decompose(o,c,d,_){let b=index_modern_length([o[0],o[1],o[2]]);const _e=index_modern_length([o[4],o[5],o[6]]),it=index_modern_length([o[8],o[9],o[10]]);determinant(o)<0&&(b=-b),c[0]=o[12],c[1]=o[13],c[2]=o[14];const nt=o.slice(),at=1/b,ut=1/_e,pt=1/it;nt[0]*=at,nt[1]*=at,nt[2]*=at,nt[4]*=ut,nt[5]*=ut,nt[6]*=ut,nt[8]*=pt,nt[9]*=pt,nt[10]*=pt,getRotation(d,nt),_[0]=b,_[1]=_e,_[2]=it}static compose(o,c,d,_){const b=_,_e=c[0],it=c[1],nt=c[2],at=c[3],ut=_e+_e,pt=it+it,mt=nt+nt,ft=_e*ut,vt=_e*pt,xt=_e*mt,At=it*pt,Ct=it*mt,Et=nt*mt,Tt=at*ut,kt=at*pt,Dt=at*mt,zt=d[0],Bt=d[1],Rt=d[2];return b[0]=(1-(At+Et))*zt,b[1]=(vt+Dt)*zt,b[2]=(xt-kt)*zt,b[3]=0,b[4]=(vt-Dt)*Bt,b[5]=(1-(ft+Et))*Bt,b[6]=(Ct+Tt)*Bt,b[7]=0,b[8]=(xt+kt)*Rt,b[9]=(Ct-Tt)*Rt,b[10]=(1-(ft+At))*Rt,b[11]=0,b[12]=o[0],b[13]=o[1],b[14]=o[2],b[15]=1,b}}function equalsRef(h,o){if(!!h!=!!o)return!1;const c=h.getChild(),d=o.getChild();return c===d||c.equals(d)}function equalsRefSet(h,o){if(!!h!=!!o)return!1;const c=h.values(),d=o.values();if(c.length!==d.length)return!1;for(let _=0;_<c.length;_++){const b=c[_],_e=d[_];if(b.getChild()!==_e.getChild()&&!b.getChild().equals(_e.getChild()))return!1}return!0}function equalsRefMap(h,o){if(!!h!=!!o)return!1;const c=h.keys(),d=o.keys();if(c.length!==d.length)return!1;for(const _ of c){const b=h.get(_),_e=o.get(_);if(!!b!=!!_e)return!1;const it=b.getChild(),nt=_e.getChild();if(it!==nt&&!it.equals(nt))return!1}return!0}function equalsArray(h,o){if(h===o)return!0;if(!!h!=!!o||!h||!o||h.length!==o.length)return!1;for(let c=0;c<h.length;c++)if(h[c]!==o[c])return!1;return!0}function equalsObject(h,o){if(h===o)return!0;if(!!h!=!!o)return!1;if(!isPlainObject(h)||!isPlainObject(o))return h===o;const c=h,d=o;let _,b=0,_e=0;for(_ in c)b++;for(_ in d)_e++;if(b!==_e)return!1;for(_ in c){const it=c[_],nt=d[_];if(isArray(it)&&isArray(nt)){if(!equalsArray(it,nt))return!1}else if(isPlainObject(it)&&isPlainObject(nt)){if(!equalsObject(it,nt))return!1}else if(it!==nt)return!1}return!0}function isArray(h){return Array.isArray(h)||ArrayBuffer.isView(h)}const ALPHABET="23456789abdegjkmnpqrvwxyzABDEGJKMNPQRVWXYZ",UNIQUE_RETRIES=999,ID_LENGTH=6,previousIDs=new Set,generateOne=function(){let h="";for(let o=0;o<ID_LENGTH;o++)h+=ALPHABET.charAt(Math.floor(Math.random()*ALPHABET.length));return h},index_modern_uuid=function(){for(let h=0;h<UNIQUE_RETRIES;h++){const o=generateOne();if(!previousIDs.has(o))return previousIDs.add(o),o}return""},NULL_DOMAIN="https://null.example";class HTTPUtils{static dirname(o){const c=o.lastIndexOf("/");return c===-1?"./":o.substring(0,c+1)}static basename(o){return index_modern_FileUtils.basename(new URL(o,NULL_DOMAIN).pathname)}static extension(o){return index_modern_FileUtils.extension(new URL(o,NULL_DOMAIN).pathname)}static resolve(o,c){if(!this.isRelativePath(c))return c;const d=o.split("/"),_=c.split("/");d.pop();for(let b=0;b<_.length;b++)_[b]!=="."&&(_[b]===".."?d.pop():d.push(_[b]));return d.join("/")}static isAbsoluteURL(o){return this.PROTOCOL_REGEXP.test(o)}static isRelativePath(o){return!/^(?:[a-zA-Z]+:)?\//.test(o)}}HTTPUtils.DEFAULT_INIT={},HTTPUtils.PROTOCOL_REGEXP=/^[a-zA-Z]+:\/\//;const COPY_IDENTITY=h=>h,EMPTY_SET=new Set;class Property extends GraphNode{constructor(o,c=""){super(o),this[$attributes].name=c,this.init(),this.dispatchEvent({type:"create"})}getGraph(){return this.graph}getDefaults(){return Object.assign(super.getDefaults(),{name:"",extras:{}})}set(o,c){return Array.isArray(c)&&(c=c.slice()),super.set(o,c)}getName(){return this.get("name")}setName(o){return this.set("name",o)}getExtras(){return this.get("extras")}setExtras(o){return this.set("extras",o)}clone(){return new this.constructor(this.graph).copy(this,COPY_IDENTITY)}copy(o,c=COPY_IDENTITY){for(const d in this[$attributes]){const _=this[$attributes][d];if(_ instanceof GraphEdge)this[$immutableKeys].has(d)||_.dispose();else if(_ instanceof RefList||_ instanceof RefSet)for(const b of _.values())b.dispose();else if(_ instanceof RefMap)for(const b of _.values())b.dispose()}for(const d in o[$attributes]){const _=this[$attributes][d],b=o[$attributes][d];if(b instanceof GraphEdge)this[$immutableKeys].has(d)?_.getChild().copy(c(b.getChild()),c):this.setRef(d,c(b.getChild()),b.getAttributes());else if(b instanceof RefSet||b instanceof RefList)for(const _e of b.values())this.addRef(d,c(_e.getChild()),_e.getAttributes());else if(b instanceof RefMap)for(const _e of b.keys()){const it=b.get(_e);this.setRefMap(d,_e,c(it.getChild()),it.getAttributes())}else isPlainObject(b)?this[$attributes][d]=JSON.parse(JSON.stringify(b)):Array.isArray(b)||b instanceof ArrayBuffer||ArrayBuffer.isView(b)?this[$attributes][d]=b.slice():this[$attributes][d]=b}return this}equals(o,c=EMPTY_SET){if(this===o)return!0;if(this.propertyType!==o.propertyType)return!1;for(const d in this[$attributes]){if(c.has(d))continue;const _=this[$attributes][d],b=o[$attributes][d];if(_ instanceof GraphEdge||b instanceof GraphEdge){if(!equalsRef(_,b))return!1}else if(_ instanceof RefSet||b instanceof RefSet||_ instanceof RefList||b instanceof RefList){if(!equalsRefSet(_,b))return!1}else if(_ instanceof RefMap||b instanceof RefMap){if(!equalsRefMap(_,b))return!1}else if(isPlainObject(_)||isPlainObject(b)){if(!equalsObject(_,b))return!1}else if(isArray(_)||isArray(b)){if(!equalsArray(_,b))return!1}else if(_!==b)return!1}return!0}detach(){return this.graph.disconnectParents(this,o=>o.propertyType!=="Root"),this}listParents(){return this.graph.listParents(this)}}class ExtensibleProperty extends Property{getDefaults(){return Object.assign(super.getDefaults(),{extensions:new RefMap})}getExtension(o){return this.getRefMap("extensions",o)}setExtension(o,c){return c&&c._validateParent(this),this.setRefMap("extensions",o,c)}listExtensions(){return this.listRefMapValues("extensions")}}class index_modern_Accessor extends ExtensibleProperty{init(){this.propertyType=index_modern_PropertyType.ACCESSOR}getDefaults(){return Object.assign(super.getDefaults(),{array:null,type:index_modern_Accessor.Type.SCALAR,componentType:index_modern_Accessor.ComponentType.FLOAT,normalized:!1,sparse:!1,buffer:null})}static getElementSize(o){switch(o){case index_modern_Accessor.Type.SCALAR:return 1;case index_modern_Accessor.Type.VEC2:return 2;case index_modern_Accessor.Type.VEC3:return 3;case index_modern_Accessor.Type.VEC4:case index_modern_Accessor.Type.MAT2:return 4;case index_modern_Accessor.Type.MAT3:return 9;case index_modern_Accessor.Type.MAT4:return 16;default:throw new Error("Unexpected type: "+o)}}static getComponentSize(o){switch(o){case index_modern_Accessor.ComponentType.BYTE:case index_modern_Accessor.ComponentType.UNSIGNED_BYTE:return 1;case index_modern_Accessor.ComponentType.SHORT:case index_modern_Accessor.ComponentType.UNSIGNED_SHORT:return 2;case index_modern_Accessor.ComponentType.UNSIGNED_INT:case index_modern_Accessor.ComponentType.FLOAT:return 4;default:throw new Error("Unexpected component type: "+o)}}getMinNormalized(o){const c=this.getNormalized(),d=this.getElementSize(),_=this.getComponentType();if(this.getMin(o),c)for(let b=0;b<d;b++)o[b]=index_modern_MathUtils.decodeNormalizedInt(o[b],_);return o}getMin(o){const c=this.getArray(),d=this.getCount(),_=this.getElementSize();for(let b=0;b<_;b++)o[b]=1/0;for(let b=0;b<d*_;b+=_)for(let _e=0;_e<_;_e++){const it=c[b+_e];Number.isFinite(it)&&(o[_e]=Math.min(o[_e],it))}return o}getMaxNormalized(o){const c=this.getNormalized(),d=this.getElementSize(),_=this.getComponentType();if(this.getMax(o),c)for(let b=0;b<d;b++)o[b]=index_modern_MathUtils.decodeNormalizedInt(o[b],_);return o}getMax(o){const c=this.get("array"),d=this.getCount(),_=this.getElementSize();for(let b=0;b<_;b++)o[b]=-1/0;for(let b=0;b<d*_;b+=_)for(let _e=0;_e<_;_e++){const it=c[b+_e];Number.isFinite(it)&&(o[_e]=Math.max(o[_e],it))}return o}getCount(){const o=this.get("array");return o?o.length/this.getElementSize():0}getType(){return this.get("type")}setType(o){return this.set("type",o)}getElementSize(){return index_modern_Accessor.getElementSize(this.get("type"))}getComponentSize(){return this.get("array").BYTES_PER_ELEMENT}getComponentType(){return this.get("componentType")}getNormalized(){return this.get("normalized")}setNormalized(o){return this.set("normalized",o)}getScalar(o){const c=this.getElementSize(),d=this.getComponentType(),_=this.getArray();return this.getNormalized()?index_modern_MathUtils.decodeNormalizedInt(_[o*c],d):_[o*c]}setScalar(o,c){const d=this.getElementSize(),_=this.getComponentType(),b=this.getArray();return this.getNormalized()?b[o*d]=index_modern_MathUtils.encodeNormalizedInt(c,_):b[o*d]=c,this}getElement(o,c){const d=this.getNormalized(),_=this.getElementSize(),b=this.getComponentType(),_e=this.getArray();for(let it=0;it<_;it++)c[it]=d?index_modern_MathUtils.decodeNormalizedInt(_e[o*_+it],b):_e[o*_+it];return c}setElement(o,c){const d=this.getNormalized(),_=this.getElementSize(),b=this.getComponentType(),_e=this.getArray();for(let it=0;it<_;it++)_e[o*_+it]=d?index_modern_MathUtils.encodeNormalizedInt(c[it],b):c[it];return this}getSparse(){return this.get("sparse")}setSparse(o){return this.set("sparse",o)}getBuffer(){return this.getRef("buffer")}setBuffer(o){return this.setRef("buffer",o)}getArray(){return this.get("array")}setArray(o){return this.set("componentType",o?arrayToComponentType(o):index_modern_Accessor.ComponentType.FLOAT),this.set("array",o),this}getByteLength(){const o=this.get("array");return o?o.byteLength:0}}function arrayToComponentType(h){switch(h.constructor){case Float32Array:return index_modern_Accessor.ComponentType.FLOAT;case Uint32Array:return index_modern_Accessor.ComponentType.UNSIGNED_INT;case Uint16Array:return index_modern_Accessor.ComponentType.UNSIGNED_SHORT;case Uint8Array:return index_modern_Accessor.ComponentType.UNSIGNED_BYTE;case Int16Array:return index_modern_Accessor.ComponentType.SHORT;case Int8Array:return index_modern_Accessor.ComponentType.BYTE;default:throw new Error("Unknown accessor componentType.")}}index_modern_Accessor.Type={SCALAR:"SCALAR",VEC2:"VEC2",VEC3:"VEC3",VEC4:"VEC4",MAT2:"MAT2",MAT3:"MAT3",MAT4:"MAT4"},index_modern_Accessor.ComponentType={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,UNSIGNED_INT:5125,FLOAT:5126};class Animation extends ExtensibleProperty{init(){this.propertyType=index_modern_PropertyType.ANIMATION}getDefaults(){return Object.assign(super.getDefaults(),{channels:new RefSet,samplers:new RefSet})}addChannel(o){return this.addRef("channels",o)}removeChannel(o){return this.removeRef("channels",o)}listChannels(){return this.listRefs("channels")}addSampler(o){return this.addRef("samplers",o)}removeSampler(o){return this.removeRef("samplers",o)}listSamplers(){return this.listRefs("samplers")}}class index_modern_AnimationChannel extends ExtensibleProperty{init(){this.propertyType=index_modern_PropertyType.ANIMATION_CHANNEL}getDefaults(){return Object.assign(super.getDefaults(),{targetPath:null,targetNode:null,sampler:null})}getTargetPath(){return this.get("targetPath")}setTargetPath(o){return this.set("targetPath",o)}getTargetNode(){return this.getRef("targetNode")}setTargetNode(o){return this.setRef("targetNode",o)}getSampler(){return this.getRef("sampler")}setSampler(o){return this.setRef("sampler",o)}}index_modern_AnimationChannel.TargetPath={TRANSLATION:"translation",ROTATION:"rotation",SCALE:"scale",WEIGHTS:"weights"};class index_modern_AnimationSampler extends ExtensibleProperty{init(){this.propertyType=index_modern_PropertyType.ANIMATION_SAMPLER}getDefaultAttributes(){return Object.assign(super.getDefaults(),{interpolation:index_modern_AnimationSampler.Interpolation.LINEAR,input:null,output:null})}getInterpolation(){return this.get("interpolation")}setInterpolation(o){return this.set("interpolation",o)}getInput(){return this.getRef("input")}setInput(o){return this.setRef("input",o,{usage:BufferViewUsage$1.OTHER})}getOutput(){return this.getRef("output")}setOutput(o){return this.setRef("output",o,{usage:BufferViewUsage$1.OTHER})}}index_modern_AnimationSampler.Interpolation={LINEAR:"LINEAR",STEP:"STEP",CUBICSPLINE:"CUBICSPLINE"};class Buffer$1 extends ExtensibleProperty{init(){this.propertyType=index_modern_PropertyType.BUFFER}getDefaults(){return Object.assign(super.getDefaults(),{uri:""})}getURI(){return this.get("uri")}setURI(o){return this.set("uri",o)}}class Camera extends ExtensibleProperty{init(){this.propertyType=index_modern_PropertyType.CAMERA}getDefaults(){return Object.assign(super.getDefaults(),{type:Camera.Type.PERSPECTIVE,znear:.1,zfar:100,aspectRatio:null,yfov:2*Math.PI*50/360,xmag:1,ymag:1})}getType(){return this.get("type")}setType(o){return this.set("type",o)}getZNear(){return this.get("znear")}setZNear(o){return this.set("znear",o)}getZFar(){return this.get("zfar")}setZFar(o){return this.set("zfar",o)}getAspectRatio(){return this.get("aspectRatio")}setAspectRatio(o){return this.set("aspectRatio",o)}getYFov(){return this.get("yfov")}setYFov(o){return this.set("yfov",o)}getXMag(){return this.get("xmag")}setXMag(o){return this.set("xmag",o)}getYMag(){return this.get("ymag")}setYMag(o){return this.set("ymag",o)}}Camera.Type={PERSPECTIVE:"perspective",ORTHOGRAPHIC:"orthographic"};class index_modern_ExtensionProperty extends Property{_validateParent(o){if(!this.parentTypes.includes(o.propertyType))throw new Error(`Parent "${o.propertyType}" invalid for child "${this.propertyType}".`)}}index_modern_ExtensionProperty.EXTENSION_NAME=void 0;class index_modern_TextureInfo extends ExtensibleProperty{init(){this.propertyType=index_modern_PropertyType.TEXTURE_INFO}getDefaults(){return Object.assign(super.getDefaults(),{texCoord:0,magFilter:null,minFilter:null,wrapS:index_modern_TextureInfo.WrapMode.REPEAT,wrapT:index_modern_TextureInfo.WrapMode.REPEAT})}getTexCoord(){return this.get("texCoord")}setTexCoord(o){return this.set("texCoord",o)}getMagFilter(){return this.get("magFilter")}setMagFilter(o){return this.set("magFilter",o)}getMinFilter(){return this.get("minFilter")}setMinFilter(o){return this.set("minFilter",o)}getWrapS(){return this.get("wrapS")}setWrapS(o){return this.set("wrapS",o)}getWrapT(){return this.get("wrapT")}setWrapT(o){return this.set("wrapT",o)}}index_modern_TextureInfo.WrapMode={CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,REPEAT:10497},index_modern_TextureInfo.MagFilter={NEAREST:9728,LINEAR:9729},index_modern_TextureInfo.MinFilter={NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987};const{R:index_modern_R,G:index_modern_G,B:index_modern_B,A:index_modern_A}=index_modern_TextureChannel;class index_modern_Material extends ExtensibleProperty{init(){this.propertyType=index_modern_PropertyType.MATERIAL}getDefaults(){return Object.assign(super.getDefaults(),{alphaMode:index_modern_Material.AlphaMode.OPAQUE,alphaCutoff:.5,doubleSided:!1,baseColorFactor:[1,1,1,1],baseColorTexture:null,baseColorTextureInfo:new index_modern_TextureInfo(this.graph,"baseColorTextureInfo"),emissiveFactor:[0,0,0],emissiveTexture:null,emissiveTextureInfo:new index_modern_TextureInfo(this.graph,"emissiveTextureInfo"),normalScale:1,normalTexture:null,normalTextureInfo:new index_modern_TextureInfo(this.graph,"normalTextureInfo"),occlusionStrength:1,occlusionTexture:null,occlusionTextureInfo:new index_modern_TextureInfo(this.graph,"occlusionTextureInfo"),roughnessFactor:1,metallicFactor:1,metallicRoughnessTexture:null,metallicRoughnessTextureInfo:new index_modern_TextureInfo(this.graph,"metallicRoughnessTextureInfo")})}getDoubleSided(){return this.get("doubleSided")}setDoubleSided(o){return this.set("doubleSided",o)}getAlpha(){return this.get("baseColorFactor")[3]}setAlpha(o){const c=this.get("baseColorFactor").slice();return c[3]=o,this.set("baseColorFactor",c)}getAlphaMode(){return this.get("alphaMode")}setAlphaMode(o){return this.set("alphaMode",o)}getAlphaCutoff(){return this.get("alphaCutoff")}setAlphaCutoff(o){return this.set("alphaCutoff",o)}getBaseColorFactor(){return this.get("baseColorFactor")}setBaseColorFactor(o){return this.set("baseColorFactor",o)}getBaseColorTexture(){return this.getRef("baseColorTexture")}getBaseColorTextureInfo(){return this.getRef("baseColorTexture")?this.getRef("baseColorTextureInfo"):null}setBaseColorTexture(o){return this.setRef("baseColorTexture",o,{channels:index_modern_R|index_modern_G|index_modern_B|index_modern_A,isColor:!0})}getEmissiveFactor(){return this.get("emissiveFactor")}setEmissiveFactor(o){return this.set("emissiveFactor",o)}getEmissiveTexture(){return this.getRef("emissiveTexture")}getEmissiveTextureInfo(){return this.getRef("emissiveTexture")?this.getRef("emissiveTextureInfo"):null}setEmissiveTexture(o){return this.setRef("emissiveTexture",o,{channels:index_modern_R|index_modern_G|index_modern_B,isColor:!0})}getNormalScale(){return this.get("normalScale")}setNormalScale(o){return this.set("normalScale",o)}getNormalTexture(){return this.getRef("normalTexture")}getNormalTextureInfo(){return this.getRef("normalTexture")?this.getRef("normalTextureInfo"):null}setNormalTexture(o){return this.setRef("normalTexture",o,{channels:index_modern_R|index_modern_G|index_modern_B})}getOcclusionStrength(){return this.get("occlusionStrength")}setOcclusionStrength(o){return this.set("occlusionStrength",o)}getOcclusionTexture(){return this.getRef("occlusionTexture")}getOcclusionTextureInfo(){return this.getRef("occlusionTexture")?this.getRef("occlusionTextureInfo"):null}setOcclusionTexture(o){return this.setRef("occlusionTexture",o,{channels:index_modern_R})}getRoughnessFactor(){return this.get("roughnessFactor")}setRoughnessFactor(o){return this.set("roughnessFactor",o)}getMetallicFactor(){return this.get("metallicFactor")}setMetallicFactor(o){return this.set("metallicFactor",o)}getMetallicRoughnessTexture(){return this.getRef("metallicRoughnessTexture")}getMetallicRoughnessTextureInfo(){return this.getRef("metallicRoughnessTexture")?this.getRef("metallicRoughnessTextureInfo"):null}setMetallicRoughnessTexture(o){return this.setRef("metallicRoughnessTexture",o,{channels:index_modern_G|index_modern_B})}}index_modern_Material.AlphaMode={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};class index_modern_Mesh extends ExtensibleProperty{init(){this.propertyType=index_modern_PropertyType.MESH}getDefaults(){return Object.assign(super.getDefaults(),{weights:[],primitives:new RefSet})}addPrimitive(o){return this.addRef("primitives",o)}removePrimitive(o){return this.removeRef("primitives",o)}listPrimitives(){return this.listRefs("primitives")}getWeights(){return this.get("weights")}setWeights(o){return this.set("weights",o)}}class index_modern_Node extends ExtensibleProperty{init(){this.propertyType=index_modern_PropertyType.NODE}getDefaults(){return Object.assign(super.getDefaults(),{translation:[0,0,0],rotation:[0,0,0,1],scale:[1,1,1],weights:[],camera:null,mesh:null,skin:null,children:new RefSet})}copy(o,c=COPY_IDENTITY){if(c===COPY_IDENTITY)throw new Error("Node cannot be copied.");return super.copy(o,c)}getTranslation(){return this.get("translation")}getRotation(){return this.get("rotation")}getScale(){return this.get("scale")}setTranslation(o){return this.set("translation",o)}setRotation(o){return this.set("rotation",o)}setScale(o){return this.set("scale",o)}getMatrix(){return index_modern_MathUtils.compose(this.get("translation"),this.get("rotation"),this.get("scale"),[])}setMatrix(o){const c=this.get("translation").slice(),d=this.get("rotation").slice(),_=this.get("scale").slice();return index_modern_MathUtils.decompose(o,c,d,_),this.set("translation",c).set("rotation",d).set("scale",_)}getWorldTranslation(){const o=[0,0,0];return index_modern_MathUtils.decompose(this.getWorldMatrix(),o,[0,0,0,1],[1,1,1]),o}getWorldRotation(){const o=[0,0,0,1];return index_modern_MathUtils.decompose(this.getWorldMatrix(),[0,0,0],o,[1,1,1]),o}getWorldScale(){const o=[1,1,1];return index_modern_MathUtils.decompose(this.getWorldMatrix(),[0,0,0],[0,0,0,1],o),o}getWorldMatrix(){const o=[];for(let _=this;_!=null;_=_.getParentNode())o.push(_);let c;const d=o.pop().getMatrix();for(;c=o.pop();)multiply(d,d,c.getMatrix());return d}addChild(o){const c=o.getParentNode();c&&c.removeChild(o);for(const d of o.listParents())d.propertyType===index_modern_PropertyType.SCENE&&d.removeChild(o);return this.addRef("children",o)}removeChild(o){return this.removeRef("children",o)}listChildren(){return this.listRefs("children")}getParentNode(){for(const o of this.listParents())if(o.propertyType===index_modern_PropertyType.NODE)return o;return null}getMesh(){return this.getRef("mesh")}setMesh(o){return this.setRef("mesh",o)}getCamera(){return this.getRef("camera")}setCamera(o){return this.setRef("camera",o)}getSkin(){return this.getRef("skin")}setSkin(o){return this.setRef("skin",o)}getWeights(){return this.get("weights")}setWeights(o){return this.set("weights",o)}traverse(o){o(this);for(const c of this.listChildren())c.traverse(o);return this}}class index_modern_Primitive extends ExtensibleProperty{init(){this.propertyType=index_modern_PropertyType.PRIMITIVE}getDefaults(){return Object.assign(super.getDefaults(),{mode:index_modern_Primitive.Mode.TRIANGLES,material:null,indices:null,attributes:new RefMap,targets:new RefSet})}getIndices(){return this.getRef("indices")}setIndices(o){return this.setRef("indices",o,{usage:BufferViewUsage$1.ELEMENT_ARRAY_BUFFER})}getAttribute(o){return this.getRefMap("attributes",o)}setAttribute(o,c){return this.setRefMap("attributes",o,c,{usage:BufferViewUsage$1.ARRAY_BUFFER})}listAttributes(){return this.listRefMapValues("attributes")}listSemantics(){return this.listRefMapKeys("attributes")}getMaterial(){return this.getRef("material")}setMaterial(o){return this.setRef("material",o)}getMode(){return this.get("mode")}setMode(o){return this.set("mode",o)}listTargets(){return this.listRefs("targets")}addTarget(o){return this.addRef("targets",o)}removeTarget(o){return this.removeRef("targets",o)}}index_modern_Primitive.Mode={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6};class index_modern_PrimitiveTarget extends Property{init(){this.propertyType=index_modern_PropertyType.PRIMITIVE_TARGET}getDefaults(){return Object.assign(super.getDefaults(),{attributes:new RefMap})}getAttribute(o){return this.getRefMap("attributes",o)}setAttribute(o,c){return this.setRefMap("attributes",o,c,{usage:BufferViewUsage$1.ARRAY_BUFFER})}listAttributes(){return this.listRefMapValues("attributes")}listSemantics(){return this.listRefMapKeys("attributes")}}function index_modern_extends(){return index_modern_extends=Object.assign?Object.assign.bind():function(h){for(var o=1;o<arguments.length;o++){var c=arguments[o];for(var d in c)({}).hasOwnProperty.call(c,d)&&(h[d]=c[d])}return h},index_modern_extends.apply(null,arguments)}class index_modern_Scene extends ExtensibleProperty{init(){this.propertyType=index_modern_PropertyType.SCENE}getDefaults(){return Object.assign(super.getDefaults(),{children:new RefSet})}copy(o,c=COPY_IDENTITY){if(c===COPY_IDENTITY)throw new Error("Scene cannot be copied.");return super.copy(o,c)}addChild(o){const c=o.getParentNode();return c&&c.removeChild(o),this.addRef("children",o)}removeChild(o){return this.removeRef("children",o)}listChildren(){return this.listRefs("children")}traverse(o){for(const c of this.listChildren())c.traverse(o);return this}}class Skin extends ExtensibleProperty{init(){this.propertyType=index_modern_PropertyType.SKIN}getDefaults(){return Object.assign(super.getDefaults(),{skeleton:null,inverseBindMatrices:null,joints:new RefSet})}getSkeleton(){return this.getRef("skeleton")}setSkeleton(o){return this.setRef("skeleton",o)}getInverseBindMatrices(){return this.getRef("inverseBindMatrices")}setInverseBindMatrices(o){return this.setRef("inverseBindMatrices",o,{usage:BufferViewUsage$1.INVERSE_BIND_MATRICES})}addJoint(o){return this.addRef("joints",o)}removeJoint(o){return this.removeRef("joints",o)}listJoints(){return this.listRefs("joints")}}class index_modern_Texture extends ExtensibleProperty{init(){this.propertyType=index_modern_PropertyType.TEXTURE}getDefaults(){return Object.assign(super.getDefaults(),{image:null,mimeType:"",uri:""})}getMimeType(){return this.get("mimeType")||index_modern_ImageUtils.extensionToMimeType(index_modern_FileUtils.extension(this.get("uri")))}setMimeType(o){return this.set("mimeType",o)}getURI(){return this.get("uri")}setURI(o){this.set("uri",o);const c=index_modern_ImageUtils.extensionToMimeType(index_modern_FileUtils.extension(o));return c&&this.set("mimeType",c),this}getImage(){return this.get("image")}setImage(o){return this.set("image",index_modern_BufferUtils.assertView(o))}getSize(){const o=this.get("image");return o?index_modern_ImageUtils.getSize(o,this.getMimeType()):null}}class index_modern_Root extends ExtensibleProperty{init(){this.propertyType=index_modern_PropertyType.ROOT}getDefaults(){return Object.assign(super.getDefaults(),{asset:{generator:`glTF-Transform ${VERSION}`,version:"2.0"},defaultScene:null,accessors:new RefSet,animations:new RefSet,buffers:new RefSet,cameras:new RefSet,materials:new RefSet,meshes:new RefSet,nodes:new RefSet,scenes:new RefSet,skins:new RefSet,textures:new RefSet})}constructor(o){super(o),this._extensions=new Set,o.addEventListener("node:create",c=>{this._addChildOfRoot(c.target)})}clone(){throw new Error("Root cannot be cloned.")}copy(o,c=COPY_IDENTITY){if(c===COPY_IDENTITY)throw new Error("Root cannot be copied.");this.set("asset",index_modern_extends({},o.get("asset"))),this.setName(o.getName()),this.setExtras(index_modern_extends({},o.getExtras())),this.setDefaultScene(o.getDefaultScene()?c(o.getDefaultScene()):null);for(const d of o.listRefMapKeys("extensions")){const _=o.getExtension(d);this.setExtension(d,c(_))}return this}_addChildOfRoot(o){return o instanceof index_modern_Scene?this.addRef("scenes",o):o instanceof index_modern_Node?this.addRef("nodes",o):o instanceof Camera?this.addRef("cameras",o):o instanceof Skin?this.addRef("skins",o):o instanceof index_modern_Mesh?this.addRef("meshes",o):o instanceof index_modern_Material?this.addRef("materials",o):o instanceof index_modern_Texture?this.addRef("textures",o):o instanceof Animation?this.addRef("animations",o):o instanceof index_modern_Accessor?this.addRef("accessors",o):o instanceof Buffer$1&&this.addRef("buffers",o),this}getAsset(){return this.get("asset")}listExtensionsUsed(){return Array.from(this._extensions)}listExtensionsRequired(){return this.listExtensionsUsed().filter(o=>o.isRequired())}_enableExtension(o){return this._extensions.add(o),this}_disableExtension(o){return this._extensions.delete(o),this}listScenes(){return this.listRefs("scenes")}setDefaultScene(o){return this.setRef("defaultScene",o)}getDefaultScene(){return this.getRef("defaultScene")}listNodes(){return this.listRefs("nodes")}listCameras(){return this.listRefs("cameras")}listSkins(){return this.listRefs("skins")}listMeshes(){return this.listRefs("meshes")}listMaterials(){return this.listRefs("materials")}listTextures(){return this.listRefs("textures")}listAnimations(){return this.listRefs("animations")}listAccessors(){return this.listRefs("accessors")}listBuffers(){return this.listRefs("buffers")}}class index_modern_Document{static fromGraph(o){return index_modern_Document._GRAPH_DOCUMENTS.get(o)||null}constructor(){this._graph=new Graph,this._root=new index_modern_Root(this._graph),this._logger=Logger.DEFAULT_INSTANCE,index_modern_Document._GRAPH_DOCUMENTS.set(this._graph,this)}getRoot(){return this._root}getGraph(){return this._graph}getLogger(){return this._logger}setLogger(o){return this._logger=o,this}clone(){throw new Error("Use 'cloneDocument(source)' from '@gltf-transform/functions'.")}merge(o){throw new Error("Use 'mergeDocuments(target, source)' from '@gltf-transform/functions'.")}async transform(...o){const c=o.map(d=>d.name);for(const d of o)await d(this,{stack:c});return this}createExtension(o){const c=o.EXTENSION_NAME;return this.getRoot().listExtensionsUsed().find(d=>d.extensionName===c)||new o(this)}createScene(o=""){return new index_modern_Scene(this._graph,o)}createNode(o=""){return new index_modern_Node(this._graph,o)}createCamera(o=""){return new Camera(this._graph,o)}createSkin(o=""){return new Skin(this._graph,o)}createMesh(o=""){return new index_modern_Mesh(this._graph,o)}createPrimitive(){return new index_modern_Primitive(this._graph)}createPrimitiveTarget(o=""){return new index_modern_PrimitiveTarget(this._graph,o)}createMaterial(o=""){return new index_modern_Material(this._graph,o)}createTexture(o=""){return new index_modern_Texture(this._graph,o)}createAnimation(o=""){return new Animation(this._graph,o)}createAnimationChannel(o=""){return new index_modern_AnimationChannel(this._graph,o)}createAnimationSampler(o=""){return new index_modern_AnimationSampler(this._graph,o)}createAccessor(o="",c=null){return c||(c=this.getRoot().listBuffers()[0]),new index_modern_Accessor(this._graph,o).setBuffer(c)}createBuffer(o=""){return new Buffer$1(this._graph,o)}}index_modern_Document._GRAPH_DOCUMENTS=new WeakMap;class Extension{constructor(o){this.extensionName="",this.prereadTypes=[],this.prewriteTypes=[],this.readDependencies=[],this.writeDependencies=[],this.document=void 0,this.required=!1,this.properties=new Set,this._listener=void 0,this.document=o,o.getRoot()._enableExtension(this),this._listener=d=>{const _=d,b=_.target;b instanceof index_modern_ExtensionProperty&&b.extensionName===this.extensionName&&(_.type==="node:create"&&this._addExtensionProperty(b),_.type==="node:dispose"&&this._removeExtensionProperty(b))};const c=o.getGraph();c.addEventListener("node:create",this._listener),c.addEventListener("node:dispose",this._listener)}dispose(){this.document.getRoot()._disableExtension(this);const o=this.document.getGraph();o.removeEventListener("node:create",this._listener),o.removeEventListener("node:dispose",this._listener);for(const c of this.properties)c.dispose()}static register(){}isRequired(){return this.required}setRequired(o){return this.required=o,this}listProperties(){return Array.from(this.properties)}_addExtensionProperty(o){return this.properties.add(o),this}_removeExtensionProperty(o){return this.properties.delete(o),this}install(o,c){return this}preread(o,c){return this}prewrite(o,c){return this}}Extension.EXTENSION_NAME=void 0;class ReaderContext{constructor(o){this.jsonDoc=void 0,this.buffers=[],this.bufferViews=[],this.bufferViewBuffers=[],this.accessors=[],this.textures=[],this.textureInfos=new Map,this.materials=[],this.meshes=[],this.cameras=[],this.nodes=[],this.skins=[],this.animations=[],this.scenes=[],this.jsonDoc=o}setTextureInfo(o,c){this.textureInfos.set(o,c),c.texCoord!==void 0&&o.setTexCoord(c.texCoord),c.extras!==void 0&&o.setExtras(c.extras);const d=this.jsonDoc.json.textures[c.index];if(d.sampler===void 0)return;const _=this.jsonDoc.json.samplers[d.sampler];_.magFilter!==void 0&&o.setMagFilter(_.magFilter),_.minFilter!==void 0&&o.setMinFilter(_.minFilter),_.wrapS!==void 0&&o.setWrapS(_.wrapS),_.wrapT!==void 0&&o.setWrapT(_.wrapT)}}const index_modern_DEFAULT_OPTIONS={logger:Logger.DEFAULT_INSTANCE,extensions:[],dependencies:{}},SUPPORTED_PREREAD_TYPES=new Set([index_modern_PropertyType.BUFFER,index_modern_PropertyType.TEXTURE,index_modern_PropertyType.MATERIAL,index_modern_PropertyType.MESH,index_modern_PropertyType.PRIMITIVE,index_modern_PropertyType.NODE,index_modern_PropertyType.SCENE]);class GLTFReader{static read(o,c=index_modern_DEFAULT_OPTIONS){const d=index_modern_extends({},index_modern_DEFAULT_OPTIONS,c),{json:_}=o,b=new index_modern_Document().setLogger(d.logger);this.validate(o,d);const _e=new ReaderContext(o),it=_.asset,nt=b.getRoot().getAsset();it.copyright&&(nt.copyright=it.copyright),it.extras&&(nt.extras=it.extras),_.extras!==void 0&&b.getRoot().setExtras(index_modern_extends({},_.extras));const at=_.extensionsUsed||[],ut=_.extensionsRequired||[];d.extensions.sort((Bt,Rt)=>Bt.EXTENSION_NAME>Rt.EXTENSION_NAME?1:-1);for(const Bt of d.extensions)if(at.includes(Bt.EXTENSION_NAME)){const Rt=b.createExtension(Bt).setRequired(ut.includes(Bt.EXTENSION_NAME)),Ut=Rt.prereadTypes.filter(Ht=>!SUPPORTED_PREREAD_TYPES.has(Ht));Ut.length&&d.logger.warn(`Preread hooks for some types (${Ut.join()}), requested by extension ${Rt.extensionName}, are unsupported. Please file an issue or a PR.`);for(const Ht of Rt.readDependencies)Rt.install(Ht,d.dependencies[Ht])}const pt=_.buffers||[];b.getRoot().listExtensionsUsed().filter(Bt=>Bt.prereadTypes.includes(index_modern_PropertyType.BUFFER)).forEach(Bt=>Bt.preread(_e,index_modern_PropertyType.BUFFER)),_e.buffers=pt.map(Bt=>{const Rt=b.createBuffer(Bt.name);return Bt.extras&&Rt.setExtras(Bt.extras),Bt.uri&&Bt.uri.indexOf("__")!==0&&Rt.setURI(Bt.uri),Rt});const mt=_.bufferViews||[];_e.bufferViewBuffers=mt.map((Bt,Rt)=>{if(!_e.bufferViews[Rt]){const Ut=o.json.buffers[Bt.buffer],Ht=Ut.uri?o.resources[Ut.uri]:o.resources[GLB_BUFFER],Jt=Bt.byteOffset||0;_e.bufferViews[Rt]=index_modern_BufferUtils.toView(Ht,Jt,Bt.byteLength)}return _e.buffers[Bt.buffer]});const ft=_.accessors||[];_e.accessors=ft.map(Bt=>{const Rt=_e.bufferViewBuffers[Bt.bufferView],Ut=b.createAccessor(Bt.name,Rt).setType(Bt.type);return Bt.extras&&Ut.setExtras(Bt.extras),Bt.normalized!==void 0&&Ut.setNormalized(Bt.normalized),Bt.bufferView===void 0||Ut.setArray(getAccessorArray(Bt,_e)),Ut});const vt=_.images||[],xt=_.textures||[];b.getRoot().listExtensionsUsed().filter(Bt=>Bt.prereadTypes.includes(index_modern_PropertyType.TEXTURE)).forEach(Bt=>Bt.preread(_e,index_modern_PropertyType.TEXTURE)),_e.textures=vt.map(Bt=>{const Rt=b.createTexture(Bt.name);if(Bt.extras&&Rt.setExtras(Bt.extras),Bt.bufferView!==void 0){const Ut=_.bufferViews[Bt.bufferView],Ht=o.json.buffers[Ut.buffer],Jt=Ht.uri?o.resources[Ht.uri]:o.resources[GLB_BUFFER],Kt=Ut.byteOffset||0,sr=Ut.byteLength,ir=Jt.slice(Kt,Kt+sr);Rt.setImage(ir)}else Bt.uri!==void 0&&(Rt.setImage(o.resources[Bt.uri]),Bt.uri.indexOf("__")!==0&&Rt.setURI(Bt.uri));if(Bt.mimeType!==void 0)Rt.setMimeType(Bt.mimeType);else if(Bt.uri){const Ut=index_modern_FileUtils.extension(Bt.uri);Rt.setMimeType(index_modern_ImageUtils.extensionToMimeType(Ut))}return Rt}),b.getRoot().listExtensionsUsed().filter(Bt=>Bt.prereadTypes.includes(index_modern_PropertyType.MATERIAL)).forEach(Bt=>Bt.preread(_e,index_modern_PropertyType.MATERIAL));const At=_.materials||[];_e.materials=At.map(Bt=>{const Rt=b.createMaterial(Bt.name);Bt.extras&&Rt.setExtras(Bt.extras),Bt.alphaMode!==void 0&&Rt.setAlphaMode(Bt.alphaMode),Bt.alphaCutoff!==void 0&&Rt.setAlphaCutoff(Bt.alphaCutoff),Bt.doubleSided!==void 0&&Rt.setDoubleSided(Bt.doubleSided);const Ut=Bt.pbrMetallicRoughness||{};if(Ut.baseColorFactor!==void 0&&Rt.setBaseColorFactor(Ut.baseColorFactor),Bt.emissiveFactor!==void 0&&Rt.setEmissiveFactor(Bt.emissiveFactor),Ut.metallicFactor!==void 0&&Rt.setMetallicFactor(Ut.metallicFactor),Ut.roughnessFactor!==void 0&&Rt.setRoughnessFactor(Ut.roughnessFactor),Ut.baseColorTexture!==void 0){const Ht=Ut.baseColorTexture,Jt=_e.textures[xt[Ht.index].source];Rt.setBaseColorTexture(Jt),_e.setTextureInfo(Rt.getBaseColorTextureInfo(),Ht)}if(Bt.emissiveTexture!==void 0){const Ht=Bt.emissiveTexture,Jt=_e.textures[xt[Ht.index].source];Rt.setEmissiveTexture(Jt),_e.setTextureInfo(Rt.getEmissiveTextureInfo(),Ht)}if(Bt.normalTexture!==void 0){const Ht=Bt.normalTexture,Jt=_e.textures[xt[Ht.index].source];Rt.setNormalTexture(Jt),_e.setTextureInfo(Rt.getNormalTextureInfo(),Ht),Bt.normalTexture.scale!==void 0&&Rt.setNormalScale(Bt.normalTexture.scale)}if(Bt.occlusionTexture!==void 0){const Ht=Bt.occlusionTexture,Jt=_e.textures[xt[Ht.index].source];Rt.setOcclusionTexture(Jt),_e.setTextureInfo(Rt.getOcclusionTextureInfo(),Ht),Bt.occlusionTexture.strength!==void 0&&Rt.setOcclusionStrength(Bt.occlusionTexture.strength)}if(Ut.metallicRoughnessTexture!==void 0){const Ht=Ut.metallicRoughnessTexture,Jt=_e.textures[xt[Ht.index].source];Rt.setMetallicRoughnessTexture(Jt),_e.setTextureInfo(Rt.getMetallicRoughnessTextureInfo(),Ht)}return Rt}),b.getRoot().listExtensionsUsed().filter(Bt=>Bt.prereadTypes.includes(index_modern_PropertyType.MESH)).forEach(Bt=>Bt.preread(_e,index_modern_PropertyType.MESH));const Ct=_.meshes||[];b.getRoot().listExtensionsUsed().filter(Bt=>Bt.prereadTypes.includes(index_modern_PropertyType.PRIMITIVE)).forEach(Bt=>Bt.preread(_e,index_modern_PropertyType.PRIMITIVE)),_e.meshes=Ct.map(Bt=>{const Rt=b.createMesh(Bt.name);return Bt.extras&&Rt.setExtras(Bt.extras),Bt.weights!==void 0&&Rt.setWeights(Bt.weights),(Bt.primitives||[]).forEach(Ut=>{const Ht=b.createPrimitive();Ut.extras&&Ht.setExtras(Ut.extras),Ut.material!==void 0&&Ht.setMaterial(_e.materials[Ut.material]),Ut.mode!==void 0&&Ht.setMode(Ut.mode);for(const[Kt,sr]of Object.entries(Ut.attributes||{}))Ht.setAttribute(Kt,_e.accessors[sr]);Ut.indices!==void 0&&Ht.setIndices(_e.accessors[Ut.indices]);const Jt=Bt.extras&&Bt.extras.targetNames||[];(Ut.targets||[]).forEach((Kt,sr)=>{const ir=Jt[sr]||sr.toString(),cr=b.createPrimitiveTarget(ir);for(const[lr,hr]of Object.entries(Kt))cr.setAttribute(lr,_e.accessors[hr]);Ht.addTarget(cr)}),Rt.addPrimitive(Ht)}),Rt});const Et=_.cameras||[];_e.cameras=Et.map(Bt=>{const Rt=b.createCamera(Bt.name).setType(Bt.type);if(Bt.extras&&Rt.setExtras(Bt.extras),Bt.type===Camera.Type.PERSPECTIVE){const Ut=Bt.perspective;Rt.setYFov(Ut.yfov),Rt.setZNear(Ut.znear),Ut.zfar!==void 0&&Rt.setZFar(Ut.zfar),Ut.aspectRatio!==void 0&&Rt.setAspectRatio(Ut.aspectRatio)}else{const Ut=Bt.orthographic;Rt.setZNear(Ut.znear).setZFar(Ut.zfar).setXMag(Ut.xmag).setYMag(Ut.ymag)}return Rt});const Tt=_.nodes||[];b.getRoot().listExtensionsUsed().filter(Bt=>Bt.prereadTypes.includes(index_modern_PropertyType.NODE)).forEach(Bt=>Bt.preread(_e,index_modern_PropertyType.NODE)),_e.nodes=Tt.map(Bt=>{const Rt=b.createNode(Bt.name);if(Bt.extras&&Rt.setExtras(Bt.extras),Bt.translation!==void 0&&Rt.setTranslation(Bt.translation),Bt.rotation!==void 0&&Rt.setRotation(Bt.rotation),Bt.scale!==void 0&&Rt.setScale(Bt.scale),Bt.matrix!==void 0){const Ut=[0,0,0],Ht=[0,0,0,1],Jt=[1,1,1];index_modern_MathUtils.decompose(Bt.matrix,Ut,Ht,Jt),Rt.setTranslation(Ut),Rt.setRotation(Ht),Rt.setScale(Jt)}return Bt.weights!==void 0&&Rt.setWeights(Bt.weights),Rt});const kt=_.skins||[];_e.skins=kt.map(Bt=>{const Rt=b.createSkin(Bt.name);Bt.extras&&Rt.setExtras(Bt.extras),Bt.inverseBindMatrices!==void 0&&Rt.setInverseBindMatrices(_e.accessors[Bt.inverseBindMatrices]),Bt.skeleton!==void 0&&Rt.setSkeleton(_e.nodes[Bt.skeleton]);for(const Ut of Bt.joints)Rt.addJoint(_e.nodes[Ut]);return Rt}),Tt.map((Bt,Rt)=>{const Ut=_e.nodes[Rt];(Bt.children||[]).forEach(Ht=>Ut.addChild(_e.nodes[Ht])),Bt.mesh!==void 0&&Ut.setMesh(_e.meshes[Bt.mesh]),Bt.camera!==void 0&&Ut.setCamera(_e.cameras[Bt.camera]),Bt.skin!==void 0&&Ut.setSkin(_e.skins[Bt.skin])});const Dt=_.animations||[];_e.animations=Dt.map(Bt=>{const Rt=b.createAnimation(Bt.name);Bt.extras&&Rt.setExtras(Bt.extras);const Ut=(Bt.samplers||[]).map(Ht=>{const Jt=b.createAnimationSampler().setInput(_e.accessors[Ht.input]).setOutput(_e.accessors[Ht.output]).setInterpolation(Ht.interpolation||index_modern_AnimationSampler.Interpolation.LINEAR);return Ht.extras&&Jt.setExtras(Ht.extras),Rt.addSampler(Jt),Jt});return(Bt.channels||[]).forEach(Ht=>{const Jt=b.createAnimationChannel().setSampler(Ut[Ht.sampler]).setTargetPath(Ht.target.path);Ht.target.node!==void 0&&Jt.setTargetNode(_e.nodes[Ht.target.node]),Ht.extras&&Jt.setExtras(Ht.extras),Rt.addChannel(Jt)}),Rt});const zt=_.scenes||[];return b.getRoot().listExtensionsUsed().filter(Bt=>Bt.prereadTypes.includes(index_modern_PropertyType.SCENE)).forEach(Bt=>Bt.preread(_e,index_modern_PropertyType.SCENE)),_e.scenes=zt.map(Bt=>{const Rt=b.createScene(Bt.name);return Bt.extras&&Rt.setExtras(Bt.extras),(Bt.nodes||[]).map(Ut=>_e.nodes[Ut]).forEach(Ut=>Rt.addChild(Ut)),Rt}),_.scene!==void 0&&b.getRoot().setDefaultScene(_e.scenes[_.scene]),b.getRoot().listExtensionsUsed().forEach(Bt=>Bt.read(_e)),ft.forEach((Bt,Rt)=>{const Ut=_e.accessors[Rt],Ht=!!Bt.sparse,Jt=!Bt.bufferView&&!Ut.getArray();(Ht||Jt)&&Ut.setSparse(!0).setArray(getSparseArray(Bt,_e))}),b}static validate(o,c){const d=o.json;if(d.asset.version!=="2.0")throw new Error(`Unsupported glTF version, "${d.asset.version}".`);if(d.extensionsRequired){for(const _ of d.extensionsRequired)if(!c.extensions.find(b=>b.EXTENSION_NAME===_))throw new Error(`Missing required extension, "${_}".`)}if(d.extensionsUsed)for(const _ of d.extensionsUsed)c.extensions.find(b=>b.EXTENSION_NAME===_)||c.logger.warn(`Missing optional extension, "${_}".`)}}function getInterleavedArray(h,o){const c=o.jsonDoc,d=o.bufferViews[h.bufferView],_=c.json.bufferViews[h.bufferView],b=index_modern_ComponentTypeToTypedArray[h.componentType],_e=index_modern_Accessor.getElementSize(h.type),it=b.BYTES_PER_ELEMENT,nt=h.byteOffset||0,at=new b(h.count*_e),ut=new DataView(d.buffer,d.byteOffset,d.byteLength),pt=_.byteStride;for(let mt=0;mt<h.count;mt++)for(let ft=0;ft<_e;ft++){const vt=nt+mt*pt+ft*it;let xt;switch(h.componentType){case index_modern_Accessor.ComponentType.FLOAT:xt=ut.getFloat32(vt,!0);break;case index_modern_Accessor.ComponentType.UNSIGNED_INT:xt=ut.getUint32(vt,!0);break;case index_modern_Accessor.ComponentType.UNSIGNED_SHORT:xt=ut.getUint16(vt,!0);break;case index_modern_Accessor.ComponentType.UNSIGNED_BYTE:xt=ut.getUint8(vt);break;case index_modern_Accessor.ComponentType.SHORT:xt=ut.getInt16(vt,!0);break;case index_modern_Accessor.ComponentType.BYTE:xt=ut.getInt8(vt);break;default:throw new Error(`Unexpected componentType "${h.componentType}".`)}at[mt*_e+ft]=xt}return at}function getAccessorArray(h,o){const c=o.jsonDoc,d=o.bufferViews[h.bufferView],_=c.json.bufferViews[h.bufferView],b=index_modern_ComponentTypeToTypedArray[h.componentType],_e=index_modern_Accessor.getElementSize(h.type),it=b.BYTES_PER_ELEMENT,nt=_e*it;if(_.byteStride!==void 0&&_.byteStride!==nt)return getInterleavedArray(h,o);const at=d.byteOffset+(h.byteOffset||0),ut=h.count*_e*it;return new b(d.buffer.slice(at,at+ut))}function getSparseArray(h,o){const c=index_modern_ComponentTypeToTypedArray[h.componentType],d=index_modern_Accessor.getElementSize(h.type);let _;_=h.bufferView!==void 0?getAccessorArray(h,o):new c(h.count*d);const b=h.sparse;if(!b)return _;const _e=b.count,it=index_modern_extends({},h,b.indices,{count:_e,type:"SCALAR"}),nt=index_modern_extends({},h,b.values,{count:_e}),at=getAccessorArray(it,o),ut=getAccessorArray(nt,o);for(let pt=0;pt<it.count;pt++)for(let mt=0;mt<d;mt++)_[at[pt]*d+mt]=ut[pt*d+mt];return _}var BufferViewTarget;(function(h){h[h.ARRAY_BUFFER=34962]="ARRAY_BUFFER",h[h.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER"})(BufferViewTarget||(BufferViewTarget={}));class WriterContext{constructor(o,c,d){this._doc=void 0,this.jsonDoc=void 0,this.options=void 0,this.accessorIndexMap=new Map,this.animationIndexMap=new Map,this.bufferIndexMap=new Map,this.cameraIndexMap=new Map,this.skinIndexMap=new Map,this.materialIndexMap=new Map,this.meshIndexMap=new Map,this.nodeIndexMap=new Map,this.imageIndexMap=new Map,this.textureDefIndexMap=new Map,this.textureInfoDefMap=new Map,this.samplerDefIndexMap=new Map,this.sceneIndexMap=new Map,this.imageBufferViews=[],this.otherBufferViews=new Map,this.otherBufferViewsIndexMap=new Map,this.extensionData={},this.bufferURIGenerator=void 0,this.imageURIGenerator=void 0,this.logger=void 0,this._accessorUsageMap=new Map,this.accessorUsageGroupedByParent=new Set(["ARRAY_BUFFER"]),this.accessorParents=new Map,this._doc=o,this.jsonDoc=c,this.options=d;const _=o.getRoot(),b=_.listBuffers().length,_e=_.listTextures().length;this.bufferURIGenerator=new UniqueURIGenerator(b>1,()=>d.basename||"buffer"),this.imageURIGenerator=new UniqueURIGenerator(_e>1,it=>getSlot(o,it)||d.basename||"texture"),this.logger=o.getLogger()}createTextureInfoDef(o,c){const d={magFilter:c.getMagFilter()||void 0,minFilter:c.getMinFilter()||void 0,wrapS:c.getWrapS(),wrapT:c.getWrapT()},_=JSON.stringify(d);this.samplerDefIndexMap.has(_)||(this.samplerDefIndexMap.set(_,this.jsonDoc.json.samplers.length),this.jsonDoc.json.samplers.push(d));const b={source:this.imageIndexMap.get(o),sampler:this.samplerDefIndexMap.get(_)},_e=JSON.stringify(b);this.textureDefIndexMap.has(_e)||(this.textureDefIndexMap.set(_e,this.jsonDoc.json.textures.length),this.jsonDoc.json.textures.push(b));const it={index:this.textureDefIndexMap.get(_e)};return c.getTexCoord()!==0&&(it.texCoord=c.getTexCoord()),Object.keys(c.getExtras()).length>0&&(it.extras=c.getExtras()),this.textureInfoDefMap.set(c,it),it}createPropertyDef(o){const c={};return o.getName()&&(c.name=o.getName()),Object.keys(o.getExtras()).length>0&&(c.extras=o.getExtras()),c}createAccessorDef(o){const c=this.createPropertyDef(o);return c.type=o.getType(),c.componentType=o.getComponentType(),c.count=o.getCount(),this._doc.getGraph().listParentEdges(o).some(d=>d.getName()==="attributes"&&d.getAttributes().key==="POSITION"||d.getName()==="input")&&(c.max=o.getMax([]).map(Math.fround),c.min=o.getMin([]).map(Math.fround)),o.getNormalized()&&(c.normalized=o.getNormalized()),c}createImageData(o,c,d){if(this.options.format===Format.GLB)this.imageBufferViews.push(c),o.bufferView=this.jsonDoc.json.bufferViews.length,this.jsonDoc.json.bufferViews.push({buffer:0,byteOffset:-1,byteLength:c.byteLength});else{const _=index_modern_ImageUtils.mimeTypeToExtension(d.getMimeType());o.uri=this.imageURIGenerator.createURI(d,_),this.assignResourceURI(o.uri,c,!1)}}assignResourceURI(o,c,d){const _=this.jsonDoc.resources;if(!(o in _))return void(_[o]=c);if(c===_[o])return void this.logger.warn(`Duplicate resource URI, "${o}".`);const b=`Resource URI "${o}" already assigned to different data.`;if(d)throw new Error(b);this.logger.warn(b)}getAccessorUsage(o){const c=this._accessorUsageMap.get(o);if(c)return c;if(o.getSparse())return BufferViewUsage$1.SPARSE;for(const d of this._doc.getGraph().listParentEdges(o)){const{usage:_}=d.getAttributes();if(_)return _;d.getParent().propertyType!==index_modern_PropertyType.ROOT&&this.logger.warn(`Missing attribute ".usage" on edge, "${d.getName()}".`)}return BufferViewUsage$1.OTHER}addAccessorToUsageGroup(o,c){const d=this._accessorUsageMap.get(o);if(d&&d!==c)throw new Error(`Accessor with usage "${d}" cannot be reused as "${c}".`);return this._accessorUsageMap.set(o,c),this}}WriterContext.BufferViewTarget=BufferViewTarget,WriterContext.BufferViewUsage=BufferViewUsage$1,WriterContext.USAGE_TO_TARGET={[BufferViewUsage$1.ARRAY_BUFFER]:BufferViewTarget.ARRAY_BUFFER,[BufferViewUsage$1.ELEMENT_ARRAY_BUFFER]:BufferViewTarget.ELEMENT_ARRAY_BUFFER};class UniqueURIGenerator{constructor(o,c){this.multiple=void 0,this.basename=void 0,this.counter={},this.multiple=o,this.basename=c}createURI(o,c){if(o.getURI())return o.getURI();if(this.multiple){const d=this.basename(o);return this.counter[d]=this.counter[d]||1,`${d}_${this.counter[d]++}.${c}`}return`${this.basename(o)}.${c}`}}function getSlot(h,o){const c=h.getGraph().listParentEdges(o).find(d=>d.getParent()!==h.getRoot());return c?c.getName().replace(/texture$/i,""):""}const{BufferViewUsage}=WriterContext,{UNSIGNED_INT,UNSIGNED_SHORT,UNSIGNED_BYTE}=index_modern_Accessor.ComponentType,SUPPORTED_PREWRITE_TYPES=new Set([index_modern_PropertyType.ACCESSOR,index_modern_PropertyType.BUFFER,index_modern_PropertyType.MATERIAL,index_modern_PropertyType.MESH]);class index_modern_GLTFWriter{static write(o,c){const d=o.getGraph(),_=o.getRoot(),b={asset:index_modern_extends({generator:`glTF-Transform ${VERSION}`},_.getAsset()),extras:index_modern_extends({},_.getExtras())},_e={json:b,resources:{}},it=new WriterContext(o,_e,c),nt=c.logger||Logger.DEFAULT_INSTANCE,at=new Set(c.extensions.map(At=>At.EXTENSION_NAME)),ut=o.getRoot().listExtensionsUsed().filter(At=>at.has(At.extensionName)).sort((At,Ct)=>At.extensionName>Ct.extensionName?1:-1),pt=o.getRoot().listExtensionsRequired().filter(At=>at.has(At.extensionName)).sort((At,Ct)=>At.extensionName>Ct.extensionName?1:-1);ut.length<o.getRoot().listExtensionsUsed().length&&nt.warn("Some extensions were not registered for I/O, and will not be written.");for(const At of ut){const Ct=At.prewriteTypes.filter(Et=>!SUPPORTED_PREWRITE_TYPES.has(Et));Ct.length&&nt.warn(`Prewrite hooks for some types (${Ct.join()}), requested by extension ${At.extensionName}, are unsupported. Please file an issue or a PR.`);for(const Et of At.writeDependencies)At.install(Et,c.dependencies[Et])}function mt(At,Ct,Et,Tt){const kt=[];let Dt=0;for(const Bt of At){const Rt=it.createAccessorDef(Bt);Rt.bufferView=b.bufferViews.length;const Ut=Bt.getArray(),Ht=index_modern_BufferUtils.pad(index_modern_BufferUtils.toView(Ut));Rt.byteOffset=Dt,Dt+=Ht.byteLength,kt.push(Ht),it.accessorIndexMap.set(Bt,b.accessors.length),b.accessors.push(Rt)}const zt={buffer:Ct,byteOffset:Et,byteLength:index_modern_BufferUtils.concat(kt).byteLength};return Tt&&(zt.target=Tt),b.bufferViews.push(zt),{buffers:kt,byteLength:Dt}}function ft(At,Ct,Et){const Tt=At[0].getCount();let kt=0;for(const Ut of At){const Ht=it.createAccessorDef(Ut);Ht.bufferView=b.bufferViews.length,Ht.byteOffset=kt;const Jt=Ut.getElementSize(),Kt=Ut.getComponentSize();kt+=index_modern_BufferUtils.padNumber(Jt*Kt),it.accessorIndexMap.set(Ut,b.accessors.length),b.accessors.push(Ht)}const Dt=Tt*kt,zt=new ArrayBuffer(Dt),Bt=new DataView(zt);for(let Ut=0;Ut<Tt;Ut++){let Ht=0;for(const Jt of At){const Kt=Jt.getElementSize(),sr=Jt.getComponentSize(),ir=Jt.getComponentType(),cr=Jt.getArray();for(let lr=0;lr<Kt;lr++){const hr=Ut*kt+Ht+lr*sr,dr=cr[Ut*Kt+lr];switch(ir){case index_modern_Accessor.ComponentType.FLOAT:Bt.setFloat32(hr,dr,!0);break;case index_modern_Accessor.ComponentType.BYTE:Bt.setInt8(hr,dr);break;case index_modern_Accessor.ComponentType.SHORT:Bt.setInt16(hr,dr,!0);break;case index_modern_Accessor.ComponentType.UNSIGNED_BYTE:Bt.setUint8(hr,dr);break;case index_modern_Accessor.ComponentType.UNSIGNED_SHORT:Bt.setUint16(hr,dr,!0);break;case index_modern_Accessor.ComponentType.UNSIGNED_INT:Bt.setUint32(hr,dr,!0);break;default:throw new Error("Unexpected component type: "+ir)}}Ht+=index_modern_BufferUtils.padNumber(Kt*sr)}}const Rt={buffer:Ct,byteOffset:Et,byteLength:Dt,byteStride:kt,target:WriterContext.BufferViewTarget.ARRAY_BUFFER};return b.bufferViews.push(Rt),{byteLength:Dt,buffers:[new Uint8Array(zt)]}}function vt(At,Ct,Et){const Tt=[];let kt=0;const Dt=new Map;let zt=-1/0,Bt=!1;for(const ir of At){const cr=it.createAccessorDef(ir);b.accessors.push(cr),it.accessorIndexMap.set(ir,b.accessors.length-1);const lr=[],hr=[],dr=[],pr=new Array(ir.getElementSize()).fill(0);for(let Dr=0,_r=ir.getCount();Dr<_r;Dr++)if(ir.getElement(Dr,dr),!index_modern_MathUtils.eq(dr,pr,0)){zt=Math.max(Dr,zt),lr.push(Dr);for(let rr=0;rr<dr.length;rr++)hr.push(dr[rr])}const ur=lr.length,xr={accessorDef:cr,count:ur};if(Dt.set(ir,xr),ur===0)continue;ur>ir.getCount()/2&&(Bt=!0);const vr=index_modern_ComponentTypeToTypedArray[ir.getComponentType()];xr.indices=lr,xr.values=new vr(hr)}if(!Number.isFinite(zt))return{buffers:Tt,byteLength:kt};Bt&&nt.warn("Some sparse accessors have >50% non-zero elements, which may increase file size.");const Rt=zt<255?Uint8Array:zt<65535?Uint16Array:Uint32Array,Ut=zt<255?UNSIGNED_BYTE:zt<65535?UNSIGNED_SHORT:UNSIGNED_INT,Ht={buffer:Ct,byteOffset:Et+kt,byteLength:0};for(const ir of At){const cr=Dt.get(ir);if(cr.count===0)continue;cr.indicesByteOffset=Ht.byteLength;const lr=index_modern_BufferUtils.pad(index_modern_BufferUtils.toView(new Rt(cr.indices)));Tt.push(lr),kt+=lr.byteLength,Ht.byteLength+=lr.byteLength}b.bufferViews.push(Ht);const Jt=b.bufferViews.length-1,Kt={buffer:Ct,byteOffset:Et+kt,byteLength:0};for(const ir of At){const cr=Dt.get(ir);if(cr.count===0)continue;cr.valuesByteOffset=Kt.byteLength;const lr=index_modern_BufferUtils.pad(index_modern_BufferUtils.toView(cr.values));Tt.push(lr),kt+=lr.byteLength,Kt.byteLength+=lr.byteLength}b.bufferViews.push(Kt);const sr=b.bufferViews.length-1;for(const ir of At){const cr=Dt.get(ir);cr.count!==0&&(cr.accessorDef.sparse={count:cr.count,indices:{bufferView:Jt,byteOffset:cr.indicesByteOffset,componentType:Ut},values:{bufferView:sr,byteOffset:cr.valuesByteOffset}})}return{buffers:Tt,byteLength:kt}}if(b.accessors=[],b.bufferViews=[],b.samplers=[],b.textures=[],b.images=_.listTextures().map((At,Ct)=>{const Et=it.createPropertyDef(At);At.getMimeType()&&(Et.mimeType=At.getMimeType());const Tt=At.getImage();return Tt&&it.createImageData(Et,Tt,At),it.imageIndexMap.set(At,Ct),Et}),ut.filter(At=>At.prewriteTypes.includes(index_modern_PropertyType.ACCESSOR)).forEach(At=>At.prewrite(it,index_modern_PropertyType.ACCESSOR)),_.listAccessors().forEach(At=>{const Ct=it.accessorUsageGroupedByParent,Et=it.accessorParents;if(it.accessorIndexMap.has(At))return;const Tt=it.getAccessorUsage(At);if(it.addAccessorToUsageGroup(At,Tt),Ct.has(Tt)){const kt=d.listParents(At).find(Dt=>Dt.propertyType!==index_modern_PropertyType.ROOT);Et.set(At,kt)}}),ut.filter(At=>At.prewriteTypes.includes(index_modern_PropertyType.BUFFER)).forEach(At=>At.prewrite(it,index_modern_PropertyType.BUFFER)),(_.listAccessors().length>0||it.otherBufferViews.size>0||_.listTextures().length>0&&c.format===Format.GLB)&&_.listBuffers().length===0)throw new Error("Buffer required for Document resources, but none was found.");b.buffers=[],_.listBuffers().forEach((At,Ct)=>{const Et=it.createPropertyDef(At),Tt=it.accessorUsageGroupedByParent,kt=At.listParents().filter(Kt=>Kt instanceof index_modern_Accessor),Dt=new Set(kt.map(Kt=>it.accessorParents.get(Kt))),zt=new Map(Array.from(Dt).map((Kt,sr)=>[Kt,sr])),Bt={};for(const Kt of kt){var Rt;if(it.accessorIndexMap.has(Kt))continue;const sr=it.getAccessorUsage(Kt);let ir=sr;if(Tt.has(sr)){const cr=it.accessorParents.get(Kt);ir+=`:${zt.get(cr)}`}Bt[Rt=ir]||(Bt[Rt]={usage:sr,accessors:[]}),Bt[ir].accessors.push(Kt)}const Ut=[],Ht=b.buffers.length;let Jt=0;for(const{usage:Kt,accessors:sr}of Object.values(Bt))if(Kt===BufferViewUsage.ARRAY_BUFFER&&c.vertexLayout===VertexLayout.INTERLEAVED){const ir=ft(sr,Ht,Jt);Jt+=ir.byteLength;for(const cr of ir.buffers)Ut.push(cr)}else if(Kt===BufferViewUsage.ARRAY_BUFFER)for(const ir of sr){const cr=ft([ir],Ht,Jt);Jt+=cr.byteLength;for(const lr of cr.buffers)Ut.push(lr)}else if(Kt===BufferViewUsage.SPARSE){const ir=vt(sr,Ht,Jt);Jt+=ir.byteLength;for(const cr of ir.buffers)Ut.push(cr)}else if(Kt===BufferViewUsage.ELEMENT_ARRAY_BUFFER){const ir=mt(sr,Ht,Jt,WriterContext.BufferViewTarget.ELEMENT_ARRAY_BUFFER);Jt+=ir.byteLength;for(const cr of ir.buffers)Ut.push(cr)}else{const ir=mt(sr,Ht,Jt);Jt+=ir.byteLength;for(const cr of ir.buffers)Ut.push(cr)}if(it.imageBufferViews.length&&Ct===0){for(let Kt=0;Kt<it.imageBufferViews.length;Kt++)if(b.bufferViews[b.images[Kt].bufferView].byteOffset=Jt,Jt+=it.imageBufferViews[Kt].byteLength,Ut.push(it.imageBufferViews[Kt]),Jt%8){const sr=8-Jt%8;Jt+=sr,Ut.push(new Uint8Array(sr))}}if(it.otherBufferViews.has(At))for(const Kt of it.otherBufferViews.get(At))b.bufferViews.push({buffer:Ht,byteOffset:Jt,byteLength:Kt.byteLength}),it.otherBufferViewsIndexMap.set(Kt,b.bufferViews.length-1),Jt+=Kt.byteLength,Ut.push(Kt);if(Jt){let Kt;c.format===Format.GLB?Kt=GLB_BUFFER:(Kt=it.bufferURIGenerator.createURI(At,"bin"),Et.uri=Kt),Et.byteLength=Jt,it.assignResourceURI(Kt,index_modern_BufferUtils.concat(Ut),!0)}b.buffers.push(Et),it.bufferIndexMap.set(At,Ct)}),_.listAccessors().find(At=>!At.getBuffer())&&nt.warn("Skipped writing one or more Accessors: no Buffer assigned."),ut.filter(At=>At.prewriteTypes.includes(index_modern_PropertyType.MATERIAL)).forEach(At=>At.prewrite(it,index_modern_PropertyType.MATERIAL)),b.materials=_.listMaterials().map((At,Ct)=>{const Et=it.createPropertyDef(At);if(At.getAlphaMode()!==index_modern_Material.AlphaMode.OPAQUE&&(Et.alphaMode=At.getAlphaMode()),At.getAlphaMode()===index_modern_Material.AlphaMode.MASK&&(Et.alphaCutoff=At.getAlphaCutoff()),At.getDoubleSided()&&(Et.doubleSided=!0),Et.pbrMetallicRoughness={},index_modern_MathUtils.eq(At.getBaseColorFactor(),[1,1,1,1])||(Et.pbrMetallicRoughness.baseColorFactor=At.getBaseColorFactor()),index_modern_MathUtils.eq(At.getEmissiveFactor(),[0,0,0])||(Et.emissiveFactor=At.getEmissiveFactor()),At.getRoughnessFactor()!==1&&(Et.pbrMetallicRoughness.roughnessFactor=At.getRoughnessFactor()),At.getMetallicFactor()!==1&&(Et.pbrMetallicRoughness.metallicFactor=At.getMetallicFactor()),At.getBaseColorTexture()){const Tt=At.getBaseColorTexture(),kt=At.getBaseColorTextureInfo();Et.pbrMetallicRoughness.baseColorTexture=it.createTextureInfoDef(Tt,kt)}if(At.getEmissiveTexture()){const Tt=At.getEmissiveTexture(),kt=At.getEmissiveTextureInfo();Et.emissiveTexture=it.createTextureInfoDef(Tt,kt)}if(At.getNormalTexture()){const Tt=At.getNormalTexture(),kt=At.getNormalTextureInfo(),Dt=it.createTextureInfoDef(Tt,kt);At.getNormalScale()!==1&&(Dt.scale=At.getNormalScale()),Et.normalTexture=Dt}if(At.getOcclusionTexture()){const Tt=At.getOcclusionTexture(),kt=At.getOcclusionTextureInfo(),Dt=it.createTextureInfoDef(Tt,kt);At.getOcclusionStrength()!==1&&(Dt.strength=At.getOcclusionStrength()),Et.occlusionTexture=Dt}if(At.getMetallicRoughnessTexture()){const Tt=At.getMetallicRoughnessTexture(),kt=At.getMetallicRoughnessTextureInfo();Et.pbrMetallicRoughness.metallicRoughnessTexture=it.createTextureInfoDef(Tt,kt)}return it.materialIndexMap.set(At,Ct),Et}),ut.filter(At=>At.prewriteTypes.includes(index_modern_PropertyType.MESH)).forEach(At=>At.prewrite(it,index_modern_PropertyType.MESH)),b.meshes=_.listMeshes().map((At,Ct)=>{const Et=it.createPropertyDef(At);let Tt=null;return Et.primitives=At.listPrimitives().map(kt=>{const Dt={attributes:{}};Dt.mode=kt.getMode();const zt=kt.getMaterial();zt&&(Dt.material=it.materialIndexMap.get(zt)),Object.keys(kt.getExtras()).length&&(Dt.extras=kt.getExtras());const Bt=kt.getIndices();Bt&&(Dt.indices=it.accessorIndexMap.get(Bt));for(const Rt of kt.listSemantics())Dt.attributes[Rt]=it.accessorIndexMap.get(kt.getAttribute(Rt));for(const Rt of kt.listTargets()){const Ut={};for(const Ht of Rt.listSemantics())Ut[Ht]=it.accessorIndexMap.get(Rt.getAttribute(Ht));Dt.targets=Dt.targets||[],Dt.targets.push(Ut)}return kt.listTargets().length&&!Tt&&(Tt=kt.listTargets().map(Rt=>Rt.getName())),Dt}),At.getWeights().length&&(Et.weights=At.getWeights()),Tt&&(Et.extras=Et.extras||{},Et.extras.targetNames=Tt),it.meshIndexMap.set(At,Ct),Et}),b.cameras=_.listCameras().map((At,Ct)=>{const Et=it.createPropertyDef(At);if(Et.type=At.getType(),Et.type===Camera.Type.PERSPECTIVE){Et.perspective={znear:At.getZNear(),zfar:At.getZFar(),yfov:At.getYFov()};const Tt=At.getAspectRatio();Tt!==null&&(Et.perspective.aspectRatio=Tt)}else Et.orthographic={znear:At.getZNear(),zfar:At.getZFar(),xmag:At.getXMag(),ymag:At.getYMag()};return it.cameraIndexMap.set(At,Ct),Et}),b.nodes=_.listNodes().map((At,Ct)=>{const Et=it.createPropertyDef(At);return index_modern_MathUtils.eq(At.getTranslation(),[0,0,0])||(Et.translation=At.getTranslation()),index_modern_MathUtils.eq(At.getRotation(),[0,0,0,1])||(Et.rotation=At.getRotation()),index_modern_MathUtils.eq(At.getScale(),[1,1,1])||(Et.scale=At.getScale()),At.getWeights().length&&(Et.weights=At.getWeights()),it.nodeIndexMap.set(At,Ct),Et}),b.skins=_.listSkins().map((At,Ct)=>{const Et=it.createPropertyDef(At),Tt=At.getInverseBindMatrices();Tt&&(Et.inverseBindMatrices=it.accessorIndexMap.get(Tt));const kt=At.getSkeleton();return kt&&(Et.skeleton=it.nodeIndexMap.get(kt)),Et.joints=At.listJoints().map(Dt=>it.nodeIndexMap.get(Dt)),it.skinIndexMap.set(At,Ct),Et}),_.listNodes().forEach((At,Ct)=>{const Et=b.nodes[Ct],Tt=At.getMesh();Tt&&(Et.mesh=it.meshIndexMap.get(Tt));const kt=At.getCamera();kt&&(Et.camera=it.cameraIndexMap.get(kt));const Dt=At.getSkin();Dt&&(Et.skin=it.skinIndexMap.get(Dt)),At.listChildren().length>0&&(Et.children=At.listChildren().map(zt=>it.nodeIndexMap.get(zt)))}),b.animations=_.listAnimations().map((At,Ct)=>{const Et=it.createPropertyDef(At),Tt=new Map;return Et.samplers=At.listSamplers().map((kt,Dt)=>{const zt=it.createPropertyDef(kt);return zt.input=it.accessorIndexMap.get(kt.getInput()),zt.output=it.accessorIndexMap.get(kt.getOutput()),zt.interpolation=kt.getInterpolation(),Tt.set(kt,Dt),zt}),Et.channels=At.listChannels().map(kt=>{const Dt=it.createPropertyDef(kt);return Dt.sampler=Tt.get(kt.getSampler()),Dt.target={node:it.nodeIndexMap.get(kt.getTargetNode()),path:kt.getTargetPath()},Dt}),it.animationIndexMap.set(At,Ct),Et}),b.scenes=_.listScenes().map((At,Ct)=>{const Et=it.createPropertyDef(At);return Et.nodes=At.listChildren().map(Tt=>it.nodeIndexMap.get(Tt)),it.sceneIndexMap.set(At,Ct),Et});const xt=_.getDefaultScene();return xt&&(b.scene=_.listScenes().indexOf(xt)),b.extensionsUsed=ut.map(At=>At.extensionName),b.extensionsRequired=pt.map(At=>At.extensionName),ut.forEach(At=>At.write(it)),index_modern_clean(b),_e}}function index_modern_clean(h){const o=[];for(const c in h){const d=h[c];(Array.isArray(d)&&d.length===0||d===null||d===""||d&&typeof d=="object"&&Object.keys(d).length===0)&&o.push(c)}for(const c of o)delete h[c]}var ChunkType;(function(h){h[h.JSON=1313821514]="JSON",h[h.BIN=5130562]="BIN"})(ChunkType||(ChunkType={}));class PlatformIO{constructor(){this._logger=Logger.DEFAULT_INSTANCE,this._extensions=new Set,this._dependencies={},this._vertexLayout=VertexLayout.INTERLEAVED,this.lastReadBytes=0,this.lastWriteBytes=0}setLogger(o){return this._logger=o,this}registerExtensions(o){for(const c of o)this._extensions.add(c),c.register();return this}registerDependencies(o){return Object.assign(this._dependencies,o),this}setVertexLayout(o){return this._vertexLayout=o,this}async read(o){return await this.readJSON(await this.readAsJSON(o))}async readAsJSON(o){const c=await this.readURI(o,"view");this.lastReadBytes=c.byteLength;const d=isGLB(c)?this._binaryToJSON(c):{json:JSON.parse(index_modern_BufferUtils.decodeText(c)),resources:{}};return await this._readResourcesExternal(d,this.dirname(o)),this._readResourcesInternal(d),d}async readJSON(o){return o=this._copyJSON(o),this._readResourcesInternal(o),GLTFReader.read(o,{extensions:Array.from(this._extensions),dependencies:this._dependencies,logger:this._logger})}async binaryToJSON(o){const c=this._binaryToJSON(index_modern_BufferUtils.assertView(o));this._readResourcesInternal(c);const d=c.json;if(d.buffers&&d.buffers.some(_=>isExternalBuffer(c,_)))throw new Error("Cannot resolve external buffers with binaryToJSON().");if(d.images&&d.images.some(_=>isExternalImage(c,_)))throw new Error("Cannot resolve external images with binaryToJSON().");return c}async readBinary(o){return this.readJSON(await this.binaryToJSON(index_modern_BufferUtils.assertView(o)))}async writeJSON(o,c={}){if(c.format===Format.GLB&&o.getRoot().listBuffers().length>1)throw new Error("GLB must have 01 buffers.");return index_modern_GLTFWriter.write(o,{format:c.format||Format.GLTF,basename:c.basename||"",logger:this._logger,vertexLayout:this._vertexLayout,dependencies:index_modern_extends({},this._dependencies),extensions:Array.from(this._extensions)})}async writeBinary(o){const{json:c,resources:d}=await this.writeJSON(o,{format:Format.GLB}),_=new Uint32Array([1179937895,2,12]),b=JSON.stringify(c),_e=index_modern_BufferUtils.pad(index_modern_BufferUtils.encodeText(b),32),it=index_modern_BufferUtils.toView(new Uint32Array([_e.byteLength,1313821514])),nt=index_modern_BufferUtils.concat([it,_e]);_[_.length-1]+=nt.byteLength;const at=Object.values(d)[0];if(!at||!at.byteLength)return index_modern_BufferUtils.concat([index_modern_BufferUtils.toView(_),nt]);const ut=index_modern_BufferUtils.pad(at,0),pt=index_modern_BufferUtils.toView(new Uint32Array([ut.byteLength,5130562])),mt=index_modern_BufferUtils.concat([pt,ut]);return _[_.length-1]+=mt.byteLength,index_modern_BufferUtils.concat([index_modern_BufferUtils.toView(_),nt,mt])}async _readResourcesExternal(o,c){var d=this;const _=[...o.json.images||[],...o.json.buffers||[]].map(async function(b){const _e=b.uri;if(!_e||_e.match(/data:/))return Promise.resolve();o.resources[_e]=await d.readURI(d.resolve(c,_e),"view"),d.lastReadBytes+=o.resources[_e].byteLength});await Promise.all(_)}_readResourcesInternal(o){function c(d){if(d.uri){if(d.uri in o.resources)index_modern_BufferUtils.assertView(o.resources[d.uri]);else if(d.uri.match(/data:/)){const _=`__${index_modern_uuid()}.${index_modern_FileUtils.extension(d.uri)}`;o.resources[_]=index_modern_BufferUtils.createBufferFromDataURI(d.uri),d.uri=_}}}(o.json.images||[]).forEach(d=>{if(d.bufferView===void 0&&d.uri===void 0)throw new Error("Missing resource URI or buffer view.");c(d)}),(o.json.buffers||[]).forEach(c)}_copyJSON(o){const{images:c,buffers:d}=o.json;return o={json:index_modern_extends({},o.json),resources:index_modern_extends({},o.resources)},c&&(o.json.images=c.map(_=>index_modern_extends({},_))),d&&(o.json.buffers=d.map(_=>index_modern_extends({},_))),o}_binaryToJSON(o){if(!isGLB(o))throw new Error("Invalid glTF 2.0 binary.");const c=new Uint32Array(o.buffer,o.byteOffset+12,2);if(c[1]!==ChunkType.JSON)throw new Error("Missing required GLB JSON chunk.");const d=c[0],_=index_modern_BufferUtils.decodeText(index_modern_BufferUtils.toView(o,20,d)),b=JSON.parse(_),_e=20+d;if(o.byteLength<=_e)return{json:b,resources:{}};const it=new Uint32Array(o.buffer,o.byteOffset+_e,2);if(it[1]!==ChunkType.BIN)return{json:b,resources:{}};const nt=it[0],at=index_modern_BufferUtils.toView(o,_e+8,nt);return{json:b,resources:{[GLB_BUFFER]:at}}}}function isExternalBuffer(h,o){return o.uri!==void 0&&!(o.uri in h.resources)}function isExternalImage(h,o){return o.uri!==void 0&&!(o.uri in h.resources)&&o.bufferView===void 0}function isGLB(h){if(h.byteLength<3*Uint32Array.BYTES_PER_ELEMENT)return!1;const o=new Uint32Array(h.buffer,h.byteOffset,3);return o[0]===1179937895&&o[1]===2}class WebIO extends PlatformIO{constructor(o=HTTPUtils.DEFAULT_INIT){super(),this._fetchConfig=void 0,this._fetchConfig=o}async readURI(o,c){const d=await fetch(o,this._fetchConfig);switch(c){case"view":return new Uint8Array(await d.arrayBuffer());case"text":return d.text()}}resolve(o,c){return HTTPUtils.resolve(o,c)}dirname(o){return HTTPUtils.dirname(o)}}const KHR_SUPERCOMPRESSION_NONE=0,KHR_DF_KHR_DESCRIPTORTYPE_BASICFORMAT=0,KHR_DF_VENDORID_KHRONOS=0,KHR_DF_VERSION=2,KHR_DF_MODEL_UNSPECIFIED=0,ktx_parse_modern_KHR_DF_MODEL_ETC1S=163,ktx_parse_modern_KHR_DF_MODEL_UASTC=166,KHR_DF_FLAG_ALPHA_STRAIGHT=0,KHR_DF_TRANSFER_SRGB=2,KHR_DF_PRIMARIES_BT709=1,KHR_DF_SAMPLE_DATATYPE_SIGNED=64,VK_FORMAT_UNDEFINED=0;class KTX2Container{constructor(){this.vkFormat=VK_FORMAT_UNDEFINED,this.typeSize=1,this.pixelWidth=0,this.pixelHeight=0,this.pixelDepth=0,this.layerCount=0,this.faceCount=1,this.supercompressionScheme=KHR_SUPERCOMPRESSION_NONE,this.levels=[],this.dataFormatDescriptor=[{vendorId:KHR_DF_VENDORID_KHRONOS,descriptorType:KHR_DF_KHR_DESCRIPTORTYPE_BASICFORMAT,descriptorBlockSize:0,versionNumber:KHR_DF_VERSION,colorModel:KHR_DF_MODEL_UNSPECIFIED,colorPrimaries:KHR_DF_PRIMARIES_BT709,transferFunction:KHR_DF_TRANSFER_SRGB,flags:KHR_DF_FLAG_ALPHA_STRAIGHT,texelBlockDimension:[0,0,0,0],bytesPlane:[0,0,0,0,0,0,0,0],samples:[]}],this.keyValue={},this.globalData=null}}class BufferReader{constructor(o,c,d,_){this._dataView=void 0,this._littleEndian=void 0,this._offset=void 0,this._dataView=new DataView(o.buffer,o.byteOffset+c,d),this._littleEndian=_,this._offset=0}_nextUint8(){const o=this._dataView.getUint8(this._offset);return this._offset+=1,o}_nextUint16(){const o=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,o}_nextUint32(){const o=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,o}_nextUint64(){const o=this._dataView.getUint32(this._offset,this._littleEndian)+4294967296*this._dataView.getUint32(this._offset+4,this._littleEndian);return this._offset+=8,o}_nextInt32(){const o=this._dataView.getInt32(this._offset,this._littleEndian);return this._offset+=4,o}_skip(o){return this._offset+=o,this}_scan(o,c=0){const d=this._offset;let _=0;for(;this._dataView.getUint8(this._offset)!==c&&_<o;)_++,this._offset++;return _<o&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+d,_)}}const KTX2_ID=[171,75,84,88,32,50,48,187,13,10,26,10];function decodeText(h){return typeof TextDecoder<"u"?new TextDecoder().decode(h):Buffer.from(h).toString("utf8")}function ktx_parse_modern_read(h){const o=new Uint8Array(h.buffer,h.byteOffset,KTX2_ID.length);if(o[0]!==KTX2_ID[0]||o[1]!==KTX2_ID[1]||o[2]!==KTX2_ID[2]||o[3]!==KTX2_ID[3]||o[4]!==KTX2_ID[4]||o[5]!==KTX2_ID[5]||o[6]!==KTX2_ID[6]||o[7]!==KTX2_ID[7]||o[8]!==KTX2_ID[8]||o[9]!==KTX2_ID[9]||o[10]!==KTX2_ID[10]||o[11]!==KTX2_ID[11])throw new Error("Missing KTX 2.0 identifier.");const c=new KTX2Container,d=17*Uint32Array.BYTES_PER_ELEMENT,_=new BufferReader(h,KTX2_ID.length,d,!0);c.vkFormat=_._nextUint32(),c.typeSize=_._nextUint32(),c.pixelWidth=_._nextUint32(),c.pixelHeight=_._nextUint32(),c.pixelDepth=_._nextUint32(),c.layerCount=_._nextUint32(),c.faceCount=_._nextUint32();const b=_._nextUint32();c.supercompressionScheme=_._nextUint32();const _e=_._nextUint32(),it=_._nextUint32(),nt=_._nextUint32(),at=_._nextUint32(),ut=_._nextUint64(),pt=_._nextUint64(),mt=3*b*8,ft=new BufferReader(h,KTX2_ID.length+d,mt,!0);for(let dr=0;dr<b;dr++)c.levels.push({levelData:new Uint8Array(h.buffer,h.byteOffset+ft._nextUint64(),ft._nextUint64()),uncompressedByteLength:ft._nextUint64()});const vt=new BufferReader(h,_e,it,!0),xt={vendorId:vt._skip(4)._nextUint16(),descriptorType:vt._nextUint16(),versionNumber:vt._nextUint16(),descriptorBlockSize:vt._nextUint16(),colorModel:vt._nextUint8(),colorPrimaries:vt._nextUint8(),transferFunction:vt._nextUint8(),flags:vt._nextUint8(),texelBlockDimension:[vt._nextUint8(),vt._nextUint8(),vt._nextUint8(),vt._nextUint8()],bytesPlane:[vt._nextUint8(),vt._nextUint8(),vt._nextUint8(),vt._nextUint8(),vt._nextUint8(),vt._nextUint8(),vt._nextUint8(),vt._nextUint8()],samples:[]},At=(xt.descriptorBlockSize/4-6)/4;for(let dr=0;dr<At;dr++){const pr={bitOffset:vt._nextUint16(),bitLength:vt._nextUint8(),channelType:vt._nextUint8(),samplePosition:[vt._nextUint8(),vt._nextUint8(),vt._nextUint8(),vt._nextUint8()],sampleLower:-1/0,sampleUpper:1/0};pr.channelType&KHR_DF_SAMPLE_DATATYPE_SIGNED?(pr.sampleLower=vt._nextInt32(),pr.sampleUpper=vt._nextInt32()):(pr.sampleLower=vt._nextUint32(),pr.sampleUpper=vt._nextUint32()),xt.samples[dr]=pr}c.dataFormatDescriptor.length=0,c.dataFormatDescriptor.push(xt);const Ct=new BufferReader(h,nt,at,!0);for(;Ct._offset<at;){const dr=Ct._nextUint32(),pr=Ct._scan(dr),ur=decodeText(pr),xr=Ct._scan(dr-pr.byteLength);c.keyValue[ur]=ur.match(/^ktx/i)?decodeText(xr):xr,Ct._offset%4&&Ct._skip(4-Ct._offset%4)}if(pt<=0)return c;const Et=new BufferReader(h,ut,pt,!0),Tt=Et._nextUint16(),kt=Et._nextUint16(),Dt=Et._nextUint32(),zt=Et._nextUint32(),Bt=Et._nextUint32(),Rt=Et._nextUint32(),Ut=[];for(let dr=0;dr<b;dr++)Ut.push({imageFlags:Et._nextUint32(),rgbSliceByteOffset:Et._nextUint32(),rgbSliceByteLength:Et._nextUint32(),alphaSliceByteOffset:Et._nextUint32(),alphaSliceByteLength:Et._nextUint32()});const Ht=ut+Et._offset,Jt=Ht+Dt,Kt=Jt+zt,sr=Kt+Bt,ir=new Uint8Array(h.buffer,h.byteOffset+Ht,Dt),cr=new Uint8Array(h.buffer,h.byteOffset+Jt,zt),lr=new Uint8Array(h.buffer,h.byteOffset+Kt,Bt),hr=new Uint8Array(h.buffer,h.byteOffset+sr,Rt);return c.globalData={endpointCount:Tt,selectorCount:kt,imageDescs:Ut,endpointsData:ir,selectorsData:cr,tablesData:lr,extendedData:hr},c}const EXT_MESH_GPU_INSTANCING="EXT_mesh_gpu_instancing",EXT_MESHOPT_COMPRESSION="EXT_meshopt_compression",EXT_TEXTURE_WEBP="EXT_texture_webp",EXT_TEXTURE_AVIF="EXT_texture_avif",KHR_DRACO_MESH_COMPRESSION="KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL="KHR_lights_punctual",KHR_MATERIALS_ANISOTROPY="KHR_materials_anisotropy",KHR_MATERIALS_CLEARCOAT="KHR_materials_clearcoat",KHR_MATERIALS_DIFFUSE_TRANSMISSION="KHR_materials_diffuse_transmission",KHR_MATERIALS_DISPERSION="KHR_materials_dispersion",KHR_MATERIALS_EMISSIVE_STRENGTH="KHR_materials_emissive_strength",KHR_MATERIALS_IOR="KHR_materials_ior",KHR_MATERIALS_IRIDESCENCE="KHR_materials_iridescence",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS="KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_SHEEN="KHR_materials_sheen",KHR_MATERIALS_SPECULAR="KHR_materials_specular",KHR_MATERIALS_TRANSMISSION="KHR_materials_transmission",KHR_MATERIALS_UNLIT="KHR_materials_unlit",KHR_MATERIALS_VOLUME="KHR_materials_volume",KHR_MATERIALS_VARIANTS="KHR_materials_variants",index_modern_KHR_MESH_QUANTIZATION="KHR_mesh_quantization",index_modern_KHR_TEXTURE_BASISU="KHR_texture_basisu",KHR_TEXTURE_TRANSFORM="KHR_texture_transform",KHR_XMP_JSON_LD="KHR_xmp_json_ld",INSTANCE_ATTRIBUTE="INSTANCE_ATTRIBUTE";class InstancedMesh extends index_modern_ExtensionProperty{init(){this.extensionName=EXT_MESH_GPU_INSTANCING,this.propertyType="InstancedMesh",this.parentTypes=[index_modern_PropertyType.NODE]}getDefaults(){return Object.assign(super.getDefaults(),{attributes:new RefMap})}getAttribute(o){return this.getRefMap("attributes",o)}setAttribute(o,c){return this.setRefMap("attributes",o,c,{usage:INSTANCE_ATTRIBUTE})}listAttributes(){return this.listRefMapValues("attributes")}listSemantics(){return this.listRefMapKeys("attributes")}}InstancedMesh.EXTENSION_NAME=EXT_MESH_GPU_INSTANCING;const NAME$o=EXT_MESH_GPU_INSTANCING;class index_modern_EXTMeshGPUInstancing extends Extension{constructor(...o){super(...o),this.extensionName=NAME$o,this.provideTypes=[index_modern_PropertyType.NODE],this.prewriteTypes=[index_modern_PropertyType.ACCESSOR]}createInstancedMesh(){return new InstancedMesh(this.document.getGraph())}read(o){return(o.jsonDoc.json.nodes||[]).forEach((c,d)=>{if(!c.extensions||!c.extensions[NAME$o])return;const _=c.extensions[NAME$o],b=this.createInstancedMesh();for(const _e in _.attributes)b.setAttribute(_e,o.accessors[_.attributes[_e]]);o.nodes[d].setExtension(NAME$o,b)}),this}prewrite(o){o.accessorUsageGroupedByParent.add(INSTANCE_ATTRIBUTE);for(const c of this.properties)for(const d of c.listAttributes())o.addAccessorToUsageGroup(d,INSTANCE_ATTRIBUTE);return this}write(o){const c=o.jsonDoc;return this.document.getRoot().listNodes().forEach(d=>{const _=d.getExtension(NAME$o);if(_){const b=o.nodeIndexMap.get(d),_e=c.json.nodes[b],it={attributes:{}};_.listSemantics().forEach(nt=>{const at=_.getAttribute(nt);it.attributes[nt]=o.accessorIndexMap.get(at)}),_e.extensions=_e.extensions||{},_e.extensions[NAME$o]=it}}),this}}function dist_index_modern_extends(){return dist_index_modern_extends=Object.assign?Object.assign.bind():function(h){for(var o=1;o<arguments.length;o++){var c=arguments[o];for(var d in c)({}).hasOwnProperty.call(c,d)&&(h[d]=c[d])}return h},dist_index_modern_extends.apply(null,arguments)}var EncoderMethod$1,MeshoptMode,MeshoptFilter;index_modern_EXTMeshGPUInstancing.EXTENSION_NAME=NAME$o,function(h){h.QUANTIZE="quantize",h.FILTER="filter"}(EncoderMethod$1||(EncoderMethod$1={})),function(h){h.ATTRIBUTES="ATTRIBUTES",h.TRIANGLES="TRIANGLES",h.INDICES="INDICES"}(MeshoptMode||(MeshoptMode={})),function(h){h.NONE="NONE",h.OCTAHEDRAL="OCTAHEDRAL",h.QUATERNION="QUATERNION",h.EXPONENTIAL="EXPONENTIAL"}(MeshoptFilter||(MeshoptFilter={}));const{BYTE,SHORT,FLOAT}=index_modern_Accessor.ComponentType,{encodeNormalizedInt,decodeNormalizedInt}=index_modern_MathUtils;function prepareAccessor(h,o,c,d){const{filter:_,bits:b}=d,_e={array:h.getArray(),byteStride:h.getElementSize()*h.getComponentSize(),componentType:h.getComponentType(),normalized:h.getNormalized()};if(c!==MeshoptMode.ATTRIBUTES)return _e;if(_!==MeshoptFilter.NONE){let it=h.getNormalized()?decodeNormalizedIntArray(h):new Float32Array(_e.array);switch(_){case MeshoptFilter.EXPONENTIAL:_e.byteStride=4*h.getElementSize(),_e.componentType=FLOAT,_e.normalized=!1,_e.array=o.encodeFilterExp(it,h.getCount(),_e.byteStride,b);break;case MeshoptFilter.OCTAHEDRAL:_e.byteStride=b>8?8:4,_e.componentType=b>8?SHORT:BYTE,_e.normalized=!0,it=h.getElementSize()===3?padNormals(it):it,_e.array=o.encodeFilterOct(it,h.getCount(),_e.byteStride,b);break;case MeshoptFilter.QUATERNION:_e.byteStride=8,_e.componentType=SHORT,_e.normalized=!0,_e.array=o.encodeFilterQuat(it,h.getCount(),_e.byteStride,b);break;default:throw new Error("Invalid filter.")}_e.min=h.getMin([]),_e.max=h.getMax([]),h.getNormalized()&&(_e.min=_e.min.map(nt=>decodeNormalizedInt(nt,h.getComponentType())),_e.max=_e.max.map(nt=>decodeNormalizedInt(nt,h.getComponentType()))),_e.normalized&&(_e.min=_e.min.map(nt=>encodeNormalizedInt(nt,_e.componentType)),_e.max=_e.max.map(nt=>encodeNormalizedInt(nt,_e.componentType)))}else _e.byteStride%4&&(_e.array=padArrayElements(_e.array,h.getElementSize()),_e.byteStride=_e.array.byteLength/h.getCount());return _e}function decodeNormalizedIntArray(h){const o=h.getComponentType(),c=h.getArray(),d=new Float32Array(c.length);for(let _=0;_<c.length;_++)d[_]=decodeNormalizedInt(c[_],o);return d}function padArrayElements(h,o){const c=index_modern_BufferUtils.padNumber(h.BYTES_PER_ELEMENT*o)/h.BYTES_PER_ELEMENT,d=h.length/o,_=new h.constructor(d*c);for(let b=0;b*o<h.length;b++)for(let _e=0;_e<o;_e++)_[b*c+_e]=h[b*o+_e];return _}function padNormals(h){const o=new Float32Array(4*h.length/3);for(let c=0,d=h.length/3;c<d;c++)o[4*c]=h[3*c],o[4*c+1]=h[3*c+1],o[4*c+2]=h[3*c+2];return o}function getMeshoptMode(h,o){return o===WriterContext.BufferViewUsage.ELEMENT_ARRAY_BUFFER?h.listParents().some(c=>c instanceof index_modern_Primitive&&c.getMode()===index_modern_Primitive.Mode.TRIANGLES)?MeshoptMode.TRIANGLES:MeshoptMode.INDICES:MeshoptMode.ATTRIBUTES}function getMeshoptFilter(h,o){const c=o.getGraph().listParentEdges(h).filter(d=>!(d.getParent()instanceof index_modern_Root));for(const d of c){const _=d.getName(),b=d.getAttributes().key||"",_e=d.getParent().propertyType===index_modern_PropertyType.PRIMITIVE_TARGET;if(_==="indices")return{filter:MeshoptFilter.NONE};if(_==="attributes"){if(b==="POSITION")return{filter:MeshoptFilter.NONE};if(b==="TEXCOORD_0")return{filter:MeshoptFilter.NONE};if(b.startsWith("JOINTS_"))return{filter:MeshoptFilter.NONE};if(b.startsWith("WEIGHTS_"))return{filter:MeshoptFilter.NONE};if(b==="NORMAL"||b==="TANGENT")return _e?{filter:MeshoptFilter.NONE}:{filter:MeshoptFilter.OCTAHEDRAL,bits:8}}if(_==="output"){const it=getTargetPath(h);return it==="rotation"?{filter:MeshoptFilter.QUATERNION,bits:16}:it==="translation"||it==="scale"?{filter:MeshoptFilter.EXPONENTIAL,bits:12}:{filter:MeshoptFilter.NONE}}if(_==="input")return{filter:MeshoptFilter.NONE};if(_==="inverseBindMatrices")return{filter:MeshoptFilter.NONE}}return{filter:MeshoptFilter.NONE}}function getTargetPath(h){for(const o of h.listParents())if(o instanceof index_modern_AnimationSampler){for(const c of o.listParents())if(c instanceof index_modern_AnimationChannel)return c.getTargetPath()}return null}function isFallbackBuffer(h){return!(!h.extensions||!h.extensions[EXT_MESHOPT_COMPRESSION])&&!!h.extensions[EXT_MESHOPT_COMPRESSION].fallback}const NAME$n=EXT_MESHOPT_COMPRESSION,DEFAULT_ENCODER_OPTIONS$1={method:EncoderMethod$1.QUANTIZE};class index_modern_EXTMeshoptCompression extends Extension{constructor(...o){super(...o),this.extensionName=NAME$n,this.prereadTypes=[index_modern_PropertyType.BUFFER,index_modern_PropertyType.PRIMITIVE],this.prewriteTypes=[index_modern_PropertyType.BUFFER,index_modern_PropertyType.ACCESSOR],this.readDependencies=["meshopt.decoder"],this.writeDependencies=["meshopt.encoder"],this._decoder=null,this._decoderFallbackBufferMap=new Map,this._encoder=null,this._encoderOptions=DEFAULT_ENCODER_OPTIONS$1,this._encoderFallbackBuffer=null,this._encoderBufferViews={},this._encoderBufferViewData={},this._encoderBufferViewAccessors={}}install(o,c){return o==="meshopt.decoder"&&(this._decoder=c),o==="meshopt.encoder"&&(this._encoder=c),this}setEncoderOptions(o){return this._encoderOptions=dist_index_modern_extends({},DEFAULT_ENCODER_OPTIONS$1,o),this}preread(o,c){if(!this._decoder){if(!this.isRequired())return this;throw new Error(`[${NAME$n}] Please install extension dependency, "meshopt.decoder".`)}if(!this._decoder.supported){if(!this.isRequired())return this;throw new Error(`[${NAME$n}]: Missing WASM support.`)}return c===index_modern_PropertyType.BUFFER?this._prereadBuffers(o):c===index_modern_PropertyType.PRIMITIVE&&this._prereadPrimitives(o),this}_prereadBuffers(o){const c=o.jsonDoc;(c.json.bufferViews||[]).forEach((d,_)=>{if(!d.extensions||!d.extensions[NAME$n])return;const b=d.extensions[NAME$n],_e=b.byteOffset||0,it=b.byteLength||0,nt=b.count,at=b.byteStride,ut=new Uint8Array(nt*at),pt=c.json.buffers[b.buffer],mt=pt.uri?c.resources[pt.uri]:c.resources[GLB_BUFFER],ft=index_modern_BufferUtils.toView(mt,_e,it);this._decoder.decodeGltfBuffer(ut,nt,at,ft,b.mode,b.filter),o.bufferViews[_]=ut})}_prereadPrimitives(o){const c=o.jsonDoc;(c.json.bufferViews||[]).forEach(d=>{if(!d.extensions||!d.extensions[NAME$n])return;const _=d.extensions[NAME$n],b=o.buffers[_.buffer],_e=o.buffers[d.buffer];isFallbackBuffer(c.json.buffers[d.buffer])&&this._decoderFallbackBufferMap.set(_e,b)})}read(o){if(!this.isRequired())return this;for(const[c,d]of this._decoderFallbackBufferMap){for(const _ of c.listParents())_ instanceof index_modern_Accessor&&_.swap(c,d);c.dispose()}return this}prewrite(o,c){return c===index_modern_PropertyType.ACCESSOR?this._prewriteAccessors(o):c===index_modern_PropertyType.BUFFER&&this._prewriteBuffers(o),this}_prewriteAccessors(o){const c=o.jsonDoc.json,d=this._encoder,_=this._encoderOptions,b=this.document.getGraph(),_e=this.document.createBuffer(),it=this.document.getRoot().listBuffers().indexOf(_e);let nt=1;const at=new Map,ut=pt=>{for(const mt of b.listParents(pt)){if(mt.propertyType===index_modern_PropertyType.ROOT)continue;let ft=at.get(pt);return ft===void 0&&at.set(pt,ft=nt++),ft}return-1};this._encoderFallbackBuffer=_e,this._encoderBufferViews={},this._encoderBufferViewData={},this._encoderBufferViewAccessors={};for(const pt of this.document.getRoot().listAccessors()){if(getTargetPath(pt)==="weights"||pt.getSparse())continue;const mt=o.getAccessorUsage(pt),ft=o.accessorUsageGroupedByParent.has(mt)?ut(pt):null,vt=getMeshoptMode(pt,mt),xt=_.method===EncoderMethod$1.FILTER?getMeshoptFilter(pt,this.document):{filter:MeshoptFilter.NONE},At=prepareAccessor(pt,d,vt,xt),{array:Ct,byteStride:Et}=At,Tt=pt.getBuffer();if(!Tt)throw new Error(`${NAME$n}: Missing buffer for accessor.`);const kt=this.document.getRoot().listBuffers().indexOf(Tt),Dt=[mt,ft,vt,xt.filter,Et,kt].join(":");let zt=this._encoderBufferViews[Dt],Bt=this._encoderBufferViewData[Dt],Rt=this._encoderBufferViewAccessors[Dt];zt&&Bt||(Rt=this._encoderBufferViewAccessors[Dt]=[],Bt=this._encoderBufferViewData[Dt]=[],zt=this._encoderBufferViews[Dt]={buffer:it,target:WriterContext.USAGE_TO_TARGET[mt],byteOffset:0,byteLength:0,byteStride:mt===WriterContext.BufferViewUsage.ARRAY_BUFFER?Et:void 0,extensions:{[NAME$n]:{buffer:kt,byteOffset:0,byteLength:0,mode:vt,filter:xt.filter!==MeshoptFilter.NONE?xt.filter:void 0,byteStride:Et,count:0}}});const Ut=o.createAccessorDef(pt);Ut.componentType=At.componentType,Ut.normalized=At.normalized,Ut.byteOffset=zt.byteLength,Ut.min&&At.min&&(Ut.min=At.min),Ut.max&&At.max&&(Ut.max=At.max),o.accessorIndexMap.set(pt,c.accessors.length),c.accessors.push(Ut),Rt.push(Ut),Bt.push(new Uint8Array(Ct.buffer,Ct.byteOffset,Ct.byteLength)),zt.byteLength+=Ct.byteLength,zt.extensions.EXT_meshopt_compression.count+=pt.getCount()}}_prewriteBuffers(o){const c=this._encoder;for(const d in this._encoderBufferViews){const _=this._encoderBufferViews[d],b=this._encoderBufferViewData[d],_e=this.document.getRoot().listBuffers()[_.extensions[NAME$n].buffer],it=o.otherBufferViews.get(_e)||[],{count:nt,byteStride:at,mode:ut}=_.extensions[NAME$n],pt=index_modern_BufferUtils.concat(b),mt=c.encodeGltfBuffer(pt,nt,at,ut),ft=index_modern_BufferUtils.pad(mt);_.extensions[NAME$n].byteLength=mt.byteLength,b.length=0,b.push(ft),it.push(ft),o.otherBufferViews.set(_e,it)}}write(o){let c=0;for(const _e in this._encoderBufferViews){const it=this._encoderBufferViews[_e],nt=this._encoderBufferViewData[_e][0],at=o.otherBufferViewsIndexMap.get(nt),ut=this._encoderBufferViewAccessors[_e];for(const ft of ut)ft.bufferView=at;const pt=o.jsonDoc.json.bufferViews[at],mt=pt.byteOffset||0;Object.assign(pt,it),pt.byteOffset=c,pt.extensions[NAME$n].byteOffset=mt,c+=index_modern_BufferUtils.padNumber(it.byteLength)}const d=this._encoderFallbackBuffer,_=o.bufferIndexMap.get(d),b=o.jsonDoc.json.buffers[_];return b.byteLength=c,b.extensions={[NAME$n]:{fallback:!0}},d.dispose(),this}}index_modern_EXTMeshoptCompression.EXTENSION_NAME=NAME$n,index_modern_EXTMeshoptCompression.EncoderMethod=EncoderMethod$1;const NAME$m=EXT_TEXTURE_AVIF;class AVIFImageUtils{match(o){return o.length>=12&&index_modern_BufferUtils.decodeText(o.slice(4,12))==="ftypavif"}getSize(o){if(!this.match(o))return null;const c=new DataView(o.buffer,o.byteOffset,o.byteLength);let d=unbox(c,0);if(!d)return null;let _=d.end;for(;d=unbox(c,_);)if(d.type==="meta")_=d.start+4;else if(d.type==="iprp"||d.type==="ipco")_=d.start;else{if(d.type==="ispe")return[c.getUint32(d.start+4),c.getUint32(d.start+8)];if(d.type==="mdat")break;_=d.end}return null}getChannels(o){return 4}}class index_modern_EXTTextureAVIF extends Extension{constructor(...o){super(...o),this.extensionName=NAME$m,this.prereadTypes=[index_modern_PropertyType.TEXTURE]}static register(){index_modern_ImageUtils.registerFormat("image/avif",new AVIFImageUtils)}preread(o){return(o.jsonDoc.json.textures||[]).forEach(c=>{c.extensions&&c.extensions[NAME$m]&&(c.source=c.extensions[NAME$m].source)}),this}read(o){return this}write(o){const c=o.jsonDoc;return this.document.getRoot().listTextures().forEach(d=>{if(d.getMimeType()==="image/avif"){const _=o.imageIndexMap.get(d);(c.json.textures||[]).forEach(b=>{b.source===_&&(b.extensions=b.extensions||{},b.extensions[NAME$m]={source:b.source},delete b.source)})}}),this}}function unbox(h,o){if(h.byteLength<4+o)return null;const c=h.getUint32(o);return h.byteLength<c+o||c<8?null:{type:index_modern_BufferUtils.decodeText(new Uint8Array(h.buffer,h.byteOffset+o+4,4)),start:o+8,end:o+c}}index_modern_EXTTextureAVIF.EXTENSION_NAME=NAME$m;const NAME$l=EXT_TEXTURE_WEBP;class WEBPImageUtils{match(o){return o.length>=12&&o[8]===87&&o[9]===69&&o[10]===66&&o[11]===80}getSize(o){const c=index_modern_BufferUtils.decodeText(o.slice(0,4)),d=index_modern_BufferUtils.decodeText(o.slice(8,12));if(c!=="RIFF"||d!=="WEBP")return null;const _=new DataView(o.buffer,o.byteOffset);let b=12;for(;b<_.byteLength;){const _e=index_modern_BufferUtils.decodeText(new Uint8Array([_.getUint8(b),_.getUint8(b+1),_.getUint8(b+2),_.getUint8(b+3)])),it=_.getUint32(b+4,!0);if(_e==="VP8 ")return[16383&_.getInt16(b+14,!0),16383&_.getInt16(b+16,!0)];if(_e==="VP8L"){const nt=_.getUint8(b+9),at=_.getUint8(b+10),ut=_.getUint8(b+11);return[1+((63&at)<<8|nt),1+((15&_.getUint8(b+12))<<10|ut<<2|(192&at)>>6)]}b+=8+it+it%2}return null}getChannels(o){return 4}}class index_modern_EXTTextureWebP extends Extension{constructor(...o){super(...o),this.extensionName=NAME$l,this.prereadTypes=[index_modern_PropertyType.TEXTURE]}static register(){index_modern_ImageUtils.registerFormat("image/webp",new WEBPImageUtils)}preread(o){return(o.jsonDoc.json.textures||[]).forEach(c=>{c.extensions&&c.extensions[NAME$l]&&(c.source=c.extensions[NAME$l].source)}),this}read(o){return this}write(o){const c=o.jsonDoc;return this.document.getRoot().listTextures().forEach(d=>{if(d.getMimeType()==="image/webp"){const _=o.imageIndexMap.get(d);(c.json.textures||[]).forEach(b=>{b.source===_&&(b.extensions=b.extensions||{},b.extensions[NAME$l]={source:b.source},delete b.source)})}}),this}}index_modern_EXTTextureWebP.EXTENSION_NAME=NAME$l;const NAME$k=KHR_DRACO_MESH_COMPRESSION;let decoderModule,COMPONENT_ARRAY,DATA_TYPE,encoderModule;function decodeGeometry(h,o){const c=new decoderModule.DecoderBuffer;try{if(c.Init(o,o.length),h.GetEncodedGeometryType(c)!==decoderModule.TRIANGULAR_MESH)throw new Error(`[${NAME$k}] Unknown geometry type.`);const d=new decoderModule.Mesh;if(!h.DecodeBufferToMesh(c,d).ok()||d.ptr===0)throw new Error(`[${NAME$k}] Decoding failure.`);return d}finally{decoderModule.destroy(c)}}function decodeIndex(h,o){const c=3*o.num_faces();let d,_;if(o.num_points()<=65534){const b=c*Uint16Array.BYTES_PER_ELEMENT;d=decoderModule._malloc(b),h.GetTrianglesUInt16Array(o,b,d),_=new Uint16Array(decoderModule.HEAPU16.buffer,d,c).slice()}else{const b=c*Uint32Array.BYTES_PER_ELEMENT;d=decoderModule._malloc(b),h.GetTrianglesUInt32Array(o,b,d),_=new Uint32Array(decoderModule.HEAPU32.buffer,d,c).slice()}return decoderModule._free(d),_}function decodeAttribute(h,o,c,d){const _=DATA_TYPE[d.componentType],b=COMPONENT_ARRAY[d.componentType],_e=c.num_components(),it=o.num_points()*_e,nt=it*b.BYTES_PER_ELEMENT,at=decoderModule._malloc(nt);h.GetAttributeDataArrayForAllPoints(o,c,_,nt,at);const ut=new b(decoderModule.HEAPF32.buffer,at,it).slice();return decoderModule._free(at),ut}function initDecoderModule(h){decoderModule=h,COMPONENT_ARRAY={[index_modern_Accessor.ComponentType.FLOAT]:Float32Array,[index_modern_Accessor.ComponentType.UNSIGNED_INT]:Uint32Array,[index_modern_Accessor.ComponentType.UNSIGNED_SHORT]:Uint16Array,[index_modern_Accessor.ComponentType.UNSIGNED_BYTE]:Uint8Array,[index_modern_Accessor.ComponentType.SHORT]:Int16Array,[index_modern_Accessor.ComponentType.BYTE]:Int8Array},DATA_TYPE={[index_modern_Accessor.ComponentType.FLOAT]:decoderModule.DT_FLOAT32,[index_modern_Accessor.ComponentType.UNSIGNED_INT]:decoderModule.DT_UINT32,[index_modern_Accessor.ComponentType.UNSIGNED_SHORT]:decoderModule.DT_UINT16,[index_modern_Accessor.ComponentType.UNSIGNED_BYTE]:decoderModule.DT_UINT8,[index_modern_Accessor.ComponentType.SHORT]:decoderModule.DT_INT16,[index_modern_Accessor.ComponentType.BYTE]:decoderModule.DT_INT8}}var index_modern_EncoderMethod,AttributeEnum;(function(h){h[h.EDGEBREAKER=1]="EDGEBREAKER",h[h.SEQUENTIAL=0]="SEQUENTIAL"})(index_modern_EncoderMethod||(index_modern_EncoderMethod={})),function(h){h.POSITION="POSITION",h.NORMAL="NORMAL",h.COLOR="COLOR",h.TEX_COORD="TEX_COORD",h.GENERIC="GENERIC"}(AttributeEnum||(AttributeEnum={}));const DEFAULT_QUANTIZATION_BITS={[AttributeEnum.POSITION]:14,[AttributeEnum.NORMAL]:10,[AttributeEnum.COLOR]:8,[AttributeEnum.TEX_COORD]:12,[AttributeEnum.GENERIC]:12},DEFAULT_ENCODER_OPTIONS={decodeSpeed:5,encodeSpeed:5,method:index_modern_EncoderMethod.EDGEBREAKER,quantizationBits:DEFAULT_QUANTIZATION_BITS,quantizationVolume:"mesh"};function initEncoderModule(h){encoderModule=h}function encodeGeometry(h,o=DEFAULT_ENCODER_OPTIONS){const c=dist_index_modern_extends({},DEFAULT_ENCODER_OPTIONS,o);c.quantizationBits=dist_index_modern_extends({},DEFAULT_QUANTIZATION_BITS,o.quantizationBits);const d=new encoderModule.MeshBuilder,_=new encoderModule.Mesh,b=new encoderModule.ExpertEncoder(_),_e={},it=new encoderModule.DracoInt8Array,nt=h.listTargets().length>0;let at=!1;for(const xt of h.listSemantics()){const At=h.getAttribute(xt);if(At.getSparse()){at=!0;continue}const Ct=getAttributeEnum(xt),Et=addAttribute(d,At.getComponentType(),_,encoderModule[Ct],At.getCount(),At.getElementSize(),At.getArray());if(Et===-1)throw new Error(`Error compressing "${xt}" attribute.`);if(_e[xt]=Et,c.quantizationVolume==="mesh"||xt!=="POSITION")b.SetAttributeQuantization(Et,c.quantizationBits[Ct]);else{if(typeof c.quantizationVolume!="object")throw new Error("Invalid quantization volume state.");{const{quantizationVolume:Tt}=c,kt=Math.max(Tt.max[0]-Tt.min[0],Tt.max[1]-Tt.min[1],Tt.max[2]-Tt.min[2]);b.SetAttributeExplicitQuantization(Et,c.quantizationBits[Ct],At.getElementSize(),Tt.min,kt)}}}const ut=h.getIndices();if(!ut)throw new EncodingError("Primitive must have indices.");d.AddFacesToMesh(_,ut.getCount()/3,ut.getArray()),b.SetSpeedOptions(c.encodeSpeed,c.decodeSpeed),b.SetTrackEncodedProperties(!0),c.method===index_modern_EncoderMethod.SEQUENTIAL||nt||at?b.SetEncodingMethod(encoderModule.MESH_SEQUENTIAL_ENCODING):b.SetEncodingMethod(encoderModule.MESH_EDGEBREAKER_ENCODING);const pt=b.EncodeToDracoBuffer(!(nt||at),it);if(pt<=0)throw new EncodingError("Error applying Draco compression.");const mt=new Uint8Array(pt);for(let xt=0;xt<pt;++xt)mt[xt]=it.GetValue(xt);const ft=b.GetNumberOfEncodedPoints(),vt=3*b.GetNumberOfEncodedFaces();return encoderModule.destroy(it),encoderModule.destroy(_),encoderModule.destroy(d),encoderModule.destroy(b),{numVertices:ft,numIndices:vt,data:mt,attributeIDs:_e}}function getAttributeEnum(h){return h==="POSITION"?AttributeEnum.POSITION:h==="NORMAL"?AttributeEnum.NORMAL:h.startsWith("COLOR_")?AttributeEnum.COLOR:h.startsWith("TEXCOORD_")?AttributeEnum.TEX_COORD:AttributeEnum.GENERIC}function addAttribute(h,o,c,d,_,b,_e){switch(o){case index_modern_Accessor.ComponentType.UNSIGNED_BYTE:return h.AddUInt8Attribute(c,d,_,b,_e);case index_modern_Accessor.ComponentType.BYTE:return h.AddInt8Attribute(c,d,_,b,_e);case index_modern_Accessor.ComponentType.UNSIGNED_SHORT:return h.AddUInt16Attribute(c,d,_,b,_e);case index_modern_Accessor.ComponentType.SHORT:return h.AddInt16Attribute(c,d,_,b,_e);case index_modern_Accessor.ComponentType.UNSIGNED_INT:return h.AddUInt32Attribute(c,d,_,b,_e);case index_modern_Accessor.ComponentType.FLOAT:return h.AddFloatAttribute(c,d,_,b,_e);default:throw new Error(`Unexpected component type, "${o}".`)}}class EncodingError extends Error{}const NAME$j=KHR_DRACO_MESH_COMPRESSION;class index_modern_KHRDracoMeshCompression extends Extension{constructor(...o){super(...o),this.extensionName=NAME$j,this.prereadTypes=[index_modern_PropertyType.PRIMITIVE],this.prewriteTypes=[index_modern_PropertyType.ACCESSOR],this.readDependencies=["draco3d.decoder"],this.writeDependencies=["draco3d.encoder"],this._decoderModule=null,this._encoderModule=null,this._encoderOptions={}}install(o,c){return o==="draco3d.decoder"&&(this._decoderModule=c,initDecoderModule(this._decoderModule)),o==="draco3d.encoder"&&(this._encoderModule=c,initEncoderModule(this._encoderModule)),this}setEncoderOptions(o){return this._encoderOptions=o,this}preread(o){if(!this._decoderModule)throw new Error(`[${NAME$j}] Please install extension dependency, "draco3d.decoder".`);const c=this.document.getLogger(),d=o.jsonDoc,_=new Map;try{const b=d.json.meshes||[];for(const _e of b)for(const it of _e.primitives){if(!it.extensions||!it.extensions[NAME$j])continue;const nt=it.extensions[NAME$j];let[at,ut]=_.get(nt.bufferView)||[];if(!ut||!at){const pt=d.json.bufferViews[nt.bufferView],mt=d.json.buffers[pt.buffer],ft=mt.uri?d.resources[mt.uri]:d.resources[GLB_BUFFER],vt=pt.byteOffset||0,xt=pt.byteLength,At=index_modern_BufferUtils.toView(ft,vt,xt);at=new this._decoderModule.Decoder,ut=decodeGeometry(at,At),_.set(nt.bufferView,[at,ut]),c.debug(`[${NAME$j}] Decompressed ${At.byteLength} bytes.`)}for(const pt in it.attributes){const mt=o.jsonDoc.json.accessors[it.attributes[pt]],ft=at.GetAttributeByUniqueId(ut,nt.attributes[pt]),vt=decodeAttribute(at,ut,ft,mt);o.accessors[it.attributes[pt]].setArray(vt)}it.indices!==void 0&&o.accessors[it.indices].setArray(decodeIndex(at,ut))}}finally{for(const[b,_e]of Array.from(_.values()))this._decoderModule.destroy(b),this._decoderModule.destroy(_e)}return this}read(o){return this}prewrite(o,c){if(!this._encoderModule)throw new Error(`[${NAME$j}] Please install extension dependency, "draco3d.encoder".`);const d=this.document.getLogger();d.debug(`[${NAME$j}] Compression options: ${JSON.stringify(this._encoderOptions)}`);const _=listDracoPrimitives(this.document),b=new Map;let _e="mesh";this._encoderOptions.quantizationVolume==="scene"&&(this.document.getRoot().listScenes().length!==1?d.warn(`[${NAME$j}]: quantizationVolume=scene requires exactly 1 scene.`):_e=getBounds(this.document.getRoot().listScenes().pop()));for(const it of Array.from(_.keys())){const nt=_.get(it);if(!nt)throw new Error("Unexpected primitive.");if(b.has(nt)){b.set(nt,b.get(nt));continue}const at=it.getIndices(),ut=o.jsonDoc.json.accessors;let pt;try{pt=encodeGeometry(it,dist_index_modern_extends({},this._encoderOptions,{quantizationVolume:_e}))}catch(vt){if(vt instanceof EncodingError){d.warn(`[${NAME$j}]: ${vt.message} Skipping primitive compression.`);continue}throw vt}b.set(nt,pt);const mt=o.createAccessorDef(at);mt.count=pt.numIndices,o.accessorIndexMap.set(at,ut.length),ut.push(mt),pt.numVertices>65534&&index_modern_Accessor.getComponentSize(mt.componentType)<=2?mt.componentType=index_modern_Accessor.ComponentType.UNSIGNED_INT:pt.numVertices>254&&index_modern_Accessor.getComponentSize(mt.componentType)<=1&&(mt.componentType=index_modern_Accessor.ComponentType.UNSIGNED_SHORT);for(const vt of it.listSemantics()){const xt=it.getAttribute(vt);if(pt.attributeIDs[vt]===void 0)continue;const At=o.createAccessorDef(xt);At.count=pt.numVertices,o.accessorIndexMap.set(xt,ut.length),ut.push(At)}const ft=it.getAttribute("POSITION").getBuffer()||this.document.getRoot().listBuffers()[0];o.otherBufferViews.has(ft)||o.otherBufferViews.set(ft,[]),o.otherBufferViews.get(ft).push(pt.data)}return d.debug(`[${NAME$j}] Compressed ${_.size} primitives.`),o.extensionData[NAME$j]={primitiveHashMap:_,primitiveEncodingMap:b},this}write(o){const c=o.extensionData[NAME$j];for(const d of this.document.getRoot().listMeshes()){const _=o.jsonDoc.json.meshes[o.meshIndexMap.get(d)];for(let b=0;b<d.listPrimitives().length;b++){const _e=d.listPrimitives()[b],it=_.primitives[b],nt=c.primitiveHashMap.get(_e);if(!nt)continue;const at=c.primitiveEncodingMap.get(nt);at&&(it.extensions=it.extensions||{},it.extensions[NAME$j]={bufferView:o.otherBufferViewsIndexMap.get(at.data),attributes:at.attributeIDs})}}if(!c.primitiveHashMap.size){const d=o.jsonDoc.json;d.extensionsUsed=(d.extensionsUsed||[]).filter(_=>_!==NAME$j),d.extensionsRequired=(d.extensionsRequired||[]).filter(_=>_!==NAME$j)}return this}}function listDracoPrimitives(h){const o=h.getLogger(),c=new Set,d=new Set;let _=0,b=0;for(const pt of h.getRoot().listMeshes())for(const mt of pt.listPrimitives())mt.getIndices()?mt.getMode()!==index_modern_Primitive.Mode.TRIANGLES?(d.add(mt),b++):c.add(mt):(d.add(mt),_++);_>0&&o.warn(`[${NAME$j}] Skipping Draco compression of ${_} non-indexed primitives.`),b>0&&o.warn(`[${NAME$j}] Skipping Draco compression of ${b} non-TRIANGLES primitives.`);const _e=h.getRoot().listAccessors(),it=new Map;for(let pt=0;pt<_e.length;pt++)it.set(_e[pt],pt);const nt=new Map,at=new Set,ut=new Map;for(const pt of Array.from(c)){let mt=createHashKey(pt,it);if(at.has(mt))ut.set(pt,mt);else{if(nt.has(pt.getIndices())){const ft=pt.getIndices(),vt=ft.clone();it.set(vt,h.getRoot().listAccessors().length-1),pt.swap(ft,vt)}for(const ft of pt.listAttributes())if(nt.has(ft)){const vt=ft.clone();it.set(vt,h.getRoot().listAccessors().length-1),pt.swap(ft,vt)}mt=createHashKey(pt,it),at.add(mt),ut.set(pt,mt),nt.set(pt.getIndices(),mt);for(const ft of pt.listAttributes())nt.set(ft,mt)}}for(const pt of Array.from(nt.keys())){const mt=new Set(pt.listParents().map(ft=>ft.propertyType));if(mt.size!==2||!mt.has(index_modern_PropertyType.PRIMITIVE)||!mt.has(index_modern_PropertyType.ROOT))throw new Error(`[${NAME$j}] Compressed accessors must only be used as indices or vertex attributes.`)}for(const pt of Array.from(c)){const mt=ut.get(pt),ft=pt.getIndices();if(nt.get(ft)!==mt||pt.listAttributes().some(vt=>nt.get(vt)!==mt))throw new Error(`[${NAME$j}] Draco primitives must share all, or no, accessors.`)}for(const pt of Array.from(d)){const mt=pt.getIndices();if(nt.has(mt)||pt.listAttributes().some(ft=>nt.has(ft)))throw new Error(`[${NAME$j}] Accessor cannot be shared by compressed and uncompressed primitives.`)}return ut}function createHashKey(h,o){const c=[],d=h.getIndices();c.push(o.get(d));for(const _ of h.listAttributes())c.push(o.get(_));return c.sort().join("|")}index_modern_KHRDracoMeshCompression.EXTENSION_NAME=NAME$j,index_modern_KHRDracoMeshCompression.EncoderMethod=index_modern_EncoderMethod;class Light extends index_modern_ExtensionProperty{init(){this.extensionName=KHR_LIGHTS_PUNCTUAL,this.propertyType="Light",this.parentTypes=[index_modern_PropertyType.NODE]}getDefaults(){return Object.assign(super.getDefaults(),{color:[1,1,1],intensity:1,type:Light.Type.POINT,range:null,innerConeAngle:0,outerConeAngle:Math.PI/4})}getColor(){return this.get("color")}setColor(o){return this.set("color",o)}getIntensity(){return this.get("intensity")}setIntensity(o){return this.set("intensity",o)}getType(){return this.get("type")}setType(o){return this.set("type",o)}getRange(){return this.get("range")}setRange(o){return this.set("range",o)}getInnerConeAngle(){return this.get("innerConeAngle")}setInnerConeAngle(o){return this.set("innerConeAngle",o)}getOuterConeAngle(){return this.get("outerConeAngle")}setOuterConeAngle(o){return this.set("outerConeAngle",o)}}Light.EXTENSION_NAME=KHR_LIGHTS_PUNCTUAL,Light.Type={POINT:"point",SPOT:"spot",DIRECTIONAL:"directional"};const NAME$i=KHR_LIGHTS_PUNCTUAL;class KHRLightsPunctual extends Extension{constructor(...o){super(...o),this.extensionName=NAME$i}createLight(o=""){return new Light(this.document.getGraph(),o)}read(o){const c=o.jsonDoc;if(!c.json.extensions||!c.json.extensions[NAME$i])return this;const d=(c.json.extensions[NAME$i].lights||[]).map(_=>{var b,_e;const it=this.createLight().setName(_.name||"").setType(_.type);return _.color!==void 0&&it.setColor(_.color),_.intensity!==void 0&&it.setIntensity(_.intensity),_.range!==void 0&&it.setRange(_.range),((b=_.spot)==null?void 0:b.innerConeAngle)!==void 0&&it.setInnerConeAngle(_.spot.innerConeAngle),((_e=_.spot)==null?void 0:_e.outerConeAngle)!==void 0&&it.setOuterConeAngle(_.spot.outerConeAngle),it});return c.json.nodes.forEach((_,b)=>{if(!_.extensions||!_.extensions[NAME$i])return;const _e=_.extensions[NAME$i];o.nodes[b].setExtension(NAME$i,d[_e.light])}),this}write(o){const c=o.jsonDoc;if(this.properties.size===0)return this;const d=[],_=new Map;for(const b of this.properties){const _e=b,it={type:_e.getType()};index_modern_MathUtils.eq(_e.getColor(),[1,1,1])||(it.color=_e.getColor()),_e.getIntensity()!==1&&(it.intensity=_e.getIntensity()),_e.getRange()!=null&&(it.range=_e.getRange()),_e.getName()&&(it.name=_e.getName()),_e.getType()===Light.Type.SPOT&&(it.spot={innerConeAngle:_e.getInnerConeAngle(),outerConeAngle:_e.getOuterConeAngle()}),d.push(it),_.set(_e,d.length-1)}return this.document.getRoot().listNodes().forEach(b=>{const _e=b.getExtension(NAME$i);if(_e){const it=o.nodeIndexMap.get(b),nt=c.json.nodes[it];nt.extensions=nt.extensions||{},nt.extensions[NAME$i]={light:_.get(_e)}}}),c.json.extensions=c.json.extensions||{},c.json.extensions[NAME$i]={lights:d},this}}KHRLightsPunctual.EXTENSION_NAME=NAME$i;const{R:R$7,G:G$7,B:B$5}=index_modern_TextureChannel;class Anisotropy extends index_modern_ExtensionProperty{init(){this.extensionName=KHR_MATERIALS_ANISOTROPY,this.propertyType="Anisotropy",this.parentTypes=[index_modern_PropertyType.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{anisotropyStrength:0,anisotropyRotation:0,anisotropyTexture:null,anisotropyTextureInfo:new index_modern_TextureInfo(this.graph,"anisotropyTextureInfo")})}getAnisotropyStrength(){return this.get("anisotropyStrength")}setAnisotropyStrength(o){return this.set("anisotropyStrength",o)}getAnisotropyRotation(){return this.get("anisotropyRotation")}setAnisotropyRotation(o){return this.set("anisotropyRotation",o)}getAnisotropyTexture(){return this.getRef("anisotropyTexture")}getAnisotropyTextureInfo(){return this.getRef("anisotropyTexture")?this.getRef("anisotropyTextureInfo"):null}setAnisotropyTexture(o){return this.setRef("anisotropyTexture",o,{channels:R$7|G$7|B$5})}}Anisotropy.EXTENSION_NAME=KHR_MATERIALS_ANISOTROPY;const NAME$h=KHR_MATERIALS_ANISOTROPY;class KHRMaterialsAnisotropy extends Extension{constructor(...o){super(...o),this.extensionName=NAME$h,this.prereadTypes=[index_modern_PropertyType.MESH],this.prewriteTypes=[index_modern_PropertyType.MESH]}createAnisotropy(){return new Anisotropy(this.document.getGraph())}read(o){return this}write(o){return this}preread(o){const c=o.jsonDoc,d=c.json.materials||[],_=c.json.textures||[];return d.forEach((b,_e)=>{if(b.extensions&&b.extensions[NAME$h]){const it=this.createAnisotropy();o.materials[_e].setExtension(NAME$h,it);const nt=b.extensions[NAME$h];if(nt.anisotropyStrength!==void 0&&it.setAnisotropyStrength(nt.anisotropyStrength),nt.anisotropyRotation!==void 0&&it.setAnisotropyRotation(nt.anisotropyRotation),nt.anisotropyTexture!==void 0){const at=nt.anisotropyTexture,ut=o.textures[_[at.index].source];it.setAnisotropyTexture(ut),o.setTextureInfo(it.getAnisotropyTextureInfo(),at)}}}),this}prewrite(o){const c=o.jsonDoc;return this.document.getRoot().listMaterials().forEach(d=>{const _=d.getExtension(NAME$h);if(_){const b=o.materialIndexMap.get(d),_e=c.json.materials[b];_e.extensions=_e.extensions||{};const it=_e.extensions[NAME$h]={};if(_.getAnisotropyStrength()>0&&(it.anisotropyStrength=_.getAnisotropyStrength()),_.getAnisotropyRotation()!==0&&(it.anisotropyRotation=_.getAnisotropyRotation()),_.getAnisotropyTexture()){const nt=_.getAnisotropyTexture(),at=_.getAnisotropyTextureInfo();it.anisotropyTexture=o.createTextureInfoDef(nt,at)}}}),this}}KHRMaterialsAnisotropy.EXTENSION_NAME=NAME$h;const{R:R$6,G:G$6,B:B$4}=index_modern_TextureChannel;class Clearcoat extends index_modern_ExtensionProperty{init(){this.extensionName=KHR_MATERIALS_CLEARCOAT,this.propertyType="Clearcoat",this.parentTypes=[index_modern_PropertyType.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{clearcoatFactor:0,clearcoatTexture:null,clearcoatTextureInfo:new index_modern_TextureInfo(this.graph,"clearcoatTextureInfo"),clearcoatRoughnessFactor:0,clearcoatRoughnessTexture:null,clearcoatRoughnessTextureInfo:new index_modern_TextureInfo(this.graph,"clearcoatRoughnessTextureInfo"),clearcoatNormalScale:1,clearcoatNormalTexture:null,clearcoatNormalTextureInfo:new index_modern_TextureInfo(this.graph,"clearcoatNormalTextureInfo")})}getClearcoatFactor(){return this.get("clearcoatFactor")}setClearcoatFactor(o){return this.set("clearcoatFactor",o)}getClearcoatTexture(){return this.getRef("clearcoatTexture")}getClearcoatTextureInfo(){return this.getRef("clearcoatTexture")?this.getRef("clearcoatTextureInfo"):null}setClearcoatTexture(o){return this.setRef("clearcoatTexture",o,{channels:R$6})}getClearcoatRoughnessFactor(){return this.get("clearcoatRoughnessFactor")}setClearcoatRoughnessFactor(o){return this.set("clearcoatRoughnessFactor",o)}getClearcoatRoughnessTexture(){return this.getRef("clearcoatRoughnessTexture")}getClearcoatRoughnessTextureInfo(){return this.getRef("clearcoatRoughnessTexture")?this.getRef("clearcoatRoughnessTextureInfo"):null}setClearcoatRoughnessTexture(o){return this.setRef("clearcoatRoughnessTexture",o,{channels:G$6})}getClearcoatNormalScale(){return this.get("clearcoatNormalScale")}setClearcoatNormalScale(o){return this.set("clearcoatNormalScale",o)}getClearcoatNormalTexture(){return this.getRef("clearcoatNormalTexture")}getClearcoatNormalTextureInfo(){return this.getRef("clearcoatNormalTexture")?this.getRef("clearcoatNormalTextureInfo"):null}setClearcoatNormalTexture(o){return this.setRef("clearcoatNormalTexture",o,{channels:R$6|G$6|B$4})}}Clearcoat.EXTENSION_NAME=KHR_MATERIALS_CLEARCOAT;const NAME$g=KHR_MATERIALS_CLEARCOAT;class KHRMaterialsClearcoat extends Extension{constructor(...o){super(...o),this.extensionName=NAME$g,this.prereadTypes=[index_modern_PropertyType.MESH],this.prewriteTypes=[index_modern_PropertyType.MESH]}createClearcoat(){return new Clearcoat(this.document.getGraph())}read(o){return this}write(o){return this}preread(o){const c=o.jsonDoc,d=c.json.materials||[],_=c.json.textures||[];return d.forEach((b,_e)=>{if(b.extensions&&b.extensions[NAME$g]){const it=this.createClearcoat();o.materials[_e].setExtension(NAME$g,it);const nt=b.extensions[NAME$g];if(nt.clearcoatFactor!==void 0&&it.setClearcoatFactor(nt.clearcoatFactor),nt.clearcoatRoughnessFactor!==void 0&&it.setClearcoatRoughnessFactor(nt.clearcoatRoughnessFactor),nt.clearcoatTexture!==void 0){const at=nt.clearcoatTexture,ut=o.textures[_[at.index].source];it.setClearcoatTexture(ut),o.setTextureInfo(it.getClearcoatTextureInfo(),at)}if(nt.clearcoatRoughnessTexture!==void 0){const at=nt.clearcoatRoughnessTexture,ut=o.textures[_[at.index].source];it.setClearcoatRoughnessTexture(ut),o.setTextureInfo(it.getClearcoatRoughnessTextureInfo(),at)}if(nt.clearcoatNormalTexture!==void 0){const at=nt.clearcoatNormalTexture,ut=o.textures[_[at.index].source];it.setClearcoatNormalTexture(ut),o.setTextureInfo(it.getClearcoatNormalTextureInfo(),at),at.scale!==void 0&&it.setClearcoatNormalScale(at.scale)}}}),this}prewrite(o){const c=o.jsonDoc;return this.document.getRoot().listMaterials().forEach(d=>{const _=d.getExtension(NAME$g);if(_){const b=o.materialIndexMap.get(d),_e=c.json.materials[b];_e.extensions=_e.extensions||{};const it=_e.extensions[NAME$g]={clearcoatFactor:_.getClearcoatFactor(),clearcoatRoughnessFactor:_.getClearcoatRoughnessFactor()};if(_.getClearcoatTexture()){const nt=_.getClearcoatTexture(),at=_.getClearcoatTextureInfo();it.clearcoatTexture=o.createTextureInfoDef(nt,at)}if(_.getClearcoatRoughnessTexture()){const nt=_.getClearcoatRoughnessTexture(),at=_.getClearcoatRoughnessTextureInfo();it.clearcoatRoughnessTexture=o.createTextureInfoDef(nt,at)}if(_.getClearcoatNormalTexture()){const nt=_.getClearcoatNormalTexture(),at=_.getClearcoatNormalTextureInfo();it.clearcoatNormalTexture=o.createTextureInfoDef(nt,at),_.getClearcoatNormalScale()!==1&&(it.clearcoatNormalTexture.scale=_.getClearcoatNormalScale())}}}),this}}KHRMaterialsClearcoat.EXTENSION_NAME=NAME$g;const{R:R$5,G:G$5,B:B$3,A:A$3}=index_modern_TextureChannel;class DiffuseTransmission extends index_modern_ExtensionProperty{init(){this.extensionName=KHR_MATERIALS_DIFFUSE_TRANSMISSION,this.propertyType="DiffuseTransmission",this.parentTypes=[index_modern_PropertyType.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{diffuseTransmissionFactor:0,diffuseTransmissionTexture:null,diffuseTransmissionTextureInfo:new index_modern_TextureInfo(this.graph,"diffuseTransmissionTextureInfo"),diffuseTransmissionColorFactor:[1,1,1],diffuseTransmissionColorTexture:null,diffuseTransmissionColorTextureInfo:new index_modern_TextureInfo(this.graph,"diffuseTransmissionColorTextureInfo")})}getDiffuseTransmissionFactor(){return this.get("diffuseTransmissionFactor")}setDiffuseTransmissionFactor(o){return this.set("diffuseTransmissionFactor",o)}getDiffuseTransmissionTexture(){return this.getRef("diffuseTransmissionTexture")}getDiffuseTransmissionTextureInfo(){return this.getRef("diffuseTransmissionTexture")?this.getRef("diffuseTransmissionTextureInfo"):null}setDiffuseTransmissionTexture(o){return this.setRef("diffuseTransmissionTexture",o,{channels:A$3})}getDiffuseTransmissionColorFactor(){return this.get("diffuseTransmissionColorFactor")}setDiffuseTransmissionColorFactor(o){return this.set("diffuseTransmissionColorFactor",o)}getDiffuseTransmissionColorTexture(){return this.getRef("diffuseTransmissionColorTexture")}getDiffuseTransmissionColorTextureInfo(){return this.getRef("diffuseTransmissionColorTexture")?this.getRef("diffuseTransmissionColorTextureInfo"):null}setDiffuseTransmissionColorTexture(o){return this.setRef("diffuseTransmissionColorTexture",o,{channels:R$5|G$5|B$3})}}DiffuseTransmission.EXTENSION_NAME=KHR_MATERIALS_DIFFUSE_TRANSMISSION;const NAME$f=KHR_MATERIALS_DIFFUSE_TRANSMISSION;class KHRMaterialsDiffuseTransmission extends Extension{constructor(...o){super(...o),this.extensionName=NAME$f}createDiffuseTransmission(){return new DiffuseTransmission(this.document.getGraph())}read(o){const c=o.jsonDoc,d=c.json.materials||[],_=c.json.textures||[];return d.forEach((b,_e)=>{if(b.extensions&&b.extensions[NAME$f]){const it=this.createDiffuseTransmission();o.materials[_e].setExtension(NAME$f,it);const nt=b.extensions[NAME$f];if(nt.diffuseTransmissionFactor!==void 0&&it.setDiffuseTransmissionFactor(nt.diffuseTransmissionFactor),nt.diffuseTransmissionColorFactor!==void 0&&it.setDiffuseTransmissionColorFactor(nt.diffuseTransmissionColorFactor),nt.diffuseTransmissionTexture!==void 0){const at=nt.diffuseTransmissionTexture,ut=o.textures[_[at.index].source];it.setDiffuseTransmissionTexture(ut),o.setTextureInfo(it.getDiffuseTransmissionTextureInfo(),at)}if(nt.diffuseTransmissionColorTexture!==void 0){const at=nt.diffuseTransmissionColorTexture,ut=o.textures[_[at.index].source];it.setDiffuseTransmissionColorTexture(ut),o.setTextureInfo(it.getDiffuseTransmissionColorTextureInfo(),at)}}}),this}write(o){const c=o.jsonDoc;for(const d of this.document.getRoot().listMaterials()){const _=d.getExtension(NAME$f);if(!_)continue;const b=o.materialIndexMap.get(d),_e=c.json.materials[b];_e.extensions=_e.extensions||{};const it=_e.extensions[NAME$f]={diffuseTransmissionFactor:_.getDiffuseTransmissionFactor(),diffuseTransmissionColorFactor:_.getDiffuseTransmissionColorFactor()};if(_.getDiffuseTransmissionTexture()){const nt=_.getDiffuseTransmissionTexture(),at=_.getDiffuseTransmissionTextureInfo();it.diffuseTransmissionTexture=o.createTextureInfoDef(nt,at)}if(_.getDiffuseTransmissionColorTexture()){const nt=_.getDiffuseTransmissionColorTexture(),at=_.getDiffuseTransmissionColorTextureInfo();it.diffuseTransmissionColorTexture=o.createTextureInfoDef(nt,at)}}return this}}KHRMaterialsDiffuseTransmission.EXTENSION_NAME=NAME$f;class Dispersion extends index_modern_ExtensionProperty{init(){this.extensionName=KHR_MATERIALS_DISPERSION,this.propertyType="Dispersion",this.parentTypes=[index_modern_PropertyType.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{dispersion:0})}getDispersion(){return this.get("dispersion")}setDispersion(o){return this.set("dispersion",o)}}Dispersion.EXTENSION_NAME=KHR_MATERIALS_DISPERSION;const NAME$e=KHR_MATERIALS_DISPERSION;class KHRMaterialsDispersion extends Extension{constructor(...o){super(...o),this.extensionName=NAME$e,this.prereadTypes=[index_modern_PropertyType.MESH],this.prewriteTypes=[index_modern_PropertyType.MESH]}createDispersion(){return new Dispersion(this.document.getGraph())}read(o){return this}write(o){return this}preread(o){return(o.jsonDoc.json.materials||[]).forEach((c,d)=>{if(c.extensions&&c.extensions[NAME$e]){const _=this.createDispersion();o.materials[d].setExtension(NAME$e,_);const b=c.extensions[NAME$e];b.dispersion!==void 0&&_.setDispersion(b.dispersion)}}),this}prewrite(o){const c=o.jsonDoc;return this.document.getRoot().listMaterials().forEach(d=>{const _=d.getExtension(NAME$e);if(_){const b=o.materialIndexMap.get(d),_e=c.json.materials[b];_e.extensions=_e.extensions||{},_e.extensions[NAME$e]={dispersion:_.getDispersion()}}}),this}}KHRMaterialsDispersion.EXTENSION_NAME=NAME$e;class EmissiveStrength extends index_modern_ExtensionProperty{init(){this.extensionName=KHR_MATERIALS_EMISSIVE_STRENGTH,this.propertyType="EmissiveStrength",this.parentTypes=[index_modern_PropertyType.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{emissiveStrength:1})}getEmissiveStrength(){return this.get("emissiveStrength")}setEmissiveStrength(o){return this.set("emissiveStrength",o)}}EmissiveStrength.EXTENSION_NAME=KHR_MATERIALS_EMISSIVE_STRENGTH;const NAME$d=KHR_MATERIALS_EMISSIVE_STRENGTH;class KHRMaterialsEmissiveStrength extends Extension{constructor(...o){super(...o),this.extensionName=NAME$d,this.prereadTypes=[index_modern_PropertyType.MESH],this.prewriteTypes=[index_modern_PropertyType.MESH]}createEmissiveStrength(){return new EmissiveStrength(this.document.getGraph())}read(o){return this}write(o){return this}preread(o){return(o.jsonDoc.json.materials||[]).forEach((c,d)=>{if(c.extensions&&c.extensions[NAME$d]){const _=this.createEmissiveStrength();o.materials[d].setExtension(NAME$d,_);const b=c.extensions[NAME$d];b.emissiveStrength!==void 0&&_.setEmissiveStrength(b.emissiveStrength)}}),this}prewrite(o){const c=o.jsonDoc;return this.document.getRoot().listMaterials().forEach(d=>{const _=d.getExtension(NAME$d);if(_){const b=o.materialIndexMap.get(d),_e=c.json.materials[b];_e.extensions=_e.extensions||{},_e.extensions[NAME$d]={emissiveStrength:_.getEmissiveStrength()}}}),this}}KHRMaterialsEmissiveStrength.EXTENSION_NAME=NAME$d;class IOR extends index_modern_ExtensionProperty{init(){this.extensionName=KHR_MATERIALS_IOR,this.propertyType="IOR",this.parentTypes=[index_modern_PropertyType.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{ior:1.5})}getIOR(){return this.get("ior")}setIOR(o){return this.set("ior",o)}}IOR.EXTENSION_NAME=KHR_MATERIALS_IOR;const NAME$c=KHR_MATERIALS_IOR;class KHRMaterialsIOR extends Extension{constructor(...o){super(...o),this.extensionName=NAME$c,this.prereadTypes=[index_modern_PropertyType.MESH],this.prewriteTypes=[index_modern_PropertyType.MESH]}createIOR(){return new IOR(this.document.getGraph())}read(o){return this}write(o){return this}preread(o){return(o.jsonDoc.json.materials||[]).forEach((c,d)=>{if(c.extensions&&c.extensions[NAME$c]){const _=this.createIOR();o.materials[d].setExtension(NAME$c,_);const b=c.extensions[NAME$c];b.ior!==void 0&&_.setIOR(b.ior)}}),this}prewrite(o){const c=o.jsonDoc;return this.document.getRoot().listMaterials().forEach(d=>{const _=d.getExtension(NAME$c);if(_){const b=o.materialIndexMap.get(d),_e=c.json.materials[b];_e.extensions=_e.extensions||{},_e.extensions[NAME$c]={ior:_.getIOR()}}}),this}}KHRMaterialsIOR.EXTENSION_NAME=NAME$c;const{R:R$4,G:G$4}=index_modern_TextureChannel;class Iridescence extends index_modern_ExtensionProperty{init(){this.extensionName=KHR_MATERIALS_IRIDESCENCE,this.propertyType="Iridescence",this.parentTypes=[index_modern_PropertyType.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{iridescenceFactor:0,iridescenceTexture:null,iridescenceTextureInfo:new index_modern_TextureInfo(this.graph,"iridescenceTextureInfo"),iridescenceIOR:1.3,iridescenceThicknessMinimum:100,iridescenceThicknessMaximum:400,iridescenceThicknessTexture:null,iridescenceThicknessTextureInfo:new index_modern_TextureInfo(this.graph,"iridescenceThicknessTextureInfo")})}getIridescenceFactor(){return this.get("iridescenceFactor")}setIridescenceFactor(o){return this.set("iridescenceFactor",o)}getIridescenceTexture(){return this.getRef("iridescenceTexture")}getIridescenceTextureInfo(){return this.getRef("iridescenceTexture")?this.getRef("iridescenceTextureInfo"):null}setIridescenceTexture(o){return this.setRef("iridescenceTexture",o,{channels:R$4})}getIridescenceIOR(){return this.get("iridescenceIOR")}setIridescenceIOR(o){return this.set("iridescenceIOR",o)}getIridescenceThicknessMinimum(){return this.get("iridescenceThicknessMinimum")}setIridescenceThicknessMinimum(o){return this.set("iridescenceThicknessMinimum",o)}getIridescenceThicknessMaximum(){return this.get("iridescenceThicknessMaximum")}setIridescenceThicknessMaximum(o){return this.set("iridescenceThicknessMaximum",o)}getIridescenceThicknessTexture(){return this.getRef("iridescenceThicknessTexture")}getIridescenceThicknessTextureInfo(){return this.getRef("iridescenceThicknessTexture")?this.getRef("iridescenceThicknessTextureInfo"):null}setIridescenceThicknessTexture(o){return this.setRef("iridescenceThicknessTexture",o,{channels:G$4})}}Iridescence.EXTENSION_NAME=KHR_MATERIALS_IRIDESCENCE;const NAME$b=KHR_MATERIALS_IRIDESCENCE;class KHRMaterialsIridescence extends Extension{constructor(...o){super(...o),this.extensionName=NAME$b,this.prereadTypes=[index_modern_PropertyType.MESH],this.prewriteTypes=[index_modern_PropertyType.MESH]}createIridescence(){return new Iridescence(this.document.getGraph())}read(o){return this}write(o){return this}preread(o){const c=o.jsonDoc,d=c.json.materials||[],_=c.json.textures||[];return d.forEach((b,_e)=>{if(b.extensions&&b.extensions[NAME$b]){const it=this.createIridescence();o.materials[_e].setExtension(NAME$b,it);const nt=b.extensions[NAME$b];if(nt.iridescenceFactor!==void 0&&it.setIridescenceFactor(nt.iridescenceFactor),nt.iridescenceIor!==void 0&&it.setIridescenceIOR(nt.iridescenceIor),nt.iridescenceThicknessMinimum!==void 0&&it.setIridescenceThicknessMinimum(nt.iridescenceThicknessMinimum),nt.iridescenceThicknessMaximum!==void 0&&it.setIridescenceThicknessMaximum(nt.iridescenceThicknessMaximum),nt.iridescenceTexture!==void 0){const at=nt.iridescenceTexture,ut=o.textures[_[at.index].source];it.setIridescenceTexture(ut),o.setTextureInfo(it.getIridescenceTextureInfo(),at)}if(nt.iridescenceThicknessTexture!==void 0){const at=nt.iridescenceThicknessTexture,ut=o.textures[_[at.index].source];it.setIridescenceThicknessTexture(ut),o.setTextureInfo(it.getIridescenceThicknessTextureInfo(),at)}}}),this}prewrite(o){const c=o.jsonDoc;return this.document.getRoot().listMaterials().forEach(d=>{const _=d.getExtension(NAME$b);if(_){const b=o.materialIndexMap.get(d),_e=c.json.materials[b];_e.extensions=_e.extensions||{};const it=_e.extensions[NAME$b]={};if(_.getIridescenceFactor()>0&&(it.iridescenceFactor=_.getIridescenceFactor()),_.getIridescenceIOR()!==1.3&&(it.iridescenceIor=_.getIridescenceIOR()),_.getIridescenceThicknessMinimum()!==100&&(it.iridescenceThicknessMinimum=_.getIridescenceThicknessMinimum()),_.getIridescenceThicknessMaximum()!==400&&(it.iridescenceThicknessMaximum=_.getIridescenceThicknessMaximum()),_.getIridescenceTexture()){const nt=_.getIridescenceTexture(),at=_.getIridescenceTextureInfo();it.iridescenceTexture=o.createTextureInfoDef(nt,at)}if(_.getIridescenceThicknessTexture()){const nt=_.getIridescenceThicknessTexture(),at=_.getIridescenceThicknessTextureInfo();it.iridescenceThicknessTexture=o.createTextureInfoDef(nt,at)}}}),this}}KHRMaterialsIridescence.EXTENSION_NAME=NAME$b;const{R:R$3,G:G$3,B:B$2$1,A:A$2}=index_modern_TextureChannel;class PBRSpecularGlossiness extends index_modern_ExtensionProperty{init(){this.extensionName=KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,this.propertyType="PBRSpecularGlossiness",this.parentTypes=[index_modern_PropertyType.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{diffuseFactor:[1,1,1,1],diffuseTexture:null,diffuseTextureInfo:new index_modern_TextureInfo(this.graph,"diffuseTextureInfo"),specularFactor:[1,1,1],glossinessFactor:1,specularGlossinessTexture:null,specularGlossinessTextureInfo:new index_modern_TextureInfo(this.graph,"specularGlossinessTextureInfo")})}getDiffuseFactor(){return this.get("diffuseFactor")}setDiffuseFactor(o){return this.set("diffuseFactor",o)}getDiffuseTexture(){return this.getRef("diffuseTexture")}getDiffuseTextureInfo(){return this.getRef("diffuseTexture")?this.getRef("diffuseTextureInfo"):null}setDiffuseTexture(o){return this.setRef("diffuseTexture",o,{channels:R$3|G$3|B$2$1|A$2,isColor:!0})}getSpecularFactor(){return this.get("specularFactor")}setSpecularFactor(o){return this.set("specularFactor",o)}getGlossinessFactor(){return this.get("glossinessFactor")}setGlossinessFactor(o){return this.set("glossinessFactor",o)}getSpecularGlossinessTexture(){return this.getRef("specularGlossinessTexture")}getSpecularGlossinessTextureInfo(){return this.getRef("specularGlossinessTexture")?this.getRef("specularGlossinessTextureInfo"):null}setSpecularGlossinessTexture(o){return this.setRef("specularGlossinessTexture",o,{channels:R$3|G$3|B$2$1|A$2})}}PBRSpecularGlossiness.EXTENSION_NAME=KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS;const NAME$a=KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS;class KHRMaterialsPBRSpecularGlossiness extends Extension{constructor(...o){super(...o),this.extensionName=NAME$a,this.prereadTypes=[index_modern_PropertyType.MESH],this.prewriteTypes=[index_modern_PropertyType.MESH]}createPBRSpecularGlossiness(){return new PBRSpecularGlossiness(this.document.getGraph())}read(o){return this}write(o){return this}preread(o){const c=o.jsonDoc,d=c.json.materials||[],_=c.json.textures||[];return d.forEach((b,_e)=>{if(b.extensions&&b.extensions[NAME$a]){const it=this.createPBRSpecularGlossiness();o.materials[_e].setExtension(NAME$a,it);const nt=b.extensions[NAME$a];if(nt.diffuseFactor!==void 0&&it.setDiffuseFactor(nt.diffuseFactor),nt.specularFactor!==void 0&&it.setSpecularFactor(nt.specularFactor),nt.glossinessFactor!==void 0&&it.setGlossinessFactor(nt.glossinessFactor),nt.diffuseTexture!==void 0){const at=nt.diffuseTexture,ut=o.textures[_[at.index].source];it.setDiffuseTexture(ut),o.setTextureInfo(it.getDiffuseTextureInfo(),at)}if(nt.specularGlossinessTexture!==void 0){const at=nt.specularGlossinessTexture,ut=o.textures[_[at.index].source];it.setSpecularGlossinessTexture(ut),o.setTextureInfo(it.getSpecularGlossinessTextureInfo(),at)}}}),this}prewrite(o){const c=o.jsonDoc;return this.document.getRoot().listMaterials().forEach(d=>{const _=d.getExtension(NAME$a);if(_){const b=o.materialIndexMap.get(d),_e=c.json.materials[b];_e.extensions=_e.extensions||{};const it=_e.extensions[NAME$a]={diffuseFactor:_.getDiffuseFactor(),specularFactor:_.getSpecularFactor(),glossinessFactor:_.getGlossinessFactor()};if(_.getDiffuseTexture()){const nt=_.getDiffuseTexture(),at=_.getDiffuseTextureInfo();it.diffuseTexture=o.createTextureInfoDef(nt,at)}if(_.getSpecularGlossinessTexture()){const nt=_.getSpecularGlossinessTexture(),at=_.getSpecularGlossinessTextureInfo();it.specularGlossinessTexture=o.createTextureInfoDef(nt,at)}}}),this}}KHRMaterialsPBRSpecularGlossiness.EXTENSION_NAME=NAME$a;const{R:R$2$1,G:G$2$1,B:B$1$1,A:A$1$1}=index_modern_TextureChannel;class Sheen extends index_modern_ExtensionProperty{init(){this.extensionName=KHR_MATERIALS_SHEEN,this.propertyType="Sheen",this.parentTypes=[index_modern_PropertyType.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{sheenColorFactor:[0,0,0],sheenColorTexture:null,sheenColorTextureInfo:new index_modern_TextureInfo(this.graph,"sheenColorTextureInfo"),sheenRoughnessFactor:0,sheenRoughnessTexture:null,sheenRoughnessTextureInfo:new index_modern_TextureInfo(this.graph,"sheenRoughnessTextureInfo")})}getSheenColorFactor(){return this.get("sheenColorFactor")}setSheenColorFactor(o){return this.set("sheenColorFactor",o)}getSheenColorTexture(){return this.getRef("sheenColorTexture")}getSheenColorTextureInfo(){return this.getRef("sheenColorTexture")?this.getRef("sheenColorTextureInfo"):null}setSheenColorTexture(o){return this.setRef("sheenColorTexture",o,{channels:R$2$1|G$2$1|B$1$1,isColor:!0})}getSheenRoughnessFactor(){return this.get("sheenRoughnessFactor")}setSheenRoughnessFactor(o){return this.set("sheenRoughnessFactor",o)}getSheenRoughnessTexture(){return this.getRef("sheenRoughnessTexture")}getSheenRoughnessTextureInfo(){return this.getRef("sheenRoughnessTexture")?this.getRef("sheenRoughnessTextureInfo"):null}setSheenRoughnessTexture(o){return this.setRef("sheenRoughnessTexture",o,{channels:A$1$1})}}Sheen.EXTENSION_NAME=KHR_MATERIALS_SHEEN;const NAME$9=KHR_MATERIALS_SHEEN;class KHRMaterialsSheen extends Extension{constructor(...o){super(...o),this.extensionName=NAME$9,this.prereadTypes=[index_modern_PropertyType.MESH],this.prewriteTypes=[index_modern_PropertyType.MESH]}createSheen(){return new Sheen(this.document.getGraph())}read(o){return this}write(o){return this}preread(o){const c=o.jsonDoc,d=c.json.materials||[],_=c.json.textures||[];return d.forEach((b,_e)=>{if(b.extensions&&b.extensions[NAME$9]){const it=this.createSheen();o.materials[_e].setExtension(NAME$9,it);const nt=b.extensions[NAME$9];if(nt.sheenColorFactor!==void 0&&it.setSheenColorFactor(nt.sheenColorFactor),nt.sheenRoughnessFactor!==void 0&&it.setSheenRoughnessFactor(nt.sheenRoughnessFactor),nt.sheenColorTexture!==void 0){const at=nt.sheenColorTexture,ut=o.textures[_[at.index].source];it.setSheenColorTexture(ut),o.setTextureInfo(it.getSheenColorTextureInfo(),at)}if(nt.sheenRoughnessTexture!==void 0){const at=nt.sheenRoughnessTexture,ut=o.textures[_[at.index].source];it.setSheenRoughnessTexture(ut),o.setTextureInfo(it.getSheenRoughnessTextureInfo(),at)}}}),this}prewrite(o){const c=o.jsonDoc;return this.document.getRoot().listMaterials().forEach(d=>{const _=d.getExtension(NAME$9);if(_){const b=o.materialIndexMap.get(d),_e=c.json.materials[b];_e.extensions=_e.extensions||{};const it=_e.extensions[NAME$9]={sheenColorFactor:_.getSheenColorFactor(),sheenRoughnessFactor:_.getSheenRoughnessFactor()};if(_.getSheenColorTexture()){const nt=_.getSheenColorTexture(),at=_.getSheenColorTextureInfo();it.sheenColorTexture=o.createTextureInfoDef(nt,at)}if(_.getSheenRoughnessTexture()){const nt=_.getSheenRoughnessTexture(),at=_.getSheenRoughnessTextureInfo();it.sheenRoughnessTexture=o.createTextureInfoDef(nt,at)}}}),this}}KHRMaterialsSheen.EXTENSION_NAME=NAME$9;const{R:R$1$1,G:G$1$1,B:dist_index_modern_B,A:dist_index_modern_A}=index_modern_TextureChannel;class Specular extends index_modern_ExtensionProperty{init(){this.extensionName=KHR_MATERIALS_SPECULAR,this.propertyType="Specular",this.parentTypes=[index_modern_PropertyType.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{specularFactor:1,specularTexture:null,specularTextureInfo:new index_modern_TextureInfo(this.graph,"specularTextureInfo"),specularColorFactor:[1,1,1],specularColorTexture:null,specularColorTextureInfo:new index_modern_TextureInfo(this.graph,"specularColorTextureInfo")})}getSpecularFactor(){return this.get("specularFactor")}setSpecularFactor(o){return this.set("specularFactor",o)}getSpecularColorFactor(){return this.get("specularColorFactor")}setSpecularColorFactor(o){return this.set("specularColorFactor",o)}getSpecularTexture(){return this.getRef("specularTexture")}getSpecularTextureInfo(){return this.getRef("specularTexture")?this.getRef("specularTextureInfo"):null}setSpecularTexture(o){return this.setRef("specularTexture",o,{channels:dist_index_modern_A})}getSpecularColorTexture(){return this.getRef("specularColorTexture")}getSpecularColorTextureInfo(){return this.getRef("specularColorTexture")?this.getRef("specularColorTextureInfo"):null}setSpecularColorTexture(o){return this.setRef("specularColorTexture",o,{channels:R$1$1|G$1$1|dist_index_modern_B,isColor:!0})}}Specular.EXTENSION_NAME=KHR_MATERIALS_SPECULAR;const NAME$8=KHR_MATERIALS_SPECULAR;class KHRMaterialsSpecular extends Extension{constructor(...o){super(...o),this.extensionName=NAME$8,this.prereadTypes=[index_modern_PropertyType.MESH],this.prewriteTypes=[index_modern_PropertyType.MESH]}createSpecular(){return new Specular(this.document.getGraph())}read(o){return this}write(o){return this}preread(o){const c=o.jsonDoc,d=c.json.materials||[],_=c.json.textures||[];return d.forEach((b,_e)=>{if(b.extensions&&b.extensions[NAME$8]){const it=this.createSpecular();o.materials[_e].setExtension(NAME$8,it);const nt=b.extensions[NAME$8];if(nt.specularFactor!==void 0&&it.setSpecularFactor(nt.specularFactor),nt.specularColorFactor!==void 0&&it.setSpecularColorFactor(nt.specularColorFactor),nt.specularTexture!==void 0){const at=nt.specularTexture,ut=o.textures[_[at.index].source];it.setSpecularTexture(ut),o.setTextureInfo(it.getSpecularTextureInfo(),at)}if(nt.specularColorTexture!==void 0){const at=nt.specularColorTexture,ut=o.textures[_[at.index].source];it.setSpecularColorTexture(ut),o.setTextureInfo(it.getSpecularColorTextureInfo(),at)}}}),this}prewrite(o){const c=o.jsonDoc;return this.document.getRoot().listMaterials().forEach(d=>{const _=d.getExtension(NAME$8);if(_){const b=o.materialIndexMap.get(d),_e=c.json.materials[b];_e.extensions=_e.extensions||{};const it=_e.extensions[NAME$8]={};if(_.getSpecularFactor()!==1&&(it.specularFactor=_.getSpecularFactor()),index_modern_MathUtils.eq(_.getSpecularColorFactor(),[1,1,1])||(it.specularColorFactor=_.getSpecularColorFactor()),_.getSpecularTexture()){const nt=_.getSpecularTexture(),at=_.getSpecularTextureInfo();it.specularTexture=o.createTextureInfoDef(nt,at)}if(_.getSpecularColorTexture()){const nt=_.getSpecularColorTexture(),at=_.getSpecularColorTextureInfo();it.specularColorTexture=o.createTextureInfoDef(nt,at)}}}),this}}KHRMaterialsSpecular.EXTENSION_NAME=NAME$8;const{R:dist_index_modern_R}=index_modern_TextureChannel;class Transmission extends index_modern_ExtensionProperty{init(){this.extensionName=KHR_MATERIALS_TRANSMISSION,this.propertyType="Transmission",this.parentTypes=[index_modern_PropertyType.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{transmissionFactor:0,transmissionTexture:null,transmissionTextureInfo:new index_modern_TextureInfo(this.graph,"transmissionTextureInfo")})}getTransmissionFactor(){return this.get("transmissionFactor")}setTransmissionFactor(o){return this.set("transmissionFactor",o)}getTransmissionTexture(){return this.getRef("transmissionTexture")}getTransmissionTextureInfo(){return this.getRef("transmissionTexture")?this.getRef("transmissionTextureInfo"):null}setTransmissionTexture(o){return this.setRef("transmissionTexture",o,{channels:dist_index_modern_R})}}Transmission.EXTENSION_NAME=KHR_MATERIALS_TRANSMISSION;const NAME$7=KHR_MATERIALS_TRANSMISSION;class KHRMaterialsTransmission extends Extension{constructor(...o){super(...o),this.extensionName=NAME$7,this.prereadTypes=[index_modern_PropertyType.MESH],this.prewriteTypes=[index_modern_PropertyType.MESH]}createTransmission(){return new Transmission(this.document.getGraph())}read(o){return this}write(o){return this}preread(o){const c=o.jsonDoc,d=c.json.materials||[],_=c.json.textures||[];return d.forEach((b,_e)=>{if(b.extensions&&b.extensions[NAME$7]){const it=this.createTransmission();o.materials[_e].setExtension(NAME$7,it);const nt=b.extensions[NAME$7];if(nt.transmissionFactor!==void 0&&it.setTransmissionFactor(nt.transmissionFactor),nt.transmissionTexture!==void 0){const at=nt.transmissionTexture,ut=o.textures[_[at.index].source];it.setTransmissionTexture(ut),o.setTextureInfo(it.getTransmissionTextureInfo(),at)}}}),this}prewrite(o){const c=o.jsonDoc;return this.document.getRoot().listMaterials().forEach(d=>{const _=d.getExtension(NAME$7);if(_){const b=o.materialIndexMap.get(d),_e=c.json.materials[b];_e.extensions=_e.extensions||{};const it=_e.extensions[NAME$7]={transmissionFactor:_.getTransmissionFactor()};if(_.getTransmissionTexture()){const nt=_.getTransmissionTexture(),at=_.getTransmissionTextureInfo();it.transmissionTexture=o.createTextureInfoDef(nt,at)}}}),this}}KHRMaterialsTransmission.EXTENSION_NAME=NAME$7;class Unlit extends index_modern_ExtensionProperty{init(){this.extensionName=KHR_MATERIALS_UNLIT,this.propertyType="Unlit",this.parentTypes=[index_modern_PropertyType.MATERIAL]}}Unlit.EXTENSION_NAME=KHR_MATERIALS_UNLIT;const NAME$6=KHR_MATERIALS_UNLIT;class index_modern_KHRMaterialsUnlit extends Extension{constructor(...o){super(...o),this.extensionName=NAME$6,this.prereadTypes=[index_modern_PropertyType.MESH],this.prewriteTypes=[index_modern_PropertyType.MESH]}createUnlit(){return new Unlit(this.document.getGraph())}read(o){return this}write(o){return this}preread(o){return(o.jsonDoc.json.materials||[]).forEach((c,d)=>{c.extensions&&c.extensions[NAME$6]&&o.materials[d].setExtension(NAME$6,this.createUnlit())}),this}prewrite(o){const c=o.jsonDoc;return this.document.getRoot().listMaterials().forEach(d=>{if(d.getExtension(NAME$6)){const _=o.materialIndexMap.get(d),b=c.json.materials[_];b.extensions=b.extensions||{},b.extensions[NAME$6]={}}}),this}}index_modern_KHRMaterialsUnlit.EXTENSION_NAME=NAME$6;class Mapping extends index_modern_ExtensionProperty{init(){this.extensionName=KHR_MATERIALS_VARIANTS,this.propertyType="Mapping",this.parentTypes=["MappingList"]}getDefaults(){return Object.assign(super.getDefaults(),{material:null,variants:new RefSet})}getMaterial(){return this.getRef("material")}setMaterial(o){return this.setRef("material",o)}addVariant(o){return this.addRef("variants",o)}removeVariant(o){return this.removeRef("variants",o)}listVariants(){return this.listRefs("variants")}}Mapping.EXTENSION_NAME=KHR_MATERIALS_VARIANTS;class MappingList extends index_modern_ExtensionProperty{init(){this.extensionName=KHR_MATERIALS_VARIANTS,this.propertyType="MappingList",this.parentTypes=[index_modern_PropertyType.PRIMITIVE]}getDefaults(){return Object.assign(super.getDefaults(),{mappings:new RefSet})}addMapping(o){return this.addRef("mappings",o)}removeMapping(o){return this.removeRef("mappings",o)}listMappings(){return this.listRefs("mappings")}}MappingList.EXTENSION_NAME=KHR_MATERIALS_VARIANTS;class Variant extends index_modern_ExtensionProperty{init(){this.extensionName=KHR_MATERIALS_VARIANTS,this.propertyType="Variant",this.parentTypes=["MappingList"]}}Variant.EXTENSION_NAME=KHR_MATERIALS_VARIANTS;const NAME$5=KHR_MATERIALS_VARIANTS;class KHRMaterialsVariants extends Extension{constructor(...o){super(...o),this.extensionName=NAME$5}createMappingList(){return new MappingList(this.document.getGraph())}createVariant(o=""){return new Variant(this.document.getGraph(),o)}createMapping(){return new Mapping(this.document.getGraph())}listVariants(){return Array.from(this.properties).filter(o=>o instanceof Variant)}read(o){const c=o.jsonDoc;if(!c.json.extensions||!c.json.extensions[NAME$5])return this;const d=(c.json.extensions[NAME$5].variants||[]).map(_=>this.createVariant().setName(_.name||""));return(c.json.meshes||[]).forEach((_,b)=>{const _e=o.meshes[b];(_.primitives||[]).forEach((it,nt)=>{if(!it.extensions||!it.extensions[NAME$5])return;const at=this.createMappingList(),ut=it.extensions[NAME$5];for(const pt of ut.mappings){const mt=this.createMapping();pt.material!==void 0&&mt.setMaterial(o.materials[pt.material]);for(const ft of pt.variants||[])mt.addVariant(d[ft]);at.addMapping(mt)}_e.listPrimitives()[nt].setExtension(NAME$5,at)})}),this}write(o){const c=o.jsonDoc,d=this.listVariants();if(!d.length)return this;const _=[],b=new Map;for(const _e of d)b.set(_e,_.length),_.push(o.createPropertyDef(_e));for(const _e of this.document.getRoot().listMeshes()){const it=o.meshIndexMap.get(_e);_e.listPrimitives().forEach((nt,at)=>{const ut=nt.getExtension(NAME$5);if(!ut)return;const pt=o.jsonDoc.json.meshes[it].primitives[at],mt=ut.listMappings().map(ft=>{const vt=o.createPropertyDef(ft),xt=ft.getMaterial();return xt&&(vt.material=o.materialIndexMap.get(xt)),vt.variants=ft.listVariants().map(At=>b.get(At)),vt});pt.extensions=pt.extensions||{},pt.extensions[NAME$5]={mappings:mt}})}return c.json.extensions=c.json.extensions||{},c.json.extensions[NAME$5]={variants:_},this}}KHRMaterialsVariants.EXTENSION_NAME=NAME$5;const{G:dist_index_modern_G}=index_modern_TextureChannel;class Volume extends index_modern_ExtensionProperty{init(){this.extensionName=KHR_MATERIALS_VOLUME,this.propertyType="Volume",this.parentTypes=[index_modern_PropertyType.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{thicknessFactor:0,thicknessTexture:null,thicknessTextureInfo:new index_modern_TextureInfo(this.graph,"thicknessTexture"),attenuationDistance:1/0,attenuationColor:[1,1,1]})}getThicknessFactor(){return this.get("thicknessFactor")}setThicknessFactor(o){return this.set("thicknessFactor",o)}getThicknessTexture(){return this.getRef("thicknessTexture")}getThicknessTextureInfo(){return this.getRef("thicknessTexture")?this.getRef("thicknessTextureInfo"):null}setThicknessTexture(o){return this.setRef("thicknessTexture",o,{channels:dist_index_modern_G})}getAttenuationDistance(){return this.get("attenuationDistance")}setAttenuationDistance(o){return this.set("attenuationDistance",o)}getAttenuationColor(){return this.get("attenuationColor")}setAttenuationColor(o){return this.set("attenuationColor",o)}}Volume.EXTENSION_NAME=KHR_MATERIALS_VOLUME;const NAME$4=KHR_MATERIALS_VOLUME;class KHRMaterialsVolume extends Extension{constructor(...o){super(...o),this.extensionName=NAME$4,this.prereadTypes=[index_modern_PropertyType.MESH],this.prewriteTypes=[index_modern_PropertyType.MESH]}createVolume(){return new Volume(this.document.getGraph())}read(o){return this}write(o){return this}preread(o){const c=o.jsonDoc,d=c.json.materials||[],_=c.json.textures||[];return d.forEach((b,_e)=>{if(b.extensions&&b.extensions[NAME$4]){const it=this.createVolume();o.materials[_e].setExtension(NAME$4,it);const nt=b.extensions[NAME$4];if(nt.thicknessFactor!==void 0&&it.setThicknessFactor(nt.thicknessFactor),nt.attenuationDistance!==void 0&&it.setAttenuationDistance(nt.attenuationDistance),nt.attenuationColor!==void 0&&it.setAttenuationColor(nt.attenuationColor),nt.thicknessTexture!==void 0){const at=nt.thicknessTexture,ut=o.textures[_[at.index].source];it.setThicknessTexture(ut),o.setTextureInfo(it.getThicknessTextureInfo(),at)}}}),this}prewrite(o){const c=o.jsonDoc;return this.document.getRoot().listMaterials().forEach(d=>{const _=d.getExtension(NAME$4);if(_){const b=o.materialIndexMap.get(d),_e=c.json.materials[b];_e.extensions=_e.extensions||{};const it=_e.extensions[NAME$4]={};if(_.getThicknessFactor()>0&&(it.thicknessFactor=_.getThicknessFactor()),Number.isFinite(_.getAttenuationDistance())&&(it.attenuationDistance=_.getAttenuationDistance()),index_modern_MathUtils.eq(_.getAttenuationColor(),[1,1,1])||(it.attenuationColor=_.getAttenuationColor()),_.getThicknessTexture()){const nt=_.getThicknessTexture(),at=_.getThicknessTextureInfo();it.thicknessTexture=o.createTextureInfoDef(nt,at)}}}),this}}KHRMaterialsVolume.EXTENSION_NAME=NAME$4;const NAME$3=index_modern_KHR_MESH_QUANTIZATION;class index_modern_KHRMeshQuantization extends Extension{constructor(...o){super(...o),this.extensionName=NAME$3}read(o){return this}write(o){return this}}index_modern_KHRMeshQuantization.EXTENSION_NAME=NAME$3;const NAME$2=index_modern_KHR_TEXTURE_BASISU;class KTX2ImageUtils{match(o){return o[0]===171&&o[1]===75&&o[2]===84&&o[3]===88&&o[4]===32&&o[5]===50&&o[6]===48&&o[7]===187&&o[8]===13&&o[9]===10&&o[10]===26&&o[11]===10}getSize(o){const c=ktx_parse_modern_read(o);return[c.pixelWidth,c.pixelHeight]}getChannels(o){const c=ktx_parse_modern_read(o).dataFormatDescriptor[0];if(c.colorModel===ktx_parse_modern_KHR_DF_MODEL_ETC1S)return c.samples.length!==2||15&~c.samples[1].channelType?3:4;if(c.colorModel===ktx_parse_modern_KHR_DF_MODEL_UASTC)return(15&c.samples[0].channelType)==3?4:3;throw new Error(`Unexpected KTX2 colorModel, "${c.colorModel}".`)}getVRAMByteLength(o){const c=ktx_parse_modern_read(o),d=this.getChannels(o)>3;let _=0;for(let b=0;b<c.levels.length;b++){const _e=c.levels[b];_e.uncompressedByteLength?_+=_e.uncompressedByteLength:_+=Math.max(1,Math.floor(c.pixelWidth/Math.pow(2,b)))/4*(Math.max(1,Math.floor(c.pixelHeight/Math.pow(2,b)))/4)*(d?16:8)}return _}}class KHRTextureBasisu extends Extension{constructor(...o){super(...o),this.extensionName=NAME$2,this.prereadTypes=[index_modern_PropertyType.TEXTURE]}static register(){index_modern_ImageUtils.registerFormat("image/ktx2",new KTX2ImageUtils)}preread(o){return o.jsonDoc.json.textures.forEach(c=>{if(c.extensions&&c.extensions[NAME$2]){const d=c.extensions[NAME$2];c.source=d.source}}),this}read(o){return this}write(o){const c=o.jsonDoc;return this.document.getRoot().listTextures().forEach(d=>{if(d.getMimeType()==="image/ktx2"){const _=o.imageIndexMap.get(d);c.json.textures.forEach(b=>{b.source===_&&(b.extensions=b.extensions||{},b.extensions[NAME$2]={source:b.source},delete b.source)})}}),this}}KHRTextureBasisu.EXTENSION_NAME=NAME$2;class Transform extends index_modern_ExtensionProperty{init(){this.extensionName=KHR_TEXTURE_TRANSFORM,this.propertyType="Transform",this.parentTypes=[index_modern_PropertyType.TEXTURE_INFO]}getDefaults(){return Object.assign(super.getDefaults(),{offset:[0,0],rotation:0,scale:[1,1],texCoord:null})}getOffset(){return this.get("offset")}setOffset(o){return this.set("offset",o)}getRotation(){return this.get("rotation")}setRotation(o){return this.set("rotation",o)}getScale(){return this.get("scale")}setScale(o){return this.set("scale",o)}getTexCoord(){return this.get("texCoord")}setTexCoord(o){return this.set("texCoord",o)}}Transform.EXTENSION_NAME=KHR_TEXTURE_TRANSFORM;const NAME$1=KHR_TEXTURE_TRANSFORM;class KHRTextureTransform extends Extension{constructor(...o){super(...o),this.extensionName=NAME$1}createTransform(){return new Transform(this.document.getGraph())}read(o){for(const[c,d]of Array.from(o.textureInfos.entries())){if(!d.extensions||!d.extensions[NAME$1])continue;const _=this.createTransform(),b=d.extensions[NAME$1];b.offset!==void 0&&_.setOffset(b.offset),b.rotation!==void 0&&_.setRotation(b.rotation),b.scale!==void 0&&_.setScale(b.scale),b.texCoord!==void 0&&_.setTexCoord(b.texCoord),c.setExtension(NAME$1,_)}return this}write(o){const c=Array.from(o.textureInfoDefMap.entries());for(const[d,_]of c){const b=d.getExtension(NAME$1);if(!b)continue;_.extensions=_.extensions||{};const _e={},it=index_modern_MathUtils.eq;it(b.getOffset(),[0,0])||(_e.offset=b.getOffset()),b.getRotation()!==0&&(_e.rotation=b.getRotation()),it(b.getScale(),[1,1])||(_e.scale=b.getScale()),b.getTexCoord()!=null&&(_e.texCoord=b.getTexCoord()),_.extensions[NAME$1]=_e}return this}}KHRTextureTransform.EXTENSION_NAME=NAME$1;const PARENT_TYPES=[index_modern_PropertyType.ROOT,index_modern_PropertyType.SCENE,index_modern_PropertyType.NODE,index_modern_PropertyType.MESH,index_modern_PropertyType.MATERIAL,index_modern_PropertyType.TEXTURE,index_modern_PropertyType.ANIMATION];class Packet extends index_modern_ExtensionProperty{init(){this.extensionName=KHR_XMP_JSON_LD,this.propertyType="Packet",this.parentTypes=PARENT_TYPES}getDefaults(){return Object.assign(super.getDefaults(),{context:{},properties:{}})}getContext(){return this.get("context")}setContext(o){return this.set("context",dist_index_modern_extends({},o))}listProperties(){return Object.keys(this.get("properties"))}getProperty(o){const c=this.get("properties");return o in c?c[o]:null}setProperty(o,c){this._assertContext(o);const d=dist_index_modern_extends({},this.get("properties"));return c?d[o]=c:delete d[o],this.set("properties",d)}toJSONLD(){return dist_index_modern_extends({"@context":copyJSON(this.get("context"))},copyJSON(this.get("properties")))}fromJSONLD(o){const c=(o=copyJSON(o))["@context"];return c&&this.set("context",c),delete o["@context"],this.set("properties",o)}_assertContext(o){if(!(o.split(":")[0]in this.get("context")))throw new Error(`${KHR_XMP_JSON_LD}: Missing context for term, "${o}".`)}}function copyJSON(h){return JSON.parse(JSON.stringify(h))}Packet.EXTENSION_NAME=KHR_XMP_JSON_LD;const NAME=KHR_XMP_JSON_LD;class KHRXMP extends Extension{constructor(...o){super(...o),this.extensionName=NAME}createPacket(){return new Packet(this.document.getGraph())}listPackets(){return Array.from(this.properties)}read(o){var c;const d=(c=o.jsonDoc.json.extensions)==null?void 0:c[NAME];if(!d||!d.packets)return this;const _=o.jsonDoc.json,b=this.document.getRoot(),_e=d.packets.map(at=>this.createPacket().fromJSONLD(at)),it=[[_.asset],_.scenes,_.nodes,_.meshes,_.materials,_.images,_.animations],nt=[[b],b.listScenes(),b.listNodes(),b.listMeshes(),b.listMaterials(),b.listTextures(),b.listAnimations()];for(let at=0;at<it.length;at++){const ut=it[at]||[];for(let pt=0;pt<ut.length;pt++){const mt=ut[pt];if(mt.extensions&&mt.extensions[NAME]){const ft=mt.extensions[NAME];nt[at][pt].setExtension(NAME,_e[ft.packet])}}}return this}write(o){const{json:c}=o.jsonDoc,d=[];for(const _ of this.properties){d.push(_.toJSONLD());for(const b of _.listParents()){let _e;switch(b.propertyType){case index_modern_PropertyType.ROOT:_e=c.asset;break;case index_modern_PropertyType.SCENE:_e=c.scenes[o.sceneIndexMap.get(b)];break;case index_modern_PropertyType.NODE:_e=c.nodes[o.nodeIndexMap.get(b)];break;case index_modern_PropertyType.MESH:_e=c.meshes[o.meshIndexMap.get(b)];break;case index_modern_PropertyType.MATERIAL:_e=c.materials[o.materialIndexMap.get(b)];break;case index_modern_PropertyType.TEXTURE:_e=c.images[o.imageIndexMap.get(b)];break;case index_modern_PropertyType.ANIMATION:_e=c.animations[o.animationIndexMap.get(b)];break;default:_e=null,this.document.getLogger().warn(`[${NAME}]: Unsupported parent property, "${b.propertyType}"`)}_e&&(_e.extensions=_e.extensions||{},_e.extensions[NAME]={packet:d.length-1})}}return d.length>0&&(c.extensions=c.extensions||{},c.extensions[NAME]={packets:d}),this}}KHRXMP.EXTENSION_NAME=NAME;const KHRONOS_EXTENSIONS=[index_modern_KHRDracoMeshCompression,KHRLightsPunctual,KHRMaterialsAnisotropy,KHRMaterialsClearcoat,KHRMaterialsDiffuseTransmission,KHRMaterialsDispersion,KHRMaterialsEmissiveStrength,KHRMaterialsIOR,KHRMaterialsIridescence,KHRMaterialsPBRSpecularGlossiness,KHRMaterialsSpecular,KHRMaterialsSheen,KHRMaterialsTransmission,index_modern_KHRMaterialsUnlit,KHRMaterialsVariants,KHRMaterialsVolume,index_modern_KHRMeshQuantization,KHRTextureBasisu,KHRTextureTransform,KHRXMP],ALL_EXTENSIONS=[index_modern_EXTMeshGPUInstancing,index_modern_EXTMeshoptCompression,index_modern_EXTTextureAVIF,index_modern_EXTTextureWebP,...KHRONOS_EXTENSIONS];class GLTFDracoExporter extends GLTFExporter2{constructor(o){super(),this._loadedLibs=!1,o=o||{method:index_modern_KHRDracoMeshCompression.EncoderMethod.EDGEBREAKER,encodeSpeed:5},this._io=new WebIO().registerExtensions(ALL_EXTENSIONS).registerExtensions(ALL_WEBGI_EXTENSIONS),this._encoderOptions=o}preload(){return this._loadLibs(),this}async _loadLibs(){if(this._loadedLibs||!this.loader)return;const o=await Promise.all([this.loader.initEncoder(),this.loader.initDecoder()]);this._io.registerDependencies({"draco3d.encoder":o[0],"draco3d.decoder":o[1]}),this._loadedLibs=!0}async parseAsync(o,{compress:c=!1,dracoOptions:d,..._},b=!1){if(!this.loader)return console.error("GLTFDracoExporter: No DRACOLoader2 instance provided"),super.parseAsync(o,_);await this._loadLibs();const _e={..._};c&&(_e.externalImagesInExtras=!0);const it=await new Promise((at,ut)=>this.parse(o,at,ut,_e)),nt=await super.parseAsync(it,_e);if(!c)return nt;try{if(!it)throw new Error("GLTFDracoExporter: gltf is null");let at=it;const ut=at.byteLength||1/0,pt=await(typeof at!="object"||at.byteLength?this._io.readBinary(new Uint8Array(at)):this._io.readJSON({json:at,resources:{}}));if(pt.createExtension(index_modern_KHRDracoMeshCompression).setRequired(!0).setEncoderOptions({...this._encoderOptions,...d??{}}),_e.exportExt==="glb")at=await this._io.writeBinary(pt),isFinite(ut)&&console.log("DRACO Compression ratio: "+(at.byteLength/ut).toFixed(5));else{const ft=await this._io.writeJSON(pt);at=ft.json,Object.values(ft.resources).filter(vt=>vt).length>0&&(console.warn("DRACOExporter: extra resources in resources not supported properly"),at.resources=ft.resources)}at.__isGLTFOutput=!0;const mt=await super.parseAsync(at,_e);if(!mt)throw new Error("GLTFDracoExporter: blob is null");return mt.ext="glb",mt.__uncompressed=nt,mt}catch(at){if(b)throw at;return console.error("Unable to compress glb with DRACO extension"),console.error(at),nt}}addExtension(o){return this._io.registerExtensions([o]),this}createAndAddExtension(o,c){return this.addExtension(createGenericExtensionClass(o,c))}}function addGLTFDracoExporter(h,o,c){return addGLTFExporter(h,o,GLTFDracoExporter,d=>{const _=esm_browser_v4()+".drc",b=d;b.loader=c.registerFile(_),b.loader.setDecoderConfig({type:"js"}),b.loader.preload(!0,!0)})}class GLTFDracoExportPlugin extends AViewerPlugin{constructor(){super(...arguments),this.enabled=!0,this.dependencies=[AssetManagerPlugin,AssetExporterPlugin]}async onAdded(o){await super.onAdded(o);const c=o.getManager().importer,d=o.getManager().exporter;if(!c)throw new Error("GLTFDracoExportPlugin: AssetImporter not found");addGLTFDracoExporter(d,o,c)}}GLTFDracoExportPlugin.PluginType="GLTFDracoExportPlugin";class WebGIViewerExtensionProperty extends index_modern_ExtensionProperty{constructor(){super(...arguments),this.extensionName=viewerGLTFExtension,this.parentTypes=[index_modern_PropertyType.SCENE],this.propertyType="ViewerJSON"}init(){}}class WebGIViewerExtension extends Extension{constructor(){super(...arguments),this.extensionName=viewerGLTFExtension,this._viewerConfig={},this._texturesRef=[],this.required=!0}read(o){var c;return this._viewerConfig={},(c=o.jsonDoc.json.scenes)===null||c===void 0||c.forEach((d,_)=>{if(d.extensions&&d.extensions[viewerGLTFExtension]){const b=new WebGIViewerExtensionProperty(this.document.getGraph());o.scenes[_].setExtension(viewerGLTFExtension,b),this._viewerConfig=d.extensions[viewerGLTFExtension]}}),this}write(o){return this.document.getRoot().listScenes().forEach(c=>{var d;if(c.getExtension(viewerGLTFExtension)){const _=(d=o.jsonDoc.json.scenes)===null||d===void 0?void 0:d[o.jsonDoc.json.scene||0];_&&Object.keys(this._viewerConfig).length>0&&(_.extensions=_.extensions||{},_.extensions[viewerGLTFExtension]=this._viewerConfig,this._texturesRef=[],this._viewerConfig={})}}),this}}WebGIViewerExtension.EXTENSION_NAME=viewerGLTFExtension;class GenericExtensionProperty extends index_modern_ExtensionProperty{addTexture(o,c,d,_=4369){this.setRef(o,d,{channels:_}),this.textures[o]=[c,d]}constructor(o,c,d){super(o,c),this.parentTypes=[index_modern_PropertyType.MATERIAL,index_modern_PropertyType.MESH,index_modern_PropertyType.NODE,index_modern_PropertyType.SCENE],this.propertyType="GenericExtension",this.textures={},this.extensionName=d}init(){}}class GenericExtension extends Extension{constructor(){super(...arguments),this.textureChannels={}}read(o){const c=o.jsonDoc,d=c.json.materials||[],_=c.json.textures||[];return d.forEach((b,_e)=>{var it,nt;if(b.extensions&&b.extensions[this.extensionName]){const at=new GenericExtensionProperty(this.document.getGraph(),"",this.extensionName);o.materials[_e].setExtension(this.extensionName,at);const ut={...b.extensions[this.extensionName]};for(const[pt,mt]of Object.entries(ut))if(typeof(mt==null?void 0:mt.index)=="number"){const ft=mt,vt=(it=_[ft.index])===null||it===void 0?void 0:it.source;if(typeof vt!="number"){console.warn("GLTF Pipeline: source texture not found for texture info",ft);continue}const xt=o.textures[vt],At=new index_modern_TextureInfo(this.document.getGraph()),Ct=(nt=this.textureChannels[pt])!==null&&nt!==void 0?nt:4369;at.addTexture(pt,At,xt,Ct),o.setTextureInfo(At,ft),delete ut[pt]}at.setExtras(ut)}}),(c.json.meshes||[]).forEach((b,_e)=>{if(b.extensions&&b.extensions[this.extensionName]){const it=new GenericExtensionProperty(this.document.getGraph(),"",this.extensionName);o.meshes[_e].setExtension(this.extensionName,it);const nt=b.extensions[this.extensionName];it.setExtras(nt)}}),(c.json.nodes||[]).forEach((b,_e)=>{if(b.extensions&&b.extensions[this.extensionName]){const it=new GenericExtensionProperty(this.document.getGraph(),"",this.extensionName);o.nodes[_e].setExtension(this.extensionName,it);const nt=b.extensions[this.extensionName];it.setExtras(nt)}}),(c.json.scenes||[]).forEach((b,_e)=>{if(b.extensions&&b.extensions[this.extensionName]){const it=new GenericExtensionProperty(this.document.getGraph(),"",this.extensionName);o.scenes[_e].setExtension(this.extensionName,it);const nt=b.extensions[this.extensionName];it.setExtras(nt)}}),this}write(o){const c=o.jsonDoc;return this.document.getRoot().listMaterials().forEach(d=>{const _=d.getExtension(this.extensionName);if(_){const b=o.materialIndexMap.get(d),_e=c.json.materials[b];_e.extensions=_e.extensions||{};const it={..._.getExtras()};for(const[nt,at]of Object.entries(_.textures)){const ut=at[0],pt=at[1];pt&&(it[nt]=o.createTextureInfoDef(pt,ut))}_e.extensions[this.extensionName]=it}}),this.document.getRoot().listMeshes().forEach(d=>{const _=d.getExtension(this.extensionName);if(_){const b=o.meshIndexMap.get(d),_e=c.json.meshes[b];_e.extensions=_e.extensions||{},_e.extensions[this.extensionName]=_.getExtras()}}),this.document.getRoot().listNodes().forEach(d=>{const _=d.getExtension(this.extensionName);if(_){const b=o.nodeIndexMap.get(d),_e=c.json.nodes[b];_e.extensions=_e.extensions||{},_e.extensions[this.extensionName]=_.getExtras()}}),this.document.getRoot().listScenes().forEach(d=>{const _=d.getExtension(this.extensionName);if(_){const b=o.jsonDoc.json.scene||0,_e=c.json.scenes[b];if(!_e)return;_e.extensions=_e.extensions||{},_e.extensions[this.extensionName]=_.getExtras()}}),this}}function stringToChannel(h){let o=0;return h.includes("R")&&(o|=index_modern_TextureChannel.R),h.includes("G")&&(o|=index_modern_TextureChannel.G),h.includes("B")&&(o|=index_modern_TextureChannel.B),h.includes("A")&&(o|=index_modern_TextureChannel.A),o}function createGenericExtensionClass(h,o){var c;return c=class extends GenericExtension{constructor(){super(...arguments),this.extensionName=h,this.textureChannels=o?Object.fromEntries(Object.entries(o).map(([d,_])=>[d,typeof _=="number"?_:stringToChannel(_)])):{}}},c.EXTENSION_NAME=h,c}class BumpMapMaterialExtension extends GenericExtension{constructor(){super(...arguments),this.extensionName=BumpMapMaterialExtension.EXTENSION_NAME,this.textureChannels={bumpTexture:index_modern_TextureChannel.R}}}BumpMapMaterialExtension.EXTENSION_NAME=GLTFMaterialsBumpMapExtensionName;class LightMapMaterialExtension extends GenericExtension{constructor(){super(...arguments),this.extensionName=LightMapMaterialExtension.EXTENSION_NAME,this.textureChannels={lightMapTexture:index_modern_TextureChannel.R|index_modern_TextureChannel.G|index_modern_TextureChannel.B}}}LightMapMaterialExtension.EXTENSION_NAME=GLTFMaterialsLightMapExtensionName;class AlphaMapMaterialExtension extends GenericExtension{constructor(){super(...arguments),this.extensionName=AlphaMapMaterialExtension.EXTENSION_NAME,this.textureChannels={alphaTexture:index_modern_TextureChannel.G}}}AlphaMapMaterialExtension.EXTENSION_NAME=GLTFMaterialsAlphaMapExtensionName;class DisplacementMapMaterialExtension extends GenericExtension{constructor(){super(...arguments),this.extensionName=DisplacementMapMaterialExtension.EXTENSION_NAME,this.textureChannels={displacementTexture:index_modern_TextureChannel.R}}}DisplacementMapMaterialExtension.EXTENSION_NAME=GLTFMaterialsDisplacementMapExtensionName;class DiamondMaterialExtension extends GenericExtension{constructor(){super(...arguments),this.extensionName=DiamondMaterialExtension.EXTENSION_NAME}}DiamondMaterialExtension.EXTENSION_NAME=DiamondPlugin.DIAMOND_GLTF_EXTENSION;class AnimationMarkersExtension extends GenericExtension{constructor(){super(...arguments),this.extensionName=AnimationMarkersExtension.EXTENSION_NAME}}AnimationMarkersExtension.EXTENSION_NAME=GLTFAnimationPlugin.AnimationMarkersExtension;class AnisotropyMaterialExtension extends GenericExtension{constructor(){super(...arguments),this.extensionName=AnisotropyMaterialExtension.EXTENSION_NAME,this.textureChannels={anisotropyDirection:index_modern_TextureChannel.R|index_modern_TextureChannel.G|index_modern_TextureChannel.B}}}AnisotropyMaterialExtension.EXTENSION_NAME=AnisotropyPlugin.ANISOTROPY_GLTF_EXTENSION;class CustomBumpMapMaterialExtension extends GenericExtension{constructor(){super(...arguments),this.extensionName=CustomBumpMapMaterialExtension.EXTENSION_NAME,this.textureChannels={customBumpMap:index_modern_TextureChannel.R|index_modern_TextureChannel.G|index_modern_TextureChannel.B}}}CustomBumpMapMaterialExtension.EXTENSION_NAME=CustomBumpMapPlugin.CUSTOM_BUMP_MAP_GLTF_EXTENSION;class LightExtrasExtension extends GenericExtension{constructor(){super(...arguments),this.extensionName=LightExtrasExtension.EXTENSION_NAME}}LightExtrasExtension.EXTENSION_NAME=webgiLightExtrasExtension;class Object3DExtrasExtension extends GenericExtension{constructor(){super(...arguments),this.extensionName=Object3DExtrasExtension.EXTENSION_NAME}}Object3DExtrasExtension.EXTENSION_NAME=webgiObject3DExtrasExtension;class MaterialExtrasExtension extends GenericExtension{constructor(){super(...arguments),this.extensionName=MaterialExtrasExtension.EXTENSION_NAME}}MaterialExtrasExtension.EXTENSION_NAME=webgiMaterialExtrasExtension;class ClearcoatTintMaterialExtension extends GenericExtension{constructor(){super(...arguments),this.extensionName=ClearcoatTintMaterialExtension.EXTENSION_NAME}}ClearcoatTintMaterialExtension.EXTENSION_NAME=ClearcoatTintPlugin.CLEARCOAT_TINT_GLTF_EXTENSION;class ThinFilmLayerMaterialExtension extends GenericExtension{constructor(){super(...arguments),this.extensionName=ThinFilmLayerMaterialExtension.EXTENSION_NAME}}ThinFilmLayerMaterialExtension.EXTENSION_NAME=ThinFilmLayerPlugin.THIN_FILM_LAYER_GLTF_EXTENSION;class TriplanarMappingMaterialExtension extends GenericExtension{constructor(){super(...arguments),this.extensionName=TriplanarMappingMaterialExtension.EXTENSION_NAME}}TriplanarMappingMaterialExtension.EXTENSION_NAME=TriplanarUVMappingPlugin.TRIPLANAR_GLTF_EXTENSION;class LayeredMaterialExtension extends GenericExtension{constructor(){super(...arguments),this.extensionName=LayeredMaterialExtension.EXTENSION_NAME}}LayeredMaterialExtension.EXTENSION_NAME=LayeredMaterialPlugin.LAYERED_MATERIAL_GLTF_EXTENSION;class SSBevelMaterialExtension extends GenericExtension{constructor(){super(...arguments),this.extensionName=SSBevelMaterialExtension.EXTENSION_NAME}}SSBevelMaterialExtension.EXTENSION_NAME=SSBevelPlugin.SSBEVEL_GLTF_EXTENSION;class NoiseBumpMaterialExtension extends GenericExtension{constructor(){super(...arguments),this.extensionName=NoiseBumpMaterialExtension.EXTENSION_NAME}}NoiseBumpMaterialExtension.EXTENSION_NAME=NoiseBumpMaterialPlugin.NOISE_BUMP_MATERIAL_GLTF_EXTENSION;const ALL_WEBGI_EXTENSIONS=[WebGIViewerExtension,DiamondMaterialExtension,BumpMapMaterialExtension,LightMapMaterialExtension,AlphaMapMaterialExtension,AnimationMarkersExtension,AnisotropyMaterialExtension,CustomBumpMapMaterialExtension,LightExtrasExtension,Object3DExtrasExtension,MaterialExtrasExtension,ClearcoatTintMaterialExtension,ThinFilmLayerMaterialExtension,SSBevelMaterialExtension,TriplanarMappingMaterialExtension,NoiseBumpMaterialExtension,DisplacementMapMaterialExtension,LayeredMaterialExtension];class PMREMGeneratorPlugin extends I$2{constructor(){super(...arguments),this.processor={forAssetType:"texture",process:(o,c)=>o}}async onAdded(o){}async onDispose(o){}async onRemove(o){this._pmrem=void 0}}PMREMGeneratorPlugin.PluginType="PMREMGenerator";const _position=new three_module.Pq0,_quaternion=new three_module.PTz,_scale=new three_module.Pq0;class CSS3DObject extends three_module.B69{constructor(o=document.createElement("div")){super(),this.isCSS3DObject=!0,this.element=o,this.element.style.position="absolute",this.element.style.pointerEvents="auto",this.element.style.userSelect="none",this.element.setAttribute("draggable",!1),this.addEventListener("removed",function(){this.traverse(function(c){c.element instanceof Element&&c.element.parentNode!==null&&c.element.parentNode.removeChild(c.element)})})}copy(o,c){return super.copy(o,c),this.element=o.element.cloneNode(!0),this}}const _matrix=new three_module.kn4,_matrix2=new three_module.kn4;class CSS3DRenderer{constructor(o={}){const c=this;let d,_,b,_e;const it={camera:{fov:0,style:""},objects:new WeakMap},nt=o.element!==void 0?o.element:document.createElement("div");nt.style.overflow="hidden",this.domElement=nt;const at=document.createElement("div");at.style.transformOrigin="0 0",at.style.pointerEvents="none",nt.appendChild(at);const ut=document.createElement("div");function pt(xt){return Math.abs(xt)<1e-10?0:xt}function mt(xt){const At=xt.elements;return"matrix3d("+pt(At[0])+","+pt(-At[1])+","+pt(At[2])+","+pt(At[3])+","+pt(At[4])+","+pt(-At[5])+","+pt(At[6])+","+pt(At[7])+","+pt(At[8])+","+pt(-At[9])+","+pt(At[10])+","+pt(At[11])+","+pt(At[12])+","+pt(-At[13])+","+pt(At[14])+","+pt(At[15])+")"}function ft(xt){const At=xt.elements;return"translate(-50%,-50%)matrix3d("+pt(At[0])+","+pt(At[1])+","+pt(At[2])+","+pt(At[3])+","+pt(-At[4])+","+pt(-At[5])+","+pt(-At[6])+","+pt(-At[7])+","+pt(At[8])+","+pt(At[9])+","+pt(At[10])+","+pt(At[11])+","+pt(At[12])+","+pt(At[13])+","+pt(At[14])+","+pt(At[15])+")"}function vt(xt,At,Ct,Et){if(xt.isCSS3DObject){const Tt=xt.visible===!0&&xt.layers.test(Ct.layers)===!0;if(xt.element.style.display=Tt===!0?"":"none",Tt===!0){let kt;xt.onBeforeRender(c,At,Ct),xt.isCSS3DSprite?(_matrix.copy(Ct.matrixWorldInverse),_matrix.transpose(),xt.rotation2D!==0&&_matrix.multiply(_matrix2.makeRotationZ(xt.rotation2D)),xt.matrixWorld.decompose(_position,_quaternion,_scale),_matrix.setPosition(_position),_matrix.scale(_scale),_matrix.elements[3]=0,_matrix.elements[7]=0,_matrix.elements[11]=0,_matrix.elements[15]=1,kt=ft(_matrix)):kt=ft(xt.matrixWorld);const Dt=xt.element,zt=it.objects.get(xt);if(zt===void 0||zt.style!==kt){Dt.style.transform=kt;const Bt={style:kt};it.objects.set(xt,Bt)}Dt.parentNode!==ut&&ut.appendChild(Dt),xt.onAfterRender(c,At,Ct)}}for(let Tt=0,kt=xt.children.length;Tt<kt;Tt++)vt(xt.children[Tt],At,Ct)}ut.style.transformStyle="preserve-3d",at.appendChild(ut),this.getSize=function(){return{width:d,height:_}},this.render=function(xt,At){const Ct=At.projectionMatrix.elements[5]*_e;let Et,Tt;it.camera.fov!==Ct&&(at.style.perspective=At.isPerspectiveCamera?Ct+"px":"",it.camera.fov=Ct),At.view&&At.view.enabled?(at.style.transform=`translate( ${-At.view.offsetX*(d/At.view.width)}px, ${-At.view.offsetY*(_/At.view.height)}px )`,at.style.transform+=`scale( ${At.view.fullWidth/At.view.width}, ${At.view.fullHeight/At.view.height} )`):at.style.transform="",xt.matrixWorldAutoUpdate===!0&&xt.updateMatrixWorld(),At.parent===null&&At.matrixWorldAutoUpdate===!0&&At.updateMatrixWorld(),At.isOrthographicCamera&&(Et=-(At.right+At.left)/2,Tt=(At.top+At.bottom)/2);const kt=At.view&&At.view.enabled?At.view.height/At.view.fullHeight:1,Dt=At.isOrthographicCamera?`scale( ${kt} )scale(`+Ct+")translate("+pt(Et)+"px,"+pt(Tt)+"px)"+mt(At.matrixWorldInverse):`scale( ${kt} )translateZ(`+Ct+"px)"+mt(At.matrixWorldInverse),zt=Dt+"translate("+b+"px,"+_e+"px)";it.camera.style!==zt&&(ut.style.transform=zt,it.camera.style=zt),vt(xt,xt,At)},this.setSize=function(xt,At){d=xt,_=At,b=d/2,_e=_/2,nt.style.width=xt+"px",nt.style.height=At+"px",at.style.width=xt+"px",at.style.height=At+"px",ut.style.width=xt+"px",ut.style.height=At+"px"}}}var CSS3DRendererPlugin_decorate=function(h,o,c,d){var _,b=arguments.length,_e=b<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_e=Reflect.decorate(h,o,c,d);else for(var it=h.length-1;it>=0;it--)(_=h[it])&&(_e=(b<3?_(_e):b>3?_(o,c,_e):_(o,c))||_e);return b>3&&_e&&Object.defineProperty(o,c,_e),_e};let CSS3DRendererPlugin=class extends AViewerPlugin{constructor(h=!0){super(),this._scene=new three_module.Z58,this.overCanvas=!0,this._trackers=[],this.attachIFrameToSelected=async()=>{var o,c,d,_,b;const _e=(c=(o=this._viewer)===null||o===void 0?void 0:o.getPlugin(PickingPlugin))===null||c===void 0?void 0:c.getSelectedObject();if(!(_e!=null&&_e.geometry))return void await((d=this._viewer)===null||d===void 0?void 0:d.alert("No Geometry: Selected object must have a geometry to apply the iframe to"));const it=await((_=this._viewer)===null||_===void 0?void 0:_.prompt("URL: Enter the url for the webpage. (Make sure its allowed to be embedded in an iframe.)","https://webgi.xyz/",!1))||"https://webgi.pixotronics.com/";if(!it)return;const nt=await((b=this._viewer)===null||b===void 0?void 0:b.prompt("Width: Enter the width for the object.","512",!1))||"512";nt&&this.attachIFrame(_e,it,parseInt(nt))},this._resizeObserver=new ResizeObserver(()=>{var o;this.enabled&&((o=this._viewer)===null||o===void 0||o.scene.setDirty({sceneUpdate:!0}))}),this.enabled=h,this._refreshCanvasInDOM=this._refreshCanvasInDOM.bind(this),this._refreshEnabled=this._refreshEnabled.bind(this)}_refreshEnabled(){}_refreshCanvasInDOM(){const h=this._viewer;h&&this._renderer&&(h.canvas.remove(),this.overCanvas?this._renderer.domElement.insertAdjacentElement("afterbegin",h.canvas):this._renderer.domElement.appendChild(h.canvas))}_initialize(){if(this._renderer||!this._viewer)return;this._renderer=new CSS3DRenderer;const h=this._viewer.renderer.rendererObject.getSize(new three_module.I9Y);this._renderer.setSize(h.width,h.height);const o=document.createElement("div");o.style.position="absolute",o.style.top="0",o.style.zIndex="0",o.appendChild(this._renderer.domElement),this._viewer.canvas.style.position="absolute",this._viewer.canvas.style.top="0",this._viewer.canvas.style.left="0",this._viewer.canvas.style.zIndex="0",this._viewer.container.appendChild(o),this._refreshCanvasInDOM(),this._viewer.renderer.addEventListener("resize",()=>{if(!this._viewer||!this._renderer)return;const c=this._viewer.renderer.rendererObject.getSize(new three_module.I9Y);this._renderer.setSize(c.width,c.height)})}async onAdded(h){await super.onAdded(h);let o=!0,c=!0;h.addEventListener("postFrame",b=>{var _e,it;o&&this.enabled&&(this._renderer||this._initialize(),this._renderer&&(c&&this._trackers.forEach(nt=>{var at,ut;let pt=!0;const mt=nt.modelObj.material.side;if(mt!==three_module.$EB){const ft=new three_module.Pq0(0,0,1).applyQuaternion(nt.cssObj.quaternion),vt=(ut=(at=this._viewer)===null||at===void 0?void 0:at.scene.activeCamera)===null||ut===void 0?void 0:ut.cameraObject,xt=ft.dot(vt.getWorldDirection(new three_module.Pq0));pt=mt===three_module.hsX?xt>0:xt<0}nt.cssObj.element.style.visibility=pt?"visible":"hidden"}),this._trackers.filter(nt=>nt.dirty).forEach(nt=>this._syncProperties(nt)),(_e=this._renderer)===null||_e===void 0||_e.render(this._scene,(it=h.scene.activeCamera)===null||it===void 0?void 0:it.cameraObject),o=!1))}),h.addEventListener("update",b=>{this.enabled&&(o=this._trackers.length>0)}),h.scene.addEventListener("sceneUpdate",b=>{this.enabled&&(this._trackers.forEach(_e=>_e.dirty=!0),o=this._trackers.length>0)}),h.scene.addEventListener("activeCameraUpdate",b=>{this.enabled&&(o=this._trackers.length>0,c=!0)});let d=!1;const _=new three_module.tBo;h.container.addEventListener("mousemove",b=>{if(!this.enabled||!this._viewer||this.overCanvas)return;const _e=this._viewer.canvas.getBoundingClientRect(),it=(b.clientX-_e.x)/_e.width*2-1,nt=-(b.clientY-_e.y)/_e.height*2+1;_.setFromCamera({x:it,y:nt},this._viewer.scene.activeCamera.cameraObject);const at=this._trackers.map(pt=>pt.modelObj),ut=_.intersectObjects(at,!1);if(console.log(ut),ut.length)return this._viewer.canvas.style.pointerEvents="none",d=!0,void console.log(this._viewer.canvas.style.pointerEvents);d&&(this._viewer.canvas.style.pointerEvents="auto",d=!1)})}attachIFrame(h,o,c){const d=computeGeometrySize(h.modelObject),_=createIFrameCSS3DObject(o,c,c*d.y/d.x,()=>{var b;return(b=h.setDirty)===null||b===void 0?void 0:b.call(h)});return this.attachCSS3DObject(_,h),_}attachCSS3DObject(h,o){var c,d,_,b,_e;if(this._trackers.push({cssObj:h,modelObj:o.modelObject,dirty:!0}),h.element&&(this._resizeObserver.observe(h.element),h.element.__isCSS3DObjectElement=!0,console.log(h.element,h.element.__isCSS3DObjectElement)),o.userData.__oldMaterial=o.material,!o.setMaterial)throw"model not processed?";const it=(c=this._viewer)===null||c===void 0?void 0:c.createMaterial("basic",{opacity:0,color:new three_module.Q1f("black"),blending:three_module.XIg,side:three_module.hB5});if(!it)throw"cannot create mat";it.userData.forcedLinearDepth=0,(d=o.setMaterial)===null||d===void 0||d.call(o,it),computeAverageGeometryNormal(o.modelObject),computeGeometryCenter(o.modelObject),computeGeometrySize(o.modelObject),this._scene.add(h),(b=(_=this.uiConfig)===null||_===void 0?void 0:_.uiRefresh)===null||b===void 0||b.call(_),(_e=o.setDirty)===null||_e===void 0||_e.call(o)}_syncProperties(h){const o=h.modelObj,c=h.cssObj;o.updateMatrixWorld();const d=h.cssObj.element.clientWidth<1.5?0:(h.cssObj.element.clientWidth-1.5)/computeGeometrySize(o).x,_=computeAverageGeometryNormal(o);c.quaternion.setFromUnitVectors(new three_module.Pq0(0,0,1),_),c.position.copy(computeGeometryCenter(o)),c.scale.set(1,1,1).multiplyScalar(1/d),c.updateMatrixWorld(),c.applyMatrix4(o.matrixWorld),h.dirty=!1}async onDispose(h){return this._resizeObserver.disconnect(),super.onDispose(h)}};function createIFrameCSS3DObject(h,o,c,d){const _=document.createElement("div");_.style.width=o.toString()+"px",_.style.height=c.toString()+"px",_.style.backgroundColor="transparent";const b=document.createElement("iframe",{is:"x-frame-bypass"});b.style.width="100%",b.style.height="100%",b.style.border="0px";const _e=()=>{var it,nt;try{b.contentWindow.name}catch(at){(typeof at=="string"?at:(nt=(it=at==null?void 0:at.toString)===null||it===void 0?void 0:it.call(at))!==null&&nt!==void 0?nt:"").includes("cross-origin")?console.warn("Trying to load cross-origin scripts, Install chrome extension if not able to load: https://chrome.google.com/webstore/detail/ignore-x-frame-headers/gleekbfjekiniecknbkamfmkohkpodhe"):console.error(at)}d(),b.removeEventListener("load",_e)};return b.addEventListener("load",_e),b.src=h,_.appendChild(b),new CSS3DObject(_)}function computeAverageGeometryNormal(h){if(h.geometry.userData.geometryNormal)return h.geometry.userData.geometryNormal;const o=h.geometry.attributes.normal,c=new three_module.Pq0,d=new three_module.Pq0;for(let _=0,b=o.count;_<b;_++)c.fromBufferAttribute(o,_),d.add(c);return d.normalize(),h.geometry.userData.geometryNormal=d,d}function computeGeometryCenter(h){if(h.geometry.userData.geometryCenter)return h.geometry.userData.geometryCenter;const o=h.geometry;if(!o)return new three_module.Pq0(0,0,0);o.boundingBox||o.computeBoundingBox();const c=o.boundingBox.getCenter(new three_module.Pq0);return h.geometry.userData.geometryCenter=c,c}function computeGeometrySize(h,o=new three_module.Pq0(0,0,1)){if(h.geometry.userData.geometrySize)return h.geometry.userData.geometrySize;const c=h.geometry;if(!c)return new three_module.Pq0(0,0,0);const d=c.clone();d.applyMatrix4(new three_module.kn4().makeRotationFromQuaternion(new three_module.PTz().setFromUnitVectors(o,computeAverageGeometryNormal(h)).invert())),d.computeBoundingBox();const _=d.boundingBox.getSize(new three_module.Pq0);return h.geometry.userData.geometrySize=_,d.dispose(),_}CSS3DRendererPlugin.PluginType="CSS3DRenderer",CSS3DRendererPlugin_decorate([uiToggle("Enabled"),x$1(CSS3DRendererPlugin.prototype._refreshEnabled),serialize()],CSS3DRendererPlugin.prototype,"enabled",void 0),CSS3DRendererPlugin_decorate([uiToggle("Over canvas"),x$1(CSS3DRendererPlugin.prototype._refreshCanvasInDOM),serialize()],CSS3DRendererPlugin.prototype,"overCanvas",void 0),CSS3DRendererPlugin_decorate([uiButton("Attach iframe")],CSS3DRendererPlugin.prototype,"attachIFrameToSelected",void 0),CSS3DRendererPlugin=CSS3DRendererPlugin_decorate([uiFolder("CSS3D Renderer")],CSS3DRendererPlugin);var outline=`uniform sampler2D outlineBuffer;uniform vec2 tDiffuseSize;uniform vec3 outlineColor;uniform float outlineThickness;uniform float outlineIntensity;uniform float highlightTransparency;uniform bool enableHighlight;uniform float dpr;float isSelected(vec2 uv){return 1.-texture2D(outlineBuffer,uv).b;}vec4 outline(in vec4 color){vec2 invSize=1./tDiffuseSize;
#if DEBUG_OUTLINE > 0
color=vec4(0.,0.,0.,1.);
#endif
vec3 finalColor=color.rgb;float c=isSelected(vUv);if(c>0.){vec4 uvOffset=1.5*dpr*outlineThickness*vec4(1.,0.,-1.,1.)*vec4(invSize,invSize);float c1=isSelected(vUv+uvOffset.xy);float c2=isSelected(vUv-uvOffset.xy);float c3=isSelected(vUv+uvOffset.yw);float c4=isSelected(vUv-uvOffset.yw);float diff1=(c1-c2)*0.5;float diff2=(c3-c4)*0.5;float d=length(vec2(diff1,diff2));vec4 highlightColor=enableHighlight?vec4(c*outlineColor,(1.-highlightTransparency)*c):vec4(0.);vec4 edgeColor=vec4(outlineColor,1.)*vec4(d);float gbufferDepth=getDepth(vUv);float outlineDepth=unpack16(texture2D(outlineBuffer,vUv).xy);outlineDepth*=outlineDepth;outlineDepth-=0.005;if(gbufferDepth<outlineDepth){highlightColor.rgb=highlightColor.rgb*0.3;edgeColor.rgb=edgeColor.rgb*0.5;}vec4 outColor=edgeColor+highlightColor*(1.-d);finalColor=mix(color.rgb,outlineIntensity*outColor.rgb,outColor.a);}else{finalColor.rgb=color.rgb;}return vec4(finalColor.rgb,color.a);}`;class OutlineRenderPass extends RenderPass{constructor(o,c,d,_=new three_module.Q1f(1,1,1),b=1){super(void 0,void 0,d,_,b),this._getSelectedObjectOrMaterial=o,this.target=c}render(o,c,d,_,b){const _e=o.getRenderTarget(),it=o.getActiveCubeFace(),nt=o.getActiveMipmapLevel(),at=this._getSelectedObjectOrMaterial();if(at)this._renderSelectedObject(o,at,c,_,b);else{o.setRenderTarget(this.target);const ut=new three_module.Q1f;o.getClearColor(ut),o.setClearColor(new three_module.Q1f(16777215)),o.clear(!0,!0),o.setClearColor(ut)}o.setRenderTarget(_e,it,nt)}_renderSelectedObject(o,c,d,_,b){if(!this.camera)return;const _e=(Array.isArray(c)?c:[c]).map(at=>at.isMaterial?[...at.userData.__appliedMeshes.values()]:at).flat();_e.forEach(at=>at.traverse(ut=>{ut.layers.enable(6)}));const it=this.camera.layers.mask;this.camera.layers.set(6);const nt=o.userData;nt||console.error("threejs is not patched?"),nt.transmissionRenderTarget=d,setThreeRendererMode(o,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!0,transparentRender:!0,transmissionRender:!0,mainRenderPass:!1},()=>super.render(o,d,this.target,_,b)),nt.transmissionRenderTarget=void 0,_e.forEach(at=>at.traverse(ut=>{ut.layers.disable(6)})),this.camera.layers.mask=it}}var outlineDepthVert=`#ifdef USE_ALPHAMAP
#define USE_UV 
#endif
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec3 vViewPosition;void main(){
#include <skinbase_vertex>
#include <begin_vertex>
#include <morphtarget_vertex>
#include <skinning_vertex>
#include <displacementmap_vertex>
#include <project_vertex>
#include <logdepthbuf_vertex>
#include <clipping_planes_vertex>
vViewPosition=-mvPosition.xyz;}`,outlineDepthFrag="uniform vec2 cameraNearFar;varying vec3 vViewPosition;vec2 pack16(float value){float sMax=65535.;int v=int(clamp(value,0.,1.)*sMax+0.5);int digit0=v/256;int digit1=v-digit0*256;return vec2(float(digit0)/255.,float(digit1)/255.);}float linstep(float edge0,float edge1,float value){return clamp((value-edge0)/(edge1-edge0),0.,1.);}void main(){float linearZ=linstep(-cameraNearFar.x,-cameraNearFar.y,-vViewPosition.z);vec2 packedZ=pack16(pow(max(0.,linearZ),0.5));gl_FragColor=vec4(packedZ.x,packedZ.y,0.,0.);}",OutlinePlugin_decorate=function(h,o,c,d){var _,b=arguments.length,_e=b<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_e=Reflect.decorate(h,o,c,d);else for(var it=h.length-1;it>=0;it--)(_=h[it])&&(_e=(b<3?_(_e):b>3?_(o,c,_e):_(o,c))||_e);return b>3&&_e&&Object.defineProperty(o,c,_e),_e};let OutlineExtension=class{constructor(h,o){this.enabled=!0,this.enableHighlight=!1,this.enableDynamicSelection=!0,this.outlineIntensity=2,this.highlightTransparency=.84,this.outlineColor=new three_module.Q1f(15305317),this.debugOutline=!1,this.highlightSelectedMaterials=!1,this.highlightMaterialSameNames=!1,this.transparency=0,this._outlineThickness=2,this.extraUniforms={outlineIntensity:{value:1},tDiffuseSize:{value:new three_module.I9Y(1,1)},outlineThickness:{value:2},highlightTransparency:{value:1},outlineColor:{value:new three_module.Q1f(15305317)},enableHighlight:{value:!0},outlineBuffer:{value:null},dpr:{value:1}},this.extraDefines={DEBUG_OUTLINE:"0"},this.parsFragmentSnippet=(c,d)=>this.enabled?fe$1`
            ${unpackGbuffer}
            ${outline}
        `:"",this._combinedPostPlugin=h.getPlugin(CombinedPostPlugin),this._pickingPlugin=h.getPluginByType("Picking"),this._setDirty=this._setDirty.bind(this),o&&(this.extraUniforms.outlineBuffer.value=o.texture),this._enable()}shaderExtender(h,o,c){this.enabled&&(h.fragmentShader=shaderReplaceString(h.fragmentShader,"#glMarker",` 
            gl_FragColor = outline(gl_FragColor);
            #glMarker
        `))}getUiConfig(){return this.uiConfig}computeCacheKey(h){return this.enabled?"1":"0"}isCompatible(h){return!0}_setDirty(){this._combinedPostPlugin&&this._combinedPostPlugin.reRender(),this.extraDefines&&(this.extraDefines.DEBUG_OUTLINE=this.debugOutline?"1":"0"),this.extraUniforms&&(this.extraUniforms.outlineIntensity.value=this.outlineIntensity,this.extraUniforms.outlineColor.value.copy(this.outlineColor),this.extraUniforms.outlineThickness.value=this._outlineThickness,this.extraUniforms.enableHighlight.value=this.enableHighlight,this.extraUniforms.highlightTransparency.value=this.transparency)}setDirty(){var h;(h=this.__setDirty)===null||h===void 0||h.call(this),this._setDirty()}_enable(){var h;(h=this._pickingPlugin)===null||h===void 0||h.enableWidget(!this.enabled),this._setDirty()}};OutlineExtension.PluginType="Outline",OutlinePlugin_decorate([x$1(OutlineExtension.prototype._enable),uiToggle("Enable"),serialize()],OutlineExtension.prototype,"enabled",void 0),OutlinePlugin_decorate([x$1(OutlineExtension.prototype._setDirty),uiToggle("Highlight"),serialize()],OutlineExtension.prototype,"enableHighlight",void 0),OutlinePlugin_decorate([x$1(OutlineExtension.prototype._setDirty),uiToggle("DynamicSelection"),serialize()],OutlineExtension.prototype,"enableDynamicSelection",void 0),OutlinePlugin_decorate([x$1(OutlineExtension.prototype._setDirty),uiSlider("Intensity",[0,2],.001,{limitedUi:!0}),serialize()],OutlineExtension.prototype,"outlineIntensity",void 0),OutlinePlugin_decorate([x$1(OutlineExtension.prototype._setDirty),uiSlider("Transparency",[0,1],.01,{limitedUi:!0}),serialize()],OutlineExtension.prototype,"highlightTransparency",void 0),OutlinePlugin_decorate([x$1(OutlineExtension.prototype._setDirty),uiColor("Color"),serialize()],OutlineExtension.prototype,"outlineColor",void 0),OutlinePlugin_decorate([x$1(OutlineExtension.prototype._setDirty),uiToggle("Debug")],OutlineExtension.prototype,"debugOutline",void 0),OutlinePlugin_decorate([x$1(OutlineExtension.prototype._setDirty),uiToggle("Highlight Selected Materials")],OutlineExtension.prototype,"highlightSelectedMaterials",void 0),OutlinePlugin_decorate([x$1(OutlineExtension.prototype._setDirty),uiToggle("Highlight Materials (same name)")],OutlineExtension.prototype,"highlightMaterialSameNames",void 0),OutlineExtension=OutlinePlugin_decorate([uiFolder("Outline")],OutlineExtension);class OutlinePlugin extends GenericExtensionPlugin{constructor(){super(),this._state="in",this.mouseInOutAnimationEnabled=!0}generateExtension(o){return new OutlineExtension(o,this._outlineTarget)}async onAdded(o){this._outlineTarget=o.renderer.createTarget({sizeMultiplier:1}),await super.onAdded(o);const c=o==null?void 0:o.getPluginByType("Picking");c||console.error("OutlinePlugin requires PickingPlugin to be added to the viewer"),o.addEventListener("preRender",()=>{this._extension.extraUniforms.dpr.value=o.renderer.displayCanvasScaling});const d=new three_module.BKk({uniforms:{cameraNearFar:{value:new three_module.I9Y(.1,100)}},vertexShader:outlineDepthVert,fragmentShader:outlineDepthFrag,side:three_module.$EB}),_=makeFilter(o,{passId:"outline",after:["gbuffer"],before:["render"],passObject:new OutlineRenderPass(()=>{var b,_e;if(!((b=this._extension)===null||b===void 0)&&b.highlightSelectedMaterials){const it=(_e=c==null?void 0:c.getSelectedObject())===null||_e===void 0?void 0:_e.material;if(this._extension.highlightMaterialSameNames&&it){const nt=Array.isArray(it)?it.map(ut=>ut.name):[it.name],at=new Set;return nt.forEach(ut=>{var pt,mt;const ft=(mt=(pt=o.assetManager)===null||pt===void 0?void 0:pt.materials)===null||mt===void 0?void 0:mt.findMaterialsByName(ut);ft==null||ft.forEach(vt=>at.add(vt))}),[...at]}return it}return c==null?void 0:c.getSelectedObject()},this._outlineTarget,d),update(){o.scene.renderCamera.updateShaderProperties(this.passObject.overrideMaterial),_.passObject.scene=o.scene.modelObject,_.passObject.camera=o.scene.renderCamera.cameraObject}});o.renderer.registerPass(_),c==null||c.addEventListener("selectedObjectChanged",()=>{!this._animationCallBack&&this._extension&&(c!=null&&c.getSelectedObject()?this._extension.enableDynamicSelection?(this._extension.transparency=1,this._animationCallBack=this._startTransparencyAnimation(1,this._extension.highlightTransparency,400)):this._extension.transparency=this._extension.highlightTransparency:this._extension.transparency=1)}),document.addEventListener("mousemove",b=>{if(!this._extension||!this.mouseInOutAnimationEnabled)return;const _e=c==null?void 0:c.getSelectedObject();_e&&this._extension.enableDynamicSelection?b.target!==o.canvas?this._animationCallBack||this._state!=="in"||(this._animationCallBack=this._startTransparencyAnimation(this._extension.highlightTransparency,1,600),this._state="out"):this._animationCallBack||this._state!=="out"||(this._animationCallBack=this._startTransparencyAnimation(1,this._extension.highlightTransparency,600),this._state="in"):this._extension.transparency=_e?this._extension.highlightTransparency:1})}async _startTransparencyAnimation(o,c,d){return animateTarget$1(this._extension,"transparency",{from:o,to:c,duration:d,onComplete:()=>{this._animationCallBack=null}})}}OutlinePlugin.PluginType="Outline";const RADIUS=.2,LINE_WIDTH=.03,MAX_OPACITY=.75,SEGMENTS=12,DELTA_PHI=Math.PI/(2*SEGMENTS),vector2=new three_module.I9Y,addCorner=(h,o,c)=>{let d=o>0?c>0?0:-Math.PI/2:c>0?Math.PI/2:Math.PI;for(let _=0;_<=SEGMENTS;++_)h.push(o+(RADIUS-LINE_WIDTH)*Math.cos(d),c+(RADIUS-LINE_WIDTH)*Math.sin(d),0,o+RADIUS*Math.cos(d),c+RADIUS*Math.sin(d),0),d+=DELTA_PHI},makeARBoxGeometry=(h,o)=>{const c=new three_module.LoY,d=[],_=[],b=h.getSize(new three_module.Pq0),_e=b.x/2,it=(o?b.y:b.z)/2;addCorner(_,_e,it),addCorner(_,-_e,it),addCorner(_,-_e,-it),addCorner(_,_e,-it);const nt=_.length/3;for(let ut=0;ut<nt-2;ut+=2)d.push(ut,ut+1,ut+3,ut,ut+3,ut+2);const at=nt-2;return d.push(at,at+1,1,at,1,0),c.setAttribute("position",new three_module.qtW(_,3)),c.setIndex(d),c};class ARPlacementBox extends three_module.eaF{constructor(o,c,d=!1){super(makeARBoxGeometry(o,d)),this.boundingSize=new three_module.Pq0,this._raycaster=new three_module.tBo,this._camera=c,this._placeOnWall=d;const _=this.material;_.side=three_module.hB5,_.color=new three_module.Q1f(16711935),_.opacity=0,this.userData.bboxVisible=!1;const b=o.getSize(this.boundingSize),_e=b.x/2,it=(d?b.y:b.z)/2;this.hitPlane=new three_module.eaF(new three_module.bdM(2*(_e+RADIUS),2*(it+RADIUS))),this.hitPlane.visible=!1,this.add(this.hitPlane),o.getCenter(this.position),d?(this.shadowHeight=o.min.z,this.position.z=this.shadowHeight):(this.rotateX(-Math.PI/2),this.shadowHeight=o.min.y,this.position.y=this.shadowHeight),this.offsetHeight=0}getHit(o,c,d){vector2.set(c,-d),this.hitPlane.visible=!0;const _=this._positionAndNormalFromPoint(vector2,this.hitPlane);return this.hitPlane.visible=!1,_==null?null:_.position}getExpandedHit(o,c,d){this.hitPlane.scale.set(1e3,1e3,1e3);const _=this.getHit(o,c,d);return this.hitPlane.scale.set(1,1,1),_}set offsetHeight(o){o-=.001,this._placeOnWall?this.position.z=this.shadowHeight+o:this.position.y=this.shadowHeight+o}get offsetHeight(){return this._placeOnWall?this.position.z-this.shadowHeight:this.position.y-this.shadowHeight}set show(o){this.material.opacity=o?MAX_OPACITY:0}get show(){return this.material.opacity>.01}updateOpacity(o){const c=this.material;this.visible=c.opacity>0}dispose(){var o;const{geometry:c,material:d}=this.hitPlane;c.dispose(),d.dispose(),this.geometry.dispose(),this.material.dispose(),(o=this.parent)===null||o===void 0||o.remove(this)}_positionAndNormalFromPoint(o,c){if(!this._camera)return null;this._raycaster.setFromCamera(o,this._camera);const d=this._raycaster.intersectObject(c,!0);if(d.length===0)return null;const _=d[0];return _.face==null?null:_.uv==null?{position:_.point,normal:_.face.normal,uv:null}:(_.face.normal.applyNormalMatrix(new three_module.dwI().getNormalMatrix(_.object.matrixWorld)),{position:_.point,normal:_.face.normal,uv:_.uv})}}const ROTATION_RATE=1.5,SCALE_SNAP_HIGH=1.3,SCALE_SNAP_LOW=1/SCALE_SNAP_HIGH,MAX_DISTANCE=10,vector3=new three_module.Pq0;class ARTouchInputHelper{constructor(){this.inputSource=null,this.isTranslating=!1,this.isRotating=!1,this.isTwoFingering=!1,this.lastDragPosition=new three_module.Pq0,this.firstRatio=0,this.lastAngle=0,this.goalPosition=new three_module.Pq0,this.goalYaw=0,this.goalScale=1,this.presentedScene=null,this.placementBox=null,this.placeOnWall=!1,this.placementComplete=!1,this.xr=null,this.session=null,this._hitPosition=new three_module.Pq0,this._hitMatrix=new three_module.kn4,this.xDamper=new k$1,this.yDamper=new k$1,this.zDamper=new k$1,this.yawDamper=new k$1,this.scaleDamper=new k$1,this.onSelectStart=o=>{const c=this.transientHitTestSource;if(c==null)return;const d=this.frame.getHitTestResultsForTransientInput(c),_=this.presentedScene,b=this.placementBox;if(d.length===1){this.inputSource=o.inputSource;const{axes:_e}=this.inputSource.gamepad||{axes:[0,0]},it=b.getHit(_,_e[0],_e[1]);b.show=!0,it!=null?(this.isTranslating=!0,this.lastDragPosition.copy(it),this.presentedScene&&(this.presentedScene.visible=!0)):this.placeOnWall||(this.isRotating=!0,this.lastAngle=_e[0]*ROTATION_RATE)}else if(d.length===2){b.show=!0,this.isTwoFingering=!0;const{separation:_e}=this.fingerPolar(d);this.firstRatio=_e/_.scale.x}},this.onSelectEnd=()=>{this.isTranslating=!1,this.isRotating=!1,this.isTwoFingering=!1,this.inputSource=null,this.goalPosition.y+=this.placementBox.offsetHeight*this.presentedScene.scale.x,this.placementBox.show=!1}}async setSession(o,c,d){var _;this.transientHitTestSource=await((_=o.requestHitTestSourceForTransientInput)===null||_===void 0?void 0:_.call(o,{profile:"generic-touchscreen"})),this.presentedScene=c,this.placementBox=d,this.session=o,this.placementComplete=!1,this.goalPosition.copy(c.position),this.goalYaw=c.rotation.y,this.goalScale=c.scale.x,o.addEventListener("selectstart",this.onSelectStart),o.addEventListener("selectend",this.onSelectEnd)}cancel(){this.transientHitTestSource&&(this.transientHitTestSource.cancel(),this.transientHitTestSource=void 0),this.presentedScene=null,this.placeOnWall=!1,this.frame=void 0,this.xr=null,this.placementBox&&(this.placementBox.show=!1,this.placementBox=null),this.session&&(this.session.removeEventListener("selectstart",this.onSelectStart),this.session.removeEventListener("selectend",this.onSelectEnd),this.session=null)}getHitPoint(o){var c;const d=(c=this.xr)===null||c===void 0?void 0:c.getReferenceSpace(),_=d?o.getPose(d):null;return _?(this._hitMatrix.fromArray(_.transform.matrix),this.placeOnWall&&(this.goalYaw=Math.atan2(this._hitMatrix.elements[4],this._hitMatrix.elements[6])),this._hitMatrix.elements[5]>.75!==this.placeOnWall?this._hitPosition.setFromMatrixPosition(this._hitMatrix):null):null}moveScene(o){if(!this.session)return;const c=this.presentedScene,d=c.position,_=c.rotation.y,b=this.placementBox,_e=Math.max(b.boundingSize.x,b.boundingSize.y,b.boundingSize.z)/2,it=this.goalPosition,nt=c.scale.x;if(!it.equals(d)||this.goalScale!==nt){let{x:at,y:ut,z:pt}=d;at=this.xDamper.update(at,it.x,o,_e),ut=this.yDamper.update(ut,it.y,o,_e),pt=this.zDamper.update(pt,it.z,o,_e),d.set(at,ut,pt);const mt=this.scaleDamper.update(nt,this.goalScale,o,1);if(c.scale.set(mt,mt,mt),!this.isTranslating){const ft=it.y-ut;this.placementComplete&&!this.placeOnWall?b.offsetHeight=ft/mt:ft===0&&(this.placementComplete=!0,b.show=!1)}}b.updateOpacity(o),c.rotation.y=this.yawDamper.update(_,this.goalYaw,o,Math.PI)}processInput(o){var c;this.frame=o;const d=this.transientHitTestSource;if(!d||!this.isTranslating&&!this.isTwoFingering&&!this.isRotating)return;const _=o.getHitTestResultsForTransientInput(d),b=this.presentedScene,_e=b.scale.x;if(this.isTwoFingering)if(_.length<2)this.isTwoFingering=!1;else{const{separation:it,deltaYaw:nt}=this.fingerPolar(_);if(this.placeOnWall||(this.goalYaw+=nt),!b.userData.__scaleDisabled){const at=it/this.firstRatio;this.goalScale=at<SCALE_SNAP_HIGH&&at>SCALE_SNAP_LOW?1:at}}else if(_.length!==2)if(this.isRotating&&!((c=this.inputSource)===null||c===void 0)&&c.gamepad){const it=this.inputSource.gamepad.axes[0]*ROTATION_RATE;this.goalYaw+=it-this.lastAngle,this.lastAngle=it}else this.isTranslating&&(console.log("translating"),_.forEach(it=>{if(it.inputSource!==this.inputSource)return;let nt=null;if(it.results.length>0&&(nt=this.getHitPoint(it.results[0])),nt==null&&(nt=this.getTouchLocation()),nt!=null){if(this.goalPosition.sub(this.lastDragPosition),!this.placeOnWall){const at=nt.y-this.lastDragPosition.y;if(at<0){this.placementBox.offsetHeight=at/_e;const ut=vector3.copy(this.xr.getCamera().position),pt=-at/(ut.y-nt.y);ut.multiplyScalar(pt),nt.multiplyScalar(1-pt).add(ut)}}this.goalPosition.add(nt),this.lastDragPosition.copy(nt)}}));else{this.isTranslating=!1,this.isRotating=!1,this.isTwoFingering=!0;const{separation:it}=this.fingerPolar(_);this.firstRatio=it/_e}}getTouchLocation(){var o,c;const{axes:d}=(o=this.inputSource.gamepad)!==null&&o!==void 0?o:{axes:[0,0]},_=this.placementBox.getExpandedHit(this.presentedScene,d[0],d[1]);return _!=null&&(vector3.copy(_).sub((c=this.xr)===null||c===void 0?void 0:c.getCamera().position),vector3.length()>MAX_DISTANCE)?null:_}fingerPolar(o){var c,d,_,b,_e,it;const nt=(_=(d=(c=o[0].inputSource)===null||c===void 0?void 0:c.gamepad)===null||d===void 0?void 0:d.axes)!==null&&_!==void 0?_:[0,0],at=(it=(_e=(b=o[1].inputSource)===null||b===void 0?void 0:b.gamepad)===null||_e===void 0?void 0:_e.axes)!==null&&it!==void 0?it:[0,0],ut=at[0]-nt[0],pt=at[1]-nt[1],mt=Math.atan2(pt,ut);let ft=this.lastAngle-mt;return ft>Math.PI?ft-=2*Math.PI:ft<-Math.PI&&(ft+=2*Math.PI),this.lastAngle=mt,{separation:Math.sqrt(ut*ut+pt*pt),deltaYaw:ft}}}class SessionLightProbe{constructor(o,c,d,_,b){this.xrLight=o,this.renderer=c,this.lightProbe=d,this.xrWebGLBinding=null,this.estimationStartCallback=b,this.frameCallback=this.onXRFrame.bind(this);const _e=c.xr.getSession();if(_&&"XRWebGLBinding"in window){const it=new three_module.o6l(16);o.environment=it.texture;const nt=c.getContext();switch(_e.preferredReflectionFormat){case"srgba8":nt.getExtension("EXT_sRGB");break;case"rgba16f":nt.getExtension("OES_texture_half_float")}this.xrWebGLBinding=new XRWebGLBinding(_e,nt),this.lightProbe.addEventListener("reflectionchange",()=>{this.updateReflection()})}_e.requestAnimationFrame(this.frameCallback)}updateReflection(){const o=this.renderer.properties.get(this.xrLight.environment);if(o){const c=this.xrWebGLBinding.getReflectionCubeMap(this.lightProbe);c&&(o.__webglTexture=c,this.xrLight.environment.needsPMREMUpdate=!0)}}onXRFrame(o,c){if(!this.xrLight)return;c.session.requestAnimationFrame(this.frameCallback);const d=c.getLightEstimate(this.lightProbe);if(d){this.xrLight.lightProbe.sh.fromArray(d.sphericalHarmonicsCoefficients),this.xrLight.lightProbe.intensity=.3;const _=Math.max(1,Math.max(d.primaryLightIntensity.x,Math.max(d.primaryLightIntensity.y,d.primaryLightIntensity.z)));this.xrLight.directionalLight.color.setRGB(d.primaryLightIntensity.x/_,d.primaryLightIntensity.y/_,d.primaryLightIntensity.z/_),this.xrLight.directionalLight.intensity=_,this.xrLight.directionalLight.position.copy(d.primaryLightDirection),this.estimationStartCallback&&(this.estimationStartCallback(),this.estimationStartCallback=null)}}dispose(){this.xrLight=null,this.renderer=null,this.lightProbe=null,this.xrWebGLBinding=null}}class XREstimatedLight extends three_module.YJl{constructor(o,c=!0){super(),this.lightProbe=new three_module.FZo,this.lightProbe.intensity=0,this.add(this.lightProbe),this.directionalLight=new three_module.ZyN,this.directionalLight.intensity=0,this.add(this.directionalLight),this.environment=null;let d=null,_=!1;o.xr.addEventListener("sessionstart",()=>{const b=o.xr.getSession();"requestLightProbe"in b&&b.requestLightProbe({reflectionFormat:b.preferredReflectionFormat}).then(_e=>{d=new SessionLightProbe(this,o,_e,c,()=>{_=!0,this.dispatchEvent({type:"estimationstart"})})})}),o.xr.addEventListener("sessionend",()=>{d&&(d.dispose(),d=null),_&&this.dispatchEvent({type:"estimationend"})}),this.dispose=()=>{d&&(d.dispose(),d=null),this.remove(this.lightProbe),this.lightProbe=null,this.remove(this.directionalLight),this.directionalLight=null,this.environment=null}}}var ARPlugin_decorate=function(h,o,c,d){var _,b=arguments.length,_e=b<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_e=Reflect.decorate(h,o,c,d);else for(var it=h.length-1;it>=0;it--)(_=h[it])&&(_e=(b<3?_(_e):b>3?_(o,c,_e):_(o,c))||_e);return b>3&&_e&&Object.defineProperty(o,c,_e),_e},ARPlugin_1;const HIT_ANGLE_DEG=20;let ARPlugin=ARPlugin_1=class extends AViewerPlugin{constructor(){super(...arguments),this.enabled=!0,this._touchInputHelper=new ARTouchInputHelper,this.dependencies=[GBufferPlugin],this.estimateLighting=!1,this.placeOnWall=!1,this.xrResolutionScale=1,this.toJSON=void 0,this.enterAR=()=>{var h;this.enabled&&this._viewer&&(navigator&&navigator.xr?this._xrSession?console.warn("Already in AR"):this._xrManager?(this._xrManager.enabled=!0,(h=this._xrManager)===null||h===void 0||h.setFramebufferScaleFactor(this.xrResolutionScale),navigator.xr.requestSession("immersive-ar",{requiredFeatures:["hit-test"],optionalFeatures:["dom-overlay","light-estimation"],domOverlay:this.domOverlay}).then(this._onSessionStarted)):console.error("XR manager not found"):console.error("XR not supported"))},this.exitAR=()=>{this._xrSession&&this._xrSession.end()},this._preRender=()=>{var h;if(!(this._dirty&&this._viewer&&this._xrManager&&this._xrSession))return;this._viewer.renderer.defaultRenderToScreen=!1,this._xrManager.enabled=!1;const o=this._xrManager.getCamera(),c=((h=o.cameras)===null||h===void 0?void 0:h[0])||o,d=this._viewer.scene.activeCamera;d.cameraObject.projectionMatrix.copy(c.projectionMatrix),d.cameraObject.projectionMatrixInverse.copy(d.cameraObject.projectionMatrix).invert()},this._postRender=()=>{var h,o;if(!this._dirty||!this._viewer||!this._xrSession)return;this._viewer.scene.activeCamera.cameraObject.updateProjectionMatrix();const c=this._viewer.renderer,d=(o=(h=this._xrManager)===null||h===void 0?void 0:h.getCamera())===null||o===void 0?void 0:o.cameras[0].viewport;d?c.rendererObject.setViewport(d):console.warn("no viewport for ar camera"),this._viewer.getPlugin(GBufferPlugin).updateShaderProperties(arCopyPass.material),arCopyPass.uniforms.tTransparentMap.value=this._viewer.renderFilter.passObject.transparentTarget.texture,setThreeRendererMode(c.rendererObject,{sceneRender:!0,opaqueRender:!0,shadowMapRender:!1,backgroundRender:!1,transparentRender:!1,transmissionRender:!1,screenSpaceRendering:!1},()=>{arCopyPass.render(c.rendererObject,null,c.composer.readBuffer,0,!1)}),this._xrManager.enabled=!0,this._viewer.renderer.defaultRenderToScreen=!0},this._frameCount=0,this._isPresenting=!1,this._interactionsDisabled=!1,this._preFrame=({xrFrame:h,deltaTime:o})=>{var c,d;if(this.dirty=!!h&&((c=this._xrManager)===null||c===void 0?void 0:c.isPresenting)||!1,(this._dirty||this._interactionsDisabled)&&(this._viewer.scene.activeCamera.setInteractions(!this._dirty,ARPlugin_1.PluginType),this._viewer.scene.activeCamera.autoLookAtTarget=!this._dirty,this._interactionsDisabled=this._dirty),!this._dirty||!h)return void(this._isPresenting&&this._xrRenderingEnd());if(!this._xrSession)return console.error("no xr session found, shouldn't happen"),void(this.dirty=!1);this._isPresenting||console.log("webxr: AR session init"),this._frameCount++;const _=this._xrManager.getReferenceSpace(),b=h.getViewerPose(_);if(b==null&&this._frameCount,b==null||((d=this._viewer)===null||d===void 0?void 0:d.scene.modelRoot.children.length)===0)return this.dirty=!1,void console.warn("no pose or no model");this._isPresenting||(this._isPresenting=!0,this._frameCount=0,this._savePreXRState(),this._preSetupModel(),this._xrRenderingBegin());const _e=this._viewer.scene.activeCamera;this._xrManager.updateCamera(_e.cameraObject),_e.setDirty(),this.moveToFloor(h),this._touchInputHelper.processInput(h),this._touchInputHelper.moveScene(o),this._updateShadow()},this._preXRState={viewerBg:null,viewerBgColor:void 0,modelScale:new three_module.Pq0(1,1,1),modelPosition:new three_module.Pq0,modelRotation:new three_module.PTz,cameraPosition:new three_module.Pq0(0,0,5),cameraTarget:new three_module.Pq0,cameraUp:new three_module.Pq0(0,1,0),cameraAspect:1,cameraFov:50,cameraZoom:1,cameraNear:.01,cameraFar:100,cameraProjectionMatrix:new three_module.kn4,cameraAutoNearFar:void 0,groundOffset:new three_module.Pq0,groundScale:1,groundRotation:0,groundRenderToDepth:!1,groundShadowBaker:!1,viewport:new three_module.I9Y,environment:void 0,preserveTransparentTarget:!0},this._savePreXRState=()=>{var h;if(!this._viewer)return;this._preXRState.viewport.copy(this._viewer.renderer.renderSize),this._preXRState.viewerBg=this._viewer.scene.background,this._preXRState.viewerBgColor=(h=this._viewer.scene.backgroundColor)===null||h===void 0?void 0:h.getHex();const o=this._viewer.scene.modelRoot,c=this._viewer.scene.activeCamera;o.updateMatrix(),o.updateMatrixWorld(!0),this._preXRState.modelScale.copy(o.scale),this._preXRState.modelPosition.copy(o.position),this._preXRState.modelRotation.copy(o.quaternion),this._preXRState.cameraPosition.copy(c.position),this._preXRState.cameraTarget.copy(c.target),this._preXRState.cameraUp.copy(c.cameraObject.up),c.cameraObject.isPerspectiveCamera&&(this._preXRState.cameraFov=c.cameraObject.fov,this._preXRState.cameraAspect=c.cameraObject.aspect),this._preXRState.cameraZoom=c.cameraObject.zoom,this._preXRState.cameraNear=c.cameraObject.near,this._preXRState.cameraFar=c.cameraObject.far,this._preXRState.cameraAutoNearFar=c.cameraObject.userData.autoNearFar,this._preXRState.cameraProjectionMatrix.copy(c.cameraObject.projectionMatrix);const d=this._viewer.getPluginByType("Ground");d!=null&&d.mesh&&(this._preXRState.groundOffset.subVectors(o.position,d.mesh.modelObject.position),this._preXRState.groundScale=d.mesh.modelObject.scale.x,this._preXRState.groundRotation=d.mesh.modelObject.rotation.z,this._preXRState.groundRenderToDepth=d.renderToDepth,this._preXRState.groundShadowBaker=d.shadowBaker.enabled),this._preXRState.environment||(this._preXRState.environment=this._viewer.scene.getEnvironment()),this._preXRState.preserveTransparentTarget=this._viewer.renderFilter.passObject.preserveTransparentTarget},this._xrRenderingBegin=()=>{if(!this._xrSession||!this._viewer)return;console.log("webxr: AR session start");const h=HIT_ANGLE_DEG*Math.PI/180,o=this.placeOnWall?void 0:new window.XRRay(new DOMPoint(0,0,0),{x:0,y:-Math.sin(h),z:-Math.cos(h)});this._viewer.renderer.useTotalFrameCount=!0,this._viewer.resize(),(async()=>{var c,d;if(this._xrSession){this._touchInputHelper.placeOnWall=this.placeOnWall,await this._touchInputHelper.setSession(this._xrSession,this._viewer.scene.modelRoot,this._placementBox);const _=await this._xrSession.requestReferenceSpace("viewer");this._hitTestSource=await((d=(c=this._xrSession).requestHitTestSource)===null||d===void 0?void 0:d.call(c,{space:_,offsetRay:o}))}})()},this._xrRenderingEnd=()=>{console.log("webxr: AR session end"),this._xrManager&&(this._xrManager.enabled=!1),this._isPresenting=!1,this._frameCount=0,this._xrSession=void 0,this._removePlacementBox(),this._cancelHitSources(),this._viewer&&(this._viewer.renderer.stableNoise=!1),this._restorePreXRState()},this._onSessionStarted=async h=>{h.addEventListener("end",this._onSessionEnded),this.estimateLighting&&(this._xrLight=new XREstimatedLight(this._viewer.renderer.rendererObject),this._xrLight.addEventListener("estimationstart",()=>{this._xrSession&&this._xrLight&&(this._viewer.scene.modelRoot.add(this._xrLight),this._preXRState.environment||(this._preXRState.environment=this._viewer.scene.getEnvironment()),this._viewer.scene.setEnvironment(this._xrLight.environment))})),this._xrManager.setReferenceSpaceType("local"),await this._xrManager.setSession(h),this._xrSession=h},this._onSessionEnded=()=>{this._xrSession&&(this._xrSession.removeEventListener("end",this._onSessionEnded),this._xrLight&&(this._xrLight.removeFromParent(),this._xrLight.dispose(),this._xrLight=void 0))}}async onAdded(h){await super.onAdded(h);const o=h.renderer.rendererObject.xr;if(o.cameraAutoUpdate=!1,this._xrManager=o,this._touchInputHelper.xr=o,!this.domOverlay){const c=document.getElementById("tweakpaneUiContainer");this.domOverlay=c?{root:c}:void 0}if(h.addEventListener("preRender",this._preRender),h.addEventListener("postRender",this._postRender),h.addEventListener("preFrame",this._preFrame),!window.isSecureContext)return h.console.error("XR not supported in insecure context, try https://"),void(this.enabled=!1);navigator&&"xr"in navigator&&navigator.xr?navigator.xr.isSessionSupported("immersive-ar").then(c=>{if(!c)throw new Error("AR not supported")}).catch(c=>{h.console.error("AR not supported:",c),o.enabled=!1,this.enabled=!1}):(o.enabled=!1,this.enabled=!1)}_updateShadow(){var h,o;if(!this._viewer)return;const c=this._viewer.scene.modelRoot,d=(o=(h=this._viewer.getPluginByType("Ground"))===null||h===void 0?void 0:h.mesh)===null||o===void 0?void 0:o.modelObject;d&&(d.rotation.z=this._viewer.scene.modelRoot.rotation.y,d.position.copy(this._preXRState.groundOffset).multiplyScalar(c.modelObject.scale.x).sub(c.modelObject.position).negate(),d.scale.setScalar(c.modelObject.scale.x*this._preXRState.groundScale))}moveToFloor(h){if(!this._dirty||!this._hitTestSource||!this._xrManager)return;const o=h.getHitTestResults(this._hitTestSource);if(!o.length)return;const c=o[0];this._touchInputHelper.placeOnWall=this.placeOnWall;const d=this._touchInputHelper.getHitPoint(c);if(!d)return;this._placementBox.show=!0;const _=this._viewer.scene.modelRoot;this._touchInputHelper.goalPosition.copy(d),_.position.copy(d),this._viewer.scene.modelRoot.visible=!0,this._hitTestSource.cancel(),this._hitTestSource=void 0}_removePlacementBox(){this._placementBox&&(this._placementBox.removeFromParent(),this._placementBox=void 0)}_preSetupModel(){var h,o;const c=this._viewer.scene.modelRoot,d=this._viewer.scene.activeCamera,_=(h=this._xrManager)===null||h===void 0?void 0:h.getCamera(),b=_.cameras[0]||_;this._removePlacementBox();const _e=this._viewer.scene.getBounds(!0,!0);_e.getSize(new three_module.Pq0).length()>.01&&(this._placementBox=new ARPlacementBox(_e,_,this.placeOnWall),c.add(this._placementBox),this._placementBox.show=!1);const it=_.getWorldDirection(new three_module.Pq0);c.rotation.y=Math.atan2(-it.x,-it.z)-0,d.cameraObject.zoom=b.zoom,d.cameraObject.near=b.near,d.cameraObject.far=b.far,d.cameraObject.userData.autoNearFar=!1,d.cameraObject.isPerspectiveCamera?(d.cameraObject.fov=b.fov,d.cameraObject.aspect=b.viewport.width/b.viewport.height):console.warn("Perspective camera required."),d.cameraObject.updateProjectionMatrix();const nt=c.userData.arScale||1;c.scale.set(nt,nt,nt),c.position.copy(_.position).add(it.multiplyScalar(5)),c.visible=!0;const at=(o=this._viewer)===null||o===void 0?void 0:o.getPluginByType("Ground");at!=null&&at.mesh&&(at.shadowBaker.enabled=!1,at.renderToDepth=!1)}_restorePreXRState(){var h;if(!this._viewer)return;this._viewer.renderer.rendererObject.setSize(this._preXRState.viewport.x,this._preXRState.viewport.y),this._viewer.resize(),this._viewer.scene.activeCamera.setInteractions(!0,ARPlugin_1.PluginType),this._viewer.scene.activeCamera.autoLookAtTarget=!0,this._viewer.scene.background=this._preXRState.viewerBg,this._preXRState.viewerBgColor!==void 0&&((h=this._viewer.scene.backgroundColor)===null||h===void 0||h.set(this._preXRState.viewerBgColor)),this._preXRState.viewerBg=null;const o=this._viewer.scene.modelRoot;o.scale.copy(this._preXRState.modelScale),o.position.copy(this._preXRState.modelPosition),o.quaternion.copy(this._preXRState.modelRotation),o.updateMatrix(),o.updateMatrixWorld(!0),o.visible=!0;const c=this._viewer.scene.activeCamera;c.position.copy(this._preXRState.cameraPosition),c.target.copy(this._preXRState.cameraTarget),c.cameraObject.up.copy(this._preXRState.cameraUp),c.cameraObject.near=this._preXRState.cameraNear,c.cameraObject.far=this._preXRState.cameraFar,c.cameraObject.userData.autoNearFar=this._preXRState.cameraAutoNearFar,c.cameraObject.isPerspectiveCamera&&(this._preXRState.cameraFov!==void 0&&(c.cameraObject.fov=this._preXRState.cameraFov),this._preXRState.cameraAspect!==void 0&&(c.cameraObject.aspect=this._preXRState.cameraAspect)),c.positionUpdated(!1),c.targetUpdated(!0),c.cameraObject.projectionMatrix.copy(this._preXRState.cameraProjectionMatrix),c.cameraObject.projectionMatrixInverse.copy(this._preXRState.cameraProjectionMatrix).invert(),c.cameraObject.updateMatrixWorld(!0),c.cameraObject.updateProjectionMatrix();const d=this._viewer.getPluginByType("Ground");d!=null&&d.mesh&&(d.mesh.modelObject.position.subVectors(o.position,this._preXRState.groundOffset),d.mesh.modelObject.scale.setScalar(this._preXRState.groundScale),d.mesh.modelObject.rotation.z=this._preXRState.groundRotation,d.renderToDepth=this._preXRState.groundRenderToDepth,d.shadowBaker.enabled=this._preXRState.groundShadowBaker,d.refreshTransform()),this._viewer.scene.setEnvironment(this._preXRState.environment),this._preXRState.environment=void 0,this._viewer.renderFilter.passObject.preserveTransparentTarget=this._preXRState.preserveTransparentTarget}_cancelHitSources(){this._hitTestSource&&(this._hitTestSource.cancel(),this._hitTestSource=void 0),this._touchInputHelper.cancel()}};ARPlugin.PluginType="WEBXR_ARPlugin",ARPlugin_decorate([uiToggle("Light Estimate")],ARPlugin.prototype,"estimateLighting",void 0),ARPlugin_decorate([uiToggle("Place on Wall")],ARPlugin.prototype,"placeOnWall",void 0),ARPlugin_decorate([uiSlider("Resilution scale",[.1,1],.1)],ARPlugin.prototype,"xrResolutionScale",void 0),ARPlugin_decorate([uiButton("Enter AR")],ARPlugin.prototype,"enterAR",void 0),ARPlugin_decorate([uiButton("Exit AR")],ARPlugin.prototype,"exitAR",void 0),ARPlugin=ARPlugin_1=ARPlugin_decorate([uiFolder("WebXR AR")],ARPlugin);const arCopyPass=new ShaderPass2({vertexShader:CopyShader.vertexShader,fragmentShader:`
        ${unpackGbuffer}
        
        uniform float opacity;

		uniform sampler2D tDiffuse;
		uniform sampler2D tTransparentMap;

		varying vec2 vUv;

		void main() {
		
            float depth = getDepth(vUv);
            vec4 texel;
            if(depth>0.9999) {
			    texel = texture2D( tTransparentMap, vUv );
                if(texel.a < 0.01) discard; // background
                // transparent objects with render to depth = false
            }else {
                texel = texture2D( tDiffuse, vUv );
			}
            gl_FragColor = texel;
            
		}
		`,uniforms:{...CopyShader.uniforms,tNormalDepth:{value:null},tTransparentMap:{value:null}}});arCopyPass.renderToScreen=!1,arCopyPass.useExistingRenderTarget=!0,arCopyPass.clear=!1;var VRPluginBasic_decorate=function(h,o,c,d){var _,b=arguments.length,_e=b<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_e=Reflect.decorate(h,o,c,d);else for(var it=h.length-1;it>=0;it--)(_=h[it])&&(_e=(b<3?_(_e):b>3?_(o,c,_e):_(o,c))||_e);return b>3&&_e&&Object.defineProperty(o,c,_e),_e},VRPluginBasic_1;let VRPluginBasic=VRPluginBasic_1=class extends AViewerPlugin{constructor(){super(...arguments),this.enabled=!0,this.dependencies=[GBufferPlugin],this.xrResolutionScale=1,this.toJSON=void 0,this.enterVR=()=>{var h;this.enabled&&this._viewer&&(navigator&&navigator.xr?this._xrSession?console.warn("Already inVR"):this._xrManager?(this._xrManager.enabled=!0,(h=this._xrManager)===null||h===void 0||h.setFramebufferScaleFactor(this.xrResolutionScale),navigator.xr.requestSession("immersive-vr",{optionalFeatures:["local-floor","bounded-floor","hand-tracking","layers"]}).then(this._onSessionStarted)):console.error("XR manager not found"):console.error("XR not supported"))},this.exitVR=()=>{this._xrSession&&this._xrSession.end()},this._currentCameraIndex=0,this._preRender=()=>{var h;if(!(this._dirty&&this._viewer&&this._xrManager&&this._xrSession))return;this._viewer.renderer.defaultRenderToScreen=!1,this._xrManager.enabled=!1;const o=this._xrManager.getCamera(),c=((h=o.cameras)===null||h===void 0?void 0:h[this._currentCameraIndex])||o,d=this._viewer.scene.activeCamera;d.cameraObject.zoom=c.zoom,d.cameraObject.near=c.near,d.cameraObject.far=c.far,d.cameraObject.userData.autoNearFar=!1,d.cameraObject.isPerspectiveCamera?(d.cameraObject.fov=c.fov,d.cameraObject.aspect=c.viewport.width/c.viewport.height):console.warn("Perspective camera required."),d.cameraObject.position.copy(c.position),d.cameraObject.rotation.copy(c.rotation),d.cameraObject.updateMatrix(),d.cameraObject.updateProjectionMatrix(),d.cameraObject.projectionMatrix.copy(c.projectionMatrix),d.cameraObject.projectionMatrixInverse.copy(d.cameraObject.projectionMatrix).invert()},this._currentRt=null,this._postRender=()=>{var h,o,c,d;if(!this._dirty||!this._viewer||!this._xrSession)return;this._viewer.scene.activeCamera.cameraObject.updateProjectionMatrix();const _=this._viewer.renderer,b=(_.rendererObject.getViewport(new three_module.IUQ),(c=(o=(h=this._xrManager)===null||h===void 0?void 0:h.getCamera())===null||o===void 0?void 0:o.cameras)!==null&&c!==void 0?c:[]),_e=_.rendererObject.getRenderTarget(),it=(d=b[this._currentCameraIndex])===null||d===void 0?void 0:d.viewport;it?_e&&_.rendererObject.setViewport(it):console.warn("no viewport for vr camera index",this._currentCameraIndex),this._viewer.getPlugin(GBufferPlugin).updateShaderProperties(VRPluginBasic_arCopyPass.material),VRPluginBasic_arCopyPass.uniforms.tTransparentMap.value=this._viewer.renderFilter.passObject.transparentTarget.texture,setThreeRendererMode(_.rendererObject,{sceneRender:!0,opaqueRender:!0,shadowMapRender:!1,backgroundRender:!1,transparentRender:!1,transmissionRender:!1,screenSpaceRendering:!1},()=>{VRPluginBasic_arCopyPass.render(_.rendererObject,null,_.composer.readBuffer,0,!1)}),this._xrManager.enabled=!0,this._viewer.renderer.defaultRenderToScreen=!0,_e&&_.rendererObject.setViewport(_e.viewport),this._currentCameraIndex++,this._currentCameraIndex>=b.length&&(this._currentCameraIndex=0)},this._frameCount=0,this._isPresenting=!1,this._interactionsDisabled=!1,this._preFrame=({xrFrame:h,deltaTime:o})=>{var c,d;if(this.dirty=!!h&&((c=this._xrManager)===null||c===void 0?void 0:c.isPresenting)||!1,(this._dirty||this._interactionsDisabled)&&(this._viewer.scene.activeCamera.setInteractions(!this._dirty,VRPluginBasic_1.PluginType),this._viewer.scene.activeCamera.autoLookAtTarget=!this._dirty,this._interactionsDisabled=this._dirty),!this._dirty||!h)return void(this._isPresenting&&this._xrRenderingEnd());if(!this._xrSession)return console.error("no xr session found, shouldn't happen"),void(this.dirty=!1);this._isPresenting||console.log("webxr: VR session init"),this._frameCount++;const _=this._xrManager.getReferenceSpace(),b=h.getViewerPose(_);if(b==null&&this._frameCount,b==null||((d=this._viewer)===null||d===void 0?void 0:d.scene.modelRoot.children.length)===0)return this.dirty=!1,void console.warn("no pose or no model");this._isPresenting||(this._isPresenting=!0,this._frameCount=0,this._savePreXRState(),this._preSetupModel(),this._xrRenderingBegin());const _e=this._viewer.scene.activeCamera;this._xrManager.updateCamera(_e.cameraObject),_e.setDirty(),this._viewer.rendersPerFrame=b?b.views.length:1,this._updateShadow()},this._preXRState={viewerBg:null,viewerBgColor:void 0,modelScale:new three_module.Pq0(1,1,1),modelPosition:new three_module.Pq0,modelRotation:new three_module.PTz,cameraPosition:new three_module.Pq0(0,0,5),cameraTarget:new three_module.Pq0,cameraUp:new three_module.Pq0(0,1,0),cameraAspect:1,cameraFov:50,cameraZoom:1,cameraNear:.01,cameraFar:100,cameraProjectioMatrix:new three_module.kn4,cameraAutoNearFar:void 0,groundOffset:new three_module.Pq0,groundScale:1,groundRotation:0,groundRenderToDepth:!1,groundShadowBaker:!1,viewport:new three_module.I9Y,environment:void 0,preserveTransparentTarget:!0},this._savePreXRState=()=>{var h;if(!this._viewer)return;this._preXRState.viewport.copy(this._viewer.renderer.renderSize),this._preXRState.viewerBg=this._viewer.scene.background,this._preXRState.viewerBgColor=(h=this._viewer.scene.backgroundColor)===null||h===void 0?void 0:h.getHex();const o=this._viewer.scene.modelRoot,c=this._viewer.scene.activeCamera;o.updateMatrix(),o.updateMatrixWorld(!0),this._preXRState.modelScale.copy(o.scale),this._preXRState.modelPosition.copy(o.position),this._preXRState.modelRotation.copy(o.quaternion),this._preXRState.cameraPosition.copy(c.position),this._preXRState.cameraTarget.copy(c.target),this._preXRState.cameraUp.copy(c.cameraObject.up),c.cameraObject.isPerspectiveCamera&&(this._preXRState.cameraFov=c.cameraObject.fov,this._preXRState.cameraAspect=c.cameraObject.aspect),this._preXRState.cameraZoom=c.cameraObject.zoom,this._preXRState.cameraNear=c.cameraObject.near,this._preXRState.cameraFar=c.cameraObject.far,this._preXRState.cameraAutoNearFar=c.cameraObject.userData.autoNearFar,this._preXRState.cameraProjectioMatrix.copy(c.cameraObject.projectionMatrix);const d=this._viewer.getPluginByType("Ground");d!=null&&d.mesh&&(this._preXRState.groundOffset.subVectors(o.position,d.mesh.modelObject.position),this._preXRState.groundScale=d.mesh.modelObject.scale.x,this._preXRState.groundRotation=d.mesh.modelObject.rotation.z,this._preXRState.groundRenderToDepth=d.renderToDepth,this._preXRState.groundShadowBaker=d.shadowBaker.enabled),this._preXRState.environment||(this._preXRState.environment=this._viewer.scene.environment),this._preXRState.preserveTransparentTarget=this._viewer.renderFilter.passObject.preserveTransparentTarget},this._xrRenderingBegin=()=>{this._xrSession&&this._viewer&&(console.log("webxr: VR session start"),this._viewer.renderer.stableNoise=!0,this._viewer.resize())},this._xrRenderingEnd=()=>{console.log("webxr: VR session end"),this._xrManager&&(this._xrManager.enabled=!1),this._isPresenting=!1,this._frameCount=0,this._xrSession=void 0,this._cancelHitSources(),this._viewer&&(this._viewer.renderer.stableNoise=!1),this._restorePreXRState()},this._onSessionStarted=async h=>{h.addEventListener("end",this._onSessionEnded),this._xrManager.setReferenceSpaceType("local"),await this._xrManager.setSession(h),this._xrSession=h},this._onSessionEnded=()=>{this._xrSession&&this._xrSession.removeEventListener("end",this._onSessionEnded)}}async onAdded(h){await super.onAdded(h);const o=h.renderer.rendererObject.xr;if(o.cameraAutoUpdate=!1,this._xrManager=o,!this.domOverlay){const c=document.getElementById("tweakpaneUiContainer");this.domOverlay=c?{root:c}:void 0}if(h.addEventListener("preRender",this._preRender),h.addEventListener("postRender",this._postRender),h.addEventListener("preFrame",this._preFrame),!window.isSecureContext)return h.console.error("XR not supported in insecure context, try https://"),void(this.enabled=!1);navigator&&"xr"in navigator&&navigator.xr?navigator.xr.isSessionSupported("immersive-vr").then(c=>{if(!c)throw new Error("VR not supported")}).catch(c=>{h.console.error("VR not supported:",c),o.enabled=!1,this.enabled=!1}):(o.enabled=!1,this.enabled=!1)}_updateShadow(){var h,o;if(!this._viewer)return;const c=this._viewer.scene.modelRoot,d=(o=(h=this._viewer.getPluginByType("Ground"))===null||h===void 0?void 0:h.mesh)===null||o===void 0?void 0:o.modelObject;d&&(d.rotation.z=this._viewer.scene.modelRoot.rotation.y,d.position.copy(this._preXRState.groundOffset).multiplyScalar(c.modelObject.scale.x).sub(c.modelObject.position).negate(),d.scale.setScalar(c.modelObject.scale.x*this._preXRState.groundScale))}_preSetupModel(){var h;const o=this._viewer.scene.modelRoot,c=o.userData.arScale||1;o.scale.set(c,c,c),o.visible=!0;const d=(h=this._viewer)===null||h===void 0?void 0:h.getPluginByType("Ground");d!=null&&d.mesh&&(d.shadowBaker.enabled=!1,d.renderToDepth=!1)}_restorePreXRState(){var h;if(!this._viewer)return;this._viewer.renderer.rendererObject.setSize(this._preXRState.viewport.x,this._preXRState.viewport.y),this._viewer.resize(),this._viewer.scene.activeCamera.setInteractions(!0,VRPluginBasic_1.PluginType),this._viewer.scene.activeCamera.autoLookAtTarget=!0,this._viewer.scene.background=this._preXRState.viewerBg,this._preXRState.viewerBgColor!==void 0&&((h=this._viewer.scene.backgroundColor)===null||h===void 0||h.set(this._preXRState.viewerBgColor)),this._preXRState.viewerBg=null;const o=this._viewer.scene.modelRoot;o.scale.copy(this._preXRState.modelScale),o.position.copy(this._preXRState.modelPosition),o.quaternion.copy(this._preXRState.modelRotation),o.updateMatrix(),o.updateMatrixWorld(!0),o.visible=!0;const c=this._viewer.scene.activeCamera;c.position.copy(this._preXRState.cameraPosition),c.target.copy(this._preXRState.cameraTarget),c.cameraObject.up.copy(this._preXRState.cameraUp),c.cameraObject.near=this._preXRState.cameraNear,c.cameraObject.far=this._preXRState.cameraFar,c.cameraObject.userData.autoNearFar=this._preXRState.cameraAutoNearFar,c.cameraObject.isPerspectiveCamera&&(this._preXRState.cameraFov!==void 0&&(c.cameraObject.fov=this._preXRState.cameraFov),this._preXRState.cameraAspect!==void 0&&(c.cameraObject.aspect=this._preXRState.cameraAspect)),c.positionUpdated(!1),c.targetUpdated(!0),c.cameraObject.projectionMatrix.copy(this._preXRState.cameraProjectioMatrix),c.cameraObject.projectionMatrixInverse.copy(this._preXRState.cameraProjectioMatrix).invert(),c.cameraObject.updateMatrixWorld(!0),c.cameraObject.updateProjectionMatrix();const d=this._viewer.getPluginByType("Ground");d!=null&&d.mesh&&(d.mesh.modelObject.position.subVectors(o.position,this._preXRState.groundOffset),d.mesh.modelObject.scale.setScalar(this._preXRState.groundScale),d.mesh.modelObject.rotation.z=this._preXRState.groundRotation,d.renderToDepth=this._preXRState.groundRenderToDepth,d.shadowBaker.enabled=this._preXRState.groundShadowBaker,d.refreshTransform()),this._viewer.scene.environment=this._preXRState.environment,this._preXRState.environment=void 0,this._viewer.renderFilter.passObject.preserveTransparentTarget=this._preXRState.preserveTransparentTarget}_cancelHitSources(){}};VRPluginBasic.PluginType="WEBXR_VRPluginBasic",VRPluginBasic_decorate([uiSlider("Resolution scale",[.1,1],.1)],VRPluginBasic.prototype,"xrResolutionScale",void 0),VRPluginBasic_decorate([uiButton("Enter VR")],VRPluginBasic.prototype,"enterVR",void 0),VRPluginBasic_decorate([uiButton("Exit VR")],VRPluginBasic.prototype,"exitVR",void 0),VRPluginBasic=VRPluginBasic_1=VRPluginBasic_decorate([uiFolder("WebXR VR")],VRPluginBasic);const VRPluginBasic_arCopyPass=new ShaderPass2({vertexShader:CopyShader.vertexShader,fragmentShader:`
        ${unpackGbuffer}
        
        uniform float opacity;

		uniform sampler2D tDiffuse;
		uniform sampler2D tTransparentMap;

		varying vec2 vUv;

		void main() {
		
            float depth = getDepth(vUv);
            vec4 texel;
            if(depth>0.9999) {
			    texel = texture2D( tTransparentMap, vUv );
                if(texel.a < 0.01) discard; // background
                // transparent objects with render to depth = false
            }else {
                texel = texture2D( tDiffuse, vUv );
			}
            gl_FragColor = texel;
            
		}
		`,uniforms:{...CopyShader.uniforms,tNormalDepth:{value:null},tTransparentMap:{value:null}}});VRPluginBasic_arCopyPass.renderToScreen=!1,VRPluginBasic_arCopyPass.useExistingRenderTarget=!0,VRPluginBasic_arCopyPass.clear=!1;class ACanvasRecorder extends I$2{get state(){return this._state}setState(o,c){this._state=o,this.dispatchEvent({type:o,...c})}_setOptions(o){Object.assign(this.options,o)}setOptions(o){this._setOptions(o)}constructor(o,c){super(),this._state="stopped",this._console=console,this._currentRecording=[],this._frameCount=0,this._ondataavailable=d=>{d.data&&d.data.size>0&&this._currentRecording.push(d.data)},this._canvas=o,c==null||c.mimeType,this.options={mimeType:"auto",frameRate:30,stepMode:!1},this._setOptions(c||this.options)}isRecording(){return this._state==="recording"}requestFrame(){return this._state==="recording"&&(this._frameCount++,!0)}dispose(){(this.isRecording()||this._state==="paused")&&this.stop(o=>{this._console.warn("disposed with blob",o),this.dispose()})}}class ImageSequenceRecorder extends ACanvasRecorder{constructor(){super(...arguments),this._currentImages=[],this._onstop=o=>{this._currentImages.length>0&&(this._writeImages([...this._currentImages]),this._currentImages=[]),this.setState("stopped")},this._onerror=o=>{this.setState("error",{error:o}),this._console.error(o)}}start(){if(this.state!=="recording"){if(this.state==="error"&&this._console.warn("Resetting from error state."),this.state==="paused")return this.setState("starting"),void this.setState("recording");this._currentRecording=[],this._currentImages=[],this._frameCount=0,this.setState("starting"),window&&window.showDirectoryPicker&&window.showDirectoryPicker().then(async o=>{const c=await(o==null?void 0:o.getDirectoryHandle("i-"+Math.floor(Date.now()),{create:!0}));this._imgDirectory=c,this._frameCount=0,this.setState("recording")}).catch(o=>{this._onerror({detail:o})})}else this._console.log("Already recording canvas")}requestFrame(){if(!super.requestFrame())return!1;const o=this.options.mimeType;return this._canvas.toBlob(c=>{this._currentImages.push(["frame_"+String(this._frameCount).padStart(5,"0")+(o.includes("png")?".png":".jpg"),c])},o,90),this._currentImages.length>60&&(this._writeImages([...this._currentImages]),this._currentImages=[]),!0}pause(){this.state!=="paused"&&this.state!=="stopped"&&this.setState("paused")}stop(o){this.state!=="stopped"&&(this.state!=="error"?(this._recordingCallback=o,this.setState("stopping"),this._onstop({})):this._console.error("Recorder in error state, cannot stop, call start again."))}async _writeImages(o){if(!this._imgDirectory)return;const c=[];for(const d of o){const _=await this._imgDirectory.getFileHandle(d[0],{create:!0});c.push($e$1(_,d[1]))}await Promise.all(c)}}class CanvasMediaRecorder extends ACanvasRecorder{_setOptions(o){var c,d;super._setOptions(o),this.options.mimeType&&this.options.mimeType!=="auto"||(this.options.mimeType=(c=CanvasMediaRecorder.GetSupportedMimeTypes([],["h264"],!0))!==null&&c!==void 0?c:CanvasMediaRecorder.GetSupportedMimeTypes(void 0,void 0,!0)),this.options.mimeType&&!(!((d=this.options.mimeType)===null||d===void 0)&&d.startsWith("video/"))||window.MediaRecorder||(this._console.warn("MediaRecorder is not supported, switching to png"),this.options.mimeType="image/png"),this.options.mimeType||console.warn(new Error("No supported mimetype found"))}setOptions(o){this._setOptions(o)}constructor(o,c){super(o,c),this._resumeSyncTime=0,this._onstop=d=>{var _;if(this._recorder&&this._currentRecording.length>0){const b=new Blob(this._currentRecording,{type:this.options.mimeType});(_=this._recordingCallback)===null||_===void 0||_.call(this,b)}this._recorder=void 0,this.setState("stopped")},this._onstart=d=>{var _;this._frameCount=0,this.options.stepMode&&((_=this._recorder)===null||_===void 0||_.pause()),this.setState("recording")},this._onresume=d=>{if(this.state!=="paused"&&this.state!=="starting"&&this.state!=="stopped"||this.setState("recording"),!this.options.stepMode)return;const _=()=>{var _e;this.state==="recording"&&((_e=this._recorder)===null||_e===void 0||_e.pause())},b=Math.min(this._resumeSyncTime-g(),0)+1e3/this.options.frameRate;b>0?X$2(b).then(_):_()},this._onerror=d=>{this.setState("error",{error:d}),this._console.error(d),this._recorder=void 0}}start(){var o,c,d;if(this.state==="recording")return void this._console.log("Already recording canvas");if(this.state==="error"&&(this._recorder=void 0,this._console.warn("Resetting from error state.")),this._recorder)return this.state==="paused"?(this.setState("starting"),void this._recorder.resume()):void this._console.warn("Canvas recorder unknown state",this.state);const _={mimeType:this.options.mimeType,videoBitsPerSecond:this.options.videoBitsPerSecond};if(this._currentRecording=[],this._frameCount=0,(o=_.mimeType)===null||o===void 0?void 0:o.startsWith("video")){if(!window.MediaRecorder)return this._console.error("MediaRecorder not supported, use image sequence"),void this.setState("error",{error:new Error("MediaRecorder not supported")});{const b=this._canvas.captureStream(this.options.stepMode?0:this.options.frameRate),_e=(c=b.getVideoTracks())===null||c===void 0?void 0:c[0];this._track=_e,this._recorder=new window.MediaRecorder(b,_),this._recorder.onstop=this._onstop,this._recorder.ondataavailable=this._ondataavailable,this._recorder.onerror=this._onerror,this._recorder.onresume=this._onresume,this._recorder.onstart=this._onstart}}this.setState("starting"),this._recorder&&((d=this._recorder)===null||d===void 0||d.start())}requestFrame(){return!(!this._recorder||!super.requestFrame()||this._track&&this.options.stepMode&&(this._resumeSyncTime=g(),this._track.requestFrame(),this._recorder.resume(),0))}pause(){this.state!=="paused"&&this.state!=="stopped"&&(this.options.stepMode?console.error("Pause not supported in stepMode"):this._recorder&&(this._recorder.pause(),this.setState("paused")))}stop(o){this.state!=="stopped"&&(this.state!=="error"?(this._recordingCallback=o,this.setState("stopping"),this._recorder&&this._recorder.stop()):this._console.error("Recorder in error state, cannot stop, call start again."))}dispose(){this._recorder&&(super.dispose(),this._recorder=void 0)}static GetSupportedMimeTypes(o,c,d=!1){if(!window.MediaRecorder)return d?void 0:[];const _=["webm","ogg","mp4","x-matroska"].filter(it=>!o||o.length<1||o.includes(it)),b=["vp9","vp9.0","vp8","vp8.0","avc1","av1","h265","h.265","h264","h.264","opus"].filter(it=>!c||c.length<1||c.includes(it)),_e=[];return _.forEach(it=>{const nt=`video/${it}`;b.forEach(at=>{[`${nt};codecs=${at}`,`${nt};codecs:${at}`,`${nt};codecs=${at.toUpperCase()}`,`${nt};codecs:${at.toUpperCase()}`,`${nt}`].forEach(ut=>{MediaRecorder.isTypeSupported(ut)&&_e.push(ut)})})}),d?_e.length>0?_e[0]:void 0:_e}}class FFMPEGRecorder extends ACanvasRecorder{constructor(o,c){super(o,c),this._workerRunning=!1,this.ffmpegOptions={imageType:"jpeg",bitrate:"10M",crf:17,pixFmt:"yuv420p",preset:"ultrafast",colorTrc:"bt709",colorSpace:"bt709"},this.worker=new Worker(ct(FFMPEGRecorder.LIBRARY_PATH+"ffmpeg-worker-mp4.js",FFMPEGRecorder.LIBRARY_PATH+"ffmpeg-worker-mp4.wasm")),this.worker.onmessage=d=>{var _;const b=d.data;switch(b.type){case"stdout":case"stderr":if(b.data.indexOf("frame=")===0){const _e=parseInt(b.data.split("frame=")[1].split("fps")[0].trim()),it=this._frameCount,nt=Math.round(_e/it*100);this.dispatchEvent({type:"encode-progress",progress:nt,frame:_e,totalFrames:it})}console.log(b.data+`
`);break;case"exit":console.log("Process exited with code "+b.data),parseInt(b.data);break;case"done":if(b.data.MEMFS[0].data===void 0)return void console.log("video processing failed");this._workerRunning=!1,(_=this._recordingCallback)===null||_===void 0||_.call(this,new Blob([b.data.MEMFS[0].data],{type:"video/mp4"})),console.timeEnd("ffmpeg-record"),this.setState("stopped")}}}start(){this.state!=="recording"?(this.state==="error"&&console.warn("Resetting from error state."),this.state!=="paused"&&(this._frameCount=0),this.setState("starting"),this.setState("recording")):console.log("Already recording canvas")}stop(o){this.state!=="stopped"&&(this.state!=="error"?(this._recordingCallback=o,this.setState("stopping"),this._lastCanvasCapturePromise?this._lastCanvasCapturePromise.then(()=>this._onStop()):this._onStop()):console.error("FFMPEGRecorder: Recorder in error state, cannot stop, call start again."))}_onStop(){var o,c,d,_;const b=this._canvas.width%2==0?this._canvas.width:this._canvas.width-1;this._workerRunning=!0,console.time("ffmpeg-record");const _e=this.options.frameRate.toString(),it=this.options.frameRate.toString(),nt=["-r",_e,"-an","-i",`img%06d.${this._mime}`,"-frames:v",this._frameCount.toString(),"-c:v","libx264","-crf",Math.min(28,Math.max(1,(o=this.ffmpegOptions.crf)!==null&&o!==void 0?o:17)).toString(),"-filter:v",`scale=${b}:-2`,"-pix_fmt",(c=this.ffmpegOptions.pixFmt)!==null&&c!==void 0?c:"yuv420p","-b:v",(d=this.ffmpegOptions.bitrate)!==null&&d!==void 0?d:"10M","-preset",(_=this.ffmpegOptions.preset)!==null&&_!==void 0?_:"ultrafast","-r",it];this.ffmpegOptions.colorSpace&&nt.push("-colorspace",this.ffmpegOptions.colorSpace),this.ffmpegOptions.colorTrc&&nt.push("-color_trc",this.ffmpegOptions.colorTrc),nt.push("out.mp4"),console.log(nt),this.worker.postMessage({type:"run",arguments:nt})}requestFrame(){return!!super.requestFrame()&&(this.sendBlobToWorker(this._frameCount-1),!0)}get _mime(){var o;let c=(o=this.ffmpegOptions.imageType)!==null&&o!==void 0?o:"jpeg";return c&&["png","jpeg","webp"].includes(c)||(console.warn("FFMPEGRecorder: Unsupported mime type",this.ffmpegOptions.imageType),c="jpeg"),c}sendBlobToWorker(o){this._lastCanvasCapturePromise&&console.warn("FFMPEGRecorder: Previous frame capture not complete",o-1);const c=this._mime;this._lastCanvasCapturePromise=new Promise(d=>{this._canvas.toBlob(_=>{this.worker.postMessage({type:"image",file:{name:`img${o.toString().padStart(6,"0")}.${c}`,data:_}}),this._lastCanvasCapturePromise=void 0,d()},`image/${c}`,90)})}pad(o,c){return(o+="").length>=c?o:new Array(c-o.length+1).join("0")+o}pause(){this.state!=="paused"&&this.state!=="stopped"&&this.setState("paused")}setOptions(o){super.setOptions(o)}}FFMPEGRecorder.LIBRARY_PATH="https://cdn.jsdelivr.net/npm/@repalash/ffmpeg.js@4.2.9005/dist/";var CanvasRecorderPlugin_decorate=function(h,o,c,d){var _,b=arguments.length,_e=b<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_e=Reflect.decorate(h,o,c,d);else for(var it=h.length-1;it>=0;it--)(_=h[it])&&(_e=(b<3?_(_e):b>3?_(o,c,_e):_(o,c))||_e);return b>3&&_e&&Object.defineProperty(o,c,_e),_e};class CanvasRecorderPlugin extends AViewerPlugin{get recorder(){return this._recorder}constructor(){super(),this.enabled=!0,this.convergeMode=!0,this.mimeType="video/mp4",this.videoFrameRate=30,this._recorders={},this._renderToScreenDisabled=!1,this._preRender=()=>{var o,c,d;if(this.convergeMode&&!((o=this._recorder)===null||o===void 0)&&o.isRecording()){const _=this._viewer.renderer.composer.renderToScreen;this._viewer.renderer.composer.renderToScreen=((d=(c=this._viewer)===null||c===void 0?void 0:c.getPluginByType("Progressive"))===null||d===void 0?void 0:d.isConverged())||!1,_&&!this._viewer.renderer.composer.renderToScreen&&(this._renderToScreenDisabled=!0)}},this._postRender=()=>{var o,c,d;if(!((o=this._recorder)===null||o===void 0)&&o.isRecording()&&(!this.convergeMode||!((d=(c=this._viewer)===null||c===void 0?void 0:c.getPluginByType("Progressive"))===null||d===void 0)&&d.isConverged(!0))){const _=()=>{var b;return(b=this._recorder)===null||b===void 0?void 0:b.requestFrame()};this.convergeMode?X$2(1).then(_):_()}this._renderToScreenDisabled&&(this._viewer.renderer.composer.renderToScreen=!0)},this._refreshUi=()=>{var o;(o=this.uiConfig.children)===null||o===void 0||o.map(c=>Ee$1(c)).flat(2).forEach(c=>{var d;return(d=c==null?void 0:c.uiRefresh)===null||d===void 0?void 0:d.call(c)})},this.endPaddingMs=500,this._turntableAnimationAngle=360,this._turntableAnimationDuration=5,this._turntableAnimationEasing="linear",this.uiConfig={type:"folder",label:"Video Export",children:[{type:"slider",label:"Frame Rate",bounds:[1,60],stepSize:1,property:[this,"videoFrameRate"]},{type:"checkbox",property:[this,"convergeMode"],onChange:()=>{var o,c;return(c=(o=this.uiConfig).uiRefresh)===null||c===void 0?void 0:c.call(o,"postFrame",!0)}},{type:"dropdown",label:"Mime type",property:[this,"mimeType"],children:[["Auto Video (x264)","auto"],["PNG sequence","image/png"],["JPEG sequence","image/jpeg"],["WEBP sequence","image/webp"],["MP4 Video (ffmpeg)","video/mp4"]].map(o=>({label:o[0],value:o[1]}))},generateUiFolder("FFmpeg Options (Advanced)",()=>this._recorder.ffmpegOptions,{},"folder",!0),{type:"input",disabled:!0,label:"State",getValue:()=>{var o,c;return(c=(o=this.recorder)===null||o===void 0?void 0:o.state)!==null&&c!==void 0?c:"not initialized"}},{type:"button",label:()=>this.isRecording()?"Stop Recording":"Start Recording",hidden:()=>!this.isRecording()&&this.convergeMode,value:()=>{this.isRecording()?this.stopRecording().then(async o=>{if(o){const c=o.type.split(";")[0].split("/").pop()||"mp4";await this._downloadBlob(o,c)}}):this.startRecording()}},{type:"button",label:"Record Camera Views",hidden:()=>{var o;return this.isRecording()||!(!((o=this._viewer)===null||o===void 0)&&o.getPluginByType("CameraViews"))},value:()=>{var o,c;(c=(o=this._viewer)===null||o===void 0?void 0:o.getPluginByType("CameraViews"))===null||c===void 0||c.recordAllViews()}},{type:"button",label:"Record Camera Views + GLTF Anim",hidden:()=>{var o,c,d;return this.isRecording()||!(!((o=this._viewer)===null||o===void 0)&&o.getPluginByType("CameraViews"))||!(!((d=(c=this._viewer)===null||c===void 0?void 0:c.getPluginByType("GLTFAnimation"))===null||d===void 0)&&d.animations.length)},value:()=>{var o,c,d,_;const b=((c=(o=this._viewer)===null||o===void 0?void 0:o.getPluginByType("GLTFAnimation"))===null||c===void 0?void 0:c.animationState)==="playing";(_=(d=this._viewer)===null||d===void 0?void 0:d.getPluginByType("CameraViews"))===null||_===void 0||_.recordAllViews(()=>{var _e,it;(it=(_e=this._viewer)===null||_e===void 0?void 0:_e.getPluginByType("GLTFAnimation"))===null||it===void 0||it.playAnimation()}).then(()=>{var _e,it;b||(it=(_e=this._viewer)===null||_e===void 0?void 0:_e.getPluginByType("GLTFAnimation"))===null||it===void 0||it.stopAnimation()})}},{type:"button",label:"Record GLTF Anim",hidden:()=>{var o,c;return this.isRecording()||!(!((c=(o=this._viewer)===null||o===void 0?void 0:o.getPluginByType("GLTFAnimation"))===null||c===void 0)&&c.animations.length)},value:async()=>{var o;if(this.isRecording())return;const c=(o=this._viewer)===null||o===void 0?void 0:o.getPluginByType("GLTFAnimation");if(!c)return;let d=!1;c.loopAnimations&&(d=!0),d&&(c.loopAnimations=!1);const _=await this.record(async()=>c.playAnimation());if(d&&(c.loopAnimations=!0),_){const b=_.type.split(";")[0].split("/").pop()||"mp4";await this._downloadBlob(_,b)}}},{type:"number",label:"Turntable animation angle",disabled:()=>this.isRecording(),property:[this,"_turntableAnimationAngle"]},{type:"number",label:"Turntable animation time (sec)",disabled:()=>this.isRecording(),property:[this,"_turntableAnimationDuration"]},{type:"dropdown",label:"Turntable animation ease",children:Object.keys(EasingFunctions).map(o=>({label:o})),disabled:()=>this.isRecording(),property:[this,"_turntableAnimationEasing"]},{type:"button",label:"Record turntable animation",hidden:()=>this.isRecording(),value:async()=>this.download360Recording(this._turntableAnimationDuration,!1,this._turntableAnimationAngle,EasingFunctions[this._turntableAnimationEasing])},{type:"button",label:"Record turntable animation (CCW)",hidden:()=>this.isRecording(),value:async()=>this.download360Recording(this._turntableAnimationDuration,!0,this._turntableAnimationAngle,EasingFunctions[this._turntableAnimationEasing])},{type:"number",label:"After recording wait time (ms)",disabled:()=>this.isRecording(),property:[this,"endPaddingMs"]}]},this.refreshRecorderOptions=this.refreshRecorderOptions.bind(this)}isRecording(){var o,c;return(c=(o=this._recorder)===null||o===void 0?void 0:o.isRecording())!==null&&c!==void 0&&c}refreshRecorderOptions(){var o,c;if(!this._viewer)return;let d="image";this.mimeType==="video/mp4"?d="ffmpeg.js":this.mimeType==="auto"?d="canvas-media":this.mimeType.startsWith("image")&&(d="image"),this._recorder=this._getRecorder(d),this._recorder&&(this._recorder.setOptions({frameRate:this.videoFrameRate,mimeType:this.mimeType,stepMode:this.convergeMode,internalMimeType:this.internalMimeType}),(c=(o=this.uiConfig).uiRefresh)===null||c===void 0||c.call(o,"postFrame",!0))}async onAdded(o){var c;await super.onAdded(o),o.addEventListener("preRender",this._preRender),o.addEventListener("postRender",this._postRender),o.scene.addEventListener("addSceneObject",this._refreshUi),this._recordIndicator=document.createElement("div"),this._recordIndicator.style.width="20px",this._recordIndicator.style.height="20px",this._recordIndicator.style.backgroundColor="red",this._recordIndicator.style.top="10px",this._recordIndicator.style.left="10px",this._recordIndicator.style.position="absolute",this._recordIndicator.style.borderRadius="100%",this._recordIndicator.style.visibility="hidden",(c=o.canvas.parentElement)===null||c===void 0||c.appendChild(this._recordIndicator),this.refreshRecorderOptions()}_stateChange(o){var c,d;this.dirty=o,(c=this._viewer)===null||c===void 0||c.setDirty(),(d=this.uiConfig.children)===null||d===void 0||d.map(_=>Ee$1(_)).flat(2).forEach(_=>{var b;return(b=_==null?void 0:_.uiRefresh)===null||b===void 0?void 0:b.call(_)})}async onRemove(o){var c;return o.removeEventListener("preRender",this._preRender),o.removeEventListener("preRender",this._postRender),o.scene.removeEventListener("addSceneObject",this._refreshUi),(c=this._recorder)===null||c===void 0||c.dispose(),Object.values(this._recorders).forEach(d=>{d==null||d.dispose()}),super.onRemove(o)}async record(o,c){var d,_;if(!this.enabled||!((d=this._recorder)===null||d===void 0)&&d.isRecording())return;const b=(_=this._viewer)===null||_===void 0?void 0:_.getPluginByType("Progressive"),_e=b==null?void 0:b.maxFrameCount;b&&this.convergeMode&&(b.maxFrameCount=Math.min(16,_e??16)),await new Promise((nt,at)=>{const ut=()=>{this.removeEventListener("start",pt),this.removeEventListener("stop",ut),this.removeEventListener("error",mt)},pt=async()=>{ut(),c==null||c(),await o(),nt()},mt=async()=>{ut(),at()};this.addEventListener("start",pt),this.addEventListener("stop",ut),this.addEventListener("error",mt),this.startRecording()});const it=await this.stopRecording();return b&&this.convergeMode&&(b.maxFrameCount=_e??16),it}startRecording(){var o;return!!this.enabled&&((o=this.recorder)===null||o===void 0?void 0:o.isRecording())===!1&&(this.recorder.options.stepMode=this.convergeMode,this.recorder.start(),!0)}async stopRecording(){var o,c;if(!((o=this.recorder)===null||o===void 0)&&o.isRecording()&&this._viewer){if(await this._viewer.doOnce("postFrame"),this.convergeMode){const d=(c=this._viewer)===null||c===void 0?void 0:c.getPluginByType("Progressive");if(d)for(let _=0;_<10&&!d.isConverged(!0);_++)await this._viewer.doOnce("postFrame")}return this.endPaddingMs&&await X$2(this.endPaddingMs),new Promise((d,_)=>{var b;return(b=this.recorder)===null||b===void 0?void 0:b.stop(d)})}}async _downloadBlob(o,c){var d,_,b;const _e=await((d=this._viewer)===null||d===void 0?void 0:d.prompt("Canvas Recorder: Save file as","recording.mp4",!1)),it=(_=this._viewer)===null||_===void 0?void 0:_.getPluginByType("FileTransferPlugin");it?await it.exportFile(o,_e||"recording.mp4"):(b=this._viewer)===null||b===void 0||b.console.error("FileTransferPlugin required to export/download file")}async download360Recording(o=null,c=!1,d=360,_){var b;if(!((b=this.recorder)===null||b===void 0)&&b.isRecording()||!this._viewer)return;const _e=o||await this._viewer.prompt("Enter duration in seconds","5",!0);if(_e===null)return;const it=parseFloat(_e||"5");if(!isFinite(it)||it<=0)return;const nt=await this.recordCamera360(it,c,d,_);if(nt){const at=nt.type.split(";")[0].split("/").pop()||"mp4";await this._downloadBlob(nt,at)}}async recordCamera360(o,c=!1,d=360,_){var b;if(!((b=this.recorder)===null||b===void 0)&&b.isRecording()||!this._viewer)return;const _e=this._viewer.scene.activeCamera;let it=_e.interactionsEnabled,nt=0;for(;!(it||(this._viewer.setDirty(),await this._viewer.doOnce("postFrame"),nt%30==0&&this._viewer.console.warn("CanvasRecorderPlugin: interactions are already disabled by something, waiting..."),it=_e.interactionsEnabled,nt>5e3/30));)nt++;_e.setInteractions(!1,CanvasRecorderPlugin.PluginType);const at=_e.target.clone(),ut=_e.position.clone().sub(at),pt=await this._viewer.getPluginByType("PopmotionPlugin");if(!pt)return void console.error("Popmotion plugin not found");const mt=new three_module.YHV().setFromVector3(ut);_e.position.setFromSpherical(mt).add(at),_e.positionUpdated(!0);const ft=_e.autoLookAtTarget;_e.autoLookAtTarget=!0;const vt=mt.theta,xt=await this.record(async()=>pt.animate({from:vt,to:vt+(c?-1:1)*d*Math.PI/180,duration:1e3*o,ease:_??EasingFunctions.linear,onUpdate:At=>{mt.theta=At,_e.position.setFromSpherical(mt).add(at),_e.positionUpdated(!0)},onComplete:async()=>{mt.theta=vt,_e.position.setFromSpherical(mt).add(at),_e.positionUpdated(!0)}}).promise);return _e.autoLookAtTarget=ft,_e.position.copy(ut).add(at),_e.positionUpdated(!0),_e.setInteractions(!0,CanvasRecorderPlugin.PluginType),xt}_getRecorder(o){if(!this._viewer)throw new Error("No viewer");if(this._recorders[o])return this._recorders[o];let c;return c=o==="canvas-media"?new CanvasMediaRecorder(this._viewer.canvas,{frameRate:this.videoFrameRate,mimeType:this.mimeType}):o==="ffmpeg.js"?new FFMPEGRecorder(this._viewer.canvas,{frameRate:this.videoFrameRate,mimeType:this.mimeType}):new ImageSequenceRecorder(this._viewer.canvas,{frameRate:this.videoFrameRate,mimeType:this.mimeType}),c.addEventListener("starting",()=>this._stateChange(!1)),c.addEventListener("recording",()=>{this._recordIndicator.style.visibility="visible",this._recordIndicator.style.backgroundColor="red",this.dispatchEvent({type:"start"}),this._stateChange(!this.convergeMode)}),c.addEventListener("error",()=>{this.dispatchEvent({type:"error"})}),c.addEventListener("paused",()=>this._stateChange(!1)),c.addEventListener("stopped",()=>{this._recordIndicator.style.visibility="hidden",this.dispatchEvent({type:"stop"}),this._stateChange(!1)}),c.addEventListener("encode-progress",d=>{this.dispatchEvent({...d})}),this._recorders[o]=c,c}}function isSafari(){return navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}CanvasRecorderPlugin.PluginType="CanvasRecorder",CanvasRecorderPlugin_decorate([x$1(CanvasRecorderPlugin.prototype.refreshRecorderOptions),serialize()],CanvasRecorderPlugin.prototype,"convergeMode",void 0),CanvasRecorderPlugin_decorate([x$1(CanvasRecorderPlugin.prototype.refreshRecorderOptions),serialize()],CanvasRecorderPlugin.prototype,"mimeType",void 0),CanvasRecorderPlugin_decorate([x$1(CanvasRecorderPlugin.prototype.refreshRecorderOptions),serialize()],CanvasRecorderPlugin.prototype,"videoFrameRate",void 0),CanvasRecorderPlugin_decorate([uiSlider("End padding (MS)",[0,1e3],1)],CanvasRecorderPlugin.prototype,"endPaddingMs",void 0);class CanvasSnipper{static async GetClonedCanvas(o,{rect:c={x:0,y:0,width:o.width,height:o.height,assumeClientRect:!1,normalized:!1},displayPixelRatio:d=1,scale:_=1}){var b,_e,it;c={...c};const nt=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");c.normalized?(c.x=Math.floor(c.x*o.width),c.y=Math.floor(c.y*o.height),c.width=Math.floor(c.width*o.width),c.height=Math.floor(c.height*o.height),c.assumeClientRect&&console.warn("CanvasSnipper: rect.assumeClientRect is ignored when rect is normalized")):c.assumeClientRect&&(c.x=Math.floor(c.x*o.width/(d*o.clientWidth)),c.y=Math.floor(c.y*o.height/(d*o.clientHeight)),c.width=Math.floor(c.width*o.width/(d*o.clientWidth)),c.height=Math.floor(c.height*o.height/(d*o.clientHeight))),nt.width=Math.floor(c.width*_*d),nt.height=Math.floor(c.height*_*d);const at=nt.getContext("2d");if(!at)return console.error("snapshot: cannot create context"),nt;const ut=o.style.background||((b=o.parentElement)===null||b===void 0?void 0:b.style.background)||"";if(ut.includes("url")){const pt=(_e=/url\("(.*)"\)/gi.exec(ut))===null||_e===void 0?void 0:_e[1];if(pt){const mt=new Image;mt.src=pt,await new Promise((ft,vt)=>{mt.onload=()=>ft(),mt.onerror=()=>vt(),mt.complete&&ft()}),at.drawImage(mt,Math.floor(mt.width*c.x*d/o.width),Math.floor(mt.height*c.y*d/o.height),Math.floor(mt.width*c.width*d/o.width),Math.floor(mt.height*c.height*d/o.height),0,0,nt.width,nt.height)}}else at.fillStyle=o.style.background||((it=o.parentElement)===null||it===void 0?void 0:it.style.backgroundColor)||"#00000000",at.fillRect(0,0,nt.width,nt.height);return at==null||at.drawImage(o,Math.floor(c.x*d),Math.floor(c.y*d),Math.floor(c.width*d),Math.floor(c.height*d),0,0,nt.width,nt.height),this.Debug&&(document.body.appendChild(nt),nt.style.position="absolute",nt.style.top="0",nt.style.left="0",nt.style.borderWidth="2px",nt.style.borderColor="#ff00ff",setTimeout(()=>nt.remove(),5e3)),nt}static async GetDataUrl(o,{mimeType:c="image/png",...d}){const _=isSafari()||d.cloneCanvas||d.rect||d.scale||d.displayPixelRatio;!_&&(d.rect||d.scale||d.displayPixelRatio)&&console.warn("rect, scale and displayPixelRatio are ignored when cloneCanvas is false");const b=_?await this.GetClonedCanvas(o,d):o,_e=b.toDataURL(c);return this.Debug||b===o||b.remove(),_e}static async GetImage(o,{mimeType:c="image/png",...d}={}){const _=await this.GetDataUrl(o,d);return new Promise((b,_e)=>{const it=new Image;it.onload=()=>{b(it)},it.src=_})}static async GetBlob(o,c={}){const d=isSafari()||c.cloneCanvas||c.rect||c.scale||c.displayPixelRatio;!d&&(c.rect||c.scale||c.displayPixelRatio)&&console.warn("rect, scale and displayPixelRatio are ignored when cloneCanvas is false");const _=d?await this.GetClonedCanvas(o,c):o,b=await new Promise((_e,it)=>{var nt;_.toBlob(at=>{at?_e(at):it("Unable to export")},(nt=c.mimeType)!==null&&nt!==void 0?nt:"image/png")});return this.Debug||_===o||_.remove(),b}static async GetFile(o,c="image",d={}){var _,b,_e;const it=c+"."+((b=(_=d.mimeType)===null||_===void 0?void 0:_.split("/")[1])!==null&&b!==void 0?b:"png");return d.getDataUrl?await this.GetDataUrl(o,d):new File([await this.GetBlob(o,d)],it,{type:(_e=d.mimeType)!==null&&_e!==void 0?_e:"image/png",lastModified:g()})}static async GetTiledFiles(o,c="image",d=2,_=2,b={}){var _e,it,nt;const at=(_e=b.rect)!==null&&_e!==void 0?_e:{x:0,y:0,width:1,height:1,assumeClientRect:!1,normalized:!0},ut=[];for(let pt=0;pt<_;pt++)for(let mt=0;mt<d;mt++){const ft=(nt=(it=b.mimeType)===null||it===void 0?void 0:it.split("/")[1])!==null&&nt!==void 0?nt:"png",vt=await this.GetFile(o,`${c}_${pt}_${mt}.${ft}`,{rect:{x:at.x+pt*at.width/_,y:at.y+mt*at.height/d,width:at.width/_,height:at.height/d,assumeClientRect:at.assumeClientRect,normalized:at.normalized}}).catch(xt=>(console.error(`Error exporting file ${pt}, ${mt}`,xt),null));vt&&ut.push(vt)}return ut}}CanvasSnipper.Debug=!1;var CanvasSnipperPlugin_decorate=function(h,o,c,d){var _,b=arguments.length,_e=b<3?o:d===null?d=Object.getOwnPropertyDescriptor(o,c):d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_e=Reflect.decorate(h,o,c,d);else for(var it=h.length-1;it>=0;it--)(_=h[it])&&(_e=(b<3?_(_e):b>3?_(o,c,_e):_(o,c))||_e);return b>3&&_e&&Object.defineProperty(o,c,_e),_e},CanvasSnipperPlugin_1;let CanvasSnipperPlugin=CanvasSnipperPlugin_1=class extends AViewerPlugin{constructor(){super(),this.enabled=!0,this.filename="snapshot",this.progressiveFrames=64,this.tileRows=1,this.tileColumns=1,this.rect=new three_module.IUQ(0,0,1,1),this._downloading=!1,this.downloadSnapshot=this.downloadSnapshot.bind(this)}async getFile(h,o={waitForProgressive:!0}){var c;return await((c=this.viewer)===null||c===void 0?void 0:c.doOnce("postFrame")),await this._getFile(h||this.filename,{...o,getDataUrl:!1})}async getDataUrl(h={}){var o,c;return await((o=this.viewer)===null||o===void 0?void 0:o.doOnce("postFrame")),(c=await this._getFile("",{...h,getDataUrl:!0}))!==null&&c!==void 0?c:""}async _getFile(h,o={}){var c,d,_,b,_e,it,nt,at,ut,pt,mt,ft;const vt=(c=this._viewer)===null||c===void 0?void 0:c.canvas;if(vt){(d=this.viewer)===null||d===void 0||d.scene.activeCamera.setInteractions(!1,CanvasSnipperPlugin_1.PluginType);const xt=this._viewer.renderer.displayCanvasScaling;o.displayPixelRatio!==void 0&&o.displayPixelRatio!==xt&&(this._viewer.renderer.displayCanvasScaling=o.displayPixelRatio);const At=(_=this._viewer)===null||_===void 0?void 0:_.getPlugin(ProgressivePlugin);let Ct=(b=o.waitForProgressive)!==null&&b!==void 0?b:!!At;Ct&&!At&&(console.warn("CanvasSnipperPlugin: ProgressivePlugin required to wait for progressive rendering"),Ct=!1),o.progressiveFrames&&!Ct&&console.warn("CanvasSnipperPlugin: waitForProgressive must be true to use progressiveFrames");const Et=At==null?void 0:At.maxFrameCount;if(Ct&&At)for(At.maxFrameCount=Math.max((_e=o.progressiveFrames)!==null&&_e!==void 0?_e:64,At.maxFrameCount),(it=this.viewer)===null||it===void 0||it.setDirty(),await((nt=this.viewer)===null||nt===void 0?void 0:nt.doOnce("postFrame"));!At.isConverged(!0);)await((at=this.viewer)===null||at===void 0?void 0:at.doOnce("postFrame"));let Tt;if(!o.timeout&&Ct||((ut=this.viewer)===null||ut===void 0||ut.setDirty(),await((pt=this.viewer)===null||pt===void 0?void 0:pt.doOnce("postFrame")),await X$2((mt=o.timeout)!==null&&mt!==void 0?mt:200)),o.displayPixelRatio=1,o.tileRows&&o.tileRows>1||o.tileColumns&&o.tileColumns>1){const kt=await CanvasSnipper.GetTiledFiles(vt,h,Math.max(1,o.tileRows||1),Math.max(1,o.tileColumns||1),o);if(Array.isArray(kt))if(kt.length===1)Tt=kt[0];else if(kt.length===0)Tt=void 0;else if(o.getDataUrl)Tt=kt;else{const Dt={};for(const Bt of kt)Dt[Bt.name]=new Uint8Array(await Bt.arrayBuffer());const zt=zipSync(Dt);Tt=new File([zt],h+".zip",{type:"application/zip",lastModified:Date.now()})}else Tt=kt}else Tt=await CanvasSnipper.GetFile(vt,h,o);return o.displayPixelRatio=this._viewer.renderer.displayCanvasScaling,this._viewer.renderer.displayCanvasScaling=xt,At&&Et!==void 0&&(At.maxFrameCount=Et),(ft=this.viewer)===null||ft===void 0||ft.scene.activeCamera.setInteractions(!0,CanvasSnipperPlugin_1.PluginType),Tt}}async downloadSnapshot(h,o){for(;this._downloading;)console.warn("CanvasSnipperPlugin: Another rendering already in progress, waiting..."),await X$2(200);this._downloading=!0;const c=await this.getFile(h,{progressiveFrames:this.progressiveFrames,waitForProgressive:!0,tileRows:this.tileRows,tileColumns:this.tileColumns,rect:{x:this.rect.x,y:this.rect.y,width:this.rect.z,height:this.rect.w,normalized:!0,assumeClientRect:!1},...o}).catch(d=>{var _;return(_=this._viewer)===null||_===void 0||_.console.error("Error exporting file",d),null});c&&await this._downloadBlob(c,c.name),this._downloading=!1}async _downloadJpeg(){return this.downloadSnapshot(void 0,{mimeType:"image/jpeg"})}async _downloadWebp(){return this.downloadSnapshot(void 0,{mimeType:"image/webp"})}async _downloadBlob(h,o){var c,d;const _=(c=this._viewer)===null||c===void 0?void 0:c.getPluginByType("FileTransferPlugin");_?await _.exportFile(h,o):(d=this._viewer)===null||d===void 0||d.console.error("FileTransferPlugin required to export/download file")}};CanvasSnipperPlugin.PluginType="CanvasSnipper",CanvasSnipperPlugin_decorate([uiInput("Filename"),serialize()],CanvasSnipperPlugin.prototype,"filename",void 0),CanvasSnipperPlugin_decorate([uiInput("Frame Count"),serialize()],CanvasSnipperPlugin.prototype,"progressiveFrames",void 0),CanvasSnipperPlugin_decorate([uiInput("Tile Rows"),serialize()],CanvasSnipperPlugin.prototype,"tileRows",void 0),CanvasSnipperPlugin_decorate([uiInput("Tile Columns"),serialize()],CanvasSnipperPlugin.prototype,"tileColumns",void 0),CanvasSnipperPlugin_decorate([uiVector("Crop Rect (x, y, w, h)",[0,1],.001),serialize()],CanvasSnipperPlugin.prototype,"rect",void 0),CanvasSnipperPlugin_decorate([uiButton("Download .png",{limitedUi:!0})],CanvasSnipperPlugin.prototype,"downloadSnapshot",null),CanvasSnipperPlugin_decorate([uiButton("Download .jpeg")],CanvasSnipperPlugin.prototype,"_downloadJpeg",null),CanvasSnipperPlugin_decorate([uiButton("Download .webp")],CanvasSnipperPlugin.prototype,"_downloadWebp",null),CanvasSnipperPlugin=CanvasSnipperPlugin_1=CanvasSnipperPlugin_decorate([uiFolder("Image Export")],CanvasSnipperPlugin);const HorizontalBlurShader={name:"HorizontalBlurShader",uniforms:{tDiffuse:{value:null},h:{value:1/512}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;
		uniform float h;

		varying vec2 vUv;

		void main() {

			vec4 sum = vec4( 0.0 );

			sum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * h, vUv.y ) ) * 0.051;
			sum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * h, vUv.y ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * h, vUv.y ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * h, vUv.y ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;
			sum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * h, vUv.y ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * h, vUv.y ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * h, vUv.y ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * h, vUv.y ) ) * 0.051;

			gl_FragColor = sum;

		}`},VerticalBlurShader={name:"VerticalBlurShader",uniforms:{tDiffuse:{value:null},v:{value:1/512}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;
		uniform float v;

		varying vec2 vUv;

		void main() {

			vec4 sum = vec4( 0.0 );

			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * v ) ) * 0.051;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * v ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * v ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * v ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * v ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * v ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * v ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * v ) ) * 0.051;

			gl_FragColor = sum;

		}`};var ContactShadowGroundPlugin_decorate=function(h,o,c,d){var _,b=arguments.length,_e=b<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_e=Reflect.decorate(h,o,c,d);else for(var it=h.length-1;it>=0;it--)(_=h[it])&&(_e=(b<3?_(_e):b>3?_(o,c,_e):_(o,c))||_e);return b>3&&_e&&Object.defineProperty(o,c,_e),_e};const horizontalBlurMaterial=new three_module.BKk(HorizontalBlurShader);horizontalBlurMaterial.depthTest=!1;const verticalBlurMaterial=new three_module.BKk(VerticalBlurShader);verticalBlurMaterial.depthTest=!1;class ContactShadowGroundPlugin extends BaseGroundPlugin{constructor(o={},c=!1){super(o),this.contactShadows=!0,this.blurAmount=1,this.shadowScale=1,this.shadowHeight=5,this.shadowCamera=new three_module.qUd(-1,1,1,-1,.001,this.shadowHeight),this._refreshShadowCameraFrustum=this._refreshShadowCameraFrustum.bind(this),this.refreshOptions=this.refreshOptions.bind(this),this._showDebug=c,c&&this.dependencies.push(DebugPlugin)}async onAdded(o){const c=o.renderer.createTarget({type:three_module.OUM,format:three_module.GWd,colorSpace:three_module.jf0,size:{width:512,height:512},generateMipmaps:!1,depthBuffer:!0,minFilter:three_module.k6q,magFilter:three_module.k6q});c.texture.name="groundContactDepthTexture";const d=new three_module.CSG({depthPacking:three_module.Rkk});d.onBeforeCompile=function(b){b.uniforms.opacity.value=1,b.fragmentShader=`
						${b.fragmentShader.replace("gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );","gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), 1.0 );")}
					`};const _=new GBufferRenderPass(c,d,new three_module.Q1f(0,0,0),0);this._depthPass=_,await super.onAdded(o)}_postFrame(){super._postFrame(),this._viewer}_preRender(){if(super._preRender(),!this._viewer||!this._depthPass)return;this._depthPass.scene=this._viewer.scene.modelObject,this._depthPass.camera=this.shadowCamera,this._depthPass.render(this._viewer.renderer.rendererObject,null);const o=this._viewer.renderer.getTempTarget({type:three_module.OUM,format:three_module.GWd,colorSpace:three_module.jf0,size:{width:1024,height:1024},generateMipmaps:!1,depthBuffer:!1,minFilter:three_module.k6q,magFilter:three_module.k6q});this._blurShadow(o),this._blurShadow(o,.4),this._viewer.renderer.releaseTempTarget(o)}_blurShadow(o,c=1){this._viewer&&this._depthPass&&(horizontalBlurMaterial.uniforms.h.value=c*this.blurAmount/256,verticalBlurMaterial.uniforms.v.value=c*this.blurAmount/256,this._viewer.renderer.blit(this._depthPass.target.texture,o,{material:horizontalBlurMaterial,clear:!0}),this._viewer.renderer.blit(o.texture,this._depthPass.target,{material:verticalBlurMaterial,clear:!0}))}async onDispose(o){return super.onDispose(o)}async onRemove(o){var c,d,_;const b=(c=this._depthPass)===null||c===void 0?void 0:c.target;return b&&((d=this._viewer)===null||d===void 0||d.renderer.disposeTarget(b)),(_=this._depthPass)===null||_===void 0||_.dispose(),this._depthPass=void 0,super.onRemove(o)}_refreshTransform(){super._refreshTransform(),this._mesh&&this._viewer&&(this.shadowCamera.position.copy(this._mesh.getWorldPosition(new three_module.Pq0)),this.shadowCamera.setRotationFromEuler(new three_module.O9p(Math.PI/2,0,0)),this.shadowCamera.updateMatrixWorld(),this._refreshShadowCameraFrustum(),this._mesh.scale.y=-this.size)}_refreshShadowCameraFrustum(){this.shadowCamera&&(this.shadowCamera.left=-this.size/(2*this.shadowScale),this.shadowCamera.right=this.size/(2*this.shadowScale),this.shadowCamera.top=this.size/(2*this.shadowScale),this.shadowCamera.bottom=-this.size/(2*this.shadowScale),this.shadowCamera.far=this.shadowHeight,this.shadowCamera.updateProjectionMatrix(),this._setDirty())}_setDirty(){var o;(o=this._viewer)===null||o===void 0||o.setDirty()}_removeMaterial(){this._material&&super._removeMaterial()}refreshOptions(){this._viewer&&super.refreshOptions()}_refreshMaterial(){var o;if(!this._viewer)return!1;const c=super._refreshMaterial();return this._material&&(this._material.alphaMap=((o=this._depthPass)===null||o===void 0?void 0:o.target.texture)||null,c&&(this._material.roughness=1,this._material.metalness=0,this._material.color.set(1118481),this._material.transparent=!0,this._material.materialObject.userData.ssreflDisabled=!0,this._material.materialObject.userData.ssreflNonPhysical=!1)),c}_extraUiConfig(){return[{label:"Contact Shadows",type:"checkbox",property:[this,"contactShadows"]},{label:"Shadow Scale",type:"slider",bounds:[0,2],property:[this,"shadowScale"]},{label:"Shadow Height",type:"slider",bounds:[0,20],property:[this,"shadowHeight"]},{label:"Blur Amount",type:"slider",bounds:[0,10],property:[this,"blurAmount"]},...super._extraUiConfig()]}}function objectBeforeRender(h,o){var c;o&&!((c=o.map)===null||c===void 0)&&c.isTexture&&(o.extraUniformsToUpload||(o.extraUniformsToUpload={}),o.extraUniformsToUpload.uvTransform||(o.extraUniformsToUpload.uvTransform={value:new three_module.dwI}),o.extraUniformsToUpload.uvTransform.value.setUvTransform(o.map.offset.x*o.map.repeat.x*h.userData.cloneRotI/(h.userData.rotationCount||1),o.map.offset.y*o.map.repeat.y*h.userData.cloneRotI/(h.userData.rotationCount||1),o.map.repeat.x,o.map.repeat.y,o.map.rotation,o.map.center.x,o.map.center.y))}function setRotI(h,o,c,d){h.traverse(_=>{_&&(_.userData.cloneRotI=o,_.userData.rotationCount=c,_.userData.rotationAxis=d,_.addEventListener("beforeRender",b=>objectBeforeRender(_,b.material)))})}function rotateDuplicatedMesh(h,o,c,d="x"){var _;if(h.userData.rotationCount>1&&!h.userData.rotationRoot)return h;const b=h.parent;if(!b)throw new Error("No parent");if(h.userData.cloneParent){const it=h.userData.cloneParent;if(h=b.children.find(nt=>it===nt.uuid),!h)return console.error("Couldn't find clone root, cannot rotate. maybe a serialization issue?",it,b),h}let _e=b.children.filter(it=>{var nt;return((nt=it.userData)===null||nt===void 0?void 0:nt.cloneParent)===h.uuid}).sort((it,nt)=>it.userData.cloneRotI-nt.userData.cloneRotI);if(h.userData.rotationCount===o&&o===_e.length&&c===void 0&&h.userData.rotationAxis===d)return h;if(c==null&&(c=(_=h.userData.rotationSkips)!==null&&_!==void 0?_:[]),c!==h.userData.rotationSkips&&(h.userData.rotationSkips=[...c]),setRotI(h,0,o,d),h.userData.rotationRoot=!0,h.visible=!0,o<=_e.length){for(let it=o-1;it<_e.length;it++)b.remove(_e[it]),_e[it].traverse(nt=>nt.userData={__disposed:!0});_e=_e.slice(0,o)}for(let it=1;it<o;it++){const nt=it<=_e.length?_e[it-1]:h.clone();nt.rotation.copy(h.rotation),nt.rotation[d]+=it/o*Math.PI*2,setRotI(nt,it,o,d),it>_e.length&&b.add(nt),nt.visible=!c.includes(it)}return h.visible=!c.includes(0),h}ContactShadowGroundPlugin.PluginType="ContactShadowGroundPlugin",ContactShadowGroundPlugin_decorate([x$1(ContactShadowGroundPlugin.prototype.refreshOptions),serialize()],ContactShadowGroundPlugin.prototype,"contactShadows",void 0),ContactShadowGroundPlugin_decorate([serialize(),x$1(ContactShadowGroundPlugin.prototype._setDirty)],ContactShadowGroundPlugin.prototype,"blurAmount",void 0),ContactShadowGroundPlugin_decorate([serialize(),x$1(ContactShadowGroundPlugin.prototype._refreshShadowCameraFrustum)],ContactShadowGroundPlugin.prototype,"shadowScale",void 0),ContactShadowGroundPlugin_decorate([serialize(),x$1(ContactShadowGroundPlugin.prototype._refreshShadowCameraFrustum)],ContactShadowGroundPlugin.prototype,"shadowHeight",void 0);var ObjectRotationPlugin_decorate=function(h,o,c,d){var _,b=arguments.length,_e=b<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_e=Reflect.decorate(h,o,c,d);else for(var it=h.length-1;it>=0;it--)(_=h[it])&&(_e=(b<3?_(_e):b>3?_(o,c,_e):_(o,c))||_e);return b>3&&_e&&Object.defineProperty(o,c,_e),_e};let ObjectRotationPlugin=class extends AViewerPlugin{async onAdded(h){var o;await super.onAdded(h),(o=h.getPluginByType("Picking"))===null||o===void 0||o.addEventListener("selectedObjectChanged",this._selectedObjectChanged)}constructor(h=!0){super(),this.rotations=1,this.axis="x",this.skips="",this._selectedObjectChanged=this._selectedObjectChanged.bind(this),this.enabled=h}_selectedObjectChanged(){var h,o,c,d,_,b,_e,it,nt;if(!this.enabled)return;const at=(o=(h=this._viewer)===null||h===void 0?void 0:h.getPluginByType("Picking"))===null||o===void 0?void 0:o.getSelectedObject();if(!at)return void((d=(c=this.uiConfig).uiRefresh)===null||d===void 0||d.call(c,"postFrame",!0));const ut=at.userData.rotationRoot&&(_=at.userData.rotationCount)!==null&&_!==void 0?_:1;this.rotations=ut,this.skips=(_e=(b=at.userData.rotationSkips)===null||b===void 0?void 0:b.join(","))!==null&&_e!==void 0?_e:"",this.axis=at.userData.rotationAxis||"x",(nt=(it=this.uiConfig).uiRefresh)===null||nt===void 0||nt.call(it,"postFrame",!0)}_paramsChanged(){var h,o,c,d,_,b;if(!this.enabled)return;const _e=(o=(h=this._viewer)===null||h===void 0?void 0:h.getPluginByType("Picking"))===null||o===void 0?void 0:o.getSelectedObject();if(_e){if(this.rotations>1||_e.userData.rotationCount){const it=_e.userData.rotationCount,nt=rotateDuplicatedMesh(_e,this.rotations,this.skips.split(",").map(ut=>parseInt(ut)).filter(ut=>isFinite(ut)),this.axis),at=nt==null?void 0:nt.userData.rotationCount;if(at&&at!==it){const ut=[];nt==null||nt.traverseAncestors(pt=>{ut.push(pt)});for(const pt of ut)if(pt.userData.autoScaled){autoScaleObject3D(pt),(c=this._viewer)===null||c===void 0||c.resetCamera({rootObject:pt,centerOffset:new three_module.Pq0(4,4,4)});break}}_e.parent&&!_e.userData.__disposed||(_=(d=this._viewer)===null||d===void 0?void 0:d.getPluginByType("Picking"))===null||_===void 0||_.setSelectedObject(nt,!0)}(b=this._viewer)===null||b===void 0||b.scene.setDirty({frameFade:!1,sceneUpdate:!0})}}};ObjectRotationPlugin.PluginType="ObjectRotationPlugin",ObjectRotationPlugin_decorate([serialize(),uiToggle("Enabled"),x$1(ObjectRotationPlugin.prototype._paramsChanged)],ObjectRotationPlugin.prototype,"enabled",void 0),ObjectRotationPlugin_decorate([uiSlider("Rotation Count",[1,100],1,h=>({hidden:()=>{var o,c;return!(!((c=(o=h._viewer)===null||o===void 0?void 0:o.getPluginByType("Picking"))===null||c===void 0)&&c.getSelectedObject())||!h.rotations}})),x$1(ObjectRotationPlugin.prototype._paramsChanged)],ObjectRotationPlugin.prototype,"rotations",void 0),ObjectRotationPlugin_decorate([uiDropdown("Axis",["x","y","z"].map(h=>({label:h})),h=>({hidden:()=>{var o,c;return!(!((c=(o=h._viewer)===null||o===void 0?void 0:o.getPluginByType("Picking"))===null||c===void 0)&&c.getSelectedObject())||!h.rotations}})),x$1(ObjectRotationPlugin.prototype._paramsChanged)],ObjectRotationPlugin.prototype,"axis",void 0),ObjectRotationPlugin_decorate([uiInput("Rotation Skips",h=>({hidden:()=>{var o,c;return!(!((c=(o=h._viewer)===null||o===void 0?void 0:o.getPluginByType("Picking"))===null||c===void 0)&&c.getSelectedObject())||!h.rotations}})),x$1(ObjectRotationPlugin.prototype._paramsChanged)],ObjectRotationPlugin.prototype,"skips",void 0),ObjectRotationPlugin=ObjectRotationPlugin_decorate([uiFolder("Object Rotations")],ObjectRotationPlugin);var reliefParallax=`#ifdef USE_BUMPMAP
mat3 mat3_inverse(mat3 A){mat3 M_t=mat3(vec3(A[0][0],A[1][0],A[2][0]),vec3(A[0][1],A[1][1],A[2][1]),vec3(A[0][2],A[1][2],A[2][2]));float det=dot(cross(M_t[0],M_t[1]),M_t[2]);mat3 adjugate=mat3(cross(M_t[1],M_t[2]),cross(M_t[2],M_t[0]),cross(M_t[0],M_t[1]));return adjugate/det;}float CalculateHeight(in vec2 texCoords){float height=texture2D(bumpMap,texCoords).x;return clamp(height,0.,1.);}const vec2 bumpMapSize=vec2(512,512);vec3 CalculateNormal(in vec2 texCoords){
#if defined( TANGENTSPACE_NORMALMAP ) && 0 
vec3 mapN=texture2D(normalMap,texCoords).xyz;mapN.xy*=normalScale;return normalize(mapN);
#else
vec2 texOffs=1./bumpMapSize;
#if PARALLAX_NORMAL_MAP_QUALITY > 0
float hx[9];hx[0]=texture2D(bumpMap,texCoords.st+texOffs*vec2(-1.,-1.)).r;hx[1]=texture2D(bumpMap,texCoords.st+texOffs*vec2(0.,-1.)).r;hx[2]=texture2D(bumpMap,texCoords.st+texOffs*vec2(1.,-1.)).r;hx[3]=texture2D(bumpMap,texCoords.st+texOffs*vec2(-1.,0.)).r;hx[4]=texture2D(bumpMap,texCoords.st).r;hx[5]=texture2D(bumpMap,texCoords.st+texOffs*vec2(1.,0.)).r;hx[6]=texture2D(bumpMap,texCoords.st+texOffs*vec2(-1.,1.)).r;hx[7]=texture2D(bumpMap,texCoords.st+texOffs*vec2(0.,1.)).r;hx[8]=texture2D(bumpMap,texCoords.st+texOffs*vec2(1.,1.)).r;vec2 deltaH=vec2(hx[0]-hx[2]+2.*(hx[3]-hx[5])+hx[6]-hx[8],hx[0]-hx[6]+2.*(hx[1]-hx[7])+hx[2]-hx[8]);
#else
float h_xa=texture2D(bumpMap,texCoords.st+texOffs*vec2(-1.,0.)).r;float h_xb=texture2D(bumpMap,texCoords.st+texOffs*vec2(1.,0.)).r;float h_ya=texture2D(bumpMap,texCoords.st+texOffs*vec2(0.,-1.)).r;float h_yb=texture2D(bumpMap,texCoords.st+texOffs*vec2(0.,1.)).r;vec2 deltaH=vec2(h_xa-h_xb,h_ya-h_yb);
#endif
return normalize(vec3(deltaH/texOffs,1.));
#endif
}vec3 ReliefParallax(in float frontFace,in vec3 texDir3D,in vec2 texCoord){float surf_sign=frontFace;float back_face=step(0.,-surf_sign);vec2 texStep=surf_sign*texDir3D.xy/abs(texDir3D.z);vec2 texC=texCoord.st+surf_sign*texStep+back_face*texStep.xy;float mapHeight=1.;float bumpHeightStep=1./float(PARALLAX_MAP_STEPS);float bestBumpHeight=mapHeight+bumpHeightStep;
#pragma unroll_loop_start
for(int i=0;i<PARALLAX_MAP_STEPS;i++){if(mapHeight<bestBumpHeight){bestBumpHeight-=bumpHeightStep;mapHeight=back_face+surf_sign*CalculateHeight(texC.xy-bestBumpHeight*texStep.xy);}}
#pragma unroll_loop_end
bestBumpHeight+=bumpHeightStep;
#pragma unroll_loop_start
for(int i=0;i<PARALLAX_MAP_B_STEPS;i++){bumpHeightStep*=0.5;bestBumpHeight-=bumpHeightStep;mapHeight=back_face+surf_sign*CalculateHeight(texC.xy-bestBumpHeight*texStep.xy);bestBumpHeight+=(bestBumpHeight<mapHeight)?bumpHeightStep:0.;}
#pragma unroll_loop_end
bestBumpHeight-=bumpHeightStep*clamp((bestBumpHeight-mapHeight)/bumpHeightStep,0.,1.);mapHeight=bestBumpHeight;texC-=mapHeight*texStep;return vec3(texC.xy,mapHeight);}vec3 reliefParallaxPerturbNormal(in float faceDirection,inout vec3 normal){if(abs(bumpScale)<0.001)return vec3(vBumpMapUv,0.);float parallaxHeight;vec2 texCoords=vBumpMapUv;float face_sign=sign(dot(normal,vViewPosition));vec3 N=normalize(normal);vec3 dp1=dFdx(-vViewPosition);vec3 dp2=dFdy(-vViewPosition);vec2 duv1=dFdx(vBumpMapUv);vec2 duv2=dFdy(vBumpMapUv);vec3 dp2perp=cross(dp2,N);vec3 dp1perp=cross(N,dp1);vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;float invmax=inversesqrt(max(dot(T,T),dot(B,B)));mat3 tbnMat=mat3(T*invmax,B*invmax,N*bumpScale);vec3 tangentPos=normalize(mat3_inverse(tbnMat)*-vViewPosition);vec3 parallaxUv=ReliefParallax(face_sign,tangentPos,vBumpMapUv);tbnMat[2]=face_sign*N/bumpScale;normal=normalize(tbnMat*CalculateNormal(parallaxUv.xy).xyz);
#ifdef FLIP_SIDED
normal=-normal;
#endif
return parallaxUv;}
#endif 
`,ParallaxMappingPlugin_decorate=function(h,o,c,d){var _,b=arguments.length,_e=b<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_e=Reflect.decorate(h,o,c,d);else for(var it=h.length-1;it>=0;it--)(_=h[it])&&(_e=(b<3?_(_e):b>3?_(o,c,_e):_(o,c))||_e);return b>3&&_e&&Object.defineProperty(o,c,_e),_e};let ParallaxMappingPlugin=class extends AViewerPlugin{constructor(h=!0){super(),this.enabled=!0,this.debugNormals=!1,this.debugHitHeight=!1,this._defines={PARALLAX_NORMAL_MAP_QUALITY:0},this.stepCount=12,this.binaryStepCount=3,this._bumpMapExtension={shaderExtender:(o,c,d)=>{if(c.materialObject.bumpMap&&this.enabled){o.fragmentShader=o.fragmentShader.replace("#include <normal_fragment_begin>",""),o.fragmentShader=o.fragmentShader.replace("#include <normal_fragment_maps>",""),o.fragmentShader=o.fragmentShader.replace("#include <map_fragment>",`#include <normal_fragment_begin>
#include <normal_fragment_maps>
#include <map_fragment>`);for(const _ of["map_fragment","alphamap_fragment","roughnessmap_fragment","metalnessmap_fragment","emissivemap_fragment","transmission_fragment"])o.fragmentShader=shaderReplaceString(o.fragmentShader,`#include <${_}>`,three_module.vxI[_].replace(/\bv\w+Uv\b/g,"parallaxUv.xy",{replaceAll:!0}));(this.debugNormals||this.debugHitHeight)&&(o.fragmentShader=shaderReplaceString(o.fragmentShader,"texture2D( map, parallaxUv.xy )",this.debugNormals?"vec4(normal, 1.); normal = nonPerturbedNormal":"vec4(parallaxUv.z,0., 0., 1.)")),o.fragmentShader=shaderReplaceString(o.fragmentShader,"#include <normal_fragment_maps>",shaderReplaceString(shaderReplaceString(three_module.vxI.normal_fragment_maps,"#elif defined( USE_NORMALMAP_TANGENTSPACE )","#elif defined( USE_NORMALMAP_TANGENTSPACE ) && !defined( USE_BUMPMAP )"),"normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );","vec3 parallaxUv = reliefParallaxPerturbNormal(faceDirection, normal);"))}},parsFragmentSnippet:()=>this.enabled?(reliefParallax+`
`).replaceAll("PARALLAX_MAP_STEPS",this._defines.PARALLAX_MAP_STEPS).replaceAll("PARALLAX_MAP_B_STEPS",this._defines.PARALLAX_MAP_B_STEPS):"",isCompatible:o=>o.isMeshStandardMaterial2,computeCacheKey:o=>{var c;return this.enabled+" "+((c=o.materialObject.bumpMap)===null||c===void 0?void 0:c.uuid)+" "+this.debugNormals+" "+this.debugHitHeight+"  "},onObjectRender:(o,{materialObject:c},d)=>{if(this.enabled)for(const[_,b]of Object.entries(this._defines)){const _e=typeof b=="number"?b:b?1:0;c.defines[_]!==_e&&(c.defines[_]=_e,c.needsUpdate=!0)}}},this.dependencies=[AssetManagerPlugin],this.enabled=h,this._updateExtension=this._updateExtension.bind(this)}_updateExtension(){var h,o,c;(o=(h=this._bumpMapExtension)===null||h===void 0?void 0:h.setDirty)===null||o===void 0||o.call(h),(c=this._viewer)===null||c===void 0||c.setDirty()}async onAdded(h){var o,c;return(c=(o=h.getPlugin(AssetManagerPlugin))===null||o===void 0?void 0:o.materials)===null||c===void 0||c.registerMaterialExtension(this._bumpMapExtension),super.onAdded(h)}async onRemove(h){var o,c;return(c=(o=h.getPlugin(AssetManagerPlugin))===null||o===void 0?void 0:o.materials)===null||c===void 0||c.unregisterMaterialExtension(this._bumpMapExtension),super.onRemove(h)}};ParallaxMappingPlugin.PluginType="ReliefParallaxMapping",ParallaxMappingPlugin_decorate([x$1(ParallaxMappingPlugin.prototype._updateExtension),serialize(),uiToggle("Enabled")],ParallaxMappingPlugin.prototype,"enabled",void 0),ParallaxMappingPlugin_decorate([x$1(ParallaxMappingPlugin.prototype._updateExtension),uiToggle("Debug Normals")],ParallaxMappingPlugin.prototype,"debugNormals",void 0),ParallaxMappingPlugin_decorate([x$1(ParallaxMappingPlugin.prototype._updateExtension),uiToggle("Debug Hit Height")],ParallaxMappingPlugin.prototype,"debugHitHeight",void 0),ParallaxMappingPlugin_decorate([matDefine("PARALLAX_MAP_STEPS",void 0,!0,ParallaxMappingPlugin.prototype._updateExtension),uiSlider("Step count",[1,32],1),serialize()],ParallaxMappingPlugin.prototype,"stepCount",void 0),ParallaxMappingPlugin_decorate([matDefine("PARALLAX_MAP_B_STEPS",void 0,!0,ParallaxMappingPlugin.prototype._updateExtension),uiSlider("Binary search steps",[1,8],1),serialize()],ParallaxMappingPlugin.prototype,"binaryStepCount",void 0),ParallaxMappingPlugin=ParallaxMappingPlugin_decorate([uiFolder("Parallax Mapping")],ParallaxMappingPlugin);class TubeShapeGeometry extends three_module.LoY{constructor(o,c,d=32,_=64,b=!1,_e=new three_module.I9Y(1,1),it="shape"){super(),this.type="TubeShapeGeometry",this.parameters={path:c,shape:o,shapeSegments:d,tubularSegments:_,closed:b,primary:it,shapeScale:_e.clone()};const nt=c.computeFrenetFrames(_,b);this.frames=nt;const at=new three_module.Pq0,ut=new three_module.Pq0,pt=new three_module.Pq0,mt=new three_module.I9Y;let ft=new three_module.Pq0;const vt=[],xt=[],At=[],Ct=o.getSpacedPoints(d);for(const kt of Ct)kt.multiply(_e);(function(){for(let kt=0;kt<_;kt++)Tt(kt);Tt(b===!1?_:0),function(){for(let kt=0;kt<=_;kt++)for(let Dt=0;Dt<=d;Dt++)mt.x=kt/_,mt.y=Dt/d,xt.push(mt.x,mt.y)}(),function(){const kt=it==="shape",Dt=kt?d:_,zt=kt?_:d;for(let Bt=1;Bt<=Dt;Bt++)for(let Rt=1;Rt<=zt;Rt++){const[Ut,Ht]=kt?[Rt,Bt]:[Bt,Rt],Jt=(d+1)*(Ut-1)+(Ht-1),Kt=(d+1)*Ut+(Ht-1),sr=(d+1)*Ut+Ht,ir=(d+1)*(Ut-1)+Ht;At.push(Jt,Kt,ir),At.push(Kt,sr,ir)}}()})(),this.setIndex(At),this.setAttribute("position",new three_module.qtW(vt,3)),this.setAttribute("uv",new three_module.qtW(xt,2)),this.computeVertexNormals();const Et=this.attributes.normal;function Tt(kt){ft=c.getPointAt(kt/_,ft);const Dt=nt.normals[kt],zt=nt.binormals[kt];for(let Bt=0;Bt<=d;Bt++){const Rt=Ct[Bt%d];ut.set(0,0,0).addScaledVector(Dt,Rt.x).addScaledVector(zt,Rt.y),at.copy(ft).add(ut),vt.push(at.x,at.y,at.z)}}(function(){for(let Dt=1;Dt<d;Dt++){const zt=Dt+_*(d+1);ut.fromBufferAttribute(Et,Dt),pt.fromBufferAttribute(Et,zt),ut.add(pt).normalize(),Et.setXYZ(Dt,ut.x,ut.y,ut.z),Et.setXYZ(zt,ut.x,ut.y,ut.z)}for(let Dt=1;Dt<_;Dt++){const zt=Dt*(d+1),Bt=zt+d;ut.fromBufferAttribute(Et,zt),pt.fromBufferAttribute(Et,Bt),ut.add(pt).normalize(),Et.setXYZ(zt,ut.x,ut.y,ut.z),Et.setXYZ(Bt,ut.x,ut.y,ut.z)}ut.fromBufferAttribute(Et,0),pt.fromBufferAttribute(Et,d),ut.add(pt);const kt=_*(d+1);pt.fromBufferAttribute(Et,kt),ut.add(pt),pt.fromBufferAttribute(Et,kt+d),ut.add(pt),ut.normalize(),Et.setXYZ(0,ut.x,ut.y,ut.z),Et.setXYZ(d,ut.x,ut.y,ut.z),Et.setXYZ(kt,ut.x,ut.y,ut.z),Et.setXYZ(kt+d,ut.x,ut.y,ut.z),Et.needsUpdate=!0})()}createSplits(o){this.clearGroups();const c=this.parameters.primary==="shape"?this.parameters.shapeSegments:this.parameters.tubularSegments,d=this.index.count,_=[...o,1].sort((it,nt)=>it-nt);let b=0,_e=0;for(const it of _){const nt=Math.round(c*it)*d/c;this.addGroup(b,nt-b,_e++),b=nt}return this.groups.length}toJSON(){const o=super.toJSON();return o.path=this.parameters.path.toJSON(),o.shape=this.parameters.shape.toJSON(),o}}var ShapeTubeExtrudePlugin_decorate=function(h,o,c,d){var _,b=arguments.length,_e=b<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_e=Reflect.decorate(h,o,c,d);else for(var it=h.length-1;it>=0;it--)(_=h[it])&&(_e=(b<3?_(_e):b>3?_(o,c,_e):_(o,c))||_e);return b>3&&_e&&Object.defineProperty(o,c,_e),_e},ShapeTubeExtrudePlugin_1;let ShapeTubeExtrudePlugin=ShapeTubeExtrudePlugin_1=class extends AViewerPlugin{constructor(){super(...arguments),this.enabled=!0,this.shapeSegments=32,this.tubularSegments=32,this.shapeScale=new three_module.I9Y(1,1),this.materialSplits="0.3, 0.6",this.horizontalSplits=!0,this.extrudeCirceTube=async()=>{var h,o;const c=(o=(h=this._viewer)===null||h===void 0?void 0:h.getPlugin(PickingPlugin))===null||o===void 0?void 0:o.getSelectedObject();if(!c)return;let d=this._viewer.prompt("Radius: Radius for the circle","1",!0);if(!d)return;d=parseFloat(d);const _=new EllipseCurve3D(0,0,d,d,0,2*Math.PI,!0,0);await this.extrudeObject(c,_)}}async onAdded(h){await super.onAdded(h)}static CreateCurve(h,o){var c,d;if(h==="circle")return new EllipseCurve3D(0,0,(c=o.radius)!==null&&c!==void 0?c:1,(d=o.radius)!==null&&d!==void 0?d:1,0,2*Math.PI,!0,0);throw new Error("Unknown curve type")}async extrudeObject(h,o,c=this.shapeSegments,d=this.tubularSegments,_=this.shapeScale,b=this.materialSplits.split(",").map(it=>parseFloat(it.trim())),_e=this.horizontalSplits){var it,nt,at,ut,pt,mt,ft,vt;if(h.userData.isExtrudedTube,h.userData._extrudeSource){const kt=h.userData._extrudeSource;if(h=(it=h.parent)===null||it===void 0?void 0:it.children.find(Dt=>kt===Dt.uuid),!h)return void console.warn("Could not find extrude source with uuid",kt)}if(h.userData.extrudedObject){const kt=h.userData.extrudedObject,Dt=(nt=h.parent)===null||nt===void 0?void 0:nt.children.find(zt=>kt===zt.uuid);Dt&&(Dt.removeFromParent(),Dt.geometry.dispose(),Dt.geometry=null,Dt.material=null),delete h.userData.extrudedObject}const xt=h.geometry;if(!xt)return void((at=this._viewer)===null||at===void 0||at.alert("Extrude: No geometry to extrude"));const At=[h.material];let Ct;try{const kt=ShapeTubeExtrudePlugin_1.ConvertGeometryToFlatShape(xt);Ct=new TubeShapeGeometry(kt,o,c,d,!0,_,_e?"shape":"path"),Ct.computeBoundingBox(),Ct.createSplits(b)}catch(kt){return void((ut=this._viewer)===null||ut===void 0||ut.alert(typeof kt=="string"?kt:kt==null?void 0:kt.message))}At[0].color.set(16777215);for(let kt=At.length;kt<Ct.groups.length;kt++){const Dt=At[0].clone();At.push(Dt),Dt.color.set(16777215*Math.random())}const Et=new three_module.eaF(Ct,At);Et.userData._extrudeSource=h.uuid,Et.userData.isExtrudedTube=!0,h.visible=!1,h.userData.bboxVisible=!1,Et.name=h.name+"_extruded";const Tt=await((ft=(mt=(pt=this._viewer)===null||pt===void 0?void 0:pt.getManager())===null||mt===void 0?void 0:mt.importer)===null||ft===void 0?void 0:ft.processImportedSingle(Et,{autoCenter:!1,autoScale:!1}));Tt&&((vt=h.parent)===null||vt===void 0||vt.add(Tt.modelObject),h.userData.extrudedObject=Tt.modelObject.uuid,Tt.dispatchEvent({type:"select",ui:!0,value:Tt}))}static ExtrudeShape(h,o,c,d,_,b,_e,it){const nt=new TubeShapeGeometry(h,d,o,c,!0,new three_module.I9Y(_,b),it?"shape":"path");nt.computeBoundingBox(),nt.createSplits(_e);const at=new three_module.eaF(nt,[]);return at.userData.isExtrudedTube=!0,at}static ConvertGeometryToFlatShape(h,o=!0){if(h.userData.__planarShape)return h.userData.__planarShape;let c=h.attributes.position;if(!c)throw"no position attribute";if(c.count>500)throw"too large to extrude";const d=h;c=d.attributes.position,d.boundingBox||d.computeBoundingBox();const _=d.boundingBox.getSize(new three_module.Pq0),b=_.x<.001?"x":_.y<.001?"y":_.z<.001?"z":null;if(!b)throw"geometry is not axis aligned not planar";let _e=[];for(let nt=0;nt<c.count;nt++){const at=new three_module.I9Y;b==="x"?at.set(c.getY(nt),c.getZ(nt)):b==="y"?at.set(c.getX(nt),c.getZ(nt)):at.set(c.getX(nt),c.getY(nt)),_e.push(at)}if(o){let nt=0;for(let at=0;at<_e.length;at++)(_e[at].x<_e[nt].x||_e[at].x===_e[nt].x&&_e[at].y<_e[nt].y)&&(nt=at);nt!==0&&(_e=_e.slice(nt).concat(_e.slice(0,nt)))}const it=new three_module.ypk(_e);return h.userData.__planarShape=it,it}};ShapeTubeExtrudePlugin.PluginType="ShapeTubeExtrudePlugin",ShapeTubeExtrudePlugin_decorate([uiToggle("Enabled")],ShapeTubeExtrudePlugin.prototype,"enabled",void 0),ShapeTubeExtrudePlugin_decorate([uiSlider("Shape Segments (X)",[1,100],1,h=>({hidden:()=>{var o,c;return!(!((c=(o=h._viewer)===null||o===void 0?void 0:o.getPlugin(PickingPlugin))===null||c===void 0)&&c.getSelectedObject())}}))],ShapeTubeExtrudePlugin.prototype,"shapeSegments",void 0),ShapeTubeExtrudePlugin_decorate([uiSlider("Tube Segments (Y)",[1,100],1,h=>({hidden:()=>{var o,c;return!(!((c=(o=h._viewer)===null||o===void 0?void 0:o.getPlugin(PickingPlugin))===null||c===void 0)&&c.getSelectedObject())}}))],ShapeTubeExtrudePlugin.prototype,"tubularSegments",void 0),ShapeTubeExtrudePlugin_decorate([uiVector("Shape scale",[.01,10],.01,h=>({hidden:()=>{var o,c;return!(!((c=(o=h._viewer)===null||o===void 0?void 0:o.getPlugin(PickingPlugin))===null||c===void 0)&&c.getSelectedObject())}}))],ShapeTubeExtrudePlugin.prototype,"shapeScale",void 0),ShapeTubeExtrudePlugin_decorate([uiInput("Material Splits",h=>({hidden:()=>{var o,c;return!(!((c=(o=h._viewer)===null||o===void 0?void 0:o.getPlugin(PickingPlugin))===null||c===void 0)&&c.getSelectedObject())}}))],ShapeTubeExtrudePlugin.prototype,"materialSplits",void 0),ShapeTubeExtrudePlugin_decorate([uiToggle("Horizontal Splits",h=>({hidden:()=>{var o,c;return!(!((c=(o=h._viewer)===null||o===void 0?void 0:o.getPlugin(PickingPlugin))===null||c===void 0)&&c.getSelectedObject())}}))],ShapeTubeExtrudePlugin.prototype,"horizontalSplits",void 0),ShapeTubeExtrudePlugin_decorate([uiButton("Extrude Circle Tube",h=>({hidden:()=>{var o,c;return!(!((c=(o=h._viewer)===null||o===void 0?void 0:o.getPlugin(PickingPlugin))===null||c===void 0)&&c.getSelectedObject())}}))],ShapeTubeExtrudePlugin.prototype,"extrudeCirceTube",void 0),ShapeTubeExtrudePlugin=ShapeTubeExtrudePlugin_1=ShapeTubeExtrudePlugin_decorate([uiFolder("Extrude Tube Shapes")],ShapeTubeExtrudePlugin);class EllipseCurve3D extends three_module.S20{getPoint(o,c){return super.getPoint(o,c||new three_module.Pq0)}}class PopmotionPlugin extends AViewerPlugin{constructor(o=!0){super(),this.enabled=!0,this.toJSON=void 0,this.fromJSON=void 0,this._lastFrameTime=0,this._updaters=[],this.dependencies=[],this._fadeDisabled=!1,this.disableFrameFade=!0,this._postFrame=()=>{var c,d;if(!this._viewer)return;if(!this.enabled||Object.keys(this.animations).length<1)return this._lastFrameTime=0,void(this._fadeDisabled&&((c=this._viewer.getPluginByType("FrameFade"))===null||c===void 0||c.enable(PopmotionPlugin.PluginType),this._fadeDisabled=!1));const _=g()/1e3;this._lastFrameTime<1&&(this._lastFrameTime=_-1/60);let b=_-this._lastFrameTime;this._lastFrameTime=_;const _e=(d=this._viewer.getPluginByType("Progressive"))===null||d===void 0?void 0:d.postFrameConvergedRecordingDelta();if(_e&&_e>0&&(b=_e),_e!==0&&(b*=1e3,!(b<=.001)&&(this._updaters.forEach(it=>{let nt=b;it.time+nt<0&&(nt=-it.time),it.time+=nt,Math.abs(nt)>.001&&it.u(nt)}),!this._fadeDisabled&&this.disableFrameFade))){const it=this._viewer.getPluginByType("FrameFade");it&&(it.disable(PopmotionPlugin.PluginType),this._fadeDisabled=!0)}},this.defaultDriver=c=>({start:()=>this._updaters.push({u:c,time:0}),stop:()=>this._updaters.splice(this._updaters.findIndex(d=>d.u===c),1)}),this.animations={},this.enabled=o,this._postFrame=this._postFrame.bind(this)}async onAdded(o){await super.onAdded(o),o.addEventListener("postFrame",this._postFrame)}async onRemove(o){return o.removeEventListener("postFrame",this._postFrame),super.onRemove(o)}animate(o){const c=esm_browser_v4(),d={id:c,options:o,stop:()=>{var _,b,_e;!((_=this.animations[c])===null||_===void 0)&&_._stop?(_e=(b=this.animations[c])===null||b===void 0?void 0:b._stop)===null||_e===void 0||_e.call(b):console.warn("Animation not started")}};return this.animations[c]=d,d.promise=new Promise((_,b)=>{const _e={driver:this.defaultDriver,...o,onComplete:async()=>{var nt;try{await((nt=o.onComplete)===null||nt===void 0?void 0:nt.call(o))}catch(at){return void b(at)}_()},onStop:async()=>{var nt;try{await((nt=o.onStop)===null||nt===void 0?void 0:nt.call(o))}catch(at){return void b(at)}_()}},it=animate(_e);this.animations[c]._stop=it.stop,this.animations[c].options=_e}).then(()=>(delete this.animations[c],c)),this.animations[c]}async animateAsync(o){return this.animate(o).promise}}PopmotionPlugin.PluginType="PopmotionPlugin";var SimpleTextPlugin_decorate=function(h,o,c,d){var _,b=arguments.length,_e=b<3?o:d===null?d=Object.getOwnPropertyDescriptor(o,c):d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_e=Reflect.decorate(h,o,c,d);else for(var it=h.length-1;it>=0;it--)(_=h[it])&&(_e=(b<3?_(_e):b>3?_(o,c,_e):_(o,c))||_e);return b>3&&_e&&Object.defineProperty(o,c,_e),_e},TextSVGOptions_1,SimpleTextPlugin_1;const onOpsChange=h=>({onChange:o=>{o.last&&h.onChange()}});let TextSVGOptions=TextSVGOptions_1=class{constructor(){this.text="Custom Text",this.fontSize=100,this.width=1024,this.height=1024,this.xOffset=0,this.yOffset=0,this.boxWidth=1024,this.boxHeight=1024,this.textAnchor="middle",this.fontFamily="",this.fontPath="",this.maskText=!1,this.innerShadow=!1,this.textColor="#000000",this.bgFillColor="#ffffff",this.svgBackground="#ffffff",this.onChange=()=>{}}set(h){Object.assign(this,h)}reset(){const h=this.onChange;Object.assign(this,new TextSVGOptions_1),this.onChange=h}toJSON(){return{text:this.text,fontFamily:this.fontFamily,fontPath:this.fontPath,svgBackground:this.svgBackground,width:this.width,height:this.height,xOffset:this.xOffset,yOffset:this.yOffset,boxWidth:this.boxWidth,boxHeight:this.boxHeight,fontSize:this.fontSize,maskText:this.maskText,innerShadow:this.innerShadow,bgFillColor:this.bgFillColor,textColor:this.textColor,textAnchor:this.textAnchor}}};SimpleTextPlugin_decorate([uiInput("Text",onOpsChange)],TextSVGOptions.prototype,"text",void 0),SimpleTextPlugin_decorate([uiSlider("Font Size",[2,400],1,onOpsChange)],TextSVGOptions.prototype,"fontSize",void 0),SimpleTextPlugin_decorate([uiSlider("Width",[2,4096],1,onOpsChange)],TextSVGOptions.prototype,"width",void 0),SimpleTextPlugin_decorate([uiSlider("Height",[2,4096],1,onOpsChange)],TextSVGOptions.prototype,"height",void 0),SimpleTextPlugin_decorate([uiSlider("X Offset",[-1024,1024],1,onOpsChange)],TextSVGOptions.prototype,"xOffset",void 0),SimpleTextPlugin_decorate([uiSlider("Y Offset",[-1024,1024],1,onOpsChange)],TextSVGOptions.prototype,"yOffset",void 0),SimpleTextPlugin_decorate([uiSlider("V-Width",[2,4096],1,onOpsChange)],TextSVGOptions.prototype,"boxWidth",void 0),SimpleTextPlugin_decorate([uiSlider("V-Height",[2,4096],1,onOpsChange)],TextSVGOptions.prototype,"boxHeight",void 0),SimpleTextPlugin_decorate([uiDropdown("Text Anchor",["start","middle","end"].map(h=>({label:h})),onOpsChange)],TextSVGOptions.prototype,"textAnchor",void 0),SimpleTextPlugin_decorate([uiInput("Font",onOpsChange)],TextSVGOptions.prototype,"fontFamily",void 0),SimpleTextPlugin_decorate([uiInput("Font Url",onOpsChange)],TextSVGOptions.prototype,"fontPath",void 0),SimpleTextPlugin_decorate([uiToggle("Mask Text",onOpsChange)],TextSVGOptions.prototype,"maskText",void 0),SimpleTextPlugin_decorate([uiToggle("Inner Shadow",onOpsChange)],TextSVGOptions.prototype,"innerShadow",void 0),SimpleTextPlugin_decorate([uiColor("Text Color",onOpsChange)],TextSVGOptions.prototype,"textColor",void 0),SimpleTextPlugin_decorate([uiColor("BG Fill",onOpsChange)],TextSVGOptions.prototype,"bgFillColor",void 0),SimpleTextPlugin_decorate([uiColor("SVG BG",onOpsChange)],TextSVGOptions.prototype,"svgBackground",void 0),TextSVGOptions=TextSVGOptions_1=SimpleTextPlugin_decorate([uiFolder("Text SVG Options")],TextSVGOptions);const fontFormatExtensionMap={woff:"woff",woff2:"woff2",ttf:"truetype",otf:"opentype",eot:"embedded-opentype"},inputHiddenParams=h=>({hidden:()=>{const o=h.getSelected();return!o||!o.userData[SimpleTextPlugin.PluginType]}});let SimpleTextPlugin=SimpleTextPlugin_1=class extends AViewerPlugin{async onAdded(h){var o;await super.onAdded(h),(o=h.getPluginByType("Picking"))===null||o===void 0||o.addEventListener("selectedObjectChanged",this._selectedObjectChanged)}constructor(){super(),this.enabled=!0,this.getSelected=()=>{var h,o;return(o=(h=this._viewer)===null||h===void 0?void 0:h.getPluginByType("Picking"))===null||o===void 0?void 0:o.getSelectedObject()},this.options=new TextSVGOptions,this.applyToMap=!0,this.applyToBumpMap=!1,this.applyToAlphaMap=!0,this.inverseAlphaMap=!1,this._lastMeta=void 0,this.fonts={roboto:"https://fonts.gstatic.com/s/roboto/v30/KFOmCnqEu92Fr1Mu4mxKKTU1Kg.woff2"},this._assetLoadOptions=void 0,this._selectedObjectChanged=this._selectedObjectChanged.bind(this),this.addTextToSelected=this.addTextToSelected.bind(this),this._paramsChanged=this._paramsChanged.bind(this),this.options.onChange=this._paramsChanged}_selectedObjectChanged(){var h,o,c,d,_,b;if(!this.enabled)return;const _e=this.getSelected();if(!_e)return void((o=(h=this.uiConfig).uiRefresh)===null||o===void 0||o.call(h,"postFrame",!0));const it=_e.userData[SimpleTextPlugin_1.PluginType];if(!it)return this.options.reset(),this._lastMeta=void 0,void((d=(c=this.uiConfig).uiRefresh)===null||d===void 0||d.call(c,"postFrame",!0));this._lastMeta!==it&&(this.options.set(it),this._lastMeta=it),(b=(_=this.uiConfig).uiRefresh)===null||b===void 0||b.call(_,"postFrame",!0)}_paramsChanged(){if(!this.enabled)return;const h=this.getSelected();h&&h.isMesh&&h.userData[SimpleTextPlugin_1.PluginType]&&this.updateText(h,this.options.toJSON())}async addTextToSelected(){var h;const o=this.getSelected();o&&o.isMesh?o.material?(o.userData[SimpleTextPlugin_1.PluginType]||!o.material.map||await((h=this._viewer)===null||h===void 0?void 0:h.confirm("Add Text: This mesh already has a texture. Adding text will replace the texture. Continue?")))&&await this.addText(o):console.error("no material on mesh"):console.error("no mesh is selected")}async addText(h,o){return this.updateText(h,Object.assign(this.options.toJSON(),o))}async updateText(h,o){var c,d;if(!h.isMesh)return;if(!h.material)return void console.error("updateText: no material on mesh");let _=h.userData[SimpleTextPlugin_1.PluginType];_||(h.userData[SimpleTextPlugin_1.PluginType]=_={}),Object.assign(_,o);const b=h.material;b.map&&(b.map._isSimpleTextTexture&&b.map.dispose(),b.map=void 0),b.alphaMap&&(b.alphaMap._isSimpleTextTexture&&b.alphaMap.dispose(),b.alphaMap=void 0),b.bumpMap&&(b.bumpMap._isSimpleTextTexture&&b.bumpMap.dispose(),b.bumpMap=void 0);const _e=await this.makeTextSvg(_);this.applyToMap&&(b.map=_e),this.applyToAlphaMap&&(b.alphaMap=_e,b.transparent=!0),this.applyToBumpMap&&(b.bumpMap=_e),b.userData.inverseAlphaMap=this.inverseAlphaMap,b.setDirty(),b.needsUpdate=!0,(d=(c=this.uiConfig).uiRefresh)===null||d===void 0||d.call(c,"postFrame",!0)}async makeTextSvg(h){const o=h.fontFamily||"Arial",c=h.fontPath||this.fonts[o]||"";let d=h.style;if(c.length>0){const _e=c.split("?")[0].split(".").pop()||"woff";d+=`
`+(c.length>0?`
            @font-face {
                font-family: ${o};
                src: url(${c}) format(${fontFormatExtensionMap[_e]||_e});
            }`:"")}let _=buildTextSvg({...h,fontFamily:o,style:d});_=await Ze$1(_,async _e=>this._getAssetData(_e)),_=B$2(_);const b=await this._viewer.getManager().importer.importSinglePath(_,{generateMipmaps:!1,minFilter:three_module.k6q});return b._isSimpleTextTexture=!0,b.flipY=!1,b.needsUpdate=!0,b}async _getAssetData(h){var o,c;if(h.startsWith("http://www.w3.org"))return h;const d=(c=(o=this._viewer)===null||o===void 0?void 0:o.getManager())===null||c===void 0?void 0:c.importer;if(!d)throw new Error("no importer");this._assetLoadOptions=this._assetLoadOptions||{fileHandler:new DataUrlLoader(d.loadingManager),processImported:!1};try{return await d.importPath(h,this._assetLoadOptions)}catch(_){return console.error(_),""}}};function buildTextSvg({text:h="Custom Text",svgBackground:o="#ffffff",xOffset:c=0,yOffset:d=0,width:_=1024,height:b=1024,boxWidth:_e=1024,boxHeight:it=1024,fontFamily:nt="",fontSize:at=32,maskText:ut=!0,innerShadow:pt=!0,bgFillColor:mt="#000000",textColor:ft="#ffffff",textAnchor:vt="middle",style:xt=""}){return`
<svg style="background-color:${o}" width="${_}" height="${b}" viewBox="0 0 ${_e} ${it}"
 xmlns="http://www.w3.org/2000/svg"
 xmlns:xlink="http://www.w3.org/1999/xlink">
     <defs>
        <style>
        ${xt}
        </style>
    </defs>

    <g style="overflow:hidden; text-anchor: ${vt}; font-size: ${at}px; font-family: ${nt||"Arial"}">
        <defs>

`+(ut?`
<mask id="textMask">
<text style="fill:white; font-size: ${at}px;" x="${c+_e/2}" y="${it/2+d+at/4}" > ${h} </text>
</mask>
`:"")+`

`+(pt?`
<filter id="innerShadow" x="-20%" y="-20%" width="140%" height="140%">
<feGaussianBlur in="SourceGraphic" stdDeviation="0.5" result="blur"/>
<feOffset in="blur" dx="1.5" dy="1.5"/>
</filter>
`:"")+`

        </defs>

`+(ut?`
        <g mask="url(#textMask)">
`:"")+`

        <rect x="0" y="0" width="${_e}" height="${it}" style="fill:${mt}"/>
        <text style="${pt?"filter: url(#innerShadow);":""} fill:${ft};" x="${c+_e/2}" y="${it/2+d+at/4}"> ${h} </text>

`+(ut?`
        </g>
`:"")+`

    </g>
</svg>
`}SimpleTextPlugin.PluginType="SimpleTextPlugin",SimpleTextPlugin_decorate([uiConfig(void 0,{params:inputHiddenParams})],SimpleTextPlugin.prototype,"options",void 0),SimpleTextPlugin_decorate([uiToggle("Apply Map",inputHiddenParams),x$1(SimpleTextPlugin.prototype._paramsChanged),serialize()],SimpleTextPlugin.prototype,"applyToMap",void 0),SimpleTextPlugin_decorate([uiToggle("Apply Bump Map",inputHiddenParams),x$1(SimpleTextPlugin.prototype._paramsChanged),serialize()],SimpleTextPlugin.prototype,"applyToBumpMap",void 0),SimpleTextPlugin_decorate([uiToggle("Apply Alpha Map",inputHiddenParams),x$1(SimpleTextPlugin.prototype._paramsChanged),serialize()],SimpleTextPlugin.prototype,"applyToAlphaMap",void 0),SimpleTextPlugin_decorate([uiToggle("Invert Alpha Map",inputHiddenParams),x$1(SimpleTextPlugin.prototype._paramsChanged),serialize()],SimpleTextPlugin.prototype,"inverseAlphaMap",void 0),SimpleTextPlugin_decorate([uiButton("Add Text",h=>({hidden:()=>!h.getSelected()}))],SimpleTextPlugin.prototype,"addTextToSelected",null),SimpleTextPlugin=SimpleTextPlugin_1=SimpleTextPlugin_decorate([uiFolder("Simple Text")],SimpleTextPlugin);var SceneLoopPlugin_decorate=function(h,o,c,d){var _,b=arguments.length,_e=b<3?o:d===null?d=Object.getOwnPropertyDescriptor(o,c):d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_e=Reflect.decorate(h,o,c,d);else for(var it=h.length-1;it>=0;it--)(_=h[it])&&(_e=(b<3?_(_e):b>3?_(o,c,_e):_(o,c))||_e);return b>3&&_e&&Object.defineProperty(o,c,_e),_e};let SceneLoopPlugin=class extends AViewerPlugin{constructor(){super(),this.enabled=!0,this.dependencies=[AssetManagerPlugin],this.scenes=[],this.assets={},this.toJSON=void 0,this._isPlaying=!1,this._isPlayingLoop=!1,this._options={},this.minSceneTime=2e3,this.loadScenes=this.loadScenes.bind(this),this.play=this.play.bind(this),this.stop=this.stop.bind(this),this.downloadScenes=this.downloadScenes.bind(this),this.promptLoadScenes=this.promptLoadScenes.bind(this)}get loadedScenes(){return this.scenes.length}async promptLoadScenes(){const h=await ge$1(!0,!1,"model/gltf");await this.loadScenes(h)}async loadScenes(h){var o,c;const d=await Promise.all(h.map(async _=>await _.arrayBuffer()));for(let _=0;_<h.length;_++){const b=h[_];this.scenes.push({[b.name]:new Uint8Array(d[_])}),this.assets[b.name]={path:b.name,file:b}}(c=(o=this.uiConfig)===null||o===void 0?void 0:o.uiRefresh)===null||c===void 0||c.call(o)}async play(){var h,o;if(!this._viewer||this._isPlaying||this._isPlayingLoop)return;this._isPlaying=!0,this._isPlayingLoop=!0;const c=(h=this._viewer.getPluginByType("AssetManagerBasicPopupPlugin"))!==null&&h!==void 0?h:this._viewer.getPluginByType("LoadingScreenPlugin");c==null||c.enabled,c&&(c.enabled=!1);const d=this._viewer.getPluginByType("FrameFade"),_=this._viewer.getPluginByType("GLTFAnimation"),b=this._viewer.getPluginByType("CameraViews");for(;this._isPlaying;)for(const _e of this.scenes){if(!this._isPlaying)break;const it=Object.keys(_e);_==null||_.stopAnimation(!1),await(b==null?void 0:b.stopAllAnimations()),this._viewer.scene.removeSceneModels(),this._viewer.renderEnabled=!1;for(const at of it){let ut=this.assets[at];ut||(ut={path:at,file:new File([_e[at]],at)},this.assets[at]=ut),await((o=this._viewer.getManager())===null||o===void 0?void 0:o.addAssetSingle(ut,this._options))}if(!this._isPlaying)break;this._viewer.renderEnabled=!0,c&&(c.enabled=!1),d&&(d.enabled=!0,await d.startTransition(1e3));const nt=[X$2(this.minSceneTime)];_&&nt.push(_.playAnimation()),b&&nt.push(b.animateAllViews()),await Promise.all(nt)}this._isPlayingLoop=!1}stop(){this._isPlaying=!1}async downloadScenes(){const h={};for(const c of this.scenes)for(const d of Object.keys(c)){const _=h[d]?d+"_":d;h[_]=c[_]}const o=zipSync(h);N$2(new Blob([o],{type:"application/zip"}),"scenes.glbloop")}async onAdded(h){var o,c;await super.onAdded(h);const d=this;(c=(o=h.getManager())===null||o===void 0?void 0:o.importer)===null||c===void 0||c.Importers.push(new Importer(class extends ZipLoader{load(_,b,_e,it){super.load(_,nt=>{d.loadScenes([...nt.values()]),b==null||b(null),X$2(100).then(d.play)},_e,it)}},["glbloop"],!0))}};SceneLoopPlugin.PluginType="SceneLoopPlugin",SceneLoopPlugin_decorate([uiMonitor("Loaded scenes")],SceneLoopPlugin.prototype,"loadedScenes",null),SceneLoopPlugin_decorate([uiButton("Load Scenes")],SceneLoopPlugin.prototype,"promptLoadScenes",null),SceneLoopPlugin_decorate([uiMonitor("Playing")],SceneLoopPlugin.prototype,"_isPlaying",void 0),SceneLoopPlugin_decorate([uiInput("Min Scene Time")],SceneLoopPlugin.prototype,"minSceneTime",void 0),SceneLoopPlugin_decorate([uiButton("Play")],SceneLoopPlugin.prototype,"play",null),SceneLoopPlugin_decorate([uiButton("Stop")],SceneLoopPlugin.prototype,"stop",null),SceneLoopPlugin_decorate([uiButton("Download Scenes")],SceneLoopPlugin.prototype,"downloadScenes",null),SceneLoopPlugin=SceneLoopPlugin_decorate([uiFolder("Scene Loop")],SceneLoopPlugin);class NBuf3{constructor(o){this.top=0,this.array=new Float32Array(o)}write(o){this.array[this.top++]=o.x,this.array[this.top++]=o.y,this.array[this.top++]=o.z}}class NBuf2{constructor(o){this.top=0,this.array=new Float32Array(o)}write(o){this.array[this.top++]=o.x,this.array[this.top++]=o.y}}class Node_Node{constructor(o){this.plane=null,this.front=null,this.back=null,this.polygons=[],o&&this.build(o)}clone(){const o=new Node_Node;return o.plane=this.plane&&this.plane.clone(),o.front=this.front&&this.front.clone(),o.back=this.back&&this.back.clone(),o.polygons=this.polygons.map(c=>c.clone()),o}invert(){for(let c=0;c<this.polygons.length;c++)this.polygons[c].flip();this.plane&&this.plane.flip(),this.front&&this.front.invert(),this.back&&this.back.invert();const o=this.front;this.front=this.back,this.back=o}clipPolygons(o){if(!this.plane)return o.slice();let c=new Array,d=new Array;for(let _=0;_<o.length;_++)this.plane.splitPolygon(o[_],c,d,c,d);return this.front&&(c=this.front.clipPolygons(c)),d=this.back?this.back.clipPolygons(d):[],c.concat(d)}clipTo(o){this.polygons=o.clipPolygons(this.polygons),this.front&&this.front.clipTo(o),this.back&&this.back.clipTo(o)}allPolygons(){let o=this.polygons.slice();return this.front&&(o=o.concat(this.front.allPolygons())),this.back&&(o=o.concat(this.back.allPolygons())),o}build(o){if(!o.length)return;this.plane||(this.plane=o[0].plane.clone());const c=[],d=[];for(let _=0;_<o.length;_++)this.plane.splitPolygon(o[_],this.polygons,this.polygons,c,d);c.length&&(this.front||(this.front=new Node_Node),this.front.build(c)),d.length&&(this.back||(this.back=new Node_Node),this.back.build(d))}}class Vector{constructor(o=0,c=0,d=0){this.x=o,this.y=c,this.z=d}copy(o){return this.x=o.x,this.y=o.y,this.z=o.z,this}clone(){return new Vector(this.x,this.y,this.z)}negate(){return this.x*=-1,this.y*=-1,this.z*=-1,this}add(o){return this.x+=o.x,this.y+=o.y,this.z+=o.z,this}sub(o){return this.x-=o.x,this.y-=o.y,this.z-=o.z,this}times(o){return this.x*=o,this.y*=o,this.z*=o,this}dividedBy(o){return this.x/=o,this.y/=o,this.z/=o,this}lerp(o,c){return this.add(new Vector().copy(o).sub(this).times(c))}unit(){return this.dividedBy(this.length())}length(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2)+Math.pow(this.z,2))}normalize(){return this.unit()}cross(o){const c=this.clone(),d=c.x,_=c.y,b=c.z,_e=o.x,it=o.y,nt=o.z;return this.x=_*nt-b*it,this.y=b*_e-d*nt,this.z=d*it-_*_e,this}dot(o){return this.x*o.x+this.y*o.y+this.z*o.z}toVector3(){return new three_module.Pq0(this.x,this.y,this.z)}}class Plane{constructor(o,c){this.normal=o,this.w=c,this.normal=o,this.w=c}clone(){return new Plane(this.normal.clone(),this.w)}flip(){this.normal.negate(),this.w=-this.w}splitPolygon(o,c,d,_,b){let _e=0;const it=[];for(let nt=0;nt<o.vertices.length;nt++){const at=this.normal.dot(o.vertices[nt].pos)-this.w,ut=at<-Plane.EPSILON?2:at>Plane.EPSILON?1:0;_e|=ut,it.push(ut)}switch(_e){case 0:(this.normal.dot(o.plane.normal)>0?c:d).push(o);break;case 1:_.push(o);break;case 2:b.push(o);break;case 3:{const nt=[],at=[];for(let ut=0;ut<o.vertices.length;ut++){const pt=(ut+1)%o.vertices.length,mt=it[ut],ft=it[pt],vt=o.vertices[ut],xt=o.vertices[pt];if(mt!=2&&nt.push(vt),mt!=1&&at.push(mt!=2?vt.clone():vt),(mt|ft)==3){const At=(this.w-this.normal.dot(vt.pos))/this.normal.dot(new Vector().copy(xt.pos).sub(vt.pos)),Ct=vt.interpolate(xt,At);nt.push(Ct),at.push(Ct.clone())}}nt.length>=3&&_.push(new Polygon(nt,o.shared)),at.length>=3&&b.push(new Polygon(at,o.shared));break}}}static fromPoints(o,c,d){const _=new Vector().copy(c).sub(o).cross(new Vector().copy(d).sub(o)).normalize();return new Plane(_.clone(),_.dot(o))}}Plane.EPSILON=1e-5;class Polygon{constructor(o,c){this.vertices=o,this.shared=c,this.plane=Plane.fromPoints(o[0].pos,o[1].pos,o[2].pos)}clone(){return new Polygon(this.vertices.map(o=>o.clone()),this.shared)}flip(){this.vertices.reverse().map(o=>o.flip()),this.plane.flip()}}class Vertex{constructor(o,c,d,_){this.pos=new Vector().copy(o),this.normal=new Vector().copy(c),this.uv=new Vector().copy(d),this.uv.z=0,_&&(this.color=new Vector().copy(_))}clone(){return new Vertex(this.pos,this.normal,this.uv,this.color)}flip(){this.normal.negate()}interpolate(o,c){return new Vertex(this.pos.clone().lerp(o.pos,c),this.normal.clone().lerp(o.normal,c),this.uv.clone().lerp(o.uv,c),this.color&&o.color&&this.color.clone().lerp(o.color,c))}}class CSG{constructor(){this.polygons=new Array}static fromPolygons(o){const c=new CSG;return c.polygons=o,c}static fromGeometry(o,c){let d=[];const _=o.attributes.position,b=o.attributes.normal,_e=o.attributes.uv,it=o.attributes.color,nt=o.groups;let at;if(o.index)at=o.index.array;else{at=new Array(_.array.length/_.itemSize|0);for(let pt=0;pt<at.length;pt++)at[pt]=pt}const ut=at.length/3|0;d=new Array(ut);for(let pt=0,mt=0,ft=at.length;pt<ft;pt+=3,mt++){const vt=new Array(3);for(let xt=0;xt<3;xt++){const At=at[pt+xt],Ct=3*At,Et=2*At,Tt=_.array[Ct],kt=_.array[Ct+1],Dt=_.array[Ct+2],zt=b.array[Ct],Bt=b.array[Ct+1],Rt=b.array[Ct+2],Ut=_e==null?void 0:_e.array[Et],Ht=_e==null?void 0:_e.array[Et+1];vt[xt]=new Vertex(new Vector(Tt,kt,Dt),new Vector(zt,Bt,Rt),new Vector(Ut,Ht,0),it&&new Vector(it.array[Et],it.array[Et+1],it.array[Et+2]))}if(c===void 0&&nt&&nt.length>0)for(const xt of nt)pt>=xt.start&&pt<xt.start+xt.count&&(d[mt]=new Polygon(vt,xt.materialIndex));else d[mt]=new Polygon(vt,c)}return CSG.fromPolygons(d.filter(pt=>!isNaN(pt.plane.normal.x)))}static toGeometry(o,c){let d=0;const _=o.polygons;for(const ft of _)d+=ft.vertices.length-2;const b=new three_module.LoY,_e=new NBuf3(3*d*3),it=new NBuf3(3*d*3),nt=new NBuf2(2*d*3);let at;const ut=[],pt=[];for(const ft of _){const vt=ft.vertices,xt=vt.length;ft.shared!==void 0&&(ut[ft.shared]||(ut[ft.shared]=[])),xt&&vt[0].color!==void 0&&(at||(at=new NBuf3(3*d*3)));for(let At=3;At<=xt;At++)(ft.shared===void 0?pt:ut[ft.shared]).push(_e.top/3,_e.top/3+1,_e.top/3+2),_e.write(vt[0].pos),_e.write(vt[At-2].pos),_e.write(vt[At-1].pos),it.write(vt[0].normal),it.write(vt[At-2].normal),it.write(vt[At-1].normal),nt&&(nt.write(vt[0].uv),nt.write(vt[At-2].uv),nt.write(vt[At-1].uv)),at&&(at.write(vt[0].color),at.write(vt[At-2].color),at.write(vt[At-1].color))}b.setAttribute("position",new three_module.THS(_e.array,3)),b.setAttribute("normal",new three_module.THS(it.array,3)),nt&&b.setAttribute("uv",new three_module.THS(nt.array,2)),at&&b.setAttribute("color",new three_module.THS(at.array,3));for(let ft=0;ft<ut.length;ft++)ut[ft]===void 0&&(ut[ft]=[]);if(ut.length){let ft=[],vt=0;for(let xt=0;xt<ut.length;xt++)b.addGroup(vt,ut[xt].length,xt),vt+=ut[xt].length,ft=ft.concat(ut[xt]);b.addGroup(vt,pt.length,ut.length),ft=ft.concat(pt),b.setIndex(ft)}const mt=new three_module.kn4().copy(c).invert();return b.applyMatrix4(mt),b.computeBoundingSphere(),b.computeBoundingBox(),b}static fromMesh(o,c){const d=CSG.fromGeometry(o.geometry,c),_=new three_module.Pq0,b=new three_module.dwI;b.getNormalMatrix(o.matrix);for(let _e=0;_e<d.polygons.length;_e++){const it=d.polygons[_e];for(let nt=0;nt<it.vertices.length;nt++){const at=it.vertices[nt];at.pos.copy(_.copy(at.pos.toVector3()).applyMatrix4(o.matrix)),at.normal.copy(_.copy(at.normal.toVector3()).applyMatrix3(b))}}return d}static toMesh(o,c,d){const _=CSG.toGeometry(o,c),b=new three_module.eaF(_,d);return b.matrix.copy(c),b.matrix.decompose(b.position,b.quaternion,b.scale),b.rotation.setFromQuaternion(b.quaternion),b.updateMatrixWorld(),b.castShadow=b.receiveShadow=!0,b}static union(o,c){const d=CSG.fromMesh(o),_=CSG.fromMesh(c);return CSG.toMesh(d.union(_),o.matrix,o.material)}static subtract(o,c){const d=CSG.fromMesh(o),_=CSG.fromMesh(c);return CSG.toMesh(d.subtract(_),o.matrix,o.material)}static intersect(o,c){const d=CSG.fromMesh(o),_=CSG.fromMesh(c);return CSG.toMesh(d.intersect(_),o.matrix,o.material)}clone(){const o=new CSG;return o.polygons=this.polygons.map(c=>c.clone()).filter(c=>Number.isFinite(c.plane.w)),o}toPolygons(){return this.polygons}union(o){const c=new Node_Node(this.clone().polygons),d=new Node_Node(o.clone().polygons);return c.clipTo(d),d.clipTo(c),d.invert(),d.clipTo(c),d.invert(),c.build(d.allPolygons()),CSG.fromPolygons(c.allPolygons())}subtract(o){const c=new Node_Node(this.clone().polygons),d=new Node_Node(o.clone().polygons);return c.invert(),c.clipTo(d),d.clipTo(c),d.invert(),d.clipTo(c),d.invert(),c.build(d.allPolygons()),c.invert(),CSG.fromPolygons(c.allPolygons())}intersect(o){const c=new Node_Node(this.clone().polygons),d=new Node_Node(o.clone().polygons);return c.invert(),d.clipTo(c),d.invert(),c.clipTo(d),d.clipTo(c),c.build(d.allPolygons()),c.invert(),CSG.fromPolygons(c.allPolygons())}inverse(){const o=this.clone();for(const c of o.polygons)c.flip();return o}toMesh(o,c){return CSG.toMesh(this,o,c)}toGeometry(o){return CSG.toGeometry(this,o)}}var CSGPluginBase_decorate=function(h,o,c,d){var _,b=arguments.length,_e=b<3?o:d===null?d=Object.getOwnPropertyDescriptor(o,c):d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_e=Reflect.decorate(h,o,c,d);else for(var it=h.length-1;it>=0;it--)(_=h[it])&&(_e=(b<3?_(_e):b>3?_(o,c,_e):_(o,c))||_e);return b>3&&_e&&Object.defineProperty(o,c,_e),_e};const csgOperations=["union","subtract","intersect"];class CSGPluginBase extends AViewerPlugin{constructor(){super(),this.enabled=!0,this.toJSON=void 0,this.dependencies=[PickingPlugin],this.rootMesh=new three_module.eaF,this.showResult=!1,this.csgSelectedEnabled=!1,this.csgSelectedOperation="union",this._csgNeedsUpdate=!1,this._csgVisible=!1,this._sceneUpdate=this._sceneUpdate.bind(this),this._preFrame=this._preFrame.bind(this),this.makeSelectedCSGBrush=this.makeSelectedCSGBrush.bind(this),this.refreshCSG=this.refreshCSG.bind(this),this._selectedObjectChanged=this._selectedObjectChanged.bind(this),this._updateSelectedProperties=this._updateSelectedProperties.bind(this),this.downloadObject=this.downloadObject.bind(this),this.exportObject=this.exportObject.bind(this)}async onAdded(o){var c;await super.onAdded(o),this.rootObject=await o.createObject3D(),this.rootObject.modelObject.add(this.rootMesh),o.scene.addEventListener("sceneUpdate",this._sceneUpdate),o.addEventListener("preFrame",this._preFrame),(c=o.getPlugin(PickingPlugin))===null||c===void 0||c.addEventListener("selectedObjectChanged",this._selectedObjectChanged)}async makeSelectedCSGBrush(){var o,c;const d=(c=(o=this._viewer)===null||o===void 0?void 0:o.getPlugin(PickingPlugin))===null||c===void 0?void 0:c.getSelectedObject();d&&d.geometry&&(d.userData._isCSGMesh||(d.userData.csgBrush||(d.userData.csgBrush={enabled:!0,operation:"union"}),this._selectedObjectChanged()))}refreshCSG(){this._sceneUpdate()}async downloadObject(){const o=await this.exportObject();o&&N$2(o,"csg."+o.ext)}async exportObject(){var o,c;const d=(c=(o=this._viewer)===null||o===void 0?void 0:o.getPluginByType("AssetExporterPlugin"))===null||c===void 0?void 0:c.exporter;if(!d||!this.rootObject)return;const _=this.rootMesh.visible;this.rootMesh.visible=!0;const b=await d.exportObject(this.rootObject.modelObject,{});return this.rootMesh.visible=_,b}_updateSelectedProperties(){var o,c;const d=(c=(o=this._viewer)===null||o===void 0?void 0:o.getPlugin(PickingPlugin))===null||c===void 0?void 0:c.getSelectedObject();d&&d.userData.csgBrush&&(d.userData.csgBrush.enabled=this.csgSelectedEnabled,d.userData.csgBrush.operation=this.csgSelectedOperation)}_selectedObjectChanged(){var o,c,d,_,b,_e,it,nt;const at=(c=(o=this._viewer)===null||o===void 0?void 0:o.getPlugin(PickingPlugin))===null||c===void 0?void 0:c.getSelectedObject();at&&(this.csgSelectedEnabled=(_=(d=at.userData.csgBrush)===null||d===void 0?void 0:d.enabled)!==null&&_!==void 0&&_,this.csgSelectedOperation=(_e=(b=at.userData.csgBrush)===null||b===void 0?void 0:b.operation)!==null&&_e!==void 0?_e:"union"),(nt=(it=this.uiConfig)===null||it===void 0?void 0:it.uiRefresh)===null||nt===void 0||nt.call(it,"postFrame",!0)}_preFrame(){var o,c,d;if(!this.rootObject||!this._csgNeedsUpdate&&this._csgVisible===this.showResult)return;const _=this._findCSGMeshes();this._csgNeedsUpdate&&(this._csgNeedsUpdate=!1,(o=this.rootObject)===null||o===void 0||o.modelObject.updateMatrixWorld(!0),((c=this.rootMesh.userData.dispose)!==null&&c!==void 0?c:this.rootMesh.removeFromParent)(),this.rootMesh=this._buildCSGMesh(_)),this.rootMesh&&!this.rootMesh.parent&&((d=this.rootObject)===null||d===void 0||d.modelObject.add(this.rootMesh)),this.showResult?(_.forEach(b=>{b[0].visible=!1}),this.rootObject.visible=!0,this._csgVisible=!0,this.rootObject.setDirty()):(_.forEach(b=>{b[0].visible=!0}),this.rootObject.visible=!1,this._csgVisible=!1,this.rootObject.setDirty())}_findCSGMeshes(){var o;const c=[];return(o=this._viewer)===null||o===void 0||o.scene.traverse(d=>{var _;d.isMesh&&d.geometry&&!((_=d.userData.csgBrush)===null||_===void 0)&&_.enabled&&c.push([d,d.userData.csgBrush.operation])}),c}_sceneUpdate(o){var c,d;!((d=(c=o==null?void 0:o.object)===null||c===void 0?void 0:c.userData)===null||d===void 0)&&d._isCSGMesh||(this._csgNeedsUpdate=!0)}}CSGPluginBase_decorate([uiToggle("Show Result",h=>({onChange:()=>{var o;return(o=h._viewer)===null||o===void 0?void 0:o.setDirty()}}))],CSGPluginBase.prototype,"showResult",void 0),CSGPluginBase_decorate([uiButton("Make CSG Brush",h=>({hidden:()=>{var o,c;const d=(c=(o=h._viewer)===null||o===void 0?void 0:o.getPlugin(PickingPlugin))===null||c===void 0?void 0:c.getSelectedObject();return!(d!=null&&d.userData)||!!d.userData.csgBrush||d.userData._isCSGMesh}}))],CSGPluginBase.prototype,"makeSelectedCSGBrush",null),CSGPluginBase_decorate([uiToggle("Enabled",h=>({hidden:()=>{var o,c;const d=(c=(o=h._viewer)===null||o===void 0?void 0:o.getPlugin(PickingPlugin))===null||c===void 0?void 0:c.getSelectedObject();return!d||!d.userData.csgBrush},onChange:h._updateSelectedProperties}))],CSGPluginBase.prototype,"csgSelectedEnabled",void 0),CSGPluginBase_decorate([uiDropdown("Operation",csgOperations.map(h=>({label:h})),h=>({hidden:()=>{var o,c;const d=(c=(o=h._viewer)===null||o===void 0?void 0:o.getPlugin(PickingPlugin))===null||c===void 0?void 0:c.getSelectedObject();return!d||!d.userData.csgBrush},onChange:h._updateSelectedProperties}))],CSGPluginBase.prototype,"csgSelectedOperation",void 0),CSGPluginBase_decorate([uiButton("Refresh CSG")],CSGPluginBase.prototype,"refreshCSG",null),CSGPluginBase_decorate([uiButton("Export Result",h=>({hidden:()=>{var o;return!(!((o=h._viewer)===null||o===void 0)&&o.getPluginByType("AssetExporterPlugin"))}}))],CSGPluginBase.prototype,"downloadObject",null);var CSGPluginBSP_decorate=function(h,o,c,d){var _,b=arguments.length,_e=b<3?o:d===null?d=Object.getOwnPropertyDescriptor(o,c):d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_e=Reflect.decorate(h,o,c,d);else for(var it=h.length-1;it>=0;it--)(_=h[it])&&(_e=(b<3?_(_e):b>3?_(o,c,_e):_(o,c))||_e);return b>3&&_e&&Object.defineProperty(o,c,_e),_e};function buildCSGMeshBSP(h,o){let c=new CSG;const d=h.map(b=>b[0].material).flatMap(b=>b);h.forEach(([b,_e])=>{if(!csgOperations.includes(_e))return void console.error(`Unknown operation ${_e}`);b.updateMatrix(),b.updateMatrixWorld();const it=b.matrix;b.matrix=b.matrixWorld;let nt=0;nt=Array.isArray(b.material)?void 0:d.indexOf(b.material),c=c[_e](CSG.fromMesh(b,nt)),b.matrix=it});const _=c.toMesh(o??new three_module.kn4().identity(),d);return _.userData._isCSGMesh=!0,_.geometry.groups=_.geometry.groups.filter(b=>b.count>0),_}let CSGPluginBSP=class extends CSGPluginBase{_buildCSGMesh(h){return buildCSGMeshBSP(h)}};CSGPluginBSP.PluginType="CSGPluginBSP",CSGPluginBSP=CSGPluginBSP_decorate([uiFolder("CSG Plugin (BSP)")],CSGPluginBSP);const ADDITION=0,SUBTRACTION=1,REVERSE_SUBTRACTION=2,INTERSECTION=3,DIFFERENCE=4,HOLLOW_SUBTRACTION=5,HOLLOW_INTERSECTION=6;class SeparatingAxisBounds{constructor(){this.min=1/0,this.max=-1/0}setFromPointsField(o,c){let d=1/0,_=-1/0;for(let b=0,_e=o.length;b<_e;b++){const it=o[b][c];d=it<d?it:d,_=it>_?it:_}this.min=d,this.max=_}setFromPoints(o,c){let d=1/0,_=-1/0;for(let b=0,_e=c.length;b<_e;b++){const it=c[b],nt=o.dot(it);d=nt<d?nt:d,_=nt>_?nt:_}this.min=d,this.max=_}isSeparated(o){return this.min>o.max||o.min>this.max}}SeparatingAxisBounds.prototype.setFromBox=function(){const h=new three_module.Pq0;return function(o,c){const d=c.min,_=c.max;let b=1/0,_e=-1/0;for(let it=0;it<=1;it++)for(let nt=0;nt<=1;nt++)for(let at=0;at<=1;at++){h.x=d.x*it+_.x*(1-it),h.y=d.y*nt+_.y*(1-nt),h.z=d.z*at+_.z*(1-at);const ut=o.dot(h);b=Math.min(ut,b),_e=Math.max(ut,_e)}this.min=b,this.max=_e}}();const closestPointLineToLine=function(){const h=new three_module.Pq0,o=new three_module.Pq0,c=new three_module.Pq0;return function(d,_,b){const _e=d.start,it=h,nt=_.start,at=o;c.subVectors(_e,nt),h.subVectors(d.end,d.start),o.subVectors(_.end,_.start);const ut=c.dot(at),pt=at.dot(it),mt=at.dot(at),ft=c.dot(it),vt=it.dot(it)*mt-pt*pt;let xt,At;xt=vt!==0?(ut*pt-ft*mt)/vt:0,At=(ut+xt*pt)/mt,b.x=xt,b.y=At}}(),closestPointsSegmentToSegment=function(){const h=new three_module.I9Y,o=new three_module.Pq0,c=new three_module.Pq0;return function(d,_,b,_e){closestPointLineToLine(d,_,h);let it=h.x,nt=h.y;if(it>=0&&it<=1&&nt>=0&&nt<=1)return d.at(it,b),void _.at(nt,_e);if(it>=0&&it<=1)return nt<0?_.at(0,_e):_.at(1,_e),void d.closestPointToPoint(_e,!0,b);if(nt>=0&&nt<=1)return it<0?d.at(0,b):d.at(1,b),void _.closestPointToPoint(b,!0,_e);{let at,ut;at=it<0?d.start:d.end,ut=nt<0?_.start:_.end;const pt=o,mt=c;return d.closestPointToPoint(ut,!0,o),_.closestPointToPoint(at,!0,c),pt.distanceToSquared(ut)<=mt.distanceToSquared(at)?(b.copy(pt),void _e.copy(ut)):(b.copy(at),void _e.copy(mt))}}}(),sphereIntersectTriangle=function(){const h=new three_module.Pq0,o=new three_module.Pq0,c=new three_module.Zcv,d=new three_module.cZY;return function(_,b){const{radius:_e,center:it}=_,{a:nt,b:at,c:ut}=b;if(d.start=nt,d.end=at,d.closestPointToPoint(it,!0,h).distanceTo(it)<=_e||(d.start=nt,d.end=ut,d.closestPointToPoint(it,!0,h).distanceTo(it)<=_e)||(d.start=at,d.end=ut,d.closestPointToPoint(it,!0,h).distanceTo(it)<=_e))return!0;const pt=b.getPlane(c);if(Math.abs(pt.distanceToPoint(it))<=_e){const mt=pt.projectPoint(it,o);if(b.containsPoint(mt))return!0}return!1}}(),ZERO_EPSILON=1e-15;function isNearZero(h){return Math.abs(h)<ZERO_EPSILON}class ExtendedTriangle extends three_module.lMl{constructor(...o){super(...o),this.isExtendedTriangle=!0,this.satAxes=new Array(4).fill().map(()=>new three_module.Pq0),this.satBounds=new Array(4).fill().map(()=>new SeparatingAxisBounds),this.points=[this.a,this.b,this.c],this.sphere=new three_module.iyt,this.plane=new three_module.Zcv,this.needsUpdate=!0}intersectsSphere(o){return sphereIntersectTriangle(o,this)}update(){const o=this.a,c=this.b,d=this.c,_=this.points,b=this.satAxes,_e=this.satBounds,it=b[0],nt=_e[0];this.getNormal(it),nt.setFromPoints(it,_);const at=b[1],ut=_e[1];at.subVectors(o,c),ut.setFromPoints(at,_);const pt=b[2],mt=_e[2];pt.subVectors(c,d),mt.setFromPoints(pt,_);const ft=b[3],vt=_e[3];ft.subVectors(d,o),vt.setFromPoints(ft,_),this.sphere.setFromPoints(this.points),this.plane.setFromNormalAndCoplanarPoint(it,o),this.needsUpdate=!1}}ExtendedTriangle.prototype.closestPointToSegment=function(){const h=new three_module.Pq0,o=new three_module.Pq0,c=new three_module.cZY;return function(d,_=null,b=null){const{start:_e,end:it}=d,nt=this.points;let at,ut=1/0;for(let pt=0;pt<3;pt++){const mt=(pt+1)%3;c.start.copy(nt[pt]),c.end.copy(nt[mt]),closestPointsSegmentToSegment(c,d,h,o),at=h.distanceToSquared(o),at<ut&&(ut=at,_&&_.copy(h),b&&b.copy(o))}return this.closestPointToPoint(_e,h),at=_e.distanceToSquared(h),at<ut&&(ut=at,_&&_.copy(h),b&&b.copy(_e)),this.closestPointToPoint(it,h),at=it.distanceToSquared(h),at<ut&&(ut=at,_&&_.copy(h),b&&b.copy(it)),Math.sqrt(ut)}}(),ExtendedTriangle.prototype.intersectsTriangle=function(){const h=new ExtendedTriangle,o=new Array(3),c=new Array(3),d=new SeparatingAxisBounds,_=new SeparatingAxisBounds,b=new three_module.Pq0,_e=new three_module.Pq0,it=new three_module.Pq0,nt=new three_module.Pq0,at=new three_module.Pq0,ut=new three_module.cZY,pt=new three_module.cZY,mt=new three_module.cZY,ft=new three_module.Pq0;function vt(xt,At,Ct){const Et=xt.points;let Tt=0,kt=-1;for(let Dt=0;Dt<3;Dt++){const{start:zt,end:Bt}=ut;zt.copy(Et[Dt]),Bt.copy(Et[(Dt+1)%3]),ut.delta(_e);const Rt=isNearZero(At.distanceToPoint(zt));if(isNearZero(At.normal.dot(_e))&&Rt){Ct.copy(ut),Tt=2;break}const Ut=At.intersectLine(ut,ft);if(!Ut&&Rt&&ft.copy(zt),(Ut||Rt)&&!isNearZero(ft.distanceTo(Bt))){if(Tt<=1)(Tt===1?Ct.start:Ct.end).copy(ft),Rt&&(kt=Tt);else if(Tt>=2){(kt===1?Ct.start:Ct.end).copy(ft),Tt=2;break}if(Tt++,Tt===2&&kt===-1)break}}return Tt}return function(xt,At=null,Ct=!1){this.needsUpdate&&this.update(),xt.isExtendedTriangle?xt.needsUpdate&&xt.update():(h.copy(xt),h.update(),xt=h);const Et=this.plane,Tt=xt.plane;if(Math.abs(Et.normal.dot(Tt.normal))>1-1e-10){const kt=this.satBounds,Dt=this.satAxes;c[0]=xt.a,c[1]=xt.b,c[2]=xt.c;for(let Rt=0;Rt<4;Rt++){const Ut=kt[Rt],Ht=Dt[Rt];if(d.setFromPoints(Ht,c),Ut.isSeparated(d))return!1}const zt=xt.satBounds,Bt=xt.satAxes;o[0]=this.a,o[1]=this.b,o[2]=this.c;for(let Rt=0;Rt<4;Rt++){const Ut=zt[Rt],Ht=Bt[Rt];if(d.setFromPoints(Ht,o),Ut.isSeparated(d))return!1}for(let Rt=0;Rt<4;Rt++){const Ut=Dt[Rt];for(let Ht=0;Ht<4;Ht++){const Jt=Bt[Ht];if(b.crossVectors(Ut,Jt),d.setFromPoints(b,o),_.setFromPoints(b,c),d.isSeparated(_))return!1}}return At&&(Ct||console.warn("ExtendedTriangle.intersectsTriangle: Triangles are coplanar which does not support an output edge. Setting edge to 0, 0, 0."),At.start.set(0,0,0),At.end.set(0,0,0)),!0}{const kt=vt(this,Tt,pt);if(kt===1&&xt.containsPoint(pt.end))return At&&(At.start.copy(pt.end),At.end.copy(pt.end)),!0;if(kt!==2)return!1;const Dt=vt(xt,Et,mt);if(Dt===1&&this.containsPoint(mt.end))return At&&(At.start.copy(mt.end),At.end.copy(mt.end)),!0;if(Dt!==2)return!1;if(pt.delta(it),mt.delta(nt),it.dot(nt)<0){let Ht=mt.start;mt.start=mt.end,mt.end=Ht}const zt=pt.start.dot(it),Bt=pt.end.dot(it),Rt=mt.start.dot(it),Ut=mt.end.dot(it);return(zt===Ut||Rt===Bt||Bt<Rt!=zt<Ut)&&(At&&(at.subVectors(pt.start,mt.start),at.dot(it)>0?At.start.copy(pt.start):At.start.copy(mt.start),at.subVectors(pt.end,mt.end),at.dot(it)<0?At.end.copy(pt.end):At.end.copy(mt.end)),!0)}}}(),ExtendedTriangle.prototype.distanceToPoint=function(){const h=new three_module.Pq0;return function(o){return this.closestPointToPoint(o,h),o.distanceTo(h)}}(),ExtendedTriangle.prototype.distanceToTriangle=function(){const h=new three_module.Pq0,o=new three_module.Pq0,c=["a","b","c"],d=new three_module.cZY,_=new three_module.cZY;return function(b,_e=null,it=null){const nt=_e||it?d:null;if(this.intersectsTriangle(b,nt))return(_e||it)&&(_e&&nt.getCenter(_e),it&&nt.getCenter(it)),0;let at=1/0;for(let ut=0;ut<3;ut++){let pt;const mt=c[ut],ft=b[mt];this.closestPointToPoint(ft,h),pt=ft.distanceToSquared(h),pt<at&&(at=pt,_e&&_e.copy(h),it&&it.copy(ft));const vt=this[mt];b.closestPointToPoint(vt,h),pt=vt.distanceToSquared(h),pt<at&&(at=pt,_e&&_e.copy(vt),it&&it.copy(h))}for(let ut=0;ut<3;ut++){const pt=c[ut],mt=c[(ut+1)%3];d.set(this[pt],this[mt]);for(let ft=0;ft<3;ft++){const vt=c[ft],xt=c[(ft+1)%3];_.set(b[vt],b[xt]),closestPointsSegmentToSegment(d,_,h,o);const At=h.distanceToSquared(o);At<at&&(at=At,_e&&_e.copy(h),it&&it.copy(o))}}return Math.sqrt(at)}}();const EPSILON=1e-14,_AB=new three_module.Pq0,_AC=new three_module.Pq0,_CB=new three_module.Pq0;function isTriDegenerate(h,o=EPSILON){_AB.subVectors(h.b,h.a),_AC.subVectors(h.c,h.a),_CB.subVectors(h.b,h.c);const c=_AB.angleTo(_AC),d=_AB.angleTo(_CB),_=Math.PI-c-d;return Math.abs(c)<o||Math.abs(d)<o||Math.abs(_)<o||h.a.distanceToSquared(h.b)<o||h.a.distanceToSquared(h.c)<o||h.b.distanceToSquared(h.c)<o}const TriangleSplitter_EPSILON=1e-10,COPLANAR_EPSILON=1e-10,PARALLEL_EPSILON=1e-10,_edge=new three_module.cZY,_foundEdge=new three_module.cZY,_vec=new three_module.Pq0,_triangleNormal=new three_module.Pq0,_planeNormal=new three_module.Pq0,TriangleSplitter_plane=new three_module.Zcv,_splittingTriangle=new ExtendedTriangle;class TrianglePool{constructor(){this._pool=[],this._index=0}getTriangle(){return this._index>=this._pool.length&&this._pool.push(new three_module.lMl),this._pool[this._index++]}clear(){this._index=0}reset(){this._pool.length=0,this._index=0}}class TriangleSplitter{constructor(){this.trianglePool=new TrianglePool,this.triangles=[],this.normal=new three_module.Pq0,this.coplanarTriangleUsed=!1}initialize(o){this.reset();const{triangles:c,trianglePool:d,normal:_}=this;if(Array.isArray(o))for(let b=0,_e=o.length;b<_e;b++){const it=o[b];if(b===0)it.getNormal(_);else if(Math.abs(1-it.getNormal(_vec).dot(_))>TriangleSplitter_EPSILON)throw new Error("Triangle Splitter: Cannot initialize with triangles that have different normals.");const nt=d.getTriangle();nt.copy(it),c.push(nt)}else{o.getNormal(_);const b=d.getTriangle();b.copy(o),c.push(b)}}splitByTriangle(o){const{normal:c,triangles:d}=this;if(o.getNormal(_triangleNormal).normalize(),Math.abs(1-Math.abs(_triangleNormal.dot(c)))<PARALLEL_EPSILON){this.coplanarTriangleUsed=!0;for(let b=0,_e=d.length;b<_e;b++)d[b].coplanarCount=0;const _=[o.a,o.b,o.c];for(let b=0;b<3;b++){const _e=(b+1)%3,it=_[b],nt=_[_e];_vec.subVectors(nt,it).normalize(),_planeNormal.crossVectors(_triangleNormal,_vec),TriangleSplitter_plane.setFromNormalAndCoplanarPoint(_planeNormal,it),this.splitByPlane(TriangleSplitter_plane,o)}}else o.getPlane(TriangleSplitter_plane),this.splitByPlane(TriangleSplitter_plane,o)}splitByPlane(o,c){const{triangles:d,trianglePool:_}=this;_splittingTriangle.copy(c),_splittingTriangle.needsUpdate=!0;for(let b=0,_e=d.length;b<_e;b++){const it=d[b];if(!_splittingTriangle.intersectsTriangle(it,_edge,!0))continue;const{a:nt,b:at,c:ut}=it;let pt=0,mt=-1,ft=!1,vt=[],xt=[];const At=[nt,at,ut];for(let Ct=0;Ct<3;Ct++){const Et=(Ct+1)%3;_edge.start.copy(At[Ct]),_edge.end.copy(At[Et]);const Tt=o.distanceToPoint(_edge.start),kt=o.distanceToPoint(_edge.end);if(Math.abs(Tt)<COPLANAR_EPSILON&&Math.abs(kt)<COPLANAR_EPSILON){ft=!0;break}if(Tt>0?vt.push(Ct):xt.push(Ct),Math.abs(Tt)<COPLANAR_EPSILON)continue;let Dt=!!o.intersectLine(_edge,_vec);!Dt&&Math.abs(kt)<COPLANAR_EPSILON&&(_vec.copy(_edge.end),Dt=!0),!Dt||_vec.distanceTo(_edge.start)<TriangleSplitter_EPSILON||(_vec.distanceTo(_edge.end)<TriangleSplitter_EPSILON&&(mt=Ct),pt===0?_foundEdge.start.copy(_vec):_foundEdge.end.copy(_vec),pt++)}if(!ft&&pt===2&&_foundEdge.distance()>COPLANAR_EPSILON)if(mt!==-1){mt=(mt+1)%3;let Ct=0;Ct===mt&&(Ct=(Ct+1)%3);let Et=Ct+1;Et===mt&&(Et=(Et+1)%3);const Tt=_.getTriangle();Tt.a.copy(At[Et]),Tt.b.copy(_foundEdge.end),Tt.c.copy(_foundEdge.start),isTriDegenerate(Tt)||d.push(Tt),it.a.copy(At[Ct]),it.b.copy(_foundEdge.start),it.c.copy(_foundEdge.end),isTriDegenerate(it)&&(d.splice(b,1),b--,_e--)}else{const Ct=vt.length>=2?xt[0]:vt[0];if(Ct===0){let zt=_foundEdge.start;_foundEdge.start=_foundEdge.end,_foundEdge.end=zt}const Et=(Ct+1)%3,Tt=(Ct+2)%3,kt=_.getTriangle(),Dt=_.getTriangle();At[Et].distanceToSquared(_foundEdge.start)<At[Tt].distanceToSquared(_foundEdge.end)?(kt.a.copy(At[Et]),kt.b.copy(_foundEdge.start),kt.c.copy(_foundEdge.end),Dt.a.copy(At[Et]),Dt.b.copy(At[Tt]),Dt.c.copy(_foundEdge.start)):(kt.a.copy(At[Tt]),kt.b.copy(_foundEdge.start),kt.c.copy(_foundEdge.end),Dt.a.copy(At[Et]),Dt.b.copy(At[Tt]),Dt.c.copy(_foundEdge.end)),it.a.copy(At[Ct]),it.b.copy(_foundEdge.end),it.c.copy(_foundEdge.start),isTriDegenerate(kt)||d.push(kt),isTriDegenerate(Dt)||d.push(Dt),isTriDegenerate(it)&&(d.splice(b,1),b--,_e--)}else pt===3&&console.warn("TriangleClipper: Coplanar clip not handled")}}reset(){this.triangles.length=0,this.trianglePool.clear(),this.coplanarTriangleUsed=!1}}function areSharedArrayBuffersSupported(){return typeof SharedArrayBuffer<"u"}function convertToSharedArrayBuffer(h){if(h.buffer instanceof SharedArrayBuffer)return h;const o=h.constructor,c=h.buffer,d=new SharedArrayBuffer(c.byteLength),_=new Uint8Array(c);return new Uint8Array(d).set(_,0),new o(d)}function getIndexArray(h,o=ArrayBuffer){return h>65535?new Uint32Array(new o(4*h)):new Uint16Array(new o(2*h))}function ensureIndex(h,o){if(!h.index){const c=h.attributes.position.count,d=getIndexArray(c,o.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer);h.setIndex(new three_module.THS(d,1));for(let _=0;_<c;_++)d[_]=_}}function getVertexCount(h){return h.index?h.index.count:h.attributes.position.count}function getTriCount(h){return getVertexCount(h)/3}function ceilToFourByteStride(h){return 4+(h=~~h)-h%4}class TypeBackedArray{constructor(o,c=500){this.expansionFactor=1.5,this.type=o,this.length=0,this.array=null,this.setSize(c)}setType(o){if(this.length!==0)throw new Error("TypeBackedArray: Cannot change the type while there is used data in the buffer.");const c=this.array.buffer;this.array=new o(c),this.type=o}setSize(o){if(this.array&&o===this.array.length)return;const c=this.type,d=new c(new(areSharedArrayBuffersSupported()?SharedArrayBuffer:ArrayBuffer)(ceilToFourByteStride(o*c.BYTES_PER_ELEMENT)));this.array&&d.set(this.array,0),this.array=d}expand(){const{array:o,expansionFactor:c}=this;this.setSize(o.length*c)}push(...o){let{array:c,length:d}=this;d+o.length>c.length&&(this.expand(),c=this.array);for(let _=0,b=o.length;_<b;_++)c[d+_]=o[_];this.length+=o.length}clear(){this.length=0}}class TypedAttributeData{constructor(){this.groupAttributes=[{}],this.groupCount=0}getType(o){return this.groupAttributes[0][o].type}getItemSize(o){return this.groupAttributes[0][o].itemSize}getNormalized(o){return this.groupAttributes[0][o].normalized}getCount(o){if(this.groupCount<=o)return 0;const c=this.getGroupAttrArray("position",o);return c.length/c.itemSize}getTotalLength(o){const{groupCount:c,groupAttributes:d}=this;let _=0;for(let b=0;b<c;b++)_+=d[b][o].length;return _}getGroupAttrSet(o=0){const{groupAttributes:c}=this;if(c[o])return this.groupCount=Math.max(this.groupCount,o+1),c[o];const d=c[0];for(this.groupCount=Math.max(this.groupCount,o+1);o>=c.length;){const _={};c.push(_);for(const b in d){const _e=d[b],it=new TypeBackedArray(_e.type);it.itemSize=_e.itemSize,it.normalized=_e.normalized,_[b]=it}}return c[o]}getGroupAttrArray(o,c=0){const{groupAttributes:d}=this;if(!d[0][o])throw new Error(`TypedAttributeData: Attribute with "${o}" has not been initialized`);return this.getGroupAttrSet(c)[o]}initializeArray(o,c,d,_){const{groupAttributes:b}=this,_e=b[0][o];if(_e){if(_e.type!==c)for(let it=0,nt=b.length;it<nt;it++){const at=b[it][o];at.setType(c),at.itemSize=d,at.normalized=_}}else for(let it=0,nt=b.length;it<nt;it++){const at=new TypeBackedArray(c);at.itemSize=d,at.normalized=_,b[it][o]=at}}clear(){this.groupCount=0;const{groupAttributes:o}=this;o.forEach(c=>{for(const d in c)c[d].clear()})}delete(o){this.groupAttributes.forEach(c=>{delete c[o]})}reset(){this.groupAttributes=[],this.groupCount=0}}class IntersectionMap{constructor(){this.intersectionSet={},this.ids=[]}add(o,c){const{intersectionSet:d,ids:_}=this;d[o]||(d[o]=[],_.push(o)),d[o].push(c)}}const operationsUtils_ray=new three_module.RlV,operationsUtils_matrix=new three_module.kn4,_tri=new three_module.lMl,_vec3=new three_module.Pq0,_vec4a=new three_module.IUQ,_vec4b=new three_module.IUQ,_vec4c=new three_module.IUQ,_vec4_0=new three_module.IUQ,_vec4_1=new three_module.IUQ,_vec4_2=new three_module.IUQ,operationsUtils_edge=new three_module.cZY,_normal=new three_module.Pq0,JITTER_EPSILON=1e-8,OFFSET_EPSILON=1e-15,BACK_SIDE=-1,FRONT_SIDE=1,COPLANAR_OPPOSITE=-2,COPLANAR_ALIGNED=2,INVERT_TRI=0,ADD_TRI=1,SKIP_TRI=2,FLOATING_COPLANAR_EPSILON=1e-14;let _debugContext=null;function setDebugContext(h){_debugContext=h}function getHitSide(h,o){h.getMidpoint(operationsUtils_ray.origin),h.getNormal(operationsUtils_ray.direction);const c=o.raycastFirst(operationsUtils_ray,three_module.$EB);return c&&operationsUtils_ray.direction.dot(c.face.normal)>0?BACK_SIDE:FRONT_SIDE}function getHitSideWithCoplanarCheck(h,o){function c(){return Math.random()-.5}h.getNormal(_normal),operationsUtils_ray.direction.copy(_normal),h.getMidpoint(operationsUtils_ray.origin);let d=0,_=1/0;for(let b=0;b<3;b++){operationsUtils_ray.direction.x+=c()*JITTER_EPSILON,operationsUtils_ray.direction.y+=c()*JITTER_EPSILON,operationsUtils_ray.direction.z+=c()*JITTER_EPSILON,operationsUtils_ray.direction.multiplyScalar(-1);const _e=o.raycastFirst(operationsUtils_ray,three_module.$EB);if(_e&&operationsUtils_ray.direction.dot(_e.face.normal)>0&&d++,_e!==null&&(_=Math.min(_,_e.distance)),_<=OFFSET_EPSILON)return _e.face.normal.dot(_normal)>0?COPLANAR_ALIGNED:COPLANAR_OPPOSITE;if(d/3>.5||(b-d+1)/3>.5)break}return d/3>.5?BACK_SIDE:FRONT_SIDE}function collectIntersectingTriangles(h,o){const c=new IntersectionMap,d=new IntersectionMap;return operationsUtils_matrix.copy(h.matrixWorld).invert().multiply(o.matrixWorld),h.geometry.boundsTree.bvhcast(o.geometry.boundsTree,operationsUtils_matrix,{intersectsTriangles(_,b,_e,it){if(!isTriDegenerate(_)&&!isTriDegenerate(b)){let nt=_.intersectsTriangle(b,operationsUtils_edge,!0);if(!nt){const at=_.plane,ut=b.plane,pt=at.normal,mt=ut.normal;pt.dot(mt)===1&&Math.abs(at.constant-ut.constant)<FLOATING_COPLANAR_EPSILON&&(nt=!0)}if(nt){let at=h.geometry.boundsTree.resolveTriangleIndex(_e),ut=o.geometry.boundsTree.resolveTriangleIndex(it);c.add(at,ut),d.add(ut,at),_debugContext&&(_debugContext.addEdge(operationsUtils_edge),_debugContext.addIntersectingTriangles(_e,_,it,b))}}return!1}}),{aIntersections:c,bIntersections:d}}function appendAttributeFromTriangle(h,o,c,d,_,b,_e=!1){const it=c.attributes,nt=c.index,at=3*h,ut=nt.getX(at+0),pt=nt.getX(at+1),mt=nt.getX(at+2);for(const ft in b){const vt=it[ft],xt=b[ft];if(!(ft in it))throw new Error(`CSG Operations: Attribute ${ft} not available on geometry.`);const At=vt.itemSize;ft==="position"?(_tri.a.fromBufferAttribute(vt,ut).applyMatrix4(d),_tri.b.fromBufferAttribute(vt,pt).applyMatrix4(d),_tri.c.fromBufferAttribute(vt,mt).applyMatrix4(d),pushBarycoordInterpolatedValues(_tri.a,_tri.b,_tri.c,o,3,xt,_e)):ft==="normal"?(_tri.a.fromBufferAttribute(vt,ut).applyNormalMatrix(_),_tri.b.fromBufferAttribute(vt,pt).applyNormalMatrix(_),_tri.c.fromBufferAttribute(vt,mt).applyNormalMatrix(_),_e&&(_tri.a.multiplyScalar(-1),_tri.b.multiplyScalar(-1),_tri.c.multiplyScalar(-1)),pushBarycoordInterpolatedValues(_tri.a,_tri.b,_tri.c,o,3,xt,_e,!0)):(_vec4a.fromBufferAttribute(vt,ut),_vec4b.fromBufferAttribute(vt,pt),_vec4c.fromBufferAttribute(vt,mt),pushBarycoordInterpolatedValues(_vec4a,_vec4b,_vec4c,o,At,xt,_e))}}function appendAttributesFromIndices(h,o,c,d,_,b,_e,it=!1){appendAttributeFromIndex(h,d,_,b,_e,it),appendAttributeFromIndex(it?c:o,d,_,b,_e,it),appendAttributeFromIndex(it?o:c,d,_,b,_e,it)}function getOperationAction(h,o,c=!1){switch(h){case ADDITION:if(o===FRONT_SIDE||o===COPLANAR_ALIGNED&&!c)return ADD_TRI;break;case SUBTRACTION:if(c){if(o===BACK_SIDE)return INVERT_TRI}else if(o===FRONT_SIDE||o===COPLANAR_OPPOSITE)return ADD_TRI;break;case REVERSE_SUBTRACTION:if(c){if(o===FRONT_SIDE||o===COPLANAR_OPPOSITE)return ADD_TRI}else if(o===BACK_SIDE)return INVERT_TRI;break;case DIFFERENCE:if(o===BACK_SIDE)return INVERT_TRI;if(o===FRONT_SIDE)return ADD_TRI;break;case INTERSECTION:if(o===BACK_SIDE||o===COPLANAR_ALIGNED&&!c)return ADD_TRI;break;case HOLLOW_SUBTRACTION:if(!c&&(o===FRONT_SIDE||o===COPLANAR_OPPOSITE))return ADD_TRI;break;case HOLLOW_INTERSECTION:if(!c&&(o===BACK_SIDE||o===COPLANAR_ALIGNED))return ADD_TRI;break;default:throw new Error(`Unrecognized CSG operation enum "${h}".`)}return SKIP_TRI}function pushBarycoordInterpolatedValues(h,o,c,d,_,b,_e=!1,it=!1){const nt=at=>{b.push(at.x),_>1&&b.push(at.y),_>2&&b.push(at.z),_>3&&b.push(at.w)};_vec4_0.set(0,0,0,0).addScaledVector(h,d.a.x).addScaledVector(o,d.a.y).addScaledVector(c,d.a.z),_vec4_1.set(0,0,0,0).addScaledVector(h,d.b.x).addScaledVector(o,d.b.y).addScaledVector(c,d.b.z),_vec4_2.set(0,0,0,0).addScaledVector(h,d.c.x).addScaledVector(o,d.c.y).addScaledVector(c,d.c.z),it&&(_vec4_0.normalize(),_vec4_1.normalize(),_vec4_2.normalize()),nt(_vec4_0),_e?(nt(_vec4_2),nt(_vec4_1)):(nt(_vec4_1),nt(_vec4_2))}function appendAttributeFromIndex(h,o,c,d,_,b=!1){for(const _e in _){const it=o[_e],nt=_[_e];if(!(_e in o))throw new Error(`CSG Operations: Attribute ${_e} no available on geometry.`);const at=it.itemSize;_e==="position"?(_vec3.fromBufferAttribute(it,h).applyMatrix4(c),nt.push(_vec3.x,_vec3.y,_vec3.z)):_e==="normal"?(_vec3.fromBufferAttribute(it,h).applyNormalMatrix(d),b&&_vec3.multiplyScalar(-1),nt.push(_vec3.x,_vec3.y,_vec3.z)):(nt.push(it.getX(h)),at>1&&nt.push(it.getY(h)),at>2&&nt.push(it.getZ(h)),at>3&&nt.push(it.getW(h)))}}class TriangleIntersectData{constructor(o){this.triangle=new three_module.lMl().copy(o),this.intersects={}}addTriangle(o,c){this.intersects[o]=new three_module.lMl().copy(c)}getIntersectArray(){const o=[],{intersects:c}=this;for(const d in c)o.push(c[d]);return o}}class TriangleIntersectionSets{constructor(){this.data={}}addTriangleIntersection(o,c,d,_){const{data:b}=this;b[o]||(b[o]=new TriangleIntersectData(c)),b[o].addTriangle(d,_)}getTrianglesAsArray(o=null){const{data:c}=this,d=[];if(o!==null)o in c&&d.push(c[o].triangle);else for(const _ in c)d.push(c[_].triangle);return d}getTriangleIndices(){return Object.keys(this.data).map(o=>parseInt(o))}getIntersectionIndices(o){const{data:c}=this;return c[o]?Object.keys(c[o].intersects).map(d=>parseInt(d)):[]}getIntersectionsAsArray(o=null,c=null){const{data:d}=this,_=new Set,b=[],_e=it=>{if(d[it])if(c!==null)d[it].intersects[c]&&b.push(d[it].intersects[c]);else{const nt=d[it].intersects;for(const at in nt)_.has(at)||(_.add(at),b.push(nt[at]))}};if(o!==null)_e(o);else for(const it in d)_e(it);return b}reset(){this.data={}}}class OperationDebugData{constructor(){this.enabled=!1,this.triangleIntersectsA=new TriangleIntersectionSets,this.triangleIntersectsB=new TriangleIntersectionSets,this.intersectionEdges=[]}addIntersectingTriangles(o,c,d,_){const{triangleIntersectsA:b,triangleIntersectsB:_e}=this;b.addTriangleIntersection(o,c,d,_),_e.addTriangleIntersection(d,_,o,c)}addEdge(o){this.intersectionEdges.push(o.clone())}reset(){this.triangleIntersectsA.reset(),this.triangleIntersectsB.reset(),this.intersectionEdges=[]}init(){this.enabled&&(this.reset(),setDebugContext(this))}complete(){this.enabled&&setDebugContext(null)}}const operations_matrix=new three_module.kn4,_normalMatrix=new three_module.dwI,_triA=new three_module.lMl,_triB=new three_module.lMl,operations_tri=new three_module.lMl,_barycoordTri=new three_module.lMl,_attr=[],_actions=[];function getFirstIdFromSet(h){for(const o of h)return o}function performOperation(h,o,c,d,_,b={}){const{useGroups:_e=!0}=b,{aIntersections:it,bIntersections:nt}=collectIntersectingTriangles(h,o);let at;return at=_e?0:-1,performSplitTriangleOperations(h,o,it,c,!1,d,_,at),performWholeTriangleOperations(h,o,it,c,!1,_,at),c.findIndex(ut=>ut!==HOLLOW_INTERSECTION&&ut!==HOLLOW_SUBTRACTION)!==-1&&(at=_e?h.geometry.groups.length||1:-1,performSplitTriangleOperations(o,h,nt,c,!0,d,_,at),performWholeTriangleOperations(o,h,nt,c,!0,_,at)),_attr.length=0,_actions.length=0,{groups:[],materials:null}}function performSplitTriangleOperations(h,o,c,d,_,b,_e,it=0){const nt=h.matrixWorld.determinant()<0;operations_matrix.copy(o.matrixWorld).invert().multiply(h.matrixWorld),_normalMatrix.getNormalMatrix(h.matrixWorld).multiplyScalar(nt?-1:1);const at=h.geometry.groupIndices,ut=h.geometry.index,pt=h.geometry.attributes.position,mt=o.geometry.boundsTree,ft=o.geometry.index,vt=o.geometry.attributes.position,xt=c.ids,At=c.intersectionSet;for(let Ct=0,Et=xt.length;Ct<Et;Ct++){const Tt=xt[Ct],kt=it===-1?0:at[Tt]+it,Dt=3*Tt,zt=ut.getX(Dt+0),Bt=ut.getX(Dt+1),Rt=ut.getX(Dt+2);_triA.a.fromBufferAttribute(pt,zt).applyMatrix4(operations_matrix),_triA.b.fromBufferAttribute(pt,Bt).applyMatrix4(operations_matrix),_triA.c.fromBufferAttribute(pt,Rt).applyMatrix4(operations_matrix),b.reset(),b.initialize(_triA);const Ut=At[Tt];for(let Jt=0,Kt=Ut.length;Jt<Kt;Jt++){const sr=3*Ut[Jt],ir=ft.getX(sr+0),cr=ft.getX(sr+1),lr=ft.getX(sr+2);_triB.a.fromBufferAttribute(vt,ir),_triB.b.fromBufferAttribute(vt,cr),_triB.c.fromBufferAttribute(vt,lr),b.splitByTriangle(_triB)}const Ht=b.triangles;for(let Jt=0,Kt=Ht.length;Jt<Kt;Jt++){const sr=Ht[Jt],ir=b.coplanarTriangleUsed?getHitSideWithCoplanarCheck(sr,mt):getHitSide(sr,mt);_attr.length=0,_actions.length=0;for(let cr=0,lr=d.length;cr<lr;cr++){const hr=getOperationAction(d[cr],ir,_);hr!==SKIP_TRI&&(_actions.push(hr),_attr.push(_e[cr].getGroupAttrSet(kt)))}if(_attr.length!==0){_triA.getBarycoord(sr.a,_barycoordTri.a),_triA.getBarycoord(sr.b,_barycoordTri.b),_triA.getBarycoord(sr.c,_barycoordTri.c);for(let cr=0,lr=_attr.length;cr<lr;cr++){const hr=_attr[cr],dr=_actions[cr]===INVERT_TRI;appendAttributeFromTriangle(Tt,_barycoordTri,h.geometry,h.matrixWorld,_normalMatrix,hr,nt!==dr)}}}}return xt.length}function performWholeTriangleOperations(h,o,c,d,_,b,_e=0){const it=h.matrixWorld.determinant()<0;operations_matrix.copy(o.matrixWorld).invert().multiply(h.matrixWorld),_normalMatrix.getNormalMatrix(h.matrixWorld).multiplyScalar(it?-1:1);const nt=o.geometry.boundsTree,at=h.geometry.groupIndices,ut=h.geometry.index,pt=h.geometry.attributes,mt=pt.position,ft=[],vt=h.geometry.halfEdges,xt=new Set;for(let At=0,Ct=getTriCount(h.geometry);At<Ct;At++)At in c.intersectionSet||xt.add(At);for(;xt.size>0;){const At=getFirstIdFromSet(xt);xt.delete(At),ft.push(At);const Ct=3*At,Et=ut.getX(Ct+0),Tt=ut.getX(Ct+1),kt=ut.getX(Ct+2);operations_tri.a.fromBufferAttribute(mt,Et).applyMatrix4(operations_matrix),operations_tri.b.fromBufferAttribute(mt,Tt).applyMatrix4(operations_matrix),operations_tri.c.fromBufferAttribute(mt,kt).applyMatrix4(operations_matrix);const Dt=getHitSide(operations_tri,nt);_actions.length=0,_attr.length=0;for(let zt=0,Bt=d.length;zt<Bt;zt++){const Rt=getOperationAction(d[zt],Dt,_);Rt!==SKIP_TRI&&(_actions.push(Rt),_attr.push(b[zt]))}for(;ft.length>0;){const zt=ft.pop();for(let Bt=0;Bt<3;Bt++){const Rt=vt.getSiblingTriangleIndex(zt,Bt);Rt!==-1&&xt.has(Rt)&&(ft.push(Rt),xt.delete(Rt))}if(_attr.length!==0){const Bt=3*zt,Rt=ut.getX(Bt+0),Ut=ut.getX(Bt+1),Ht=ut.getX(Bt+2),Jt=_e===-1?0:at[zt]+_e;if(operations_tri.a.fromBufferAttribute(mt,Rt),operations_tri.b.fromBufferAttribute(mt,Ut),operations_tri.c.fromBufferAttribute(mt,Ht),!isTriDegenerate(operations_tri))for(let Kt=0,sr=_attr.length;Kt<sr;Kt++){const ir=_actions[Kt],cr=_attr[Kt].getGroupAttrSet(Jt),lr=ir===INVERT_TRI;appendAttributesFromIndices(Rt,Ut,Ht,pt,h.matrixWorld,_normalMatrix,cr,lr!==it)}}}}}const CENTER=0,AVERAGE=1,SAH=2,CONTAINED=2,TRIANGLE_INTERSECT_COST=1.25,TRAVERSAL_COST=1,BYTES_PER_NODE=32,IS_LEAFNODE_FLAG=65535,FLOAT32_EPSILON=Math.pow(2,-24),SKIP_GENERATION=Symbol("SKIP_GENERATION");function geometryUtils_getVertexCount(h){return h.index?h.index.count:h.attributes.position.count}function geometryUtils_getTriCount(h){return geometryUtils_getVertexCount(h)/3}function geometryUtils_getIndexArray(h,o=ArrayBuffer){return h>65535?new Uint32Array(new o(4*h)):new Uint16Array(new o(2*h))}function geometryUtils_ensureIndex(h,o){if(!h.index){const c=h.attributes.position.count,d=geometryUtils_getIndexArray(c,o.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer);h.setIndex(new three_module.THS(d,1));for(let _=0;_<c;_++)d[_]=_}}function getFullGeometryRange(h){const o=geometryUtils_getTriCount(h),c=h.drawRange,d=c.start/3,_=(c.start+c.count)/3,b=Math.max(0,d),_e=Math.min(o,_)-b;return[{offset:Math.floor(b),count:Math.floor(_e)}]}function getRootIndexRanges(h){if(!h.groups||!h.groups.length)return getFullGeometryRange(h);const o=[],c=new Set,d=h.drawRange,_=d.start/3,b=(d.start+d.count)/3;for(const it of h.groups){const nt=it.start/3,at=(it.start+it.count)/3;c.add(Math.max(_,nt)),c.add(Math.min(b,at))}const _e=Array.from(c.values()).sort((it,nt)=>it-nt);for(let it=0;it<_e.length-1;it++){const nt=_e[it],at=_e[it+1];o.push({offset:Math.floor(nt),count:Math.floor(at-nt)})}return o}function hasGroupGaps(h){if(h.groups.length===0)return!1;const o=geometryUtils_getTriCount(h),c=getRootIndexRanges(h).sort((b,_e)=>b.offset-_e.offset),d=c[c.length-1];d.count=Math.min(o-d.offset,d.count);let _=0;return c.forEach(({count:b})=>_+=b),o!==_}function arrayToBox(h,o,c){return c.min.x=o[h],c.min.y=o[h+1],c.min.z=o[h+2],c.max.x=o[h+3],c.max.y=o[h+4],c.max.z=o[h+5],c}function makeEmptyBounds(h){h[0]=h[1]=h[2]=1/0,h[3]=h[4]=h[5]=-1/0}function getLongestEdgeIndex(h){let o=-1,c=-1/0;for(let d=0;d<3;d++){const _=h[d+3]-h[d];_>c&&(c=_,o=d)}return o}function copyBounds(h,o){o.set(h)}function unionBounds(h,o,c){let d,_;for(let b=0;b<3;b++){const _e=b+3;d=h[b],_=o[b],c[b]=d<_?d:_,d=h[_e],_=o[_e],c[_e]=d>_?d:_}}function expandByTriangleBounds(h,o,c){for(let d=0;d<3;d++){const _=o[h+2*d],b=o[h+2*d+1],_e=_-b,it=_+b;_e<c[d]&&(c[d]=_e),it>c[d+3]&&(c[d+3]=it)}}function computeSurfaceArea(h){const o=h[3]-h[0],c=h[4]-h[1],d=h[5]-h[2];return 2*(o*c+c*d+d*o)}function computeBoundsUtils_getBounds(h,o,c,d,_=null){let b=1/0,_e=1/0,it=1/0,nt=-1/0,at=-1/0,ut=-1/0,pt=1/0,mt=1/0,ft=1/0,vt=-1/0,xt=-1/0,At=-1/0;const Ct=_!==null;for(let Et=6*o,Tt=6*(o+c);Et<Tt;Et+=6){const kt=h[Et+0],Dt=h[Et+1],zt=kt-Dt,Bt=kt+Dt;zt<b&&(b=zt),Bt>nt&&(nt=Bt),Ct&&kt<pt&&(pt=kt),Ct&&kt>vt&&(vt=kt);const Rt=h[Et+2],Ut=h[Et+3],Ht=Rt-Ut,Jt=Rt+Ut;Ht<_e&&(_e=Ht),Jt>at&&(at=Jt),Ct&&Rt<mt&&(mt=Rt),Ct&&Rt>xt&&(xt=Rt);const Kt=h[Et+4],sr=h[Et+5],ir=Kt-sr,cr=Kt+sr;ir<it&&(it=ir),cr>ut&&(ut=cr),Ct&&Kt<ft&&(ft=Kt),Ct&&Kt>At&&(At=Kt)}d[0]=b,d[1]=_e,d[2]=it,d[3]=nt,d[4]=at,d[5]=ut,Ct&&(_[0]=pt,_[1]=mt,_[2]=ft,_[3]=vt,_[4]=xt,_[5]=At)}function getCentroidBounds(h,o,c,d){let _=1/0,b=1/0,_e=1/0,it=-1/0,nt=-1/0,at=-1/0;for(let ut=6*o,pt=6*(o+c);ut<pt;ut+=6){const mt=h[ut+0];mt<_&&(_=mt),mt>it&&(it=mt);const ft=h[ut+2];ft<b&&(b=ft),ft>nt&&(nt=ft);const vt=h[ut+4];vt<_e&&(_e=vt),vt>at&&(at=vt)}d[0]=_,d[1]=b,d[2]=_e,d[3]=it,d[4]=nt,d[5]=at}function computeTriangleBounds(h,o){makeEmptyBounds(o);const c=h.attributes.position,d=h.index?h.index.array:null,_=geometryUtils_getTriCount(h),b=new Float32Array(6*_),_e=c.normalized,it=c.array,nt=c.offset||0;let at=3;c.isInterleavedBufferAttribute&&(at=c.data.stride);const ut=["getX","getY","getZ"];for(let pt=0;pt<_;pt++){const mt=3*pt,ft=6*pt;let vt=mt+0,xt=mt+1,At=mt+2;d&&(vt=d[vt],xt=d[xt],At=d[At]),_e||(vt=vt*at+nt,xt=xt*at+nt,At=At*at+nt);for(let Ct=0;Ct<3;Ct++){let Et,Tt,kt;_e?(Et=c[ut[Ct]](vt),Tt=c[ut[Ct]](xt),kt=c[ut[Ct]](At)):(Et=it[vt+Ct],Tt=it[xt+Ct],kt=it[At+Ct]);let Dt=Et;Tt<Dt&&(Dt=Tt),kt<Dt&&(Dt=kt);let zt=Et;Tt>zt&&(zt=Tt),kt>zt&&(zt=kt);const Bt=(zt-Dt)/2,Rt=2*Ct;b[ft+Rt+0]=Dt+Bt,b[ft+Rt+1]=Bt+(Math.abs(Dt)+Bt)*FLOAT32_EPSILON,Dt<o[Ct]&&(o[Ct]=Dt),zt>o[Ct+3]&&(o[Ct+3]=zt)}}return b}const BIN_COUNT=32,binsSort=(h,o)=>h.candidate-o.candidate,sahBins=new Array(BIN_COUNT).fill().map(()=>({count:0,bounds:new Float32Array(6),rightCacheBounds:new Float32Array(6),leftCacheBounds:new Float32Array(6),candidate:0})),leftBounds=new Float32Array(6);function getOptimalSplit(h,o,c,d,_,b){let _e=-1,it=0;if(b===CENTER)_e=getLongestEdgeIndex(o),_e!==-1&&(it=(o[_e]+o[_e+3])/2);else if(b===AVERAGE)_e=getLongestEdgeIndex(h),_e!==-1&&(it=getAverage(c,d,_,_e));else if(b===SAH){const nt=computeSurfaceArea(h);let at=TRIANGLE_INTERSECT_COST*_;const ut=6*d,pt=6*(d+_);for(let mt=0;mt<3;mt++){const ft=o[mt],vt=(o[mt+3]-ft)/BIN_COUNT;if(_<BIN_COUNT/4){const xt=[...sahBins];xt.length=_;let At=0;for(let Et=ut;Et<pt;Et+=6,At++){const Tt=xt[At];Tt.candidate=c[Et+2*mt],Tt.count=0;const{bounds:kt,leftCacheBounds:Dt,rightCacheBounds:zt}=Tt;for(let Bt=0;Bt<3;Bt++)zt[Bt]=1/0,zt[Bt+3]=-1/0,Dt[Bt]=1/0,Dt[Bt+3]=-1/0,kt[Bt]=1/0,kt[Bt+3]=-1/0;expandByTriangleBounds(Et,c,kt)}xt.sort(binsSort);let Ct=_;for(let Et=0;Et<Ct;Et++){const Tt=xt[Et];for(;Et+1<Ct&&xt[Et+1].candidate===Tt.candidate;)xt.splice(Et+1,1),Ct--}for(let Et=ut;Et<pt;Et+=6){const Tt=c[Et+2*mt];for(let kt=0;kt<Ct;kt++){const Dt=xt[kt];Tt>=Dt.candidate?expandByTriangleBounds(Et,c,Dt.rightCacheBounds):(expandByTriangleBounds(Et,c,Dt.leftCacheBounds),Dt.count++)}}for(let Et=0;Et<Ct;Et++){const Tt=xt[Et],kt=Tt.count,Dt=_-Tt.count,zt=Tt.leftCacheBounds,Bt=Tt.rightCacheBounds;let Rt=0;kt!==0&&(Rt=computeSurfaceArea(zt)/nt);let Ut=0;Dt!==0&&(Ut=computeSurfaceArea(Bt)/nt);const Ht=TRAVERSAL_COST+TRIANGLE_INTERSECT_COST*(Rt*kt+Ut*Dt);Ht<at&&(_e=mt,at=Ht,it=Tt.candidate)}}else{for(let Ct=0;Ct<BIN_COUNT;Ct++){const Et=sahBins[Ct];Et.count=0,Et.candidate=ft+vt+Ct*vt;const Tt=Et.bounds;for(let kt=0;kt<3;kt++)Tt[kt]=1/0,Tt[kt+3]=-1/0}for(let Ct=ut;Ct<pt;Ct+=6){let Et=~~((c[Ct+2*mt]-ft)/vt);Et>=BIN_COUNT&&(Et=BIN_COUNT-1);const Tt=sahBins[Et];Tt.count++,expandByTriangleBounds(Ct,c,Tt.bounds)}const xt=sahBins[BIN_COUNT-1];copyBounds(xt.bounds,xt.rightCacheBounds);for(let Ct=BIN_COUNT-2;Ct>=0;Ct--){const Et=sahBins[Ct],Tt=sahBins[Ct+1];unionBounds(Et.bounds,Tt.rightCacheBounds,Et.rightCacheBounds)}let At=0;for(let Ct=0;Ct<BIN_COUNT-1;Ct++){const Et=sahBins[Ct],Tt=Et.count,kt=Et.bounds,Dt=sahBins[Ct+1].rightCacheBounds;Tt!==0&&(At===0?copyBounds(kt,leftBounds):unionBounds(kt,leftBounds,leftBounds)),At+=Tt;let zt=0,Bt=0;At!==0&&(zt=computeSurfaceArea(leftBounds)/nt);const Rt=_-At;Rt!==0&&(Bt=computeSurfaceArea(Dt)/nt);const Ut=TRAVERSAL_COST+TRIANGLE_INTERSECT_COST*(zt*At+Bt*Rt);Ut<at&&(_e=mt,at=Ut,it=Et.candidate)}}}}else console.warn(`MeshBVH: Invalid build strategy value ${b} used.`);return{axis:_e,pos:it}}function getAverage(h,o,c,d){let _=0;for(let b=o,_e=o+c;b<_e;b++)_+=h[6*b+2*d];return _/c}class MeshBVHNode{constructor(){}}function partition(h,o,c,d,_,b){let _e=d,it=d+_-1;const nt=b.pos,at=2*b.axis;for(;;){for(;_e<=it&&c[6*_e+at]<nt;)_e++;for(;_e<=it&&c[6*it+at]>=nt;)it--;if(!(_e<it))return _e;for(let ut=0;ut<3;ut++){let pt=o[3*_e+ut];o[3*_e+ut]=o[3*it+ut],o[3*it+ut]=pt}for(let ut=0;ut<6;ut++){let pt=c[6*_e+ut];c[6*_e+ut]=c[6*it+ut],c[6*it+ut]=pt}_e++,it--}}function partition_indirect(h,o,c,d,_,b){let _e=d,it=d+_-1;const nt=b.pos,at=2*b.axis;for(;;){for(;_e<=it&&c[6*_e+at]<nt;)_e++;for(;_e<=it&&c[6*it+at]>=nt;)it--;if(!(_e<it))return _e;{let ut=h[_e];h[_e]=h[it],h[it]=ut;for(let pt=0;pt<6;pt++){let mt=c[6*_e+pt];c[6*_e+pt]=c[6*it+pt],c[6*it+pt]=mt}_e++,it--}}}function generateIndirectBuffer(h,o){const c=(h.index?h.index.count:h.attributes.position.count)/3,d=c>65536,_=d?4:2,b=o?new SharedArrayBuffer(c*_):new ArrayBuffer(c*_),_e=d?new Uint32Array(b):new Uint16Array(b);for(let it=0,nt=_e.length;it<nt;it++)_e[it]=it;return _e}function buildTree(h,o){const c=h.geometry,d=c.index?c.index.array:null,_=o.maxDepth,b=o.verbose,_e=o.maxLeafTris,it=o.strategy,nt=o.onProgress,at=geometryUtils_getTriCount(c),ut=h._indirectBuffer;let pt=!1;const mt=new Float32Array(6),ft=new Float32Array(6),vt=computeTriangleBounds(c,mt),xt=o.indirect?partition_indirect:partition,At=[],Ct=o.indirect?getFullGeometryRange(c):getRootIndexRanges(c);if(Ct.length===1){const kt=Ct[0],Dt=new MeshBVHNode;Dt.boundingData=mt,getCentroidBounds(vt,kt.offset,kt.count,ft),Tt(Dt,kt.offset,kt.count,ft),At.push(Dt)}else for(let kt of Ct){const Dt=new MeshBVHNode;Dt.boundingData=new Float32Array(6),computeBoundsUtils_getBounds(vt,kt.offset,kt.count,Dt.boundingData,ft),Tt(Dt,kt.offset,kt.count,ft),At.push(Dt)}return At;function Et(kt){nt&&nt(kt/at)}function Tt(kt,Dt,zt,Bt=null,Rt=0){if(!pt&&Rt>=_&&(pt=!0,b&&(console.warn(`MeshBVH: Max depth of ${_} reached when generating BVH. Consider increasing maxDepth.`),console.warn(c))),zt<=_e||Rt>=_)return Et(Dt+zt),kt.offset=Dt,kt.count=zt,kt;const Ut=getOptimalSplit(kt.boundingData,Bt,vt,Dt,zt,it);if(Ut.axis===-1)return Et(Dt+zt),kt.offset=Dt,kt.count=zt,kt;const Ht=xt(ut,d,vt,Dt,zt,Ut);if(Ht===Dt||Ht===Dt+zt)Et(Dt+zt),kt.offset=Dt,kt.count=zt;else{kt.splitAxis=Ut.axis;const Jt=new MeshBVHNode,Kt=Dt,sr=Ht-Dt;kt.left=Jt,Jt.boundingData=new Float32Array(6),computeBoundsUtils_getBounds(vt,Kt,sr,Jt.boundingData,ft),Tt(Jt,Kt,sr,ft,Rt+1);const ir=new MeshBVHNode,cr=Ht,lr=zt-sr;kt.right=ir,ir.boundingData=new Float32Array(6),computeBoundsUtils_getBounds(vt,cr,lr,ir.boundingData,ft),Tt(ir,cr,lr,ft,Rt+1)}return kt}}function buildPackedTree(h,o){const c=h.geometry;o.indirect&&(h._indirectBuffer=generateIndirectBuffer(c,o.useSharedArrayBuffer),hasGroupGaps(c)&&!o.verbose&&console.warn('MeshBVH: Provided geometry contains groups that do not fully span the vertex contents while using the "indirect" option. BVH may incorrectly report intersections on unrendered portions of the geometry.')),h._indirectBuffer||geometryUtils_ensureIndex(c,o);const d=buildTree(h,o);let _,b,_e;const it=[],nt=o.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;for(let pt=0;pt<d.length;pt++){const mt=d[pt];let ft=at(mt);const vt=new nt(BYTES_PER_NODE*ft);_=new Float32Array(vt),b=new Uint32Array(vt),_e=new Uint16Array(vt),ut(0,mt),it.push(vt)}return void(h._roots=it);function at(pt){return pt.count?1:1+at(pt.left)+at(pt.right)}function ut(pt,mt){const ft=pt/4,vt=pt/2,xt=!!mt.count,At=mt.boundingData;for(let Ct=0;Ct<6;Ct++)_[ft+Ct]=At[Ct];if(xt){const Ct=mt.offset,Et=mt.count;return b[ft+6]=Ct,_e[vt+14]=Et,_e[vt+15]=IS_LEAFNODE_FLAG,pt+BYTES_PER_NODE}{const Ct=mt.left,Et=mt.right,Tt=mt.splitAxis;let kt;if(kt=ut(pt+BYTES_PER_NODE,Ct),kt/4>Math.pow(2,32))throw new Error("MeshBVH: Cannot store child pointer greater than 32 bits.");return b[ft+6]=kt/4,kt=ut(kt,Et),b[ft+7]=Tt,kt}}}class OrientedBox{constructor(o,c,d){this.isOrientedBox=!0,this.min=new three_module.Pq0,this.max=new three_module.Pq0,this.matrix=new three_module.kn4,this.invMatrix=new three_module.kn4,this.points=new Array(8).fill().map(()=>new three_module.Pq0),this.satAxes=new Array(3).fill().map(()=>new three_module.Pq0),this.satBounds=new Array(3).fill().map(()=>new SeparatingAxisBounds),this.alignedSatBounds=new Array(3).fill().map(()=>new SeparatingAxisBounds),this.needsUpdate=!1,o&&this.min.copy(o),c&&this.max.copy(c),d&&this.matrix.copy(d)}set(o,c,d){this.min.copy(o),this.max.copy(c),this.matrix.copy(d),this.needsUpdate=!0}copy(o){this.min.copy(o.min),this.max.copy(o.max),this.matrix.copy(o.matrix),this.needsUpdate=!0}}OrientedBox.prototype.update=function(){const h=this.matrix,o=this.min,c=this.max,d=this.points;for(let nt=0;nt<=1;nt++)for(let at=0;at<=1;at++)for(let ut=0;ut<=1;ut++){const pt=d[1*nt|2*at|4*ut];pt.x=nt?c.x:o.x,pt.y=at?c.y:o.y,pt.z=ut?c.z:o.z,pt.applyMatrix4(h)}const _=this.satBounds,b=this.satAxes,_e=d[0];for(let nt=0;nt<3;nt++){const at=b[nt],ut=_[nt],pt=d[1<<nt];at.subVectors(_e,pt),ut.setFromPoints(at,d)}const it=this.alignedSatBounds;it[0].setFromPointsField(d,"x"),it[1].setFromPointsField(d,"y"),it[2].setFromPointsField(d,"z"),this.invMatrix.copy(this.matrix).invert(),this.needsUpdate=!1},OrientedBox.prototype.intersectsBox=function(){const h=new SeparatingAxisBounds;return function(o){this.needsUpdate&&this.update();const c=o.min,d=o.max,_=this.satBounds,b=this.satAxes,_e=this.alignedSatBounds;if(h.min=c.x,h.max=d.x,_e[0].isSeparated(h)||(h.min=c.y,h.max=d.y,_e[1].isSeparated(h))||(h.min=c.z,h.max=d.z,_e[2].isSeparated(h)))return!1;for(let it=0;it<3;it++){const nt=b[it],at=_[it];if(h.setFromBox(nt,o),at.isSeparated(h))return!1}return!0}}(),OrientedBox.prototype.intersectsTriangle=function(){const h=new ExtendedTriangle,o=new Array(3),c=new SeparatingAxisBounds,d=new SeparatingAxisBounds,_=new three_module.Pq0;return function(b){this.needsUpdate&&this.update(),b.isExtendedTriangle?b.needsUpdate&&b.update():(h.copy(b),h.update(),b=h);const _e=this.satBounds,it=this.satAxes;o[0]=b.a,o[1]=b.b,o[2]=b.c;for(let pt=0;pt<3;pt++){const mt=_e[pt],ft=it[pt];if(c.setFromPoints(ft,o),mt.isSeparated(c))return!1}const nt=b.satBounds,at=b.satAxes,ut=this.points;for(let pt=0;pt<3;pt++){const mt=nt[pt],ft=at[pt];if(c.setFromPoints(ft,ut),mt.isSeparated(c))return!1}for(let pt=0;pt<3;pt++){const mt=it[pt];for(let ft=0;ft<4;ft++){const vt=at[ft];if(_.crossVectors(mt,vt),c.setFromPoints(_,o),d.setFromPoints(_,ut),c.isSeparated(d))return!1}}return!0}}(),OrientedBox.prototype.closestPointToPoint=function(h,o){return this.needsUpdate&&this.update(),o.copy(h).applyMatrix4(this.invMatrix).clamp(this.min,this.max).applyMatrix4(this.matrix),o},OrientedBox.prototype.distanceToPoint=function(){const h=new three_module.Pq0;return function(o){return this.closestPointToPoint(o,h),o.distanceTo(h)}}(),OrientedBox.prototype.distanceToBox=function(){const h=["x","y","z"],o=new Array(12).fill().map(()=>new three_module.cZY),c=new Array(12).fill().map(()=>new three_module.cZY),d=new three_module.Pq0,_=new three_module.Pq0;return function(b,_e=0,it=null,nt=null){if(this.needsUpdate&&this.update(),this.intersectsBox(b))return(it||nt)&&(b.getCenter(_),this.closestPointToPoint(_,d),b.closestPointToPoint(d,_),it&&it.copy(d),nt&&nt.copy(_)),0;const at=_e*_e,ut=b.min,pt=b.max,mt=this.points;let ft=1/0;for(let xt=0;xt<8;xt++){const At=mt[xt];_.copy(At).clamp(ut,pt);const Ct=At.distanceToSquared(_);if(Ct<ft&&(ft=Ct,it&&it.copy(At),nt&&nt.copy(_),Ct<at))return Math.sqrt(Ct)}let vt=0;for(let xt=0;xt<3;xt++)for(let At=0;At<=1;At++)for(let Ct=0;Ct<=1;Ct++){const Et=(xt+1)%3,Tt=(xt+2)%3,kt=1<<xt|At<<Et|Ct<<Tt,Dt=mt[At<<Et|Ct<<Tt],zt=mt[kt];o[vt].set(Dt,zt);const Bt=h[xt],Rt=h[Et],Ut=h[Tt],Ht=c[vt],Jt=Ht.start,Kt=Ht.end;Jt[Bt]=ut[Bt],Jt[Rt]=At?ut[Rt]:pt[Rt],Jt[Ut]=Ct?ut[Ut]:pt[Rt],Kt[Bt]=pt[Bt],Kt[Rt]=At?ut[Rt]:pt[Rt],Kt[Ut]=Ct?ut[Ut]:pt[Rt],vt++}for(let xt=0;xt<=1;xt++)for(let At=0;At<=1;At++)for(let Ct=0;Ct<=1;Ct++){_.x=xt?pt.x:ut.x,_.y=At?pt.y:ut.y,_.z=Ct?pt.z:ut.z,this.closestPointToPoint(_,d);const Et=_.distanceToSquared(d);if(Et<ft&&(ft=Et,it&&it.copy(d),nt&&nt.copy(_),Et<at))return Math.sqrt(Et)}for(let xt=0;xt<12;xt++){const At=o[xt];for(let Ct=0;Ct<12;Ct++){const Et=c[Ct];closestPointsSegmentToSegment(At,Et,d,_);const Tt=d.distanceToSquared(_);if(Tt<ft&&(ft=Tt,it&&it.copy(d),nt&&nt.copy(_),Tt<at))return Math.sqrt(Tt)}}return Math.sqrt(ft)}}();class PrimitivePool{constructor(o){this._getNewPrimitive=o,this._primitives=[]}getPrimitive(){const o=this._primitives;return o.length===0?this._getNewPrimitive():o.pop()}releasePrimitive(o){this._primitives.push(o)}}class ExtendedTrianglePoolBase extends PrimitivePool{constructor(){super(()=>new ExtendedTriangle)}}const ExtendedTrianglePool=new ExtendedTrianglePoolBase;function IS_LEAF(h,o){return o[h+15]===65535}function OFFSET(h,o){return o[h+6]}function COUNT(h,o){return o[h+14]}function LEFT_NODE(h){return h+8}function RIGHT_NODE(h,o){return o[h+6]}function SPLIT_AXIS(h,o){return o[h+7]}class _BufferStack{constructor(){this.float32Array=null,this.uint16Array=null,this.uint32Array=null;const o=[];let c=null;this.setBuffer=d=>{c&&o.push(c),c=d,this.float32Array=new Float32Array(d),this.uint16Array=new Uint16Array(d),this.uint32Array=new Uint32Array(d)},this.clearBuffer=()=>{c=null,this.float32Array=null,this.uint16Array=null,this.uint32Array=null,o.length!==0&&this.setBuffer(o.pop())}}}const BufferStack=new _BufferStack;let _box1,_box2;const boxStack=[],boxPool=new PrimitivePool(()=>new three_module.NRn);function shapecast(h,o,c,d,_,b){_box1=boxPool.getPrimitive(),_box2=boxPool.getPrimitive(),boxStack.push(_box1,_box2),BufferStack.setBuffer(h._roots[o]);const _e=shapecastTraverse(0,h.geometry,c,d,_,b);BufferStack.clearBuffer(),boxPool.releasePrimitive(_box1),boxPool.releasePrimitive(_box2),boxStack.pop(),boxStack.pop();const it=boxStack.length;return it>0&&(_box2=boxStack[it-1],_box1=boxStack[it-2]),_e}function shapecastTraverse(h,o,c,d,_=null,b=0,_e=0){const{float32Array:it,uint16Array:nt,uint32Array:at}=BufferStack;let ut=2*h;if(IS_LEAF(ut,nt)){const pt=OFFSET(h,at),mt=COUNT(ut,nt);return arrayToBox(h,it,_box1),d(pt,mt,!1,_e,b+h,_box1)}{let pt=function(Ut){const{uint16Array:Ht,uint32Array:Jt}=BufferStack;let Kt=2*Ut;for(;!IS_LEAF(Kt,Ht);)Kt=2*(Ut=LEFT_NODE(Ut));return OFFSET(Ut,Jt)},mt=function(Ut){const{uint16Array:Ht,uint32Array:Jt}=BufferStack;let Kt=2*Ut;for(;!IS_LEAF(Kt,Ht);)Kt=2*(Ut=RIGHT_NODE(Ut,Jt));return OFFSET(Ut,Jt)+COUNT(Kt,Ht)};const ft=LEFT_NODE(h),vt=RIGHT_NODE(h,at);let xt,At,Ct,Et,Tt=ft,kt=vt;if(_&&(Ct=_box1,Et=_box2,arrayToBox(Tt,it,Ct),arrayToBox(kt,it,Et),xt=_(Ct),At=_(Et),At<xt)){Tt=vt,kt=ft;const Ut=xt;xt=At,At=Ut,Ct=Et}Ct||(Ct=_box1,arrayToBox(Tt,it,Ct));const Dt=c(Ct,IS_LEAF(2*Tt,nt),xt,_e+1,b+Tt);let zt;if(Dt===CONTAINED){const Ut=pt(Tt);zt=d(Ut,mt(Tt)-Ut,!0,_e+1,b+Tt,Ct)}else zt=Dt&&shapecastTraverse(Tt,o,c,d,_,b,_e+1);if(zt)return!0;Et=_box2,arrayToBox(kt,it,Et);const Bt=c(Et,IS_LEAF(2*kt,nt),At,_e+1,b+kt);let Rt;if(Bt===CONTAINED){const Ut=pt(kt);Rt=d(Ut,mt(kt)-Ut,!0,_e+1,b+kt,Et)}else Rt=Bt&&shapecastTraverse(kt,o,c,d,_,b,_e+1);return!!Rt}}const temp=new three_module.Pq0,temp1=new three_module.Pq0;function closestPointToPoint(h,o,c={},d=0,_=1/0){const b=d*d,_e=_*_;let it=1/0,nt=null;if(h.shapecast({boundsTraverseOrder:ut=>(temp.copy(o).clamp(ut.min,ut.max),temp.distanceToSquared(o)),intersectsBounds:(ut,pt,mt)=>mt<it&&mt<_e,intersectsTriangle:(ut,pt)=>{ut.closestPointToPoint(o,temp);const mt=o.distanceToSquared(temp);return mt<it&&(temp1.copy(temp),it=mt,nt=pt),mt<b}}),it===1/0)return null;const at=Math.sqrt(it);return c.point?c.point.copy(temp1):c.point=temp1.clone(),c.distance=at,c.faceIndex=nt,c}const ThreeRayIntersectUtilities_vA=new three_module.Pq0,ThreeRayIntersectUtilities_vB=new three_module.Pq0,ThreeRayIntersectUtilities_vC=new three_module.Pq0,_uvA=new three_module.I9Y,_uvB=new three_module.I9Y,_uvC=new three_module.I9Y,_normalA=new three_module.Pq0,_normalB=new three_module.Pq0,_normalC=new three_module.Pq0,_intersectionPoint=new three_module.Pq0;function checkIntersection(h,o,c,d,_,b){let _e;return _e=b===three_module.hsX?h.intersectTriangle(d,c,o,!0,_):h.intersectTriangle(o,c,d,b!==three_module.$EB,_),_e===null?null:{distance:h.origin.distanceTo(_),point:_.clone()}}function checkBufferGeometryIntersection(h,o,c,d,_,b,_e,it,nt){ThreeRayIntersectUtilities_vA.fromBufferAttribute(o,b),ThreeRayIntersectUtilities_vB.fromBufferAttribute(o,_e),ThreeRayIntersectUtilities_vC.fromBufferAttribute(o,it);const at=checkIntersection(h,ThreeRayIntersectUtilities_vA,ThreeRayIntersectUtilities_vB,ThreeRayIntersectUtilities_vC,_intersectionPoint,nt);if(at){d&&(_uvA.fromBufferAttribute(d,b),_uvB.fromBufferAttribute(d,_e),_uvC.fromBufferAttribute(d,it),at.uv=three_module.lMl.getInterpolation(_intersectionPoint,ThreeRayIntersectUtilities_vA,ThreeRayIntersectUtilities_vB,ThreeRayIntersectUtilities_vC,_uvA,_uvB,_uvC,new three_module.I9Y)),_&&(_uvA.fromBufferAttribute(_,b),_uvB.fromBufferAttribute(_,_e),_uvC.fromBufferAttribute(_,it),at.uv1=three_module.lMl.getInterpolation(_intersectionPoint,ThreeRayIntersectUtilities_vA,ThreeRayIntersectUtilities_vB,ThreeRayIntersectUtilities_vC,_uvA,_uvB,_uvC,new three_module.I9Y)),c&&(_normalA.fromBufferAttribute(c,b),_normalB.fromBufferAttribute(c,_e),_normalC.fromBufferAttribute(c,it),at.normal=three_module.lMl.getInterpolation(_intersectionPoint,ThreeRayIntersectUtilities_vA,ThreeRayIntersectUtilities_vB,ThreeRayIntersectUtilities_vC,_normalA,_normalB,_normalC,new three_module.Pq0),at.normal.dot(h.direction)>0&&at.normal.multiplyScalar(-1));const ut={a:b,b:_e,c:it,normal:new three_module.Pq0,materialIndex:0};three_module.lMl.getNormal(ThreeRayIntersectUtilities_vA,ThreeRayIntersectUtilities_vB,ThreeRayIntersectUtilities_vC,ut.normal),at.face=ut,at.faceIndex=b}return at}function intersectTri(h,o,c,d,_){const b=3*d;let _e=b+0,it=b+1,nt=b+2;const at=h.index;h.index&&(_e=at.getX(_e),it=at.getX(it),nt=at.getX(nt));const{position:ut,normal:pt,uv:mt,uv1:ft}=h.attributes,vt=checkBufferGeometryIntersection(c,ut,pt,mt,ft,_e,it,nt,o);return vt?(vt.faceIndex=d,_&&_.push(vt),vt):null}function setTriangle(h,o,c,d){const _=h.a,b=h.b,_e=h.c;let it=o,nt=o+1,at=o+2;c&&(it=c.getX(it),nt=c.getX(nt),at=c.getX(at)),_.x=d.getX(it),_.y=d.getY(it),_.z=d.getZ(it),b.x=d.getX(nt),b.y=d.getY(nt),b.z=d.getZ(nt),_e.x=d.getX(at),_e.y=d.getY(at),_e.z=d.getZ(at)}new three_module.Pq0;new three_module.Pq0;new three_module.Pq0;new three_module.I9Y;new three_module.I9Y;new three_module.I9Y;function intersectTris(h,o,c,d,_,b){const{geometry:_e,_indirectBuffer:it}=h;for(let nt=d,at=d+_;nt<at;nt++)intersectTri(_e,o,c,nt,b)}function intersectClosestTri(h,o,c,d,_){const{geometry:b,_indirectBuffer:_e}=h;let it=1/0,nt=null;for(let at=d,ut=d+_;at<ut;at++){let pt;pt=intersectTri(b,o,c,at),pt&&pt.distance<it&&(nt=pt,it=pt.distance)}return nt}function iterateOverTriangles(h,o,c,d,_,b,_e){const{geometry:it}=c,{index:nt}=it,at=it.attributes.position;for(let ut=h,pt=o+h;ut<pt;ut++){let mt;if(mt=ut,setTriangle(_e,3*mt,nt,at),_e.needsUpdate=!0,d(_e,mt,_,b))return!0}return!1}function refit(h,o=null){o&&Array.isArray(o)&&(o=new Set(o));const c=h.geometry,d=c.index?c.index.array:null,_=c.attributes.position;let b,_e,it,nt,at=0;const ut=h._roots;for(let mt=0,ft=ut.length;mt<ft;mt++)b=ut[mt],_e=new Uint32Array(b),it=new Uint16Array(b),nt=new Float32Array(b),pt(0,at),at+=b.byteLength;function pt(mt,ft,vt=!1){const xt=2*mt;if(it[xt+15]===IS_LEAFNODE_FLAG){const At=_e[mt+6];let Ct=1/0,Et=1/0,Tt=1/0,kt=-1/0,Dt=-1/0,zt=-1/0;for(let Bt=3*At,Rt=3*(At+it[xt+14]);Bt<Rt;Bt++){let Ut=d[Bt];const Ht=_.getX(Ut),Jt=_.getY(Ut),Kt=_.getZ(Ut);Ht<Ct&&(Ct=Ht),Ht>kt&&(kt=Ht),Jt<Et&&(Et=Jt),Jt>Dt&&(Dt=Jt),Kt<Tt&&(Tt=Kt),Kt>zt&&(zt=Kt)}return(nt[mt+0]!==Ct||nt[mt+1]!==Et||nt[mt+2]!==Tt||nt[mt+3]!==kt||nt[mt+4]!==Dt||nt[mt+5]!==zt)&&(nt[mt+0]=Ct,nt[mt+1]=Et,nt[mt+2]=Tt,nt[mt+3]=kt,nt[mt+4]=Dt,nt[mt+5]=zt,!0)}{const At=mt+8,Ct=_e[mt+6],Et=At+ft,Tt=Ct+ft;let kt=vt,Dt=!1,zt=!1;o?kt||(Dt=o.has(Et),zt=o.has(Tt),kt=!Dt&&!zt):(Dt=!0,zt=!0);const Bt=kt||zt;let Rt=!1;(kt||Dt)&&(Rt=pt(At,ft,kt));let Ut=!1;Bt&&(Ut=pt(Ct,ft,kt));const Ht=Rt||Ut;if(Ht)for(let Jt=0;Jt<3;Jt++){const Kt=At+Jt,sr=Ct+Jt,ir=nt[Kt],cr=nt[Kt+3],lr=nt[sr],hr=nt[sr+3];nt[mt+Jt]=ir<lr?ir:lr,nt[mt+Jt+3]=cr>hr?cr:hr}return Ht}}}const _boundingBox=new three_module.NRn;function intersectRay(h,o,c,d){return arrayToBox(h,o,_boundingBox),c.intersectBox(_boundingBox,d)}const _boxIntersection=new three_module.Pq0;function raycast(h,o,c,d,_){BufferStack.setBuffer(h._roots[o]),_raycast(0,h,c,d,_),BufferStack.clearBuffer()}function _raycast(h,o,c,d,_){const{float32Array:b,uint16Array:_e,uint32Array:it}=BufferStack,nt=2*h;if(IS_LEAF(nt,_e))intersectTris(o,c,d,OFFSET(h,it),COUNT(nt,_e),_);else{const at=LEFT_NODE(h);intersectRay(at,b,d,_boxIntersection)&&_raycast(at,o,c,d,_);const ut=RIGHT_NODE(h,it);intersectRay(ut,b,d,_boxIntersection)&&_raycast(ut,o,c,d,_)}}const raycastFirst_generated_boxIntersection=new three_module.Pq0,_xyzFields=["x","y","z"];function raycastFirst(h,o,c,d){BufferStack.setBuffer(h._roots[o]);const _=_raycastFirst(0,h,c,d);return BufferStack.clearBuffer(),_}function _raycastFirst(h,o,c,d){const{float32Array:_,uint16Array:b,uint32Array:_e}=BufferStack;let it=2*h;if(IS_LEAF(it,b))return intersectClosestTri(o,c,d,OFFSET(h,_e),COUNT(it,b));{const nt=SPLIT_AXIS(h,_e),at=_xyzFields[nt],ut=d.direction[at]>=0;let pt,mt;ut?(pt=LEFT_NODE(h),mt=RIGHT_NODE(h,_e)):(pt=RIGHT_NODE(h,_e),mt=LEFT_NODE(h));const ft=intersectRay(pt,_,d,raycastFirst_generated_boxIntersection)?_raycastFirst(pt,o,c,d):null;if(ft){const xt=ft.point[at];if(ut?xt<=_[mt+nt]:xt>=_[mt+nt+3])return ft}const vt=intersectRay(mt,_,d,raycastFirst_generated_boxIntersection)?_raycastFirst(mt,o,c,d):null;return ft&&vt?ft.distance<=vt.distance?ft:vt:ft||vt||null}}const boundingBox=new three_module.NRn,triangle=new ExtendedTriangle,triangle2=new ExtendedTriangle,invertedMat=new three_module.kn4,obb=new OrientedBox,obb2=new OrientedBox;function intersectsGeometry(h,o,c,d){BufferStack.setBuffer(h._roots[o]);const _=_intersectsGeometry(0,h,c,d);return BufferStack.clearBuffer(),_}function _intersectsGeometry(h,o,c,d,_=null){const{float32Array:b,uint16Array:_e,uint32Array:it}=BufferStack;let nt=2*h;if(_===null&&(c.boundingBox||c.computeBoundingBox(),obb.set(c.boundingBox.min,c.boundingBox.max,d),_=obb),!IS_LEAF(nt,_e)){const at=h+8,ut=it[h+6];return arrayToBox(at,b,boundingBox),_.intersectsBox(boundingBox)&&_intersectsGeometry(at,o,c,d,_)?!0:(arrayToBox(ut,b,boundingBox),!(!_.intersectsBox(boundingBox)||!_intersectsGeometry(ut,o,c,d,_)))}{const at=o.geometry,ut=at.index,pt=at.attributes.position,mt=c.index,ft=c.attributes.position,vt=OFFSET(h,it),xt=COUNT(nt,_e);if(invertedMat.copy(d).invert(),c.boundsTree)return arrayToBox(h,b,obb2),obb2.matrix.copy(invertedMat),obb2.needsUpdate=!0,c.boundsTree.shapecast({intersectsBounds:At=>obb2.intersectsBox(At),intersectsTriangle:At=>{At.a.applyMatrix4(d),At.b.applyMatrix4(d),At.c.applyMatrix4(d),At.needsUpdate=!0;for(let Ct=3*vt,Et=3*(xt+vt);Ct<Et;Ct+=3)if(setTriangle(triangle2,Ct,ut,pt),triangle2.needsUpdate=!0,At.intersectsTriangle(triangle2))return!0;return!1}});for(let At=3*vt,Ct=3*(xt+vt);At<Ct;At+=3){setTriangle(triangle,At,ut,pt),triangle.a.applyMatrix4(invertedMat),triangle.b.applyMatrix4(invertedMat),triangle.c.applyMatrix4(invertedMat),triangle.needsUpdate=!0;for(let Et=0,Tt=mt.count;Et<Tt;Et+=3)if(setTriangle(triangle2,Et,mt,ft),triangle2.needsUpdate=!0,triangle.intersectsTriangle(triangle2))return!0}}}const tempMatrix=new three_module.kn4,closestPointToGeometry_generated_obb=new OrientedBox,closestPointToGeometry_generated_obb2=new OrientedBox,closestPointToGeometry_generated_temp1=new three_module.Pq0,temp2=new three_module.Pq0,temp3=new three_module.Pq0,temp4=new three_module.Pq0;function closestPointToGeometry(h,o,c,d={},_={},b=0,_e=1/0){o.boundingBox||o.computeBoundingBox(),closestPointToGeometry_generated_obb.set(o.boundingBox.min,o.boundingBox.max,c),closestPointToGeometry_generated_obb.needsUpdate=!0;const it=h.geometry,nt=it.attributes.position,at=it.index,ut=o.attributes.position,pt=o.index,mt=ExtendedTrianglePool.getPrimitive(),ft=ExtendedTrianglePool.getPrimitive();let vt=closestPointToGeometry_generated_temp1,xt=temp2,At=null,Ct=null;_&&(At=temp3,Ct=temp4);let Et=1/0,Tt=null,kt=null;return tempMatrix.copy(c).invert(),closestPointToGeometry_generated_obb2.matrix.copy(tempMatrix),h.shapecast({boundsTraverseOrder:Dt=>closestPointToGeometry_generated_obb.distanceToBox(Dt),intersectsBounds:(Dt,zt,Bt)=>Bt<Et&&Bt<_e&&(zt&&(closestPointToGeometry_generated_obb2.min.copy(Dt.min),closestPointToGeometry_generated_obb2.max.copy(Dt.max),closestPointToGeometry_generated_obb2.needsUpdate=!0),!0),intersectsRange:(Dt,zt)=>{if(o.boundsTree)return o.boundsTree.shapecast({boundsTraverseOrder:Bt=>closestPointToGeometry_generated_obb2.distanceToBox(Bt),intersectsBounds:(Bt,Rt,Ut)=>Ut<Et&&Ut<_e,intersectsRange:(Bt,Rt)=>{for(let Ut=Bt,Ht=Bt+Rt;Ut<Ht;Ut++){setTriangle(ft,3*Ut,pt,ut),ft.a.applyMatrix4(c),ft.b.applyMatrix4(c),ft.c.applyMatrix4(c),ft.needsUpdate=!0;for(let Jt=Dt,Kt=Dt+zt;Jt<Kt;Jt++){setTriangle(mt,3*Jt,at,nt),mt.needsUpdate=!0;const sr=mt.distanceToTriangle(ft,vt,At);if(sr<Et&&(xt.copy(vt),Ct&&Ct.copy(At),Et=sr,Tt=Jt,kt=Ut),sr<b)return!0}}}});for(let Bt=0,Rt=geometryUtils_getTriCount(o);Bt<Rt;Bt++){setTriangle(ft,3*Bt,pt,ut),ft.a.applyMatrix4(c),ft.b.applyMatrix4(c),ft.c.applyMatrix4(c),ft.needsUpdate=!0;for(let Ut=Dt,Ht=Dt+zt;Ut<Ht;Ut++){setTriangle(mt,3*Ut,at,nt),mt.needsUpdate=!0;const Jt=mt.distanceToTriangle(ft,vt,At);if(Jt<Et&&(xt.copy(vt),Ct&&Ct.copy(At),Et=Jt,Tt=Ut,kt=Bt),Jt<b)return!0}}}}),ExtendedTrianglePool.releasePrimitive(mt),ExtendedTrianglePool.releasePrimitive(ft),Et===1/0?null:(d.point?d.point.copy(xt):d.point=xt.clone(),d.distance=Et,d.faceIndex=Tt,_&&(_.point?_.point.copy(Ct):_.point=Ct.clone(),_.point.applyMatrix4(tempMatrix),xt.applyMatrix4(tempMatrix),_.distance=xt.sub(_.point).length(),_.faceIndex=kt),d)}function intersectTris_indirect(h,o,c,d,_,b){const{geometry:_e,_indirectBuffer:it}=h;for(let nt=d,at=d+_;nt<at;nt++)intersectTri(_e,o,c,it?it[nt]:nt,b)}function intersectClosestTri_indirect(h,o,c,d,_){const{geometry:b,_indirectBuffer:_e}=h;let it=1/0,nt=null;for(let at=d,ut=d+_;at<ut;at++){let pt;pt=intersectTri(b,o,c,_e?_e[at]:at),pt&&pt.distance<it&&(nt=pt,it=pt.distance)}return nt}function iterateOverTriangles_indirect(h,o,c,d,_,b,_e){const{geometry:it}=c,{index:nt}=it,at=it.attributes.position;for(let ut=h,pt=o+h;ut<pt;ut++){let mt;if(mt=c.resolveTriangleIndex(ut),setTriangle(_e,3*mt,nt,at),_e.needsUpdate=!0,d(_e,mt,_,b))return!0}return!1}function refit_indirect(h,o=null){o&&Array.isArray(o)&&(o=new Set(o));const c=h.geometry,d=c.index?c.index.array:null,_=c.attributes.position;let b,_e,it,nt,at=0;const ut=h._roots;for(let mt=0,ft=ut.length;mt<ft;mt++)b=ut[mt],_e=new Uint32Array(b),it=new Uint16Array(b),nt=new Float32Array(b),pt(0,at),at+=b.byteLength;function pt(mt,ft,vt=!1){const xt=2*mt;if(it[xt+15]===IS_LEAFNODE_FLAG){const At=_e[mt+6];let Ct=1/0,Et=1/0,Tt=1/0,kt=-1/0,Dt=-1/0,zt=-1/0;for(let Bt=At,Rt=At+it[xt+14];Bt<Rt;Bt++){const Ut=3*h.resolveTriangleIndex(Bt);for(let Ht=0;Ht<3;Ht++){let Jt=Ut+Ht;Jt=d?d[Jt]:Jt;const Kt=_.getX(Jt),sr=_.getY(Jt),ir=_.getZ(Jt);Kt<Ct&&(Ct=Kt),Kt>kt&&(kt=Kt),sr<Et&&(Et=sr),sr>Dt&&(Dt=sr),ir<Tt&&(Tt=ir),ir>zt&&(zt=ir)}}return(nt[mt+0]!==Ct||nt[mt+1]!==Et||nt[mt+2]!==Tt||nt[mt+3]!==kt||nt[mt+4]!==Dt||nt[mt+5]!==zt)&&(nt[mt+0]=Ct,nt[mt+1]=Et,nt[mt+2]=Tt,nt[mt+3]=kt,nt[mt+4]=Dt,nt[mt+5]=zt,!0)}{const At=mt+8,Ct=_e[mt+6],Et=At+ft,Tt=Ct+ft;let kt=vt,Dt=!1,zt=!1;o?kt||(Dt=o.has(Et),zt=o.has(Tt),kt=!Dt&&!zt):(Dt=!0,zt=!0);const Bt=kt||zt;let Rt=!1;(kt||Dt)&&(Rt=pt(At,ft,kt));let Ut=!1;Bt&&(Ut=pt(Ct,ft,kt));const Ht=Rt||Ut;if(Ht)for(let Jt=0;Jt<3;Jt++){const Kt=At+Jt,sr=Ct+Jt,ir=nt[Kt],cr=nt[Kt+3],lr=nt[sr],hr=nt[sr+3];nt[mt+Jt]=ir<lr?ir:lr,nt[mt+Jt+3]=cr>hr?cr:hr}return Ht}}}const raycast_indirect_generated_boxIntersection=new three_module.Pq0;function raycast_indirect(h,o,c,d,_){BufferStack.setBuffer(h._roots[o]),raycast_indirect_generated_raycast(0,h,c,d,_),BufferStack.clearBuffer()}function raycast_indirect_generated_raycast(h,o,c,d,_){const{float32Array:b,uint16Array:_e,uint32Array:it}=BufferStack,nt=2*h;if(IS_LEAF(nt,_e))intersectTris_indirect(o,c,d,OFFSET(h,it),COUNT(nt,_e),_);else{const at=LEFT_NODE(h);intersectRay(at,b,d,raycast_indirect_generated_boxIntersection)&&raycast_indirect_generated_raycast(at,o,c,d,_);const ut=RIGHT_NODE(h,it);intersectRay(ut,b,d,raycast_indirect_generated_boxIntersection)&&raycast_indirect_generated_raycast(ut,o,c,d,_)}}const raycastFirst_indirect_generated_boxIntersection=new three_module.Pq0,raycastFirst_indirect_generated_xyzFields=["x","y","z"];function raycastFirst_indirect(h,o,c,d){BufferStack.setBuffer(h._roots[o]);const _=raycastFirst_indirect_generated_raycastFirst(0,h,c,d);return BufferStack.clearBuffer(),_}function raycastFirst_indirect_generated_raycastFirst(h,o,c,d){const{float32Array:_,uint16Array:b,uint32Array:_e}=BufferStack;let it=2*h;if(IS_LEAF(it,b))return intersectClosestTri_indirect(o,c,d,OFFSET(h,_e),COUNT(it,b));{const nt=SPLIT_AXIS(h,_e),at=raycastFirst_indirect_generated_xyzFields[nt],ut=d.direction[at]>=0;let pt,mt;ut?(pt=LEFT_NODE(h),mt=RIGHT_NODE(h,_e)):(pt=RIGHT_NODE(h,_e),mt=LEFT_NODE(h));const ft=intersectRay(pt,_,d,raycastFirst_indirect_generated_boxIntersection)?raycastFirst_indirect_generated_raycastFirst(pt,o,c,d):null;if(ft){const xt=ft.point[at];if(ut?xt<=_[mt+nt]:xt>=_[mt+nt+3])return ft}const vt=intersectRay(mt,_,d,raycastFirst_indirect_generated_boxIntersection)?raycastFirst_indirect_generated_raycastFirst(mt,o,c,d):null;return ft&&vt?ft.distance<=vt.distance?ft:vt:ft||vt||null}}const intersectsGeometry_indirect_generated_boundingBox=new three_module.NRn,intersectsGeometry_indirect_generated_triangle=new ExtendedTriangle,intersectsGeometry_indirect_generated_triangle2=new ExtendedTriangle,intersectsGeometry_indirect_generated_invertedMat=new three_module.kn4,intersectsGeometry_indirect_generated_obb=new OrientedBox,intersectsGeometry_indirect_generated_obb2=new OrientedBox;function intersectsGeometry_indirect(h,o,c,d){BufferStack.setBuffer(h._roots[o]);const _=intersectsGeometry_indirect_generated_intersectsGeometry(0,h,c,d);return BufferStack.clearBuffer(),_}function intersectsGeometry_indirect_generated_intersectsGeometry(h,o,c,d,_=null){const{float32Array:b,uint16Array:_e,uint32Array:it}=BufferStack;let nt=2*h;if(_===null&&(c.boundingBox||c.computeBoundingBox(),intersectsGeometry_indirect_generated_obb.set(c.boundingBox.min,c.boundingBox.max,d),_=intersectsGeometry_indirect_generated_obb),!IS_LEAF(nt,_e)){const at=h+8,ut=it[h+6];return arrayToBox(at,b,intersectsGeometry_indirect_generated_boundingBox),_.intersectsBox(intersectsGeometry_indirect_generated_boundingBox)&&intersectsGeometry_indirect_generated_intersectsGeometry(at,o,c,d,_)?!0:(arrayToBox(ut,b,intersectsGeometry_indirect_generated_boundingBox),!(!_.intersectsBox(intersectsGeometry_indirect_generated_boundingBox)||!intersectsGeometry_indirect_generated_intersectsGeometry(ut,o,c,d,_)))}{const at=o.geometry,ut=at.index,pt=at.attributes.position,mt=c.index,ft=c.attributes.position,vt=OFFSET(h,it),xt=COUNT(nt,_e);if(intersectsGeometry_indirect_generated_invertedMat.copy(d).invert(),c.boundsTree)return arrayToBox(h,b,intersectsGeometry_indirect_generated_obb2),intersectsGeometry_indirect_generated_obb2.matrix.copy(intersectsGeometry_indirect_generated_invertedMat),intersectsGeometry_indirect_generated_obb2.needsUpdate=!0,c.boundsTree.shapecast({intersectsBounds:At=>intersectsGeometry_indirect_generated_obb2.intersectsBox(At),intersectsTriangle:At=>{At.a.applyMatrix4(d),At.b.applyMatrix4(d),At.c.applyMatrix4(d),At.needsUpdate=!0;for(let Ct=vt,Et=xt+vt;Ct<Et;Ct++)if(setTriangle(intersectsGeometry_indirect_generated_triangle2,3*o.resolveTriangleIndex(Ct),ut,pt),intersectsGeometry_indirect_generated_triangle2.needsUpdate=!0,At.intersectsTriangle(intersectsGeometry_indirect_generated_triangle2))return!0;return!1}});for(let At=vt,Ct=xt+vt;At<Ct;At++){const Et=o.resolveTriangleIndex(At);setTriangle(intersectsGeometry_indirect_generated_triangle,3*Et,ut,pt),intersectsGeometry_indirect_generated_triangle.a.applyMatrix4(intersectsGeometry_indirect_generated_invertedMat),intersectsGeometry_indirect_generated_triangle.b.applyMatrix4(intersectsGeometry_indirect_generated_invertedMat),intersectsGeometry_indirect_generated_triangle.c.applyMatrix4(intersectsGeometry_indirect_generated_invertedMat),intersectsGeometry_indirect_generated_triangle.needsUpdate=!0;for(let Tt=0,kt=mt.count;Tt<kt;Tt+=3)if(setTriangle(intersectsGeometry_indirect_generated_triangle2,Tt,mt,ft),intersectsGeometry_indirect_generated_triangle2.needsUpdate=!0,intersectsGeometry_indirect_generated_triangle.intersectsTriangle(intersectsGeometry_indirect_generated_triangle2))return!0}}}const closestPointToGeometry_indirect_generated_tempMatrix=new three_module.kn4,closestPointToGeometry_indirect_generated_obb=new OrientedBox,closestPointToGeometry_indirect_generated_obb2=new OrientedBox,closestPointToGeometry_indirect_generated_temp1=new three_module.Pq0,closestPointToGeometry_indirect_generated_temp2=new three_module.Pq0,closestPointToGeometry_indirect_generated_temp3=new three_module.Pq0,closestPointToGeometry_indirect_generated_temp4=new three_module.Pq0;function closestPointToGeometry_indirect(h,o,c,d={},_={},b=0,_e=1/0){o.boundingBox||o.computeBoundingBox(),closestPointToGeometry_indirect_generated_obb.set(o.boundingBox.min,o.boundingBox.max,c),closestPointToGeometry_indirect_generated_obb.needsUpdate=!0;const it=h.geometry,nt=it.attributes.position,at=it.index,ut=o.attributes.position,pt=o.index,mt=ExtendedTrianglePool.getPrimitive(),ft=ExtendedTrianglePool.getPrimitive();let vt=closestPointToGeometry_indirect_generated_temp1,xt=closestPointToGeometry_indirect_generated_temp2,At=null,Ct=null;_&&(At=closestPointToGeometry_indirect_generated_temp3,Ct=closestPointToGeometry_indirect_generated_temp4);let Et=1/0,Tt=null,kt=null;return closestPointToGeometry_indirect_generated_tempMatrix.copy(c).invert(),closestPointToGeometry_indirect_generated_obb2.matrix.copy(closestPointToGeometry_indirect_generated_tempMatrix),h.shapecast({boundsTraverseOrder:Dt=>closestPointToGeometry_indirect_generated_obb.distanceToBox(Dt),intersectsBounds:(Dt,zt,Bt)=>Bt<Et&&Bt<_e&&(zt&&(closestPointToGeometry_indirect_generated_obb2.min.copy(Dt.min),closestPointToGeometry_indirect_generated_obb2.max.copy(Dt.max),closestPointToGeometry_indirect_generated_obb2.needsUpdate=!0),!0),intersectsRange:(Dt,zt)=>{if(o.boundsTree){const Bt=o.boundsTree;return Bt.shapecast({boundsTraverseOrder:Rt=>closestPointToGeometry_indirect_generated_obb2.distanceToBox(Rt),intersectsBounds:(Rt,Ut,Ht)=>Ht<Et&&Ht<_e,intersectsRange:(Rt,Ut)=>{for(let Ht=Rt,Jt=Rt+Ut;Ht<Jt;Ht++){const Kt=Bt.resolveTriangleIndex(Ht);setTriangle(ft,3*Kt,pt,ut),ft.a.applyMatrix4(c),ft.b.applyMatrix4(c),ft.c.applyMatrix4(c),ft.needsUpdate=!0;for(let sr=Dt,ir=Dt+zt;sr<ir;sr++){const cr=h.resolveTriangleIndex(sr);setTriangle(mt,3*cr,at,nt),mt.needsUpdate=!0;const lr=mt.distanceToTriangle(ft,vt,At);if(lr<Et&&(xt.copy(vt),Ct&&Ct.copy(At),Et=lr,Tt=sr,kt=Ht),lr<b)return!0}}}})}for(let Bt=0,Rt=geometryUtils_getTriCount(o);Bt<Rt;Bt++){setTriangle(ft,3*Bt,pt,ut),ft.a.applyMatrix4(c),ft.b.applyMatrix4(c),ft.c.applyMatrix4(c),ft.needsUpdate=!0;for(let Ut=Dt,Ht=Dt+zt;Ut<Ht;Ut++){const Jt=h.resolveTriangleIndex(Ut);setTriangle(mt,3*Jt,at,nt),mt.needsUpdate=!0;const Kt=mt.distanceToTriangle(ft,vt,At);if(Kt<Et&&(xt.copy(vt),Ct&&Ct.copy(At),Et=Kt,Tt=Ut,kt=Bt),Kt<b)return!0}}}}),ExtendedTrianglePool.releasePrimitive(mt),ExtendedTrianglePool.releasePrimitive(ft),Et===1/0?null:(d.point?d.point.copy(xt):d.point=xt.clone(),d.distance=Et,d.faceIndex=Tt,_&&(_.point?_.point.copy(Ct):_.point=Ct.clone(),_.point.applyMatrix4(closestPointToGeometry_indirect_generated_tempMatrix),xt.applyMatrix4(closestPointToGeometry_indirect_generated_tempMatrix),_.distance=xt.sub(_.point).length(),_.faceIndex=kt),d)}function isSharedArrayBufferSupported(){return typeof SharedArrayBuffer<"u"}const _bufferStack1=new BufferStack.constructor,_bufferStack2=new BufferStack.constructor,_boxPool=new PrimitivePool(()=>new three_module.NRn),_leftBox1=new three_module.NRn,_rightBox1=new three_module.NRn,_leftBox2=new three_module.NRn,_rightBox2=new three_module.NRn;let _active=!1;function bvhcast(h,o,c,d){if(_active)throw new Error("MeshBVH: Recursive calls to bvhcast not supported.");_active=!0;const _=h._roots,b=o._roots;let _e,it=0,nt=0;const at=new three_module.kn4().copy(c).invert();for(let ut=0,pt=_.length;ut<pt;ut++){_bufferStack1.setBuffer(_[ut]),nt=0;const mt=_boxPool.getPrimitive();arrayToBox(0,_bufferStack1.float32Array,mt),mt.applyMatrix4(at);for(let ft=0,vt=b.length;ft<vt&&(_bufferStack2.setBuffer(b[ut]),_e=_traverse(0,0,c,at,d,it,nt,0,0,mt),_bufferStack2.clearBuffer(),nt+=b[ft].length,!_e);ft++);if(_boxPool.releasePrimitive(mt),_bufferStack1.clearBuffer(),it+=_[ut].length,_e)break}return _active=!1,_e}function _traverse(h,o,c,d,_,b=0,_e=0,it=0,nt=0,at=null,ut=!1){let pt,mt;ut?(pt=_bufferStack2,mt=_bufferStack1):(pt=_bufferStack1,mt=_bufferStack2);const ft=pt.float32Array,vt=pt.uint32Array,xt=pt.uint16Array,At=mt.float32Array,Ct=mt.uint32Array,Et=mt.uint16Array,Tt=2*o,kt=IS_LEAF(2*h,xt),Dt=IS_LEAF(Tt,Et);let zt=!1;if(Dt&&kt)zt=ut?_(OFFSET(o,Ct),COUNT(2*o,Et),OFFSET(h,vt),COUNT(2*h,xt),nt,_e+o,it,b+h):_(OFFSET(h,vt),COUNT(2*h,xt),OFFSET(o,Ct),COUNT(2*o,Et),it,b+h,nt,_e+o);else if(Dt){const Bt=_boxPool.getPrimitive();arrayToBox(o,At,Bt),Bt.applyMatrix4(c);const Rt=LEFT_NODE(h),Ut=RIGHT_NODE(h,vt);arrayToBox(Rt,ft,_leftBox1),arrayToBox(Ut,ft,_rightBox1);const Ht=Bt.intersectsBox(_leftBox1),Jt=Bt.intersectsBox(_rightBox1);zt=Ht&&_traverse(o,Rt,d,c,_,_e,b,nt,it+1,Bt,!ut)||Jt&&_traverse(o,Ut,d,c,_,_e,b,nt,it+1,Bt,!ut),_boxPool.releasePrimitive(Bt)}else{const Bt=LEFT_NODE(o),Rt=RIGHT_NODE(o,Ct);arrayToBox(Bt,At,_leftBox2),arrayToBox(Rt,At,_rightBox2);const Ut=at.intersectsBox(_leftBox2),Ht=at.intersectsBox(_rightBox2);if(Ut&&Ht)zt=_traverse(h,Bt,c,d,_,b,_e,it,nt+1,at,ut)||_traverse(h,Rt,c,d,_,b,_e,it,nt+1,at,ut);else if(Ut)if(kt)zt=_traverse(h,Bt,c,d,_,b,_e,it,nt+1,at,ut);else{const Jt=_boxPool.getPrimitive();Jt.copy(_leftBox2).applyMatrix4(c);const Kt=LEFT_NODE(h),sr=RIGHT_NODE(h,vt);arrayToBox(Kt,ft,_leftBox1),arrayToBox(sr,ft,_rightBox1);const ir=Jt.intersectsBox(_leftBox1),cr=Jt.intersectsBox(_rightBox1);zt=ir&&_traverse(Bt,Kt,d,c,_,_e,b,nt,it+1,Jt,!ut)||cr&&_traverse(Bt,sr,d,c,_,_e,b,nt,it+1,Jt,!ut),_boxPool.releasePrimitive(Jt)}else if(Ht)if(kt)zt=_traverse(h,Rt,c,d,_,b,_e,it,nt+1,at,ut);else{const Jt=_boxPool.getPrimitive();Jt.copy(_rightBox2).applyMatrix4(c);const Kt=LEFT_NODE(h),sr=RIGHT_NODE(h,vt);arrayToBox(Kt,ft,_leftBox1),arrayToBox(sr,ft,_rightBox1);const ir=Jt.intersectsBox(_leftBox1),cr=Jt.intersectsBox(_rightBox1);zt=ir&&_traverse(Rt,Kt,d,c,_,_e,b,nt,it+1,Jt,!ut)||cr&&_traverse(Rt,sr,d,c,_,_e,b,nt,it+1,Jt,!ut),_boxPool.releasePrimitive(Jt)}}return zt}const MeshBVH_obb=new OrientedBox,tempBox=new three_module.NRn;class MeshBVH{static serialize(o,c={}){c={cloneBuffers:!0,...c};const d=o.geometry,_=o._roots,b=o._indirectBuffer,_e=d.getIndex();let it;return it=c.cloneBuffers?{roots:_.map(nt=>nt.slice()),index:_e.array.slice(),indirectBuffer:b?b.slice():null}:{roots:_,index:_e.array,indirectBuffer:b},it}static deserialize(o,c,d={}){d={setIndex:!0,indirect:!!o.indirectBuffer,...d};const{index:_,roots:b,indirectBuffer:_e}=o,it=new MeshBVH(c,{...d,[SKIP_GENERATION]:!0});if(it._roots=b,it._indirectBuffer=_e||null,d.setIndex){const nt=c.getIndex();if(nt===null){const at=new three_module.THS(o.index,1,!1);c.setIndex(at)}else nt.array!==_&&(nt.array.set(_),nt.needsUpdate=!0)}return it}get indirect(){return!!this._indirectBuffer}constructor(o,c={}){if(!o.isBufferGeometry)throw new Error("MeshBVH: Only BufferGeometries are supported.");if(o.index&&o.index.isInterleavedBufferAttribute)throw new Error("MeshBVH: InterleavedBufferAttribute is not supported for the index attribute.");if((c=Object.assign({strategy:CENTER,maxDepth:40,maxLeafTris:10,verbose:!0,useSharedArrayBuffer:!1,setBoundingBox:!0,onProgress:null,indirect:!1,[SKIP_GENERATION]:!1},c)).useSharedArrayBuffer&&!isSharedArrayBufferSupported())throw new Error("MeshBVH: SharedArrayBuffer is not available.");this.geometry=o,this._roots=null,this._indirectBuffer=null,c[SKIP_GENERATION]||(buildPackedTree(this,c),!o.boundingBox&&c.setBoundingBox&&(o.boundingBox=this.getBoundingBox(new three_module.NRn)));const{_indirectBuffer:d}=this;this.resolveTriangleIndex=c.indirect?_=>d[_]:_=>_}refit(o=null){return(this.indirect?refit_indirect:refit)(this,o)}traverse(o,c=0){const d=this._roots[c],_=new Uint32Array(d),b=new Uint16Array(d);(function _e(it,nt=0){const at=2*it,ut=b[at+15]===IS_LEAFNODE_FLAG;if(ut){const pt=_[it+6],mt=b[at+14];o(nt,ut,new Float32Array(d,4*it,6),pt,mt)}else{const pt=it+BYTES_PER_NODE/4,mt=_[it+6],ft=_[it+7];o(nt,ut,new Float32Array(d,4*it,6),ft)||(_e(pt,nt+1),_e(mt,nt+1))}})(0)}raycast(o,c=three_module.hB5){const d=this._roots,_=this.geometry,b=[],_e=c.isMaterial,it=Array.isArray(c),nt=_.groups,at=_e?c.side:c,ut=this.indirect?raycast_indirect:raycast;for(let pt=0,mt=d.length;pt<mt;pt++){const ft=it?c[nt[pt].materialIndex].side:at,vt=b.length;if(ut(this,pt,ft,o,b),it){const xt=nt[pt].materialIndex;for(let At=vt,Ct=b.length;At<Ct;At++)b[At].face.materialIndex=xt}}return b}raycastFirst(o,c=three_module.hB5){const d=this._roots,_=this.geometry,b=c.isMaterial,_e=Array.isArray(c);let it=null;const nt=_.groups,at=b?c.side:c,ut=this.indirect?raycastFirst_indirect:raycastFirst;for(let pt=0,mt=d.length;pt<mt;pt++){const ft=ut(this,pt,_e?c[nt[pt].materialIndex].side:at,o);ft!=null&&(it==null||ft.distance<it.distance)&&(it=ft,_e&&(ft.face.materialIndex=nt[pt].materialIndex))}return it}intersectsGeometry(o,c){let d=!1;const _=this._roots,b=this.indirect?intersectsGeometry_indirect:intersectsGeometry;for(let _e=0,it=_.length;_e<it&&(d=b(this,_e,o,c),!d);_e++);return d}shapecast(o){const c=ExtendedTrianglePool.getPrimitive(),d=this.indirect?iterateOverTriangles_indirect:iterateOverTriangles;let{boundsTraverseOrder:_,intersectsBounds:b,intersectsRange:_e,intersectsTriangle:it}=o;if(_e&&it){const pt=_e;_e=(mt,ft,vt,xt,At)=>!!pt(mt,ft,vt,xt,At)||d(mt,ft,this,it,vt,xt,c)}else _e||(_e=it?(pt,mt,ft,vt)=>d(pt,mt,this,it,ft,vt,c):(pt,mt,ft)=>ft);let nt=!1,at=0;const ut=this._roots;for(let pt=0,mt=ut.length;pt<mt;pt++){const ft=ut[pt];if(nt=shapecast(this,pt,b,_e,_,at),nt)break;at+=ft.byteLength}return ExtendedTrianglePool.releasePrimitive(c),nt}bvhcast(o,c,d){let{intersectsRanges:_,intersectsTriangles:b}=d;const _e=ExtendedTrianglePool.getPrimitive(),it=this.geometry.index,nt=this.geometry.attributes.position,at=this.indirect?vt=>{const xt=this.resolveTriangleIndex(vt);setTriangle(_e,3*xt,it,nt)}:vt=>{setTriangle(_e,3*vt,it,nt)},ut=ExtendedTrianglePool.getPrimitive(),pt=o.geometry.index,mt=o.geometry.attributes.position,ft=o.indirect?vt=>{const xt=o.resolveTriangleIndex(vt);setTriangle(ut,3*xt,pt,mt)}:vt=>{setTriangle(ut,3*vt,pt,mt)};if(b){const vt=(xt,At,Ct,Et,Tt,kt,Dt,zt)=>{for(let Bt=Ct,Rt=Ct+Et;Bt<Rt;Bt++){ft(Bt),ut.a.applyMatrix4(c),ut.b.applyMatrix4(c),ut.c.applyMatrix4(c),ut.needsUpdate=!0;for(let Ut=xt,Ht=xt+At;Ut<Ht;Ut++)if(at(Ut),_e.needsUpdate=!0,b(_e,ut,Ut,Bt,Tt,kt,Dt,zt))return!0}return!1};if(_){const xt=_;_=function(At,Ct,Et,Tt,kt,Dt,zt,Bt){return!!xt(At,Ct,Et,Tt,kt,Dt,zt,Bt)||vt(At,Ct,Et,Tt,kt,Dt,zt,Bt)}}else _=vt}return bvhcast(this,o,c,_)}intersectsBox(o,c){return MeshBVH_obb.set(o.min,o.max,c),MeshBVH_obb.needsUpdate=!0,this.shapecast({intersectsBounds:d=>MeshBVH_obb.intersectsBox(d),intersectsTriangle:d=>MeshBVH_obb.intersectsTriangle(d)})}intersectsSphere(o){return this.shapecast({intersectsBounds:c=>o.intersectsBox(c),intersectsTriangle:c=>c.intersectsSphere(o)})}closestPointToGeometry(o,c,d={},_={},b=0,_e=1/0){return(this.indirect?closestPointToGeometry_indirect:closestPointToGeometry)(this,o,c,d,_,b,_e)}closestPointToPoint(o,c={},d=0,_=1/0){return closestPointToPoint(this,o,c,d,_)}getBoundingBox(o){return o.makeEmpty(),this._roots.forEach(c=>{arrayToBox(0,new Float32Array(c),tempBox),o.union(tempBox)}),o}}const HASH_WIDTH=1e-6,HASH_HALF_WIDTH=.5*HASH_WIDTH,HASH_MULTIPLIER=Math.pow(10,-Math.log10(HASH_WIDTH)),HASH_ADDITION=HASH_HALF_WIDTH*HASH_MULTIPLIER;function hashNumber(h){return~~(h*HASH_MULTIPLIER+HASH_ADDITION)}function hashVertex2(h){return`${hashNumber(h.x)},${hashNumber(h.y)}`}function hashVertex3(h){return`${hashNumber(h.x)},${hashNumber(h.y)},${hashNumber(h.z)}`}function hashVertex4(h){return`${hashNumber(h.x)},${hashNumber(h.y)},${hashNumber(h.z)},${hashNumber(h.w)}`}function toNormalizedRay(h,o,c){c.direction.subVectors(o,h).normalize();const d=h.dot(c.direction);return c.origin.copy(h).addScaledVector(c.direction,-d),c}const DEGENERATE_EPSILON=1e-8,_tempVec=new three_module.Pq0;function toTriIndex(h){return~~(h/3)}function toEdgeIndex(h){return h%3}function sortEdgeFunc(h,o){return h.start-o.start}function getProjectedDistance(h,o){return _tempVec.subVectors(o,h.origin).dot(h.direction)}function matchEdges(h,o,c,d=DEGENERATE_EPSILON){h.sort(sortEdgeFunc),o.sort(sortEdgeFunc);for(let it=0;it<h.length;it++){const nt=h[it];for(let at=0;at<o.length;at++){const ut=o[at];if(!(ut.start>nt.end)){if(nt.end<ut.start||ut.end<nt.start)continue;if(nt.start<=ut.start&&nt.end>=ut.end)b(ut.end,nt.end)||h.splice(it+1,0,{start:ut.end,end:nt.end,index:nt.index}),nt.end=ut.start,ut.start=0,ut.end=0;else if(nt.start>=ut.start&&nt.end<=ut.end)b(nt.end,ut.end)||o.splice(at+1,0,{start:nt.end,end:ut.end,index:ut.index}),ut.end=nt.start,nt.start=0,nt.end=0;else if(nt.start<=ut.start&&nt.end<=ut.end){const pt=nt.end;nt.end=ut.start,ut.start=pt}else{if(!(nt.start>=ut.start&&nt.end>=ut.end))throw new Error;{const pt=ut.end;ut.end=nt.start,nt.start=pt}}}if(c.has(nt.index)||c.set(nt.index,[]),c.has(ut.index)||c.set(ut.index,[]),c.get(nt.index).push(ut.index),c.get(ut.index).push(nt.index),_e(ut)&&(o.splice(at,1),at--),_e(nt)){h.splice(it,1),it--;break}}}function _(it){for(let nt=0;nt<it.length;nt++)_e(it[nt])&&(it.splice(nt,1),nt--)}function b(it,nt){return Math.abs(nt-it)<d}function _e(it){return Math.abs(it.end-it.start)<d}_(h),_(o)}const DIST_EPSILON=1e-5,ANGLE_EPSILON=1e-4;class RaySet{constructor(){this._rays=[]}addRay(o){this._rays.push(o)}findClosestRay(o){const c=this._rays,d=o.clone();d.direction.multiplyScalar(-1);let _=1/0,b=null;for(let nt=0,at=c.length;nt<at;nt++){const ut=c[nt];if(_e(ut,o)&&_e(ut,d))continue;const pt=it(ut,o),mt=it(ut,d),ft=Math.min(pt,mt);ft<_&&(_=ft,b=ut)}return b;function _e(nt,at){const ut=nt.origin.distanceTo(at.origin)>DIST_EPSILON;return nt.direction.angleTo(at.direction)>ANGLE_EPSILON||ut}function it(nt,at){const ut=nt.origin.distanceTo(at.origin),pt=nt.direction.angleTo(at.direction);return ut/DIST_EPSILON+pt/ANGLE_EPSILON}}}const _v0=new three_module.Pq0,_v1=new three_module.Pq0,computeDisjointEdges_ray=new three_module.RlV;function computeDisjointEdges(h,o,c){const d=h.attributes,_=h.index,b=d.position,_e=new Map,it=new Map,nt=Array.from(o),at=new RaySet;for(let ut=0,pt=nt.length;ut<pt;ut++){const mt=nt[ut],ft=toTriIndex(mt),vt=toEdgeIndex(mt);let xt,At=3*ft+vt,Ct=3*ft+(vt+1)%3;_&&(At=_.getX(At),Ct=_.getX(Ct)),_v0.fromBufferAttribute(b,At),_v1.fromBufferAttribute(b,Ct),toNormalizedRay(_v0,_v1,computeDisjointEdges_ray);let Et=at.findClosestRay(computeDisjointEdges_ray);Et===null&&(Et=computeDisjointEdges_ray.clone(),at.addRay(Et)),it.has(Et)||it.set(Et,{forward:[],reverse:[],ray:Et}),xt=it.get(Et);let Tt=getProjectedDistance(Et,_v0),kt=getProjectedDistance(Et,_v1);Tt>kt&&([Tt,kt]=[kt,Tt]),computeDisjointEdges_ray.direction.dot(Et.direction)<0?xt.reverse.push({start:Tt,end:kt,index:mt}):xt.forward.push({start:Tt,end:kt,index:mt})}return it.forEach(({forward:ut,reverse:pt},mt)=>{matchEdges(ut,pt,_e,c),ut.length===0&&pt.length===0&&it.delete(mt)}),{disjointConnectivityMap:_e,fragmentMap:it}}const _vec2=new three_module.I9Y,HalfEdgeMap_vec3=new three_module.Pq0,_vec4=new three_module.IUQ,_hashes=["","",""];class HalfEdgeMap{constructor(o=null){this.data=null,this.disjointConnections=null,this.unmatchedDisjointEdges=null,this.unmatchedEdges=-1,this.matchedEdges=-1,this.useDrawRange=!0,this.useAllAttributes=!1,this.matchDisjointEdges=!1,this.degenerateEpsilon=1e-8,o&&this.updateFrom(o)}getSiblingTriangleIndex(o,c){const d=this.data[3*o+c];return d===-1?-1:~~(d/3)}getSiblingEdgeIndex(o,c){const d=this.data[3*o+c];return d===-1?-1:d%3}getDisjointSiblingTriangleIndices(o,c){const d=3*o+c,_=this.disjointConnections.get(d);return _?_.map(b=>~~(b/3)):[]}getDisjointSiblingEdgeIndices(o,c){const d=3*o+c,_=this.disjointConnections.get(d);return _?_.map(b=>b%3):[]}isFullyConnected(){return this.unmatchedEdges===0}updateFrom(o){const{useAllAttributes:c,useDrawRange:d,matchDisjointEdges:_,degenerateEpsilon:b}=this,_e=c?function(Et){let Tt="";for(let kt=0,Dt=at.length;kt<Dt;kt++){const zt=nt[at[kt]];let Bt;switch(zt.itemSize){case 1:Bt=hashNumber(zt.getX(Et));break;case 2:Bt=hashVertex2(_vec2.fromBufferAttribute(zt,Et));break;case 3:Bt=hashVertex3(HalfEdgeMap_vec3.fromBufferAttribute(zt,Et));break;case 4:Bt=hashVertex4(_vec4.fromBufferAttribute(zt,Et))}Tt!==""&&(Tt+="|"),Tt+=Bt}return Tt}:function(Et){return HalfEdgeMap_vec3.fromBufferAttribute(pt,Et),hashVertex3(HalfEdgeMap_vec3)},it=new Map,{attributes:nt}=o,at=c?Object.keys(nt):null,ut=o.index,pt=nt.position;let mt=getTriCount(o);const ft=mt;let vt=0;d&&(vt=o.drawRange.start,o.drawRange.count!==1/0&&(mt=~~(o.drawRange.count/3)));let xt=this.data;(!xt||xt.length<3*ft)&&(xt=new Int32Array(3*ft)),xt.fill(-1);let At=0,Ct=new Set;for(let Et=vt,Tt=3*mt+vt;Et<Tt;Et+=3){const kt=Et;for(let Dt=0;Dt<3;Dt++){let zt=kt+Dt;ut&&(zt=ut.getX(zt)),_hashes[Dt]=_e(zt)}for(let Dt=0;Dt<3;Dt++){const zt=(Dt+1)%3,Bt=_hashes[Dt],Rt=_hashes[zt],Ut=`${Rt}_${Bt}`;if(it.has(Ut)){const Ht=kt+Dt,Jt=it.get(Ut);xt[Ht]=Jt,xt[Jt]=Ht,it.delete(Ut),At+=2,Ct.delete(Jt)}else{const Ht=`${Bt}_${Rt}`,Jt=kt+Dt;it.set(Ht,Jt),Ct.add(Jt)}}}if(_){const{fragmentMap:Et,disjointConnectivityMap:Tt}=computeDisjointEdges(o,Ct,b);Ct.clear(),Et.forEach(({forward:kt,reverse:Dt})=>{kt.forEach(({index:zt})=>Ct.add(zt)),Dt.forEach(({index:zt})=>Ct.add(zt))}),this.unmatchedDisjointEdges=Et,this.disjointConnections=Tt,At=3*mt-Ct.size}this.matchedEdges=At,this.unmatchedEdges=Ct.size,this.data=xt}}class Brush extends three_module.eaF{constructor(...o){super(...o),this.isBrush=!0,this._previousMatrix=new three_module.kn4,this._previousMatrix.elements.fill(0)}markUpdated(){this._previousMatrix.copy(this.matrix)}isDirty(){const{matrix:o,_previousMatrix:c}=this,d=o.elements,_=c.elements;for(let b=0;b<16;b++)if(d[b]!==_[b])return!0;return!1}prepareGeometry(){const o=this.geometry,c=o.attributes,d=areSharedArrayBuffersSupported();if(d)for(const _ in c){const b=c[_];if(b.isInterleavedBufferAttribute)throw new Error("Brush: InterleavedBufferAttributes are not supported.");b.array=convertToSharedArrayBuffer(b.array)}if(o.boundsTree||(ensureIndex(o,{useSharedArrayBuffer:d}),o.boundsTree=new MeshBVH(o,{maxLeafTris:3,indirect:!0,useSharedArrayBuffer:d})),o.halfEdges||(o.halfEdges=new HalfEdgeMap(o)),!o.groupIndices){const _=getTriCount(o),b=new Uint16Array(_),_e=o.groups;for(let it=0,nt=_e.length;it<nt;it++){const{start:at,count:ut}=_e[it];for(let pt=at/3,mt=(at+ut)/3;pt<mt;pt++)b[pt]=it}o.groupIndices=b}}disposeCacheData(){const{geometry:o}=this;o.halfEdges=null,o.boundsTree=null,o.groupIndices=null}}function joinGroups(h){for(let o=0;o<h.length-1;o++){const c=h[o],d=h[o+1];if(c.materialIndex===d.materialIndex){const _=c.start,b=d.start+d.count;d.start=_,d.count=b-_,h.splice(o,1),o--}}}function prepareAttributesData(h,o,c,d){c.clear();const _=h.attributes;for(let b=0,_e=d.length;b<_e;b++){const it=d[b],nt=_[it];c.initializeArray(it,nt.array.constructor,nt.itemSize,nt.normalized)}for(const b in c.attributes)d.includes(b)||c.delete(b);for(const b in o.attributes)d.includes(b)||(o.deleteAttribute(b),o.dispose())}function assignBufferData(h,o,c){let d=!1,_=-1;const b=h.attributes,_e=o.groupAttributes[0];for(const nt in _e){const at=o.getTotalLength(nt),ut=o.getType(nt),pt=o.getItemSize(nt),mt=o.getNormalized(nt);let ft=b[nt];(!ft||ft.array.length<at)&&(ft=new three_module.THS(new ut(at),pt,mt),h.setAttribute(nt,ft),d=!0);let vt=0;for(let xt=0,At=Math.min(c.length,o.groupCount);xt<At;xt++){const Ct=c[xt].index,{array:Et,type:Tt,length:kt}=o.groupAttributes[Ct][nt],Dt=new Tt(Et.buffer,0,kt);ft.array.set(Dt,vt),vt+=Dt.length}ft.needsUpdate=!0,_=at/ft.itemSize}if(h.index){const nt=h.index.array;if(nt.length<_)h.index=null,d=!0;else for(let at=0,ut=nt.length;at<ut;at++)nt[at]=at}let it=0;h.clearGroups();for(let nt=0,at=Math.min(c.length,o.groupCount);nt<at;nt++){const{index:ut,materialIndex:pt}=c[nt],mt=o.getCount(ut);mt!==0&&(h.addGroup(it,mt,pt),it+=mt)}h.setDrawRange(0,_),h.boundsTree=null,d&&h.dispose()}function getMaterialList(h,o){let c=o;return Array.isArray(o)||(c=[],h.forEach(d=>{c[d.materialIndex]=o})),c}class Evaluator{constructor(){this.triangleSplitter=new TriangleSplitter,this.attributeData=[],this.attributes=["position","uv","normal"],this.useGroups=!0,this.consolidateGroups=!0,this.debug=new OperationDebugData}getGroupRanges(o){return this.useGroups&&o.groups.length!==0?o.groups.map(c=>({...c})):[{start:0,count:1/0,materialIndex:0}]}evaluate(o,c,d,_=new Brush){let b=!0;if(Array.isArray(d)||(d=[d]),Array.isArray(_)||(_=[_],b=!1),_.length!==d.length)throw new Error("Evaluator: operations and target array passed as different sizes.");o.prepareGeometry(),c.prepareGeometry();const{triangleSplitter:_e,attributeData:it,attributes:nt,useGroups:at,consolidateGroups:ut,debug:pt}=this;for(;it.length<_.length;)it.push(new TypedAttributeData);_.forEach((Ct,Et)=>{prepareAttributesData(o.geometry,Ct.geometry,it[Et],nt)}),pt.init(),performOperation(o,c,d,_e,it,{useGroups:at}),pt.complete();const mt=this.getGroupRanges(o.geometry),ft=getMaterialList(mt,o.material),vt=this.getGroupRanges(c.geometry),xt=getMaterialList(vt,c.material);vt.forEach(Ct=>Ct.materialIndex+=ft.length);let At=[...mt,...vt].map((Ct,Et)=>({...Ct,index:Et}));if(at){const Ct=[...ft,...xt];ut&&(At=At.map(Tt=>{const kt=Ct[Tt.materialIndex];return Tt.materialIndex=Ct.indexOf(kt),Tt}).sort((Tt,kt)=>Tt.materialIndex-kt.materialIndex));const Et=[];for(let Tt=0,kt=Ct.length;Tt<kt;Tt++){let Dt=!1;for(let zt=0,Bt=At.length;zt<Bt;zt++){const Rt=At[zt];Rt.materialIndex===Tt&&(Dt=!0,Rt.materialIndex=Et.length)}Dt&&Et.push(Ct[Tt])}_.forEach(Tt=>{Tt.material=Et})}else At=[{start:0,count:1/0,index:0,materialIndex:0}],_.forEach(Ct=>{Ct.material=ft[0]});return _.forEach((Ct,Et)=>{const Tt=Ct.geometry;assignBufferData(Tt,it[Et],At),ut&&joinGroups(Tt.groups)}),b?_:_[0]}evaluateHierarchy(o,c=new Brush){o.updateMatrixWorld(!0);const d=(b,_e)=>{const it=b.children;for(let nt=0,at=it.length;nt<at;nt++){const ut=it[nt];ut.isOperationGroup?d(ut,_e):_e(ut)}},_=b=>{const _e=b.children;let it=!1;for(let at=0,ut=_e.length;at<ut;at++){const pt=_e[at];it=_(pt)||it}const nt=b.isDirty();if(nt&&b.markUpdated(),it&&!b.isOperationGroup){let at;return d(b,ut=>{at=at?this.evaluate(at,ut,ut.operation):this.evaluate(b,ut,ut.operation)}),b._cachedGeometry=at.geometry,b._cachedMaterials=at.material,!0}return it||nt};return _(o),c.geometry=o._cachedGeometry,c.material=o._cachedMaterials,c}reset(){this.triangleSplitter.reset()}}var CSGPluginBVH_decorate=function(h,o,c,d){var _,b=arguments.length,_e=b<3?o:d===null?d=Object.getOwnPropertyDescriptor(o,c):d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_e=Reflect.decorate(h,o,c,d);else for(var it=h.length-1;it>=0;it--)(_=h[it])&&(_e=(b<3?_(_e):b>3?_(o,c,_e):_(o,c))||_e);return b>3&&_e&&Object.defineProperty(o,c,_e),_e};const operations={union:ADDITION,subtract:SUBTRACTION,intersect:INTERSECTION,difference:DIFFERENCE};function buildCSGMeshBVH(h,o){const c=new Evaluator;c.useGroups=!0,c.attributes=["position","normal","uv"],h.forEach(b=>{for(const _e of[...c.attributes])b[0].geometry.getAttribute(_e)||c.attributes.splice(c.attributes.indexOf(_e),1)});let d=new Brush(new three_module.bdM(.01,.01,2,2));h.forEach(([b,_e])=>{if(!Object.keys(operations).includes(_e))return void console.error(`Unknown operation ${_e}`);b.updateMatrix(),b.updateMatrixWorld();const it=new Brush;it.geometry=b.geometry,it.material=b.material,b.matrixWorld.decompose(it.position,it.quaternion,it.scale),it.updateMatrix(),it.updateMatrixWorld(),d=c.evaluate(d,it,operations[_e])});const _=d;return _.userData._isCSGMesh=!0,_}let CSGPluginBVH=class extends CSGPluginBase{_buildCSGMesh(h){return buildCSGMeshBVH(h)}};CSGPluginBVH.PluginType="CSGPluginBVH",CSGPluginBVH=CSGPluginBVH_decorate([uiFolder("CSG Plugin (BVH)")],CSGPluginBVH);class ACameraControlsPlugin extends AViewerPlugin{constructor(){super(...arguments),this.enabled=!0,this.toJSON=void 0,this._cameraChanged=o=>{var c,d,_,b;(d=(c=o.lastCamera)===null||c===void 0?void 0:c.removeControlsCtor)===null||d===void 0||d.call(c,this.controlsKey),(b=(_=o.camera)===null||_===void 0?void 0:_.setControlsCtor)===null||b===void 0||b.call(_,this.controlsKey,this._controlsCtor)}}async onAdded(o){await super.onAdded(o),this._cameraChanged({camera:o.scene.activeCamera}),o.scene.addEventListener("activeCameraChange",this._cameraChanged)}async onRemove(o){return this._cameraChanged({lastCamera:o.scene.activeCamera}),o.scene.removeEventListener("activeCameraChange",this._cameraChanged),super.onRemove(o)}}var DeviceOrientationControl_decorate=function(h,o,c,d){var _,b=arguments.length,_e=b<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_e=Reflect.decorate(h,o,c,d);else for(var it=h.length-1;it>=0;it--)(_=h[it])&&(_e=(b<3?_(_e):b>3?_(o,c,_e):_(o,c))||_e);return b>3&&_e&&Object.defineProperty(o,c,_e),_e};const _zee=new three_module.Pq0(0,0,1),_euler=new three_module.O9p,_q0=new three_module.PTz,_q1=new three_module.PTz(-Math.sqrt(.5),0,0,Math.sqrt(.5)),_q2=new three_module.PTz,DeviceOrientationControl_changeEvent={type:"change"},EPS=1e-6;let DeviceOrientationControls2=class extends three_module.Qev{constructor(h){super(),this.enabled=!1,this.lastOrder="XYZ",this.dampingFactor=.05,this.lastQuaternion=new three_module.PTz,this.onDeviceOrientationChangeEvent=o=>{this.deviceOrientation=o},this.onScreenOrientationChangeEvent=()=>{this.screenOrientation=screen.orientation},this._initQuaternion=new three_module.PTz,this._initQuaternionInvert=new three_module.PTz,this._initQuaternionDest=new three_module.PTz,this._lastTime=-1,window.isSecureContext===!1&&console.error("DeviceOrientationControls2: DeviceOrientationEvent is only available in secure contexts (https)"),this.object=h,this.lastOrder=this.object.rotation.order,this.object.rotation.reorder("YXZ"),this.connect()}connect(){this.onScreenOrientationChangeEvent(),window.DeviceOrientationEvent!==void 0&&typeof window.DeviceOrientationEvent.requestPermission=="function"?window.DeviceOrientationEvent.requestPermission().then(h=>{h=="granted"&&(window.addEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.addEventListener("deviceorientation",this.onDeviceOrientationChangeEvent))}).catch(h=>{console.error("DeviceOrientationControls2: Unable to use DeviceOrientation API:",h)}):(window.addEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.addEventListener("deviceorientation",this.onDeviceOrientationChangeEvent)),this.enabled=!0,this._initQuaternion.copy(this.object.quaternion),this._initQuaternionInvert.copy(this.object.quaternion).invert()}disconnect(){window.removeEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.removeEventListener("deviceorientation",this.onDeviceOrientationChangeEvent),this._initQuaternion.identity(),this._initQuaternionInvert.identity(),this._initQuaternionDest=new three_module.PTz,this.object.rotation.reorder(this.lastOrder),this.lastOrder="XYZ",this.enabled=!1}update(){if(!this.enabled)return;const h=this.deviceOrientation;if(h){const o=h.alpha!==null?three_module.cj9.degToRad(h.alpha):0,c=h.beta!==null?three_module.cj9.degToRad(h.beta):0,d=h.gamma!==null?three_module.cj9.degToRad(h.gamma):0,_=this.screenOrientation?three_module.cj9.degToRad(this.screenOrientation.angle):0;this.setObjectQuaternion(o,c,d,_),8*(1-this.lastQuaternion.dot(this.object.quaternion))>EPS&&(this.lastQuaternion.copy(this.object.quaternion),this.dispatchEvent(DeviceOrientationControl_changeEvent))}}dispose(){this.disconnect()}setObjectQuaternion(h,o,c,d){const _=g()/1e3;_euler.set(o,h,-c,"YXZ"),_q2.setFromEuler(_euler),_q2.multiply(_q1),_q2.multiply(_q0.setFromAxisAngle(_zee,-d)),this._initQuaternionDest.__init||(this._initQuaternionDest.copy(_q2).invert(),this._initQuaternionDest.__init=!0),_q2.premultiply(this._initQuaternionDest),this.object.quaternion.slerp(_q2,this.dampingFactor/(Math.min(1,_-this._lastTime)/(1/60))),this._lastTime=_}};DeviceOrientationControl_decorate([serialize(),uiSlider("Damping",[0,1],.01)],DeviceOrientationControls2.prototype,"dampingFactor",void 0),DeviceOrientationControls2=DeviceOrientationControl_decorate([uiPanel("Device Orientation Controls")],DeviceOrientationControls2);class DeviceOrientationControlsPlugin extends ACameraControlsPlugin{constructor(){super(...arguments),this.controlsKey="deviceOrientation",this._controlsCtor=(o,c)=>new DeviceOrientationControls2(o)}}DeviceOrientationControlsPlugin.PluginType="DeviceOrientationControlsPlugin";var FirstPersonControls2_decorate=function(h,o,c,d){var _,b=arguments.length,_e=b<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_e=Reflect.decorate(h,o,c,d);else for(var it=h.length-1;it>=0;it--)(_=h[it])&&(_e=(b<3?_(_e):b>3?_(o,c,_e):_(o,c))||_e);return b>3&&_e&&Object.defineProperty(o,c,_e),_e};const _lookDirection=new three_module.Pq0,_spherical=new three_module.YHV,_target=new three_module.Pq0,FirstPersonControls2_changeEvent={type:"change"};let FirstPersonControls2=class extends three_module.Qev{constructor(h,o){super(),this.enabled=!0,this.enableKeys=!0,this.movementSpeed=1,this.lookSpeed=.005,this.lookVertical=!0,this.autoForward=!1,this.activeLook=!0,this.heightSpeed=!1,this.heightCoef=1,this.heightMin=0,this.heightMax=1,this.constrainVertical=!1,this.verticalMin=0,this.verticalMax=Math.PI,this.mouseDragOn=!1,this.autoSpeedFactor=0,this.pointerX=0,this.pointerY=0,this.moveForward=!1,this.moveBackward=!1,this.moveLeft=!1,this.moveRight=!1,this.moveUp=!1,this.moveDown=!1,this.viewHalfX=0,this.viewHalfY=0,this.lat=0,this.lon=0,this.targetPosition=new three_module.Pq0,this._lastTime=-1,this.object=h,this.domElement=o,this.onPointerMove=this.onPointerMove.bind(this),this.onPointerDown=this.onPointerDown.bind(this),this.onPointerUp=this.onPointerUp.bind(this),this.onKeyDown=this.onKeyDown.bind(this),this.onKeyUp=this.onKeyUp.bind(this),this.onContextMenu=this.onContextMenu.bind(this),this.domElement.addEventListener("contextmenu",this.onContextMenu),this.domElement.addEventListener("pointermove",this.onPointerMove),this.domElement.addEventListener("pointerdown",this.onPointerDown),this.domElement.addEventListener("pointerup",this.onPointerUp),window.addEventListener("keydown",this.onKeyDown),window.addEventListener("keyup",this.onKeyUp),this.handleResize(),this.setOrientation()}setOrientation(){const h=this.object.quaternion;_lookDirection.set(0,0,-1).applyQuaternion(h),_spherical.setFromVector3(_lookDirection),this.lat=90-three_module.cj9.radToDeg(_spherical.phi),this.lon=three_module.cj9.radToDeg(_spherical.theta)}handleResize(){this.domElement===document?(this.viewHalfX=window.innerWidth/2,this.viewHalfY=window.innerHeight/2):(this.viewHalfX=this.domElement.offsetWidth/2,this.viewHalfY=this.domElement.offsetHeight/2)}onPointerDown(h){if(this.domElement!==document&&this.domElement.focus(),this.activeLook)switch(h.button){case 0:this.moveForward=!0;break;case 2:this.moveBackward=!0}this.mouseDragOn=!0}onPointerUp(h){if(this.activeLook)switch(h.button){case 0:this.moveForward=!1;break;case 2:this.moveBackward=!1}this.mouseDragOn=!1}onPointerMove(h){this.domElement===document?(this.pointerX=h.pageX-this.viewHalfX,this.pointerY=h.pageY-this.viewHalfY):(this.pointerX=h.pageX-this.domElement.offsetLeft-this.viewHalfX,this.pointerY=h.pageY-this.domElement.offsetTop-this.viewHalfY)}onKeyDown(h){if(this.enableKeys)switch(h.code){case"ArrowUp":case"KeyW":this.moveForward=!0;break;case"ArrowLeft":case"KeyA":this.moveLeft=!0;break;case"ArrowDown":case"KeyS":this.moveBackward=!0;break;case"ArrowRight":case"KeyD":this.moveRight=!0;break;case"KeyR":this.moveUp=!0;break;case"KeyF":this.moveDown=!0}}onKeyUp(h){if(this.enableKeys)switch(h.code){case"ArrowUp":case"KeyW":this.moveForward=!1;break;case"ArrowLeft":case"KeyA":this.moveLeft=!1;break;case"ArrowDown":case"KeyS":this.moveBackward=!1;break;case"ArrowRight":case"KeyD":this.moveRight=!1;break;case"KeyR":this.moveUp=!1;break;case"KeyF":this.moveDown=!1}}lookAt(h,o,c){return h.isVector3?_target.copy(h):o===void 0||c===void 0?console.error("FirstPersonControls2.lookAt: y and z parameters are required"):_target.set(h,o,c),this.object.lookAt(_target),this.setOrientation(),this}update(){const h=g(),o=(this._lastTime<0?16:Math.min(h-this._lastTime,1e3))/1e3;if(this._lastTime=h,!this.enabled)return;if(this.heightSpeed){const nt=three_module.cj9.clamp(this.object.position.y,this.heightMin,this.heightMax)-this.heightMin;this.autoSpeedFactor=o*(nt*this.heightCoef)}else this.autoSpeedFactor=0;const c=o*this.movementSpeed;(this.moveForward||this.autoForward&&!this.moveBackward)&&this.object.translateZ(-(c+this.autoSpeedFactor)),this.moveBackward&&this.object.translateZ(c),this.moveLeft&&this.object.translateX(-c),this.moveRight&&this.object.translateX(c),this.moveUp&&this.object.translateY(c),this.moveDown&&this.object.translateY(-c);let d=o*this.lookSpeed;this.activeLook||(d=0);let _=1;this.constrainVertical&&(_=Math.PI/(this.verticalMax-this.verticalMin)),this.lon-=this.pointerX*d,this.lookVertical&&(this.lat-=this.pointerY*d*_),this.lat=Math.max(-85,Math.min(85,this.lat));let b=three_module.cj9.degToRad(90-this.lat);const _e=three_module.cj9.degToRad(this.lon);this.constrainVertical&&(b=three_module.cj9.mapLinear(b,0,Math.PI,this.verticalMin,this.verticalMax));const it=this.object.position;this.targetPosition.setFromSphericalCoords(1,b,_e).add(it),this.object.lookAt(this.targetPosition),this.dispatchEvent(FirstPersonControls2_changeEvent)}dispose(){this.domElement.removeEventListener("contextmenu",this.onContextMenu),this.domElement.removeEventListener("pointerdown",this.onPointerDown),this.domElement.removeEventListener("pointermove",this.onPointerMove),this.domElement.removeEventListener("pointerup",this.onPointerUp),window.removeEventListener("keydown",this.onKeyDown),window.removeEventListener("keyup",this.onKeyUp)}onContextMenu(h){this.enableKeys&&h.preventDefault()}};FirstPersonControls2_decorate([serialize(),uiToggle()],FirstPersonControls2.prototype,"enabled",void 0),FirstPersonControls2_decorate([serialize(),uiToggle()],FirstPersonControls2.prototype,"enableKeys",void 0),FirstPersonControls2_decorate([serialize(),uiInput()],FirstPersonControls2.prototype,"movementSpeed",void 0),FirstPersonControls2_decorate([serialize(),uiInput()],FirstPersonControls2.prototype,"lookSpeed",void 0),FirstPersonControls2_decorate([serialize(),uiToggle()],FirstPersonControls2.prototype,"lookVertical",void 0),FirstPersonControls2_decorate([serialize(),uiToggle()],FirstPersonControls2.prototype,"autoForward",void 0),FirstPersonControls2_decorate([serialize(),uiToggle()],FirstPersonControls2.prototype,"activeLook",void 0),FirstPersonControls2_decorate([serialize(),uiToggle()],FirstPersonControls2.prototype,"heightSpeed",void 0),FirstPersonControls2_decorate([serialize(),uiInput()],FirstPersonControls2.prototype,"heightCoef",void 0),FirstPersonControls2_decorate([serialize(),uiInput()],FirstPersonControls2.prototype,"heightMin",void 0),FirstPersonControls2_decorate([serialize(),uiInput()],FirstPersonControls2.prototype,"heightMax",void 0),FirstPersonControls2_decorate([serialize(),uiToggle()],FirstPersonControls2.prototype,"constrainVertical",void 0),FirstPersonControls2_decorate([serialize(),uiInput()],FirstPersonControls2.prototype,"verticalMin",void 0),FirstPersonControls2_decorate([serialize(),uiInput()],FirstPersonControls2.prototype,"verticalMax",void 0),FirstPersonControls2_decorate([serialize(),uiToggle()],FirstPersonControls2.prototype,"mouseDragOn",void 0),FirstPersonControls2=FirstPersonControls2_decorate([uiFolder("First Person Controls")],FirstPersonControls2);class FirstPersonControlsPlugin extends ACameraControlsPlugin{constructor(){super(...arguments),this.controlsKey="firstPerson",this._controlsCtor=(o,c)=>new FirstPersonControls2(o,c)}}FirstPersonControlsPlugin.PluginType="FirstPersonControlsPlugin";var PointerLockControls2_decorate=function(h,o,c,d){var _,b=arguments.length,_e=b<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_e=Reflect.decorate(h,o,c,d);else for(var it=h.length-1;it>=0;it--)(_=h[it])&&(_e=(b<3?_(_e):b>3?_(o,c,_e):_(o,c))||_e);return b>3&&_e&&Object.defineProperty(o,c,_e),_e};const PointerLockControls2_euler=new three_module.O9p(0,0,0,"YXZ"),PointerLockControls2_vector=new three_module.Pq0,PointerLockControls2_changeEvent={type:"change"},_lockEvent={type:"lock"},_unlockEvent={type:"unlock"},_PI_2=Math.PI/2;let PointerLockControls2=class extends three_module.Qev{constructor(h,o){super(),this.isLocked=!1,this.enabled=!0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.pointerSpeed=1,this.autoLockOnClick=!0,this._movementX=0,this._movementY=0,this._forwardDirection=new three_module.Pq0(0,0,-1),this.domElement=o,this.object=h,this.onElementClick=this.onElementClick.bind(this),this.onMouseMove=this.onMouseMove.bind(this),this.onPointerlockChange=this.onPointerlockChange.bind(this),this.onPointerlockError=this.onPointerlockError.bind(this),this.connect()}onElementClick(h){this.isLocked||this.autoLockOnClick&&(h.preventDefault(),this.lock())}onMouseMove(h){this.isLocked&&(this._movementX+=h.movementX||h.mozMovementX||h.webkitMovementX||0,this._movementY+=h.movementY||h.mozMovementY||h.webkitMovementY||0)}onPointerlockChange(){this.domElement.ownerDocument.pointerLockElement===this.domElement?(this.dispatchEvent(_lockEvent),this.isLocked=!0):(this.dispatchEvent(_unlockEvent),this.isLocked=!1)}onPointerlockError(){console.error("THREE.PointerLockControls: Unable to use Pointer Lock API")}connect(){this.domElement.ownerDocument.addEventListener("mousemove",this.onMouseMove),this.domElement.ownerDocument.addEventListener("pointerlockchange",this.onPointerlockChange),this.domElement.ownerDocument.addEventListener("pointerlockerror",this.onPointerlockError),this.domElement.addEventListener("click",this.onElementClick)}disconnect(){this.domElement.ownerDocument.removeEventListener("mousemove",this.onMouseMove),this.domElement.ownerDocument.removeEventListener("pointerlockchange",this.onPointerlockChange),this.domElement.ownerDocument.removeEventListener("pointerlockerror",this.onPointerlockError),this.domElement.removeEventListener("click",this.onElementClick)}dispose(){this.disconnect()}getDirection(h){return h.copy(this._forwardDirection).applyQuaternion(this.object.quaternion)}moveForward(h){PointerLockControls2_vector.setFromMatrixColumn(this.object.matrix,0),PointerLockControls2_vector.crossVectors(this.object.up,PointerLockControls2_vector),this.object.position.addScaledVector(PointerLockControls2_vector,h)}moveRight(h){PointerLockControls2_vector.setFromMatrixColumn(this.object.matrix,0),this.object.position.addScaledVector(PointerLockControls2_vector,h)}lock(){this.domElement.requestPointerLock()}unlock(){this.domElement.ownerDocument.exitPointerLock()}update(){Math.abs(this._movementX)<1e-4&&Math.abs(this._movementY)<1e-4||(PointerLockControls2_euler.setFromQuaternion(this.object.quaternion),PointerLockControls2_euler.y-=.002*this._movementX*this.pointerSpeed,PointerLockControls2_euler.x-=.002*this._movementY*this.pointerSpeed,this._movementX=0,this._movementY=0,PointerLockControls2_euler.x=Math.max(_PI_2-this.maxPolarAngle,Math.min(_PI_2-this.minPolarAngle,PointerLockControls2_euler.x)),this.object.quaternion.setFromEuler(PointerLockControls2_euler),this.dispatchEvent(PointerLockControls2_changeEvent))}};PointerLockControls2_decorate([uiToggle(),serialize()],PointerLockControls2.prototype,"enabled",void 0),PointerLockControls2_decorate([uiInput(),serialize()],PointerLockControls2.prototype,"minPolarAngle",void 0),PointerLockControls2_decorate([uiInput(),serialize()],PointerLockControls2.prototype,"maxPolarAngle",void 0),PointerLockControls2_decorate([uiInput(),serialize()],PointerLockControls2.prototype,"pointerSpeed",void 0),PointerLockControls2_decorate([uiToggle(),serialize()],PointerLockControls2.prototype,"autoLockOnClick",void 0),PointerLockControls2=PointerLockControls2_decorate([uiPanel("Pointer Lock Controls")],PointerLockControls2);class PointerLockControlsPlugin extends ACameraControlsPlugin{constructor(){super(...arguments),this.controlsKey="pointerLock",this._controlsCtor=(o,c)=>new PointerLockControls2(o,c.ownerDocument?c:c.documentElement)}}PointerLockControlsPlugin.PluginType="PointerLockControlsPlugin";const TrackballControls_changeEvent={type:"change"},TrackballControls_startEvent={type:"start"},TrackballControls_endEvent={type:"end"};class TrackballControls extends three_module.Qev{constructor(o,c){super();const d=this,_=-1;this.object=o,this.domElement=c,this.domElement.style.touchAction="none",this.enabled=!0,this.screen={left:0,top:0,width:0,height:0},this.rotateSpeed=1,this.zoomSpeed=1.2,this.panSpeed=.3,this.noRotate=!1,this.noZoom=!1,this.noPan=!1,this.staticMoving=!1,this.dynamicDampingFactor=.2,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.keys=["KeyA","KeyS","KeyD"],this.mouseButtons={LEFT:three_module.kBv.ROTATE,MIDDLE:three_module.kBv.DOLLY,RIGHT:three_module.kBv.PAN},this.target=new three_module.Pq0;const b=1e-6,_e=new three_module.Pq0;let it=1,nt=_,at=_,ut=0,pt=0,mt=0;const ft=new three_module.Pq0,vt=new three_module.I9Y,xt=new three_module.I9Y,At=new three_module.Pq0,Ct=new three_module.I9Y,Et=new three_module.I9Y,Tt=new three_module.I9Y,kt=new three_module.I9Y,Dt=[],zt={};this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.up0=this.object.up.clone(),this.zoom0=this.object.zoom,this.handleResize=function(){const pr=d.domElement.getBoundingClientRect(),ur=d.domElement.ownerDocument.documentElement;d.screen.left=pr.left+window.pageXOffset-ur.clientLeft,d.screen.top=pr.top+window.pageYOffset-ur.clientTop,d.screen.width=pr.width,d.screen.height=pr.height};const Bt=function(){const pr=new three_module.I9Y;return function(ur,xr){return pr.set((ur-d.screen.left)/d.screen.width,(xr-d.screen.top)/d.screen.height),pr}}(),Rt=function(){const pr=new three_module.I9Y;return function(ur,xr){return pr.set((ur-.5*d.screen.width-d.screen.left)/(.5*d.screen.width),(d.screen.height+2*(d.screen.top-xr))/d.screen.width),pr}}();function Ut(pr){d.enabled!==!1&&(Dt.length===0&&(d.domElement.setPointerCapture(pr.pointerId),d.domElement.addEventListener("pointermove",Ht),d.domElement.addEventListener("pointerup",Jt)),function(ur){Dt.push(ur)}(pr),pr.pointerType==="touch"?function(ur){if(dr(ur),Dt.length===1)nt=3,xt.copy(Rt(Dt[0].pageX,Dt[0].pageY)),vt.copy(xt);else{nt=4;const xr=Dt[0].pageX-Dt[1].pageX,vr=Dt[0].pageY-Dt[1].pageY;pt=ut=Math.sqrt(xr*xr+vr*vr);const Dr=(Dt[0].pageX+Dt[1].pageX)/2,_r=(Dt[0].pageY+Dt[1].pageY)/2;Tt.copy(Bt(Dr,_r)),kt.copy(Tt)}d.dispatchEvent(TrackballControls_startEvent)}(pr):function(ur){if(nt===_)switch(ur.button){case d.mouseButtons.LEFT:nt=0;break;case d.mouseButtons.MIDDLE:nt=1;break;case d.mouseButtons.RIGHT:nt=2}const xr=at!==_?at:nt;xr!==0||d.noRotate?xr!==1||d.noZoom?xr!==2||d.noPan||(Tt.copy(Bt(ur.pageX,ur.pageY)),kt.copy(Tt)):(Ct.copy(Bt(ur.pageX,ur.pageY)),Et.copy(Ct)):(xt.copy(Rt(ur.pageX,ur.pageY)),vt.copy(xt)),d.dispatchEvent(TrackballControls_startEvent)}(pr))}function Ht(pr){d.enabled!==!1&&(pr.pointerType==="touch"?function(ur){if(dr(ur),Dt.length===1)vt.copy(xt),xt.copy(Rt(ur.pageX,ur.pageY));else{const xr=function(mr){const Rr=mr.pointerId===Dt[0].pointerId?Dt[1]:Dt[0];return zt[Rr.pointerId]}(ur),vr=ur.pageX-xr.x,Dr=ur.pageY-xr.y;pt=Math.sqrt(vr*vr+Dr*Dr);const _r=(ur.pageX+xr.x)/2,rr=(ur.pageY+xr.y)/2;kt.copy(Bt(_r,rr))}}(pr):function(ur){const xr=at!==_?at:nt;xr!==0||d.noRotate?xr!==1||d.noZoom?xr!==2||d.noPan||kt.copy(Bt(ur.pageX,ur.pageY)):Et.copy(Bt(ur.pageX,ur.pageY)):(vt.copy(xt),xt.copy(Rt(ur.pageX,ur.pageY)))}(pr))}function Jt(pr){d.enabled!==!1&&(pr.pointerType==="touch"?function(ur){switch(Dt.length){case 0:nt=_;break;case 1:nt=3,xt.copy(Rt(ur.pageX,ur.pageY)),vt.copy(xt);break;case 2:nt=4;for(let xr=0;xr<Dt.length;xr++)if(Dt[xr].pointerId!==ur.pointerId){const vr=zt[Dt[xr].pointerId];xt.copy(Rt(vr.x,vr.y)),vt.copy(xt);break}}d.dispatchEvent(TrackballControls_endEvent)}(pr):(nt=_,d.dispatchEvent(TrackballControls_endEvent)),hr(pr),Dt.length===0&&(d.domElement.releasePointerCapture(pr.pointerId),d.domElement.removeEventListener("pointermove",Ht),d.domElement.removeEventListener("pointerup",Jt)))}function Kt(pr){hr(pr)}function sr(pr){d.enabled!==!1&&(window.removeEventListener("keydown",sr),at===_&&(pr.code!==d.keys[0]||d.noRotate?pr.code!==d.keys[1]||d.noZoom?pr.code!==d.keys[2]||d.noPan||(at=2):at=1:at=0))}function ir(){d.enabled!==!1&&(at=_,window.addEventListener("keydown",sr))}function cr(pr){if(d.enabled!==!1&&d.noZoom!==!0){switch(pr.preventDefault(),pr.deltaMode){case 2:Ct.y-=.025*pr.deltaY;break;case 1:Ct.y-=.01*pr.deltaY;break;default:Ct.y-=25e-5*pr.deltaY}d.dispatchEvent(TrackballControls_startEvent),d.dispatchEvent(TrackballControls_endEvent)}}function lr(pr){d.enabled!==!1&&pr.preventDefault()}function hr(pr){delete zt[pr.pointerId];for(let ur=0;ur<Dt.length;ur++)if(Dt[ur].pointerId==pr.pointerId)return void Dt.splice(ur,1)}function dr(pr){let ur=zt[pr.pointerId];ur===void 0&&(ur=new three_module.I9Y,zt[pr.pointerId]=ur),ur.set(pr.pageX,pr.pageY)}this.rotateCamera=function(){const pr=new three_module.Pq0,ur=new three_module.PTz,xr=new three_module.Pq0,vr=new three_module.Pq0,Dr=new three_module.Pq0,_r=new three_module.Pq0;return function(){_r.set(xt.x-vt.x,xt.y-vt.y,0);let rr=_r.length();rr?(ft.copy(d.object.position).sub(d.target),xr.copy(ft).normalize(),vr.copy(d.object.up).normalize(),Dr.crossVectors(vr,xr).normalize(),vr.setLength(xt.y-vt.y),Dr.setLength(xt.x-vt.x),_r.copy(vr.add(Dr)),pr.crossVectors(_r,ft).normalize(),rr*=d.rotateSpeed,ur.setFromAxisAngle(pr,rr),ft.applyQuaternion(ur),d.object.up.applyQuaternion(ur),At.copy(pr),mt=rr):!d.staticMoving&&mt&&(mt*=Math.sqrt(1-d.dynamicDampingFactor),ft.copy(d.object.position).sub(d.target),ur.setFromAxisAngle(At,mt),ft.applyQuaternion(ur),d.object.up.applyQuaternion(ur)),vt.copy(xt)}}(),this.zoomCamera=function(){let pr;nt===4?(pr=ut/pt,ut=pt,d.object.isPerspectiveCamera?ft.multiplyScalar(pr):d.object.isOrthographicCamera?(d.object.zoom=three_module.cj9.clamp(d.object.zoom/pr,d.minZoom,d.maxZoom),it!==d.object.zoom&&d.object.updateProjectionMatrix()):console.warn("THREE.TrackballControls: Unsupported camera type")):(pr=1+(Et.y-Ct.y)*d.zoomSpeed,pr!==1&&pr>0&&(d.object.isPerspectiveCamera?ft.multiplyScalar(pr):d.object.isOrthographicCamera?(d.object.zoom=three_module.cj9.clamp(d.object.zoom/pr,d.minZoom,d.maxZoom),it!==d.object.zoom&&d.object.updateProjectionMatrix()):console.warn("THREE.TrackballControls: Unsupported camera type")),d.staticMoving?Ct.copy(Et):Ct.y+=(Et.y-Ct.y)*this.dynamicDampingFactor)},this.panCamera=function(){const pr=new three_module.I9Y,ur=new three_module.Pq0,xr=new three_module.Pq0;return function(){if(pr.copy(kt).sub(Tt),pr.lengthSq()){if(d.object.isOrthographicCamera){const vr=(d.object.right-d.object.left)/d.object.zoom/d.domElement.clientWidth,Dr=(d.object.top-d.object.bottom)/d.object.zoom/d.domElement.clientWidth;pr.x*=vr,pr.y*=Dr}pr.multiplyScalar(ft.length()*d.panSpeed),xr.copy(ft).cross(d.object.up).setLength(pr.x),xr.add(ur.copy(d.object.up).setLength(pr.y)),d.object.position.add(xr),d.target.add(xr),d.staticMoving?Tt.copy(kt):Tt.add(pr.subVectors(kt,Tt).multiplyScalar(d.dynamicDampingFactor))}}}(),this.checkDistances=function(){d.noZoom&&d.noPan||(ft.lengthSq()>d.maxDistance*d.maxDistance&&(d.object.position.addVectors(d.target,ft.setLength(d.maxDistance)),Ct.copy(Et)),ft.lengthSq()<d.minDistance*d.minDistance&&(d.object.position.addVectors(d.target,ft.setLength(d.minDistance)),Ct.copy(Et)))},this.update=function(){ft.subVectors(d.object.position,d.target),d.noRotate||d.rotateCamera(),d.noZoom||d.zoomCamera(),d.noPan||d.panCamera(),d.object.position.addVectors(d.target,ft),d.object.isPerspectiveCamera?(d.checkDistances(),d.object.lookAt(d.target),_e.distanceToSquared(d.object.position)>b&&(d.dispatchEvent(TrackballControls_changeEvent),_e.copy(d.object.position))):d.object.isOrthographicCamera?(d.object.lookAt(d.target),(_e.distanceToSquared(d.object.position)>b||it!==d.object.zoom)&&(d.dispatchEvent(TrackballControls_changeEvent),_e.copy(d.object.position),it=d.object.zoom)):console.warn("THREE.TrackballControls: Unsupported camera type")},this.reset=function(){nt=_,at=_,d.target.copy(d.target0),d.object.position.copy(d.position0),d.object.up.copy(d.up0),d.object.zoom=d.zoom0,d.object.updateProjectionMatrix(),ft.subVectors(d.object.position,d.target),d.object.lookAt(d.target),d.dispatchEvent(TrackballControls_changeEvent),_e.copy(d.object.position),it=d.object.zoom},this.dispose=function(){d.domElement.removeEventListener("contextmenu",lr),d.domElement.removeEventListener("pointerdown",Ut),d.domElement.removeEventListener("pointercancel",Kt),d.domElement.removeEventListener("wheel",cr),d.domElement.removeEventListener("pointermove",Ht),d.domElement.removeEventListener("pointerup",Jt),window.removeEventListener("keydown",sr),window.removeEventListener("keyup",ir)},this.domElement.addEventListener("contextmenu",lr),this.domElement.addEventListener("pointerdown",Ut),this.domElement.addEventListener("pointercancel",Kt),this.domElement.addEventListener("wheel",cr,{passive:!1}),window.addEventListener("keydown",sr),window.addEventListener("keyup",ir),this.handleResize(),this.update()}}var TrackballControls2_decorate=function(h,o,c,d){var _,b=arguments.length,_e=b<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_e=Reflect.decorate(h,o,c,d);else for(var it=h.length-1;it>=0;it--)(_=h[it])&&(_e=(b<3?_(_e):b>3?_(o,c,_e):_(o,c))||_e);return b>3&&_e&&Object.defineProperty(o,c,_e),_e};let TrackballControls2=class extends TrackballControls{constructor(h,o){super(h,o),this.type="TrackballControls",this.enabled=!0,this.rotateSpeed=1,this.zoomSpeed=1.2,this.panSpeed=.3,this.noRotate=!1,this.noZoom=!1,this.noPan=!1,this.noRoll=!1,this.staticMoving=!1,this.dynamicDampingFactor=.2,this.minDistance=0,this.maxDistance=999999,this.minZoom=0,this.maxZoom=999999,this.object=h}};TrackballControls2_decorate([serialize()],TrackballControls2.prototype,"type",void 0),TrackballControls2_decorate([uiToggle()],TrackballControls2.prototype,"enabled",void 0),TrackballControls2_decorate([uiInput(),serialize()],TrackballControls2.prototype,"rotateSpeed",void 0),TrackballControls2_decorate([uiInput(),serialize()],TrackballControls2.prototype,"zoomSpeed",void 0),TrackballControls2_decorate([uiInput(),serialize()],TrackballControls2.prototype,"panSpeed",void 0),TrackballControls2_decorate([uiToggle(),serialize()],TrackballControls2.prototype,"noRotate",void 0),TrackballControls2_decorate([uiToggle(),serialize()],TrackballControls2.prototype,"noZoom",void 0),TrackballControls2_decorate([uiToggle(),serialize()],TrackballControls2.prototype,"noPan",void 0),TrackballControls2_decorate([uiToggle(),serialize()],TrackballControls2.prototype,"noRoll",void 0),TrackballControls2_decorate([uiToggle(),serialize()],TrackballControls2.prototype,"staticMoving",void 0),TrackballControls2_decorate([uiInput(),serialize()],TrackballControls2.prototype,"dynamicDampingFactor",void 0),TrackballControls2_decorate([uiInput(),serialize()],TrackballControls2.prototype,"minDistance",void 0),TrackballControls2_decorate([uiInput(),serialize()],TrackballControls2.prototype,"maxDistance",void 0),TrackballControls2_decorate([uiInput(),serialize()],TrackballControls2.prototype,"minZoom",void 0),TrackballControls2_decorate([uiInput(),serialize()],TrackballControls2.prototype,"maxZoom",void 0),TrackballControls2=TrackballControls2_decorate([uiPanel("Track Ball")],TrackballControls2);class TrackballControlsPlugin extends ACameraControlsPlugin{constructor(){super(...arguments),this.controlsKey="trackball",this._controlsCtor=(o,c)=>new TrackballControls2(o,c.ownerDocument?c:c.documentElement)}}TrackballControlsPlugin.PluginType="TrackballControlsPlugin";var SimplifyModifierPlugin_decorate=function(h,o,c,d){var _,b=arguments.length,_e=b<3?o:d===null?d=Object.getOwnPropertyDescriptor(o,c):d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_e=Reflect.decorate(h,o,c,d);else for(var it=h.length-1;it>=0;it--)(_=h[it])&&(_e=(b<3?_(_e):b>3?_(o,c,_e):_(o,c))||_e);return b>3&&_e&&Object.defineProperty(o,c,_e),_e};class SimplifyModifierPlugin extends AViewerPlugin{constructor(){super(),this.enabled=!0,this.toJSON=void 0,this.simplifyFactor=.5}get initialized(){return!0}async initialize(){}async onAdded(o){await super.onAdded(o),this._pickingPlugin=o.getPlugin(PickingPlugin)}simplifyGeometries(o,c){var d;if(!o){const b=(d=this._pickingPlugin)===null||d===void 0?void 0:d.getSelectedObject(),_e=[];if(b==null||b.traverse(it=>{it.geometry&&!_e.includes(it.geometry)&&_e.push(it.geometry)}),!(o=_e)||!o.length)return}Array.isArray(o)||(o=[o]);const _=[];for(const b of o)_.push(this.simplifyGeometry(b,c));return _}simplifyGeometry(o,{factor:c,count:d,replace:_=!0,disposeOnReplace:b=!1}={}){var _e,it,nt;if(!o){const Ct=(_e=this._pickingPlugin)===null||_e===void 0?void 0:_e.getSelectedObject();if(!(o=Ct==null?void 0:Ct.geometry))return}if(!o.attributes.position)return(it=this._viewer)===null||it===void 0||it.console.error("SimplifyModifierPlugin: Geometry does not have position attribute",o),o;c=c||this.simplifyFactor,d=d||o.attributes.position.count*c,o.boundingBox||o.computeBoundingBox();const at=this._simplify(o,d);at.computeBoundingBox(),at.computeBoundingSphere(),at.computeVertexNormals();const ut=at.boundingBox,pt=ut.getSize(new three_module.Pq0);if(!isFinite(pt.x)||!isFinite(pt.y)||!isFinite(pt.z))return(nt=this._viewer)===null||nt===void 0||nt.console.error("SimplifyModifierPlugin: Unable to simplify",o,at,pt),o;const mt=o.boundingBox,ft=mt.getSize(new three_module.Pq0),vt=pt.clone().sub(ft),xt=vt.clone().divide(ft);if(xt.lengthSq()>.001&&console.warn("Simplify",o,at,ut,mt,pt,ft,vt,xt),!_)return at;const At=o.userData.__appliedMeshes;if(!At)return console.error("No meshes found for geometry, cannot replace",o),at;for(const Ct of At)Ct.setGeometry?Ct.setGeometry(at):Ct.geometry=at;return b&&o.dispose(!0),at}async simplifyAll(o,c){var d;if(!o&&this._viewer&&(o=this._viewer.scene.modelRoot),!o)return void console.error("SimplifyModifierPlugin: No root found");if(!this.initialized&&(await this.initialize(),!this.initialized))return void((d=this._viewer)===null||d===void 0||d.console.error("SimplifyModifierPlugin cannot be initialized"));const _=[];if(o.modelObject.traverse(b=>{b.geometry&&!_.includes(b.geometry)&&_.push(b.geometry)}),_.length)return this.simplifyGeometries(_,c);console.error("SimplifyModifierPlugin: No geometries found")}async simplifySelected(){var o;if(!this._viewer)return;if(!this.initialized&&(await this.initialize(),!this.initialized))return void await this._viewer.alert("Simplify: SimplifyModifierPlugin cannot be initialized");const c=(o=this._pickingPlugin)===null||o===void 0?void 0:o.getSelectedObject();if(!c)return void await this._viewer.alert("Simplify: Nothing Selected");let d=!1;c.geometry?c.children.length===0&&(d=!0):d=!0,d||await this._viewer.confirm("Simplify: Simplify all in hierarchy?")&&(d=!0),d?this.simplifyGeometries():this.simplifyGeometry(c.geometry)}}SimplifyModifierPlugin.PluginType="SimplifyModifierPlugin",SimplifyModifierPlugin_decorate([uiSlider("Simplify Factor",[0,1])],SimplifyModifierPlugin.prototype,"simplifyFactor",void 0),SimplifyModifierPlugin_decorate([uiButton("Simplify All",{sendArgs:!1})],SimplifyModifierPlugin.prototype,"simplifyAll",null),SimplifyModifierPlugin_decorate([uiButton("Simplify Selected")],SimplifyModifierPlugin.prototype,"simplifySelected",null);var MeshOptSimplifyModifierPlugin_decorate=function(h,o,c,d){var _,b=arguments.length,_e=b<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_e=Reflect.decorate(h,o,c,d);else for(var it=h.length-1;it>=0;it--)(_=h[it])&&(_e=(b<3?_(_e):b>3?_(o,c,_e):_(o,c))||_e);return b>3&&_e&&Object.defineProperty(o,c,_e),_e},MeshOptSimplifyModifierPlugin_1;let MeshOptSimplifyModifierPlugin=MeshOptSimplifyModifierPlugin_1=class extends SimplifyModifierPlugin{constructor(h=!0,o=document.head){super(),this.rootNode=o,this._initializing=void 0,this.errorThreshold=.5,this.lockBorder=!1,h&&this.initialize()}get initialized(){return!!window.MeshoptSimplifier}async initialize(){if(this.initialized)return;if(this._initializing)return await this._initializing;const h=document.createElement("script");h.type="module";const o=Math.random().toString(36).substring(7);return h.innerHTML=`
import { MeshoptSimplifier } from '${MeshOptSimplifyModifierPlugin_1.SIMPLIFIER_URL}';
MeshoptSimplifier.ready.then(() => {
window.MeshoptSimplifier = MeshoptSimplifier;
window.dispatchEvent(new CustomEvent('${o}'))
});
`,this._initializing=new Promise(c=>{window.addEventListener(o,()=>c(),{once:!0}),this.rootNode.appendChild(h),this._script=h}),await this._initializing}dispose(){this._script&&(this._script.remove(),delete window.MeshoptSimplifier),this._script=void 0}_simplify(h,o){if(!this.initialized)throw new Error("MeshOptSimplifyModifierPlugin not initialized");const c=(h=h.index?h.clone():toIndexedGeometry(h)).index.array,d=h.attributes.position.array,_=o/h.attributes.position.count,b=3*Math.floor(_*c.length/3),[_e,it]=window.MeshoptSimplifier.simplify(c,d,3,b,this.errorThreshold,this.lockBorder?["LockBorder"]:[]);return console.log("srcCount",c.length/3,"destCount",_e.length/3),it&&console.log("Simplify error",it),h.setIndex(new three_module.THS(new Uint32Array(_e),1)),h}};MeshOptSimplifyModifierPlugin.PluginType="MeshOptSimplifyModifierPlugin",MeshOptSimplifyModifierPlugin.SIMPLIFIER_URL="https://unpkg.com/meshoptimizer@0.20.0/meshopt_simplifier.module.js",MeshOptSimplifyModifierPlugin_decorate([uiInput()],MeshOptSimplifyModifierPlugin.prototype,"errorThreshold",void 0),MeshOptSimplifyModifierPlugin_decorate([uiToggle()],MeshOptSimplifyModifierPlugin.prototype,"lockBorder",void 0),MeshOptSimplifyModifierPlugin=MeshOptSimplifyModifierPlugin_1=MeshOptSimplifyModifierPlugin_decorate([uiFolder("Simplify Modifier (meshopt)")],MeshOptSimplifyModifierPlugin);class CustomAnimationHelper{constructor(){this._animations=[],this._playingAnimations=new Set,this._clock=new three_module.zD7}loadModel(o){this._model=o,this.mixer=new three_module.Iw4(o),o&&(this._animations=[...o.animations])}get getMixer(){return this.mixer}get getAnimationClips(){return this._animations}async playAllAnimations(o){var c;const d=[];(c=this._animations)===null||c===void 0||c.forEach(_=>{d.push(this.playClip(_,o))}),await Promise.all(d)}async reverseAllAnimation(o){var c;const d=[];(c=this._animations)===null||c===void 0||c.forEach(_=>{d.push(this.playClip(_,o,1,!0))}),await Promise.all(d)}async playClip(o,c,d=1,_=!1,b=!1){if(!this.mixer)return;const _e=this.mixer.clipAction(o);return this._playingAnimations.has(_e)&&this.mixer.dispatchEvent({type:"canceled",action:_e}),b&&(this.mixer.setTime(0),this.mixer.stopAllAction()),_?(_e.paused=!1,_e.timeScale=-d):(_e.reset(),_e.timeScale=d),_e.loop=c?three_module.aMy:three_module.G3T,_e.clampWhenFinished=!0,new Promise(it=>{const nt=async at=>{at.action===_e&&(this.mixer.removeEventListener("finished",nt),this.mixer.removeEventListener("canceled",nt),this._playingAnimations.delete(_e),it())};this.mixer.addEventListener("finished",nt),this.mixer.addEventListener("canceled",nt),this._playingAnimations.add(_e),_e.play()})}playClipByName(o,c,d=1,_=!1){let b;this._animations.forEach(_e=>{_e.name===o&&(b=_e)}),b&&this.playClip(b,c,d,_)}update(){const o=this._clock.getDelta();return this._playingAnimations.size>0&&(this.mixer.update(o),!0)}}class CustomAnimationHelperPlugin extends AViewerPlugin{constructor(){super(),this.helperIdentities=new Map}async onAdded(o){var c;await super.onAdded(o),(c=this._viewer)===null||c===void 0||c.addEventListener("postFrame",()=>{this.helperIdentities.forEach(d=>{var _;d.update()&&((_=this._viewer)===null||_===void 0||_.setDirty())})})}createHelper(o,c){var d;if(this.helperIdentities.has(o))(d=this._viewer)===null||d===void 0||d.console.warn("Helper with this id already exists");else{const _=new CustomAnimationHelper;_.loadModel(c),this.helperIdentities.set(o,_)}}getAnimationClips(o){if(this.helperIdentities.has(o))return this.helperIdentities.get(o).getAnimationClips}async playClip(o,c,d,_=1,b=!1,_e=!1){this.helperIdentities.has(o)&&await this.helperIdentities.get(o).playClip(c,d,_,b,_e)}async playAllAnimations(o,c){this.helperIdentities.has(o)&&await this.helperIdentities.get(o).playAllAnimations(c)}async playAllAnimationsInReverse(o,c){this.helperIdentities.has(o)&&await this.helperIdentities.get(o).reverseAllAnimation(c)}async playAnimationByName(o,c,d,_=1,b=!1){this.helperIdentities.has(o)&&await this.helperIdentities.get(o).playClipByName(c,d,_,b)}}CustomAnimationHelperPlugin.PluginType="AnimationHelperPlugin";class FileTransferPlugin extends AViewerPlugin{constructor(){super(...arguments),this.enabled=!0,this.toJSON=void 0,this.defaultActions={exportFile:async(o,c,d)=>{N$2(o,c)}},this.actions={...this.defaultActions}}async exportFile(o,c){c=c||o.name||"file_export",this.dispatchEvent({type:"transferFile",path:c,state:"exporting"}),await this.actions.exportFile(o,c,({state:d,progress:_})=>{this.dispatchEvent({type:"transferFile",path:c,state:d??"exporting",progress:_})}),this.dispatchEvent({type:"transferFile",path:c,state:"done"})}}FileTransferPlugin.PluginType="FileTransferPlugin";var CameraViewControlPlugin_decorate=function(h,o,c,d){var _,b=arguments.length,_e=b<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_e=Reflect.decorate(h,o,c,d);else for(var it=h.length-1;it>=0;it--)(_=h[it])&&(_e=(b<3?_(_e):b>3?_(o,c,_e):_(o,c))||_e);return b>3&&_e&&Object.defineProperty(o,c,_e),_e};class CameraViewControlPlugin extends AViewerPlugin{_onEnabledChanged1(){this._onEnabledChanged()}_onEnabledChanged(){this._viewer&&(this._viewer.scene.activeCamera.interactionsEnabled=!this.enabled);const o=this._cameraViews.length;this._oldState=o<2?0:three_module.cj9.clamp(this._currentState,0,o-1.001),this.enabled&&this._animateCameraToView(),this.dispatchEvent({type:"enableChanged",enabled:this.enabled})}constructor(o=!0){super(),this.enabled=!0,this.animEase="easeInOutSine",this.interpolateMode="spherical",this.enableDamping=!0,this.damping=.04,this.initAnimationTime=1,this.dependencies=[CameraViewPlugin],this._currentState=0,this._oldState=0,this._overrideTime=0,this._preFrame1=c=>{this._preFrame(c)},this.enabled=o,this._onEnabledChanged1=this._onEnabledChanged1.bind(this)}get _cameraViews(){var o,c,d;return(d=(c=(o=this._viewer)===null||o===void 0?void 0:o.getPlugin(CameraViewPlugin))===null||c===void 0?void 0:c.camViews)!==null&&d!==void 0?d:[]}setState(o){this._currentState=o}async onAdded(o){await super.onAdded(o),this.enabled&&this._onEnabledChanged(),o.addEventListener("preFrame",this._preFrame1)}async onRemove(o){return o.removeEventListener("preFrame",this._preFrame1),this.enabled=!1,super.onRemove(o)}_preFrame(o){var c;if(!this.enabled)return;const d=this._cameraViews;if(d.length<=1||!this._overrideStartView&&Math.abs(this._currentState-this._oldState)<.001)return;this.enableDamping?this._oldState=three_module.cj9.lerp(this._oldState,this._currentState,this.damping):this._oldState=this._currentState,this._oldState=three_module.cj9.clamp(this._oldState,0,d.length-1.001);const _=Math.floor(this._oldState),b=this._overrideStartView||d[_],_e=this._overrideEndView||d[_+1];let it,nt=this._overrideStartView?this._overrideTime:this._oldState-_;nt=EasingFunctions[this.animEase](nt),it=this.interpolateMode==="spherical"?this._lerpViewsSpherical(b,_e,nt):this._lerpViewsLinear(b,_e,nt);const at=(c=this._viewer)===null||c===void 0?void 0:c.scene.activeCamera;at&&(at.position.copy(it[0]),at.target.copy(it[1]),at.positionTargetUpdated(!0)),this._overrideStartView&&(this._overrideTime+=o.deltaTime/1e3,this._overrideTime>=this.initAnimationTime&&(this._overrideTime=0,this._overrideStartView=void 0,this._overrideEndView=void 0))}_lerpViewsLinear(o,c,d){const _=new three_module.Pq0,b=new three_module.Pq0;return b.lerpVectors(o.position,c.position,d),_.lerpVectors(o.target,c.target,d),[b,_]}_lerpViewsSpherical(o,c,d){const _=o.target.clone(),b=new three_module.Pq0,_e=new three_module.Pq0,it=sphericalFromObject(o,o.target),nt=sphericalFromObject(c,c.target),at=new three_module.YHV;return at.phi=lerpAngle(it.phi,nt.phi,d),at.theta=lerpAngle(it.theta,nt.theta,d),at.radius=three_module.cj9.lerp(it.radius,nt.radius,d),b.copy(_).lerp(c.target,d),_e.setFromSpherical(at),_e.add(b),[_e,b]}_animateCameraToView(){const o=this._cameraViews;if(!this._viewer||o.length<2||!this.enabled)return;this._overrideStartView=new CameraView(this._viewer.scene.activeCamera.position,this._viewer.scene.activeCamera.target);const c=Math.floor(this._oldState),d=this._oldState-c;let _;_=this.interpolateMode==="spherical"?this._lerpViewsSpherical(o[c],o[c+1],d):this._lerpViewsLinear(o[c],o[c+1],d),this._overrideEndView=new CameraView(_[0],_[1]),this._overrideTime=0}}CameraViewControlPlugin.PluginType="CameraViewControlPlugin",CameraViewControlPlugin_decorate([uiToggle("Enabled"),x$1(CameraViewControlPlugin.prototype._onEnabledChanged1),serialize()],CameraViewControlPlugin.prototype,"enabled",void 0),CameraViewControlPlugin_decorate([serialize(),uiDropdown("Ease",Object.keys(EasingFunctions).map(h=>({label:h})))],CameraViewControlPlugin.prototype,"animEase",void 0),CameraViewControlPlugin_decorate([serialize(),uiDropdown("Interpolation",["spherical","linear"].map(h=>({label:h})))],CameraViewControlPlugin.prototype,"interpolateMode",void 0),CameraViewControlPlugin_decorate([uiToggle("Enable Damping"),serialize()],CameraViewControlPlugin.prototype,"enableDamping",void 0),CameraViewControlPlugin_decorate([uiSlider("Damping",[.01,1],.001),serialize()],CameraViewControlPlugin.prototype,"damping",void 0),CameraViewControlPlugin_decorate([uiSlider("Init Anim Time",[.01,5],.001),serialize()],CameraViewControlPlugin.prototype,"initAnimationTime",void 0);class ScrollableCameraViewPlugin extends CameraViewControlPlugin{constructor(o=document.body,c=!0){super(c),this.wrapper=document.createElement("div"),this.toJSON=void 0,this.uiConfig={type:"folder",label:"Scrollable Camera Views",children:[...generateUiConfig(this)]},typeof o=="string"?(this.parent=document.getElementById(o),this.parent||(console.error("parent doesn't exist"),this.parent=document.body)):this.parent=o}_preFrame(o){var c;if(this.enabled&&!(this._cameraViews.length<=1))try{const d=this._findActiveView(),_=this._getScroll(d);this.setState(_+d),super._preFrame(o)}catch(d){return void(((c=this._viewer)===null||c===void 0?void 0:c.getPluginByType("Debug"))&&console.error(d))}}_getScroll(o){var c,d;if(o>=this._cameraViews.length-1)return 0;const _=(c=this.parent.querySelector(this._cameraViews[o].name))!==null&&c!==void 0?c:this.parent.getElementsByTagName("section")[o],b=(d=this.parent.querySelector(this._cameraViews[o+1].name))!==null&&d!==void 0?d:this.parent.getElementsByTagName("section")[o+1],_e=this.parent.getBoundingClientRect();if(!_||!b)return 0;const it=_.getBoundingClientRect(),nt=b.getBoundingClientRect(),at=this.parent===document.body?0:_e.top;return three_module.cj9.clamp((at-it.top)/Math.max(nt.top-it.top,1e-4),0,1)}_findActiveView(){var o,c;for(let d=this._cameraViews.length-1;d>=0;d--){const _=(o=this.parent.querySelector(this._cameraViews[d].name))!==null&&o!==void 0?o:this.parent.getElementsByTagName("section")[d],b=this.parent.getBoundingClientRect();if(_){if(_.getBoundingClientRect().top<(this.parent===document.body?0:b.top))return d}else!((c=this._cameraViews[d].name)===null||c===void 0)&&c.startsWith("#")&&console.error("section with id "+this._cameraViews[d].name+" doesn't exist!")}return 0}}ScrollableCameraViewPlugin.PluginType="ScrollableCameraViewPlugin";var ScrollableCameraViewPreviewPlugin_decorate=function(h,o,c,d){var _,b=arguments.length,_e=b<3?o:d===null?d=Object.getOwnPropertyDescriptor(o,c):d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_e=Reflect.decorate(h,o,c,d);else for(var it=h.length-1;it>=0;it--)(_=h[it])&&(_e=(b<3?_(_e):b>3?_(o,c,_e):_(o,c))||_e);return b>3&&_e&&Object.defineProperty(o,c,_e),_e};let ScrollableCameraViewPreviewPlugin=class extends ScrollableCameraViewPlugin{generateCode(){var h;const o=document.createElement("div");o.style.position="absolute",o.style.top="0",o.style.width="100%",o.style.height="100%",o.style.display="flex",o.style.flexDirection="column",o.style.justifyContent="center",o.style.alignItems="center",o.style.zIndex="200";const c=document.createElement("textarea");c.rows=20,c.style.border="3px solid #27223a",c.style.borderRadius="5px",c.style.width="30%",c.style.padding="5px",c.style.zIndex="1000";const d=document.createElement("div");d.textContent="X",d.style.color="red",d.style.width="20px",d.style.height="20px",d.style.padding="2",d.style.textAlign="center",d.style.backgroundColor="white",d.style.borderRadius="100%",d.style.border="2px solid #27223a",d.style.cursor="pointer",d.addEventListener("click",()=>{var b;(b=this._viewer)===null||b===void 0||b.container.removeChild(o)});const _=document.createElement("div");_.textContent="Update",_.style.marginTop="10px",_.style.color="white",_.style.padding="4px 10px 4px 10px",_.style.justifyContent="center",_.style.alignItems="center",_.style.backgroundColor="green",_.style.borderRadius="10px",_.style.border="2px solid #fff",_.style.cursor="pointer",_.addEventListener("click",()=>{var b,_e;const it=this.parent.innerHTML;this.parent.innerHTML=c.value;let nt=0;for(;nt<this._cameraViews.length;nt++){let at;try{at=(b=this.parent.querySelector(this._cameraViews[nt].name))!==null&&b!==void 0?b:this.parent.getElementsByTagName("section")[nt]}catch{at=null}if(!at&&nt<2){alert("you need to add 2 sections at least");break}if(!at){const ut=((_e=this._cameraViews[nt].name)===null||_e===void 0||_e.startsWith("#"),this._cameraViews[nt].name.replace(/^#/,""));c.value+=ut,c.value=this._format(c.value)}}nt<2?this.parent.innerHTML=it:setInnerHTMLWithScripts(this.parent,c.value)}),o.appendChild(d),o.appendChild(c),o.appendChild(_),c.value=this._format(this.parent.innerHTML),(h=this._viewer)===null||h===void 0||h.container.appendChild(o)}_onEnabledChanged(){super._onEnabledChanged(),this._togglePreview()}_togglePreview(){this.wrapper&&(this.wrapper.style.zIndex=this.canvasUp?"-100":"100",this.wrapper.style.visibility=this.enabled?"visible":"hidden",this._viewer&&(this._viewer.canvas.style.pointerEvents=this.enabled&&this.canvasUp?"none":"auto"))}constructor(h=document.body,o=!1){super(h,o),this.canvasUp=!1,this._togglePreview=this._togglePreview.bind(this),this.generateCode=this.generateCode.bind(this)}async onAdded(h){var o,c,d,_,b,_e;this.parent=this.wrapper,await super.onAdded(h),this._addWrapper(),this._togglePreview(),this.deserialize=this.deserialize.bind(this),this.addView=this.addView.bind(this),this.deleteView=this.deleteView.bind(this),(c=(o=this._viewer)===null||o===void 0?void 0:o.getPlugin(CameraViewPlugin))===null||c===void 0||c.addEventListener("viewDelete",this.deleteView),(_=(d=this._viewer)===null||d===void 0?void 0:d.getPlugin(CameraViewPlugin))===null||_===void 0||_.addEventListener("deserialize",this.deserialize),(_e=(b=this._viewer)===null||b===void 0?void 0:b.getPlugin(CameraViewPlugin))===null||_e===void 0||_e.addEventListener("viewAdd",this.addView)}deserialize(h){this._cameraViews.forEach(o=>{this._createSection(o.name)})}_addWrapper(){var h;this.wrapper.style.width="100%",this.wrapper.style.height="100%",this.wrapper.style.zIndex="-100",this.wrapper.style.position="absolute",this.wrapper.style.top="0",this.wrapper.id="parentWrapper",this.wrapper.style.borderRadius="10px",this.wrapper.style.overflowY="scroll",this.wrapper.style.overflowX="hidden",(h=this._viewer)===null||h===void 0||h.container.appendChild(this.wrapper)}_createSection(h){const o=document.createElement("section");o.style.width="100%",o.style.height="100%",o.style.opacity="50%",o.style.backgroundColor="black",o.style.zIndex="100",o.style.top="0",o.textContent=h,o.style.color="white",o.style.fontSize="100px",o.style.display="flex",o.style.alignItems="center",o.style.justifyContent="center",o.id=h,this.parent.appendChild(o)}addView(h){this._cameraViews.forEach((o,c)=>{var d,_;let b;try{b=(d=this.parent.querySelector(o.name))!==null&&d!==void 0?d:this.parent.getElementsByTagName("section")[c]}catch{b=null}if(!b){const _e=`<section id="${!((_=o.name)===null||_===void 0)&&_.startsWith("#")?o.name.replace(/^#/,""):""}" style="width: 100%; height: 100%; opacity: 0.5; background-color: black; z-index: 100; top: 0px; color: white; font-size: 100px; display: flex; align-items: center; justify-content: center;">
                    ${o.name}
                    </section>`;this.parent.innerHTML+=_e}})}deleteView(h){var o;try{const c=(o=this.parent.querySelector(h.view.name))!==null&&o!==void 0?o:this.parent.getElementsByTagName("section").namedItem(h.view.name);c==null||c.remove()}catch{return}}_format(h){let o="",c="";return h.split(/>\s*</).forEach(function(d){d.match(/^\/\w/)&&(c=c.substring(1)),o+=c+"<"+d+`>\r
`,d.match(/^<?\w[^>]*[^/]$/)&&!d.startsWith("input")&&(c+="	")}),o.substring(1,o.length-3)}};ScrollableCameraViewPreviewPlugin_decorate([uiButton("Show/Edit Code")],ScrollableCameraViewPreviewPlugin.prototype,"generateCode",null),ScrollableCameraViewPreviewPlugin_decorate([uiToggle("Canvas on top"),x$1(ScrollableCameraViewPreviewPlugin.prototype._togglePreview)],ScrollableCameraViewPreviewPlugin.prototype,"canvasUp",void 0),ScrollableCameraViewPreviewPlugin=ScrollableCameraViewPreviewPlugin_decorate([uiFolder("Scrollable Camera View Preview (Dev)")],ScrollableCameraViewPreviewPlugin);var build_e={d:(h,o)=>{for(var c in o)build_e.o(o,c)&&!build_e.o(h,c)&&Object.defineProperty(h,c,{enumerable:!0,get:o[c]})},o:(h,o)=>Object.prototype.hasOwnProperty.call(h,o)},build_t={};build_e.d(build_t,{e:()=>build_R});var build_n=function(h,o,c,d){return new(c||(c=Promise))(function(_,b){function _e(at){try{nt(d.next(at))}catch(ut){b(ut)}}function it(at){try{nt(d.throw(at))}catch(ut){b(ut)}}function nt(at){var ut;at.done?_(at.value):(ut=at.value,ut instanceof c?ut:new c(function(pt){pt(ut)})).then(_e,it)}nt((d=d.apply(h,[])).next())})};class build_r{constructor(o,c={resolution:2048},d={},_=!1,b=!1,_e=!1){this.THREE=o,this.packOptions=c,this.chartOptions=d,this.useNormals=_,this.timeUnwrap=b,this.logProgress=_e,this._libraryLoaded=!1,this._isUnwrapping=!1,this.xAtlas=this._createXAtlas()}loadLibrary(o,c,d){return build_n(this,void 0,void 0,function*(){if(!this._libraryLoaded){for(yield new Promise((_,b)=>{try{this.xAtlas.init(_,o,c,d)}catch(_e){b(_e)}});!this.xAtlas.api||!(yield this.xAtlas.api.loaded);)yield new Promise(_=>setTimeout(_,100));this._libraryLoaded=!0}})}packAtlas(o,c="uv2",d="uv"){return build_n(this,void 0,void 0,function*(){if(!this._libraryLoaded)throw new Error("xatlas-three: library not loaded");if(!o)throw new Error("xatlas-three: nodeList argument not provided");if(o.length<1)throw new Error("xatlas-three: nodeList must have non-zero length");const _=this.chartOptions.useInputMeshUvs;for(;this._isUnwrapping;)console.log("xatlas-three: unwrapping another mesh, waiting 100 ms"),yield new Promise(at=>setTimeout(at,100));this._isUnwrapping=!0,yield this.xAtlas.api.setProgressLogging(this.logProgress),yield this.xAtlas.api.createAtlas();let b=[],_e="";for(let at of o){let{uuid:ut,index:pt,attributes:mt}=at;const ft=at.userData.worldScale||1;b.push(ut),pt&&mt.position&&mt.position.itemSize===3?(_e="Mesh"+b.length+" added to atlas: "+ut,this.timeUnwrap&&console.time(_e),yield this.xAtlas.api.addMesh(pt.array,mt.position.array,mt.normal?mt.normal.array:void 0,mt.uv?mt.uv.array:void 0,ut,this.useNormals,_,ft),this.timeUnwrap&&console.timeEnd(_e)):console.warn("xatlas-three: Geometry not supported: ",at)}_e="Generated atlas with "+b.length+" meshes",this.timeUnwrap&&console.time(_e);const it=yield this.xAtlas.api.generateAtlas(this.chartOptions,this.packOptions,!0);this.timeUnwrap&&console.timeEnd(_e);let nt=[];for(let at of it.meshes){let ut=o.find(ft=>ft.uuid===at.mesh);if(!ut){console.error("xatlas-three: Geometry not found: ",at.mesh);continue}at.vertex.vertices&&ut.setAttribute("position",new this.THREE.BufferAttribute(at.vertex.vertices,3,!1)),at.vertex.normals&&ut.setAttribute("normal",new this.THREE.BufferAttribute(at.vertex.normals,3,!0)),at.vertex.coords1&&ut.setAttribute(c,new this.THREE.BufferAttribute(at.vertex.coords1,2,!1)),at.vertex.coords&&c!==d&&ut.setAttribute(d,new this.THREE.BufferAttribute(at.vertex.coords,2,!1)),at.index&&ut.setIndex(new this.THREE.BufferAttribute(at.index,1,!1)),at.subMeshes&&(ut.userData.xAtlasSubMeshes=structuredClone(at.subMeshes));const pt=at.oldIndexes,mt=ut.attributes;for(const ft in mt){if(ft==="position"||ft==="normal"||ft===c||ft===d)continue;const vt=mt[ft],xt=vt.array.constructor,At=vt.itemSize,Ct=vt.array,Et=new xt(pt.length*At),Tt=new this.THREE.BufferAttribute(Et,At,vt.normalized);Tt.gpuType=vt.gpuType;for(let kt=0,Dt=pt.length;kt<Dt;kt++){const zt=pt[kt];for(let Bt=0;Bt<At;Bt++)Et[kt*At+Bt]=Ct[zt*At+Bt]}ut.setAttribute(ft,Tt)}nt.push(ut)}return yield this.xAtlas.api.destroyAtlas(),this._isUnwrapping=!1,{width:it.width,height:it.height,atlasCount:it.atlasCount,meshCount:it.meshCount,texelsPerUnit:it.texelsPerUnit,geometries:nt,meshes:it.meshes}})}unwrapGeometry(o,c="uv",d="uv2"){return build_n(this,void 0,void 0,function*(){return this.packAtlas([o],c,d)})}}class build_s{}const build_i=Symbol("Comlink.proxy"),build_a=Symbol("Comlink.endpoint"),build_o=Symbol("Comlink.releaseProxy"),build_l=Symbol("Comlink.finalizer"),build_u=Symbol("Comlink.thrown"),build_c=h=>typeof h=="object"&&h!==null||typeof h=="function",build_h=new Map([["proxy",{canHandle:h=>build_c(h)&&h[build_i],serialize(h){const{port1:o,port2:c}=new MessageChannel;return build_p(h,o),[c,[c]]},deserialize:h=>(h.start(),build_f(h))}],["throw",{canHandle:h=>build_c(h)&&build_u in h,serialize({value:h}){let o;return o=h instanceof Error?{isError:!0,value:{message:h.message,name:h.name,stack:h.stack}}:{isError:!1,value:h},[o,[]]},deserialize(h){throw h.isError?Object.assign(new Error(h.value.message),h.value):h.value}}]]);function build_p(h,o=globalThis,c=["*"]){o.addEventListener("message",function d(_){if(!_||!_.data)return;if(!function(ut,pt){for(const mt of ut)if(pt===mt||mt==="*"||mt instanceof RegExp&&mt.test(pt))return!0;return!1}(c,_.origin))return void console.warn(`Invalid origin '${_.origin}' for comlink proxy`);const{id:b,type:_e,path:it}=Object.assign({path:[]},_.data),nt=(_.data.argumentList||[]).map(build_L);let at;try{const ut=it.slice(0,-1).reduce((mt,ft)=>mt[ft],h),pt=it.reduce((mt,ft)=>mt[ft],h);switch(_e){case"GET":at=pt;break;case"SET":ut[it.slice(-1)[0]]=build_L(_.data.value),at=!0;break;case"APPLY":at=pt.apply(ut,nt);break;case"CONSTRUCT":at=build_x(new pt(...nt));break;case"ENDPOINT":{const{port1:mt,port2:ft}=new MessageChannel;build_p(h,ft),at=function(vt,xt){return build_E.set(vt,xt),vt}(mt,[mt])}break;case"RELEASE":at=void 0;break;default:return}}catch(ut){at={value:ut,[build_u]:0}}Promise.resolve(at).catch(ut=>({value:ut,[build_u]:0})).then(ut=>{const[pt,mt]=build_A(ut);o.postMessage(Object.assign(Object.assign({},pt),{id:b}),mt),_e==="RELEASE"&&(o.removeEventListener("message",d),build_d(o),build_l in h&&typeof h[build_l]=="function"&&h[build_l]())}).catch(ut=>{const[pt,mt]=build_A({value:new TypeError("Unserializable return value"),[build_u]:0});o.postMessage(Object.assign(Object.assign({},pt),{id:b}),mt)})}),o.start&&o.start()}function build_d(h){(function(o){return o.constructor.name==="MessagePort"})(h)&&h.close()}function build_f(h,o){return build_v(h,[],o)}function build_m(h){if(h)throw new Error("Proxy has been released and is not useable")}function build_g(h){return build_P(h,{type:"RELEASE"}).then(()=>{build_d(h)})}const build_y=new WeakMap,build_w="FinalizationRegistry"in globalThis&&new FinalizationRegistry(h=>{const o=(build_y.get(h)||0)-1;build_y.set(h,o),o===0&&build_g(h)});function build_v(h,o=[],c=function(){}){let d=!1;const _=new Proxy(c,{get(b,_e){if(build_m(d),_e===build_o)return()=>{(function(it){build_w&&build_w.unregister(it)})(_),build_g(h),d=!0};if(_e==="then"){if(o.length===0)return{then:()=>_};const it=build_P(h,{type:"GET",path:o.map(nt=>nt.toString())}).then(build_L);return it.then.bind(it)}return build_v(h,[...o,_e])},set(b,_e,it){build_m(d);const[nt,at]=build_A(it);return build_P(h,{type:"SET",path:[...o,_e].map(ut=>ut.toString()),value:nt},at).then(build_L)},apply(b,_e,it){build_m(d);const nt=o[o.length-1];if(nt===build_a)return build_P(h,{type:"ENDPOINT"}).then(build_L);if(nt==="bind")return build_v(h,o.slice(0,-1));const[at,ut]=build_b(it);return build_P(h,{type:"APPLY",path:o.map(pt=>pt.toString()),argumentList:at},ut).then(build_L)},construct(b,_e){build_m(d);const[it,nt]=build_b(_e);return build_P(h,{type:"CONSTRUCT",path:o.map(at=>at.toString()),argumentList:it},nt).then(build_L)}});return function(b,_e){const it=(build_y.get(_e)||0)+1;build_y.set(_e,it),build_w&&build_w.register(b,_e,b)}(_,h),_}function build_b(h){const o=h.map(build_A);return[o.map(d=>d[0]),(c=o.map(d=>d[1]),Array.prototype.concat.apply([],c))];var c}const build_E=new WeakMap;function build_x(h){return Object.assign(h,{[build_i]:!0})}function build_A(h){for(const[o,c]of build_h)if(c.canHandle(h)){const[d,_]=c.serialize(h);return[{type:"HANDLER",name:o,value:d},_]}return[{type:"RAW",value:h},build_E.get(h)||[]]}function build_L(h){switch(h.type){case"HANDLER":return build_h.get(h.name).deserialize(h.value);case"RAW":return h.value}}function build_P(h,o,c){return new Promise(d=>{const _=new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-");h.addEventListener("message",function b(_e){_e.data&&_e.data.id&&_e.data.id===_&&(h.removeEventListener("message",b),d(_e.data))}),h.start&&h.start(),h.postMessage(Object.assign({id:_},o),c)})}class build_T extends build_s{init(o,c,d,_){if(!this.api){if(!_)throw new Error("workerFilePath is required");(()=>{var b,_e,it;b=this,it=function*(){const nt=yield fetch(_).then(pt=>pt.blob()),at=URL.createObjectURL(nt),ut=new Worker(at,{type:"module"});this.api=yield new(build_f(ut))(build_x(()=>{o(),URL.revokeObjectURL(at)}),build_x((pt,mt)=>pt==="xatlas.wasm"?d:pt+mt),build_x(c))},new((_e=void 0)||(_e=Promise))(function(nt,at){function ut(ft){try{mt(it.next(ft))}catch(vt){at(vt)}}function pt(ft){try{mt(it.throw(ft))}catch(vt){at(vt)}}function mt(ft){var vt;ft.done?nt(ft.value):(vt=ft.value,vt instanceof _e?vt:new _e(function(xt){xt(vt)})).then(ut,pt)}mt((it=it.apply(b,[])).next())})})()}}}class build_R extends build_r{_createXAtlas(){return new build_T}}var build_k=build_t.e,XAtlasPlugin_decorate=function(h,o,c,d){var _,b=arguments.length,_e=b<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_e=Reflect.decorate(h,o,c,d);else for(var it=h.length-1;it>=0;it--)(_=h[it])&&(_e=(b<3?_(_e):b>3?_(o,c,_e):_(o,c))||_e);return b>3&&_e&&Object.defineProperty(o,c,_e),_e},XAtlasPlugin_1;let UChartOptions=class{constructor(){this.fixWinding=!1,this.maxBoundaryLength=0,this.maxChartArea=0,this.maxCost=2,this.maxIterations=1,this.normalDeviationWeight=2,this.normalSeamWeight=4,this.roundnessWeight=.009999999776482582,this.straightnessWeight=6,this.textureSeamWeight=.5,this.useInputMeshUvs=!1}};XAtlasPlugin_decorate([serialize()],UChartOptions.prototype,"fixWinding",void 0),XAtlasPlugin_decorate([serialize()],UChartOptions.prototype,"maxBoundaryLength",void 0),XAtlasPlugin_decorate([serialize()],UChartOptions.prototype,"maxChartArea",void 0),XAtlasPlugin_decorate([serialize()],UChartOptions.prototype,"maxCost",void 0),XAtlasPlugin_decorate([serialize()],UChartOptions.prototype,"maxIterations",void 0),XAtlasPlugin_decorate([serialize()],UChartOptions.prototype,"normalDeviationWeight",void 0),XAtlasPlugin_decorate([serialize()],UChartOptions.prototype,"normalSeamWeight",void 0),XAtlasPlugin_decorate([serialize()],UChartOptions.prototype,"roundnessWeight",void 0),XAtlasPlugin_decorate([serialize()],UChartOptions.prototype,"straightnessWeight",void 0),XAtlasPlugin_decorate([serialize()],UChartOptions.prototype,"textureSeamWeight",void 0),XAtlasPlugin_decorate([serialize()],UChartOptions.prototype,"useInputMeshUvs",void 0),UChartOptions=XAtlasPlugin_decorate([uiFolder("Chart Options"),serializable("UChartOptions")],UChartOptions);let UPackOptions=class{constructor(){this.bilinear=!0,this.blockAlign=!1,this.bruteForce=!1,this.createImage=!1,this.maxChartSize=0,this.padding=0,this.resolution=0,this.rotateCharts=!0,this.rotateChartsToAxis=!0,this.texelsPerUnit=0}};XAtlasPlugin_decorate([serialize()],UPackOptions.prototype,"bilinear",void 0),XAtlasPlugin_decorate([serialize()],UPackOptions.prototype,"blockAlign",void 0),XAtlasPlugin_decorate([serialize()],UPackOptions.prototype,"bruteForce",void 0),XAtlasPlugin_decorate([serialize()],UPackOptions.prototype,"createImage",void 0),XAtlasPlugin_decorate([serialize()],UPackOptions.prototype,"maxChartSize",void 0),XAtlasPlugin_decorate([serialize()],UPackOptions.prototype,"padding",void 0),XAtlasPlugin_decorate([serialize()],UPackOptions.prototype,"resolution",void 0),XAtlasPlugin_decorate([serialize()],UPackOptions.prototype,"rotateCharts",void 0),XAtlasPlugin_decorate([serialize()],UPackOptions.prototype,"rotateChartsToAxis",void 0),XAtlasPlugin_decorate([serialize()],UPackOptions.prototype,"texelsPerUnit",void 0),UPackOptions=XAtlasPlugin_decorate([uiFolder("Pack Options"),serializable("UPackOptions")],UPackOptions);let XAtlasPlugin=XAtlasPlugin_1=class extends AViewerPlugin{constructor(h=!1){super(),this.enabled=!0,this.useNormals=!0,this.chartOptions=new UChartOptions,this.packOptions=new UPackOptions,this._loaded=!1,this._unwrapProgress=(o,c)=>{console.log("Unwrapping",o,c)},this.unwrapSelected=async()=>{var o,c,d,_,b;const _e=(c=(o=this._viewer)===null||o===void 0?void 0:o.getPlugin(PickingPlugin))===null||c===void 0?void 0:c.getSelectedObject();if(_e)if(_e.geometry){if(_e.geometry.attributes.uv&&!await((b=this._viewer)===null||b===void 0?void 0:b.confirm("Unwrap: Geometry already has UVs. Overwrite?")))return;await this.unwrapGeometry(_e.geometry)}else(_=this._viewer)===null||_===void 0||_.alert("Unwrap: Selected object has no geometry");else(d=this._viewer)===null||d===void 0||d.alert("Unwrap: No object selected")},h&&this.loadLibrary()}async loadLibrary(){if(this._unwrapper)for(;!this._loaded;)await X$2(100);else this._unwrapper=new build_k({BufferAttribute:three_module.THS},this.packOptions,this.chartOptions,this.useNormals),await this._unwrapper.loadLibrary(this._unwrapProgress,XAtlasPlugin_1.LIBRARY_PATH+"xatlas.wasm",XAtlasPlugin_1.LIBRARY_PATH+"xatlas.js"),console.log("xatlas loaded"),this._loaded=!0}async unwrapGeometry(h,o="uv",c="uv"){var d;await this.loadLibrary(),await((d=this._unwrapper)===null||d===void 0?void 0:d.unwrapGeometry(h,o,c))}async packAtlas(h,o=!0,c="uv2",d="uv"){var _;await this.loadLibrary(),Array.isArray(h)||(h=[h]);const b=[];o?h.forEach(_e=>_e.traverse(it=>{it.geometry&&b.push(it.geometry)})):h.forEach(_e=>{_e.geometry&&b.push(_e.geometry)}),await((_=this._unwrapper)===null||_===void 0?void 0:_.packAtlas(b,c,d))}_useNormalsChanged(){this._unwrapper&&(this._unwrapper.useNormals=this.useNormals)}};XAtlasPlugin.PluginType="XAtlasPlugin",XAtlasPlugin.LIBRARY_PATH="https://cdn.jsdelivr.net/npm/xatlasjs@0.1.0/dist/",XAtlasPlugin_decorate([x$1(XAtlasPlugin.prototype._useNormalsChanged),serialize()],XAtlasPlugin.prototype,"useNormals",void 0),XAtlasPlugin_decorate([serialize()],XAtlasPlugin.prototype,"chartOptions",void 0),XAtlasPlugin_decorate([serialize()],XAtlasPlugin.prototype,"packOptions",void 0),XAtlasPlugin_decorate([uiButton("Unwrap Selected Geometry")],XAtlasPlugin.prototype,"unwrapSelected",void 0),XAtlasPlugin=XAtlasPlugin_1=XAtlasPlugin_decorate([uiFolder("UV Unwrapping (xAtlas)")],XAtlasPlugin);class VariationConfiguratorPlugin extends AViewerPlugin{constructor(){super(...arguments),this.dependencies=[AssetManagerPlugin],this.enabled=!0,this.serializeWithViewer=!1,this.baseUrl="",this.variations={objects:[],materials:[]},this.autoDispose=!0,this._ty=["objects","materials"],this._extForType={objects:["glb","fbx","obj","gltf","stl","3dm","json","vjson"],materials:["pmat","dmat"],images:["png","jpg","jpeg","gif","bmp","webp","svg"]},this.utils={getName:o=>o.name||o.prefix.replace(/^\//,"").replace(/\/$/,"").replaceAll("/","_"),getTitle:o=>o.title||this.utils.getName(o),getIcon:(o,c)=>{let d=o.icon;return(d&&/^(\w+)\(([^)]*)\)/.exec(d)||/^#([A-Fa-f\d]+)$/.exec(d))&&(d=Je$1(d)),d&&d.startsWith("http")&&d.startsWith("data:")||(d=this.utils.pathToIcon(this.baseUrl+c+"/"+o.prefix+(d||""))),d},getItemIcon:(o,c,d)=>{const _=o.iconFiles[c];if(_)return URL.createObjectURL(_);let b=o.icons[c];return(b&&/^(\w+)\(([^)]*)\)/.exec(b)||/^#([A-Fa-f\d]+)$/.exec(b))&&(b=Je$1(b)),b||(b=this.utils.pathToIcon(o.items[c])),!b||b.startsWith("http")||b.startsWith("data:")||(b=this.baseUrl+d+"/"+o.prefix+b),b},getItemTitle:(o,c)=>o.titles[c]||this.utils.pathToTitle(o.items[c]),getItemPath:(o,c,d)=>o.items[c].startsWith("http")?o.items[c]:`${this.baseUrl}${d}/${o.prefix}${o.items[c]}`,pathToTitle:o=>o.split("/").pop().replace(/\.[^.]*$/,""),pathToIcon:o=>o.replace(/\/$/,"").replace(/\.[^/.]+$/,"")+".webp"},this.toJSON=void 0}_getVariationId(o){return this.utils.getName(o)}async applyVariation(o,c,d,_=!1){var b,_e;if(!this._viewer)return;const it=this._getVariationId(o);typeof c=="number"&&(c=o.items[c]);const nt=o.items.indexOf(c);if(nt===-1)return void this._viewer.console.warn(`Item ${c} not found`);const at=o.itemFiles[nt],ut=o.selected;if(!_&&ut===nt)return;o.selected=nt;const pt=this._viewer.getManager(),mt=this.utils.getItemPath(o,nt,d);if(d==="objects"){let ft=this._viewer.scene.findObjectsByName(it).map(Et=>Et.modelObject);ft.length===0&&(ft=[(await this._viewer.createObject3D()).modelObject],ft[0].name=it),this._viewer.renderEnabled=!1;for(const Et of ft)[...Et.children].forEach(Tt=>Tt.dispose&&this.autoDispose?Tt.dispose():Tt.removeFromParent());const vt=await this._loadObject(mt,at);if(!vt.length)return void(mt.endsWith("json")||this._viewer.console.warn(`Object ${mt} not found`));let xt=!1;for(const Et of ft){[...Et.children].forEach(Tt=>Tt.dispose&&this.autoDispose?Tt.dispose():Tt.removeFromParent());for(const Tt of vt)xt?Et.add(Tt.modelObject.clone()):Et.add(Tt.modelObject);xt=!0}const At=[],Ct=this.variations.materials.filter(Et=>Et&&typeof Et.selected=="number");for(const Et of Ct)At.push(this.applyVariation(Et,Et.selected,"materials",!0));await Promise.all(At),this._viewer.renderEnabled=!0}if(d==="materials"){const ft=await this._loadMaterial(mt,at);if(!ft)return void this._viewer.console.warn(`Material ${mt} not found`);ft.userData.__isVariation=!0;const vt=this._viewer.scene.findObjectsByName(it),xt=At=>{var Ct,Et,Tt,kt;At.material&&!((Ct=o.data)===null||Ct===void 0)&&Ct.matType&&(Array.isArray(At.material)?At.material.length!==0&&((Et=o.data)===null||Et===void 0?void 0:Et.matType)!==At.material[0].typeSlug:((Tt=o.data)===null||Tt===void 0?void 0:Tt.matType)!==At.material.typeSlug)||(kt=At==null?void 0:At.setMaterial)===null||kt===void 0||kt.call(At,ft)};for(const At of vt)!((b=o.data)===null||b===void 0)&&b.traverse?At.traverse(xt):xt(At);(_e=pt.materials)===null||_e===void 0||_e.applyMaterial(ft,it)}}clearVariations(){const o=this.variations.objects;if(this.variations.materials,this.variations={objects:[],materials:[]},this._viewer)for(const c of o){const d=this._getVariationId(c),_=this._viewer.scene.findObjectsByName(d);for(const b of _)[...b.children].forEach(_e=>{var it;return((it=_e.dispose)!==null&&it!==void 0?it:_e.removeFromParent)()})}}async _loadMaterial(o,c){var d,_,b;return(b=(_=(d=this._viewer)===null||d===void 0?void 0:d.getManager())===null||_===void 0?void 0:_.importer)===null||b===void 0?void 0:b.importSinglePath(o,{importedFile:c})}async _loadObject(o,c){var d,_,b;return(b=(_=(d=this._viewer)===null||d===void 0?void 0:d.getManager())===null||_===void 0?void 0:_.importer)===null||b===void 0?void 0:b.importPath(o,{importedFile:c,reimportDisposed:!0})}importConfig(o,c){var d,_;typeof o=="string"&&(o=JSON.parse(o)),o.baseUrl!==void 0&&(this.baseUrl=o.baseUrl),!c&&o.folder&&(c=typeof o.folder=="object"?o.folder:typeof o.folder=="string"?unzipSync(strToU8(o.folder)):unzipSync(o.folder));for(const b of this._ty)if(o[b])for(const _e of o[b]){const it={items:_e.items,prefix:_e.prefix,name:_e.name,title:_e.title||"",icon:_e.icon||"",icons:(d=_e.icons)!==null&&d!==void 0?d:_e.items.map(()=>""),titles:(_=_e.titles)!==null&&_!==void 0?_:_e.items.map(()=>""),itemFiles:[],iconFiles:[],data:{..._e.data}};if(c)for(let nt=0;nt<_e.items.length;nt++){const at=_e.items[nt],ut=c[b+"/"+_e.prefix+at];it.itemFiles[nt]=ut?new File([ut],at):void 0;const pt=_e.icons[nt];if(!pt)continue;const mt=c[b+"/"+_e.prefix+pt];it.iconFiles[nt]=mt?new File([mt],pt):void 0}this.variations[b].push(it)}}async importPath(o){var c,d;if(o.endsWith(".json")){const _=await((d=(c=this._viewer)===null||c===void 0?void 0:c.getManager().importer)===null||d===void 0?void 0:d.importSinglePath(o,{processImported:!1})),b=o.split("?")[0];return this.baseUrl||(this.baseUrl=b.substring(0,b.lastIndexOf("/")+1)),this.importConfig(_)}o.endsWith(".zip")?alert("not implemented"):alert("not supported")}getMaterials(o){var c;return((c=this.variations.materials.find(d=>this.utils.getName(d)===o))===null||c===void 0?void 0:c.items)||[]}getObjects(o){var c;return((c=this.variations.objects.find(d=>this.utils.getName(d)===o))===null||c===void 0?void 0:c.items)||[]}getMaterialVariations(){return this.variations.materials.map(o=>this.utils.getName(o))}getObjectVariations(){return this.variations.objects.map(o=>this.utils.getName(o))}async onRemove(o){return super.onRemove(o)}fromJSON(o){return super.fromJSON(o)?(this.importConfig(o),this):null}async _exportConfiguratorState(){var o;let c={objects:{},materials:{}};const d={objects:[],materials:[],type:VariationConfiguratorPlugin.PluginType};this.baseUrl&&(d.baseUrl=this.baseUrl);let _=!1;for(const b of this._ty)for(const _e of this.variations[b]){const it={..._e};it.data={...it.data},delete it.itemFiles,delete it.iconFiles,d[b].push(it);const nt=_e.prefix.replace(/^\//,""),at=nt.trimEnd().endsWith("/")?"":nt.split("/").pop()||"",ut=nt.replace(at,"").trimEnd().replace(/\/$/,""),pt={};let mt=!1;for(let xt=0;xt<_e.items.length;xt++){const At=_e.items[xt],Ct=_e.itemFiles[xt],Et=_e.iconFiles[xt],Tt=_e.icons[xt];Ct?(pt[at+At]=new Uint8Array(await Ct.arrayBuffer()),Et&&!Tt&&((o=this._viewer)===null||o===void 0||o.console.error("Icon file without icon name")),Et&&Tt&&(pt[at+Tt]=new Uint8Array(await Et.arrayBuffer())),mt=!0):Et&&alert("Icon file without model/material file not supported")}if(!mt)continue;_=!0;const ft=ut.split("/");let vt=c[b];for(const xt of ft){vt[xt]||(vt[xt]={});const At=vt[xt];if(typeof At!="object")throw new Error("Invalid prefix: "+_e.prefix);vt=At}Object.assign(vt,pt)}return _||(c=void 0),{folder:c,config:d}}}VariationConfiguratorPlugin.PluginType="VariationConfiguratorPlugin";class VariationConfiguratorGridUiPlugin extends VariationConfiguratorPlugin{constructor(){super(),this._uiNeedRefresh=!1,this._refreshUi=this._refreshUi.bind(this)}async onAdded(o){await super.onAdded(o),o.addEventListener("preFrame",this._refreshUi)}async onRemove(o){return o.removeEventListener("preFrame",this._refreshUi),super.onRemove(o)}refreshUi(){this.enabled&&(this._uiNeedRefresh=!0)}async _refreshUi(){if(!this.enabled||!this._viewer||!this._uiNeedRefresh)return!1;this._uiNeedRefresh=!1,CustomContextGrid.RemoveAll(VariationConfiguratorGridUiPlugin.PluginType);for(const o of["objects","materials"])for(const c of this.variations[o])CustomContextGrid.Create(VariationConfiguratorGridUiPlugin.PluginType,this.utils.getTitle(c),5,20,0,c.items.map((d,_)=>({id:d,image:this.utils.getItemIcon(c,_,o),onClick:async b=>this.applyVariation(c,b,o,!1),tooltip:this.utils.getItemTitle(c,_)})),(d,_)=>tippy_esm(d,{placement:"bottom",content:_.tooltip}));return CustomContextGrid.RebuildUi(this._viewer.container),!0}}VariationConfiguratorGridUiPlugin.PluginType="VariationConfiguratorPlugin";class VariationConfiguratorEditorUiPlugin extends VariationConfiguratorGridUiPlugin{constructor(){super(...arguments),this._uiExpandedState={},this.uiConfig={type:"folder",label:"Configurator",children:[{type:"input",label:"Base URL",property:[this,"baseUrl"]},...this._ty.map(o=>({type:"folder",expanded:this._uiExpandedState["__/"+o],onExpand:()=>this._uiExpandedState["__/"+o]=!0,onCollapse:()=>this._uiExpandedState["__/"+o]=!1,label:o,children:[()=>this.variations[o].map(c=>({type:"folder",expanded:this._uiExpandedState[c.name],onExpand:()=>this._uiExpandedState[c.name]=!0,onCollapse:()=>this._uiExpandedState[c.name]=!1,label:()=>this.utils.getName(c),children:[{type:"input",placeholder:()=>this.utils.getName(c),property:[c,"name"]},{type:"input",property:[c,"prefix"]},{type:"input",placeholder:()=>this.utils.pathToTitle(this.utils.getName(c)),property:[c,"title"]},{type:"input",placeholder:()=>this.utils.pathToIcon(this.baseUrl+c.prefix),property:[c,"icon"]},{type:"folder",label:"items",children:c.items.map((d,_)=>({type:"folder",label:()=>c.items[_],children:[{type:"input",label:"File/URL",isMonitor:!c.itemFiles[_],getValue:()=>c.items[_],setValue:b=>{c.items[_]=b}},{type:"input",label:"Icon/Image",placeholder:this.utils.pathToIcon(c.items[_]),getValue:()=>c.icons[_],setValue:b=>{c.icons[_]=b}},{type:"input",label:"Title",placeholder:this.utils.pathToTitle(c.items[_]),getValue:()=>c.titles[_],setValue:b=>{c.titles[_]=b}},{type:"button",label:"Apply",value:async()=>this.applyVariation(c,_,o)},c.itemFiles[_]?[{type:"button",label:"Remove",value:()=>{c.items.splice(_,1),c.itemFiles.splice(_,1),this.refreshUi()}},{type:"button",label:"Replace",value:async()=>{const b=await ge$1(!1,!1);b.length!==0&&(c.itemFiles[_]=b[0],c.items[_]=b[0].name,this.refreshUi())}},{type:"button",label:"Download",value:async()=>{const b=c.itemFiles[_];N$2(b,b.name)}}]:{}]}))},{type:"button",label:"Add item (local)",value:async()=>{var d,_,b;const _e=await ge$1(!0,!1);if(_e.length!==0){for(const it of _e){if(!this._extForType[o].includes((d=it.name.split(".").pop())!==null&&d!==void 0?d:"")){await((_=this._viewer)===null||_===void 0?void 0:_.alert(`Invalid file: ${it.name} is not a valid ${o} file`));continue}if(c.items.includes(it.name)){await((b=this._viewer)===null||b===void 0?void 0:b.alert(`Already exists: Item with name ${it.name} already exists`));continue}const nt=c.items.push(it.name)-1;c.icons[nt]="",c.titles[nt]="",c.itemFiles[nt]=it}this.refreshUi()}}},{type:"button",label:"Add item (url)",value:async()=>{var d,_,b,_e,it;const nt=await((d=this._viewer)===null||d===void 0?void 0:d.prompt("URL: Enter the url of the object/material"));if(!nt)return;if(!nt.startsWith("http")&&!this.baseUrl.startsWith("http"))return void await((_=this._viewer)===null||_===void 0?void 0:_.alert(`Invalid url: ${nt} should be a valid HTTP(S) url. If you are passing a relative path, set the baseURL first`));if(!this._extForType[o].includes((b=nt.split(".").pop())!==null&&b!==void 0?b:""))return void await((_e=this._viewer)===null||_e===void 0?void 0:_e.alert(`Invalid url: ${nt} should be of a material ending with mat`));c.items.includes(nt)&&await((it=this._viewer)===null||it===void 0?void 0:it.alert(`Already exists: Item with url ${nt} already exists`)),c.items.push(nt);const at=c.items.length-1;c.icons[at]="",c.titles[at]="",this.refreshUi()}},{type:"button",label:()=>"Remove "+this.utils.getName(c),value:async()=>{var d;await((d=this._viewer)===null||d===void 0?void 0:d.confirm(`Delete Group: Are you sure you want to remove ${this.utils.getName(c)}?`))&&(this.variations[o].splice(this.variations[o].indexOf(c),1),this.refreshUi())}}]})),{type:"button",label:`Add ${o} group (empty)`,value:async()=>{var c;const d=await((c=this._viewer)===null||c===void 0?void 0:c.prompt("Name: Enter the name of the object/material"));d&&(this.variations[o].push({items:[],itemFiles:[],icons:[],iconFiles:[],titles:[],prefix:d+"/",name:d,icon:"",title:""}),this.refreshUi())}},{type:"button",label:`Add ${o} group (local folder)`,value:async()=>{var c,d,_,b;const _e=await ge$1(!1,!0);if(_e.length===0)return;const it=[],nt=[],at=[],ut=[];for(const xt of _e){if(xt.name.startsWith("."))continue;const At=(c=xt.name.split(".").pop())!==null&&c!==void 0?c:"";At?this._extForType[o].includes(At)?(it.push(xt.webkitRelativePath.replace(/^\//,"")),nt.push(xt)):this._extForType.images.includes(At)?(at.push(xt.webkitRelativePath.replace(/^\//,"")),ut.push(xt)):await((_=this._viewer)===null||_===void 0?void 0:_.alert(`Invalid file: ${xt.name} is not a valid ${o} file`)):await((d=this._viewer)===null||d===void 0?void 0:d.alert(`Invalid file: ${xt.name} has no extension`))}const pt=he$1(it),mt=this.utils.getName({prefix:pt});let ft=await((b=this._viewer)===null||b===void 0?void 0:b.prompt("Name: Enter the name of the object/material",mt,!0));if(ft===null)return;ft=ft||mt;const vt=it.map(xt=>{var At;const Ct=xt.replace(pt,""),Et=(At=Ct.split(".").pop())!==null&&At!==void 0?At:"",Tt=Ct.replace("."+Et,"")+".",kt=at.findIndex(Dt=>Dt.replace(pt,"").startsWith(Tt));return kt<0?["",void 0]:[at[kt].replace(pt,""),ut[kt]||void 0]});this.variations[o].push({items:it.map(xt=>xt.replace(pt,"")),icons:vt.map(xt=>xt[0]),iconFiles:vt.map(xt=>xt[1]),titles:it.map(()=>""),itemFiles:nt,prefix:pt,name:ft,icon:"",title:""}),this.refreshUi()}}]})),{type:"button",label:"Download JSON/Zip",value:async()=>{var o,c;try{const{folder:d,config:_}=await this._exportConfiguratorState(),b=JSON.stringify(_,null,4);if(d){d["config.json"]=strToU8(b);const _e=await zipSync(d);N$2(new Blob([_e],{type:"application/zip"}),"configurator.zip")}else N$2(new Blob([b],{type:"application/json"}),"config.json")}catch(d){return(o=this._viewer)===null||o===void 0||o.console.error(d),void await((c=this._viewer)===null||c===void 0?void 0:c.alert("Error: "+((d==null?void 0:d.message)||d)))}}},{type:"button",label:"Load JSON/Zip",value:async()=>{var o,c,d;const _=await ge$1(!1,!1,"application/zip,application/json");if(_.length===0)return;const b=_[0];if(b.name.endsWith(".zip")){const _e=unzipSync(new Uint8Array(await b.arrayBuffer()));if(!_e["config.json"])return void await((o=this._viewer)===null||o===void 0?void 0:o.alert("Invalid zip: config.json not found"));const it=JSON.parse(strFromU8(_e["config.json"]));this.importConfig(it,_e)}else{if(!b.name.endsWith(".json"))return void await((c=this._viewer)===null||c===void 0?void 0:c.alert("Invalid file: "+b.name));{const _e=JSON.parse(await b.text());this.importConfig(_e)}}await((d=this._viewer)===null||d===void 0?void 0:d.alert("Imported successfully")),this.refreshUi()}},{type:"button",label:"Import Path",value:async()=>{var o,c;const d=await((o=this._viewer)===null||o===void 0?void 0:o.prompt("URL: Enter the url of the json file."));d&&(await this.importPath(d),await((c=this._viewer)===null||c===void 0?void 0:c.alert("Imported successfully")),this.refreshUi())}},{type:"button",label:"Refresh UI",value:()=>{this.refreshUi()}},{type:"button",label:"Clear All",value:async()=>{var o;await((o=this._viewer)===null||o===void 0?void 0:o.confirm("Clear: Are you sure you want to clear the configuration ?"))&&(this.variations.objects=[],this.variations.materials=[],this.refreshUi())}}]}}_refreshUiConfig(){var o,c;(c=(o=this.uiConfig)===null||o===void 0?void 0:o.uiRefresh)===null||c===void 0||c.call(o,"postFrame",!0)}refreshUi(){this._refreshUiConfig(),super.refreshUi()}async _loadObject(o,c){const d=await super._loadObject(o,c);for(const _ of d)(_.modelObject||_).userData.excludeFromExport=!0;return d}}VariationConfiguratorEditorUiPlugin.PluginType="VariationConfiguratorPlugin";class TransformAnimationPlugin extends AViewerPlugin{constructor(){super(),this.toJSON=void 0,this.enabled=!0,this._addSceneObject=o=>{const c=o.object;c!=null&&c.traverse&&c.traverse(d=>{var _,b;if(d.isWidget)return;d.userData[TransformAnimationPlugin.PluginType]===void 0&&(d.userData[TransformAnimationPlugin.PluginType]={transforms:[]});const _e={type:"folder",label:"Transform Animation",children:[{type:"button",label:"Add Current Transform",value:()=>{var it;this.addTransform(d),(it=_e==null?void 0:_e.uiRefresh)===null||it===void 0||it.call(_e)}},()=>{var it;return(it=d.userData[TransformAnimationPlugin.PluginType])===null||it===void 0?void 0:it.transforms.map((nt,at)=>({type:"folder",label:`Transform ${at}`,children:[{type:"vec3",label:"Position",property:[nt,"position"]},{type:"vec3",label:"Quaternion",property:[nt,"quaternion"]},{type:"vec3",label:"Scale",property:[nt,"scale"]},{type:"button",label:"Set",value:()=>{this.setTransform(d,nt)}},{type:"button",label:"Animate",value:()=>{this.animateTransform(d,nt)}}]}))}]};(b=(_=d.uiConfig)===null||_===void 0?void 0:_.children)===null||b===void 0||b.push(_e)})}}async onAdded(o){await super.onAdded(o),o.scene.addEventListener("addSceneObject",this._addSceneObject)}async onRemove(o){return o.scene.removeEventListener("addSceneObject",this._addSceneObject),super.onRemove(o)}addTransform(o){o.userData[TransformAnimationPlugin.PluginType].transforms.push({position:o.position.clone(),quaternion:o.quaternion.clone(),scale:o.scale.clone()})}setTransform(o,c){var d,_,b,_e;o.position.copy(c.position),o.quaternion.copy(c.quaternion),o.scale.copy(c.scale),(_=(d=o.userData).setDirty)===null||_===void 0||_.call(d),(_e=(b=o.uiConfig)===null||b===void 0?void 0:b.uiRefresh)===null||_e===void 0||_e.call(b)}animateTransform(o,c,d=2e3){var _,b;const _e=(_=this._viewer)===null||_===void 0?void 0:_.getPluginByType("PopmotionPlugin");_e||(b=this._viewer)===null||b===void 0||b.console.error("PopmotionPlugin required for animation");const it=typeof c=="number"?o.userData[TransformAnimationPlugin.PluginType].transforms[c]:c,nt=new three_module.Pq0,at=new three_module.PTz,ut=new three_module.Pq0,pt=o.position.clone(),mt=o.quaternion.clone(),ft=o.scale.clone(),vt=it.position,xt=it.quaternion,At=it.scale;return _e==null?void 0:_e.animate({from:0,to:1,duration:d,onUpdate:Ct=>{var Et,Tt;nt.lerpVectors(pt,vt,Ct),at.slerpQuaternions(mt,xt,Ct),ut.lerpVectors(ft,At,Ct),o.position.copy(nt),o.quaternion.copy(at),o.scale.copy(ut),(Et=this._viewer)===null||Et===void 0||Et.setDirty(),(Tt=this._viewer)===null||Tt===void 0||Tt.renderer.resetShadows()},onStop:()=>{var Ct,Et,Tt,kt;o.position.copy(it.position),o.quaternion.copy(it.quaternion),o.scale.copy(it.scale),(Et=(Ct=o.userData).setDirty)===null||Et===void 0||Et.call(Ct),(kt=(Tt=o.uiConfig)===null||Tt===void 0?void 0:Tt.uiRefresh)===null||kt===void 0||kt.call(Tt)}})}}TransformAnimationPlugin.PluginType="TransformAnimationPlugin";var VirtualCamerasPlugin_decorate=function(h,o,c,d){var _,b=arguments.length,_e=b<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_e=Reflect.decorate(h,o,c,d);else for(var it=h.length-1;it>=0;it--)(_=h[it])&&(_e=(b<3?_(_e):b>3?_(o,c,_e):_(o,c))||_e);return b>3&&_e&&Object.defineProperty(o,c,_e),_e};let VirtualCamerasPlugin=class extends AViewerPlugin{constructor(h=!0){super(),this.enabled=!0,this.toJSON=void 0,this.cameras=[],this._preRender=()=>{if(this.enabled&&this._viewer)for(const o of this.cameras){if(!o.enabled)continue;const c=this._viewer,d=o.camera;try{this.dispatchEvent({type:"preRenderCamera",camera:o}),c.scene.renderCamera=d,c.renderer.render(!1);const _=c.renderer.composer.readBuffer;this.dispatchEvent({type:"preBlitCamera",camera:o,readBuffer:_}),c.renderer.blit(_.texture,o.target),this.dispatchEvent({type:"postRenderCamera",camera:o})}catch(_){console.error(_),o.enabled=!1}}},this.enabled=h}async onAdded(h){await super.onAdded(h),h.addEventListener("preRender",this._preRender)}addCamera(h){if(!this._viewer)throw"Plugin not added to viewer";const o={camera:h,target:this._viewer.renderer.composerTarget.clone(!0),enabled:!0};return this.cameras.push(o),o}};function updateAttribute(h,o,c,d,_){const b=h.getAttribute(o),_e=d.length/c;return b&&b.count===_e?(b.set(d),b.needsUpdate=!0):h.setAttribute(o,new three_module.qtW(d,c)),b}function updateIndices(h,o){const c=h.index;c&&c.count===o.length?(c.set(o),c.needsUpdate=!0):h.setIndex(o)}function updateUi(h,o){var c,d,_;if(!h.uiConfig)return;let b=(c=h.uiConfig.children)===null||c===void 0?void 0:c.find(_e=>{var it;return(it=_e.tags)===null||it===void 0?void 0:it.includes("generatedGeometry")});b||(b={type:"folder",label:"Generation Params",tags:["generatedGeometry"],children:[]},(d=h.uiConfig.children)===null||d===void 0||d.push(b)),h.userData.__generationParamsUiType!==h.userData.generationParams.type&&(b.children=o(),h.userData.__generationParamsUiType=h.userData.generationParams.type,(_=b.uiRefresh)===null||_===void 0||_.call(b,"postFrame",!0))}VirtualCamerasPlugin.PluginType="VirtualCamerasPlugin",VirtualCamerasPlugin_decorate([uiToggle()],VirtualCamerasPlugin.prototype,"enabled",void 0),VirtualCamerasPlugin=VirtualCamerasPlugin_decorate([uiFolder("Virtual Cameras")],VirtualCamerasPlugin);class AGeometryGenerator{constructor(o){this.type=o}createUiConfig(o){const c=generateUiConfig(o.userData.generationParams).filter(d=>{var _;return((_=Ee$1(d.property))===null||_===void 0?void 0:_[1])!=="type"});return c.forEach(d=>{d.onChange=()=>this.generate(o)}),c}generate(o,c={}){const d=o??new three_module.LoY;if(d.userData.generationParams||(d.userData.generationParams={type:this.type}),d.userData.generationParams.type=this.type,c.type)return console.error("Cannot set type parameter here, use the plugin instead"),d;const _={...this.defaultParams,...d.userData.generationParams,...c},{indices:b,vertices:_e,normals:it,uvs:nt,groups:at}=this._generateData(_);if(updateIndices(d,b),updateAttribute(d,"position",3,_e),updateAttribute(d,"normal",3,it),updateAttribute(d,"uv",2,nt),at){d.clearGroups();for(const ut of at)d.addGroup(ut.start,ut.count,ut.materialIndex)}return d.computeBoundingBox(),d.computeBoundingSphere(),Object.assign(d.userData.generationParams,_),updateUi(d,()=>this.createUiConfig(d)),d.dispatchEvent({type:"geometryUpdate"}),d}}class SphereGeometryGenerator extends AGeometryGenerator{constructor(){super(...arguments),this.defaultParams={radius:1,widthSegments:32,heightSegments:16,phiStart:0,phiLength:2*Math.PI,thetaStart:0,thetaLength:Math.PI}}_generateData(o){const{radius:c,phiStart:d,phiLength:_,thetaStart:b,thetaLength:_e}=o;let{widthSegments:it,heightSegments:nt}=o;it=Math.max(3,Math.floor(it)),nt=Math.max(2,Math.floor(nt));const at=Math.min(b+_e,Math.PI);let ut=0;const pt=[],mt=new three_module.Pq0,ft=new three_module.Pq0,vt=[],xt=[],At=[],Ct=[];for(let Et=0;Et<=nt;Et++){const Tt=[],kt=Et/nt;let Dt=0;Et===0&&b===0?Dt=.5/it:Et===nt&&at===Math.PI&&(Dt=-.5/it);for(let zt=0;zt<=it;zt++){const Bt=zt/it;mt.x=-c*Math.cos(d+Bt*_)*Math.sin(b+kt*_e),mt.y=c*Math.cos(b+kt*_e),mt.z=c*Math.sin(d+Bt*_)*Math.sin(b+kt*_e),xt.push(mt.x,mt.y,mt.z),ft.copy(mt).normalize(),At.push(ft.x,ft.y,ft.z),Ct.push(Bt+Dt,1-kt),Tt.push(ut++)}pt.push(Tt)}for(let Et=0;Et<nt;Et++)for(let Tt=0;Tt<it;Tt++){const kt=pt[Et][Tt+1],Dt=pt[Et][Tt],zt=pt[Et+1][Tt],Bt=pt[Et+1][Tt+1];(Et!==0||b>0)&&vt.push(kt,Dt,Bt),(Et!==nt-1||at<Math.PI)&&vt.push(Dt,zt,Bt)}return{indices:vt,vertices:xt,normals:At,uvs:Ct}}}class PlaneGeometryGenerator extends AGeometryGenerator{constructor(){super(...arguments),this.defaultParams={width:1,height:1,widthSegments:2,heightSegments:2}}_generateData(o){const c=o.width/2,d=o.height/2,_=Math.floor(o.widthSegments),b=Math.floor(o.heightSegments),_e=_+1,it=b+1,nt=o.width/_,at=o.height/b,ut=[],pt=[],mt=[],ft=[];for(let vt=0;vt<it;vt++){const xt=vt*at-d;for(let At=0;At<_e;At++){const Ct=At*nt-c;pt.push(Ct,-xt,0),mt.push(0,0,1),ft.push(At/_),ft.push(1-vt/b)}}for(let vt=0;vt<b;vt++)for(let xt=0;xt<_;xt++){const At=xt+_e*vt,Ct=xt+_e*(vt+1),Et=xt+1+_e*(vt+1),Tt=xt+1+_e*vt;ut.push(At,Ct,Tt),ut.push(Ct,Et,Tt)}return{indices:ut,vertices:pt,normals:mt,uvs:ft}}}class CircleGeometryGenerator extends AGeometryGenerator{constructor(){super(...arguments),this.defaultParams={radius:1,segments:32,thetaStart:0,thetaLength:2*Math.PI}}_generateData(o){const{radius:c,thetaStart:d,thetaLength:_}=o,b=Math.max(3,o.segments),_e=[],it=[],nt=[],at=[],ut=new three_module.Pq0,pt=new three_module.I9Y;it.push(0,0,0),nt.push(0,0,1),at.push(.5,.5);for(let mt=0,ft=3;mt<=b;mt++,ft+=3){const vt=d+mt/b*_;ut.x=c*Math.cos(vt),ut.y=c*Math.sin(vt),it.push(ut.x,ut.y,ut.z),nt.push(0,0,1),pt.x=(it[ft]/c+1)/2,pt.y=(it[ft+1]/c+1)/2,at.push(pt.x,pt.y)}for(let mt=1;mt<=b;mt++)_e.push(mt,mt+1,0);return{indices:_e,vertices:it,normals:nt,uvs:at}}}class TorusGeometryGenerator extends AGeometryGenerator{constructor(){super(...arguments),this.defaultParams={radius:1,tube:.4,radialSegments:12,tubularSegments:48,arc:2*Math.PI}}_generateData(o){const{radius:c,tube:d,arc:_}=o;let{radialSegments:b,tubularSegments:_e}=o;b=Math.floor(b),_e=Math.floor(_e);const it=[],nt=[],at=[],ut=[],pt=new three_module.Pq0,mt=new three_module.Pq0,ft=new three_module.Pq0;for(let vt=0;vt<=b;vt++)for(let xt=0;xt<=_e;xt++){const At=xt/_e*_,Ct=vt/b*Math.PI*2;mt.x=(c+d*Math.cos(Ct))*Math.cos(At),mt.y=(c+d*Math.cos(Ct))*Math.sin(At),mt.z=d*Math.sin(Ct),nt.push(mt.x,mt.y,mt.z),pt.x=c*Math.cos(At),pt.y=c*Math.sin(At),ft.subVectors(mt,pt).normalize(),at.push(ft.x,ft.y,ft.z),ut.push(xt/_e),ut.push(vt/b)}for(let vt=1;vt<=b;vt++)for(let xt=1;xt<=_e;xt++){const At=(_e+1)*vt+xt-1,Ct=(_e+1)*(vt-1)+xt-1,Et=(_e+1)*(vt-1)+xt,Tt=(_e+1)*vt+xt;it.push(At,Ct,Tt),it.push(Ct,Et,Tt)}return{indices:it,vertices:nt,normals:at,uvs:ut}}}class CylinderGeometryGenerator extends AGeometryGenerator{constructor(){super(...arguments),this.defaultParams={radiusTop:1,radiusBottom:1,height:1,radialSegments:32,heightSegments:1,openEnded:!1,thetaStart:0,thetaLength:2*Math.PI}}_generateTorso(o){const{radiusTop:c,radiusBottom:d,height:_,radialSegments:b,heightSegments:_e,thetaStart:it,thetaLength:nt,indexArray:at,indices:ut,groups:pt,vertices:mt,normals:ft,uvs:vt,groupStart:xt,halfHeight:At}=o,Ct=new three_module.Pq0,Et=new three_module.Pq0;let Tt=0;const kt=(d-c)/_;for(let Dt=0;Dt<=_e;Dt++){const zt=[],Bt=Dt/_e,Rt=Bt*(d-c)+c;for(let Ut=0;Ut<=b;Ut++){const Ht=Ut/b,Jt=Ht*nt+it,Kt=Math.sin(Jt),sr=Math.cos(Jt);Et.x=Rt*Kt,Et.y=-Bt*_+At,Et.z=Rt*sr,mt.push(Et.x,Et.y,Et.z),Ct.set(Kt,kt,sr).normalize(),ft.push(Ct.x,Ct.y,Ct.z),vt.push(Ht,1-Bt),zt.push(o.index++)}at.push(zt)}for(let Dt=0;Dt<b;Dt++)for(let zt=0;zt<_e;zt++){const Bt=at[zt][Dt],Rt=at[zt+1][Dt],Ut=at[zt+1][Dt+1],Ht=at[zt][Dt+1];ut.push(Bt,Rt,Ht),ut.push(Rt,Ut,Ht),Tt+=6}pt.push({start:xt,count:Tt,materialIndex:0}),o.groupStart+=Tt}_generateCap(o,c){const{radiusTop:d,radiusBottom:_,radialSegments:b,thetaStart:_e,thetaLength:it,indices:nt,groups:at,vertices:ut,normals:pt,uvs:mt,groupStart:ft,halfHeight:vt}=o,xt=o.index,At=new three_module.I9Y,Ct=new three_module.Pq0;let Et=0;const Tt=c===!0?d:_,kt=c===!0?1:-1;for(let zt=1;zt<=b;zt++)ut.push(0,vt*kt,0),pt.push(0,kt,0),mt.push(.5,.5),o.index++;const Dt=o.index;for(let zt=0;zt<=b;zt++){const Bt=zt/b*it+_e,Rt=Math.cos(Bt),Ut=Math.sin(Bt);Ct.x=Tt*Ut,Ct.y=vt*kt,Ct.z=Tt*Rt,ut.push(Ct.x,Ct.y,Ct.z),pt.push(0,kt,0),At.x=.5*Rt+.5,At.y=.5*Ut*kt+.5,mt.push(At.x,At.y),o.index++}for(let zt=0;zt<b;zt++){const Bt=xt+zt,Rt=Dt+zt;c===!0?nt.push(Rt,Rt+1,Bt):nt.push(Rt+1,Rt,Bt),Et+=3}at.push({start:ft,count:Et,materialIndex:c===!0?1:2}),o.groupStart+=Et}_generateData(o){let{radialSegments:c,heightSegments:d}=o;c=Math.floor(c),d=Math.floor(d);const _={indices:[],vertices:[],normals:[],uvs:[],numberOfVertices:0,groupStart:0,groups:[],index:0,indexArray:[],halfHeight:o.height/2,...o,radialSegments:c,heightSegments:d};return this._generateTorso(_),o.openEnded===!1&&(o.radiusTop>0&&this._generateCap(_,!0),o.radiusBottom>0&&this._generateCap(_,!1)),_}}class BoxGeometryGenerator extends AGeometryGenerator{constructor(){super(...arguments),this.defaultParams={width:1,height:1,depth:1,widthSegments:1,heightSegments:1,depthSegments:1}}_buildPlane(o,c,d,_,b,_e,it,nt,at,ut,pt,mt){const{indices:ft,vertices:vt,normals:xt,uvs:At,numberOfVertices:Ct,groupStart:Et,groups:Tt}=o,kt=it/ut,Dt=nt/pt,zt=it/2,Bt=nt/2,Rt=at/2,Ut=ut+1,Ht=pt+1;let Jt=0,Kt=0;const sr=new three_module.Pq0;for(let ir=0;ir<Ht;ir++){const cr=ir*Dt-Bt;for(let lr=0;lr<Ut;lr++){const hr=lr*kt-zt;sr[c]=hr*b,sr[d]=cr*_e,sr[_]=Rt,vt.push(sr.x,sr.y,sr.z),sr[c]=0,sr[d]=0,sr[_]=at>0?1:-1,xt.push(sr.x,sr.y,sr.z),At.push(lr/ut),At.push(1-ir/pt),Jt+=1}}for(let ir=0;ir<pt;ir++)for(let cr=0;cr<ut;cr++){const lr=Ct+cr+Ut*ir,hr=Ct+cr+Ut*(ir+1),dr=Ct+(cr+1)+Ut*(ir+1),pr=Ct+(cr+1)+Ut*ir;ft.push(lr,hr,pr),ft.push(hr,dr,pr),Kt+=6}Tt.push({start:Et,count:Kt,materialIndex:mt}),o.groupStart+=Kt,o.numberOfVertices+=Jt}_generateData(o){const{width:c,height:d,depth:_}=o;let{widthSegments:b,heightSegments:_e,depthSegments:it}=o;b=Math.floor(b),_e=Math.floor(_e),it=Math.floor(it);const nt={indices:[],vertices:[],normals:[],uvs:[],numberOfVertices:0,groupStart:0,groups:[]};return this._buildPlane(nt,"z","y","x",-1,-1,_,d,c,it,_e,0),this._buildPlane(nt,"z","y","x",1,-1,_,d,-c,it,_e,1),this._buildPlane(nt,"x","z","y",1,1,c,_,d,b,it,2),this._buildPlane(nt,"x","z","y",1,-1,c,_,-d,b,it,3),this._buildPlane(nt,"x","y","z",1,-1,c,d,_,b,_e,4),this._buildPlane(nt,"x","y","z",-1,-1,c,d,-_,b,_e,5),nt}}class GeometryGeneratorPlugin extends AViewerPlugin{constructor(){super(...arguments),this.enabled=!0,this.toJSON=void 0,this.generators={plane:new PlaneGeometryGenerator("plane"),sphere:new SphereGeometryGenerator("sphere"),box:new BoxGeometryGenerator("box"),circle:new CircleGeometryGenerator("circle"),torus:new TorusGeometryGenerator("torus"),cylinder:new CylinderGeometryGenerator("cylinder")},this._sceneUpdate=o=>{var c;if(o.hierarchyChanged){const d=o.object||((c=this._viewer)===null||c===void 0?void 0:c.scene.modelRoot);d&&d.traverse(_=>{var b,_e,it;const nt=(it=(_e=(b=_.geometry)===null||b===void 0?void 0:b.userData)===null||_e===void 0?void 0:_e.generationParams)===null||it===void 0?void 0:it.type;nt&&updateUi(_.geometry,()=>{var at;const ut=this.generators[nt];return ut!=null&&ut.createUiConfig&&(at=ut.createUiConfig(_.geometry))!==null&&at!==void 0?at:[]})})}},this.uiConfig={type:"folder",label:"Generate Geometry",children:[()=>Object.keys(this.generators).map(o=>({type:"button",label:"Generate "+o,value:async()=>{(await this.generateObject(o)).name=o}}))]}}async generateObject(o){var c,d;const _=this.generators[o];if(!_)throw new Error("Unknown generator type: "+o);const b=await((d=(c=this._viewer)===null||c===void 0?void 0:c.getManager())===null||d===void 0?void 0:d.addImportedSingle(new three_module.eaF(new three_module.LoY,new MeshStandardMaterial2({color:16711680})),{autoScale:!1,autoCenter:!1}));return _.generate(b.modelObject.geometry),b.name=o,b.geometry.name="Generated "+o,b.modelObject}async onAdded(o){await super.onAdded(o),o.scene.addEventListener("sceneUpdate",this._sceneUpdate)}}GeometryGeneratorPlugin.PluginType="GeometryGeneratorPlugin";var MaterialPresetPlugin_decorate=function(h,o,c,d){var _,b=arguments.length,_e=b<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_e=Reflect.decorate(h,o,c,d);else for(var it=h.length-1;it>=0;it--)(_=h[it])&&(_e=(b<3?_(_e):b>3?_(o,c,_e):_(o,c))||_e);return b>3&&_e&&Object.defineProperty(o,c,_e),_e};let MaterialPresetPlugin$1=class extends AViewerPlugin{constructor(){super(...arguments),this.serializeWithViewer=!1,this.enabled=!0,this.mapping=[],this.presets={},this.getMaterialPresetByName=h=>this.presets&&this.presets.length!=0?this.presets[h.type].find(o=>o.path.split("/").pop()==h.name):null,this.applyOnLoad=!0,this.replaceMaterial=!0}async onAdded(h){await super.onAdded(h)}loadPresets(h,o){this.presets=h,this.basePath=o,this.dispatchEvent({type:"loadPresets"})}async fromJSON(h,o){return h&&h.materials&&!h.mapping&&(h.mapping=h.materials,delete h.materials),super.fromJSON(h,o)?(this.applyOnLoad&&await this.applyAll(),this):null}async applyAll(){var h;const o=[];for(const c of this.mapping)o.push(this._apply(c.name,c.path,(h=c.regex)===null||h===void 0||h));await Promise.all(o)}async _apply(h,o,c=!0){var d,_,b,_e,it;const nt=(d=this._viewer)===null||d===void 0?void 0:d.getManager();if(!o||!h||!nt)return;o=(_=(o=(o!=null&&o.startsWith("https://")?"":this.basePath||"")+o)==null?void 0:o.replace)===null||_===void 0?void 0:_.call(o,/(https?:\/\/)|(\/)+/g,(pt,mt)=>mt||"/");let at=await((b=nt.importer)===null||b===void 0?void 0:b.importSinglePath(o));if(!at)return void console.warn("MaterialPresetPlugin: Material not found",o);this.replaceMaterial&&(at=at.clone?at.clone():at),at.name=h;const ut=new Set;(it=(_e=this._viewer)===null||_e===void 0?void 0:_e.scene)===null||it===void 0||it.traverse(pt=>{pt.material&&(c?pt.material.name.match("^"+h+"$"):pt.material.name===h)&&ut.add(pt)}),ut.forEach(pt=>{var mt,ft,vt;if(this.replaceMaterial||!pt.material){const xt=((mt=pt.material)===null||mt===void 0?void 0:mt.name)||pt.name;(ft=pt==null?void 0:pt.setMaterial)===null||ft===void 0||ft.call(pt,at),pt.material.name=xt}else{const xt=Array.isArray(pt.material)?pt.material:[pt.material];for(const At of xt)(vt=nt.materials)===null||vt===void 0||vt.copyMaterialProps(At,at)}})}async addMapping(h,o,c=!0){if(!h||!o)return;const d=this.mapping.findIndex(_=>_.name===h);return d!==-1?this.mapping[d]={name:h,path:o}:this.mapping.push({name:h,path:o}),c?this._apply(h,o):void 0}};MaterialPresetPlugin$1.PluginType="MaterialPresetPlugin",MaterialPresetPlugin_decorate([serialize()],MaterialPresetPlugin$1.prototype,"mapping",void 0);var TransfrSharePlugin_decorate=function(h,o,c,d){var _,b=arguments.length,_e=b<3?o:d===null?d=Object.getOwnPropertyDescriptor(o,c):d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_e=Reflect.decorate(h,o,c,d);else for(var it=h.length-1;it>=0;it--)(_=h[it])&&(_e=(b<3?_(_e):b>3?_(o,c,_e):_(o,c))||_e);return b>3&&_e&&Object.defineProperty(o,c,_e),_e};let TransfrSharePlugin=class extends AViewerPlugin{constructor(){super(...arguments),this.toJSON=null,this.enabled=!0,this.dependencies=[AssetExporterPlugin],this._exporting=!1}async exportObject(h){var o,c;const d=(o=this._viewer)===null||o===void 0?void 0:o.getPlugin(AssetExporterPlugin);if(!d)throw new Error("AssetExporterPlugin not found");return h?(c=d.exporter)===null||c===void 0?void 0:c.exportObject(h,{format:"glb"}):d.exportScene(d.exportOptions)}async getLink(h){var o;const c=await this.exportObject(h);if(!c)throw new Error("Failed to export object or scene");const d=await fetch("https://bee.transfr.one/model.glb",{method:"PUT",body:c});if(d.status!==200)throw new Error("Failed to upload file");const _=(o=await d.text())===null||o===void 0?void 0:o.trim();console.log(_);try{new URL(_)}catch{throw new Error("Invalid URL "+_)}return _}async shareLink(h,o="m"){var c;if(this._exporting)return;this._exporting=!0;let d=await this.getLink().catch(_=>{var b,_e;return(b=this._viewer)===null||b===void 0||b.console.error(_),(_e=this._viewer)===null||_e===void 0||_e.alert(`Error: Failed to share scene: 
`+_.message),null});if(d){if(h){const b=typeof h=="string"?new URL(h):h;b.searchParams.set(o??"m",d),d=b.href}let _=!1;try{window&&window.navigator&&navigator.clipboard&&(await navigator.clipboard.writeText(d),_=!0)}catch(b){console.error("Failed to copy link",b)}(c=this._viewer)===null||c===void 0||c.alert("Link"+(_?" Copied: ":": "+d)+`

Note: File will be deleted in 7 days`)}return this._exporting=!1,d}async shareEditorLink(){const h=new URL(window.location.href);return this.shareLink(h)}async shareViewerLink(){const h=new URL(window.location.href);return h.pathname=h.pathname.replace(/editor\.html$/,"viewer.html"),this.shareLink(h)}};TransfrSharePlugin.PluginType="TransfrSharePlugin",TransfrSharePlugin_decorate([uiButton("Share editor link")],TransfrSharePlugin.prototype,"shareEditorLink",null),TransfrSharePlugin_decorate([uiButton("Share viewer link")],TransfrSharePlugin.prototype,"shareViewerLink",null),TransfrSharePlugin=TransfrSharePlugin_decorate([uiFolder("Share Link")],TransfrSharePlugin);var ndarray_ndarray=__webpackgi_require__(881),ndarray_ops=__webpackgi_require__(49);function getPixelsInternal(h,o){if(!(h instanceof Uint8Array))throw new Error("[ndarray-pixels] Input must be Uint8Array or Buffer.");const c=new Blob([h],{type:o}),d=URL.createObjectURL(c);return new Promise((_,b)=>{const _e=new Image;_e.crossOrigin="anonymous",_e.onload=function(){URL.revokeObjectURL(d);const it=new OffscreenCanvas(_e.width,_e.height).getContext("2d");it.drawImage(_e,0,0);const nt=it.getImageData(0,0,_e.width,_e.height);_(ndarray_ndarray(new Uint8Array(nt.data),[_e.width,_e.height,4],[4,4*_e.width,1],0))},_e.onerror=it=>{URL.revokeObjectURL(d),b(it)},_e.src=d})}function putPixelData(h,o,c=-1){if(h.shape.length===4)return putPixelData(h.pick(c),o,0);if(h.shape.length===3)if(h.shape[2]===3)ndarray_ops.assign(ndarray_ndarray(o,[h.shape[0],h.shape[1],3],[4,4*h.shape[0],1]),h),ndarray_ops.assigns(ndarray_ndarray(o,[h.shape[0]*h.shape[1]],[4],3),255);else if(h.shape[2]===4)ndarray_ops.assign(ndarray_ndarray(o,[h.shape[0],h.shape[1],4],[4,4*h.shape[0],1]),h);else{if(h.shape[2]!==1)throw new Error("[ndarray-pixels] Incompatible array shape.");ndarray_ops.assign(ndarray_ndarray(o,[h.shape[0],h.shape[1],3],[4,4*h.shape[0],1]),ndarray_ndarray(h.data,[h.shape[0],h.shape[1],3],[h.stride[0],h.stride[1],0],h.offset)),ndarray_ops.assigns(ndarray_ndarray(o,[h.shape[0]*h.shape[1]],[4],3),255)}else{if(h.shape.length!==2)throw new Error("[ndarray-pixels] Incompatible array shape.");ndarray_ops.assign(ndarray_ndarray(o,[h.shape[0],h.shape[1],3],[4,4*h.shape[0],1]),ndarray_ndarray(h.data,[h.shape[0],h.shape[1],3],[h.stride[0],h.stride[1],0],h.offset)),ndarray_ops.assigns(ndarray_ndarray(o,[h.shape[0]*h.shape[1]],[4],3),255)}return o}async function savePixelsInternal(h,o){const c=new OffscreenCanvas(h.shape[0],h.shape[1]),d=c.getContext("2d"),_=d.getImageData(0,0,c.width,c.height);return putPixelData(h,_.data),d.putImageData(_,0,0),streamCanvas(c,o)}async function streamCanvas(h,o){const c=await h.convertToBlob(o),d=await c.arrayBuffer();return new Uint8Array(d)}async function ndarray_pixels_browser_modern_getPixels(h,o){return getPixelsInternal(h,o)}async function ndarray_pixels_browser_modern_savePixels(h,o){let c;return c={type:o,quality:void 0},savePixelsInternal(h,c)}function functions_modern_extends(){return functions_modern_extends=Object.assign?Object.assign.bind():function(h){for(var o=1;o<arguments.length;o++){var c=arguments[o];for(var d in c)({}).hasOwnProperty.call(c,d)&&(h[d]=c[d])}return h},functions_modern_extends.apply(null,arguments)}index_modern_Primitive.Mode;function createTransform(h,o){return Object.defineProperty(o,"name",{value:h}),o}async function rewriteTexture(h,o,c){if(!h)return null;const d=h.getImage();if(!d)return null;const _=await ndarray_pixels_browser_modern_getPixels(d,h.getMimeType());for(let _e=0;_e<_.shape[0];++_e)for(let it=0;it<_.shape[1];++it)c(_,_e,it);const b=await ndarray_pixels_browser_modern_savePixels(_,"image/png");return o.setImage(b).setMimeType("image/png")}var functions_modern_ARRAY_TYPE=typeof Float32Array<"u"?Float32Array:Array;function create$1(){var h=new functions_modern_ARRAY_TYPE(3);return functions_modern_ARRAY_TYPE!=Float32Array&&(h[0]=0,h[1]=0,h[2]=0),h}Math.hypot||(Math.hypot=function(){for(var h=0,o=arguments.length;o--;)h+=arguments[o]*arguments[o];return Math.sqrt(h)});create$1();index_modern_PropertyType.ACCESSOR,index_modern_PropertyType.MESH,index_modern_PropertyType.TEXTURE,index_modern_PropertyType.MATERIAL,index_modern_PropertyType.SKIN;function functions_modern_create(){var h=new functions_modern_ARRAY_TYPE(4);return functions_modern_ARRAY_TYPE!=Float32Array&&(h[0]=0,h[1]=0,h[2]=0,h[3]=0),h}functions_modern_create();index_modern_PropertyType.NODE,index_modern_PropertyType.SKIN,index_modern_PropertyType.MESH,index_modern_PropertyType.CAMERA,index_modern_PropertyType.PRIMITIVE,index_modern_PropertyType.PRIMITIVE_TARGET,index_modern_PropertyType.ANIMATION,index_modern_PropertyType.MATERIAL,index_modern_PropertyType.TEXTURE,index_modern_PropertyType.ACCESSOR,index_modern_PropertyType.BUFFER;var VertexCountMethod;(function(h){h.RENDER="render",h.RENDER_CACHED="render-cached",h.UPLOAD="upload",h.UPLOAD_NAIVE="upload-naive",h.DISTINCT="distinct",h.DISTINCT_POSITION="distinct-position",h.UNUSED="unused"})(VertexCountMethod||(VertexCountMethod={}));index_modern_Accessor.ComponentType;index_modern_Primitive.Mode;index_modern_Primitive.Mode;index_modern_AnimationChannel.TargetPath;const QUANTIZE_DEFAULTS={pattern:/.*/,quantizationVolume:"mesh",quantizePosition:14,quantizeNormal:10,quantizeTexcoord:12,quantizeColor:8,quantizeWeight:8,quantizeGeneric:12,normalizeWeights:!0,cleanup:!0};functions_modern_extends({level:"high"},QUANTIZE_DEFAULTS);const functions_modern_NAME$d="metalRough",METALROUGH_DEFAULTS={};function metalRough(h=METALROUGH_DEFAULTS){return createTransform(functions_modern_NAME$d,async o=>{const c=o.getLogger();if(!o.getRoot().listExtensionsUsed().map(it=>it.extensionName).includes("KHR_materials_pbrSpecularGlossiness"))return void c.warn(`${functions_modern_NAME$d}: KHR_materials_pbrSpecularGlossiness not found on document.`);const d=o.createExtension(KHRMaterialsIOR),_=o.createExtension(KHRMaterialsSpecular),b=o.createExtension(KHRMaterialsPBRSpecularGlossiness),_e=new Set;for(const it of o.getRoot().listMaterials()){const nt=it.getExtension("KHR_materials_pbrSpecularGlossiness");if(!nt)continue;const at=_.createSpecular().setSpecularFactor(1).setSpecularColorFactor(nt.getSpecularFactor());_e.add(nt.getSpecularGlossinessTexture()),_e.add(it.getBaseColorTexture()),_e.add(it.getMetallicRoughnessTexture()),it.setBaseColorFactor(nt.getDiffuseFactor()).setMetallicFactor(0).setRoughnessFactor(1).setExtension("KHR_materials_ior",d.createIOR().setIOR(1e3)).setExtension("KHR_materials_specular",at);const ut=nt.getDiffuseTexture();ut&&(it.setBaseColorTexture(ut),it.getBaseColorTextureInfo().copy(nt.getDiffuseTextureInfo()));const pt=nt.getSpecularGlossinessTexture();if(pt){const mt=nt.getSpecularGlossinessTextureInfo(),ft=o.createTexture();await rewriteTexture(pt,ft,(At,Ct,Et)=>{At.set(Ct,Et,3,255)}),at.setSpecularTexture(ft),at.setSpecularColorTexture(ft),at.getSpecularTextureInfo().copy(mt),at.getSpecularColorTextureInfo().copy(mt);const vt=nt.getGlossinessFactor(),xt=o.createTexture();await rewriteTexture(pt,xt,(At,Ct,Et)=>{const Tt=255-Math.round(At.get(Ct,Et,3)*vt);At.set(Ct,Et,0,0),At.set(Ct,Et,1,Tt),At.set(Ct,Et,2,0),At.set(Ct,Et,3,255)}),it.setMetallicRoughnessTexture(xt),it.getMetallicRoughnessTextureInfo().copy(mt)}else at.setSpecularColorFactor(nt.getSpecularFactor()),it.setRoughnessFactor(1-nt.getGlossinessFactor());it.setExtension("KHR_materials_pbrSpecularGlossiness",null)}b.dispose();for(const it of _e)it&&it.listParents().length===1&&it.dispose();c.debug(`${functions_modern_NAME$d}: Complete.`)})}var InterpolationInternal;(function(h){h[h.STEP=0]="STEP",h[h.LERP=1]="LERP",h[h.SLERP=2]="SLERP"})(InterpolationInternal||(InterpolationInternal={}));Promise.resolve();index_modern_Primitive.Mode;var TextureResizeFilter;(function(h){h.LANCZOS3="lanczos3",h.LANCZOS2="lanczos2"})(TextureResizeFilter||(TextureResizeFilter={}));TextureResizeFilter.LANCZOS3;const gltfKhrPbrSpecularGlossinessConverter=h=>o=>({name:"KHR_materials_pbrSpecularGlossiness",beforeRoot:async()=>{var c,d;try{if(!o.json.extensionsUsed.includes("KHR_materials_pbrSpecularGlossiness")||h&&!await h("Convert KHR_materials_pbrSpecularGlossiness to KHR_materials_pbrMetallicRoughness?"))return;const _=o.json,b=new WebIO().registerExtensions(ALL_EXTENSIONS).registerExtensions(ALL_WEBGI_EXTENSIONS);if(o.extensions.KHR_draco_mesh_compression){const at=o.extensions.KHR_draco_mesh_compression.dracoLoader;if(!at.isDRACOLoader2)return void console.error("DRACOLoader2 required for gltfKhrPbrSpecularGlossinessConverter");const ut=await at.initDecoder();b.registerDependencies({"draco3d.decoder":ut})}const _e=await b.readJSON({json:_,resources:{"@glb.bin":new Uint8Array((c=o.extensions.KHR_binary_glTF)===null||c===void 0?void 0:c.body)}});await _e.transform(metalRough()),o.extensions.KHR_draco_mesh_compression&&((d=_e.getRoot().listExtensionsUsed().find(at=>at.extensionName==="KHR_draco_mesh_compression"))===null||d===void 0||d.dispose());const it=await b.writeBinary(_e),nt=new GLTFBinaryExtension(it.buffer);o.extensions.KHR_binary_glTF=nt,o.json=JSON.parse(nt.content)}catch(_){return void console.error(_)}}});class GLTFSpecGlossinessConverterPlugin extends AViewerPlugin{_loaderCreate({loader:o}){o.isGLTFLoader2&&o.register(gltfKhrPbrSpecularGlossinessConverter(async c=>{var d,_;return!!this.enabled&&(!this.confirm||(_=(d=this._viewer)===null||d===void 0?void 0:d.confirm(this.confirmMessage||c))===null||_===void 0||_)}))}constructor(){super(),this.enabled=!0,this.toJSON=void 0,this.dependencies=[AssetManagerPlugin],this.confirm=!0,this.confirmMessage="GLTF Load: This file includes specular glossiness materials, do you want to convert it to metallic roughness before load?",this._loaderCreate=this._loaderCreate.bind(this)}async onAdded(o){var c;await super.onAdded(o);const d=o.getPlugin(AssetManagerPlugin);(c=d==null?void 0:d.importer)===null||c===void 0||c.addEventListener("loaderCreate",this._loaderCreate)}async onRemove(o){var c,d;return(d=(c=o.getPlugin(AssetManagerPlugin))===null||c===void 0?void 0:c.importer)===null||d===void 0||d.removeEventListener("loaderCreate",this._loaderCreate),super.onRemove(o)}}GLTFSpecGlossinessConverterPlugin.PluginType="GLTFSpecGlossinessConverterPlugin";var RainbowDiamondPlugin_decorate=function(h,o,c,d){var _,b=arguments.length,_e=b<3?o:d===null?d=Object.getOwnPropertyDescriptor(o,c):d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_e=Reflect.decorate(h,o,c,d);else for(var it=h.length-1;it>=0;it--)(_=h[it])&&(_e=(b<3?_(_e):b>3?_(o,c,_e):_(o,c))||_e);return b>3&&_e&&Object.defineProperty(o,c,_e),_e};let RainbowDiamondPlugin=class extends AViewerPlugin{constructor(){super(...arguments),this.enabled=!0,this.toJSON=void 0,this.prefix="",this.count=50,this.loops=1,this.color=new three_module.Q1f().setHSL(0,.8,.5)}colorItems(){if(!this._viewer)return;const h=this._viewer.scene.modelRoot;let o=0;const c=this.color.getHSL({h:0,s:0,l:0});h.traverse(d=>{const _=d.material&&d.material.isDiamondMaterial,b=_&&d.name.startsWith(this.prefix);if(_&&console.log("Found Diamond, name = ",d.name,", coloring = ",b),b){let _e=d.name.replace(this.prefix,"");_e=parseFloat(_e)/this.count;const it=new three_module.Q1f().setHSL((this.loops*_e+c.h)%1,c.s,c.l);d.material=d.material.userData.isColoredClone?d.material:d.material.clone(),d.material.color.set(it),d.material.boostFactors.set(1,1,1),d.material.userData.isColoredClone=!0,o++}}),console.log("total",o),this._viewer.setDirty()}};RainbowDiamondPlugin.PluginType="RainbowDiamondPlugin",RainbowDiamondPlugin_decorate([uiInput("Object name prefix")],RainbowDiamondPlugin.prototype,"prefix",void 0),RainbowDiamondPlugin_decorate([uiInput("Count")],RainbowDiamondPlugin.prototype,"count",void 0),RainbowDiamondPlugin_decorate([uiInput("Loops")],RainbowDiamondPlugin.prototype,"loops",void 0),RainbowDiamondPlugin_decorate([uiColor("First Color")],RainbowDiamondPlugin.prototype,"color",void 0),RainbowDiamondPlugin_decorate([uiButton("Color All Items")],RainbowDiamondPlugin.prototype,"colorItems",null),RainbowDiamondPlugin=RainbowDiamondPlugin_decorate([uiFolder("Rainbow Diamond Coloring")],RainbowDiamondPlugin);class BeringRingAnimation extends AViewerPlugin{constructor(){super(...arguments),this.enabled=!0,this.toJSON=null,this.ringSlots=[],this.dependencies=[AssetManagerPlugin,PopmotionPlugin],this._animating=!1,this._runningAnimations=[],this.uiConfig={type:"folder",label:"Bering Animation",children:[{label:"Play Animation",type:"button",value:()=>{this.startRingAnimation(!1)}},{label:"Record Animation",type:"button",value:async()=>{var o;const c=(o=this._viewer)===null||o===void 0?void 0:o.getPluginByType("CanvasRecorder");if(!c||c.isRecording())return;this.animating&&this.stopRingAnimation(!1),await X$2(500);const d=await c.record(async()=>{console.log("start"),await this.startRingAnimation(!1),console.log("finish")});d&&(console.log("recorded",d),N$2(d,"animation.mp4"))}}]}}get animating(){return this._animating}set animating(o){var c,d;if(this._animating===o)return;this._animating=o;const _=(c=this._viewer)===null||c===void 0?void 0:c.getPlugin(FrameFadePlugin);_&&(o?_.disable("bering"):_.enable("bering"));const b=(d=this._viewer)===null||d===void 0?void 0:d.getPlugin(TemporalAAPlugin);b&&(b.enabled=!o)}async onAdded(o){await super.onAdded(o),o.scene.addEventListener("addSceneObject",c=>{var d,_,b,_e,it;if(!(!((_=(d=c.options)===null||d===void 0?void 0:d.allImported)===null||_===void 0)&&_.length)||!c.object||!c.object.__importedViewerConfig&&!(!((b=c.object.modelObject)===null||b===void 0)&&b.__importedViewerConfig)||!(!((_e=c.options)===null||_e===void 0)&&_e.allImported))return;let nt=0;const at=(it=c.options)===null||it===void 0?void 0:it.allImported.filter(ut=>!!(ut&&ut.modelObject&&ut.name.endsWith("bmod"))).reverse();at.forEach(ut=>{this.loadRingBMod(ut,ut.name,nt,at.length-1),nt++})})}loadRingBMod(o,c,d,_){var b,_e,it;if(!c)return;if(!(!((b=this._viewer)===null||b===void 0)&&b.getPlugin(AssetManagerPlugin)))throw new Error("no asset manager");this._runningAnimations&&this.stopRingAnimation(),c.endsWith(".bmod")||(c+=".bmod");const nt=o==null?void 0:o.modelObject;if(!nt||!o)throw new Error("no model");nt.userData.__ringSlot=d,this.ringSlots[d]=o;const at=[];nt.traverse(pt=>{pt.userData.rotationCount>1&&at.push(pt)}),new Box3B().expandByObjects(at,!0,!0),c.toLowerCase().includes("x3")||c.toLowerCase().includes("x4");const ut=parseInt(c.split("-").pop().toLowerCase().replace("x","").replace(".bmod",""))+1;return nt.userData.__ringWidth=ut,nt.userData.__ringTotalSlots=_,(it=(_e=this._viewer)===null||_e===void 0?void 0:_e.scene)===null||it===void 0||it.setDirty({sceneUpdate:!0,frameFade:!1}),o}clearAllSlots(){this.ringSlots.forEach(o=>{o.modelObject.removeFromParent()}),this.ringSlots=[]}stopRingAnimation(o=!0){var c,d;if(this._runningAnimations.length!==0){for(const _ of this._runningAnimations)_.stop();this._runningAnimations=[],o&&((d=(c=this._viewer)===null||c===void 0?void 0:c.getPlugin(FrameFadePlugin))===null||d===void 0||d.startTransition(1200))}}async startRingAnimation(o=!0){if(this.animating||!this._viewer)return;this.stopRingAnimation(),this.animating=!0;let c=0;const d=[];await new Promise(_=>{var b,_e,it;if(!this._viewer)return;const nt=()=>{c+=1,c<d.length||_()},at=2500,ut=this._viewer.getPlugin(PopmotionPlugin),pt=this.ringSlots[0];if(pt){const mt=pt.modelObject,ft={left:[],right:[],rem:[]};mt.traverse(At=>{const Ct=(At==null?void 0:At.name.trim().toLowerCase().replace(/[0-9]/g,""))||"";Ct.endsWith("-s")?ft.left.push(At):Ct.endsWith("-l")?ft.right.push(At):Ct.startsWith("testlogo")&&ft.rem.push(At)});const vt=[];for(const At of ft.left){const Ct=((b=At.parent)===null||b===void 0?void 0:b.children)||[];vt.push(...Ct)}for(const At of ft.right){const Ct=((_e=At.parent)===null||_e===void 0?void 0:_e.children)||[];vt.push(...Ct)}for(const At of vt)ft.left.includes(At)||ft.right.includes(At)||ft.rem.includes(At)||ft.rem.push(At);for(const At of ft.rem)new Box3B().expandByObject(At,!1,!0).getCenter(new three_module.Pq0).x<=0?ft.left.push(At):ft.right.push(At);for(const At of[...ft.left,...ft.right])At.userData.__initX=At.position.x,At.userData.__initRotX=At.rotation.x;const xt=(it=this._viewer)===null||it===void 0?void 0:it.getPluginByType("Ground");if(ft.left.length>0&&ft.right.length>0){const At=Et=>Tt=>{var kt,Dt,zt;for(const Bt of ft[Et])Bt.position.x=Tt+Bt.userData.__initX;(Dt=(kt=this._viewer)===null||kt===void 0?void 0:kt.scene)===null||Dt===void 0||Dt.setDirty({sceneUpdate:!1,frameFade:!1}),o&&((zt=xt==null?void 0:xt.shadowBaker)===null||zt===void 0||zt.reset())},Ct=Et=>Tt=>{var kt,Dt;for(const zt of ft[Et])zt.rotation.x=Tt+zt.userData.__initRotX;(Dt=(kt=this._viewer)===null||kt===void 0?void 0:kt.scene)===null||Dt===void 0||Dt.setDirty({sceneUpdate:!1,frameFade:!1})};d.push(ut.animate({from:0,to:-.75,onUpdate:At("left"),onStop:()=>{At("left")(0),nt()},onComplete:nt,duration:at,ease:EasingFunctions.easeInOut,repeat:1,repeatDelay:250,repeatType:"mirror"})),d.push(ut.animate({from:0,to:.75,onUpdate:At("right"),onStop:()=>{At("right")(0),nt()},onComplete:nt,duration:at,ease:EasingFunctions.easeInOut,repeat:1,repeatDelay:250,repeatType:"mirror"})),d.push(ut.animate({from:0,to:1.5*-Math.PI,onUpdate:Ct("left"),onStop:()=>{Ct("left")(0),nt()},onComplete:nt,duration:1250,ease:EasingFunctions.easeInOut,repeat:1,repeatDelay:2750,repeatType:"mirror"}))}}this.ringSlots.forEach(mt=>{if(pt===mt)return;const ft=mt.modelObject.userData.__ringSlot,vt=mt.modelObject.userData.__ringTotalSlots,xt=mt.modelObject.userData.__ringWidth,At=mt.modelObject.position.x;d.push(ut.animate({from:At,to:At+.75-1.5*(1-(ft+1)/(vt+1+(2-xt))),onUpdate:Ct=>{var Et,Tt;mt.modelObject.position.x=Ct,(Tt=(Et=this._viewer)===null||Et===void 0?void 0:Et.scene)===null||Tt===void 0||Tt.setDirty({sceneUpdate:!1,frameFade:!1})},onStop:()=>{mt.modelObject.position.x=At,nt()},onComplete:nt,duration:at,ease:EasingFunctions.easeInOut,repeat:1,repeatDelay:250,repeatType:"mirror"}))}),d.length>0?this._runningAnimations=d:(this.animating=!1,_())}),this.animating=!1;for(const _ of this._runningAnimations)_.stop();this._runningAnimations=[],console.log("animation end")}}BeringRingAnimation.PluginType="BeringRingAnimation";class Mat3{constructor(o){o===void 0&&(o=[0,0,0,0,0,0,0,0,0]),this.elements=o}identity(){const o=this.elements;o[0]=1,o[1]=0,o[2]=0,o[3]=0,o[4]=1,o[5]=0,o[6]=0,o[7]=0,o[8]=1}setZero(){const o=this.elements;o[0]=0,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=0,o[6]=0,o[7]=0,o[8]=0}setTrace(o){const c=this.elements;c[0]=o.x,c[4]=o.y,c[8]=o.z}getTrace(o){o===void 0&&(o=new Vec3);const c=this.elements;return o.x=c[0],o.y=c[4],o.z=c[8],o}vmult(o,c){c===void 0&&(c=new Vec3);const d=this.elements,_=o.x,b=o.y,_e=o.z;return c.x=d[0]*_+d[1]*b+d[2]*_e,c.y=d[3]*_+d[4]*b+d[5]*_e,c.z=d[6]*_+d[7]*b+d[8]*_e,c}smult(o){for(let c=0;c<this.elements.length;c++)this.elements[c]*=o}mmult(o,c){c===void 0&&(c=new Mat3);const d=this.elements,_=o.elements,b=c.elements,_e=d[0],it=d[1],nt=d[2],at=d[3],ut=d[4],pt=d[5],mt=d[6],ft=d[7],vt=d[8],xt=_[0],At=_[1],Ct=_[2],Et=_[3],Tt=_[4],kt=_[5],Dt=_[6],zt=_[7],Bt=_[8];return b[0]=_e*xt+it*Et+nt*Dt,b[1]=_e*At+it*Tt+nt*zt,b[2]=_e*Ct+it*kt+nt*Bt,b[3]=at*xt+ut*Et+pt*Dt,b[4]=at*At+ut*Tt+pt*zt,b[5]=at*Ct+ut*kt+pt*Bt,b[6]=mt*xt+ft*Et+vt*Dt,b[7]=mt*At+ft*Tt+vt*zt,b[8]=mt*Ct+ft*kt+vt*Bt,c}scale(o,c){c===void 0&&(c=new Mat3);const d=this.elements,_=c.elements;for(let b=0;b!==3;b++)_[3*b+0]=o.x*d[3*b+0],_[3*b+1]=o.y*d[3*b+1],_[3*b+2]=o.z*d[3*b+2];return c}solve(o,c){c===void 0&&(c=new Vec3);const d=[];let _,b;for(_=0;_<12;_++)d.push(0);for(_=0;_<3;_++)for(b=0;b<3;b++)d[_+4*b]=this.elements[_+3*b];d[3]=o.x,d[7]=o.y,d[11]=o.z;let _e=3;const it=_e;let nt,at;do{if(_=it-_e,d[_+4*_]===0){for(b=_+1;b<it;b++)if(d[_+4*b]!==0){nt=4;do at=4-nt,d[at+4*_]+=d[at+4*b];while(--nt);break}}if(d[_+4*_]!==0)for(b=_+1;b<it;b++){const ut=d[_+4*b]/d[_+4*_];nt=4;do at=4-nt,d[at+4*b]=at<=_?0:d[at+4*b]-d[at+4*_]*ut;while(--nt)}}while(--_e);if(c.z=d[11]/d[10],c.y=(d[7]-d[6]*c.z)/d[5],c.x=(d[3]-d[2]*c.z-d[1]*c.y)/d[0],isNaN(c.x)||isNaN(c.y)||isNaN(c.z)||c.x===1/0||c.y===1/0||c.z===1/0)throw`Could not solve equation! Got x=[${c.toString()}], b=[${o.toString()}], A=[${this.toString()}]`;return c}e(o,c,d){if(d===void 0)return this.elements[c+3*o];this.elements[c+3*o]=d}copy(o){for(let c=0;c<o.elements.length;c++)this.elements[c]=o.elements[c];return this}toString(){let o="";for(let c=0;c<9;c++)o+=this.elements[c]+",";return o}reverse(o){o===void 0&&(o=new Mat3);const c=reverse_eqns;let d,_;for(d=0;d<3;d++)for(_=0;_<3;_++)c[d+6*_]=this.elements[d+3*_];c[3]=1,c[9]=0,c[15]=0,c[4]=0,c[10]=1,c[16]=0,c[5]=0,c[11]=0,c[17]=1;let b=3;const _e=b;let it,nt;do{if(d=_e-b,c[d+6*d]===0){for(_=d+1;_<_e;_++)if(c[d+6*_]!==0){it=6;do nt=6-it,c[nt+6*d]+=c[nt+6*_];while(--it);break}}if(c[d+6*d]!==0)for(_=d+1;_<_e;_++){const at=c[d+6*_]/c[d+6*d];it=6;do nt=6-it,c[nt+6*_]=nt<=d?0:c[nt+6*_]-c[nt+6*d]*at;while(--it)}}while(--b);d=2;do{_=d-1;do{const at=c[d+6*_]/c[d+6*d];it=6;do nt=6-it,c[nt+6*_]=c[nt+6*_]-c[nt+6*d]*at;while(--it)}while(_--)}while(--d);d=2;do{const at=1/c[d+6*d];it=6;do nt=6-it,c[nt+6*d]=c[nt+6*d]*at;while(--it)}while(d--);d=2;do{_=2;do{if(nt=c[3+_+6*d],isNaN(nt)||nt===1/0)throw`Could not reverse! A=[${this.toString()}]`;o.e(d,_,nt)}while(_--)}while(d--);return o}setRotationFromQuaternion(o){const c=o.x,d=o.y,_=o.z,b=o.w,_e=c+c,it=d+d,nt=_+_,at=c*_e,ut=c*it,pt=c*nt,mt=d*it,ft=d*nt,vt=_*nt,xt=b*_e,At=b*it,Ct=b*nt,Et=this.elements;return Et[0]=1-(mt+vt),Et[1]=ut-Ct,Et[2]=pt+At,Et[3]=ut+Ct,Et[4]=1-(at+vt),Et[5]=ft-xt,Et[6]=pt-At,Et[7]=ft+xt,Et[8]=1-(at+mt),this}transpose(o){o===void 0&&(o=new Mat3);const c=this.elements,d=o.elements;let _;return d[0]=c[0],d[4]=c[4],d[8]=c[8],_=c[1],d[1]=c[3],d[3]=_,_=c[2],d[2]=c[6],d[6]=_,_=c[5],d[5]=c[7],d[7]=_,o}}const reverse_eqns=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];class Vec3{constructor(o,c,d){o===void 0&&(o=0),c===void 0&&(c=0),d===void 0&&(d=0),this.x=o,this.y=c,this.z=d}cross(o,c){c===void 0&&(c=new Vec3);const d=o.x,_=o.y,b=o.z,_e=this.x,it=this.y,nt=this.z;return c.x=it*b-nt*_,c.y=nt*d-_e*b,c.z=_e*_-it*d,c}set(o,c,d){return this.x=o,this.y=c,this.z=d,this}setZero(){this.x=this.y=this.z=0}vadd(o,c){if(!c)return new Vec3(this.x+o.x,this.y+o.y,this.z+o.z);c.x=o.x+this.x,c.y=o.y+this.y,c.z=o.z+this.z}vsub(o,c){if(!c)return new Vec3(this.x-o.x,this.y-o.y,this.z-o.z);c.x=this.x-o.x,c.y=this.y-o.y,c.z=this.z-o.z}crossmat(){return new Mat3([0,-this.z,this.y,this.z,0,-this.x,-this.y,this.x,0])}normalize(){const o=this.x,c=this.y,d=this.z,_=Math.sqrt(o*o+c*c+d*d);if(_>0){const b=1/_;this.x*=b,this.y*=b,this.z*=b}else this.x=0,this.y=0,this.z=0;return _}unit(o){o===void 0&&(o=new Vec3);const c=this.x,d=this.y,_=this.z;let b=Math.sqrt(c*c+d*d+_*_);return b>0?(b=1/b,o.x=c*b,o.y=d*b,o.z=_*b):(o.x=1,o.y=0,o.z=0),o}length(){const o=this.x,c=this.y,d=this.z;return Math.sqrt(o*o+c*c+d*d)}lengthSquared(){return this.dot(this)}distanceTo(o){const c=this.x,d=this.y,_=this.z,b=o.x,_e=o.y,it=o.z;return Math.sqrt((b-c)*(b-c)+(_e-d)*(_e-d)+(it-_)*(it-_))}distanceSquared(o){const c=this.x,d=this.y,_=this.z,b=o.x,_e=o.y,it=o.z;return(b-c)*(b-c)+(_e-d)*(_e-d)+(it-_)*(it-_)}scale(o,c){c===void 0&&(c=new Vec3);const d=this.x,_=this.y,b=this.z;return c.x=o*d,c.y=o*_,c.z=o*b,c}vmul(o,c){return c===void 0&&(c=new Vec3),c.x=o.x*this.x,c.y=o.y*this.y,c.z=o.z*this.z,c}addScaledVector(o,c,d){return d===void 0&&(d=new Vec3),d.x=this.x+o*c.x,d.y=this.y+o*c.y,d.z=this.z+o*c.z,d}dot(o){return this.x*o.x+this.y*o.y+this.z*o.z}isZero(){return this.x===0&&this.y===0&&this.z===0}negate(o){return o===void 0&&(o=new Vec3),o.x=-this.x,o.y=-this.y,o.z=-this.z,o}tangents(o,c){const d=this.length();if(d>0){const _=Vec3_tangents_n,b=1/d;_.set(this.x*b,this.y*b,this.z*b);const _e=Vec3_tangents_randVec;Math.abs(_.x)<.9?(_e.set(1,0,0),_.cross(_e,o)):(_e.set(0,1,0),_.cross(_e,o)),_.cross(o,c)}else o.set(1,0,0),c.set(0,1,0)}toString(){return`${this.x},${this.y},${this.z}`}toArray(){return[this.x,this.y,this.z]}copy(o){return this.x=o.x,this.y=o.y,this.z=o.z,this}lerp(o,c,d){const _=this.x,b=this.y,_e=this.z;d.x=_+(o.x-_)*c,d.y=b+(o.y-b)*c,d.z=_e+(o.z-_e)*c}almostEquals(o,c){return c===void 0&&(c=1e-6),!(Math.abs(this.x-o.x)>c||Math.abs(this.y-o.y)>c||Math.abs(this.z-o.z)>c)}almostZero(o){return o===void 0&&(o=1e-6),!(Math.abs(this.x)>o||Math.abs(this.y)>o||Math.abs(this.z)>o)}isAntiparallelTo(o,c){return this.negate(antip_neg),antip_neg.almostEquals(o,c)}clone(){return new Vec3(this.x,this.y,this.z)}}Vec3.ZERO=new Vec3(0,0,0),Vec3.UNIT_X=new Vec3(1,0,0),Vec3.UNIT_Y=new Vec3(0,1,0),Vec3.UNIT_Z=new Vec3(0,0,1);const Vec3_tangents_n=new Vec3,Vec3_tangents_randVec=new Vec3,antip_neg=new Vec3;class AABB{constructor(o){o===void 0&&(o={}),this.lowerBound=new Vec3,this.upperBound=new Vec3,o.lowerBound&&this.lowerBound.copy(o.lowerBound),o.upperBound&&this.upperBound.copy(o.upperBound)}setFromPoints(o,c,d,_){const b=this.lowerBound,_e=this.upperBound,it=d;b.copy(o[0]),it&&it.vmult(b,b),_e.copy(b);for(let nt=1;nt<o.length;nt++){let at=o[nt];it&&(it.vmult(at,tmp$1),at=tmp$1),at.x>_e.x&&(_e.x=at.x),at.x<b.x&&(b.x=at.x),at.y>_e.y&&(_e.y=at.y),at.y<b.y&&(b.y=at.y),at.z>_e.z&&(_e.z=at.z),at.z<b.z&&(b.z=at.z)}return c&&(c.vadd(b,b),c.vadd(_e,_e)),_&&(b.x-=_,b.y-=_,b.z-=_,_e.x+=_,_e.y+=_,_e.z+=_),this}copy(o){return this.lowerBound.copy(o.lowerBound),this.upperBound.copy(o.upperBound),this}clone(){return new AABB().copy(this)}extend(o){this.lowerBound.x=Math.min(this.lowerBound.x,o.lowerBound.x),this.upperBound.x=Math.max(this.upperBound.x,o.upperBound.x),this.lowerBound.y=Math.min(this.lowerBound.y,o.lowerBound.y),this.upperBound.y=Math.max(this.upperBound.y,o.upperBound.y),this.lowerBound.z=Math.min(this.lowerBound.z,o.lowerBound.z),this.upperBound.z=Math.max(this.upperBound.z,o.upperBound.z)}overlaps(o){const c=this.lowerBound,d=this.upperBound,_=o.lowerBound,b=o.upperBound,_e=_.x<=d.x&&d.x<=b.x||c.x<=b.x&&b.x<=d.x,it=_.y<=d.y&&d.y<=b.y||c.y<=b.y&&b.y<=d.y,nt=_.z<=d.z&&d.z<=b.z||c.z<=b.z&&b.z<=d.z;return _e&&it&&nt}volume(){const o=this.lowerBound,c=this.upperBound;return(c.x-o.x)*(c.y-o.y)*(c.z-o.z)}contains(o){const c=this.lowerBound,d=this.upperBound,_=o.lowerBound,b=o.upperBound;return c.x<=_.x&&d.x>=b.x&&c.y<=_.y&&d.y>=b.y&&c.z<=_.z&&d.z>=b.z}getCorners(o,c,d,_,b,_e,it,nt){const at=this.lowerBound,ut=this.upperBound;o.copy(at),c.set(ut.x,at.y,at.z),d.set(ut.x,ut.y,at.z),_.set(at.x,ut.y,ut.z),b.set(ut.x,at.y,ut.z),_e.set(at.x,ut.y,at.z),it.set(at.x,at.y,ut.z),nt.copy(ut)}toLocalFrame(o,c){const d=transformIntoFrame_corners,_=d[0],b=d[1],_e=d[2],it=d[3],nt=d[4],at=d[5],ut=d[6],pt=d[7];this.getCorners(_,b,_e,it,nt,at,ut,pt);for(let mt=0;mt!==8;mt++){const ft=d[mt];o.pointToLocal(ft,ft)}return c.setFromPoints(d)}toWorldFrame(o,c){const d=transformIntoFrame_corners,_=d[0],b=d[1],_e=d[2],it=d[3],nt=d[4],at=d[5],ut=d[6],pt=d[7];this.getCorners(_,b,_e,it,nt,at,ut,pt);for(let mt=0;mt!==8;mt++){const ft=d[mt];o.pointToWorld(ft,ft)}return c.setFromPoints(d)}overlapsRay(o){const{direction:c,from:d}=o,_=1/c.x,b=1/c.y,_e=1/c.z,it=(this.lowerBound.x-d.x)*_,nt=(this.upperBound.x-d.x)*_,at=(this.lowerBound.y-d.y)*b,ut=(this.upperBound.y-d.y)*b,pt=(this.lowerBound.z-d.z)*_e,mt=(this.upperBound.z-d.z)*_e,ft=Math.max(Math.max(Math.min(it,nt),Math.min(at,ut)),Math.min(pt,mt)),vt=Math.min(Math.min(Math.max(it,nt),Math.max(at,ut)),Math.max(pt,mt));return!(vt<0||ft>vt)}}const tmp$1=new Vec3,transformIntoFrame_corners=[new Vec3,new Vec3,new Vec3,new Vec3,new Vec3,new Vec3,new Vec3,new Vec3];class ArrayCollisionMatrix{constructor(){this.matrix=[]}get(o,c){let{index:d}=o,{index:_}=c;if(_>d){const b=_;_=d,d=b}return this.matrix[(d*(d+1)>>1)+_-1]}set(o,c,d){let{index:_}=o,{index:b}=c;if(b>_){const _e=b;b=_,_=_e}this.matrix[(_*(_+1)>>1)+b-1]=d?1:0}reset(){for(let o=0,c=this.matrix.length;o!==c;o++)this.matrix[o]=0}setNumObjects(o){this.matrix.length=o*(o-1)>>1}}class EventTarget{addEventListener(o,c){this._listeners===void 0&&(this._listeners={});const d=this._listeners;return d[o]===void 0&&(d[o]=[]),d[o].includes(c)||d[o].push(c),this}hasEventListener(o,c){if(this._listeners===void 0)return!1;const d=this._listeners;return!(d[o]===void 0||!d[o].includes(c))}hasAnyEventListener(o){return this._listeners!==void 0&&this._listeners[o]!==void 0}removeEventListener(o,c){if(this._listeners===void 0)return this;const d=this._listeners;if(d[o]===void 0)return this;const _=d[o].indexOf(c);return _!==-1&&d[o].splice(_,1),this}dispatchEvent(o){if(this._listeners===void 0)return this;const c=this._listeners[o.type];if(c!==void 0){o.target=this;for(let d=0,_=c.length;d<_;d++)c[d].call(this,o)}return this}}class Quaternion{constructor(o,c,d,_){o===void 0&&(o=0),c===void 0&&(c=0),d===void 0&&(d=0),_===void 0&&(_=1),this.x=o,this.y=c,this.z=d,this.w=_}set(o,c,d,_){return this.x=o,this.y=c,this.z=d,this.w=_,this}toString(){return`${this.x},${this.y},${this.z},${this.w}`}toArray(){return[this.x,this.y,this.z,this.w]}setFromAxisAngle(o,c){const d=Math.sin(.5*c);return this.x=o.x*d,this.y=o.y*d,this.z=o.z*d,this.w=Math.cos(.5*c),this}toAxisAngle(o){o===void 0&&(o=new Vec3),this.normalize();const c=2*Math.acos(this.w),d=Math.sqrt(1-this.w*this.w);return d<.001?(o.x=this.x,o.y=this.y,o.z=this.z):(o.x=this.x/d,o.y=this.y/d,o.z=this.z/d),[o,c]}setFromVectors(o,c){if(o.isAntiparallelTo(c)){const d=sfv_t1,_=sfv_t2;o.tangents(d,_),this.setFromAxisAngle(d,Math.PI)}else{const d=o.cross(c);this.x=d.x,this.y=d.y,this.z=d.z,this.w=Math.sqrt(o.length()**2*c.length()**2)+o.dot(c),this.normalize()}return this}mult(o,c){c===void 0&&(c=new Quaternion);const d=this.x,_=this.y,b=this.z,_e=this.w,it=o.x,nt=o.y,at=o.z,ut=o.w;return c.x=d*ut+_e*it+_*at-b*nt,c.y=_*ut+_e*nt+b*it-d*at,c.z=b*ut+_e*at+d*nt-_*it,c.w=_e*ut-d*it-_*nt-b*at,c}inverse(o){o===void 0&&(o=new Quaternion);const c=this.x,d=this.y,_=this.z,b=this.w;this.conjugate(o);const _e=1/(c*c+d*d+_*_+b*b);return o.x*=_e,o.y*=_e,o.z*=_e,o.w*=_e,o}conjugate(o){return o===void 0&&(o=new Quaternion),o.x=-this.x,o.y=-this.y,o.z=-this.z,o.w=this.w,o}normalize(){let o=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return o===0?(this.x=0,this.y=0,this.z=0,this.w=0):(o=1/o,this.x*=o,this.y*=o,this.z*=o,this.w*=o),this}normalizeFast(){const o=(3-(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w))/2;return o===0?(this.x=0,this.y=0,this.z=0,this.w=0):(this.x*=o,this.y*=o,this.z*=o,this.w*=o),this}vmult(o,c){c===void 0&&(c=new Vec3);const d=o.x,_=o.y,b=o.z,_e=this.x,it=this.y,nt=this.z,at=this.w,ut=at*d+it*b-nt*_,pt=at*_+nt*d-_e*b,mt=at*b+_e*_-it*d,ft=-_e*d-it*_-nt*b;return c.x=ut*at+ft*-_e+pt*-nt-mt*-it,c.y=pt*at+ft*-it+mt*-_e-ut*-nt,c.z=mt*at+ft*-nt+ut*-it-pt*-_e,c}copy(o){return this.x=o.x,this.y=o.y,this.z=o.z,this.w=o.w,this}toEuler(o,c){let d,_,b;c===void 0&&(c="YZX");const _e=this.x,it=this.y,nt=this.z,at=this.w;if(c!=="YZX")throw new Error(`Euler order ${c} not supported yet.`);{const ut=_e*it+nt*at;if(ut>.499&&(d=2*Math.atan2(_e,at),_=Math.PI/2,b=0),ut<-.499&&(d=-2*Math.atan2(_e,at),_=-Math.PI/2,b=0),d===void 0){const pt=_e*_e,mt=it*it,ft=nt*nt;d=Math.atan2(2*it*at-2*_e*nt,1-2*mt-2*ft),_=Math.asin(2*ut),b=Math.atan2(2*_e*at-2*it*nt,1-2*pt-2*ft)}}o.y=d,o.z=_,o.x=b}setFromEuler(o,c,d,_){_===void 0&&(_="XYZ");const b=Math.cos(o/2),_e=Math.cos(c/2),it=Math.cos(d/2),nt=Math.sin(o/2),at=Math.sin(c/2),ut=Math.sin(d/2);return _==="XYZ"?(this.x=nt*_e*it+b*at*ut,this.y=b*at*it-nt*_e*ut,this.z=b*_e*ut+nt*at*it,this.w=b*_e*it-nt*at*ut):_==="YXZ"?(this.x=nt*_e*it+b*at*ut,this.y=b*at*it-nt*_e*ut,this.z=b*_e*ut-nt*at*it,this.w=b*_e*it+nt*at*ut):_==="ZXY"?(this.x=nt*_e*it-b*at*ut,this.y=b*at*it+nt*_e*ut,this.z=b*_e*ut+nt*at*it,this.w=b*_e*it-nt*at*ut):_==="ZYX"?(this.x=nt*_e*it-b*at*ut,this.y=b*at*it+nt*_e*ut,this.z=b*_e*ut-nt*at*it,this.w=b*_e*it+nt*at*ut):_==="YZX"?(this.x=nt*_e*it+b*at*ut,this.y=b*at*it+nt*_e*ut,this.z=b*_e*ut-nt*at*it,this.w=b*_e*it-nt*at*ut):_==="XZY"&&(this.x=nt*_e*it-b*at*ut,this.y=b*at*it-nt*_e*ut,this.z=b*_e*ut+nt*at*it,this.w=b*_e*it+nt*at*ut),this}clone(){return new Quaternion(this.x,this.y,this.z,this.w)}slerp(o,c,d){d===void 0&&(d=new Quaternion);const _=this.x,b=this.y,_e=this.z,it=this.w;let nt,at,ut,pt,mt,ft=o.x,vt=o.y,xt=o.z,At=o.w;return at=_*ft+b*vt+_e*xt+it*At,at<0&&(at=-at,ft=-ft,vt=-vt,xt=-xt,At=-At),1-at>1e-6?(nt=Math.acos(at),ut=Math.sin(nt),pt=Math.sin((1-c)*nt)/ut,mt=Math.sin(c*nt)/ut):(pt=1-c,mt=c),d.x=pt*_+mt*ft,d.y=pt*b+mt*vt,d.z=pt*_e+mt*xt,d.w=pt*it+mt*At,d}integrate(o,c,d,_){_===void 0&&(_=new Quaternion);const b=o.x*d.x,_e=o.y*d.y,it=o.z*d.z,nt=this.x,at=this.y,ut=this.z,pt=this.w,mt=.5*c;return _.x+=mt*(b*pt+_e*ut-it*at),_.y+=mt*(_e*pt+it*nt-b*ut),_.z+=mt*(it*pt+b*at-_e*nt),_.w+=mt*(-b*nt-_e*at-it*ut),_}}const sfv_t1=new Vec3,sfv_t2=new Vec3,SHAPE_TYPES={SPHERE:1,PLANE:2,BOX:4,COMPOUND:8,CONVEXPOLYHEDRON:16,HEIGHTFIELD:32,PARTICLE:64,CYLINDER:128,TRIMESH:256};class Shape{constructor(o){o===void 0&&(o={}),this.id=Shape.idCounter++,this.type=o.type||0,this.boundingSphereRadius=0,this.collisionResponse=!o.collisionResponse||o.collisionResponse,this.collisionFilterGroup=o.collisionFilterGroup!==void 0?o.collisionFilterGroup:1,this.collisionFilterMask=o.collisionFilterMask!==void 0?o.collisionFilterMask:-1,this.material=o.material?o.material:null,this.body=null}updateBoundingSphereRadius(){throw`computeBoundingSphereRadius() not implemented for shape type ${this.type}`}volume(){throw`volume() not implemented for shape type ${this.type}`}calculateLocalInertia(o,c){throw`calculateLocalInertia() not implemented for shape type ${this.type}`}calculateWorldAABB(o,c,d,_){throw`calculateWorldAABB() not implemented for shape type ${this.type}`}}Shape.idCounter=0,Shape.types=SHAPE_TYPES;class cannon_es_Transform{constructor(o){o===void 0&&(o={}),this.position=new Vec3,this.quaternion=new Quaternion,o.position&&this.position.copy(o.position),o.quaternion&&this.quaternion.copy(o.quaternion)}pointToLocal(o,c){return cannon_es_Transform.pointToLocalFrame(this.position,this.quaternion,o,c)}pointToWorld(o,c){return cannon_es_Transform.pointToWorldFrame(this.position,this.quaternion,o,c)}vectorToWorldFrame(o,c){return c===void 0&&(c=new Vec3),this.quaternion.vmult(o,c),c}static pointToLocalFrame(o,c,d,_){return _===void 0&&(_=new Vec3),d.vsub(o,_),c.conjugate(tmpQuat$1),tmpQuat$1.vmult(_,_),_}static pointToWorldFrame(o,c,d,_){return _===void 0&&(_=new Vec3),c.vmult(d,_),_.vadd(o,_),_}static vectorToWorldFrame(o,c,d){return d===void 0&&(d=new Vec3),o.vmult(c,d),d}static vectorToLocalFrame(o,c,d,_){return _===void 0&&(_=new Vec3),c.w*=-1,c.vmult(d,_),c.w*=-1,_}}const tmpQuat$1=new Quaternion;class ConvexPolyhedron extends Shape{constructor(o){o===void 0&&(o={});const{vertices:c=[],faces:d=[],normals:_=[],axes:b,boundingSphereRadius:_e}=o;super({type:Shape.types.CONVEXPOLYHEDRON}),this.vertices=c,this.faces=d,this.faceNormals=_,this.faceNormals.length===0&&this.computeNormals(),_e?this.boundingSphereRadius=_e:this.updateBoundingSphereRadius(),this.worldVertices=[],this.worldVerticesNeedsUpdate=!0,this.worldFaceNormals=[],this.worldFaceNormalsNeedsUpdate=!0,this.uniqueAxes=b?b.slice():null,this.uniqueEdges=[],this.computeEdges()}computeEdges(){const o=this.faces,c=this.vertices,d=this.uniqueEdges;d.length=0;const _=new Vec3;for(let b=0;b!==o.length;b++){const _e=o[b],it=_e.length;for(let nt=0;nt!==it;nt++){const at=(nt+1)%it;c[_e[nt]].vsub(c[_e[at]],_),_.normalize();let ut=!1;for(let pt=0;pt!==d.length;pt++)if(d[pt].almostEquals(_)||d[pt].almostEquals(_)){ut=!0;break}ut||d.push(_.clone())}}}computeNormals(){this.faceNormals.length=this.faces.length;for(let o=0;o<this.faces.length;o++){for(let _=0;_<this.faces[o].length;_++)if(!this.vertices[this.faces[o][_]])throw new Error(`Vertex ${this.faces[o][_]} not found!`);const c=this.faceNormals[o]||new Vec3;this.getFaceNormal(o,c),c.negate(c),this.faceNormals[o]=c;const d=this.vertices[this.faces[o][0]];if(c.dot(d)<0){console.error(`.faceNormals[${o}] = Vec3(${c.toString()}) looks like it points into the shape? The vertices follow. Make sure they are ordered CCW around the normal, using the right hand rule.`);for(let _=0;_<this.faces[o].length;_++)console.warn(`.vertices[${this.faces[o][_]}] = Vec3(${this.vertices[this.faces[o][_]].toString()})`)}}}getFaceNormal(o,c){const d=this.faces[o],_=this.vertices[d[0]],b=this.vertices[d[1]],_e=this.vertices[d[2]];ConvexPolyhedron.computeNormal(_,b,_e,c)}static computeNormal(o,c,d,_){const b=new Vec3,_e=new Vec3;c.vsub(o,_e),d.vsub(c,b),b.cross(_e,_),_.isZero()||_.normalize()}clipAgainstHull(o,c,d,_,b,_e,it,nt,at){const ut=new Vec3;let pt=-1,mt=-Number.MAX_VALUE;for(let vt=0;vt<d.faces.length;vt++){ut.copy(d.faceNormals[vt]),b.vmult(ut,ut);const xt=ut.dot(_e);xt>mt&&(mt=xt,pt=vt)}const ft=[];for(let vt=0;vt<d.faces[pt].length;vt++){const xt=d.vertices[d.faces[pt][vt]],At=new Vec3;At.copy(xt),b.vmult(At,At),_.vadd(At,At),ft.push(At)}pt>=0&&this.clipFaceAgainstHull(_e,o,c,ft,it,nt,at)}findSeparatingAxis(o,c,d,_,b,_e,it,nt){const at=new Vec3,ut=new Vec3,pt=new Vec3,mt=new Vec3,ft=new Vec3,vt=new Vec3;let xt=Number.MAX_VALUE;const At=this;if(At.uniqueAxes)for(let Ct=0;Ct!==At.uniqueAxes.length;Ct++){d.vmult(At.uniqueAxes[Ct],at);const Et=At.testSepAxis(at,o,c,d,_,b);if(Et===!1)return!1;Et<xt&&(xt=Et,_e.copy(at))}else{const Ct=it?it.length:At.faces.length;for(let Et=0;Et<Ct;Et++){const Tt=it?it[Et]:Et;at.copy(At.faceNormals[Tt]),d.vmult(at,at);const kt=At.testSepAxis(at,o,c,d,_,b);if(kt===!1)return!1;kt<xt&&(xt=kt,_e.copy(at))}}if(o.uniqueAxes)for(let Ct=0;Ct!==o.uniqueAxes.length;Ct++){b.vmult(o.uniqueAxes[Ct],ut);const Et=At.testSepAxis(ut,o,c,d,_,b);if(Et===!1)return!1;Et<xt&&(xt=Et,_e.copy(ut))}else{const Ct=nt?nt.length:o.faces.length;for(let Et=0;Et<Ct;Et++){const Tt=nt?nt[Et]:Et;ut.copy(o.faceNormals[Tt]),b.vmult(ut,ut);const kt=At.testSepAxis(ut,o,c,d,_,b);if(kt===!1)return!1;kt<xt&&(xt=kt,_e.copy(ut))}}for(let Ct=0;Ct!==At.uniqueEdges.length;Ct++){d.vmult(At.uniqueEdges[Ct],mt);for(let Et=0;Et!==o.uniqueEdges.length;Et++)if(b.vmult(o.uniqueEdges[Et],ft),mt.cross(ft,vt),!vt.almostZero()){vt.normalize();const Tt=At.testSepAxis(vt,o,c,d,_,b);if(Tt===!1)return!1;Tt<xt&&(xt=Tt,_e.copy(vt))}}return _.vsub(c,pt),pt.dot(_e)>0&&_e.negate(_e),!0}testSepAxis(o,c,d,_,b,_e){ConvexPolyhedron.project(this,o,d,_,maxminA),ConvexPolyhedron.project(c,o,b,_e,maxminB);const it=maxminA[0],nt=maxminA[1],at=maxminB[0],ut=maxminB[1];if(it<ut||at<nt)return!1;const pt=it-ut,mt=at-nt;return pt<mt?pt:mt}calculateLocalInertia(o,c){const d=new Vec3,_=new Vec3;this.computeLocalAABB(_,d);const b=d.x-_.x,_e=d.y-_.y,it=d.z-_.z;c.x=1/12*o*(2*_e*2*_e+2*it*2*it),c.y=1/12*o*(2*b*2*b+2*it*2*it),c.z=1/12*o*(2*_e*2*_e+2*b*2*b)}getPlaneConstantOfFace(o){const c=this.faces[o],d=this.faceNormals[o],_=this.vertices[c[0]];return-d.dot(_)}clipFaceAgainstHull(o,c,d,_,b,_e,it){const nt=new Vec3,at=new Vec3,ut=new Vec3,pt=new Vec3,mt=new Vec3,ft=new Vec3,vt=new Vec3,xt=new Vec3,At=this,Ct=_,Et=[];let Tt=-1,kt=Number.MAX_VALUE;for(let Ut=0;Ut<At.faces.length;Ut++){nt.copy(At.faceNormals[Ut]),d.vmult(nt,nt);const Ht=nt.dot(o);Ht<kt&&(kt=Ht,Tt=Ut)}if(Tt<0)return;const Dt=At.faces[Tt];Dt.connectedFaces=[];for(let Ut=0;Ut<At.faces.length;Ut++)for(let Ht=0;Ht<At.faces[Ut].length;Ht++)Dt.indexOf(At.faces[Ut][Ht])!==-1&&Ut!==Tt&&Dt.connectedFaces.indexOf(Ut)===-1&&Dt.connectedFaces.push(Ut);const zt=Dt.length;for(let Ut=0;Ut<zt;Ut++){const Ht=At.vertices[Dt[Ut]],Jt=At.vertices[Dt[(Ut+1)%zt]];Ht.vsub(Jt,at),ut.copy(at),d.vmult(ut,ut),c.vadd(ut,ut),pt.copy(this.faceNormals[Tt]),d.vmult(pt,pt),c.vadd(pt,pt),ut.cross(pt,mt),mt.negate(mt),ft.copy(Ht),d.vmult(ft,ft),c.vadd(ft,ft);const Kt=Dt.connectedFaces[Ut];vt.copy(this.faceNormals[Kt]);const sr=this.getPlaneConstantOfFace(Kt);xt.copy(vt),d.vmult(xt,xt);const ir=sr-xt.dot(c);for(this.clipFaceAgainstPlane(Ct,Et,xt,ir);Ct.length;)Ct.shift();for(;Et.length;)Ct.push(Et.shift())}vt.copy(this.faceNormals[Tt]);const Bt=this.getPlaneConstantOfFace(Tt);xt.copy(vt),d.vmult(xt,xt);const Rt=Bt-xt.dot(c);for(let Ut=0;Ut<Ct.length;Ut++){let Ht=xt.dot(Ct[Ut])+Rt;if(Ht<=b&&(console.log(`clamped: depth=${Ht} to minDist=${b}`),Ht=b),Ht<=_e){const Jt=Ct[Ut];if(Ht<=1e-6){const Kt={point:Jt,normal:xt,depth:Ht};it.push(Kt)}}}}clipFaceAgainstPlane(o,c,d,_){let b,_e;const it=o.length;if(it<2)return c;let nt=o[o.length-1],at=o[0];b=d.dot(nt)+_;for(let ut=0;ut<it;ut++){if(at=o[ut],_e=d.dot(at)+_,b<0)if(_e<0){const pt=new Vec3;pt.copy(at),c.push(pt)}else{const pt=new Vec3;nt.lerp(at,b/(b-_e),pt),c.push(pt)}else if(_e<0){const pt=new Vec3;nt.lerp(at,b/(b-_e),pt),c.push(pt),c.push(at)}nt=at,b=_e}return c}computeWorldVertices(o,c){for(;this.worldVertices.length<this.vertices.length;)this.worldVertices.push(new Vec3);const d=this.vertices,_=this.worldVertices;for(let b=0;b!==this.vertices.length;b++)c.vmult(d[b],_[b]),o.vadd(_[b],_[b]);this.worldVerticesNeedsUpdate=!1}computeLocalAABB(o,c){const d=this.vertices;o.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),c.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let _=0;_<this.vertices.length;_++){const b=d[_];b.x<o.x?o.x=b.x:b.x>c.x&&(c.x=b.x),b.y<o.y?o.y=b.y:b.y>c.y&&(c.y=b.y),b.z<o.z?o.z=b.z:b.z>c.z&&(c.z=b.z)}}computeWorldFaceNormals(o){const c=this.faceNormals.length;for(;this.worldFaceNormals.length<c;)this.worldFaceNormals.push(new Vec3);const d=this.faceNormals,_=this.worldFaceNormals;for(let b=0;b!==c;b++)o.vmult(d[b],_[b]);this.worldFaceNormalsNeedsUpdate=!1}updateBoundingSphereRadius(){let o=0;const c=this.vertices;for(let d=0;d!==c.length;d++){const _=c[d].lengthSquared();_>o&&(o=_)}this.boundingSphereRadius=Math.sqrt(o)}calculateWorldAABB(o,c,d,_){const b=this.vertices;let _e,it,nt,at,ut,pt,mt=new Vec3;for(let ft=0;ft<b.length;ft++){mt.copy(b[ft]),c.vmult(mt,mt),o.vadd(mt,mt);const vt=mt;(_e===void 0||vt.x<_e)&&(_e=vt.x),(at===void 0||vt.x>at)&&(at=vt.x),(it===void 0||vt.y<it)&&(it=vt.y),(ut===void 0||vt.y>ut)&&(ut=vt.y),(nt===void 0||vt.z<nt)&&(nt=vt.z),(pt===void 0||vt.z>pt)&&(pt=vt.z)}d.set(_e,it,nt),_.set(at,ut,pt)}volume(){return 4*Math.PI*this.boundingSphereRadius/3}getAveragePointLocal(o){o===void 0&&(o=new Vec3);const c=this.vertices;for(let d=0;d<c.length;d++)o.vadd(c[d],o);return o.scale(1/c.length,o),o}transformAllPoints(o,c){const d=this.vertices.length,_=this.vertices;if(c){for(let b=0;b<d;b++){const _e=_[b];c.vmult(_e,_e)}for(let b=0;b<this.faceNormals.length;b++){const _e=this.faceNormals[b];c.vmult(_e,_e)}}if(o)for(let b=0;b<d;b++){const _e=_[b];_e.vadd(o,_e)}}pointIsInside(o){const c=this.vertices,d=this.faces,_=this.faceNormals,b=new Vec3;this.getAveragePointLocal(b);for(let _e=0;_e<this.faces.length;_e++){let it=_[_e];const nt=c[d[_e][0]],at=new Vec3;o.vsub(nt,at);const ut=it.dot(at),pt=new Vec3;b.vsub(nt,pt);const mt=it.dot(pt);if(ut<0&&mt>0||ut>0&&mt<0)return!1}return-1}static project(o,c,d,_,b){const _e=o.vertices.length,it=project_localAxis;let nt=0,at=0;const ut=project_localOrigin,pt=o.vertices;ut.setZero(),cannon_es_Transform.vectorToLocalFrame(d,_,c,it),cannon_es_Transform.pointToLocalFrame(d,_,ut,ut);const mt=ut.dot(it);at=nt=pt[0].dot(it);for(let ft=1;ft<_e;ft++){const vt=pt[ft].dot(it);vt>nt&&(nt=vt),vt<at&&(at=vt)}if(at-=mt,nt-=mt,at>nt){const ft=at;at=nt,nt=ft}b[0]=nt,b[1]=at}}const maxminA=[],maxminB=[];new Vec3;const project_localAxis=new Vec3,project_localOrigin=new Vec3;class Box extends Shape{constructor(o){super({type:Shape.types.BOX}),this.halfExtents=o,this.convexPolyhedronRepresentation=null,this.updateConvexPolyhedronRepresentation(),this.updateBoundingSphereRadius()}updateConvexPolyhedronRepresentation(){const o=this.halfExtents.x,c=this.halfExtents.y,d=this.halfExtents.z,_=Vec3,b=[new _(-o,-c,-d),new _(o,-c,-d),new _(o,c,-d),new _(-o,c,-d),new _(-o,-c,d),new _(o,-c,d),new _(o,c,d),new _(-o,c,d)],_e=[new _(0,0,1),new _(0,1,0),new _(1,0,0)],it=new ConvexPolyhedron({vertices:b,faces:[[3,2,1,0],[4,5,6,7],[5,4,0,1],[2,3,7,6],[0,4,7,3],[1,2,6,5]],axes:_e});this.convexPolyhedronRepresentation=it,it.material=this.material}calculateLocalInertia(o,c){return c===void 0&&(c=new Vec3),Box.calculateInertia(this.halfExtents,o,c),c}static calculateInertia(o,c,d){const _=o;d.x=1/12*c*(2*_.y*2*_.y+2*_.z*2*_.z),d.y=1/12*c*(2*_.x*2*_.x+2*_.z*2*_.z),d.z=1/12*c*(2*_.y*2*_.y+2*_.x*2*_.x)}getSideNormals(o,c){const d=o,_=this.halfExtents;if(d[0].set(_.x,0,0),d[1].set(0,_.y,0),d[2].set(0,0,_.z),d[3].set(-_.x,0,0),d[4].set(0,-_.y,0),d[5].set(0,0,-_.z),c!==void 0)for(let b=0;b!==d.length;b++)c.vmult(d[b],d[b]);return d}volume(){return 8*this.halfExtents.x*this.halfExtents.y*this.halfExtents.z}updateBoundingSphereRadius(){this.boundingSphereRadius=this.halfExtents.length()}forEachWorldCorner(o,c,d){const _=this.halfExtents,b=[[_.x,_.y,_.z],[-_.x,_.y,_.z],[-_.x,-_.y,_.z],[-_.x,-_.y,-_.z],[_.x,-_.y,-_.z],[_.x,_.y,-_.z],[-_.x,_.y,-_.z],[_.x,-_.y,_.z]];for(let _e=0;_e<b.length;_e++)worldCornerTempPos.set(b[_e][0],b[_e][1],b[_e][2]),c.vmult(worldCornerTempPos,worldCornerTempPos),o.vadd(worldCornerTempPos,worldCornerTempPos),d(worldCornerTempPos.x,worldCornerTempPos.y,worldCornerTempPos.z)}calculateWorldAABB(o,c,d,_){const b=this.halfExtents;worldCornersTemp[0].set(b.x,b.y,b.z),worldCornersTemp[1].set(-b.x,b.y,b.z),worldCornersTemp[2].set(-b.x,-b.y,b.z),worldCornersTemp[3].set(-b.x,-b.y,-b.z),worldCornersTemp[4].set(b.x,-b.y,-b.z),worldCornersTemp[5].set(b.x,b.y,-b.z),worldCornersTemp[6].set(-b.x,b.y,-b.z),worldCornersTemp[7].set(b.x,-b.y,b.z);const _e=worldCornersTemp[0];c.vmult(_e,_e),o.vadd(_e,_e),_.copy(_e),d.copy(_e);for(let it=1;it<8;it++){const nt=worldCornersTemp[it];c.vmult(nt,nt),o.vadd(nt,nt);const at=nt.x,ut=nt.y,pt=nt.z;at>_.x&&(_.x=at),ut>_.y&&(_.y=ut),pt>_.z&&(_.z=pt),at<d.x&&(d.x=at),ut<d.y&&(d.y=ut),pt<d.z&&(d.z=pt)}}}const worldCornerTempPos=new Vec3,worldCornersTemp=[new Vec3,new Vec3,new Vec3,new Vec3,new Vec3,new Vec3,new Vec3,new Vec3],BODY_TYPES={DYNAMIC:1,STATIC:2,KINEMATIC:4},BODY_SLEEP_STATES={AWAKE:0,SLEEPY:1,SLEEPING:2};class Body extends EventTarget{constructor(o){o===void 0&&(o={}),super(),this.id=Body.idCounter++,this.index=-1,this.world=null,this.vlambda=new Vec3,this.collisionFilterGroup=typeof o.collisionFilterGroup=="number"?o.collisionFilterGroup:1,this.collisionFilterMask=typeof o.collisionFilterMask=="number"?o.collisionFilterMask:-1,this.collisionResponse=typeof o.collisionResponse!="boolean"||o.collisionResponse,this.position=new Vec3,this.previousPosition=new Vec3,this.interpolatedPosition=new Vec3,this.initPosition=new Vec3,o.position&&(this.position.copy(o.position),this.previousPosition.copy(o.position),this.interpolatedPosition.copy(o.position),this.initPosition.copy(o.position)),this.velocity=new Vec3,o.velocity&&this.velocity.copy(o.velocity),this.initVelocity=new Vec3,this.force=new Vec3;const c=typeof o.mass=="number"?o.mass:0;this.mass=c,this.invMass=c>0?1/c:0,this.material=o.material||null,this.linearDamping=typeof o.linearDamping=="number"?o.linearDamping:.01,this.type=c<=0?Body.STATIC:Body.DYNAMIC,typeof o.type==typeof Body.STATIC&&(this.type=o.type),this.allowSleep=o.allowSleep===void 0||o.allowSleep,this.sleepState=Body.AWAKE,this.sleepSpeedLimit=o.sleepSpeedLimit!==void 0?o.sleepSpeedLimit:.1,this.sleepTimeLimit=o.sleepTimeLimit!==void 0?o.sleepTimeLimit:1,this.timeLastSleepy=0,this.wakeUpAfterNarrowphase=!1,this.torque=new Vec3,this.quaternion=new Quaternion,this.initQuaternion=new Quaternion,this.previousQuaternion=new Quaternion,this.interpolatedQuaternion=new Quaternion,o.quaternion&&(this.quaternion.copy(o.quaternion),this.initQuaternion.copy(o.quaternion),this.previousQuaternion.copy(o.quaternion),this.interpolatedQuaternion.copy(o.quaternion)),this.angularVelocity=new Vec3,o.angularVelocity&&this.angularVelocity.copy(o.angularVelocity),this.initAngularVelocity=new Vec3,this.shapes=[],this.shapeOffsets=[],this.shapeOrientations=[],this.inertia=new Vec3,this.invInertia=new Vec3,this.invInertiaWorld=new Mat3,this.invMassSolve=0,this.invInertiaSolve=new Vec3,this.invInertiaWorldSolve=new Mat3,this.fixedRotation=o.fixedRotation!==void 0&&o.fixedRotation,this.angularDamping=o.angularDamping!==void 0?o.angularDamping:.01,this.linearFactor=new Vec3(1,1,1),o.linearFactor&&this.linearFactor.copy(o.linearFactor),this.angularFactor=new Vec3(1,1,1),o.angularFactor&&this.angularFactor.copy(o.angularFactor),this.aabb=new AABB,this.aabbNeedsUpdate=!0,this.boundingRadius=0,this.wlambda=new Vec3,this.isTrigger=!!o.isTrigger,o.shape&&this.addShape(o.shape),this.updateMassProperties()}wakeUp(){const o=this.sleepState;this.sleepState=Body.AWAKE,this.wakeUpAfterNarrowphase=!1,o===Body.SLEEPING&&this.dispatchEvent(Body.wakeupEvent)}sleep(){this.sleepState=Body.SLEEPING,this.velocity.set(0,0,0),this.angularVelocity.set(0,0,0),this.wakeUpAfterNarrowphase=!1}sleepTick(o){if(this.allowSleep){const c=this.sleepState,d=this.velocity.lengthSquared()+this.angularVelocity.lengthSquared(),_=this.sleepSpeedLimit**2;c===Body.AWAKE&&d<_?(this.sleepState=Body.SLEEPY,this.timeLastSleepy=o,this.dispatchEvent(Body.sleepyEvent)):c===Body.SLEEPY&&d>_?this.wakeUp():c===Body.SLEEPY&&o-this.timeLastSleepy>this.sleepTimeLimit&&(this.sleep(),this.dispatchEvent(Body.sleepEvent))}}updateSolveMassProperties(){this.sleepState===Body.SLEEPING||this.type===Body.KINEMATIC?(this.invMassSolve=0,this.invInertiaSolve.setZero(),this.invInertiaWorldSolve.setZero()):(this.invMassSolve=this.invMass,this.invInertiaSolve.copy(this.invInertia),this.invInertiaWorldSolve.copy(this.invInertiaWorld))}pointToLocalFrame(o,c){return c===void 0&&(c=new Vec3),o.vsub(this.position,c),this.quaternion.conjugate().vmult(c,c),c}vectorToLocalFrame(o,c){return c===void 0&&(c=new Vec3),this.quaternion.conjugate().vmult(o,c),c}pointToWorldFrame(o,c){return c===void 0&&(c=new Vec3),this.quaternion.vmult(o,c),c.vadd(this.position,c),c}vectorToWorldFrame(o,c){return c===void 0&&(c=new Vec3),this.quaternion.vmult(o,c),c}addShape(o,c,d){const _=new Vec3,b=new Quaternion;return c&&_.copy(c),d&&b.copy(d),this.shapes.push(o),this.shapeOffsets.push(_),this.shapeOrientations.push(b),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0,o.body=this,this}removeShape(o){const c=this.shapes.indexOf(o);return c===-1?(console.warn("Shape does not belong to the body"),this):(this.shapes.splice(c,1),this.shapeOffsets.splice(c,1),this.shapeOrientations.splice(c,1),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0,o.body=null,this)}updateBoundingRadius(){const o=this.shapes,c=this.shapeOffsets,d=o.length;let _=0;for(let b=0;b!==d;b++){const _e=o[b];_e.updateBoundingSphereRadius();const it=c[b].length(),nt=_e.boundingSphereRadius;it+nt>_&&(_=it+nt)}this.boundingRadius=_}updateAABB(){const o=this.shapes,c=this.shapeOffsets,d=this.shapeOrientations,_=o.length,b=tmpVec,_e=tmpQuat,it=this.quaternion,nt=this.aabb,at=updateAABB_shapeAABB;for(let ut=0;ut!==_;ut++){const pt=o[ut];it.vmult(c[ut],b),b.vadd(this.position,b),it.mult(d[ut],_e),pt.calculateWorldAABB(b,_e,at.lowerBound,at.upperBound),ut===0?nt.copy(at):nt.extend(at)}this.aabbNeedsUpdate=!1}updateInertiaWorld(o){const c=this.invInertia;if(c.x!==c.y||c.y!==c.z||o){const d=uiw_m1,_=uiw_m2;d.setRotationFromQuaternion(this.quaternion),d.transpose(_),d.scale(c,d),d.mmult(_,this.invInertiaWorld)}}applyForce(o,c){if(c===void 0&&(c=new Vec3),this.type!==Body.DYNAMIC)return;this.sleepState===Body.SLEEPING&&this.wakeUp();const d=Body_applyForce_rotForce;c.cross(o,d),this.force.vadd(o,this.force),this.torque.vadd(d,this.torque)}applyLocalForce(o,c){if(c===void 0&&(c=new Vec3),this.type!==Body.DYNAMIC)return;const d=Body_applyLocalForce_worldForce,_=Body_applyLocalForce_relativePointWorld;this.vectorToWorldFrame(o,d),this.vectorToWorldFrame(c,_),this.applyForce(d,_)}applyTorque(o){this.type===Body.DYNAMIC&&(this.sleepState===Body.SLEEPING&&this.wakeUp(),this.torque.vadd(o,this.torque))}applyImpulse(o,c){if(c===void 0&&(c=new Vec3),this.type!==Body.DYNAMIC)return;this.sleepState===Body.SLEEPING&&this.wakeUp();const d=c,_=Body_applyImpulse_velo;_.copy(o),_.scale(this.invMass,_),this.velocity.vadd(_,this.velocity);const b=Body_applyImpulse_rotVelo;d.cross(o,b),this.invInertiaWorld.vmult(b,b),this.angularVelocity.vadd(b,this.angularVelocity)}applyLocalImpulse(o,c){if(c===void 0&&(c=new Vec3),this.type!==Body.DYNAMIC)return;const d=Body_applyLocalImpulse_worldImpulse,_=Body_applyLocalImpulse_relativePoint;this.vectorToWorldFrame(o,d),this.vectorToWorldFrame(c,_),this.applyImpulse(d,_)}updateMassProperties(){const o=Body_updateMassProperties_halfExtents;this.invMass=this.mass>0?1/this.mass:0;const c=this.inertia,d=this.fixedRotation;this.updateAABB(),o.set((this.aabb.upperBound.x-this.aabb.lowerBound.x)/2,(this.aabb.upperBound.y-this.aabb.lowerBound.y)/2,(this.aabb.upperBound.z-this.aabb.lowerBound.z)/2),Box.calculateInertia(o,this.mass,c),this.invInertia.set(c.x>0&&!d?1/c.x:0,c.y>0&&!d?1/c.y:0,c.z>0&&!d?1/c.z:0),this.updateInertiaWorld(!0)}getVelocityAtWorldPoint(o,c){const d=new Vec3;return o.vsub(this.position,d),this.angularVelocity.cross(d,c),this.velocity.vadd(c,c),c}integrate(o,c,d){if(this.previousPosition.copy(this.position),this.previousQuaternion.copy(this.quaternion),this.type!==Body.DYNAMIC&&this.type!==Body.KINEMATIC||this.sleepState===Body.SLEEPING)return;const _=this.velocity,b=this.angularVelocity,_e=this.position,it=this.force,nt=this.torque,at=this.quaternion,ut=this.invMass,pt=this.invInertiaWorld,mt=this.linearFactor,ft=ut*o;_.x+=it.x*ft*mt.x,_.y+=it.y*ft*mt.y,_.z+=it.z*ft*mt.z;const vt=pt.elements,xt=this.angularFactor,At=nt.x*xt.x,Ct=nt.y*xt.y,Et=nt.z*xt.z;b.x+=o*(vt[0]*At+vt[1]*Ct+vt[2]*Et),b.y+=o*(vt[3]*At+vt[4]*Ct+vt[5]*Et),b.z+=o*(vt[6]*At+vt[7]*Ct+vt[8]*Et),_e.x+=_.x*o,_e.y+=_.y*o,_e.z+=_.z*o,at.integrate(this.angularVelocity,o,this.angularFactor,at),c&&(d?at.normalizeFast():at.normalize()),this.aabbNeedsUpdate=!0,this.updateInertiaWorld()}}Body.idCounter=0,Body.COLLIDE_EVENT_NAME="collide",Body.DYNAMIC=BODY_TYPES.DYNAMIC,Body.STATIC=BODY_TYPES.STATIC,Body.KINEMATIC=BODY_TYPES.KINEMATIC,Body.AWAKE=BODY_SLEEP_STATES.AWAKE,Body.SLEEPY=BODY_SLEEP_STATES.SLEEPY,Body.SLEEPING=BODY_SLEEP_STATES.SLEEPING,Body.wakeupEvent={type:"wakeup"},Body.sleepyEvent={type:"sleepy"},Body.sleepEvent={type:"sleep"};const tmpVec=new Vec3,tmpQuat=new Quaternion,updateAABB_shapeAABB=new AABB,uiw_m1=new Mat3,uiw_m2=new Mat3;new Mat3;const Body_applyForce_rotForce=new Vec3,Body_applyLocalForce_worldForce=new Vec3,Body_applyLocalForce_relativePointWorld=new Vec3,Body_applyImpulse_velo=new Vec3,Body_applyImpulse_rotVelo=new Vec3,Body_applyLocalImpulse_worldImpulse=new Vec3,Body_applyLocalImpulse_relativePoint=new Vec3,Body_updateMassProperties_halfExtents=new Vec3;class Broadphase{constructor(){this.world=null,this.useBoundingBoxes=!1,this.dirty=!0}collisionPairs(o,c,d){throw new Error("collisionPairs not implemented for this BroadPhase class!")}needBroadphaseCollision(o,c){return!(!(o.collisionFilterGroup&c.collisionFilterMask&&c.collisionFilterGroup&o.collisionFilterMask)||(o.type&Body.STATIC||o.sleepState===Body.SLEEPING)&&(c.type&Body.STATIC||c.sleepState===Body.SLEEPING))}intersectionTest(o,c,d,_){this.useBoundingBoxes?this.doBoundingBoxBroadphase(o,c,d,_):this.doBoundingSphereBroadphase(o,c,d,_)}doBoundingSphereBroadphase(o,c,d,_){const b=Broadphase_collisionPairs_r;c.position.vsub(o.position,b);const _e=(o.boundingRadius+c.boundingRadius)**2;b.lengthSquared()<_e&&(d.push(o),_.push(c))}doBoundingBoxBroadphase(o,c,d,_){o.aabbNeedsUpdate&&o.updateAABB(),c.aabbNeedsUpdate&&c.updateAABB(),o.aabb.overlaps(c.aabb)&&(d.push(o),_.push(c))}makePairsUnique(o,c){const d=Broadphase_makePairsUnique_temp,_=Broadphase_makePairsUnique_p1,b=Broadphase_makePairsUnique_p2,_e=o.length;for(let it=0;it!==_e;it++)_[it]=o[it],b[it]=c[it];o.length=0,c.length=0;for(let it=0;it!==_e;it++){const nt=_[it].id,at=b[it].id,ut=nt<at?`${nt},${at}`:`${at},${nt}`;d[ut]=it,d.keys.push(ut)}for(let it=0;it!==d.keys.length;it++){const nt=d.keys.pop(),at=d[nt];o.push(_[at]),c.push(b[at]),delete d[nt]}}setWorld(o){}static boundingSphereCheck(o,c){const d=new Vec3;o.position.vsub(c.position,d);const _=o.shapes[0],b=c.shapes[0];return Math.pow(_.boundingSphereRadius+b.boundingSphereRadius,2)>d.lengthSquared()}aabbQuery(o,c,d){return console.warn(".aabbQuery is not implemented in this Broadphase subclass."),[]}}const Broadphase_collisionPairs_r=new Vec3;new Vec3,new Quaternion,new Vec3;const Broadphase_makePairsUnique_temp={keys:[]},Broadphase_makePairsUnique_p1=[],Broadphase_makePairsUnique_p2=[];new Vec3;new Vec3;new Vec3;class NaiveBroadphase extends Broadphase{constructor(){super()}collisionPairs(o,c,d){const _=o.bodies,b=_.length;let _e,it;for(let nt=0;nt!==b;nt++)for(let at=0;at!==nt;at++)_e=_[nt],it=_[at],this.needBroadphaseCollision(_e,it)&&this.intersectionTest(_e,it,c,d)}aabbQuery(o,c,d){d===void 0&&(d=[]);for(let _=0;_<o.bodies.length;_++){const b=o.bodies[_];b.aabbNeedsUpdate&&b.updateAABB(),b.aabb.overlaps(c)&&d.push(b)}return d}}class RaycastResult{constructor(){this.rayFromWorld=new Vec3,this.rayToWorld=new Vec3,this.hitNormalWorld=new Vec3,this.hitPointWorld=new Vec3,this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}reset(){this.rayFromWorld.setZero(),this.rayToWorld.setZero(),this.hitNormalWorld.setZero(),this.hitPointWorld.setZero(),this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}abort(){this.shouldStop=!0}set(o,c,d,_,b,_e,it){this.rayFromWorld.copy(o),this.rayToWorld.copy(c),this.hitNormalWorld.copy(d),this.hitPointWorld.copy(_),this.shape=b,this.body=_e,this.distance=it}}let _Shape$types$SPHERE,_Shape$types$PLANE,_Shape$types$BOX,_Shape$types$CYLINDER,_Shape$types$CONVEXPO,_Shape$types$HEIGHTFI,_Shape$types$TRIMESH;const RAY_MODES={CLOSEST:1,ANY:2,ALL:4};_Shape$types$SPHERE=Shape.types.SPHERE,_Shape$types$PLANE=Shape.types.PLANE,_Shape$types$BOX=Shape.types.BOX,_Shape$types$CYLINDER=Shape.types.CYLINDER,_Shape$types$CONVEXPO=Shape.types.CONVEXPOLYHEDRON,_Shape$types$HEIGHTFI=Shape.types.HEIGHTFIELD,_Shape$types$TRIMESH=Shape.types.TRIMESH;class Ray{get[_Shape$types$SPHERE](){return this._intersectSphere}get[_Shape$types$PLANE](){return this._intersectPlane}get[_Shape$types$BOX](){return this._intersectBox}get[_Shape$types$CYLINDER](){return this._intersectConvex}get[_Shape$types$CONVEXPO](){return this._intersectConvex}get[_Shape$types$HEIGHTFI](){return this._intersectHeightfield}get[_Shape$types$TRIMESH](){return this._intersectTrimesh}constructor(o,c){o===void 0&&(o=new Vec3),c===void 0&&(c=new Vec3),this.from=o.clone(),this.to=c.clone(),this.direction=new Vec3,this.precision=1e-4,this.checkCollisionResponse=!0,this.skipBackfaces=!1,this.collisionFilterMask=-1,this.collisionFilterGroup=-1,this.mode=Ray.ANY,this.result=new RaycastResult,this.hasHit=!1,this.callback=d=>{}}intersectWorld(o,c){return this.mode=c.mode||Ray.ANY,this.result=c.result||new RaycastResult,this.skipBackfaces=!!c.skipBackfaces,this.collisionFilterMask=c.collisionFilterMask!==void 0?c.collisionFilterMask:-1,this.collisionFilterGroup=c.collisionFilterGroup!==void 0?c.collisionFilterGroup:-1,this.checkCollisionResponse=c.checkCollisionResponse===void 0||c.checkCollisionResponse,c.from&&this.from.copy(c.from),c.to&&this.to.copy(c.to),this.callback=c.callback||(()=>{}),this.hasHit=!1,this.result.reset(),this.updateDirection(),this.getAABB(tmpAABB$1),tmpArray.length=0,o.broadphase.aabbQuery(o,tmpAABB$1,tmpArray),this.intersectBodies(tmpArray),this.hasHit}intersectBody(o,c){c&&(this.result=c,this.updateDirection());const d=this.checkCollisionResponse;if(d&&!o.collisionResponse||!(this.collisionFilterGroup&o.collisionFilterMask&&o.collisionFilterGroup&this.collisionFilterMask))return;const _=intersectBody_xi,b=intersectBody_qi;for(let _e=0,it=o.shapes.length;_e<it;_e++){const nt=o.shapes[_e];if((!d||nt.collisionResponse)&&(o.quaternion.mult(o.shapeOrientations[_e],b),o.quaternion.vmult(o.shapeOffsets[_e],_),_.vadd(o.position,_),this.intersectShape(nt,b,_,o),this.result.shouldStop))break}}intersectBodies(o,c){c&&(this.result=c,this.updateDirection());for(let d=0,_=o.length;!this.result.shouldStop&&d<_;d++)this.intersectBody(o[d])}updateDirection(){this.to.vsub(this.from,this.direction),this.direction.normalize()}intersectShape(o,c,d,_){if(distanceFromIntersection(this.from,this.direction,d)>o.boundingSphereRadius)return;const b=this[o.type];b&&b.call(this,o,c,d,_,o)}_intersectBox(o,c,d,_,b){return this._intersectConvex(o.convexPolyhedronRepresentation,c,d,_,b)}_intersectPlane(o,c,d,_,b){const _e=this.from,it=this.to,nt=this.direction,at=new Vec3(0,0,1);c.vmult(at,at);const ut=new Vec3;_e.vsub(d,ut);const pt=ut.dot(at);if(it.vsub(d,ut),pt*ut.dot(at)>0||_e.distanceTo(it)<pt)return;const mt=at.dot(nt);if(Math.abs(mt)<this.precision)return;const ft=new Vec3,vt=new Vec3,xt=new Vec3;_e.vsub(d,ft);const At=-at.dot(ft)/mt;nt.scale(At,vt),_e.vadd(vt,xt),this.reportIntersection(at,xt,b,_,-1)}getAABB(o){const{lowerBound:c,upperBound:d}=o,_=this.to,b=this.from;c.x=Math.min(_.x,b.x),c.y=Math.min(_.y,b.y),c.z=Math.min(_.z,b.z),d.x=Math.max(_.x,b.x),d.y=Math.max(_.y,b.y),d.z=Math.max(_.z,b.z)}_intersectHeightfield(o,c,d,_,b){o.data,o.elementSize;const _e=intersectHeightfield_localRay;_e.from.copy(this.from),_e.to.copy(this.to),cannon_es_Transform.pointToLocalFrame(d,c,_e.from,_e.from),cannon_es_Transform.pointToLocalFrame(d,c,_e.to,_e.to),_e.updateDirection();const it=intersectHeightfield_index;let nt,at,ut,pt;nt=at=0,ut=pt=o.data.length-1;const mt=new AABB;_e.getAABB(mt),o.getIndexOfPosition(mt.lowerBound.x,mt.lowerBound.y,it,!0),nt=Math.max(nt,it[0]),at=Math.max(at,it[1]),o.getIndexOfPosition(mt.upperBound.x,mt.upperBound.y,it,!0),ut=Math.min(ut,it[0]+1),pt=Math.min(pt,it[1]+1);for(let ft=nt;ft<ut;ft++)for(let vt=at;vt<pt;vt++){if(this.result.shouldStop)return;if(o.getAabbAtIndex(ft,vt,mt),mt.overlapsRay(_e)){if(o.getConvexTrianglePillar(ft,vt,!1),cannon_es_Transform.pointToWorldFrame(d,c,o.pillarOffset,worldPillarOffset),this._intersectConvex(o.pillarConvex,c,worldPillarOffset,_,b,intersectConvexOptions),this.result.shouldStop)return;o.getConvexTrianglePillar(ft,vt,!0),cannon_es_Transform.pointToWorldFrame(d,c,o.pillarOffset,worldPillarOffset),this._intersectConvex(o.pillarConvex,c,worldPillarOffset,_,b,intersectConvexOptions)}}}_intersectSphere(o,c,d,_,b){const _e=this.from,it=this.to,nt=o.radius,at=(it.x-_e.x)**2+(it.y-_e.y)**2+(it.z-_e.z)**2,ut=2*((it.x-_e.x)*(_e.x-d.x)+(it.y-_e.y)*(_e.y-d.y)+(it.z-_e.z)*(_e.z-d.z)),pt=ut**2-4*at*((_e.x-d.x)**2+(_e.y-d.y)**2+(_e.z-d.z)**2-nt**2),mt=Ray_intersectSphere_intersectionPoint,ft=Ray_intersectSphere_normal;if(!(pt<0))if(pt===0)_e.lerp(it,pt,mt),mt.vsub(d,ft),ft.normalize(),this.reportIntersection(ft,mt,b,_,-1);else{const vt=(-ut-Math.sqrt(pt))/(2*at),xt=(-ut+Math.sqrt(pt))/(2*at);if(vt>=0&&vt<=1&&(_e.lerp(it,vt,mt),mt.vsub(d,ft),ft.normalize(),this.reportIntersection(ft,mt,b,_,-1)),this.result.shouldStop)return;xt>=0&&xt<=1&&(_e.lerp(it,xt,mt),mt.vsub(d,ft),ft.normalize(),this.reportIntersection(ft,mt,b,_,-1))}}_intersectConvex(o,c,d,_,b,_e){const it=intersectConvex_normal,nt=intersectConvex_vector,at=_e&&_e.faceList||null,ut=o.faces,pt=o.vertices,mt=o.faceNormals,ft=this.direction,vt=this.from,xt=this.to,At=vt.distanceTo(xt),Ct=at?at.length:ut.length,Et=this.result;for(let Tt=0;!Et.shouldStop&&Tt<Ct;Tt++){const kt=at?at[Tt]:Tt,Dt=ut[kt],zt=mt[kt],Bt=c,Rt=d;nt.copy(pt[Dt[0]]),Bt.vmult(nt,nt),nt.vadd(Rt,nt),nt.vsub(vt,nt),Bt.vmult(zt,it);const Ut=ft.dot(it);if(Math.abs(Ut)<this.precision)continue;const Ht=it.dot(nt)/Ut;if(!(Ht<0)){ft.scale(Ht,intersectPoint),intersectPoint.vadd(vt,intersectPoint),cannon_es_a.copy(pt[Dt[0]]),Bt.vmult(cannon_es_a,cannon_es_a),Rt.vadd(cannon_es_a,cannon_es_a);for(let Jt=1;!Et.shouldStop&&Jt<Dt.length-1;Jt++){cannon_es_b.copy(pt[Dt[Jt]]),cannon_es_c.copy(pt[Dt[Jt+1]]),Bt.vmult(cannon_es_b,cannon_es_b),Bt.vmult(cannon_es_c,cannon_es_c),Rt.vadd(cannon_es_b,cannon_es_b),Rt.vadd(cannon_es_c,cannon_es_c);const Kt=intersectPoint.distanceTo(vt);!Ray.pointInTriangle(intersectPoint,cannon_es_a,cannon_es_b,cannon_es_c)&&!Ray.pointInTriangle(intersectPoint,cannon_es_b,cannon_es_a,cannon_es_c)||Kt>At||this.reportIntersection(it,intersectPoint,b,_,kt)}}}}_intersectTrimesh(o,c,d,_,b,_e){const it=intersectTrimesh_normal,nt=intersectTrimesh_triangles,at=intersectTrimesh_treeTransform,ut=intersectConvex_vector,pt=intersectTrimesh_localDirection,mt=intersectTrimesh_localFrom,ft=intersectTrimesh_localTo,vt=intersectTrimesh_worldIntersectPoint,xt=intersectTrimesh_worldNormal,At=o.indices;o.vertices;const Ct=this.from,Et=this.to,Tt=this.direction;at.position.copy(d),at.quaternion.copy(c),cannon_es_Transform.vectorToLocalFrame(d,c,Tt,pt),cannon_es_Transform.pointToLocalFrame(d,c,Ct,mt),cannon_es_Transform.pointToLocalFrame(d,c,Et,ft),ft.x*=o.scale.x,ft.y*=o.scale.y,ft.z*=o.scale.z,mt.x*=o.scale.x,mt.y*=o.scale.y,mt.z*=o.scale.z,ft.vsub(mt,pt),pt.normalize();const kt=mt.distanceSquared(ft);o.tree.rayQuery(this,at,nt);for(let Dt=0,zt=nt.length;!this.result.shouldStop&&Dt!==zt;Dt++){const Bt=nt[Dt];o.getNormal(Bt,it),o.getVertex(At[3*Bt],cannon_es_a),cannon_es_a.vsub(mt,ut);const Rt=pt.dot(it),Ut=it.dot(ut)/Rt;if(Ut<0)continue;pt.scale(Ut,intersectPoint),intersectPoint.vadd(mt,intersectPoint),o.getVertex(At[3*Bt+1],cannon_es_b),o.getVertex(At[3*Bt+2],cannon_es_c);const Ht=intersectPoint.distanceSquared(mt);!Ray.pointInTriangle(intersectPoint,cannon_es_b,cannon_es_a,cannon_es_c)&&!Ray.pointInTriangle(intersectPoint,cannon_es_a,cannon_es_b,cannon_es_c)||Ht>kt||(cannon_es_Transform.vectorToWorldFrame(c,it,xt),cannon_es_Transform.pointToWorldFrame(d,c,intersectPoint,vt),this.reportIntersection(xt,vt,b,_,Bt))}nt.length=0}reportIntersection(o,c,d,_,b){const _e=this.from,it=this.to,nt=_e.distanceTo(c),at=this.result;if(!(this.skipBackfaces&&o.dot(this.direction)>0))switch(at.hitFaceIndex=b!==void 0?b:-1,this.mode){case Ray.ALL:this.hasHit=!0,at.set(_e,it,o,c,d,_,nt),at.hasHit=!0,this.callback(at);break;case Ray.CLOSEST:(nt<at.distance||!at.hasHit)&&(this.hasHit=!0,at.hasHit=!0,at.set(_e,it,o,c,d,_,nt));break;case Ray.ANY:this.hasHit=!0,at.hasHit=!0,at.set(_e,it,o,c,d,_,nt),at.shouldStop=!0}}static pointInTriangle(o,c,d,_){_.vsub(c,v0),d.vsub(c,v1),o.vsub(c,v2);const b=v0.dot(v0),_e=v0.dot(v1),it=v0.dot(v2),nt=v1.dot(v1),at=v1.dot(v2);let ut,pt;return(ut=nt*it-_e*at)>=0&&(pt=b*at-_e*it)>=0&&ut+pt<b*nt-_e*_e}}Ray.CLOSEST=RAY_MODES.CLOSEST,Ray.ANY=RAY_MODES.ANY,Ray.ALL=RAY_MODES.ALL;const tmpAABB$1=new AABB,tmpArray=[],v1=new Vec3,v2=new Vec3,intersectBody_xi=new Vec3,intersectBody_qi=new Quaternion,intersectPoint=new Vec3,cannon_es_a=new Vec3,cannon_es_b=new Vec3,cannon_es_c=new Vec3;new Vec3,new RaycastResult;const intersectConvexOptions={faceList:[0]},worldPillarOffset=new Vec3,intersectHeightfield_localRay=new Ray,intersectHeightfield_index=[],Ray_intersectSphere_intersectionPoint=new Vec3,Ray_intersectSphere_normal=new Vec3,intersectConvex_normal=new Vec3;new Vec3;new Vec3;const intersectConvex_vector=new Vec3,intersectTrimesh_normal=new Vec3,intersectTrimesh_localDirection=new Vec3,intersectTrimesh_localFrom=new Vec3,intersectTrimesh_localTo=new Vec3,intersectTrimesh_worldNormal=new Vec3,intersectTrimesh_worldIntersectPoint=new Vec3;new AABB;const intersectTrimesh_triangles=[],intersectTrimesh_treeTransform=new cannon_es_Transform,v0=new Vec3,intersect=new Vec3;function distanceFromIntersection(h,o,c){c.vsub(h,v0);const d=v0.dot(o);return o.scale(d,intersect),intersect.vadd(h,intersect),c.distanceTo(intersect)}class Utils{static defaults(o,c){o===void 0&&(o={});for(let d in c)d in o||(o[d]=c[d]);return o}}class Constraint{constructor(o,c,d){d===void 0&&(d={}),d=Utils.defaults(d,{collideConnected:!0,wakeUpBodies:!0}),this.equations=[],this.bodyA=o,this.bodyB=c,this.id=Constraint.idCounter++,this.collideConnected=d.collideConnected,d.wakeUpBodies&&(o&&o.wakeUp(),c&&c.wakeUp())}update(){throw new Error("method update() not implmemented in this Constraint subclass!")}enable(){const o=this.equations;for(let c=0;c<o.length;c++)o[c].enabled=!0}disable(){const o=this.equations;for(let c=0;c<o.length;c++)o[c].enabled=!1}}Constraint.idCounter=0;class JacobianElement{constructor(){this.spatial=new Vec3,this.rotational=new Vec3}multiplyElement(o){return o.spatial.dot(this.spatial)+o.rotational.dot(this.rotational)}multiplyVectors(o,c){return o.dot(this.spatial)+c.dot(this.rotational)}}class Equation{constructor(o,c,d,_){d===void 0&&(d=-1e6),_===void 0&&(_=1e6),this.id=Equation.idCounter++,this.minForce=d,this.maxForce=_,this.bi=o,this.bj=c,this.a=0,this.b=0,this.eps=0,this.jacobianElementA=new JacobianElement,this.jacobianElementB=new JacobianElement,this.enabled=!0,this.multiplier=0,this.setSpookParams(1e7,4,1/60)}setSpookParams(o,c,d){const _=c,b=o,_e=d;this.a=4/(_e*(1+4*_)),this.b=4*_/(1+4*_),this.eps=4/(_e*_e*b*(1+4*_))}computeB(o,c,d){const _=this.computeGW();return-this.computeGq()*o-_*c-this.computeGiMf()*d}computeGq(){const o=this.jacobianElementA,c=this.jacobianElementB,d=this.bi,_=this.bj,b=d.position,_e=_.position;return o.spatial.dot(b)+c.spatial.dot(_e)}computeGW(){const o=this.jacobianElementA,c=this.jacobianElementB,d=this.bi,_=this.bj,b=d.velocity,_e=_.velocity,it=d.angularVelocity,nt=_.angularVelocity;return o.multiplyVectors(b,it)+c.multiplyVectors(_e,nt)}computeGWlambda(){const o=this.jacobianElementA,c=this.jacobianElementB,d=this.bi,_=this.bj,b=d.vlambda,_e=_.vlambda,it=d.wlambda,nt=_.wlambda;return o.multiplyVectors(b,it)+c.multiplyVectors(_e,nt)}computeGiMf(){const o=this.jacobianElementA,c=this.jacobianElementB,d=this.bi,_=this.bj,b=d.force,_e=d.torque,it=_.force,nt=_.torque,at=d.invMassSolve,ut=_.invMassSolve;return b.scale(at,iMfi),it.scale(ut,iMfj),d.invInertiaWorldSolve.vmult(_e,invIi_vmult_taui),_.invInertiaWorldSolve.vmult(nt,invIj_vmult_tauj),o.multiplyVectors(iMfi,invIi_vmult_taui)+c.multiplyVectors(iMfj,invIj_vmult_tauj)}computeGiMGt(){const o=this.jacobianElementA,c=this.jacobianElementB,d=this.bi,_=this.bj,b=d.invMassSolve,_e=_.invMassSolve,it=d.invInertiaWorldSolve,nt=_.invInertiaWorldSolve;let at=b+_e;return it.vmult(o.rotational,tmp),at+=tmp.dot(o.rotational),nt.vmult(c.rotational,tmp),at+=tmp.dot(c.rotational),at}addToWlambda(o){const c=this.jacobianElementA,d=this.jacobianElementB,_=this.bi,b=this.bj,_e=addToWlambda_temp;_.vlambda.addScaledVector(_.invMassSolve*o,c.spatial,_.vlambda),b.vlambda.addScaledVector(b.invMassSolve*o,d.spatial,b.vlambda),_.invInertiaWorldSolve.vmult(c.rotational,_e),_.wlambda.addScaledVector(o,_e,_.wlambda),b.invInertiaWorldSolve.vmult(d.rotational,_e),b.wlambda.addScaledVector(o,_e,b.wlambda)}computeC(){return this.computeGiMGt()+this.eps}}Equation.idCounter=0;const iMfi=new Vec3,iMfj=new Vec3,invIi_vmult_taui=new Vec3,invIj_vmult_tauj=new Vec3,tmp=new Vec3,addToWlambda_temp=new Vec3;class ContactEquation extends Equation{constructor(o,c,d){d===void 0&&(d=1e6),super(o,c,0,d),this.restitution=0,this.ri=new Vec3,this.rj=new Vec3,this.ni=new Vec3}computeB(o){const c=this.a,d=this.b,_=this.bi,b=this.bj,_e=this.ri,it=this.rj,nt=ContactEquation_computeB_temp1,at=ContactEquation_computeB_temp2,ut=_.velocity,pt=_.angularVelocity;_.force,_.torque;const mt=b.velocity,ft=b.angularVelocity;b.force,b.torque;const vt=ContactEquation_computeB_temp3,xt=this.jacobianElementA,At=this.jacobianElementB,Ct=this.ni;_e.cross(Ct,nt),it.cross(Ct,at),Ct.negate(xt.spatial),nt.negate(xt.rotational),At.spatial.copy(Ct),At.rotational.copy(at),vt.copy(b.position),vt.vadd(it,vt),vt.vsub(_.position,vt),vt.vsub(_e,vt);const Et=Ct.dot(vt),Tt=this.restitution+1;return-Et*c-(Tt*mt.dot(Ct)-Tt*ut.dot(Ct)+ft.dot(at)-pt.dot(nt))*d-o*this.computeGiMf()}getImpactVelocityAlongNormal(){const o=ContactEquation_getImpactVelocityAlongNormal_vi,c=ContactEquation_getImpactVelocityAlongNormal_vj,d=ContactEquation_getImpactVelocityAlongNormal_xi,_=ContactEquation_getImpactVelocityAlongNormal_xj,b=ContactEquation_getImpactVelocityAlongNormal_relVel;return this.bi.position.vadd(this.ri,d),this.bj.position.vadd(this.rj,_),this.bi.getVelocityAtWorldPoint(d,o),this.bj.getVelocityAtWorldPoint(_,c),o.vsub(c,b),this.ni.dot(b)}}const ContactEquation_computeB_temp1=new Vec3,ContactEquation_computeB_temp2=new Vec3,ContactEquation_computeB_temp3=new Vec3,ContactEquation_getImpactVelocityAlongNormal_vi=new Vec3,ContactEquation_getImpactVelocityAlongNormal_vj=new Vec3,ContactEquation_getImpactVelocityAlongNormal_xi=new Vec3,ContactEquation_getImpactVelocityAlongNormal_xj=new Vec3,ContactEquation_getImpactVelocityAlongNormal_relVel=new Vec3;class PointToPointConstraint extends Constraint{constructor(o,c,d,_,b){c===void 0&&(c=new Vec3),_===void 0&&(_=new Vec3),b===void 0&&(b=1e6),super(o,d),this.pivotA=c.clone(),this.pivotB=_.clone();const _e=this.equationX=new ContactEquation(o,d),it=this.equationY=new ContactEquation(o,d),nt=this.equationZ=new ContactEquation(o,d);this.equations.push(_e,it,nt),_e.minForce=it.minForce=nt.minForce=-b,_e.maxForce=it.maxForce=nt.maxForce=b,_e.ni.set(1,0,0),it.ni.set(0,1,0),nt.ni.set(0,0,1)}update(){const o=this.bodyA,c=this.bodyB,d=this.equationX,_=this.equationY,b=this.equationZ;o.quaternion.vmult(this.pivotA,d.ri),c.quaternion.vmult(this.pivotB,d.rj),_.ri.copy(d.ri),_.rj.copy(d.rj),b.ri.copy(d.ri),b.rj.copy(d.rj)}}new Vec3;new Vec3;new Vec3;new Vec3;new Vec3,new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;class FrictionEquation extends Equation{constructor(o,c,d){super(o,c,-d,d),this.ri=new Vec3,this.rj=new Vec3,this.t=new Vec3}computeB(o){this.a;const c=this.b;this.bi,this.bj;const d=this.ri,_=this.rj,b=FrictionEquation_computeB_temp1,_e=FrictionEquation_computeB_temp2,it=this.t;d.cross(it,b),_.cross(it,_e);const nt=this.jacobianElementA,at=this.jacobianElementB;return it.negate(nt.spatial),b.negate(nt.rotational),at.spatial.copy(it),at.rotational.copy(_e),-this.computeGW()*c-o*this.computeGiMf()}}const FrictionEquation_computeB_temp1=new Vec3,FrictionEquation_computeB_temp2=new Vec3;class ContactMaterial{constructor(o,c,d){d=Utils.defaults(d,{friction:.3,restitution:.3,contactEquationStiffness:1e7,contactEquationRelaxation:3,frictionEquationStiffness:1e7,frictionEquationRelaxation:3}),this.id=ContactMaterial.idCounter++,this.materials=[o,c],this.friction=d.friction,this.restitution=d.restitution,this.contactEquationStiffness=d.contactEquationStiffness,this.contactEquationRelaxation=d.contactEquationRelaxation,this.frictionEquationStiffness=d.frictionEquationStiffness,this.frictionEquationRelaxation=d.frictionEquationRelaxation}}ContactMaterial.idCounter=0;class cannon_es_Material{constructor(o){o===void 0&&(o={});let c="";typeof o=="string"&&(c=o,o={}),this.name=c,this.id=cannon_es_Material.idCounter++,this.friction=o.friction!==void 0?o.friction:-1,this.restitution=o.restitution!==void 0?o.restitution:-1}}cannon_es_Material.idCounter=0;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3,new Vec3,new Vec3;new Vec3;new Vec3;new Vec3;new Ray,new Vec3;new Vec3;new Vec3;new Vec3(1,0,0),new Vec3(0,1,0),new Vec3(0,0,1);new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;class Sphere extends Shape{constructor(o){if(super({type:Shape.types.SPHERE}),this.radius=o!==void 0?o:1,this.radius<0)throw new Error("The sphere radius cannot be negative.");this.updateBoundingSphereRadius()}calculateLocalInertia(o,c){c===void 0&&(c=new Vec3);const d=2*o*this.radius*this.radius/5;return c.x=d,c.y=d,c.z=d,c}volume(){return 4*Math.PI*Math.pow(this.radius,3)/3}updateBoundingSphereRadius(){this.boundingSphereRadius=this.radius}calculateWorldAABB(o,c,d,_){const b=this.radius,_e=["x","y","z"];for(let it=0;it<_e.length;it++){const nt=_e[it];d[nt]=o[nt]-b,_[nt]=o[nt]+b}}}new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;class Cylinder extends ConvexPolyhedron{constructor(o,c,d,_){if(o===void 0&&(o=1),c===void 0&&(c=1),d===void 0&&(d=1),_===void 0&&(_=8),o<0)throw new Error("The cylinder radiusTop cannot be negative.");if(c<0)throw new Error("The cylinder radiusBottom cannot be negative.");const b=_,_e=[],it=[],nt=[],at=[],ut=[],pt=Math.cos,mt=Math.sin;_e.push(new Vec3(-c*mt(0),.5*-d,c*pt(0))),at.push(0),_e.push(new Vec3(-o*mt(0),.5*d,o*pt(0))),ut.push(1);for(let vt=0;vt<b;vt++){const xt=2*Math.PI/b*(vt+1),At=2*Math.PI/b*(vt+.5);vt<b-1?(_e.push(new Vec3(-c*mt(xt),.5*-d,c*pt(xt))),at.push(2*vt+2),_e.push(new Vec3(-o*mt(xt),.5*d,o*pt(xt))),ut.push(2*vt+3),nt.push([2*vt,2*vt+1,2*vt+3,2*vt+2])):nt.push([2*vt,2*vt+1,1,0]),(b%2==1||vt<b/2)&&it.push(new Vec3(-mt(At),0,pt(At)))}nt.push(at),it.push(new Vec3(0,1,0));const ft=[];for(let vt=0;vt<ut.length;vt++)ft.push(ut[ut.length-vt-1]);nt.push(ft),super({vertices:_e,faces:nt,axes:it}),this.type=Shape.types.CYLINDER,this.radiusTop=o,this.radiusBottom=c,this.height=d,this.numSegments=_}}class cannon_es_Plane extends Shape{constructor(){super({type:Shape.types.PLANE}),this.worldNormal=new Vec3,this.worldNormalNeedsUpdate=!0,this.boundingSphereRadius=Number.MAX_VALUE}computeWorldNormal(o){const c=this.worldNormal;c.set(0,0,1),o.vmult(c,c),this.worldNormalNeedsUpdate=!1}calculateLocalInertia(o,c){return c===void 0&&(c=new Vec3),c}volume(){return Number.MAX_VALUE}calculateWorldAABB(o,c,d,_){tempNormal.set(0,0,1),c.vmult(tempNormal,tempNormal);const b=Number.MAX_VALUE;d.set(-b,-b,-b),_.set(b,b,b),tempNormal.x===1?_.x=o.x:tempNormal.x===-1&&(d.x=o.x),tempNormal.y===1?_.y=o.y:tempNormal.y===-1&&(d.y=o.y),tempNormal.z===1?_.z=o.z:tempNormal.z===-1&&(d.z=o.z)}updateBoundingSphereRadius(){this.boundingSphereRadius=Number.MAX_VALUE}}const tempNormal=new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;new Vec3;class OctreeNode{constructor(o){o===void 0&&(o={}),this.root=o.root||null,this.aabb=o.aabb?o.aabb.clone():new AABB,this.data=[],this.children=[]}reset(){this.children.length=this.data.length=0}insert(o,c,d){d===void 0&&(d=0);const _=this.data;if(!this.aabb.contains(o))return!1;const b=this.children;if(d<(this.maxDepth||this.root.maxDepth)){let _e=!1;b.length||(this.subdivide(),_e=!0);for(let it=0;it!==8;it++)if(b[it].insert(o,c,d+1))return!0;_e&&(b.length=0)}return _.push(c),!0}subdivide(){const o=this.aabb,c=o.lowerBound,d=o.upperBound,_=this.children;_.push(new OctreeNode({aabb:new AABB({lowerBound:new Vec3(0,0,0)})}),new OctreeNode({aabb:new AABB({lowerBound:new Vec3(1,0,0)})}),new OctreeNode({aabb:new AABB({lowerBound:new Vec3(1,1,0)})}),new OctreeNode({aabb:new AABB({lowerBound:new Vec3(1,1,1)})}),new OctreeNode({aabb:new AABB({lowerBound:new Vec3(0,1,1)})}),new OctreeNode({aabb:new AABB({lowerBound:new Vec3(0,0,1)})}),new OctreeNode({aabb:new AABB({lowerBound:new Vec3(1,0,1)})}),new OctreeNode({aabb:new AABB({lowerBound:new Vec3(0,1,0)})})),d.vsub(c,halfDiagonal),halfDiagonal.scale(.5,halfDiagonal);const b=this.root||this;for(let _e=0;_e!==8;_e++){const it=_[_e];it.root=b;const nt=it.aabb.lowerBound;nt.x*=halfDiagonal.x,nt.y*=halfDiagonal.y,nt.z*=halfDiagonal.z,nt.vadd(c,nt),nt.vadd(halfDiagonal,it.aabb.upperBound)}}aabbQuery(o,c){this.data,this.children;const d=[this];for(;d.length;){const _=d.pop();_.aabb.overlaps(o)&&Array.prototype.push.apply(c,_.data),Array.prototype.push.apply(d,_.children)}return c}rayQuery(o,c,d){return o.getAABB(tmpAABB),tmpAABB.toLocalFrame(c,tmpAABB),this.aabbQuery(tmpAABB,d),d}removeEmptyNodes(){for(let o=this.children.length-1;o>=0;o--)this.children[o].removeEmptyNodes(),this.children[o].children.length||this.children[o].data.length||this.children.splice(o,1)}}class Octree extends OctreeNode{constructor(o,c){c===void 0&&(c={}),super({root:null,aabb:o}),this.maxDepth=c.maxDepth!==void 0?c.maxDepth:8}}const halfDiagonal=new Vec3,tmpAABB=new AABB;class Trimesh extends Shape{constructor(o,c){super({type:Shape.types.TRIMESH}),this.vertices=new Float32Array(o),this.indices=new Int16Array(c),this.normals=new Float32Array(c.length),this.aabb=new AABB,this.edges=null,this.scale=new Vec3(1,1,1),this.tree=new Octree,this.updateEdges(),this.updateNormals(),this.updateAABB(),this.updateBoundingSphereRadius(),this.updateTree()}updateTree(){const o=this.tree;o.reset(),o.aabb.copy(this.aabb);const c=this.scale;o.aabb.lowerBound.x*=1/c.x,o.aabb.lowerBound.y*=1/c.y,o.aabb.lowerBound.z*=1/c.z,o.aabb.upperBound.x*=1/c.x,o.aabb.upperBound.y*=1/c.y,o.aabb.upperBound.z*=1/c.z;const d=new AABB,_=new Vec3,b=new Vec3,_e=new Vec3,it=[_,b,_e];for(let nt=0;nt<this.indices.length/3;nt++){const at=3*nt;this._getUnscaledVertex(this.indices[at],_),this._getUnscaledVertex(this.indices[at+1],b),this._getUnscaledVertex(this.indices[at+2],_e),d.setFromPoints(it),o.insert(d,nt)}o.removeEmptyNodes()}getTrianglesInAABB(o,c){unscaledAABB.copy(o);const d=this.scale,_=d.x,b=d.y,_e=d.z,it=unscaledAABB.lowerBound,nt=unscaledAABB.upperBound;return it.x/=_,it.y/=b,it.z/=_e,nt.x/=_,nt.y/=b,nt.z/=_e,this.tree.aabbQuery(unscaledAABB,c)}setScale(o){const c=this.scale.x===this.scale.y&&this.scale.y===this.scale.z,d=o.x===o.y&&o.y===o.z;c&&d||this.updateNormals(),this.scale.copy(o),this.updateAABB(),this.updateBoundingSphereRadius()}updateNormals(){const o=computeNormals_n,c=this.normals;for(let d=0;d<this.indices.length/3;d++){const _=3*d,b=this.indices[_],_e=this.indices[_+1],it=this.indices[_+2];this.getVertex(b,va$1),this.getVertex(_e,vb$1),this.getVertex(it,vc$1),Trimesh.computeNormal(vb$1,va$1,vc$1,o),c[_]=o.x,c[_+1]=o.y,c[_+2]=o.z}}updateEdges(){const o={},c=(_,b)=>{o[_<b?`${_}_${b}`:`${b}_${_}`]=!0};for(let _=0;_<this.indices.length/3;_++){const b=3*_,_e=this.indices[b],it=this.indices[b+1],nt=this.indices[b+2];c(_e,it),c(it,nt),c(nt,_e)}const d=Object.keys(o);this.edges=new Int16Array(2*d.length);for(let _=0;_<d.length;_++){const b=d[_].split("_");this.edges[2*_]=parseInt(b[0],10),this.edges[2*_+1]=parseInt(b[1],10)}}getEdgeVertex(o,c,d){const _=this.edges[2*o+(c?1:0)];this.getVertex(_,d)}getEdgeVector(o,c){const d=getEdgeVector_va,_=getEdgeVector_vb;this.getEdgeVertex(o,0,d),this.getEdgeVertex(o,1,_),_.vsub(d,c)}static computeNormal(o,c,d,_){c.vsub(o,ab$1),d.vsub(c,cannon_es_cb),cannon_es_cb.cross(ab$1,_),_.isZero()||_.normalize()}getVertex(o,c){const d=this.scale;return this._getUnscaledVertex(o,c),c.x*=d.x,c.y*=d.y,c.z*=d.z,c}_getUnscaledVertex(o,c){const d=3*o,_=this.vertices;return c.set(_[d],_[d+1],_[d+2])}getWorldVertex(o,c,d,_){return this.getVertex(o,_),cannon_es_Transform.pointToWorldFrame(c,d,_,_),_}getTriangleVertices(o,c,d,_){const b=3*o;this.getVertex(this.indices[b],c),this.getVertex(this.indices[b+1],d),this.getVertex(this.indices[b+2],_)}getNormal(o,c){const d=3*o;return c.set(this.normals[d],this.normals[d+1],this.normals[d+2])}calculateLocalInertia(o,c){this.computeLocalAABB(cli_aabb);const d=cli_aabb.upperBound.x-cli_aabb.lowerBound.x,_=cli_aabb.upperBound.y-cli_aabb.lowerBound.y,b=cli_aabb.upperBound.z-cli_aabb.lowerBound.z;return c.set(1/12*o*(2*_*2*_+2*b*2*b),1/12*o*(2*d*2*d+2*b*2*b),1/12*o*(2*_*2*_+2*d*2*d))}computeLocalAABB(o){const c=o.lowerBound,d=o.upperBound,_=this.vertices.length;this.vertices;const b=computeLocalAABB_worldVert;this.getVertex(0,b),c.copy(b),d.copy(b);for(let _e=0;_e!==_;_e++)this.getVertex(_e,b),b.x<c.x?c.x=b.x:b.x>d.x&&(d.x=b.x),b.y<c.y?c.y=b.y:b.y>d.y&&(d.y=b.y),b.z<c.z?c.z=b.z:b.z>d.z&&(d.z=b.z)}updateAABB(){this.computeLocalAABB(this.aabb)}updateBoundingSphereRadius(){let o=0;const c=this.vertices,d=new Vec3;for(let _=0,b=c.length/3;_!==b;_++){this.getVertex(_,d);const _e=d.lengthSquared();_e>o&&(o=_e)}this.boundingSphereRadius=Math.sqrt(o)}calculateWorldAABB(o,c,d,_){const b=calculateWorldAABB_frame,_e=calculateWorldAABB_aabb;b.position=o,b.quaternion=c,this.aabb.toWorldFrame(b,_e),d.copy(_e.lowerBound),_.copy(_e.upperBound)}volume(){return 4*Math.PI*this.boundingSphereRadius/3}static createTorus(o,c,d,_,b){o===void 0&&(o=1),c===void 0&&(c=.5),d===void 0&&(d=8),_===void 0&&(_=6),b===void 0&&(b=2*Math.PI);const _e=[],it=[];for(let nt=0;nt<=d;nt++)for(let at=0;at<=_;at++){const ut=at/_*b,pt=nt/d*Math.PI*2,mt=(o+c*Math.cos(pt))*Math.cos(ut),ft=(o+c*Math.cos(pt))*Math.sin(ut),vt=c*Math.sin(pt);_e.push(mt,ft,vt)}for(let nt=1;nt<=d;nt++)for(let at=1;at<=_;at++){const ut=(_+1)*nt+at-1,pt=(_+1)*(nt-1)+at-1,mt=(_+1)*(nt-1)+at,ft=(_+1)*nt+at;it.push(ut,pt,ft),it.push(pt,mt,ft)}return new Trimesh(_e,it)}}const computeNormals_n=new Vec3,unscaledAABB=new AABB,getEdgeVector_va=new Vec3,getEdgeVector_vb=new Vec3,cannon_es_cb=new Vec3,ab$1=new Vec3,va$1=new Vec3,vb$1=new Vec3,vc$1=new Vec3,cli_aabb=new AABB,computeLocalAABB_worldVert=new Vec3,calculateWorldAABB_frame=new cannon_es_Transform,calculateWorldAABB_aabb=new AABB;class Solver{constructor(){this.equations=[]}solve(o,c){return 0}addEquation(o){!o.enabled||o.bi.isTrigger||o.bj.isTrigger||this.equations.push(o)}removeEquation(o){const c=this.equations,d=c.indexOf(o);d!==-1&&c.splice(d,1)}removeAllEquations(){this.equations.length=0}}class GSSolver extends Solver{constructor(){super(),this.iterations=10,this.tolerance=1e-7}solve(o,c){let d=0;const _=this.iterations,b=this.tolerance*this.tolerance,_e=this.equations,it=_e.length,nt=c.bodies,at=nt.length,ut=o;let pt,mt,ft,vt,xt,At;if(it!==0)for(let kt=0;kt!==at;kt++)nt[kt].updateSolveMassProperties();const Ct=GSSolver_solve_invCs,Et=GSSolver_solve_Bs,Tt=GSSolver_solve_lambda;Ct.length=it,Et.length=it,Tt.length=it;for(let kt=0;kt!==it;kt++){const Dt=_e[kt];Tt[kt]=0,Et[kt]=Dt.computeB(ut),Ct[kt]=1/Dt.computeC()}if(it!==0){for(let zt=0;zt!==at;zt++){const Bt=nt[zt],Rt=Bt.vlambda,Ut=Bt.wlambda;Rt.set(0,0,0),Ut.set(0,0,0)}for(d=0;d!==_;d++){vt=0;for(let zt=0;zt!==it;zt++){const Bt=_e[zt];pt=Et[zt],mt=Ct[zt],At=Tt[zt],xt=Bt.computeGWlambda(),ft=mt*(pt-xt-Bt.eps*At),At+ft<Bt.minForce?ft=Bt.minForce-At:At+ft>Bt.maxForce&&(ft=Bt.maxForce-At),Tt[zt]+=ft,vt+=ft>0?ft:-ft,Bt.addToWlambda(ft)}if(vt*vt<b)break}for(let zt=0;zt!==at;zt++){const Bt=nt[zt],Rt=Bt.velocity,Ut=Bt.angularVelocity;Bt.vlambda.vmul(Bt.linearFactor,Bt.vlambda),Rt.vadd(Bt.vlambda,Rt),Bt.wlambda.vmul(Bt.angularFactor,Bt.wlambda),Ut.vadd(Bt.wlambda,Ut)}let kt=_e.length;const Dt=1/ut;for(;kt--;)_e[kt].multiplier=Tt[kt]*Dt}return d}}const GSSolver_solve_lambda=[],GSSolver_solve_invCs=[],GSSolver_solve_Bs=[];Body.STATIC;class Pool{constructor(){this.objects=[],this.type=Object}release(){const o=arguments.length;for(let c=0;c!==o;c++)this.objects.push(c<0||arguments.length<=c?void 0:arguments[c]);return this}get(){return this.objects.length===0?this.constructObject():this.objects.pop()}constructObject(){throw new Error("constructObject() not implemented in this Pool subclass yet!")}resize(o){const c=this.objects;for(;c.length>o;)c.pop();for(;c.length<o;)c.push(this.constructObject());return this}}class Vec3Pool extends Pool{constructor(){super(...arguments),this.type=Vec3}constructObject(){return new Vec3}}const COLLISION_TYPES={sphereSphere:Shape.types.SPHERE,spherePlane:Shape.types.SPHERE|Shape.types.PLANE,boxBox:Shape.types.BOX|Shape.types.BOX,sphereBox:Shape.types.SPHERE|Shape.types.BOX,planeBox:Shape.types.PLANE|Shape.types.BOX,convexConvex:Shape.types.CONVEXPOLYHEDRON,sphereConvex:Shape.types.SPHERE|Shape.types.CONVEXPOLYHEDRON,planeConvex:Shape.types.PLANE|Shape.types.CONVEXPOLYHEDRON,boxConvex:Shape.types.BOX|Shape.types.CONVEXPOLYHEDRON,sphereHeightfield:Shape.types.SPHERE|Shape.types.HEIGHTFIELD,boxHeightfield:Shape.types.BOX|Shape.types.HEIGHTFIELD,convexHeightfield:Shape.types.CONVEXPOLYHEDRON|Shape.types.HEIGHTFIELD,sphereParticle:Shape.types.PARTICLE|Shape.types.SPHERE,planeParticle:Shape.types.PLANE|Shape.types.PARTICLE,boxParticle:Shape.types.BOX|Shape.types.PARTICLE,convexParticle:Shape.types.PARTICLE|Shape.types.CONVEXPOLYHEDRON,cylinderCylinder:Shape.types.CYLINDER,sphereCylinder:Shape.types.SPHERE|Shape.types.CYLINDER,planeCylinder:Shape.types.PLANE|Shape.types.CYLINDER,boxCylinder:Shape.types.BOX|Shape.types.CYLINDER,convexCylinder:Shape.types.CONVEXPOLYHEDRON|Shape.types.CYLINDER,heightfieldCylinder:Shape.types.HEIGHTFIELD|Shape.types.CYLINDER,particleCylinder:Shape.types.PARTICLE|Shape.types.CYLINDER,sphereTrimesh:Shape.types.SPHERE|Shape.types.TRIMESH,planeTrimesh:Shape.types.PLANE|Shape.types.TRIMESH};class Narrowphase{get[COLLISION_TYPES.sphereSphere](){return this.sphereSphere}get[COLLISION_TYPES.spherePlane](){return this.spherePlane}get[COLLISION_TYPES.boxBox](){return this.boxBox}get[COLLISION_TYPES.sphereBox](){return this.sphereBox}get[COLLISION_TYPES.planeBox](){return this.planeBox}get[COLLISION_TYPES.convexConvex](){return this.convexConvex}get[COLLISION_TYPES.sphereConvex](){return this.sphereConvex}get[COLLISION_TYPES.planeConvex](){return this.planeConvex}get[COLLISION_TYPES.boxConvex](){return this.boxConvex}get[COLLISION_TYPES.sphereHeightfield](){return this.sphereHeightfield}get[COLLISION_TYPES.boxHeightfield](){return this.boxHeightfield}get[COLLISION_TYPES.convexHeightfield](){return this.convexHeightfield}get[COLLISION_TYPES.sphereParticle](){return this.sphereParticle}get[COLLISION_TYPES.planeParticle](){return this.planeParticle}get[COLLISION_TYPES.boxParticle](){return this.boxParticle}get[COLLISION_TYPES.convexParticle](){return this.convexParticle}get[COLLISION_TYPES.cylinderCylinder](){return this.convexConvex}get[COLLISION_TYPES.sphereCylinder](){return this.sphereConvex}get[COLLISION_TYPES.planeCylinder](){return this.planeConvex}get[COLLISION_TYPES.boxCylinder](){return this.boxConvex}get[COLLISION_TYPES.convexCylinder](){return this.convexConvex}get[COLLISION_TYPES.heightfieldCylinder](){return this.heightfieldCylinder}get[COLLISION_TYPES.particleCylinder](){return this.particleCylinder}get[COLLISION_TYPES.sphereTrimesh](){return this.sphereTrimesh}get[COLLISION_TYPES.planeTrimesh](){return this.planeTrimesh}constructor(o){this.contactPointPool=[],this.frictionEquationPool=[],this.result=[],this.frictionResult=[],this.v3pool=new Vec3Pool,this.world=o,this.currentContactMaterial=o.defaultContactMaterial,this.enableFrictionReduction=!1}createContactEquation(o,c,d,_,b,_e){let it;this.contactPointPool.length?(it=this.contactPointPool.pop(),it.bi=o,it.bj=c):it=new ContactEquation(o,c),it.enabled=o.collisionResponse&&c.collisionResponse&&d.collisionResponse&&_.collisionResponse;const nt=this.currentContactMaterial;it.restitution=nt.restitution,it.setSpookParams(nt.contactEquationStiffness,nt.contactEquationRelaxation,this.world.dt);const at=d.material||o.material,ut=_.material||c.material;return at&&ut&&at.restitution>=0&&ut.restitution>=0&&(it.restitution=at.restitution*ut.restitution),it.si=b||d,it.sj=_e||_,it}createFrictionEquationsFromContact(o,c){const d=o.bi,_=o.bj,b=o.si,_e=o.sj,it=this.world,nt=this.currentContactMaterial;let at=nt.friction;const ut=b.material||d.material,pt=_e.material||_.material;if(ut&&pt&&ut.friction>=0&&pt.friction>=0&&(at=ut.friction*pt.friction),at>0){const mt=at*it.gravity.length();let ft=d.invMass+_.invMass;ft>0&&(ft=1/ft);const vt=this.frictionEquationPool,xt=vt.length?vt.pop():new FrictionEquation(d,_,mt*ft),At=vt.length?vt.pop():new FrictionEquation(d,_,mt*ft);return xt.bi=At.bi=d,xt.bj=At.bj=_,xt.minForce=At.minForce=-mt*ft,xt.maxForce=At.maxForce=mt*ft,xt.ri.copy(o.ri),xt.rj.copy(o.rj),At.ri.copy(o.ri),At.rj.copy(o.rj),o.ni.tangents(xt.t,At.t),xt.setSpookParams(nt.frictionEquationStiffness,nt.frictionEquationRelaxation,it.dt),At.setSpookParams(nt.frictionEquationStiffness,nt.frictionEquationRelaxation,it.dt),xt.enabled=At.enabled=o.enabled,c.push(xt,At),!0}return!1}createFrictionFromAverage(o){let c=this.result[this.result.length-1];if(!this.createFrictionEquationsFromContact(c,this.frictionResult)||o===1)return;const d=this.frictionResult[this.frictionResult.length-2],_=this.frictionResult[this.frictionResult.length-1];averageNormal.setZero(),averageContactPointA.setZero(),averageContactPointB.setZero();const b=c.bi;c.bj;for(let it=0;it!==o;it++)c=this.result[this.result.length-1-it],c.bi!==b?(averageNormal.vadd(c.ni,averageNormal),averageContactPointA.vadd(c.ri,averageContactPointA),averageContactPointB.vadd(c.rj,averageContactPointB)):(averageNormal.vsub(c.ni,averageNormal),averageContactPointA.vadd(c.rj,averageContactPointA),averageContactPointB.vadd(c.ri,averageContactPointB));const _e=1/o;averageContactPointA.scale(_e,d.ri),averageContactPointB.scale(_e,d.rj),_.ri.copy(d.ri),_.rj.copy(d.rj),averageNormal.normalize(),averageNormal.tangents(d.t,_.t)}getContacts(o,c,d,_,b,_e,it){this.contactPointPool=b,this.frictionEquationPool=it,this.result=_,this.frictionResult=_e;const nt=tmpQuat1,at=tmpQuat2,ut=tmpVec1,pt=tmpVec2;for(let mt=0,ft=o.length;mt!==ft;mt++){const vt=o[mt],xt=c[mt];let At=null;vt.material&&xt.material&&(At=d.getContactMaterial(vt.material,xt.material)||null);const Ct=vt.type&Body.KINEMATIC&&xt.type&Body.STATIC||vt.type&Body.STATIC&&xt.type&Body.KINEMATIC||vt.type&Body.KINEMATIC&&xt.type&Body.KINEMATIC;for(let Et=0;Et<vt.shapes.length;Et++){vt.quaternion.mult(vt.shapeOrientations[Et],nt),vt.quaternion.vmult(vt.shapeOffsets[Et],ut),ut.vadd(vt.position,ut);const Tt=vt.shapes[Et];for(let kt=0;kt<xt.shapes.length;kt++){xt.quaternion.mult(xt.shapeOrientations[kt],at),xt.quaternion.vmult(xt.shapeOffsets[kt],pt),pt.vadd(xt.position,pt);const Dt=xt.shapes[kt];if(!(Tt.collisionFilterMask&Dt.collisionFilterGroup&&Dt.collisionFilterMask&Tt.collisionFilterGroup)||ut.distanceTo(pt)>Tt.boundingSphereRadius+Dt.boundingSphereRadius)continue;let zt=null;Tt.material&&Dt.material&&(zt=d.getContactMaterial(Tt.material,Dt.material)||null),this.currentContactMaterial=zt||At||d.defaultContactMaterial;const Bt=this[Tt.type|Dt.type];if(Bt){let Rt=!1;Rt=Tt.type<Dt.type?Bt.call(this,Tt,Dt,ut,pt,nt,at,vt,xt,Tt,Dt,Ct):Bt.call(this,Dt,Tt,pt,ut,at,nt,xt,vt,Tt,Dt,Ct),Rt&&Ct&&(d.shapeOverlapKeeper.set(Tt.id,Dt.id),d.bodyOverlapKeeper.set(vt.id,xt.id))}}}}}sphereSphere(o,c,d,_,b,_e,it,nt,at,ut,pt){if(pt)return d.distanceSquared(_)<(o.radius+c.radius)**2;const mt=this.createContactEquation(it,nt,o,c,at,ut);_.vsub(d,mt.ni),mt.ni.normalize(),mt.ri.copy(mt.ni),mt.rj.copy(mt.ni),mt.ri.scale(o.radius,mt.ri),mt.rj.scale(-c.radius,mt.rj),mt.ri.vadd(d,mt.ri),mt.ri.vsub(it.position,mt.ri),mt.rj.vadd(_,mt.rj),mt.rj.vsub(nt.position,mt.rj),this.result.push(mt),this.createFrictionEquationsFromContact(mt,this.frictionResult)}spherePlane(o,c,d,_,b,_e,it,nt,at,ut,pt){const mt=this.createContactEquation(it,nt,o,c,at,ut);if(mt.ni.set(0,0,1),_e.vmult(mt.ni,mt.ni),mt.ni.negate(mt.ni),mt.ni.normalize(),mt.ni.scale(o.radius,mt.ri),d.vsub(_,point_on_plane_to_sphere),mt.ni.scale(mt.ni.dot(point_on_plane_to_sphere),plane_to_sphere_ortho),point_on_plane_to_sphere.vsub(plane_to_sphere_ortho,mt.rj),-point_on_plane_to_sphere.dot(mt.ni)<=o.radius){if(pt)return!0;const ft=mt.ri,vt=mt.rj;ft.vadd(d,ft),ft.vsub(it.position,ft),vt.vadd(_,vt),vt.vsub(nt.position,vt),this.result.push(mt),this.createFrictionEquationsFromContact(mt,this.frictionResult)}}boxBox(o,c,d,_,b,_e,it,nt,at,ut,pt){return o.convexPolyhedronRepresentation.material=o.material,c.convexPolyhedronRepresentation.material=c.material,o.convexPolyhedronRepresentation.collisionResponse=o.collisionResponse,c.convexPolyhedronRepresentation.collisionResponse=c.collisionResponse,this.convexConvex(o.convexPolyhedronRepresentation,c.convexPolyhedronRepresentation,d,_,b,_e,it,nt,o,c,pt)}sphereBox(o,c,d,_,b,_e,it,nt,at,ut,pt){const mt=this.v3pool,ft=sphereBox_sides;d.vsub(_,box_to_sphere),c.getSideNormals(ft,_e);const vt=o.radius;let xt=!1;const At=sphereBox_side_ns,Ct=sphereBox_side_ns1,Et=sphereBox_side_ns2;let Tt=null,kt=0,Dt=0,zt=0,Bt=null;for(let lr=0,hr=ft.length;lr!==hr&&xt===!1;lr++){const dr=sphereBox_ns;dr.copy(ft[lr]);const pr=dr.length();dr.normalize();const ur=box_to_sphere.dot(dr);if(ur<pr+vt&&ur>0){const xr=sphereBox_ns1,vr=sphereBox_ns2;xr.copy(ft[(lr+1)%3]),vr.copy(ft[(lr+2)%3]);const Dr=xr.length(),_r=vr.length();xr.normalize(),vr.normalize();const rr=box_to_sphere.dot(xr),mr=box_to_sphere.dot(vr);if(rr<Dr&&rr>-Dr&&mr<_r&&mr>-_r){const Rr=Math.abs(ur-pr-vt);if((Bt===null||Rr<Bt)&&(Bt=Rr,Dt=rr,zt=mr,Tt=pr,At.copy(dr),Ct.copy(xr),Et.copy(vr),kt++,pt))return!0}}}if(kt){xt=!0;const lr=this.createContactEquation(it,nt,o,c,at,ut);At.scale(-vt,lr.ri),lr.ni.copy(At),lr.ni.negate(lr.ni),At.scale(Tt,At),Ct.scale(Dt,Ct),At.vadd(Ct,At),Et.scale(zt,Et),At.vadd(Et,lr.rj),lr.ri.vadd(d,lr.ri),lr.ri.vsub(it.position,lr.ri),lr.rj.vadd(_,lr.rj),lr.rj.vsub(nt.position,lr.rj),this.result.push(lr),this.createFrictionEquationsFromContact(lr,this.frictionResult)}let Rt=mt.get();const Ut=sphereBox_sphere_to_corner;for(let lr=0;lr!==2&&!xt;lr++)for(let hr=0;hr!==2&&!xt;hr++)for(let dr=0;dr!==2&&!xt;dr++)if(Rt.set(0,0,0),lr?Rt.vadd(ft[0],Rt):Rt.vsub(ft[0],Rt),hr?Rt.vadd(ft[1],Rt):Rt.vsub(ft[1],Rt),dr?Rt.vadd(ft[2],Rt):Rt.vsub(ft[2],Rt),_.vadd(Rt,Ut),Ut.vsub(d,Ut),Ut.lengthSquared()<vt*vt){if(pt)return!0;xt=!0;const pr=this.createContactEquation(it,nt,o,c,at,ut);pr.ri.copy(Ut),pr.ri.normalize(),pr.ni.copy(pr.ri),pr.ri.scale(vt,pr.ri),pr.rj.copy(Rt),pr.ri.vadd(d,pr.ri),pr.ri.vsub(it.position,pr.ri),pr.rj.vadd(_,pr.rj),pr.rj.vsub(nt.position,pr.rj),this.result.push(pr),this.createFrictionEquationsFromContact(pr,this.frictionResult)}mt.release(Rt),Rt=null;const Ht=mt.get(),Jt=mt.get(),Kt=mt.get(),sr=mt.get(),ir=mt.get(),cr=ft.length;for(let lr=0;lr!==cr&&!xt;lr++)for(let hr=0;hr!==cr&&!xt;hr++)if(lr%3!=hr%3){ft[hr].cross(ft[lr],Ht),Ht.normalize(),ft[lr].vadd(ft[hr],Jt),Kt.copy(d),Kt.vsub(Jt,Kt),Kt.vsub(_,Kt);const dr=Kt.dot(Ht);Ht.scale(dr,sr);let pr=0;for(;pr===lr%3||pr===hr%3;)pr++;ir.copy(d),ir.vsub(sr,ir),ir.vsub(Jt,ir),ir.vsub(_,ir);const ur=Math.abs(dr),xr=ir.length();if(ur<ft[pr].length()&&xr<vt){if(pt)return!0;xt=!0;const vr=this.createContactEquation(it,nt,o,c,at,ut);Jt.vadd(sr,vr.rj),vr.rj.copy(vr.rj),ir.negate(vr.ni),vr.ni.normalize(),vr.ri.copy(vr.rj),vr.ri.vadd(_,vr.ri),vr.ri.vsub(d,vr.ri),vr.ri.normalize(),vr.ri.scale(vt,vr.ri),vr.ri.vadd(d,vr.ri),vr.ri.vsub(it.position,vr.ri),vr.rj.vadd(_,vr.rj),vr.rj.vsub(nt.position,vr.rj),this.result.push(vr),this.createFrictionEquationsFromContact(vr,this.frictionResult)}}mt.release(Ht,Jt,Kt,sr,ir)}planeBox(o,c,d,_,b,_e,it,nt,at,ut,pt){return c.convexPolyhedronRepresentation.material=c.material,c.convexPolyhedronRepresentation.collisionResponse=c.collisionResponse,c.convexPolyhedronRepresentation.id=c.id,this.planeConvex(o,c.convexPolyhedronRepresentation,d,_,b,_e,it,nt,o,c,pt)}convexConvex(o,c,d,_,b,_e,it,nt,at,ut,pt,mt,ft){const vt=convexConvex_sepAxis;if(!(d.distanceTo(_)>o.boundingSphereRadius+c.boundingSphereRadius)&&o.findSeparatingAxis(c,d,b,_,_e,vt,mt,ft)){const xt=[],At=convexConvex_q;o.clipAgainstHull(d,b,c,_,_e,vt,-100,100,xt);let Ct=0;for(let Et=0;Et!==xt.length;Et++){if(pt)return!0;const Tt=this.createContactEquation(it,nt,o,c,at,ut),kt=Tt.ri,Dt=Tt.rj;vt.negate(Tt.ni),xt[Et].normal.negate(At),At.scale(xt[Et].depth,At),xt[Et].point.vadd(At,kt),Dt.copy(xt[Et].point),kt.vsub(d,kt),Dt.vsub(_,Dt),kt.vadd(d,kt),kt.vsub(it.position,kt),Dt.vadd(_,Dt),Dt.vsub(nt.position,Dt),this.result.push(Tt),Ct++,this.enableFrictionReduction||this.createFrictionEquationsFromContact(Tt,this.frictionResult)}this.enableFrictionReduction&&Ct&&this.createFrictionFromAverage(Ct)}}sphereConvex(o,c,d,_,b,_e,it,nt,at,ut,pt){const mt=this.v3pool;d.vsub(_,convex_to_sphere);const ft=c.faceNormals,vt=c.faces,xt=c.vertices,At=o.radius;let Ct=!1;for(let Et=0;Et!==xt.length;Et++){const Tt=xt[Et],kt=sphereConvex_worldCorner;_e.vmult(Tt,kt),_.vadd(kt,kt);const Dt=sphereConvex_sphereToCorner;if(kt.vsub(d,Dt),Dt.lengthSquared()<At*At){if(pt)return!0;Ct=!0;const zt=this.createContactEquation(it,nt,o,c,at,ut);return zt.ri.copy(Dt),zt.ri.normalize(),zt.ni.copy(zt.ri),zt.ri.scale(At,zt.ri),kt.vsub(_,zt.rj),zt.ri.vadd(d,zt.ri),zt.ri.vsub(it.position,zt.ri),zt.rj.vadd(_,zt.rj),zt.rj.vsub(nt.position,zt.rj),this.result.push(zt),void this.createFrictionEquationsFromContact(zt,this.frictionResult)}}for(let Et=0,Tt=vt.length;Et!==Tt&&Ct===!1;Et++){const kt=ft[Et],Dt=vt[Et],zt=sphereConvex_worldNormal;_e.vmult(kt,zt);const Bt=sphereConvex_worldPoint;_e.vmult(xt[Dt[0]],Bt),Bt.vadd(_,Bt);const Rt=sphereConvex_worldSpherePointClosestToPlane;zt.scale(-At,Rt),d.vadd(Rt,Rt);const Ut=sphereConvex_penetrationVec;Rt.vsub(Bt,Ut);const Ht=Ut.dot(zt),Jt=sphereConvex_sphereToWorldPoint;if(d.vsub(Bt,Jt),Ht<0&&Jt.dot(zt)>0){const Kt=[];for(let sr=0,ir=Dt.length;sr!==ir;sr++){const cr=mt.get();_e.vmult(xt[Dt[sr]],cr),_.vadd(cr,cr),Kt.push(cr)}if(pointInPolygon(Kt,zt,d)){if(pt)return!0;Ct=!0;const sr=this.createContactEquation(it,nt,o,c,at,ut);zt.scale(-At,sr.ri),zt.negate(sr.ni);const ir=mt.get();zt.scale(-Ht,ir);const cr=mt.get();zt.scale(-At,cr),d.vsub(_,sr.rj),sr.rj.vadd(cr,sr.rj),sr.rj.vadd(ir,sr.rj),sr.rj.vadd(_,sr.rj),sr.rj.vsub(nt.position,sr.rj),sr.ri.vadd(d,sr.ri),sr.ri.vsub(it.position,sr.ri),mt.release(ir),mt.release(cr),this.result.push(sr),this.createFrictionEquationsFromContact(sr,this.frictionResult);for(let lr=0,hr=Kt.length;lr!==hr;lr++)mt.release(Kt[lr]);return}for(let sr=0;sr!==Dt.length;sr++){const ir=mt.get(),cr=mt.get();_e.vmult(xt[Dt[(sr+1)%Dt.length]],ir),_e.vmult(xt[Dt[(sr+2)%Dt.length]],cr),_.vadd(ir,ir),_.vadd(cr,cr);const lr=sphereConvex_edge;cr.vsub(ir,lr);const hr=sphereConvex_edgeUnit;lr.unit(hr);const dr=mt.get(),pr=mt.get();d.vsub(ir,pr);const ur=pr.dot(hr);hr.scale(ur,dr),dr.vadd(ir,dr);const xr=mt.get();if(dr.vsub(d,xr),ur>0&&ur*ur<lr.lengthSquared()&&xr.lengthSquared()<At*At){if(pt)return!0;const vr=this.createContactEquation(it,nt,o,c,at,ut);dr.vsub(_,vr.rj),dr.vsub(d,vr.ni),vr.ni.normalize(),vr.ni.scale(At,vr.ri),vr.rj.vadd(_,vr.rj),vr.rj.vsub(nt.position,vr.rj),vr.ri.vadd(d,vr.ri),vr.ri.vsub(it.position,vr.ri),this.result.push(vr),this.createFrictionEquationsFromContact(vr,this.frictionResult);for(let Dr=0,_r=Kt.length;Dr!==_r;Dr++)mt.release(Kt[Dr]);return mt.release(ir),mt.release(cr),mt.release(dr),mt.release(xr),void mt.release(pr)}mt.release(ir),mt.release(cr),mt.release(dr),mt.release(xr),mt.release(pr)}for(let sr=0,ir=Kt.length;sr!==ir;sr++)mt.release(Kt[sr])}}}planeConvex(o,c,d,_,b,_e,it,nt,at,ut,pt){const mt=planeConvex_v,ft=planeConvex_normal;ft.set(0,0,1),b.vmult(ft,ft);let vt=0;const xt=planeConvex_relpos;for(let At=0;At!==c.vertices.length;At++)if(mt.copy(c.vertices[At]),_e.vmult(mt,mt),_.vadd(mt,mt),mt.vsub(d,xt),ft.dot(xt)<=0){if(pt)return!0;const Ct=this.createContactEquation(it,nt,o,c,at,ut),Et=planeConvex_projected;ft.scale(ft.dot(xt),Et),mt.vsub(Et,Et),Et.vsub(d,Ct.ri),Ct.ni.copy(ft),mt.vsub(_,Ct.rj),Ct.ri.vadd(d,Ct.ri),Ct.ri.vsub(it.position,Ct.ri),Ct.rj.vadd(_,Ct.rj),Ct.rj.vsub(nt.position,Ct.rj),this.result.push(Ct),vt++,this.enableFrictionReduction||this.createFrictionEquationsFromContact(Ct,this.frictionResult)}this.enableFrictionReduction&&vt&&this.createFrictionFromAverage(vt)}boxConvex(o,c,d,_,b,_e,it,nt,at,ut,pt){return o.convexPolyhedronRepresentation.material=o.material,o.convexPolyhedronRepresentation.collisionResponse=o.collisionResponse,this.convexConvex(o.convexPolyhedronRepresentation,c,d,_,b,_e,it,nt,o,c,pt)}sphereHeightfield(o,c,d,_,b,_e,it,nt,at,ut,pt){const mt=c.data,ft=o.radius,vt=c.elementSize,xt=sphereHeightfield_tmp2,At=sphereHeightfield_tmp1;cannon_es_Transform.pointToLocalFrame(_,_e,d,At);let Ct=Math.floor((At.x-ft)/vt)-1,Et=Math.ceil((At.x+ft)/vt)+1,Tt=Math.floor((At.y-ft)/vt)-1,kt=Math.ceil((At.y+ft)/vt)+1;if(Et<0||kt<0||Ct>mt.length||Tt>mt[0].length)return;Ct<0&&(Ct=0),Et<0&&(Et=0),Tt<0&&(Tt=0),kt<0&&(kt=0),Ct>=mt.length&&(Ct=mt.length-1),Et>=mt.length&&(Et=mt.length-1),kt>=mt[0].length&&(kt=mt[0].length-1),Tt>=mt[0].length&&(Tt=mt[0].length-1);const Dt=[];c.getRectMinMax(Ct,Tt,Et,kt,Dt);const zt=Dt[0],Bt=Dt[1];if(At.z-ft>Bt||At.z+ft<zt)return;const Rt=this.result;for(let Ut=Ct;Ut<Et;Ut++)for(let Ht=Tt;Ht<kt;Ht++){const Jt=Rt.length;let Kt=!1;if(c.getConvexTrianglePillar(Ut,Ht,!1),cannon_es_Transform.pointToWorldFrame(_,_e,c.pillarOffset,xt),d.distanceTo(xt)<c.pillarConvex.boundingSphereRadius+o.boundingSphereRadius&&(Kt=this.sphereConvex(o,c.pillarConvex,d,xt,b,_e,it,nt,o,c,pt)),pt&&Kt||(c.getConvexTrianglePillar(Ut,Ht,!0),cannon_es_Transform.pointToWorldFrame(_,_e,c.pillarOffset,xt),d.distanceTo(xt)<c.pillarConvex.boundingSphereRadius+o.boundingSphereRadius&&(Kt=this.sphereConvex(o,c.pillarConvex,d,xt,b,_e,it,nt,o,c,pt)),pt&&Kt))return!0;if(Rt.length-Jt>2)return}}boxHeightfield(o,c,d,_,b,_e,it,nt,at,ut,pt){return o.convexPolyhedronRepresentation.material=o.material,o.convexPolyhedronRepresentation.collisionResponse=o.collisionResponse,this.convexHeightfield(o.convexPolyhedronRepresentation,c,d,_,b,_e,it,nt,o,c,pt)}convexHeightfield(o,c,d,_,b,_e,it,nt,at,ut,pt){const mt=c.data,ft=c.elementSize,vt=o.boundingSphereRadius,xt=convexHeightfield_tmp2,At=convexHeightfield_faceList,Ct=convexHeightfield_tmp1;cannon_es_Transform.pointToLocalFrame(_,_e,d,Ct);let Et=Math.floor((Ct.x-vt)/ft)-1,Tt=Math.ceil((Ct.x+vt)/ft)+1,kt=Math.floor((Ct.y-vt)/ft)-1,Dt=Math.ceil((Ct.y+vt)/ft)+1;if(Tt<0||Dt<0||Et>mt.length||kt>mt[0].length)return;Et<0&&(Et=0),Tt<0&&(Tt=0),kt<0&&(kt=0),Dt<0&&(Dt=0),Et>=mt.length&&(Et=mt.length-1),Tt>=mt.length&&(Tt=mt.length-1),Dt>=mt[0].length&&(Dt=mt[0].length-1),kt>=mt[0].length&&(kt=mt[0].length-1);const zt=[];c.getRectMinMax(Et,kt,Tt,Dt,zt);const Bt=zt[0],Rt=zt[1];if(!(Ct.z-vt>Rt||Ct.z+vt<Bt))for(let Ut=Et;Ut<Tt;Ut++)for(let Ht=kt;Ht<Dt;Ht++){let Jt=!1;if(c.getConvexTrianglePillar(Ut,Ht,!1),cannon_es_Transform.pointToWorldFrame(_,_e,c.pillarOffset,xt),d.distanceTo(xt)<c.pillarConvex.boundingSphereRadius+o.boundingSphereRadius&&(Jt=this.convexConvex(o,c.pillarConvex,d,xt,b,_e,it,nt,null,null,pt,At,null)),pt&&Jt||(c.getConvexTrianglePillar(Ut,Ht,!0),cannon_es_Transform.pointToWorldFrame(_,_e,c.pillarOffset,xt),d.distanceTo(xt)<c.pillarConvex.boundingSphereRadius+o.boundingSphereRadius&&(Jt=this.convexConvex(o,c.pillarConvex,d,xt,b,_e,it,nt,null,null,pt,At,null)),pt&&Jt))return!0}}sphereParticle(o,c,d,_,b,_e,it,nt,at,ut,pt){const mt=particleSphere_normal;if(mt.set(0,0,1),_.vsub(d,mt),mt.lengthSquared()<=o.radius*o.radius){if(pt)return!0;const ft=this.createContactEquation(nt,it,c,o,at,ut);mt.normalize(),ft.rj.copy(mt),ft.rj.scale(o.radius,ft.rj),ft.ni.copy(mt),ft.ni.negate(ft.ni),ft.ri.set(0,0,0),this.result.push(ft),this.createFrictionEquationsFromContact(ft,this.frictionResult)}}planeParticle(o,c,d,_,b,_e,it,nt,at,ut,pt){const mt=particlePlane_normal;mt.set(0,0,1),it.quaternion.vmult(mt,mt);const ft=particlePlane_relpos;if(_.vsub(it.position,ft),mt.dot(ft)<=0){if(pt)return!0;const vt=this.createContactEquation(nt,it,c,o,at,ut);vt.ni.copy(mt),vt.ni.negate(vt.ni),vt.ri.set(0,0,0);const xt=particlePlane_projected;mt.scale(mt.dot(_),xt),_.vsub(xt,xt),vt.rj.copy(xt),this.result.push(vt),this.createFrictionEquationsFromContact(vt,this.frictionResult)}}boxParticle(o,c,d,_,b,_e,it,nt,at,ut,pt){return o.convexPolyhedronRepresentation.material=o.material,o.convexPolyhedronRepresentation.collisionResponse=o.collisionResponse,this.convexParticle(o.convexPolyhedronRepresentation,c,d,_,b,_e,it,nt,o,c,pt)}convexParticle(o,c,d,_,b,_e,it,nt,at,ut,pt){let mt=-1;const ft=convexParticle_penetratedFaceNormal,vt=convexParticle_worldPenetrationVec;let xt=null;const At=convexParticle_local;if(At.copy(_),At.vsub(d,At),b.conjugate(cqj),cqj.vmult(At,At),o.pointIsInside(At)){o.worldVerticesNeedsUpdate&&o.computeWorldVertices(d,b),o.worldFaceNormalsNeedsUpdate&&o.computeWorldFaceNormals(b);for(let Ct=0,Et=o.faces.length;Ct!==Et;Ct++){const Tt=[o.worldVertices[o.faces[Ct][0]]],kt=o.worldFaceNormals[Ct];_.vsub(Tt[0],convexParticle_vertexToParticle);const Dt=-kt.dot(convexParticle_vertexToParticle);if(xt===null||Math.abs(Dt)<Math.abs(xt)){if(pt)return!0;xt=Dt,mt=Ct,ft.copy(kt)}}if(mt!==-1){const Ct=this.createContactEquation(nt,it,c,o,at,ut);ft.scale(xt,vt),vt.vadd(_,vt),vt.vsub(d,vt),Ct.rj.copy(vt),ft.negate(Ct.ni),Ct.ri.set(0,0,0);const Et=Ct.ri,Tt=Ct.rj;Et.vadd(_,Et),Et.vsub(nt.position,Et),Tt.vadd(d,Tt),Tt.vsub(it.position,Tt),this.result.push(Ct),this.createFrictionEquationsFromContact(Ct,this.frictionResult)}else console.warn("Point found inside convex, but did not find penetrating face!")}}heightfieldCylinder(o,c,d,_,b,_e,it,nt,at,ut,pt){return this.convexHeightfield(c,o,_,d,_e,b,nt,it,at,ut,pt)}particleCylinder(o,c,d,_,b,_e,it,nt,at,ut,pt){return this.convexParticle(c,o,_,d,_e,b,nt,it,at,ut,pt)}sphereTrimesh(o,c,d,_,b,_e,it,nt,at,ut,pt){const mt=sphereTrimesh_edgeVertexA,ft=sphereTrimesh_edgeVertexB,vt=sphereTrimesh_edgeVector,xt=sphereTrimesh_edgeVectorUnit,At=sphereTrimesh_localSpherePos,Ct=sphereTrimesh_tmp,Et=sphereTrimesh_localSphereAABB,Tt=sphereTrimesh_v2,kt=sphereTrimesh_relpos,Dt=sphereTrimesh_triangles;cannon_es_Transform.pointToLocalFrame(_,_e,d,At);const zt=o.radius;Et.lowerBound.set(At.x-zt,At.y-zt,At.z-zt),Et.upperBound.set(At.x+zt,At.y+zt,At.z+zt),c.getTrianglesInAABB(Et,Dt);const Bt=sphereTrimesh_v,Rt=o.radius*o.radius;for(let sr=0;sr<Dt.length;sr++)for(let ir=0;ir<3;ir++)if(c.getVertex(c.indices[3*Dt[sr]+ir],Bt),Bt.vsub(At,kt),kt.lengthSquared()<=Rt){if(Tt.copy(Bt),cannon_es_Transform.pointToWorldFrame(_,_e,Tt,Bt),Bt.vsub(d,kt),pt)return!0;let cr=this.createContactEquation(it,nt,o,c,at,ut);cr.ni.copy(kt),cr.ni.normalize(),cr.ri.copy(cr.ni),cr.ri.scale(o.radius,cr.ri),cr.ri.vadd(d,cr.ri),cr.ri.vsub(it.position,cr.ri),cr.rj.copy(Bt),cr.rj.vsub(nt.position,cr.rj),this.result.push(cr),this.createFrictionEquationsFromContact(cr,this.frictionResult)}for(let sr=0;sr<Dt.length;sr++)for(let ir=0;ir<3;ir++){c.getVertex(c.indices[3*Dt[sr]+ir],mt),c.getVertex(c.indices[3*Dt[sr]+(ir+1)%3],ft),ft.vsub(mt,vt),At.vsub(ft,Ct);const cr=Ct.dot(vt);At.vsub(mt,Ct);let lr=Ct.dot(vt);if(lr>0&&cr<0&&(At.vsub(mt,Ct),xt.copy(vt),xt.normalize(),lr=Ct.dot(xt),xt.scale(lr,Ct),Ct.vadd(mt,Ct),Ct.distanceTo(At)<o.radius)){if(pt)return!0;const hr=this.createContactEquation(it,nt,o,c,at,ut);Ct.vsub(At,hr.ni),hr.ni.normalize(),hr.ni.scale(o.radius,hr.ri),hr.ri.vadd(d,hr.ri),hr.ri.vsub(it.position,hr.ri),cannon_es_Transform.pointToWorldFrame(_,_e,Ct,Ct),Ct.vsub(nt.position,hr.rj),cannon_es_Transform.vectorToWorldFrame(_e,hr.ni,hr.ni),cannon_es_Transform.vectorToWorldFrame(_e,hr.ri,hr.ri),this.result.push(hr),this.createFrictionEquationsFromContact(hr,this.frictionResult)}}const Ut=sphereTrimesh_va,Ht=sphereTrimesh_vb,Jt=sphereTrimesh_vc,Kt=sphereTrimesh_normal;for(let sr=0,ir=Dt.length;sr!==ir;sr++){c.getTriangleVertices(Dt[sr],Ut,Ht,Jt),c.getNormal(Dt[sr],Kt),At.vsub(Ut,Ct);let cr=Ct.dot(Kt);if(Kt.scale(cr,Ct),At.vsub(Ct,Ct),cr=Ct.distanceTo(At),Ray.pointInTriangle(Ct,Ut,Ht,Jt)&&cr<o.radius){if(pt)return!0;let lr=this.createContactEquation(it,nt,o,c,at,ut);Ct.vsub(At,lr.ni),lr.ni.normalize(),lr.ni.scale(o.radius,lr.ri),lr.ri.vadd(d,lr.ri),lr.ri.vsub(it.position,lr.ri),cannon_es_Transform.pointToWorldFrame(_,_e,Ct,Ct),Ct.vsub(nt.position,lr.rj),cannon_es_Transform.vectorToWorldFrame(_e,lr.ni,lr.ni),cannon_es_Transform.vectorToWorldFrame(_e,lr.ri,lr.ri),this.result.push(lr),this.createFrictionEquationsFromContact(lr,this.frictionResult)}}Dt.length=0}planeTrimesh(o,c,d,_,b,_e,it,nt,at,ut,pt){const mt=new Vec3,ft=planeTrimesh_normal;ft.set(0,0,1),b.vmult(ft,ft);for(let vt=0;vt<c.vertices.length/3;vt++){c.getVertex(vt,mt);const xt=new Vec3;xt.copy(mt),cannon_es_Transform.pointToWorldFrame(_,_e,xt,mt);const At=planeTrimesh_relpos;if(mt.vsub(d,At),ft.dot(At)<=0){if(pt)return!0;const Ct=this.createContactEquation(it,nt,o,c,at,ut);Ct.ni.copy(ft);const Et=planeTrimesh_projected;ft.scale(At.dot(ft),Et),mt.vsub(Et,Et),Ct.ri.copy(Et),Ct.ri.vsub(it.position,Ct.ri),Ct.rj.copy(mt),Ct.rj.vsub(nt.position,Ct.rj),this.result.push(Ct),this.createFrictionEquationsFromContact(Ct,this.frictionResult)}}}}const averageNormal=new Vec3,averageContactPointA=new Vec3,averageContactPointB=new Vec3,tmpVec1=new Vec3,tmpVec2=new Vec3,tmpQuat1=new Quaternion,tmpQuat2=new Quaternion,planeTrimesh_normal=new Vec3,planeTrimesh_relpos=new Vec3,planeTrimesh_projected=new Vec3,sphereTrimesh_normal=new Vec3,sphereTrimesh_relpos=new Vec3;new Vec3;const sphereTrimesh_v=new Vec3,sphereTrimesh_v2=new Vec3,sphereTrimesh_edgeVertexA=new Vec3,sphereTrimesh_edgeVertexB=new Vec3,sphereTrimesh_edgeVector=new Vec3,sphereTrimesh_edgeVectorUnit=new Vec3,sphereTrimesh_localSpherePos=new Vec3,sphereTrimesh_tmp=new Vec3,sphereTrimesh_va=new Vec3,sphereTrimesh_vb=new Vec3,sphereTrimesh_vc=new Vec3,sphereTrimesh_localSphereAABB=new AABB,sphereTrimesh_triangles=[],point_on_plane_to_sphere=new Vec3,plane_to_sphere_ortho=new Vec3,pointInPolygon_edge=new Vec3,pointInPolygon_edge_x_normal=new Vec3,pointInPolygon_vtp=new Vec3;function pointInPolygon(h,o,c){let d=null;const _=h.length;for(let b=0;b!==_;b++){const _e=h[b],it=pointInPolygon_edge;h[(b+1)%_].vsub(_e,it);const nt=pointInPolygon_edge_x_normal;it.cross(o,nt);const at=pointInPolygon_vtp;c.vsub(_e,at);const ut=nt.dot(at);if(!(d===null||ut>0&&d===!0||ut<=0&&d===!1))return!1;d===null&&(d=ut>0)}return!0}const box_to_sphere=new Vec3,sphereBox_ns=new Vec3,sphereBox_ns1=new Vec3,sphereBox_ns2=new Vec3,sphereBox_sides=[new Vec3,new Vec3,new Vec3,new Vec3,new Vec3,new Vec3],sphereBox_sphere_to_corner=new Vec3,sphereBox_side_ns=new Vec3,sphereBox_side_ns1=new Vec3,sphereBox_side_ns2=new Vec3,convex_to_sphere=new Vec3,sphereConvex_edge=new Vec3,sphereConvex_edgeUnit=new Vec3,sphereConvex_sphereToCorner=new Vec3,sphereConvex_worldCorner=new Vec3,sphereConvex_worldNormal=new Vec3,sphereConvex_worldPoint=new Vec3,sphereConvex_worldSpherePointClosestToPlane=new Vec3,sphereConvex_penetrationVec=new Vec3,sphereConvex_sphereToWorldPoint=new Vec3;new Vec3,new Vec3;const planeConvex_v=new Vec3,planeConvex_normal=new Vec3,planeConvex_relpos=new Vec3,planeConvex_projected=new Vec3,convexConvex_sepAxis=new Vec3,convexConvex_q=new Vec3,particlePlane_normal=new Vec3,particlePlane_relpos=new Vec3,particlePlane_projected=new Vec3,particleSphere_normal=new Vec3,cqj=new Quaternion,convexParticle_local=new Vec3;new Vec3;const convexParticle_penetratedFaceNormal=new Vec3,convexParticle_vertexToParticle=new Vec3,convexParticle_worldPenetrationVec=new Vec3,convexHeightfield_tmp1=new Vec3,convexHeightfield_tmp2=new Vec3,convexHeightfield_faceList=[0],sphereHeightfield_tmp1=new Vec3,sphereHeightfield_tmp2=new Vec3;class OverlapKeeper{constructor(){this.current=[],this.previous=[]}getKey(o,c){if(c<o){const d=c;c=o,o=d}return o<<16|c}set(o,c){const d=this.getKey(o,c),_=this.current;let b=0;for(;d>_[b];)b++;if(d!==_[b]){for(let _e=_.length-1;_e>=b;_e--)_[_e+1]=_[_e];_[b]=d}}tick(){const o=this.current;this.current=this.previous,this.previous=o,this.current.length=0}getDiff(o,c){const d=this.current,_=this.previous,b=d.length,_e=_.length;let it=0;for(let nt=0;nt<b;nt++){let at=!1;const ut=d[nt];for(;ut>_[it];)it++;at=ut===_[it],at||unpackAndPush(o,ut)}it=0;for(let nt=0;nt<_e;nt++){let at=!1;const ut=_[nt];for(;ut>d[it];)it++;at=d[it]===ut,at||unpackAndPush(c,ut)}}}function unpackAndPush(h,o){h.push((4294901760&o)>>16,65535&o)}const getKey=(h,o)=>h<o?`${h}-${o}`:`${o}-${h}`;class TupleDictionary{constructor(){this.data={keys:[]}}get(o,c){const d=getKey(o,c);return this.data[d]}set(o,c,d){const _=getKey(o,c);this.get(o,c)||this.data.keys.push(_),this.data[_]=d}delete(o,c){const d=getKey(o,c),_=this.data.keys.indexOf(d);_!==-1&&this.data.keys.splice(_,1),delete this.data[d]}reset(){const o=this.data,c=o.keys;for(;c.length>0;)delete o[c.pop()]}}class World extends EventTarget{constructor(o){o===void 0&&(o={}),super(),this.dt=-1,this.allowSleep=!!o.allowSleep,this.contacts=[],this.frictionEquations=[],this.quatNormalizeSkip=o.quatNormalizeSkip!==void 0?o.quatNormalizeSkip:0,this.quatNormalizeFast=o.quatNormalizeFast!==void 0&&o.quatNormalizeFast,this.time=0,this.stepnumber=0,this.default_dt=1/60,this.nextId=0,this.gravity=new Vec3,o.gravity&&this.gravity.copy(o.gravity),this.broadphase=o.broadphase!==void 0?o.broadphase:new NaiveBroadphase,this.bodies=[],this.hasActiveBodies=!1,this.solver=o.solver!==void 0?o.solver:new GSSolver,this.constraints=[],this.narrowphase=new Narrowphase(this),this.collisionMatrix=new ArrayCollisionMatrix,this.collisionMatrixPrevious=new ArrayCollisionMatrix,this.bodyOverlapKeeper=new OverlapKeeper,this.shapeOverlapKeeper=new OverlapKeeper,this.contactmaterials=[],this.contactMaterialTable=new TupleDictionary,this.defaultMaterial=new cannon_es_Material("default"),this.defaultContactMaterial=new ContactMaterial(this.defaultMaterial,this.defaultMaterial,{friction:.3,restitution:0}),this.doProfiling=!1,this.profile={solve:0,makeContactConstraints:0,broadphase:0,integrate:0,narrowphase:0},this.accumulator=0,this.subsystems=[],this.addBodyEvent={type:"addBody",body:null},this.removeBodyEvent={type:"removeBody",body:null},this.idToBodyMap={},this.broadphase.setWorld(this)}getContactMaterial(o,c){return this.contactMaterialTable.get(o.id,c.id)}collisionMatrixTick(){const o=this.collisionMatrixPrevious;this.collisionMatrixPrevious=this.collisionMatrix,this.collisionMatrix=o,this.collisionMatrix.reset(),this.bodyOverlapKeeper.tick(),this.shapeOverlapKeeper.tick()}addConstraint(o){this.constraints.push(o)}removeConstraint(o){const c=this.constraints.indexOf(o);c!==-1&&this.constraints.splice(c,1)}rayTest(o,c,d){d instanceof RaycastResult?this.raycastClosest(o,c,{skipBackfaces:!0},d):this.raycastAll(o,c,{skipBackfaces:!0},d)}raycastAll(o,c,d,_){return d===void 0&&(d={}),d.mode=Ray.ALL,d.from=o,d.to=c,d.callback=_,tmpRay.intersectWorld(this,d)}raycastAny(o,c,d,_){return d===void 0&&(d={}),d.mode=Ray.ANY,d.from=o,d.to=c,d.result=_,tmpRay.intersectWorld(this,d)}raycastClosest(o,c,d,_){return d===void 0&&(d={}),d.mode=Ray.CLOSEST,d.from=o,d.to=c,d.result=_,tmpRay.intersectWorld(this,d)}addBody(o){this.bodies.includes(o)||(o.index=this.bodies.length,this.bodies.push(o),o.world=this,o.initPosition.copy(o.position),o.initVelocity.copy(o.velocity),o.timeLastSleepy=this.time,o instanceof Body&&(o.initAngularVelocity.copy(o.angularVelocity),o.initQuaternion.copy(o.quaternion)),this.collisionMatrix.setNumObjects(this.bodies.length),this.addBodyEvent.body=o,this.idToBodyMap[o.id]=o,this.dispatchEvent(this.addBodyEvent))}removeBody(o){o.world=null;const c=this.bodies.length-1,d=this.bodies,_=d.indexOf(o);if(_!==-1){d.splice(_,1);for(let b=0;b!==d.length;b++)d[b].index=b;this.collisionMatrix.setNumObjects(c),this.removeBodyEvent.body=o,delete this.idToBodyMap[o.id],this.dispatchEvent(this.removeBodyEvent)}}getBodyById(o){return this.idToBodyMap[o]}getShapeById(o){const c=this.bodies;for(let d=0;d<c.length;d++){const _=c[d].shapes;for(let b=0;b<_.length;b++){const _e=_[b];if(_e.id===o)return _e}}return null}addContactMaterial(o){this.contactmaterials.push(o),this.contactMaterialTable.set(o.materials[0].id,o.materials[1].id,o)}removeContactMaterial(o){const c=this.contactmaterials.indexOf(o);c!==-1&&(this.contactmaterials.splice(c,1),this.contactMaterialTable.delete(o.materials[0].id,o.materials[1].id))}fixedStep(o,c){o===void 0&&(o=1/60),c===void 0&&(c=10);const d=cannon_es_performance.now()/1e3;if(this.lastCallTime){const _=d-this.lastCallTime;this.step(o,_,c)}else this.step(o,void 0,c);this.lastCallTime=d}step(o,c,d){if(d===void 0&&(d=10),c===void 0)this.internalStep(o),this.time+=o;else{this.accumulator+=c;const _=cannon_es_performance.now();let b=0;for(;this.accumulator>=o&&b<d&&(this.internalStep(o),this.accumulator-=o,b++,!(cannon_es_performance.now()-_>1e3*o)););this.accumulator=this.accumulator%o;const _e=this.accumulator/o;for(let it=0;it!==this.bodies.length;it++){const nt=this.bodies[it];nt.previousPosition.lerp(nt.position,_e,nt.interpolatedPosition),nt.previousQuaternion.slerp(nt.quaternion,_e,nt.interpolatedQuaternion),nt.previousQuaternion.normalize()}this.time+=c}}internalStep(o){this.dt=o;const c=this.contacts,d=World_step_p1,_=World_step_p2,b=this.bodies.length,_e=this.bodies,it=this.solver,nt=this.gravity,at=this.doProfiling,ut=this.profile,pt=Body.DYNAMIC;let mt=-1/0;const ft=this.constraints,vt=World_step_frictionEquationPool;nt.length();const xt=nt.x,At=nt.y,Ct=nt.z;let Et=0;for(at&&(mt=cannon_es_performance.now()),Et=0;Et!==b;Et++){const Kt=_e[Et];if(Kt.type===pt){const sr=Kt.force,ir=Kt.mass;sr.x+=ir*xt,sr.y+=ir*At,sr.z+=ir*Ct}}for(let Kt=0,sr=this.subsystems.length;Kt!==sr;Kt++)this.subsystems[Kt].update();at&&(mt=cannon_es_performance.now()),d.length=0,_.length=0,this.broadphase.collisionPairs(this,d,_),at&&(ut.broadphase=cannon_es_performance.now()-mt);let Tt=ft.length;for(Et=0;Et!==Tt;Et++){const Kt=ft[Et];if(!Kt.collideConnected)for(let sr=d.length-1;sr>=0;sr-=1)(Kt.bodyA===d[sr]&&Kt.bodyB===_[sr]||Kt.bodyB===d[sr]&&Kt.bodyA===_[sr])&&(d.splice(sr,1),_.splice(sr,1))}this.collisionMatrixTick(),at&&(mt=cannon_es_performance.now());const kt=World_step_oldContacts,Dt=c.length;for(Et=0;Et!==Dt;Et++)kt.push(c[Et]);c.length=0;const zt=this.frictionEquations.length;for(Et=0;Et!==zt;Et++)vt.push(this.frictionEquations[Et]);for(this.frictionEquations.length=0,this.narrowphase.getContacts(d,_,this,c,kt,this.frictionEquations,vt),at&&(ut.narrowphase=cannon_es_performance.now()-mt),at&&(mt=cannon_es_performance.now()),Et=0;Et<this.frictionEquations.length;Et++)it.addEquation(this.frictionEquations[Et]);const Bt=c.length;for(let Kt=0;Kt!==Bt;Kt++){const sr=c[Kt],ir=sr.bi,cr=sr.bj,lr=sr.si,hr=sr.sj;let dr;dr=ir.material&&cr.material&&this.getContactMaterial(ir.material,cr.material)||this.defaultContactMaterial,dr.friction,ir.material&&cr.material&&(ir.material.friction>=0&&cr.material.friction>=0&&(ir.material.friction,cr.material.friction),ir.material.restitution>=0&&cr.material.restitution>=0&&(sr.restitution=ir.material.restitution*cr.material.restitution)),it.addEquation(sr),ir.allowSleep&&ir.type===Body.DYNAMIC&&ir.sleepState===Body.SLEEPING&&cr.sleepState===Body.AWAKE&&cr.type!==Body.STATIC&&cr.velocity.lengthSquared()+cr.angularVelocity.lengthSquared()>=2*cr.sleepSpeedLimit**2&&(ir.wakeUpAfterNarrowphase=!0),cr.allowSleep&&cr.type===Body.DYNAMIC&&cr.sleepState===Body.SLEEPING&&ir.sleepState===Body.AWAKE&&ir.type!==Body.STATIC&&ir.velocity.lengthSquared()+ir.angularVelocity.lengthSquared()>=2*ir.sleepSpeedLimit**2&&(cr.wakeUpAfterNarrowphase=!0),this.collisionMatrix.set(ir,cr,!0),this.collisionMatrixPrevious.get(ir,cr)||(World_step_collideEvent.body=cr,World_step_collideEvent.contact=sr,ir.dispatchEvent(World_step_collideEvent),World_step_collideEvent.body=ir,cr.dispatchEvent(World_step_collideEvent)),this.bodyOverlapKeeper.set(ir.id,cr.id),this.shapeOverlapKeeper.set(lr.id,hr.id)}for(this.emitContactEvents(),at&&(ut.makeContactConstraints=cannon_es_performance.now()-mt,mt=cannon_es_performance.now()),Et=0;Et!==b;Et++){const Kt=_e[Et];Kt.wakeUpAfterNarrowphase&&(Kt.wakeUp(),Kt.wakeUpAfterNarrowphase=!1)}for(Tt=ft.length,Et=0;Et!==Tt;Et++){const Kt=ft[Et];Kt.update();for(let sr=0,ir=Kt.equations.length;sr!==ir;sr++){const cr=Kt.equations[sr];it.addEquation(cr)}}it.solve(o,this),at&&(ut.solve=cannon_es_performance.now()-mt),it.removeAllEquations();const Rt=Math.pow;for(Et=0;Et!==b;Et++){const Kt=_e[Et];if(Kt.type&pt){const sr=Rt(1-Kt.linearDamping,o),ir=Kt.velocity;ir.scale(sr,ir);const cr=Kt.angularVelocity;if(cr){const lr=Rt(1-Kt.angularDamping,o);cr.scale(lr,cr)}}}this.dispatchEvent(World_step_preStepEvent),at&&(mt=cannon_es_performance.now());const Ut=this.stepnumber%(this.quatNormalizeSkip+1)==0,Ht=this.quatNormalizeFast;for(Et=0;Et!==b;Et++)_e[Et].integrate(o,Ut,Ht);this.clearForces(),this.broadphase.dirty=!0,at&&(ut.integrate=cannon_es_performance.now()-mt),this.stepnumber+=1,this.dispatchEvent(World_step_postStepEvent);let Jt=!0;if(this.allowSleep)for(Jt=!1,Et=0;Et!==b;Et++){const Kt=_e[Et];Kt.sleepTick(this.time),Kt.sleepState!==Body.SLEEPING&&(Jt=!0)}this.hasActiveBodies=Jt}emitContactEvents(){const o=this.hasAnyEventListener("beginContact"),c=this.hasAnyEventListener("endContact");if((o||c)&&this.bodyOverlapKeeper.getDiff(additions,removals),o){for(let b=0,_e=additions.length;b<_e;b+=2)beginContactEvent.bodyA=this.getBodyById(additions[b]),beginContactEvent.bodyB=this.getBodyById(additions[b+1]),this.dispatchEvent(beginContactEvent);beginContactEvent.bodyA=beginContactEvent.bodyB=null}if(c){for(let b=0,_e=removals.length;b<_e;b+=2)endContactEvent.bodyA=this.getBodyById(removals[b]),endContactEvent.bodyB=this.getBodyById(removals[b+1]),this.dispatchEvent(endContactEvent);endContactEvent.bodyA=endContactEvent.bodyB=null}additions.length=removals.length=0;const d=this.hasAnyEventListener("beginShapeContact"),_=this.hasAnyEventListener("endShapeContact");if((d||_)&&this.shapeOverlapKeeper.getDiff(additions,removals),d){for(let b=0,_e=additions.length;b<_e;b+=2){const it=this.getShapeById(additions[b]),nt=this.getShapeById(additions[b+1]);beginShapeContactEvent.shapeA=it,beginShapeContactEvent.shapeB=nt,it&&(beginShapeContactEvent.bodyA=it.body),nt&&(beginShapeContactEvent.bodyB=nt.body),this.dispatchEvent(beginShapeContactEvent)}beginShapeContactEvent.bodyA=beginShapeContactEvent.bodyB=beginShapeContactEvent.shapeA=beginShapeContactEvent.shapeB=null}if(_){for(let b=0,_e=removals.length;b<_e;b+=2){const it=this.getShapeById(removals[b]),nt=this.getShapeById(removals[b+1]);endShapeContactEvent.shapeA=it,endShapeContactEvent.shapeB=nt,it&&(endShapeContactEvent.bodyA=it.body),nt&&(endShapeContactEvent.bodyB=nt.body),this.dispatchEvent(endShapeContactEvent)}endShapeContactEvent.bodyA=endShapeContactEvent.bodyB=endShapeContactEvent.shapeA=endShapeContactEvent.shapeB=null}}clearForces(){const o=this.bodies,c=o.length;for(let d=0;d!==c;d++){const _=o[d];_.force,_.torque,_.force.set(0,0,0),_.torque.set(0,0,0)}}}new AABB;const tmpRay=new Ray,cannon_es_performance=globalThis.performance||{};if(!cannon_es_performance.now){let h=Date.now();cannon_es_performance.timing&&cannon_es_performance.timing.navigationStart&&(h=cannon_es_performance.timing.navigationStart),cannon_es_performance.now=()=>Date.now()-h}new Vec3;const World_step_postStepEvent={type:"postStep"},World_step_preStepEvent={type:"preStep"},World_step_collideEvent={type:Body.COLLIDE_EVENT_NAME,body:null,contact:null},World_step_oldContacts=[],World_step_frictionEquationPool=[],World_step_p1=[],World_step_p2=[],additions=[],removals=[],beginContactEvent={type:"beginContact",bodyA:null,bodyB:null},endContactEvent={type:"endContact",bodyA:null,bodyB:null},beginShapeContactEvent={type:"beginShapeContact",bodyA:null,bodyB:null,shapeA:null,shapeB:null},endShapeContactEvent={type:"endShapeContact",bodyA:null,bodyB:null,shapeA:null,shapeB:null};var ConvexHull=function(){var h,o,c,d=new three_module.Pq0;function _(){this.tolerance=-1,this.faces=[],this.newFaces=[],this.assigned=new nt,this.unassigned=new nt,this.vertices=[]}function b(){this.normal=new three_module.Pq0,this.midpoint=new three_module.Pq0,this.area=0,this.constant=0,this.outside=null,this.mark=0,this.edge=null}function _e(at,ut){this.vertex=at,this.prev=null,this.next=null,this.twin=null,this.face=ut}function it(at,ut){this.point=at,this.index=ut,this.prev=null,this.next=null,this.face=null}function nt(){this.head=null,this.tail=null}return Object.assign(_.prototype,{toJSON:function(){const at=this.faces.map(vt=>vt.toArray()),ut=Array.from(new Set(at.flat())).sort(),pt=[];for(let vt=0;vt<ut.length;vt++)pt.push(this.vertices[ut[vt]].point.x,this.vertices[ut[vt]].point.y,this.vertices[ut[vt]].point.z);const mt=new Map;for(let vt=0;vt<ut.length;vt++)mt.set(ut[vt],vt);const ft=[];for(let vt=0;vt<at.length;vt++)ft.push([mt.get(at[vt][0]),mt.get(at[vt][1]),mt.get(at[vt][2])]);return[pt,ft]},setFromPoints:function(at){Array.isArray(at)!==!0&&console.error("THREE.ConvexHull: Points parameter is not an array."),at.length<4&&console.error("THREE.ConvexHull: The algorithm needs at least four points."),this.makeEmpty();for(var ut=0,pt=at.length;ut<pt;ut++)this.vertices.push(new it(at[ut],ut));return this.compute(),this},setFromObject:function(at){var ut=[];return at.updateMatrixWorld(!0),at.traverse(function(pt){var mt,ft,vt,xt=pt.geometry;if(xt!==void 0&&(xt.isGeometry&&(xt=xt.toBufferGeometry?xt.toBufferGeometry():new BufferGeometry().fromGeometry(xt)),xt.isBufferGeometry)){var At=xt.attributes.position;if(At!==void 0)for(mt=0,ft=At.count;mt<ft;mt++)(vt=new three_module.Pq0).fromBufferAttribute(At,mt).applyMatrix4(pt.matrixWorld),ut.push(vt)}}),this.setFromPoints(ut)},containsPoint:function(at){for(var ut=this.faces,pt=0,mt=ut.length;pt<mt;pt++)if(ut[pt].distanceToPoint(at)>this.tolerance)return!1;return!0},intersectRay:function(at,ut){for(var pt=this.faces,mt=-1/0,ft=1/0,vt=0,xt=pt.length;vt<xt;vt++){var At=pt[vt],Ct=At.distanceToPoint(at.origin),Et=At.normal.dot(at.direction);if(Ct>0&&Et>=0)return null;var Tt=Et!==0?-Ct/Et:0;if(!(Tt<=0)&&(Et>0?ft=Math.min(Tt,ft):mt=Math.max(Tt,mt),mt>ft))return null}return mt!==-1/0?at.at(mt,ut):at.at(ft,ut),ut},intersectsRay:function(at){return this.intersectRay(at,d)!==null},makeEmpty:function(){return this.faces=[],this.vertices=[],this},addVertexToFace:function(at,ut){return at.face=ut,ut.outside===null?this.assigned.append(at):this.assigned.insertBefore(ut.outside,at),ut.outside=at,this},removeVertexFromFace:function(at,ut){return at===ut.outside&&(at.next!==null&&at.next.face===ut?ut.outside=at.next:ut.outside=null),this.assigned.remove(at),this},removeAllVerticesFromFace:function(at){if(at.outside!==null){for(var ut=at.outside,pt=at.outside;pt.next!==null&&pt.next.face===at;)pt=pt.next;return this.assigned.removeSubList(ut,pt),ut.prev=pt.next=null,at.outside=null,ut}},deleteFaceVertices:function(at,ut){var pt=this.removeAllVerticesFromFace(at);if(pt!==void 0)if(ut===void 0)this.unassigned.appendChain(pt);else{var mt=pt;do{var ft=mt.next;ut.distanceToPoint(mt.point)>this.tolerance?this.addVertexToFace(mt,ut):this.unassigned.append(mt),mt=ft}while(mt!==null)}return this},resolveUnassignedPoints:function(at){if(this.unassigned.isEmpty()===!1){var ut=this.unassigned.first();do{for(var pt=ut.next,mt=this.tolerance,ft=null,vt=0;vt<at.length;vt++){var xt=at[vt];if(xt.mark===0){var At=xt.distanceToPoint(ut.point);if(At>mt&&(mt=At,ft=xt),mt>1e3*this.tolerance)break}}ft!==null&&this.addVertexToFace(ut,ft),ut=pt}while(ut!==null)}return this},computeExtremes:function(){var at,ut,pt,mt=new three_module.Pq0,ft=new three_module.Pq0,vt=[],xt=[];for(at=0;at<3;at++)vt[at]=xt[at]=this.vertices[0];for(mt.copy(this.vertices[0].point),ft.copy(this.vertices[0].point),at=0,ut=this.vertices.length;at<ut;at++){var At=this.vertices[at],Ct=At.point;for(pt=0;pt<3;pt++)Ct.getComponent(pt)<mt.getComponent(pt)&&(mt.setComponent(pt,Ct.getComponent(pt)),vt[pt]=At);for(pt=0;pt<3;pt++)Ct.getComponent(pt)>ft.getComponent(pt)&&(ft.setComponent(pt,Ct.getComponent(pt)),xt[pt]=At)}return this.tolerance=3*Number.EPSILON*(Math.max(Math.abs(mt.x),Math.abs(ft.x))+Math.max(Math.abs(mt.y),Math.abs(ft.y))+Math.max(Math.abs(mt.z),Math.abs(ft.z))),{min:vt,max:xt}},computeInitialHull:function(){h===void 0&&(h=new three_module.cZY,o=new three_module.Zcv,c=new three_module.Pq0);var at,ut,pt,mt,ft,vt,xt,At,Ct,Et=this.vertices,Tt=this.computeExtremes(),kt=Tt.min,Dt=Tt.max,zt=0,Bt=0;for(vt=0;vt<3;vt++)(Ct=Dt[vt].point.getComponent(vt)-kt[vt].point.getComponent(vt))>zt&&(zt=Ct,Bt=vt);for(ut=kt[Bt],pt=Dt[Bt],zt=0,h.set(ut.point,pt.point),vt=0,xt=this.vertices.length;vt<xt;vt++)(at=Et[vt])!==ut&&at!==pt&&(h.closestPointToPoint(at.point,!0,c),(Ct=c.distanceToSquared(at.point))>zt&&(zt=Ct,mt=at));for(zt=-1,o.setFromCoplanarPoints(ut.point,pt.point,mt.point),vt=0,xt=this.vertices.length;vt<xt;vt++)(at=Et[vt])!==ut&&at!==pt&&at!==mt&&(Ct=Math.abs(o.distanceToPoint(at.point)))>zt&&(zt=Ct,ft=at);var Rt=[];if(o.distanceToPoint(ft.point)<0)for(Rt.push(b.create(ut,pt,mt),b.create(ft,pt,ut),b.create(ft,mt,pt),b.create(ft,ut,mt)),vt=0;vt<3;vt++)At=(vt+1)%3,Rt[vt+1].getEdge(2).setTwin(Rt[0].getEdge(At)),Rt[vt+1].getEdge(1).setTwin(Rt[At+1].getEdge(0));else for(Rt.push(b.create(ut,mt,pt),b.create(ft,ut,pt),b.create(ft,pt,mt),b.create(ft,mt,ut)),vt=0;vt<3;vt++)At=(vt+1)%3,Rt[vt+1].getEdge(2).setTwin(Rt[0].getEdge((3-vt)%3)),Rt[vt+1].getEdge(0).setTwin(Rt[At+1].getEdge(1));for(vt=0;vt<4;vt++)this.faces.push(Rt[vt]);for(vt=0,xt=Et.length;vt<xt;vt++)if((at=Et[vt])!==ut&&at!==pt&&at!==mt&&at!==ft){zt=this.tolerance;var Ut=null;for(At=0;At<4;At++)(Ct=this.faces[At].distanceToPoint(at.point))>zt&&(zt=Ct,Ut=this.faces[At]);Ut!==null&&this.addVertexToFace(at,Ut)}return this},reindexFaces:function(){for(var at=[],ut=0;ut<this.faces.length;ut++){var pt=this.faces[ut];pt.mark===0&&at.push(pt)}return this.faces=at,this},nextVertexToAdd:function(){if(this.assigned.isEmpty()===!1){var at,ut=0,pt=this.assigned.first().face,mt=pt.outside;do{var ft=pt.distanceToPoint(mt.point);ft>ut&&(ut=ft,at=mt),mt=mt.next}while(mt!==null&&mt.face===pt);return at}},computeHorizon:function(at,ut,pt,mt){var ft;this.deleteFaceVertices(pt),pt.mark=1,ft=ut===null?ut=pt.getEdge(0):ut.next;do{var vt=ft.twin,xt=vt.face;xt.mark===0&&(xt.distanceToPoint(at)>this.tolerance?this.computeHorizon(at,vt,xt,mt):mt.push(ft)),ft=ft.next}while(ft!==ut);return this},addAdjoiningFace:function(at,ut){var pt=b.create(at,ut.tail(),ut.head());return this.faces.push(pt),pt.getEdge(-1).setTwin(ut.twin),pt.getEdge(0)},addNewFaces:function(at,ut){this.newFaces=[];for(var pt=null,mt=null,ft=0;ft<ut.length;ft++){var vt=ut[ft],xt=this.addAdjoiningFace(at,vt);pt===null?pt=xt:xt.next.setTwin(mt),this.newFaces.push(xt.face),mt=xt}return pt.next.setTwin(mt),this},addVertexToHull:function(at){var ut=[];return this.unassigned.clear(),this.removeVertexFromFace(at,at.face),this.computeHorizon(at.point,null,at.face,ut),this.addNewFaces(at,ut),this.resolveUnassignedPoints(this.newFaces),this},cleanup:function(){return this.assigned.clear(),this.unassigned.clear(),this.newFaces=[],this},compute:function(){var at;for(this.computeInitialHull();(at=this.nextVertexToAdd())!==void 0;)this.addVertexToHull(at);return this.reindexFaces(),this.cleanup(),this}}),Object.assign(b,{create:function(at,ut,pt){var mt=new b,ft=new _e(at,mt),vt=new _e(ut,mt),xt=new _e(pt,mt);return ft.next=xt.prev=vt,vt.next=ft.prev=xt,xt.next=vt.prev=ft,mt.edge=ft,mt.compute()}}),Object.assign(b.prototype,{toArray:function(){const at=[];let ut=this.edge;do at.push(ut.head().index),ut=ut.next;while(ut!==this.edge);return at},getEdge:function(at){for(var ut=this.edge;at>0;)ut=ut.next,at--;for(;at<0;)ut=ut.prev,at++;return ut},compute:function(){var at;return function(){at===void 0&&(at=new three_module.lMl);var ut=this.edge.tail(),pt=this.edge.head(),mt=this.edge.next.head();return at.set(ut.point,pt.point,mt.point),at.getNormal(this.normal),at.getMidpoint(this.midpoint),this.area=at.getArea(),this.constant=this.normal.dot(this.midpoint),this}}(),distanceToPoint:function(at){return this.normal.dot(at)-this.constant}}),Object.assign(_e.prototype,{head:function(){return this.vertex},tail:function(){return this.prev?this.prev.vertex:null},length:function(){var at=this.head(),ut=this.tail();return ut!==null?ut.point.distanceTo(at.point):-1},lengthSquared:function(){var at=this.head(),ut=this.tail();return ut!==null?ut.point.distanceToSquared(at.point):-1},setTwin:function(at){return this.twin=at,at.twin=this,this}}),Object.assign(nt.prototype,{first:function(){return this.head},last:function(){return this.tail},clear:function(){return this.head=this.tail=null,this},insertBefore:function(at,ut){return ut.prev=at.prev,ut.next=at,ut.prev===null?this.head=ut:ut.prev.next=ut,at.prev=ut,this},insertAfter:function(at,ut){return ut.prev=at,ut.next=at.next,ut.next===null?this.tail=ut:ut.next.prev=ut,at.next=ut,this},append:function(at){return this.head===null?this.head=at:this.tail.next=at,at.prev=this.tail,at.next=null,this.tail=at,this},appendChain:function(at){for(this.head===null?this.head=at:this.tail.next=at,at.prev=this.tail;at.next!==null;)at=at.next;return this.tail=at,this},remove:function(at){return at.prev===null?this.head=at.next:at.prev.next=at.next,at.next===null?this.tail=at.prev:at.next.prev=at.prev,this},removeSubList:function(at,ut){return at.prev===null?this.head=ut.next:at.prev.next=ut.next,ut.next===null?this.tail=at.prev:ut.next.prev=at.prev,this},isEmpty:function(){return this.head===null}}),_}();const three_to_cannon_modern_v1=new three_module.Pq0,_v2=new three_module.Pq0,three_to_cannon_modern_q1=new three_module.PTz;function getGeometry(h){const o=getMeshes(h);if(o.length===0)return null;if(o.length===1)return normalizeGeometry(o[0]);let c;const d=[];for(;c=o.pop();)d.push(simplifyGeometry(normalizeGeometry(c)));return three_to_cannon_modern_mergeBufferGeometries(d)}function normalizeGeometry(h){let o=h.geometry;return o=o.toBufferGeometry?o.toBufferGeometry():o.clone(),h.updateMatrixWorld(),h.matrixWorld.decompose(three_to_cannon_modern_v1,three_to_cannon_modern_q1,_v2),o.scale(_v2.x,_v2.y,_v2.z),o}function three_to_cannon_modern_mergeBufferGeometries(h){let o=0;for(let _=0;_<h.length;_++){const b=h[_].attributes.position;b&&b.itemSize===3&&(o+=b.count)}const c=new Float32Array(3*o);let d=0;for(let _=0;_<h.length;_++){const b=h[_].attributes.position;if(b&&b.itemSize===3)for(let _e=0;_e<b.count;_e++)c[d++]=b.getX(_e),c[d++]=b.getY(_e),c[d++]=b.getZ(_e)}return new three_module.LoY().setAttribute("position",new three_module.THS(c,3))}function getVertices(h){const o=h.attributes.position,c=new Float32Array(3*o.count);for(let d=0;d<o.count;d++)c[3*d]=o.getX(d),c[3*d+1]=o.getY(d),c[3*d+2]=o.getZ(d);return c}function getMeshes(h){const o=[];return h.traverse(function(c){c.isMesh&&o.push(c)}),o}function getComponent(h,o){switch(o){case"x":return h.x;case"y":return h.y;case"z":return h.z}throw new Error(`Unexpected component ${o}`)}function simplifyGeometry(h,o=1e-4){o=Math.max(o,Number.EPSILON);const c={},d=h.getIndex(),_=h.getAttribute("position"),b=d?d.count:_.count;let _e=0;const it=[],nt=[],at=Math.log10(1/o),ut=Math.pow(10,at);for(let ft=0;ft<b;ft++){const vt=d?d.getX(ft):ft;let xt="";xt+=~~(_.getX(vt)*ut)+",",xt+=~~(_.getY(vt)*ut)+",",xt+=~~(_.getZ(vt)*ut)+",",xt in c?it.push(c[xt]):(nt.push(_.getX(vt)),nt.push(_.getY(vt)),nt.push(_.getZ(vt)),c[xt]=_e,it.push(_e),_e++)}const pt=new three_module.THS(new Float32Array(nt),_.itemSize,_.normalized),mt=new three_module.LoY;return mt.setAttribute("position",pt),mt.setIndex(it),mt}const PI_2=Math.PI/2;var ShapeType;(function(h){h.BOX="Box",h.CYLINDER="Cylinder",h.SPHERE="Sphere",h.HULL="ConvexPolyhedron",h.MESH="Trimesh"})(ShapeType||(ShapeType={}));const getShapeParameters=function(h,o={}){let c;if(o.type===ShapeType.BOX)return getBoundingBoxParameters(h);if(o.type===ShapeType.CYLINDER)return getBoundingCylinderParameters(h,o);if(o.type===ShapeType.SPHERE)return getBoundingSphereParameters(h,o);if(o.type===ShapeType.HULL)return getConvexPolyhedronParameters(h);if(o.type===ShapeType.MESH)return c=getGeometry(h),c?getTrimeshParameters(c):null;if(o.type)throw new Error(`[CANNON.getShapeParameters] Invalid type "${o.type}".`);if(c=getGeometry(h),!c)return null;switch(c.type){case"BoxGeometry":case"BoxBufferGeometry":return getBoxParameters(c);case"CylinderGeometry":case"CylinderBufferGeometry":return getCylinderParameters(c);case"PlaneGeometry":case"PlaneBufferGeometry":return getPlaneParameters(c);case"SphereGeometry":case"SphereBufferGeometry":return getSphereParameters(c);case"TubeGeometry":case"BufferGeometry":return getBoundingBoxParameters(h);default:return console.warn('Unrecognized geometry: "%s". Using bounding box as shape.',c.type),getBoxParameters(c)}},threeToCannon=function(h,o={}){const c=getShapeParameters(h,o);if(!c)return null;const{type:d,params:_,offset:b,orientation:_e}=c;let it;return it=d===ShapeType.BOX?createBox$1(_):d===ShapeType.CYLINDER?createCylinder(_):d===ShapeType.SPHERE?createSphere(_):d===ShapeType.HULL?createConvexPolyhedron(_):createTrimesh(_),{shape:it,offset:b,orientation:_e}};function createBox$1(h){const{x:o,y:c,z:d}=h;return new Box(new Vec3(o,c,d))}function createCylinder(h){const{radiusTop:o,radiusBottom:c,height:d,segments:_}=h,b=new Cylinder(o,c,d,_);return b.radiusTop=c,b.radiusBottom=c,b.height=d,b.numSegments=_,b}function createSphere(h){return new Sphere(h.radius)}function createConvexPolyhedron(h){const{faces:o,vertices:c}=h,d=[];for(let _=0;_<c.length;_+=3)d.push(new Vec3(c[_],c[_+1],c[_+2]));return new ConvexPolyhedron({faces:o,vertices:d})}function createTrimesh(h){const{vertices:o,indices:c}=h;return new Trimesh(o,c)}function getBoxParameters(h){if(!getVertices(h).length)return null;h.computeBoundingBox();const o=h.boundingBox;return{type:ShapeType.BOX,params:{x:(o.max.x-o.min.x)/2,y:(o.max.y-o.min.y)/2,z:(o.max.z-o.min.z)/2}}}function getBoundingBoxParameters(h){const o=h.clone();o.quaternion.set(0,0,0,1),o.updateMatrixWorld();const c=new three_module.NRn().setFromObject(o);if(!isFinite(c.min.lengthSq()))return null;const d=c.translate(o.position.negate()).getCenter(new three_module.Pq0);return{type:ShapeType.BOX,params:{x:(c.max.x-c.min.x)/2,y:(c.max.y-c.min.y)/2,z:(c.max.z-c.min.z)/2},offset:d.lengthSq()?new Vec3(d.x,d.y,d.z):void 0}}function getConvexPolyhedronParameters(h){const o=getGeometry(h);if(!o)return null;const c=1e-4;for(let b=0;b<o.attributes.position.count;b++)o.attributes.position.setXYZ(b,o.attributes.position.getX(b)+(Math.random()-.5)*c,o.attributes.position.getY(b)+(Math.random()-.5)*c,o.attributes.position.getZ(b)+(Math.random()-.5)*c);const[d,_]=new ConvexHull().setFromObject(new three_module.eaF(o)).toJSON();return{type:ShapeType.HULL,params:{vertices:new Float32Array(d),faces:_}}}function getCylinderParameters(h){const o=h.parameters;return{type:ShapeType.CYLINDER,params:{radiusTop:o.radiusTop,radiusBottom:o.radiusBottom,height:o.height,segments:o.radialSegments},orientation:new Quaternion().setFromEuler(three_module.cj9.degToRad(-90),0,0,"XYZ").normalize()}}function getBoundingCylinderParameters(h,o){const c=["x","y","z"],d=o.cylinderAxis||"y",_=c.splice(c.indexOf(d),1)&&c,b=new three_module.NRn().setFromObject(h);if(!isFinite(b.min.lengthSq()))return null;const _e=b.max[d]-b.min[d],it=.5*Math.max(getComponent(b.max,_[0])-getComponent(b.min,_[0]),getComponent(b.max,_[1])-getComponent(b.min,_[1])),nt=d==="y"?PI_2:0,at=d==="z"?PI_2:0;return{type:ShapeType.CYLINDER,params:{radiusTop:it,radiusBottom:it,height:_e,segments:12},orientation:new Quaternion().setFromEuler(nt,at,0,"XYZ").normalize()}}function getPlaneParameters(h){h.computeBoundingBox();const o=h.boundingBox;return{type:ShapeType.BOX,params:{x:(o.max.x-o.min.x)/2||.1,y:(o.max.y-o.min.y)/2||.1,z:(o.max.z-o.min.z)/2||.1}}}function getSphereParameters(h){return{type:ShapeType.SPHERE,params:{radius:h.parameters.radius}}}function getBoundingSphereParameters(h,o){if(o.sphereRadius)return{type:ShapeType.SPHERE,params:{radius:o.sphereRadius}};const c=getGeometry(h);return c?(c.computeBoundingSphere(),{type:ShapeType.SPHERE,params:{radius:c.boundingSphere.radius}}):null}function getTrimeshParameters(h){const o=getVertices(h);if(!o.length)return null;const c=new Uint32Array(o.length);for(let d=0;d<o.length;d++)c[d]=d;return{type:ShapeType.MESH,params:{vertices:o,indices:c}}}var CannonPhysicsPlugin_decorate=function(h,o,c,d){var _,b=arguments.length,_e=b<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_e=Reflect.decorate(h,o,c,d);else for(var it=h.length-1;it>=0;it--)(_=h[it])&&(_e=(b<3?_(_e):b>3?_(o,c,_e):_(o,c))||_e);return b>3&&_e&&Object.defineProperty(o,c,_e),_e},CannonPhysicsPlugin_1;let CannonPhysicsPlugin=CannonPhysicsPlugin_1=class extends AViewerPlugin{constructor(h=!1){super(),this._world=new World,this.enabled=!0,this.nextSteps=0,this.stepPhysics={stepCount:100,delta:.1,step:()=>{this.nextSteps=this.stepPhysics.stepCount}},this.makeRootBodies=()=>{var _;(_=this._viewer)===null||_===void 0||_.scene.modelRoot.children.forEach(b=>{this.makeBody(b)})},this._bodyMeshMap=new Map,this._movementPlane=new three_module.eaF(new three_module.bdM(100,100),new three_module.V9B({color:65280,side:three_module.$EB})),this.enabled=h,this._world.gravity.set(0,-9.81,0);const o=new cannon_es_Plane,c=new Body({mass:0,position:new Vec3(0,-2,0)});c.addShape(o),c.quaternion.setFromEuler(-Math.PI/2,0,0),this._ground=c,this._world.addBody(c);const d=new Sphere(.1);this._jointBody=new Body({mass:0}),this._jointBody.addShape(d),this._jointBody.collisionFilterGroup=0,this._jointBody.collisionFilterMask=0,this._world.addBody(this._jointBody)}async onAdded(h){await super.onAdded(h);const o=new three_module.Pq0,c=new three_module.Pq0,d=new three_module.Pq0,_=new three_module.PTz,b=new three_module.PTz,_e=new three_module.kn4,it=new three_module.kn4;let nt=!1,at=!1;function ut(pt){const mt=h.canvas.getBoundingClientRect(),ft=new three_module.I9Y;return ft.x=(pt.clientX-mt.x)/mt.width*2-1,ft.y=-(pt.clientY-mt.y)/mt.height*2+1,ft}h.addEventListener("preFrame",()=>{const pt=h.getPlugin(GroundPlugin),mt=h.getPlugin(FrameFadePlugin);if(!this.enabled){if(!(this.nextSteps>0))return pt&&nt&&(pt.enableRefreshTransform=!0,nt=!1),mt&&at&&(mt.enable(CannonPhysicsPlugin_1.PluginType),at=!1),void(this._dirty=!1);this.enabled=!0}if(pt&&pt.enableRefreshTransform&&!nt&&(pt.enableRefreshTransform=!1,nt=!0),mt&&!at&&mt.disable(CannonPhysicsPlugin_1.PluginType),this.nextSteps>0)for(let vt=0;vt<this.stepPhysics.stepCount;vt++)this._world.step(this.stepPhysics.delta);else this._world.fixedStep();this._dirty=!1;let ft=!1;for(const vt of this._world.bodies){if(vt.mass===0)continue;const xt=this._bodyMeshMap.get(vt);if(xt&&(xt.updateMatrixWorld(),xt.getWorldPosition(c),xt.getWorldQuaternion(b),xt.getWorldScale(d),c.manhattanDistanceTo(o.copy(vt.position))>0&&(ft=!0),b.angleTo(_.copy(vt.quaternion))>0&&(ft=!0),ft)){if(_e.compose(o,_,d),!xt.parent)throw new Error("no parent");it.copy(xt.parent.matrixWorld).invert(),it.multiply(_e),it.decompose(o,_,d),xt.position.copy(o),xt.quaternion.copy(_)}}this._dirty=ft,h.setDirty(),h.renderer.resetShadows(),pt==null||pt.bakeShadows(),this.nextSteps>0&&(this.enabled=!1,this.nextSteps=0)}),h.scene.addEventListener("update",pt=>{this._bodyMeshMap.forEach((mt,ft)=>{ft.velocity.set(0,0,0),ft.angularVelocity.set(0,0,0)})}),h.scene.addEventListener("addSceneObject",pt=>{var mt;const ft=(mt=pt.object)===null||mt===void 0?void 0:mt.modelObject;ft&&ft.traverse(vt=>{const xt=vt.uiConfig;xt&&Array.isArray(xt.children)&&!vt.isWidget&&(xt.children.push({type:"folder",label:"Physics",children:[{type:"button",label:"Make Body",value:()=>this.makeBody(vt)},{type:"number",label:"Mass",hidden:()=>!vt._physicsBody,getValue:()=>{var At,Ct;return(Ct=(At=vt._physicsBody)===null||At===void 0?void 0:At.mass)!==null&&Ct!==void 0?Ct:0},setValue:At=>{vt._physicsBody&&(vt._physicsBody.mass=At)}}]}),vt.userData.physicsMass!==void 0&&this.makeBody(vt))})}),h.canvas.addEventListener("pointerdown",pt=>{if(!this.enabled||!pt.isPrimary)return;h.getPlugin(PickingPlugin)&&(h.getPlugin(PickingPlugin).enabled=!1);const mt=ut(pt),ft=new three_module.tBo;ft.setFromCamera(mt,h.scene.activeCamera.cameraObject);const vt=ft.intersectObjects([...this._bodyMeshMap.values()],!0);if(!vt.length)return;let xt,At=null,Ct=vt[0];for(const kt of vt){for(At=kt.object,Ct=kt;!(At==null||At.visible&&At.material);)At=At.parent;if(At)break}if(!At)return;for(;At.parent&&!xt;){for(const[kt,Dt]of this._bodyMeshMap.entries())if(Dt===At){kt.mass>0&&(xt=kt);break}At=At.parent}if(!xt)return;h.scene.activeCamera.setInteractions(!1,CannonPhysicsPlugin_1.PluginType),this._movementPlane.position.copy(Ct.point),this._movementPlane.lookAt(h.scene.activeCamera.cameraObject.getWorldPosition(new three_module.Pq0));const Et=new Vec3().copy(Ct.point).vsub(xt.position),Tt=xt.quaternion.inverse().vmult(Et);this._jointBody.position.copy(Ct.point),this._jointConstraint=new PointToPointConstraint(xt,Tt,this._jointBody,new Vec3(0,0,0)),this._world.addConstraint(this._jointConstraint)}),h.canvas.addEventListener("pointermove",pt=>{if(!this.enabled||!pt.isPrimary||!this._jointConstraint)return;const mt=ut(pt),ft=new three_module.tBo;ft.setFromCamera(mt,h.scene.activeCamera.cameraObject);const vt=ft.intersectObject(this._movementPlane);if(!vt.length)return;const xt=vt[0];this._jointBody.position.copy(xt.point),this._jointConstraint.update()}),h.canvas.addEventListener("pointerup",pt=>{this.enabled&&pt.isPrimary&&(h.getPlugin(PickingPlugin)&&(h.getPlugin(PickingPlugin).enabled=!0),h.scene.activeCamera.setInteractions(!0,CannonPhysicsPlugin_1.PluginType),this._jointConstraint&&(this._world.removeConstraint(this._jointConstraint),this._jointConstraint=void 0))})}makeBody(h){if(h.isLight||h._physicsBody)return;const o=[];let c=0;if(h.updateMatrixWorld(),h.traverse(nt=>{var at;const ut=nt;if(!ut.isMesh||!ut.material||!ut.visible)return;if(ut._physicsShape)return void o.push(ut._physicsShape);if(c+=(at=ut.userData.physicsMass)!==null&&at!==void 0?at:1,ut.addEventListener("objectUpdate",()=>{ut.userData.physicsMass===0&&(this._ground.position.y=ut.position.y,this._bodyMeshMap.forEach((mt,ft)=>{ft.velocity.set(0,0,0),ft.angularVelocity.set(0,0,0),ft.force.set(0,0,0),ft.torque.set(0,0,0)}))}),ut.userData.physicsMass===0)return;const pt=threeToCannon(ut,{type:ShapeType.HULL});pt?(o.push([pt.shape,ut]),ut._physicsShape=pt.shape):console.warn("Failed to convert mesh to cannon shape",ut)}),!o.length)return;const d=new Body({mass:c,angularVelocity:new Vec3(0,0,0),velocity:new Vec3(0,0,0)}),_=new three_module.Pq0,b=new three_module.PTz,_e=new three_module.Pq0,it=new three_module.kn4;for(const[nt,at]of o)at!==h?(at.updateMatrixWorld(),it.copy(h.matrixWorld).invert(),it.multiply(at.matrixWorld),it.decompose(_,b,_e),d.addShape(nt,new Vec3(..._.toArray()),new Quaternion(...b.toArray()))):d.addShape(nt);d.position.set(...h.getWorldPosition(_).toArray()),d.quaternion.set(...h.getWorldQuaternion(b).toArray()),d.angularVelocity.set(0,0,0),d.velocity.set(0,0,0),h.addEventListener("objectUpdate",()=>{d.position.set(...h.getWorldPosition(_).toArray()),d.quaternion.set(...h.getWorldQuaternion(b).toArray()),d.angularVelocity.set(0,0,0),d.velocity.set(0,0,0)}),this._world.addBody(d),this._bodyMeshMap.set(d,h),h._physicsBody=d,h.setDirty({sceneUpdate:!0,updateGround:!1,frameFade:!1,refreshUi:!0})}};CannonPhysicsPlugin.PluginType="CannonPhysics",CannonPhysicsPlugin_decorate([uiToggle("Enabled",h=>({onChange:()=>{}})),serialize()],CannonPhysicsPlugin.prototype,"enabled",void 0),CannonPhysicsPlugin_decorate([uiConfig()],CannonPhysicsPlugin.prototype,"stepPhysics",void 0),CannonPhysicsPlugin_decorate([uiButton("Make Root Bodies")],CannonPhysicsPlugin.prototype,"makeRootBodies",void 0),CannonPhysicsPlugin=CannonPhysicsPlugin_1=CannonPhysicsPlugin_decorate([uiFolder("Physics (dev)")],CannonPhysicsPlugin);class SimplexNoise{constructor(o=Math){this.grad3=[[1,1,0],[-1,1,0],[1,-1,0],[-1,-1,0],[1,0,1],[-1,0,1],[1,0,-1],[-1,0,-1],[0,1,1],[0,-1,1],[0,1,-1],[0,-1,-1]],this.grad4=[[0,1,1,1],[0,1,1,-1],[0,1,-1,1],[0,1,-1,-1],[0,-1,1,1],[0,-1,1,-1],[0,-1,-1,1],[0,-1,-1,-1],[1,0,1,1],[1,0,1,-1],[1,0,-1,1],[1,0,-1,-1],[-1,0,1,1],[-1,0,1,-1],[-1,0,-1,1],[-1,0,-1,-1],[1,1,0,1],[1,1,0,-1],[1,-1,0,1],[1,-1,0,-1],[-1,1,0,1],[-1,1,0,-1],[-1,-1,0,1],[-1,-1,0,-1],[1,1,1,0],[1,1,-1,0],[1,-1,1,0],[1,-1,-1,0],[-1,1,1,0],[-1,1,-1,0],[-1,-1,1,0],[-1,-1,-1,0]],this.p=[];for(let c=0;c<256;c++)this.p[c]=Math.floor(256*o.random());this.perm=[];for(let c=0;c<512;c++)this.perm[c]=this.p[255&c];this.simplex=[[0,1,2,3],[0,1,3,2],[0,0,0,0],[0,2,3,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,3,0],[0,2,1,3],[0,0,0,0],[0,3,1,2],[0,3,2,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,3,2,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,0,3],[0,0,0,0],[1,3,0,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,3,0,1],[2,3,1,0],[1,0,2,3],[1,0,3,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,3,1],[0,0,0,0],[2,1,3,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,1,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,0,1,2],[3,0,2,1],[0,0,0,0],[3,1,2,0],[2,1,0,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,1,0,2],[0,0,0,0],[3,2,0,1],[3,2,1,0]]}dot(o,c,d){return o[0]*c+o[1]*d}dot3(o,c,d,_){return o[0]*c+o[1]*d+o[2]*_}dot4(o,c,d,_,b){return o[0]*c+o[1]*d+o[2]*_+o[3]*b}noise(o,c){let d,_,b;const _e=(o+c)*(.5*(Math.sqrt(3)-1)),it=Math.floor(o+_e),nt=Math.floor(c+_e),at=(3-Math.sqrt(3))/6,ut=(it+nt)*at,pt=o-(it-ut),mt=c-(nt-ut);let ft,vt;pt>mt?(ft=1,vt=0):(ft=0,vt=1);const xt=pt-ft+at,At=mt-vt+at,Ct=pt-1+2*at,Et=mt-1+2*at,Tt=255&it,kt=255&nt,Dt=this.perm[Tt+this.perm[kt]]%12,zt=this.perm[Tt+ft+this.perm[kt+vt]]%12,Bt=this.perm[Tt+1+this.perm[kt+1]]%12;let Rt=.5-pt*pt-mt*mt;Rt<0?d=0:(Rt*=Rt,d=Rt*Rt*this.dot(this.grad3[Dt],pt,mt));let Ut=.5-xt*xt-At*At;Ut<0?_=0:(Ut*=Ut,_=Ut*Ut*this.dot(this.grad3[zt],xt,At));let Ht=.5-Ct*Ct-Et*Et;return Ht<0?b=0:(Ht*=Ht,b=Ht*Ht*this.dot(this.grad3[Bt],Ct,Et)),70*(d+_+b)}noise3d(o,c,d){let _,b,_e,it;const nt=(o+c+d)*.3333333333333333,at=Math.floor(o+nt),ut=Math.floor(c+nt),pt=Math.floor(d+nt),mt=1/6,ft=(at+ut+pt)*mt,vt=o-(at-ft),xt=c-(ut-ft),At=d-(pt-ft);let Ct,Et,Tt,kt,Dt,zt;vt>=xt?xt>=At?(Ct=1,Et=0,Tt=0,kt=1,Dt=1,zt=0):vt>=At?(Ct=1,Et=0,Tt=0,kt=1,Dt=0,zt=1):(Ct=0,Et=0,Tt=1,kt=1,Dt=0,zt=1):xt<At?(Ct=0,Et=0,Tt=1,kt=0,Dt=1,zt=1):vt<At?(Ct=0,Et=1,Tt=0,kt=0,Dt=1,zt=1):(Ct=0,Et=1,Tt=0,kt=1,Dt=1,zt=0);const Bt=vt-Ct+mt,Rt=xt-Et+mt,Ut=At-Tt+mt,Ht=vt-kt+2*mt,Jt=xt-Dt+2*mt,Kt=At-zt+2*mt,sr=vt-1+.5,ir=xt-1+.5,cr=At-1+.5,lr=255&at,hr=255&ut,dr=255&pt,pr=this.perm[lr+this.perm[hr+this.perm[dr]]]%12,ur=this.perm[lr+Ct+this.perm[hr+Et+this.perm[dr+Tt]]]%12,xr=this.perm[lr+kt+this.perm[hr+Dt+this.perm[dr+zt]]]%12,vr=this.perm[lr+1+this.perm[hr+1+this.perm[dr+1]]]%12;let Dr=.6-vt*vt-xt*xt-At*At;Dr<0?_=0:(Dr*=Dr,_=Dr*Dr*this.dot3(this.grad3[pr],vt,xt,At));let _r=.6-Bt*Bt-Rt*Rt-Ut*Ut;_r<0?b=0:(_r*=_r,b=_r*_r*this.dot3(this.grad3[ur],Bt,Rt,Ut));let rr=.6-Ht*Ht-Jt*Jt-Kt*Kt;rr<0?_e=0:(rr*=rr,_e=rr*rr*this.dot3(this.grad3[xr],Ht,Jt,Kt));let mr=.6-sr*sr-ir*ir-cr*cr;return mr<0?it=0:(mr*=mr,it=mr*mr*this.dot3(this.grad3[vr],sr,ir,cr)),32*(_+b+_e+it)}noise4d(o,c,d,_){const b=this.grad4,_e=this.simplex,it=this.perm,nt=(Math.sqrt(5)-1)/4,at=(5-Math.sqrt(5))/20;let ut,pt,mt,ft,vt;const xt=(o+c+d+_)*nt,At=Math.floor(o+xt),Ct=Math.floor(c+xt),Et=Math.floor(d+xt),Tt=Math.floor(_+xt),kt=(At+Ct+Et+Tt)*at,Dt=o-(At-kt),zt=c-(Ct-kt),Bt=d-(Et-kt),Rt=_-(Tt-kt),Ut=(Dt>zt?32:0)+(Dt>Bt?16:0)+(zt>Bt?8:0)+(Dt>Rt?4:0)+(zt>Rt?2:0)+(Bt>Rt?1:0),Ht=_e[Ut][0]>=3?1:0,Jt=_e[Ut][1]>=3?1:0,Kt=_e[Ut][2]>=3?1:0,sr=_e[Ut][3]>=3?1:0,ir=_e[Ut][0]>=2?1:0,cr=_e[Ut][1]>=2?1:0,lr=_e[Ut][2]>=2?1:0,hr=_e[Ut][3]>=2?1:0,dr=_e[Ut][0]>=1?1:0,pr=_e[Ut][1]>=1?1:0,ur=_e[Ut][2]>=1?1:0,xr=_e[Ut][3]>=1?1:0,vr=Dt-Ht+at,Dr=zt-Jt+at,_r=Bt-Kt+at,rr=Rt-sr+at,mr=Dt-ir+2*at,Rr=zt-cr+2*at,Yr=Bt-lr+2*at,Zr=Rt-hr+2*at,cn=Dt-dr+3*at,Tn=zt-pr+3*at,yn=Bt-ur+3*at,zn=Rt-xr+3*at,gs=Dt-1+4*at,or=zt-1+4*at,yr=Bt-1+4*at,Pr=Rt-1+4*at,jr=255&At,Tr=255&Ct,Br=255&Et,Gr=255&Tt,tn=it[jr+it[Tr+it[Br+it[Gr]]]]%32,nn=it[jr+Ht+it[Tr+Jt+it[Br+Kt+it[Gr+sr]]]]%32,gn=it[jr+ir+it[Tr+cr+it[Br+lr+it[Gr+hr]]]]%32,xn=it[jr+dr+it[Tr+pr+it[Br+ur+it[Gr+xr]]]]%32,Mn=it[jr+1+it[Tr+1+it[Br+1+it[Gr+1]]]]%32;let An=.6-Dt*Dt-zt*zt-Bt*Bt-Rt*Rt;An<0?ut=0:(An*=An,ut=An*An*this.dot4(b[tn],Dt,zt,Bt,Rt));let vn=.6-vr*vr-Dr*Dr-_r*_r-rr*rr;vn<0?pt=0:(vn*=vn,pt=vn*vn*this.dot4(b[nn],vr,Dr,_r,rr));let Cn=.6-mr*mr-Rr*Rr-Yr*Yr-Zr*Zr;Cn<0?mt=0:(Cn*=Cn,mt=Cn*Cn*this.dot4(b[gn],mr,Rr,Yr,Zr));let rn=.6-cn*cn-Tn*Tn-yn*yn-zn*zn;rn<0?ft=0:(rn*=rn,ft=rn*rn*this.dot4(b[xn],cn,Tn,yn,zn));let En=.6-gs*gs-or*or-yr*yr-Pr*Pr;return En<0?vt=0:(En*=En,vt=En*En*this.dot4(b[Mn],gs,or,yr,Pr)),27*(ut+pt+mt+ft+vt)}}var WaveGroundPlugin_decorate=function(h,o,c,d){var _,b=arguments.length,_e=b<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_e=Reflect.decorate(h,o,c,d);else for(var it=h.length-1;it>=0;it--)(_=h[it])&&(_e=(b<3?_(_e):b>3?_(o,c,_e):_(o,c))||_e);return b>3&&_e&&Object.defineProperty(o,c,_e),_e},WaveGroundPlugin_1;let WaveGroundPlugin=WaveGroundPlugin_1=class extends AViewerPlugin{constructor(){super(),this.enabled=!1,this.noiseScale=1.8,this.amplitude=.5,this.paused=!1,this._preFrame=()=>{var d;this._viewer&&this.enabled&&(this.paused||(this._makeRoughGround(this._planeMesh.geometry,this.noiseScale,this.amplitude),(d=this._viewer)===null||d===void 0||d.setDirty()))},this._noise=new SimplexNoise;const h=new three_module.bdM(1,1,100,100),o=new MeshStandardMaterial2({color:16777215,side:three_module.$EB}),c=new three_module.eaF(h,o);c.receiveShadow=!0,c.rotation.x=-.5*Math.PI,c.position.x=0,c.position.y=-1,c.position.z=0,c.scale.setScalar(10),this._planeMesh=c,this.planeMesh=c}async onAdded(h){await super.onAdded(h),h.addEventListener("preFrame",this._preFrame),this.enabled&&await this.onEnable()}async onEnable(){var h,o;const c=this._viewer;if(!c)return;const d=c.getPluginByType("Ground"),_=c.getPlugin(FrameFadePlugin);if(!this.enabled)return this._planeMesh.visible=!1,_&&_.enable(WaveGroundPlugin_1.PluginType),(h=this._viewer)===null||h===void 0||h.setDirty(),void(d&&d.mesh&&d.setGeometry(void 0));if(_&&_.disable(WaveGroundPlugin_1.PluginType),d&&d.mesh)d.setGeometry(this._planeMesh.geometry),d.material&&(d.material.side=three_module.$EB,d.material.fog=!0),this.planeMesh=d.mesh.modelObject;else{const b=(o=c.scene.getObjectByName("WaveGroundPlugin_root"))!==null&&o!==void 0?o:(await c.createObject3D(void 0,!0)).modelObject;b.name="WaveGroundPlugin_root",b.clear(),this.planeMesh=this._planeMesh,b.add(this.planeMesh)}this.planeMesh.visible=!0}async onRemove(h){return h.removeEventListener("preFrame",this._preFrame),this.planeMesh=this._planeMesh,this._planeMesh.geometry.dispose(),this._planeMesh.removeFromParent(),super.onRemove(h)}_makeRoughGround(h,o=1,c=1){const d=Date.now(),_=30*o,b=.01*c,_e=h.attributes.position,it=_e.count;for(let nt=0;nt<it;nt++){const at=_e.getX(nt),ut=_e.getY(nt),pt=_e.getZ(nt),mt=5*this._noise.noise3d(at*_*.1+3e-4*d,ut*_*.1+3e-4*d,pt*_*.1+3e-4*d)*b+4*this._noise.noise3d(at*_*.2+12e-5*d,ut*_*.2+15e-5*d,pt*_*.2+15e-5*d)*b+4*this._noise.noise3d(at*_*.09+15e-5*d,ut*_*.12+9e-5*d,pt*_*.15+15e-5*d)*b;_e.setZ(nt,mt/3)}_e.needsUpdate=!0,h.computeVertexNormals()}};WaveGroundPlugin.PluginType="WaveGroundPlugin",WaveGroundPlugin_decorate([uiToggle(),serialize(),x$1(WaveGroundPlugin.prototype.onEnable)],WaveGroundPlugin.prototype,"enabled",void 0),WaveGroundPlugin_decorate([uiSlider("Noise scale",[0,2]),serialize()],WaveGroundPlugin.prototype,"noiseScale",void 0),WaveGroundPlugin_decorate([uiSlider("Amplitude",[0,2]),serialize()],WaveGroundPlugin.prototype,"amplitude",void 0),WaveGroundPlugin_decorate([uiToggle("Paused"),serialize()],WaveGroundPlugin.prototype,"paused",void 0),WaveGroundPlugin=WaveGroundPlugin_1=WaveGroundPlugin_decorate([uiFolder("Wave Ground")],WaveGroundPlugin);const Visible=0,Deleted=1,ConvexHull_v1=new three_module.Pq0,_line3=new three_module.cZY,ConvexHull_plane=new three_module.Zcv,ConvexHull_closestPoint=new three_module.Pq0,_triangle=new three_module.lMl;class ConvexHull_ConvexHull{constructor(){this.tolerance=-1,this.faces=[],this.newFaces=[],this.assigned=new VertexList,this.unassigned=new VertexList,this.vertices=[]}setFromPoints(o){if(o.length>=4){this.makeEmpty();for(let c=0,d=o.length;c<d;c++)this.vertices.push(new VertexNode(o[c]));this.compute()}return this}setFromObject(o){const c=[];return o.updateMatrixWorld(!0),o.traverse(function(d){const _=d.geometry;if(_!==void 0){const b=_.attributes.position;if(b!==void 0)for(let _e=0,it=b.count;_e<it;_e++){const nt=new three_module.Pq0;nt.fromBufferAttribute(b,_e).applyMatrix4(d.matrixWorld),c.push(nt)}}}),this.setFromPoints(c)}containsPoint(o){const c=this.faces;for(let d=0,_=c.length;d<_;d++)if(c[d].distanceToPoint(o)>this.tolerance)return!1;return!0}intersectRay(o,c){const d=this.faces;let _=-1/0,b=1/0;for(let _e=0,it=d.length;_e<it;_e++){const nt=d[_e],at=nt.distanceToPoint(o.origin),ut=nt.normal.dot(o.direction);if(at>0&&ut>=0)return null;const pt=ut!==0?-at/ut:0;if(!(pt<=0)&&(ut>0?b=Math.min(pt,b):_=Math.max(pt,_),_>b))return null}return _!==-1/0?o.at(_,c):o.at(b,c),c}intersectsRay(o){return this.intersectRay(o,ConvexHull_v1)!==null}makeEmpty(){return this.faces=[],this.vertices=[],this}addVertexToFace(o,c){return o.face=c,c.outside===null?this.assigned.append(o):this.assigned.insertBefore(c.outside,o),c.outside=o,this}removeVertexFromFace(o,c){return o===c.outside&&(o.next!==null&&o.next.face===c?c.outside=o.next:c.outside=null),this.assigned.remove(o),this}removeAllVerticesFromFace(o){if(o.outside!==null){const c=o.outside;let d=o.outside;for(;d.next!==null&&d.next.face===o;)d=d.next;return this.assigned.removeSubList(c,d),c.prev=d.next=null,o.outside=null,c}}deleteFaceVertices(o,c){const d=this.removeAllVerticesFromFace(o);if(d!==void 0)if(c===void 0)this.unassigned.appendChain(d);else{let _=d;do{const b=_.next;c.distanceToPoint(_.point)>this.tolerance?this.addVertexToFace(_,c):this.unassigned.append(_),_=b}while(_!==null)}return this}resolveUnassignedPoints(o){if(this.unassigned.isEmpty()===!1){let c=this.unassigned.first();do{const d=c.next;let _=this.tolerance,b=null;for(let _e=0;_e<o.length;_e++){const it=o[_e];if(it.mark===Visible){const nt=it.distanceToPoint(c.point);if(nt>_&&(_=nt,b=it),_>1e3*this.tolerance)break}}b!==null&&this.addVertexToFace(c,b),c=d}while(c!==null)}return this}computeExtremes(){const o=new three_module.Pq0,c=new three_module.Pq0,d=[],_=[];for(let b=0;b<3;b++)d[b]=_[b]=this.vertices[0];o.copy(this.vertices[0].point),c.copy(this.vertices[0].point);for(let b=0,_e=this.vertices.length;b<_e;b++){const it=this.vertices[b],nt=it.point;for(let at=0;at<3;at++)nt.getComponent(at)<o.getComponent(at)&&(o.setComponent(at,nt.getComponent(at)),d[at]=it);for(let at=0;at<3;at++)nt.getComponent(at)>c.getComponent(at)&&(c.setComponent(at,nt.getComponent(at)),_[at]=it)}return this.tolerance=3*Number.EPSILON*(Math.max(Math.abs(o.x),Math.abs(c.x))+Math.max(Math.abs(o.y),Math.abs(c.y))+Math.max(Math.abs(o.z),Math.abs(c.z))),{min:d,max:_}}computeInitialHull(){const o=this.vertices,c=this.computeExtremes(),d=c.min,_=c.max;let b=0,_e=0;for(let mt=0;mt<3;mt++){const ft=_[mt].point.getComponent(mt)-d[mt].point.getComponent(mt);ft>b&&(b=ft,_e=mt)}const it=d[_e],nt=_[_e];let at,ut;b=0,_line3.set(it.point,nt.point);for(let mt=0,ft=this.vertices.length;mt<ft;mt++){const vt=o[mt];if(vt!==it&&vt!==nt){_line3.closestPointToPoint(vt.point,!0,ConvexHull_closestPoint);const xt=ConvexHull_closestPoint.distanceToSquared(vt.point);xt>b&&(b=xt,at=vt)}}b=-1,ConvexHull_plane.setFromCoplanarPoints(it.point,nt.point,at.point);for(let mt=0,ft=this.vertices.length;mt<ft;mt++){const vt=o[mt];if(vt!==it&&vt!==nt&&vt!==at){const xt=Math.abs(ConvexHull_plane.distanceToPoint(vt.point));xt>b&&(b=xt,ut=vt)}}const pt=[];if(ConvexHull_plane.distanceToPoint(ut.point)<0){pt.push(Face.create(it,nt,at),Face.create(ut,nt,it),Face.create(ut,at,nt),Face.create(ut,it,at));for(let mt=0;mt<3;mt++){const ft=(mt+1)%3;pt[mt+1].getEdge(2).setTwin(pt[0].getEdge(ft)),pt[mt+1].getEdge(1).setTwin(pt[ft+1].getEdge(0))}}else{pt.push(Face.create(it,at,nt),Face.create(ut,it,nt),Face.create(ut,nt,at),Face.create(ut,at,it));for(let mt=0;mt<3;mt++){const ft=(mt+1)%3;pt[mt+1].getEdge(2).setTwin(pt[0].getEdge((3-mt)%3)),pt[mt+1].getEdge(0).setTwin(pt[ft+1].getEdge(1))}}for(let mt=0;mt<4;mt++)this.faces.push(pt[mt]);for(let mt=0,ft=o.length;mt<ft;mt++){const vt=o[mt];if(vt!==it&&vt!==nt&&vt!==at&&vt!==ut){b=this.tolerance;let xt=null;for(let At=0;At<4;At++){const Ct=this.faces[At].distanceToPoint(vt.point);Ct>b&&(b=Ct,xt=this.faces[At])}xt!==null&&this.addVertexToFace(vt,xt)}}return this}reindexFaces(){const o=[];for(let c=0;c<this.faces.length;c++){const d=this.faces[c];d.mark===Visible&&o.push(d)}return this.faces=o,this}nextVertexToAdd(){if(this.assigned.isEmpty()===!1){let o,c=0;const d=this.assigned.first().face;let _=d.outside;do{const b=d.distanceToPoint(_.point);b>c&&(c=b,o=_),_=_.next}while(_!==null&&_.face===d);return o}}computeHorizon(o,c,d,_){let b;this.deleteFaceVertices(d),d.mark=Deleted,b=c===null?c=d.getEdge(0):c.next;do{const _e=b.twin,it=_e.face;it.mark===Visible&&(it.distanceToPoint(o)>this.tolerance?this.computeHorizon(o,_e,it,_):_.push(b)),b=b.next}while(b!==c);return this}addAdjoiningFace(o,c){const d=Face.create(o,c.tail(),c.head());return this.faces.push(d),d.getEdge(-1).setTwin(c.twin),d.getEdge(0)}addNewFaces(o,c){this.newFaces=[];let d=null,_=null;for(let b=0;b<c.length;b++){const _e=c[b],it=this.addAdjoiningFace(o,_e);d===null?d=it:it.next.setTwin(_),this.newFaces.push(it.face),_=it}return d.next.setTwin(_),this}addVertexToHull(o){const c=[];return this.unassigned.clear(),this.removeVertexFromFace(o,o.face),this.computeHorizon(o.point,null,o.face,c),this.addNewFaces(o,c),this.resolveUnassignedPoints(this.newFaces),this}cleanup(){return this.assigned.clear(),this.unassigned.clear(),this.newFaces=[],this}compute(){let o;for(this.computeInitialHull();(o=this.nextVertexToAdd())!==void 0;)this.addVertexToHull(o);return this.reindexFaces(),this.cleanup(),this}}class Face{constructor(){this.normal=new three_module.Pq0,this.midpoint=new three_module.Pq0,this.area=0,this.constant=0,this.outside=null,this.mark=Visible,this.edge=null}static create(o,c,d){const _=new Face,b=new HalfEdge(o,_),_e=new HalfEdge(c,_),it=new HalfEdge(d,_);return b.next=it.prev=_e,_e.next=b.prev=it,it.next=_e.prev=b,_.edge=b,_.compute()}getEdge(o){let c=this.edge;for(;o>0;)c=c.next,o--;for(;o<0;)c=c.prev,o++;return c}compute(){const o=this.edge.tail(),c=this.edge.head(),d=this.edge.next.head();return _triangle.set(o.point,c.point,d.point),_triangle.getNormal(this.normal),_triangle.getMidpoint(this.midpoint),this.area=_triangle.getArea(),this.constant=this.normal.dot(this.midpoint),this}distanceToPoint(o){return this.normal.dot(o)-this.constant}}class HalfEdge{constructor(o,c){this.vertex=o,this.prev=null,this.next=null,this.twin=null,this.face=c}head(){return this.vertex}tail(){return this.prev?this.prev.vertex:null}length(){const o=this.head(),c=this.tail();return c!==null?c.point.distanceTo(o.point):-1}lengthSquared(){const o=this.head(),c=this.tail();return c!==null?c.point.distanceToSquared(o.point):-1}setTwin(o){return this.twin=o,o.twin=this,this}}class VertexNode{constructor(o){this.point=o,this.prev=null,this.next=null,this.face=null}}class VertexList{constructor(){this.head=null,this.tail=null}first(){return this.head}last(){return this.tail}clear(){return this.head=this.tail=null,this}insertBefore(o,c){return c.prev=o.prev,c.next=o,c.prev===null?this.head=c:c.prev.next=c,o.prev=c,this}insertAfter(o,c){return c.prev=o,c.next=o.next,c.next===null?this.tail=c:c.next.prev=c,o.next=c,this}append(o){return this.head===null?this.head=o:this.tail.next=o,o.prev=this.tail,o.next=null,this.tail=o,this}appendChain(o){for(this.head===null?this.head=o:this.tail.next=o,o.prev=this.tail;o.next!==null;)o=o.next;return this.tail=o,this}remove(o){return o.prev===null?this.head=o.next:o.prev.next=o.next,o.next===null?this.tail=o.prev:o.next.prev=o.prev,this}removeSubList(o,c){return o.prev===null?this.head=c.next:o.prev.next=c.next,c.next===null?this.tail=o.prev:c.next.prev=o.prev,this}isEmpty(){return this.head===null}}class ConvexGeometry extends three_module.LoY{constructor(o=[]){super();const c=[],d=[],_=new ConvexHull_ConvexHull().setFromPoints(o).faces;for(let b=0;b<_.length;b++){const _e=_[b];let it=_e.edge;do{const nt=it.head().point;c.push(nt.x,nt.y,nt.z),d.push(_e.normal.x,_e.normal.y,_e.normal.z),it=it.next}while(it!==_e.edge)}this.setAttribute("position",new three_module.qtW(c,3)),this.setAttribute("normal",new three_module.qtW(d,3))}}var PosePlugin_decorate=function(h,o,c,d){var _,b=arguments.length,_e=b<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_e=Reflect.decorate(h,o,c,d);else for(var it=h.length-1;it>=0;it--)(_=h[it])&&(_e=(b<3?_(_e):b>3?_(o,c,_e):_(o,c))||_e);return b>3&&_e&&Object.defineProperty(o,c,_e),_e};let PosePlugin=class extends AViewerPlugin{constructor(){super(),this._debug=!1,this.enabled=!0,this.toJSON=void 0,this.autoUpdateGround=!0}computeStablePoses(h){var o,c;const d=new ConvexHull_ConvexHull().setFromObject(h),_=this._computeCOM(d),b=new three_module.Pq0,_e=new three_module.Pq0,it=new three_module.Pq0,nt=new three_module.Pq0,at=[];for(const ut of d.faces){this._getFaceData(ut,b,_e,it,nt);const pt=new three_module.Pq0().copy(b),mt=this._project(_,b,_e,it,nt),ft=this._constructRotationTransform(_,mt,nt),vt=new three_module.kn4().copy(ft).invert(),xt=new three_module.Pq0().copy(_);xt.applyMatrix4(vt),b.applyMatrix4(vt),_e.applyMatrix4(vt),it.applyMatrix4(vt);const At=new three_module.I9Y(xt.x,xt.y),Ct=new three_module.I9Y(b.x,b.y),Et=new three_module.I9Y(_e.x,_e.y),Tt=new three_module.I9Y(it.x,it.y),kt=this._pointInTriangle(At,Ct,Et,Tt);if(kt>0){const Dt=this._triArea(b,_e,it),zt=this._getMaxEdgeData(b,_e,it),Bt=this._constructRotationTransform(_,mt,nt,zt.edgeVector);at.push({distance:kt,faceNormal:nt,area:Dt,face:ut,maxEdgeLength:zt.maxEdgeLength,xform:Bt,edgePoint:pt})}}return at.sort((ut,pt)=>pt.maxEdgeLength-ut.maxEdgeLength),this._debug&&this._createDebugMeshes(_,d),h._stablePoses=at,h._poseIndex=-1,(c=(o=h.uiConfig)===null||o===void 0?void 0:o.uiRefresh)===null||c===void 0||c.call(o,"postFrame",!0),at}setMostStablePose(h){return this.setPose(h,0)}setVerticalPose(h){if(h._stablePoses||this.computeStablePoses(h),h._stablePoses)return this.setPose(h,h._stablePoses.length-1)}setNextPose(h){var o;return this.setPose(h,((o=h._poseIndex)!==null&&o!==void 0?o:-1)+1)}setPreviousPose(h){return this.setPose(h,(h._poseIndex||0)-1)}setOriginalPose(h){delete h._poseIndex,h._stablePoses||this.computeStablePoses(h),h._stablePoses&&this._syncPose(h,!0)}clearPoses(h){var o,c,d,_,b;delete h._stablePoses,delete h._poseIndex,delete h._originalXform,(_=(d=(c=(o=this._viewer)===null||o===void 0?void 0:o.getPlugin(PickingPlugin))===null||c===void 0?void 0:c.uiConfig)===null||d===void 0?void 0:d.uiRefresh)===null||_===void 0||_.call(d,"postFrame",!0),(b=this._viewer)===null||b===void 0||b.setDirty()}setPose(h,o){var c;if(h._stablePoses||this.computeStablePoses(h),!h._stablePoses)return;const d=(c=h._poseIndex)!==null&&c!==void 0?c:-1;return o<0&&(o=h._stablePoses.length-1),o>h._stablePoses.length-1&&(o=0),o!==d?(h._poseIndex=o,this._syncPose(h),()=>d<0?this.setOriginalPose(h):this.setPose(h,d)):void 0}async onAdded(h){await super.onAdded(h),h.scene.addEventListener("addSceneObject",o=>{var c;const d=(c=o.object)===null||c===void 0?void 0:c.modelObject;if(!d)return;const _=d.uiConfig;_&&Array.isArray(_.children)&&_.children.push({type:"folder",label:"Poses",children:[{type:"button",label:"Compute Poses",hidden:()=>!!d._stablePoses,value:()=>this.computeStablePoses(d)},{type:"button",label:"Original Pose",hidden:()=>!d._stablePoses,value:()=>this.setOriginalPose(d)},{type:"button",label:"Stable Pose",hidden:()=>!d._stablePoses,value:()=>this.setMostStablePose(d)},{type:"button",label:"Vertical Pose",hidden:()=>!d._stablePoses,value:()=>this.setVerticalPose(d)},{type:"button",label:"Next Pose",hidden:()=>!d._stablePoses,value:()=>this.setNextPose(d)},{type:"button",label:"Previous Pose",hidden:()=>!d._stablePoses,value:()=>this.setPreviousPose(d)},{type:"button",label:"Clear Poses",hidden:()=>!d._stablePoses,value:()=>this.clearPoses(d)}]})})}_getMaxEdgeData(h,o,c){const d=h.distanceTo(o),_=o.distanceTo(c),b=c.distanceTo(h);let _e=d;const it=new three_module.Pq0;return d>_?d>b?(_e=d,it.copy(o).sub(h).normalize()):(_e=b,it.copy(h).sub(c).normalize()):_>b?(_e=_,it.copy(c).sub(o).normalize()):(_e=b,it.copy(h).sub(c).normalize()),{maxEdgeLength:_e,edgeVector:it,edgePoint:new three_module.Pq0().copy(h)}}_getFaceData(h,o,c,d,_){let b=h.edge,_e=b.head().point;o.set(_e.x,_e.y,_e.z),b=b.next,_e=b.head().point,c.set(_e.x,_e.y,_e.z),b=b.next,_e=b.head().point,d.set(_e.x,_e.y,_e.z),_==null||_.copy(h.normal)}_computeCOM(h){const o=new three_module.Pq0,c=new three_module.Pq0,d=new three_module.Pq0,_=new three_module.Pq0,b=new three_module.Pq0;let _e=0;for(const it of h.faces){this._getFaceData(it,c,d,_),b.set(0,0,0),b.add(c).add(d).add(_).multiplyScalar(1/3),d.sub(c),_.sub(c);const nt=.5*d.cross(_).length();_e+=nt,b.multiplyScalar(nt),o.add(b)}return o.multiplyScalar(1/_e),o}_sign(h,o,c){return(h.x-c.x)*(o.y-c.y)-(o.x-c.x)*(h.y-c.y)}_shortestDistance(h,o,c){const d=new three_module.I9Y(o.y-c.y,c.x-o.x).normalize(),_=new three_module.I9Y().copy(o).sub(h);return Math.abs(_.dot(d))}_pointInTriangle(h,o,c,d){const _=this._sign(h,o,c),b=this._sign(h,c,d),_e=this._sign(h,d,o);if(!(_<0||b<0||_e<0)||!(_>0||b>0||_e>0)){const it=this._shortestDistance(h,o,c),nt=this._shortestDistance(h,c,d),at=this._shortestDistance(h,d,o);return Math.min(Math.min(it,nt),at)}return-1}_project(h,o,c,d,_){const b=new three_module.Pq0().copy(_),_e=new three_module.Pq0().copy(o).sub(h).dot(b);_e<0&&b.negate();const it=Math.abs(_e);return new three_module.Pq0().copy(h).addScaledVector(b,it)}_constructRotationTransform(h,o,c,d){const _=new three_module.Pq0().copy(c),b=new three_module.Pq0().copy(o).sub(h).dot(_);b>0&&_.negate();const _e=new three_module.Pq0().copy(o).addScaledVector(_,Math.abs(b)),it=d===void 0?new three_module.Pq0(1,1,0):d;return new three_module.kn4().lookAt(o,_e,it)}_triArea(h,o,c){const d=new three_module.Pq0().copy(o).sub(h),_=new three_module.Pq0().copy(c).sub(h);return .5*d.cross(_).length()}_createTriangleMesh(){const h=new three_module.LoY,o=new three_module.V9B({color:16711680,side:three_module.$EB});return new three_module.eaF(h,o)}_updateTriangleMesh(h){var o;this._triMesh.geometry.setAttribute("position",new three_module.THS(h,3)),(o=this._viewer)===null||o===void 0||o.setDirty()}_syncPose(h,o=!1){var c,d,_,b,_e,it,nt,at;if(h._stablePoses===void 0||h._stablePoses.length==0)return;const ut=new three_module.kn4;if(!o){ut.lookAt(new three_module.Pq0,new three_module.Pq0(0,1,0),new three_module.Pq0(0,0,1));const mt=h._stablePoses[h._poseIndex||0].xform,ft=new three_module.kn4().copy(mt).invert();ut.multiply(ft)}if(h._originalXform){const mt=new three_module.Pq0,ft=new three_module.PTz,vt=new three_module.Pq0;h._originalXform.decompose(mt,ft,vt),h.position.copy(mt),h.quaternion.copy(ft),h.scale.copy(vt)}else h._originalXform=new three_module.kn4().copy(h.matrix);h.applyMatrix4(ut);const pt=(c=this._viewer)===null||c===void 0?void 0:c.getPlugin(GroundPlugin);if(this.autoUpdateGround)(d=this._viewer)===null||d===void 0||d.scene.setDirty({sceneUpdate:!0}),pt.enableRefreshTransform=!0;else if(!o){const mt=h._stablePoses[h._poseIndex||0].edgePoint,ft=new three_module.Pq0().copy(mt);ft.applyMatrix4(ut);const vt=ft.y-pt.shadowBaker.attachedMesh.position.y;h.position.y-=vt}(_=this._viewer)===null||_===void 0||_.setDirty(),(b=this._viewer)===null||b===void 0||b.renderer.resetShadows(),pt==null||pt.bakeShadows(),(at=(it=(_e=this._viewer)===null||_e===void 0?void 0:_e.getPlugin(PickingPlugin))===null||it===void 0?void 0:(nt=it.uiConfig).uiRefresh)===null||at===void 0||at.call(nt,"postFrame",!0)}async _createDebugMeshes(h,o){var c;const d=[];for(const ut of o.vertices)d.push(new three_module.Pq0(ut.point.x,ut.point.y,ut.point.z));const _=new ConvexGeometry(d),b=new three_module.XJ7(_),_e=new three_module.DXC(b);_e.material.opacity=.25,_e.material.transparent=!0,this._triMesh=this._createTriangleMesh();const it=new three_module.Gu$(.025),nt=new three_module.eaF(it,new three_module.uSd({color:16776960}));nt.position.copy(h);const at=(await((c=this._viewer)===null||c===void 0?void 0:c.createObject3D(void 0,!0))).modelObject;return at.add(this._triMesh),at.add(_e),at.add(nt),at}};PosePlugin.PluginType="PosePlugin",PosePlugin_decorate([uiToggle()],PosePlugin.prototype,"autoUpdateGround",void 0),PosePlugin=PosePlugin_decorate([uiFolder("Pose Plugin")],PosePlugin);var tweakpane_image_plugin=__webpackgi_require__(282),tweakpane=__webpackgi_require__(578);const tweakpaneCheckParent=(h,o)=>o.controller_.rackController.rack===h.controller_.parent,tweakPaneMoveToParentIndex=(h,o,c)=>{var d,_;const b=h.controller_,_e=(_=(d=b.parent)===null||d===void 0?void 0:d.children)===null||_===void 0?void 0:_.indexOf(b);return!(tweakpaneCheckParent(h,o)&&_e===c||(o.add(h,c),0))},tpFolderGenerator=(h,o,c,d)=>{var _,b,_e,it,nt;let at=o.uiRef;at!=null&&at.controller_.viewProps.get("disposed")&&(at=void 0);const ut=at==null?void 0:at.expanded;if(!at){const At=h.addFolder({title:""});at=At,at.on("fold",Ct=>{var Et,Tt,kt,Dt;let zt=At.expanded;S$2(o,"expanded",zt,!0),zt=(Et=Ee$1(o.expanded))!==null&&Et!==void 0?Et:zt,zt!==At.expanded&&(At.expanded=zt),(Tt=o.uiRefresh)===null||Tt===void 0||Tt.call(o,"postFrame",!0,10),zt?(kt=o.onExpand)===null||kt===void 0||kt.call(o,o):(Dt=o.onCollapse)===null||Dt===void 0||Dt.call(o,o)})}if(!at)return at;at.expanded=(b=(_=Ee$1(o.expanded))!==null&&_!==void 0?_:ut)!==null&&b!==void 0&&b;const pt=((_e=o.children)!==null&&_e!==void 0?_e:[]).map(At=>At&&Ee$1(At)).flat(2).filter(At=>At);let mt=0;for(const At of pt){if(Array.isArray(At)||typeof At!="object"){console.error("child is not an object",At);continue}let Ct=At.uiRef;Ct&&Ct.controller_.viewProps.get("disposed")&&(At.uiRef=void 0,At.uiRefresh=void 0),Ct=At.uiRef,Ct||(c.appendUiObject({uiConfig:At},at),Ct=At.uiRef),Ct&&tweakPaneMoveToParentIndex(Ct,at,mt++)&&c.appendUiObject({uiConfig:At},at)}let ft=at.children;for(;ft.length>mt;){const At=ft[ft.length-1];at.remove(At),At.dispose(),ft=at.children}at.controller_.props.set("title",(it=Ee$1(o.label))!==null&&it!==void 0?it:"");const vt=at.controller_.view.containerElement,xt=Ee$1(o.domChildren,[]);if((xt==null?void 0:xt.length)!==void 0){const At=[];for(let Ct=0;Ct<vt.children.length;Ct++){const Et=vt.children[Ct];!((nt=Et.dataset)===null||nt===void 0)&&nt.tpCustomDOM&&At.push(Et)}for(const Ct of At)vt.removeChild(Ct);for(const Ct of xt)Ct.parentElement!==vt&&(vt.appendChild(Ct),Ct.dataset.tpCustomDOM="true");at.controller_.foldable.cleanUpTransition()}return at},tpButtonInputGenerator=(h,o,c,d)=>{var _,b;const[_e,it]=(_=o.property)!==null&&_!==void 0?_:[void 0,void 0],nt=(b=Ee$1(o.label))!==null&&b!==void 0?b:it;let at=o.uiRef;return at!=null&&at.controller_.viewProps.get("disposed")&&(at=void 0),at||(at=h.addButton({title:""}),at.on("click",async()=>{const ut=[];o.prompt&&ut.push(await c.prompt(...o.prompt));let pt=_e&&it?_e[it]:void 0,mt=_e;if(pt||(pt=o.value,mt=o),typeof pt=="function"){const ft=()=>{var vt;c.removeEventListener("postFrame",ft);const xt=pt.call(mt??o,...ut);typeof xt=="function"&&((vt=c.undoManager)===null||vt===void 0||vt.record({undo:()=>{var At;xt.call(mt??o,...ut),(At=o.uiRefresh)===null||At===void 0||At.call(o,void 0,!1)},redo:()=>{var At;pt.call(mt??o,...ut),(At=o.uiRefresh)===null||At===void 0||At.call(o,void 0,!1)}}))};c.addEventListener("postFrame",ft)}else console.warn("uiconfig.js: Invalid action type for button")})),at&&(at.title=(nt??"click me")+""),at},tpDropdownInputGenerator=(h,o,c,d)=>{var _;const b=Object.fromEntries(((_=Ee$1(o.children))!==null&&_!==void 0?_:[]).map(_e=>Ee$1(_e)).flat(2).filter(_e=>_e).map(_e=>{var it;const nt=Ee$1(_e.label);return[nt,(it=_e.value)!==null&&it!==void 0?it:nt]}));return tpInputGenerator(h,o,c,{options:b,...d??{}})},tpSliderInputGenerator=(h,o,c,d)=>{var _,b;const _e=Ee$1(o.bounds),it=((_=_e==null?void 0:_e.length)!==null&&_!==void 0?_:0)>=2?_e[1]:1,nt=((b=_e==null?void 0:_e.length)!==null&&b!==void 0?b:0)>=1?_e[0]:0,at=o.stepSize||void 0;return tpInputGenerator(h,o,c,{min:nt,max:it,step:at,...d??{}})},tpVecInputGenerator=(h,o,c,d)=>{var _,b,_e;const it=Ee$1(o.bounds);if(!it||it.length<1)return tpInputGenerator(h,o,c,{...d??{}});const nt=((_=it.length)!==null&&_!==void 0?_:0)>=2?it[1]:1,at=((b=it.length)!==null&&b!==void 0?b:0)>=1?it[0]:0,ut={min:at,max:nt,step:(_e=o.stepSize)!==null&&_e!==void 0?_e:(nt-at)/100},pt={x:ut,y:ut};o.type!=="vec3"&&o.type!=="vec4"||(pt.z=ut),o.type==="vec4"&&(pt.w=ut);const mt=o.property;if(o.value===void 0&&mt&&mt[0]&&typeof mt[0]=="object"&&mt[0][mt[1]]&&Array.isArray(mt[0][mt[1]])){const[ft,vt]=mt,xt=ft[vt],At=xt.length,Ct=new(At===2?three_module.I9Y:At===3?three_module.Pq0:three_module.IUQ)().fromArray(xt);o.value=Ct,o.property=void 0,o.onChange=[()=>{ft[vt]=Ct.toArray()},...Array.isArray(o.onChange)?o.onChange:[o.onChange]].filter(Et=>Et),o.label===void 0&&(o.label=vt)}return tpInputGenerator(h,o,c,{...pt,...d??{}})},tpColorInputGenerator=(h,o,c,d)=>{var _;const b=o.property;if(o.value===void 0&&b&&typeof b[0]=="object"&&!((_=b[0][b[1]])===null||_===void 0)&&_.isColor){const[_e,it]=b,nt=three_module.er$;Object.defineProperty(o,"value",{get:()=>{const at=_e[it];return at?new three_module.Q1f(at).getHex(nt):0},set:at=>{const ut=_e[it],pt=new three_module.Q1f().setHex(at,nt);ut.isColor?ut.copy(pt):typeof ut=="number"?_e[it]=pt.getHex():typeof ut=="string"&&(_e[it]="#"+pt.getHexString()),typeof(_e==null?void 0:_e.setDirty)=="function"&&_e.setDirty()}}),o.property=void 0,o.onChange=[...Array.isArray(o.onChange)?o.onChange:[o.onChange]].filter(at=>at),o.label===void 0&&(o.label=it+"")}return(d=d??{}).view="color",Ee$1(o.inlinePicker)&&(d.picker="inline"),tpInputGenerator(h,o,c,d)},tpInputGenerator=(h,o,c,d)=>{var _,b,_e,it,nt,at,ut;let pt=Ee$1(o.property);if((o.getValue||o.setValue)&&pt&&console.error("specify either property or value, or getValue and setValue",o),pt)o.value&&console.warn("uiconfig.js: Both property and value are defined, value will be ignored",o);else if((Object.hasOwn?Object.hasOwn(o,"value"):o.hasOwnProperty("value"))||o.value!==void 0||!o.getValue&&!o.setValue||(Object.defineProperty(o,"value",{get:()=>{var xt;return(xt=o.getValue)===null||xt===void 0?void 0:xt.call(o)},set:xt=>{var At;return(At=o.setValue)===null||At===void 0?void 0:At.call(o,xt)}}),pt=[o,"value"]),pt||o.value===void 0||(pt=[o,"value"]),!pt)return void console.error("cannot determine property",o);d=d??{};const mt={label:(_=Ee$1(o.label))!==null&&_!==void 0?_:pt[1],...d};let ft=o.uiRef;ft!=null&&ft.controller_.viewProps.get("disposed")&&(ft=void 0);let vt=!1;if(!ft&&typeof pt[0]=="object"&&pt[0]){const[xt,At]=pt;try{if(o.isMonitor)ft=h.addMonitor(xt,At,mt);else{const Ct={tar:xt,key:At,__v:cloneVar(xt[At])};Ct.lastUndoVal=cloneVar(Ct.__v),Object.defineProperty(Ct,At,{get:()=>Ct.__v,set:kt=>{Ct.__v=kt}});const Et=kt=>{var Dt;[o.onChange].flat().forEach(zt=>typeof zt=="function"&&(zt==null?void 0:zt(kt))),typeof((Dt=Ct.tar)===null||Dt===void 0?void 0:Dt.setDirty)=="function"&&Ct.tar.setDirty(kt)},Tt=kt=>{var Dt,zt;const Bt=Ct.tar[Ct.key];let Rt=Ct.__v;const Ut=compare(Bt,Rt);if((!Ut||kt.last)&&(Ut||(copyVal(Ct.tar,Ct.key,Rt),Et(kt)),kt.last)){let Ht=Ct.lastUndoVal,Jt=!1;if(typeof Rt=="string"&&Rt.length>1e5&&(Jt=!0),typeof Ht=="string"&&Ht.length>1e5&&(Jt=!0),!(Jt||Rt instanceof HTMLImageElement)){const Kt=compare(Ht,Rt);!((Dt=c.undoManager)===null||Dt===void 0)&&Dt.options.debug&&console.log("onchange",Ht,Rt,Kt),Kt||(Rt=cloneVar(Rt),Ht=cloneVar(Ht),(zt=c.undoManager)===null||zt===void 0||zt.record({undo:()=>{var sr;copyVal(Ct.tar,Ct.key,Ht),Et({...kt,value:Ht}),(sr=o.uiRefresh)===null||sr===void 0||sr.call(o,void 0,!1)},redo:()=>{var sr;copyVal(Ct.tar,Ct.key,Rt),Et(kt),(sr=o.uiRefresh)===null||sr===void 0||sr.call(o,void 0,!1)}}),copyVal(Ct,"lastUndoVal",Rt))}}};ft=h.addInput(Ct,At,mt).on("change",Tt),ft.__proxy1=Ct,vt=!0}}catch(Ct){if(!Ct.message.startsWith("No matching controller for"))throw Ct;ft=void 0}}if(ft){for(const[xt,At]of Object.entries(mt)){const Ct=ft.controller_;let Et=Ct.props.value(xt);if(Et!==void 0)Et.rawValue!==At&&ft.controller_.props.set(xt,At);else{const Tt=Ct.valueController;Et=(_e=(b=Tt.props)===null||b===void 0?void 0:b.value)===null||_e===void 0?void 0:_e.call(b,xt);let kt=At;const Dt=Et==null?void 0:Et.rawValue;let zt=!1;xt==="options"&&typeof kt=="object"&&!Array.isArray(kt)&&Array.isArray(Dt)&&(kt=Object.entries(kt).map(([Bt,Rt])=>({text:Bt,value:Rt})),zt=!0),Et===void 0||Dt===kt||zt&&ft.__lastOptions===At||(Tt.props.set(xt,kt),zt&&((nt=(it=Tt.view)===null||it===void 0?void 0:it.update_)===null||nt===void 0||nt.call(it),ft.__lastOptions=At))}}if(o.type==="slider"&&(mt.min!==void 0&&ft.controller_.valueController.sliderController.props.set("minValue",mt.min),mt.max!==void 0&&ft.controller_.valueController.sliderController.props.set("maxValue",mt.max)),(at=(ft==null?void 0:ft.controller_.valueController.view).inputElement)===null||at===void 0||at.setAttribute("placeholder",(ut=Ee$1(o.placeholder))!==null&&ut!==void 0?ut:""),ft.__proxy1&&!vt){const xt=ft.__proxy1,[At,Ct]=pt;xt.tar=At,xt.key=Ct;const Et=At[Ct];copyVal(xt,"__v",Et),copyVal(xt,"lastUndoVal",Et)}ft.refresh()}return ft};function compare(h,o){return typeof h==typeof o&&(typeof h=="object"||Array.isArray(h)?Array.isArray(h)?h.length===o.length&&h.every((c,d)=>compare(c,o[d])):typeof h.equals=="function"?!!h.equals(o):h.toArray&&o.toArray?compare(h.toArray(),o.toArray()):h===o:h===o)}function cloneVar(h){return typeof h=="object"&&h?Array.isArray(h)?[...h]:h.isObject3D||h.isMaterial?h:typeof h.clone=="function"?h.clone():h:h}function copyVal(h,o,c){typeof c.copy=="function"&&h[o]?h[o].copy(c):h[o]=cloneVar(c)}class TweakpaneWrapper extends I$2{constructor(o=!1,c=!1,d=!1,_=!0,b=document.body){super(),this._refreshQueue={preRender:[],postRender:[],preFrame:[],postFrame:[]},this._lastModeTime={preRender:0,postRender:0,preFrame:0,postFrame:0},this._typeGenerators={panel:tpFolderGenerator,folder:tpFolderGenerator,input:tpInputGenerator,number:tpInputGenerator,slider:tpSliderInputGenerator,dropdown:tpDropdownInputGenerator,checkbox:tpInputGenerator,color:tpColorInputGenerator,vec:tpVecInputGenerator,vec2:tpVecInputGenerator,vec3:tpVecInputGenerator,vec4:tpVecInputGenerator,button:tpButtonInputGenerator,monitor:(it,nt,at,ut)=>(nt.isMonitor=!0,tpInputGenerator(it,nt,at,ut)),dummy:(it,nt,at,ut)=>tpInputGenerator(it,nt,at,ut)},this.undoManager=new Q$2({bindHotKeys:!0,limit:100,debug:!1}),this.alert=this.alert.bind(this),this.confirm=this.confirm.bind(this),this.prompt=this.prompt.bind(this),this._expand=o,this._limitedOptions=d;const _e=this._createUiContainer();b.appendChild(_e),this._container=b,this._pane=new tweakpane.Pane({title:"Configuration",container:_e}),this._pane.expanded=this._expand,_&&(this.addEventListener("postFrame",()=>this.refreshQueue("postFrame")),setTimeout(()=>{this.dispatchEvent({type:"postFrame"})},32))}refreshQueue(o){const c=this._refreshQueue[o],d=[],_=g(),b=_-this._lastModeTime[o];c.forEach(_e=>{_e[2]>.001?(_e[2]-=b,d.push(_e)):this._refreshUiObject(_e[0],_e[1],_e[2])}),this._refreshQueue[o]=d,this._lastModeTime[o]=_}addToRefreshQueue(o,c){var d;const _=(d=c[0])===null||d===void 0?void 0:d.uiConfig,b=_==null?void 0:_.uuid,_e=this._refreshQueue[o],it=_e.find(nt=>nt[3]===b);it?it[2]=Math.max(it[2],c[2]):_e.push([...c,b]),this._refreshQueue[o]=_e}dispose(){var o;(o=this._pane)===null||o===void 0||o.dispose(),this._pane=void 0}appendUiObject(o,c){o&&this._appendUiObject(o,c)}appendChild(o){this.appendUiObject({uiConfig:o})}_appendUiObject(o,c){var d,_,b,_e;const{uiConfig:it}=o??{};if(it&&(!this._limitedOptions||it.limitedUi)&&(c=c??this._pane,it.type)){it.uuid||(it.uuid=esm_browser_v4()),it.uiRef&&it.uiRefType!==it.type&&this.removeUiConfig(it);const nt=(_=(d=this._typeGenerators)[it.type])===null||_===void 0?void 0:_.call(d,c,it,this);nt&&(nt.hidden=(b=Ee$1(it.hidden))!==null&&b!==void 0&&b,nt.disabled=(_e=Ee$1(it.disabled))!==null&&_e!==void 0&&_e),it.uiRef=nt,it.uiRefType=nt?it.type:void 0,it.uiRefresh=(at="postFrame",ut=!1,pt=0)=>{var mt;return this._uiObjectRefresh(at,(mt=o==null?void 0:o.uiConfig)!==null&&mt!==void 0?mt:it,c,ut,pt)},nt==null||nt.controller_.viewProps.handleDispose(()=>{it.uiRef=void 0,it.uiRefType=void 0,it.uiRefresh=void 0})}}removeUiObject(o){this.removeUiConfig(o==null?void 0:o.uiConfig)}removeUiConfig(o){var c,d;o&&o.uiRef&&((d=(c=o.uiRef).dispose)===null||d===void 0||d.call(c),o.uiRef=void 0,o.uiRefType=void 0,o.uiRefresh=void 0)}_uiObjectRefresh(o,c,d,_,b){(_?flattenUiConfig(c,d):[{uiConfig:c,parentFolder:d}]).forEach(_e=>{const it=[{uiConfig:_e.uiConfig},_e.parentFolder,b];o==="immediate"?this._refreshUiObject(...it):this.addToRefreshQueue(o,it)})}_refreshUiObject(o,c,d=0){this._appendUiObject(o,c),d>1e-4&&console.error("no support for immediate delay")}_createUiContainer(){const o=ee$1({id:"tweakpaneUiContainer",addToBody:!1});return P$2($`
          :root{
            --tweakpane-ui-container-width: 300px;
          }
          @media only screen and (min-width: 1500px) {
            :root{
              --tweakpane-ui-container-width: 300px;
            }
          }
          @media only screen and (min-width: 2500px) {
            :root{
              --tweakpane-ui-container-width: 500px;
            }
          }
          #tweakpaneUiContainer {
            position: fixed;
            top: 0px;
            padding-right: 4px;
            padding-bottom: 10px;
            right: 10px;
            width: var(--tweakpane-ui-container-width);
            height: auto;
            overflow-y: scroll;
            z-index: 100;
            pointer-events: auto;
            max-height: calc(100% - 6rem);
            border-radius: 0.5rem;
            font-family: Inter, ui-sans-serif, system-ui, -apple-system, "system-ui", "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
          }
        `),o}async alert(o){return alert(o)}async confirm(o){return confirm(o)}async prompt(o,c,d=!0){return prompt(o,c)}}function flattenUiConfig(h,o,c){return c=c??[],h&&h.uiRef&&(c.push({uiConfig:h,parentFolder:o}),typeof h.children=="function"||[...h.children||[]].forEach(d=>{typeof d!="function"&&d&&(Array.isArray(d)?d.forEach(_=>c=flattenUiConfig(_,h.uiRef,c)):c=flattenUiConfig(d,h.uiRef,c))})),c}const tpImageInputGenerator=h=>(o,c,d,_)=>{let b=c.property||c.__property;const _e="placeholder";c.value===void 0&&(c.getValue||c.setValue)&&(Object.defineProperty(c,"_value",{get:()=>{var at;return(at=c.getValue)===null||at===void 0?void 0:at.call(c)},set:at=>{var ut;return(ut=c.setValue)===null||ut===void 0?void 0:ut.call(c,at)}}),b=[c,"_value"]);const[it,nt]=b&&typeof b[0]=="object"?b:[c,"value"];if((!(Object.hasOwn?Object.hasOwn(c,"value"):c.hasOwnProperty("value"))||c.value===void 0)&&b&&typeof b[0]=="object"){const at=Xe$1("Render Target"),ut=Xe$1("Data Texture"),pt=Xe$1("CUBE Texture"),mt=Xe$1("Compressed Texture"),ft={},vt={};Object.defineProperty(c,"value",{get:()=>{var xt;let At,Ct=it[nt];if(Ct!=null&&Ct.get&&(Ct=Ct.get()),!Ct)return _e;if(Ct.isCompressedTexture&&Ct.image&&!Ct.image.tp_src&&(Ct.image.tp_src=mt),Ct.isTexture?(Ct.image&&!Ct.image.tp_src&&(Ct.image instanceof ImageBitmap||Ct.image instanceof HTMLImageElement||Ct.image instanceof HTMLVideoElement)?Ct.image.tp_src=Ne$1(Ct.image,160):Ct.image&&Ct.isRenderTargetTexture&&!Ct.image.tp_src?Ct.__target&&(Ct.tp_src=h.renderer.renderTargetToDataUrl(Ct.__target,void 0,void 0,Array.isArray(Ct.__target.texture)?Ct.__target.texture.indexOf(Ct):void 0)):Ct.image&&!Ct.image.tp_src&&(Ct.image.tp_src=textureToCanvas(Ct,160,!1).toDataURL("image/png",90)),!Ct.isRenderTargetTexture||Ct.image.tp_src||Ct.tp_src||(Ct.image.tp_src=at),Ct.isDataTexture&&Ct.image&&!Ct.image.tp_src&&(Ct.image.tp_src=ut),Ct.image&&(At=Ct.image.tp_src_uuid,At=At?ft[At]:void 0,At||(At=Ct.image.tp_src||Ct.image.src)),Ct.tp_src&&(At=Ct.tp_src)):typeof Ct=="string"?At=Ct:Ct.domainMin?(At=Ct.texture,Ct.texture.image&&!Ct.texture.image.tp_src&&(Ct.texture.image.tp_src=pt),Ct.texture.image&&(At=Ct.texture.image.tp_src_uuid,At=At?ft[At]:void 0,At||(At=Ct.texture.image.tp_src||Ct.texture.image.src))):Ct&&console.error("unknown value",Ct),At||(At=_e),Ct.image&&!Ct.image.tp_src_uuid){const Et=esm_browser_v4();Ct.image.tp_src_uuid=Et,vt[At]=Et}return typeof At=="string"&&(At=(xt=ft[At])!==null&&xt!==void 0?xt:At),At},set:xt=>{var At,Ct,Et,Tt,kt,Dt,zt,Bt,Rt,Ut,Ht,Jt,Kt;const sr=it[nt],ir=lr=>{var hr;it[nt]=lr,lr!=null&&lr.isTexture&&(lr.flipY=lr.isDataTexture?lr.flipY:(hr=sr==null?void 0:sr.flipY)===null||hr===void 0||hr)};if(typeof xt=="string")return void(typeof sr=="string"&&ir(xt));if(!xt)return void(c.value=_e);if(xt.isPlaceholder)return void(sr&&(ir(typeof sr=="string"?"":null),typeof(it==null?void 0:it.setDirty)=="function"&&it.setDirty()));let cr=xt.tp_src_uuid;if(cr||(cr=(At=xt.src)!==null&&At!==void 0?At:xt.tp_src,cr=(Ct=vt[cr])!==null&&Ct!==void 0?Ct:cr,delete vt[cr],xt.tp_src_uuid=cr),cr&&(ft[cr]=xt),typeof sr!="string"){if(!((sr==null?void 0:sr.image)===xt||((Et=sr==null?void 0:sr.image)===null||Et===void 0?void 0:Et.src)===xt.src||((Tt=sr==null?void 0:sr.image)===null||Tt===void 0?void 0:Tt.tp_src)===xt.tp_src&&xt.tp_src!=null||((kt=sr==null?void 0:sr.image)===null||kt===void 0?void 0:kt.tp_src)===xt.src&&xt.src!=null||((Dt=sr==null?void 0:sr.image)===null||Dt===void 0?void 0:Dt.src)===xt.tp_src&&xt.tp_src!=null))if(xt instanceof File){const lr=h==null?void 0:h.getPlugin(AssetManagerPlugin);if(!lr)throw"Viewer or AssetManagerPlugin not found";(zt=lr.importer)===null||zt===void 0||zt.importSingle({file:xt,path:xt.src}).then(hr=>{var dr,pr,ur,xr;if(hr){hr.isDataTexture&&(hr.needsUpdate=!0);const vr=(ur=(pr=(dr=xt.src)===null||dr===void 0?void 0:dr.split("?"))===null||pr===void 0?void 0:pr[0])===null||ur===void 0?void 0:ur.split(".").pop();hr.userData&&(hr.userData.mimeType||(hr.userData.mimeType="image/"+(["jpg","jpeg"].includes(vr)?"jpeg":"png"))),ir(hr),[c.onChange].flat().forEach(Dr=>typeof Dr=="function"&&(Dr==null?void 0:Dr())),typeof(it==null?void 0:it.setDirty)=="function"&&it.setDirty(),(xr=c.uiRefresh)===null||xr===void 0||xr.call(c,"postFrame",!1)}})}else{if(SVGTextureLoader.USE_CANVAS_TEXTURE&&(!((Bt=xt.src)===null||Bt===void 0)&&Bt.endsWith(".svg")||!((Rt=xt.src)===null||Rt===void 0)&&Rt.startsWith("data:image/svg"))){const pr=document.createElement("canvas");SVGTextureLoader.CopyImageToCanvas(pr,xt),xt=pr}const lr=new three_module.gPd(xt);lr.assetType="texture",lr.needsUpdate=!0;const hr=(Jt=(Ht=(Ut=xt.src)===null||Ut===void 0?void 0:Ut.split("?"))===null||Ht===void 0?void 0:Ht[0])===null||Jt===void 0?void 0:Jt.split(".").pop();lr.userData.mimeType||(lr.userData.mimeType="image/"+(["jpg","jpeg"].includes(hr)?"jpeg":"png"));const dr=["normalMap","aoMap","emissiveMap","roughnessMap","metalnessMap","displacementMap","bumpMap","alphaMap"].includes(nt);lr.colorSpace=dr?three_module.Zr2:three_module.er$,lr.wrapS=three_module.GJx,lr.wrapT=three_module.GJx,ir(lr),[c.onChange].flat().forEach(pr=>typeof pr=="function"&&(pr==null?void 0:pr())),typeof(it==null?void 0:it.setDirty)=="function"&&it.setDirty(),(Kt=c.uiRefresh)===null||Kt===void 0||Kt.call(c,"postFrame",!1)}}else ir(cr)}}),c.__property=c.property,c.property=void 0,c.label===void 0&&(c.label=nt)}return(_=_??{}).extensions=[".jpg",".png",".svg",".hdr",".exr",".jpeg",".bmp",".gif",".webp",".cube","ktx2"],_.imageFit===void 0&&(_.imageFit="contain"),_.clickCallback===void 0&&(_.clickCallback=(at,ut)=>{var pt;const mt=at==null?void 0:at.target,ft=mt==null?void 0:mt.getBoundingClientRect();if(!ft)return void ut.click();const vt=c.uiRef.controller_.valueController.value.rawValue,xt=vt===_e||vt!=null&&vt.isPlaceholder?{}:{"remove image":()=>{var Ct;c.uiRef.controller_.valueController.value.setRawValue("");const Et=typeof it[nt]=="string";it[nt]=Et?"":null,[c.onChange].flat().forEach(Tt=>typeof Tt=="function"&&(Tt==null?void 0:Tt())),typeof(it==null?void 0:it.setDirty)=="function"&&it.setDirty(),(Ct=c.uiRefresh)===null||Ct===void 0||Ct.call(c,"postFrame",!1),CustomContextMenu.Remove()},"download image":async()=>{var Ct,Et,Tt;CustomContextMenu.Remove();const kt=it[nt];if(!kt)return;const Dt=(Ct=kt==null?void 0:kt.image)!==null&&Ct!==void 0?Ct:c.uiRef.controller_.valueController.value.rawValue;let zt=kt.__rootBlob?kt.__rootBlob.objectUrl||URL.createObjectURL(kt.__rootBlob):((Et=kt.userData)===null||Et===void 0?void 0:Et.rootPath)||(Dt==null?void 0:Dt.src);Dt&&(Dt instanceof ImageBitmap||Dt instanceof HTMLImageElement||Dt instanceof HTMLVideoElement)&&!zt&&(zt=Ne$1(Dt));let Bt=kt.__rootBlob?kt.__rootBlob.name||"image."+(kt.__rootBlob.ext||"png"):null;if(!zt&&kt.isRenderTargetTexture){const Ut=kt.__target;if(kt.type===three_module.OUM)zt=h.renderer.renderTargetToDataUrl(Ut,"image/png",90,Array.isArray(kt.__target.texture)?kt.__target.texture.indexOf(kt):void 0),Bt="renderTarget.png";else{const Ht=new EXRExporter2().parse(h.renderer.rendererObject,Ut,{textureIndex:Array.isArray(kt.__target.texture)?kt.__target.texture.indexOf(kt):void 0}),Jt=new Blob([Ht],{type:"image/x-exr"});if(!Jt)return void console.error("cannot export render target",Dt,it[nt],it,nt,c);Bt="renderTarget.exr",zt=URL.createObjectURL(Jt)}}if(!zt&&kt.isDataTexture){const Ut=new EXRExporter2().parse(void 0,kt),Ht=new Blob([Ut],{type:"image/x-exr"});if(!Ht)return void console.error("cannot export data texture",Dt,it[nt],it,nt,c);Bt="dataTexture.exr",zt=URL.createObjectURL(Ht)}if(!zt)return void console.error("cannot export image",Dt,it[nt],it,nt,c);const Rt=document.createElement("a");document.body.appendChild(Rt),Rt.style.display="none",Rt.href=zt,Rt.download=Bt||(zt.startsWith("data:")?"image.png":(Tt=zt.split("/").pop())!==null&&Tt!==void 0?Tt:"image.png"),Rt.target="_blank",Rt.click(),document.body.removeChild(Rt)}},At=CustomContextMenu.Create({...xt,"set/replace image":()=>{ut.click(),CustomContextMenu.Remove()},"from url":async()=>{var Ct,Et;let Tt="";if(Tt=await d.prompt("Load texture: Enter Image/Texture URL",Tt,!0),!Tt||!Tt.startsWith("http")&&!Tt.startsWith("data:image"))return Tt!==null&&await d.alert("Loading Image: Invalid URL"),void CustomContextMenu.Remove();Tt=Tt.trim();const kt=it[nt];if(typeof kt=="string")it[nt]=Tt,[c.onChange].flat().forEach(Dt=>typeof Dt=="function"&&(Dt==null?void 0:Dt())),typeof(it==null?void 0:it.setDirty)=="function"&&it.setDirty(),(Ct=c.uiRefresh)===null||Ct===void 0||Ct.call(c,"postFrame",!1);else{const Dt=h==null?void 0:h.getPlugin(AssetManagerPlugin);if(!Dt)throw"Viewer or AssetManagerPlugin not found";(Et=Dt.importer)===null||Et===void 0||Et.importSinglePath(Tt).then(zt=>{var Bt;if(zt){zt.isDataTexture?zt.needsUpdate=!0:zt&&(kt==null?void 0:kt.flipY)!==void 0&&(zt.flipY=kt.flipY);const Rt=["normalMap","aoMap","emissiveMap","roughnessMap","metalnessMap","displacementMap","bumpMap","alphaMap"].includes(nt);zt.colorSpace=Rt?three_module.Zr2:three_module.er$,it[nt]=zt,[c.onChange].flat().forEach(Ut=>typeof Ut=="function"&&(Ut==null?void 0:Ut())),typeof(it==null?void 0:it.setDirty)=="function"&&it.setDirty(),(Bt=c.uiRefresh)===null||Bt===void 0||Bt.call(c,"postFrame",!1)}else console.warn("uiconfig-tweakpane: Failed to load texture",Tt)})}CustomContextMenu.Remove()},cancel:()=>{CustomContextMenu.Remove()}},2,ft.height+8);(pt=mt.parentElement)===null||pt===void 0||pt.appendChild(At),ft.y>.7*document.body.clientHeight&&(At.style.top="auto",At.style.bottom=ft.height+8+"px")}),_.view="input-image",tpInputGenerator(o,c,d,_)};var tpTheme=__webpackgi_require__(367),tpTheme_exported={};tpTheme.A&&tpTheme.A.locals&&(tpTheme_exported.locals=tpTheme.A.locals);var tpTheme_refs=0,tpTheme_update,tpTheme_options={};tpTheme_options.styleTagTransform=styleTagTransform_default(),tpTheme_options.setAttributes=setAttributesWithoutAttributes_default(),tpTheme_options.insert=function(h,o){(o.target||document.head).appendChild(h)},tpTheme_options.domAPI=styleDomAPI_default(),tpTheme_options.insertStyleElement=insertStyleElement_default(),tpTheme_exported.use=function(h){return tpTheme_options.options=h||{},tpTheme_refs++||(tpTheme_update=injectStylesIntoStyleTag_default()(tpTheme.A,tpTheme_options)),tpTheme_exported},tpTheme_exported.unuse=function(){tpTheme_refs>0&&!--tpTheme_refs&&(tpTheme_update(),tpTheme_update=null)};var ui_tpTheme=tpTheme_exported,TweakpaneUiPlugin_decorate=function(h,o,c,d){var _,b=arguments.length,_e=b<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_e=Reflect.decorate(h,o,c,d);else for(var it=h.length-1;it>=0;it--)(_=h[it])&&(_e=(b<3?_(_e):b>3?_(o,c,_e):_(o,c))||_e);return b>3&&_e&&Object.defineProperty(o,c,_e),_e};class TweakpaneUiPlugin extends TweakpaneWrapper{constructor(o=!1,c=!1,d=!1,_,b){var _e,it;super(o,c,d,!1,(_e=_??document.getElementById("tweakpaneMainPanelSlot"))!==null&&_e!==void 0?_e:document.body),this.dependencies=[AssetManagerPlugin],this._preRender=()=>this.refreshQueue("preRender"),this._postRender=()=>this.refreshQueue("postRender"),this._postFrame=nt=>{this.dispatchEvent(nt),this.refreshQueue("postFrame")},this._preFrame=()=>this.refreshQueue("preFrame"),this._plugins=[],this._pane.registerPlugin(tweakpane_image_plugin),ui_tpTheme.use({target:this._container}),this.colorMode=(it=b??(localStorage?localStorage.getItem("tpTheme"):"blue"))!==null&&it!==void 0?it:"blue"}async onAdded(o){this._viewer=o,this._typeGenerators.image=tpImageInputGenerator(this._viewer),o.addEventListener("preRender",this._preRender),o.addEventListener("postRender",this._postRender),o.addEventListener("preFrame",this._preFrame),o.addEventListener("postFrame",this._postFrame)}async onDispose(o){this.dispose()}async onRemove(o){this._viewer=void 0,o.removeEventListener("preRender",this._preRender),o.removeEventListener("postRender",this._postRender),o.removeEventListener("preFrame",this._preFrame),o.removeEventListener("postFrame",this._postFrame),this.dispose()}setupPluginUi(o){var c;const d=(c=this._viewer)===null||c===void 0?void 0:c.getPlugin(o);if(!d)return void console.warn("plugin not found:",o);this._plugins.push(d),d.uiConfig&&(d.uiConfig.limitedUi=!0),d.uiConfig&&d.uiConfig.hidden===void 0&&(d.uiConfig.hidden=!1),this._appendUiObject(d);const _=d.uiConfig;if(_!=null&&_.uiRef&&d.toJSON){const b=typeof d.toJSON=="function"?d.toJSON():null;d.resetDefaults=async()=>{var nt,at;await((nt=d.fromJSON)===null||nt===void 0?void 0:nt.call(d,b)),(at=_.uiRefresh)===null||at===void 0||at.call(_,"postFrame",!0)};const _e=_.uiRef.controller_.view.element,it=ee$1({innerHTML:"&#8942;",classList:["pluginOptionsButton"],elementTag:"button"});it.onclick=nt=>{const at={};typeof d.toJSON=="function"&&(at["download preset"]=async()=>{var pt,mt;const ft=(mt=(pt=this._viewer)===null||pt===void 0?void 0:pt.getPlugin(AssetManagerPlugin))===null||mt===void 0?void 0:mt.exportPluginPreset(d);await N$2(new Blob([JSON.stringify(ft,null,2)],{type:"application/json"}),"preset."+d.constructor.PluginType+".json"),CustomContextMenu.Remove()}),typeof d.fromJSON=="function"&&(at["upload preset"]=async()=>{var pt,mt,ft;CustomContextMenu.Remove();const vt=await ge$1(!1,!1);if(vt.length===0)return;const xt=vt[0],At=await xt.text(),Ct=JSON.parse(At);await((mt=(pt=this._viewer)===null||pt===void 0?void 0:pt.getPlugin(AssetManagerPlugin))===null||mt===void 0?void 0:mt.importPluginPreset(Ct,d)),(ft=_.uiRefresh)===null||ft===void 0||ft.call(_,"postFrame",!0)},b&&(at["reset defaults"]=async()=>{var pt,mt;CustomContextMenu.Remove(),await((mt=(pt=d).resetDefaults)===null||mt===void 0?void 0:mt.call(pt))}));const ut=CustomContextMenu.Create(at,_e.clientWidth-120,12);_e.append(ut),nt.preventDefault()},_e.appendChild(it)}return _}setupPlugins(...o){o.forEach(c=>this.setupPluginUi(c))}refreshPluginsEnabled(){this._plugins.forEach(o=>{var c;const d=o.uiConfig;d&&(Ee$1(d.hidden)!==!0?(c=d.uiRefresh)===null||c===void 0||c.call(d,"postFrame",!0):d.uiRef&&(d.uiRef.hidden=!0))})}async alert(o){return this._viewer?this._viewer.alert(o):super.alert(o)}async confirm(o){return this._viewer?this._viewer.confirm(o):super.confirm(o)}async prompt(o,c,d=!0){return this._viewer?this._viewer.prompt(o,c,d):super.prompt(o,c,d)}_colorModeChanged(){document.body.classList.remove("tpTheme-black","tpTheme-white","tpTheme-blue"),document.body.classList.add("tpTheme-"+this.colorMode),localStorage&&localStorage.setItem("tpTheme",this.colorMode)}}TweakpaneUiPlugin.PluginType="TweakpaneUi",TweakpaneUiPlugin_decorate([x$1(TweakpaneUiPlugin.prototype._colorModeChanged)],TweakpaneUiPlugin.prototype,"colorMode",void 0);class SimpleBackgroundEnvUiPlugin extends AViewerPlugin{constructor(){super(...arguments),this.enabled=!0,this.toJSON=void 0,this._savedBg=!1,this.lastBgVal=null,this.uiConfig={label:"Background / Environment",type:"folder",expanded:!1,limitedUi:!0,children:[{label:"Color",type:"color",inlinePicker:!0,property:[this,"sceneBackgroundColor"],limitedUi:!0},()=>({label:"Image",property:[this,"sceneBackground"],type:"image",limitedUi:!0}),{label:"EnvMap BG",type:"checkbox",property:[this,"envmapBg"]},()=>({type:"slider",label:"BG Intensity",getValue:()=>{var o,c;return(c=(o=this._viewer)===null||o===void 0?void 0:o.scene.backgroundIntensity)!==null&&c!==void 0?c:1},setValue:o=>{this._viewer&&(this._viewer.scene.backgroundIntensity=o)},bounds:[0,16]}),{label:"Set Transparent BG",type:"button",hidden:()=>!this._viewer||this._viewer.useRgbm,value:()=>{this._viewer&&(this._viewer.scene.background=null,this._viewer.scene.backgroundColor=null)}},()=>({label:"Environment",getValue:()=>{var o;return((o=this._viewer)===null||o===void 0?void 0:o.scene.environment)||null},setValue:o=>{this._viewer&&(this._viewer.scene.environment=o)},type:"image",limitedUi:!0}),{type:"slider",label:"Env Rotation",getValue:()=>{var o,c,d;return(d=(c=(o=this._viewer)===null||o===void 0?void 0:o.scene.environment)===null||c===void 0?void 0:c.rotation)!==null&&d!==void 0?d:0},setValue:o=>{var c,d;const _=(c=this._viewer)===null||c===void 0?void 0:c.scene.environment;_&&(_.rotation=o,(d=this._viewer)===null||d===void 0||d.scene.setDirty())},bounds:[0,2*Math.PI],limitedUi:!0},{type:"slider",label:"Env Intensity",getValue:()=>{var o,c;return(c=(o=this._viewer)===null||o===void 0?void 0:o.scene.envMapIntensity)!==null&&c!==void 0?c:1},setValue:o=>{var c;!((c=this._viewer)===null||c===void 0)&&c.scene&&(this._viewer.scene.envMapIntensity=o)},bounds:[0,4],limitedUi:!0},()=>({label:"Environment1",getValue:()=>{var o;return((o=this._viewer)===null||o===void 0?void 0:o.scene.textureSlots.environment1)||null},setValue:o=>{this._viewer&&(o.mapping===three_module.UTZ&&(o.mapping=three_module.wfO,o.needsUpdate=!0),this._viewer.scene.textureSlots.environment1=o)},type:"image"}),{type:"slider",label:"Env1 Rotation",hidden:()=>{var o;return!(!((o=this._viewer)===null||o===void 0)&&o.scene.textureSlots.environment1)},getValue:()=>{var o,c,d;return(d=(c=(o=this._viewer)===null||o===void 0?void 0:o.scene.textureSlots.environment1)===null||c===void 0?void 0:c.rotation)!==null&&d!==void 0?d:0},setValue:o=>{var c,d;const _=(c=this._viewer)===null||c===void 0?void 0:c.scene.textureSlots.environment1;_&&(_.rotation=o,(d=this._viewer)===null||d===void 0||d.scene.setDirty())},bounds:[0,2*Math.PI]},{type:"checkbox",label:"Fixed Env Direction",getValue:()=>{var o,c;return(c=(o=this._viewer)===null||o===void 0?void 0:o.scene.fixedEnvMapDirection)!==null&&c!==void 0&&c},setValue:o=>{this._viewer&&(this._viewer.scene.fixedEnvMapDirection=o)}}]}}get sceneBackgroundColor(){var o,c;const d=(c=(o=this._viewer)===null||o===void 0?void 0:o.scene.backgroundColor)===null||c===void 0?void 0:c.getHex(three_module.er$);return d!==void 0&&(this._savedBg=!0),d||0}set sceneBackgroundColor(o){this._viewer&&this._savedBg&&(this._viewer.scene.backgroundColor||(this._viewer.scene.backgroundColor=new three_module.Q1f),this._viewer.scene.backgroundColor.setHex(o),this._viewer.scene.setDirty())}get sceneBackground(){var o;const c=(o=this._viewer)===null||o===void 0?void 0:o.scene.background;return c&&(c.isTexture||c.assetType==="texture")?c:null}set sceneBackground(o){this._viewer&&(this._viewer.scene.background=o)}get envmapBg(){var o,c,d;return((o=this._viewer)===null||o===void 0?void 0:o.scene.background)==="environment"||((c=this._viewer)===null||c===void 0?void 0:c.scene.background)===((d=this._viewer)===null||d===void 0?void 0:d.scene.environment)}set envmapBg(o){if(this._viewer)if(o){const c=this._viewer.scene.background;c&&c!==this._viewer.scene.environment&&c!=="environment"&&(this.lastBgVal=c),this._viewer.scene.background="environment"}else this._viewer.scene.background!==this._viewer.scene.environment&&this._viewer.scene.background!=="environment"||(this._viewer.scene.background=this.lastBgVal)}async onAdded(o){await super.onAdded(o),this.lastBgVal=o.scene.background,o.scene.addEventListener("backgroundChanged",()=>{var c,d;(d=(c=this.uiConfig).uiRefresh)===null||d===void 0||d.call(c,"postFrame",!0)}),o.scene.addEventListener("environmentChanged",()=>{var c,d;(d=(c=this.uiConfig).uiRefresh)===null||d===void 0||d.call(c,"postFrame",!0)})}}SimpleBackgroundEnvUiPlugin.PluginType="SimpleBackgroundEnvUiPlugin1";class SimpleViewerUi extends AViewerPlugin{constructor(){super(),this.enabled=!0,this.toJSON=void 0,this._uiConfig={type:"folder",label:"Scene",children:[],onExpand:()=>{var o,c;(c=(o=this._uiConfig).uiRefresh)===null||c===void 0||c.call(o,"postFrame",!0)}},this._clearSceneButton={type:"button",label:"Clear Scene",value:()=>{var o;(o=this._viewer)===null||o===void 0||o.scene.disposeSceneModels()}},this._sceneUpdate=this._sceneUpdate.bind(this)}async onAdded(o){await super.onAdded(o),o.scene.addEventListener("sceneUpdate",this._sceneUpdate)}async onRemove(o){return o.scene.removeEventListener("sceneUpdate",this._sceneUpdate),super.onRemove(o)}setDirty(){var o;(o=this._viewer)===null||o===void 0||o.setDirty()}get uiConfig(){return this._viewer?(this._uiConfig.children=[this._clearSceneButton],this._uiConfig):this._uiConfig}_sceneUpdate(){}}SimpleViewerUi.PluginType="SimpleUi";var tree=__webpackgi_require__(530),tree_default=__webpackgi_require__.n(tree),treejs=tree_default();class HierarchyUiPlugin extends AViewerPlugin{constructor(o=!0){super(),this.enabled=!0,this.toJSON=void 0,this.treeView=void 0,this.hierarchyDiv=ee$1({innerHTML:"",id:"tpHierarchyContainer",addToBody:!1}),this._resetting=!1,this._uiConfig={type:"folder",label:"Hierarchy",children:[]},this._buildData=(c,d)=>(c.push({text:d.name||"unnamed",id:d.uuid,children:d.children.reduce(this._buildData,[])}),c),this._findVisible=(c,d)=>(d.visible&&(d.children.length<1?c.push(d.uuid):c.push(...d.children.reduce(this._findVisible,[]))),c),this._setVisible=c=>{var d;(d=this._viewer)===null||d===void 0||d.doOnce("postFrame",()=>{var _,b,_e;const it=(_=this._viewer)===null||_===void 0?void 0:_.scene.modelRoot;if(!it||c==null)return;const nt=new Set;it.traverse(at=>{at!==it&&(at.visible=c.includes(at.uuid),at.visible&&at.traverseAncestors(ut=>nt.add(ut)))}),nt.forEach(at=>at.visible=!0),(_e=(b=this._viewer)===null||b===void 0?void 0:b.scene)===null||_e===void 0||_e.setDirty({sceneUpdate:!0,fromHierarchyPlugin:!0,updateGround:!1})})},this.enabled=o,this.reset=this.reset.bind(this),P$2($`
#tpHierarchyContainer{
  width: 100%;
  height: auto;
  background-color: transparent;
  color: var(--tp-container-foreground-color, hsl(230, 7%, 75%));
  margin-top: 0;
}
.treejs .treejs-switcher:before {
    border-top: 6px solid var(--tp-container-foreground-color, hsl(230, 7%, 75%)) !important;
}
        `)}_reset(o){var c;if(o!=null&&o.fromHierarchyPlugin||o&&!o.hierarchyChanged)return;for(;this.hierarchyDiv.firstChild;)this.hierarchyDiv.firstChild.remove();const d=(c=this._viewer)===null||c===void 0?void 0:c.scene.modelRoot;if(!d)return;const _=d.children.reduce(this._buildData,[]),b=d.children.reduce(this._findVisible,[]);let _e=!1;return new Promise((it,nt)=>{this.treeView=new treejs(this.hierarchyDiv,{closeDepth:1,data:_,loaded:function(){this.values=b,it()},onChange:()=>{_e?X$2(200).then(()=>{this.treeView&&this._setVisible(this.treeView.values)}):_e=!0},onItemLabelClick:at=>{var ut;const pt=(ut=this._viewer)===null||ut===void 0?void 0:ut.scene.modelRoot.modelObject.getObjectByProperty("uuid",at);pt&&d.visible&&pt.dispatchEvent({type:"select",value:pt,ui:!0})}})})}async onAdded(o){await super.onAdded(o),o.scene.addEventListener("sceneUpdate",this.reset),await this.reset()}async reset(o){this._resetting||(this._resetting=!0,await X$2(500),await this._reset(o),this._resetting=!1)}async onRemove(o){return o.scene.removeEventListener("sceneUpdate",this.reset),super.onRemove(o)}async onDispose(o){return super.onDispose(o)}get uiConfig(){return this._uiConfig.domChildren||(this._uiConfig.domChildren=[this.hierarchyDiv]),this._uiConfig}}HierarchyUiPlugin.PluginType="HierarchyUiPlugin";class LightsUiPlugin extends AViewerPlugin{constructor(){super(),this.toJSON=void 0,this.enabled=!0,this.uiConfig={type:"folder",label:"Lights",children:[{type:"button",label:"Add Directional Light",value:()=>{if(!this._viewer)return;const o=new DirectionalLight2;o.position.set(0,0,0),o.target.position.set(0,0,-1).normalize(),o.intensity=2,o.shadow.mapSize.set(1024,1024),this._viewer.scene.addLight(o)}},{type:"button",label:"Add Ambient Light",value:()=>{if(!this._viewer)return;const o=new AmbientLight2;o.intensity=.4,this._viewer.scene.addLight(o)}},{type:"button",label:"Add Point Light",value:()=>{if(!this._viewer)return;const o=new PointLight2;o.position.set(3,3,3),o.shadow.mapSize.set(1024,1024),o.intensity=2,this._viewer.scene.addLight(o)}},{type:"button",label:"Add Spot Light",value:()=>{if(!this._viewer)return;const o=new SpotLight2;o.position.set(3,3,3),o.shadow.mapSize.set(1024,1024),o.intensity=2,o.lookAt(0,0,0),this._viewer.scene.addLight(o)}}],limitedUi:!0},this.dependencies=[AssetManagerPlugin],this._sceneUpdate=o=>{var c,d,_;if(!o.hierarchyChanged)return;const b=[];(c=this._viewer)===null||c===void 0||c.traverseSceneObjects(_e=>{if(!_e.lightObject)return;const it=_e.uiConfig;it&&!b.includes(it)&&b.push(it)}),[...this.uiConfig.children].forEach(_e=>{(_e==null?void 0:_e.type)==="button"||b.includes(_e)||this.uiConfig.children.splice(this.uiConfig.children.indexOf(_e),1)}),b.forEach(_e=>{this.uiConfig.children.includes(_e)||this.uiConfig.children.push(_e)}),(_=(d=this.uiConfig).uiRefresh)===null||_===void 0||_.call(d,"postFrame",!0)}}async onAdded(o){await super.onAdded(o),o.scene.addEventListener("sceneUpdate",this._sceneUpdate)}async onRemove(o){return o.scene.removeEventListener("sceneUpdate",this._sceneUpdate),super.onRemove(o)}}LightsUiPlugin.PluginType="SimpleLightsUi";class SceneCamerasUiPlugin extends AViewerPlugin{constructor(){super(),this.toJSON=void 0,this.enabled=!0,this.uiConfig={type:"folder",label:"Cameras (Loaded)",children:[{type:"button",label:"Add Camera",value:()=>{var o;if(!this._viewer)return;const c=this._viewer.createCamera(new three_module.ubm(45,1,.5,20));this._viewer.scene.modelRoot.add(c.cameraObject),c.setCameraOptions({controlsMode:"orbit"}),c.position.set(2,2,2),c.target.set(0,0,0),c.positionUpdated(!0),c.cameraObject.lookAt(0,0,0),c.setDirty();const d=this._viewer.getPluginByType("VirtualCamerasPlugin");if(d){const _=d.addCamera(c),b=(o=this._viewer)===null||o===void 0?void 0:o.getPluginByType("debug");b&&b.addTexture("camera frame",()=>_.target.texture,[40,310,300,200])}}}],limitedUi:!0},this.dependencies=[AssetManagerPlugin],this._sceneUpdate=o=>{var c,d,_;if(!o.hierarchyChanged)return;const b=[];(c=this._viewer)===null||c===void 0||c.traverseSceneObjects(_e=>{if(!_e.cameraObject)return;const it=_e.uiConfig;it&&!b.includes(it)&&b.push(it)}),[...this.uiConfig.children].forEach(_e=>{(_e==null?void 0:_e.type)==="button"||b.includes(_e)||this.uiConfig.children.splice(this.uiConfig.children.indexOf(_e),1)}),b.forEach(_e=>{this.uiConfig.children.includes(_e)||this.uiConfig.children.push(_e)}),(_=(d=this.uiConfig).uiRefresh)===null||_===void 0||_.call(d,"postFrame",!0)}}async onAdded(o){await super.onAdded(o),o.scene.addEventListener("sceneUpdate",this._sceneUpdate)}async onRemove(o){return o.scene.removeEventListener("sceneUpdate",this._sceneUpdate),super.onRemove(o)}}SceneCamerasUiPlugin.PluginType="SimpleSceneCamerasUi";var RendererUiPlugin_decorate=function(h,o,c,d){var _,b=arguments.length,_e=b<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_e=Reflect.decorate(h,o,c,d);else for(var it=h.length-1;it>=0;it--)(_=h[it])&&(_e=(b<3?_(_e):b>3?_(o,c,_e):_(o,c))||_e);return b>3&&_e&&Object.defineProperty(o,c,_e),_e},RendererUiPlugin_1;let RendererUiPlugin=RendererUiPlugin_1=class extends AViewerPlugin{constructor(){super(),this.enabled=!0,this._serializeVersion=1,this.mode="full",this.width=0,this.height=0,this.scale=1,this._sizeChanged=this._sizeChanged.bind(this),this._refresh=this._refresh.bind(this),this.refreshSize=this.refreshSize.bind(this)}refreshSize(){var h;this.enabled&&(this._sizeChanged(),(h=this._viewer)===null||h===void 0||h.setDirty())}_sizeChanged(h=!0){if(!this._viewer||!this.enabled)return;if(this.mode==="full")return this._viewer.setSize({}),this._setScale(this.scale),void this._refresh();const o={width:Math.floor(this.width),height:Math.floor(this.height)},c=this._viewer.container.getBoundingClientRect(),d={width:Math.floor(c.width),height:Math.floor(c.height)};let _=1;if(o.width>d.width){const b=o.width;o.width=d.width;const _e=o.width/b;if(o.height=Math.floor(o.height*_e),_/=_e,_>RendererUiPlugin_1.MaxCanvasScale)return this.width=d.width*RendererUiPlugin_1.MaxCanvasScale,console.log("loop",this.width,d.width,_),void this._sizeChanged()}if(o.height>d.height){const b=o.height;o.height=d.height;const _e=o.height/b;if(o.width=Math.floor(o.width*_e),_/=_e,_>RendererUiPlugin_1.MaxCanvasScale)return this.height=d.height*RendererUiPlugin_1.MaxCanvasScale,console.log("loop",this.width,d.width,this.height,d.height,_),void this._sizeChanged()}(o.width>=d.width||o.width<1)&&delete o.width,(o.height>=d.height||o.height<1)&&delete o.height,this._viewer.setSize(o),this._setScale(_),h&&(this.scale=_),this._refresh()}_setScale(h){this._viewer&&(this._viewer.renderer.displayCanvasScaling=h)}_scaleChanged(){if(!this._viewer)return;const h=this.scale;if(Math.abs(h-this._viewer.renderer.displayCanvasScaling)<.01)return;if(this.mode==="full")return void this._sizeChanged();const o=this.width/this.height,c=this._viewer.container.getBoundingClientRect(),d=Math.floor(c.width*h),_=Math.floor(d/o);this.width=d,this.height=_,this._sizeChanged(!1)}async onAdded(h){await super.onAdded(h);const o=h.canvas.clientWidth,c=h.canvas.clientHeight,d=h.renderer.displayCanvasScaling;this.width=o,this.height=c,this.scale=d,h.renderer.addEventListener("resize",this.refreshSize),this.addEventListener("deserialize",this.refreshSize),this._refresh()}async onRemove(h){return this.removeEventListener("deserialize",this.refreshSize),h.renderer.removeEventListener("resize",this.refreshSize),super.onRemove(h)}_refresh(){var h,o;(o=(h=this.uiConfig)===null||h===void 0?void 0:h.uiRefresh)===null||o===void 0||o.call(h,"postFrame",!0)}fromJSON(h,o){if(!h.mode)if(h.width||h.height){const c=this._viewer.container.getBoundingClientRect();h.width||(h.width=c.width),h.height||(h.height=c.height),h.scale&&(h.width*=h.scale,h.height*=h.scale,delete h.scale),h.width=Math.round(h.width),h.height=Math.round(h.height),h.mode="custom"}else h.mode="full";return super.fromJSON(h,o)}toJSON(h){const o=super.toJSON(h);return o.mode==="full"&&(delete o.width,delete o.height),o.mode==="custom"&&delete o.scale,o}};RendererUiPlugin.PluginType="RendererParamsUiPlugin",RendererUiPlugin.MaxCanvasScale=5,RendererUiPlugin_decorate([serialize("version")],RendererUiPlugin.prototype,"_serializeVersion",void 0),RendererUiPlugin_decorate([serialize(),uiDropdown("Mode",["full","custom"].map(h=>({label:h}))),ze$1(RendererUiPlugin.prototype._sizeChanged)],RendererUiPlugin.prototype,"mode",void 0),RendererUiPlugin_decorate([serialize(),uiSlider("Width",void 0,1,h=>({onChange:()=>h._sizeChanged(),hidden:()=>h.mode==="full",bounds:()=>{var o;return[10,Math.pow(2,Math.ceil(Math.log2(((o=h._viewer)===null||o===void 0?void 0:o.container.getBoundingClientRect().width)||1024)+2))]}}))],RendererUiPlugin.prototype,"width",void 0),RendererUiPlugin_decorate([serialize(),uiSlider("Height",void 0,1,h=>({onChange:()=>h._sizeChanged(),hidden:()=>h.mode==="full",bounds:()=>{var o;return[10,Math.pow(2,Math.ceil(Math.log2(((o=h._viewer)===null||o===void 0?void 0:o.container.getBoundingClientRect().height)||1024)+2))]}}))],RendererUiPlugin.prototype,"height",void 0),RendererUiPlugin_decorate([serialize(),x$1(RendererUiPlugin.prototype._scaleChanged),uiSlider("Scale",[.25,RendererUiPlugin.MaxCanvasScale],.001,h=>({disabled:()=>h.mode==="custom"}))],RendererUiPlugin.prototype,"scale",void 0),RendererUiPlugin=RendererUiPlugin_1=RendererUiPlugin_decorate([uiFolder("Renderer")],RendererUiPlugin);class CameraUiPlugin extends AViewerPlugin{async onAdded(o){await super.onAdded(o),o.scene.addEventListener("activeCameraChange",this._refresh),o.scene.addEventListener("sceneUpdate",this._refresh)}async onRemove(o){return o.scene.removeEventListener("activeCameraChange",this._refresh),o.scene.removeEventListener("sceneUpdate",this._refresh),super.onRemove(o)}constructor(){super(),this.enabled=!0,this.serializeWithViewer=!1,this._refresh=this._refresh.bind(this)}toJSON(o){var c;const d=super.toJSON(o);return d.activeCamera=(c=this._viewer)===null||c===void 0?void 0:c.scene.activeCamera.toJSON(),d}fromJSON(o,c){var d;return o.activeCamera&&((d=this._viewer)===null||d===void 0||d.scene.activeCamera.fromJSON(o.activeCamera),delete(o={...o}).activeCamera),super.fromJSON(o,c)}_refresh(){var o,c;this._viewer&&((c=(o=this.uiConfig).uiRefresh)===null||c===void 0||c.call(o,"postFrame",!0))}get uiConfig(){var o;return((o=this._viewer)===null||o===void 0?void 0:o.scene.activeCamera.uiConfig)||{}}}CameraUiPlugin.PluginType="CameraUiPlugin";let Button={create:h=>{let o="button"+(h.type?" "+h.type:""),c=utility.createDiv(o,h.text);return c.addEventListener("click",h.onClick),c}};var js_button=Button;let Utility={createElement:(h,o,c,d)=>{let _=document.createElement(h);if(o&&(_.className=o),c&&(_.innerHTML=c),d)for(let b in d)_.setAttribute(b,d[b]);return _},createDiv:(h,o,c)=>Utility.createElement("div",h,o,c),createDomTree:h=>{if(!h||!h.hasOwnProperty("dom"))return h;let o=h.dom;if(h.children)for(let c in h.children)h.children[c]&&o.appendChild(Utility.createDomTree(h.children[c]));return o},removeElement:h=>{h!=null&&h.parentNode.removeChild(h)},appendToBody:h=>{document.body.appendChild(h)},makeIconHTML:h=>{let o="";return h=="ok"&&(o="#tick"),h=="error"&&(o="#cancel"),h=="info"&&(o="#info-button"),h=="caution"&&(o="#danger"),h=="min"&&(o="#line"),h=="close"&&(o="#close"),`<svg class="icon ${h}"><use xlink:href="${o}" /></svg>`},makeNftContent:h=>{let o=null;if(h.type){let c=null;c=typeof h.content=="string"?Utility.createDiv("inner-content",h.content):Utility.createDomTree({dom:Utility.createDiv("inner-content"),children:[h.content]}),o=h.type=="text"?Utility.createDomTree({dom:Utility.createDiv("content text"),children:[c]}):Utility.createDomTree({dom:Utility.createDiv("content"),children:[Utility.createDiv("state",Utility.makeIconHTML(h.type)),c]})}else typeof h.content=="string"&&(o=Utility.createDiv("content",h.content));return o},standardizeButtons:(h,o)=>{let c=[];if(o.buttons===void 0)return o.type!="caution"&&o.type!="info"||c.push({key:27,text:"Cancel",onClick:h.close.bind(h,"cancel")}),c.push({key:13,text:"OK",type:"main",onClick:h.close.bind(h,"ok")}),c;c=o.buttons,c.constructor!==Array&&(c=[c]);for(let d in c)!c[d].onClick&&(c[d].onClick=h.close.bind(h,c[d].id));return c},makeButtons:h=>{let o=[];if(h)for(let c in h)o.push(js_button.create({text:h[c].text?h[c].text:"OK",type:h[c].normal?null:"main",onClick:h[c].onClick}));return Utility.createDomTree({dom:Utility.createDiv("button-wrapper"),children:o})},bindButtonKeyEvents:h=>{let o=c=>{for(let d in h)if(h[d].key===c.keyCode)return void h[d].onClick()};return window.addEventListener("keydown",o),o},unbindButtonKeyEvents:h=>{window.removeEventListener("keydown",h)}};var utility=Utility,animator=__webpackgi_require__(333);let frames_frames={"wwise-overlay-in-1":{opacity:"0"},"wwise-overlay-in-2":{opacity:"1"},"wwise-overlay-out-1":{opacity:"0"},"wwise-pop-in-1":{transform:"scale(0.5, 0.5)","margin-top":"50px",opacity:".5"},"wwise-pop-in-2":{transform:"scale(1, 1)","margin-top":"0",opacity:"1"},"wwise-pop-in-3":{transform:"scale(1.05, 1.05)"},"wwise-pop-in-4":{transform:"scale(1, 1)"},"wwise-pop-out-1":{transform:"scale(0.25, 0.25)","margin-top":"50px",opacity:"0"},"wwise-flip-in-1":{transform:"rotateX(60deg) scaleX(.5)",opacity:".2"},"wwise-flip-in-2":{transform:"none",opacity:"1"},"wwise-flip-out-1":{transform:"rotateX(60deg) scaleX(.5)",opacity:"0"},"wwise-top-in-1":{transform:"translateY(-30vh)",opacity:".5"},"wwise-top-in-2":{transform:"none",opacity:"1"},"wwise-top-out-1":{transform:"translateY(-30vh)",opacity:"0"},"wwise-bottom-in-1":{transform:"translateY(30vh)",opacity:".5"},"wwise-bottom-in-2":{transform:"none",opacity:"1"},"wwise-bottom-out-1":{transform:"translateY(30vh)",opacity:"0"},"wwise-left-in-1":{transform:"translateX(-30vw)",opacity:".5"},"wwise-left-in-2":{transform:"none",opacity:"1"},"wwise-left-out-1":{transform:"translateX(-30vw)",opacity:"0"},"wwise-right-in-1":{transform:"translateX(30vw)",opacity:".5"},"wwise-right-in-2":{transform:"none",opacity:"1"},"wwise-right-out-1":{transform:"translateX(30vw)",opacity:"0"},"wwise-min-in-1":{"margin-top":"0",transform:"rotateX(-60deg) scale(0.2, 1.8) translateY(80vh)",opacity:".2"},"wwise-min-in-2":{transform:"none",opacity:"1"},"wwise-min-out-1":{"margin-top":"30vh",transform:"rotateX(-60deg) scale(0.05, 2) translateY(30vh)",opacity:"0"}};var js_frames=frames_frames;let animation_Animation={};animation_Animation.overlay_in=[new animator.Frame(js_frames["wwise-overlay-in-1"],0),new animator.Frame(js_frames["wwise-overlay-in-2"],400)],animation_Animation.overlay_out=[new animator.Frame(js_frames["wwise-overlay-out-1"],300)],animation_Animation.pop_in=[new animator.Frame(js_frames["wwise-pop-in-1"],0),new animator.Frame(js_frames["wwise-pop-in-2"],{duration:200,"timing-function":"ease-in"}),new animator.Frame(js_frames["wwise-pop-in-3"],{duration:100,"timing-function":"linear"}),new animator.Frame(js_frames["wwise-pop-in-4"],{duration:100,"timing-function":"linear"})],animation_Animation.pop_out=[new animator.Frame(js_frames["wwise-pop-out-1"],{duration:250,"timing-function":"ease-in"})],animation_Animation.flip_in=[new animator.Frame(js_frames["wwise-flip-in-1"],0),new animator.Frame(js_frames["wwise-flip-in-2"],500)],animation_Animation.flip_out=[new animator.Frame(js_frames["wwise-flip-out-1"],400)],animation_Animation.min_in=[new animator.Frame(js_frames["wwise-min-in-1"],0),new animator.Frame(js_frames["wwise-min-in-2"],350)],animation_Animation.min_out=[new animator.Frame(js_frames["wwise-min-out-1"],400)];let dirs=["top","bottom","left","right"];for(let h in dirs){let o=dirs[h];animation_Animation[o+"_in"]=[new animator.Frame(js_frames["wwise-"+o+"-in-1"],0),new animator.Frame(js_frames["wwise-"+o+"-in-2"],{duration:400,"timing-function":"ease-out"})],animation_Animation[o+"_out"]=[new animator.Frame(js_frames["wwise-"+o+"-out-1"],{duration:400,"timing-function":"ease-in"})]}var js_animation=animation_Animation;let defaultOptions={animation:"pop",topbar:{showClose:!0,showMin:!1},keepOverlay:!1,position:"center",overlay:!1,clickOverlayToClose:!0,removeBackground:!1,noRadius:!1,zIndex:null};class Window{static create(o,c){let d=o.getElementsByClassName("title")[0];d&&(d=d.innerHTML);let _=o.getElementsByClassName("content")[0];return _&&(_=_.innerHTML),utility.removeElement(o),c.title=d,c.content=_,new Window(c)}constructor(o){this.options=JSON.parse(JSON.stringify(defaultOptions));for(let nt in o)o[nt]!=null&&(this.options[nt]=o[nt]);let c=this.options.position;if(c.indexOf(" ")==-1&&(c=="left"||c=="right"?c+=" center":c=c=="top"||c=="bottom"?"center "+c:c+" "+c),this.options.position=c,this.options.overlay){let nt=document.getElementsByClassName("wwise-overlay");nt.length?(this.overlay=nt[0],this.hasOverlay=!0):(this.overlay=utility.createDiv("wwise-overlay"),this.options.zIndex&&(this.overlay.style.zIndex=this.options.zIndex)),this.overlayClickHandler=this.close.bind(this,void 0)}else this.options.clickOverlayToClose=!1;let d="content";if(this.options.topbar){let nt=[];this.options.topbar.showMin&&(nt.push(utility.createDiv(null,utility.makeIconHTML("min"))),nt[nt.length-1].addEventListener("click",this.min.bind(this))),this.options.topbar.showClose&&(nt.push(utility.createDiv(null,utility.makeIconHTML("close"))),nt[nt.length-1].addEventListener("click",this.close.bind(this,void 0)));let at=null;at=typeof this.options.title=="string"?utility.createDiv("title",this.options.title):utility.createDomTree({dom:utility.createDiv("title"),children:[this.options.title]}),this.topbar=utility.createDomTree({dom:utility.createDiv("topbar"),children:[{dom:utility.createDiv("control"),children:nt.map(ut=>({dom:ut}))},{dom:at},{dom:utility.createDiv("clear")}]})}else d+=" no-topbar";typeof this.options.content=="string"?this.content=utility.createDomTree({dom:utility.createDiv(d,this.options.content)}):this.content=utility.createDomTree({dom:utility.createDiv(d),children:[this.options.content]}),this.options.removeBackground&&(this.content.style.background="initial"),this.window=utility.createDomTree({dom:utility.createDiv("wwise"+(this.options.noRadius?" no-radius":"")),children:[this.topbar,this.content]});let _=utility.createDiv("wwise-wrapper");this.options.zIndex&&(_.style.zIndex=this.options.zIndex),this.wrapper=utility.createDomTree({dom:_,children:[this.window]}),this.dom=utility.createDomTree({dom:utility.createDiv(),children:[this.wrapper]});let b=this.options.position.split(" "),_e=-50,it=-50;if(b[0]=="left"?(_e=0,this.wrapper.classList.add("left")):b[0]=="right"?(_e=-100,this.wrapper.classList.add("right")):b[0]=="center"?this.wrapper.classList.add("h-center"):this.wrapper.style.left=b[0],b[1]=="top"?(it=0,this.wrapper.classList.add("top")):b[1]=="bottom"?(it=-100,this.wrapper.classList.add("bottom")):b[1]=="center"?this.wrapper.classList.add("v-center"):this.wrapper.style.top=c[1],this.window.style.transform=`translate(${_e}%, ${it}%)`,this.options.style)for(let nt in this.options.style)this.window.style[nt]=this.options.style[nt];this.options.margin&&(this.wrapper.style.margin=this.options.margin),this.options.draggable&&this.draggable()}open(o){if(this.opened)return;this.promise=new Promise(d=>{this.promiseResolve=d}),this.appendDoms(),this.opened=!0,this.options.clickOverlayToClose&&(this.overlay.addEventListener("click",this.overlayClickHandler),this.overlay.addEventListener("touchstart",this.overlayClickHandler));let c=o?"min":this.options.animation;if(c){c!="min"&&c!="flip"||this.dom.classList.add("wwise-perspective");let d=[new animator.Queue(this.wrapper,js_animation[c+"_in"],{instant:!0,applyOnEnd:!0}).getPromise()];return this.options.overlay&&!this.hasOverlay&&d.push(new animator.Queue(this.overlay,js_animation.overlay_in,{instant:!0,applyOnEnd:!0}).getPromise()),Promise.all(d).then(()=>{this.dom.classList.remove("wwise-perspective")})}return Promise.resolve()}close(o){if(!this.opened)return;this.opened=!1;let c=o?"min":this.options.animation;if(this.overlay&&(this.overlay.removeEventListener("click",this.overlayClickHandler),this.overlay.removeEventListener("touchstart",this.overlayClickHandler)),c){c!="min"&&c!="flip"||this.dom.classList.add("wwise-perspective");let d=[new animator.Queue(this.wrapper,js_animation[c+"_out"],{instant:!0,applyOnEnd:!0}).getPromise()];return this.options.overlay&&!this.options.keepOverlay&&d.push(new animator.Queue(this.overlay,js_animation.overlay_out,{instant:!0,applyOnEnd:!0}).getPromise()),Promise.all(d).then(()=>{this.removeDoms(),this.dom.classList.remove("wwise-perspective"),this.promiseResolve()})}return this.removeDoms(),this.promiseResolve(),Promise.resolve()}min(){return this.close(!0)}resume(){return this.open(!0)}getPromise(){return this.promise}appendDoms(){this.options.overlay&&!this.hasOverlay&&(utility.appendToBody(this.overlay),document.body.classList.add("wwise-no-scroll"),this.overlay.addEventListener("touchstart",o=>{o.preventDefault()})),utility.appendToBody(this.dom)}removeDoms(){utility.removeElement(this.dom),!this.options.keepOverlay&&this.overlay&&(utility.removeElement(this.overlay),document.body.classList.remove("wwise-no-scroll"))}draggable(o=!0){this.topbar&&(o?(this.draggableMouseMoveHandler=this.handleDraggableMouseMove.bind(this),this.draggableMouseDownHandler=this.handleDraggableMouseDown.bind(this),this.draggableMouseUpHandler=this.handleDraggableMouseUp.bind(this),this.draggableMouseOutHandler=this.handleDraggableMouseOut.bind(this),window.addEventListener("mousemove",this.draggableMouseMoveHandler),window.addEventListener("mouseout",this.draggableMouseOutHandler),this.topbar.addEventListener("mousedown",this.draggableMouseDownHandler),window.addEventListener("mouseup",this.draggableMouseUpHandler)):(window.removeEventListener("mousemove",this.draggableMouseMoveHandler),window.removeEventListener("mouseout",this.draggableMouseOutHandler),this.topbar.removeEventListener("mousedown",this.draggableMouseDownHandler),window.removeEventListener("mouseup",this.draggableMouseUpHandler)))}handleDraggableMouseMove(o){if(this.inDragging){let c={x:o.clientX-this.dragPrev.x,y:o.clientY-this.dragPrev.y},d=window.getComputedStyle(this.wrapper),_=this.options.draggable,b=parseFloat(d.left),_e=parseFloat(d.top);if(d.left.indexOf("%")!=-1){b=d.left,b=b.substr(0,b.length-1),b=parseInt(b);let it=window,nt=document,at=nt.documentElement,ut=nt.getElementsByTagName("body")[0];b=b*(it.innerWidth||at.clientWidth||ut.clientWidth)/100}if(d.top.indexOf("%")!=-1){_e=d.top,_e=_e.substr(0,_e.length-1),_e=parseInt(_e);let it=window,nt=document,at=nt.documentElement,ut=nt.getElementsByTagName("body")[0];_e=_e*(it.innerHeight||at.clientHeight||ut.clientHeight)/100}_!=1&&_!="horizontal"||(this.wrapper.style.left=b+c.x+"px"),_!=1&&_!="vertical"||(this.wrapper.style.top=_e+c.y+"px"),this.dragPrev={x:o.clientX,y:o.clientY}}}handleDraggableMouseDown(o){this.inDragging=!0,this.dragPrev={x:o.clientX,y:o.clientY}}handleDraggableMouseUp(o){this.inDragging=!1}handleDraggableMouseOut(o){let c=o.relatedTarget;c&&c.nodeName!="HTML"||(this.inDragging=!1)}}var js_window=Window;class Modal{constructor(o){let c=this.options=o;!c.type&&(c.type="ok");let d={topbar:!1};d.content=this.constructContent({type:c.type,title:c.title,text:c.text,content:c.content,buttons:c.buttons}),d.overlay=!0,d.keepOverlay=c.keepOverlay,d.clickOverlayToClose=!1,d.animation=c.animation,d.zIndex=c.zIndex,this.wwise=new js_window(d)}constructContent(o){let c=utility.createDiv("modal"),d=utility.createDomTree({dom:utility.createDiv("main "+o.type),children:[utility.createDiv(null,utility.makeIconHTML(o.type)),utility.createDiv("title",o.title),utility.createDiv("text",o.text)]});this.buttonArr=utility.standardizeButtons(this,o);let _=utility.makeButtons(this.buttonArr),b=null;o.content&&(b=typeof o.content=="string"?utility.createDiv(null,o.content):o.content);let _e=null;return _.innerHTML&&(_e=utility.createDomTree({dom:utility.createDiv("operation "+o.type),children:[_]})),b||_e||d.classList.add("no-op"),utility.createDomTree({dom:c,children:[d,b,_e]})}open(){if(this.wwise.opened)return;let o=this.wwise.open();return this.value=void 0,this.promise=new Promise(c=>{this.promiseResolve=c}),this.wwise.getPromise().then(this.handlePromiseResolve.bind(this)),this.keyHandler=utility.bindButtonKeyEvents(this.buttonArr),this.options.closeAfter&&window.setTimeout(()=>{this.close("timer")},this.options.closeAfter),o}close(o){if(this.wwise.opened)return this.value=o,utility.unbindButtonKeyEvents(this.keyHandler),this.wwise.close()}getPromise(){return this.promise}handlePromiseResolve(){this.promiseResolve(this.value)}}var js_modal=Modal;let input_defaultOptions={showCancel:!1,okText:"OK",cancelText:"Cancel",placeholder:"",validator:null},defaultWwiseOptions={type:"info",keepOverlay:!1,title:"Input",text:"",zIndex:null};class Input{constructor(o){this.options=JSON.parse(JSON.stringify(input_defaultOptions));for(let b in o)o[b]!=null&&(this.options[b]=o[b]);let c=this.options,d=JSON.parse(JSON.stringify(defaultWwiseOptions));for(let b in d)c.hasOwnProperty(b)&&(d[b]=c[b]);let _=[];c.showCancel&&_.push({key:27,text:c.cancelText,normal:!0,onClick:this.handleCancel.bind(this)}),_.push({key:13,text:c.okText,onClick:this.handleOk.bind(this)}),d.buttons=_,this.input=utility.createElement("input","input",null,{placeholder:c.placeholder}),this.error=utility.createDiv("error"),d.content=utility.createDomTree({dom:utility.createDiv("input-wrapper"),children:[this.input,this.error]}),this.modal=new js_modal(d)}handleCancel(){this.close().then(this.promiseReject.bind(this))}handleOk(){this.options.validator?this.options.validator(this.input.value).then(()=>{this.close().then(this.promiseResolve.bind(this,this.input.value))},o=>{this.error.innerText=o}):this.close().then(this.promiseResolve.bind(this,this.input.value))}open(){if(this.modal.wwise.opened)return;let o=this.modal.open();return this.input.value="",this.error.innerText="",this.input.focus(),this.promise=new Promise((c,d)=>{this.promiseResolve=c,this.promiseReject=d}),o}close(){if(this.modal.wwise.opened)return this.modal.close()}getPromise(){return this.promise}}var input=Input,windowise=__webpackgi_require__(160),windowise_exported={};windowise.A&&windowise.A.locals&&(windowise_exported.locals=windowise.A.locals);var windowise_refs=0,windowise_update,windowise_options={};windowise_options.styleTagTransform=styleTagTransform_default(),windowise_options.setAttributes=setAttributesWithoutAttributes_default(),windowise_options.insert=function(h,o){(o.target||document.head).appendChild(h)},windowise_options.domAPI=styleDomAPI_default(),windowise_options.insertStyleElement=insertStyleElement_default(),windowise_exported.use=function(h){return windowise_options.options=h||{},windowise_refs++||(windowise_update=injectStylesIntoStyleTag_default()(windowise.A,windowise_options)),windowise_exported},windowise_exported.unuse=function(){windowise_refs>0&&!--windowise_refs&&(windowise_update(),windowise_update=null)};var ui_windowise=windowise_exported;class WindowiseDialogPlugin extends AViewerPlugin{constructor(){super(...arguments),this.enabled=!0,this.toJSON=void 0,this._previousMappings={}}async onAdded(o){await super.onAdded(o),this._previousMappings={alert:o.alert,confirm:o.confirm,prompt:o.prompt},utility.appendToBody=c=>{c.style.zIndex="350",o.container.appendChild(c)},utility.makeIconHTML=c=>"",ui_windowise.use({target:o.container}),o.alert=async c=>{const d=c==null?void 0:c.split(":")[0],_=new js_modal({type:"info",title:d??"&ndsp;",text:(c==null?void 0:c.replace(d+":","").replace(/(\r?\n)/gm,"<br>"))||"",buttons:[{key:13,text:"OK",type:"main",id:"ok"}],animation:"overlay"});return _.open(),_.getPromise()},o.confirm=async c=>{const d=c==null?void 0:c.split(":")[0],_=new js_modal({type:"info",title:d??"&ndsp;",text:(c==null?void 0:c.replace(d||"","").replace(":",""))||"",buttons:[{id:"no",key:27,text:"No",normal:!0},{id:"yes",key:13,text:"Yes"}],animation:"overlay"});return _.open(),await _.getPromise()==="yes"},o.prompt=async(c,d,_=!0)=>{const b=c==null?void 0:c.split(":")[0],_e=new input({type:"info",title:b??"&ndsp;",placeholder:d??"",showCancel:_,animation:"overlay",text:(c==null?void 0:c.replace(b||"","").replace(":",""))||""});return _e.open(),await _e.getPromise().catch(async()=>null)}}async onRemove(o){return o.alert=this._previousMappings.alert,o.confirm=this._previousMappings.confirm,o.prompt=this._previousMappings.prompt,super.onRemove(o)}}WindowiseDialogPlugin.PluginType="WindowiseDialogPlugin";var editorModes=__webpackgi_require__(757),editorModes_exported={};editorModes.A&&editorModes.A.locals&&(editorModes_exported.locals=editorModes.A.locals);var editorModes_refs=0,editorModes_update,editorModes_options={};editorModes_options.styleTagTransform=styleTagTransform_default(),editorModes_options.setAttributes=setAttributesWithoutAttributes_default(),editorModes_options.insert=function(h,o){(o.target||document.head).appendChild(h)},editorModes_options.domAPI=styleDomAPI_default(),editorModes_options.insertStyleElement=insertStyleElement_default(),editorModes_exported.use=function(h){return editorModes_options.options=h||{},editorModes_refs++||(editorModes_update=injectStylesIntoStyleTag_default()(editorModes.A,editorModes_options)),editorModes_exported},editorModes_exported.unuse=function(){editorModes_refs>0&&!--editorModes_refs&&(editorModes_update(),editorModes_update=null)};var ui_editorModes=editorModes_exported;function setupModesStyles(){ui_editorModes.use(),tippy_js_dist_tippy.use()}async function setupModesUi(h,o=void 0,c=[]){var d,_;tippy_esm.setDefaultProps({theme:"editor",duration:300,arrow:!0,appendTo:()=>h.container});const b=ee$1({classList:["mode-buttons-container","button-bar"],addToBody:!0}),_e=ee$1({innerHTML:"",id:"webgi-logo",addToBody:!1});rt("logo-img")&&(_e.style.backgroundImage=`url(${rt("logo-img")})`),_e.onclick=()=>{window.open(rt("logo-link")||"https://webgi.xyz","_blank")};const it=`<svg xmlns="http://www.w3.org/2000/svg" style="width:100%; height:100%;" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path stroke-linecap="round" stroke-linejoin="round" d="M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4" />
</svg>`;h.container.appendChild(_e),tippy_esm(_e,{placement:"right",content:"Powered by WebGi SDK"});const nt=ee$1({innerHTML:it,id:"fsToggle",classList:["round-button"],addToBody:!1});nt.dataset.tippyContent="Full-Screen",(d=h.getPlugin(FullScreenPlugin))===null||d===void 0||d.addEventListener("enter",()=>{nt.innerHTML=`<svg xmlns="http://www.w3.org/2000/svg" style="width:100%; height:100%;" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path d="M9 19L9 15M9 15L5 15M9 15L4 20M15 15L20 20M15 15V19M15 15H19M15 5V9M15 9L19 9M15 9L20 4M9 5L9 9M9 9L5 9M9 9L4 4" stroke-linecap="round" stroke-linejoin="round"/>
</svg>`,nt.dataset.tippyContent="Exit Full-Screen"}),(_=h.getPlugin(FullScreenPlugin))===null||_===void 0||_.addEventListener("exit",()=>{nt.innerHTML=it,nt.dataset.tippyContent="Full-Screen"}),nt.onclick=()=>{var Ct;(Ct=h.getPlugin(FullScreenPlugin))===null||Ct===void 0||Ct.toggle(h.container)},h.container.appendChild(nt),tippy_esm(nt,{placement:"left"});const at=ee$1({classList:["button-bar","util-buttons-container"],addToBody:!1});h.container.appendChild(at);const ut=[{id:"reset-settings",icon:`<svg xmlns="http://www.w3.org/2000/svg" style="width:100%; height:100%;" fill="currentColor" viewBox="0 0 24 24">
 <path fill="currentColor" d="M19 8L15 12H18C18 15.31 15.31 18 12 18C11 18 10.03 17.75 9.2 17.3L7.74 18.76C8.97 19.54 10.43 20 12 20C16.42 20 20 16.42 20 12H23M6 12C6 8.69 8.69 6 12 6C13 6 13.97 6.25 14.8 6.7L16.26 5.24C15.03 4.46 13.57 4 12 4C7.58 4 4 7.58 4 12H1L5 16L9 12M14 12C14 13.11 13.11 14 12 14S10 13.11 10 12 10.9 10 12 10 14 10.9 14 12Z" />
</svg>`,tooltip:"Reset All Settings",onclick:async()=>{var Ct;if(!await h.confirm("Reset settings: Are you sure you want to reset all plugin settings?"))return;const Et=xt.map(Tt=>h.getPlugin(Tt));for(const Tt of Et)await((Ct=Tt==null?void 0:Tt.resetDefaults)===null||Ct===void 0?void 0:Ct.call(Tt))}},{id:"clear-scene",icon:`<svg xmlns="http://www.w3.org/2000/svg" style="width:100%; height:100%;" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
 <path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
</svg>`,tooltip:"Clear Scene",onclick:async()=>{await h.confirm("Clear scene: Are you sure you want to clear the scene?")&&h.scene.disposeSceneModels()}},{id:"fit-scene",icon:`<svg xmlns="http://www.w3.org/2000/svg" style="width:100%; height:100%;" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1">
    <path fill="currentColor" d="M17 12C17 7.55 11.62 5.31 8.46 8.46C5.31 11.61 7.55 17 12 17C14.76 17 17 14.76 17 12M12 15C9.33 15 8 11.77 9.88 9.88C11.77 8 15 9.33 15 12C15 13.66 13.66 15 12 15M5 15H3V19C3 20.1 3.9 21 5 21H9V19H5M5 5H9V3H5C3.9 3 3 3.9 3 5V9H5M19 3H15V5H19V9H21V5C21 3.9 20.1 3 19 3M19 19H15V21H19C20.1 21 21 20.1 21 19V15H19" />
</svg>`,tooltip:"Fit Object/Scene",onclick:async()=>{var Ct;await h.fitToView((Ct=h.getPlugin(PickingPlugin))===null||Ct===void 0?void 0:Ct.getSelectedObject())}},{id:"loop-cam-views",icon:`<svg xmlns="http://www.w3.org/2000/svg" style="width:100%; height:100%;" fill="currentColor" viewBox="0 0 24 24">
 <path fill="currentColor" d="M19 8L15 12H18C18 15.31 15.31 18 12 18C11 18 10.03 17.75 9.2 17.3L7.74 18.76C8.97 19.54 10.43 20 12 20C16.42 20 20 16.42 20 12H23M6 12C6 8.69 8.69 6 12 6C13 6 13.97 6.25 14.8 6.7L16.26 5.24C15.03 4.46 13.57 4 12 4C7.58 4 4 7.58 4 12H1L5 16L9 12M14 12C14 13.11 13.11 14 12 14S10 13.11 10 12 10.9 10 12 10 14 10.9 14 12Z" />
</svg>`,tooltip:"Loop Camera Views",toggle:!0,onclick:async()=>{h.getPlugin(CameraViewPlugin)&&(h.getPlugin(CameraViewPlugin).viewLooping=!h.getPlugin(CameraViewPlugin).viewLooping)}},{id:"play-gltf",icon:`<svg xmlns="http://www.w3.org/2000/svg" style="width:100%; height:100%;" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path stroke-linecap="round" stroke-linejoin="round" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z" />
  <path stroke-linecap="round" stroke-linejoin="round" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
</svg>`,tooltip:"GLTF Animations",toggle:!0,onclick:async()=>{var Ct;(Ct=h.getPlugin(GLTFAnimationPlugin))===null||Ct===void 0||Ct.playPauseAnimation()}},{id:"auto-rotate-cc",icon:`<svg xmlns="http://www.w3.org/2000/svg" style="width:100%; height:100%;" fill="currentColor" viewBox="0 0 24 24">
 <path fill="currentColor" d="M10,12L14,16L10,20V16.9C5.44,16.44 2,14.42 2,12C2,9.58 5.44,7.56 10,7.1V9.09C6.55,9.43 4,10.6 4,12C4,13.4 6.55,14.57 10,14.91V12M20,12C20,10.6 17.45,9.43 14,9.09V7.1C18.56,7.56 22,9.58 22,12C22,14.16 19.26,16 15.42,16.7L16.12,16L14.92,14.79C17.89,14.36 20,13.27 20,12M11,2H13V13L11,11V2M11,22V21L13,19V22H11Z" />
</svg>`,tooltip:"Auto rotate",toggle:!0,onclick:async()=>{const Ct=h.scene.activeCamera.controls;Ct&&Ct.autoRotate!==void 0&&(Ct.autoRotate=!Ct.autoRotate)}},{id:"snapshot",icon:`<svg xmlns="http://www.w3.org/2000/svg" style="width:100%; height:100%;" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path stroke-linecap="round" stroke-linejoin="round" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z" />
  <path stroke-linecap="round" stroke-linejoin="round" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z" />
</svg>`,tooltip:"Capture Snapshot",onclick:async()=>{const Ct=h.getPlugin(CanvasSnipperPlugin);Ct?await Ct.downloadSnapshot():h.console.error("CanvasSnipperPlugin not added")}},{id:"glb-export",icon:`<svg xmlns="http://www.w3.org/2000/svg" style="width:100%; height:100%;" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path stroke-linecap="round" stroke-linejoin="round" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
</svg>`,tooltip:"Export GLB",onclick:async()=>{const Ct=h.getPlugin(AssetExporterPlugin);Ct?await(Ct==null?void 0:Ct.downloadSceneGlb()):h.console.error("AssetExporterPlugin not added")}}];for(const Ct of ut){const Et=ee$1({innerHTML:Ct.icon,id:Ct.id,classList:["button-bar-button","util-button"],addToBody:!1});Et.dataset.tippyContent=Ct.tooltip,Et.onclick=()=>{Ct.toggle&&Et.classList.toggle("button-bar-selected-box"),Ct.onclick()},at.appendChild(Et)}createSingleton(tippy_esm(".util-button"),{moveTransition:"transform 0.2s ease-out",placement:"top"});const pt=h.getPlugin(PickingPlugin),mt=h.getPlugin(InteractionPromptPlugin);for(const[Ct,Et]of Object.entries(o??{})){const Tt=c.find(kt=>kt.title===Ct);Tt?Tt.plugins.push(...Et):c.push({title:Ct,plugins:[...Et]})}let ft=c[2],vt=[];const xt=c.reduce((Ct,Et)=>Ct.concat(Et.plugins),[]);function At(Ct,Et=!0){var Tt;ft=Ct,pt&&(pt.enabled=!0),mt&&(["Plugins"].includes(ft.title)?mt.enable("modesUi"):mt.disable("modesUi")),vt=[];for(const kt of xt){const Dt=h.getPlugin(kt);if(!(Dt!=null&&Dt.uiConfig))continue;const zt=Ct.plugins.includes(kt);S$2(Dt.uiConfig,"hidden",!zt,!0),zt&&vt.push(Dt)}for(const kt of c)(Tt=kt.div)===null||Tt===void 0||Tt.classList[ft!==kt?"remove":"add"]("mode-button-selected","button-bar-selected");h.getPlugin(TweakpaneUiPlugin).refreshPluginsEnabled(),Et&&window.dispatchEvent(new CustomEvent("webgi_editorModeChanged",{detail:{mode:Ct}}))}for(const Ct of c){const Et=ee$1({innerHTML:Ct.title,classList:["mode-button","button-bar-button"]});Et.onclick=()=>{At(Ct)},Ct.div=Et,b.appendChild(Et)}At(c[0]),window.webgi_setEditorMode=At,window.webgi_editorModes=c,pt==null||pt.addEventListener("selectedObjectChanged",()=>{pt!=null&&pt.getSelectedObject()&&!["Picking","Modifiers","Configurators"].includes(ft.title)&&At(c.find(Ct=>Ct.plugins.includes(PickingPlugin)))})}class ExtrasUiPlugin extends AViewerPlugin{constructor(){super(...arguments),this.enabled=!0,this.toJSON=void 0,this.showColorScheme=!0,this.uiConfig={type:"folder",label:"Extras",limitedUi:!1,children:[()=>this.showColorScheme?{label:"Color Scheme",type:"dropdown",children:["black","white","blue"].map(o=>({label:o})),getValue:()=>{var o,c;return(c=(o=this._viewer)===null||o===void 0?void 0:o.getPluginByType("TweakpaneUi"))===null||c===void 0?void 0:c.colorMode},setValue:o=>{var c;const d=(c=this._viewer)===null||c===void 0?void 0:c.getPluginByType("TweakpaneUi");d&&(d.colorMode=o)}}:void 0,()=>({label:"Shadow type",type:"dropdown",children:[["Basic",three_module.bTm],["PCF",three_module.QP0],["PCFSoft",three_module.Wk7],["VSM",three_module.RyA]].map(o=>({label:o[0],value:o[1]})),getValue:()=>{var o;return(o=this._viewer)===null||o===void 0?void 0:o.renderer.rendererObject.shadowMap.type},setValue:o=>{var c;(c=this._viewer)===null||c===void 0||c.doOnce("postFrame",()=>{this._viewer&&(this._viewer.renderer.rendererObject.shadowMap.type=o,this._viewer.renderer.resetShadows(),this._viewer.renderer.reset(),this._viewer.scene.setDirty({sceneUpdate:!0,frameFade:!1}),this._viewer.setDirty())})}}),()=>{var o;return{label:(!((o=this._viewer)===null||o===void 0)&&o.useRgbm?"Disable":"Enable")+" RGBM",type:"button",value:async()=>{var c,d;await((c=this._viewer)===null||c===void 0?void 0:c.confirm("Edit Extras: This will reload the webpage. Are you sure?"))&&st("rgbm",!((d=this._viewer)===null||d===void 0)&&d.useRgbm?"no":"yes",!0)}}},()=>{var o;return{label:(!((o=this._viewer)===null||o===void 0)&&o.isAntialiased?"Disable":"Enable")+" MSAA",type:"button",value:async()=>{var c,d;await((c=this._viewer)===null||c===void 0?void 0:c.confirm("Edit Extras: This will reload the webpage. Are you sure?"))&&st("msaa",!((d=this._viewer)===null||d===void 0)&&d.isAntialiased?"no":"yes",!0)}}},()=>{var o;return{label:(!((o=this._viewer)===null||o===void 0)&&o.useGBufferDepth?"Disable":"Enable")+" Depth(z) Prepass",type:"button",value:async()=>{var c,d;await((c=this._viewer)===null||c===void 0?void 0:c.confirm("Edit Extras: This will reload the webpage. Are you sure?"))&&st("depthPrepass",!((d=this._viewer)===null||d===void 0)&&d.useGBufferDepth?"no":"yes",!0)}}},()=>{var o;return{label:(!((o=this._viewer)===null||o===void 0)&&o.getPluginByType("debug")?"Disable":"Enable")+" Debug",type:"button",value:async()=>{var c,d;await((c=this._viewer)===null||c===void 0?void 0:c.confirm("Edit Extras: This will reload the webpage. Are you sure?"))&&st("debug",!((d=this._viewer)===null||d===void 0)&&d.getPluginByType("debug")?null:"true",!0)}}},{label:"Clear local storage",type:"button",value:async()=>{var o;await((o=this._viewer)===null||o===void 0?void 0:o.confirm("Edit Extras: This will clear all local storage. Are you sure?"))&&localStorage.clear()}},{label:"Clear caches",type:"button",value:async()=>{var o,c;const d=(c=(o=this._viewer)===null||o===void 0?void 0:o.getPlugin(AssetManagerPlugin))===null||c===void 0?void 0:c.storage;if(d instanceof Storage)d.clear();else if(d instanceof Cache){const _=await d.keys();await Promise.all(_.map(async b=>d.delete(b)))}localStorage.clear()}},{label:"Auto GPU instance all",type:"button",value:()=>{var o;const c=new Set;(o=this._viewer)===null||o===void 0||o.scene.modelRoot.traverse(d=>d.geometry&&c.add(d.geometry)),c.forEach(d=>autoGPUInstanceMeshes(d))}},{label:"Auto Center All Geometries",type:"button",value:()=>{var o;const c=new Set;(o=this._viewer)===null||o===void 0||o.scene.modelRoot.traverse(d=>d.geometry&&c.add(d.geometry)),c.forEach(d=>{const _=new three_module.Pq0;d.center(_),_.negate();const b=d.userData.__appliedMeshes;b||console.error("No meshes found for geometry",d),b==null||b.forEach(_e=>{_e.updateMatrix(),_e.position.copy(_).applyMatrix4(_e.matrix),_e.setDirty&&_e.setDirty()})})}}]}}}ExtrasUiPlugin.PluginType="ExtrasUiPlugin1";var AHelperWidget_decorate=function(h,o,c,d){var _,b=arguments.length,_e=b<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_e=Reflect.decorate(h,o,c,d);else for(var it=h.length-1;it>=0;it--)(_=h[it])&&(_e=(b<3?_(_e):b>3?_(o,c,_e):_(o,c))||_e);return b>3&&_e&&Object.defineProperty(o,c,_e),_e};class AHelperWidget extends three_module.B69{constructor(o){super(),this.modelObject=this,this.assetType="widget",this.visible=!0,this.uiConfig=generateUiFolder("Widget",this),this.object=o,this.object.updateMatrixWorld(),this.object.updateProjectionMatrix&&this.object.updateProjectionMatrix(),this.matrix=o.matrixWorld,this.matrixAutoUpdate=!1,this._objectUpdate=this._objectUpdate.bind(this),this.attach(o),this.traverse(c=>{c.userData.__keepShadowDef=!0,c.castShadow=!1,c.receiveShadow=!1})}dispose(){this.detach()}_objectUpdate(){this.object&&this.update()}attach(o){var c,d;return this.object&&this.detach(),this.object=o,this.object&&(this.update(),this.object.addEventListener("objectUpdate",this._objectUpdate),this.object.addEventListener("dispose",this.dispose),this.uiConfig&&((d=(c=this.object.uiConfig)===null||c===void 0?void 0:c.children)===null||d===void 0||d.push(this.uiConfig)),this.visible=!0),this}detach(){var o,c,d,_;if(this.object){if(this.object.removeEventListener("objectUpdate",this._objectUpdate),this.object.removeEventListener("dispose",this.dispose),this.uiConfig){const b=(c=(o=this.object.uiConfig)===null||o===void 0?void 0:o.children)===null||c===void 0?void 0:c.indexOf(this.uiConfig);b!==void 0&&b>=0&&((_=(d=this.object.uiConfig)===null||d===void 0?void 0:d.children)===null||_===void 0||_.splice(b,1))}this.object=void 0,this.visible=!1}return this}}AHelperWidget_decorate([uiToggle()],AHelperWidget.prototype,"visible",void 0);class ALightHelperWidget extends AHelperWidget{constructor(o){super(o),this.light=o,this.traverse(c=>{c.userData.__keepShadowDef=!0,c.castShadow=!1,c.receiveShadow=!1})}}var DirectionalLightHelper2_decorate=function(h,o,c,d){var _,b=arguments.length,_e=b<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_e=Reflect.decorate(h,o,c,d);else for(var it=h.length-1;it>=0;it--)(_=h[it])&&(_e=(b<3?_(_e):b>3?_(o,c,_e):_(o,c))||_e);return b>3&&_e&&Object.defineProperty(o,c,_e),_e};class DirectionalLightHelper2 extends ALightHelperWidget{constructor(o,c,d){super(o),this.lineWidth=5,this.size=.5,this._v1=new three_module.Pq0,this._v2=new three_module.Pq0,this._v3=new three_module.Pq0,this.color=d,c!==void 0&&(this.size=c);let _=new LineGeometry;this.material=new LineMaterial({color:16711680,linewidth:.005,vertexColors:!1,dashed:!1,alphaToCoverage:!0,toneMapped:!1,transparent:!0,depthTest:!1,depthWrite:!1}),this.lightPlane=new Line2(_,this.material),this.add(this.lightPlane),_=new LineGeometry,_.setPositions([0,0,0,0,0,1]),this.targetLine=new Line2(_,this.material),this.add(this.targetLine),this.update(),this.traverse(b=>{b.userData.__keepShadowDef=!0,b.castShadow=!1,b.receiveShadow=!1})}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose(),super.dispose()}update(){var o;this.light&&this.lightPlane&&(this._v1.setFromMatrixPosition(this.light.matrixWorld),this._v2.setFromMatrixPosition(this.light.target.matrixWorld),this._v3.subVectors(this._v2,this._v1),this.lightPlane.geometry.setPositions([-this.size,this.size,0,this.size,this.size,0,this.size,-this.size,0,-this.size,-this.size,0,-this.size,this.size,0]),this.lightPlane.lookAt(this._v2),this.lightPlane.material=this.material,this.targetLine.material=this.material,this.material.color.set((o=this.color)!==null&&o!==void 0?o:this.light.color),this.material.linewidth=.001*this.lineWidth,this.targetLine.lookAt(this._v2),this.targetLine.scale.z=this.light.intensity/3)}static Check(o){return o.isDirectionalLight}static Create(o){return new DirectionalLightHelper2(o)}}DirectionalLightHelper2_decorate([x$1(DirectionalLightHelper2.prototype.update)],DirectionalLightHelper2.prototype,"material",void 0),DirectionalLightHelper2_decorate([x$1(DirectionalLightHelper2.prototype.update),uiSlider(void 0,[.1,20],.01)],DirectionalLightHelper2.prototype,"lineWidth",void 0),DirectionalLightHelper2_decorate([x$1(DirectionalLightHelper2.prototype.update),uiSlider(void 0,[.01,10],.01)],DirectionalLightHelper2.prototype,"size",void 0);var PointLightHelper2_decorate=function(h,o,c,d){var _,b=arguments.length,_e=b<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_e=Reflect.decorate(h,o,c,d);else for(var it=h.length-1;it>=0;it--)(_=h[it])&&(_e=(b<3?_(_e):b>3?_(o,c,_e):_(o,c))||_e);return b>3&&_e&&Object.defineProperty(o,c,_e),_e};class PointLightHelper2 extends ALightHelperWidget{constructor(o,c,d){super(o),this.lineWidth=5,this.size=.5,this.color=d,c!==void 0&&(this.size=c);const _=new WireframeGeometry2(new three_module.Gu$(.5,4,2));this.material=new LineMaterial({color:16711680,linewidth:.005,vertexColors:!1,dashed:!1,alphaToCoverage:!0,toneMapped:!1,transparent:!0,depthTest:!1,depthWrite:!1}),this.lightSphere=new Wireframe(_,this.material),this.lightSphere.computeLineDistances(),this.add(this.lightSphere),this.update(),this.traverse(b=>{b.userData.__keepShadowDef=!0,b.castShadow=!1,b.receiveShadow=!1})}dispose(){this.lightSphere.geometry.dispose(),this.lightSphere.material.dispose(),super.dispose()}update(){var o;this.light&&this.lightSphere&&(this.material.color.set((o=this.color)!==null&&o!==void 0?o:this.light.color),this.material.linewidth=.001*this.lineWidth,this.lightSphere.scale.setScalar(this.size))}static Check(o){return o.isPointLight}static Create(o){return new PointLightHelper2(o)}}PointLightHelper2_decorate([x$1(PointLightHelper2.prototype.update)],PointLightHelper2.prototype,"material",void 0),PointLightHelper2_decorate([x$1(PointLightHelper2.prototype.update),uiSlider(void 0,[.1,20],.01)],PointLightHelper2.prototype,"lineWidth",void 0),PointLightHelper2_decorate([x$1(PointLightHelper2.prototype.update),uiSlider(void 0,[.01,10],.01)],PointLightHelper2.prototype,"size",void 0);var SpotLightHelper2_decorate=function(h,o,c,d){var _,b=arguments.length,_e=b<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_e=Reflect.decorate(h,o,c,d);else for(var it=h.length-1;it>=0;it--)(_=h[it])&&(_e=(b<3?_(_e):b>3?_(o,c,_e):_(o,c))||_e);return b>3&&_e&&Object.defineProperty(o,c,_e),_e};class SpotLightHelper2 extends ALightHelperWidget{constructor(o,c,d){super(o),this.lineWidth=5,this._v1=new three_module.Pq0,this.color=d;let _=new LineSegmentsGeometry;const b=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let _e=0,it=1,nt=32;_e<nt;_e++,it++){const at=_e/nt*Math.PI*2,ut=it/nt*Math.PI*2;b.push(Math.cos(at),Math.sin(at),1,Math.cos(ut),Math.sin(ut),1)}_.setPositions(b),this.material=new LineMaterial({color:16711680,linewidth:.005,vertexColors:!1,dashed:!1,alphaToCoverage:!0,toneMapped:!1,transparent:!0,depthTest:!1,depthWrite:!1}),this.cone=new LineSegments2(_,this.material),this.add(this.cone),_=new LineGeometry,_.setPositions([0,0,0,0,0,1]),this.update(),this.traverse(_e=>{_e.userData.__keepShadowDef=!0,_e.castShadow=!1,_e.receiveShadow=!1})}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose(),super.dispose()}update(){var o;if(!this.light||!this.cone)return;this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1);const c=this.light.distance?this.light.distance:1e3,d=c*Math.tan(this.light.angle);this.cone.scale.set(d,d,c),this._v1.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(this._v1),this.material.color.set((o=this.color)!==null&&o!==void 0?o:this.light.color),this.material.linewidth=.001*this.lineWidth}static Check(o){return o.isSpotLight}static Create(o){return new SpotLightHelper2(o)}}SpotLightHelper2_decorate([x$1(SpotLightHelper2.prototype.update)],SpotLightHelper2.prototype,"material",void 0),SpotLightHelper2_decorate([x$1(SpotLightHelper2.prototype.update),uiSlider(void 0,[.1,20],.01)],SpotLightHelper2.prototype,"lineWidth",void 0);class ACameraHelperWidget extends AHelperWidget{constructor(o){super(o),this.camera=o,this.traverse(c=>{c.userData.__keepShadowDef=!0,c.castShadow=!1,c.receiveShadow=!1})}}class CameraHelper2 extends ACameraHelperWidget{constructor(o){super(o),this._vector=new three_module.Pq0,this._camera=new three_module.i7d;const c=new LineSegmentsGeometry,d=new LineMaterial({color:16777215,linewidth:.005,vertexColors:!0,dashed:!1,alphaToCoverage:!0,toneMapped:!1,transparent:!0,depthTest:!1,depthWrite:!1}),{vertices:_,colors:b,pointMap:_e}=generateVertices();c.setPositions(_),c.setColors(b),this.line=new LineSegments2(c,d),this.line.frustumCulled=!1,this.add(this.line),this.pointMap=_e,this.update();const it=new three_module.Q1f(16755200),nt=new three_module.Q1f(16711680),at=new three_module.Q1f(43775),ut=new three_module.Q1f(16777215),pt=new three_module.Q1f(3355443);this.setColors(it,nt,at,ut,pt)}setColors(o,c,d,_,b){const _e=this.line.geometry,it=_e.getAttribute("instanceColorStart"),nt=_e.getAttribute("instanceColorEnd");function at(ut,pt){it.setXYZ(ut/2,pt.r,pt.g,pt.b),nt.setXYZ(ut/2,pt.r,pt.g,pt.b)}at(0,o),at(2,o),at(4,o),at(6,o),at(8,o),at(10,o),at(12,o),at(14,o),at(16,o),at(18,o),at(20,o),at(22,o),at(24,c),at(26,c),at(28,c),at(30,c),at(32,d),at(34,d),at(36,d),at(38,_),at(40,b),at(42,b),at(44,b),at(46,b),at(48,b),it.needsUpdate=!0,nt.needsUpdate=!0}update(){if(!this.camera)return;const o=this.line.geometry,c=this.pointMap,{_camera:d,_vector:_}=this;d.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),setPoint("c",c,o,d,0,0,-1,_),setPoint("t",c,o,d,0,0,1,_),setPoint("n1",c,o,d,-1,-1,-1,_),setPoint("n2",c,o,d,1,-1,-1,_),setPoint("n3",c,o,d,-1,1,-1,_),setPoint("n4",c,o,d,1,1,-1,_),setPoint("f1",c,o,d,-1,-1,1,_),setPoint("f2",c,o,d,1,-1,1,_),setPoint("f3",c,o,d,-1,1,1,_),setPoint("f4",c,o,d,1,1,1,_),setPoint("u1",c,o,d,.7,1.1,-1,_),setPoint("u2",c,o,d,-.7,1.1,-1,_),setPoint("u3",c,o,d,0,2,-1,_),setPoint("cf1",c,o,d,-1,0,1,_),setPoint("cf2",c,o,d,1,0,1,_),setPoint("cf3",c,o,d,0,-1,1,_),setPoint("cf4",c,o,d,0,1,1,_),setPoint("cn1",c,o,d,-1,0,-1,_),setPoint("cn2",c,o,d,1,0,-1,_),setPoint("cn3",c,o,d,0,-1,-1,_),setPoint("cn4",c,o,d,0,1,-1,_),o.getAttribute("instanceStart").needsUpdate=!0,o.getAttribute("instanceEnd").needsUpdate=!0,o.computeBoundingBox(),o.computeBoundingSphere()}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),super.dispose()}static Check(o){return o.isCamera}static Create(o){return new CameraHelper2(o)}}function setPoint(h,o,c,d,_,b,_e,it){it.set(_,b,_e).unproject(d);const nt=o[h];if(nt!==void 0){const at=c.getAttribute("instanceStart"),ut=c.getAttribute("instanceEnd");for(let pt=0,mt=nt.length;pt<mt;pt++){const ft=Math.floor(nt[pt]/2);(nt[pt]%2==0?at:ut).setXYZ(ft,it.x,it.y,it.z)}}}function generateVertices(){const h=[],o=[],c={};function d(b,_e){_(b),_(_e)}function _(b){h.push(0,0,0),o.push(0,0,0),c[b]===void 0&&(c[b]=[]),c[b].push(h.length/3-1)}return d("n1","n2"),d("n2","n4"),d("n4","n3"),d("n3","n1"),d("f1","f2"),d("f2","f4"),d("f4","f3"),d("f3","f1"),d("n1","f1"),d("n2","f2"),d("n3","f3"),d("n4","f4"),d("p","n1"),d("p","n2"),d("p","n3"),d("p","n4"),d("u1","u2"),d("u2","u3"),d("u3","u1"),d("c","t"),d("p","c"),d("cn1","cn2"),d("cn3","cn4"),d("cf1","cf2"),d("cf3","cf4"),{vertices:h,colors:o,pointMap:c}}var Object3DWidgetsPlugin_decorate=function(h,o,c,d){var _,b=arguments.length,_e=b<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_e=Reflect.decorate(h,o,c,d);else for(var it=h.length-1;it>=0;it--)(_=h[it])&&(_e=(b<3?_(_e):b>3?_(o,c,_e):_(o,c))||_e);return b>3&&_e&&Object.defineProperty(o,c,_e),_e};class Object3DWidgetsPlugin extends AViewerPlugin{setDirty(){var o,c;(o=this.widgets)===null||o===void 0||o.forEach(d=>d.visible=this.enabled),(c=this._viewer)===null||c===void 0||c.setDirty()}constructor(o=!0){super(),this.enabled=!0,this.helpers=[DirectionalLightHelper2,SpotLightHelper2,PointLightHelper2,CameraHelper2],this.toJSON=null,this._addSceneObject=c=>{const d=c.object;this._createWidgets(d==null?void 0:d.modelObject)},this.widgets=[],this.uiConfig={type:"folder",label:"Widgets",children:[{type:"checkbox",label:"Visible",property:[this,"enabled"]},{type:"button",label:"Refresh",value:()=>this.refresh()}]},this.enabled=o}async onAdded(o){await super.onAdded(o),o.scene.addEventListener("addSceneObject",this._addSceneObject)}async onRemove(o){return o.scene.removeEventListener("addSceneObject",this._addSceneObject),this.widgets.forEach(c=>c.dispose&&c.dispose()),this.widgets=[],super.onRemove(o)}refresh(){var o;this._createWidgets((o=this._viewer)===null||o===void 0?void 0:o.scene.modelRoot)}_createWidgets(o){o==null||o.traverse(c=>{const d=this.widgets.find(_=>_.object===c);if(d)return void(d.update&&d.update());this.helpers.filter(_=>_.Check(c)).forEach(_=>{var b;const _e=_.Create(c);_e.visible=this.enabled,this.widgets.push(_e),(b=this._viewer)===null||b===void 0||b.scene.addWidget(_e)})})}}Object3DWidgetsPlugin.PluginType="WidgetsPlugin",Object3DWidgetsPlugin_decorate([x$1(Object3DWidgetsPlugin.prototype.setDirty)],Object3DWidgetsPlugin.prototype,"enabled",void 0);var popper_lite_defaultModifiers=[eventListeners,modifiers_popperOffsets,modifiers_computeStyles,modifiers_applyStyles],popper_lite_createPopper=popperGenerator({defaultModifiers:popper_lite_defaultModifiers}),object_hash=__webpackgi_require__(516),object_hash_default=__webpackgi_require__.n(object_hash);function removeDuplicateGeometries(h){const o=[];h.traverse(_=>{_.geometry&&o.push(_)});const c={},d={};o.forEach(_=>{var b;if(!c[_.geometry.uuid]){const nt=_.geometry.toJSON().data,at=nt?object_hash_default()({a:nt.attributes||{},b:nt.index||[]}):"";c[_.geometry.uuid]=at}const _e=c[_.geometry.uuid],it=(b=d[_e])!==null&&b!==void 0?b:d[_e]=[];it.includes(_)||it.push(_)}),Object.values(d).forEach(_=>{if(_.length<2)return;const b=_[0].geometry;_.forEach((_e,it)=>{it<1||(_e.geometry.dispose(),_e.geometry=b)})})}const offset2=new three_module.Pq0,targetDeltaX=new three_module.Pq0,targetDeltaY=new three_module.Pq0,targetDeltaZ=new three_module.Pq0,targetDelta=new three_module.Pq0,panOffset2=new three_module.Pq0;let scaleOffset=1;const upVec=new three_module.Pq0(0,1,0);class OrbitControls2 extends OrbitControls{constructor(o,c){super(o,c),this.throttleUpdate=60,this.targetOffset=new three_module.Pq0(0,0,0);const d=this.update;this.update=()=>this._update(d)}_update(o){this.target.add(this.targetOffset),offset2.copy(this.object.position).sub(this.target),scaleOffset=offset2.length(),panOffset2.copy(this.target);const c=o();return panOffset2.sub(this.target),offset2.copy(this.object.position).sub(this.target),scaleOffset/=offset2.length(),this.target.add(panOffset2),this.object.position.copy(this.target).add(offset2),offset2.normalize(),targetDeltaX.crossVectors(upVec,offset2).normalize(),targetDeltaY.crossVectors(offset2,targetDeltaX).normalize(),targetDeltaZ.crossVectors(targetDeltaX,targetDeltaY).normalize().negate(),targetDeltaX.length()>.1&&this.object.up.crossVectors(offset2.clone().normalize(),targetDeltaX),this.enablePan&&(targetDelta.set(0,0,0).addScaledVector(targetDeltaX,panOffset2.x).addScaledVector(targetDeltaY,panOffset2.y).addScaledVector(targetDeltaZ,panOffset2.z),this.targetOffset.add(targetDelta),this.targetOffset.multiplyScalar(1/scaleOffset)),targetDelta.set(0,0,0).addScaledVector(targetDeltaX,-this.targetOffset.x).addScaledVector(targetDeltaY,-this.targetOffset.y).addScaledVector(targetDeltaZ,-this.targetOffset.z),this.object.lookAt(targetDelta.add(this.target)),this.object.updateMatrixWorld(),this.object.isCamera&&this.object.updateProjectionMatrix(),this.target.sub(this.targetOffset),c}}const _raycaster=new three_module.tBo,_tempVector=new three_module.Pq0,_tempVector2=new three_module.Pq0,_tempQuaternion=new three_module.PTz,_unit={X:new three_module.Pq0(1,0,0),Y:new three_module.Pq0(0,1,0),Z:new three_module.Pq0(0,0,1)},TransformControls_changeEvent={type:"change"},_mouseDownEvent={type:"mouseDown"},_mouseUpEvent={type:"mouseUp",mode:null},_objectChangeEvent={type:"objectChange"};class TransformControls extends three_module.B69{constructor(o,c){super(),c===void 0&&(console.warn('THREE.TransformControls: The second parameter "domElement" is now mandatory.'),c=document),this.isTransformControls=!0,this.visible=!1,this.domElement=c,this.domElement.style.touchAction="none";const d=new TransformControlsGizmo;this._gizmo=d,this.add(d);const _=new TransformControlsPlane;this._plane=_,this.add(_);const b=this;function _e(Ct,Et){let Tt=Et;Object.defineProperty(b,Ct,{get:function(){return Tt!==void 0?Tt:Et},set:function(kt){Tt!==kt&&(Tt=kt,_[Ct]=kt,d[Ct]=kt,b.dispatchEvent({type:Ct+"-changed",value:kt}),b.dispatchEvent(TransformControls_changeEvent))}}),b[Ct]=Et,_[Ct]=Et,d[Ct]=Et}_e("camera",o),_e("object",void 0),_e("enabled",!0),_e("axis",null),_e("mode","translate"),_e("translationSnap",null),_e("rotationSnap",null),_e("scaleSnap",null),_e("space","world"),_e("size",1),_e("dragging",!1),_e("showX",!0),_e("showY",!0),_e("showZ",!0);const it=new three_module.Pq0,nt=new three_module.Pq0,at=new three_module.PTz,ut=new three_module.PTz,pt=new three_module.Pq0,mt=new three_module.PTz,ft=new three_module.Pq0,vt=new three_module.Pq0,xt=new three_module.Pq0,At=new three_module.Pq0;_e("worldPosition",it),_e("worldPositionStart",nt),_e("worldQuaternion",at),_e("worldQuaternionStart",ut),_e("cameraPosition",pt),_e("cameraQuaternion",mt),_e("pointStart",ft),_e("pointEnd",vt),_e("rotationAxis",xt),_e("rotationAngle",0),_e("eye",At),this._offset=new three_module.Pq0,this._startNorm=new three_module.Pq0,this._endNorm=new three_module.Pq0,this._cameraScale=new three_module.Pq0,this._parentPosition=new three_module.Pq0,this._parentQuaternion=new three_module.PTz,this._parentQuaternionInv=new three_module.PTz,this._parentScale=new three_module.Pq0,this._worldScaleStart=new three_module.Pq0,this._worldQuaternionInv=new three_module.PTz,this._worldScale=new three_module.Pq0,this._positionStart=new three_module.Pq0,this._quaternionStart=new three_module.PTz,this._scaleStart=new three_module.Pq0,this._getPointer=getPointer.bind(this),this._onPointerDown=onPointerDown.bind(this),this._onPointerHover=onPointerHover.bind(this),this._onPointerMove=onPointerMove.bind(this),this._onPointerUp=onPointerUp.bind(this),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointermove",this._onPointerHover),this.domElement.addEventListener("pointerup",this._onPointerUp)}updateMatrixWorld(){this.object!==void 0&&(this.object.updateMatrixWorld(),this.object.parent===null?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):this.object.parent.matrixWorld.decompose(this._parentPosition,this._parentQuaternion,this._parentScale),this.object.matrixWorld.decompose(this.worldPosition,this.worldQuaternion,this._worldScale),this._parentQuaternionInv.copy(this._parentQuaternion).invert(),this._worldQuaternionInv.copy(this.worldQuaternion).invert()),this.camera.updateMatrixWorld(),this.camera.matrixWorld.decompose(this.cameraPosition,this.cameraQuaternion,this._cameraScale),this.camera.isOrthographicCamera?this.camera.getWorldDirection(this.eye).negate():this.eye.copy(this.cameraPosition).sub(this.worldPosition).normalize(),super.updateMatrixWorld(this)}pointerHover(o){if(this.object===void 0||this.dragging===!0||o.buttons)return;_raycaster.setFromCamera(o,this.camera);const c=intersectObjectWithRay(this._gizmo.picker[this.mode],_raycaster);this.axis=c?c.object.name:null}pointerDown(o){if(this.object!==void 0&&this.dragging!==!0&&o.button===0&&this.axis!==null){_raycaster.setFromCamera(o,this.camera);const c=intersectObjectWithRay(this._plane,_raycaster,!0);c&&(this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),this._positionStart.copy(this.object.position),this._quaternionStart.copy(this.object.quaternion),this._scaleStart.copy(this.object.scale),this.object.matrixWorld.decompose(this.worldPositionStart,this.worldQuaternionStart,this._worldScaleStart),this.pointStart.copy(c.point).sub(this.worldPositionStart)),this.dragging=!0,_mouseDownEvent.mode=this.mode,this.dispatchEvent(_mouseDownEvent)}}pointerMove(o){const c=this.axis,d=this.mode,_=this.object;let b=this.space;if(d==="scale"?b="local":c!=="E"&&c!=="XYZE"&&c!=="XYZ"||(b="world"),_===void 0||c===null||this.dragging===!1||o.button!==-1)return;_raycaster.setFromCamera(o,this.camera);const _e=intersectObjectWithRay(this._plane,_raycaster,!0);if(_e){if(this.pointEnd.copy(_e.point).sub(this.worldPositionStart),d==="translate")this._offset.copy(this.pointEnd).sub(this.pointStart),b==="local"&&c!=="XYZ"&&this._offset.applyQuaternion(this._worldQuaternionInv),c.indexOf("X")===-1&&(this._offset.x=0),c.indexOf("Y")===-1&&(this._offset.y=0),c.indexOf("Z")===-1&&(this._offset.z=0),b==="local"&&c!=="XYZ"?this._offset.applyQuaternion(this._quaternionStart).divide(this._parentScale):this._offset.applyQuaternion(this._parentQuaternionInv).divide(this._parentScale),_.position.copy(this._offset).add(this._positionStart),this.translationSnap&&(b==="local"&&(_.position.applyQuaternion(_tempQuaternion.copy(this._quaternionStart).invert()),c.search("X")!==-1&&(_.position.x=Math.round(_.position.x/this.translationSnap)*this.translationSnap),c.search("Y")!==-1&&(_.position.y=Math.round(_.position.y/this.translationSnap)*this.translationSnap),c.search("Z")!==-1&&(_.position.z=Math.round(_.position.z/this.translationSnap)*this.translationSnap),_.position.applyQuaternion(this._quaternionStart)),b==="world"&&(_.parent&&_.position.add(_tempVector.setFromMatrixPosition(_.parent.matrixWorld)),c.search("X")!==-1&&(_.position.x=Math.round(_.position.x/this.translationSnap)*this.translationSnap),c.search("Y")!==-1&&(_.position.y=Math.round(_.position.y/this.translationSnap)*this.translationSnap),c.search("Z")!==-1&&(_.position.z=Math.round(_.position.z/this.translationSnap)*this.translationSnap),_.parent&&_.position.sub(_tempVector.setFromMatrixPosition(_.parent.matrixWorld))));else if(d==="scale"){if(c.search("XYZ")!==-1){let it=this.pointEnd.length()/this.pointStart.length();this.pointEnd.dot(this.pointStart)<0&&(it*=-1),_tempVector2.set(it,it,it)}else _tempVector.copy(this.pointStart),_tempVector2.copy(this.pointEnd),_tempVector.applyQuaternion(this._worldQuaternionInv),_tempVector2.applyQuaternion(this._worldQuaternionInv),_tempVector2.divide(_tempVector),c.search("X")===-1&&(_tempVector2.x=1),c.search("Y")===-1&&(_tempVector2.y=1),c.search("Z")===-1&&(_tempVector2.z=1);_.scale.copy(this._scaleStart).multiply(_tempVector2),this.scaleSnap&&(c.search("X")!==-1&&(_.scale.x=Math.round(_.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),c.search("Y")!==-1&&(_.scale.y=Math.round(_.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),c.search("Z")!==-1&&(_.scale.z=Math.round(_.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if(d==="rotate"){this._offset.copy(this.pointEnd).sub(this.pointStart);const it=20/this.worldPosition.distanceTo(_tempVector.setFromMatrixPosition(this.camera.matrixWorld));let nt=!1;c==="XYZE"?(this.rotationAxis.copy(this._offset).cross(this.eye).normalize(),this.rotationAngle=this._offset.dot(_tempVector.copy(this.rotationAxis).cross(this.eye))*it):c!=="X"&&c!=="Y"&&c!=="Z"||(this.rotationAxis.copy(_unit[c]),_tempVector.copy(_unit[c]),b==="local"&&_tempVector.applyQuaternion(this.worldQuaternion),_tempVector.cross(this.eye),_tempVector.length()===0?nt=!0:this.rotationAngle=this._offset.dot(_tempVector.normalize())*it),(c==="E"||nt)&&(this.rotationAxis.copy(this.eye),this.rotationAngle=this.pointEnd.angleTo(this.pointStart),this._startNorm.copy(this.pointStart).normalize(),this._endNorm.copy(this.pointEnd).normalize(),this.rotationAngle*=this._endNorm.cross(this._startNorm).dot(this.eye)<0?1:-1),this.rotationSnap&&(this.rotationAngle=Math.round(this.rotationAngle/this.rotationSnap)*this.rotationSnap),b==="local"&&c!=="E"&&c!=="XYZE"?(_.quaternion.copy(this._quaternionStart),_.quaternion.multiply(_tempQuaternion.setFromAxisAngle(this.rotationAxis,this.rotationAngle)).normalize()):(this.rotationAxis.applyQuaternion(this._parentQuaternionInv),_.quaternion.copy(_tempQuaternion.setFromAxisAngle(this.rotationAxis,this.rotationAngle)),_.quaternion.multiply(this._quaternionStart).normalize())}this.dispatchEvent(TransformControls_changeEvent),this.dispatchEvent(_objectChangeEvent)}}pointerUp(o){o.button===0&&(this.dragging&&this.axis!==null&&(_mouseUpEvent.mode=this.mode,this.dispatchEvent(_mouseUpEvent)),this.dragging=!1,this.axis=null)}dispose(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerHover),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.traverse(function(o){o.geometry&&o.geometry.dispose(),o.material&&o.material.dispose()})}attach(o){return this.object=o,this.visible=!0,this}detach(){return this.object=void 0,this.visible=!1,this.axis=null,this}reset(){this.enabled&&this.dragging&&(this.object.position.copy(this._positionStart),this.object.quaternion.copy(this._quaternionStart),this.object.scale.copy(this._scaleStart),this.dispatchEvent(TransformControls_changeEvent),this.dispatchEvent(_objectChangeEvent),this.pointStart.copy(this.pointEnd))}getRaycaster(){return _raycaster}getMode(){return this.mode}setMode(o){this.mode=o}setTranslationSnap(o){this.translationSnap=o}setRotationSnap(o){this.rotationSnap=o}setScaleSnap(o){this.scaleSnap=o}setSize(o){this.size=o}setSpace(o){this.space=o}}function getPointer(h){if(this.domElement.ownerDocument.pointerLockElement)return{x:0,y:0,button:h.button,buttons:h.buttons};{const o=this.domElement.getBoundingClientRect();return{x:(h.clientX-o.left)/o.width*2-1,y:-(h.clientY-o.top)/o.height*2+1,button:h.button,buttons:h.buttons}}}function onPointerHover(h){if(this.enabled)switch(h.pointerType){case"mouse":case"pen":this.pointerHover(this._getPointer(h))}}function onPointerDown(h){this.enabled&&(document.pointerLockElement||this.domElement.setPointerCapture(h.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.pointerHover(this._getPointer(h)),this.pointerDown(this._getPointer(h)))}function onPointerMove(h){this.enabled&&this.pointerMove(this._getPointer(h))}function onPointerUp(h){this.enabled&&(this.domElement.releasePointerCapture(h.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.pointerUp(this._getPointer(h)))}function intersectObjectWithRay(h,o,c){const d=o.intersectObject(h,!0);for(let _=0;_<d.length;_++)if(d[_].object.visible||c)return d[_];return!1}TransformControls.ObjectConstructors={MeshBasicMaterial:three_module.V9B,LineBasicMaterial:three_module.mrM};const _tempEuler=new three_module.O9p,_alignVector=new three_module.Pq0(0,1,0),_zeroVector=new three_module.Pq0(0,0,0),_lookAtMatrix=new three_module.kn4,_tempQuaternion2=new three_module.PTz,_identityQuaternion=new three_module.PTz,_dirVector=new three_module.Pq0,_tempMatrix=new three_module.kn4,_unitX=new three_module.Pq0(1,0,0),_unitY=new three_module.Pq0(0,1,0),_unitZ=new three_module.Pq0(0,0,1),TransformControls_v1=new three_module.Pq0,TransformControls_v2=new three_module.Pq0,_v3=new three_module.Pq0;class TransformControlsGizmo extends three_module.B69{constructor(){super(),this.isTransformControlsGizmo=!0,this.type="TransformControlsGizmo";const o=new TransformControls.ObjectConstructors.MeshBasicMaterial({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),c=new TransformControls.ObjectConstructors.LineBasicMaterial({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),d=o.clone();d.opacity=.15;const _=c.clone();_.opacity=1;const b=o.clone();b.color.setHex(15663205),b.opacity=.95;const _e=o.clone();_e.color.setHex(2014720),_e.opacity=.95;const it=o.clone();it.color.setHex(37885),it.opacity=.95;const nt=o.clone();nt.color.setHex(16618689),nt.__color=b.color.getHex();const at=o.clone();at.color.setHex(12516474),at.__color=_e.color.getHex();const ut=o.clone();ut.color.setHex(11397372),ut.__color=it.color.getHex();const pt=o.clone();pt.color.setHex(15663205),pt.opacity=.75;const mt=o.clone();mt.color.setHex(2014720),mt.opacity=.75;const ft=o.clone();ft.color.setHex(37885),ft.opacity=.75;const vt=o.clone();vt.color.setHex(12893629),vt.opacity=.75;const xt=o.clone();xt.color.setHex(16777051),xt.opacity=.25;const At=o.clone();At.color.setHex(7895160),At.opacity=.75;const Ct=new three_module.Ho_(0,.04,.1,12);Ct.translate(0,.05,0);const Et=new three_module.iNn(.08,.08,.08);Et.translate(0,.04,0);const Tt=new three_module.LoY;Tt.setAttribute("position",new three_module.qtW([0,0,0,1,0,0],3));const kt=new three_module.Ho_(.0075,.0075,.5,3);function Dt(hr,dr){const pr=new three_module.O3Y(hr,.0075,3,64,dr*Math.PI*2);return pr.rotateY(Math.PI/2),pr.rotateX(Math.PI/2),pr}function zt(hr,dr){const pr=new three_module.O3Y(hr,.1,4,24,dr*Math.PI*2);return pr.rotateY(Math.PI/2),pr.rotateX(Math.PI/2),pr}kt.translate(0,.25,0);const Bt={X:[[new three_module.eaF(Ct,nt),[.5,0,0],[0,0,-Math.PI/2]],[new three_module.eaF(kt,b),[0,0,0],[0,0,-Math.PI/2]]],Y:[[new three_module.eaF(Ct,at),[0,.5,0]],[new three_module.eaF(kt,_e)]],Z:[[new three_module.eaF(Ct,ut),[0,0,.5],[Math.PI/2,0,0]],[new three_module.eaF(kt,it),null,[Math.PI/2,0,0]]],XYZ:[[new three_module.eaF(new three_module.Ufg(.1,2),vt.clone()),[0,0,0]]],XY:[[new three_module.eaF(new three_module.iNn(.2,.2,.01),ft.clone()),[.2,.2,0]]],YZ:[[new three_module.eaF(new three_module.iNn(.2,.2,.01),pt.clone()),[0,.2,.2],[0,Math.PI/2,0]]],XZ:[[new three_module.eaF(new three_module.iNn(.2,.2,.01),mt.clone()),[.2,0,.2],[-Math.PI/2,0,0]]]},Rt={X:[[new three_module.eaF(new three_module.Ho_(.2,0,.6,4),d),[.3,0,0],[0,0,-Math.PI/2]]],Y:[[new three_module.eaF(new three_module.Ho_(.2,0,.6,4),d),[0,.3,0]]],Z:[[new three_module.eaF(new three_module.Ho_(.2,0,.6,4),d),[0,0,.3],[Math.PI/2,0,0]]],XYZ:[[new three_module.eaF(new three_module.Ufg(.2,0),d)]],XY:[[new three_module.eaF(new three_module.iNn(.25,.25,.01),d),[.2,.2,0]]],YZ:[[new three_module.eaF(new three_module.iNn(.25,.25,.01),d),[0,.2,.2],[0,Math.PI/2,0]]],XZ:[[new three_module.eaF(new three_module.iNn(.25,.25,.01),d),[.2,0,.2],[-Math.PI/2,0,0]]]},Ut={START:[[new three_module.eaF(new three_module.Ufg(.01,2),_),null,null,null,"helper"]],END:[[new three_module.eaF(new three_module.Ufg(.01,2),_),null,null,null,"helper"]],DELTA:[[new three_module.N1A(function(){const hr=new three_module.LoY;return hr.setAttribute("position",new three_module.qtW([0,0,0,1,1,1],3)),hr}(),_),null,null,null,"helper"]],X:[[new three_module.N1A(Tt,_.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new three_module.N1A(Tt,_.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new three_module.N1A(Tt,_.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},Ht={XYZE:[[new three_module.eaF(new three_module.Gu$(.1,10,8),vt)],[new three_module.eaF(Dt(.5,1),At),null,[0,Math.PI/2,0]]],X:[[new three_module.eaF(Dt(.5,.5),b)],[new three_module.eaF(kt,b),[0,0,0],[0,0,-Math.PI/2]],[new three_module.eaF(Ct.clone().translate(.5,0,0),nt),[0,0,0],[-Math.PI/2,-Math.PI/2,-Math.PI/2]]],Y:[[new three_module.eaF(Dt(.5,.5),_e),null,[0,0,-Math.PI/2]],[new three_module.eaF(kt,_e)],[new three_module.eaF(Ct.clone().rotateZ(-Math.PI/2).translate(0,.5,0),at),[0,0,0],[Math.PI/2,0,0]]],Z:[[new three_module.eaF(Dt(.5,.5),it),null,[0,Math.PI/2,0]],[new three_module.eaF(kt,it),null,[Math.PI/2,0,0]],[new three_module.eaF(Ct.clone().rotateZ(-Math.PI).translate(0,0,.5),ut),[0,0,0],[0,Math.PI/2,0]]]},Jt={AXIS:[[new three_module.N1A(Tt,_.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},Kt={XYZE:[[new three_module.eaF(new three_module.Gu$(.25,10,8),d)]],X:[[new three_module.eaF(zt(.5,.5),d)]],Y:[[new three_module.eaF(zt(.5,.5),d),[0,0,0],[0,0,-Math.PI/2]]],Z:[[new three_module.eaF(zt(.5,.5),d),[0,0,0],[0,Math.PI/2,0]]]},sr={X:[[new three_module.eaF(Et,nt),[.5,0,0],[0,0,-Math.PI/2]],[new three_module.eaF(kt,b),[0,0,0],[0,0,-Math.PI/2]]],Y:[[new three_module.eaF(Et,at),[0,.5,0]],[new three_module.eaF(kt,_e)]],Z:[[new three_module.eaF(Et,ut),[0,0,.5],[Math.PI/2,0,0]],[new three_module.eaF(kt,it),[0,0,0],[Math.PI/2,0,0]]],XY:[[new three_module.eaF(new three_module.iNn(.15,.15,.01),ft),[.15,.15,0]]],YZ:[[new three_module.eaF(new three_module.iNn(.15,.15,.01),pt),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new three_module.eaF(new three_module.iNn(.15,.15,.01),mt),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new three_module.eaF(new three_module.iNn(.1,.1,.1),vt.clone())]]},ir={X:[[new three_module.eaF(new three_module.Ho_(.2,0,.6,4),d),[.3,0,0],[0,0,-Math.PI/2]],[new three_module.eaF(new three_module.Ho_(.2,0,.6,4),d),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new three_module.eaF(new three_module.Ho_(.2,0,.6,4),d),[0,.3,0]],[new three_module.eaF(new three_module.Ho_(.2,0,.6,4),d),[0,-.3,0],[0,0,Math.PI]]],Z:[[new three_module.eaF(new three_module.Ho_(.2,0,.6,4),d),[0,0,.3],[Math.PI/2,0,0]],[new three_module.eaF(new three_module.Ho_(.2,0,.6,4),d),[0,0,-.3],[-Math.PI/2,0,0]]],XY:[[new three_module.eaF(new three_module.iNn(.2,.2,.01),d),[.15,.15,0]]],YZ:[[new three_module.eaF(new three_module.iNn(.2,.2,.01),d),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new three_module.eaF(new three_module.iNn(.2,.2,.01),d),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new three_module.eaF(new three_module.iNn(.2,.2,.2),d),[0,0,0]]]},cr={X:[[new three_module.N1A(Tt,_.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new three_module.N1A(Tt,_.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new three_module.N1A(Tt,_.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]};function lr(hr){const dr=new three_module.B69;for(const pr in hr)for(let ur=hr[pr].length;ur--;){const xr=hr[pr][ur][0].clone(),vr=hr[pr][ur][1],Dr=hr[pr][ur][2],_r=hr[pr][ur][3],rr=hr[pr][ur][4];xr.name=pr,xr.tag=rr,vr&&xr.position.set(vr[0],vr[1],vr[2]),Dr&&xr.rotation.set(Dr[0],Dr[1],Dr[2]),_r&&xr.scale.set(_r[0],_r[1],_r[2]),xr.updateMatrix();const mr=xr.geometry.clone();mr.applyMatrix4(xr.matrix),xr.geometry=mr,xr.renderOrder=1/0,xr.position.set(0,0,0),xr.rotation.set(0,0,0),xr.scale.set(1,1,1),dr.add(xr)}return dr}this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=lr(Bt)),this.add(this.gizmo.rotate=lr(Ht)),this.add(this.gizmo.scale=lr(sr)),this.add(this.picker.translate=lr(Rt)),this.add(this.picker.rotate=lr(Kt)),this.add(this.picker.scale=lr(ir)),this.add(this.helper.translate=lr(Ut)),this.add(this.helper.rotate=lr(Jt)),this.add(this.helper.scale=lr(cr)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1}updateMatrixWorld(o){const c=(this.mode==="scale"?"local":this.space)==="local"?this.worldQuaternion:_identityQuaternion;this.gizmo.translate.visible=this.mode==="translate",this.gizmo.rotate.visible=this.mode==="rotate",this.gizmo.scale.visible=this.mode==="scale",this.helper.translate.visible=this.mode==="translate",this.helper.rotate.visible=this.mode==="rotate",this.helper.scale.visible=this.mode==="scale";let d=[];d=d.concat(this.picker[this.mode].children),d=d.concat(this.gizmo[this.mode].children),d=d.concat(this.helper[this.mode].children);for(let _=0;_<d.length;_++){const b=d[_];let _e;b.visible=!0,b.rotation.set(0,0,0),b.position.copy(this.worldPosition),_e=this.camera.isOrthographicCamera?(this.camera.top-this.camera.bottom)/this.camera.zoom:this.worldPosition.distanceTo(this.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),b.scale.set(1,1,1).multiplyScalar(_e*this.size/4),b.tag!=="helper"?(b.quaternion.copy(c),this.mode==="translate"||this.mode==="scale"?(b.name==="X"&&Math.abs(_alignVector.copy(_unitX).applyQuaternion(c).dot(this.eye))>.99&&(b.scale.set(1e-10,1e-10,1e-10),b.visible=!1),b.name==="Y"&&Math.abs(_alignVector.copy(_unitY).applyQuaternion(c).dot(this.eye))>.99&&(b.scale.set(1e-10,1e-10,1e-10),b.visible=!1),b.name==="Z"&&Math.abs(_alignVector.copy(_unitZ).applyQuaternion(c).dot(this.eye))>.99&&(b.scale.set(1e-10,1e-10,1e-10),b.visible=!1),b.name==="XY"&&Math.abs(_alignVector.copy(_unitZ).applyQuaternion(c).dot(this.eye))<.2&&(b.scale.set(1e-10,1e-10,1e-10),b.visible=!1),b.name==="YZ"&&Math.abs(_alignVector.copy(_unitX).applyQuaternion(c).dot(this.eye))<.2&&(b.scale.set(1e-10,1e-10,1e-10),b.visible=!1),b.name==="XZ"&&Math.abs(_alignVector.copy(_unitY).applyQuaternion(c).dot(this.eye))<.2&&(b.scale.set(1e-10,1e-10,1e-10),b.visible=!1)):this.mode==="rotate"&&(_tempQuaternion2.copy(c),_alignVector.copy(this.eye).applyQuaternion(_tempQuaternion.copy(c).invert()),b.name.search("E")!==-1&&b.quaternion.setFromRotationMatrix(_lookAtMatrix.lookAt(this.eye,_zeroVector,_unitY)),b.name==="X"&&(_tempQuaternion.setFromAxisAngle(_unitX,Math.atan2(-_alignVector.y,_alignVector.z)),_tempQuaternion.multiplyQuaternions(_tempQuaternion2,_tempQuaternion),b.quaternion.copy(_tempQuaternion)),b.name==="Y"&&(_tempQuaternion.setFromAxisAngle(_unitY,Math.atan2(_alignVector.x,_alignVector.z)),_tempQuaternion.multiplyQuaternions(_tempQuaternion2,_tempQuaternion),b.quaternion.copy(_tempQuaternion)),b.name==="Z"&&(_tempQuaternion.setFromAxisAngle(_unitZ,Math.atan2(_alignVector.y,_alignVector.x)),_tempQuaternion.multiplyQuaternions(_tempQuaternion2,_tempQuaternion),b.quaternion.copy(_tempQuaternion))),b.visible=b.visible&&(b.name.indexOf("X")===-1||this.showX),b.visible=b.visible&&(b.name.indexOf("Y")===-1||this.showY),b.visible=b.visible&&(b.name.indexOf("Z")===-1||this.showZ),b.visible=b.visible&&(b.name.indexOf("E")===-1||this.showX&&this.showY&&this.showZ),b.material._color=b.material._color||b.material.color.clone(),b.material._opacity=b.material._opacity||b.material.opacity,b.material.color.copy(b.material._color),b.material.opacity=b.material._opacity,this.enabled&&this.axis&&(b.name===this.axis||this.axis.split("").some(function(it){return b.name===it}))&&(b.material.__color&&b.material.color.setHex(b.material.__color),b.material.opacity=1)):(b.visible=!1,b.name==="AXIS"?(b.visible=!!this.axis,this.axis==="X"&&(_tempQuaternion.setFromEuler(_tempEuler.set(0,0,0)),b.quaternion.copy(c).multiply(_tempQuaternion),Math.abs(_alignVector.copy(_unitX).applyQuaternion(c).dot(this.eye))>.9&&(b.visible=!1)),this.axis==="Y"&&(_tempQuaternion.setFromEuler(_tempEuler.set(0,0,Math.PI/2)),b.quaternion.copy(c).multiply(_tempQuaternion),Math.abs(_alignVector.copy(_unitY).applyQuaternion(c).dot(this.eye))>.9&&(b.visible=!1)),this.axis==="Z"&&(_tempQuaternion.setFromEuler(_tempEuler.set(0,Math.PI/2,0)),b.quaternion.copy(c).multiply(_tempQuaternion),Math.abs(_alignVector.copy(_unitZ).applyQuaternion(c).dot(this.eye))>.9&&(b.visible=!1)),this.axis==="XYZE"&&(_tempQuaternion.setFromEuler(_tempEuler.set(0,Math.PI/2,0)),_alignVector.copy(this.rotationAxis),b.quaternion.setFromRotationMatrix(_lookAtMatrix.lookAt(_zeroVector,_alignVector,_unitY)),b.quaternion.multiply(_tempQuaternion),b.visible=this.dragging),this.axis==="E"&&(b.visible=!1)):b.name==="START"?(b.position.copy(this.worldPositionStart),b.visible=this.dragging):b.name==="END"?(b.position.copy(this.worldPosition),b.visible=this.dragging):b.name==="DELTA"?(b.position.copy(this.worldPositionStart),b.quaternion.copy(this.worldQuaternionStart),_tempVector.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),_tempVector.applyQuaternion(this.worldQuaternionStart.clone().invert()),b.scale.copy(_tempVector),b.visible=this.dragging):(b.quaternion.copy(c),this.dragging?b.position.copy(this.worldPositionStart):b.position.copy(this.worldPosition),this.axis&&(b.visible=this.axis.search(b.name)!==-1)))}super.updateMatrixWorld(o)}}class TransformControlsPlane extends three_module.eaF{constructor(){super(new three_module.bdM(1e5,1e5,2,2),new TransformControls.ObjectConstructors.MeshBasicMaterial({visible:!1,wireframe:!0,side:three_module.$EB,transparent:!0,opacity:.1,toneMapped:!1})),this.isTransformControlsPlane=!0,this.type="TransformControlsPlane"}updateMatrixWorld(o){let c=this.space;switch(this.position.copy(this.worldPosition),this.mode==="scale"&&(c="local"),TransformControls_v1.copy(_unitX).applyQuaternion(c==="local"?this.worldQuaternion:_identityQuaternion),TransformControls_v2.copy(_unitY).applyQuaternion(c==="local"?this.worldQuaternion:_identityQuaternion),_v3.copy(_unitZ).applyQuaternion(c==="local"?this.worldQuaternion:_identityQuaternion),_alignVector.copy(TransformControls_v2),this.mode){case"translate":case"scale":switch(this.axis){case"X":_alignVector.copy(this.eye).cross(TransformControls_v1),_dirVector.copy(TransformControls_v1).cross(_alignVector);break;case"Y":_alignVector.copy(this.eye).cross(TransformControls_v2),_dirVector.copy(TransformControls_v2).cross(_alignVector);break;case"Z":_alignVector.copy(this.eye).cross(_v3),_dirVector.copy(_v3).cross(_alignVector);break;case"XY":_dirVector.copy(_v3);break;case"YZ":_dirVector.copy(TransformControls_v1);break;case"XZ":_alignVector.copy(_v3),_dirVector.copy(TransformControls_v2);break;case"XYZ":case"E":_dirVector.set(0,0,0)}break;default:_dirVector.set(0,0,0)}_dirVector.length()===0?this.quaternion.copy(this.cameraQuaternion):(_tempMatrix.lookAt(_tempVector.set(0,0,0),_dirVector,_alignVector),this.quaternion.setFromRotationMatrix(_tempMatrix)),super.updateMatrixWorld(o)}}var TransformControls2_decorate=function(h,o,c,d){var _,b=arguments.length,_e=b<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_e=Reflect.decorate(h,o,c,d);else for(var it=h.length-1;it>=0;it--)(_=h[it])&&(_e=(b<3?_(_e):b>3?_(o,c,_e):_(o,c))||_e);return b>3&&_e&&Object.defineProperty(o,c,_e),_e};let TransformControls2=class extends TransformControls{setDirty(h){this.dispatchEvent({...h,type:"objectUpdate",object:this})}refreshUi(){var h,o;(o=(h=this.uiConfig)===null||h===void 0?void 0:h.uiRefresh)===null||o===void 0||o.call(h,"postFrame",!0,1)}_keyDownListener(h){if(this.enabled&&this.object&&!h.metaKey&&!h.ctrlKey){switch(h.code){case"KeyQ":this.space=this.space==="local"?"world":"local";break;case"ShiftLeft":this.translationSnap=.5,this.rotationSnap=three_module.cj9.degToRad(15),this.scaleSnap=.25;break;case"KeyW":this.mode="translate";break;case"KeyE":this.mode="rotate";break;case"KeyR":this.mode="scale";break;case"Equal":case"NumpadAdd":case"Plus":this.size=this.size+.1;break;case"Minus":case"NumpadSubtract":case"Underscore":this.size=Math.max(this.size-.1,.1);break;case"KeyX":this.showX=!this.showX;break;case"KeyY":this.showY=!this.showY;break;case"KeyZ":this.showZ=!this.showZ;break;case"Space":this.enabled=!this.enabled;break;default:return}this.setDirty({refreshScene:!0,frameFade:!0})}}_keyUpListener(h){this.enabled&&(h.code==="ShiftLeft"&&(this.translationSnap=null,this.rotationSnap=null,this.scaleSnap=null),this.object&&h.code)}constructor(h,o){super(h,o),this.isWidget=!0,setupIModel(this),this.visible=!1,this.userData.bboxVisible=!1,this.size=2,this.addEventListener("objectChange",()=>{var c;(c=this.object)===null||c===void 0||c.setDirty({fadeFrame:!1})}),this.addEventListener("change",()=>{this.setDirty({fadeFrame:!1})}),this._keyUpListener=this._keyUpListener.bind(this),this._keyDownListener=this._keyDownListener.bind(this),window.addEventListener("keydown",this._keyDownListener),window.addEventListener("keyup",this._keyUpListener)}dispose(){window.removeEventListener("keydown",this._keyDownListener),window.removeEventListener("keyup",this._keyUpListener),super.dispose()}get modelObject(){return this}};TransformControls2_decorate([uiDropdown("Mode",["translate","rotate","scale"].map(h=>({label:h})))],TransformControls2.prototype,"mode",void 0),TransformControls2_decorate([uiDropdown("Space",["world","local"].map(h=>({label:h})))],TransformControls2.prototype,"space",void 0),TransformControls2_decorate([uiSlider("Size",[.1,10],.1)],TransformControls2.prototype,"size",void 0),TransformControls2_decorate([uiToggle("Show X")],TransformControls2.prototype,"showX",void 0),TransformControls2_decorate([uiToggle("Show Y")],TransformControls2.prototype,"showY",void 0),TransformControls2_decorate([uiToggle("Show Z")],TransformControls2.prototype,"showZ",void 0),TransformControls2=TransformControls2_decorate([uiFolder("Transform Controls")],TransformControls2);class CanvasRecorder extends I$2{_setOptions(o){var c,d;Object.assign(this._options,o),this._options.mimeType&&this._options.mimeType!=="auto"||(this._options.mimeType=(c=CanvasRecorder.GetSupportedMimeTypes([],["h264"],!0))!==null&&c!==void 0?c:CanvasRecorder.GetSupportedMimeTypes(void 0,void 0,!0)),this._options.mimeType&&!(!((d=this._options.mimeType)===null||d===void 0)&&d.startsWith("video/"))||window.MediaRecorder||(this._console.warn("MediaRecorder is not supported, switching to png"),this._options.mimeType="image/png"),this._options.mimeType||console.warn(new Error("No supported mimetype found"))}setOptions(o){this._setOptions(o)}constructor(o,c){super(),this._state="stopped",this._console=console,this._currentRecording=[],this._currentImages=[],this.stepMode=!1,this._resumeSyncTime=0,this._frameCount=0,this._onstop=_=>{var b;if(this._state="stopped",this._recorder&&this._currentRecording.length>0){const _e=new Blob(this._currentRecording,{type:this._options.mimeType});(b=this._recordingCallback)===null||b===void 0||b.call(this,_e)}else this._currentImages.length>0&&(this._writeImages([...this._currentImages]),this._currentImages=[]);this._recorder=void 0,this.dispatchEvent({type:"stop"})},this._onstart=_=>{var b;this._state="recording",this._frameCount=0,this.dispatchEvent({type:"start"}),this.stepMode&&((b=this._recorder)===null||b===void 0||b.pause())},this._onresume=_=>{if(!this.stepMode)return;const b=()=>{var it;this._state==="recording"&&((it=this._recorder)===null||it===void 0||it.pause())},_e=Math.min(this._resumeSyncTime-g(),0)+1e3/this._options.frameRate;_e>0?X$2(_e).then(b):b()},this._onpause=_=>{},this._ondataavailable=_=>{_.data&&_.data.size>0&&this._currentRecording.push(_.data)},this._onerror=_=>{this._state="error",this._console.error(_),this.dispatchEvent({type:"error",error:_}),this._recorder=void 0},this._canvas=o;const d=c==null?void 0:c.mimeType;this._options={mimeType:d||"auto",frameRate:30,stepMode:!1},this._setOptions(c||this._options)}isRecording(){return this._state==="recording"}start(){var o,c,d;if(this._state==="recording")return void this._console.log("Already recording canvas");if(this._state==="error"&&(this._recorder=void 0,this._console.warn("Resetting from error state.")),this._recorder)return this._state==="paused"?(this.dispatchEvent({type:"starting"}),void this._recorder.resume()):void this._console.warn("Canvas recorder unknown state",this._state);if(this._state==="paused")return this.dispatchEvent({type:"starting"}),void(this._state="recording");const _={mimeType:this._options.mimeType,videoBitsPerSecond:this._options.videoBitsPerSecond};if(this._currentRecording=[],this._currentImages=[],this._frameCount=0,(o=_.mimeType)===null||o===void 0?void 0:o.startsWith("video")){if(!window.MediaRecorder)return this._console.error("MediaRecorder not supported, use image sequence"),void(this._state="error");{const b=this._canvas.captureStream(this.stepMode?0:this._options.frameRate),_e=(c=b.getVideoTracks())===null||c===void 0?void 0:c[0];this._track=_e,this._recorder=new window.MediaRecorder(b,_),this._recorder.onstop=this._onstop,this._recorder.ondataavailable=this._ondataavailable,this._recorder.onerror=this._onerror,this._recorder.onresume=this._onresume,this._recorder.onstart=this._onstart}}this.dispatchEvent({type:"starting"}),this._recorder?(this._state="recording",(d=this._recorder)===null||d===void 0||d.start()):window&&window.showDirectoryPicker&&window.showDirectoryPicker().then(async b=>{const _e=await(b==null?void 0:b.getDirectoryHandle("i-"+Math.floor(Date.now()),{create:!0}));this._imgDirectory=_e,this._state="recording",this._onstart({})}).catch(b=>{this._onerror({detail:b})})}async requestFrame(){if(this._state!=="recording")return;this._frameCount++;const o=this._options.mimeType;if(!this._recorder&&o.startsWith("image/")){const c=this._canvas.toDataURL(o,90);this._currentImages.push(["frame_"+String(this._frameCount).padStart(5,"0")+(o.includes("png")?".png":".jpg"),c]),this._currentImages.length>60&&(this._writeImages([...this._currentImages]),this._currentImages=[])}this._recorder&&this._track&&this.stepMode&&(this._resumeSyncTime=g(),this._track.requestFrame(),this._recorder.resume())}pause(){this._state!=="paused"&&this._state!=="stopped"&&(this._recorder?this._recorder.pause():this._state="paused")}stop(o){this._state!=="stopped"&&(this._state!=="error"?(this._recordingCallback=o,this.dispatchEvent({type:"stopping"}),this._recorder?this._recorder.stop():this._onstop({})):this._console.error("Recorder in error state, cannot stop, call start again."))}get state(){return this._state}dispose(){this._recorder&&this._state!=="error"?this.stop(o=>{this._console.warn("disposed with blob",o),this.dispose()}):this._recorder=void 0}async _writeImages(o){if(!this._imgDirectory)return;const c=await Promise.all(o.map(async([_,b])=>await(await fetch(b)).blob())),d=[];for(let _=0;_<o.length;_++){const b=await this._imgDirectory.getFileHandle(o[_][0],{create:!0});d.push($e$1(b,c[_]))}await Promise.all(d)}static GetSupportedMimeTypes(o,c,d=!1){if(!window.MediaRecorder)return d?void 0:[];const _=["webm","ogg","mp4","x-matroska"].filter(it=>!o||o.length<1||o.includes(it)),b=["vp9","vp9.0","vp8","vp8.0","avc1","av1","h265","h.265","h264","h.264","opus"].filter(it=>!c||c.length<1||c.includes(it)),_e=[];return _.forEach(it=>{const nt=`video/${it}`;b.forEach(at=>{[`${nt};codecs=${at}`,`${nt};codecs:${at}`,`${nt};codecs=${at.toUpperCase()}`,`${nt};codecs:${at.toUpperCase()}`,`${nt}`].forEach(ut=>{MediaRecorder.isTypeSupported(ut)&&_e.push(ut)})})}),d?_e.length>0?_e[0]:void 0:_e}}class SphereSelectionWidget extends SelectionWidget{constructor(){super(),this.boundingScaleMultiplier=1.2,this._initGeometry(new three_module.WBB(1,0))}}function deepAccessObject(h,o,c=!1){for(typeof h=="string"&&(h=h.split("."));h.length>0;){if(!o)return o;const d=h.splice(0,1)[0];if(!(d.length<1))if(Array.isArray(o))o=o[parseInt(d)];else{if(typeof o!="object"||!(d in o)){if(c)throw new Error("invalid access, check "+d+" in "+o);return}o=o[d]}}return o}function extractAnimationKey(h,o,c){var d,_;let b=Array.from(((d=h.access)!==null&&d!==void 0?d:"").split(".")),_e=(_=h.targetObject)!==null&&_!==void 0?_:o;const it=b.pop();if(!it||it.length===0)return{key:void 0,tar:_e};if((c=c??(o==null?void 0:o._animGetters))&&b[0]in c){const nt=c[b[0]](b);nt?(_e=nt.tar,b=b.slice(nt.i+1)):_e=nt}return _e=deepAccessObject(b,_e),_e&&!(it in _e)?(console.error("invalid key",it,_e,o,h),{key:void 0,tar:_e}):{key:it,tar:_e}}async function animateObject(h,o,c){var d,_,b,_e;const{key:it,tar:nt}=extractAnimationKey(o,h),at=o.animSet?[animateSet(h,o.animSet,c,(d=o.animSetParallel)!==null&&d!==void 0&&d)]:[];if(it&&nt){const ut=(_e=o.updater)!==null&&_e!==void 0?_e:[],pt=async()=>animateTarget$1(nt,it,{from:o.from,to:o.to,ease:typeof o.ease=="string"?EasingFunctions[o.ease]:o.ease,duration:o.duration,...o.options,onUpdate:mt=>{var ft,vt;(vt=(ft=o.options).onUpdate)===null||vt===void 0||vt.call(ft,mt),ut.forEach(xt=>{var At;return(At=c[xt])===null||At===void 0?void 0:At.call(c)})}},void 0,!1);o.delay?at.push(X$2(o.delay).then(pt)):at.push(pt())}else(o.duration||o.delay)&&at.push(X$2(((_=o.delay)!==null&&_!==void 0?_:0)+((b=o.duration)!==null&&b!==void 0?b:0)));return at.length===1?at[0]:Promise.all(at)}async function animationObject_animate(h,o,c){return typeof o.animate=="function"?o.animate():animateObject(h,o,c)}async function animateSet(h,o,c,d=!1){if(d)return Promise.all(o.map(async _=>animationObject_animate(h,_,c)));for(const _ of o)await animationObject_animate(h,_,c)}const encoder=new TextEncoder,HOST_SERVICES={appstream2:"appstream",cloudhsmv2:"cloudhsm",email:"ses",marketplace:"aws-marketplace",mobile:"AWSMobileHubService",pinpoint:"mobiletargeting",queue:"sqs","git-codecommit":"codecommit","mturk-requester-sandbox":"mturk-requester","personalize-runtime":"personalize"},UNSIGNABLE_HEADERS=new Set(["authorization","content-type","content-length","user-agent","presigned-expires","expect","x-amzn-trace-id","range","connection"]);class AwsClient{constructor({accessKeyId:o,secretAccessKey:c,sessionToken:d,service:_,region:b,cache:_e,retries:it,initRetryMs:nt}){if(o==null)throw new TypeError("accessKeyId is a required option");if(c==null)throw new TypeError("secretAccessKey is a required option");this.accessKeyId=o,this.secretAccessKey=c,this.sessionToken=d,this.service=_,this.region=b,this.cache=_e||new Map,this.retries=it??10,this.initRetryMs=nt||50}async sign(o,c){if(o instanceof Request){const{method:b,url:_e,headers:it,body:nt}=o;(c=Object.assign({method:b,url:_e,headers:it},c)).body==null&&it.has("Content-Type")&&(c.body=nt!=null&&it.has("X-Amz-Content-Sha256")?nt:await o.clone().arrayBuffer()),o=_e}const d=new AwsV4Signer(Object.assign({url:o.toString()},c,this,c&&c.aws)),_=Object.assign({},c,await d.sign());delete _.aws;try{return new Request(_.url.toString(),_)}catch(b){if(b instanceof TypeError)return new Request(_.url.toString(),Object.assign({duplex:"half"},_));throw b}}async fetch(o,c){for(let d=0;d<=this.retries;d++){const _=fetch(await this.sign(o,c));if(d===this.retries)return _;const b=await _;if(b.status<500&&b.status!==429)return b;await new Promise(_e=>setTimeout(_e,Math.random()*this.initRetryMs*Math.pow(2,d)))}throw new Error("An unknown error occurred, ensure retries is not negative")}}class AwsV4Signer{constructor({method:o,url:c,headers:d,body:_,accessKeyId:b,secretAccessKey:_e,sessionToken:it,service:nt,region:at,cache:ut,datetime:pt,signQuery:mt,appendSessionToken:ft,allHeaders:vt,singleEncode:xt}){if(c==null)throw new TypeError("url is a required option");if(b==null)throw new TypeError("accessKeyId is a required option");if(_e==null)throw new TypeError("secretAccessKey is a required option");let At,Ct;this.method=o||(_?"POST":"GET"),this.url=new URL(c),this.headers=new Headers(d||{}),this.body=_,this.accessKeyId=b,this.secretAccessKey=_e,this.sessionToken=it,nt&&at||([At,Ct]=guessServiceRegion(this.url,this.headers)),this.service=nt||At||"",this.region=at||Ct||"us-east-1",this.cache=ut||new Map,this.datetime=pt||new Date().toISOString().replace(/[:-]|\.\d{3}/g,""),this.signQuery=mt,this.appendSessionToken=ft||this.service==="iotdevicegateway",this.headers.delete("Host"),this.service!=="s3"||this.signQuery||this.headers.has("X-Amz-Content-Sha256")||this.headers.set("X-Amz-Content-Sha256","UNSIGNED-PAYLOAD");const Et=this.signQuery?this.url.searchParams:this.headers;if(Et.set("X-Amz-Date",this.datetime),this.sessionToken&&!this.appendSessionToken&&Et.set("X-Amz-Security-Token",this.sessionToken),this.signableHeaders=["host",...this.headers.keys()].filter(kt=>vt||!UNSIGNABLE_HEADERS.has(kt)).sort(),this.signedHeaders=this.signableHeaders.join(";"),this.canonicalHeaders=this.signableHeaders.map(kt=>kt+":"+(kt==="host"?this.url.host:(this.headers.get(kt)||"").replace(/\s+/g," "))).join(`
`),this.credentialString=[this.datetime.slice(0,8),this.region,this.service,"aws4_request"].join("/"),this.signQuery&&(this.service!=="s3"||Et.has("X-Amz-Expires")||Et.set("X-Amz-Expires","86400"),Et.set("X-Amz-Algorithm","AWS4-HMAC-SHA256"),Et.set("X-Amz-Credential",this.accessKeyId+"/"+this.credentialString),Et.set("X-Amz-SignedHeaders",this.signedHeaders)),this.service==="s3")try{this.encodedPath=decodeURIComponent(this.url.pathname.replace(/\+/g," "))}catch{this.encodedPath=this.url.pathname}else this.encodedPath=this.url.pathname.replace(/\/+/g,"/");xt||(this.encodedPath=encodeURIComponent(this.encodedPath).replace(/%2F/g,"/")),this.encodedPath=encodeRfc3986(this.encodedPath);const Tt=new Set;this.encodedSearch=[...this.url.searchParams].filter(([kt])=>{if(!kt)return!1;if(this.service==="s3"){if(Tt.has(kt))return!1;Tt.add(kt)}return!0}).map(kt=>kt.map(Dt=>encodeRfc3986(encodeURIComponent(Dt)))).sort(([kt,Dt],[zt,Bt])=>kt<zt?-1:kt>zt?1:Dt<Bt?-1:Dt>Bt?1:0).map(kt=>kt.join("=")).join("&")}async sign(){return this.signQuery?(this.url.searchParams.set("X-Amz-Signature",await this.signature()),this.sessionToken&&this.appendSessionToken&&this.url.searchParams.set("X-Amz-Security-Token",this.sessionToken)):this.headers.set("Authorization",await this.authHeader()),{method:this.method,url:this.url,headers:this.headers,body:this.body}}async authHeader(){return["AWS4-HMAC-SHA256 Credential="+this.accessKeyId+"/"+this.credentialString,"SignedHeaders="+this.signedHeaders,"Signature="+await this.signature()].join(", ")}async signature(){const o=this.datetime.slice(0,8),c=[this.secretAccessKey,o,this.region,this.service].join();let d=this.cache.get(c);if(!d){const _=await hmac("AWS4"+this.secretAccessKey,o),b=await hmac(_,this.region),_e=await hmac(b,this.service);d=await hmac(_e,"aws4_request"),this.cache.set(c,d)}return buf2hex(await hmac(d,await this.stringToSign()))}async stringToSign(){return["AWS4-HMAC-SHA256",this.datetime,this.credentialString,buf2hex(await aws4fetch_esm_hash(await this.canonicalString()))].join(`
`)}async canonicalString(){return[this.method.toUpperCase(),this.encodedPath,this.encodedSearch,this.canonicalHeaders+`
`,this.signedHeaders,await this.hexBodyHash()].join(`
`)}async hexBodyHash(){let o=this.headers.get("X-Amz-Content-Sha256")||(this.service==="s3"&&this.signQuery?"UNSIGNED-PAYLOAD":null);if(o==null){if(this.body&&typeof this.body!="string"&&!("byteLength"in this.body))throw new Error("body must be a string, ArrayBuffer or ArrayBufferView, unless you include the X-Amz-Content-Sha256 header");o=buf2hex(await aws4fetch_esm_hash(this.body||""))}return o}}async function hmac(h,o){const c=await crypto.subtle.importKey("raw",typeof h=="string"?encoder.encode(h):h,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]);return crypto.subtle.sign("HMAC",c,encoder.encode(o))}async function aws4fetch_esm_hash(h){return crypto.subtle.digest("SHA-256",typeof h=="string"?encoder.encode(h):h)}const HEX_CHARS=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function buf2hex(h){const o=new Uint8Array(h);let c="";for(let d=0;d<o.length;d++){const _=o[d];c+=HEX_CHARS[_>>>4&15],c+=HEX_CHARS[15&_]}return c}function encodeRfc3986(h){return h.replace(/[!'()*]/g,o=>"%"+o.charCodeAt(0).toString(16).toUpperCase())}function guessServiceRegion(h,o){const{hostname:c,pathname:d}=h;if(c.endsWith(".on.aws")){const it=c.match(/^[^.]{1,63}\.lambda-url\.([^.]{1,63})\.on\.aws$/);return it!=null?["lambda",it[1]||""]:["",""]}if(c.endsWith(".r2.cloudflarestorage.com"))return["s3","auto"];if(c.endsWith(".backblazeb2.com")){const it=c.match(/^(?:[^.]{1,63}\.)?s3\.([^.]{1,63})\.backblazeb2\.com$/);return it!=null?["s3",it[1]||""]:["",""]}const _=c.replace("dualstack.","").match(/([^.]{1,63})\.(?:([^.]{0,63})\.)?amazonaws\.com(?:\.cn)?$/);let b=_&&_[1]||"",_e=_&&_[2];if(_e==="us-gov")_e="us-gov-west-1";else if(_e==="s3"||_e==="s3-accelerate")_e="us-east-1",b="s3";else if(b==="iot")b=c.startsWith("iot.")?"execute-api":c.startsWith("data.jobs.iot.")?"iot-jobs-data":d==="/mqtt"?"iotdevicegateway":"iotdata";else if(b==="autoscaling"){const it=(o.get("X-Amz-Target")||"").split(".")[0];it==="AnyScaleFrontendService"?b="application-autoscaling":it==="AnyScaleScalingPlannerFrontendService"&&(b="autoscaling-plans")}else _e==null&&b.startsWith("s3-")?(_e=b.slice(3).replace(/^fips-|^external-1/,""),b="s3"):b.endsWith("-fips")?b=b.slice(0,-5):_e&&/-\d$/.test(b)&&!/-\d$/.test(_e)&&([b,_e]=[_e,b]);return[HOST_SERVICES[b]||b,_e||""]}var AWSClientPlugin_decorate=function(h,o,c,d){var _,b=arguments.length,_e=b<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_e=Reflect.decorate(h,o,c,d);else for(var it=h.length-1;it>=0;it--)(_=h[it])&&(_e=(b<3?_(_e):b>3?_(o,c,_e):_(o,c))||_e);return b>3&&_e&&Object.defineProperty(o,c,_e),_e},AWSClientPlugin_1;let AWSClientPlugin=AWSClientPlugin_1=class extends AViewerPlugin{constructor(){super(),this.enabled=!0,this._connected=!1,this.dependencies=[FileTransferPlugin],this.accessKeyId="",this.accessKeySecret="",this.endpointURL="",this.pathPrefix="webgi",this.serializeSettings=!1,this.toggleConnection=()=>{this._connected?this.disconnect():this.connect()},this.serializeWithViewer=!1,this.fetchFunction=fetch}connect(){this._connected&&this.disconnect(),this._client=new AwsClient({accessKeyId:this.accessKeyId,secretAccessKey:this.accessKeySecret}),this._connected=!0,this.refreshUi()}refreshUi(){var h,o;(o=(h=this.uiConfig)===null||h===void 0?void 0:h.uiRefresh)===null||o===void 0||o.call(h,"postFrame",!0)}disconnect(){this._client=void 0,this._connected=!1,this.refreshUi()}get connected(){return this._connected}get client(){return this._client}toJSON(h){return this.serializeSettings?super.toJSON(h):{type:this.constructor.PluginType}}async onAdded(h){await super.onAdded(h);const o=h.getPlugin(FileTransferPlugin);o.actions.exportFile=async(c,d,_)=>{if(!this._connected)return void await o.defaultActions.exportFile(c,d);const b=ot([this.endpointURL,this.pathPrefix,d]),_e=await this.fetch(b,{method:"PUT",body:c},_);if(!_e.ok)return h.console.error("Error uploading file",_e),void await o.defaultActions.exportFile(c,d);this.dispatchEvent({type:"fileUpload",name:d,blob:c,response:_e,path:b}),h.console.log("File uploaded",_e)}}async fetch(h,o,c){if(!this._client)throw new Error("Not connected");for(let d=0;d<=this._client.retries;d++){const _=await sign2(this._client,h,o);let b=_.url.toString();AWSClientPlugin_1.USE_PROXY&&b&&!b.includes(AWSClientPlugin_1.PROXY_URL)&&(b=AWSClientPlugin_1.PROXY_URL.replace("{path}",b));const _e=(0,this.fetchFunction)(b,_);if(d===this._client.retries)return _e;const it=await _e;if(it.status<500&&it.status!==429)return it;await X$2(Math.random()*this._client.initRetryMs*Math.pow(2,d))}throw new Error("An unknown error occurred, ensure retries is not negative")}};async function sign2(h,o,c){if(o instanceof Request){const{method:b,url:_e,headers:it,body:nt}=o;(c=Object.assign({method:b,url:_e,headers:it},c)).body==null&&it.has("Content-Type")&&(c.body=nt!=null&&it.has("X-Amz-Content-Sha256")?nt:await o.clone().arrayBuffer()),o=_e,console.warn("WebGi AWSClientPlugin: There could be a bug in chrome with cloning Request objects, see https://bugs.chromium.org/p/chromium/issues/detail?id=1360943")}const d=new AwsV4Signer(Object.assign({url:o},c,h,c&&c.aws)),_=Object.assign({},c,await d.sign());return delete _.aws,_}AWSClientPlugin.PluginType="AWSClientPlugin1",AWSClientPlugin.USE_PROXY=!1,AWSClientPlugin.PROXY_URL="https://r2-s3-api.repalash.com/{path}",AWSClientPlugin_decorate([serialize(),uiInput("Access Key ID",h=>({disabled:()=>!h.enabled||h._connected}))],AWSClientPlugin.prototype,"accessKeyId",void 0),AWSClientPlugin_decorate([serialize(),uiInput("Access Key Secret",h=>({disabled:()=>!h.enabled||h._connected}))],AWSClientPlugin.prototype,"accessKeySecret",void 0),AWSClientPlugin_decorate([serialize(),uiInput("Endpoint URL",h=>({disabled:()=>!h.enabled||h._connected}))],AWSClientPlugin.prototype,"endpointURL",void 0),AWSClientPlugin_decorate([serialize(),uiInput("Path Prefix",h=>({disabled:()=>!h.enabled}))],AWSClientPlugin.prototype,"pathPrefix",void 0),AWSClientPlugin_decorate([serialize(),uiToggle("Remember",h=>({disabled:()=>!h.enabled||h._connected}))],AWSClientPlugin.prototype,"serializeSettings",void 0),AWSClientPlugin_decorate([uiButton(void 0,h=>({label:()=>h._connected?"Disconnect":"Connect"}))],AWSClientPlugin.prototype,"toggleConnection",void 0),AWSClientPlugin=AWSClientPlugin_1=AWSClientPlugin_decorate([uiFolder("S3 Connection")],AWSClientPlugin);const supportsRequestStreams=(()=>{let h=!1,o=!1;const c=typeof globalThis.ReadableStream=="function",d=typeof globalThis.Request=="function";return c&&d&&(o=new globalThis.Request("https://empty.invalid",{body:new globalThis.ReadableStream,method:"POST",get duplex(){return h=!0,"half"}}).headers.has("Content-Type")),h&&!o})(),defaultPresets={Background:new SimpleAssetList({basePath:"https://demo-assets.pixotronics.com/pixo/presets/background",assets:["gradient-radial-dark-blue.svg","gradient-radial-grey.svg","gradient-radial-red.svg","gradient-radial-aqua.svg","gradient-radial-green.svg","gradient-radial-white.svg","gradient-radial-coral.svg","gradient-radial-fuchsia.svg","gradient-radial-blue.svg","gradient-radial-black.svg","gradient-radial-light-blue.svg","gradient-radial-gray.svg","gradient-radial-beige.svg","gradient-radial-antrasit.svg","gradient-linear-light-blue.svg","gradient-linear-gray.svg","gradient-linear-beige.svg","gradient-linear-antrasit.svg","bg-1.jpg","bg-2.png"].map(h=>({path:h}))}).assets,Environment:new SimpleAssetList({basePath:"https://demo-assets.pixotronics.com/pixo/presets/environment",assets:["env-metal-1.hdr","env-metal-2.hdr","env-metal-3.hdr","env-metal-4.hdr","env-metal-5.hdr","env-metal-6.hdr","env-metal-7.hdr","env-metal-8.hdr","env-metal-9.hdr","env-metal-10.hdr","env-metal-11.hdr","env-metal-12.hdr","env-metal-13.hdr","env-metal-14.exr","env-metal-gem-1.hdr","env-metal-gem-2.hdr","env-gem-1.hdr","env-gem-2.hdr","env-gem-3.exr","env-gem-4.exr","alps_field_1k.hdr","paul_lobe_haus_1k.hdr","derelict_highway_midday_1k.hdr","neon_photostudio_1k.hdr","studio_small_08_1k.hdr","evening_meadow_1k.hdr","st_peters_square_night_1k.hdr","studio_small_07_1k.hdr","moonless_golf_1k.hdr","satara_night_1k.hdr","venice_sunset_1k.hdr","umhlanga_sunrise_1k.hdr","studio_country_hall_1k.hdr"].map(h=>({path:h}))}).assets,GemEnvironment:new SimpleAssetList({basePath:"https://demo-assets.pixotronics.com/pixo/presets/environment",assets:["env-gem-1.hdr","env-gem-2.hdr","env-gem-3.exr","env-gem-4.exr","env-metal-gem-1.hdr","env-metal-gem-2.hdr"].map(h=>({path:h}))}).assets,GemEnvironment2:new SimpleAssetList({basePath:"https://demo-assets.pixotronics.com/pixo/presets/environment",assets:["env-gem-1.hdr","env-gem-2.hdr","env-gem-3.exr","env-gem-4.exr","env-metal-gem-1.hdr","env-metal-gem-2.hdr"].map(h=>({path:h}))}).assets,GemEnvironment3:new SimpleAssetList({basePath:"https://demo-assets.pixotronics.com/pixo/presets/environment",assets:["env-gem-1.hdr","env-gem-2.hdr","env-gem-3.exr","env-gem-4.exr","env-metal-gem-1.hdr","env-metal-gem-2.hdr"].map(h=>({path:h}))}).assets,Ground:new SimpleAssetList({basePath:"https://demo-assets.pixotronics.com/pixo/presets/ground",assets:["ground-1.json","ground-2.json","ground-3.json","g-1.json","g-2.json","g-3.json","g-4.json","g-5.json"].map(h=>({path:h}))}).assets,CameraViews:new SimpleAssetList({basePath:"https://demo-assets.pixotronics.com/pixo/presets/views",assets:["views-1.json","views-2.json"].map(h=>({path:h}))}).assets,MaterialConfiguration:new SimpleAssetList({basePath:"https://demo-assets.pixotronics.com/pixo/presets/material-conf",assets:["gold-ceramic.json","gold.json","metal-diamond.json"].map(h=>({path:h}))}).assets,MaterialLibraries:new SimpleAssetList({basePath:"https://demo-assets.pixotronics.com/pixo/presets/material-lib",assets:["metal.zip","gem.zip"].map(h=>({path:h}))}).assets};function velocityPerSecond$1(h,o){return o?h*(1e3/o):0}function inertia$1(h){var o,c=h.from,d=c===void 0?0:c,_=h.velocity,b=_===void 0?0:_,_e=h.min,it=h.max,nt=h.power,at=nt===void 0?.8:nt,ut=h.timeConstant,pt=ut===void 0?750:ut,mt=h.bounceStiffness,ft=mt===void 0?500:mt,vt=h.bounceDamping,xt=vt===void 0?10:vt,At=h.restDelta,Ct=At===void 0?1:At,Et=h.modifyTarget,Tt=h.driver,kt=h.onUpdate,Dt=h.onComplete,zt=h.onStop;function Bt(lr){return _e!==void 0&&lr<_e||it!==void 0&&lr>it}function Rt(lr){return _e===void 0?it:it===void 0||Math.abs(_e-lr)<Math.abs(it-lr)?_e:it}function Ut(lr){o==null||o.stop(),o=animate(__assign(__assign({},lr),{driver:Tt,onUpdate:function(hr){var dr;kt==null||kt(hr),(dr=lr.onUpdate)===null||dr===void 0||dr.call(lr,hr)},onComplete:Dt,onStop:zt}))}function Ht(lr){Ut(__assign({type:"spring",stiffness:ft,damping:xt,restDelta:Ct},lr))}if(Bt(d))Ht({from:d,velocity:b,to:Rt(d)});else{var Jt=at*b+d;Et!==void 0&&(Jt=Et(Jt));var Kt,sr,ir=Rt(Jt),cr=ir===_e?-1:1;Ut({type:"decay",from:d,velocity:b,timeConstant:pt,power:at,restDelta:Ct,modifyTarget:Et,onUpdate:Bt(Jt)?function(lr){Kt=sr,sr=lr,b=velocityPerSecond$1(lr-Kt,getFrameData().delta),(cr===1&&lr>ir||cr===-1&&lr<ir)&&Ht({from:lr,to:ir,velocity:b})}:void 0})}return{stop:function(){return o==null?void 0:o.stop()}}}var radiansToDegrees=function(h){return 180*h/Math.PI},angle=function(h,o){return o===void 0&&(o=zeroPoint),radiansToDegrees(Math.atan2(o.y-h.y,o.x-h.x))},applyOffset=function(h,o){var c=!0;return o===void 0&&(o=h,c=!1),function(d){return c?d-h+o:(h=d,c=!0,o)}},identity=function(h){return h},createAttractor=function(h){return h===void 0&&(h=identity),function(o,c,d){var _=c-d,b=-(0-o+1)*(0-h(Math.abs(_)));return _<=0?c+b:c-b}},attract=createAttractor(),attractExpo=createAttractor(Math.sqrt),degreesToRadians=function(h){return h*Math.PI/180},isPoint=function(h){return h.hasOwnProperty("x")&&h.hasOwnProperty("y")},isPoint3D=function(h){return isPoint(h)&&h.hasOwnProperty("z")},distance1D=function(h,o){return Math.abs(h-o)};function distance$1(h,o){if(isNum(h)&&isNum(o))return distance1D(h,o);if(isPoint(h)&&isPoint(o)){var c=distance1D(h.x,o.x),d=distance1D(h.y,o.y),_=isPoint3D(h)&&isPoint3D(o)?distance1D(h.z,o.z):0;return Math.sqrt(Math.pow(c,2)+Math.pow(d,2)+Math.pow(_,2))}}var pointFromVector=function(h,o,c){return o=degreesToRadians(o),{x:c*Math.cos(o)+h.x,y:c*Math.sin(o)+h.y}},toDecimal=function(h,o){return o===void 0&&(o=2),o=Math.pow(10,o),Math.round(h*o)/o},smoothFrame=function(h,o,c,d){return d===void 0&&(d=0),toDecimal(h+c*(o-h)/Math.max(d,c))},smooth=function(h){h===void 0&&(h=50);var o=0,c=0;return function(d){var _=getFrameData().timestamp,b=_!==c?_-c:0,_e=b?smoothFrame(o,d,b,h):o;return c=_,o=_e,_e}},snap=function(h){if(typeof h=="number")return function(d){return Math.round(d/h)*h};var o=0,c=h.length;return function(d){var _=Math.abs(h[0]-d);for(o=1;o<c;o++){var b=h[o],_e=Math.abs(b-d);if(_e===0)return b;if(_e>_)return h[o-1];if(o===c-1)return b;_=_e}}};function velocityPerFrame(h,o){return h/(1e3/o)}var wrap=function(h,o,c){var d=o-h;return((c-h)%d+d)%d+h},cubic_bezier_a=function(h,o){return 1-3*o+3*h},cubic_bezier_b=function(h,o){return 3*o-6*h},cubic_bezier_c=function(h){return 3*h},calcBezier$1=function(h,o,c){return((cubic_bezier_a(o,c)*h+cubic_bezier_b(o,c))*h+cubic_bezier_c(o))*h},getSlope=function(h,o,c){return 3*cubic_bezier_a(o,c)*h*h+2*cubic_bezier_b(o,c)*h+cubic_bezier_c(o)},subdivisionPrecision$1=1e-7,subdivisionMaxIterations$1=10;function binarySubdivide$1(h,o,c,d,_){var b,_e,it=0;do(b=calcBezier$1(_e=o+(c-o)/2,d,_)-h)>0?c=_e:o=_e;while(Math.abs(b)>subdivisionPrecision$1&&++it<subdivisionMaxIterations$1);return _e}var newtonIterations=8,newtonMinSlope=.001;function newtonRaphsonIterate(h,o,c,d){for(var _=0;_<newtonIterations;++_){var b=getSlope(o,c,d);if(b===0)return o;o-=(calcBezier$1(o,c,d)-h)/b}return o}var kSplineTableSize=11,kSampleStepSize=1/(kSplineTableSize-1);function cubicBezier$1(h,o,c,d){if(h===o&&c===d)return linear;for(var _=new Float32Array(kSplineTableSize),b=0;b<kSplineTableSize;++b)_[b]=calcBezier$1(b*kSampleStepSize,h,c);return function(_e){return _e===0||_e===1?_e:calcBezier$1(function(it){for(var nt=0,at=1,ut=kSplineTableSize-1;at!==ut&&_[at]<=it;++at)nt+=kSampleStepSize;--at;var pt=nt+(it-_[at])/(_[at+1]-_[at])*kSampleStepSize,mt=getSlope(pt,h,c);return mt>=newtonMinSlope?newtonRaphsonIterate(it,pt,h,c):mt===0?pt:binarySubdivide$1(it,nt,nt+kSampleStepSize,h,c)}(_e),o,d)}}var steps_steps=function(h,o){return o===void 0&&(o="end"),function(c){var d=(c=o==="end"?Math.min(c,.999):Math.max(c,.001))*h,_=o==="end"?Math.floor(d):Math.ceil(d);return clamp$1(0,1,_/h)}};const _lut=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];function generateUUID(){const h=4294967295*Math.random()|0,o=4294967295*Math.random()|0,c=4294967295*Math.random()|0,d=4294967295*Math.random()|0;return(_lut[255&h]+_lut[h>>8&255]+_lut[h>>16&255]+_lut[h>>24&255]+"-"+_lut[255&o]+_lut[o>>8&255]+"-"+_lut[o>>16&15|64]+_lut[o>>24&255]+"-"+_lut[63&c|128]+_lut[c>>8&255]+"-"+_lut[c>>16&255]+_lut[c>>24&255]+_lut[255&d]+_lut[d>>8&255]+_lut[d>>16&255]+_lut[d>>24&255]).toLowerCase()}var AnimationObjectPlugin_decorate=function(h,o,c,d){var _,b=arguments.length,_e=b<3?o:d===null?d=Object.getOwnPropertyDescriptor(o,c):d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_e=Reflect.decorate(h,o,c,d);else for(var it=h.length-1;it>=0;it--)(_=h[it])&&(_e=(b<3?_(_e):b>3?_(o,c,_e):_(o,c))||_e);return b>3&&_e&&Object.defineProperty(o,c,_e),_e},AnimationObject_1;class AnimationObjectPlugin extends AViewerPlugin{constructor(){super(...arguments),this.enabled=!0,this.animation=new AnimationObject(()=>this._viewer),this.uiConfig=this.animation.uiConfig}async onAdded(o){function c(d){let _="",b=1;for(;b<d.length&&(_+=d[b],d[b].endsWith("\\"));b++)_=_.slice(0,-1),_+=".";return[_,b]}await super.onAdded(o),o._animGetters={objects:d=>{if(d.length<2||!o)return;const[_,b]=c(d);return{tar:o.scene.getObjectByName(_),i:b}},materials:d=>{var _,b,_e;if(d.length<2||!o)return;const[it,nt]=c(d);return{tar:(_e=(b=(_=o.assetManager)===null||_===void 0?void 0:_.materials)===null||b===void 0?void 0:b.findMaterialsByName(it))===null||_e===void 0?void 0:_e[0],i:nt}}}}}AnimationObjectPlugin.PluginType="AnimationObjectPlugin",AnimationObjectPlugin_decorate([serialize(),uiConfig()],AnimationObjectPlugin.prototype,"animation",void 0);let AnimationObject=AnimationObject_1=class{constructor(h){this.target=h,this.uuid=generateUUID(),this.name="",this.access="",this.options={},this.duration=1e3,this.delay=0,this.repeat=1,this.repeatType="mirror",this.ease="easeInOutSine",this.updater=[],this.updateScene=!1,this.updateCamera=!1,this.updateViewer=!1,this.animSetParallel=!1,this.animSet=[],this.uiConfig=generateUiFolder("Animation Object",this,void 0,"folder",!0)}_onAccessChanged(){const h=Ee$1(this.target),{key:o,tar:c}=extractAnimationKey(this,h);if(this.from=void 0,this.to=void 0,!o||!c)return void this.refreshUi();const d=c[o];if(d==null)return void this.refreshUi();const _=()=>{if(!d)return d;if(d.isColor)return"#"+d.getHexString();const b=typeof d.clone=="function"?d.clone():typeof d=="object"?{...d}:d;return console.log(b),b};this.from=_(),this.to=_(),this.refreshUi()}refreshUi(){var h,o;(o=(h=this.uiConfig)===null||h===void 0?void 0:h.uiRefresh)===null||o===void 0||o.call(h,"postFrame",!0,1)}add(h){this.animSet.push(h),h.parent=this,this.refreshUi()}remove(h){const o=this.animSet.indexOf(h);o>=0&&(this.animSet.splice(o,1),h.parent=void 0,this.refreshUi())}async animate(h=!1){typeof h!="boolean"&&(h=!1);const o=Ee$1(this.target);if(!o)return void console.warn("AnimationObject: No viewer");h&&(this.options.to=this.from,this.options.from=this.to),this.options.repeatType=this.repeatType,this.options.repeat=this.repeat,this.updater=[],this.updateScene&&this.updater.push("scene"),this.updateCamera&&this.updater.push("camera"),this.updateViewer&&this.updater.push("viewer"),this.animSet.forEach(c=>c.target=this.target),await animateObject(o,this,{viewer:()=>o.setDirty(),renderer:()=>o.renderer.reset(),scene:()=>{o.scene.setDirty()},camera:()=>o.scene.activeCamera.setDirty()}),delete this.options.to,delete this.options.from}async animateReverse(){await this.animate(!0)}async removeFromParent2(){const h=Ee$1(this.target);this.parent&&h&&await h.confirm(`Delete: Are you sure you want to delete the animation ${this.name}?`)&&this.removeFromParent()}removeFromParent(){this.parent&&this.parent.remove(this)}addAnimation(){this.add(new AnimationObject_1(this.target))}};AnimationObjectPlugin_decorate([serialize(),uiInput()],AnimationObject.prototype,"name",void 0),AnimationObjectPlugin_decorate([serialize(),uiInput(),x$1(AnimationObject.prototype._onAccessChanged)],AnimationObject.prototype,"access",void 0),AnimationObjectPlugin_decorate([uiConfig(),serialize()],AnimationObject.prototype,"from",void 0),AnimationObjectPlugin_decorate([uiConfig(),serialize()],AnimationObject.prototype,"to",void 0),AnimationObjectPlugin_decorate([serialize()],AnimationObject.prototype,"options",void 0),AnimationObjectPlugin_decorate([serialize(),uiSlider(void 0,[0,1e4],1,h=>({hidden:()=>h.from===void 0}))],AnimationObject.prototype,"duration",void 0),AnimationObjectPlugin_decorate([serialize(),uiSlider(void 0,[0,1e4],1,h=>({hidden:()=>h.from===void 0}))],AnimationObject.prototype,"delay",void 0),AnimationObjectPlugin_decorate([serialize(),uiSlider(void 0,[0,10],1,h=>({hidden:()=>h.from===void 0}))],AnimationObject.prototype,"repeat",void 0),AnimationObjectPlugin_decorate([serialize(),uiDropdown("repeatType",["loop","reverse","mirror"].map(h=>({label:h})),h=>({hidden:()=>h.from===void 0}))],AnimationObject.prototype,"repeatType",void 0),AnimationObjectPlugin_decorate([serialize(),uiDropdown("ease",Object.keys(EasingFunctions).map(h=>({label:h})),h=>({hidden:()=>h.from===void 0}))],AnimationObject.prototype,"ease",void 0),AnimationObjectPlugin_decorate([serialize(),uiToggle(void 0,h=>({hidden:()=>h.from===void 0}))],AnimationObject.prototype,"updateScene",void 0),AnimationObjectPlugin_decorate([serialize(),uiToggle(void 0,h=>({hidden:()=>h.from===void 0}))],AnimationObject.prototype,"updateCamera",void 0),AnimationObjectPlugin_decorate([serialize(),uiToggle(void 0,h=>({hidden:()=>h.from===void 0}))],AnimationObject.prototype,"updateViewer",void 0),AnimationObjectPlugin_decorate([uiButton("Animate")],AnimationObject.prototype,"animate",null),AnimationObjectPlugin_decorate([uiButton("Animate Reverse")],AnimationObject.prototype,"animateReverse",null),AnimationObjectPlugin_decorate([uiButton("Delete")],AnimationObject.prototype,"removeFromParent2",null),AnimationObjectPlugin_decorate([serialize(),uiToggle()],AnimationObject.prototype,"animSetParallel",void 0),AnimationObjectPlugin_decorate([serialize(),uiConfig()],AnimationObject.prototype,"animSet",void 0),AnimationObjectPlugin_decorate([uiButton("Add Animation")],AnimationObject.prototype,"addAnimation",null),AnimationObject=AnimationObject_1=AnimationObjectPlugin_decorate([serializable("AnimationObject")],AnimationObject);var GradientSvgPlugin_decorate=function(h,o,c,d){var _,b=arguments.length,_e=b<3?o:d===null?d=Object.getOwnPropertyDescriptor(o,c):d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_e=Reflect.decorate(h,o,c,d);else for(var it=h.length-1;it>=0;it--)(_=h[it])&&(_e=(b<3?_(_e):b>3?_(o,c,_e):_(o,c))||_e);return b>3&&_e&&Object.defineProperty(o,c,_e),_e};let GradientSvgPlugin=class extends AViewerPlugin{constructor(h=!0){super(),this.enabled=!0,this.dependencies=[],this.options={id:generateUUID(),type:"linear",gradientUnits:"objectBoundingBox",linearOptions:{angle:45,x1:0,y1:0,x2:1,y2:1},radialOptions:{cx:.5,cy:.5,r:.5,fx:.5,fy:.5,spreadMethod:"pad"}},this.type="linear",this.gradientUnits="objectBoundingBox",this.position1=new three_module.I9Y(0,0),this.position2=new three_module.I9Y(1,1),this.angle=0,this.radius=.5,this.center=new three_module.I9Y(.5,.5),this.focus=new three_module.I9Y(.5,.5),this.spreadMethod="pad",this._svgGradient=new SvgGradient,this._needsUpdate=!1,this.colors=[new three_module.Q1f(1,1,1),new three_module.Q1f(1,0,0)],this.color1=this.colors[0],this.color2=this.colors[1],this.applyToBackground=!1,this.autoRefresh=!0,this.enabled=h}_refreshOptions(){var h,o,c,d,_,b,_e,it;this.options.type=this.type,this.options.gradientUnits=this.gradientUnits,this.options.linearOptions={angle:this.angle,x1:(h=this.position1)===null||h===void 0?void 0:h.x,y1:(o=this.position1)===null||o===void 0?void 0:o.y,x2:(c=this.position2)===null||c===void 0?void 0:c.x,y2:(d=this.position2)===null||d===void 0?void 0:d.y},this.options.radialOptions={cx:(_=this.center)===null||_===void 0?void 0:_.x,cy:(b=this.center)===null||b===void 0?void 0:b.y,r:this.radius,fx:(_e=this.focus)===null||_e===void 0?void 0:_e.x,fy:(it=this.focus)===null||it===void 0?void 0:it.y,spreadMethod:this.spreadMethod},this.setDirty()}setDirty(){this._needsUpdate=!0}addColor(){this.colors.push(new three_module.Q1f),this.setDirty()}refreshSvg(){if((!this.applyToBackground||this._viewer)&&(this._refreshOptions(),this._needsUpdate=!1,this._svgElement=this._svgGradient.get(this.colors,this.options),this.applyToBackground)){const h=`
            <svg xmlns="http://www.w3.org/2000/svg" width="100" height="100">
            <defs>
            ${this._svgElement.outerHTML}
            </defs>
            <rect width="100%" height="100%" fill="url(#${this.options.id})"/>
            </svg>
            `,o=B$2(h),c=new Image;c.src=o;const d=new three_module.gPd(c);c.onload=()=>{this._svgTexture===d&&(this._svgTexture.needsUpdate=!0,this._viewer.scene.background=this._svgTexture,this._viewer.setDirty())},this._svgTexture&&this._svgTexture.dispose(),this._svgTexture=d}}async onAdded(h){await super.onAdded(h),h.addEventListener("postFrame",()=>{this.enabled&&this._needsUpdate&&this.autoRefresh&&this.refreshSvg()})}};GradientSvgPlugin.PluginType="GradientSvgPlugin",GradientSvgPlugin_decorate([uiToggle()],GradientSvgPlugin.prototype,"enabled",void 0),GradientSvgPlugin_decorate([serialize(),uiDropdown("type",["linear","radial"].map(h=>({label:h}))),x$1(GradientSvgPlugin.prototype._refreshOptions)],GradientSvgPlugin.prototype,"type",void 0),GradientSvgPlugin_decorate([serialize(),x$1(GradientSvgPlugin.prototype._refreshOptions)],GradientSvgPlugin.prototype,"gradientUnits",void 0),GradientSvgPlugin_decorate([serialize(),uiVector("position1",[0,1],.01,h=>({hidden:()=>h.type!=="linear",onChange:()=>h._refreshOptions()})),x$1(GradientSvgPlugin.prototype._refreshOptions)],GradientSvgPlugin.prototype,"position1",void 0),GradientSvgPlugin_decorate([serialize(),uiVector("position2",[0,1],.01,h=>({hidden:()=>h.type!=="linear",onChange:()=>h._refreshOptions()})),x$1(GradientSvgPlugin.prototype._refreshOptions)],GradientSvgPlugin.prototype,"position2",void 0),GradientSvgPlugin_decorate([serialize(),uiSlider("angle",[0,360],1,h=>({hidden:()=>h.type!=="linear"})),x$1(GradientSvgPlugin.prototype._refreshOptions)],GradientSvgPlugin.prototype,"angle",void 0),GradientSvgPlugin_decorate([serialize(),uiSlider("radius",[0,1],.01,h=>({hidden:()=>h.type!=="radial"})),x$1(GradientSvgPlugin.prototype._refreshOptions)],GradientSvgPlugin.prototype,"radius",void 0),GradientSvgPlugin_decorate([serialize(),uiVector("center",[0,1],.01,h=>({hidden:()=>h.type!=="radial",onChange:()=>h._refreshOptions()})),x$1(GradientSvgPlugin.prototype._refreshOptions)],GradientSvgPlugin.prototype,"center",void 0),GradientSvgPlugin_decorate([serialize(),uiVector("focus",[0,1],.01,h=>({hidden:()=>h.type!=="radial",onChange:()=>h._refreshOptions()})),x$1(GradientSvgPlugin.prototype._refreshOptions)],GradientSvgPlugin.prototype,"focus",void 0),GradientSvgPlugin_decorate([serialize(),x$1(GradientSvgPlugin.prototype._refreshOptions)],GradientSvgPlugin.prototype,"spreadMethod",void 0),GradientSvgPlugin_decorate([serialize()],GradientSvgPlugin.prototype,"colors",void 0),GradientSvgPlugin_decorate([uiColor(void 0,h=>({onChange:()=>h.setDirty()})),x$1(GradientSvgPlugin.prototype.setDirty)],GradientSvgPlugin.prototype,"color1",void 0),GradientSvgPlugin_decorate([uiColor(void 0,h=>({onChange:()=>h.setDirty()})),x$1(GradientSvgPlugin.prototype.setDirty)],GradientSvgPlugin.prototype,"color2",void 0),GradientSvgPlugin_decorate([serialize(),uiToggle(),x$1(GradientSvgPlugin.prototype.setDirty)],GradientSvgPlugin.prototype,"applyToBackground",void 0),GradientSvgPlugin_decorate([uiButton()],GradientSvgPlugin.prototype,"refreshSvg",null),GradientSvgPlugin_decorate([serialize()],GradientSvgPlugin.prototype,"autoRefresh",void 0),GradientSvgPlugin=GradientSvgPlugin_decorate([uiFolder("Gradient SVG")],GradientSvgPlugin);class SvgGradient{constructor(){}get(o,c){return this.colors=o,this.options=c,this.createGradient()}createSvgElement(o){return document.createElementNS("http://www.w3.org/2000/svg",o)}createColorStop(o,c,d){const _=this.createSvgElement("stop");return _.setAttribute("offset",c/d*100+"%"),_.setAttribute("stop-color",o),_}colorsToStops(){const o=this.colors;return o.map((c,d)=>{const _=c.getStyle();return this.createColorStop(_,d,o.length)})}createGradientElement(){const o=this.options,c=this.createSvgElement(`${o.type}Gradient`),d=/((id)|([c|f|x|y|r][x|y|1|2]?)|(gradientUnits))/,_=o[`${o.type}Options`],b={id:o.id,type:o.type,gradientUnits:o.gradientUnits,..._};return Object.entries(b).filter(_e=>d.test(_e[0])).forEach(_e=>{_e[0]!=="type"&&c.setAttribute(_e[0],_e[1])}),b.angle&&c.setAttribute("gradientTransform",`rotate(${b.angle})`),c}createGradient(){const o=this.createGradientElement();return this.colorsToStops().forEach(c=>o.appendChild(c)),o}}var TransformControlsPlugin_decorate=function(h,o,c,d){var _,b=arguments.length,_e=b<3?o:d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_e=Reflect.decorate(h,o,c,d);else for(var it=h.length-1;it>=0;it--)(_=h[it])&&(_e=(b<3?_(_e):b>3?_(o,c,_e):_(o,c))||_e);return b>3&&_e&&Object.defineProperty(o,c,_e),_e};class TransformControlsPlugin extends AViewerPlugin{setDirty(){var o,c;if(!this._viewer)return;const d=this._viewer.getPlugin(PickingPlugin),_=this.enabled;_&&d.widgetEnabled?(d.enableWidget(!1),this._pickingWidgetDisabled=!0):!_&&this._pickingWidgetDisabled&&(d.enableWidget(!0),this._pickingWidgetDisabled=!1),this.transformControls&&(_&&d.getSelectedObject()?this.transformControls.attach(d.getSelectedObject()):this.transformControls.detach()),this._viewer.setDirty(),(c=(o=this.uiConfig)===null||o===void 0?void 0:o.uiRefresh)===null||c===void 0||c.call(o,"postFrame",!0,1)}constructor(o=!0){super(),this.uiConfig={type:"folder",label:"Transform Controls",children:[...generateUiConfig(this),()=>{var c;return(c=this.transformControls)===null||c===void 0?void 0:c.uiConfig}]},this.enabled=!0,this._pickingWidgetDisabled=!1,this.toJSON=void 0,this.dependencies=[PickingPlugin],this._isInteracting=!1,this._transformState={obj:null,position:new three_module.Pq0,rotation:new three_module.O9p,scale:new three_module.Pq0},this._activeCameraChange=()=>{this.transformControls&&this._viewer&&(this.transformControls.camera=this._viewer.scene.activeCamera.cameraObject)},TransformControls.ObjectConstructors.MeshBasicMaterial=MeshBasicMaterial2,this.enabled=o}get undoManager(){var o,c;return(c=(o=this._viewer)===null||o===void 0?void 0:o.getPlugin(TweakpaneUiPlugin))===null||c===void 0?void 0:c.undoManager}async onAdded(o){await super.onAdded(o),this.setDirty(),this.transformControls=new TransformControls2(o.scene.activeCamera.cameraObject,o.canvas),this._activeCameraChange=this._activeCameraChange.bind(this),o.scene.addEventListener("activeCameraChange",this._activeCameraChange),this.transformControls.addEventListener("dragging-changed",c=>{if(!(this!=null&&this._viewer))return;const d=this._viewer.scene.activeCamera.controls;typeof(d==null?void 0:d.stopDamping)=="function"&&d!=null&&d.enabled&&d.stopDamping(),this._viewer.scene.activeCamera.setInteractions(!c.value,TransformControlsPlugin.PluginType)}),this.transformControls.addEventListener("axis-changed",c=>{if(!(this!=null&&this._viewer))return;this._isInteracting=!!c.value;const d=this._viewer.scene.activeCamera.controls;typeof(d==null?void 0:d.stopDamping)=="function"&&d!=null&&d.enabled&&d.stopDamping(),this._viewer.setDirty()}),o.scene.addSceneObject(this.transformControls,{addToRoot:!0}),o.getPlugin(PickingPlugin).addEventListener("selectedObjectChanged",c=>{this.transformControls&&(this.enabled?c.object?this.transformControls.attach(c.object):this.transformControls.detach():this.transformControls.object&&this.transformControls.detach())}),this.transformControls.addEventListener("mouseDown",()=>{if(!this.transformControls)return;const c=this.transformControls.object;c&&(this._transformState.obj=c,this._transformState.position=c.position.clone(),this._transformState.rotation=c.rotation.clone(),this._transformState.scale=c.scale.clone())}),this.transformControls.addEventListener("mouseUp",()=>{if(!this.transformControls)return;const c=this.transformControls.object;if(!c||this._transformState.obj!==c||!this.undoManager)return;const d={translate:"position",rotate:"rotation",scale:"scale"}[this.transformControls.getMode()];if(!d||this._transformState[d].equals(c[d]))return;const _={last:this._transformState[d].clone(),current:c[d].clone(),set:b=>{var _e,it;c[d].copy(b),c.updateMatrixWorld(!0),(_e=this.transformControls)===null||_e===void 0||_e.dispatchEvent({type:"change"}),(it=this.transformControls)===null||it===void 0||it.dispatchEvent({type:"objectChange"})},undo:()=>_.set(_.last),redo:()=>_.set(_.current)};this.undoManager.record(_)})}async onRemove(o){o.scene.removeEventListener("activeCameraChange",this._activeCameraChange),this.transformControls&&(this.transformControls.detach(),o.scene.remove(this.transformControls),this.transformControls.dispose()),this.transformControls=void 0,await super.onRemove(o)}}TransformControlsPlugin.PluginType="TransformControlsPlugin",TransformControlsPlugin_decorate([uiToggle(),x$1(TransformControlsPlugin.prototype.setDirty)],TransformControlsPlugin.prototype,"enabled",void 0);var WatchHandsPlugin_decorate=function(h,o,c,d){var _,b=arguments.length,_e=b<3?o:d===null?d=Object.getOwnPropertyDescriptor(o,c):d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_e=Reflect.decorate(h,o,c,d);else for(var it=h.length-1;it>=0;it--)(_=h[it])&&(_e=(b<3?_(_e):b>3?_(o,c,_e):_(o,c))||_e);return b>3&&_e&&Object.defineProperty(o,c,_e),_e};let WatchHandsPlugin=class extends AViewerPlugin{constructor(){super(...arguments),this.enabled=!0,this.dependencies=[],this.axis="y",this.invertAxis=!1,this.analog=!0,this.hourOffset=0,this.minuteOffset=0,this.secondOffset=0,this.hour=".*hour.*",this.minute=".*minute.*",this.second=".*second.*",this.regex=!0,this.hands=[],this._lastEnabled=!0,this._preFrame=()=>{var h,o,c,d;if(!this.enabled){if(this._lastEnabled){if(this._lastEnabled=!1,!this.hands.length)return;for(const at of this.hands)at.object.rotation.fromArray(at.object.userData.initRotation),at.object.updateMatrixWorld();(h=this._viewer)===null||h===void 0||h.renderer.resetShadows(),(o=this._viewer)===null||o===void 0||o.setDirty()}return}if(this._lastEnabled=!0,!this.hands.length)return;const _=new Date,b=this.invertAxis?-1:1,_e=b*(_.getSeconds()+(this.analog?_.getMilliseconds()/1e3:0)-this.secondOffset)*(2*Math.PI)/60,it=b*(_.getMinutes()-this.minuteOffset)*(2*Math.PI)/60+_e/60,nt=b*(_.getHours()-this.hourOffset)*(2*Math.PI)/12+it/12;if(this.hands.find(at=>at.type==="second"&&Math.abs(_e-at.object.rotation[this.axis])>.001)){for(const at of this.hands)at.type==="second"&&(at.object.rotation[this.axis]=_e),at.type==="minute"&&(at.object.rotation[this.axis]=it),at.type==="hour"&&(at.object.rotation[this.axis]=nt);(c=this._viewer)===null||c===void 0||c.renderer.resetShadows(),(d=this._viewer)===null||d===void 0||d.setDirty()}},this._addSceneObject=async h=>{const o=h.object;o&&o.modelObject&&this.refresh()}}async onAdded(h){await super.onAdded(h),h.scene.addEventListener("addSceneObject",this._addSceneObject),h.addEventListener("preFrame",this._preFrame)}async onRemove(h){await super.onRemove(h),h.scene.removeEventListener("addSceneObject",this._addSceneObject),h.removeEventListener("preFrame",this._preFrame)}refresh(){var h;this.hands=[],(h=this.viewer)===null||h===void 0||h.scene.modelRoot.traverse(o=>{let c=!1;o.traverseAncestors(d=>{c||this.hands.find(_=>_.object===d)&&(c=!0)}),c||(o.name.match(this.regex?new RegExp(this.hour):this.hour)&&(o.userData.initRotation||(o.userData.initRotation=o.rotation.toArray()),this.hands.push({type:"hour",object:o})),o.name.match(this.regex?new RegExp(this.minute):this.minute)&&(o.userData.initRotation||(o.userData.initRotation=o.rotation.toArray()),this.hands.push({type:"minute",object:o})),o.name.match(this.regex?new RegExp(this.second):this.second)&&(o.userData.initRotation||(o.userData.initRotation=o.rotation.toArray()),this.hands.push({type:"second",object:o})))})}};WatchHandsPlugin.PluginType="WatchHandsPlugin",WatchHandsPlugin_decorate([uiToggle(),serialize()],WatchHandsPlugin.prototype,"enabled",void 0),WatchHandsPlugin_decorate([uiDropdown(void 0,["x","y","z"].map(h=>({label:h}))),serialize()],WatchHandsPlugin.prototype,"axis",void 0),WatchHandsPlugin_decorate([uiToggle(),serialize()],WatchHandsPlugin.prototype,"invertAxis",void 0),WatchHandsPlugin_decorate([uiToggle(),serialize()],WatchHandsPlugin.prototype,"analog",void 0),WatchHandsPlugin_decorate([uiSlider(void 0,[0,12],.001),serialize()],WatchHandsPlugin.prototype,"hourOffset",void 0),WatchHandsPlugin_decorate([uiSlider(void 0,[0,60],.001),serialize()],WatchHandsPlugin.prototype,"minuteOffset",void 0),WatchHandsPlugin_decorate([uiSlider(void 0,[0,60],.001),serialize()],WatchHandsPlugin.prototype,"secondOffset",void 0),WatchHandsPlugin_decorate([uiInput(),serialize()],WatchHandsPlugin.prototype,"hour",void 0),WatchHandsPlugin_decorate([uiInput(),serialize()],WatchHandsPlugin.prototype,"minute",void 0),WatchHandsPlugin_decorate([uiInput(),serialize()],WatchHandsPlugin.prototype,"second",void 0),WatchHandsPlugin_decorate([uiToggle(),x$1("refresh"),serialize()],WatchHandsPlugin.prototype,"regex",void 0),WatchHandsPlugin_decorate([uiButton()],WatchHandsPlugin.prototype,"refresh",null),WatchHandsPlugin=WatchHandsPlugin_decorate([uiFolder("Watch Hands Time")],WatchHandsPlugin);class CoreEditorApp extends ViewerApp{get editorInitialized(){return this._editorInitialized}constructor(o){super(o),this._editorInitialized=!1,this.defaultModes=[{title:"Viewer",plugins:[RendererUiPlugin,CameraUiPlugin,PresetLibraryPlugin,DropzonePlugin]},{title:"Picking",plugins:[HierarchyUiPlugin,PickingPlugin,TransformControlsPlugin,DiamondPlugin,MaterialLibraryPlugin,XAtlasPlugin,Object3DWidgetsPlugin]},{title:"Scene",plugins:[SimpleBackgroundEnvUiPlugin,GroundPlugin,SimpleViewerUi,LightsUiPlugin,SceneCamerasUiPlugin,RandomizedDirectionalLightPlugin,HDRiGroundPlugin,ContactShadowGroundPlugin,GeometryGeneratorPlugin,GradientSvgPlugin]},{title:"Anti-aliasing",plugins:[ProgressivePlugin,TemporalAAPlugin,VelocityBufferPlugin]},{title:"Post Processing",plugins:[TonemapPlugin,OutlinePlugin,LUTPlugin,ChromaticAberrationPlugin,FilmicGrainPlugin,VignettePlugin,SSRPlugin,SSAOPlugin,BloomPlugin,DepthOfFieldPlugin,SSGIPlugin,SSContactShadows,SSBevelPlugin]},{title:"Export",plugins:[AssetExporterPlugin,CanvasSnipperPlugin,CanvasRecorderPlugin,AWSClientPlugin,TransfrSharePlugin]},{title:"Animations",plugins:[GLTFAnimationPlugin,CameraViewPlugin,AnimationObjectPlugin,ScrollableCameraViewPreviewPlugin,CannonPhysicsPlugin,PosePlugin]},{title:"Modifiers",plugins:[ObjectRotationPlugin,ShapeTubeExtrudePlugin,SimpleTextPlugin,ParallaxMappingPlugin,CSGPluginBSP,CSGPluginBVH,ParallaxCameraControllerPlugin,MeshOptSimplifyModifierPlugin]},{title:"Configurators",plugins:[SwitchNodePlugin,MaterialConfiguratorPlugin,GLTFKHRMaterialVariantsPlugin,VariationConfiguratorEditorUiPlugin]},{title:"Plugins",plugins:[InteractionPromptPlugin,AnisotropyPlugin,FullScreenPlugin,CustomBumpMapPlugin,FrameFadePlugin,ClearcoatTintPlugin,ThinFilmLayerPlugin,FragmentClippingExtensionPlugin,NormalBufferPlugin,NoiseBumpMaterialPlugin,LoadingScreenPlugin,CSS3DRendererPlugin,Rhino3dmLoadPlugin,ModelStagePlugin,WatchHandsPlugin]},{title:"Extras",plugins:[ExtrasUiPlugin,SnowFallPlugin,WaveGroundPlugin,VRPluginBasic,VirtualCamerasPlugin,RainbowDiamondPlugin,BeringRingAnimation]}],setupModesStyles();const c=this.scene.activeCamera.controls;c&&(c.autoPushTarget2=!0)}async setupUi(o,c){await setupModesUi(this,o,c??this.defaultModes),this._editorInitialized=!0}}async function addEditorPlugins(h,{debug:o=!1,ground:c=!0,bloom:d=!0,depthTonemap:_=!0,importPopup:b=!0,caching:_e=!0,presetLibrary:it=!0,switchNode:nt=!0,materialConfigurator:at=!0}){h.enabled=!1,KTX2LoadPlugin.SAVE_SOURCE_BLOBS=!0,o&&await h.addPlugin(DebugPlugin),h.getPlugin(AssetManagerPlugin)||await h.addPlugin(AssetManagerPlugin,void 0,void 0,{storage:_e&&window.caches?await window.caches.open("webgi-cache-storage"):void 0}),await h.addPlugin(AssetExporterPlugin),await h.addPlugin(GLTFDracoExportPlugin),await h.addPlugin(GLTFSpecGlossinessConverterPlugin),await h.addPlugin(FileTransferPlugin),b&&((await h.addPlugin(LoadingScreenPlugin)).isEditor=!0),await h.addPlugin(WindowiseDialogPlugin),await h.addPlugin(VirtualCamerasPlugin,!1),await h.getOrAddPlugin(KTXLoadPlugin),await h.addPlugin(PopmotionPlugin),await h.getOrAddPlugin(DropzonePlugin),await h.addPlugin(CannonPhysicsPlugin),await h.addPlugin(TransformAnimationPlugin),await h.addPlugin(PickingPlugin,BoxSelectionWidget,!1,!0),await h.addPlugin(TransformControlsPlugin,!1),await addBasePlugins(h,{ground:c,bloom:d,depthTonemap:_}),(await h.getOrAddPlugin(FrameFadePlugin)).isEditor=!0,it&&await h.getOrAddPlugin(PresetLibraryPlugin),await h.getOrAddPlugin(DiamondPlugin),await h.addPlugin(OutlinePlugin),await h.addPlugin(ParallaxMappingPlugin,!1),await h.addPlugin(DeviceOrientationControlsPlugin),await h.addPlugin(FirstPersonControlsPlugin),await h.addPlugin(PointerLockControlsPlugin),await h.addPlugin(TrackballControlsPlugin),await h.addPlugin(CSS3DRendererPlugin,!1),await h.addPlugin(new ObjectRotationPlugin(!1)),await h.addPlugin(ShapeTubeExtrudePlugin),await h.addPlugin(SimpleTextPlugin),at&&((await h.addPlugin(MaterialConfiguratorPlugin)).enableEditContextMenus=!0),nt&&await h.addPlugin(SwitchNodePlugin),await h.addPlugin(VariationConfiguratorEditorUiPlugin),await h.addPlugin(MaterialLibraryPlugin),await h.addPlugin(CanvasRecorderPlugin),await h.addPlugin(CanvasSnipperPlugin),await h.addPlugin(HierarchyUiPlugin),await h.addPlugin(SimpleViewerUi),await h.addPlugin(LightsUiPlugin),await h.addPlugin(SceneCamerasUiPlugin),await h.addPlugin(RendererUiPlugin),await h.addPlugin(CameraUiPlugin),await h.addPlugin(SimpleBackgroundEnvUiPlugin),await h.addPlugin(Object3DWidgetsPlugin,!1),await h.addPlugin(GeometryGeneratorPlugin),await h.addPlugin(XAtlasPlugin),await h.addPlugin(ScrollableCameraViewPreviewPlugin,h.container,!1),await h.addPlugin(AWSClientPlugin),await h.addPlugin(RainbowDiamondPlugin),await h.addPlugin(TransfrSharePlugin),await h.addPlugin(GradientSvgPlugin),await h.addPlugin(AnimationObjectPlugin),await h.addPlugin(MeshOptSimplifyModifierPlugin),await h.addPlugin(SnowFallPlugin),await h.addPlugin(WaveGroundPlugin),await h.addPlugin(PosePlugin),await h.addPlugin(WatchHandsPlugin);const ut=await h.addPlugin(new TweakpaneUiPlugin(!we$1()));return h.renderer.refreshPipeline(),h.scene.addEventListener("textureAdded",pt=>{pt.texture&&h.setEnvironmentMap(pt.texture)}),ut.setupPluginUi(FullScreenPlugin),ut.setupPluginUi(RendererUiPlugin),ut.setupPluginUi(CameraUiPlugin),ut.setupPluginUi(LoadingScreenPlugin),ut.setupPluginUi(DropzonePlugin),ut.setupPluginUi(SimpleBackgroundEnvUiPlugin),ut.setupPluginUi(AssetExporterPlugin),ut.setupPluginUi(GLTFAnimationPlugin),ut.setupPluginUi(RandomizedDirectionalLightPlugin),nt&&ut.setupPluginUi(SwitchNodePlugin),at&&ut.setupPluginUi(MaterialConfiguratorPlugin),ut.setupPluginUi(CannonPhysicsPlugin),ut.setupPluginUi(HierarchyUiPlugin),ut.setupPluginUi(MaterialLibraryPlugin),ut.setupPluginUi(DiamondPlugin),ut.setupPluginUi(TransformControlsPlugin),ut.setupPluginUi(PickingPlugin),c&&h.getPlugin(GroundPlugin)&&ut.setupPluginUi(GroundPlugin),c&&h.getPlugin(ContactShadowGroundPlugin)&&ut.setupPluginUi(ContactShadowGroundPlugin),ut.setupPluginUi(SSRPlugin),ut.setupPluginUi(CameraViewPlugin),ut.setupPluginUi(CanvasRecorderPlugin),ut.setupPluginUi(TonemapPlugin),ut.setupPluginUi(OutlinePlugin),ut.setupPluginUi(ChromaticAberrationPlugin),ut.setupPluginUi(FilmicGrainPlugin),ut.setupPluginUi(LUTPlugin),ut.setupPluginUi(VignettePlugin),ut.setupPluginUi(DepthOfFieldPlugin),ut.setupPluginUi(SSAOPlugin),ut.setupPluginUi(NormalBufferPlugin),ut.setupPluginUi(SSBevelPlugin),ut.setupPluginUi(SimpleViewerUi),ut.setupPluginUi(ObjectRotationPlugin),ut.setupPluginUi(ShapeTubeExtrudePlugin),ut.setupPluginUi(ProgressivePlugin),ut.setupPluginUi(GradientSvgPlugin),ut.setupPluginUi(AnimationObjectPlugin),ut.setupPluginUi(LightsUiPlugin),ut.setupPluginUi(SceneCamerasUiPlugin),ut.setupPluginUi(ThinFilmLayerPlugin),ut.setupPluginUi(FragmentClippingExtensionPlugin),ut.setupPluginUi(NoiseBumpMaterialPlugin),d&&ut.setupPluginUi(BloomPlugin),ut.setupPluginUi(CanvasSnipperPlugin),ut.setupPluginUi(AnisotropyPlugin),ut.setupPluginUi(TemporalAAPlugin),ut.setupPluginUi(HDRiGroundPlugin),ut.setupPluginUi(SSGIPlugin),ut.setupPluginUi(SSContactShadows),ut.setupPluginUi(SimpleTextPlugin),ut.setupPluginUi(FrameFadePlugin),ut.setupPluginUi(VelocityBufferPlugin),ut.setupPluginUi(ModelStagePlugin),it&&ut.setupPluginUi(PresetLibraryPlugin),ut.setupPluginUi(GLTFKHRMaterialVariantsPlugin),ut.setupPluginUi(CustomBumpMapPlugin),ut.setupPluginUi(ParallaxMappingPlugin),ut.setupPluginUi(CSS3DRendererPlugin),ut.setupPluginUi(AWSClientPlugin),ut.setupPluginUi(ScrollableCameraViewPreviewPlugin),ut.setupPluginUi(XAtlasPlugin),ut.setupPluginUi(VariationConfiguratorEditorUiPlugin),ut.setupPluginUi(ParallaxCameraControllerPlugin),ut.setupPluginUi(Object3DWidgetsPlugin),ut.setupPluginUi(Rhino3dmLoadPlugin),ut.setupPluginUi(VirtualCamerasPlugin),ut.setupPluginUi(GeometryGeneratorPlugin),ut.setupPluginUi(InteractionPromptPlugin),ut.setupPluginUi(RainbowDiamondPlugin),ut.setupPluginUi(TransfrSharePlugin),ut.setupPluginUi(MeshOptSimplifyModifierPlugin),ut.setupPluginUi(SnowFallPlugin),ut.setupPluginUi(WaveGroundPlugin),ut.setupPluginUi(PosePlugin),ut.setupPluginUi(WatchHandsPlugin),h.enabled=!0,h}async function setupSandboxWebGiEditor(h,{debug:o=!1,ground:c=!0,bloom:d=!0,depthTonemap:_=!0,importPopup:b=!0,caching:_e=!0}){const it=new ViewerApp(h);return await addEditorPlugins(it,{debug:o,ground:c,bloom:d,depthTonemap:_,importPopup:b,caching:_e}),it}async function setupCoreWebGiViewer(h,{debug:o=!1,ground:c=!0,bloom:d=!0,depthTonemap:_=!0,importPopup:b=!1,enableDrop:_e=!1,caching:it=!0}={}){const nt=new ViewerApp(h);return o&&await nt.addPlugin(DebugPlugin),nt.getPlugin(AssetManagerPlugin)||nt.addPluginSync(AssetManagerPlugin,void 0,void 0,{storage:it&&window.caches?await caches.open("webgi-cache-storage"):void 0}),await nt.addPlugin(AssetManagerLoadingBarPlugin,!0),await addBasePlugins(nt,{ground:c,bloom:d,depthTonemap:_,enableDrop:_e,importPopup:b}),await nt.getOrAddPlugin(DiamondPlugin),nt}var __webpackgi_exports__AAssetManagerProcessStatePlugin=__webpackgi_exports__.CZu,__webpackgi_exports__ACESFilmicToneMapping=__webpackgi_exports__.FV,__webpackgi_exports__ACameraControlsPlugin=__webpackgi_exports__.oK2,__webpackgi_exports__ACanvasRecorder=__webpackgi_exports__.SLH,__webpackgi_exports__ALL_WEBGI_EXTENSIONS=__webpackgi_exports__.yo9,__webpackgi_exports__AMaterialManager=__webpackgi_exports__.YJd,__webpackgi_exports__ARPlacementBox=__webpackgi_exports__.qnC,__webpackgi_exports__ARPlugin=__webpackgi_exports__.TtJ,__webpackgi_exports__ARTouchInputHelper=__webpackgi_exports__.rUH,__webpackgi_exports__AShaderMaterial2=__webpackgi_exports__.oAs,__webpackgi_exports__AViewerPlugin=__webpackgi_exports__.$fV,__webpackgi_exports__AWSClientPlugin=__webpackgi_exports__.upe,__webpackgi_exports__AddBlendPass=__webpackgi_exports__.yPJ,__webpackgi_exports__AddEquation=__webpackgi_exports__.gO9,__webpackgi_exports__AddOperation=__webpackgi_exports__.XrR,__webpackgi_exports__AdditiveAnimationBlendMode=__webpackgi_exports__.DAe,__webpackgi_exports__AdditiveBlending=__webpackgi_exports__.EZo,__webpackgi_exports__AlphaFormat=__webpackgi_exports__.wrO,__webpackgi_exports__AlwaysCompare=__webpackgi_exports__.FFZ,__webpackgi_exports__AlwaysDepth=__webpackgi_exports__.lGu,__webpackgi_exports__AlwaysStencilFunc=__webpackgi_exports__.sKt,__webpackgi_exports__AmbientLight=__webpackgi_exports__.$p8,__webpackgi_exports__AmbientLight2=__webpackgi_exports__.nJr,__webpackgi_exports__AnimationAction=__webpackgi_exports__.pPE,__webpackgi_exports__AnimationClip=__webpackgi_exports__.tz3,__webpackgi_exports__AnimationLoader=__webpackgi_exports__.kEx,__webpackgi_exports__AnimationMixer=__webpackgi_exports__.Iw4,__webpackgi_exports__AnimationObjectGroup=__webpackgi_exports__.P5j,__webpackgi_exports__AnimationUtils=__webpackgi_exports__.AKb,__webpackgi_exports__AnisotropyPlugin=__webpackgi_exports__.GXy,__webpackgi_exports__ArcCurve=__webpackgi_exports__.ibB,__webpackgi_exports__ArrayCamera=__webpackgi_exports__.nZQ,__webpackgi_exports__ArrowHelper=__webpackgi_exports__.E0M,__webpackgi_exports__AssetExporter=__webpackgi_exports__.GLG,__webpackgi_exports__AssetExporterPlugin=__webpackgi_exports__.$VP,__webpackgi_exports__AssetImporter=__webpackgi_exports__.NeI,__webpackgi_exports__AssetManagerBasicPopupPlugin=__webpackgi_exports__.rzc,__webpackgi_exports__AssetManagerLoadingBarPlugin=__webpackgi_exports__.Kiu,__webpackgi_exports__AssetManagerPlugin=__webpackgi_exports__.XDT,__webpackgi_exports__AsyncCompress=__webpackgi_exports__.XiN,__webpackgi_exports__AsyncDecompress=__webpackgi_exports__._I9,__webpackgi_exports__AsyncDeflate=__webpackgi_exports__.ShE,__webpackgi_exports__AsyncGunzip=__webpackgi_exports__.OXP,__webpackgi_exports__AsyncGzip=__webpackgi_exports__.JZ8,__webpackgi_exports__AsyncInflate=__webpackgi_exports__.gS4,__webpackgi_exports__AsyncUnzipInflate=__webpackgi_exports__.eFx,__webpackgi_exports__AsyncUnzlib=__webpackgi_exports__.peq,__webpackgi_exports__AsyncZipDeflate=__webpackgi_exports__.hw0,__webpackgi_exports__AsyncZlib=__webpackgi_exports__._DG,__webpackgi_exports__Audio=__webpackgi_exports__.fP5,__webpackgi_exports__AudioAnalyser=__webpackgi_exports__.CwR,__webpackgi_exports__AudioContext=__webpackgi_exports__.UtX,__webpackgi_exports__AudioListener=__webpackgi_exports__.Pf$,__webpackgi_exports__AudioLoader=__webpackgi_exports__.Am1,__webpackgi_exports__AxesHelper=__webpackgi_exports__.IzY,__webpackgi_exports__BackSide=__webpackgi_exports__.hsX,__webpackgi_exports__BackgroundPresetGroup=__webpackgi_exports__.XFr,__webpackgi_exports__BaseGroundPlugin=__webpackgi_exports__.Eh1,__webpackgi_exports__BaseRenderer=__webpackgi_exports__.RJS,__webpackgi_exports__BasicDepthPacking=__webpackgi_exports__.Rkk,__webpackgi_exports__BasicShadowMap=__webpackgi_exports__.bTm,__webpackgi_exports__BeringRingAnimation=__webpackgi_exports__.Otl,__webpackgi_exports__BlobLoader=__webpackgi_exports__.pOj,__webpackgi_exports__BloomPlugin=__webpackgi_exports__.jg0,__webpackgi_exports__Bone=__webpackgi_exports__.$Kf,__webpackgi_exports__BooleanKeyframeTrack=__webpackgi_exports__.YOZ,__webpackgi_exports__Box2=__webpackgi_exports__.UtB,__webpackgi_exports__Box3=__webpackgi_exports__.NRn,__webpackgi_exports__Box3B=__webpackgi_exports__.DYt,__webpackgi_exports__Box3Helper=__webpackgi_exports__.BND,__webpackgi_exports__BoxGeometry=__webpackgi_exports__.iNn,__webpackgi_exports__BoxHelper=__webpackgi_exports__.IWo,__webpackgi_exports__BoxSelectionWidget=__webpackgi_exports__.SYd,__webpackgi_exports__BufferAttribute=__webpackgi_exports__.THS,__webpackgi_exports__BufferGeometry=__webpackgi_exports__.LoY,__webpackgi_exports__BufferGeometryLoader=__webpackgi_exports__.SUR,__webpackgi_exports__ByteType=__webpackgi_exports__.tJf,__webpackgi_exports__CSGPluginBSP=__webpackgi_exports__.Y3u,__webpackgi_exports__CSGPluginBVH=__webpackgi_exports__.poD,__webpackgi_exports__CSGPluginBase=__webpackgi_exports__.gaG,__webpackgi_exports__CSS3DRendererPlugin=__webpackgi_exports__.z0x,__webpackgi_exports__Cache=__webpackgi_exports__.l2R,__webpackgi_exports__Camera=__webpackgi_exports__.i7d,__webpackgi_exports__CameraController=__webpackgi_exports__.mL7,__webpackgi_exports__CameraHelper=__webpackgi_exports__.WTh,__webpackgi_exports__CameraUiPlugin=__webpackgi_exports__.l5h,__webpackgi_exports__CameraView=__webpackgi_exports__.hzv,__webpackgi_exports__CameraViewControlPlugin=__webpackgi_exports__.f_U,__webpackgi_exports__CameraViewPlugin=__webpackgi_exports__.sxt,__webpackgi_exports__CannonPhysicsPlugin=__webpackgi_exports__.af0,__webpackgi_exports__CanvasMediaRecorder=__webpackgi_exports__.Phj,__webpackgi_exports__CanvasRecorder=__webpackgi_exports__.p5D,__webpackgi_exports__CanvasRecorderPlugin=__webpackgi_exports__.CS6,__webpackgi_exports__CanvasSnipper=__webpackgi_exports__.aKT,__webpackgi_exports__CanvasSnipperPlugin=__webpackgi_exports__.RzO,__webpackgi_exports__CanvasTexture=__webpackgi_exports__.GOR,__webpackgi_exports__CapsuleGeometry=__webpackgi_exports__.qU7,__webpackgi_exports__CatmullRomCurve3=__webpackgi_exports__.B6O,__webpackgi_exports__ChromaticAberrationPlugin=__webpackgi_exports__.z1d,__webpackgi_exports__CineonToneMapping=__webpackgi_exports__.nNL,__webpackgi_exports__CircleGeometry=__webpackgi_exports__.tcD,__webpackgi_exports__ClampToEdgeWrapping=__webpackgi_exports__.ghU,__webpackgi_exports__ClearcoatTintPlugin=__webpackgi_exports__.Dk8,__webpackgi_exports__Clock=__webpackgi_exports__.zD7,__webpackgi_exports__Color=__webpackgi_exports__.Q1f,__webpackgi_exports__ColorKeyframeTrack=__webpackgi_exports__.T6I,__webpackgi_exports__ColorManagement=__webpackgi_exports__.ppV,__webpackgi_exports__CombinedPostPlugin=__webpackgi_exports__.FvD,__webpackgi_exports__Compress=__webpackgi_exports__.n3b,__webpackgi_exports__CompressedArrayTexture=__webpackgi_exports__.iOZ,__webpackgi_exports__CompressedCubeTexture=__webpackgi_exports__.c5h,__webpackgi_exports__CompressedTexture=__webpackgi_exports__.YSM,__webpackgi_exports__CompressedTextureLoader=__webpackgi_exports__.YRT,__webpackgi_exports__ConeGeometry=__webpackgi_exports__.qFE,__webpackgi_exports__ContactShadowGroundPlugin=__webpackgi_exports__.fCM,__webpackgi_exports__CoreEditorApp=__webpackgi_exports__.afc,__webpackgi_exports__CoreViewerApp=__webpackgi_exports__.hLJ,__webpackgi_exports__CubeCamera=__webpackgi_exports__.F1T,__webpackgi_exports__CubeNormalsCaptureHelper=__webpackgi_exports__.SXA,__webpackgi_exports__CubeReflectionMapping=__webpackgi_exports__.hy7,__webpackgi_exports__CubeRefractionMapping=__webpackgi_exports__.xFO,__webpackgi_exports__CubeTexture=__webpackgi_exports__.b4q,__webpackgi_exports__CubeTextureLoader=__webpackgi_exports__.ScU,__webpackgi_exports__CubeUVReflectionMapping=__webpackgi_exports__.Om,__webpackgi_exports__CubicBezierCurve=__webpackgi_exports__.Z0B,__webpackgi_exports__CubicBezierCurve3=__webpackgi_exports__.s0K,__webpackgi_exports__CubicInterpolant=__webpackgi_exports__.Pdi,__webpackgi_exports__CullFaceBack=__webpackgi_exports__.Vb5,__webpackgi_exports__CullFaceFront=__webpackgi_exports__.Jnc,__webpackgi_exports__CullFaceFrontBack=__webpackgi_exports__.ywQ,__webpackgi_exports__CullFaceNone=__webpackgi_exports__.WNZ,__webpackgi_exports__Curve=__webpackgi_exports__.Ipv,__webpackgi_exports__CurvePath=__webpackgi_exports__.jGm,__webpackgi_exports__CustomAnimationHelper=__webpackgi_exports__.Ogy,__webpackgi_exports__CustomAnimationHelperPlugin=__webpackgi_exports__.xLk,__webpackgi_exports__CustomBlending=__webpackgi_exports__.bCz,__webpackgi_exports__CustomBumpMapPlugin=__webpackgi_exports__.bGG,__webpackgi_exports__CustomToneMapping=__webpackgi_exports__.g7M,__webpackgi_exports__CylinderGeometry=__webpackgi_exports__.Ho_,__webpackgi_exports__Cylindrical=__webpackgi_exports__.hjs,__webpackgi_exports__DRACOLoader2=__webpackgi_exports__.Zn9,__webpackgi_exports__Damper=__webpackgi_exports__.AHf,__webpackgi_exports__Data3DTexture=__webpackgi_exports__.dYF,__webpackgi_exports__DataArrayTexture=__webpackgi_exports__.rFo,__webpackgi_exports__DataTexture=__webpackgi_exports__.GYF,__webpackgi_exports__DataTextureLoader=__webpackgi_exports__.BRH,__webpackgi_exports__DataUrlLoader=__webpackgi_exports__.psi,__webpackgi_exports__DataUtils=__webpackgi_exports__.GxU,__webpackgi_exports__DebugPlugin=__webpackgi_exports__.n2t,__webpackgi_exports__DecodeUTF8=__webpackgi_exports__.yuL,__webpackgi_exports__Decompress=__webpackgi_exports__.YMq,__webpackgi_exports__DecrementStencilOp=__webpackgi_exports__.ROr,__webpackgi_exports__DecrementWrapStencilOp=__webpackgi_exports__.fJr,__webpackgi_exports__DefaultLoadingManager=__webpackgi_exports__.h_9,__webpackgi_exports__Deflate=__webpackgi_exports__.Gyi,__webpackgi_exports__DepthFormat=__webpackgi_exports__.zdS,__webpackgi_exports__DepthOfFieldPass=__webpackgi_exports__.WCV,__webpackgi_exports__DepthOfFieldPlugin=__webpackgi_exports__._Vf,__webpackgi_exports__DepthStencilFormat=__webpackgi_exports__.dcC,__webpackgi_exports__DepthTexture=__webpackgi_exports__.VCu,__webpackgi_exports__DeviceOrientationControls2=__webpackgi_exports__.n1S,__webpackgi_exports__DeviceOrientationControlsPlugin=__webpackgi_exports__.sOF,__webpackgi_exports__DiamondMaterial=__webpackgi_exports__.aFP,__webpackgi_exports__DiamondPlugin=__webpackgi_exports__.GMU,__webpackgi_exports__DirectionalLight=__webpackgi_exports__.ZyN,__webpackgi_exports__DirectionalLight2=__webpackgi_exports__.rFg,__webpackgi_exports__DirectionalLightHelper=__webpackgi_exports__.PFK,__webpackgi_exports__DiscreteInterpolant=__webpackgi_exports__.Yhb,__webpackgi_exports__DisplayP3ColorSpace=__webpackgi_exports__.V5c,__webpackgi_exports__DodecahedronGeometry=__webpackgi_exports__.nEu,__webpackgi_exports__DoubleSide=__webpackgi_exports__.$EB,__webpackgi_exports__Dropzone=__webpackgi_exports__.mRE,__webpackgi_exports__DropzonePlugin=__webpackgi_exports__.hSt,__webpackgi_exports__DstAlphaFactor=__webpackgi_exports__.hdd,__webpackgi_exports__DstColorFactor=__webpackgi_exports__.wn6,__webpackgi_exports__DynamicCopyUsage=__webpackgi_exports__.MOq,__webpackgi_exports__DynamicDrawUsage=__webpackgi_exports__.Vnu,__webpackgi_exports__DynamicReadUsage=__webpackgi_exports__.hIf,__webpackgi_exports__EXRExporter2=__webpackgi_exports__.d5G,__webpackgi_exports__EXRLoadPlugin=__webpackgi_exports__.vr8,__webpackgi_exports__EasingFunctions=__webpackgi_exports__.JCs,__webpackgi_exports__EdgesGeometry=__webpackgi_exports__.TDQ,__webpackgi_exports__EffectComposer2=__webpackgi_exports__.WYq,__webpackgi_exports__EllipseCurve=__webpackgi_exports__.S20,__webpackgi_exports__EllipseCurve3D=__webpackgi_exports__.LWT,__webpackgi_exports__EncodeUTF8=__webpackgi_exports__.MJ1,__webpackgi_exports__EncoderMethod=__webpackgi_exports__.KDW,__webpackgi_exports__EnvironmentPresetGroup=__webpackgi_exports__.SQT,__webpackgi_exports__EqualCompare=__webpackgi_exports__.kO0,__webpackgi_exports__EqualDepth=__webpackgi_exports__.U3G,__webpackgi_exports__EqualStencilFunc=__webpackgi_exports__.jsO,__webpackgi_exports__EquirectangularReflectionMapping=__webpackgi_exports__.wfO,__webpackgi_exports__EquirectangularRefractionMapping=__webpackgi_exports__.uV5,__webpackgi_exports__Euler=__webpackgi_exports__.O9p,__webpackgi_exports__EventDispatcher=__webpackgi_exports__.Qev,__webpackgi_exports__ExtrasUiPlugin=__webpackgi_exports__.j8I,__webpackgi_exports__ExtrudeGeometry=__webpackgi_exports__.QCA,__webpackgi_exports__FBXLoadPlugin=__webpackgi_exports__.ol2,__webpackgi_exports__FFMPEGRecorder=__webpackgi_exports__.y74,__webpackgi_exports__FSShadowMaterial=__webpackgi_exports__.lT0,__webpackgi_exports__FileLoader=__webpackgi_exports__.Y9S,__webpackgi_exports__FileTransferPlugin=__webpackgi_exports__.ryq,__webpackgi_exports__FilmicGrainPlugin=__webpackgi_exports__.xcV,__webpackgi_exports__FirstPersonControls2=__webpackgi_exports__.OMG,__webpackgi_exports__FirstPersonControlsPlugin=__webpackgi_exports__.Vkg,__webpackgi_exports__Float16BufferAttribute=__webpackgi_exports__.Oax,__webpackgi_exports__Float32BufferAttribute=__webpackgi_exports__.qtW,__webpackgi_exports__Float64BufferAttribute=__webpackgi_exports__.V58,__webpackgi_exports__FloatType=__webpackgi_exports__.RQf,__webpackgi_exports__Fog=__webpackgi_exports__.jUj,__webpackgi_exports__FogExp2=__webpackgi_exports__.cRK,__webpackgi_exports__FragmentClippingExtensionPlugin=__webpackgi_exports__.ziY,__webpackgi_exports__FragmentClippingMode=__webpackgi_exports__.kzd,__webpackgi_exports__FrameFadePlugin=__webpackgi_exports__.VNy,__webpackgi_exports__FramebufferTexture=__webpackgi_exports__.Pem,__webpackgi_exports__FrontSide=__webpackgi_exports__.hB5,__webpackgi_exports__Frustum=__webpackgi_exports__.PPD,__webpackgi_exports__FullScreenPlugin=__webpackgi_exports__.BH6,__webpackgi_exports__GBufferPlugin=__webpackgi_exports__.HSI,__webpackgi_exports__GLBufferAttribute=__webpackgi_exports__.oh6,__webpackgi_exports__GLSL1=__webpackgi_exports__.Wyr,__webpackgi_exports__GLSL3=__webpackgi_exports__.Wdf,__webpackgi_exports__GLTFAnimationPlugin=__webpackgi_exports__.P3V,__webpackgi_exports__GLTFDracoExportPlugin=__webpackgi_exports__.s0N,__webpackgi_exports__GLTFDracoExporter=__webpackgi_exports__._Js,__webpackgi_exports__GLTFExporter2=__webpackgi_exports__.xQA,__webpackgi_exports__GLTFExporterMaterialsVariantsExtensionExport=__webpackgi_exports__.Yeh,__webpackgi_exports__GLTFKHRMaterialVariantsPlugin=__webpackgi_exports__.N30,__webpackgi_exports__GLTFLoader2=__webpackgi_exports__.P44,__webpackgi_exports__GLTFMaterialsVariantsExtensionImport=__webpackgi_exports__.MdZ,__webpackgi_exports__GLTFMeshGpuInstancingExporter=__webpackgi_exports__.Cc9,__webpackgi_exports__GLTFMeshOptPlugin=__webpackgi_exports__.HjZ,__webpackgi_exports__GLTFSpecGlossinessConverterPlugin=__webpackgi_exports__.UX5,__webpackgi_exports__GLTFWriter2=__webpackgi_exports__.fGP,__webpackgi_exports__GammaCorrectionExtension=__webpackgi_exports__.T03,__webpackgi_exports__GammaCorrectionPlugin=__webpackgi_exports__.fPK,__webpackgi_exports__GemEnvironmentPresetGroup=__webpackgi_exports__.XpU,__webpackgi_exports__GenericBlendTexturePass=__webpackgi_exports__.hUz,__webpackgi_exports__GenericFilterPlugin=__webpackgi_exports__.pbu,__webpackgi_exports__GeometryGeneratorPlugin=__webpackgi_exports__.jhn,__webpackgi_exports__GreaterCompare=__webpackgi_exports__.eoi,__webpackgi_exports__GreaterDepth=__webpackgi_exports__.K52,__webpackgi_exports__GreaterEqualCompare=__webpackgi_exports__.gWB,__webpackgi_exports__GreaterEqualDepth=__webpackgi_exports__.Gwm,__webpackgi_exports__GreaterEqualStencilFunc=__webpackgi_exports__.TMh,__webpackgi_exports__GreaterStencilFunc=__webpackgi_exports__.RcT,__webpackgi_exports__GridHelper=__webpackgi_exports__.fTw,__webpackgi_exports__GroundPlugin=__webpackgi_exports__.Hx_,__webpackgi_exports__Group=__webpackgi_exports__.YJl,__webpackgi_exports__Gunzip=__webpackgi_exports__.asK,__webpackgi_exports__GyroInputDevice=__webpackgi_exports__._qo,__webpackgi_exports__Gzip=__webpackgi_exports__.Ne,__webpackgi_exports__HDRiGroundPlugin=__webpackgi_exports__.Guc,__webpackgi_exports__HalfFloatType=__webpackgi_exports__.ix0,__webpackgi_exports__HemisphereLight=__webpackgi_exports__.dth,__webpackgi_exports__HemisphereLightHelper=__webpackgi_exports__.R1W,__webpackgi_exports__HierarchyUiPlugin=__webpackgi_exports__.tcR,__webpackgi_exports__IcosahedronGeometry=__webpackgi_exports__.WBB,__webpackgi_exports__ImageBitmapLoader=__webpackgi_exports__.Kzg,__webpackgi_exports__ImageLoader=__webpackgi_exports__.$NF,__webpackgi_exports__ImageSequenceRecorder=__webpackgi_exports__.NuM,__webpackgi_exports__ImageUtils=__webpackgi_exports__.HgN,__webpackgi_exports__Importer=__webpackgi_exports__.l9C,__webpackgi_exports__IncrementStencilOp=__webpackgi_exports__.HLH,__webpackgi_exports__IncrementWrapStencilOp=__webpackgi_exports__.Ru$,__webpackgi_exports__Inflate=__webpackgi_exports__.ELl,__webpackgi_exports__InstancedBufferAttribute=__webpackgi_exports__.uWO,__webpackgi_exports__InstancedBufferGeometry=__webpackgi_exports__.CmU,__webpackgi_exports__InstancedInterleavedBuffer=__webpackgi_exports__.LuO,__webpackgi_exports__InstancedMesh=__webpackgi_exports__.ZLX,__webpackgi_exports__Int16BufferAttribute=__webpackgi_exports__.Hrb,__webpackgi_exports__Int32BufferAttribute=__webpackgi_exports__.vmz,__webpackgi_exports__Int8BufferAttribute=__webpackgi_exports__.wvS,__webpackgi_exports__IntType=__webpackgi_exports__.Yuy,__webpackgi_exports__InteractionPromptPlugin=__webpackgi_exports__.K5h,__webpackgi_exports__InterleavedBuffer=__webpackgi_exports__.eB$,__webpackgi_exports__InterleavedBufferAttribute=__webpackgi_exports__.eHs,__webpackgi_exports__Interpolant=__webpackgi_exports__.lGw,__webpackgi_exports__InterpolateDiscrete=__webpackgi_exports__.ljd,__webpackgi_exports__InterpolateLinear=__webpackgi_exports__.PJ3,__webpackgi_exports__InterpolateSmooth=__webpackgi_exports__.EQC,__webpackgi_exports__InvertStencilOp=__webpackgi_exports__.oVO,__webpackgi_exports__KHR_TEXTURE_BASISU=__webpackgi_exports__.Yj4,__webpackgi_exports__KTX2LoadPlugin=__webpackgi_exports__.ZPL,__webpackgi_exports__KTXLoadPlugin=__webpackgi_exports__.$16,__webpackgi_exports__KeepStencilOp=__webpackgi_exports__.VVr,__webpackgi_exports__KeyframeTrack=__webpackgi_exports__.UJ6,__webpackgi_exports__LOD=__webpackgi_exports__.UpK,__webpackgi_exports__LUTPlugin=__webpackgi_exports__.ZYb,__webpackgi_exports__LatheGeometry=__webpackgi_exports__.nzx,__webpackgi_exports__LayeredMaterialPlugin=__webpackgi_exports__.DLJ,__webpackgi_exports__Layers=__webpackgi_exports__.zgK,__webpackgi_exports__LessCompare=__webpackgi_exports__.vim,__webpackgi_exports__LessDepth=__webpackgi_exports__.brA,__webpackgi_exports__LessEqualCompare=__webpackgi_exports__.TiK,__webpackgi_exports__LessEqualDepth=__webpackgi_exports__.xSv,__webpackgi_exports__LessEqualStencilFunc=__webpackgi_exports__.CR7,__webpackgi_exports__LessStencilFunc=__webpackgi_exports__.kYr,__webpackgi_exports__Light=__webpackgi_exports__.veJ,__webpackgi_exports__LightProbe=__webpackgi_exports__.FZo,__webpackgi_exports__LightsUiPlugin=__webpackgi_exports__.Dvx,__webpackgi_exports__Line=__webpackgi_exports__.N1A,__webpackgi_exports__Line2=__webpackgi_exports__.XkL,__webpackgi_exports__Line3=__webpackgi_exports__.cZY,__webpackgi_exports__LineBasicMaterial=__webpackgi_exports__.mrM,__webpackgi_exports__LineCurve=__webpackgi_exports__.GZZ,__webpackgi_exports__LineCurve3=__webpackgi_exports__.VnP,__webpackgi_exports__LineDashedMaterial=__webpackgi_exports__.Fvt,__webpackgi_exports__LineGeometry=__webpackgi_exports__.vK6,__webpackgi_exports__LineLoop=__webpackgi_exports__.FCc,__webpackgi_exports__LineMaterial=__webpackgi_exports__.GV4,__webpackgi_exports__LineSegments=__webpackgi_exports__.DXC,__webpackgi_exports__LineSegments2=__webpackgi_exports__.bFd,__webpackgi_exports__LineSegmentsGeometry=__webpackgi_exports__.n31,__webpackgi_exports__LinearDisplayP3ColorSpace=__webpackgi_exports__.qIQ,__webpackgi_exports__LinearEncoding=__webpackgi_exports__.tgE,__webpackgi_exports__LinearFilter=__webpackgi_exports__.k6q,__webpackgi_exports__LinearInterpolant=__webpackgi_exports__.ezk,__webpackgi_exports__LinearMipMapLinearFilter=__webpackgi_exports__.NZq,__webpackgi_exports__LinearMipMapNearestFilter=__webpackgi_exports__.iUH,__webpackgi_exports__LinearMipmapLinearFilter=__webpackgi_exports__.$_I,__webpackgi_exports__LinearMipmapNearestFilter=__webpackgi_exports__.kRr,__webpackgi_exports__LinearSRGBColorSpace=__webpackgi_exports__.Zr2,__webpackgi_exports__LinearToneMapping=__webpackgi_exports__.kyO,__webpackgi_exports__LinearTransfer=__webpackgi_exports__.VxR,__webpackgi_exports__Loader=__webpackgi_exports__.aHM,__webpackgi_exports__LoaderUtils=__webpackgi_exports__.r6x,__webpackgi_exports__LoadingManager=__webpackgi_exports__.KPJ,__webpackgi_exports__LoadingScreenPlugin=__webpackgi_exports__.O0Q,__webpackgi_exports__LoopOnce=__webpackgi_exports__.G3T,__webpackgi_exports__LoopPingPong=__webpackgi_exports__.lc7,__webpackgi_exports__LoopRepeat=__webpackgi_exports__.aMy,__webpackgi_exports__LuminanceAlphaFormat=__webpackgi_exports__.CMB,__webpackgi_exports__LuminanceFormat=__webpackgi_exports__.Kzv,__webpackgi_exports__MOUSE=__webpackgi_exports__.kBv,__webpackgi_exports__MTLLoader2=__webpackgi_exports__.T6P,__webpackgi_exports__Material=__webpackgi_exports__.imn,__webpackgi_exports__MaterialConfiguratorBasePlugin=__webpackgi_exports__.Bhh,__webpackgi_exports__MaterialConfiguratorPlugin=__webpackgi_exports__.q$N,__webpackgi_exports__MaterialExtender=__webpackgi_exports__.pzC,__webpackgi_exports__MaterialLibPresetGroupPresetGroup=__webpackgi_exports__.xbg,__webpackgi_exports__MaterialLibraryBasePlugin=__webpackgi_exports__.LTv,__webpackgi_exports__MaterialLibraryPlugin=__webpackgi_exports__.usO,__webpackgi_exports__MaterialLoader=__webpackgi_exports__.jut,__webpackgi_exports__MaterialManager=__webpackgi_exports__.Jxy,__webpackgi_exports__MaterialPresetPlugin=__webpackgi_exports__.Kmw,__webpackgi_exports__MaterialPreviewGenerator=__webpackgi_exports__.jR8,__webpackgi_exports__MathUtils=__webpackgi_exports__.cj9,__webpackgi_exports__Matrix3=__webpackgi_exports__.dwI,__webpackgi_exports__Matrix4=__webpackgi_exports__.kn4,__webpackgi_exports__MaxEquation=__webpackgi_exports__.$ei,__webpackgi_exports__Mesh=__webpackgi_exports__.eaF,__webpackgi_exports__MeshBasicMaterial=__webpackgi_exports__.V9B,__webpackgi_exports__MeshBasicMaterial2=__webpackgi_exports__.NLY,__webpackgi_exports__MeshDepthMaterial=__webpackgi_exports__.CSG,__webpackgi_exports__MeshDistanceMaterial=__webpackgi_exports__.aVO,__webpackgi_exports__MeshLambertMaterial=__webpackgi_exports__.G_z,__webpackgi_exports__MeshMatcapMaterial=__webpackgi_exports__.FNr,__webpackgi_exports__MeshNormalMaterial=__webpackgi_exports__.qBx,__webpackgi_exports__MeshOptSimplifyModifierPlugin=__webpackgi_exports__.onB,__webpackgi_exports__MeshPhongMaterial=__webpackgi_exports__.tXL,__webpackgi_exports__MeshPhysicalMaterial=__webpackgi_exports__.uSd,__webpackgi_exports__MeshStandardMaterial=__webpackgi_exports__._4j,__webpackgi_exports__MeshStandardMaterial2=__webpackgi_exports__.gCR,__webpackgi_exports__MeshToonMaterial=__webpackgi_exports__.Df,__webpackgi_exports__MinEquation=__webpackgi_exports__.znC,__webpackgi_exports__MirroredRepeatWrapping=__webpackgi_exports__.kTW,__webpackgi_exports__MixOperation=__webpackgi_exports__.KRh,__webpackgi_exports__ModelStagePlugin=__webpackgi_exports__.$iG,__webpackgi_exports__ModelStagePresetGroup=__webpackgi_exports__.eti,__webpackgi_exports__MouseInputDevice=__webpackgi_exports__.Um5,__webpackgi_exports__MultiFilterPlugin=__webpackgi_exports__.tF0,__webpackgi_exports__MultiplyBlending=__webpackgi_exports__.EdD,__webpackgi_exports__MultiplyOperation=__webpackgi_exports__.caT,__webpackgi_exports__NearestFilter=__webpackgi_exports__.hxR,__webpackgi_exports__NearestMipMapLinearFilter=__webpackgi_exports__.a$r,__webpackgi_exports__NearestMipMapNearestFilter=__webpackgi_exports__.$O9,__webpackgi_exports__NearestMipmapLinearFilter=__webpackgi_exports__.Cfg,__webpackgi_exports__NearestMipmapNearestFilter=__webpackgi_exports__.pHI,__webpackgi_exports__NeverCompare=__webpackgi_exports__.amv,__webpackgi_exports__NeverDepth=__webpackgi_exports__.eHc,__webpackgi_exports__NeverStencilFunc=__webpackgi_exports__.HPb,__webpackgi_exports__NoBlending=__webpackgi_exports__.XIg,__webpackgi_exports__NoColorSpace=__webpackgi_exports__.jf0,__webpackgi_exports__NoToneMapping=__webpackgi_exports__.y_p,__webpackgi_exports__NoiseBumpMaterialPlugin=__webpackgi_exports__.dFv,__webpackgi_exports__NormalAnimationBlendMode=__webpackgi_exports__.Ke9,__webpackgi_exports__NormalBlending=__webpackgi_exports__.NTi,__webpackgi_exports__NormalBufferPlugin=__webpackgi_exports__.nqf,__webpackgi_exports__NormalCaptureMaterial=__webpackgi_exports__.hws,__webpackgi_exports__NotEqualCompare=__webpackgi_exports__.jzd,__webpackgi_exports__NotEqualDepth=__webpackgi_exports__.bw0,__webpackgi_exports__NotEqualStencilFunc=__webpackgi_exports__.klZ,__webpackgi_exports__NumberKeyframeTrack=__webpackgi_exports__.Hit,__webpackgi_exports__OBJLoader2=__webpackgi_exports__.DJz,__webpackgi_exports__ObjMtlLoadPlugin=__webpackgi_exports__.UwE,__webpackgi_exports__Object3D=__webpackgi_exports__.B69,__webpackgi_exports__Object3DModel=__webpackgi_exports__.QA8,__webpackgi_exports__Object3DWidgetsPlugin=__webpackgi_exports__.$xz,__webpackgi_exports__ObjectLoader=__webpackgi_exports__.XTe,__webpackgi_exports__ObjectLoader2=__webpackgi_exports__.zjB,__webpackgi_exports__ObjectPicker=__webpackgi_exports__.sHL,__webpackgi_exports__ObjectProcessorMap=__webpackgi_exports__.Upe,__webpackgi_exports__ObjectRotationPlugin=__webpackgi_exports__.nEH,__webpackgi_exports__ObjectSpaceNormalMap=__webpackgi_exports__.vyJ,__webpackgi_exports__OctahedronGeometry=__webpackgi_exports__.Ufg,__webpackgi_exports__OneFactor=__webpackgi_exports__.qad,__webpackgi_exports__OneMinusDstAlphaFactor=__webpackgi_exports__.Nt7,__webpackgi_exports__OneMinusDstColorFactor=__webpackgi_exports__.aEY,__webpackgi_exports__OneMinusSrcAlphaFactor=__webpackgi_exports__.OuU,__webpackgi_exports__OneMinusSrcColorFactor=__webpackgi_exports__.LiQ,__webpackgi_exports__OrbitControls2=__webpackgi_exports__.xYO,__webpackgi_exports__OrbitControls3=__webpackgi_exports__.c07,__webpackgi_exports__OrthographicCamera=__webpackgi_exports__.qUd,__webpackgi_exports__OutlinePlugin=__webpackgi_exports__.I_i,__webpackgi_exports__P3Primaries=__webpackgi_exports__.wqq,__webpackgi_exports__PCFShadowMap=__webpackgi_exports__.QP0,__webpackgi_exports__PCFSoftShadowMap=__webpackgi_exports__.Wk7,__webpackgi_exports__PMREMGenerator=__webpackgi_exports__.BdL,__webpackgi_exports__PMREMGeneratorPlugin=__webpackgi_exports__.Q7O,__webpackgi_exports__ParallaxCameraControllerPlugin=__webpackgi_exports__.uxM,__webpackgi_exports__ParallaxMappingPlugin=__webpackgi_exports__.N9C,__webpackgi_exports__Path=__webpackgi_exports__.wAk,__webpackgi_exports__PerspectiveCamera=__webpackgi_exports__.ubm,__webpackgi_exports__PickingPlugin=__webpackgi_exports__.PG6,__webpackgi_exports__Plane=__webpackgi_exports__.Zcv,__webpackgi_exports__PlaneGeometry=__webpackgi_exports__.bdM,__webpackgi_exports__PlaneHelper=__webpackgi_exports__.ZM4,__webpackgi_exports__PluginPresetGroup=__webpackgi_exports__._EQ,__webpackgi_exports__PointLight=__webpackgi_exports__.HiM,__webpackgi_exports__PointLight2=__webpackgi_exports__.RXx,__webpackgi_exports__PointLightHelper=__webpackgi_exports__.F1l,__webpackgi_exports__PointerDragHelper=__webpackgi_exports__.W_W,__webpackgi_exports__PointerLockControls2=__webpackgi_exports__.FnS,__webpackgi_exports__PointerLockControlsPlugin=__webpackgi_exports__.oPt,__webpackgi_exports__Points=__webpackgi_exports__.ONl,__webpackgi_exports__PointsMaterial=__webpackgi_exports__.BH$,__webpackgi_exports__PolarGridHelper=__webpackgi_exports__.hzE,__webpackgi_exports__PolyhedronGeometry=__webpackgi_exports__.pFK,__webpackgi_exports__PopmotionPlugin=__webpackgi_exports__.j9d,__webpackgi_exports__PosePlugin=__webpackgi_exports__.DeC,__webpackgi_exports__PositionalAudio=__webpackgi_exports__.xZx,__webpackgi_exports__PresetGroup=__webpackgi_exports__.ZaL,__webpackgi_exports__PresetLibraryPlugin=__webpackgi_exports__.UwN,__webpackgi_exports__ProgressivePlugin=__webpackgi_exports__.hzf,__webpackgi_exports__PropertyBinding=__webpackgi_exports__.Nwf,__webpackgi_exports__PropertyMixer=__webpackgi_exports__.N2s,__webpackgi_exports__QuadraticBezierCurve=__webpackgi_exports__.dAo,__webpackgi_exports__QuadraticBezierCurve3=__webpackgi_exports__.CV9,__webpackgi_exports__Quaternion=__webpackgi_exports__.PTz,__webpackgi_exports__QuaternionKeyframeTrack=__webpackgi_exports__.MBL,__webpackgi_exports__QuaternionLinearInterpolant=__webpackgi_exports__.GBG,__webpackgi_exports__RED_GREEN_RGTC2_Format=__webpackgi_exports__.HO_,__webpackgi_exports__RED_RGTC1_Format=__webpackgi_exports__.Kef,__webpackgi_exports__REVISION=__webpackgi_exports__.sPf,__webpackgi_exports__RGBADepthPacking=__webpackgi_exports__.N5j,__webpackgi_exports__RGBAFormat=__webpackgi_exports__.GWd,__webpackgi_exports__RGBAIntegerFormat=__webpackgi_exports__.c90,__webpackgi_exports__RGBA_ASTC_10x10_Format=__webpackgi_exports__.y3Z,__webpackgi_exports__RGBA_ASTC_10x5_Format=__webpackgi_exports__.uB5,__webpackgi_exports__RGBA_ASTC_10x6_Format=__webpackgi_exports__.lyL,__webpackgi_exports__RGBA_ASTC_10x8_Format=__webpackgi_exports__.bC7,__webpackgi_exports__RGBA_ASTC_12x10_Format=__webpackgi_exports__.ojs,__webpackgi_exports__RGBA_ASTC_12x12_Format=__webpackgi_exports__.S$4,__webpackgi_exports__RGBA_ASTC_4x4_Format=__webpackgi_exports__.qa3,__webpackgi_exports__RGBA_ASTC_5x4_Format=__webpackgi_exports__.B_h,__webpackgi_exports__RGBA_ASTC_5x5_Format=__webpackgi_exports__.czI,__webpackgi_exports__RGBA_ASTC_6x5_Format=__webpackgi_exports__.rSH,__webpackgi_exports__RGBA_ASTC_6x6_Format=__webpackgi_exports__.Qrf,__webpackgi_exports__RGBA_ASTC_8x5_Format=__webpackgi_exports__.psI,__webpackgi_exports__RGBA_ASTC_8x6_Format=__webpackgi_exports__.a5J,__webpackgi_exports__RGBA_ASTC_8x8_Format=__webpackgi_exports__._QJ,__webpackgi_exports__RGBA_BPTC_Format=__webpackgi_exports__.Fn,__webpackgi_exports__RGBA_ETC2_EAC_Format=__webpackgi_exports__.KDk,__webpackgi_exports__RGBA_PVRTC_2BPPV1_Format=__webpackgi_exports__.pBf,__webpackgi_exports__RGBA_PVRTC_4BPPV1_Format=__webpackgi_exports__.HXV,__webpackgi_exports__RGBA_S3TC_DXT1_Format=__webpackgi_exports__.Nz6,__webpackgi_exports__RGBA_S3TC_DXT3_Format=__webpackgi_exports__.jR7,__webpackgi_exports__RGBA_S3TC_DXT5_Format=__webpackgi_exports__.BXX,__webpackgi_exports__RGBM16ColorSpace=__webpackgi_exports__.DAr,__webpackgi_exports__RGBM16ColorSpace_=__webpackgi_exports__.uC4,__webpackgi_exports__RGB_BPTC_SIGNED_Format=__webpackgi_exports__.H23,__webpackgi_exports__RGB_BPTC_UNSIGNED_Format=__webpackgi_exports__.W9U,__webpackgi_exports__RGB_ETC1_Format=__webpackgi_exports__.CVz,__webpackgi_exports__RGB_ETC2_Format=__webpackgi_exports__.Riy,__webpackgi_exports__RGB_PVRTC_2BPPV1_Format=__webpackgi_exports__.kTp,__webpackgi_exports__RGB_PVRTC_4BPPV1_Format=__webpackgi_exports__.k6Q,__webpackgi_exports__RGB_S3TC_DXT1_Format=__webpackgi_exports__.IE4,__webpackgi_exports__RGFormat=__webpackgi_exports__.paN,__webpackgi_exports__RGIntegerFormat=__webpackgi_exports__.TkQ,__webpackgi_exports__RainbowDiamondPlugin=__webpackgi_exports__.qa1,__webpackgi_exports__RandomizedDirectionalLight=__webpackgi_exports__.EZL,__webpackgi_exports__RandomizedDirectionalLightPlugin=__webpackgi_exports__.fMJ,__webpackgi_exports__RawShaderMaterial=__webpackgi_exports__.D$Q,__webpackgi_exports__Ray=__webpackgi_exports__.RlV,__webpackgi_exports__Raycaster=__webpackgi_exports__.tBo,__webpackgi_exports__Rec709Primaries=__webpackgi_exports__.z5,__webpackgi_exports__RectAreaLight=__webpackgi_exports__.ure,__webpackgi_exports__RedFormat=__webpackgi_exports__.VT0,__webpackgi_exports__RedIntegerFormat=__webpackgi_exports__.ZQM,__webpackgi_exports__Reflector2=__webpackgi_exports__.TyI,__webpackgi_exports__ReinhardToneMapping=__webpackgi_exports__.Mjd,__webpackgi_exports__RenderTarget=__webpackgi_exports__.O0B,__webpackgi_exports__RendererUiPlugin=__webpackgi_exports__.FZz,__webpackgi_exports__RepeatWrapping=__webpackgi_exports__.GJx,__webpackgi_exports__ReplaceStencilOp=__webpackgi_exports__.kG0,__webpackgi_exports__ReverseSubtractEquation=__webpackgi_exports__.nST,__webpackgi_exports__Rhino3dmLoadPlugin=__webpackgi_exports__.AUf,__webpackgi_exports__Rhino3dmLoader2=__webpackgi_exports__.oXQ,__webpackgi_exports__RingGeometry=__webpackgi_exports__.rKP,__webpackgi_exports__RootScene=__webpackgi_exports__.vMJ,__webpackgi_exports__SIGNED_RED_GREEN_RGTC2_Format=__webpackgi_exports__.CWW,__webpackgi_exports__SIGNED_RED_RGTC1_Format=__webpackgi_exports__.XG_,__webpackgi_exports__SRGBColorSpace=__webpackgi_exports__.er$,__webpackgi_exports__SRGBTransfer=__webpackgi_exports__.KLL,__webpackgi_exports__SSAOPlugin=__webpackgi_exports__.ye,__webpackgi_exports__SSBevelPass=__webpackgi_exports__.czS,__webpackgi_exports__SSBevelPlugin=__webpackgi_exports__.UG9,__webpackgi_exports__SSContactShadows=__webpackgi_exports__.aJo,__webpackgi_exports__SSGIPlugin=__webpackgi_exports__.uC9,__webpackgi_exports__SSRPlugin=__webpackgi_exports__.k9M,__webpackgi_exports__STLLoadPlugin=__webpackgi_exports__.fRH,__webpackgi_exports__Scene=__webpackgi_exports__.Z58,__webpackgi_exports__SceneCamerasUiPlugin=__webpackgi_exports__._I4,__webpackgi_exports__SceneLoopPlugin=__webpackgi_exports__.Sr,__webpackgi_exports__ScrollableCameraViewPlugin=__webpackgi_exports__.zx2,__webpackgi_exports__ScrollableCameraViewPreviewPlugin=__webpackgi_exports__.r1V,__webpackgi_exports__SelectionWidget=__webpackgi_exports__.tI0,__webpackgi_exports__ShaderChunk=__webpackgi_exports__.vxI,__webpackgi_exports__ShaderLib=__webpackgi_exports__.zkh,__webpackgi_exports__ShaderMaterial=__webpackgi_exports__.BKk,__webpackgi_exports__ShaderMaterial2=__webpackgi_exports__.rNP,__webpackgi_exports__ShaderMaterialEncodingSupport=__webpackgi_exports__.DkA,__webpackgi_exports__ShaderPass2=__webpackgi_exports__.rpH,__webpackgi_exports__ShadowMapBaker=__webpackgi_exports__.Q4F,__webpackgi_exports__ShadowMaterial=__webpackgi_exports__.q2,__webpackgi_exports__Shape=__webpackgi_exports__.ypk,__webpackgi_exports__ShapeGeometry=__webpackgi_exports__.MSw,__webpackgi_exports__ShapePath=__webpackgi_exports__.Ld9,__webpackgi_exports__ShapeTubeExtrudePlugin=__webpackgi_exports__.YOp,__webpackgi_exports__ShapeUtils=__webpackgi_exports__.xJ6,__webpackgi_exports__ShortType=__webpackgi_exports__.fBL,__webpackgi_exports__SimpleAssetList=__webpackgi_exports__.XTN,__webpackgi_exports__SimpleBackgroundEnvUiPlugin=__webpackgi_exports__.ZXl,__webpackgi_exports__SimpleDataSource=__webpackgi_exports__.O9e,__webpackgi_exports__SimpleEventDispatcher=__webpackgi_exports__.ILd,__webpackgi_exports__SimpleJSONExporter=__webpackgi_exports__.SQN,__webpackgi_exports__SimpleJSONLoader=__webpackgi_exports__.GDD,__webpackgi_exports__SimpleTextExporter=__webpackgi_exports__.HVh,__webpackgi_exports__SimpleTextPlugin=__webpackgi_exports__.X46,__webpackgi_exports__SimpleViewerUi=__webpackgi_exports__.hdr,__webpackgi_exports__SimplifyModifierPlugin=__webpackgi_exports__.CSJ,__webpackgi_exports__Skeleton=__webpackgi_exports__.EAD,__webpackgi_exports__SkeletonHelper=__webpackgi_exports__._xc,__webpackgi_exports__SkinnedMesh=__webpackgi_exports__.I46,__webpackgi_exports__SnowFallPlugin=__webpackgi_exports__.CSm,__webpackgi_exports__Source=__webpackgi_exports__.kLi,__webpackgi_exports__Sphere=__webpackgi_exports__.iyt,__webpackgi_exports__SphereGeometry=__webpackgi_exports__.Gu$,__webpackgi_exports__SphereSelectionWidget=__webpackgi_exports__.s6s,__webpackgi_exports__Spherical=__webpackgi_exports__.YHV,__webpackgi_exports__SphericalHarmonics3=__webpackgi_exports__.xOk,__webpackgi_exports__SplineCurve=__webpackgi_exports__.xfg,__webpackgi_exports__SpotLight=__webpackgi_exports__.nCl,__webpackgi_exports__SpotLight2=__webpackgi_exports__.Hs2,__webpackgi_exports__SpotLightHelper=__webpackgi_exports__.Fpm,__webpackgi_exports__Sprite=__webpackgi_exports__.kxk,__webpackgi_exports__SpriteMaterial=__webpackgi_exports__.RoJ,__webpackgi_exports__SrcAlphaFactor=__webpackgi_exports__.ie2,__webpackgi_exports__SrcAlphaSaturateFactor=__webpackgi_exports__.hgQ,__webpackgi_exports__SrcColorFactor=__webpackgi_exports__.f4X,__webpackgi_exports__StaticCopyUsage=__webpackgi_exports__.Hrq,__webpackgi_exports__StaticDrawUsage=__webpackgi_exports__.agE,__webpackgi_exports__StaticReadUsage=__webpackgi_exports__.uXQ,__webpackgi_exports__StereoCamera=__webpackgi_exports__.keZ,__webpackgi_exports__StreamCopyUsage=__webpackgi_exports__.rOG,__webpackgi_exports__StreamDrawUsage=__webpackgi_exports__.Ktl,__webpackgi_exports__StreamReadUsage=__webpackgi_exports__.uov,__webpackgi_exports__StringKeyframeTrack=__webpackgi_exports__.hZF,__webpackgi_exports__SubtractEquation=__webpackgi_exports__.FXf,__webpackgi_exports__SubtractiveBlending=__webpackgi_exports__.Kwu,__webpackgi_exports__SwitchNodeBasePlugin=__webpackgi_exports__.hv1,__webpackgi_exports__SwitchNodePlugin=__webpackgi_exports__.AqU,__webpackgi_exports__TOUCH=__webpackgi_exports__.wtR,__webpackgi_exports__TYPED_ARRAYS=__webpackgi_exports__.cGs,__webpackgi_exports__TangentSpaceNormalMap=__webpackgi_exports__.bI3,__webpackgi_exports__TemporalAAPlugin=__webpackgi_exports__.afA,__webpackgi_exports__TetrahedronGeometry=__webpackgi_exports__.Zpd,__webpackgi_exports__TextSVGOptions=__webpackgi_exports__.gO_,__webpackgi_exports__Texture=__webpackgi_exports__.gPd,__webpackgi_exports__TextureLoader=__webpackgi_exports__.Tap,__webpackgi_exports__ThinFilmLayerPlugin=__webpackgi_exports__.k4W,__webpackgi_exports__ThreeMaterialLoader=__webpackgi_exports__.ndu,__webpackgi_exports__TonemapPlugin=__webpackgi_exports__.el_,__webpackgi_exports__TorusGeometry=__webpackgi_exports__.O3Y,__webpackgi_exports__TorusKnotGeometry=__webpackgi_exports__.UPV,__webpackgi_exports__TrackballControlsPlugin=__webpackgi_exports__.iu6,__webpackgi_exports__TransformAnimationPlugin=__webpackgi_exports__.Ijk,__webpackgi_exports__TransformControls=__webpackgi_exports__.ZU6,__webpackgi_exports__TransformControls2=__webpackgi_exports__.XXP,__webpackgi_exports__TransformControlsGizmo=__webpackgi_exports__.RQH,__webpackgi_exports__TransformControlsPlane=__webpackgi_exports__.tUF,__webpackgi_exports__TransfrSharePlugin=__webpackgi_exports__.Tww,__webpackgi_exports__Triangle=__webpackgi_exports__.lMl,__webpackgi_exports__TriangleFanDrawMode=__webpackgi_exports__.rYR,__webpackgi_exports__TriangleStripDrawMode=__webpackgi_exports__.O49,__webpackgi_exports__TrianglesDrawMode=__webpackgi_exports__.RJ4,__webpackgi_exports__TriplanarUVMappingPlugin=__webpackgi_exports__.CXS,__webpackgi_exports__TubeGeometry=__webpackgi_exports__.j6,__webpackgi_exports__TubeShapeGeometry=__webpackgi_exports__.G8g,__webpackgi_exports__TweakpaneUiPlugin=__webpackgi_exports__.SOP,__webpackgi_exports__TweakpaneWrapper=__webpackgi_exports__.e2_,__webpackgi_exports__TwoPassDoubleSide=__webpackgi_exports__.GTy,__webpackgi_exports__UChartOptions=__webpackgi_exports__.cOZ,__webpackgi_exports__UPackOptions=__webpackgi_exports__.XxD,__webpackgi_exports__UVMapping=__webpackgi_exports__.UTZ,__webpackgi_exports__Uint16BufferAttribute=__webpackgi_exports__.A$4,__webpackgi_exports__Uint32BufferAttribute=__webpackgi_exports__.MW4,__webpackgi_exports__Uint8BufferAttribute=__webpackgi_exports__.baL,__webpackgi_exports__Uint8ClampedBufferAttribute=__webpackgi_exports__.fc6,__webpackgi_exports__Uncharted2Tonemapping=__webpackgi_exports__.t7h,__webpackgi_exports__Uniform=__webpackgi_exports__.nc$,__webpackgi_exports__UniformsGroup=__webpackgi_exports__.dzP,__webpackgi_exports__UniformsLib=__webpackgi_exports__.fCn,__webpackgi_exports__UniformsUtils=__webpackgi_exports__.LlO,__webpackgi_exports__UnsignedByteType=__webpackgi_exports__.OUM,__webpackgi_exports__UnsignedInt248Type=__webpackgi_exports__.V3x,__webpackgi_exports__UnsignedIntType=__webpackgi_exports__.bkx,__webpackgi_exports__UnsignedShort4444Type=__webpackgi_exports__.Wew,__webpackgi_exports__UnsignedShort5551Type=__webpackgi_exports__.gJ2,__webpackgi_exports__UnsignedShortType=__webpackgi_exports__.cHt,__webpackgi_exports__Unzip=__webpackgi_exports__.HJp,__webpackgi_exports__UnzipInflate=__webpackgi_exports__.mMi,__webpackgi_exports__UnzipPassThrough=__webpackgi_exports__.XLH,__webpackgi_exports__Unzlib=__webpackgi_exports__.TWi,__webpackgi_exports__VJSONPresetGroup=__webpackgi_exports__.DcJ,__webpackgi_exports__VRPluginBasic=__webpackgi_exports__.Kmx,__webpackgi_exports__VSMShadowMap=__webpackgi_exports__.RyA,__webpackgi_exports__VariationConfiguratorEditorUiPlugin=__webpackgi_exports__.NPD,__webpackgi_exports__VariationConfiguratorGridUiPlugin=__webpackgi_exports__.Gpr,__webpackgi_exports__VariationConfiguratorPlugin=__webpackgi_exports__.mKI,__webpackgi_exports__Vector2=__webpackgi_exports__.I9Y,__webpackgi_exports__Vector3=__webpackgi_exports__.Pq0,__webpackgi_exports__Vector4=__webpackgi_exports__.IUQ,__webpackgi_exports__VectorKeyframeTrack=__webpackgi_exports__.RiT,__webpackgi_exports__VelocityBufferPlugin=__webpackgi_exports__.Xkr,__webpackgi_exports__VideoTexture=__webpackgi_exports__.Nv2,__webpackgi_exports__ViewerApp=__webpackgi_exports__.EW5,__webpackgi_exports__ViewerState=__webpackgi_exports__.oJ0,__webpackgi_exports__VignettePlugin=__webpackgi_exports__.Q1b,__webpackgi_exports__VirtualCamerasPlugin=__webpackgi_exports__.jK_,__webpackgi_exports__WaveGroundPlugin=__webpackgi_exports__.gTm,__webpackgi_exports__WebGL1Renderer=__webpackgi_exports__.S3G,__webpackgi_exports__WebGL3DRenderTarget=__webpackgi_exports__.ALV,__webpackgi_exports__WebGLArrayRenderTarget=__webpackgi_exports__.y9J,__webpackgi_exports__WebGLCoordinateSystem=__webpackgi_exports__.TdN,__webpackgi_exports__WebGLCubeRenderTarget=__webpackgi_exports__.o6l,__webpackgi_exports__WebGLMultipleRenderTargets=__webpackgi_exports__.AT1,__webpackgi_exports__WebGLRenderTarget=__webpackgi_exports__.nWS,__webpackgi_exports__WebGLRenderer=__webpackgi_exports__.JeP,__webpackgi_exports__WebGLUtils=__webpackgi_exports__.hfX,__webpackgi_exports__WebGPUCoordinateSystem=__webpackgi_exports__.i7u,__webpackgi_exports__WebGiViewerElement=__webpackgi_exports__.b5D,__webpackgi_exports__WindowiseDialogPlugin=__webpackgi_exports__.Z1R,__webpackgi_exports__Wireframe=__webpackgi_exports__.pWZ,__webpackgi_exports__WireframeGeometry=__webpackgi_exports__.XJ7,__webpackgi_exports__WireframeGeometry2=__webpackgi_exports__.r3D,__webpackgi_exports__WrapAroundEnding=__webpackgi_exports__.dhZ,__webpackgi_exports__XAtlasPlugin=__webpackgi_exports__.$Tl,__webpackgi_exports__ZeroCurvatureEnding=__webpackgi_exports__.rQf,__webpackgi_exports__ZeroFactor=__webpackgi_exports__.ojh,__webpackgi_exports__ZeroSlopeEnding=__webpackgi_exports__.h2z,__webpackgi_exports__ZeroStencilOp=__webpackgi_exports__.kqe,__webpackgi_exports__Zip=__webpackgi_exports__.qQr,__webpackgi_exports__ZipDeflate=__webpackgi_exports__.D8L,__webpackgi_exports__ZipLoader=__webpackgi_exports__.p9O,__webpackgi_exports__ZipPassThrough=__webpackgi_exports__.uZB,__webpackgi_exports__Zlib=__webpackgi_exports__.KK,__webpackgi_exports___SRGBAFormat=__webpackgi_exports__.Ua6,__webpackgi_exports__absMax=__webpackgi_exports__.TYE,__webpackgi_exports__addBasePlugins=__webpackgi_exports__.rQr,__webpackgi_exports__addBloomData=__webpackgi_exports__.$00,__webpackgi_exports__addDracoLoader=__webpackgi_exports__.ued,__webpackgi_exports__addEditorPlugins=__webpackgi_exports__.p$A,__webpackgi_exports__addGLTFExporter=__webpackgi_exports__.m2A,__webpackgi_exports__addGLTFLoader=__webpackgi_exports__.MqB,__webpackgi_exports__addLUTData=__webpackgi_exports__.Dv6,__webpackgi_exports__addRGBELoader=__webpackgi_exports__.f9i,__webpackgi_exports__addSSBevel=__webpackgi_exports__.qHA,__webpackgi_exports__aesGcmDecrypt=__webpackgi_exports__.sQz,__webpackgi_exports__aesGcmEncrypt=__webpackgi_exports__.G52,__webpackgi_exports__afterMain=__webpackgi_exports__.EP1,__webpackgi_exports__afterRead=__webpackgi_exports__.v5N,__webpackgi_exports__afterWrite=__webpackgi_exports__.SET,__webpackgi_exports__angle=__webpackgi_exports__.g7h,__webpackgi_exports__animate=__webpackgi_exports__.i0Z,__webpackgi_exports__animateAsync=__webpackgi_exports__.GcL,__webpackgi_exports__animateObject=__webpackgi_exports__.z67,__webpackgi_exports__animateSet=__webpackgi_exports__.im4,__webpackgi_exports__animateTarget=__webpackgi_exports__.$bx,__webpackgi_exports__anticipate=__webpackgi_exports__.btx,__webpackgi_exports__applyOffset=__webpackgi_exports__.M7c,__webpackgi_exports__applyStyles=__webpackgi_exports__.ZMO,__webpackgi_exports__arrayBufferToBase64=__webpackgi_exports__.YiG,__webpackgi_exports__arrow=__webpackgi_exports__.UE8,__webpackgi_exports__attract=__webpackgi_exports__.uHr,__webpackgi_exports__attractExpo=__webpackgi_exports__.YYK,__webpackgi_exports__auto=__webpackgi_exports__.qZL,__webpackgi_exports__autoCenterObject3D=__webpackgi_exports__.XMb,__webpackgi_exports__autoGPUInstanceMeshes=__webpackgi_exports__.utC,__webpackgi_exports__autoScaleObject3D=__webpackgi_exports__.uO_,__webpackgi_exports__backIn=__webpackgi_exports__.dgX,__webpackgi_exports__backInOut=__webpackgi_exports__.ZZ5,__webpackgi_exports__backOut=__webpackgi_exports__.Szj,__webpackgi_exports__base64ToArrayBuffer=__webpackgi_exports__.Ms4,__webpackgi_exports__basePlacements=__webpackgi_exports__.OMj,__webpackgi_exports__basicMaterialPropList=__webpackgi_exports__.D7g,__webpackgi_exports__beforeMain=__webpackgi_exports__.LG_,__webpackgi_exports__beforeRead=__webpackgi_exports__.cis,__webpackgi_exports__beforeWrite=__webpackgi_exports__.pAB,__webpackgi_exports__blobToDataURL=__webpackgi_exports__.y80,__webpackgi_exports__bottom=__webpackgi_exports__.sQg,__webpackgi_exports__bounceIn=__webpackgi_exports__.ipZ,__webpackgi_exports__bounceInOut=__webpackgi_exports__.wmn,__webpackgi_exports__bounceOut=__webpackgi_exports__.Tel,__webpackgi_exports__buildCSGMeshBSP=__webpackgi_exports__.Q5,__webpackgi_exports__buildCSGMeshBVH=__webpackgi_exports__.b1j,__webpackgi_exports__cLinearToRGBM=__webpackgi_exports__.wzf,__webpackgi_exports__cRGBMToLinear=__webpackgi_exports__.Cq_,__webpackgi_exports__circIn=__webpackgi_exports__.poN,__webpackgi_exports__circInOut=__webpackgi_exports__.tnX,__webpackgi_exports__circOut=__webpackgi_exports__.yT,__webpackgi_exports__clamp=__webpackgi_exports__.qE8,__webpackgi_exports__clippingParents=__webpackgi_exports__.WYS,__webpackgi_exports__colorToDataUrl=__webpackgi_exports__.Cp1,__webpackgi_exports__combineDofShader=__webpackgi_exports__.mz1,__webpackgi_exports__compress=__webpackgi_exports__.Bc,__webpackgi_exports__compressSync=__webpackgi_exports__.oSR,__webpackgi_exports__computeAverageGeometryNormal=__webpackgi_exports__.KJu,__webpackgi_exports__computeEigenVectors=__webpackgi_exports__.G1I,__webpackgi_exports__computeGeometryCenter=__webpackgi_exports__.dXm,__webpackgi_exports__computeGeometrySize=__webpackgi_exports__.lRj,__webpackgi_exports__computeMikkTSpaceTangents=__webpackgi_exports__.WL9,__webpackgi_exports__computeMorphedAttributes=__webpackgi_exports__.OkM,__webpackgi_exports__computeOffsetMatrix=__webpackgi_exports__.kRU,__webpackgi_exports__computeScreenSpaceBoundingBox=__webpackgi_exports__.Xpo,__webpackgi_exports__computeStyles=__webpackgi_exports__.KCp,__webpackgi_exports__copyMaterialUserData=__webpackgi_exports__.a17,__webpackgi_exports__copyObject3DUserData=__webpackgi_exports__.prl,__webpackgi_exports__copyProps=__webpackgi_exports__.ij0,__webpackgi_exports__copyTextureUserData=__webpackgi_exports__.MjE,__webpackgi_exports__createAnticipate=__webpackgi_exports__.bhJ,__webpackgi_exports__createAttractor=__webpackgi_exports__.nMR,__webpackgi_exports__createBackIn=__webpackgi_exports__.p4x,__webpackgi_exports__createCanvasElement=__webpackgi_exports__.lPF,__webpackgi_exports__createDiv=__webpackgi_exports__.SwP,__webpackgi_exports__createExpoIn=__webpackgi_exports__.U2C,__webpackgi_exports__createGenericExtensionClass=__webpackgi_exports__.FOd,__webpackgi_exports__createIFrameCSS3DObject=__webpackgi_exports__.WOM,__webpackgi_exports__createImage=__webpackgi_exports__.mFw,__webpackgi_exports__createPopper=__webpackgi_exports__.n4h,__webpackgi_exports__createPopperBase=__webpackgi_exports__.eRo,__webpackgi_exports__createPopperLite=__webpackgi_exports__.LsR,__webpackgi_exports__createRenderTargetKey=__webpackgi_exports__.tJ,__webpackgi_exports__createScriptFromURL=__webpackgi_exports__.bES,__webpackgi_exports__createStyles=__webpackgi_exports__.rU,__webpackgi_exports__csgOperations=__webpackgi_exports__.omb,__webpackgi_exports__css=__webpackgi_exports__.AHW,__webpackgi_exports__cubicBezier=__webpackgi_exports__.AKs,__webpackgi_exports__dataTextureFromColor=__webpackgi_exports__.VxZ,__webpackgi_exports__dataTextureFromVec4=__webpackgi_exports__.GRd,__webpackgi_exports__decay=__webpackgi_exports__.TVt,__webpackgi_exports__decompress=__webpackgi_exports__.mFv,__webpackgi_exports__decompressSync=__webpackgi_exports__.RqU,__webpackgi_exports__deepAccessObject=__webpackgi_exports__.UKN,__webpackgi_exports__deepCloneAttribute=__webpackgi_exports__.mmZ,__webpackgi_exports__defaultPresets=__webpackgi_exports__.Ikv,__webpackgi_exports__deflate=__webpackgi_exports__.Kcl,__webpackgi_exports__deflateSync=__webpackgi_exports__.pdh,__webpackgi_exports__degreesToRadians=__webpackgi_exports__.tRv,__webpackgi_exports__deinterleaveAttribute=__webpackgi_exports__.nNY,__webpackgi_exports__deinterleaveGeometry=__webpackgi_exports__.LK7,__webpackgi_exports__deserializeObject=__webpackgi_exports__.$q,__webpackgi_exports__deserializers=__webpackgi_exports__.vem,__webpackgi_exports__detectOverflow=__webpackgi_exports__.__B,__webpackgi_exports__diamondMaterialPropList=__webpackgi_exports__.BF2,__webpackgi_exports__distance=__webpackgi_exports__.IoC,__webpackgi_exports__downloadBlob=__webpackgi_exports__.WNF,__webpackgi_exports__downloadFile=__webpackgi_exports__.PE3,__webpackgi_exports__easeIn=__webpackgi_exports__.a6C,__webpackgi_exports__easeInOut=__webpackgi_exports__.am_,__webpackgi_exports__easeOut=__webpackgi_exports__.vTE,__webpackgi_exports__embedUrlRefs=__webpackgi_exports__.VAT,__webpackgi_exports__end=__webpackgi_exports__._N2,__webpackgi_exports__envMapBackground=__webpackgi_exports__.oib,__webpackgi_exports__escapeRegExp=__webpackgi_exports__.NtM,__webpackgi_exports__estimateBytesUsed=__webpackgi_exports__.ru_,__webpackgi_exports__eventListeners=__webpackgi_exports__.GcD,__webpackgi_exports__extractAnimationKey=__webpackgi_exports__.pJG,__webpackgi_exports__flattenUiConfig=__webpackgi_exports__.vxL,__webpackgi_exports__flip=__webpackgi_exports__.UUz,__webpackgi_exports__fontFormatExtensionMap=__webpackgi_exports__.mlk,__webpackgi_exports__generateUiConfig=__webpackgi_exports__.SVi,__webpackgi_exports__generateUiFolder=__webpackgi_exports__.QXJ,__webpackgi_exports__getFileHandle=__webpackgi_exports__.D01,__webpackgi_exports__getFilenameFromPath=__webpackgi_exports__.$7C,__webpackgi_exports__getKeyByValue=__webpackgi_exports__.cdn,__webpackgi_exports__getNewFileHandle=__webpackgi_exports__.vGk,__webpackgi_exports__getOrCall=__webpackgi_exports__.GPz,__webpackgi_exports__getPropertyDescriptor=__webpackgi_exports__.NxN,__webpackgi_exports__getTexelDecoding=__webpackgi_exports__.o7j,__webpackgi_exports__getTexelDecodingFunction=__webpackgi_exports__.yqR,__webpackgi_exports__getTextureDataType=__webpackgi_exports__.U_j,__webpackgi_exports__getTypedArray=__webpackgi_exports__.mB_,__webpackgi_exports__getUrlQueryParam=__webpackgi_exports__.d6c,__webpackgi_exports__glbEncryptionPreparser=__webpackgi_exports__.zhG,__webpackgi_exports__glsl=__webpackgi_exports__.HJb,__webpackgi_exports__gltfExporterMaterialsVariantsExtensionExport=__webpackgi_exports__.e5R,__webpackgi_exports__gunzip=__webpackgi_exports__.kdR,__webpackgi_exports__gunzipSync=__webpackgi_exports__.D85,__webpackgi_exports__gzip=__webpackgi_exports__.ZIX,__webpackgi_exports__gzipSync=__webpackgi_exports__.u3y,__webpackgi_exports__hide=__webpackgi_exports__.jDu,__webpackgi_exports__html=__webpackgi_exports__.qyt,__webpackgi_exports__htmlToCanvas=__webpackgi_exports__.Dtr,__webpackgi_exports__htmlToPng=__webpackgi_exports__.WKP,__webpackgi_exports__htmlToSvg=__webpackgi_exports__.fJV,__webpackgi_exports__iGeometryIgnoredUserData=__webpackgi_exports__.tC7,__webpackgi_exports__iMaterialIgnoredUserData=__webpackgi_exports__.Uan,__webpackgi_exports__iModelIgnoredUserData=__webpackgi_exports__.Uct,__webpackgi_exports__iTextureIgnoredUserData=__webpackgi_exports__.K_U,__webpackgi_exports__imageBitmapToBase64=__webpackgi_exports__.BFA,__webpackgi_exports__imageDataToCanvas=__webpackgi_exports__.BHX,__webpackgi_exports__imageToCanvas=__webpackgi_exports__.Pee,__webpackgi_exports__imageUrlToImageData=__webpackgi_exports__.$If,__webpackgi_exports__includesAll=__webpackgi_exports__.RFY,__webpackgi_exports__inertia=__webpackgi_exports__.Buv,__webpackgi_exports__inflate=__webpackgi_exports__.UDz,__webpackgi_exports__inflateSync=__webpackgi_exports__.HMP,__webpackgi_exports__interleaveAttributes=__webpackgi_exports__.Zg4,__webpackgi_exports__interpolate=__webpackgi_exports__.GWP,__webpackgi_exports__isAnimatableType=__webpackgi_exports__.r58,__webpackgi_exports__isPoint=__webpackgi_exports__.fTC,__webpackgi_exports__isPoint3D=__webpackgi_exports__.YWz,__webpackgi_exports__isPropertyWritable=__webpackgi_exports__.eAs,__webpackgi_exports__keyframes=__webpackgi_exports__.i7C,__webpackgi_exports__khrMaterialsVariantsGLTF=__webpackgi_exports__.jFo,__webpackgi_exports__left=__webpackgi_exports__.kbd,__webpackgi_exports__lerpAngle=__webpackgi_exports__.nU8,__webpackgi_exports__lerpAngle2=__webpackgi_exports__.NFx,__webpackgi_exports__linear=__webpackgi_exports__.sns,__webpackgi_exports__longestCommonPrefix=__webpackgi_exports__.S2G,__webpackgi_exports__main=__webpackgi_exports__.iW4,__webpackgi_exports__makeColorSvg=__webpackgi_exports__.Se$,__webpackgi_exports__makeColorSvgCircle=__webpackgi_exports__.Sop,__webpackgi_exports__makeFilter=__webpackgi_exports__.HNH,__webpackgi_exports__makeSamplerUi=__webpackgi_exports__.jGz,__webpackgi_exports__makeSetterFor=__webpackgi_exports__.ll7,__webpackgi_exports__makeTextSvg=__webpackgi_exports__.SrG,__webpackgi_exports__matDefine=__webpackgi_exports__.UGD,__webpackgi_exports__mergeAttributes=__webpackgi_exports__.KVf,__webpackgi_exports__mergeBufferAttributes=__webpackgi_exports__.gDN,__webpackgi_exports__mergeBufferGeometries=__webpackgi_exports__.h0o,__webpackgi_exports__mergeGeometries=__webpackgi_exports__.pPQ,__webpackgi_exports__mergeGroups=__webpackgi_exports__.hLo,__webpackgi_exports__mergeVertices=__webpackgi_exports__.ecu,__webpackgi_exports__mirrorEasing=__webpackgi_exports__.mhB,__webpackgi_exports__mix=__webpackgi_exports__.jhA,__webpackgi_exports__mixColor=__webpackgi_exports__.iou,__webpackgi_exports__mixComplex=__webpackgi_exports__.JL8,__webpackgi_exports__mobileAndTabletCheck=__webpackgi_exports__.G8Z,__webpackgi_exports__modifierPhases=__webpackgi_exports__.GMB,__webpackgi_exports__now=__webpackgi_exports__.tB5,__webpackgi_exports__objectHasOwn=__webpackgi_exports__.GnX,__webpackgi_exports__offset=__webpackgi_exports__.cYW,__webpackgi_exports__onChange=__webpackgi_exports__.k9K,__webpackgi_exports__onChange2=__webpackgi_exports__.CTC,__webpackgi_exports__onChange3=__webpackgi_exports__.JW6,__webpackgi_exports__parseFileExtension=__webpackgi_exports__.p7C,__webpackgi_exports__patchShaderEncodingSupport=__webpackgi_exports__.OId,__webpackgi_exports__pathJoin=__webpackgi_exports__.CN_,__webpackgi_exports__physicalMaterialPropList=__webpackgi_exports__.uaX,__webpackgi_exports__pipe=__webpackgi_exports__.FsL,__webpackgi_exports__pivotToBBoxCenter=__webpackgi_exports__.gtD,__webpackgi_exports__pivotToPoint=__webpackgi_exports__.wbL,__webpackgi_exports__placements=__webpackgi_exports__.DDu,__webpackgi_exports__pointFromVector=__webpackgi_exports__.O$W,__webpackgi_exports__popper=__webpackgi_exports__.xfb,__webpackgi_exports__popperGenerator=__webpackgi_exports__.UD3,__webpackgi_exports__popperOffsets=__webpackgi_exports__.ZoD,__webpackgi_exports__prettyScrollbar=__webpackgi_exports__.hQ_,__webpackgi_exports__preventOverflow=__webpackgi_exports__.V7C,__webpackgi_exports__processViewer=__webpackgi_exports__.Sow,__webpackgi_exports__progress=__webpackgi_exports__.qB0,__webpackgi_exports__radiansToDegrees=__webpackgi_exports__.nv6,__webpackgi_exports__read=__webpackgi_exports__.LF4,__webpackgi_exports__readFile=__webpackgi_exports__.TAg,__webpackgi_exports__reference=__webpackgi_exports__.irg,__webpackgi_exports__remoteWorkerURL=__webpackgi_exports__.Ei4,__webpackgi_exports__removeDuplicateGeometries=__webpackgi_exports__.Grb,__webpackgi_exports__replaceAll=__webpackgi_exports__.yhl,__webpackgi_exports__reverseEasing=__webpackgi_exports__.Gmo,__webpackgi_exports__right=__webpackgi_exports__.pGT,__webpackgi_exports__rotateDuplicatedMesh=__webpackgi_exports__.Gsh,__webpackgi_exports__sRGBEncoding=__webpackgi_exports__.S2Q,__webpackgi_exports__safeSetProperty=__webpackgi_exports__.pUp,__webpackgi_exports__serializable=__webpackgi_exports__.sU3,__webpackgi_exports__serialize=__webpackgi_exports__.lKg,__webpackgi_exports__serializeObject=__webpackgi_exports__.gwL,__webpackgi_exports__serializeTextureInExtras=__webpackgi_exports__.EBS,__webpackgi_exports__serializers=__webpackgi_exports__.YCG,__webpackgi_exports__setMeshGeometry=__webpackgi_exports__.gC,__webpackgi_exports__setMeshMaterial=__webpackgi_exports__.R5k,__webpackgi_exports__setThreeRendererMode=__webpackgi_exports__.zB$,__webpackgi_exports__setUrlQueryParam=__webpackgi_exports__.dGw,__webpackgi_exports__setupCoreWebGiViewer=__webpackgi_exports__.tNl,__webpackgi_exports__setupIModel=__webpackgi_exports__.AAd,__webpackgi_exports__setupModesStyles=__webpackgi_exports__.YFt,__webpackgi_exports__setupModesUi=__webpackgi_exports__.IRk,__webpackgi_exports__setupObject3dModel=__webpackgi_exports__.ZVX,__webpackgi_exports__setupSandboxWebGiEditor=__webpackgi_exports__.cTN,__webpackgi_exports__shaderReplaceString=__webpackgi_exports__.PlU,__webpackgi_exports__sign2=__webpackgi_exports__.Mi5,__webpackgi_exports__slerp=__webpackgi_exports__.nuN,__webpackgi_exports__smooth=__webpackgi_exports__.Jp2,__webpackgi_exports__smoothFrame=__webpackgi_exports__.oDA,__webpackgi_exports__snap=__webpackgi_exports__.n$K,__webpackgi_exports__snapObject=__webpackgi_exports__.w4b,__webpackgi_exports__sphericalFromObject=__webpackgi_exports__.JVv,__webpackgi_exports__spring=__webpackgi_exports__.ozl,__webpackgi_exports__standardMaterialPropList=__webpackgi_exports__.asH,__webpackgi_exports__start=__webpackgi_exports__.niF,__webpackgi_exports__steps=__webpackgi_exports__.CiD,__webpackgi_exports__strFromU8=__webpackgi_exports__.heq,__webpackgi_exports__strToU8=__webpackgi_exports__._uk,__webpackgi_exports__supportsRequestStreams=__webpackgi_exports__.xrZ,__webpackgi_exports__svgToCanvas=__webpackgi_exports__.aUi,__webpackgi_exports__svgToPng=__webpackgi_exports__.Tmf,__webpackgi_exports__svgUrl=__webpackgi_exports__.AYr,__webpackgi_exports__texImageToCanvas=__webpackgi_exports__.SVO,__webpackgi_exports__textureDataToImageData=__webpackgi_exports__.mBH,__webpackgi_exports__textureToCanvas=__webpackgi_exports__.z73,__webpackgi_exports__textureToDataUrl=__webpackgi_exports__.cyN,__webpackgi_exports__timeout=__webpackgi_exports__.wRz,__webpackgi_exports__toCreasedNormals=__webpackgi_exports__.pbX,__webpackgi_exports__toDecimal=__webpackgi_exports__.nIf,__webpackgi_exports__toIndexedGeometry=__webpackgi_exports__.RY5,__webpackgi_exports__toTitleCase=__webpackgi_exports__.SnO,__webpackgi_exports__toTrianglesDrawMode=__webpackgi_exports__._cJ,__webpackgi_exports__top=__webpackgi_exports__.Mny,__webpackgi_exports__uiButton=__webpackgi_exports__.X0G,__webpackgi_exports__uiColor=__webpackgi_exports__.mBY,__webpackgi_exports__uiConfig=__webpackgi_exports__.rpQ,__webpackgi_exports__uiDropdown=__webpackgi_exports__.exO,__webpackgi_exports__uiFolder=__webpackgi_exports__.rsv,__webpackgi_exports__uiImage=__webpackgi_exports__.gpt,__webpackgi_exports__uiInput=__webpackgi_exports__.hEL,__webpackgi_exports__uiMonitor=__webpackgi_exports__.LIx,__webpackgi_exports__uiPanel=__webpackgi_exports__.Z5F,__webpackgi_exports__uiSlider=__webpackgi_exports__.Eiw,__webpackgi_exports__uiToggle=__webpackgi_exports__.Jx6,__webpackgi_exports__uiVector=__webpackgi_exports__.q00,__webpackgi_exports__uniform=__webpackgi_exports__.PiW,__webpackgi_exports__unzip=__webpackgi_exports__.$15,__webpackgi_exports__unzipSync=__webpackgi_exports__.AOo,__webpackgi_exports__unzlib=__webpackgi_exports__.VTi,__webpackgi_exports__unzlibSync=__webpackgi_exports__.a8Y,__webpackgi_exports__uploadFile=__webpackgi_exports__.QMY,__webpackgi_exports__vLinearToRGBM=__webpackgi_exports__.d5o,__webpackgi_exports__vRGBMToLinear=__webpackgi_exports__.Fxe,__webpackgi_exports__valueToUiType=__webpackgi_exports__.Nan,__webpackgi_exports__variationPlacements=__webpackgi_exports__.Ols,__webpackgi_exports__velocityPerFrame=__webpackgi_exports__.Ovn,__webpackgi_exports__velocityPerSecond=__webpackgi_exports__.fjO,__webpackgi_exports__verifyPermission=__webpackgi_exports__.pZl,__webpackgi_exports__viewport=__webpackgi_exports__.R9T,__webpackgi_exports__wrap=__webpackgi_exports__.LV7,__webpackgi_exports__write=__webpackgi_exports__.M98,__webpackgi_exports__writeFile=__webpackgi_exports__._h9,__webpackgi_exports__zip=__webpackgi_exports__.yU6,__webpackgi_exports__zipSync=__webpackgi_exports__.LaF,__webpackgi_exports__zlib=__webpackgi_exports__.w58,__webpackgi_exports__zlibSync=__webpackgi_exports__.$ax;const WEBGI=Object.freeze(Object.defineProperty({__proto__:null,AAssetManagerProcessStatePlugin:__webpackgi_exports__AAssetManagerProcessStatePlugin,ACESFilmicToneMapping:__webpackgi_exports__ACESFilmicToneMapping,ACameraControlsPlugin:__webpackgi_exports__ACameraControlsPlugin,ACanvasRecorder:__webpackgi_exports__ACanvasRecorder,ALL_WEBGI_EXTENSIONS:__webpackgi_exports__ALL_WEBGI_EXTENSIONS,AMaterialManager:__webpackgi_exports__AMaterialManager,ARPlacementBox:__webpackgi_exports__ARPlacementBox,ARPlugin:__webpackgi_exports__ARPlugin,ARTouchInputHelper:__webpackgi_exports__ARTouchInputHelper,AShaderMaterial2:__webpackgi_exports__AShaderMaterial2,AViewerPlugin:__webpackgi_exports__AViewerPlugin,AWSClientPlugin:__webpackgi_exports__AWSClientPlugin,AddBlendPass:__webpackgi_exports__AddBlendPass,AddEquation:__webpackgi_exports__AddEquation,AddOperation:__webpackgi_exports__AddOperation,AdditiveAnimationBlendMode:__webpackgi_exports__AdditiveAnimationBlendMode,AdditiveBlending:__webpackgi_exports__AdditiveBlending,AlphaFormat:__webpackgi_exports__AlphaFormat,AlwaysCompare:__webpackgi_exports__AlwaysCompare,AlwaysDepth:__webpackgi_exports__AlwaysDepth,AlwaysStencilFunc:__webpackgi_exports__AlwaysStencilFunc,AmbientLight:__webpackgi_exports__AmbientLight,AmbientLight2:__webpackgi_exports__AmbientLight2,AnimationAction:__webpackgi_exports__AnimationAction,AnimationClip:__webpackgi_exports__AnimationClip,AnimationLoader:__webpackgi_exports__AnimationLoader,AnimationMixer:__webpackgi_exports__AnimationMixer,AnimationObjectGroup:__webpackgi_exports__AnimationObjectGroup,AnimationUtils:__webpackgi_exports__AnimationUtils,AnisotropyPlugin:__webpackgi_exports__AnisotropyPlugin,ArcCurve:__webpackgi_exports__ArcCurve,ArrayCamera:__webpackgi_exports__ArrayCamera,ArrowHelper:__webpackgi_exports__ArrowHelper,AssetExporter:__webpackgi_exports__AssetExporter,AssetExporterPlugin:__webpackgi_exports__AssetExporterPlugin,AssetImporter:__webpackgi_exports__AssetImporter,AssetManagerBasicPopupPlugin:__webpackgi_exports__AssetManagerBasicPopupPlugin,AssetManagerLoadingBarPlugin:__webpackgi_exports__AssetManagerLoadingBarPlugin,AssetManagerPlugin:__webpackgi_exports__AssetManagerPlugin,AsyncCompress:__webpackgi_exports__AsyncCompress,AsyncDecompress:__webpackgi_exports__AsyncDecompress,AsyncDeflate:__webpackgi_exports__AsyncDeflate,AsyncGunzip:__webpackgi_exports__AsyncGunzip,AsyncGzip:__webpackgi_exports__AsyncGzip,AsyncInflate:__webpackgi_exports__AsyncInflate,AsyncUnzipInflate:__webpackgi_exports__AsyncUnzipInflate,AsyncUnzlib:__webpackgi_exports__AsyncUnzlib,AsyncZipDeflate:__webpackgi_exports__AsyncZipDeflate,AsyncZlib:__webpackgi_exports__AsyncZlib,Audio:__webpackgi_exports__Audio,AudioAnalyser:__webpackgi_exports__AudioAnalyser,AudioContext:__webpackgi_exports__AudioContext,AudioListener:__webpackgi_exports__AudioListener,AudioLoader:__webpackgi_exports__AudioLoader,AxesHelper:__webpackgi_exports__AxesHelper,BackSide:__webpackgi_exports__BackSide,BackgroundPresetGroup:__webpackgi_exports__BackgroundPresetGroup,BaseGroundPlugin:__webpackgi_exports__BaseGroundPlugin,BaseRenderer:__webpackgi_exports__BaseRenderer,BasicDepthPacking:__webpackgi_exports__BasicDepthPacking,BasicShadowMap:__webpackgi_exports__BasicShadowMap,BeringRingAnimation:__webpackgi_exports__BeringRingAnimation,BlobLoader:__webpackgi_exports__BlobLoader,BloomPlugin:__webpackgi_exports__BloomPlugin,Bone:__webpackgi_exports__Bone,BooleanKeyframeTrack:__webpackgi_exports__BooleanKeyframeTrack,Box2:__webpackgi_exports__Box2,Box3:__webpackgi_exports__Box3,Box3B:__webpackgi_exports__Box3B,Box3Helper:__webpackgi_exports__Box3Helper,BoxGeometry:__webpackgi_exports__BoxGeometry,BoxHelper:__webpackgi_exports__BoxHelper,BoxSelectionWidget:__webpackgi_exports__BoxSelectionWidget,BufferAttribute:__webpackgi_exports__BufferAttribute,BufferGeometry:__webpackgi_exports__BufferGeometry,BufferGeometryLoader:__webpackgi_exports__BufferGeometryLoader,ByteType:__webpackgi_exports__ByteType,CSGPluginBSP:__webpackgi_exports__CSGPluginBSP,CSGPluginBVH:__webpackgi_exports__CSGPluginBVH,CSGPluginBase:__webpackgi_exports__CSGPluginBase,CSS3DRendererPlugin:__webpackgi_exports__CSS3DRendererPlugin,Cache:__webpackgi_exports__Cache,Camera:__webpackgi_exports__Camera,CameraController:__webpackgi_exports__CameraController,CameraHelper:__webpackgi_exports__CameraHelper,CameraUiPlugin:__webpackgi_exports__CameraUiPlugin,CameraView:__webpackgi_exports__CameraView,CameraViewControlPlugin:__webpackgi_exports__CameraViewControlPlugin,CameraViewPlugin:__webpackgi_exports__CameraViewPlugin,CannonPhysicsPlugin:__webpackgi_exports__CannonPhysicsPlugin,CanvasMediaRecorder:__webpackgi_exports__CanvasMediaRecorder,CanvasRecorder:__webpackgi_exports__CanvasRecorder,CanvasRecorderPlugin:__webpackgi_exports__CanvasRecorderPlugin,CanvasSnipper:__webpackgi_exports__CanvasSnipper,CanvasSnipperPlugin:__webpackgi_exports__CanvasSnipperPlugin,CanvasTexture:__webpackgi_exports__CanvasTexture,CapsuleGeometry:__webpackgi_exports__CapsuleGeometry,CatmullRomCurve3:__webpackgi_exports__CatmullRomCurve3,ChromaticAberrationPlugin:__webpackgi_exports__ChromaticAberrationPlugin,CineonToneMapping:__webpackgi_exports__CineonToneMapping,CircleGeometry:__webpackgi_exports__CircleGeometry,ClampToEdgeWrapping:__webpackgi_exports__ClampToEdgeWrapping,ClearcoatTintPlugin:__webpackgi_exports__ClearcoatTintPlugin,Clock:__webpackgi_exports__Clock,Color:__webpackgi_exports__Color,ColorKeyframeTrack:__webpackgi_exports__ColorKeyframeTrack,ColorManagement:__webpackgi_exports__ColorManagement,CombinedPostPlugin:__webpackgi_exports__CombinedPostPlugin,Compress:__webpackgi_exports__Compress,CompressedArrayTexture:__webpackgi_exports__CompressedArrayTexture,CompressedCubeTexture:__webpackgi_exports__CompressedCubeTexture,CompressedTexture:__webpackgi_exports__CompressedTexture,CompressedTextureLoader:__webpackgi_exports__CompressedTextureLoader,ConeGeometry:__webpackgi_exports__ConeGeometry,ContactShadowGroundPlugin:__webpackgi_exports__ContactShadowGroundPlugin,CoreEditorApp:__webpackgi_exports__CoreEditorApp,CoreViewerApp:__webpackgi_exports__CoreViewerApp,CubeCamera:__webpackgi_exports__CubeCamera,CubeNormalsCaptureHelper:__webpackgi_exports__CubeNormalsCaptureHelper,CubeReflectionMapping:__webpackgi_exports__CubeReflectionMapping,CubeRefractionMapping:__webpackgi_exports__CubeRefractionMapping,CubeTexture:__webpackgi_exports__CubeTexture,CubeTextureLoader:__webpackgi_exports__CubeTextureLoader,CubeUVReflectionMapping:__webpackgi_exports__CubeUVReflectionMapping,CubicBezierCurve:__webpackgi_exports__CubicBezierCurve,CubicBezierCurve3:__webpackgi_exports__CubicBezierCurve3,CubicInterpolant:__webpackgi_exports__CubicInterpolant,CullFaceBack:__webpackgi_exports__CullFaceBack,CullFaceFront:__webpackgi_exports__CullFaceFront,CullFaceFrontBack:__webpackgi_exports__CullFaceFrontBack,CullFaceNone:__webpackgi_exports__CullFaceNone,Curve:__webpackgi_exports__Curve,CurvePath:__webpackgi_exports__CurvePath,CustomAnimationHelper:__webpackgi_exports__CustomAnimationHelper,CustomAnimationHelperPlugin:__webpackgi_exports__CustomAnimationHelperPlugin,CustomBlending:__webpackgi_exports__CustomBlending,CustomBumpMapPlugin:__webpackgi_exports__CustomBumpMapPlugin,CustomToneMapping:__webpackgi_exports__CustomToneMapping,CylinderGeometry:__webpackgi_exports__CylinderGeometry,Cylindrical:__webpackgi_exports__Cylindrical,DRACOLoader2:__webpackgi_exports__DRACOLoader2,Damper:__webpackgi_exports__Damper,Data3DTexture:__webpackgi_exports__Data3DTexture,DataArrayTexture:__webpackgi_exports__DataArrayTexture,DataTexture:__webpackgi_exports__DataTexture,DataTextureLoader:__webpackgi_exports__DataTextureLoader,DataUrlLoader:__webpackgi_exports__DataUrlLoader,DataUtils:__webpackgi_exports__DataUtils,DebugPlugin:__webpackgi_exports__DebugPlugin,DecodeUTF8:__webpackgi_exports__DecodeUTF8,Decompress:__webpackgi_exports__Decompress,DecrementStencilOp:__webpackgi_exports__DecrementStencilOp,DecrementWrapStencilOp:__webpackgi_exports__DecrementWrapStencilOp,DefaultLoadingManager:__webpackgi_exports__DefaultLoadingManager,Deflate:__webpackgi_exports__Deflate,DepthFormat:__webpackgi_exports__DepthFormat,DepthOfFieldPass:__webpackgi_exports__DepthOfFieldPass,DepthOfFieldPlugin:__webpackgi_exports__DepthOfFieldPlugin,DepthStencilFormat:__webpackgi_exports__DepthStencilFormat,DepthTexture:__webpackgi_exports__DepthTexture,DeviceOrientationControls2:__webpackgi_exports__DeviceOrientationControls2,DeviceOrientationControlsPlugin:__webpackgi_exports__DeviceOrientationControlsPlugin,DiamondMaterial:__webpackgi_exports__DiamondMaterial,DiamondPlugin:__webpackgi_exports__DiamondPlugin,DirectionalLight:__webpackgi_exports__DirectionalLight,DirectionalLight2:__webpackgi_exports__DirectionalLight2,DirectionalLightHelper:__webpackgi_exports__DirectionalLightHelper,DiscreteInterpolant:__webpackgi_exports__DiscreteInterpolant,DisplayP3ColorSpace:__webpackgi_exports__DisplayP3ColorSpace,DodecahedronGeometry:__webpackgi_exports__DodecahedronGeometry,DoubleSide:__webpackgi_exports__DoubleSide,Dropzone:__webpackgi_exports__Dropzone,DropzonePlugin:__webpackgi_exports__DropzonePlugin,DstAlphaFactor:__webpackgi_exports__DstAlphaFactor,DstColorFactor:__webpackgi_exports__DstColorFactor,DynamicCopyUsage:__webpackgi_exports__DynamicCopyUsage,DynamicDrawUsage:__webpackgi_exports__DynamicDrawUsage,DynamicReadUsage:__webpackgi_exports__DynamicReadUsage,EXRExporter2:__webpackgi_exports__EXRExporter2,EXRLoadPlugin:__webpackgi_exports__EXRLoadPlugin,EasingFunctions:__webpackgi_exports__EasingFunctions,EdgesGeometry:__webpackgi_exports__EdgesGeometry,EffectComposer2:__webpackgi_exports__EffectComposer2,EllipseCurve:__webpackgi_exports__EllipseCurve,EllipseCurve3D:__webpackgi_exports__EllipseCurve3D,EncodeUTF8:__webpackgi_exports__EncodeUTF8,EncoderMethod:__webpackgi_exports__EncoderMethod,EnvironmentPresetGroup:__webpackgi_exports__EnvironmentPresetGroup,EqualCompare:__webpackgi_exports__EqualCompare,EqualDepth:__webpackgi_exports__EqualDepth,EqualStencilFunc:__webpackgi_exports__EqualStencilFunc,EquirectangularReflectionMapping:__webpackgi_exports__EquirectangularReflectionMapping,EquirectangularRefractionMapping:__webpackgi_exports__EquirectangularRefractionMapping,Euler:__webpackgi_exports__Euler,EventDispatcher:__webpackgi_exports__EventDispatcher,ExtrasUiPlugin:__webpackgi_exports__ExtrasUiPlugin,ExtrudeGeometry:__webpackgi_exports__ExtrudeGeometry,FBXLoadPlugin:__webpackgi_exports__FBXLoadPlugin,FFMPEGRecorder:__webpackgi_exports__FFMPEGRecorder,FSShadowMaterial:__webpackgi_exports__FSShadowMaterial,FileLoader:__webpackgi_exports__FileLoader,FileTransferPlugin:__webpackgi_exports__FileTransferPlugin,FilmicGrainPlugin:__webpackgi_exports__FilmicGrainPlugin,FirstPersonControls2:__webpackgi_exports__FirstPersonControls2,FirstPersonControlsPlugin:__webpackgi_exports__FirstPersonControlsPlugin,Float16BufferAttribute:__webpackgi_exports__Float16BufferAttribute,Float32BufferAttribute:__webpackgi_exports__Float32BufferAttribute,Float64BufferAttribute:__webpackgi_exports__Float64BufferAttribute,FloatType:__webpackgi_exports__FloatType,Fog:__webpackgi_exports__Fog,FogExp2:__webpackgi_exports__FogExp2,FragmentClippingExtensionPlugin:__webpackgi_exports__FragmentClippingExtensionPlugin,FragmentClippingMode:__webpackgi_exports__FragmentClippingMode,FrameFadePlugin:__webpackgi_exports__FrameFadePlugin,FramebufferTexture:__webpackgi_exports__FramebufferTexture,FrontSide:__webpackgi_exports__FrontSide,Frustum:__webpackgi_exports__Frustum,FullScreenPlugin:__webpackgi_exports__FullScreenPlugin,GBufferPlugin:__webpackgi_exports__GBufferPlugin,GLBufferAttribute:__webpackgi_exports__GLBufferAttribute,GLSL1:__webpackgi_exports__GLSL1,GLSL3:__webpackgi_exports__GLSL3,GLTFAnimationPlugin:__webpackgi_exports__GLTFAnimationPlugin,GLTFDracoExportPlugin:__webpackgi_exports__GLTFDracoExportPlugin,GLTFDracoExporter:__webpackgi_exports__GLTFDracoExporter,GLTFExporter2:__webpackgi_exports__GLTFExporter2,GLTFExporterMaterialsVariantsExtensionExport:__webpackgi_exports__GLTFExporterMaterialsVariantsExtensionExport,GLTFKHRMaterialVariantsPlugin:__webpackgi_exports__GLTFKHRMaterialVariantsPlugin,GLTFLoader2:__webpackgi_exports__GLTFLoader2,GLTFMaterialsVariantsExtensionImport:__webpackgi_exports__GLTFMaterialsVariantsExtensionImport,GLTFMeshGpuInstancingExporter:__webpackgi_exports__GLTFMeshGpuInstancingExporter,GLTFMeshOptPlugin:__webpackgi_exports__GLTFMeshOptPlugin,GLTFSpecGlossinessConverterPlugin:__webpackgi_exports__GLTFSpecGlossinessConverterPlugin,GLTFWriter2:__webpackgi_exports__GLTFWriter2,GammaCorrectionExtension:__webpackgi_exports__GammaCorrectionExtension,GammaCorrectionPlugin:__webpackgi_exports__GammaCorrectionPlugin,GemEnvironmentPresetGroup:__webpackgi_exports__GemEnvironmentPresetGroup,GenericBlendTexturePass:__webpackgi_exports__GenericBlendTexturePass,GenericFilterPlugin:__webpackgi_exports__GenericFilterPlugin,GeometryGeneratorPlugin:__webpackgi_exports__GeometryGeneratorPlugin,GreaterCompare:__webpackgi_exports__GreaterCompare,GreaterDepth:__webpackgi_exports__GreaterDepth,GreaterEqualCompare:__webpackgi_exports__GreaterEqualCompare,GreaterEqualDepth:__webpackgi_exports__GreaterEqualDepth,GreaterEqualStencilFunc:__webpackgi_exports__GreaterEqualStencilFunc,GreaterStencilFunc:__webpackgi_exports__GreaterStencilFunc,GridHelper:__webpackgi_exports__GridHelper,GroundPlugin:__webpackgi_exports__GroundPlugin,Group:__webpackgi_exports__Group,Gunzip:__webpackgi_exports__Gunzip,GyroInputDevice:__webpackgi_exports__GyroInputDevice,Gzip:__webpackgi_exports__Gzip,HDRiGroundPlugin:__webpackgi_exports__HDRiGroundPlugin,HalfFloatType:__webpackgi_exports__HalfFloatType,HemisphereLight:__webpackgi_exports__HemisphereLight,HemisphereLightHelper:__webpackgi_exports__HemisphereLightHelper,HierarchyUiPlugin:__webpackgi_exports__HierarchyUiPlugin,IcosahedronGeometry:__webpackgi_exports__IcosahedronGeometry,ImageBitmapLoader:__webpackgi_exports__ImageBitmapLoader,ImageLoader:__webpackgi_exports__ImageLoader,ImageSequenceRecorder:__webpackgi_exports__ImageSequenceRecorder,ImageUtils:__webpackgi_exports__ImageUtils,Importer:__webpackgi_exports__Importer,IncrementStencilOp:__webpackgi_exports__IncrementStencilOp,IncrementWrapStencilOp:__webpackgi_exports__IncrementWrapStencilOp,Inflate:__webpackgi_exports__Inflate,InstancedBufferAttribute:__webpackgi_exports__InstancedBufferAttribute,InstancedBufferGeometry:__webpackgi_exports__InstancedBufferGeometry,InstancedInterleavedBuffer:__webpackgi_exports__InstancedInterleavedBuffer,InstancedMesh:__webpackgi_exports__InstancedMesh,Int16BufferAttribute:__webpackgi_exports__Int16BufferAttribute,Int32BufferAttribute:__webpackgi_exports__Int32BufferAttribute,Int8BufferAttribute:__webpackgi_exports__Int8BufferAttribute,IntType:__webpackgi_exports__IntType,InteractionPromptPlugin:__webpackgi_exports__InteractionPromptPlugin,InterleavedBuffer:__webpackgi_exports__InterleavedBuffer,InterleavedBufferAttribute:__webpackgi_exports__InterleavedBufferAttribute,Interpolant:__webpackgi_exports__Interpolant,InterpolateDiscrete:__webpackgi_exports__InterpolateDiscrete,InterpolateLinear:__webpackgi_exports__InterpolateLinear,InterpolateSmooth:__webpackgi_exports__InterpolateSmooth,InvertStencilOp:__webpackgi_exports__InvertStencilOp,KHR_TEXTURE_BASISU:__webpackgi_exports__KHR_TEXTURE_BASISU,KTX2LoadPlugin:__webpackgi_exports__KTX2LoadPlugin,KTXLoadPlugin:__webpackgi_exports__KTXLoadPlugin,KeepStencilOp:__webpackgi_exports__KeepStencilOp,KeyframeTrack:__webpackgi_exports__KeyframeTrack,LOD:__webpackgi_exports__LOD,LUTPlugin:__webpackgi_exports__LUTPlugin,LatheGeometry:__webpackgi_exports__LatheGeometry,LayeredMaterialPlugin:__webpackgi_exports__LayeredMaterialPlugin,Layers:__webpackgi_exports__Layers,LessCompare:__webpackgi_exports__LessCompare,LessDepth:__webpackgi_exports__LessDepth,LessEqualCompare:__webpackgi_exports__LessEqualCompare,LessEqualDepth:__webpackgi_exports__LessEqualDepth,LessEqualStencilFunc:__webpackgi_exports__LessEqualStencilFunc,LessStencilFunc:__webpackgi_exports__LessStencilFunc,Light:__webpackgi_exports__Light,LightProbe:__webpackgi_exports__LightProbe,LightsUiPlugin:__webpackgi_exports__LightsUiPlugin,Line:__webpackgi_exports__Line,Line2:__webpackgi_exports__Line2,Line3:__webpackgi_exports__Line3,LineBasicMaterial:__webpackgi_exports__LineBasicMaterial,LineCurve:__webpackgi_exports__LineCurve,LineCurve3:__webpackgi_exports__LineCurve3,LineDashedMaterial:__webpackgi_exports__LineDashedMaterial,LineGeometry:__webpackgi_exports__LineGeometry,LineLoop:__webpackgi_exports__LineLoop,LineMaterial:__webpackgi_exports__LineMaterial,LineSegments:__webpackgi_exports__LineSegments,LineSegments2:__webpackgi_exports__LineSegments2,LineSegmentsGeometry:__webpackgi_exports__LineSegmentsGeometry,LinearDisplayP3ColorSpace:__webpackgi_exports__LinearDisplayP3ColorSpace,LinearEncoding:__webpackgi_exports__LinearEncoding,LinearFilter:__webpackgi_exports__LinearFilter,LinearInterpolant:__webpackgi_exports__LinearInterpolant,LinearMipMapLinearFilter:__webpackgi_exports__LinearMipMapLinearFilter,LinearMipMapNearestFilter:__webpackgi_exports__LinearMipMapNearestFilter,LinearMipmapLinearFilter:__webpackgi_exports__LinearMipmapLinearFilter,LinearMipmapNearestFilter:__webpackgi_exports__LinearMipmapNearestFilter,LinearSRGBColorSpace:__webpackgi_exports__LinearSRGBColorSpace,LinearToneMapping:__webpackgi_exports__LinearToneMapping,LinearTransfer:__webpackgi_exports__LinearTransfer,Loader:__webpackgi_exports__Loader,LoaderUtils:__webpackgi_exports__LoaderUtils,LoadingManager:__webpackgi_exports__LoadingManager,LoadingScreenPlugin:__webpackgi_exports__LoadingScreenPlugin,LoopOnce:__webpackgi_exports__LoopOnce,LoopPingPong:__webpackgi_exports__LoopPingPong,LoopRepeat:__webpackgi_exports__LoopRepeat,LuminanceAlphaFormat:__webpackgi_exports__LuminanceAlphaFormat,LuminanceFormat:__webpackgi_exports__LuminanceFormat,MOUSE:__webpackgi_exports__MOUSE,MTLLoader2:__webpackgi_exports__MTLLoader2,Material:__webpackgi_exports__Material,MaterialConfiguratorBasePlugin:__webpackgi_exports__MaterialConfiguratorBasePlugin,MaterialConfiguratorPlugin:__webpackgi_exports__MaterialConfiguratorPlugin,MaterialExtender:__webpackgi_exports__MaterialExtender,MaterialLibPresetGroupPresetGroup:__webpackgi_exports__MaterialLibPresetGroupPresetGroup,MaterialLibraryBasePlugin:__webpackgi_exports__MaterialLibraryBasePlugin,MaterialLibraryPlugin:__webpackgi_exports__MaterialLibraryPlugin,MaterialLoader:__webpackgi_exports__MaterialLoader,MaterialManager:__webpackgi_exports__MaterialManager,MaterialPresetPlugin:__webpackgi_exports__MaterialPresetPlugin,MaterialPreviewGenerator:__webpackgi_exports__MaterialPreviewGenerator,MathUtils:__webpackgi_exports__MathUtils,Matrix3:__webpackgi_exports__Matrix3,Matrix4:__webpackgi_exports__Matrix4,MaxEquation:__webpackgi_exports__MaxEquation,Mesh:__webpackgi_exports__Mesh,MeshBasicMaterial:__webpackgi_exports__MeshBasicMaterial,MeshBasicMaterial2:__webpackgi_exports__MeshBasicMaterial2,MeshDepthMaterial:__webpackgi_exports__MeshDepthMaterial,MeshDistanceMaterial:__webpackgi_exports__MeshDistanceMaterial,MeshLambertMaterial:__webpackgi_exports__MeshLambertMaterial,MeshMatcapMaterial:__webpackgi_exports__MeshMatcapMaterial,MeshNormalMaterial:__webpackgi_exports__MeshNormalMaterial,MeshOptSimplifyModifierPlugin:__webpackgi_exports__MeshOptSimplifyModifierPlugin,MeshPhongMaterial:__webpackgi_exports__MeshPhongMaterial,MeshPhysicalMaterial:__webpackgi_exports__MeshPhysicalMaterial,MeshStandardMaterial:__webpackgi_exports__MeshStandardMaterial,MeshStandardMaterial2:__webpackgi_exports__MeshStandardMaterial2,MeshToonMaterial:__webpackgi_exports__MeshToonMaterial,MinEquation:__webpackgi_exports__MinEquation,MirroredRepeatWrapping:__webpackgi_exports__MirroredRepeatWrapping,MixOperation:__webpackgi_exports__MixOperation,ModelStagePlugin:__webpackgi_exports__ModelStagePlugin,ModelStagePresetGroup:__webpackgi_exports__ModelStagePresetGroup,MouseInputDevice:__webpackgi_exports__MouseInputDevice,MultiFilterPlugin:__webpackgi_exports__MultiFilterPlugin,MultiplyBlending:__webpackgi_exports__MultiplyBlending,MultiplyOperation:__webpackgi_exports__MultiplyOperation,NearestFilter:__webpackgi_exports__NearestFilter,NearestMipMapLinearFilter:__webpackgi_exports__NearestMipMapLinearFilter,NearestMipMapNearestFilter:__webpackgi_exports__NearestMipMapNearestFilter,NearestMipmapLinearFilter:__webpackgi_exports__NearestMipmapLinearFilter,NearestMipmapNearestFilter:__webpackgi_exports__NearestMipmapNearestFilter,NeverCompare:__webpackgi_exports__NeverCompare,NeverDepth:__webpackgi_exports__NeverDepth,NeverStencilFunc:__webpackgi_exports__NeverStencilFunc,NoBlending:__webpackgi_exports__NoBlending,NoColorSpace:__webpackgi_exports__NoColorSpace,NoToneMapping:__webpackgi_exports__NoToneMapping,NoiseBumpMaterialPlugin:__webpackgi_exports__NoiseBumpMaterialPlugin,NormalAnimationBlendMode:__webpackgi_exports__NormalAnimationBlendMode,NormalBlending:__webpackgi_exports__NormalBlending,NormalBufferPlugin:__webpackgi_exports__NormalBufferPlugin,NormalCaptureMaterial:__webpackgi_exports__NormalCaptureMaterial,NotEqualCompare:__webpackgi_exports__NotEqualCompare,NotEqualDepth:__webpackgi_exports__NotEqualDepth,NotEqualStencilFunc:__webpackgi_exports__NotEqualStencilFunc,NumberKeyframeTrack:__webpackgi_exports__NumberKeyframeTrack,OBJLoader2:__webpackgi_exports__OBJLoader2,ObjMtlLoadPlugin:__webpackgi_exports__ObjMtlLoadPlugin,Object3D:__webpackgi_exports__Object3D,Object3DModel:__webpackgi_exports__Object3DModel,Object3DWidgetsPlugin:__webpackgi_exports__Object3DWidgetsPlugin,ObjectLoader:__webpackgi_exports__ObjectLoader,ObjectLoader2:__webpackgi_exports__ObjectLoader2,ObjectPicker:__webpackgi_exports__ObjectPicker,ObjectProcessorMap:__webpackgi_exports__ObjectProcessorMap,ObjectRotationPlugin:__webpackgi_exports__ObjectRotationPlugin,ObjectSpaceNormalMap:__webpackgi_exports__ObjectSpaceNormalMap,OctahedronGeometry:__webpackgi_exports__OctahedronGeometry,OneFactor:__webpackgi_exports__OneFactor,OneMinusDstAlphaFactor:__webpackgi_exports__OneMinusDstAlphaFactor,OneMinusDstColorFactor:__webpackgi_exports__OneMinusDstColorFactor,OneMinusSrcAlphaFactor:__webpackgi_exports__OneMinusSrcAlphaFactor,OneMinusSrcColorFactor:__webpackgi_exports__OneMinusSrcColorFactor,OrbitControls2:__webpackgi_exports__OrbitControls2,OrbitControls3:__webpackgi_exports__OrbitControls3,OrthographicCamera:__webpackgi_exports__OrthographicCamera,OutlinePlugin:__webpackgi_exports__OutlinePlugin,P3Primaries:__webpackgi_exports__P3Primaries,PCFShadowMap:__webpackgi_exports__PCFShadowMap,PCFSoftShadowMap:__webpackgi_exports__PCFSoftShadowMap,PMREMGenerator:__webpackgi_exports__PMREMGenerator,PMREMGeneratorPlugin:__webpackgi_exports__PMREMGeneratorPlugin,ParallaxCameraControllerPlugin:__webpackgi_exports__ParallaxCameraControllerPlugin,ParallaxMappingPlugin:__webpackgi_exports__ParallaxMappingPlugin,Path:__webpackgi_exports__Path,PerspectiveCamera:__webpackgi_exports__PerspectiveCamera,PickingPlugin:__webpackgi_exports__PickingPlugin,Plane:__webpackgi_exports__Plane,PlaneGeometry:__webpackgi_exports__PlaneGeometry,PlaneHelper:__webpackgi_exports__PlaneHelper,PluginPresetGroup:__webpackgi_exports__PluginPresetGroup,PointLight:__webpackgi_exports__PointLight,PointLight2:__webpackgi_exports__PointLight2,PointLightHelper:__webpackgi_exports__PointLightHelper,PointerDragHelper:__webpackgi_exports__PointerDragHelper,PointerLockControls2:__webpackgi_exports__PointerLockControls2,PointerLockControlsPlugin:__webpackgi_exports__PointerLockControlsPlugin,Points:__webpackgi_exports__Points,PointsMaterial:__webpackgi_exports__PointsMaterial,PolarGridHelper:__webpackgi_exports__PolarGridHelper,PolyhedronGeometry:__webpackgi_exports__PolyhedronGeometry,PopmotionPlugin:__webpackgi_exports__PopmotionPlugin,PosePlugin:__webpackgi_exports__PosePlugin,PositionalAudio:__webpackgi_exports__PositionalAudio,PresetGroup:__webpackgi_exports__PresetGroup,PresetLibraryPlugin:__webpackgi_exports__PresetLibraryPlugin,ProgressivePlugin:__webpackgi_exports__ProgressivePlugin,PropertyBinding:__webpackgi_exports__PropertyBinding,PropertyMixer:__webpackgi_exports__PropertyMixer,QuadraticBezierCurve:__webpackgi_exports__QuadraticBezierCurve,QuadraticBezierCurve3:__webpackgi_exports__QuadraticBezierCurve3,Quaternion:__webpackgi_exports__Quaternion,QuaternionKeyframeTrack:__webpackgi_exports__QuaternionKeyframeTrack,QuaternionLinearInterpolant:__webpackgi_exports__QuaternionLinearInterpolant,RED_GREEN_RGTC2_Format:__webpackgi_exports__RED_GREEN_RGTC2_Format,RED_RGTC1_Format:__webpackgi_exports__RED_RGTC1_Format,REVISION:__webpackgi_exports__REVISION,RGBADepthPacking:__webpackgi_exports__RGBADepthPacking,RGBAFormat:__webpackgi_exports__RGBAFormat,RGBAIntegerFormat:__webpackgi_exports__RGBAIntegerFormat,RGBA_ASTC_10x10_Format:__webpackgi_exports__RGBA_ASTC_10x10_Format,RGBA_ASTC_10x5_Format:__webpackgi_exports__RGBA_ASTC_10x5_Format,RGBA_ASTC_10x6_Format:__webpackgi_exports__RGBA_ASTC_10x6_Format,RGBA_ASTC_10x8_Format:__webpackgi_exports__RGBA_ASTC_10x8_Format,RGBA_ASTC_12x10_Format:__webpackgi_exports__RGBA_ASTC_12x10_Format,RGBA_ASTC_12x12_Format:__webpackgi_exports__RGBA_ASTC_12x12_Format,RGBA_ASTC_4x4_Format:__webpackgi_exports__RGBA_ASTC_4x4_Format,RGBA_ASTC_5x4_Format:__webpackgi_exports__RGBA_ASTC_5x4_Format,RGBA_ASTC_5x5_Format:__webpackgi_exports__RGBA_ASTC_5x5_Format,RGBA_ASTC_6x5_Format:__webpackgi_exports__RGBA_ASTC_6x5_Format,RGBA_ASTC_6x6_Format:__webpackgi_exports__RGBA_ASTC_6x6_Format,RGBA_ASTC_8x5_Format:__webpackgi_exports__RGBA_ASTC_8x5_Format,RGBA_ASTC_8x6_Format:__webpackgi_exports__RGBA_ASTC_8x6_Format,RGBA_ASTC_8x8_Format:__webpackgi_exports__RGBA_ASTC_8x8_Format,RGBA_BPTC_Format:__webpackgi_exports__RGBA_BPTC_Format,RGBA_ETC2_EAC_Format:__webpackgi_exports__RGBA_ETC2_EAC_Format,RGBA_PVRTC_2BPPV1_Format:__webpackgi_exports__RGBA_PVRTC_2BPPV1_Format,RGBA_PVRTC_4BPPV1_Format:__webpackgi_exports__RGBA_PVRTC_4BPPV1_Format,RGBA_S3TC_DXT1_Format:__webpackgi_exports__RGBA_S3TC_DXT1_Format,RGBA_S3TC_DXT3_Format:__webpackgi_exports__RGBA_S3TC_DXT3_Format,RGBA_S3TC_DXT5_Format:__webpackgi_exports__RGBA_S3TC_DXT5_Format,RGBM16ColorSpace:__webpackgi_exports__RGBM16ColorSpace,RGBM16ColorSpace_:__webpackgi_exports__RGBM16ColorSpace_,RGB_BPTC_SIGNED_Format:__webpackgi_exports__RGB_BPTC_SIGNED_Format,RGB_BPTC_UNSIGNED_Format:__webpackgi_exports__RGB_BPTC_UNSIGNED_Format,RGB_ETC1_Format:__webpackgi_exports__RGB_ETC1_Format,RGB_ETC2_Format:__webpackgi_exports__RGB_ETC2_Format,RGB_PVRTC_2BPPV1_Format:__webpackgi_exports__RGB_PVRTC_2BPPV1_Format,RGB_PVRTC_4BPPV1_Format:__webpackgi_exports__RGB_PVRTC_4BPPV1_Format,RGB_S3TC_DXT1_Format:__webpackgi_exports__RGB_S3TC_DXT1_Format,RGFormat:__webpackgi_exports__RGFormat,RGIntegerFormat:__webpackgi_exports__RGIntegerFormat,RainbowDiamondPlugin:__webpackgi_exports__RainbowDiamondPlugin,RandomizedDirectionalLight:__webpackgi_exports__RandomizedDirectionalLight,RandomizedDirectionalLightPlugin:__webpackgi_exports__RandomizedDirectionalLightPlugin,RawShaderMaterial:__webpackgi_exports__RawShaderMaterial,Ray:__webpackgi_exports__Ray,Raycaster:__webpackgi_exports__Raycaster,Rec709Primaries:__webpackgi_exports__Rec709Primaries,RectAreaLight:__webpackgi_exports__RectAreaLight,RedFormat:__webpackgi_exports__RedFormat,RedIntegerFormat:__webpackgi_exports__RedIntegerFormat,Reflector2:__webpackgi_exports__Reflector2,ReinhardToneMapping:__webpackgi_exports__ReinhardToneMapping,RenderTarget:__webpackgi_exports__RenderTarget,RendererUiPlugin:__webpackgi_exports__RendererUiPlugin,RepeatWrapping:__webpackgi_exports__RepeatWrapping,ReplaceStencilOp:__webpackgi_exports__ReplaceStencilOp,ReverseSubtractEquation:__webpackgi_exports__ReverseSubtractEquation,Rhino3dmLoadPlugin:__webpackgi_exports__Rhino3dmLoadPlugin,Rhino3dmLoader2:__webpackgi_exports__Rhino3dmLoader2,RingGeometry:__webpackgi_exports__RingGeometry,RootScene:__webpackgi_exports__RootScene,SIGNED_RED_GREEN_RGTC2_Format:__webpackgi_exports__SIGNED_RED_GREEN_RGTC2_Format,SIGNED_RED_RGTC1_Format:__webpackgi_exports__SIGNED_RED_RGTC1_Format,SRGBColorSpace:__webpackgi_exports__SRGBColorSpace,SRGBTransfer:__webpackgi_exports__SRGBTransfer,SSAOPlugin:__webpackgi_exports__SSAOPlugin,SSBevelPass:__webpackgi_exports__SSBevelPass,SSBevelPlugin:__webpackgi_exports__SSBevelPlugin,SSContactShadows:__webpackgi_exports__SSContactShadows,SSGIPlugin:__webpackgi_exports__SSGIPlugin,SSRPlugin:__webpackgi_exports__SSRPlugin,STLLoadPlugin:__webpackgi_exports__STLLoadPlugin,Scene:__webpackgi_exports__Scene,SceneCamerasUiPlugin:__webpackgi_exports__SceneCamerasUiPlugin,SceneLoopPlugin:__webpackgi_exports__SceneLoopPlugin,ScrollableCameraViewPlugin:__webpackgi_exports__ScrollableCameraViewPlugin,ScrollableCameraViewPreviewPlugin:__webpackgi_exports__ScrollableCameraViewPreviewPlugin,SelectionWidget:__webpackgi_exports__SelectionWidget,ShaderChunk:__webpackgi_exports__ShaderChunk,ShaderLib:__webpackgi_exports__ShaderLib,ShaderMaterial:__webpackgi_exports__ShaderMaterial,ShaderMaterial2:__webpackgi_exports__ShaderMaterial2,ShaderMaterialEncodingSupport:__webpackgi_exports__ShaderMaterialEncodingSupport,ShaderPass2:__webpackgi_exports__ShaderPass2,ShadowMapBaker:__webpackgi_exports__ShadowMapBaker,ShadowMaterial:__webpackgi_exports__ShadowMaterial,Shape:__webpackgi_exports__Shape,ShapeGeometry:__webpackgi_exports__ShapeGeometry,ShapePath:__webpackgi_exports__ShapePath,ShapeTubeExtrudePlugin:__webpackgi_exports__ShapeTubeExtrudePlugin,ShapeUtils:__webpackgi_exports__ShapeUtils,ShortType:__webpackgi_exports__ShortType,SimpleAssetList:__webpackgi_exports__SimpleAssetList,SimpleBackgroundEnvUiPlugin:__webpackgi_exports__SimpleBackgroundEnvUiPlugin,SimpleDataSource:__webpackgi_exports__SimpleDataSource,SimpleEventDispatcher:__webpackgi_exports__SimpleEventDispatcher,SimpleJSONExporter:__webpackgi_exports__SimpleJSONExporter,SimpleJSONLoader:__webpackgi_exports__SimpleJSONLoader,SimpleTextExporter:__webpackgi_exports__SimpleTextExporter,SimpleTextPlugin:__webpackgi_exports__SimpleTextPlugin,SimpleViewerUi:__webpackgi_exports__SimpleViewerUi,SimplifyModifierPlugin:__webpackgi_exports__SimplifyModifierPlugin,Skeleton:__webpackgi_exports__Skeleton,SkeletonHelper:__webpackgi_exports__SkeletonHelper,SkinnedMesh:__webpackgi_exports__SkinnedMesh,SnowFallPlugin:__webpackgi_exports__SnowFallPlugin,Source:__webpackgi_exports__Source,Sphere:__webpackgi_exports__Sphere,SphereGeometry:__webpackgi_exports__SphereGeometry,SphereSelectionWidget:__webpackgi_exports__SphereSelectionWidget,Spherical:__webpackgi_exports__Spherical,SphericalHarmonics3:__webpackgi_exports__SphericalHarmonics3,SplineCurve:__webpackgi_exports__SplineCurve,SpotLight:__webpackgi_exports__SpotLight,SpotLight2:__webpackgi_exports__SpotLight2,SpotLightHelper:__webpackgi_exports__SpotLightHelper,Sprite:__webpackgi_exports__Sprite,SpriteMaterial:__webpackgi_exports__SpriteMaterial,SrcAlphaFactor:__webpackgi_exports__SrcAlphaFactor,SrcAlphaSaturateFactor:__webpackgi_exports__SrcAlphaSaturateFactor,SrcColorFactor:__webpackgi_exports__SrcColorFactor,StaticCopyUsage:__webpackgi_exports__StaticCopyUsage,StaticDrawUsage:__webpackgi_exports__StaticDrawUsage,StaticReadUsage:__webpackgi_exports__StaticReadUsage,StereoCamera:__webpackgi_exports__StereoCamera,StreamCopyUsage:__webpackgi_exports__StreamCopyUsage,StreamDrawUsage:__webpackgi_exports__StreamDrawUsage,StreamReadUsage:__webpackgi_exports__StreamReadUsage,StringKeyframeTrack:__webpackgi_exports__StringKeyframeTrack,SubtractEquation:__webpackgi_exports__SubtractEquation,SubtractiveBlending:__webpackgi_exports__SubtractiveBlending,SwitchNodeBasePlugin:__webpackgi_exports__SwitchNodeBasePlugin,SwitchNodePlugin:__webpackgi_exports__SwitchNodePlugin,TOUCH:__webpackgi_exports__TOUCH,TYPED_ARRAYS:__webpackgi_exports__TYPED_ARRAYS,TangentSpaceNormalMap:__webpackgi_exports__TangentSpaceNormalMap,TemporalAAPlugin:__webpackgi_exports__TemporalAAPlugin,TetrahedronGeometry:__webpackgi_exports__TetrahedronGeometry,TextSVGOptions:__webpackgi_exports__TextSVGOptions,Texture:__webpackgi_exports__Texture,TextureLoader:__webpackgi_exports__TextureLoader,ThinFilmLayerPlugin:__webpackgi_exports__ThinFilmLayerPlugin,ThreeMaterialLoader:__webpackgi_exports__ThreeMaterialLoader,TonemapPlugin:__webpackgi_exports__TonemapPlugin,TorusGeometry:__webpackgi_exports__TorusGeometry,TorusKnotGeometry:__webpackgi_exports__TorusKnotGeometry,TrackballControlsPlugin:__webpackgi_exports__TrackballControlsPlugin,TransformAnimationPlugin:__webpackgi_exports__TransformAnimationPlugin,TransformControls:__webpackgi_exports__TransformControls,TransformControls2:__webpackgi_exports__TransformControls2,TransformControlsGizmo:__webpackgi_exports__TransformControlsGizmo,TransformControlsPlane:__webpackgi_exports__TransformControlsPlane,TransfrSharePlugin:__webpackgi_exports__TransfrSharePlugin,Triangle:__webpackgi_exports__Triangle,TriangleFanDrawMode:__webpackgi_exports__TriangleFanDrawMode,TriangleStripDrawMode:__webpackgi_exports__TriangleStripDrawMode,TrianglesDrawMode:__webpackgi_exports__TrianglesDrawMode,TriplanarUVMappingPlugin:__webpackgi_exports__TriplanarUVMappingPlugin,TubeGeometry:__webpackgi_exports__TubeGeometry,TubeShapeGeometry:__webpackgi_exports__TubeShapeGeometry,TweakpaneUiPlugin:__webpackgi_exports__TweakpaneUiPlugin,TweakpaneWrapper:__webpackgi_exports__TweakpaneWrapper,TwoPassDoubleSide:__webpackgi_exports__TwoPassDoubleSide,UChartOptions:__webpackgi_exports__UChartOptions,UPackOptions:__webpackgi_exports__UPackOptions,UVMapping:__webpackgi_exports__UVMapping,Uint16BufferAttribute:__webpackgi_exports__Uint16BufferAttribute,Uint32BufferAttribute:__webpackgi_exports__Uint32BufferAttribute,Uint8BufferAttribute:__webpackgi_exports__Uint8BufferAttribute,Uint8ClampedBufferAttribute:__webpackgi_exports__Uint8ClampedBufferAttribute,Uncharted2Tonemapping:__webpackgi_exports__Uncharted2Tonemapping,Uniform:__webpackgi_exports__Uniform,UniformsGroup:__webpackgi_exports__UniformsGroup,UniformsLib:__webpackgi_exports__UniformsLib,UniformsUtils:__webpackgi_exports__UniformsUtils,UnsignedByteType:__webpackgi_exports__UnsignedByteType,UnsignedInt248Type:__webpackgi_exports__UnsignedInt248Type,UnsignedIntType:__webpackgi_exports__UnsignedIntType,UnsignedShort4444Type:__webpackgi_exports__UnsignedShort4444Type,UnsignedShort5551Type:__webpackgi_exports__UnsignedShort5551Type,UnsignedShortType:__webpackgi_exports__UnsignedShortType,Unzip:__webpackgi_exports__Unzip,UnzipInflate:__webpackgi_exports__UnzipInflate,UnzipPassThrough:__webpackgi_exports__UnzipPassThrough,Unzlib:__webpackgi_exports__Unzlib,VJSONPresetGroup:__webpackgi_exports__VJSONPresetGroup,VRPluginBasic:__webpackgi_exports__VRPluginBasic,VSMShadowMap:__webpackgi_exports__VSMShadowMap,VariationConfiguratorEditorUiPlugin:__webpackgi_exports__VariationConfiguratorEditorUiPlugin,VariationConfiguratorGridUiPlugin:__webpackgi_exports__VariationConfiguratorGridUiPlugin,VariationConfiguratorPlugin:__webpackgi_exports__VariationConfiguratorPlugin,Vector2:__webpackgi_exports__Vector2,Vector3:__webpackgi_exports__Vector3,Vector4:__webpackgi_exports__Vector4,VectorKeyframeTrack:__webpackgi_exports__VectorKeyframeTrack,VelocityBufferPlugin:__webpackgi_exports__VelocityBufferPlugin,VideoTexture:__webpackgi_exports__VideoTexture,ViewerApp:__webpackgi_exports__ViewerApp,ViewerState:__webpackgi_exports__ViewerState,VignettePlugin:__webpackgi_exports__VignettePlugin,VirtualCamerasPlugin:__webpackgi_exports__VirtualCamerasPlugin,WaveGroundPlugin:__webpackgi_exports__WaveGroundPlugin,WebGL1Renderer:__webpackgi_exports__WebGL1Renderer,WebGL3DRenderTarget:__webpackgi_exports__WebGL3DRenderTarget,WebGLArrayRenderTarget:__webpackgi_exports__WebGLArrayRenderTarget,WebGLCoordinateSystem:__webpackgi_exports__WebGLCoordinateSystem,WebGLCubeRenderTarget:__webpackgi_exports__WebGLCubeRenderTarget,WebGLMultipleRenderTargets:__webpackgi_exports__WebGLMultipleRenderTargets,WebGLRenderTarget:__webpackgi_exports__WebGLRenderTarget,WebGLRenderer:__webpackgi_exports__WebGLRenderer,WebGLUtils:__webpackgi_exports__WebGLUtils,WebGPUCoordinateSystem:__webpackgi_exports__WebGPUCoordinateSystem,WebGiViewerElement:__webpackgi_exports__WebGiViewerElement,WindowiseDialogPlugin:__webpackgi_exports__WindowiseDialogPlugin,Wireframe:__webpackgi_exports__Wireframe,WireframeGeometry:__webpackgi_exports__WireframeGeometry,WireframeGeometry2:__webpackgi_exports__WireframeGeometry2,WrapAroundEnding:__webpackgi_exports__WrapAroundEnding,XAtlasPlugin:__webpackgi_exports__XAtlasPlugin,ZeroCurvatureEnding:__webpackgi_exports__ZeroCurvatureEnding,ZeroFactor:__webpackgi_exports__ZeroFactor,ZeroSlopeEnding:__webpackgi_exports__ZeroSlopeEnding,ZeroStencilOp:__webpackgi_exports__ZeroStencilOp,Zip:__webpackgi_exports__Zip,ZipDeflate:__webpackgi_exports__ZipDeflate,ZipLoader:__webpackgi_exports__ZipLoader,ZipPassThrough:__webpackgi_exports__ZipPassThrough,Zlib:__webpackgi_exports__Zlib,_SRGBAFormat:__webpackgi_exports___SRGBAFormat,absMax:__webpackgi_exports__absMax,addBasePlugins:__webpackgi_exports__addBasePlugins,addBloomData:__webpackgi_exports__addBloomData,addDracoLoader:__webpackgi_exports__addDracoLoader,addEditorPlugins:__webpackgi_exports__addEditorPlugins,addGLTFExporter:__webpackgi_exports__addGLTFExporter,addGLTFLoader:__webpackgi_exports__addGLTFLoader,addLUTData:__webpackgi_exports__addLUTData,addRGBELoader:__webpackgi_exports__addRGBELoader,addSSBevel:__webpackgi_exports__addSSBevel,aesGcmDecrypt:__webpackgi_exports__aesGcmDecrypt,aesGcmEncrypt:__webpackgi_exports__aesGcmEncrypt,afterMain:__webpackgi_exports__afterMain,afterRead:__webpackgi_exports__afterRead,afterWrite:__webpackgi_exports__afterWrite,angle:__webpackgi_exports__angle,animate:__webpackgi_exports__animate,animateAsync:__webpackgi_exports__animateAsync,animateObject:__webpackgi_exports__animateObject,animateSet:__webpackgi_exports__animateSet,animateTarget:__webpackgi_exports__animateTarget,anticipate:__webpackgi_exports__anticipate,applyOffset:__webpackgi_exports__applyOffset,applyStyles:__webpackgi_exports__applyStyles,arrayBufferToBase64:__webpackgi_exports__arrayBufferToBase64,arrow:__webpackgi_exports__arrow,attract:__webpackgi_exports__attract,attractExpo:__webpackgi_exports__attractExpo,auto:__webpackgi_exports__auto,autoCenterObject3D:__webpackgi_exports__autoCenterObject3D,autoGPUInstanceMeshes:__webpackgi_exports__autoGPUInstanceMeshes,autoScaleObject3D:__webpackgi_exports__autoScaleObject3D,backIn:__webpackgi_exports__backIn,backInOut:__webpackgi_exports__backInOut,backOut:__webpackgi_exports__backOut,base64ToArrayBuffer:__webpackgi_exports__base64ToArrayBuffer,basePlacements:__webpackgi_exports__basePlacements,basicMaterialPropList:__webpackgi_exports__basicMaterialPropList,beforeMain:__webpackgi_exports__beforeMain,beforeRead:__webpackgi_exports__beforeRead,beforeWrite:__webpackgi_exports__beforeWrite,blobToDataURL:__webpackgi_exports__blobToDataURL,bottom:__webpackgi_exports__bottom,bounceIn:__webpackgi_exports__bounceIn,bounceInOut:__webpackgi_exports__bounceInOut,bounceOut:__webpackgi_exports__bounceOut,buildCSGMeshBSP:__webpackgi_exports__buildCSGMeshBSP,buildCSGMeshBVH:__webpackgi_exports__buildCSGMeshBVH,cLinearToRGBM:__webpackgi_exports__cLinearToRGBM,cRGBMToLinear:__webpackgi_exports__cRGBMToLinear,circIn:__webpackgi_exports__circIn,circInOut:__webpackgi_exports__circInOut,circOut:__webpackgi_exports__circOut,clamp:__webpackgi_exports__clamp,clippingParents:__webpackgi_exports__clippingParents,colorToDataUrl:__webpackgi_exports__colorToDataUrl,combineDofShader:__webpackgi_exports__combineDofShader,compress:__webpackgi_exports__compress,compressSync:__webpackgi_exports__compressSync,computeAverageGeometryNormal:__webpackgi_exports__computeAverageGeometryNormal,computeEigenVectors:__webpackgi_exports__computeEigenVectors,computeGeometryCenter:__webpackgi_exports__computeGeometryCenter,computeGeometrySize:__webpackgi_exports__computeGeometrySize,computeMikkTSpaceTangents:__webpackgi_exports__computeMikkTSpaceTangents,computeMorphedAttributes:__webpackgi_exports__computeMorphedAttributes,computeOffsetMatrix:__webpackgi_exports__computeOffsetMatrix,computeScreenSpaceBoundingBox:__webpackgi_exports__computeScreenSpaceBoundingBox,computeStyles:__webpackgi_exports__computeStyles,copyMaterialUserData:__webpackgi_exports__copyMaterialUserData,copyObject3DUserData:__webpackgi_exports__copyObject3DUserData,copyProps:__webpackgi_exports__copyProps,copyTextureUserData:__webpackgi_exports__copyTextureUserData,createAnticipate:__webpackgi_exports__createAnticipate,createAttractor:__webpackgi_exports__createAttractor,createBackIn:__webpackgi_exports__createBackIn,createCanvasElement:__webpackgi_exports__createCanvasElement,createDiv:__webpackgi_exports__createDiv,createExpoIn:__webpackgi_exports__createExpoIn,createGenericExtensionClass:__webpackgi_exports__createGenericExtensionClass,createIFrameCSS3DObject:__webpackgi_exports__createIFrameCSS3DObject,createImage:__webpackgi_exports__createImage,createPopper:__webpackgi_exports__createPopper,createPopperBase:__webpackgi_exports__createPopperBase,createPopperLite:__webpackgi_exports__createPopperLite,createRenderTargetKey:__webpackgi_exports__createRenderTargetKey,createScriptFromURL:__webpackgi_exports__createScriptFromURL,createStyles:__webpackgi_exports__createStyles,csgOperations:__webpackgi_exports__csgOperations,css:__webpackgi_exports__css,cubicBezier:__webpackgi_exports__cubicBezier,dataTextureFromColor:__webpackgi_exports__dataTextureFromColor,dataTextureFromVec4:__webpackgi_exports__dataTextureFromVec4,decay:__webpackgi_exports__decay,decompress:__webpackgi_exports__decompress,decompressSync:__webpackgi_exports__decompressSync,deepAccessObject:__webpackgi_exports__deepAccessObject,deepCloneAttribute:__webpackgi_exports__deepCloneAttribute,defaultPresets:__webpackgi_exports__defaultPresets,deflate:__webpackgi_exports__deflate,deflateSync:__webpackgi_exports__deflateSync,degreesToRadians:__webpackgi_exports__degreesToRadians,deinterleaveAttribute:__webpackgi_exports__deinterleaveAttribute,deinterleaveGeometry:__webpackgi_exports__deinterleaveGeometry,deserializeObject:__webpackgi_exports__deserializeObject,deserializers:__webpackgi_exports__deserializers,detectOverflow:__webpackgi_exports__detectOverflow,diamondMaterialPropList:__webpackgi_exports__diamondMaterialPropList,distance:__webpackgi_exports__distance,downloadBlob:__webpackgi_exports__downloadBlob,downloadFile:__webpackgi_exports__downloadFile,easeIn:__webpackgi_exports__easeIn,easeInOut:__webpackgi_exports__easeInOut,easeOut:__webpackgi_exports__easeOut,embedUrlRefs:__webpackgi_exports__embedUrlRefs,end:__webpackgi_exports__end,envMapBackground:__webpackgi_exports__envMapBackground,escapeRegExp:__webpackgi_exports__escapeRegExp,estimateBytesUsed:__webpackgi_exports__estimateBytesUsed,eventListeners:__webpackgi_exports__eventListeners,extractAnimationKey:__webpackgi_exports__extractAnimationKey,flattenUiConfig:__webpackgi_exports__flattenUiConfig,flip:__webpackgi_exports__flip,fontFormatExtensionMap:__webpackgi_exports__fontFormatExtensionMap,generateUiConfig:__webpackgi_exports__generateUiConfig,generateUiFolder:__webpackgi_exports__generateUiFolder,getFileHandle:__webpackgi_exports__getFileHandle,getFilenameFromPath:__webpackgi_exports__getFilenameFromPath,getKeyByValue:__webpackgi_exports__getKeyByValue,getNewFileHandle:__webpackgi_exports__getNewFileHandle,getOrCall:__webpackgi_exports__getOrCall,getPropertyDescriptor:__webpackgi_exports__getPropertyDescriptor,getTexelDecoding:__webpackgi_exports__getTexelDecoding,getTexelDecodingFunction:__webpackgi_exports__getTexelDecodingFunction,getTextureDataType:__webpackgi_exports__getTextureDataType,getTypedArray:__webpackgi_exports__getTypedArray,getUrlQueryParam:__webpackgi_exports__getUrlQueryParam,glbEncryptionPreparser:__webpackgi_exports__glbEncryptionPreparser,glsl:__webpackgi_exports__glsl,gltfExporterMaterialsVariantsExtensionExport:__webpackgi_exports__gltfExporterMaterialsVariantsExtensionExport,gunzip:__webpackgi_exports__gunzip,gunzipSync:__webpackgi_exports__gunzipSync,gzip:__webpackgi_exports__gzip,gzipSync:__webpackgi_exports__gzipSync,hide:__webpackgi_exports__hide,html:__webpackgi_exports__html,htmlToCanvas:__webpackgi_exports__htmlToCanvas,htmlToPng:__webpackgi_exports__htmlToPng,htmlToSvg:__webpackgi_exports__htmlToSvg,iGeometryIgnoredUserData:__webpackgi_exports__iGeometryIgnoredUserData,iMaterialIgnoredUserData:__webpackgi_exports__iMaterialIgnoredUserData,iModelIgnoredUserData:__webpackgi_exports__iModelIgnoredUserData,iTextureIgnoredUserData:__webpackgi_exports__iTextureIgnoredUserData,imageBitmapToBase64:__webpackgi_exports__imageBitmapToBase64,imageDataToCanvas:__webpackgi_exports__imageDataToCanvas,imageToCanvas:__webpackgi_exports__imageToCanvas,imageUrlToImageData:__webpackgi_exports__imageUrlToImageData,includesAll:__webpackgi_exports__includesAll,inertia:__webpackgi_exports__inertia,inflate:__webpackgi_exports__inflate,inflateSync:__webpackgi_exports__inflateSync,interleaveAttributes:__webpackgi_exports__interleaveAttributes,interpolate:__webpackgi_exports__interpolate,isAnimatableType:__webpackgi_exports__isAnimatableType,isPoint:__webpackgi_exports__isPoint,isPoint3D:__webpackgi_exports__isPoint3D,isPropertyWritable:__webpackgi_exports__isPropertyWritable,keyframes:__webpackgi_exports__keyframes,khrMaterialsVariantsGLTF:__webpackgi_exports__khrMaterialsVariantsGLTF,left:__webpackgi_exports__left,lerpAngle:__webpackgi_exports__lerpAngle,lerpAngle2:__webpackgi_exports__lerpAngle2,linear:__webpackgi_exports__linear,longestCommonPrefix:__webpackgi_exports__longestCommonPrefix,main:__webpackgi_exports__main,makeColorSvg:__webpackgi_exports__makeColorSvg,makeColorSvgCircle:__webpackgi_exports__makeColorSvgCircle,makeFilter:__webpackgi_exports__makeFilter,makeSamplerUi:__webpackgi_exports__makeSamplerUi,makeSetterFor:__webpackgi_exports__makeSetterFor,makeTextSvg:__webpackgi_exports__makeTextSvg,matDefine:__webpackgi_exports__matDefine,mergeAttributes:__webpackgi_exports__mergeAttributes,mergeBufferAttributes:__webpackgi_exports__mergeBufferAttributes,mergeBufferGeometries:__webpackgi_exports__mergeBufferGeometries,mergeGeometries:__webpackgi_exports__mergeGeometries,mergeGroups:__webpackgi_exports__mergeGroups,mergeVertices:__webpackgi_exports__mergeVertices,mirrorEasing:__webpackgi_exports__mirrorEasing,mix:__webpackgi_exports__mix,mixColor:__webpackgi_exports__mixColor,mixComplex:__webpackgi_exports__mixComplex,mobileAndTabletCheck:__webpackgi_exports__mobileAndTabletCheck,modifierPhases:__webpackgi_exports__modifierPhases,now:__webpackgi_exports__now,objectHasOwn:__webpackgi_exports__objectHasOwn,offset:__webpackgi_exports__offset,onChange:__webpackgi_exports__onChange,onChange2:__webpackgi_exports__onChange2,onChange3:__webpackgi_exports__onChange3,parseFileExtension:__webpackgi_exports__parseFileExtension,patchShaderEncodingSupport:__webpackgi_exports__patchShaderEncodingSupport,pathJoin:__webpackgi_exports__pathJoin,physicalMaterialPropList:__webpackgi_exports__physicalMaterialPropList,pipe:__webpackgi_exports__pipe,pivotToBBoxCenter:__webpackgi_exports__pivotToBBoxCenter,pivotToPoint:__webpackgi_exports__pivotToPoint,placements:__webpackgi_exports__placements,pointFromVector:__webpackgi_exports__pointFromVector,popper:__webpackgi_exports__popper,popperGenerator:__webpackgi_exports__popperGenerator,popperOffsets:__webpackgi_exports__popperOffsets,prettyScrollbar:__webpackgi_exports__prettyScrollbar,preventOverflow:__webpackgi_exports__preventOverflow,processViewer:__webpackgi_exports__processViewer,progress:__webpackgi_exports__progress,radiansToDegrees:__webpackgi_exports__radiansToDegrees,read:__webpackgi_exports__read,readFile:__webpackgi_exports__readFile,reference:__webpackgi_exports__reference,remoteWorkerURL:__webpackgi_exports__remoteWorkerURL,removeDuplicateGeometries:__webpackgi_exports__removeDuplicateGeometries,replaceAll:__webpackgi_exports__replaceAll,reverseEasing:__webpackgi_exports__reverseEasing,right:__webpackgi_exports__right,rotateDuplicatedMesh:__webpackgi_exports__rotateDuplicatedMesh,sRGBEncoding:__webpackgi_exports__sRGBEncoding,safeSetProperty:__webpackgi_exports__safeSetProperty,serializable:__webpackgi_exports__serializable,serialize:__webpackgi_exports__serialize,serializeObject:__webpackgi_exports__serializeObject,serializeTextureInExtras:__webpackgi_exports__serializeTextureInExtras,serializers:__webpackgi_exports__serializers,setMeshGeometry:__webpackgi_exports__setMeshGeometry,setMeshMaterial:__webpackgi_exports__setMeshMaterial,setThreeRendererMode:__webpackgi_exports__setThreeRendererMode,setUrlQueryParam:__webpackgi_exports__setUrlQueryParam,setupCoreWebGiViewer:__webpackgi_exports__setupCoreWebGiViewer,setupIModel:__webpackgi_exports__setupIModel,setupModesStyles:__webpackgi_exports__setupModesStyles,setupModesUi:__webpackgi_exports__setupModesUi,setupObject3dModel:__webpackgi_exports__setupObject3dModel,setupSandboxWebGiEditor:__webpackgi_exports__setupSandboxWebGiEditor,shaderReplaceString:__webpackgi_exports__shaderReplaceString,sign2:__webpackgi_exports__sign2,slerp:__webpackgi_exports__slerp,smooth:__webpackgi_exports__smooth,smoothFrame:__webpackgi_exports__smoothFrame,snap:__webpackgi_exports__snap,snapObject:__webpackgi_exports__snapObject,sphericalFromObject:__webpackgi_exports__sphericalFromObject,spring:__webpackgi_exports__spring,standardMaterialPropList:__webpackgi_exports__standardMaterialPropList,start:__webpackgi_exports__start,steps:__webpackgi_exports__steps,strFromU8:__webpackgi_exports__strFromU8,strToU8:__webpackgi_exports__strToU8,supportsRequestStreams:__webpackgi_exports__supportsRequestStreams,svgToCanvas:__webpackgi_exports__svgToCanvas,svgToPng:__webpackgi_exports__svgToPng,svgUrl:__webpackgi_exports__svgUrl,texImageToCanvas:__webpackgi_exports__texImageToCanvas,textureDataToImageData:__webpackgi_exports__textureDataToImageData,textureToCanvas:__webpackgi_exports__textureToCanvas,textureToDataUrl:__webpackgi_exports__textureToDataUrl,timeout:__webpackgi_exports__timeout,toCreasedNormals:__webpackgi_exports__toCreasedNormals,toDecimal:__webpackgi_exports__toDecimal,toIndexedGeometry:__webpackgi_exports__toIndexedGeometry,toTitleCase:__webpackgi_exports__toTitleCase,toTrianglesDrawMode:__webpackgi_exports__toTrianglesDrawMode,top:__webpackgi_exports__top,uiButton:__webpackgi_exports__uiButton,uiColor:__webpackgi_exports__uiColor,uiConfig:__webpackgi_exports__uiConfig,uiDropdown:__webpackgi_exports__uiDropdown,uiFolder:__webpackgi_exports__uiFolder,uiImage:__webpackgi_exports__uiImage,uiInput:__webpackgi_exports__uiInput,uiMonitor:__webpackgi_exports__uiMonitor,uiPanel:__webpackgi_exports__uiPanel,uiSlider:__webpackgi_exports__uiSlider,uiToggle:__webpackgi_exports__uiToggle,uiVector:__webpackgi_exports__uiVector,uniform:__webpackgi_exports__uniform,unzip:__webpackgi_exports__unzip,unzipSync:__webpackgi_exports__unzipSync,unzlib:__webpackgi_exports__unzlib,unzlibSync:__webpackgi_exports__unzlibSync,uploadFile:__webpackgi_exports__uploadFile,vLinearToRGBM:__webpackgi_exports__vLinearToRGBM,vRGBMToLinear:__webpackgi_exports__vRGBMToLinear,valueToUiType:__webpackgi_exports__valueToUiType,variationPlacements:__webpackgi_exports__variationPlacements,velocityPerFrame:__webpackgi_exports__velocityPerFrame,velocityPerSecond:__webpackgi_exports__velocityPerSecond,verifyPermission:__webpackgi_exports__verifyPermission,viewport:__webpackgi_exports__viewport,wrap:__webpackgi_exports__wrap,write:__webpackgi_exports__write,writeFile:__webpackgi_exports__writeFile,zip:__webpackgi_exports__zip,zipSync:__webpackgi_exports__zipSync,zlib:__webpackgi_exports__zlib,zlibSync:__webpackgi_exports__zlibSync},Symbol.toStringTag,{value:"Module"})),w0=class Aw extends __webpackgi_exports__AViewerPlugin{constructor(){super(...arguments),this.enabled=!0,this.materials=[],this.presets={},this.getMaterialPresetByName=o=>!this.presets||this.presets.length==0?null:this.presets[o.type].find(c=>c.path.split("/").pop()==o.name)}async onAdded(o){await super.onAdded(o)}loadPresets(o,c){this.presets=o,this.basePath=c,this.dispatchEvent({type:"deserialize"})}exportPresets(){return{materials:this.materials,type:Aw.PluginType}}async fromJSON(o,c){if(!super.fromJSON(o,c))return null;const d=o.materials;if(!d)return null;const _=[];for(const b of d)_.push(this.apply(b.name,b.path));return await Promise.all(_),this.dispatchEvent({type:"deserialize"}),this}async apply(o,c){var d,_,b,_e,it;const nt=(d=this._viewer)==null?void 0:d.getManager(),at=(b=await((_=nt==null?void 0:nt.importer)==null?void 0:_.importSinglePath(c)))==null?void 0:b.clone();if(!at)return"Unable to load material";at.name=o;const ut=new Set;(it=(_e=this._viewer)==null?void 0:_e.scene)==null||it.traverse(mt=>{mt.isMesh&&mt.material.name===o&&ut.add(mt)}),ut.forEach(mt=>{var ft;(ft=mt==null?void 0:mt.setMaterial)==null||ft.call(mt,at),mt.material.name=o});const pt=this.materials.findIndex(mt=>mt.name===o);pt!==-1?this.materials[pt]={name:o,path:c}:this.materials.push({name:o,path:c})}};w0.PluginType="MaterialPresetPlugin";let MaterialPresetPlugin=w0;var jsxRuntime={exports:{}},reactJsxRuntime_production_min={},react={exports:{}},react_production_min={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var l$1=Symbol.for("react.element"),n$1=Symbol.for("react.portal"),p$2=Symbol.for("react.fragment"),q$1=Symbol.for("react.strict_mode"),r=Symbol.for("react.profiler"),t=Symbol.for("react.provider"),u=Symbol.for("react.context"),v$2=Symbol.for("react.forward_ref"),w=Symbol.for("react.suspense"),x=Symbol.for("react.memo"),y=Symbol.for("react.lazy"),z$1=Symbol.iterator;function A$1(h){return h===null||typeof h!="object"?null:(h=z$1&&h[z$1]||h["@@iterator"],typeof h=="function"?h:null)}var B$1={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},C$1=Object.assign,D$1={};function E$1(h,o,c){this.props=h,this.context=o,this.refs=D$1,this.updater=c||B$1}E$1.prototype.isReactComponent={};E$1.prototype.setState=function(h,o){if(typeof h!="object"&&typeof h!="function"&&h!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,h,o,"setState")};E$1.prototype.forceUpdate=function(h){this.updater.enqueueForceUpdate(this,h,"forceUpdate")};function F(){}F.prototype=E$1.prototype;function G$1(h,o,c){this.props=h,this.context=o,this.refs=D$1,this.updater=c||B$1}var H$1=G$1.prototype=new F;H$1.constructor=G$1;C$1(H$1,E$1.prototype);H$1.isPureReactComponent=!0;var I$1=Array.isArray,J=Object.prototype.hasOwnProperty,K$1={current:null},L$1={key:!0,ref:!0,__self:!0,__source:!0};function M$1(h,o,c){var d,_={},b=null,_e=null;if(o!=null)for(d in o.ref!==void 0&&(_e=o.ref),o.key!==void 0&&(b=""+o.key),o)J.call(o,d)&&!L$1.hasOwnProperty(d)&&(_[d]=o[d]);var it=arguments.length-2;if(it===1)_.children=c;else if(1<it){for(var nt=Array(it),at=0;at<it;at++)nt[at]=arguments[at+2];_.children=nt}if(h&&h.defaultProps)for(d in it=h.defaultProps,it)_[d]===void 0&&(_[d]=it[d]);return{$$typeof:l$1,type:h,key:b,ref:_e,props:_,_owner:K$1.current}}function N$1(h,o){return{$$typeof:l$1,type:h.type,key:o,ref:h.ref,props:h.props,_owner:h._owner}}function O$1(h){return typeof h=="object"&&h!==null&&h.$$typeof===l$1}function escape$1(h){var o={"=":"=0",":":"=2"};return"$"+h.replace(/[=:]/g,function(c){return o[c]})}var P$1=/\/+/g;function Q$1(h,o){return typeof h=="object"&&h!==null&&h.key!=null?escape$1(""+h.key):o.toString(36)}function R$1(h,o,c,d,_){var b=typeof h;(b==="undefined"||b==="boolean")&&(h=null);var _e=!1;if(h===null)_e=!0;else switch(b){case"string":case"number":_e=!0;break;case"object":switch(h.$$typeof){case l$1:case n$1:_e=!0}}if(_e)return _e=h,_=_(_e),h=d===""?"."+Q$1(_e,0):d,I$1(_)?(c="",h!=null&&(c=h.replace(P$1,"$&/")+"/"),R$1(_,o,c,"",function(at){return at})):_!=null&&(O$1(_)&&(_=N$1(_,c+(!_.key||_e&&_e.key===_.key?"":(""+_.key).replace(P$1,"$&/")+"/")+h)),o.push(_)),1;if(_e=0,d=d===""?".":d+":",I$1(h))for(var it=0;it<h.length;it++){b=h[it];var nt=d+Q$1(b,it);_e+=R$1(b,o,c,nt,_)}else if(nt=A$1(h),typeof nt=="function")for(h=nt.call(h),it=0;!(b=h.next()).done;)b=b.value,nt=d+Q$1(b,it++),_e+=R$1(b,o,c,nt,_);else if(b==="object")throw o=String(h),Error("Objects are not valid as a React child (found: "+(o==="[object Object]"?"object with keys {"+Object.keys(h).join(", ")+"}":o)+"). If you meant to render a collection of children, use an array instead.");return _e}function S$1(h,o,c){if(h==null)return h;var d=[],_=0;return R$1(h,d,"","",function(b){return o.call(c,b,_++)}),d}function T$1(h){if(h._status===-1){var o=h._result;o=o(),o.then(function(c){(h._status===0||h._status===-1)&&(h._status=1,h._result=c)},function(c){(h._status===0||h._status===-1)&&(h._status=2,h._result=c)}),h._status===-1&&(h._status=0,h._result=o)}if(h._status===1)return h._result.default;throw h._result}var U$1={current:null},V$1={transition:null},W$1={ReactCurrentDispatcher:U$1,ReactCurrentBatchConfig:V$1,ReactCurrentOwner:K$1};function X$1(){throw Error("act(...) is not supported in production builds of React.")}react_production_min.Children={map:S$1,forEach:function(h,o,c){S$1(h,function(){o.apply(this,arguments)},c)},count:function(h){var o=0;return S$1(h,function(){o++}),o},toArray:function(h){return S$1(h,function(o){return o})||[]},only:function(h){if(!O$1(h))throw Error("React.Children.only expected to receive a single React element child.");return h}};react_production_min.Component=E$1;react_production_min.Fragment=p$2;react_production_min.Profiler=r;react_production_min.PureComponent=G$1;react_production_min.StrictMode=q$1;react_production_min.Suspense=w;react_production_min.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=W$1;react_production_min.act=X$1;react_production_min.cloneElement=function(h,o,c){if(h==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+h+".");var d=C$1({},h.props),_=h.key,b=h.ref,_e=h._owner;if(o!=null){if(o.ref!==void 0&&(b=o.ref,_e=K$1.current),o.key!==void 0&&(_=""+o.key),h.type&&h.type.defaultProps)var it=h.type.defaultProps;for(nt in o)J.call(o,nt)&&!L$1.hasOwnProperty(nt)&&(d[nt]=o[nt]===void 0&&it!==void 0?it[nt]:o[nt])}var nt=arguments.length-2;if(nt===1)d.children=c;else if(1<nt){it=Array(nt);for(var at=0;at<nt;at++)it[at]=arguments[at+2];d.children=it}return{$$typeof:l$1,type:h.type,key:_,ref:b,props:d,_owner:_e}};react_production_min.createContext=function(h){return h={$$typeof:u,_currentValue:h,_currentValue2:h,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},h.Provider={$$typeof:t,_context:h},h.Consumer=h};react_production_min.createElement=M$1;react_production_min.createFactory=function(h){var o=M$1.bind(null,h);return o.type=h,o};react_production_min.createRef=function(){return{current:null}};react_production_min.forwardRef=function(h){return{$$typeof:v$2,render:h}};react_production_min.isValidElement=O$1;react_production_min.lazy=function(h){return{$$typeof:y,_payload:{_status:-1,_result:h},_init:T$1}};react_production_min.memo=function(h,o){return{$$typeof:x,type:h,compare:o===void 0?null:o}};react_production_min.startTransition=function(h){var o=V$1.transition;V$1.transition={};try{h()}finally{V$1.transition=o}};react_production_min.unstable_act=X$1;react_production_min.useCallback=function(h,o){return U$1.current.useCallback(h,o)};react_production_min.useContext=function(h){return U$1.current.useContext(h)};react_production_min.useDebugValue=function(){};react_production_min.useDeferredValue=function(h){return U$1.current.useDeferredValue(h)};react_production_min.useEffect=function(h,o){return U$1.current.useEffect(h,o)};react_production_min.useId=function(){return U$1.current.useId()};react_production_min.useImperativeHandle=function(h,o,c){return U$1.current.useImperativeHandle(h,o,c)};react_production_min.useInsertionEffect=function(h,o){return U$1.current.useInsertionEffect(h,o)};react_production_min.useLayoutEffect=function(h,o){return U$1.current.useLayoutEffect(h,o)};react_production_min.useMemo=function(h,o){return U$1.current.useMemo(h,o)};react_production_min.useReducer=function(h,o,c){return U$1.current.useReducer(h,o,c)};react_production_min.useRef=function(h){return U$1.current.useRef(h)};react_production_min.useState=function(h){return U$1.current.useState(h)};react_production_min.useSyncExternalStore=function(h,o,c){return U$1.current.useSyncExternalStore(h,o,c)};react_production_min.useTransition=function(){return U$1.current.useTransition()};react_production_min.version="18.3.1";react.exports=react_production_min;var reactExports=react.exports;/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var f=reactExports,k=Symbol.for("react.element"),l=Symbol.for("react.fragment"),m$1=Object.prototype.hasOwnProperty,n=f.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,p$1={key:!0,ref:!0,__self:!0,__source:!0};function q(h,o,c){var d,_={},b=null,_e=null;c!==void 0&&(b=""+c),o.key!==void 0&&(b=""+o.key),o.ref!==void 0&&(_e=o.ref);for(d in o)m$1.call(o,d)&&!p$1.hasOwnProperty(d)&&(_[d]=o[d]);if(h&&h.defaultProps)for(d in o=h.defaultProps,o)_[d]===void 0&&(_[d]=o[d]);return{$$typeof:k,type:h,key:b,ref:_e,props:_,_owner:n.current}}reactJsxRuntime_production_min.Fragment=l;reactJsxRuntime_production_min.jsx=q;reactJsxRuntime_production_min.jsxs=q;jsxRuntime.exports=reactJsxRuntime_production_min;var jsxRuntimeExports=jsxRuntime.exports,client={},reactDom={exports:{}},reactDom_production_min={},scheduler={exports:{}},scheduler_production_min={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(h){function o(dr,pr){var ur=dr.length;dr.push(pr);e:for(;0<ur;){var xr=ur-1>>>1,vr=dr[xr];if(0<_(vr,pr))dr[xr]=pr,dr[ur]=vr,ur=xr;else break e}}function c(dr){return dr.length===0?null:dr[0]}function d(dr){if(dr.length===0)return null;var pr=dr[0],ur=dr.pop();if(ur!==pr){dr[0]=ur;e:for(var xr=0,vr=dr.length,Dr=vr>>>1;xr<Dr;){var _r=2*(xr+1)-1,rr=dr[_r],mr=_r+1,Rr=dr[mr];if(0>_(rr,ur))mr<vr&&0>_(Rr,rr)?(dr[xr]=Rr,dr[mr]=ur,xr=mr):(dr[xr]=rr,dr[_r]=ur,xr=_r);else if(mr<vr&&0>_(Rr,ur))dr[xr]=Rr,dr[mr]=ur,xr=mr;else break e}}return pr}function _(dr,pr){var ur=dr.sortIndex-pr.sortIndex;return ur!==0?ur:dr.id-pr.id}if(typeof performance=="object"&&typeof performance.now=="function"){var b=performance;h.unstable_now=function(){return b.now()}}else{var _e=Date,it=_e.now();h.unstable_now=function(){return _e.now()-it}}var nt=[],at=[],ut=1,pt=null,mt=3,ft=!1,vt=!1,xt=!1,At=typeof setTimeout=="function"?setTimeout:null,Ct=typeof clearTimeout=="function"?clearTimeout:null,Et=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function Tt(dr){for(var pr=c(at);pr!==null;){if(pr.callback===null)d(at);else if(pr.startTime<=dr)d(at),pr.sortIndex=pr.expirationTime,o(nt,pr);else break;pr=c(at)}}function kt(dr){if(xt=!1,Tt(dr),!vt)if(c(nt)!==null)vt=!0,lr(Dt);else{var pr=c(at);pr!==null&&hr(kt,pr.startTime-dr)}}function Dt(dr,pr){vt=!1,xt&&(xt=!1,Ct(Rt),Rt=-1),ft=!0;var ur=mt;try{for(Tt(pr),pt=c(nt);pt!==null&&(!(pt.expirationTime>pr)||dr&&!Jt());){var xr=pt.callback;if(typeof xr=="function"){pt.callback=null,mt=pt.priorityLevel;var vr=xr(pt.expirationTime<=pr);pr=h.unstable_now(),typeof vr=="function"?pt.callback=vr:pt===c(nt)&&d(nt),Tt(pr)}else d(nt);pt=c(nt)}if(pt!==null)var Dr=!0;else{var _r=c(at);_r!==null&&hr(kt,_r.startTime-pr),Dr=!1}return Dr}finally{pt=null,mt=ur,ft=!1}}var zt=!1,Bt=null,Rt=-1,Ut=5,Ht=-1;function Jt(){return!(h.unstable_now()-Ht<Ut)}function Kt(){if(Bt!==null){var dr=h.unstable_now();Ht=dr;var pr=!0;try{pr=Bt(!0,dr)}finally{pr?sr():(zt=!1,Bt=null)}}else zt=!1}var sr;if(typeof Et=="function")sr=function(){Et(Kt)};else if(typeof MessageChannel<"u"){var ir=new MessageChannel,cr=ir.port2;ir.port1.onmessage=Kt,sr=function(){cr.postMessage(null)}}else sr=function(){At(Kt,0)};function lr(dr){Bt=dr,zt||(zt=!0,sr())}function hr(dr,pr){Rt=At(function(){dr(h.unstable_now())},pr)}h.unstable_IdlePriority=5,h.unstable_ImmediatePriority=1,h.unstable_LowPriority=4,h.unstable_NormalPriority=3,h.unstable_Profiling=null,h.unstable_UserBlockingPriority=2,h.unstable_cancelCallback=function(dr){dr.callback=null},h.unstable_continueExecution=function(){vt||ft||(vt=!0,lr(Dt))},h.unstable_forceFrameRate=function(dr){0>dr||125<dr?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Ut=0<dr?Math.floor(1e3/dr):5},h.unstable_getCurrentPriorityLevel=function(){return mt},h.unstable_getFirstCallbackNode=function(){return c(nt)},h.unstable_next=function(dr){switch(mt){case 1:case 2:case 3:var pr=3;break;default:pr=mt}var ur=mt;mt=pr;try{return dr()}finally{mt=ur}},h.unstable_pauseExecution=function(){},h.unstable_requestPaint=function(){},h.unstable_runWithPriority=function(dr,pr){switch(dr){case 1:case 2:case 3:case 4:case 5:break;default:dr=3}var ur=mt;mt=dr;try{return pr()}finally{mt=ur}},h.unstable_scheduleCallback=function(dr,pr,ur){var xr=h.unstable_now();switch(typeof ur=="object"&&ur!==null?(ur=ur.delay,ur=typeof ur=="number"&&0<ur?xr+ur:xr):ur=xr,dr){case 1:var vr=-1;break;case 2:vr=250;break;case 5:vr=1073741823;break;case 4:vr=1e4;break;default:vr=5e3}return vr=ur+vr,dr={id:ut++,callback:pr,priorityLevel:dr,startTime:ur,expirationTime:vr,sortIndex:-1},ur>xr?(dr.sortIndex=ur,o(at,dr),c(nt)===null&&dr===c(at)&&(xt?(Ct(Rt),Rt=-1):xt=!0,hr(kt,ur-xr))):(dr.sortIndex=vr,o(nt,dr),vt||ft||(vt=!0,lr(Dt))),dr},h.unstable_shouldYield=Jt,h.unstable_wrapCallback=function(dr){var pr=mt;return function(){var ur=mt;mt=pr;try{return dr.apply(this,arguments)}finally{mt=ur}}}})(scheduler_production_min);scheduler.exports=scheduler_production_min;var schedulerExports=scheduler.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var aa=reactExports,ca=schedulerExports;function p(h){for(var o="https://reactjs.org/docs/error-decoder.html?invariant="+h,c=1;c<arguments.length;c++)o+="&args[]="+encodeURIComponent(arguments[c]);return"Minified React error #"+h+"; visit "+o+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var da=new Set,ea={};function fa(h,o){ha(h,o),ha(h+"Capture",o)}function ha(h,o){for(ea[h]=o,h=0;h<o.length;h++)da.add(o[h])}var ia=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),ja=Object.prototype.hasOwnProperty,ka=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,la={},ma={};function oa(h){return ja.call(ma,h)?!0:ja.call(la,h)?!1:ka.test(h)?ma[h]=!0:(la[h]=!0,!1)}function pa(h,o,c,d){if(c!==null&&c.type===0)return!1;switch(typeof o){case"function":case"symbol":return!0;case"boolean":return d?!1:c!==null?!c.acceptsBooleans:(h=h.toLowerCase().slice(0,5),h!=="data-"&&h!=="aria-");default:return!1}}function qa(h,o,c,d){if(o===null||typeof o>"u"||pa(h,o,c,d))return!0;if(d)return!1;if(c!==null)switch(c.type){case 3:return!o;case 4:return o===!1;case 5:return isNaN(o);case 6:return isNaN(o)||1>o}return!1}function v$1(h,o,c,d,_,b,_e){this.acceptsBooleans=o===2||o===3||o===4,this.attributeName=d,this.attributeNamespace=_,this.mustUseProperty=c,this.propertyName=h,this.type=o,this.sanitizeURL=b,this.removeEmptyString=_e}var z={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(h){z[h]=new v$1(h,0,!1,h,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(h){var o=h[0];z[o]=new v$1(o,1,!1,h[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(h){z[h]=new v$1(h,2,!1,h.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(h){z[h]=new v$1(h,2,!1,h,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(h){z[h]=new v$1(h,3,!1,h.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(h){z[h]=new v$1(h,3,!0,h,null,!1,!1)});["capture","download"].forEach(function(h){z[h]=new v$1(h,4,!1,h,null,!1,!1)});["cols","rows","size","span"].forEach(function(h){z[h]=new v$1(h,6,!1,h,null,!1,!1)});["rowSpan","start"].forEach(function(h){z[h]=new v$1(h,5,!1,h.toLowerCase(),null,!1,!1)});var ra=/[\-:]([a-z])/g;function sa(h){return h[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(h){var o=h.replace(ra,sa);z[o]=new v$1(o,1,!1,h,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(h){var o=h.replace(ra,sa);z[o]=new v$1(o,1,!1,h,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(h){var o=h.replace(ra,sa);z[o]=new v$1(o,1,!1,h,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(h){z[h]=new v$1(h,1,!1,h.toLowerCase(),null,!1,!1)});z.xlinkHref=new v$1("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(h){z[h]=new v$1(h,1,!1,h.toLowerCase(),null,!0,!0)});function ta(h,o,c,d){var _=z.hasOwnProperty(o)?z[o]:null;(_!==null?_.type!==0:d||!(2<o.length)||o[0]!=="o"&&o[0]!=="O"||o[1]!=="n"&&o[1]!=="N")&&(qa(o,c,_,d)&&(c=null),d||_===null?oa(o)&&(c===null?h.removeAttribute(o):h.setAttribute(o,""+c)):_.mustUseProperty?h[_.propertyName]=c===null?_.type===3?!1:"":c:(o=_.attributeName,d=_.attributeNamespace,c===null?h.removeAttribute(o):(_=_.type,c=_===3||_===4&&c===!0?"":""+c,d?h.setAttributeNS(d,o,c):h.setAttribute(o,c))))}var ua=aa.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,va=Symbol.for("react.element"),wa=Symbol.for("react.portal"),ya=Symbol.for("react.fragment"),za=Symbol.for("react.strict_mode"),Aa=Symbol.for("react.profiler"),Ba=Symbol.for("react.provider"),Ca=Symbol.for("react.context"),Da=Symbol.for("react.forward_ref"),Ea=Symbol.for("react.suspense"),Fa=Symbol.for("react.suspense_list"),Ga=Symbol.for("react.memo"),Ha=Symbol.for("react.lazy"),Ia=Symbol.for("react.offscreen"),Ja=Symbol.iterator;function Ka(h){return h===null||typeof h!="object"?null:(h=Ja&&h[Ja]||h["@@iterator"],typeof h=="function"?h:null)}var A=Object.assign,La;function Ma(h){if(La===void 0)try{throw Error()}catch(c){var o=c.stack.trim().match(/\n( *(at )?)/);La=o&&o[1]||""}return`
`+La+h}var Na=!1;function Oa(h,o){if(!h||Na)return"";Na=!0;var c=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(o)if(o=function(){throw Error()},Object.defineProperty(o.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(o,[])}catch(at){var d=at}Reflect.construct(h,[],o)}else{try{o.call()}catch(at){d=at}h.call(o.prototype)}else{try{throw Error()}catch(at){d=at}h()}}catch(at){if(at&&d&&typeof at.stack=="string"){for(var _=at.stack.split(`
`),b=d.stack.split(`
`),_e=_.length-1,it=b.length-1;1<=_e&&0<=it&&_[_e]!==b[it];)it--;for(;1<=_e&&0<=it;_e--,it--)if(_[_e]!==b[it]){if(_e!==1||it!==1)do if(_e--,it--,0>it||_[_e]!==b[it]){var nt=`
`+_[_e].replace(" at new "," at ");return h.displayName&&nt.includes("<anonymous>")&&(nt=nt.replace("<anonymous>",h.displayName)),nt}while(1<=_e&&0<=it);break}}}finally{Na=!1,Error.prepareStackTrace=c}return(h=h?h.displayName||h.name:"")?Ma(h):""}function Pa(h){switch(h.tag){case 5:return Ma(h.type);case 16:return Ma("Lazy");case 13:return Ma("Suspense");case 19:return Ma("SuspenseList");case 0:case 2:case 15:return h=Oa(h.type,!1),h;case 11:return h=Oa(h.type.render,!1),h;case 1:return h=Oa(h.type,!0),h;default:return""}}function Qa(h){if(h==null)return null;if(typeof h=="function")return h.displayName||h.name||null;if(typeof h=="string")return h;switch(h){case ya:return"Fragment";case wa:return"Portal";case Aa:return"Profiler";case za:return"StrictMode";case Ea:return"Suspense";case Fa:return"SuspenseList"}if(typeof h=="object")switch(h.$$typeof){case Ca:return(h.displayName||"Context")+".Consumer";case Ba:return(h._context.displayName||"Context")+".Provider";case Da:var o=h.render;return h=h.displayName,h||(h=o.displayName||o.name||"",h=h!==""?"ForwardRef("+h+")":"ForwardRef"),h;case Ga:return o=h.displayName||null,o!==null?o:Qa(h.type)||"Memo";case Ha:o=h._payload,h=h._init;try{return Qa(h(o))}catch{}}return null}function Ra(h){var o=h.type;switch(h.tag){case 24:return"Cache";case 9:return(o.displayName||"Context")+".Consumer";case 10:return(o._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return h=o.render,h=h.displayName||h.name||"",o.displayName||(h!==""?"ForwardRef("+h+")":"ForwardRef");case 7:return"Fragment";case 5:return o;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Qa(o);case 8:return o===za?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof o=="function")return o.displayName||o.name||null;if(typeof o=="string")return o}return null}function Sa(h){switch(typeof h){case"boolean":case"number":case"string":case"undefined":return h;case"object":return h;default:return""}}function Ta(h){var o=h.type;return(h=h.nodeName)&&h.toLowerCase()==="input"&&(o==="checkbox"||o==="radio")}function Ua(h){var o=Ta(h)?"checked":"value",c=Object.getOwnPropertyDescriptor(h.constructor.prototype,o),d=""+h[o];if(!h.hasOwnProperty(o)&&typeof c<"u"&&typeof c.get=="function"&&typeof c.set=="function"){var _=c.get,b=c.set;return Object.defineProperty(h,o,{configurable:!0,get:function(){return _.call(this)},set:function(_e){d=""+_e,b.call(this,_e)}}),Object.defineProperty(h,o,{enumerable:c.enumerable}),{getValue:function(){return d},setValue:function(_e){d=""+_e},stopTracking:function(){h._valueTracker=null,delete h[o]}}}}function Va(h){h._valueTracker||(h._valueTracker=Ua(h))}function Wa(h){if(!h)return!1;var o=h._valueTracker;if(!o)return!0;var c=o.getValue(),d="";return h&&(d=Ta(h)?h.checked?"true":"false":h.value),h=d,h!==c?(o.setValue(h),!0):!1}function Xa(h){if(h=h||(typeof document<"u"?document:void 0),typeof h>"u")return null;try{return h.activeElement||h.body}catch{return h.body}}function Ya(h,o){var c=o.checked;return A({},o,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:c??h._wrapperState.initialChecked})}function Za(h,o){var c=o.defaultValue==null?"":o.defaultValue,d=o.checked!=null?o.checked:o.defaultChecked;c=Sa(o.value!=null?o.value:c),h._wrapperState={initialChecked:d,initialValue:c,controlled:o.type==="checkbox"||o.type==="radio"?o.checked!=null:o.value!=null}}function ab(h,o){o=o.checked,o!=null&&ta(h,"checked",o,!1)}function bb(h,o){ab(h,o);var c=Sa(o.value),d=o.type;if(c!=null)d==="number"?(c===0&&h.value===""||h.value!=c)&&(h.value=""+c):h.value!==""+c&&(h.value=""+c);else if(d==="submit"||d==="reset"){h.removeAttribute("value");return}o.hasOwnProperty("value")?cb(h,o.type,c):o.hasOwnProperty("defaultValue")&&cb(h,o.type,Sa(o.defaultValue)),o.checked==null&&o.defaultChecked!=null&&(h.defaultChecked=!!o.defaultChecked)}function db(h,o,c){if(o.hasOwnProperty("value")||o.hasOwnProperty("defaultValue")){var d=o.type;if(!(d!=="submit"&&d!=="reset"||o.value!==void 0&&o.value!==null))return;o=""+h._wrapperState.initialValue,c||o===h.value||(h.value=o),h.defaultValue=o}c=h.name,c!==""&&(h.name=""),h.defaultChecked=!!h._wrapperState.initialChecked,c!==""&&(h.name=c)}function cb(h,o,c){(o!=="number"||Xa(h.ownerDocument)!==h)&&(c==null?h.defaultValue=""+h._wrapperState.initialValue:h.defaultValue!==""+c&&(h.defaultValue=""+c))}var eb=Array.isArray;function fb(h,o,c,d){if(h=h.options,o){o={};for(var _=0;_<c.length;_++)o["$"+c[_]]=!0;for(c=0;c<h.length;c++)_=o.hasOwnProperty("$"+h[c].value),h[c].selected!==_&&(h[c].selected=_),_&&d&&(h[c].defaultSelected=!0)}else{for(c=""+Sa(c),o=null,_=0;_<h.length;_++){if(h[_].value===c){h[_].selected=!0,d&&(h[_].defaultSelected=!0);return}o!==null||h[_].disabled||(o=h[_])}o!==null&&(o.selected=!0)}}function gb(h,o){if(o.dangerouslySetInnerHTML!=null)throw Error(p(91));return A({},o,{value:void 0,defaultValue:void 0,children:""+h._wrapperState.initialValue})}function hb(h,o){var c=o.value;if(c==null){if(c=o.children,o=o.defaultValue,c!=null){if(o!=null)throw Error(p(92));if(eb(c)){if(1<c.length)throw Error(p(93));c=c[0]}o=c}o==null&&(o=""),c=o}h._wrapperState={initialValue:Sa(c)}}function ib(h,o){var c=Sa(o.value),d=Sa(o.defaultValue);c!=null&&(c=""+c,c!==h.value&&(h.value=c),o.defaultValue==null&&h.defaultValue!==c&&(h.defaultValue=c)),d!=null&&(h.defaultValue=""+d)}function jb(h){var o=h.textContent;o===h._wrapperState.initialValue&&o!==""&&o!==null&&(h.value=o)}function kb(h){switch(h){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function lb(h,o){return h==null||h==="http://www.w3.org/1999/xhtml"?kb(o):h==="http://www.w3.org/2000/svg"&&o==="foreignObject"?"http://www.w3.org/1999/xhtml":h}var mb,nb=function(h){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(o,c,d,_){MSApp.execUnsafeLocalFunction(function(){return h(o,c,d,_)})}:h}(function(h,o){if(h.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in h)h.innerHTML=o;else{for(mb=mb||document.createElement("div"),mb.innerHTML="<svg>"+o.valueOf().toString()+"</svg>",o=mb.firstChild;h.firstChild;)h.removeChild(h.firstChild);for(;o.firstChild;)h.appendChild(o.firstChild)}});function ob(h,o){if(o){var c=h.firstChild;if(c&&c===h.lastChild&&c.nodeType===3){c.nodeValue=o;return}}h.textContent=o}var pb={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},qb=["Webkit","ms","Moz","O"];Object.keys(pb).forEach(function(h){qb.forEach(function(o){o=o+h.charAt(0).toUpperCase()+h.substring(1),pb[o]=pb[h]})});function rb(h,o,c){return o==null||typeof o=="boolean"||o===""?"":c||typeof o!="number"||o===0||pb.hasOwnProperty(h)&&pb[h]?(""+o).trim():o+"px"}function sb(h,o){h=h.style;for(var c in o)if(o.hasOwnProperty(c)){var d=c.indexOf("--")===0,_=rb(c,o[c],d);c==="float"&&(c="cssFloat"),d?h.setProperty(c,_):h[c]=_}}var tb=A({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ub(h,o){if(o){if(tb[h]&&(o.children!=null||o.dangerouslySetInnerHTML!=null))throw Error(p(137,h));if(o.dangerouslySetInnerHTML!=null){if(o.children!=null)throw Error(p(60));if(typeof o.dangerouslySetInnerHTML!="object"||!("__html"in o.dangerouslySetInnerHTML))throw Error(p(61))}if(o.style!=null&&typeof o.style!="object")throw Error(p(62))}}function vb(h,o){if(h.indexOf("-")===-1)return typeof o.is=="string";switch(h){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var wb=null;function xb(h){return h=h.target||h.srcElement||window,h.correspondingUseElement&&(h=h.correspondingUseElement),h.nodeType===3?h.parentNode:h}var yb=null,zb=null,Ab=null;function Bb(h){if(h=Cb(h)){if(typeof yb!="function")throw Error(p(280));var o=h.stateNode;o&&(o=Db(o),yb(h.stateNode,h.type,o))}}function Eb(h){zb?Ab?Ab.push(h):Ab=[h]:zb=h}function Fb(){if(zb){var h=zb,o=Ab;if(Ab=zb=null,Bb(h),o)for(h=0;h<o.length;h++)Bb(o[h])}}function Gb(h,o){return h(o)}function Hb(){}var Ib=!1;function Jb(h,o,c){if(Ib)return h(o,c);Ib=!0;try{return Gb(h,o,c)}finally{Ib=!1,(zb!==null||Ab!==null)&&(Hb(),Fb())}}function Kb(h,o){var c=h.stateNode;if(c===null)return null;var d=Db(c);if(d===null)return null;c=d[o];e:switch(o){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(d=!d.disabled)||(h=h.type,d=!(h==="button"||h==="input"||h==="select"||h==="textarea")),h=!d;break e;default:h=!1}if(h)return null;if(c&&typeof c!="function")throw Error(p(231,o,typeof c));return c}var Lb=!1;if(ia)try{var Mb={};Object.defineProperty(Mb,"passive",{get:function(){Lb=!0}}),window.addEventListener("test",Mb,Mb),window.removeEventListener("test",Mb,Mb)}catch(h){Lb=!1}function Nb(h,o,c,d,_,b,_e,it,nt){var at=Array.prototype.slice.call(arguments,3);try{o.apply(c,at)}catch(ut){this.onError(ut)}}var Ob=!1,Pb=null,Qb=!1,Rb=null,Sb={onError:function(h){Ob=!0,Pb=h}};function Tb(h,o,c,d,_,b,_e,it,nt){Ob=!1,Pb=null,Nb.apply(Sb,arguments)}function Ub(h,o,c,d,_,b,_e,it,nt){if(Tb.apply(this,arguments),Ob){if(Ob){var at=Pb;Ob=!1,Pb=null}else throw Error(p(198));Qb||(Qb=!0,Rb=at)}}function Vb(h){var o=h,c=h;if(h.alternate)for(;o.return;)o=o.return;else{h=o;do o=h,o.flags&4098&&(c=o.return),h=o.return;while(h)}return o.tag===3?c:null}function Wb(h){if(h.tag===13){var o=h.memoizedState;if(o===null&&(h=h.alternate,h!==null&&(o=h.memoizedState)),o!==null)return o.dehydrated}return null}function Xb(h){if(Vb(h)!==h)throw Error(p(188))}function Yb(h){var o=h.alternate;if(!o){if(o=Vb(h),o===null)throw Error(p(188));return o!==h?null:h}for(var c=h,d=o;;){var _=c.return;if(_===null)break;var b=_.alternate;if(b===null){if(d=_.return,d!==null){c=d;continue}break}if(_.child===b.child){for(b=_.child;b;){if(b===c)return Xb(_),h;if(b===d)return Xb(_),o;b=b.sibling}throw Error(p(188))}if(c.return!==d.return)c=_,d=b;else{for(var _e=!1,it=_.child;it;){if(it===c){_e=!0,c=_,d=b;break}if(it===d){_e=!0,d=_,c=b;break}it=it.sibling}if(!_e){for(it=b.child;it;){if(it===c){_e=!0,c=b,d=_;break}if(it===d){_e=!0,d=b,c=_;break}it=it.sibling}if(!_e)throw Error(p(189))}}if(c.alternate!==d)throw Error(p(190))}if(c.tag!==3)throw Error(p(188));return c.stateNode.current===c?h:o}function Zb(h){return h=Yb(h),h!==null?$b(h):null}function $b(h){if(h.tag===5||h.tag===6)return h;for(h=h.child;h!==null;){var o=$b(h);if(o!==null)return o;h=h.sibling}return null}var ac=ca.unstable_scheduleCallback,bc=ca.unstable_cancelCallback,cc=ca.unstable_shouldYield,dc=ca.unstable_requestPaint,B=ca.unstable_now,ec=ca.unstable_getCurrentPriorityLevel,fc=ca.unstable_ImmediatePriority,gc=ca.unstable_UserBlockingPriority,hc=ca.unstable_NormalPriority,ic=ca.unstable_LowPriority,jc=ca.unstable_IdlePriority,kc=null,lc=null;function mc(h){if(lc&&typeof lc.onCommitFiberRoot=="function")try{lc.onCommitFiberRoot(kc,h,void 0,(h.current.flags&128)===128)}catch{}}var oc=Math.clz32?Math.clz32:nc,pc=Math.log,qc=Math.LN2;function nc(h){return h>>>=0,h===0?32:31-(pc(h)/qc|0)|0}var rc=64,sc=4194304;function tc(h){switch(h&-h){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return h&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return h&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return h}}function uc(h,o){var c=h.pendingLanes;if(c===0)return 0;var d=0,_=h.suspendedLanes,b=h.pingedLanes,_e=c&268435455;if(_e!==0){var it=_e&~_;it!==0?d=tc(it):(b&=_e,b!==0&&(d=tc(b)))}else _e=c&~_,_e!==0?d=tc(_e):b!==0&&(d=tc(b));if(d===0)return 0;if(o!==0&&o!==d&&!(o&_)&&(_=d&-d,b=o&-o,_>=b||_===16&&(b&4194240)!==0))return o;if(d&4&&(d|=c&16),o=h.entangledLanes,o!==0)for(h=h.entanglements,o&=d;0<o;)c=31-oc(o),_=1<<c,d|=h[c],o&=~_;return d}function vc(h,o){switch(h){case 1:case 2:case 4:return o+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return o+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function wc(h,o){for(var c=h.suspendedLanes,d=h.pingedLanes,_=h.expirationTimes,b=h.pendingLanes;0<b;){var _e=31-oc(b),it=1<<_e,nt=_[_e];nt===-1?(!(it&c)||it&d)&&(_[_e]=vc(it,o)):nt<=o&&(h.expiredLanes|=it),b&=~it}}function xc(h){return h=h.pendingLanes&-1073741825,h!==0?h:h&1073741824?1073741824:0}function yc(){var h=rc;return rc<<=1,!(rc&4194240)&&(rc=64),h}function zc(h){for(var o=[],c=0;31>c;c++)o.push(h);return o}function Ac(h,o,c){h.pendingLanes|=o,o!==536870912&&(h.suspendedLanes=0,h.pingedLanes=0),h=h.eventTimes,o=31-oc(o),h[o]=c}function Bc(h,o){var c=h.pendingLanes&~o;h.pendingLanes=o,h.suspendedLanes=0,h.pingedLanes=0,h.expiredLanes&=o,h.mutableReadLanes&=o,h.entangledLanes&=o,o=h.entanglements;var d=h.eventTimes;for(h=h.expirationTimes;0<c;){var _=31-oc(c),b=1<<_;o[_]=0,d[_]=-1,h[_]=-1,c&=~b}}function Cc(h,o){var c=h.entangledLanes|=o;for(h=h.entanglements;c;){var d=31-oc(c),_=1<<d;_&o|h[d]&o&&(h[d]|=o),c&=~_}}var C=0;function Dc(h){return h&=-h,1<h?4<h?h&268435455?16:536870912:4:1}var Ec,Fc,Gc,Hc,Ic,Jc=!1,Kc=[],Lc=null,Mc=null,Nc=null,Oc=new Map,Pc=new Map,Qc=[],Rc="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Sc(h,o){switch(h){case"focusin":case"focusout":Lc=null;break;case"dragenter":case"dragleave":Mc=null;break;case"mouseover":case"mouseout":Nc=null;break;case"pointerover":case"pointerout":Oc.delete(o.pointerId);break;case"gotpointercapture":case"lostpointercapture":Pc.delete(o.pointerId)}}function Tc(h,o,c,d,_,b){return h===null||h.nativeEvent!==b?(h={blockedOn:o,domEventName:c,eventSystemFlags:d,nativeEvent:b,targetContainers:[_]},o!==null&&(o=Cb(o),o!==null&&Fc(o)),h):(h.eventSystemFlags|=d,o=h.targetContainers,_!==null&&o.indexOf(_)===-1&&o.push(_),h)}function Uc(h,o,c,d,_){switch(o){case"focusin":return Lc=Tc(Lc,h,o,c,d,_),!0;case"dragenter":return Mc=Tc(Mc,h,o,c,d,_),!0;case"mouseover":return Nc=Tc(Nc,h,o,c,d,_),!0;case"pointerover":var b=_.pointerId;return Oc.set(b,Tc(Oc.get(b)||null,h,o,c,d,_)),!0;case"gotpointercapture":return b=_.pointerId,Pc.set(b,Tc(Pc.get(b)||null,h,o,c,d,_)),!0}return!1}function Vc(h){var o=Wc(h.target);if(o!==null){var c=Vb(o);if(c!==null){if(o=c.tag,o===13){if(o=Wb(c),o!==null){h.blockedOn=o,Ic(h.priority,function(){Gc(c)});return}}else if(o===3&&c.stateNode.current.memoizedState.isDehydrated){h.blockedOn=c.tag===3?c.stateNode.containerInfo:null;return}}}h.blockedOn=null}function Xc(h){if(h.blockedOn!==null)return!1;for(var o=h.targetContainers;0<o.length;){var c=Yc(h.domEventName,h.eventSystemFlags,o[0],h.nativeEvent);if(c===null){c=h.nativeEvent;var d=new c.constructor(c.type,c);wb=d,c.target.dispatchEvent(d),wb=null}else return o=Cb(c),o!==null&&Fc(o),h.blockedOn=c,!1;o.shift()}return!0}function Zc(h,o,c){Xc(h)&&c.delete(o)}function $c(){Jc=!1,Lc!==null&&Xc(Lc)&&(Lc=null),Mc!==null&&Xc(Mc)&&(Mc=null),Nc!==null&&Xc(Nc)&&(Nc=null),Oc.forEach(Zc),Pc.forEach(Zc)}function ad(h,o){h.blockedOn===o&&(h.blockedOn=null,Jc||(Jc=!0,ca.unstable_scheduleCallback(ca.unstable_NormalPriority,$c)))}function bd(h){function o(_){return ad(_,h)}if(0<Kc.length){ad(Kc[0],h);for(var c=1;c<Kc.length;c++){var d=Kc[c];d.blockedOn===h&&(d.blockedOn=null)}}for(Lc!==null&&ad(Lc,h),Mc!==null&&ad(Mc,h),Nc!==null&&ad(Nc,h),Oc.forEach(o),Pc.forEach(o),c=0;c<Qc.length;c++)d=Qc[c],d.blockedOn===h&&(d.blockedOn=null);for(;0<Qc.length&&(c=Qc[0],c.blockedOn===null);)Vc(c),c.blockedOn===null&&Qc.shift()}var cd=ua.ReactCurrentBatchConfig,dd=!0;function ed(h,o,c,d){var _=C,b=cd.transition;cd.transition=null;try{C=1,fd(h,o,c,d)}finally{C=_,cd.transition=b}}function gd(h,o,c,d){var _=C,b=cd.transition;cd.transition=null;try{C=4,fd(h,o,c,d)}finally{C=_,cd.transition=b}}function fd(h,o,c,d){if(dd){var _=Yc(h,o,c,d);if(_===null)hd(h,o,d,id$2,c),Sc(h,d);else if(Uc(_,h,o,c,d))d.stopPropagation();else if(Sc(h,d),o&4&&-1<Rc.indexOf(h)){for(;_!==null;){var b=Cb(_);if(b!==null&&Ec(b),b=Yc(h,o,c,d),b===null&&hd(h,o,d,id$2,c),b===_)break;_=b}_!==null&&d.stopPropagation()}else hd(h,o,d,null,c)}}var id$2=null;function Yc(h,o,c,d){if(id$2=null,h=xb(d),h=Wc(h),h!==null)if(o=Vb(h),o===null)h=null;else if(c=o.tag,c===13){if(h=Wb(o),h!==null)return h;h=null}else if(c===3){if(o.stateNode.current.memoizedState.isDehydrated)return o.tag===3?o.stateNode.containerInfo:null;h=null}else o!==h&&(h=null);return id$2=h,null}function jd(h){switch(h){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(ec()){case fc:return 1;case gc:return 4;case hc:case ic:return 16;case jc:return 536870912;default:return 16}default:return 16}}var kd=null,ld=null,md=null;function nd(){if(md)return md;var h,o=ld,c=o.length,d,_="value"in kd?kd.value:kd.textContent,b=_.length;for(h=0;h<c&&o[h]===_[h];h++);var _e=c-h;for(d=1;d<=_e&&o[c-d]===_[b-d];d++);return md=_.slice(h,1<d?1-d:void 0)}function od(h){var o=h.keyCode;return"charCode"in h?(h=h.charCode,h===0&&o===13&&(h=13)):h=o,h===10&&(h=13),32<=h||h===13?h:0}function pd(){return!0}function qd(){return!1}function rd(h){function o(c,d,_,b,_e){this._reactName=c,this._targetInst=_,this.type=d,this.nativeEvent=b,this.target=_e,this.currentTarget=null;for(var it in h)h.hasOwnProperty(it)&&(c=h[it],this[it]=c?c(b):b[it]);return this.isDefaultPrevented=(b.defaultPrevented!=null?b.defaultPrevented:b.returnValue===!1)?pd:qd,this.isPropagationStopped=qd,this}return A(o.prototype,{preventDefault:function(){this.defaultPrevented=!0;var c=this.nativeEvent;c&&(c.preventDefault?c.preventDefault():typeof c.returnValue!="unknown"&&(c.returnValue=!1),this.isDefaultPrevented=pd)},stopPropagation:function(){var c=this.nativeEvent;c&&(c.stopPropagation?c.stopPropagation():typeof c.cancelBubble!="unknown"&&(c.cancelBubble=!0),this.isPropagationStopped=pd)},persist:function(){},isPersistent:pd}),o}var sd={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(h){return h.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},td=rd(sd),ud=A({},sd,{view:0,detail:0}),vd=rd(ud),wd,xd,yd,Ad=A({},ud,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:zd,button:0,buttons:0,relatedTarget:function(h){return h.relatedTarget===void 0?h.fromElement===h.srcElement?h.toElement:h.fromElement:h.relatedTarget},movementX:function(h){return"movementX"in h?h.movementX:(h!==yd&&(yd&&h.type==="mousemove"?(wd=h.screenX-yd.screenX,xd=h.screenY-yd.screenY):xd=wd=0,yd=h),wd)},movementY:function(h){return"movementY"in h?h.movementY:xd}}),Bd=rd(Ad),Cd=A({},Ad,{dataTransfer:0}),Dd=rd(Cd),Ed=A({},ud,{relatedTarget:0}),Fd=rd(Ed),Gd=A({},sd,{animationName:0,elapsedTime:0,pseudoElement:0}),Hd=rd(Gd),Id=A({},sd,{clipboardData:function(h){return"clipboardData"in h?h.clipboardData:window.clipboardData}}),Jd=rd(Id),Kd=A({},sd,{data:0}),Ld=rd(Kd),Md={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Nd={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Od={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Pd(h){var o=this.nativeEvent;return o.getModifierState?o.getModifierState(h):(h=Od[h])?!!o[h]:!1}function zd(){return Pd}var Qd=A({},ud,{key:function(h){if(h.key){var o=Md[h.key]||h.key;if(o!=="Unidentified")return o}return h.type==="keypress"?(h=od(h),h===13?"Enter":String.fromCharCode(h)):h.type==="keydown"||h.type==="keyup"?Nd[h.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:zd,charCode:function(h){return h.type==="keypress"?od(h):0},keyCode:function(h){return h.type==="keydown"||h.type==="keyup"?h.keyCode:0},which:function(h){return h.type==="keypress"?od(h):h.type==="keydown"||h.type==="keyup"?h.keyCode:0}}),Rd=rd(Qd),Sd=A({},Ad,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Td=rd(Sd),Ud=A({},ud,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:zd}),Vd=rd(Ud),Wd=A({},sd,{propertyName:0,elapsedTime:0,pseudoElement:0}),Xd=rd(Wd),Yd=A({},Ad,{deltaX:function(h){return"deltaX"in h?h.deltaX:"wheelDeltaX"in h?-h.wheelDeltaX:0},deltaY:function(h){return"deltaY"in h?h.deltaY:"wheelDeltaY"in h?-h.wheelDeltaY:"wheelDelta"in h?-h.wheelDelta:0},deltaZ:0,deltaMode:0}),Zd=rd(Yd),$d=[9,13,27,32],ae=ia&&"CompositionEvent"in window,be=null;ia&&"documentMode"in document&&(be=document.documentMode);var ce=ia&&"TextEvent"in window&&!be,de=ia&&(!ae||be&&8<be&&11>=be),ee=" ",fe=!1;function ge(h,o){switch(h){case"keyup":return $d.indexOf(o.keyCode)!==-1;case"keydown":return o.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function he(h){return h=h.detail,typeof h=="object"&&"data"in h?h.data:null}var ie=!1;function je(h,o){switch(h){case"compositionend":return he(o);case"keypress":return o.which!==32?null:(fe=!0,ee);case"textInput":return h=o.data,h===ee&&fe?null:h;default:return null}}function ke(h,o){if(ie)return h==="compositionend"||!ae&&ge(h,o)?(h=nd(),md=ld=kd=null,ie=!1,h):null;switch(h){case"paste":return null;case"keypress":if(!(o.ctrlKey||o.altKey||o.metaKey)||o.ctrlKey&&o.altKey){if(o.char&&1<o.char.length)return o.char;if(o.which)return String.fromCharCode(o.which)}return null;case"compositionend":return de&&o.locale!=="ko"?null:o.data;default:return null}}var le={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function me(h){var o=h&&h.nodeName&&h.nodeName.toLowerCase();return o==="input"?!!le[h.type]:o==="textarea"}function ne(h,o,c,d){Eb(d),o=oe(o,"onChange"),0<o.length&&(c=new td("onChange","change",null,c,d),h.push({event:c,listeners:o}))}var pe=null,qe=null;function re(h){se(h,0)}function te(h){var o=ue(h);if(Wa(o))return h}function ve(h,o){if(h==="change")return o}var we=!1;if(ia){var xe;if(ia){var ye="oninput"in document;if(!ye){var ze=document.createElement("div");ze.setAttribute("oninput","return;"),ye=typeof ze.oninput=="function"}xe=ye}else xe=!1;we=xe&&(!document.documentMode||9<document.documentMode)}function Ae(){pe&&(pe.detachEvent("onpropertychange",Be),qe=pe=null)}function Be(h){if(h.propertyName==="value"&&te(qe)){var o=[];ne(o,qe,h,xb(h)),Jb(re,o)}}function Ce(h,o,c){h==="focusin"?(Ae(),pe=o,qe=c,pe.attachEvent("onpropertychange",Be)):h==="focusout"&&Ae()}function De(h){if(h==="selectionchange"||h==="keyup"||h==="keydown")return te(qe)}function Ee(h,o){if(h==="click")return te(o)}function Fe(h,o){if(h==="input"||h==="change")return te(o)}function Ge(h,o){return h===o&&(h!==0||1/h===1/o)||h!==h&&o!==o}var He=typeof Object.is=="function"?Object.is:Ge;function Ie(h,o){if(He(h,o))return!0;if(typeof h!="object"||h===null||typeof o!="object"||o===null)return!1;var c=Object.keys(h),d=Object.keys(o);if(c.length!==d.length)return!1;for(d=0;d<c.length;d++){var _=c[d];if(!ja.call(o,_)||!He(h[_],o[_]))return!1}return!0}function Je(h){for(;h&&h.firstChild;)h=h.firstChild;return h}function Ke(h,o){var c=Je(h);h=0;for(var d;c;){if(c.nodeType===3){if(d=h+c.textContent.length,h<=o&&d>=o)return{node:c,offset:o-h};h=d}e:{for(;c;){if(c.nextSibling){c=c.nextSibling;break e}c=c.parentNode}c=void 0}c=Je(c)}}function Le(h,o){return h&&o?h===o?!0:h&&h.nodeType===3?!1:o&&o.nodeType===3?Le(h,o.parentNode):"contains"in h?h.contains(o):h.compareDocumentPosition?!!(h.compareDocumentPosition(o)&16):!1:!1}function Me(){for(var h=window,o=Xa();o instanceof h.HTMLIFrameElement;){try{var c=typeof o.contentWindow.location.href=="string"}catch{c=!1}if(c)h=o.contentWindow;else break;o=Xa(h.document)}return o}function Ne(h){var o=h&&h.nodeName&&h.nodeName.toLowerCase();return o&&(o==="input"&&(h.type==="text"||h.type==="search"||h.type==="tel"||h.type==="url"||h.type==="password")||o==="textarea"||h.contentEditable==="true")}function Oe(h){var o=Me(),c=h.focusedElem,d=h.selectionRange;if(o!==c&&c&&c.ownerDocument&&Le(c.ownerDocument.documentElement,c)){if(d!==null&&Ne(c)){if(o=d.start,h=d.end,h===void 0&&(h=o),"selectionStart"in c)c.selectionStart=o,c.selectionEnd=Math.min(h,c.value.length);else if(h=(o=c.ownerDocument||document)&&o.defaultView||window,h.getSelection){h=h.getSelection();var _=c.textContent.length,b=Math.min(d.start,_);d=d.end===void 0?b:Math.min(d.end,_),!h.extend&&b>d&&(_=d,d=b,b=_),_=Ke(c,b);var _e=Ke(c,d);_&&_e&&(h.rangeCount!==1||h.anchorNode!==_.node||h.anchorOffset!==_.offset||h.focusNode!==_e.node||h.focusOffset!==_e.offset)&&(o=o.createRange(),o.setStart(_.node,_.offset),h.removeAllRanges(),b>d?(h.addRange(o),h.extend(_e.node,_e.offset)):(o.setEnd(_e.node,_e.offset),h.addRange(o)))}}for(o=[],h=c;h=h.parentNode;)h.nodeType===1&&o.push({element:h,left:h.scrollLeft,top:h.scrollTop});for(typeof c.focus=="function"&&c.focus(),c=0;c<o.length;c++)h=o[c],h.element.scrollLeft=h.left,h.element.scrollTop=h.top}}var Pe=ia&&"documentMode"in document&&11>=document.documentMode,Qe=null,Re=null,Se=null,Te=!1;function Ue(h,o,c){var d=c.window===c?c.document:c.nodeType===9?c:c.ownerDocument;Te||Qe==null||Qe!==Xa(d)||(d=Qe,"selectionStart"in d&&Ne(d)?d={start:d.selectionStart,end:d.selectionEnd}:(d=(d.ownerDocument&&d.ownerDocument.defaultView||window).getSelection(),d={anchorNode:d.anchorNode,anchorOffset:d.anchorOffset,focusNode:d.focusNode,focusOffset:d.focusOffset}),Se&&Ie(Se,d)||(Se=d,d=oe(Re,"onSelect"),0<d.length&&(o=new td("onSelect","select",null,o,c),h.push({event:o,listeners:d}),o.target=Qe)))}function Ve(h,o){var c={};return c[h.toLowerCase()]=o.toLowerCase(),c["Webkit"+h]="webkit"+o,c["Moz"+h]="moz"+o,c}var We={animationend:Ve("Animation","AnimationEnd"),animationiteration:Ve("Animation","AnimationIteration"),animationstart:Ve("Animation","AnimationStart"),transitionend:Ve("Transition","TransitionEnd")},Xe={},Ye={};ia&&(Ye=document.createElement("div").style,"AnimationEvent"in window||(delete We.animationend.animation,delete We.animationiteration.animation,delete We.animationstart.animation),"TransitionEvent"in window||delete We.transitionend.transition);function Ze(h){if(Xe[h])return Xe[h];if(!We[h])return h;var o=We[h],c;for(c in o)if(o.hasOwnProperty(c)&&c in Ye)return Xe[h]=o[c];return h}var $e=Ze("animationend"),af=Ze("animationiteration"),bf=Ze("animationstart"),cf=Ze("transitionend"),df=new Map,ef="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function ff(h,o){df.set(h,o),fa(o,[h])}for(var gf=0;gf<ef.length;gf++){var hf=ef[gf],jf=hf.toLowerCase(),kf=hf[0].toUpperCase()+hf.slice(1);ff(jf,"on"+kf)}ff($e,"onAnimationEnd");ff(af,"onAnimationIteration");ff(bf,"onAnimationStart");ff("dblclick","onDoubleClick");ff("focusin","onFocus");ff("focusout","onBlur");ff(cf,"onTransitionEnd");ha("onMouseEnter",["mouseout","mouseover"]);ha("onMouseLeave",["mouseout","mouseover"]);ha("onPointerEnter",["pointerout","pointerover"]);ha("onPointerLeave",["pointerout","pointerover"]);fa("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));fa("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));fa("onBeforeInput",["compositionend","keypress","textInput","paste"]);fa("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));fa("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));fa("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var lf="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),mf=new Set("cancel close invalid load scroll toggle".split(" ").concat(lf));function nf(h,o,c){var d=h.type||"unknown-event";h.currentTarget=c,Ub(d,o,void 0,h),h.currentTarget=null}function se(h,o){o=(o&4)!==0;for(var c=0;c<h.length;c++){var d=h[c],_=d.event;d=d.listeners;e:{var b=void 0;if(o)for(var _e=d.length-1;0<=_e;_e--){var it=d[_e],nt=it.instance,at=it.currentTarget;if(it=it.listener,nt!==b&&_.isPropagationStopped())break e;nf(_,it,at),b=nt}else for(_e=0;_e<d.length;_e++){if(it=d[_e],nt=it.instance,at=it.currentTarget,it=it.listener,nt!==b&&_.isPropagationStopped())break e;nf(_,it,at),b=nt}}}if(Qb)throw h=Rb,Qb=!1,Rb=null,h}function D(h,o){var c=o[of];c===void 0&&(c=o[of]=new Set);var d=h+"__bubble";c.has(d)||(pf(o,h,2,!1),c.add(d))}function qf(h,o,c){var d=0;o&&(d|=4),pf(c,h,d,o)}var rf="_reactListening"+Math.random().toString(36).slice(2);function sf(h){if(!h[rf]){h[rf]=!0,da.forEach(function(c){c!=="selectionchange"&&(mf.has(c)||qf(c,!1,h),qf(c,!0,h))});var o=h.nodeType===9?h:h.ownerDocument;o===null||o[rf]||(o[rf]=!0,qf("selectionchange",!1,o))}}function pf(h,o,c,d){switch(jd(o)){case 1:var _=ed;break;case 4:_=gd;break;default:_=fd}c=_.bind(null,o,c,h),_=void 0,!Lb||o!=="touchstart"&&o!=="touchmove"&&o!=="wheel"||(_=!0),d?_!==void 0?h.addEventListener(o,c,{capture:!0,passive:_}):h.addEventListener(o,c,!0):_!==void 0?h.addEventListener(o,c,{passive:_}):h.addEventListener(o,c,!1)}function hd(h,o,c,d,_){var b=d;if(!(o&1)&&!(o&2)&&d!==null)e:for(;;){if(d===null)return;var _e=d.tag;if(_e===3||_e===4){var it=d.stateNode.containerInfo;if(it===_||it.nodeType===8&&it.parentNode===_)break;if(_e===4)for(_e=d.return;_e!==null;){var nt=_e.tag;if((nt===3||nt===4)&&(nt=_e.stateNode.containerInfo,nt===_||nt.nodeType===8&&nt.parentNode===_))return;_e=_e.return}for(;it!==null;){if(_e=Wc(it),_e===null)return;if(nt=_e.tag,nt===5||nt===6){d=b=_e;continue e}it=it.parentNode}}d=d.return}Jb(function(){var at=b,ut=xb(c),pt=[];e:{var mt=df.get(h);if(mt!==void 0){var ft=td,vt=h;switch(h){case"keypress":if(od(c)===0)break e;case"keydown":case"keyup":ft=Rd;break;case"focusin":vt="focus",ft=Fd;break;case"focusout":vt="blur",ft=Fd;break;case"beforeblur":case"afterblur":ft=Fd;break;case"click":if(c.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":ft=Bd;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":ft=Dd;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":ft=Vd;break;case $e:case af:case bf:ft=Hd;break;case cf:ft=Xd;break;case"scroll":ft=vd;break;case"wheel":ft=Zd;break;case"copy":case"cut":case"paste":ft=Jd;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":ft=Td}var xt=(o&4)!==0,At=!xt&&h==="scroll",Ct=xt?mt!==null?mt+"Capture":null:mt;xt=[];for(var Et=at,Tt;Et!==null;){Tt=Et;var kt=Tt.stateNode;if(Tt.tag===5&&kt!==null&&(Tt=kt,Ct!==null&&(kt=Kb(Et,Ct),kt!=null&&xt.push(tf(Et,kt,Tt)))),At)break;Et=Et.return}0<xt.length&&(mt=new ft(mt,vt,null,c,ut),pt.push({event:mt,listeners:xt}))}}if(!(o&7)){e:{if(mt=h==="mouseover"||h==="pointerover",ft=h==="mouseout"||h==="pointerout",mt&&c!==wb&&(vt=c.relatedTarget||c.fromElement)&&(Wc(vt)||vt[uf]))break e;if((ft||mt)&&(mt=ut.window===ut?ut:(mt=ut.ownerDocument)?mt.defaultView||mt.parentWindow:window,ft?(vt=c.relatedTarget||c.toElement,ft=at,vt=vt?Wc(vt):null,vt!==null&&(At=Vb(vt),vt!==At||vt.tag!==5&&vt.tag!==6)&&(vt=null)):(ft=null,vt=at),ft!==vt)){if(xt=Bd,kt="onMouseLeave",Ct="onMouseEnter",Et="mouse",(h==="pointerout"||h==="pointerover")&&(xt=Td,kt="onPointerLeave",Ct="onPointerEnter",Et="pointer"),At=ft==null?mt:ue(ft),Tt=vt==null?mt:ue(vt),mt=new xt(kt,Et+"leave",ft,c,ut),mt.target=At,mt.relatedTarget=Tt,kt=null,Wc(ut)===at&&(xt=new xt(Ct,Et+"enter",vt,c,ut),xt.target=Tt,xt.relatedTarget=At,kt=xt),At=kt,ft&&vt)t:{for(xt=ft,Ct=vt,Et=0,Tt=xt;Tt;Tt=vf(Tt))Et++;for(Tt=0,kt=Ct;kt;kt=vf(kt))Tt++;for(;0<Et-Tt;)xt=vf(xt),Et--;for(;0<Tt-Et;)Ct=vf(Ct),Tt--;for(;Et--;){if(xt===Ct||Ct!==null&&xt===Ct.alternate)break t;xt=vf(xt),Ct=vf(Ct)}xt=null}else xt=null;ft!==null&&wf(pt,mt,ft,xt,!1),vt!==null&&At!==null&&wf(pt,At,vt,xt,!0)}}e:{if(mt=at?ue(at):window,ft=mt.nodeName&&mt.nodeName.toLowerCase(),ft==="select"||ft==="input"&&mt.type==="file")var Dt=ve;else if(me(mt))if(we)Dt=Fe;else{Dt=De;var zt=Ce}else(ft=mt.nodeName)&&ft.toLowerCase()==="input"&&(mt.type==="checkbox"||mt.type==="radio")&&(Dt=Ee);if(Dt&&(Dt=Dt(h,at))){ne(pt,Dt,c,ut);break e}zt&&zt(h,mt,at),h==="focusout"&&(zt=mt._wrapperState)&&zt.controlled&&mt.type==="number"&&cb(mt,"number",mt.value)}switch(zt=at?ue(at):window,h){case"focusin":(me(zt)||zt.contentEditable==="true")&&(Qe=zt,Re=at,Se=null);break;case"focusout":Se=Re=Qe=null;break;case"mousedown":Te=!0;break;case"contextmenu":case"mouseup":case"dragend":Te=!1,Ue(pt,c,ut);break;case"selectionchange":if(Pe)break;case"keydown":case"keyup":Ue(pt,c,ut)}var Bt;if(ae)e:{switch(h){case"compositionstart":var Rt="onCompositionStart";break e;case"compositionend":Rt="onCompositionEnd";break e;case"compositionupdate":Rt="onCompositionUpdate";break e}Rt=void 0}else ie?ge(h,c)&&(Rt="onCompositionEnd"):h==="keydown"&&c.keyCode===229&&(Rt="onCompositionStart");Rt&&(de&&c.locale!=="ko"&&(ie||Rt!=="onCompositionStart"?Rt==="onCompositionEnd"&&ie&&(Bt=nd()):(kd=ut,ld="value"in kd?kd.value:kd.textContent,ie=!0)),zt=oe(at,Rt),0<zt.length&&(Rt=new Ld(Rt,h,null,c,ut),pt.push({event:Rt,listeners:zt}),Bt?Rt.data=Bt:(Bt=he(c),Bt!==null&&(Rt.data=Bt)))),(Bt=ce?je(h,c):ke(h,c))&&(at=oe(at,"onBeforeInput"),0<at.length&&(ut=new Ld("onBeforeInput","beforeinput",null,c,ut),pt.push({event:ut,listeners:at}),ut.data=Bt))}se(pt,o)})}function tf(h,o,c){return{instance:h,listener:o,currentTarget:c}}function oe(h,o){for(var c=o+"Capture",d=[];h!==null;){var _=h,b=_.stateNode;_.tag===5&&b!==null&&(_=b,b=Kb(h,c),b!=null&&d.unshift(tf(h,b,_)),b=Kb(h,o),b!=null&&d.push(tf(h,b,_))),h=h.return}return d}function vf(h){if(h===null)return null;do h=h.return;while(h&&h.tag!==5);return h||null}function wf(h,o,c,d,_){for(var b=o._reactName,_e=[];c!==null&&c!==d;){var it=c,nt=it.alternate,at=it.stateNode;if(nt!==null&&nt===d)break;it.tag===5&&at!==null&&(it=at,_?(nt=Kb(c,b),nt!=null&&_e.unshift(tf(c,nt,it))):_||(nt=Kb(c,b),nt!=null&&_e.push(tf(c,nt,it)))),c=c.return}_e.length!==0&&h.push({event:o,listeners:_e})}var xf=/\r\n?/g,yf=/\u0000|\uFFFD/g;function zf(h){return(typeof h=="string"?h:""+h).replace(xf,`
`).replace(yf,"")}function Af(h,o,c){if(o=zf(o),zf(h)!==o&&c)throw Error(p(425))}function Bf(){}var Cf=null,Df=null;function Ef(h,o){return h==="textarea"||h==="noscript"||typeof o.children=="string"||typeof o.children=="number"||typeof o.dangerouslySetInnerHTML=="object"&&o.dangerouslySetInnerHTML!==null&&o.dangerouslySetInnerHTML.__html!=null}var Ff=typeof setTimeout=="function"?setTimeout:void 0,Gf=typeof clearTimeout=="function"?clearTimeout:void 0,Hf=typeof Promise=="function"?Promise:void 0,Jf=typeof queueMicrotask=="function"?queueMicrotask:typeof Hf<"u"?function(h){return Hf.resolve(null).then(h).catch(If)}:Ff;function If(h){setTimeout(function(){throw h})}function Kf(h,o){var c=o,d=0;do{var _=c.nextSibling;if(h.removeChild(c),_&&_.nodeType===8)if(c=_.data,c==="/$"){if(d===0){h.removeChild(_),bd(o);return}d--}else c!=="$"&&c!=="$?"&&c!=="$!"||d++;c=_}while(c);bd(o)}function Lf(h){for(;h!=null;h=h.nextSibling){var o=h.nodeType;if(o===1||o===3)break;if(o===8){if(o=h.data,o==="$"||o==="$!"||o==="$?")break;if(o==="/$")return null}}return h}function Mf(h){h=h.previousSibling;for(var o=0;h;){if(h.nodeType===8){var c=h.data;if(c==="$"||c==="$!"||c==="$?"){if(o===0)return h;o--}else c==="/$"&&o++}h=h.previousSibling}return null}var Nf=Math.random().toString(36).slice(2),Of="__reactFiber$"+Nf,Pf="__reactProps$"+Nf,uf="__reactContainer$"+Nf,of="__reactEvents$"+Nf,Qf="__reactListeners$"+Nf,Rf="__reactHandles$"+Nf;function Wc(h){var o=h[Of];if(o)return o;for(var c=h.parentNode;c;){if(o=c[uf]||c[Of]){if(c=o.alternate,o.child!==null||c!==null&&c.child!==null)for(h=Mf(h);h!==null;){if(c=h[Of])return c;h=Mf(h)}return o}h=c,c=h.parentNode}return null}function Cb(h){return h=h[Of]||h[uf],!h||h.tag!==5&&h.tag!==6&&h.tag!==13&&h.tag!==3?null:h}function ue(h){if(h.tag===5||h.tag===6)return h.stateNode;throw Error(p(33))}function Db(h){return h[Pf]||null}var Sf=[],Tf=-1;function Uf(h){return{current:h}}function E(h){0>Tf||(h.current=Sf[Tf],Sf[Tf]=null,Tf--)}function G(h,o){Tf++,Sf[Tf]=h.current,h.current=o}var Vf={},H=Uf(Vf),Wf=Uf(!1),Xf=Vf;function Yf(h,o){var c=h.type.contextTypes;if(!c)return Vf;var d=h.stateNode;if(d&&d.__reactInternalMemoizedUnmaskedChildContext===o)return d.__reactInternalMemoizedMaskedChildContext;var _={},b;for(b in c)_[b]=o[b];return d&&(h=h.stateNode,h.__reactInternalMemoizedUnmaskedChildContext=o,h.__reactInternalMemoizedMaskedChildContext=_),_}function Zf(h){return h=h.childContextTypes,h!=null}function $f(){E(Wf),E(H)}function ag(h,o,c){if(H.current!==Vf)throw Error(p(168));G(H,o),G(Wf,c)}function bg(h,o,c){var d=h.stateNode;if(o=o.childContextTypes,typeof d.getChildContext!="function")return c;d=d.getChildContext();for(var _ in d)if(!(_ in o))throw Error(p(108,Ra(h)||"Unknown",_));return A({},c,d)}function cg(h){return h=(h=h.stateNode)&&h.__reactInternalMemoizedMergedChildContext||Vf,Xf=H.current,G(H,h),G(Wf,Wf.current),!0}function dg(h,o,c){var d=h.stateNode;if(!d)throw Error(p(169));c?(h=bg(h,o,Xf),d.__reactInternalMemoizedMergedChildContext=h,E(Wf),E(H),G(H,h)):E(Wf),G(Wf,c)}var eg=null,fg=!1,gg=!1;function hg(h){eg===null?eg=[h]:eg.push(h)}function ig(h){fg=!0,hg(h)}function jg(){if(!gg&&eg!==null){gg=!0;var h=0,o=C;try{var c=eg;for(C=1;h<c.length;h++){var d=c[h];do d=d(!0);while(d!==null)}eg=null,fg=!1}catch(_){throw eg!==null&&(eg=eg.slice(h+1)),ac(fc,jg),_}finally{C=o,gg=!1}}return null}var kg=[],lg=0,mg=null,ng=0,og=[],pg=0,qg=null,rg=1,sg="";function tg(h,o){kg[lg++]=ng,kg[lg++]=mg,mg=h,ng=o}function ug(h,o,c){og[pg++]=rg,og[pg++]=sg,og[pg++]=qg,qg=h;var d=rg;h=sg;var _=32-oc(d)-1;d&=~(1<<_),c+=1;var b=32-oc(o)+_;if(30<b){var _e=_-_%5;b=(d&(1<<_e)-1).toString(32),d>>=_e,_-=_e,rg=1<<32-oc(o)+_|c<<_|d,sg=b+h}else rg=1<<b|c<<_|d,sg=h}function vg(h){h.return!==null&&(tg(h,1),ug(h,1,0))}function wg(h){for(;h===mg;)mg=kg[--lg],kg[lg]=null,ng=kg[--lg],kg[lg]=null;for(;h===qg;)qg=og[--pg],og[pg]=null,sg=og[--pg],og[pg]=null,rg=og[--pg],og[pg]=null}var xg=null,yg=null,I=!1,zg=null;function Ag(h,o){var c=Bg(5,null,null,0);c.elementType="DELETED",c.stateNode=o,c.return=h,o=h.deletions,o===null?(h.deletions=[c],h.flags|=16):o.push(c)}function Cg(h,o){switch(h.tag){case 5:var c=h.type;return o=o.nodeType!==1||c.toLowerCase()!==o.nodeName.toLowerCase()?null:o,o!==null?(h.stateNode=o,xg=h,yg=Lf(o.firstChild),!0):!1;case 6:return o=h.pendingProps===""||o.nodeType!==3?null:o,o!==null?(h.stateNode=o,xg=h,yg=null,!0):!1;case 13:return o=o.nodeType!==8?null:o,o!==null?(c=qg!==null?{id:rg,overflow:sg}:null,h.memoizedState={dehydrated:o,treeContext:c,retryLane:1073741824},c=Bg(18,null,null,0),c.stateNode=o,c.return=h,h.child=c,xg=h,yg=null,!0):!1;default:return!1}}function Dg(h){return(h.mode&1)!==0&&(h.flags&128)===0}function Eg(h){if(I){var o=yg;if(o){var c=o;if(!Cg(h,o)){if(Dg(h))throw Error(p(418));o=Lf(c.nextSibling);var d=xg;o&&Cg(h,o)?Ag(d,c):(h.flags=h.flags&-4097|2,I=!1,xg=h)}}else{if(Dg(h))throw Error(p(418));h.flags=h.flags&-4097|2,I=!1,xg=h}}}function Fg(h){for(h=h.return;h!==null&&h.tag!==5&&h.tag!==3&&h.tag!==13;)h=h.return;xg=h}function Gg(h){if(h!==xg)return!1;if(!I)return Fg(h),I=!0,!1;var o;if((o=h.tag!==3)&&!(o=h.tag!==5)&&(o=h.type,o=o!=="head"&&o!=="body"&&!Ef(h.type,h.memoizedProps)),o&&(o=yg)){if(Dg(h))throw Hg(),Error(p(418));for(;o;)Ag(h,o),o=Lf(o.nextSibling)}if(Fg(h),h.tag===13){if(h=h.memoizedState,h=h!==null?h.dehydrated:null,!h)throw Error(p(317));e:{for(h=h.nextSibling,o=0;h;){if(h.nodeType===8){var c=h.data;if(c==="/$"){if(o===0){yg=Lf(h.nextSibling);break e}o--}else c!=="$"&&c!=="$!"&&c!=="$?"||o++}h=h.nextSibling}yg=null}}else yg=xg?Lf(h.stateNode.nextSibling):null;return!0}function Hg(){for(var h=yg;h;)h=Lf(h.nextSibling)}function Ig(){yg=xg=null,I=!1}function Jg(h){zg===null?zg=[h]:zg.push(h)}var Kg=ua.ReactCurrentBatchConfig;function Lg(h,o,c){if(h=c.ref,h!==null&&typeof h!="function"&&typeof h!="object"){if(c._owner){if(c=c._owner,c){if(c.tag!==1)throw Error(p(309));var d=c.stateNode}if(!d)throw Error(p(147,h));var _=d,b=""+h;return o!==null&&o.ref!==null&&typeof o.ref=="function"&&o.ref._stringRef===b?o.ref:(o=function(_e){var it=_.refs;_e===null?delete it[b]:it[b]=_e},o._stringRef=b,o)}if(typeof h!="string")throw Error(p(284));if(!c._owner)throw Error(p(290,h))}return h}function Mg(h,o){throw h=Object.prototype.toString.call(o),Error(p(31,h==="[object Object]"?"object with keys {"+Object.keys(o).join(", ")+"}":h))}function Ng(h){var o=h._init;return o(h._payload)}function Og(h){function o(Ct,Et){if(h){var Tt=Ct.deletions;Tt===null?(Ct.deletions=[Et],Ct.flags|=16):Tt.push(Et)}}function c(Ct,Et){if(!h)return null;for(;Et!==null;)o(Ct,Et),Et=Et.sibling;return null}function d(Ct,Et){for(Ct=new Map;Et!==null;)Et.key!==null?Ct.set(Et.key,Et):Ct.set(Et.index,Et),Et=Et.sibling;return Ct}function _(Ct,Et){return Ct=Pg(Ct,Et),Ct.index=0,Ct.sibling=null,Ct}function b(Ct,Et,Tt){return Ct.index=Tt,h?(Tt=Ct.alternate,Tt!==null?(Tt=Tt.index,Tt<Et?(Ct.flags|=2,Et):Tt):(Ct.flags|=2,Et)):(Ct.flags|=1048576,Et)}function _e(Ct){return h&&Ct.alternate===null&&(Ct.flags|=2),Ct}function it(Ct,Et,Tt,kt){return Et===null||Et.tag!==6?(Et=Qg(Tt,Ct.mode,kt),Et.return=Ct,Et):(Et=_(Et,Tt),Et.return=Ct,Et)}function nt(Ct,Et,Tt,kt){var Dt=Tt.type;return Dt===ya?ut(Ct,Et,Tt.props.children,kt,Tt.key):Et!==null&&(Et.elementType===Dt||typeof Dt=="object"&&Dt!==null&&Dt.$$typeof===Ha&&Ng(Dt)===Et.type)?(kt=_(Et,Tt.props),kt.ref=Lg(Ct,Et,Tt),kt.return=Ct,kt):(kt=Rg(Tt.type,Tt.key,Tt.props,null,Ct.mode,kt),kt.ref=Lg(Ct,Et,Tt),kt.return=Ct,kt)}function at(Ct,Et,Tt,kt){return Et===null||Et.tag!==4||Et.stateNode.containerInfo!==Tt.containerInfo||Et.stateNode.implementation!==Tt.implementation?(Et=Sg(Tt,Ct.mode,kt),Et.return=Ct,Et):(Et=_(Et,Tt.children||[]),Et.return=Ct,Et)}function ut(Ct,Et,Tt,kt,Dt){return Et===null||Et.tag!==7?(Et=Tg(Tt,Ct.mode,kt,Dt),Et.return=Ct,Et):(Et=_(Et,Tt),Et.return=Ct,Et)}function pt(Ct,Et,Tt){if(typeof Et=="string"&&Et!==""||typeof Et=="number")return Et=Qg(""+Et,Ct.mode,Tt),Et.return=Ct,Et;if(typeof Et=="object"&&Et!==null){switch(Et.$$typeof){case va:return Tt=Rg(Et.type,Et.key,Et.props,null,Ct.mode,Tt),Tt.ref=Lg(Ct,null,Et),Tt.return=Ct,Tt;case wa:return Et=Sg(Et,Ct.mode,Tt),Et.return=Ct,Et;case Ha:var kt=Et._init;return pt(Ct,kt(Et._payload),Tt)}if(eb(Et)||Ka(Et))return Et=Tg(Et,Ct.mode,Tt,null),Et.return=Ct,Et;Mg(Ct,Et)}return null}function mt(Ct,Et,Tt,kt){var Dt=Et!==null?Et.key:null;if(typeof Tt=="string"&&Tt!==""||typeof Tt=="number")return Dt!==null?null:it(Ct,Et,""+Tt,kt);if(typeof Tt=="object"&&Tt!==null){switch(Tt.$$typeof){case va:return Tt.key===Dt?nt(Ct,Et,Tt,kt):null;case wa:return Tt.key===Dt?at(Ct,Et,Tt,kt):null;case Ha:return Dt=Tt._init,mt(Ct,Et,Dt(Tt._payload),kt)}if(eb(Tt)||Ka(Tt))return Dt!==null?null:ut(Ct,Et,Tt,kt,null);Mg(Ct,Tt)}return null}function ft(Ct,Et,Tt,kt,Dt){if(typeof kt=="string"&&kt!==""||typeof kt=="number")return Ct=Ct.get(Tt)||null,it(Et,Ct,""+kt,Dt);if(typeof kt=="object"&&kt!==null){switch(kt.$$typeof){case va:return Ct=Ct.get(kt.key===null?Tt:kt.key)||null,nt(Et,Ct,kt,Dt);case wa:return Ct=Ct.get(kt.key===null?Tt:kt.key)||null,at(Et,Ct,kt,Dt);case Ha:var zt=kt._init;return ft(Ct,Et,Tt,zt(kt._payload),Dt)}if(eb(kt)||Ka(kt))return Ct=Ct.get(Tt)||null,ut(Et,Ct,kt,Dt,null);Mg(Et,kt)}return null}function vt(Ct,Et,Tt,kt){for(var Dt=null,zt=null,Bt=Et,Rt=Et=0,Ut=null;Bt!==null&&Rt<Tt.length;Rt++){Bt.index>Rt?(Ut=Bt,Bt=null):Ut=Bt.sibling;var Ht=mt(Ct,Bt,Tt[Rt],kt);if(Ht===null){Bt===null&&(Bt=Ut);break}h&&Bt&&Ht.alternate===null&&o(Ct,Bt),Et=b(Ht,Et,Rt),zt===null?Dt=Ht:zt.sibling=Ht,zt=Ht,Bt=Ut}if(Rt===Tt.length)return c(Ct,Bt),I&&tg(Ct,Rt),Dt;if(Bt===null){for(;Rt<Tt.length;Rt++)Bt=pt(Ct,Tt[Rt],kt),Bt!==null&&(Et=b(Bt,Et,Rt),zt===null?Dt=Bt:zt.sibling=Bt,zt=Bt);return I&&tg(Ct,Rt),Dt}for(Bt=d(Ct,Bt);Rt<Tt.length;Rt++)Ut=ft(Bt,Ct,Rt,Tt[Rt],kt),Ut!==null&&(h&&Ut.alternate!==null&&Bt.delete(Ut.key===null?Rt:Ut.key),Et=b(Ut,Et,Rt),zt===null?Dt=Ut:zt.sibling=Ut,zt=Ut);return h&&Bt.forEach(function(Jt){return o(Ct,Jt)}),I&&tg(Ct,Rt),Dt}function xt(Ct,Et,Tt,kt){var Dt=Ka(Tt);if(typeof Dt!="function")throw Error(p(150));if(Tt=Dt.call(Tt),Tt==null)throw Error(p(151));for(var zt=Dt=null,Bt=Et,Rt=Et=0,Ut=null,Ht=Tt.next();Bt!==null&&!Ht.done;Rt++,Ht=Tt.next()){Bt.index>Rt?(Ut=Bt,Bt=null):Ut=Bt.sibling;var Jt=mt(Ct,Bt,Ht.value,kt);if(Jt===null){Bt===null&&(Bt=Ut);break}h&&Bt&&Jt.alternate===null&&o(Ct,Bt),Et=b(Jt,Et,Rt),zt===null?Dt=Jt:zt.sibling=Jt,zt=Jt,Bt=Ut}if(Ht.done)return c(Ct,Bt),I&&tg(Ct,Rt),Dt;if(Bt===null){for(;!Ht.done;Rt++,Ht=Tt.next())Ht=pt(Ct,Ht.value,kt),Ht!==null&&(Et=b(Ht,Et,Rt),zt===null?Dt=Ht:zt.sibling=Ht,zt=Ht);return I&&tg(Ct,Rt),Dt}for(Bt=d(Ct,Bt);!Ht.done;Rt++,Ht=Tt.next())Ht=ft(Bt,Ct,Rt,Ht.value,kt),Ht!==null&&(h&&Ht.alternate!==null&&Bt.delete(Ht.key===null?Rt:Ht.key),Et=b(Ht,Et,Rt),zt===null?Dt=Ht:zt.sibling=Ht,zt=Ht);return h&&Bt.forEach(function(Kt){return o(Ct,Kt)}),I&&tg(Ct,Rt),Dt}function At(Ct,Et,Tt,kt){if(typeof Tt=="object"&&Tt!==null&&Tt.type===ya&&Tt.key===null&&(Tt=Tt.props.children),typeof Tt=="object"&&Tt!==null){switch(Tt.$$typeof){case va:e:{for(var Dt=Tt.key,zt=Et;zt!==null;){if(zt.key===Dt){if(Dt=Tt.type,Dt===ya){if(zt.tag===7){c(Ct,zt.sibling),Et=_(zt,Tt.props.children),Et.return=Ct,Ct=Et;break e}}else if(zt.elementType===Dt||typeof Dt=="object"&&Dt!==null&&Dt.$$typeof===Ha&&Ng(Dt)===zt.type){c(Ct,zt.sibling),Et=_(zt,Tt.props),Et.ref=Lg(Ct,zt,Tt),Et.return=Ct,Ct=Et;break e}c(Ct,zt);break}else o(Ct,zt);zt=zt.sibling}Tt.type===ya?(Et=Tg(Tt.props.children,Ct.mode,kt,Tt.key),Et.return=Ct,Ct=Et):(kt=Rg(Tt.type,Tt.key,Tt.props,null,Ct.mode,kt),kt.ref=Lg(Ct,Et,Tt),kt.return=Ct,Ct=kt)}return _e(Ct);case wa:e:{for(zt=Tt.key;Et!==null;){if(Et.key===zt)if(Et.tag===4&&Et.stateNode.containerInfo===Tt.containerInfo&&Et.stateNode.implementation===Tt.implementation){c(Ct,Et.sibling),Et=_(Et,Tt.children||[]),Et.return=Ct,Ct=Et;break e}else{c(Ct,Et);break}else o(Ct,Et);Et=Et.sibling}Et=Sg(Tt,Ct.mode,kt),Et.return=Ct,Ct=Et}return _e(Ct);case Ha:return zt=Tt._init,At(Ct,Et,zt(Tt._payload),kt)}if(eb(Tt))return vt(Ct,Et,Tt,kt);if(Ka(Tt))return xt(Ct,Et,Tt,kt);Mg(Ct,Tt)}return typeof Tt=="string"&&Tt!==""||typeof Tt=="number"?(Tt=""+Tt,Et!==null&&Et.tag===6?(c(Ct,Et.sibling),Et=_(Et,Tt),Et.return=Ct,Ct=Et):(c(Ct,Et),Et=Qg(Tt,Ct.mode,kt),Et.return=Ct,Ct=Et),_e(Ct)):c(Ct,Et)}return At}var Ug=Og(!0),Vg=Og(!1),Wg=Uf(null),Xg=null,Yg=null,Zg=null;function $g(){Zg=Yg=Xg=null}function ah(h){var o=Wg.current;E(Wg),h._currentValue=o}function bh(h,o,c){for(;h!==null;){var d=h.alternate;if((h.childLanes&o)!==o?(h.childLanes|=o,d!==null&&(d.childLanes|=o)):d!==null&&(d.childLanes&o)!==o&&(d.childLanes|=o),h===c)break;h=h.return}}function ch(h,o){Xg=h,Zg=Yg=null,h=h.dependencies,h!==null&&h.firstContext!==null&&(h.lanes&o&&(dh=!0),h.firstContext=null)}function eh(h){var o=h._currentValue;if(Zg!==h)if(h={context:h,memoizedValue:o,next:null},Yg===null){if(Xg===null)throw Error(p(308));Yg=h,Xg.dependencies={lanes:0,firstContext:h}}else Yg=Yg.next=h;return o}var fh=null;function gh(h){fh===null?fh=[h]:fh.push(h)}function hh(h,o,c,d){var _=o.interleaved;return _===null?(c.next=c,gh(o)):(c.next=_.next,_.next=c),o.interleaved=c,ih(h,d)}function ih(h,o){h.lanes|=o;var c=h.alternate;for(c!==null&&(c.lanes|=o),c=h,h=h.return;h!==null;)h.childLanes|=o,c=h.alternate,c!==null&&(c.childLanes|=o),c=h,h=h.return;return c.tag===3?c.stateNode:null}var jh=!1;function kh(h){h.updateQueue={baseState:h.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function lh(h,o){h=h.updateQueue,o.updateQueue===h&&(o.updateQueue={baseState:h.baseState,firstBaseUpdate:h.firstBaseUpdate,lastBaseUpdate:h.lastBaseUpdate,shared:h.shared,effects:h.effects})}function mh(h,o){return{eventTime:h,lane:o,tag:0,payload:null,callback:null,next:null}}function nh(h,o,c){var d=h.updateQueue;if(d===null)return null;if(d=d.shared,K&2){var _=d.pending;return _===null?o.next=o:(o.next=_.next,_.next=o),d.pending=o,ih(h,c)}return _=d.interleaved,_===null?(o.next=o,gh(d)):(o.next=_.next,_.next=o),d.interleaved=o,ih(h,c)}function oh(h,o,c){if(o=o.updateQueue,o!==null&&(o=o.shared,(c&4194240)!==0)){var d=o.lanes;d&=h.pendingLanes,c|=d,o.lanes=c,Cc(h,c)}}function ph(h,o){var c=h.updateQueue,d=h.alternate;if(d!==null&&(d=d.updateQueue,c===d)){var _=null,b=null;if(c=c.firstBaseUpdate,c!==null){do{var _e={eventTime:c.eventTime,lane:c.lane,tag:c.tag,payload:c.payload,callback:c.callback,next:null};b===null?_=b=_e:b=b.next=_e,c=c.next}while(c!==null);b===null?_=b=o:b=b.next=o}else _=b=o;c={baseState:d.baseState,firstBaseUpdate:_,lastBaseUpdate:b,shared:d.shared,effects:d.effects},h.updateQueue=c;return}h=c.lastBaseUpdate,h===null?c.firstBaseUpdate=o:h.next=o,c.lastBaseUpdate=o}function qh(h,o,c,d){var _=h.updateQueue;jh=!1;var b=_.firstBaseUpdate,_e=_.lastBaseUpdate,it=_.shared.pending;if(it!==null){_.shared.pending=null;var nt=it,at=nt.next;nt.next=null,_e===null?b=at:_e.next=at,_e=nt;var ut=h.alternate;ut!==null&&(ut=ut.updateQueue,it=ut.lastBaseUpdate,it!==_e&&(it===null?ut.firstBaseUpdate=at:it.next=at,ut.lastBaseUpdate=nt))}if(b!==null){var pt=_.baseState;_e=0,ut=at=nt=null,it=b;do{var mt=it.lane,ft=it.eventTime;if((d&mt)===mt){ut!==null&&(ut=ut.next={eventTime:ft,lane:0,tag:it.tag,payload:it.payload,callback:it.callback,next:null});e:{var vt=h,xt=it;switch(mt=o,ft=c,xt.tag){case 1:if(vt=xt.payload,typeof vt=="function"){pt=vt.call(ft,pt,mt);break e}pt=vt;break e;case 3:vt.flags=vt.flags&-65537|128;case 0:if(vt=xt.payload,mt=typeof vt=="function"?vt.call(ft,pt,mt):vt,mt==null)break e;pt=A({},pt,mt);break e;case 2:jh=!0}}it.callback!==null&&it.lane!==0&&(h.flags|=64,mt=_.effects,mt===null?_.effects=[it]:mt.push(it))}else ft={eventTime:ft,lane:mt,tag:it.tag,payload:it.payload,callback:it.callback,next:null},ut===null?(at=ut=ft,nt=pt):ut=ut.next=ft,_e|=mt;if(it=it.next,it===null){if(it=_.shared.pending,it===null)break;mt=it,it=mt.next,mt.next=null,_.lastBaseUpdate=mt,_.shared.pending=null}}while(!0);if(ut===null&&(nt=pt),_.baseState=nt,_.firstBaseUpdate=at,_.lastBaseUpdate=ut,o=_.shared.interleaved,o!==null){_=o;do _e|=_.lane,_=_.next;while(_!==o)}else b===null&&(_.shared.lanes=0);rh|=_e,h.lanes=_e,h.memoizedState=pt}}function sh(h,o,c){if(h=o.effects,o.effects=null,h!==null)for(o=0;o<h.length;o++){var d=h[o],_=d.callback;if(_!==null){if(d.callback=null,d=c,typeof _!="function")throw Error(p(191,_));_.call(d)}}}var th={},uh=Uf(th),vh$1=Uf(th),wh=Uf(th);function xh(h){if(h===th)throw Error(p(174));return h}function yh(h,o){switch(G(wh,o),G(vh$1,h),G(uh,th),h=o.nodeType,h){case 9:case 11:o=(o=o.documentElement)?o.namespaceURI:lb(null,"");break;default:h=h===8?o.parentNode:o,o=h.namespaceURI||null,h=h.tagName,o=lb(o,h)}E(uh),G(uh,o)}function zh(){E(uh),E(vh$1),E(wh)}function Ah(h){xh(wh.current);var o=xh(uh.current),c=lb(o,h.type);o!==c&&(G(vh$1,h),G(uh,c))}function Bh(h){vh$1.current===h&&(E(uh),E(vh$1))}var L=Uf(0);function Ch(h){for(var o=h;o!==null;){if(o.tag===13){var c=o.memoizedState;if(c!==null&&(c=c.dehydrated,c===null||c.data==="$?"||c.data==="$!"))return o}else if(o.tag===19&&o.memoizedProps.revealOrder!==void 0){if(o.flags&128)return o}else if(o.child!==null){o.child.return=o,o=o.child;continue}if(o===h)break;for(;o.sibling===null;){if(o.return===null||o.return===h)return null;o=o.return}o.sibling.return=o.return,o=o.sibling}return null}var Dh=[];function Eh(){for(var h=0;h<Dh.length;h++)Dh[h]._workInProgressVersionPrimary=null;Dh.length=0}var Fh=ua.ReactCurrentDispatcher,Gh=ua.ReactCurrentBatchConfig,Hh=0,M=null,N=null,O=null,Ih=!1,Jh=!1,Kh=0,Lh=0;function P(){throw Error(p(321))}function Mh(h,o){if(o===null)return!1;for(var c=0;c<o.length&&c<h.length;c++)if(!He(h[c],o[c]))return!1;return!0}function Nh(h,o,c,d,_,b){if(Hh=b,M=o,o.memoizedState=null,o.updateQueue=null,o.lanes=0,Fh.current=h===null||h.memoizedState===null?Oh:Ph,h=c(d,_),Jh){b=0;do{if(Jh=!1,Kh=0,25<=b)throw Error(p(301));b+=1,O=N=null,o.updateQueue=null,Fh.current=Qh,h=c(d,_)}while(Jh)}if(Fh.current=Rh,o=N!==null&&N.next!==null,Hh=0,O=N=M=null,Ih=!1,o)throw Error(p(300));return h}function Sh(){var h=Kh!==0;return Kh=0,h}function Th(){var h={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return O===null?M.memoizedState=O=h:O=O.next=h,O}function Uh(){if(N===null){var h=M.alternate;h=h!==null?h.memoizedState:null}else h=N.next;var o=O===null?M.memoizedState:O.next;if(o!==null)O=o,N=h;else{if(h===null)throw Error(p(310));N=h,h={memoizedState:N.memoizedState,baseState:N.baseState,baseQueue:N.baseQueue,queue:N.queue,next:null},O===null?M.memoizedState=O=h:O=O.next=h}return O}function Vh(h,o){return typeof o=="function"?o(h):o}function Wh(h){var o=Uh(),c=o.queue;if(c===null)throw Error(p(311));c.lastRenderedReducer=h;var d=N,_=d.baseQueue,b=c.pending;if(b!==null){if(_!==null){var _e=_.next;_.next=b.next,b.next=_e}d.baseQueue=_=b,c.pending=null}if(_!==null){b=_.next,d=d.baseState;var it=_e=null,nt=null,at=b;do{var ut=at.lane;if((Hh&ut)===ut)nt!==null&&(nt=nt.next={lane:0,action:at.action,hasEagerState:at.hasEagerState,eagerState:at.eagerState,next:null}),d=at.hasEagerState?at.eagerState:h(d,at.action);else{var pt={lane:ut,action:at.action,hasEagerState:at.hasEagerState,eagerState:at.eagerState,next:null};nt===null?(it=nt=pt,_e=d):nt=nt.next=pt,M.lanes|=ut,rh|=ut}at=at.next}while(at!==null&&at!==b);nt===null?_e=d:nt.next=it,He(d,o.memoizedState)||(dh=!0),o.memoizedState=d,o.baseState=_e,o.baseQueue=nt,c.lastRenderedState=d}if(h=c.interleaved,h!==null){_=h;do b=_.lane,M.lanes|=b,rh|=b,_=_.next;while(_!==h)}else _===null&&(c.lanes=0);return[o.memoizedState,c.dispatch]}function Xh(h){var o=Uh(),c=o.queue;if(c===null)throw Error(p(311));c.lastRenderedReducer=h;var d=c.dispatch,_=c.pending,b=o.memoizedState;if(_!==null){c.pending=null;var _e=_=_.next;do b=h(b,_e.action),_e=_e.next;while(_e!==_);He(b,o.memoizedState)||(dh=!0),o.memoizedState=b,o.baseQueue===null&&(o.baseState=b),c.lastRenderedState=b}return[b,d]}function Yh(){}function Zh(h,o){var c=M,d=Uh(),_=o(),b=!He(d.memoizedState,_);if(b&&(d.memoizedState=_,dh=!0),d=d.queue,$h(ai.bind(null,c,d,h),[h]),d.getSnapshot!==o||b||O!==null&&O.memoizedState.tag&1){if(c.flags|=2048,bi(9,ci.bind(null,c,d,_,o),void 0,null),Q===null)throw Error(p(349));Hh&30||di(c,o,_)}return _}function di(h,o,c){h.flags|=16384,h={getSnapshot:o,value:c},o=M.updateQueue,o===null?(o={lastEffect:null,stores:null},M.updateQueue=o,o.stores=[h]):(c=o.stores,c===null?o.stores=[h]:c.push(h))}function ci(h,o,c,d){o.value=c,o.getSnapshot=d,ei(o)&&fi(h)}function ai(h,o,c){return c(function(){ei(o)&&fi(h)})}function ei(h){var o=h.getSnapshot;h=h.value;try{var c=o();return!He(h,c)}catch{return!0}}function fi(h){var o=ih(h,1);o!==null&&gi(o,h,1,-1)}function hi(h){var o=Th();return typeof h=="function"&&(h=h()),o.memoizedState=o.baseState=h,h={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Vh,lastRenderedState:h},o.queue=h,h=h.dispatch=ii.bind(null,M,h),[o.memoizedState,h]}function bi(h,o,c,d){return h={tag:h,create:o,destroy:c,deps:d,next:null},o=M.updateQueue,o===null?(o={lastEffect:null,stores:null},M.updateQueue=o,o.lastEffect=h.next=h):(c=o.lastEffect,c===null?o.lastEffect=h.next=h:(d=c.next,c.next=h,h.next=d,o.lastEffect=h)),h}function ji(){return Uh().memoizedState}function ki(h,o,c,d){var _=Th();M.flags|=h,_.memoizedState=bi(1|o,c,void 0,d===void 0?null:d)}function li(h,o,c,d){var _=Uh();d=d===void 0?null:d;var b=void 0;if(N!==null){var _e=N.memoizedState;if(b=_e.destroy,d!==null&&Mh(d,_e.deps)){_.memoizedState=bi(o,c,b,d);return}}M.flags|=h,_.memoizedState=bi(1|o,c,b,d)}function mi(h,o){return ki(8390656,8,h,o)}function $h(h,o){return li(2048,8,h,o)}function ni(h,o){return li(4,2,h,o)}function oi(h,o){return li(4,4,h,o)}function pi(h,o){if(typeof o=="function")return h=h(),o(h),function(){o(null)};if(o!=null)return h=h(),o.current=h,function(){o.current=null}}function qi(h,o,c){return c=c!=null?c.concat([h]):null,li(4,4,pi.bind(null,o,h),c)}function ri(){}function si(h,o){var c=Uh();o=o===void 0?null:o;var d=c.memoizedState;return d!==null&&o!==null&&Mh(o,d[1])?d[0]:(c.memoizedState=[h,o],h)}function ti(h,o){var c=Uh();o=o===void 0?null:o;var d=c.memoizedState;return d!==null&&o!==null&&Mh(o,d[1])?d[0]:(h=h(),c.memoizedState=[h,o],h)}function ui(h,o,c){return Hh&21?(He(c,o)||(c=yc(),M.lanes|=c,rh|=c,h.baseState=!0),o):(h.baseState&&(h.baseState=!1,dh=!0),h.memoizedState=c)}function vi(h,o){var c=C;C=c!==0&&4>c?c:4,h(!0);var d=Gh.transition;Gh.transition={};try{h(!1),o()}finally{C=c,Gh.transition=d}}function wi(){return Uh().memoizedState}function xi(h,o,c){var d=yi(h);if(c={lane:d,action:c,hasEagerState:!1,eagerState:null,next:null},zi(h))Ai(o,c);else if(c=hh(h,o,c,d),c!==null){var _=R();gi(c,h,d,_),Bi(c,o,d)}}function ii(h,o,c){var d=yi(h),_={lane:d,action:c,hasEagerState:!1,eagerState:null,next:null};if(zi(h))Ai(o,_);else{var b=h.alternate;if(h.lanes===0&&(b===null||b.lanes===0)&&(b=o.lastRenderedReducer,b!==null))try{var _e=o.lastRenderedState,it=b(_e,c);if(_.hasEagerState=!0,_.eagerState=it,He(it,_e)){var nt=o.interleaved;nt===null?(_.next=_,gh(o)):(_.next=nt.next,nt.next=_),o.interleaved=_;return}}catch{}finally{}c=hh(h,o,_,d),c!==null&&(_=R(),gi(c,h,d,_),Bi(c,o,d))}}function zi(h){var o=h.alternate;return h===M||o!==null&&o===M}function Ai(h,o){Jh=Ih=!0;var c=h.pending;c===null?o.next=o:(o.next=c.next,c.next=o),h.pending=o}function Bi(h,o,c){if(c&4194240){var d=o.lanes;d&=h.pendingLanes,c|=d,o.lanes=c,Cc(h,c)}}var Rh={readContext:eh,useCallback:P,useContext:P,useEffect:P,useImperativeHandle:P,useInsertionEffect:P,useLayoutEffect:P,useMemo:P,useReducer:P,useRef:P,useState:P,useDebugValue:P,useDeferredValue:P,useTransition:P,useMutableSource:P,useSyncExternalStore:P,useId:P,unstable_isNewReconciler:!1},Oh={readContext:eh,useCallback:function(h,o){return Th().memoizedState=[h,o===void 0?null:o],h},useContext:eh,useEffect:mi,useImperativeHandle:function(h,o,c){return c=c!=null?c.concat([h]):null,ki(4194308,4,pi.bind(null,o,h),c)},useLayoutEffect:function(h,o){return ki(4194308,4,h,o)},useInsertionEffect:function(h,o){return ki(4,2,h,o)},useMemo:function(h,o){var c=Th();return o=o===void 0?null:o,h=h(),c.memoizedState=[h,o],h},useReducer:function(h,o,c){var d=Th();return o=c!==void 0?c(o):o,d.memoizedState=d.baseState=o,h={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:h,lastRenderedState:o},d.queue=h,h=h.dispatch=xi.bind(null,M,h),[d.memoizedState,h]},useRef:function(h){var o=Th();return h={current:h},o.memoizedState=h},useState:hi,useDebugValue:ri,useDeferredValue:function(h){return Th().memoizedState=h},useTransition:function(){var h=hi(!1),o=h[0];return h=vi.bind(null,h[1]),Th().memoizedState=h,[o,h]},useMutableSource:function(){},useSyncExternalStore:function(h,o,c){var d=M,_=Th();if(I){if(c===void 0)throw Error(p(407));c=c()}else{if(c=o(),Q===null)throw Error(p(349));Hh&30||di(d,o,c)}_.memoizedState=c;var b={value:c,getSnapshot:o};return _.queue=b,mi(ai.bind(null,d,b,h),[h]),d.flags|=2048,bi(9,ci.bind(null,d,b,c,o),void 0,null),c},useId:function(){var h=Th(),o=Q.identifierPrefix;if(I){var c=sg,d=rg;c=(d&~(1<<32-oc(d)-1)).toString(32)+c,o=":"+o+"R"+c,c=Kh++,0<c&&(o+="H"+c.toString(32)),o+=":"}else c=Lh++,o=":"+o+"r"+c.toString(32)+":";return h.memoizedState=o},unstable_isNewReconciler:!1},Ph={readContext:eh,useCallback:si,useContext:eh,useEffect:$h,useImperativeHandle:qi,useInsertionEffect:ni,useLayoutEffect:oi,useMemo:ti,useReducer:Wh,useRef:ji,useState:function(){return Wh(Vh)},useDebugValue:ri,useDeferredValue:function(h){var o=Uh();return ui(o,N.memoizedState,h)},useTransition:function(){var h=Wh(Vh)[0],o=Uh().memoizedState;return[h,o]},useMutableSource:Yh,useSyncExternalStore:Zh,useId:wi,unstable_isNewReconciler:!1},Qh={readContext:eh,useCallback:si,useContext:eh,useEffect:$h,useImperativeHandle:qi,useInsertionEffect:ni,useLayoutEffect:oi,useMemo:ti,useReducer:Xh,useRef:ji,useState:function(){return Xh(Vh)},useDebugValue:ri,useDeferredValue:function(h){var o=Uh();return N===null?o.memoizedState=h:ui(o,N.memoizedState,h)},useTransition:function(){var h=Xh(Vh)[0],o=Uh().memoizedState;return[h,o]},useMutableSource:Yh,useSyncExternalStore:Zh,useId:wi,unstable_isNewReconciler:!1};function Ci(h,o){if(h&&h.defaultProps){o=A({},o),h=h.defaultProps;for(var c in h)o[c]===void 0&&(o[c]=h[c]);return o}return o}function Di(h,o,c,d){o=h.memoizedState,c=c(d,o),c=c==null?o:A({},o,c),h.memoizedState=c,h.lanes===0&&(h.updateQueue.baseState=c)}var Ei={isMounted:function(h){return(h=h._reactInternals)?Vb(h)===h:!1},enqueueSetState:function(h,o,c){h=h._reactInternals;var d=R(),_=yi(h),b=mh(d,_);b.payload=o,c!=null&&(b.callback=c),o=nh(h,b,_),o!==null&&(gi(o,h,_,d),oh(o,h,_))},enqueueReplaceState:function(h,o,c){h=h._reactInternals;var d=R(),_=yi(h),b=mh(d,_);b.tag=1,b.payload=o,c!=null&&(b.callback=c),o=nh(h,b,_),o!==null&&(gi(o,h,_,d),oh(o,h,_))},enqueueForceUpdate:function(h,o){h=h._reactInternals;var c=R(),d=yi(h),_=mh(c,d);_.tag=2,o!=null&&(_.callback=o),o=nh(h,_,d),o!==null&&(gi(o,h,d,c),oh(o,h,d))}};function Fi(h,o,c,d,_,b,_e){return h=h.stateNode,typeof h.shouldComponentUpdate=="function"?h.shouldComponentUpdate(d,b,_e):o.prototype&&o.prototype.isPureReactComponent?!Ie(c,d)||!Ie(_,b):!0}function Gi(h,o,c){var d=!1,_=Vf,b=o.contextType;return typeof b=="object"&&b!==null?b=eh(b):(_=Zf(o)?Xf:H.current,d=o.contextTypes,b=(d=d!=null)?Yf(h,_):Vf),o=new o(c,b),h.memoizedState=o.state!==null&&o.state!==void 0?o.state:null,o.updater=Ei,h.stateNode=o,o._reactInternals=h,d&&(h=h.stateNode,h.__reactInternalMemoizedUnmaskedChildContext=_,h.__reactInternalMemoizedMaskedChildContext=b),o}function Hi(h,o,c,d){h=o.state,typeof o.componentWillReceiveProps=="function"&&o.componentWillReceiveProps(c,d),typeof o.UNSAFE_componentWillReceiveProps=="function"&&o.UNSAFE_componentWillReceiveProps(c,d),o.state!==h&&Ei.enqueueReplaceState(o,o.state,null)}function Ii(h,o,c,d){var _=h.stateNode;_.props=c,_.state=h.memoizedState,_.refs={},kh(h);var b=o.contextType;typeof b=="object"&&b!==null?_.context=eh(b):(b=Zf(o)?Xf:H.current,_.context=Yf(h,b)),_.state=h.memoizedState,b=o.getDerivedStateFromProps,typeof b=="function"&&(Di(h,o,b,c),_.state=h.memoizedState),typeof o.getDerivedStateFromProps=="function"||typeof _.getSnapshotBeforeUpdate=="function"||typeof _.UNSAFE_componentWillMount!="function"&&typeof _.componentWillMount!="function"||(o=_.state,typeof _.componentWillMount=="function"&&_.componentWillMount(),typeof _.UNSAFE_componentWillMount=="function"&&_.UNSAFE_componentWillMount(),o!==_.state&&Ei.enqueueReplaceState(_,_.state,null),qh(h,c,_,d),_.state=h.memoizedState),typeof _.componentDidMount=="function"&&(h.flags|=4194308)}function Ji(h,o){try{var c="",d=o;do c+=Pa(d),d=d.return;while(d);var _=c}catch(b){_=`
Error generating stack: `+b.message+`
`+b.stack}return{value:h,source:o,stack:_,digest:null}}function Ki(h,o,c){return{value:h,source:null,stack:c??null,digest:o??null}}function Li(h,o){try{console.error(o.value)}catch(c){setTimeout(function(){throw c})}}var Mi=typeof WeakMap=="function"?WeakMap:Map;function Ni(h,o,c){c=mh(-1,c),c.tag=3,c.payload={element:null};var d=o.value;return c.callback=function(){Oi||(Oi=!0,Pi=d),Li(h,o)},c}function Qi(h,o,c){c=mh(-1,c),c.tag=3;var d=h.type.getDerivedStateFromError;if(typeof d=="function"){var _=o.value;c.payload=function(){return d(_)},c.callback=function(){Li(h,o)}}var b=h.stateNode;return b!==null&&typeof b.componentDidCatch=="function"&&(c.callback=function(){Li(h,o),typeof d!="function"&&(Ri===null?Ri=new Set([this]):Ri.add(this));var _e=o.stack;this.componentDidCatch(o.value,{componentStack:_e!==null?_e:""})}),c}function Si(h,o,c){var d=h.pingCache;if(d===null){d=h.pingCache=new Mi;var _=new Set;d.set(o,_)}else _=d.get(o),_===void 0&&(_=new Set,d.set(o,_));_.has(c)||(_.add(c),h=Ti.bind(null,h,o,c),o.then(h,h))}function Ui(h){do{var o;if((o=h.tag===13)&&(o=h.memoizedState,o=o!==null?o.dehydrated!==null:!0),o)return h;h=h.return}while(h!==null);return null}function Vi(h,o,c,d,_){return h.mode&1?(h.flags|=65536,h.lanes=_,h):(h===o?h.flags|=65536:(h.flags|=128,c.flags|=131072,c.flags&=-52805,c.tag===1&&(c.alternate===null?c.tag=17:(o=mh(-1,1),o.tag=2,nh(c,o,1))),c.lanes|=1),h)}var Wi=ua.ReactCurrentOwner,dh=!1;function Xi(h,o,c,d){o.child=h===null?Vg(o,null,c,d):Ug(o,h.child,c,d)}function Yi(h,o,c,d,_){c=c.render;var b=o.ref;return ch(o,_),d=Nh(h,o,c,d,b,_),c=Sh(),h!==null&&!dh?(o.updateQueue=h.updateQueue,o.flags&=-2053,h.lanes&=~_,Zi(h,o,_)):(I&&c&&vg(o),o.flags|=1,Xi(h,o,d,_),o.child)}function $i(h,o,c,d,_){if(h===null){var b=c.type;return typeof b=="function"&&!aj(b)&&b.defaultProps===void 0&&c.compare===null&&c.defaultProps===void 0?(o.tag=15,o.type=b,bj(h,o,b,d,_)):(h=Rg(c.type,null,d,o,o.mode,_),h.ref=o.ref,h.return=o,o.child=h)}if(b=h.child,!(h.lanes&_)){var _e=b.memoizedProps;if(c=c.compare,c=c!==null?c:Ie,c(_e,d)&&h.ref===o.ref)return Zi(h,o,_)}return o.flags|=1,h=Pg(b,d),h.ref=o.ref,h.return=o,o.child=h}function bj(h,o,c,d,_){if(h!==null){var b=h.memoizedProps;if(Ie(b,d)&&h.ref===o.ref)if(dh=!1,o.pendingProps=d=b,(h.lanes&_)!==0)h.flags&131072&&(dh=!0);else return o.lanes=h.lanes,Zi(h,o,_)}return cj(h,o,c,d,_)}function dj(h,o,c){var d=o.pendingProps,_=d.children,b=h!==null?h.memoizedState:null;if(d.mode==="hidden")if(!(o.mode&1))o.memoizedState={baseLanes:0,cachePool:null,transitions:null},G(ej,fj),fj|=c;else{if(!(c&1073741824))return h=b!==null?b.baseLanes|c:c,o.lanes=o.childLanes=1073741824,o.memoizedState={baseLanes:h,cachePool:null,transitions:null},o.updateQueue=null,G(ej,fj),fj|=h,null;o.memoizedState={baseLanes:0,cachePool:null,transitions:null},d=b!==null?b.baseLanes:c,G(ej,fj),fj|=d}else b!==null?(d=b.baseLanes|c,o.memoizedState=null):d=c,G(ej,fj),fj|=d;return Xi(h,o,_,c),o.child}function gj(h,o){var c=o.ref;(h===null&&c!==null||h!==null&&h.ref!==c)&&(o.flags|=512,o.flags|=2097152)}function cj(h,o,c,d,_){var b=Zf(c)?Xf:H.current;return b=Yf(o,b),ch(o,_),c=Nh(h,o,c,d,b,_),d=Sh(),h!==null&&!dh?(o.updateQueue=h.updateQueue,o.flags&=-2053,h.lanes&=~_,Zi(h,o,_)):(I&&d&&vg(o),o.flags|=1,Xi(h,o,c,_),o.child)}function hj(h,o,c,d,_){if(Zf(c)){var b=!0;cg(o)}else b=!1;if(ch(o,_),o.stateNode===null)ij(h,o),Gi(o,c,d),Ii(o,c,d,_),d=!0;else if(h===null){var _e=o.stateNode,it=o.memoizedProps;_e.props=it;var nt=_e.context,at=c.contextType;typeof at=="object"&&at!==null?at=eh(at):(at=Zf(c)?Xf:H.current,at=Yf(o,at));var ut=c.getDerivedStateFromProps,pt=typeof ut=="function"||typeof _e.getSnapshotBeforeUpdate=="function";pt||typeof _e.UNSAFE_componentWillReceiveProps!="function"&&typeof _e.componentWillReceiveProps!="function"||(it!==d||nt!==at)&&Hi(o,_e,d,at),jh=!1;var mt=o.memoizedState;_e.state=mt,qh(o,d,_e,_),nt=o.memoizedState,it!==d||mt!==nt||Wf.current||jh?(typeof ut=="function"&&(Di(o,c,ut,d),nt=o.memoizedState),(it=jh||Fi(o,c,it,d,mt,nt,at))?(pt||typeof _e.UNSAFE_componentWillMount!="function"&&typeof _e.componentWillMount!="function"||(typeof _e.componentWillMount=="function"&&_e.componentWillMount(),typeof _e.UNSAFE_componentWillMount=="function"&&_e.UNSAFE_componentWillMount()),typeof _e.componentDidMount=="function"&&(o.flags|=4194308)):(typeof _e.componentDidMount=="function"&&(o.flags|=4194308),o.memoizedProps=d,o.memoizedState=nt),_e.props=d,_e.state=nt,_e.context=at,d=it):(typeof _e.componentDidMount=="function"&&(o.flags|=4194308),d=!1)}else{_e=o.stateNode,lh(h,o),it=o.memoizedProps,at=o.type===o.elementType?it:Ci(o.type,it),_e.props=at,pt=o.pendingProps,mt=_e.context,nt=c.contextType,typeof nt=="object"&&nt!==null?nt=eh(nt):(nt=Zf(c)?Xf:H.current,nt=Yf(o,nt));var ft=c.getDerivedStateFromProps;(ut=typeof ft=="function"||typeof _e.getSnapshotBeforeUpdate=="function")||typeof _e.UNSAFE_componentWillReceiveProps!="function"&&typeof _e.componentWillReceiveProps!="function"||(it!==pt||mt!==nt)&&Hi(o,_e,d,nt),jh=!1,mt=o.memoizedState,_e.state=mt,qh(o,d,_e,_);var vt=o.memoizedState;it!==pt||mt!==vt||Wf.current||jh?(typeof ft=="function"&&(Di(o,c,ft,d),vt=o.memoizedState),(at=jh||Fi(o,c,at,d,mt,vt,nt)||!1)?(ut||typeof _e.UNSAFE_componentWillUpdate!="function"&&typeof _e.componentWillUpdate!="function"||(typeof _e.componentWillUpdate=="function"&&_e.componentWillUpdate(d,vt,nt),typeof _e.UNSAFE_componentWillUpdate=="function"&&_e.UNSAFE_componentWillUpdate(d,vt,nt)),typeof _e.componentDidUpdate=="function"&&(o.flags|=4),typeof _e.getSnapshotBeforeUpdate=="function"&&(o.flags|=1024)):(typeof _e.componentDidUpdate!="function"||it===h.memoizedProps&&mt===h.memoizedState||(o.flags|=4),typeof _e.getSnapshotBeforeUpdate!="function"||it===h.memoizedProps&&mt===h.memoizedState||(o.flags|=1024),o.memoizedProps=d,o.memoizedState=vt),_e.props=d,_e.state=vt,_e.context=nt,d=at):(typeof _e.componentDidUpdate!="function"||it===h.memoizedProps&&mt===h.memoizedState||(o.flags|=4),typeof _e.getSnapshotBeforeUpdate!="function"||it===h.memoizedProps&&mt===h.memoizedState||(o.flags|=1024),d=!1)}return jj(h,o,c,d,b,_)}function jj(h,o,c,d,_,b){gj(h,o);var _e=(o.flags&128)!==0;if(!d&&!_e)return _&&dg(o,c,!1),Zi(h,o,b);d=o.stateNode,Wi.current=o;var it=_e&&typeof c.getDerivedStateFromError!="function"?null:d.render();return o.flags|=1,h!==null&&_e?(o.child=Ug(o,h.child,null,b),o.child=Ug(o,null,it,b)):Xi(h,o,it,b),o.memoizedState=d.state,_&&dg(o,c,!0),o.child}function kj(h){var o=h.stateNode;o.pendingContext?ag(h,o.pendingContext,o.pendingContext!==o.context):o.context&&ag(h,o.context,!1),yh(h,o.containerInfo)}function lj(h,o,c,d,_){return Ig(),Jg(_),o.flags|=256,Xi(h,o,c,d),o.child}var mj={dehydrated:null,treeContext:null,retryLane:0};function nj(h){return{baseLanes:h,cachePool:null,transitions:null}}function oj(h,o,c){var d=o.pendingProps,_=L.current,b=!1,_e=(o.flags&128)!==0,it;if((it=_e)||(it=h!==null&&h.memoizedState===null?!1:(_&2)!==0),it?(b=!0,o.flags&=-129):(h===null||h.memoizedState!==null)&&(_|=1),G(L,_&1),h===null)return Eg(o),h=o.memoizedState,h!==null&&(h=h.dehydrated,h!==null)?(o.mode&1?h.data==="$!"?o.lanes=8:o.lanes=1073741824:o.lanes=1,null):(_e=d.children,h=d.fallback,b?(d=o.mode,b=o.child,_e={mode:"hidden",children:_e},!(d&1)&&b!==null?(b.childLanes=0,b.pendingProps=_e):b=pj(_e,d,0,null),h=Tg(h,d,c,null),b.return=o,h.return=o,b.sibling=h,o.child=b,o.child.memoizedState=nj(c),o.memoizedState=mj,h):qj(o,_e));if(_=h.memoizedState,_!==null&&(it=_.dehydrated,it!==null))return rj(h,o,_e,d,it,_,c);if(b){b=d.fallback,_e=o.mode,_=h.child,it=_.sibling;var nt={mode:"hidden",children:d.children};return!(_e&1)&&o.child!==_?(d=o.child,d.childLanes=0,d.pendingProps=nt,o.deletions=null):(d=Pg(_,nt),d.subtreeFlags=_.subtreeFlags&14680064),it!==null?b=Pg(it,b):(b=Tg(b,_e,c,null),b.flags|=2),b.return=o,d.return=o,d.sibling=b,o.child=d,d=b,b=o.child,_e=h.child.memoizedState,_e=_e===null?nj(c):{baseLanes:_e.baseLanes|c,cachePool:null,transitions:_e.transitions},b.memoizedState=_e,b.childLanes=h.childLanes&~c,o.memoizedState=mj,d}return b=h.child,h=b.sibling,d=Pg(b,{mode:"visible",children:d.children}),!(o.mode&1)&&(d.lanes=c),d.return=o,d.sibling=null,h!==null&&(c=o.deletions,c===null?(o.deletions=[h],o.flags|=16):c.push(h)),o.child=d,o.memoizedState=null,d}function qj(h,o){return o=pj({mode:"visible",children:o},h.mode,0,null),o.return=h,h.child=o}function sj(h,o,c,d){return d!==null&&Jg(d),Ug(o,h.child,null,c),h=qj(o,o.pendingProps.children),h.flags|=2,o.memoizedState=null,h}function rj(h,o,c,d,_,b,_e){if(c)return o.flags&256?(o.flags&=-257,d=Ki(Error(p(422))),sj(h,o,_e,d)):o.memoizedState!==null?(o.child=h.child,o.flags|=128,null):(b=d.fallback,_=o.mode,d=pj({mode:"visible",children:d.children},_,0,null),b=Tg(b,_,_e,null),b.flags|=2,d.return=o,b.return=o,d.sibling=b,o.child=d,o.mode&1&&Ug(o,h.child,null,_e),o.child.memoizedState=nj(_e),o.memoizedState=mj,b);if(!(o.mode&1))return sj(h,o,_e,null);if(_.data==="$!"){if(d=_.nextSibling&&_.nextSibling.dataset,d)var it=d.dgst;return d=it,b=Error(p(419)),d=Ki(b,d,void 0),sj(h,o,_e,d)}if(it=(_e&h.childLanes)!==0,dh||it){if(d=Q,d!==null){switch(_e&-_e){case 4:_=2;break;case 16:_=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:_=32;break;case 536870912:_=268435456;break;default:_=0}_=_&(d.suspendedLanes|_e)?0:_,_!==0&&_!==b.retryLane&&(b.retryLane=_,ih(h,_),gi(d,h,_,-1))}return tj(),d=Ki(Error(p(421))),sj(h,o,_e,d)}return _.data==="$?"?(o.flags|=128,o.child=h.child,o=uj.bind(null,h),_._reactRetry=o,null):(h=b.treeContext,yg=Lf(_.nextSibling),xg=o,I=!0,zg=null,h!==null&&(og[pg++]=rg,og[pg++]=sg,og[pg++]=qg,rg=h.id,sg=h.overflow,qg=o),o=qj(o,d.children),o.flags|=4096,o)}function vj(h,o,c){h.lanes|=o;var d=h.alternate;d!==null&&(d.lanes|=o),bh(h.return,o,c)}function wj(h,o,c,d,_){var b=h.memoizedState;b===null?h.memoizedState={isBackwards:o,rendering:null,renderingStartTime:0,last:d,tail:c,tailMode:_}:(b.isBackwards=o,b.rendering=null,b.renderingStartTime=0,b.last=d,b.tail=c,b.tailMode=_)}function xj(h,o,c){var d=o.pendingProps,_=d.revealOrder,b=d.tail;if(Xi(h,o,d.children,c),d=L.current,d&2)d=d&1|2,o.flags|=128;else{if(h!==null&&h.flags&128)e:for(h=o.child;h!==null;){if(h.tag===13)h.memoizedState!==null&&vj(h,c,o);else if(h.tag===19)vj(h,c,o);else if(h.child!==null){h.child.return=h,h=h.child;continue}if(h===o)break e;for(;h.sibling===null;){if(h.return===null||h.return===o)break e;h=h.return}h.sibling.return=h.return,h=h.sibling}d&=1}if(G(L,d),!(o.mode&1))o.memoizedState=null;else switch(_){case"forwards":for(c=o.child,_=null;c!==null;)h=c.alternate,h!==null&&Ch(h)===null&&(_=c),c=c.sibling;c=_,c===null?(_=o.child,o.child=null):(_=c.sibling,c.sibling=null),wj(o,!1,_,c,b);break;case"backwards":for(c=null,_=o.child,o.child=null;_!==null;){if(h=_.alternate,h!==null&&Ch(h)===null){o.child=_;break}h=_.sibling,_.sibling=c,c=_,_=h}wj(o,!0,c,null,b);break;case"together":wj(o,!1,null,null,void 0);break;default:o.memoizedState=null}return o.child}function ij(h,o){!(o.mode&1)&&h!==null&&(h.alternate=null,o.alternate=null,o.flags|=2)}function Zi(h,o,c){if(h!==null&&(o.dependencies=h.dependencies),rh|=o.lanes,!(c&o.childLanes))return null;if(h!==null&&o.child!==h.child)throw Error(p(153));if(o.child!==null){for(h=o.child,c=Pg(h,h.pendingProps),o.child=c,c.return=o;h.sibling!==null;)h=h.sibling,c=c.sibling=Pg(h,h.pendingProps),c.return=o;c.sibling=null}return o.child}function yj(h,o,c){switch(o.tag){case 3:kj(o),Ig();break;case 5:Ah(o);break;case 1:Zf(o.type)&&cg(o);break;case 4:yh(o,o.stateNode.containerInfo);break;case 10:var d=o.type._context,_=o.memoizedProps.value;G(Wg,d._currentValue),d._currentValue=_;break;case 13:if(d=o.memoizedState,d!==null)return d.dehydrated!==null?(G(L,L.current&1),o.flags|=128,null):c&o.child.childLanes?oj(h,o,c):(G(L,L.current&1),h=Zi(h,o,c),h!==null?h.sibling:null);G(L,L.current&1);break;case 19:if(d=(c&o.childLanes)!==0,h.flags&128){if(d)return xj(h,o,c);o.flags|=128}if(_=o.memoizedState,_!==null&&(_.rendering=null,_.tail=null,_.lastEffect=null),G(L,L.current),d)break;return null;case 22:case 23:return o.lanes=0,dj(h,o,c)}return Zi(h,o,c)}var zj,Aj,Bj,Cj;zj=function(h,o){for(var c=o.child;c!==null;){if(c.tag===5||c.tag===6)h.appendChild(c.stateNode);else if(c.tag!==4&&c.child!==null){c.child.return=c,c=c.child;continue}if(c===o)break;for(;c.sibling===null;){if(c.return===null||c.return===o)return;c=c.return}c.sibling.return=c.return,c=c.sibling}};Aj=function(){};Bj=function(h,o,c,d){var _=h.memoizedProps;if(_!==d){h=o.stateNode,xh(uh.current);var b=null;switch(c){case"input":_=Ya(h,_),d=Ya(h,d),b=[];break;case"select":_=A({},_,{value:void 0}),d=A({},d,{value:void 0}),b=[];break;case"textarea":_=gb(h,_),d=gb(h,d),b=[];break;default:typeof _.onClick!="function"&&typeof d.onClick=="function"&&(h.onclick=Bf)}ub(c,d);var _e;c=null;for(at in _)if(!d.hasOwnProperty(at)&&_.hasOwnProperty(at)&&_[at]!=null)if(at==="style"){var it=_[at];for(_e in it)it.hasOwnProperty(_e)&&(c||(c={}),c[_e]="")}else at!=="dangerouslySetInnerHTML"&&at!=="children"&&at!=="suppressContentEditableWarning"&&at!=="suppressHydrationWarning"&&at!=="autoFocus"&&(ea.hasOwnProperty(at)?b||(b=[]):(b=b||[]).push(at,null));for(at in d){var nt=d[at];if(it=_!=null?_[at]:void 0,d.hasOwnProperty(at)&&nt!==it&&(nt!=null||it!=null))if(at==="style")if(it){for(_e in it)!it.hasOwnProperty(_e)||nt&&nt.hasOwnProperty(_e)||(c||(c={}),c[_e]="");for(_e in nt)nt.hasOwnProperty(_e)&&it[_e]!==nt[_e]&&(c||(c={}),c[_e]=nt[_e])}else c||(b||(b=[]),b.push(at,c)),c=nt;else at==="dangerouslySetInnerHTML"?(nt=nt?nt.__html:void 0,it=it?it.__html:void 0,nt!=null&&it!==nt&&(b=b||[]).push(at,nt)):at==="children"?typeof nt!="string"&&typeof nt!="number"||(b=b||[]).push(at,""+nt):at!=="suppressContentEditableWarning"&&at!=="suppressHydrationWarning"&&(ea.hasOwnProperty(at)?(nt!=null&&at==="onScroll"&&D("scroll",h),b||it===nt||(b=[])):(b=b||[]).push(at,nt))}c&&(b=b||[]).push("style",c);var at=b;(o.updateQueue=at)&&(o.flags|=4)}};Cj=function(h,o,c,d){c!==d&&(o.flags|=4)};function Dj(h,o){if(!I)switch(h.tailMode){case"hidden":o=h.tail;for(var c=null;o!==null;)o.alternate!==null&&(c=o),o=o.sibling;c===null?h.tail=null:c.sibling=null;break;case"collapsed":c=h.tail;for(var d=null;c!==null;)c.alternate!==null&&(d=c),c=c.sibling;d===null?o||h.tail===null?h.tail=null:h.tail.sibling=null:d.sibling=null}}function S(h){var o=h.alternate!==null&&h.alternate.child===h.child,c=0,d=0;if(o)for(var _=h.child;_!==null;)c|=_.lanes|_.childLanes,d|=_.subtreeFlags&14680064,d|=_.flags&14680064,_.return=h,_=_.sibling;else for(_=h.child;_!==null;)c|=_.lanes|_.childLanes,d|=_.subtreeFlags,d|=_.flags,_.return=h,_=_.sibling;return h.subtreeFlags|=d,h.childLanes=c,o}function Ej(h,o,c){var d=o.pendingProps;switch(wg(o),o.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return S(o),null;case 1:return Zf(o.type)&&$f(),S(o),null;case 3:return d=o.stateNode,zh(),E(Wf),E(H),Eh(),d.pendingContext&&(d.context=d.pendingContext,d.pendingContext=null),(h===null||h.child===null)&&(Gg(o)?o.flags|=4:h===null||h.memoizedState.isDehydrated&&!(o.flags&256)||(o.flags|=1024,zg!==null&&(Fj(zg),zg=null))),Aj(h,o),S(o),null;case 5:Bh(o);var _=xh(wh.current);if(c=o.type,h!==null&&o.stateNode!=null)Bj(h,o,c,d,_),h.ref!==o.ref&&(o.flags|=512,o.flags|=2097152);else{if(!d){if(o.stateNode===null)throw Error(p(166));return S(o),null}if(h=xh(uh.current),Gg(o)){d=o.stateNode,c=o.type;var b=o.memoizedProps;switch(d[Of]=o,d[Pf]=b,h=(o.mode&1)!==0,c){case"dialog":D("cancel",d),D("close",d);break;case"iframe":case"object":case"embed":D("load",d);break;case"video":case"audio":for(_=0;_<lf.length;_++)D(lf[_],d);break;case"source":D("error",d);break;case"img":case"image":case"link":D("error",d),D("load",d);break;case"details":D("toggle",d);break;case"input":Za(d,b),D("invalid",d);break;case"select":d._wrapperState={wasMultiple:!!b.multiple},D("invalid",d);break;case"textarea":hb(d,b),D("invalid",d)}ub(c,b),_=null;for(var _e in b)if(b.hasOwnProperty(_e)){var it=b[_e];_e==="children"?typeof it=="string"?d.textContent!==it&&(b.suppressHydrationWarning!==!0&&Af(d.textContent,it,h),_=["children",it]):typeof it=="number"&&d.textContent!==""+it&&(b.suppressHydrationWarning!==!0&&Af(d.textContent,it,h),_=["children",""+it]):ea.hasOwnProperty(_e)&&it!=null&&_e==="onScroll"&&D("scroll",d)}switch(c){case"input":Va(d),db(d,b,!0);break;case"textarea":Va(d),jb(d);break;case"select":case"option":break;default:typeof b.onClick=="function"&&(d.onclick=Bf)}d=_,o.updateQueue=d,d!==null&&(o.flags|=4)}else{_e=_.nodeType===9?_:_.ownerDocument,h==="http://www.w3.org/1999/xhtml"&&(h=kb(c)),h==="http://www.w3.org/1999/xhtml"?c==="script"?(h=_e.createElement("div"),h.innerHTML="<script><\/script>",h=h.removeChild(h.firstChild)):typeof d.is=="string"?h=_e.createElement(c,{is:d.is}):(h=_e.createElement(c),c==="select"&&(_e=h,d.multiple?_e.multiple=!0:d.size&&(_e.size=d.size))):h=_e.createElementNS(h,c),h[Of]=o,h[Pf]=d,zj(h,o,!1,!1),o.stateNode=h;e:{switch(_e=vb(c,d),c){case"dialog":D("cancel",h),D("close",h),_=d;break;case"iframe":case"object":case"embed":D("load",h),_=d;break;case"video":case"audio":for(_=0;_<lf.length;_++)D(lf[_],h);_=d;break;case"source":D("error",h),_=d;break;case"img":case"image":case"link":D("error",h),D("load",h),_=d;break;case"details":D("toggle",h),_=d;break;case"input":Za(h,d),_=Ya(h,d),D("invalid",h);break;case"option":_=d;break;case"select":h._wrapperState={wasMultiple:!!d.multiple},_=A({},d,{value:void 0}),D("invalid",h);break;case"textarea":hb(h,d),_=gb(h,d),D("invalid",h);break;default:_=d}ub(c,_),it=_;for(b in it)if(it.hasOwnProperty(b)){var nt=it[b];b==="style"?sb(h,nt):b==="dangerouslySetInnerHTML"?(nt=nt?nt.__html:void 0,nt!=null&&nb(h,nt)):b==="children"?typeof nt=="string"?(c!=="textarea"||nt!=="")&&ob(h,nt):typeof nt=="number"&&ob(h,""+nt):b!=="suppressContentEditableWarning"&&b!=="suppressHydrationWarning"&&b!=="autoFocus"&&(ea.hasOwnProperty(b)?nt!=null&&b==="onScroll"&&D("scroll",h):nt!=null&&ta(h,b,nt,_e))}switch(c){case"input":Va(h),db(h,d,!1);break;case"textarea":Va(h),jb(h);break;case"option":d.value!=null&&h.setAttribute("value",""+Sa(d.value));break;case"select":h.multiple=!!d.multiple,b=d.value,b!=null?fb(h,!!d.multiple,b,!1):d.defaultValue!=null&&fb(h,!!d.multiple,d.defaultValue,!0);break;default:typeof _.onClick=="function"&&(h.onclick=Bf)}switch(c){case"button":case"input":case"select":case"textarea":d=!!d.autoFocus;break e;case"img":d=!0;break e;default:d=!1}}d&&(o.flags|=4)}o.ref!==null&&(o.flags|=512,o.flags|=2097152)}return S(o),null;case 6:if(h&&o.stateNode!=null)Cj(h,o,h.memoizedProps,d);else{if(typeof d!="string"&&o.stateNode===null)throw Error(p(166));if(c=xh(wh.current),xh(uh.current),Gg(o)){if(d=o.stateNode,c=o.memoizedProps,d[Of]=o,(b=d.nodeValue!==c)&&(h=xg,h!==null))switch(h.tag){case 3:Af(d.nodeValue,c,(h.mode&1)!==0);break;case 5:h.memoizedProps.suppressHydrationWarning!==!0&&Af(d.nodeValue,c,(h.mode&1)!==0)}b&&(o.flags|=4)}else d=(c.nodeType===9?c:c.ownerDocument).createTextNode(d),d[Of]=o,o.stateNode=d}return S(o),null;case 13:if(E(L),d=o.memoizedState,h===null||h.memoizedState!==null&&h.memoizedState.dehydrated!==null){if(I&&yg!==null&&o.mode&1&&!(o.flags&128))Hg(),Ig(),o.flags|=98560,b=!1;else if(b=Gg(o),d!==null&&d.dehydrated!==null){if(h===null){if(!b)throw Error(p(318));if(b=o.memoizedState,b=b!==null?b.dehydrated:null,!b)throw Error(p(317));b[Of]=o}else Ig(),!(o.flags&128)&&(o.memoizedState=null),o.flags|=4;S(o),b=!1}else zg!==null&&(Fj(zg),zg=null),b=!0;if(!b)return o.flags&65536?o:null}return o.flags&128?(o.lanes=c,o):(d=d!==null,d!==(h!==null&&h.memoizedState!==null)&&d&&(o.child.flags|=8192,o.mode&1&&(h===null||L.current&1?T===0&&(T=3):tj())),o.updateQueue!==null&&(o.flags|=4),S(o),null);case 4:return zh(),Aj(h,o),h===null&&sf(o.stateNode.containerInfo),S(o),null;case 10:return ah(o.type._context),S(o),null;case 17:return Zf(o.type)&&$f(),S(o),null;case 19:if(E(L),b=o.memoizedState,b===null)return S(o),null;if(d=(o.flags&128)!==0,_e=b.rendering,_e===null)if(d)Dj(b,!1);else{if(T!==0||h!==null&&h.flags&128)for(h=o.child;h!==null;){if(_e=Ch(h),_e!==null){for(o.flags|=128,Dj(b,!1),d=_e.updateQueue,d!==null&&(o.updateQueue=d,o.flags|=4),o.subtreeFlags=0,d=c,c=o.child;c!==null;)b=c,h=d,b.flags&=14680066,_e=b.alternate,_e===null?(b.childLanes=0,b.lanes=h,b.child=null,b.subtreeFlags=0,b.memoizedProps=null,b.memoizedState=null,b.updateQueue=null,b.dependencies=null,b.stateNode=null):(b.childLanes=_e.childLanes,b.lanes=_e.lanes,b.child=_e.child,b.subtreeFlags=0,b.deletions=null,b.memoizedProps=_e.memoizedProps,b.memoizedState=_e.memoizedState,b.updateQueue=_e.updateQueue,b.type=_e.type,h=_e.dependencies,b.dependencies=h===null?null:{lanes:h.lanes,firstContext:h.firstContext}),c=c.sibling;return G(L,L.current&1|2),o.child}h=h.sibling}b.tail!==null&&B()>Gj&&(o.flags|=128,d=!0,Dj(b,!1),o.lanes=4194304)}else{if(!d)if(h=Ch(_e),h!==null){if(o.flags|=128,d=!0,c=h.updateQueue,c!==null&&(o.updateQueue=c,o.flags|=4),Dj(b,!0),b.tail===null&&b.tailMode==="hidden"&&!_e.alternate&&!I)return S(o),null}else 2*B()-b.renderingStartTime>Gj&&c!==1073741824&&(o.flags|=128,d=!0,Dj(b,!1),o.lanes=4194304);b.isBackwards?(_e.sibling=o.child,o.child=_e):(c=b.last,c!==null?c.sibling=_e:o.child=_e,b.last=_e)}return b.tail!==null?(o=b.tail,b.rendering=o,b.tail=o.sibling,b.renderingStartTime=B(),o.sibling=null,c=L.current,G(L,d?c&1|2:c&1),o):(S(o),null);case 22:case 23:return Hj(),d=o.memoizedState!==null,h!==null&&h.memoizedState!==null!==d&&(o.flags|=8192),d&&o.mode&1?fj&1073741824&&(S(o),o.subtreeFlags&6&&(o.flags|=8192)):S(o),null;case 24:return null;case 25:return null}throw Error(p(156,o.tag))}function Ij(h,o){switch(wg(o),o.tag){case 1:return Zf(o.type)&&$f(),h=o.flags,h&65536?(o.flags=h&-65537|128,o):null;case 3:return zh(),E(Wf),E(H),Eh(),h=o.flags,h&65536&&!(h&128)?(o.flags=h&-65537|128,o):null;case 5:return Bh(o),null;case 13:if(E(L),h=o.memoizedState,h!==null&&h.dehydrated!==null){if(o.alternate===null)throw Error(p(340));Ig()}return h=o.flags,h&65536?(o.flags=h&-65537|128,o):null;case 19:return E(L),null;case 4:return zh(),null;case 10:return ah(o.type._context),null;case 22:case 23:return Hj(),null;case 24:return null;default:return null}}var Jj=!1,U=!1,Kj=typeof WeakSet=="function"?WeakSet:Set,V=null;function Lj(h,o){var c=h.ref;if(c!==null)if(typeof c=="function")try{c(null)}catch(d){W(h,o,d)}else c.current=null}function Mj(h,o,c){try{c()}catch(d){W(h,o,d)}}var Nj=!1;function Oj(h,o){if(Cf=dd,h=Me(),Ne(h)){if("selectionStart"in h)var c={start:h.selectionStart,end:h.selectionEnd};else e:{c=(c=h.ownerDocument)&&c.defaultView||window;var d=c.getSelection&&c.getSelection();if(d&&d.rangeCount!==0){c=d.anchorNode;var _=d.anchorOffset,b=d.focusNode;d=d.focusOffset;try{c.nodeType,b.nodeType}catch{c=null;break e}var _e=0,it=-1,nt=-1,at=0,ut=0,pt=h,mt=null;t:for(;;){for(var ft;pt!==c||_!==0&&pt.nodeType!==3||(it=_e+_),pt!==b||d!==0&&pt.nodeType!==3||(nt=_e+d),pt.nodeType===3&&(_e+=pt.nodeValue.length),(ft=pt.firstChild)!==null;)mt=pt,pt=ft;for(;;){if(pt===h)break t;if(mt===c&&++at===_&&(it=_e),mt===b&&++ut===d&&(nt=_e),(ft=pt.nextSibling)!==null)break;pt=mt,mt=pt.parentNode}pt=ft}c=it===-1||nt===-1?null:{start:it,end:nt}}else c=null}c=c||{start:0,end:0}}else c=null;for(Df={focusedElem:h,selectionRange:c},dd=!1,V=o;V!==null;)if(o=V,h=o.child,(o.subtreeFlags&1028)!==0&&h!==null)h.return=o,V=h;else for(;V!==null;){o=V;try{var vt=o.alternate;if(o.flags&1024)switch(o.tag){case 0:case 11:case 15:break;case 1:if(vt!==null){var xt=vt.memoizedProps,At=vt.memoizedState,Ct=o.stateNode,Et=Ct.getSnapshotBeforeUpdate(o.elementType===o.type?xt:Ci(o.type,xt),At);Ct.__reactInternalSnapshotBeforeUpdate=Et}break;case 3:var Tt=o.stateNode.containerInfo;Tt.nodeType===1?Tt.textContent="":Tt.nodeType===9&&Tt.documentElement&&Tt.removeChild(Tt.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(p(163))}}catch(kt){W(o,o.return,kt)}if(h=o.sibling,h!==null){h.return=o.return,V=h;break}V=o.return}return vt=Nj,Nj=!1,vt}function Pj(h,o,c){var d=o.updateQueue;if(d=d!==null?d.lastEffect:null,d!==null){var _=d=d.next;do{if((_.tag&h)===h){var b=_.destroy;_.destroy=void 0,b!==void 0&&Mj(o,c,b)}_=_.next}while(_!==d)}}function Qj(h,o){if(o=o.updateQueue,o=o!==null?o.lastEffect:null,o!==null){var c=o=o.next;do{if((c.tag&h)===h){var d=c.create;c.destroy=d()}c=c.next}while(c!==o)}}function Rj(h){var o=h.ref;if(o!==null){var c=h.stateNode;switch(h.tag){case 5:h=c;break;default:h=c}typeof o=="function"?o(h):o.current=h}}function Sj(h){var o=h.alternate;o!==null&&(h.alternate=null,Sj(o)),h.child=null,h.deletions=null,h.sibling=null,h.tag===5&&(o=h.stateNode,o!==null&&(delete o[Of],delete o[Pf],delete o[of],delete o[Qf],delete o[Rf])),h.stateNode=null,h.return=null,h.dependencies=null,h.memoizedProps=null,h.memoizedState=null,h.pendingProps=null,h.stateNode=null,h.updateQueue=null}function Tj(h){return h.tag===5||h.tag===3||h.tag===4}function Uj(h){e:for(;;){for(;h.sibling===null;){if(h.return===null||Tj(h.return))return null;h=h.return}for(h.sibling.return=h.return,h=h.sibling;h.tag!==5&&h.tag!==6&&h.tag!==18;){if(h.flags&2||h.child===null||h.tag===4)continue e;h.child.return=h,h=h.child}if(!(h.flags&2))return h.stateNode}}function Vj(h,o,c){var d=h.tag;if(d===5||d===6)h=h.stateNode,o?c.nodeType===8?c.parentNode.insertBefore(h,o):c.insertBefore(h,o):(c.nodeType===8?(o=c.parentNode,o.insertBefore(h,c)):(o=c,o.appendChild(h)),c=c._reactRootContainer,c!=null||o.onclick!==null||(o.onclick=Bf));else if(d!==4&&(h=h.child,h!==null))for(Vj(h,o,c),h=h.sibling;h!==null;)Vj(h,o,c),h=h.sibling}function Wj(h,o,c){var d=h.tag;if(d===5||d===6)h=h.stateNode,o?c.insertBefore(h,o):c.appendChild(h);else if(d!==4&&(h=h.child,h!==null))for(Wj(h,o,c),h=h.sibling;h!==null;)Wj(h,o,c),h=h.sibling}var X=null,Xj=!1;function Yj(h,o,c){for(c=c.child;c!==null;)Zj(h,o,c),c=c.sibling}function Zj(h,o,c){if(lc&&typeof lc.onCommitFiberUnmount=="function")try{lc.onCommitFiberUnmount(kc,c)}catch{}switch(c.tag){case 5:U||Lj(c,o);case 6:var d=X,_=Xj;X=null,Yj(h,o,c),X=d,Xj=_,X!==null&&(Xj?(h=X,c=c.stateNode,h.nodeType===8?h.parentNode.removeChild(c):h.removeChild(c)):X.removeChild(c.stateNode));break;case 18:X!==null&&(Xj?(h=X,c=c.stateNode,h.nodeType===8?Kf(h.parentNode,c):h.nodeType===1&&Kf(h,c),bd(h)):Kf(X,c.stateNode));break;case 4:d=X,_=Xj,X=c.stateNode.containerInfo,Xj=!0,Yj(h,o,c),X=d,Xj=_;break;case 0:case 11:case 14:case 15:if(!U&&(d=c.updateQueue,d!==null&&(d=d.lastEffect,d!==null))){_=d=d.next;do{var b=_,_e=b.destroy;b=b.tag,_e!==void 0&&(b&2||b&4)&&Mj(c,o,_e),_=_.next}while(_!==d)}Yj(h,o,c);break;case 1:if(!U&&(Lj(c,o),d=c.stateNode,typeof d.componentWillUnmount=="function"))try{d.props=c.memoizedProps,d.state=c.memoizedState,d.componentWillUnmount()}catch(it){W(c,o,it)}Yj(h,o,c);break;case 21:Yj(h,o,c);break;case 22:c.mode&1?(U=(d=U)||c.memoizedState!==null,Yj(h,o,c),U=d):Yj(h,o,c);break;default:Yj(h,o,c)}}function ak(h){var o=h.updateQueue;if(o!==null){h.updateQueue=null;var c=h.stateNode;c===null&&(c=h.stateNode=new Kj),o.forEach(function(d){var _=bk.bind(null,h,d);c.has(d)||(c.add(d),d.then(_,_))})}}function ck(h,o){var c=o.deletions;if(c!==null)for(var d=0;d<c.length;d++){var _=c[d];try{var b=h,_e=o,it=_e;e:for(;it!==null;){switch(it.tag){case 5:X=it.stateNode,Xj=!1;break e;case 3:X=it.stateNode.containerInfo,Xj=!0;break e;case 4:X=it.stateNode.containerInfo,Xj=!0;break e}it=it.return}if(X===null)throw Error(p(160));Zj(b,_e,_),X=null,Xj=!1;var nt=_.alternate;nt!==null&&(nt.return=null),_.return=null}catch(at){W(_,o,at)}}if(o.subtreeFlags&12854)for(o=o.child;o!==null;)dk(o,h),o=o.sibling}function dk(h,o){var c=h.alternate,d=h.flags;switch(h.tag){case 0:case 11:case 14:case 15:if(ck(o,h),ek(h),d&4){try{Pj(3,h,h.return),Qj(3,h)}catch(xt){W(h,h.return,xt)}try{Pj(5,h,h.return)}catch(xt){W(h,h.return,xt)}}break;case 1:ck(o,h),ek(h),d&512&&c!==null&&Lj(c,c.return);break;case 5:if(ck(o,h),ek(h),d&512&&c!==null&&Lj(c,c.return),h.flags&32){var _=h.stateNode;try{ob(_,"")}catch(xt){W(h,h.return,xt)}}if(d&4&&(_=h.stateNode,_!=null)){var b=h.memoizedProps,_e=c!==null?c.memoizedProps:b,it=h.type,nt=h.updateQueue;if(h.updateQueue=null,nt!==null)try{it==="input"&&b.type==="radio"&&b.name!=null&&ab(_,b),vb(it,_e);var at=vb(it,b);for(_e=0;_e<nt.length;_e+=2){var ut=nt[_e],pt=nt[_e+1];ut==="style"?sb(_,pt):ut==="dangerouslySetInnerHTML"?nb(_,pt):ut==="children"?ob(_,pt):ta(_,ut,pt,at)}switch(it){case"input":bb(_,b);break;case"textarea":ib(_,b);break;case"select":var mt=_._wrapperState.wasMultiple;_._wrapperState.wasMultiple=!!b.multiple;var ft=b.value;ft!=null?fb(_,!!b.multiple,ft,!1):mt!==!!b.multiple&&(b.defaultValue!=null?fb(_,!!b.multiple,b.defaultValue,!0):fb(_,!!b.multiple,b.multiple?[]:"",!1))}_[Pf]=b}catch(xt){W(h,h.return,xt)}}break;case 6:if(ck(o,h),ek(h),d&4){if(h.stateNode===null)throw Error(p(162));_=h.stateNode,b=h.memoizedProps;try{_.nodeValue=b}catch(xt){W(h,h.return,xt)}}break;case 3:if(ck(o,h),ek(h),d&4&&c!==null&&c.memoizedState.isDehydrated)try{bd(o.containerInfo)}catch(xt){W(h,h.return,xt)}break;case 4:ck(o,h),ek(h);break;case 13:ck(o,h),ek(h),_=h.child,_.flags&8192&&(b=_.memoizedState!==null,_.stateNode.isHidden=b,!b||_.alternate!==null&&_.alternate.memoizedState!==null||(fk=B())),d&4&&ak(h);break;case 22:if(ut=c!==null&&c.memoizedState!==null,h.mode&1?(U=(at=U)||ut,ck(o,h),U=at):ck(o,h),ek(h),d&8192){if(at=h.memoizedState!==null,(h.stateNode.isHidden=at)&&!ut&&h.mode&1)for(V=h,ut=h.child;ut!==null;){for(pt=V=ut;V!==null;){switch(mt=V,ft=mt.child,mt.tag){case 0:case 11:case 14:case 15:Pj(4,mt,mt.return);break;case 1:Lj(mt,mt.return);var vt=mt.stateNode;if(typeof vt.componentWillUnmount=="function"){d=mt,c=mt.return;try{o=d,vt.props=o.memoizedProps,vt.state=o.memoizedState,vt.componentWillUnmount()}catch(xt){W(d,c,xt)}}break;case 5:Lj(mt,mt.return);break;case 22:if(mt.memoizedState!==null){gk(pt);continue}}ft!==null?(ft.return=mt,V=ft):gk(pt)}ut=ut.sibling}e:for(ut=null,pt=h;;){if(pt.tag===5){if(ut===null){ut=pt;try{_=pt.stateNode,at?(b=_.style,typeof b.setProperty=="function"?b.setProperty("display","none","important"):b.display="none"):(it=pt.stateNode,nt=pt.memoizedProps.style,_e=nt!=null&&nt.hasOwnProperty("display")?nt.display:null,it.style.display=rb("display",_e))}catch(xt){W(h,h.return,xt)}}}else if(pt.tag===6){if(ut===null)try{pt.stateNode.nodeValue=at?"":pt.memoizedProps}catch(xt){W(h,h.return,xt)}}else if((pt.tag!==22&&pt.tag!==23||pt.memoizedState===null||pt===h)&&pt.child!==null){pt.child.return=pt,pt=pt.child;continue}if(pt===h)break e;for(;pt.sibling===null;){if(pt.return===null||pt.return===h)break e;ut===pt&&(ut=null),pt=pt.return}ut===pt&&(ut=null),pt.sibling.return=pt.return,pt=pt.sibling}}break;case 19:ck(o,h),ek(h),d&4&&ak(h);break;case 21:break;default:ck(o,h),ek(h)}}function ek(h){var o=h.flags;if(o&2){try{e:{for(var c=h.return;c!==null;){if(Tj(c)){var d=c;break e}c=c.return}throw Error(p(160))}switch(d.tag){case 5:var _=d.stateNode;d.flags&32&&(ob(_,""),d.flags&=-33);var b=Uj(h);Wj(h,b,_);break;case 3:case 4:var _e=d.stateNode.containerInfo,it=Uj(h);Vj(h,it,_e);break;default:throw Error(p(161))}}catch(nt){W(h,h.return,nt)}h.flags&=-3}o&4096&&(h.flags&=-4097)}function hk(h,o,c){V=h,ik(h)}function ik(h,o,c){for(var d=(h.mode&1)!==0;V!==null;){var _=V,b=_.child;if(_.tag===22&&d){var _e=_.memoizedState!==null||Jj;if(!_e){var it=_.alternate,nt=it!==null&&it.memoizedState!==null||U;it=Jj;var at=U;if(Jj=_e,(U=nt)&&!at)for(V=_;V!==null;)_e=V,nt=_e.child,_e.tag===22&&_e.memoizedState!==null?jk(_):nt!==null?(nt.return=_e,V=nt):jk(_);for(;b!==null;)V=b,ik(b),b=b.sibling;V=_,Jj=it,U=at}kk(h)}else _.subtreeFlags&8772&&b!==null?(b.return=_,V=b):kk(h)}}function kk(h){for(;V!==null;){var o=V;if(o.flags&8772){var c=o.alternate;try{if(o.flags&8772)switch(o.tag){case 0:case 11:case 15:U||Qj(5,o);break;case 1:var d=o.stateNode;if(o.flags&4&&!U)if(c===null)d.componentDidMount();else{var _=o.elementType===o.type?c.memoizedProps:Ci(o.type,c.memoizedProps);d.componentDidUpdate(_,c.memoizedState,d.__reactInternalSnapshotBeforeUpdate)}var b=o.updateQueue;b!==null&&sh(o,b,d);break;case 3:var _e=o.updateQueue;if(_e!==null){if(c=null,o.child!==null)switch(o.child.tag){case 5:c=o.child.stateNode;break;case 1:c=o.child.stateNode}sh(o,_e,c)}break;case 5:var it=o.stateNode;if(c===null&&o.flags&4){c=it;var nt=o.memoizedProps;switch(o.type){case"button":case"input":case"select":case"textarea":nt.autoFocus&&c.focus();break;case"img":nt.src&&(c.src=nt.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(o.memoizedState===null){var at=o.alternate;if(at!==null){var ut=at.memoizedState;if(ut!==null){var pt=ut.dehydrated;pt!==null&&bd(pt)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(p(163))}U||o.flags&512&&Rj(o)}catch(mt){W(o,o.return,mt)}}if(o===h){V=null;break}if(c=o.sibling,c!==null){c.return=o.return,V=c;break}V=o.return}}function gk(h){for(;V!==null;){var o=V;if(o===h){V=null;break}var c=o.sibling;if(c!==null){c.return=o.return,V=c;break}V=o.return}}function jk(h){for(;V!==null;){var o=V;try{switch(o.tag){case 0:case 11:case 15:var c=o.return;try{Qj(4,o)}catch(nt){W(o,c,nt)}break;case 1:var d=o.stateNode;if(typeof d.componentDidMount=="function"){var _=o.return;try{d.componentDidMount()}catch(nt){W(o,_,nt)}}var b=o.return;try{Rj(o)}catch(nt){W(o,b,nt)}break;case 5:var _e=o.return;try{Rj(o)}catch(nt){W(o,_e,nt)}}}catch(nt){W(o,o.return,nt)}if(o===h){V=null;break}var it=o.sibling;if(it!==null){it.return=o.return,V=it;break}V=o.return}}var lk=Math.ceil,mk=ua.ReactCurrentDispatcher,nk=ua.ReactCurrentOwner,ok=ua.ReactCurrentBatchConfig,K=0,Q=null,Y=null,Z=0,fj=0,ej=Uf(0),T=0,pk=null,rh=0,qk=0,rk=0,sk=null,tk=null,fk=0,Gj=1/0,uk=null,Oi=!1,Pi=null,Ri=null,vk=!1,wk=null,xk=0,yk=0,zk=null,Ak=-1,Bk=0;function R(){return K&6?B():Ak!==-1?Ak:Ak=B()}function yi(h){return h.mode&1?K&2&&Z!==0?Z&-Z:Kg.transition!==null?(Bk===0&&(Bk=yc()),Bk):(h=C,h!==0||(h=window.event,h=h===void 0?16:jd(h.type)),h):1}function gi(h,o,c,d){if(50<yk)throw yk=0,zk=null,Error(p(185));Ac(h,c,d),(!(K&2)||h!==Q)&&(h===Q&&(!(K&2)&&(qk|=c),T===4&&Ck(h,Z)),Dk(h,d),c===1&&K===0&&!(o.mode&1)&&(Gj=B()+500,fg&&jg()))}function Dk(h,o){var c=h.callbackNode;wc(h,o);var d=uc(h,h===Q?Z:0);if(d===0)c!==null&&bc(c),h.callbackNode=null,h.callbackPriority=0;else if(o=d&-d,h.callbackPriority!==o){if(c!=null&&bc(c),o===1)h.tag===0?ig(Ek.bind(null,h)):hg(Ek.bind(null,h)),Jf(function(){!(K&6)&&jg()}),c=null;else{switch(Dc(d)){case 1:c=fc;break;case 4:c=gc;break;case 16:c=hc;break;case 536870912:c=jc;break;default:c=hc}c=Fk(c,Gk.bind(null,h))}h.callbackPriority=o,h.callbackNode=c}}function Gk(h,o){if(Ak=-1,Bk=0,K&6)throw Error(p(327));var c=h.callbackNode;if(Hk()&&h.callbackNode!==c)return null;var d=uc(h,h===Q?Z:0);if(d===0)return null;if(d&30||d&h.expiredLanes||o)o=Ik(h,d);else{o=d;var _=K;K|=2;var b=Jk();(Q!==h||Z!==o)&&(uk=null,Gj=B()+500,Kk(h,o));do try{Lk();break}catch(it){Mk(h,it)}while(!0);$g(),mk.current=b,K=_,Y!==null?o=0:(Q=null,Z=0,o=T)}if(o!==0){if(o===2&&(_=xc(h),_!==0&&(d=_,o=Nk(h,_))),o===1)throw c=pk,Kk(h,0),Ck(h,d),Dk(h,B()),c;if(o===6)Ck(h,d);else{if(_=h.current.alternate,!(d&30)&&!Ok(_)&&(o=Ik(h,d),o===2&&(b=xc(h),b!==0&&(d=b,o=Nk(h,b))),o===1))throw c=pk,Kk(h,0),Ck(h,d),Dk(h,B()),c;switch(h.finishedWork=_,h.finishedLanes=d,o){case 0:case 1:throw Error(p(345));case 2:Pk(h,tk,uk);break;case 3:if(Ck(h,d),(d&130023424)===d&&(o=fk+500-B(),10<o)){if(uc(h,0)!==0)break;if(_=h.suspendedLanes,(_&d)!==d){R(),h.pingedLanes|=h.suspendedLanes&_;break}h.timeoutHandle=Ff(Pk.bind(null,h,tk,uk),o);break}Pk(h,tk,uk);break;case 4:if(Ck(h,d),(d&4194240)===d)break;for(o=h.eventTimes,_=-1;0<d;){var _e=31-oc(d);b=1<<_e,_e=o[_e],_e>_&&(_=_e),d&=~b}if(d=_,d=B()-d,d=(120>d?120:480>d?480:1080>d?1080:1920>d?1920:3e3>d?3e3:4320>d?4320:1960*lk(d/1960))-d,10<d){h.timeoutHandle=Ff(Pk.bind(null,h,tk,uk),d);break}Pk(h,tk,uk);break;case 5:Pk(h,tk,uk);break;default:throw Error(p(329))}}}return Dk(h,B()),h.callbackNode===c?Gk.bind(null,h):null}function Nk(h,o){var c=sk;return h.current.memoizedState.isDehydrated&&(Kk(h,o).flags|=256),h=Ik(h,o),h!==2&&(o=tk,tk=c,o!==null&&Fj(o)),h}function Fj(h){tk===null?tk=h:tk.push.apply(tk,h)}function Ok(h){for(var o=h;;){if(o.flags&16384){var c=o.updateQueue;if(c!==null&&(c=c.stores,c!==null))for(var d=0;d<c.length;d++){var _=c[d],b=_.getSnapshot;_=_.value;try{if(!He(b(),_))return!1}catch{return!1}}}if(c=o.child,o.subtreeFlags&16384&&c!==null)c.return=o,o=c;else{if(o===h)break;for(;o.sibling===null;){if(o.return===null||o.return===h)return!0;o=o.return}o.sibling.return=o.return,o=o.sibling}}return!0}function Ck(h,o){for(o&=~rk,o&=~qk,h.suspendedLanes|=o,h.pingedLanes&=~o,h=h.expirationTimes;0<o;){var c=31-oc(o),d=1<<c;h[c]=-1,o&=~d}}function Ek(h){if(K&6)throw Error(p(327));Hk();var o=uc(h,0);if(!(o&1))return Dk(h,B()),null;var c=Ik(h,o);if(h.tag!==0&&c===2){var d=xc(h);d!==0&&(o=d,c=Nk(h,d))}if(c===1)throw c=pk,Kk(h,0),Ck(h,o),Dk(h,B()),c;if(c===6)throw Error(p(345));return h.finishedWork=h.current.alternate,h.finishedLanes=o,Pk(h,tk,uk),Dk(h,B()),null}function Qk(h,o){var c=K;K|=1;try{return h(o)}finally{K=c,K===0&&(Gj=B()+500,fg&&jg())}}function Rk(h){wk!==null&&wk.tag===0&&!(K&6)&&Hk();var o=K;K|=1;var c=ok.transition,d=C;try{if(ok.transition=null,C=1,h)return h()}finally{C=d,ok.transition=c,K=o,!(K&6)&&jg()}}function Hj(){fj=ej.current,E(ej)}function Kk(h,o){h.finishedWork=null,h.finishedLanes=0;var c=h.timeoutHandle;if(c!==-1&&(h.timeoutHandle=-1,Gf(c)),Y!==null)for(c=Y.return;c!==null;){var d=c;switch(wg(d),d.tag){case 1:d=d.type.childContextTypes,d!=null&&$f();break;case 3:zh(),E(Wf),E(H),Eh();break;case 5:Bh(d);break;case 4:zh();break;case 13:E(L);break;case 19:E(L);break;case 10:ah(d.type._context);break;case 22:case 23:Hj()}c=c.return}if(Q=h,Y=h=Pg(h.current,null),Z=fj=o,T=0,pk=null,rk=qk=rh=0,tk=sk=null,fh!==null){for(o=0;o<fh.length;o++)if(c=fh[o],d=c.interleaved,d!==null){c.interleaved=null;var _=d.next,b=c.pending;if(b!==null){var _e=b.next;b.next=_,d.next=_e}c.pending=d}fh=null}return h}function Mk(h,o){do{var c=Y;try{if($g(),Fh.current=Rh,Ih){for(var d=M.memoizedState;d!==null;){var _=d.queue;_!==null&&(_.pending=null),d=d.next}Ih=!1}if(Hh=0,O=N=M=null,Jh=!1,Kh=0,nk.current=null,c===null||c.return===null){T=1,pk=o,Y=null;break}e:{var b=h,_e=c.return,it=c,nt=o;if(o=Z,it.flags|=32768,nt!==null&&typeof nt=="object"&&typeof nt.then=="function"){var at=nt,ut=it,pt=ut.tag;if(!(ut.mode&1)&&(pt===0||pt===11||pt===15)){var mt=ut.alternate;mt?(ut.updateQueue=mt.updateQueue,ut.memoizedState=mt.memoizedState,ut.lanes=mt.lanes):(ut.updateQueue=null,ut.memoizedState=null)}var ft=Ui(_e);if(ft!==null){ft.flags&=-257,Vi(ft,_e,it,b,o),ft.mode&1&&Si(b,at,o),o=ft,nt=at;var vt=o.updateQueue;if(vt===null){var xt=new Set;xt.add(nt),o.updateQueue=xt}else vt.add(nt);break e}else{if(!(o&1)){Si(b,at,o),tj();break e}nt=Error(p(426))}}else if(I&&it.mode&1){var At=Ui(_e);if(At!==null){!(At.flags&65536)&&(At.flags|=256),Vi(At,_e,it,b,o),Jg(Ji(nt,it));break e}}b=nt=Ji(nt,it),T!==4&&(T=2),sk===null?sk=[b]:sk.push(b),b=_e;do{switch(b.tag){case 3:b.flags|=65536,o&=-o,b.lanes|=o;var Ct=Ni(b,nt,o);ph(b,Ct);break e;case 1:it=nt;var Et=b.type,Tt=b.stateNode;if(!(b.flags&128)&&(typeof Et.getDerivedStateFromError=="function"||Tt!==null&&typeof Tt.componentDidCatch=="function"&&(Ri===null||!Ri.has(Tt)))){b.flags|=65536,o&=-o,b.lanes|=o;var kt=Qi(b,it,o);ph(b,kt);break e}}b=b.return}while(b!==null)}Sk(c)}catch(Dt){o=Dt,Y===c&&c!==null&&(Y=c=c.return);continue}break}while(!0)}function Jk(){var h=mk.current;return mk.current=Rh,h===null?Rh:h}function tj(){(T===0||T===3||T===2)&&(T=4),Q===null||!(rh&268435455)&&!(qk&268435455)||Ck(Q,Z)}function Ik(h,o){var c=K;K|=2;var d=Jk();(Q!==h||Z!==o)&&(uk=null,Kk(h,o));do try{Tk();break}catch(_){Mk(h,_)}while(!0);if($g(),K=c,mk.current=d,Y!==null)throw Error(p(261));return Q=null,Z=0,T}function Tk(){for(;Y!==null;)Uk(Y)}function Lk(){for(;Y!==null&&!cc();)Uk(Y)}function Uk(h){var o=Vk(h.alternate,h,fj);h.memoizedProps=h.pendingProps,o===null?Sk(h):Y=o,nk.current=null}function Sk(h){var o=h;do{var c=o.alternate;if(h=o.return,o.flags&32768){if(c=Ij(c,o),c!==null){c.flags&=32767,Y=c;return}if(h!==null)h.flags|=32768,h.subtreeFlags=0,h.deletions=null;else{T=6,Y=null;return}}else if(c=Ej(c,o,fj),c!==null){Y=c;return}if(o=o.sibling,o!==null){Y=o;return}Y=o=h}while(o!==null);T===0&&(T=5)}function Pk(h,o,c){var d=C,_=ok.transition;try{ok.transition=null,C=1,Wk(h,o,c,d)}finally{ok.transition=_,C=d}return null}function Wk(h,o,c,d){do Hk();while(wk!==null);if(K&6)throw Error(p(327));c=h.finishedWork;var _=h.finishedLanes;if(c===null)return null;if(h.finishedWork=null,h.finishedLanes=0,c===h.current)throw Error(p(177));h.callbackNode=null,h.callbackPriority=0;var b=c.lanes|c.childLanes;if(Bc(h,b),h===Q&&(Y=Q=null,Z=0),!(c.subtreeFlags&2064)&&!(c.flags&2064)||vk||(vk=!0,Fk(hc,function(){return Hk(),null})),b=(c.flags&15990)!==0,c.subtreeFlags&15990||b){b=ok.transition,ok.transition=null;var _e=C;C=1;var it=K;K|=4,nk.current=null,Oj(h,c),dk(c,h),Oe(Df),dd=!!Cf,Df=Cf=null,h.current=c,hk(c),dc(),K=it,C=_e,ok.transition=b}else h.current=c;if(vk&&(vk=!1,wk=h,xk=_),b=h.pendingLanes,b===0&&(Ri=null),mc(c.stateNode),Dk(h,B()),o!==null)for(d=h.onRecoverableError,c=0;c<o.length;c++)_=o[c],d(_.value,{componentStack:_.stack,digest:_.digest});if(Oi)throw Oi=!1,h=Pi,Pi=null,h;return xk&1&&h.tag!==0&&Hk(),b=h.pendingLanes,b&1?h===zk?yk++:(yk=0,zk=h):yk=0,jg(),null}function Hk(){if(wk!==null){var h=Dc(xk),o=ok.transition,c=C;try{if(ok.transition=null,C=16>h?16:h,wk===null)var d=!1;else{if(h=wk,wk=null,xk=0,K&6)throw Error(p(331));var _=K;for(K|=4,V=h.current;V!==null;){var b=V,_e=b.child;if(V.flags&16){var it=b.deletions;if(it!==null){for(var nt=0;nt<it.length;nt++){var at=it[nt];for(V=at;V!==null;){var ut=V;switch(ut.tag){case 0:case 11:case 15:Pj(8,ut,b)}var pt=ut.child;if(pt!==null)pt.return=ut,V=pt;else for(;V!==null;){ut=V;var mt=ut.sibling,ft=ut.return;if(Sj(ut),ut===at){V=null;break}if(mt!==null){mt.return=ft,V=mt;break}V=ft}}}var vt=b.alternate;if(vt!==null){var xt=vt.child;if(xt!==null){vt.child=null;do{var At=xt.sibling;xt.sibling=null,xt=At}while(xt!==null)}}V=b}}if(b.subtreeFlags&2064&&_e!==null)_e.return=b,V=_e;else e:for(;V!==null;){if(b=V,b.flags&2048)switch(b.tag){case 0:case 11:case 15:Pj(9,b,b.return)}var Ct=b.sibling;if(Ct!==null){Ct.return=b.return,V=Ct;break e}V=b.return}}var Et=h.current;for(V=Et;V!==null;){_e=V;var Tt=_e.child;if(_e.subtreeFlags&2064&&Tt!==null)Tt.return=_e,V=Tt;else e:for(_e=Et;V!==null;){if(it=V,it.flags&2048)try{switch(it.tag){case 0:case 11:case 15:Qj(9,it)}}catch(Dt){W(it,it.return,Dt)}if(it===_e){V=null;break e}var kt=it.sibling;if(kt!==null){kt.return=it.return,V=kt;break e}V=it.return}}if(K=_,jg(),lc&&typeof lc.onPostCommitFiberRoot=="function")try{lc.onPostCommitFiberRoot(kc,h)}catch{}d=!0}return d}finally{C=c,ok.transition=o}}return!1}function Xk(h,o,c){o=Ji(c,o),o=Ni(h,o,1),h=nh(h,o,1),o=R(),h!==null&&(Ac(h,1,o),Dk(h,o))}function W(h,o,c){if(h.tag===3)Xk(h,h,c);else for(;o!==null;){if(o.tag===3){Xk(o,h,c);break}else if(o.tag===1){var d=o.stateNode;if(typeof o.type.getDerivedStateFromError=="function"||typeof d.componentDidCatch=="function"&&(Ri===null||!Ri.has(d))){h=Ji(c,h),h=Qi(o,h,1),o=nh(o,h,1),h=R(),o!==null&&(Ac(o,1,h),Dk(o,h));break}}o=o.return}}function Ti(h,o,c){var d=h.pingCache;d!==null&&d.delete(o),o=R(),h.pingedLanes|=h.suspendedLanes&c,Q===h&&(Z&c)===c&&(T===4||T===3&&(Z&130023424)===Z&&500>B()-fk?Kk(h,0):rk|=c),Dk(h,o)}function Yk(h,o){o===0&&(h.mode&1?(o=sc,sc<<=1,!(sc&130023424)&&(sc=4194304)):o=1);var c=R();h=ih(h,o),h!==null&&(Ac(h,o,c),Dk(h,c))}function uj(h){var o=h.memoizedState,c=0;o!==null&&(c=o.retryLane),Yk(h,c)}function bk(h,o){var c=0;switch(h.tag){case 13:var d=h.stateNode,_=h.memoizedState;_!==null&&(c=_.retryLane);break;case 19:d=h.stateNode;break;default:throw Error(p(314))}d!==null&&d.delete(o),Yk(h,c)}var Vk;Vk=function(h,o,c){if(h!==null)if(h.memoizedProps!==o.pendingProps||Wf.current)dh=!0;else{if(!(h.lanes&c)&&!(o.flags&128))return dh=!1,yj(h,o,c);dh=!!(h.flags&131072)}else dh=!1,I&&o.flags&1048576&&ug(o,ng,o.index);switch(o.lanes=0,o.tag){case 2:var d=o.type;ij(h,o),h=o.pendingProps;var _=Yf(o,H.current);ch(o,c),_=Nh(null,o,d,h,_,c);var b=Sh();return o.flags|=1,typeof _=="object"&&_!==null&&typeof _.render=="function"&&_.$$typeof===void 0?(o.tag=1,o.memoizedState=null,o.updateQueue=null,Zf(d)?(b=!0,cg(o)):b=!1,o.memoizedState=_.state!==null&&_.state!==void 0?_.state:null,kh(o),_.updater=Ei,o.stateNode=_,_._reactInternals=o,Ii(o,d,h,c),o=jj(null,o,d,!0,b,c)):(o.tag=0,I&&b&&vg(o),Xi(null,o,_,c),o=o.child),o;case 16:d=o.elementType;e:{switch(ij(h,o),h=o.pendingProps,_=d._init,d=_(d._payload),o.type=d,_=o.tag=Zk(d),h=Ci(d,h),_){case 0:o=cj(null,o,d,h,c);break e;case 1:o=hj(null,o,d,h,c);break e;case 11:o=Yi(null,o,d,h,c);break e;case 14:o=$i(null,o,d,Ci(d.type,h),c);break e}throw Error(p(306,d,""))}return o;case 0:return d=o.type,_=o.pendingProps,_=o.elementType===d?_:Ci(d,_),cj(h,o,d,_,c);case 1:return d=o.type,_=o.pendingProps,_=o.elementType===d?_:Ci(d,_),hj(h,o,d,_,c);case 3:e:{if(kj(o),h===null)throw Error(p(387));d=o.pendingProps,b=o.memoizedState,_=b.element,lh(h,o),qh(o,d,null,c);var _e=o.memoizedState;if(d=_e.element,b.isDehydrated)if(b={element:d,isDehydrated:!1,cache:_e.cache,pendingSuspenseBoundaries:_e.pendingSuspenseBoundaries,transitions:_e.transitions},o.updateQueue.baseState=b,o.memoizedState=b,o.flags&256){_=Ji(Error(p(423)),o),o=lj(h,o,d,c,_);break e}else if(d!==_){_=Ji(Error(p(424)),o),o=lj(h,o,d,c,_);break e}else for(yg=Lf(o.stateNode.containerInfo.firstChild),xg=o,I=!0,zg=null,c=Vg(o,null,d,c),o.child=c;c;)c.flags=c.flags&-3|4096,c=c.sibling;else{if(Ig(),d===_){o=Zi(h,o,c);break e}Xi(h,o,d,c)}o=o.child}return o;case 5:return Ah(o),h===null&&Eg(o),d=o.type,_=o.pendingProps,b=h!==null?h.memoizedProps:null,_e=_.children,Ef(d,_)?_e=null:b!==null&&Ef(d,b)&&(o.flags|=32),gj(h,o),Xi(h,o,_e,c),o.child;case 6:return h===null&&Eg(o),null;case 13:return oj(h,o,c);case 4:return yh(o,o.stateNode.containerInfo),d=o.pendingProps,h===null?o.child=Ug(o,null,d,c):Xi(h,o,d,c),o.child;case 11:return d=o.type,_=o.pendingProps,_=o.elementType===d?_:Ci(d,_),Yi(h,o,d,_,c);case 7:return Xi(h,o,o.pendingProps,c),o.child;case 8:return Xi(h,o,o.pendingProps.children,c),o.child;case 12:return Xi(h,o,o.pendingProps.children,c),o.child;case 10:e:{if(d=o.type._context,_=o.pendingProps,b=o.memoizedProps,_e=_.value,G(Wg,d._currentValue),d._currentValue=_e,b!==null)if(He(b.value,_e)){if(b.children===_.children&&!Wf.current){o=Zi(h,o,c);break e}}else for(b=o.child,b!==null&&(b.return=o);b!==null;){var it=b.dependencies;if(it!==null){_e=b.child;for(var nt=it.firstContext;nt!==null;){if(nt.context===d){if(b.tag===1){nt=mh(-1,c&-c),nt.tag=2;var at=b.updateQueue;if(at!==null){at=at.shared;var ut=at.pending;ut===null?nt.next=nt:(nt.next=ut.next,ut.next=nt),at.pending=nt}}b.lanes|=c,nt=b.alternate,nt!==null&&(nt.lanes|=c),bh(b.return,c,o),it.lanes|=c;break}nt=nt.next}}else if(b.tag===10)_e=b.type===o.type?null:b.child;else if(b.tag===18){if(_e=b.return,_e===null)throw Error(p(341));_e.lanes|=c,it=_e.alternate,it!==null&&(it.lanes|=c),bh(_e,c,o),_e=b.sibling}else _e=b.child;if(_e!==null)_e.return=b;else for(_e=b;_e!==null;){if(_e===o){_e=null;break}if(b=_e.sibling,b!==null){b.return=_e.return,_e=b;break}_e=_e.return}b=_e}Xi(h,o,_.children,c),o=o.child}return o;case 9:return _=o.type,d=o.pendingProps.children,ch(o,c),_=eh(_),d=d(_),o.flags|=1,Xi(h,o,d,c),o.child;case 14:return d=o.type,_=Ci(d,o.pendingProps),_=Ci(d.type,_),$i(h,o,d,_,c);case 15:return bj(h,o,o.type,o.pendingProps,c);case 17:return d=o.type,_=o.pendingProps,_=o.elementType===d?_:Ci(d,_),ij(h,o),o.tag=1,Zf(d)?(h=!0,cg(o)):h=!1,ch(o,c),Gi(o,d,_),Ii(o,d,_,c),jj(null,o,d,!0,h,c);case 19:return xj(h,o,c);case 22:return dj(h,o,c)}throw Error(p(156,o.tag))};function Fk(h,o){return ac(h,o)}function $k(h,o,c,d){this.tag=h,this.key=c,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=o,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=d,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Bg(h,o,c,d){return new $k(h,o,c,d)}function aj(h){return h=h.prototype,!(!h||!h.isReactComponent)}function Zk(h){if(typeof h=="function")return aj(h)?1:0;if(h!=null){if(h=h.$$typeof,h===Da)return 11;if(h===Ga)return 14}return 2}function Pg(h,o){var c=h.alternate;return c===null?(c=Bg(h.tag,o,h.key,h.mode),c.elementType=h.elementType,c.type=h.type,c.stateNode=h.stateNode,c.alternate=h,h.alternate=c):(c.pendingProps=o,c.type=h.type,c.flags=0,c.subtreeFlags=0,c.deletions=null),c.flags=h.flags&14680064,c.childLanes=h.childLanes,c.lanes=h.lanes,c.child=h.child,c.memoizedProps=h.memoizedProps,c.memoizedState=h.memoizedState,c.updateQueue=h.updateQueue,o=h.dependencies,c.dependencies=o===null?null:{lanes:o.lanes,firstContext:o.firstContext},c.sibling=h.sibling,c.index=h.index,c.ref=h.ref,c}function Rg(h,o,c,d,_,b){var _e=2;if(d=h,typeof h=="function")aj(h)&&(_e=1);else if(typeof h=="string")_e=5;else e:switch(h){case ya:return Tg(c.children,_,b,o);case za:_e=8,_|=8;break;case Aa:return h=Bg(12,c,o,_|2),h.elementType=Aa,h.lanes=b,h;case Ea:return h=Bg(13,c,o,_),h.elementType=Ea,h.lanes=b,h;case Fa:return h=Bg(19,c,o,_),h.elementType=Fa,h.lanes=b,h;case Ia:return pj(c,_,b,o);default:if(typeof h=="object"&&h!==null)switch(h.$$typeof){case Ba:_e=10;break e;case Ca:_e=9;break e;case Da:_e=11;break e;case Ga:_e=14;break e;case Ha:_e=16,d=null;break e}throw Error(p(130,h==null?h:typeof h,""))}return o=Bg(_e,c,o,_),o.elementType=h,o.type=d,o.lanes=b,o}function Tg(h,o,c,d){return h=Bg(7,h,d,o),h.lanes=c,h}function pj(h,o,c,d){return h=Bg(22,h,d,o),h.elementType=Ia,h.lanes=c,h.stateNode={isHidden:!1},h}function Qg(h,o,c){return h=Bg(6,h,null,o),h.lanes=c,h}function Sg(h,o,c){return o=Bg(4,h.children!==null?h.children:[],h.key,o),o.lanes=c,o.stateNode={containerInfo:h.containerInfo,pendingChildren:null,implementation:h.implementation},o}function al(h,o,c,d,_){this.tag=o,this.containerInfo=h,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=zc(0),this.expirationTimes=zc(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=zc(0),this.identifierPrefix=d,this.onRecoverableError=_,this.mutableSourceEagerHydrationData=null}function bl(h,o,c,d,_,b,_e,it,nt){return h=new al(h,o,c,it,nt),o===1?(o=1,b===!0&&(o|=8)):o=0,b=Bg(3,null,null,o),h.current=b,b.stateNode=h,b.memoizedState={element:d,isDehydrated:c,cache:null,transitions:null,pendingSuspenseBoundaries:null},kh(b),h}function cl(h,o,c){var d=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:wa,key:d==null?null:""+d,children:h,containerInfo:o,implementation:c}}function dl(h){if(!h)return Vf;h=h._reactInternals;e:{if(Vb(h)!==h||h.tag!==1)throw Error(p(170));var o=h;do{switch(o.tag){case 3:o=o.stateNode.context;break e;case 1:if(Zf(o.type)){o=o.stateNode.__reactInternalMemoizedMergedChildContext;break e}}o=o.return}while(o!==null);throw Error(p(171))}if(h.tag===1){var c=h.type;if(Zf(c))return bg(h,c,o)}return o}function el(h,o,c,d,_,b,_e,it,nt){return h=bl(c,d,!0,h,_,b,_e,it,nt),h.context=dl(null),c=h.current,d=R(),_=yi(c),b=mh(d,_),b.callback=o??null,nh(c,b,_),h.current.lanes=_,Ac(h,_,d),Dk(h,d),h}function fl(h,o,c,d){var _=o.current,b=R(),_e=yi(_);return c=dl(c),o.context===null?o.context=c:o.pendingContext=c,o=mh(b,_e),o.payload={element:h},d=d===void 0?null:d,d!==null&&(o.callback=d),h=nh(_,o,_e),h!==null&&(gi(h,_,_e,b),oh(h,_,_e)),_e}function gl(h){if(h=h.current,!h.child)return null;switch(h.child.tag){case 5:return h.child.stateNode;default:return h.child.stateNode}}function hl(h,o){if(h=h.memoizedState,h!==null&&h.dehydrated!==null){var c=h.retryLane;h.retryLane=c!==0&&c<o?c:o}}function il(h,o){hl(h,o),(h=h.alternate)&&hl(h,o)}function jl(){return null}var kl=typeof reportError=="function"?reportError:function(h){console.error(h)};function ll(h){this._internalRoot=h}ml.prototype.render=ll.prototype.render=function(h){var o=this._internalRoot;if(o===null)throw Error(p(409));fl(h,o,null,null)};ml.prototype.unmount=ll.prototype.unmount=function(){var h=this._internalRoot;if(h!==null){this._internalRoot=null;var o=h.containerInfo;Rk(function(){fl(null,h,null,null)}),o[uf]=null}};function ml(h){this._internalRoot=h}ml.prototype.unstable_scheduleHydration=function(h){if(h){var o=Hc();h={blockedOn:null,target:h,priority:o};for(var c=0;c<Qc.length&&o!==0&&o<Qc[c].priority;c++);Qc.splice(c,0,h),c===0&&Vc(h)}};function nl(h){return!(!h||h.nodeType!==1&&h.nodeType!==9&&h.nodeType!==11)}function ol(h){return!(!h||h.nodeType!==1&&h.nodeType!==9&&h.nodeType!==11&&(h.nodeType!==8||h.nodeValue!==" react-mount-point-unstable "))}function pl(){}function ql(h,o,c,d,_){if(_){if(typeof d=="function"){var b=d;d=function(){var at=gl(_e);b.call(at)}}var _e=el(o,d,h,0,null,!1,!1,"",pl);return h._reactRootContainer=_e,h[uf]=_e.current,sf(h.nodeType===8?h.parentNode:h),Rk(),_e}for(;_=h.lastChild;)h.removeChild(_);if(typeof d=="function"){var it=d;d=function(){var at=gl(nt);it.call(at)}}var nt=bl(h,0,!1,null,null,!1,!1,"",pl);return h._reactRootContainer=nt,h[uf]=nt.current,sf(h.nodeType===8?h.parentNode:h),Rk(function(){fl(o,nt,c,d)}),nt}function rl(h,o,c,d,_){var b=c._reactRootContainer;if(b){var _e=b;if(typeof _=="function"){var it=_;_=function(){var nt=gl(_e);it.call(nt)}}fl(o,_e,h,_)}else _e=ql(c,o,h,_,d);return gl(_e)}Ec=function(h){switch(h.tag){case 3:var o=h.stateNode;if(o.current.memoizedState.isDehydrated){var c=tc(o.pendingLanes);c!==0&&(Cc(o,c|1),Dk(o,B()),!(K&6)&&(Gj=B()+500,jg()))}break;case 13:Rk(function(){var d=ih(h,1);if(d!==null){var _=R();gi(d,h,1,_)}}),il(h,1)}};Fc=function(h){if(h.tag===13){var o=ih(h,134217728);if(o!==null){var c=R();gi(o,h,134217728,c)}il(h,134217728)}};Gc=function(h){if(h.tag===13){var o=yi(h),c=ih(h,o);if(c!==null){var d=R();gi(c,h,o,d)}il(h,o)}};Hc=function(){return C};Ic=function(h,o){var c=C;try{return C=h,o()}finally{C=c}};yb=function(h,o,c){switch(o){case"input":if(bb(h,c),o=c.name,c.type==="radio"&&o!=null){for(c=h;c.parentNode;)c=c.parentNode;for(c=c.querySelectorAll("input[name="+JSON.stringify(""+o)+'][type="radio"]'),o=0;o<c.length;o++){var d=c[o];if(d!==h&&d.form===h.form){var _=Db(d);if(!_)throw Error(p(90));Wa(d),bb(d,_)}}}break;case"textarea":ib(h,c);break;case"select":o=c.value,o!=null&&fb(h,!!c.multiple,o,!1)}};Gb=Qk;Hb=Rk;var sl={usingClientEntryPoint:!1,Events:[Cb,ue,Db,Eb,Fb,Qk]},tl={findFiberByHostInstance:Wc,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},ul={bundleType:tl.bundleType,version:tl.version,rendererPackageName:tl.rendererPackageName,rendererConfig:tl.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:ua.ReactCurrentDispatcher,findHostInstanceByFiber:function(h){return h=Zb(h),h===null?null:h.stateNode},findFiberByHostInstance:tl.findFiberByHostInstance||jl,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var vl=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!vl.isDisabled&&vl.supportsFiber)try{kc=vl.inject(ul),lc=vl}catch{}}reactDom_production_min.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=sl;reactDom_production_min.createPortal=function(h,o){var c=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!nl(o))throw Error(p(200));return cl(h,o,null,c)};reactDom_production_min.createRoot=function(h,o){if(!nl(h))throw Error(p(299));var c=!1,d="",_=kl;return o!=null&&(o.unstable_strictMode===!0&&(c=!0),o.identifierPrefix!==void 0&&(d=o.identifierPrefix),o.onRecoverableError!==void 0&&(_=o.onRecoverableError)),o=bl(h,1,!1,null,null,c,!1,d,_),h[uf]=o.current,sf(h.nodeType===8?h.parentNode:h),new ll(o)};reactDom_production_min.findDOMNode=function(h){if(h==null)return null;if(h.nodeType===1)return h;var o=h._reactInternals;if(o===void 0)throw typeof h.render=="function"?Error(p(188)):(h=Object.keys(h).join(","),Error(p(268,h)));return h=Zb(o),h=h===null?null:h.stateNode,h};reactDom_production_min.flushSync=function(h){return Rk(h)};reactDom_production_min.hydrate=function(h,o,c){if(!ol(o))throw Error(p(200));return rl(null,h,o,!0,c)};reactDom_production_min.hydrateRoot=function(h,o,c){if(!nl(h))throw Error(p(405));var d=c!=null&&c.hydratedSources||null,_=!1,b="",_e=kl;if(c!=null&&(c.unstable_strictMode===!0&&(_=!0),c.identifierPrefix!==void 0&&(b=c.identifierPrefix),c.onRecoverableError!==void 0&&(_e=c.onRecoverableError)),o=el(o,null,h,1,c??null,_,!1,b,_e),h[uf]=o.current,sf(h),d)for(h=0;h<d.length;h++)c=d[h],_=c._getVersion,_=_(c._source),o.mutableSourceEagerHydrationData==null?o.mutableSourceEagerHydrationData=[c,_]:o.mutableSourceEagerHydrationData.push(c,_);return new ml(o)};reactDom_production_min.render=function(h,o,c){if(!ol(o))throw Error(p(200));return rl(null,h,o,!1,c)};reactDom_production_min.unmountComponentAtNode=function(h){if(!ol(h))throw Error(p(40));return h._reactRootContainer?(Rk(function(){rl(null,null,h,!1,function(){h._reactRootContainer=null,h[uf]=null})}),!0):!1};reactDom_production_min.unstable_batchedUpdates=Qk;reactDom_production_min.unstable_renderSubtreeIntoContainer=function(h,o,c,d){if(!ol(c))throw Error(p(200));if(h==null||h._reactInternals===void 0)throw Error(p(38));return rl(h,o,c,!1,d)};reactDom_production_min.version="18.3.1-next-f1338f8080-20240426";function checkDCE(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(checkDCE)}catch(h){console.error(h)}}checkDCE(),reactDom.exports=reactDom_production_min;var reactDomExports=reactDom.exports,m=reactDomExports;client.createRoot=m.createRoot,client.hydrateRoot=m.hydrateRoot;const LEFT="Left",RIGHT="Right",UP="Up",DOWN="Down",defaultProps={delta:10,preventScrollOnSwipe:!1,rotationAngle:0,trackMouse:!1,trackTouch:!0,swipeDuration:1/0,touchEventOptions:{passive:!0}},initialState={first:!0,initial:[0,0],start:0,swiping:!1,xy:[0,0]},mouseMove="mousemove",mouseUp="mouseup",touchEnd="touchend",touchMove="touchmove",touchStart="touchstart";function getDirection(h,o,c,d){return h>o?c>0?RIGHT:LEFT:d>0?DOWN:UP}function rotateXYByAngle(h,o){if(o===0)return h;const c=Math.PI/180*o,d=h[0]*Math.cos(c)+h[1]*Math.sin(c),_=h[1]*Math.cos(c)-h[0]*Math.sin(c);return[d,_]}function getHandlers(h,o){const c=at=>{const ut="touches"in at;ut&&at.touches.length>1||h((pt,mt)=>{mt.trackMouse&&!ut&&(document.addEventListener(mouseMove,d),document.addEventListener(mouseUp,_e));const{clientX:ft,clientY:vt}=ut?at.touches[0]:at,xt=rotateXYByAngle([ft,vt],mt.rotationAngle);return mt.onTouchStartOrOnMouseDown&&mt.onTouchStartOrOnMouseDown({event:at}),Object.assign(Object.assign(Object.assign({},pt),initialState),{initial:xt.slice(),xy:xt,start:at.timeStamp||0})})},d=at=>{h((ut,pt)=>{const mt="touches"in at;if(mt&&at.touches.length>1)return ut;if(at.timeStamp-ut.start>pt.swipeDuration)return ut.swiping?Object.assign(Object.assign({},ut),{swiping:!1}):ut;const{clientX:ft,clientY:vt}=mt?at.touches[0]:at,[xt,At]=rotateXYByAngle([ft,vt],pt.rotationAngle),Ct=xt-ut.xy[0],Et=At-ut.xy[1],Tt=Math.abs(Ct),kt=Math.abs(Et),Dt=(at.timeStamp||0)-ut.start,zt=Math.sqrt(Tt*Tt+kt*kt)/(Dt||1),Bt=[Ct/(Dt||1),Et/(Dt||1)],Rt=getDirection(Tt,kt,Ct,Et),Ut=typeof pt.delta=="number"?pt.delta:pt.delta[Rt.toLowerCase()]||defaultProps.delta;if(Tt<Ut&&kt<Ut&&!ut.swiping)return ut;const Ht={absX:Tt,absY:kt,deltaX:Ct,deltaY:Et,dir:Rt,event:at,first:ut.first,initial:ut.initial,velocity:zt,vxvy:Bt};Ht.first&&pt.onSwipeStart&&pt.onSwipeStart(Ht),pt.onSwiping&&pt.onSwiping(Ht);let Jt=!1;return(pt.onSwiping||pt.onSwiped||pt[`onSwiped${Rt}`])&&(Jt=!0),Jt&&pt.preventScrollOnSwipe&&pt.trackTouch&&at.cancelable&&at.preventDefault(),Object.assign(Object.assign({},ut),{first:!1,eventData:Ht,swiping:!0})})},_=at=>{h((ut,pt)=>{let mt;if(ut.swiping&&ut.eventData){if(at.timeStamp-ut.start<pt.swipeDuration){mt=Object.assign(Object.assign({},ut.eventData),{event:at}),pt.onSwiped&&pt.onSwiped(mt);const ft=pt[`onSwiped${mt.dir}`];ft&&ft(mt)}}else pt.onTap&&pt.onTap({event:at});return pt.onTouchEndOrOnMouseUp&&pt.onTouchEndOrOnMouseUp({event:at}),Object.assign(Object.assign(Object.assign({},ut),initialState),{eventData:mt})})},b=()=>{document.removeEventListener(mouseMove,d),document.removeEventListener(mouseUp,_e)},_e=at=>{b(),_(at)},it=(at,ut)=>{let pt=()=>{};if(at&&at.addEventListener){const mt=Object.assign(Object.assign({},defaultProps.touchEventOptions),ut.touchEventOptions),ft=[[touchStart,c,mt],[touchMove,d,Object.assign(Object.assign({},mt),ut.preventScrollOnSwipe?{passive:!1}:{})],[touchEnd,_,mt]];ft.forEach(([vt,xt,At])=>at.addEventListener(vt,xt,At)),pt=()=>ft.forEach(([vt,xt])=>at.removeEventListener(vt,xt))}return pt},nt={ref:at=>{at!==null&&h((ut,pt)=>{if(ut.el===at)return ut;const mt={};return ut.el&&ut.el!==at&&ut.cleanUpTouch&&(ut.cleanUpTouch(),mt.cleanUpTouch=void 0),pt.trackTouch&&at&&(mt.cleanUpTouch=it(at,pt)),Object.assign(Object.assign(Object.assign({},ut),{el:at}),mt)})}};return o.trackMouse&&(nt.onMouseDown=c),[nt,it]}function updateTransientState(h,o,c,d){return!o.trackTouch||!h.el?(h.cleanUpTouch&&h.cleanUpTouch(),Object.assign(Object.assign({},h),{cleanUpTouch:void 0})):h.cleanUpTouch?o.preventScrollOnSwipe!==c.preventScrollOnSwipe||o.touchEventOptions.passive!==c.touchEventOptions.passive?(h.cleanUpTouch(),Object.assign(Object.assign({},h),{cleanUpTouch:d(h.el,o)})):h:Object.assign(Object.assign({},h),{cleanUpTouch:d(h.el,o)})}function useSwipeable(h){const{trackMouse:o}=h,c=reactExports.useRef(Object.assign({},initialState)),d=reactExports.useRef(Object.assign({},defaultProps)),_=reactExports.useRef(Object.assign({},d.current));_.current=Object.assign({},d.current),d.current=Object.assign(Object.assign({},defaultProps),h);let b;for(b in defaultProps)d.current[b]===void 0&&(d.current[b]=defaultProps[b]);const[_e,it]=reactExports.useMemo(()=>getHandlers(nt=>c.current=nt(c.current,d.current),{trackMouse:o}),[o]);return c.current=updateTransientState(c.current,d.current,_.current,it),_e}const MotionConfigContext=reactExports.createContext({transformPagePoint:h=>h,isStatic:!1,reducedMotion:"never"}),MotionContext=reactExports.createContext({}),PresenceContext=reactExports.createContext(null),isBrowser=typeof document<"u",useIsomorphicLayoutEffect=isBrowser?reactExports.useLayoutEffect:reactExports.useEffect,LazyContext=reactExports.createContext({strict:!1}),camelToDash=h=>h.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),optimizedAppearDataId="framerAppearId",optimizedAppearDataAttribute="data-"+camelToDash(optimizedAppearDataId),MotionGlobalConfig={skipAnimations:!1,useManualTiming:!1};class Queue{constructor(){this.order=[],this.scheduled=new Set}add(o){if(!this.scheduled.has(o))return this.scheduled.add(o),this.order.push(o),!0}remove(o){const c=this.order.indexOf(o);c!==-1&&(this.order.splice(c,1),this.scheduled.delete(o))}clear(){this.order.length=0,this.scheduled.clear()}}function createRenderStep(h){let o=new Queue,c=new Queue,d=0,_=!1,b=!1;const _e=new WeakSet,it={schedule:(nt,at=!1,ut=!1)=>{const pt=ut&&_,mt=pt?o:c;return at&&_e.add(nt),mt.add(nt)&&pt&&_&&(d=o.order.length),nt},cancel:nt=>{c.remove(nt),_e.delete(nt)},process:nt=>{if(_){b=!0;return}if(_=!0,[o,c]=[c,o],c.clear(),d=o.order.length,d)for(let at=0;at<d;at++){const ut=o.order[at];_e.has(ut)&&(it.schedule(ut),h()),ut(nt)}_=!1,b&&(b=!1,it.process(nt))}};return it}const stepsOrder=["read","resolveKeyframes","update","preRender","render","postRender"],maxElapsed=40;function createRenderBatcher(h,o){let c=!1,d=!0;const _={delta:0,timestamp:0,isProcessing:!1},b=stepsOrder.reduce((at,ut)=>(at[ut]=createRenderStep(()=>c=!0),at),{}),_e=at=>{b[at].process(_)},it=()=>{const at=performance.now();c=!1,_.delta=d?1e3/60:Math.max(Math.min(at-_.timestamp,maxElapsed),1),_.timestamp=at,_.isProcessing=!0,stepsOrder.forEach(_e),_.isProcessing=!1,c&&o&&(d=!1,h(it))},nt=()=>{c=!0,d=!0,_.isProcessing||h(it)};return{schedule:stepsOrder.reduce((at,ut)=>{const pt=b[ut];return at[ut]=(mt,ft=!1,vt=!1)=>(c||nt(),pt.schedule(mt,ft,vt)),at},{}),cancel:at=>stepsOrder.forEach(ut=>b[ut].cancel(at)),state:_,steps:b}}const{schedule:microtask,cancel:cancelMicrotask}=createRenderBatcher(queueMicrotask,!1);function useVisualElement(h,o,c,d){const{visualElement:_}=reactExports.useContext(MotionContext),b=reactExports.useContext(LazyContext),_e=reactExports.useContext(PresenceContext),it=reactExports.useContext(MotionConfigContext).reducedMotion,nt=reactExports.useRef();d=d||b.renderer,!nt.current&&d&&(nt.current=d(h,{visualState:o,parent:_,props:c,presenceContext:_e,blockInitialAnimation:_e?_e.initial===!1:!1,reducedMotionConfig:it}));const at=nt.current;reactExports.useInsertionEffect(()=>{at&&at.update(c,_e)});const ut=reactExports.useRef(!!(c[optimizedAppearDataAttribute]&&!window.HandoffComplete));return useIsomorphicLayoutEffect(()=>{at&&(microtask.postRender(at.render),ut.current&&at.animationState&&at.animationState.animateChanges())}),reactExports.useEffect(()=>{at&&(at.updateFeatures(),!ut.current&&at.animationState&&at.animationState.animateChanges(),ut.current&&(ut.current=!1,window.HandoffComplete=!0))}),at}function isRefObject(h){return h&&typeof h=="object"&&Object.prototype.hasOwnProperty.call(h,"current")}function useMotionRef(h,o,c){return reactExports.useCallback(d=>{d&&h.mount&&h.mount(d),o&&(d?o.mount(d):o.unmount()),c&&(typeof c=="function"?c(d):isRefObject(c)&&(c.current=d))},[o])}function isVariantLabel(h){return typeof h=="string"||Array.isArray(h)}function isAnimationControls(h){return h!==null&&typeof h=="object"&&typeof h.start=="function"}const variantPriorityOrder=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],variantProps=["initial",...variantPriorityOrder];function isControllingVariants(h){return isAnimationControls(h.animate)||variantProps.some(o=>isVariantLabel(h[o]))}function isVariantNode(h){return!!(isControllingVariants(h)||h.variants)}function getCurrentTreeVariants(h,o){if(isControllingVariants(h)){const{initial:c,animate:d}=h;return{initial:c===!1||isVariantLabel(c)?c:void 0,animate:isVariantLabel(d)?d:void 0}}return h.inherit!==!1?o:{}}function useCreateMotionContext(h){const{initial:o,animate:c}=getCurrentTreeVariants(h,reactExports.useContext(MotionContext));return reactExports.useMemo(()=>({initial:o,animate:c}),[variantLabelsAsDependency(o),variantLabelsAsDependency(c)])}function variantLabelsAsDependency(h){return Array.isArray(h)?h.join(" "):h}const featureProps={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},featureDefinitions={};for(const h in featureProps)featureDefinitions[h]={isEnabled:o=>featureProps[h].some(c=>!!o[c])};function loadFeatures(h){for(const o in h)featureDefinitions[o]={...featureDefinitions[o],...h[o]}}const LayoutGroupContext=reactExports.createContext({}),SwitchLayoutGroupContext=reactExports.createContext({}),motionComponentSymbol=Symbol.for("motionComponentSymbol");function createMotionComponent({preloadedFeatures:h,createVisualElement:o,useRender:c,useVisualState:d,Component:_}){h&&loadFeatures(h);function b(it,nt){let at;const ut={...reactExports.useContext(MotionConfigContext),...it,layoutId:useLayoutId(it)},{isStatic:pt}=ut,mt=useCreateMotionContext(it),ft=d(it,pt);if(!pt&&isBrowser){mt.visualElement=useVisualElement(_,ft,ut,o);const vt=reactExports.useContext(SwitchLayoutGroupContext),xt=reactExports.useContext(LazyContext).strict;mt.visualElement&&(at=mt.visualElement.loadFeatures(ut,xt,h,vt))}return jsxRuntimeExports.jsxs(MotionContext.Provider,{value:mt,children:[at&&mt.visualElement?jsxRuntimeExports.jsx(at,{visualElement:mt.visualElement,...ut}):null,c(_,it,useMotionRef(ft,mt.visualElement,nt),ft,pt,mt.visualElement)]})}const _e=reactExports.forwardRef(b);return _e[motionComponentSymbol]=_,_e}function useLayoutId({layoutId:h}){const o=reactExports.useContext(LayoutGroupContext).id;return o&&h!==void 0?o+"-"+h:h}function createMotionProxy(h){function o(d,_={}){return createMotionComponent(h(d,_))}if(typeof Proxy>"u")return o;const c=new Map;return new Proxy(o,{get:(d,_)=>(c.has(_)||c.set(_,o(_)),c.get(_))})}const lowercaseSVGElements=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function isSVGComponent(h){return typeof h!="string"||h.includes("-")?!1:!!(lowercaseSVGElements.indexOf(h)>-1||/[A-Z]/u.test(h))}const scaleCorrectors={};function addScaleCorrector(h){Object.assign(scaleCorrectors,h)}const transformPropOrder=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],transformProps=new Set(transformPropOrder);function isForcedMotionValue(h,{layout:o,layoutId:c}){return transformProps.has(h)||h.startsWith("origin")||(o||c!==void 0)&&(!!scaleCorrectors[h]||h==="opacity")}const isMotionValue=h=>!!(h&&h.getVelocity),translateAlias={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},numTransforms=transformPropOrder.length;function buildTransform(h,{enableHardwareAcceleration:o=!0,allowTransformNone:c=!0},d,_){let b="";for(let _e=0;_e<numTransforms;_e++){const it=transformPropOrder[_e];if(h[it]!==void 0){const nt=translateAlias[it]||it;b+=`${nt}(${h[it]}) `}}return o&&!h.z&&(b+="translateZ(0)"),b=b.trim(),_?b=_(h,d?"":b):c&&d&&(b="none"),b}const checkStringStartsWith=h=>o=>typeof o=="string"&&o.startsWith(h),isCSSVariableName=checkStringStartsWith("--"),startsAsVariableToken=checkStringStartsWith("var(--"),isCSSVariableToken=h=>startsAsVariableToken(h)?singleCssVariableRegex.test(h.split("/*")[0].trim()):!1,singleCssVariableRegex=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,getValueAsType=(h,o)=>o&&typeof h=="number"?o.transform(h):h,clamp=(h,o,c)=>c>o?o:c<h?h:c,number={test:h=>typeof h=="number",parse:parseFloat,transform:h=>h},alpha={...number,transform:h=>clamp(0,1,h)},scale={...number,default:1},sanitize=h=>Math.round(h*1e5)/1e5,floatRegex=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu,colorRegex=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu,singleColorRegex=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu;function isString(h){return typeof h=="string"}const createUnitType=h=>({test:o=>isString(o)&&o.endsWith(h)&&o.split(" ").length===1,parse:parseFloat,transform:o=>`${o}${h}`}),degrees=createUnitType("deg"),percent=createUnitType("%"),px=createUnitType("px"),vh=createUnitType("vh"),vw=createUnitType("vw"),progressPercentage={...percent,parse:h=>percent.parse(h)/100,transform:h=>percent.transform(h*100)},int={...number,transform:Math.round},numberValueTypes={borderWidth:px,borderTopWidth:px,borderRightWidth:px,borderBottomWidth:px,borderLeftWidth:px,borderRadius:px,radius:px,borderTopLeftRadius:px,borderTopRightRadius:px,borderBottomRightRadius:px,borderBottomLeftRadius:px,width:px,maxWidth:px,height:px,maxHeight:px,size:px,top:px,right:px,bottom:px,left:px,padding:px,paddingTop:px,paddingRight:px,paddingBottom:px,paddingLeft:px,margin:px,marginTop:px,marginRight:px,marginBottom:px,marginLeft:px,rotate:degrees,rotateX:degrees,rotateY:degrees,rotateZ:degrees,scale,scaleX:scale,scaleY:scale,scaleZ:scale,skew:degrees,skewX:degrees,skewY:degrees,distance:px,translateX:px,translateY:px,translateZ:px,x:px,y:px,z:px,perspective:px,transformPerspective:px,opacity:alpha,originX:progressPercentage,originY:progressPercentage,originZ:px,zIndex:int,backgroundPositionX:px,backgroundPositionY:px,fillOpacity:alpha,strokeOpacity:alpha,numOctaves:int};function buildHTMLStyles(h,o,c,d){const{style:_,vars:b,transform:_e,transformOrigin:it}=h;let nt=!1,at=!1,ut=!0;for(const pt in o){const mt=o[pt];if(isCSSVariableName(pt)){b[pt]=mt;continue}const ft=numberValueTypes[pt],vt=getValueAsType(mt,ft);if(transformProps.has(pt)){if(nt=!0,_e[pt]=vt,!ut)continue;mt!==(ft.default||0)&&(ut=!1)}else pt.startsWith("origin")?(at=!0,it[pt]=vt):_[pt]=vt}if(o.transform||(nt||d?_.transform=buildTransform(h.transform,c,ut,d):_.transform&&(_.transform="none")),at){const{originX:pt="50%",originY:mt="50%",originZ:ft=0}=it;_.transformOrigin=`${pt} ${mt} ${ft}`}}const createHtmlRenderState=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function copyRawValuesOnly(h,o,c){for(const d in o)!isMotionValue(o[d])&&!isForcedMotionValue(d,c)&&(h[d]=o[d])}function useInitialMotionValues({transformTemplate:h},o,c){return reactExports.useMemo(()=>{const d=createHtmlRenderState();return buildHTMLStyles(d,o,{enableHardwareAcceleration:!c},h),Object.assign({},d.vars,d.style)},[o])}function useStyle(h,o,c){const d=h.style||{},_={};return copyRawValuesOnly(_,d,h),Object.assign(_,useInitialMotionValues(h,o,c)),_}function useHTMLProps(h,o,c){const d={},_=useStyle(h,o,c);return h.drag&&h.dragListener!==!1&&(d.draggable=!1,_.userSelect=_.WebkitUserSelect=_.WebkitTouchCallout="none",_.touchAction=h.drag===!0?"none":`pan-${h.drag==="x"?"y":"x"}`),h.tabIndex===void 0&&(h.onTap||h.onTapStart||h.whileTap)&&(d.tabIndex=0),d.style=_,d}const validMotionProps=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function isValidMotionProp(h){return h.startsWith("while")||h.startsWith("drag")&&h!=="draggable"||h.startsWith("layout")||h.startsWith("onTap")||h.startsWith("onPan")||h.startsWith("onLayout")||validMotionProps.has(h)}let shouldForward=h=>!isValidMotionProp(h);function loadExternalIsValidProp(h){h&&(shouldForward=o=>o.startsWith("on")?!isValidMotionProp(o):h(o))}try{loadExternalIsValidProp(require("@emotion/is-prop-valid").default)}catch(h){}function filterProps(h,o,c){const d={};for(const _ in h)_==="values"&&typeof h.values=="object"||(shouldForward(_)||c===!0&&isValidMotionProp(_)||!o&&!isValidMotionProp(_)||h.draggable&&_.startsWith("onDrag"))&&(d[_]=h[_]);return d}function calcOrigin$1(h,o,c){return typeof h=="string"?h:px.transform(o+c*h)}function calcSVGTransformOrigin(h,o,c){const d=calcOrigin$1(o,h.x,h.width),_=calcOrigin$1(c,h.y,h.height);return`${d} ${_}`}const dashKeys={offset:"stroke-dashoffset",array:"stroke-dasharray"},camelKeys={offset:"strokeDashoffset",array:"strokeDasharray"};function buildSVGPath(h,o,c=1,d=0,_=!0){h.pathLength=1;const b=_?dashKeys:camelKeys;h[b.offset]=px.transform(-d);const _e=px.transform(o),it=px.transform(c);h[b.array]=`${_e} ${it}`}function buildSVGAttrs(h,{attrX:o,attrY:c,attrScale:d,originX:_,originY:b,pathLength:_e,pathSpacing:it=1,pathOffset:nt=0,...at},ut,pt,mt){if(buildHTMLStyles(h,at,ut,mt),pt){h.style.viewBox&&(h.attrs.viewBox=h.style.viewBox);return}h.attrs=h.style,h.style={};const{attrs:ft,style:vt,dimensions:xt}=h;ft.transform&&(xt&&(vt.transform=ft.transform),delete ft.transform),xt&&(_!==void 0||b!==void 0||vt.transform)&&(vt.transformOrigin=calcSVGTransformOrigin(xt,_!==void 0?_:.5,b!==void 0?b:.5)),o!==void 0&&(ft.x=o),c!==void 0&&(ft.y=c),d!==void 0&&(ft.scale=d),_e!==void 0&&buildSVGPath(ft,_e,it,nt,!1)}const createSvgRenderState=()=>({...createHtmlRenderState(),attrs:{}}),isSVGTag=h=>typeof h=="string"&&h.toLowerCase()==="svg";function useSVGProps(h,o,c,d){const _=reactExports.useMemo(()=>{const b=createSvgRenderState();return buildSVGAttrs(b,o,{enableHardwareAcceleration:!1},isSVGTag(d),h.transformTemplate),{...b.attrs,style:{...b.style}}},[o]);if(h.style){const b={};copyRawValuesOnly(b,h.style,h),_.style={...b,..._.style}}return _}function createUseRender(h=!1){return(o,c,d,{latestValues:_},b)=>{const _e=(isSVGComponent(o)?useSVGProps:useHTMLProps)(c,_,b,o),it=filterProps(c,typeof o=="string",h),nt=o!==reactExports.Fragment?{...it,..._e,ref:d}:{},{children:at}=c,ut=reactExports.useMemo(()=>isMotionValue(at)?at.get():at,[at]);return reactExports.createElement(o,{...nt,children:ut})}}function renderHTML(h,{style:o,vars:c},d,_){Object.assign(h.style,o,_&&_.getProjectionStyles(d));for(const b in c)h.style.setProperty(b,c[b])}const camelCaseAttributes=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function renderSVG(h,o,c,d){renderHTML(h,o,void 0,d);for(const _ in o.attrs)h.setAttribute(camelCaseAttributes.has(_)?_:camelToDash(_),o.attrs[_])}function scrapeMotionValuesFromProps$1(h,o,c){var d;const{style:_}=h,b={};for(const _e in _)(isMotionValue(_[_e])||o.style&&isMotionValue(o.style[_e])||isForcedMotionValue(_e,h)||((d=c==null?void 0:c.getValue(_e))===null||d===void 0?void 0:d.liveStyle)!==void 0)&&(b[_e]=_[_e]);return b}function scrapeMotionValuesFromProps(h,o,c){const d=scrapeMotionValuesFromProps$1(h,o,c);for(const _ in h)if(isMotionValue(h[_])||isMotionValue(o[_])){const b=transformPropOrder.indexOf(_)!==-1?"attr"+_.charAt(0).toUpperCase()+_.substring(1):_;d[b]=h[_]}return d}function resolveVariantFromProps(h,o,c,d={},_={}){return typeof o=="function"&&(o=o(c!==void 0?c:h.custom,d,_)),typeof o=="string"&&(o=h.variants&&h.variants[o]),typeof o=="function"&&(o=o(c!==void 0?c:h.custom,d,_)),o}function useConstant(h){const o=reactExports.useRef(null);return o.current===null&&(o.current=h()),o.current}const isKeyframesTarget=h=>Array.isArray(h),isCustomValue=h=>!!(h&&typeof h=="object"&&h.mix&&h.toValue),resolveFinalValueInKeyframes=h=>isKeyframesTarget(h)?h[h.length-1]||0:h;function resolveMotionValue(h){const o=isMotionValue(h)?h.get():h;return isCustomValue(o)?o.toValue():o}function makeState({scrapeMotionValuesFromProps:h,createRenderState:o,onMount:c},d,_,b){const _e={latestValues:makeLatestValues(d,_,b,h),renderState:o()};return c&&(_e.mount=it=>c(d,it,_e)),_e}const makeUseVisualState=h=>(o,c)=>{const d=reactExports.useContext(MotionContext),_=reactExports.useContext(PresenceContext),b=()=>makeState(h,o,d,_);return c?b():useConstant(b)};function makeLatestValues(h,o,c,d){const _={},b=d(h,{});for(const mt in b)_[mt]=resolveMotionValue(b[mt]);let{initial:_e,animate:it}=h;const nt=isControllingVariants(h),at=isVariantNode(h);o&&at&&!nt&&h.inherit!==!1&&(_e===void 0&&(_e=o.initial),it===void 0&&(it=o.animate));let ut=c?c.initial===!1:!1;ut=ut||_e===!1;const pt=ut?it:_e;return pt&&typeof pt!="boolean"&&!isAnimationControls(pt)&&(Array.isArray(pt)?pt:[pt]).forEach(mt=>{const ft=resolveVariantFromProps(h,mt);if(!ft)return;const{transitionEnd:vt,transition:xt,...At}=ft;for(const Ct in At){let Et=At[Ct];if(Array.isArray(Et)){const Tt=ut?Et.length-1:0;Et=Et[Tt]}Et!==null&&(_[Ct]=Et)}for(const Ct in vt)_[Ct]=vt[Ct]}),_}const noop=h=>h,{schedule:frame,cancel:cancelFrame,state:frameData,steps}=createRenderBatcher(typeof requestAnimationFrame<"u"?requestAnimationFrame:noop,!0),svgMotionConfig={useVisualState:makeUseVisualState({scrapeMotionValuesFromProps,createRenderState:createSvgRenderState,onMount:(h,o,{renderState:c,latestValues:d})=>{frame.read(()=>{try{c.dimensions=typeof o.getBBox=="function"?o.getBBox():o.getBoundingClientRect()}catch{c.dimensions={x:0,y:0,width:0,height:0}}}),frame.render(()=>{buildSVGAttrs(c,d,{enableHardwareAcceleration:!1},isSVGTag(o.tagName),h.transformTemplate),renderSVG(o,c)})}})},htmlMotionConfig={useVisualState:makeUseVisualState({scrapeMotionValuesFromProps:scrapeMotionValuesFromProps$1,createRenderState:createHtmlRenderState})};function createDomMotionConfig(h,{forwardMotionProps:o=!1},c,d){return{...isSVGComponent(h)?svgMotionConfig:htmlMotionConfig,preloadedFeatures:c,useRender:createUseRender(o),createVisualElement:d,Component:h}}function addDomEvent(h,o,c,d={passive:!0}){return h.addEventListener(o,c,d),()=>h.removeEventListener(o,c)}const isPrimaryPointer=h=>h.pointerType==="mouse"?typeof h.button!="number"||h.button<=0:h.isPrimary!==!1;function extractEventInfo(h,o="page"){return{point:{x:h[`${o}X`],y:h[`${o}Y`]}}}const addPointerInfo=h=>o=>isPrimaryPointer(o)&&h(o,extractEventInfo(o));function addPointerEvent(h,o,c,d){return addDomEvent(h,o,addPointerInfo(c),d)}const combineFunctions=(h,o)=>c=>o(h(c)),pipe=(...h)=>h.reduce(combineFunctions);function createLock(h){let o=null;return()=>{const c=()=>{o=null};return o===null?(o=h,c):!1}}const globalHorizontalLock=createLock("dragHorizontal"),globalVerticalLock=createLock("dragVertical");function getGlobalLock(h){let o=!1;if(h==="y")o=globalVerticalLock();else if(h==="x")o=globalHorizontalLock();else{const c=globalHorizontalLock(),d=globalVerticalLock();c&&d?o=()=>{c(),d()}:(c&&c(),d&&d())}return o}function isDragActive(){const h=getGlobalLock(!0);return h?(h(),!1):!0}class Feature{constructor(o){this.isMounted=!1,this.node=o}update(){}}function addHoverEvent(h,o){const c=o?"pointerenter":"pointerleave",d=o?"onHoverStart":"onHoverEnd",_=(b,_e)=>{if(b.pointerType==="touch"||isDragActive())return;const it=h.getProps();h.animationState&&it.whileHover&&h.animationState.setActive("whileHover",o);const nt=it[d];nt&&frame.postRender(()=>nt(b,_e))};return addPointerEvent(h.current,c,_,{passive:!h.getProps()[d]})}class HoverGesture extends Feature{mount(){this.unmount=pipe(addHoverEvent(this.node,!0),addHoverEvent(this.node,!1))}unmount(){}}class FocusGesture extends Feature{constructor(){super(...arguments),this.isActive=!1}onFocus(){let o=!1;try{o=this.node.current.matches(":focus-visible")}catch{o=!0}!o||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=pipe(addDomEvent(this.node.current,"focus",()=>this.onFocus()),addDomEvent(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}const isNodeOrChild=(h,o)=>o?h===o?!0:isNodeOrChild(h,o.parentElement):!1;function fireSyntheticPointerEvent(h,o){if(!o)return;const c=new PointerEvent("pointer"+h);o(c,extractEventInfo(c))}class PressGesture extends Feature{constructor(){super(...arguments),this.removeStartListeners=noop,this.removeEndListeners=noop,this.removeAccessibleListeners=noop,this.startPointerPress=(o,c)=>{if(this.isPressing)return;this.removeEndListeners();const d=this.node.getProps(),_=addPointerEvent(window,"pointerup",(_e,it)=>{if(!this.checkPressEnd())return;const{onTap:nt,onTapCancel:at,globalTapTarget:ut}=this.node.getProps(),pt=!ut&&!isNodeOrChild(this.node.current,_e.target)?at:nt;pt&&frame.update(()=>pt(_e,it))},{passive:!(d.onTap||d.onPointerUp)}),b=addPointerEvent(window,"pointercancel",(_e,it)=>this.cancelPress(_e,it),{passive:!(d.onTapCancel||d.onPointerCancel)});this.removeEndListeners=pipe(_,b),this.startPress(o,c)},this.startAccessiblePress=()=>{const o=b=>{if(b.key!=="Enter"||this.isPressing)return;const _e=it=>{it.key!=="Enter"||!this.checkPressEnd()||fireSyntheticPointerEvent("up",(nt,at)=>{const{onTap:ut}=this.node.getProps();ut&&frame.postRender(()=>ut(nt,at))})};this.removeEndListeners(),this.removeEndListeners=addDomEvent(this.node.current,"keyup",_e),fireSyntheticPointerEvent("down",(it,nt)=>{this.startPress(it,nt)})},c=addDomEvent(this.node.current,"keydown",o),d=()=>{this.isPressing&&fireSyntheticPointerEvent("cancel",(b,_e)=>this.cancelPress(b,_e))},_=addDomEvent(this.node.current,"blur",d);this.removeAccessibleListeners=pipe(c,_)}}startPress(o,c){this.isPressing=!0;const{onTapStart:d,whileTap:_}=this.node.getProps();_&&this.node.animationState&&this.node.animationState.setActive("whileTap",!0),d&&frame.postRender(()=>d(o,c))}checkPressEnd(){return this.removeEndListeners(),this.isPressing=!1,this.node.getProps().whileTap&&this.node.animationState&&this.node.animationState.setActive("whileTap",!1),!isDragActive()}cancelPress(o,c){if(!this.checkPressEnd())return;const{onTapCancel:d}=this.node.getProps();d&&frame.postRender(()=>d(o,c))}mount(){const o=this.node.getProps(),c=addPointerEvent(o.globalTapTarget?window:this.node.current,"pointerdown",this.startPointerPress,{passive:!(o.onTapStart||o.onPointerStart)}),d=addDomEvent(this.node.current,"focus",this.startAccessiblePress);this.removeStartListeners=pipe(c,d)}unmount(){this.removeStartListeners(),this.removeEndListeners(),this.removeAccessibleListeners()}}const observerCallbacks=new WeakMap,observers=new WeakMap,fireObserverCallback=h=>{const o=observerCallbacks.get(h.target);o&&o(h)},fireAllObserverCallbacks=h=>{h.forEach(fireObserverCallback)};function initIntersectionObserver({root:h,...o}){const c=h||document;observers.has(c)||observers.set(c,{});const d=observers.get(c),_=JSON.stringify(o);return d[_]||(d[_]=new IntersectionObserver(fireAllObserverCallbacks,{root:h,...o})),d[_]}function observeIntersection(h,o,c){const d=initIntersectionObserver(o);return observerCallbacks.set(h,c),d.observe(h),()=>{observerCallbacks.delete(h),d.unobserve(h)}}const thresholdNames={some:0,all:1};class InViewFeature extends Feature{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:o={}}=this.node.getProps(),{root:c,margin:d,amount:_="some",once:b}=o,_e={root:c?c.current:void 0,rootMargin:d,threshold:typeof _=="number"?_:thresholdNames[_]},it=nt=>{const{isIntersecting:at}=nt;if(this.isInView===at||(this.isInView=at,b&&!at&&this.hasEnteredView))return;at&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",at);const{onViewportEnter:ut,onViewportLeave:pt}=this.node.getProps(),mt=at?ut:pt;mt&&mt(nt)};return observeIntersection(this.node.current,_e,it)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:o,prevProps:c}=this.node;["amount","margin","root"].some(hasViewportOptionChanged(o,c))&&this.startObserver()}unmount(){}}function hasViewportOptionChanged({viewport:h={}},{viewport:o={}}={}){return c=>h[c]!==o[c]}const gestureAnimations={inView:{Feature:InViewFeature},tap:{Feature:PressGesture},focus:{Feature:FocusGesture},hover:{Feature:HoverGesture}};function shallowCompare(h,o){if(!Array.isArray(o))return!1;const c=o.length;if(c!==h.length)return!1;for(let d=0;d<c;d++)if(o[d]!==h[d])return!1;return!0}function getCurrent(h){const o={};return h.values.forEach((c,d)=>o[d]=c.get()),o}function getVelocity$1(h){const o={};return h.values.forEach((c,d)=>o[d]=c.getVelocity()),o}function resolveVariant(h,o,c){const d=h.getProps();return resolveVariantFromProps(d,o,c!==void 0?c:d.custom,getCurrent(h),getVelocity$1(h))}const secondsToMilliseconds=h=>h*1e3,millisecondsToSeconds=h=>h/1e3,underDampedSpring={type:"spring",stiffness:500,damping:25,restSpeed:10},criticallyDampedSpring=h=>({type:"spring",stiffness:550,damping:h===0?2*Math.sqrt(550):30,restSpeed:10}),keyframesTransition={type:"keyframes",duration:.8},ease={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},getDefaultTransition=(h,{keyframes:o})=>o.length>2?keyframesTransition:transformProps.has(h)?h.startsWith("scale")?criticallyDampedSpring(o[1]):underDampedSpring:ease;function isTransitionDefined({when:h,delay:o,delayChildren:c,staggerChildren:d,staggerDirection:_,repeat:b,repeatType:_e,repeatDelay:it,from:nt,elapsed:at,...ut}){return!!Object.keys(ut).length}function getValueTransition(h,o){return h[o]||h.default||h}const isNotNull=h=>h!==null;function getFinalKeyframe(h,{repeat:o,repeatType:c="loop"},d){const _=h.filter(isNotNull),b=o&&c!=="loop"&&o%2===1?0:_.length-1;return!b||d===void 0?_[b]:d}let now;function clearTime(){now=void 0}const time={now:()=>(now===void 0&&time.set(frameData.isProcessing||MotionGlobalConfig.useManualTiming?frameData.timestamp:performance.now()),now),set:h=>{now=h,queueMicrotask(clearTime)}},isZeroValueString=h=>/^0[^.\s]+$/u.test(h);function isNone(h){return typeof h=="number"?h===0:h!==null?h==="none"||h==="0"||isZeroValueString(h):!0}let invariant=noop;const isNumericalString=h=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(h),splitCSSVariableRegex=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function parseCSSVariable(h){const o=splitCSSVariableRegex.exec(h);if(!o)return[,];const[,c,d,_]=o;return[`--${c??d}`,_]}function getVariableValue(h,o,c=1){const[d,_]=parseCSSVariable(h);if(!d)return;const b=window.getComputedStyle(o).getPropertyValue(d);if(b){const _e=b.trim();return isNumericalString(_e)?parseFloat(_e):_e}return isCSSVariableToken(_)?getVariableValue(_,o,c+1):_}const positionalKeys=new Set(["width","height","top","left","right","bottom","x","y","translateX","translateY"]),isNumOrPxType=h=>h===number||h===px,getPosFromMatrix=(h,o)=>parseFloat(h.split(", ")[o]),getTranslateFromMatrix=(h,o)=>(c,{transform:d})=>{if(d==="none"||!d)return 0;const _=d.match(/^matrix3d\((.+)\)$/u);if(_)return getPosFromMatrix(_[1],o);{const b=d.match(/^matrix\((.+)\)$/u);return b?getPosFromMatrix(b[1],h):0}},transformKeys=new Set(["x","y","z"]),nonTranslationalTransformKeys=transformPropOrder.filter(h=>!transformKeys.has(h));function removeNonTranslationalTransform(h){const o=[];return nonTranslationalTransformKeys.forEach(c=>{const d=h.getValue(c);d!==void 0&&(o.push([c,d.get()]),d.set(c.startsWith("scale")?1:0))}),o}const positionalValues={width:({x:h},{paddingLeft:o="0",paddingRight:c="0"})=>h.max-h.min-parseFloat(o)-parseFloat(c),height:({y:h},{paddingTop:o="0",paddingBottom:c="0"})=>h.max-h.min-parseFloat(o)-parseFloat(c),top:(h,{top:o})=>parseFloat(o),left:(h,{left:o})=>parseFloat(o),bottom:({y:h},{top:o})=>parseFloat(o)+(h.max-h.min),right:({x:h},{left:o})=>parseFloat(o)+(h.max-h.min),x:getTranslateFromMatrix(4,13),y:getTranslateFromMatrix(5,14)};positionalValues.translateX=positionalValues.x;positionalValues.translateY=positionalValues.y;const testValueType=h=>o=>o.test(h),auto={test:h=>h==="auto",parse:h=>h},dimensionValueTypes=[number,px,percent,degrees,vw,vh,auto],findDimensionValueType=h=>dimensionValueTypes.find(testValueType(h)),toResolve=new Set;let isScheduled=!1,anyNeedsMeasurement=!1;function measureAllKeyframes(){if(anyNeedsMeasurement){const h=Array.from(toResolve).filter(d=>d.needsMeasurement),o=new Set(h.map(d=>d.element)),c=new Map;o.forEach(d=>{const _=removeNonTranslationalTransform(d);_.length&&(c.set(d,_),d.render())}),h.forEach(d=>d.measureInitialState()),o.forEach(d=>{d.render();const _=c.get(d);_&&_.forEach(([b,_e])=>{var it;(it=d.getValue(b))===null||it===void 0||it.set(_e)})}),h.forEach(d=>d.measureEndState()),h.forEach(d=>{d.suspendedScrollY!==void 0&&window.scrollTo(0,d.suspendedScrollY)})}anyNeedsMeasurement=!1,isScheduled=!1,toResolve.forEach(h=>h.complete()),toResolve.clear()}function readAllKeyframes(){toResolve.forEach(h=>{h.readKeyframes(),h.needsMeasurement&&(anyNeedsMeasurement=!0)})}function flushKeyframeResolvers(){readAllKeyframes(),measureAllKeyframes()}class KeyframeResolver{constructor(o,c,d,_,b,_e=!1){this.isComplete=!1,this.isAsync=!1,this.needsMeasurement=!1,this.isScheduled=!1,this.unresolvedKeyframes=[...o],this.onComplete=c,this.name=d,this.motionValue=_,this.element=b,this.isAsync=_e}scheduleResolve(){this.isScheduled=!0,this.isAsync?(toResolve.add(this),isScheduled||(isScheduled=!0,frame.read(readAllKeyframes),frame.resolveKeyframes(measureAllKeyframes))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:o,name:c,element:d,motionValue:_}=this;for(let b=0;b<o.length;b++)if(o[b]===null)if(b===0){const _e=_==null?void 0:_.get(),it=o[o.length-1];if(_e!==void 0)o[0]=_e;else if(d&&c){const nt=d.readValue(c,it);nt!=null&&(o[0]=nt)}o[0]===void 0&&(o[0]=it),_&&_e===void 0&&_.set(o[0])}else o[b]=o[b-1]}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(){this.isComplete=!0,this.onComplete(this.unresolvedKeyframes,this.finalKeyframe),toResolve.delete(this)}cancel(){this.isComplete||(this.isScheduled=!1,toResolve.delete(this))}resume(){this.isComplete||this.scheduleResolve()}}const isColorString=(h,o)=>c=>!!(isString(c)&&singleColorRegex.test(c)&&c.startsWith(h)||o&&Object.prototype.hasOwnProperty.call(c,o)),splitColor=(h,o,c)=>d=>{if(!isString(d))return d;const[_,b,_e,it]=d.match(floatRegex);return{[h]:parseFloat(_),[o]:parseFloat(b),[c]:parseFloat(_e),alpha:it!==void 0?parseFloat(it):1}},clampRgbUnit=h=>clamp(0,255,h),rgbUnit={...number,transform:h=>Math.round(clampRgbUnit(h))},rgba={test:isColorString("rgb","red"),parse:splitColor("red","green","blue"),transform:({red:h,green:o,blue:c,alpha:d=1})=>"rgba("+rgbUnit.transform(h)+", "+rgbUnit.transform(o)+", "+rgbUnit.transform(c)+", "+sanitize(alpha.transform(d))+")"};function parseHex(h){let o="",c="",d="",_="";return h.length>5?(o=h.substring(1,3),c=h.substring(3,5),d=h.substring(5,7),_=h.substring(7,9)):(o=h.substring(1,2),c=h.substring(2,3),d=h.substring(3,4),_=h.substring(4,5),o+=o,c+=c,d+=d,_+=_),{red:parseInt(o,16),green:parseInt(c,16),blue:parseInt(d,16),alpha:_?parseInt(_,16)/255:1}}const hex={test:isColorString("#"),parse:parseHex,transform:rgba.transform},hsla={test:isColorString("hsl","hue"),parse:splitColor("hue","saturation","lightness"),transform:({hue:h,saturation:o,lightness:c,alpha:d=1})=>"hsla("+Math.round(h)+", "+percent.transform(sanitize(o))+", "+percent.transform(sanitize(c))+", "+sanitize(alpha.transform(d))+")"},color={test:h=>rgba.test(h)||hex.test(h)||hsla.test(h),parse:h=>rgba.test(h)?rgba.parse(h):hsla.test(h)?hsla.parse(h):hex.parse(h),transform:h=>isString(h)?h:h.hasOwnProperty("red")?rgba.transform(h):hsla.transform(h)};function test(h){var o,c;return isNaN(h)&&isString(h)&&(((o=h.match(floatRegex))===null||o===void 0?void 0:o.length)||0)+(((c=h.match(colorRegex))===null||c===void 0?void 0:c.length)||0)>0}const NUMBER_TOKEN="number",COLOR_TOKEN="color",VAR_TOKEN="var",VAR_FUNCTION_TOKEN="var(",SPLIT_TOKEN="${}",complexRegex=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function analyseComplexValue(h){const o=h.toString(),c=[],d={color:[],number:[],var:[]},_=[];let b=0;const _e=o.replace(complexRegex,it=>(color.test(it)?(d.color.push(b),_.push(COLOR_TOKEN),c.push(color.parse(it))):it.startsWith(VAR_FUNCTION_TOKEN)?(d.var.push(b),_.push(VAR_TOKEN),c.push(it)):(d.number.push(b),_.push(NUMBER_TOKEN),c.push(parseFloat(it))),++b,SPLIT_TOKEN)).split(SPLIT_TOKEN);return{values:c,split:_e,indexes:d,types:_}}function parseComplexValue(h){return analyseComplexValue(h).values}function createTransformer(h){const{split:o,types:c}=analyseComplexValue(h),d=o.length;return _=>{let b="";for(let _e=0;_e<d;_e++)if(b+=o[_e],_[_e]!==void 0){const it=c[_e];it===NUMBER_TOKEN?b+=sanitize(_[_e]):it===COLOR_TOKEN?b+=color.transform(_[_e]):b+=_[_e]}return b}}const convertNumbersToZero=h=>typeof h=="number"?0:h;function getAnimatableNone$1(h){const o=parseComplexValue(h);return createTransformer(h)(o.map(convertNumbersToZero))}const complex={test,parse:parseComplexValue,createTransformer,getAnimatableNone:getAnimatableNone$1},maxDefaults=new Set(["brightness","contrast","saturate","opacity"]);function applyDefaultFilter(h){const[o,c]=h.slice(0,-1).split("(");if(o==="drop-shadow")return h;const[d]=c.match(floatRegex)||[];if(!d)return h;const _=c.replace(d,"");let b=maxDefaults.has(o)?1:0;return d!==c&&(b*=100),o+"("+b+_+")"}const functionRegex=/\b([a-z-]*)\(.*?\)/gu,filter={...complex,getAnimatableNone:h=>{const o=h.match(functionRegex);return o?o.map(applyDefaultFilter).join(" "):h}},defaultValueTypes={...numberValueTypes,color,backgroundColor:color,outlineColor:color,fill:color,stroke:color,borderColor:color,borderTopColor:color,borderRightColor:color,borderBottomColor:color,borderLeftColor:color,filter,WebkitFilter:filter},getDefaultValueType=h=>defaultValueTypes[h];function getAnimatableNone(h,o){let c=getDefaultValueType(h);return c!==filter&&(c=complex),c.getAnimatableNone?c.getAnimatableNone(o):void 0}const invalidTemplates=new Set(["auto","none","0"]);function makeNoneKeyframesAnimatable(h,o,c){let d=0,_;for(;d<h.length&&!_;){const b=h[d];typeof b=="string"&&!invalidTemplates.has(b)&&(_=h[d]),d++}if(_&&c)for(const b of o)h[b]=getAnimatableNone(c,_)}class DOMKeyframesResolver extends KeyframeResolver{constructor(o,c,d,_){super(o,c,d,_,_==null?void 0:_.owner,!0)}readKeyframes(){const{unresolvedKeyframes:o,element:c,name:d}=this;if(!c.current)return;super.readKeyframes();for(let nt=0;nt<o.length;nt++){const at=o[nt];if(typeof at=="string"&&isCSSVariableToken(at)){const ut=getVariableValue(at,c.current);ut!==void 0&&(o[nt]=ut),nt===o.length-1&&(this.finalKeyframe=at)}}if(this.resolveNoneKeyframes(),!positionalKeys.has(d)||o.length!==2)return;const[_,b]=o,_e=findDimensionValueType(_),it=findDimensionValueType(b);if(_e!==it)if(isNumOrPxType(_e)&&isNumOrPxType(it))for(let nt=0;nt<o.length;nt++){const at=o[nt];typeof at=="string"&&(o[nt]=parseFloat(at))}else this.needsMeasurement=!0}resolveNoneKeyframes(){const{unresolvedKeyframes:o,name:c}=this,d=[];for(let _=0;_<o.length;_++)isNone(o[_])&&d.push(_);d.length&&makeNoneKeyframesAnimatable(o,d,c)}measureInitialState(){const{element:o,unresolvedKeyframes:c,name:d}=this;if(!o.current)return;d==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=positionalValues[d](o.measureViewportBox(),window.getComputedStyle(o.current)),c[0]=this.measuredOrigin;const _=c[c.length-1];_!==void 0&&o.getValue(d,_).jump(_,!1)}measureEndState(){var o;const{element:c,name:d,unresolvedKeyframes:_}=this;if(!c.current)return;const b=c.getValue(d);b&&b.jump(this.measuredOrigin,!1);const _e=_.length-1,it=_[_e];_[_e]=positionalValues[d](c.measureViewportBox(),window.getComputedStyle(c.current)),it!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=it),!((o=this.removedTransforms)===null||o===void 0)&&o.length&&this.removedTransforms.forEach(([nt,at])=>{c.getValue(nt).set(at)}),this.resolveNoneKeyframes()}}function memo(h){let o;return()=>(o===void 0&&(o=h()),o)}const isAnimatable=(h,o)=>o==="zIndex"?!1:!!(typeof h=="number"||Array.isArray(h)||typeof h=="string"&&(complex.test(h)||h==="0")&&!h.startsWith("url("));function hasKeyframesChanged(h){const o=h[0];if(h.length===1)return!0;for(let c=0;c<h.length;c++)if(h[c]!==o)return!0}function canAnimate(h,o,c,d){const _=h[0];if(_===null)return!1;const b=h[h.length-1],_e=isAnimatable(_,o),it=isAnimatable(b,o);return!_e||!it?!1:hasKeyframesChanged(h)||c==="spring"&&d}class BaseAnimation{constructor({autoplay:o=!0,delay:c=0,type:d="keyframes",repeat:_=0,repeatDelay:b=0,repeatType:_e="loop",...it}){this.isStopped=!1,this.hasAttemptedResolve=!1,this.options={autoplay:o,delay:c,type:d,repeat:_,repeatDelay:b,repeatType:_e,...it},this.updateFinishedPromise()}get resolved(){return!this._resolved&&!this.hasAttemptedResolve&&flushKeyframeResolvers(),this._resolved}onKeyframesResolved(o,c){this.hasAttemptedResolve=!0;const{name:d,type:_,velocity:b,delay:_e,onComplete:it,onUpdate:nt,isGenerator:at}=this.options;if(!at&&!canAnimate(o,d,_,b))if(_e)this.options.duration=0;else{nt==null||nt(getFinalKeyframe(o,this.options,c)),it==null||it(),this.resolveFinishedPromise();return}const ut=this.initPlayback(o,c);ut!==!1&&(this._resolved={keyframes:o,finalKeyframe:c,...ut},this.onPostResolved())}onPostResolved(){}then(o,c){return this.currentFinishedPromise.then(o,c)}updateFinishedPromise(){this.currentFinishedPromise=new Promise(o=>{this.resolveFinishedPromise=o})}}function velocityPerSecond(h,o){return o?h*(1e3/o):0}const velocitySampleDuration=5;function calcGeneratorVelocity(h,o,c){const d=Math.max(o-velocitySampleDuration,0);return velocityPerSecond(c-h(d),o-d)}const safeMin=.001,minDuration=.01,maxDuration$1=10,minDamping=.05,maxDamping=1;function findSpring({duration:h=800,bounce:o=.25,velocity:c=0,mass:d=1}){let _,b,_e=1-o;_e=clamp(minDamping,maxDamping,_e),h=clamp(minDuration,maxDuration$1,millisecondsToSeconds(h)),_e<1?(_=at=>{const ut=at*_e,pt=ut*h,mt=ut-c,ft=calcAngularFreq(at,_e),vt=Math.exp(-pt);return safeMin-mt/ft*vt},b=at=>{const ut=at*_e*h,pt=ut*c+c,mt=Math.pow(_e,2)*Math.pow(at,2)*h,ft=Math.exp(-ut),vt=calcAngularFreq(Math.pow(at,2),_e);return(-_(at)+safeMin>0?-1:1)*((pt-mt)*ft)/vt}):(_=at=>{const ut=Math.exp(-at*h),pt=(at-c)*h+1;return-safeMin+ut*pt},b=at=>{const ut=Math.exp(-at*h),pt=(c-at)*(h*h);return ut*pt});const it=5/h,nt=approximateRoot(_,b,it);if(h=secondsToMilliseconds(h),isNaN(nt))return{stiffness:100,damping:10,duration:h};{const at=Math.pow(nt,2)*d;return{stiffness:at,damping:_e*2*Math.sqrt(d*at),duration:h}}}const rootIterations=12;function approximateRoot(h,o,c){let d=c;for(let _=1;_<rootIterations;_++)d=d-h(d)/o(d);return d}function calcAngularFreq(h,o){return h*Math.sqrt(1-o*o)}const durationKeys=["duration","bounce"],physicsKeys=["stiffness","damping","mass"];function isSpringType(h,o){return o.some(c=>h[c]!==void 0)}function getSpringOptions(h){let o={velocity:0,stiffness:100,damping:10,mass:1,isResolvedFromDuration:!1,...h};if(!isSpringType(h,physicsKeys)&&isSpringType(h,durationKeys)){const c=findSpring(h);o={...o,...c,mass:1},o.isResolvedFromDuration=!0}return o}function spring({keyframes:h,restDelta:o,restSpeed:c,...d}){const _=h[0],b=h[h.length-1],_e={done:!1,value:_},{stiffness:it,damping:nt,mass:at,duration:ut,velocity:pt,isResolvedFromDuration:mt}=getSpringOptions({...d,velocity:-millisecondsToSeconds(d.velocity||0)}),ft=pt||0,vt=nt/(2*Math.sqrt(it*at)),xt=b-_,At=millisecondsToSeconds(Math.sqrt(it/at)),Ct=Math.abs(xt)<5;c||(c=Ct?.01:2),o||(o=Ct?.005:.5);let Et;if(vt<1){const Tt=calcAngularFreq(At,vt);Et=kt=>{const Dt=Math.exp(-vt*At*kt);return b-Dt*((ft+vt*At*xt)/Tt*Math.sin(Tt*kt)+xt*Math.cos(Tt*kt))}}else if(vt===1)Et=Tt=>b-Math.exp(-At*Tt)*(xt+(ft+At*xt)*Tt);else{const Tt=At*Math.sqrt(vt*vt-1);Et=kt=>{const Dt=Math.exp(-vt*At*kt),zt=Math.min(Tt*kt,300);return b-Dt*((ft+vt*At*xt)*Math.sinh(zt)+Tt*xt*Math.cosh(zt))/Tt}}return{calculatedDuration:mt&&ut||null,next:Tt=>{const kt=Et(Tt);if(mt)_e.done=Tt>=ut;else{let Dt=ft;Tt!==0&&(vt<1?Dt=calcGeneratorVelocity(Et,Tt,kt):Dt=0);const zt=Math.abs(Dt)<=c,Bt=Math.abs(b-kt)<=o;_e.done=zt&&Bt}return _e.value=_e.done?b:kt,_e}}}function inertia({keyframes:h,velocity:o=0,power:c=.8,timeConstant:d=325,bounceDamping:_=10,bounceStiffness:b=500,modifyTarget:_e,min:it,max:nt,restDelta:at=.5,restSpeed:ut}){const pt=h[0],mt={done:!1,value:pt},ft=Rt=>it!==void 0&&Rt<it||nt!==void 0&&Rt>nt,vt=Rt=>it===void 0?nt:nt===void 0||Math.abs(it-Rt)<Math.abs(nt-Rt)?it:nt;let xt=c*o;const At=pt+xt,Ct=_e===void 0?At:_e(At);Ct!==At&&(xt=Ct-pt);const Et=Rt=>-xt*Math.exp(-Rt/d),Tt=Rt=>Ct+Et(Rt),kt=Rt=>{const Ut=Et(Rt),Ht=Tt(Rt);mt.done=Math.abs(Ut)<=at,mt.value=mt.done?Ct:Ht};let Dt,zt;const Bt=Rt=>{ft(mt.value)&&(Dt=Rt,zt=spring({keyframes:[mt.value,vt(mt.value)],velocity:calcGeneratorVelocity(Tt,Rt,mt.value),damping:_,stiffness:b,restDelta:at,restSpeed:ut}))};return Bt(0),{calculatedDuration:null,next:Rt=>{let Ut=!1;return!zt&&Dt===void 0&&(Ut=!0,kt(Rt),Bt(Rt)),Dt!==void 0&&Rt>=Dt?zt.next(Rt-Dt):(!Ut&&kt(Rt),mt)}}}const calcBezier=(h,o,c)=>(((1-3*c+3*o)*h+(3*c-6*o))*h+3*o)*h,subdivisionPrecision=1e-7,subdivisionMaxIterations=12;function binarySubdivide(h,o,c,d,_){let b,_e,it=0;do _e=o+(c-o)/2,b=calcBezier(_e,d,_)-h,b>0?c=_e:o=_e;while(Math.abs(b)>subdivisionPrecision&&++it<subdivisionMaxIterations);return _e}function cubicBezier(h,o,c,d){if(h===o&&c===d)return noop;const _=b=>binarySubdivide(b,0,1,h,c);return b=>b===0||b===1?b:calcBezier(_(b),o,d)}const easeIn=cubicBezier(.42,0,1,1),easeOut=cubicBezier(0,0,.58,1),easeInOut=cubicBezier(.42,0,.58,1),isEasingArray=h=>Array.isArray(h)&&typeof h[0]!="number",mirrorEasing=h=>o=>o<=.5?h(2*o)/2:(2-h(2*(1-o)))/2,reverseEasing=h=>o=>1-h(1-o),circIn=h=>1-Math.sin(Math.acos(h)),circOut=reverseEasing(circIn),circInOut=mirrorEasing(circIn),backOut=cubicBezier(.33,1.53,.69,.99),backIn=reverseEasing(backOut),backInOut=mirrorEasing(backIn),anticipate=h=>(h*=2)<1?.5*backIn(h):.5*(2-Math.pow(2,-10*(h-1))),easingLookup={linear:noop,easeIn,easeInOut,easeOut,circIn,circInOut,circOut,backIn,backInOut,backOut,anticipate},easingDefinitionToFunction=h=>{if(Array.isArray(h)){invariant(h.length===4);const[o,c,d,_]=h;return cubicBezier(o,c,d,_)}else if(typeof h=="string")return easingLookup[h];return h},progress=(h,o,c)=>{const d=o-h;return d===0?1:(c-h)/d},mixNumber$1=(h,o,c)=>h+(o-h)*c;function hueToRgb(h,o,c){return c<0&&(c+=1),c>1&&(c-=1),c<1/6?h+(o-h)*6*c:c<1/2?o:c<2/3?h+(o-h)*(2/3-c)*6:h}function hslaToRgba({hue:h,saturation:o,lightness:c,alpha:d}){h/=360,o/=100,c/=100;let _=0,b=0,_e=0;if(!o)_=b=_e=c;else{const it=c<.5?c*(1+o):c+o-c*o,nt=2*c-it;_=hueToRgb(nt,it,h+1/3),b=hueToRgb(nt,it,h),_e=hueToRgb(nt,it,h-1/3)}return{red:Math.round(_*255),green:Math.round(b*255),blue:Math.round(_e*255),alpha:d}}const mixLinearColor=(h,o,c)=>{const d=h*h,_=c*(o*o-d)+d;return _<0?0:Math.sqrt(_)},colorTypes=[hex,rgba,hsla],getColorType=h=>colorTypes.find(o=>o.test(h));function asRGBA(h){const o=getColorType(h);let c=o.parse(h);return o===hsla&&(c=hslaToRgba(c)),c}const mixColor=(h,o)=>{const c=asRGBA(h),d=asRGBA(o),_={...c};return b=>(_.red=mixLinearColor(c.red,d.red,b),_.green=mixLinearColor(c.green,d.green,b),_.blue=mixLinearColor(c.blue,d.blue,b),_.alpha=mixNumber$1(c.alpha,d.alpha,b),rgba.transform(_))};function mixImmediate(h,o){return c=>c>0?o:h}function mixNumber(h,o){return c=>mixNumber$1(h,o,c)}function getMixer$1(h){return typeof h=="number"?mixNumber:typeof h=="string"?isCSSVariableToken(h)?mixImmediate:color.test(h)?mixColor:mixComplex:Array.isArray(h)?mixArray:typeof h=="object"?color.test(h)?mixColor:mixObject:mixImmediate}function mixArray(h,o){const c=[...h],d=c.length,_=h.map((b,_e)=>getMixer$1(b)(b,o[_e]));return b=>{for(let _e=0;_e<d;_e++)c[_e]=_[_e](b);return c}}function mixObject(h,o){const c={...h,...o},d={};for(const _ in c)h[_]!==void 0&&o[_]!==void 0&&(d[_]=getMixer$1(h[_])(h[_],o[_]));return _=>{for(const b in d)c[b]=d[b](_);return c}}function matchOrder(h,o){var c;const d=[],_={color:0,var:0,number:0};for(let b=0;b<o.values.length;b++){const _e=o.types[b],it=h.indexes[_e][_[_e]],nt=(c=h.values[it])!==null&&c!==void 0?c:0;d[b]=nt,_[_e]++}return d}const mixComplex=(h,o)=>{const c=complex.createTransformer(o),d=analyseComplexValue(h),_=analyseComplexValue(o);return d.indexes.var.length===_.indexes.var.length&&d.indexes.color.length===_.indexes.color.length&&d.indexes.number.length>=_.indexes.number.length?pipe(mixArray(matchOrder(d,_),_.values),c):mixImmediate(h,o)};function mix(h,o,c){return typeof h=="number"&&typeof o=="number"&&typeof c=="number"?mixNumber$1(h,o,c):getMixer$1(h)(h,o)}function createMixers(h,o,c){const d=[],_=c||mix,b=h.length-1;for(let _e=0;_e<b;_e++){let it=_(h[_e],h[_e+1]);if(o){const nt=Array.isArray(o)?o[_e]||noop:o;it=pipe(nt,it)}d.push(it)}return d}function interpolate(h,o,{clamp:c=!0,ease:d,mixer:_}={}){const b=h.length;if(invariant(b===o.length),b===1)return()=>o[0];if(b===2&&h[0]===h[1])return()=>o[1];h[0]>h[b-1]&&(h=[...h].reverse(),o=[...o].reverse());const _e=createMixers(o,d,_),it=_e.length,nt=at=>{let ut=0;if(it>1)for(;ut<h.length-2&&!(at<h[ut+1]);ut++);const pt=progress(h[ut],h[ut+1],at);return _e[ut](pt)};return c?at=>nt(clamp(h[0],h[b-1],at)):nt}function fillOffset(h,o){const c=h[h.length-1];for(let d=1;d<=o;d++){const _=progress(0,o,d);h.push(mixNumber$1(c,1,_))}}function defaultOffset(h){const o=[0];return fillOffset(o,h.length-1),o}function convertOffsetToTimes(h,o){return h.map(c=>c*o)}function defaultEasing(h,o){return h.map(()=>o||easeInOut).splice(0,h.length-1)}function keyframes({duration:h=300,keyframes:o,times:c,ease:d="easeInOut"}){const _=isEasingArray(d)?d.map(easingDefinitionToFunction):easingDefinitionToFunction(d),b={done:!1,value:o[0]},_e=convertOffsetToTimes(c&&c.length===o.length?c:defaultOffset(o),h),it=interpolate(_e,o,{ease:Array.isArray(_)?_:defaultEasing(o,_)});return{calculatedDuration:h,next:nt=>(b.value=it(nt),b.done=nt>=h,b)}}const maxGeneratorDuration=2e4;function calcGeneratorDuration(h){let o=0;const c=50;let d=h.next(o);for(;!d.done&&o<maxGeneratorDuration;)o+=c,d=h.next(o);return o>=maxGeneratorDuration?1/0:o}const frameloopDriver=h=>{const o=({timestamp:c})=>h(c);return{start:()=>frame.update(o,!0),stop:()=>cancelFrame(o),now:()=>frameData.isProcessing?frameData.timestamp:time.now()}},generators={decay:inertia,inertia,tween:keyframes,keyframes,spring},percentToProgress=h=>h/100;class MainThreadAnimation extends BaseAnimation{constructor({KeyframeResolver:o=KeyframeResolver,...c}){super(c),this.holdTime=null,this.startTime=null,this.cancelTime=null,this.currentTime=0,this.playbackSpeed=1,this.pendingPlayState="running",this.state="idle",this.stop=()=>{if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;this.teardown();const{onStop:it}=this.options;it&&it()};const{name:d,motionValue:_,keyframes:b}=this.options,_e=(it,nt)=>this.onKeyframesResolved(it,nt);d&&_&&_.owner?this.resolver=_.owner.resolveKeyframes(b,_e,d,_):this.resolver=new o(b,_e,d,_),this.resolver.scheduleResolve()}initPlayback(o){const{type:c="keyframes",repeat:d=0,repeatDelay:_=0,repeatType:b,velocity:_e=0}=this.options,it=generators[c]||keyframes;let nt,at;it!==keyframes&&typeof o[0]!="number"&&(nt=pipe(percentToProgress,mix(o[0],o[1])),o=[0,100]);const ut=it({...this.options,keyframes:o});b==="mirror"&&(at=it({...this.options,keyframes:[...o].reverse(),velocity:-_e})),ut.calculatedDuration===null&&(ut.calculatedDuration=calcGeneratorDuration(ut));const{calculatedDuration:pt}=ut,mt=pt+_,ft=mt*(d+1)-_;return{generator:ut,mirroredGenerator:at,mapPercentToKeyframes:nt,calculatedDuration:pt,resolvedDuration:mt,totalDuration:ft}}onPostResolved(){const{autoplay:o=!0}=this.options;this.play(),this.pendingPlayState==="paused"||!o?this.pause():this.state=this.pendingPlayState}tick(o,c=!1){const{resolved:d}=this;if(!d){const{keyframes:Rt}=this.options;return{done:!0,value:Rt[Rt.length-1]}}const{finalKeyframe:_,generator:b,mirroredGenerator:_e,mapPercentToKeyframes:it,keyframes:nt,calculatedDuration:at,totalDuration:ut,resolvedDuration:pt}=d;if(this.startTime===null)return b.next(0);const{delay:mt,repeat:ft,repeatType:vt,repeatDelay:xt,onUpdate:At}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,o):this.speed<0&&(this.startTime=Math.min(o-ut/this.speed,this.startTime)),c?this.currentTime=o:this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=Math.round(o-this.startTime)*this.speed;const Ct=this.currentTime-mt*(this.speed>=0?1:-1),Et=this.speed>=0?Ct<0:Ct>ut;this.currentTime=Math.max(Ct,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=ut);let Tt=this.currentTime,kt=b;if(ft){const Rt=Math.min(this.currentTime,ut)/pt;let Ut=Math.floor(Rt),Ht=Rt%1;!Ht&&Rt>=1&&(Ht=1),Ht===1&&Ut--,Ut=Math.min(Ut,ft+1),Ut%2&&(vt==="reverse"?(Ht=1-Ht,xt&&(Ht-=xt/pt)):vt==="mirror"&&(kt=_e)),Tt=clamp(0,1,Ht)*pt}const Dt=Et?{done:!1,value:nt[0]}:kt.next(Tt);it&&(Dt.value=it(Dt.value));let{done:zt}=Dt;!Et&&at!==null&&(zt=this.speed>=0?this.currentTime>=ut:this.currentTime<=0);const Bt=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&zt);return Bt&&_!==void 0&&(Dt.value=getFinalKeyframe(nt,this.options,_)),At&&At(Dt.value),Bt&&this.finish(),Dt}get duration(){const{resolved:o}=this;return o?millisecondsToSeconds(o.calculatedDuration):0}get time(){return millisecondsToSeconds(this.currentTime)}set time(o){o=secondsToMilliseconds(o),this.currentTime=o,this.holdTime!==null||this.speed===0?this.holdTime=o:this.driver&&(this.startTime=this.driver.now()-o/this.speed)}get speed(){return this.playbackSpeed}set speed(o){const c=this.playbackSpeed!==o;this.playbackSpeed=o,c&&(this.time=millisecondsToSeconds(this.currentTime))}play(){if(this.resolver.isScheduled||this.resolver.resume(),!this._resolved){this.pendingPlayState="running";return}if(this.isStopped)return;const{driver:o=frameloopDriver,onPlay:c}=this.options;this.driver||(this.driver=o(_=>this.tick(_))),c&&c();const d=this.driver.now();this.holdTime!==null?this.startTime=d-this.holdTime:(!this.startTime||this.state==="finished")&&(this.startTime=d),this.state==="finished"&&this.updateFinishedPromise(),this.cancelTime=this.startTime,this.holdTime=null,this.state="running",this.driver.start()}pause(){var o;if(!this._resolved){this.pendingPlayState="paused";return}this.state="paused",this.holdTime=(o=this.currentTime)!==null&&o!==void 0?o:0}complete(){this.state!=="running"&&this.play(),this.pendingPlayState=this.state="finished",this.holdTime=null}finish(){this.teardown(),this.state="finished";const{onComplete:o}=this.options;o&&o()}cancel(){this.cancelTime!==null&&this.tick(this.cancelTime),this.teardown(),this.updateFinishedPromise()}teardown(){this.state="idle",this.stopDriver(),this.resolveFinishedPromise(),this.updateFinishedPromise(),this.startTime=this.cancelTime=null,this.resolver.cancel()}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(o){return this.startTime=0,this.tick(o,!0)}}function animateValue(h){return new MainThreadAnimation(h)}const isBezierDefinition=h=>Array.isArray(h)&&typeof h[0]=="number";function isWaapiSupportedEasing(h){return!!(!h||typeof h=="string"&&h in supportedWaapiEasing||isBezierDefinition(h)||Array.isArray(h)&&h.every(isWaapiSupportedEasing))}const cubicBezierAsString=([h,o,c,d])=>`cubic-bezier(${h}, ${o}, ${c}, ${d})`,supportedWaapiEasing={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:cubicBezierAsString([0,.65,.55,1]),circOut:cubicBezierAsString([.55,0,1,.45]),backIn:cubicBezierAsString([.31,.01,.66,-.59]),backOut:cubicBezierAsString([.33,1.53,.69,.99])};function mapEasingToNativeEasingWithDefault(h){return mapEasingToNativeEasing(h)||supportedWaapiEasing.easeOut}function mapEasingToNativeEasing(h){if(h)return isBezierDefinition(h)?cubicBezierAsString(h):Array.isArray(h)?h.map(mapEasingToNativeEasingWithDefault):supportedWaapiEasing[h]}function animateStyle(h,o,c,{delay:d=0,duration:_=300,repeat:b=0,repeatType:_e="loop",ease:it,times:nt}={}){const at={[o]:c};nt&&(at.offset=nt);const ut=mapEasingToNativeEasing(it);return Array.isArray(ut)&&(at.easing=ut),h.animate(at,{delay:d,duration:_,easing:Array.isArray(ut)?"linear":ut,fill:"both",iterations:b+1,direction:_e==="reverse"?"alternate":"normal"})}const supportsWaapi=memo(()=>Object.hasOwnProperty.call(Element.prototype,"animate")),acceleratedValues=new Set(["opacity","clipPath","filter","transform"]),sampleDelta=10,maxDuration=2e4;function requiresPregeneratedKeyframes(h){return h.type==="spring"||h.name==="backgroundColor"||!isWaapiSupportedEasing(h.ease)}function pregenerateKeyframes(h,o){const c=new MainThreadAnimation({...o,keyframes:h,repeat:0,delay:0,isGenerator:!0});let d={done:!1,value:h[0]};const _=[];let b=0;for(;!d.done&&b<maxDuration;)d=c.sample(b),_.push(d.value),b+=sampleDelta;return{times:void 0,keyframes:_,duration:b-sampleDelta,ease:"linear"}}class AcceleratedAnimation extends BaseAnimation{constructor(o){super(o);const{name:c,motionValue:d,keyframes:_}=this.options;this.resolver=new DOMKeyframesResolver(_,(b,_e)=>this.onKeyframesResolved(b,_e),c,d),this.resolver.scheduleResolve()}initPlayback(o,c){var d;let{duration:_=300,times:b,ease:_e,type:it,motionValue:nt,name:at}=this.options;if(!(!((d=nt.owner)===null||d===void 0)&&d.current))return!1;if(requiresPregeneratedKeyframes(this.options)){const{onComplete:pt,onUpdate:mt,motionValue:ft,...vt}=this.options,xt=pregenerateKeyframes(o,vt);o=xt.keyframes,o.length===1&&(o[1]=o[0]),_=xt.duration,b=xt.times,_e=xt.ease,it="keyframes"}const ut=animateStyle(nt.owner.current,at,o,{...this.options,duration:_,times:b,ease:_e});return ut.startTime=time.now(),this.pendingTimeline?(ut.timeline=this.pendingTimeline,this.pendingTimeline=void 0):ut.onfinish=()=>{const{onComplete:pt}=this.options;nt.set(getFinalKeyframe(o,this.options,c)),pt&&pt(),this.cancel(),this.resolveFinishedPromise()},{animation:ut,duration:_,times:b,type:it,ease:_e,keyframes:o}}get duration(){const{resolved:o}=this;if(!o)return 0;const{duration:c}=o;return millisecondsToSeconds(c)}get time(){const{resolved:o}=this;if(!o)return 0;const{animation:c}=o;return millisecondsToSeconds(c.currentTime||0)}set time(o){const{resolved:c}=this;if(!c)return;const{animation:d}=c;d.currentTime=secondsToMilliseconds(o)}get speed(){const{resolved:o}=this;if(!o)return 1;const{animation:c}=o;return c.playbackRate}set speed(o){const{resolved:c}=this;if(!c)return;const{animation:d}=c;d.playbackRate=o}get state(){const{resolved:o}=this;if(!o)return"idle";const{animation:c}=o;return c.playState}attachTimeline(o){if(!this._resolved)this.pendingTimeline=o;else{const{resolved:c}=this;if(!c)return noop;const{animation:d}=c;d.timeline=o,d.onfinish=null}return noop}play(){if(this.isStopped)return;const{resolved:o}=this;if(!o)return;const{animation:c}=o;c.playState==="finished"&&this.updateFinishedPromise(),c.play()}pause(){const{resolved:o}=this;if(!o)return;const{animation:c}=o;c.pause()}stop(){if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;const{resolved:o}=this;if(!o)return;const{animation:c,keyframes:d,duration:_,type:b,ease:_e,times:it}=o;if(!(c.playState==="idle"||c.playState==="finished")){if(this.time){const{motionValue:nt,onUpdate:at,onComplete:ut,...pt}=this.options,mt=new MainThreadAnimation({...pt,keyframes:d,duration:_,type:b,ease:_e,times:it,isGenerator:!0}),ft=secondsToMilliseconds(this.time);nt.setWithVelocity(mt.sample(ft-sampleDelta).value,mt.sample(ft).value,sampleDelta)}this.cancel()}}complete(){const{resolved:o}=this;o&&o.animation.finish()}cancel(){const{resolved:o}=this;o&&o.animation.cancel()}static supports(o){const{motionValue:c,name:d,repeatDelay:_,repeatType:b,damping:_e,type:it}=o;return supportsWaapi()&&d&&acceleratedValues.has(d)&&c&&c.owner&&c.owner.current instanceof HTMLElement&&!c.owner.getProps().onUpdate&&!_&&b!=="mirror"&&_e!==0&&it!=="inertia"}}const animateMotionValue=(h,o,c,d={},_,b)=>_e=>{const it=getValueTransition(d,h)||{},nt=it.delay||d.delay||0;let{elapsed:at=0}=d;at=at-secondsToMilliseconds(nt);let ut={keyframes:Array.isArray(c)?c:[null,c],ease:"easeOut",velocity:o.getVelocity(),...it,delay:-at,onUpdate:mt=>{o.set(mt),it.onUpdate&&it.onUpdate(mt)},onComplete:()=>{_e(),it.onComplete&&it.onComplete()},name:h,motionValue:o,element:b?void 0:_};isTransitionDefined(it)||(ut={...ut,...getDefaultTransition(h,ut)}),ut.duration&&(ut.duration=secondsToMilliseconds(ut.duration)),ut.repeatDelay&&(ut.repeatDelay=secondsToMilliseconds(ut.repeatDelay)),ut.from!==void 0&&(ut.keyframes[0]=ut.from);let pt=!1;if((ut.type===!1||ut.duration===0&&!ut.repeatDelay)&&(ut.duration=0,ut.delay===0&&(pt=!0)),pt&&!b&&o.get()!==void 0){const mt=getFinalKeyframe(ut.keyframes,it);if(mt!==void 0){frame.update(()=>{ut.onUpdate(mt),ut.onComplete()});return}}return!b&&AcceleratedAnimation.supports(ut)?new AcceleratedAnimation(ut):new MainThreadAnimation(ut)};function isWillChangeMotionValue(h){return!!(isMotionValue(h)&&h.add)}function addUniqueItem(h,o){h.indexOf(o)===-1&&h.push(o)}function removeItem(h,o){const c=h.indexOf(o);c>-1&&h.splice(c,1)}class SubscriptionManager{constructor(){this.subscriptions=[]}add(o){return addUniqueItem(this.subscriptions,o),()=>removeItem(this.subscriptions,o)}notify(o,c,d){const _=this.subscriptions.length;if(_)if(_===1)this.subscriptions[0](o,c,d);else for(let b=0;b<_;b++){const _e=this.subscriptions[b];_e&&_e(o,c,d)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const MAX_VELOCITY_DELTA=30,isFloat=h=>!isNaN(parseFloat(h)),collectMotionValues={current:void 0};class MotionValue{constructor(o,c={}){this.version="11.1.9",this.canTrackVelocity=!1,this.events={},this.updateAndNotify=(d,_=!0)=>{const b=time.now();this.updatedAt!==b&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(d),this.current!==this.prev&&this.events.change&&this.events.change.notify(this.current),_&&this.events.renderRequest&&this.events.renderRequest.notify(this.current)},this.hasAnimated=!1,this.setCurrent(o),this.canTrackVelocity=isFloat(this.current),this.owner=c.owner}setCurrent(o){this.current=o,this.updatedAt=time.now()}setPrevFrameValue(o=this.current){this.prevFrameValue=o,this.prevUpdatedAt=this.updatedAt}onChange(o){return this.on("change",o)}on(o,c){this.events[o]||(this.events[o]=new SubscriptionManager);const d=this.events[o].add(c);return o==="change"?()=>{d(),frame.read(()=>{this.events.change.getSize()||this.stop()})}:d}clearListeners(){for(const o in this.events)this.events[o].clear()}attach(o,c){this.passiveEffect=o,this.stopPassiveEffect=c}set(o,c=!0){!c||!this.passiveEffect?this.updateAndNotify(o,c):this.passiveEffect(o,this.updateAndNotify)}setWithVelocity(o,c,d){this.set(c),this.prev=void 0,this.prevFrameValue=o,this.prevUpdatedAt=this.updatedAt-d}jump(o,c=!0){this.updateAndNotify(o),this.prev=o,this.prevUpdatedAt=this.prevFrameValue=void 0,c&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}get(){return collectMotionValues.current&&collectMotionValues.current.push(this),this.current}getPrevious(){return this.prev}getVelocity(){const o=time.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||o-this.updatedAt>MAX_VELOCITY_DELTA)return 0;const c=Math.min(this.updatedAt-this.prevUpdatedAt,MAX_VELOCITY_DELTA);return velocityPerSecond(parseFloat(this.current)-parseFloat(this.prevFrameValue),c)}start(o){return this.stop(),new Promise(c=>{this.hasAnimated=!0,this.animation=o(c),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function motionValue(h,o){return new MotionValue(h,o)}function setMotionValue(h,o,c){h.hasValue(o)?h.getValue(o).set(c):h.addValue(o,motionValue(c))}function setTarget(h,o){const c=resolveVariant(h,o);let{transitionEnd:d={},transition:_={},...b}=c||{};b={...b,...d};for(const _e in b){const it=resolveFinalValueInKeyframes(b[_e]);setMotionValue(h,_e,it)}}function shouldBlockAnimation({protectedKeys:h,needsAnimating:o},c){const d=h.hasOwnProperty(c)&&o[c]!==!0;return o[c]=!1,d}function animateTarget(h,o,{delay:c=0,transitionOverride:d,type:_}={}){var b;let{transition:_e=h.getDefaultTransition(),transitionEnd:it,...nt}=o;const at=h.getValue("willChange");d&&(_e=d);const ut=[],pt=_&&h.animationState&&h.animationState.getState()[_];for(const mt in nt){const ft=h.getValue(mt,(b=h.latestValues[mt])!==null&&b!==void 0?b:null),vt=nt[mt];if(vt===void 0||pt&&shouldBlockAnimation(pt,mt))continue;const xt={delay:c,elapsed:0,...getValueTransition(_e||{},mt)};let At=!1;if(window.HandoffAppearAnimations){const Et=h.getProps()[optimizedAppearDataAttribute];if(Et){const Tt=window.HandoffAppearAnimations(Et,mt);Tt!==null&&(xt.elapsed=Tt,At=!0)}}ft.start(animateMotionValue(mt,ft,vt,h.shouldReduceMotion&&transformProps.has(mt)?{type:!1}:xt,h,At));const Ct=ft.animation;Ct&&(isWillChangeMotionValue(at)&&(at.add(mt),Ct.then(()=>at.remove(mt))),ut.push(Ct))}return it&&Promise.all(ut).then(()=>{frame.update(()=>{it&&setTarget(h,it)})}),ut}function animateVariant(h,o,c={}){var d;const _=resolveVariant(h,o,c.type==="exit"?(d=h.presenceContext)===null||d===void 0?void 0:d.custom:void 0);let{transition:b=h.getDefaultTransition()||{}}=_||{};c.transitionOverride&&(b=c.transitionOverride);const _e=_?()=>Promise.all(animateTarget(h,_,c)):()=>Promise.resolve(),it=h.variantChildren&&h.variantChildren.size?(at=0)=>{const{delayChildren:ut=0,staggerChildren:pt,staggerDirection:mt}=b;return animateChildren(h,o,ut+at,pt,mt,c)}:()=>Promise.resolve(),{when:nt}=b;if(nt){const[at,ut]=nt==="beforeChildren"?[_e,it]:[it,_e];return at().then(()=>ut())}else return Promise.all([_e(),it(c.delay)])}function animateChildren(h,o,c=0,d=0,_=1,b){const _e=[],it=(h.variantChildren.size-1)*d,nt=_===1?(at=0)=>at*d:(at=0)=>it-at*d;return Array.from(h.variantChildren).sort(sortByTreeOrder).forEach((at,ut)=>{at.notify("AnimationStart",o),_e.push(animateVariant(at,o,{...b,delay:c+nt(ut)}).then(()=>at.notify("AnimationComplete",o)))}),Promise.all(_e)}function sortByTreeOrder(h,o){return h.sortNodePosition(o)}function animateVisualElement(h,o,c={}){h.notify("AnimationStart",o);let d;if(Array.isArray(o)){const _=o.map(b=>animateVariant(h,b,c));d=Promise.all(_)}else if(typeof o=="string")d=animateVariant(h,o,c);else{const _=typeof o=="function"?resolveVariant(h,o,c.custom):o;d=Promise.all(animateTarget(h,_,c))}return d.then(()=>{frame.postRender(()=>{h.notify("AnimationComplete",o)})})}const reversePriorityOrder=[...variantPriorityOrder].reverse(),numAnimationTypes=variantPriorityOrder.length;function animateList(h){return o=>Promise.all(o.map(({animation:c,options:d})=>animateVisualElement(h,c,d)))}function createAnimationState(h){let o=animateList(h);const c=createState();let d=!0;const _=nt=>(at,ut)=>{var pt;const mt=resolveVariant(h,ut,nt==="exit"?(pt=h.presenceContext)===null||pt===void 0?void 0:pt.custom:void 0);if(mt){const{transition:ft,transitionEnd:vt,...xt}=mt;at={...at,...xt,...vt}}return at};function b(nt){o=nt(h)}function _e(nt){const at=h.getProps(),ut=h.getVariantContext(!0)||{},pt=[],mt=new Set;let ft={},vt=1/0;for(let At=0;At<numAnimationTypes;At++){const Ct=reversePriorityOrder[At],Et=c[Ct],Tt=at[Ct]!==void 0?at[Ct]:ut[Ct],kt=isVariantLabel(Tt),Dt=Ct===nt?Et.isActive:null;Dt===!1&&(vt=At);let zt=Tt===ut[Ct]&&Tt!==at[Ct]&&kt;if(zt&&d&&h.manuallyAnimateOnMount&&(zt=!1),Et.protectedKeys={...ft},!Et.isActive&&Dt===null||!Tt&&!Et.prevProp||isAnimationControls(Tt)||typeof Tt=="boolean")continue;let Bt=checkVariantsDidChange(Et.prevProp,Tt)||Ct===nt&&Et.isActive&&!zt&&kt||At>vt&&kt,Rt=!1;const Ut=Array.isArray(Tt)?Tt:[Tt];let Ht=Ut.reduce(_(Ct),{});Dt===!1&&(Ht={});const{prevResolvedValues:Jt={}}=Et,Kt={...Jt,...Ht},sr=ir=>{Bt=!0,mt.has(ir)&&(Rt=!0,mt.delete(ir)),Et.needsAnimating[ir]=!0;const cr=h.getValue(ir);cr&&(cr.liveStyle=!1)};for(const ir in Kt){const cr=Ht[ir],lr=Jt[ir];if(ft.hasOwnProperty(ir))continue;let hr=!1;isKeyframesTarget(cr)&&isKeyframesTarget(lr)?hr=!shallowCompare(cr,lr):hr=cr!==lr,hr?cr!=null?sr(ir):mt.add(ir):cr!==void 0&&mt.has(ir)?sr(ir):Et.protectedKeys[ir]=!0}Et.prevProp=Tt,Et.prevResolvedValues=Ht,Et.isActive&&(ft={...ft,...Ht}),d&&h.blockInitialAnimation&&(Bt=!1),Bt&&(!zt||Rt)&&pt.push(...Ut.map(ir=>({animation:ir,options:{type:Ct}})))}if(mt.size){const At={};mt.forEach(Ct=>{const Et=h.getBaseTarget(Ct),Tt=h.getValue(Ct);Tt&&(Tt.liveStyle=!0),At[Ct]=Et??null}),pt.push({animation:At})}let xt=!!pt.length;return d&&(at.initial===!1||at.initial===at.animate)&&!h.manuallyAnimateOnMount&&(xt=!1),d=!1,xt?o(pt):Promise.resolve()}function it(nt,at){var ut;if(c[nt].isActive===at)return Promise.resolve();(ut=h.variantChildren)===null||ut===void 0||ut.forEach(mt=>{var ft;return(ft=mt.animationState)===null||ft===void 0?void 0:ft.setActive(nt,at)}),c[nt].isActive=at;const pt=_e(nt);for(const mt in c)c[mt].protectedKeys={};return pt}return{animateChanges:_e,setActive:it,setAnimateFunction:b,getState:()=>c}}function checkVariantsDidChange(h,o){return typeof o=="string"?o!==h:Array.isArray(o)?!shallowCompare(o,h):!1}function createTypeState(h=!1){return{isActive:h,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function createState(){return{animate:createTypeState(!0),whileInView:createTypeState(),whileHover:createTypeState(),whileTap:createTypeState(),whileDrag:createTypeState(),whileFocus:createTypeState(),exit:createTypeState()}}class AnimationFeature extends Feature{constructor(o){super(o),o.animationState||(o.animationState=createAnimationState(o))}updateAnimationControlsSubscription(){const{animate:o}=this.node.getProps();this.unmount(),isAnimationControls(o)&&(this.unmount=o.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:o}=this.node.getProps(),{animate:c}=this.node.prevProps||{};o!==c&&this.updateAnimationControlsSubscription()}unmount(){}}let id$1=0;class ExitAnimationFeature extends Feature{constructor(){super(...arguments),this.id=id$1++}update(){if(!this.node.presenceContext)return;const{isPresent:o,onExitComplete:c}=this.node.presenceContext,{isPresent:d}=this.node.prevPresenceContext||{};if(!this.node.animationState||o===d)return;const _=this.node.animationState.setActive("exit",!o);c&&!o&&_.then(()=>c(this.id))}mount(){const{register:o}=this.node.presenceContext||{};o&&(this.unmount=o(this.id))}unmount(){}}const animations={animation:{Feature:AnimationFeature},exit:{Feature:ExitAnimationFeature}},distance=(h,o)=>Math.abs(h-o);function distance2D(h,o){const c=distance(h.x,o.x),d=distance(h.y,o.y);return Math.sqrt(c**2+d**2)}class PanSession{constructor(o,c,{transformPagePoint:d,contextWindow:_,dragSnapToOrigin:b=!1}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const pt=getPanInfo(this.lastMoveEventInfo,this.history),mt=this.startEvent!==null,ft=distance2D(pt.offset,{x:0,y:0})>=3;if(!mt&&!ft)return;const{point:vt}=pt,{timestamp:xt}=frameData;this.history.push({...vt,timestamp:xt});const{onStart:At,onMove:Ct}=this.handlers;mt||(At&&At(this.lastMoveEvent,pt),this.startEvent=this.lastMoveEvent),Ct&&Ct(this.lastMoveEvent,pt)},this.handlePointerMove=(pt,mt)=>{this.lastMoveEvent=pt,this.lastMoveEventInfo=transformPoint(mt,this.transformPagePoint),frame.update(this.updatePoint,!0)},this.handlePointerUp=(pt,mt)=>{this.end();const{onEnd:ft,onSessionEnd:vt,resumeAnimation:xt}=this.handlers;if(this.dragSnapToOrigin&&xt&&xt(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const At=getPanInfo(pt.type==="pointercancel"?this.lastMoveEventInfo:transformPoint(mt,this.transformPagePoint),this.history);this.startEvent&&ft&&ft(pt,At),vt&&vt(pt,At)},!isPrimaryPointer(o))return;this.dragSnapToOrigin=b,this.handlers=c,this.transformPagePoint=d,this.contextWindow=_||window;const _e=extractEventInfo(o),it=transformPoint(_e,this.transformPagePoint),{point:nt}=it,{timestamp:at}=frameData;this.history=[{...nt,timestamp:at}];const{onSessionStart:ut}=c;ut&&ut(o,getPanInfo(it,this.history)),this.removeListeners=pipe(addPointerEvent(this.contextWindow,"pointermove",this.handlePointerMove),addPointerEvent(this.contextWindow,"pointerup",this.handlePointerUp),addPointerEvent(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(o){this.handlers=o}end(){this.removeListeners&&this.removeListeners(),cancelFrame(this.updatePoint)}}function transformPoint(h,o){return o?{point:o(h.point)}:h}function subtractPoint(h,o){return{x:h.x-o.x,y:h.y-o.y}}function getPanInfo({point:h},o){return{point:h,delta:subtractPoint(h,lastDevicePoint(o)),offset:subtractPoint(h,startDevicePoint(o)),velocity:getVelocity(o,.1)}}function startDevicePoint(h){return h[0]}function lastDevicePoint(h){return h[h.length-1]}function getVelocity(h,o){if(h.length<2)return{x:0,y:0};let c=h.length-1,d=null;const _=lastDevicePoint(h);for(;c>=0&&(d=h[c],!(_.timestamp-d.timestamp>secondsToMilliseconds(o)));)c--;if(!d)return{x:0,y:0};const b=millisecondsToSeconds(_.timestamp-d.timestamp);if(b===0)return{x:0,y:0};const _e={x:(_.x-d.x)/b,y:(_.y-d.y)/b};return _e.x===1/0&&(_e.x=0),_e.y===1/0&&(_e.y=0),_e}function calcLength(h){return h.max-h.min}function isNear(h,o=0,c=.01){return Math.abs(h-o)<=c}function calcAxisDelta(h,o,c,d=.5){h.origin=d,h.originPoint=mixNumber$1(o.min,o.max,h.origin),h.scale=calcLength(c)/calcLength(o),(isNear(h.scale,1,1e-4)||isNaN(h.scale))&&(h.scale=1),h.translate=mixNumber$1(c.min,c.max,h.origin)-h.originPoint,(isNear(h.translate)||isNaN(h.translate))&&(h.translate=0)}function calcBoxDelta(h,o,c,d){calcAxisDelta(h.x,o.x,c.x,d?d.originX:void 0),calcAxisDelta(h.y,o.y,c.y,d?d.originY:void 0)}function calcRelativeAxis(h,o,c){h.min=c.min+o.min,h.max=h.min+calcLength(o)}function calcRelativeBox(h,o,c){calcRelativeAxis(h.x,o.x,c.x),calcRelativeAxis(h.y,o.y,c.y)}function calcRelativeAxisPosition(h,o,c){h.min=o.min-c.min,h.max=h.min+calcLength(o)}function calcRelativePosition(h,o,c){calcRelativeAxisPosition(h.x,o.x,c.x),calcRelativeAxisPosition(h.y,o.y,c.y)}function applyConstraints(h,{min:o,max:c},d){return o!==void 0&&h<o?h=d?mixNumber$1(o,h,d.min):Math.max(h,o):c!==void 0&&h>c&&(h=d?mixNumber$1(c,h,d.max):Math.min(h,c)),h}function calcRelativeAxisConstraints(h,o,c){return{min:o!==void 0?h.min+o:void 0,max:c!==void 0?h.max+c-(h.max-h.min):void 0}}function calcRelativeConstraints(h,{top:o,left:c,bottom:d,right:_}){return{x:calcRelativeAxisConstraints(h.x,c,_),y:calcRelativeAxisConstraints(h.y,o,d)}}function calcViewportAxisConstraints(h,o){let c=o.min-h.min,d=o.max-h.max;return o.max-o.min<h.max-h.min&&([c,d]=[d,c]),{min:c,max:d}}function calcViewportConstraints(h,o){return{x:calcViewportAxisConstraints(h.x,o.x),y:calcViewportAxisConstraints(h.y,o.y)}}function calcOrigin(h,o){let c=.5;const d=calcLength(h),_=calcLength(o);return _>d?c=progress(o.min,o.max-d,h.min):d>_&&(c=progress(h.min,h.max-_,o.min)),clamp(0,1,c)}function rebaseAxisConstraints(h,o){const c={};return o.min!==void 0&&(c.min=o.min-h.min),o.max!==void 0&&(c.max=o.max-h.min),c}const defaultElastic=.35;function resolveDragElastic(h=defaultElastic){return h===!1?h=0:h===!0&&(h=defaultElastic),{x:resolveAxisElastic(h,"left","right"),y:resolveAxisElastic(h,"top","bottom")}}function resolveAxisElastic(h,o,c){return{min:resolvePointElastic(h,o),max:resolvePointElastic(h,c)}}function resolvePointElastic(h,o){return typeof h=="number"?h:h[o]||0}const createAxisDelta=()=>({translate:0,scale:1,origin:0,originPoint:0}),createDelta=()=>({x:createAxisDelta(),y:createAxisDelta()}),createAxis=()=>({min:0,max:0}),createBox=()=>({x:createAxis(),y:createAxis()});function eachAxis(h){return[h("x"),h("y")]}function convertBoundingBoxToBox({top:h,left:o,right:c,bottom:d}){return{x:{min:o,max:c},y:{min:h,max:d}}}function convertBoxToBoundingBox({x:h,y:o}){return{top:o.min,right:h.max,bottom:o.max,left:h.min}}function transformBoxPoints(h,o){if(!o)return h;const c=o({x:h.left,y:h.top}),d=o({x:h.right,y:h.bottom});return{top:c.y,left:c.x,bottom:d.y,right:d.x}}function isIdentityScale(h){return h===void 0||h===1}function hasScale({scale:h,scaleX:o,scaleY:c}){return!isIdentityScale(h)||!isIdentityScale(o)||!isIdentityScale(c)}function hasTransform(h){return hasScale(h)||has2DTranslate(h)||h.z||h.rotate||h.rotateX||h.rotateY||h.skewX||h.skewY}function has2DTranslate(h){return is2DTranslate(h.x)||is2DTranslate(h.y)}function is2DTranslate(h){return h&&h!=="0%"}function scalePoint(h,o,c){const d=h-c,_=o*d;return c+_}function applyPointDelta(h,o,c,d,_){return _!==void 0&&(h=scalePoint(h,_,d)),scalePoint(h,c,d)+o}function applyAxisDelta(h,o=0,c=1,d,_){h.min=applyPointDelta(h.min,o,c,d,_),h.max=applyPointDelta(h.max,o,c,d,_)}function applyBoxDelta(h,{x:o,y:c}){applyAxisDelta(h.x,o.translate,o.scale,o.originPoint),applyAxisDelta(h.y,c.translate,c.scale,c.originPoint)}function applyTreeDeltas(h,o,c,d=!1){const _=c.length;if(!_)return;o.x=o.y=1;let b,_e;for(let it=0;it<_;it++){b=c[it],_e=b.projectionDelta;const nt=b.instance;nt&&nt.style&&nt.style.display==="contents"||(d&&b.options.layoutScroll&&b.scroll&&b!==b.root&&transformBox(h,{x:-b.scroll.offset.x,y:-b.scroll.offset.y}),_e&&(o.x*=_e.x.scale,o.y*=_e.y.scale,applyBoxDelta(h,_e)),d&&hasTransform(b.latestValues)&&transformBox(h,b.latestValues))}o.x=snapToDefault(o.x),o.y=snapToDefault(o.y)}function snapToDefault(h){return Number.isInteger(h)||h>1.0000000000001||h<.999999999999?h:1}function translateAxis(h,o){h.min=h.min+o,h.max=h.max+o}function transformAxis(h,o,[c,d,_]){const b=o[_]!==void 0?o[_]:.5,_e=mixNumber$1(h.min,h.max,b);applyAxisDelta(h,o[c],o[d],_e,o.scale)}const xKeys$1=["x","scaleX","originX"],yKeys$1=["y","scaleY","originY"];function transformBox(h,o){transformAxis(h.x,o,xKeys$1),transformAxis(h.y,o,yKeys$1)}function measureViewportBox(h,o){return convertBoundingBoxToBox(transformBoxPoints(h.getBoundingClientRect(),o))}function measurePageBox(h,o,c){const d=measureViewportBox(h,c),{scroll:_}=o;return _&&(translateAxis(d.x,_.offset.x),translateAxis(d.y,_.offset.y)),d}const getContextWindow=({current:h})=>h?h.ownerDocument.defaultView:null,elementDragControls=new WeakMap;class VisualElementDragControls{constructor(o){this.openGlobalLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=createBox(),this.visualElement=o}start(o,{snapToCursor:c=!1}={}){const{presenceContext:d}=this.visualElement;if(d&&d.isPresent===!1)return;const _=ut=>{const{dragSnapToOrigin:pt}=this.getProps();pt?this.pauseAnimation():this.stopAnimation(),c&&this.snapToCursor(extractEventInfo(ut,"page").point)},b=(ut,pt)=>{const{drag:mt,dragPropagation:ft,onDragStart:vt}=this.getProps();if(mt&&!ft&&(this.openGlobalLock&&this.openGlobalLock(),this.openGlobalLock=getGlobalLock(mt),!this.openGlobalLock))return;this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),eachAxis(At=>{let Ct=this.getAxisMotionValue(At).get()||0;if(percent.test(Ct)){const{projection:Et}=this.visualElement;if(Et&&Et.layout){const Tt=Et.layout.layoutBox[At];Tt&&(Ct=calcLength(Tt)*(parseFloat(Ct)/100))}}this.originPoint[At]=Ct}),vt&&frame.postRender(()=>vt(ut,pt));const{animationState:xt}=this.visualElement;xt&&xt.setActive("whileDrag",!0)},_e=(ut,pt)=>{const{dragPropagation:mt,dragDirectionLock:ft,onDirectionLock:vt,onDrag:xt}=this.getProps();if(!mt&&!this.openGlobalLock)return;const{offset:At}=pt;if(ft&&this.currentDirection===null){this.currentDirection=getCurrentDirection(At),this.currentDirection!==null&&vt&&vt(this.currentDirection);return}this.updateAxis("x",pt.point,At),this.updateAxis("y",pt.point,At),this.visualElement.render(),xt&&xt(ut,pt)},it=(ut,pt)=>this.stop(ut,pt),nt=()=>eachAxis(ut=>{var pt;return this.getAnimationState(ut)==="paused"&&((pt=this.getAxisMotionValue(ut).animation)===null||pt===void 0?void 0:pt.play())}),{dragSnapToOrigin:at}=this.getProps();this.panSession=new PanSession(o,{onSessionStart:_,onStart:b,onMove:_e,onSessionEnd:it,resumeAnimation:nt},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:at,contextWindow:getContextWindow(this.visualElement)})}stop(o,c){const d=this.isDragging;if(this.cancel(),!d)return;const{velocity:_}=c;this.startAnimation(_);const{onDragEnd:b}=this.getProps();b&&frame.postRender(()=>b(o,c))}cancel(){this.isDragging=!1;const{projection:o,animationState:c}=this.visualElement;o&&(o.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:d}=this.getProps();!d&&this.openGlobalLock&&(this.openGlobalLock(),this.openGlobalLock=null),c&&c.setActive("whileDrag",!1)}updateAxis(o,c,d){const{drag:_}=this.getProps();if(!d||!shouldDrag(o,_,this.currentDirection))return;const b=this.getAxisMotionValue(o);let _e=this.originPoint[o]+d[o];this.constraints&&this.constraints[o]&&(_e=applyConstraints(_e,this.constraints[o],this.elastic[o])),b.set(_e)}resolveConstraints(){var o;const{dragConstraints:c,dragElastic:d}=this.getProps(),_=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):(o=this.visualElement.projection)===null||o===void 0?void 0:o.layout,b=this.constraints;c&&isRefObject(c)?this.constraints||(this.constraints=this.resolveRefConstraints()):c&&_?this.constraints=calcRelativeConstraints(_.layoutBox,c):this.constraints=!1,this.elastic=resolveDragElastic(d),b!==this.constraints&&_&&this.constraints&&!this.hasMutatedConstraints&&eachAxis(_e=>{this.constraints!==!1&&this.getAxisMotionValue(_e)&&(this.constraints[_e]=rebaseAxisConstraints(_.layoutBox[_e],this.constraints[_e]))})}resolveRefConstraints(){const{dragConstraints:o,onMeasureDragConstraints:c}=this.getProps();if(!o||!isRefObject(o))return!1;const d=o.current,{projection:_}=this.visualElement;if(!_||!_.layout)return!1;const b=measurePageBox(d,_.root,this.visualElement.getTransformPagePoint());let _e=calcViewportConstraints(_.layout.layoutBox,b);if(c){const it=c(convertBoxToBoundingBox(_e));this.hasMutatedConstraints=!!it,it&&(_e=convertBoundingBoxToBox(it))}return _e}startAnimation(o){const{drag:c,dragMomentum:d,dragElastic:_,dragTransition:b,dragSnapToOrigin:_e,onDragTransitionEnd:it}=this.getProps(),nt=this.constraints||{},at=eachAxis(ut=>{if(!shouldDrag(ut,c,this.currentDirection))return;let pt=nt&&nt[ut]||{};_e&&(pt={min:0,max:0});const mt=_?200:1e6,ft=_?40:1e7,vt={type:"inertia",velocity:d?o[ut]:0,bounceStiffness:mt,bounceDamping:ft,timeConstant:750,restDelta:1,restSpeed:10,...b,...pt};return this.startAxisValueAnimation(ut,vt)});return Promise.all(at).then(it)}startAxisValueAnimation(o,c){const d=this.getAxisMotionValue(o);return d.start(animateMotionValue(o,d,0,c,this.visualElement))}stopAnimation(){eachAxis(o=>this.getAxisMotionValue(o).stop())}pauseAnimation(){eachAxis(o=>{var c;return(c=this.getAxisMotionValue(o).animation)===null||c===void 0?void 0:c.pause()})}getAnimationState(o){var c;return(c=this.getAxisMotionValue(o).animation)===null||c===void 0?void 0:c.state}getAxisMotionValue(o){const c=`_drag${o.toUpperCase()}`,d=this.visualElement.getProps();return d[c]||this.visualElement.getValue(o,(d.initial?d.initial[o]:void 0)||0)}snapToCursor(o){eachAxis(c=>{const{drag:d}=this.getProps();if(!shouldDrag(c,d,this.currentDirection))return;const{projection:_}=this.visualElement,b=this.getAxisMotionValue(c);if(_&&_.layout){const{min:_e,max:it}=_.layout.layoutBox[c];b.set(o[c]-mixNumber$1(_e,it,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:o,dragConstraints:c}=this.getProps(),{projection:d}=this.visualElement;if(!isRefObject(c)||!d||!this.constraints)return;this.stopAnimation();const _={x:0,y:0};eachAxis(_e=>{const it=this.getAxisMotionValue(_e);if(it&&this.constraints!==!1){const nt=it.get();_[_e]=calcOrigin({min:nt,max:nt},this.constraints[_e])}});const{transformTemplate:b}=this.visualElement.getProps();this.visualElement.current.style.transform=b?b({},""):"none",d.root&&d.root.updateScroll(),d.updateLayout(),this.resolveConstraints(),eachAxis(_e=>{if(!shouldDrag(_e,o,null))return;const it=this.getAxisMotionValue(_e),{min:nt,max:at}=this.constraints[_e];it.set(mixNumber$1(nt,at,_[_e]))})}addListeners(){if(!this.visualElement.current)return;elementDragControls.set(this.visualElement,this);const o=this.visualElement.current,c=addPointerEvent(o,"pointerdown",nt=>{const{drag:at,dragListener:ut=!0}=this.getProps();at&&ut&&this.start(nt)}),d=()=>{const{dragConstraints:nt}=this.getProps();isRefObject(nt)&&(this.constraints=this.resolveRefConstraints())},{projection:_}=this.visualElement,b=_.addEventListener("measure",d);_&&!_.layout&&(_.root&&_.root.updateScroll(),_.updateLayout()),d();const _e=addDomEvent(window,"resize",()=>this.scalePositionWithinConstraints()),it=_.addEventListener("didUpdate",({delta:nt,hasLayoutChanged:at})=>{this.isDragging&&at&&(eachAxis(ut=>{const pt=this.getAxisMotionValue(ut);pt&&(this.originPoint[ut]+=nt[ut].translate,pt.set(pt.get()+nt[ut].translate))}),this.visualElement.render())});return()=>{_e(),c(),b(),it&&it()}}getProps(){const o=this.visualElement.getProps(),{drag:c=!1,dragDirectionLock:d=!1,dragPropagation:_=!1,dragConstraints:b=!1,dragElastic:_e=defaultElastic,dragMomentum:it=!0}=o;return{...o,drag:c,dragDirectionLock:d,dragPropagation:_,dragConstraints:b,dragElastic:_e,dragMomentum:it}}}function shouldDrag(h,o,c){return(o===!0||o===h)&&(c===null||c===h)}function getCurrentDirection(h,o=10){let c=null;return Math.abs(h.y)>o?c="y":Math.abs(h.x)>o&&(c="x"),c}class DragGesture extends Feature{constructor(o){super(o),this.removeGroupControls=noop,this.removeListeners=noop,this.controls=new VisualElementDragControls(o)}mount(){const{dragControls:o}=this.node.getProps();o&&(this.removeGroupControls=o.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||noop}unmount(){this.removeGroupControls(),this.removeListeners()}}const asyncHandler=h=>(o,c)=>{h&&frame.postRender(()=>h(o,c))};class PanGesture extends Feature{constructor(){super(...arguments),this.removePointerDownListener=noop}onPointerDown(o){this.session=new PanSession(o,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:getContextWindow(this.node)})}createPanHandlers(){const{onPanSessionStart:o,onPanStart:c,onPan:d,onPanEnd:_}=this.node.getProps();return{onSessionStart:asyncHandler(o),onStart:asyncHandler(c),onMove:d,onEnd:(b,_e)=>{delete this.session,_&&frame.postRender(()=>_(b,_e))}}}mount(){this.removePointerDownListener=addPointerEvent(this.node.current,"pointerdown",o=>this.onPointerDown(o))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}function usePresence(){const h=reactExports.useContext(PresenceContext);if(h===null)return[!0,null];const{isPresent:o,onExitComplete:c,register:d}=h,_=reactExports.useId();return reactExports.useEffect(()=>d(_),[]),!o&&c?[!1,()=>c&&c(_)]:[!0]}const globalProjectionState={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function pixelsToPercent(h,o){return o.max===o.min?0:h/(o.max-o.min)*100}const correctBorderRadius={correct:(h,o)=>{if(!o.target)return h;if(typeof h=="string")if(px.test(h))h=parseFloat(h);else return h;const c=pixelsToPercent(h,o.target.x),d=pixelsToPercent(h,o.target.y);return`${c}% ${d}%`}},correctBoxShadow={correct:(h,{treeScale:o,projectionDelta:c})=>{const d=h,_=complex.parse(h);if(_.length>5)return d;const b=complex.createTransformer(h),_e=typeof _[0]!="number"?1:0,it=c.x.scale*o.x,nt=c.y.scale*o.y;_[0+_e]/=it,_[1+_e]/=nt;const at=mixNumber$1(it,nt,.5);return typeof _[2+_e]=="number"&&(_[2+_e]/=at),typeof _[3+_e]=="number"&&(_[3+_e]/=at),b(_)}};class MeasureLayoutWithContext extends reactExports.Component{componentDidMount(){const{visualElement:o,layoutGroup:c,switchLayoutGroup:d,layoutId:_}=this.props,{projection:b}=o;addScaleCorrector(defaultScaleCorrectors),b&&(c.group&&c.group.add(b),d&&d.register&&_&&d.register(b),b.root.didUpdate(),b.addEventListener("animationComplete",()=>{this.safeToRemove()}),b.setOptions({...b.options,onExitComplete:()=>this.safeToRemove()})),globalProjectionState.hasEverUpdated=!0}getSnapshotBeforeUpdate(o){const{layoutDependency:c,visualElement:d,drag:_,isPresent:b}=this.props,_e=d.projection;return _e&&(_e.isPresent=b,_||o.layoutDependency!==c||c===void 0?_e.willUpdate():this.safeToRemove(),o.isPresent!==b&&(b?_e.promote():_e.relegate()||frame.postRender(()=>{const it=_e.getStack();(!it||!it.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:o}=this.props.visualElement;o&&(o.root.didUpdate(),microtask.postRender(()=>{!o.currentAnimation&&o.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:o,layoutGroup:c,switchLayoutGroup:d}=this.props,{projection:_}=o;_&&(_.scheduleCheckAfterUnmount(),c&&c.group&&c.group.remove(_),d&&d.deregister&&d.deregister(_))}safeToRemove(){const{safeToRemove:o}=this.props;o&&o()}render(){return null}}function MeasureLayout(h){const[o,c]=usePresence(),d=reactExports.useContext(LayoutGroupContext);return jsxRuntimeExports.jsx(MeasureLayoutWithContext,{...h,layoutGroup:d,switchLayoutGroup:reactExports.useContext(SwitchLayoutGroupContext),isPresent:o,safeToRemove:c})}const defaultScaleCorrectors={borderRadius:{...correctBorderRadius,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:correctBorderRadius,borderTopRightRadius:correctBorderRadius,borderBottomLeftRadius:correctBorderRadius,borderBottomRightRadius:correctBorderRadius,boxShadow:correctBoxShadow},borders=["TopLeft","TopRight","BottomLeft","BottomRight"],numBorders=borders.length,asNumber=h=>typeof h=="string"?parseFloat(h):h,isPx=h=>typeof h=="number"||px.test(h);function mixValues(h,o,c,d,_,b){_?(h.opacity=mixNumber$1(0,c.opacity!==void 0?c.opacity:1,easeCrossfadeIn(d)),h.opacityExit=mixNumber$1(o.opacity!==void 0?o.opacity:1,0,easeCrossfadeOut(d))):b&&(h.opacity=mixNumber$1(o.opacity!==void 0?o.opacity:1,c.opacity!==void 0?c.opacity:1,d));for(let _e=0;_e<numBorders;_e++){const it=`border${borders[_e]}Radius`;let nt=getRadius(o,it),at=getRadius(c,it);nt===void 0&&at===void 0||(nt||(nt=0),at||(at=0),nt===0||at===0||isPx(nt)===isPx(at)?(h[it]=Math.max(mixNumber$1(asNumber(nt),asNumber(at),d),0),(percent.test(at)||percent.test(nt))&&(h[it]+="%")):h[it]=at)}(o.rotate||c.rotate)&&(h.rotate=mixNumber$1(o.rotate||0,c.rotate||0,d))}function getRadius(h,o){return h[o]!==void 0?h[o]:h.borderRadius}const easeCrossfadeIn=compress(0,.5,circOut),easeCrossfadeOut=compress(.5,.95,noop);function compress(h,o,c){return d=>d<h?0:d>o?1:c(progress(h,o,d))}function copyAxisInto(h,o){h.min=o.min,h.max=o.max}function copyBoxInto(h,o){copyAxisInto(h.x,o.x),copyAxisInto(h.y,o.y)}function removePointDelta(h,o,c,d,_){return h-=o,h=scalePoint(h,1/c,d),_!==void 0&&(h=scalePoint(h,1/_,d)),h}function removeAxisDelta(h,o=0,c=1,d=.5,_,b=h,_e=h){if(percent.test(o)&&(o=parseFloat(o),o=mixNumber$1(_e.min,_e.max,o/100)-_e.min),typeof o!="number")return;let it=mixNumber$1(b.min,b.max,d);h===b&&(it-=o),h.min=removePointDelta(h.min,o,c,it,_),h.max=removePointDelta(h.max,o,c,it,_)}function removeAxisTransforms(h,o,[c,d,_],b,_e){removeAxisDelta(h,o[c],o[d],o[_],o.scale,b,_e)}const xKeys=["x","scaleX","originX"],yKeys=["y","scaleY","originY"];function removeBoxTransforms(h,o,c,d){removeAxisTransforms(h.x,o,xKeys,c?c.x:void 0,d?d.x:void 0),removeAxisTransforms(h.y,o,yKeys,c?c.y:void 0,d?d.y:void 0)}function isAxisDeltaZero(h){return h.translate===0&&h.scale===1}function isDeltaZero(h){return isAxisDeltaZero(h.x)&&isAxisDeltaZero(h.y)}function boxEquals(h,o){return h.x.min===o.x.min&&h.x.max===o.x.max&&h.y.min===o.y.min&&h.y.max===o.y.max}function boxEqualsRounded(h,o){return Math.round(h.x.min)===Math.round(o.x.min)&&Math.round(h.x.max)===Math.round(o.x.max)&&Math.round(h.y.min)===Math.round(o.y.min)&&Math.round(h.y.max)===Math.round(o.y.max)}function aspectRatio(h){return calcLength(h.x)/calcLength(h.y)}class NodeStack{constructor(){this.members=[]}add(o){addUniqueItem(this.members,o),o.scheduleRender()}remove(o){if(removeItem(this.members,o),o===this.prevLead&&(this.prevLead=void 0),o===this.lead){const c=this.members[this.members.length-1];c&&this.promote(c)}}relegate(o){const c=this.members.findIndex(_=>o===_);if(c===0)return!1;let d;for(let _=c;_>=0;_--){const b=this.members[_];if(b.isPresent!==!1){d=b;break}}return d?(this.promote(d),!0):!1}promote(o,c){const d=this.lead;if(o!==d&&(this.prevLead=d,this.lead=o,o.show(),d)){d.instance&&d.scheduleRender(),o.scheduleRender(),o.resumeFrom=d,c&&(o.resumeFrom.preserveOpacity=!0),d.snapshot&&(o.snapshot=d.snapshot,o.snapshot.latestValues=d.animationValues||d.latestValues),o.root&&o.root.isUpdating&&(o.isLayoutDirty=!0);const{crossfade:_}=o.options;_===!1&&d.hide()}}exitAnimationComplete(){this.members.forEach(o=>{const{options:c,resumingFrom:d}=o;c.onExitComplete&&c.onExitComplete(),d&&d.options.onExitComplete&&d.options.onExitComplete()})}scheduleRender(){this.members.forEach(o=>{o.instance&&o.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function buildProjectionTransform(h,o,c){let d="";const _=h.x.translate/o.x,b=h.y.translate/o.y,_e=(c==null?void 0:c.z)||0;if((_||b||_e)&&(d=`translate3d(${_}px, ${b}px, ${_e}px) `),(o.x!==1||o.y!==1)&&(d+=`scale(${1/o.x}, ${1/o.y}) `),c){const{transformPerspective:at,rotate:ut,rotateX:pt,rotateY:mt,skewX:ft,skewY:vt}=c;at&&(d=`perspective(${at}px) ${d}`),ut&&(d+=`rotate(${ut}deg) `),pt&&(d+=`rotateX(${pt}deg) `),mt&&(d+=`rotateY(${mt}deg) `),ft&&(d+=`skewX(${ft}deg) `),vt&&(d+=`skewY(${vt}deg) `)}const it=h.x.scale*o.x,nt=h.y.scale*o.y;return(it!==1||nt!==1)&&(d+=`scale(${it}, ${nt})`),d||"none"}const compareByDepth=(h,o)=>h.depth-o.depth;class FlatTree{constructor(){this.children=[],this.isDirty=!1}add(o){addUniqueItem(this.children,o),this.isDirty=!0}remove(o){removeItem(this.children,o),this.isDirty=!0}forEach(o){this.isDirty&&this.children.sort(compareByDepth),this.isDirty=!1,this.children.forEach(o)}}function delay(h,o){const c=time.now(),d=({timestamp:_})=>{const b=_-c;b>=o&&(cancelFrame(d),h(b-o))};return frame.read(d,!0),()=>cancelFrame(d)}function record(h){window.MotionDebug&&window.MotionDebug.record(h)}function isSVGElement(h){return h instanceof SVGElement&&h.tagName!=="svg"}function animateSingleValue(h,o,c){const d=isMotionValue(h)?h:motionValue(h);return d.start(animateMotionValue("",d,o,c)),d.animation}const transformAxes=["","X","Y","Z"],hiddenVisibility={visibility:"hidden"},animationTarget=1e3;let id=0;const projectionFrameData={type:"projectionFrame",totalNodes:0,resolvedTargetDeltas:0,recalculatedProjection:0};function resetDistortingTransform(h,o,c,d){const{latestValues:_}=o;_[h]&&(c[h]=_[h],o.setStaticValue(h,0),d&&(d[h]=0))}function createProjectionNode({attachResizeListener:h,defaultParent:o,measureScroll:c,checkIsScrollRoot:d,resetTransform:_}){return class{constructor(b={},_e=o==null?void 0:o()){this.id=id++,this.animationId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,projectionFrameData.totalNodes=projectionFrameData.resolvedTargetDeltas=projectionFrameData.recalculatedProjection=0,this.nodes.forEach(propagateDirtyNodes),this.nodes.forEach(resolveTargetDelta),this.nodes.forEach(calcProjection),this.nodes.forEach(cleanDirtyNodes),record(projectionFrameData)},this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=b,this.root=_e?_e.root||_e:this,this.path=_e?[..._e.path,_e]:[],this.parent=_e,this.depth=_e?_e.depth+1:0;for(let it=0;it<this.path.length;it++)this.path[it].shouldResetTransform=!0;this.root===this&&(this.nodes=new FlatTree)}addEventListener(b,_e){return this.eventHandlers.has(b)||this.eventHandlers.set(b,new SubscriptionManager),this.eventHandlers.get(b).add(_e)}notifyListeners(b,..._e){const it=this.eventHandlers.get(b);it&&it.notify(..._e)}hasListeners(b){return this.eventHandlers.has(b)}mount(b,_e=this.root.hasTreeAnimated){if(this.instance)return;this.isSVG=isSVGElement(b),this.instance=b;const{layoutId:it,layout:nt,visualElement:at}=this.options;if(at&&!at.current&&at.mount(b),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),_e&&(nt||it)&&(this.isLayoutDirty=!0),h){let ut;const pt=()=>this.root.updateBlockedByResize=!1;h(b,()=>{this.root.updateBlockedByResize=!0,ut&&ut(),ut=delay(pt,250),globalProjectionState.hasAnimatedSinceResize&&(globalProjectionState.hasAnimatedSinceResize=!1,this.nodes.forEach(finishAnimation))})}it&&this.root.registerSharedNode(it,this),this.options.animate!==!1&&at&&(it||nt)&&this.addEventListener("didUpdate",({delta:ut,hasLayoutChanged:pt,hasRelativeTargetChanged:mt,layout:ft})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const vt=this.options.transition||at.getDefaultTransition()||defaultLayoutTransition,{onLayoutAnimationStart:xt,onLayoutAnimationComplete:At}=at.getProps(),Ct=!this.targetLayout||!boxEqualsRounded(this.targetLayout,ft)||mt,Et=!pt&&mt;if(this.options.layoutRoot||this.resumeFrom&&this.resumeFrom.instance||Et||pt&&(Ct||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0),this.setAnimationOrigin(ut,Et);const Tt={...getValueTransition(vt,"layout"),onPlay:xt,onComplete:At};(at.shouldReduceMotion||this.options.layoutRoot)&&(Tt.delay=0,Tt.type=!1),this.startAnimation(Tt)}else pt||finishAnimation(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=ft})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const b=this.getStack();b&&b.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,cancelFrame(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(resetSkewAndRotation),this.animationId++)}getTransformTemplate(){const{visualElement:b}=this.options;return b&&b.getProps().transformTemplate}willUpdate(b=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let at=0;at<this.path.length;at++){const ut=this.path[at];ut.shouldResetTransform=!0,ut.updateScroll("snapshot"),ut.options.layoutRoot&&ut.willUpdate(!1)}const{layoutId:_e,layout:it}=this.options;if(_e===void 0&&!it)return;const nt=this.getTransformTemplate();this.prevTransformTemplateValue=nt?nt(this.latestValues,""):void 0,this.updateSnapshot(),b&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(clearMeasurements);return}this.isUpdating||this.nodes.forEach(clearIsLayoutDirty),this.isUpdating=!1,window.HandoffCancelAllAnimations&&window.HandoffCancelAllAnimations(),this.nodes.forEach(resetTransformStyle),this.nodes.forEach(updateLayout),this.nodes.forEach(notifyLayoutUpdate),this.clearAllSnapshots();const b=time.now();frameData.delta=clamp(0,1e3/60,b-frameData.timestamp),frameData.timestamp=b,frameData.isProcessing=!0,steps.update.process(frameData),steps.preRender.process(frameData),steps.render.process(frameData),frameData.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,microtask.read(()=>this.update()))}clearAllSnapshots(){this.nodes.forEach(clearSnapshot),this.sharedNodes.forEach(removeLeadSnapshots)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,frame.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){frame.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure())}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let it=0;it<this.path.length;it++)this.path[it].updateScroll();const b=this.layout;this.layout=this.measure(!1),this.layoutCorrected=createBox(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:_e}=this.options;_e&&_e.notify("LayoutMeasure",this.layout.layoutBox,b?b.layoutBox:void 0)}updateScroll(b="measure"){let _e=!!(this.options.layoutScroll&&this.instance);this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===b&&(_e=!1),_e&&(this.scroll={animationId:this.root.animationId,phase:b,isRoot:d(this.instance),offset:c(this.instance)})}resetTransform(){if(!_)return;const b=this.isLayoutDirty||this.shouldResetTransform,_e=this.projectionDelta&&!isDeltaZero(this.projectionDelta),it=this.getTransformTemplate(),nt=it?it(this.latestValues,""):void 0,at=nt!==this.prevTransformTemplateValue;b&&(_e||hasTransform(this.latestValues)||at)&&(_(this.instance,nt),this.shouldResetTransform=!1,this.scheduleRender())}measure(b=!0){const _e=this.measurePageBox();let it=this.removeElementScroll(_e);return b&&(it=this.removeTransform(it)),roundBox(it),{animationId:this.root.animationId,measuredBox:_e,layoutBox:it,latestValues:{},source:this.id}}measurePageBox(){const{visualElement:b}=this.options;if(!b)return createBox();const _e=b.measureViewportBox(),{scroll:it}=this.root;return it&&(translateAxis(_e.x,it.offset.x),translateAxis(_e.y,it.offset.y)),_e}removeElementScroll(b){const _e=createBox();copyBoxInto(_e,b);for(let it=0;it<this.path.length;it++){const nt=this.path[it],{scroll:at,options:ut}=nt;if(nt!==this.root&&at&&ut.layoutScroll){if(at.isRoot){copyBoxInto(_e,b);const{scroll:pt}=this.root;pt&&(translateAxis(_e.x,-pt.offset.x),translateAxis(_e.y,-pt.offset.y))}translateAxis(_e.x,at.offset.x),translateAxis(_e.y,at.offset.y)}}return _e}applyTransform(b,_e=!1){const it=createBox();copyBoxInto(it,b);for(let nt=0;nt<this.path.length;nt++){const at=this.path[nt];!_e&&at.options.layoutScroll&&at.scroll&&at!==at.root&&transformBox(it,{x:-at.scroll.offset.x,y:-at.scroll.offset.y}),hasTransform(at.latestValues)&&transformBox(it,at.latestValues)}return hasTransform(this.latestValues)&&transformBox(it,this.latestValues),it}removeTransform(b){const _e=createBox();copyBoxInto(_e,b);for(let it=0;it<this.path.length;it++){const nt=this.path[it];if(!nt.instance||!hasTransform(nt.latestValues))continue;hasScale(nt.latestValues)&&nt.updateSnapshot();const at=createBox(),ut=nt.measurePageBox();copyBoxInto(at,ut),removeBoxTransforms(_e,nt.latestValues,nt.snapshot?nt.snapshot.layoutBox:void 0,at)}return hasTransform(this.latestValues)&&removeBoxTransforms(_e,this.latestValues),_e}setTargetDelta(b){this.targetDelta=b,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(b){this.options={...this.options,...b,crossfade:b.crossfade!==void 0?b.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==frameData.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(b=!1){var _e;const it=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=it.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=it.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=it.isSharedProjectionDirty);const nt=!!this.resumingFrom||this!==it;if(!(b||nt&&this.isSharedProjectionDirty||this.isProjectionDirty||!((_e=this.parent)===null||_e===void 0)&&_e.isProjectionDirty||this.attemptToResolveRelativeTarget))return;const{layout:at,layoutId:ut}=this.options;if(!(!this.layout||!(at||ut))){if(this.resolvedRelativeTargetAt=frameData.timestamp,!this.targetDelta&&!this.relativeTarget){const pt=this.getClosestProjectingParent();pt&&pt.layout&&this.animationProgress!==1?(this.relativeParent=pt,this.forceRelativeParentToResolveTarget(),this.relativeTarget=createBox(),this.relativeTargetOrigin=createBox(),calcRelativePosition(this.relativeTargetOrigin,this.layout.layoutBox,pt.layout.layoutBox),copyBoxInto(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(!(!this.relativeTarget&&!this.targetDelta)){if(this.target||(this.target=createBox(),this.targetWithTransforms=createBox()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),calcRelativeBox(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):copyBoxInto(this.target,this.layout.layoutBox),applyBoxDelta(this.target,this.targetDelta)):copyBoxInto(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget){this.attemptToResolveRelativeTarget=!1;const pt=this.getClosestProjectingParent();pt&&!!pt.resumingFrom==!!this.resumingFrom&&!pt.options.layoutScroll&&pt.target&&this.animationProgress!==1?(this.relativeParent=pt,this.forceRelativeParentToResolveTarget(),this.relativeTarget=createBox(),this.relativeTargetOrigin=createBox(),calcRelativePosition(this.relativeTargetOrigin,this.target,pt.target),copyBoxInto(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}projectionFrameData.resolvedTargetDeltas++}}}getClosestProjectingParent(){if(!(!this.parent||hasScale(this.parent.latestValues)||has2DTranslate(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){var b;const _e=this.getLead(),it=!!this.resumingFrom||this!==_e;let nt=!0;if((this.isProjectionDirty||!((b=this.parent)===null||b===void 0)&&b.isProjectionDirty)&&(nt=!1),it&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(nt=!1),this.resolvedRelativeTargetAt===frameData.timestamp&&(nt=!1),nt)return;const{layout:at,layoutId:ut}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(at||ut))return;copyBoxInto(this.layoutCorrected,this.layout.layoutBox);const pt=this.treeScale.x,mt=this.treeScale.y;applyTreeDeltas(this.layoutCorrected,this.treeScale,this.path,it),_e.layout&&!_e.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(_e.target=_e.layout.layoutBox,_e.targetWithTransforms=createBox());const{target:ft}=_e;if(!ft){this.projectionTransform&&(this.projectionDelta=createDelta(),this.projectionTransform="none",this.scheduleRender());return}this.projectionDelta||(this.projectionDelta=createDelta(),this.projectionDeltaWithTransform=createDelta());const vt=this.projectionTransform;calcBoxDelta(this.projectionDelta,this.layoutCorrected,ft,this.latestValues),this.projectionTransform=buildProjectionTransform(this.projectionDelta,this.treeScale),(this.projectionTransform!==vt||this.treeScale.x!==pt||this.treeScale.y!==mt)&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",ft)),projectionFrameData.recalculatedProjection++}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(b=!0){if(this.options.scheduleRender&&this.options.scheduleRender(),b){const _e=this.getStack();_e&&_e.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}setAnimationOrigin(b,_e=!1){const it=this.snapshot,nt=it?it.latestValues:{},at={...this.latestValues},ut=createDelta();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!_e;const pt=createBox(),mt=it?it.source:void 0,ft=this.layout?this.layout.source:void 0,vt=mt!==ft,xt=this.getStack(),At=!xt||xt.members.length<=1,Ct=!!(vt&&!At&&this.options.crossfade===!0&&!this.path.some(hasOpacityCrossfade));this.animationProgress=0;let Et;this.mixTargetDelta=Tt=>{const kt=Tt/1e3;mixAxisDelta(ut.x,b.x,kt),mixAxisDelta(ut.y,b.y,kt),this.setTargetDelta(ut),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(calcRelativePosition(pt,this.layout.layoutBox,this.relativeParent.layout.layoutBox),mixBox(this.relativeTarget,this.relativeTargetOrigin,pt,kt),Et&&boxEquals(this.relativeTarget,Et)&&(this.isProjectionDirty=!1),Et||(Et=createBox()),copyBoxInto(Et,this.relativeTarget)),vt&&(this.animationValues=at,mixValues(at,nt,this.latestValues,kt,Ct,At)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=kt},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(b){this.notifyListeners("animationStart"),this.currentAnimation&&this.currentAnimation.stop(),this.resumingFrom&&this.resumingFrom.currentAnimation&&this.resumingFrom.currentAnimation.stop(),this.pendingAnimation&&(cancelFrame(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=frame.update(()=>{globalProjectionState.hasAnimatedSinceResize=!0,this.currentAnimation=animateSingleValue(0,animationTarget,{...b,onUpdate:_e=>{this.mixTargetDelta(_e),b.onUpdate&&b.onUpdate(_e)},onComplete:()=>{b.onComplete&&b.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const b=this.getStack();b&&b.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(animationTarget),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const b=this.getLead();let{targetWithTransforms:_e,target:it,layout:nt,latestValues:at}=b;if(!(!_e||!it||!nt)){if(this!==b&&this.layout&&nt&&shouldAnimatePositionOnly(this.options.animationType,this.layout.layoutBox,nt.layoutBox)){it=this.target||createBox();const ut=calcLength(this.layout.layoutBox.x);it.x.min=b.target.x.min,it.x.max=it.x.min+ut;const pt=calcLength(this.layout.layoutBox.y);it.y.min=b.target.y.min,it.y.max=it.y.min+pt}copyBoxInto(_e,it),transformBox(_e,at),calcBoxDelta(this.projectionDeltaWithTransform,this.layoutCorrected,_e,at)}}registerSharedNode(b,_e){this.sharedNodes.has(b)||this.sharedNodes.set(b,new NodeStack),this.sharedNodes.get(b).add(_e);const it=_e.options.initialPromotionConfig;_e.promote({transition:it?it.transition:void 0,preserveFollowOpacity:it&&it.shouldPreserveFollowOpacity?it.shouldPreserveFollowOpacity(_e):void 0})}isLead(){const b=this.getStack();return b?b.lead===this:!0}getLead(){var b;const{layoutId:_e}=this.options;return _e?((b=this.getStack())===null||b===void 0?void 0:b.lead)||this:this}getPrevLead(){var b;const{layoutId:_e}=this.options;return _e?(b=this.getStack())===null||b===void 0?void 0:b.prevLead:void 0}getStack(){const{layoutId:b}=this.options;if(b)return this.root.sharedNodes.get(b)}promote({needsReset:b,transition:_e,preserveFollowOpacity:it}={}){const nt=this.getStack();nt&&nt.promote(this,it),b&&(this.projectionDelta=void 0,this.needsReset=!0),_e&&this.setOptions({transition:_e})}relegate(){const b=this.getStack();return b?b.relegate(this):!1}resetSkewAndRotation(){const{visualElement:b}=this.options;if(!b)return;let _e=!1;const{latestValues:it}=b;if((it.z||it.rotate||it.rotateX||it.rotateY||it.rotateZ||it.skewX||it.skewY)&&(_e=!0),!_e)return;const nt={};it.z&&resetDistortingTransform("z",b,nt,this.animationValues);for(let at=0;at<transformAxes.length;at++)resetDistortingTransform(`rotate${transformAxes[at]}`,b,nt,this.animationValues),resetDistortingTransform(`skew${transformAxes[at]}`,b,nt,this.animationValues);b.render();for(const at in nt)b.setStaticValue(at,nt[at]),this.animationValues&&(this.animationValues[at]=nt[at]);b.scheduleRender()}getProjectionStyles(b){var _e,it;if(!this.instance||this.isSVG)return;if(!this.isVisible)return hiddenVisibility;const nt={visibility:""},at=this.getTransformTemplate();if(this.needsReset)return this.needsReset=!1,nt.opacity="",nt.pointerEvents=resolveMotionValue(b==null?void 0:b.pointerEvents)||"",nt.transform=at?at(this.latestValues,""):"none",nt;const ut=this.getLead();if(!this.projectionDelta||!this.layout||!ut.target){const vt={};return this.options.layoutId&&(vt.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,vt.pointerEvents=resolveMotionValue(b==null?void 0:b.pointerEvents)||""),this.hasProjected&&!hasTransform(this.latestValues)&&(vt.transform=at?at({},""):"none",this.hasProjected=!1),vt}const pt=ut.animationValues||ut.latestValues;this.applyTransformsToTarget(),nt.transform=buildProjectionTransform(this.projectionDeltaWithTransform,this.treeScale,pt),at&&(nt.transform=at(pt,nt.transform));const{x:mt,y:ft}=this.projectionDelta;nt.transformOrigin=`${mt.origin*100}% ${ft.origin*100}% 0`,ut.animationValues?nt.opacity=ut===this?(it=(_e=pt.opacity)!==null&&_e!==void 0?_e:this.latestValues.opacity)!==null&&it!==void 0?it:1:this.preserveOpacity?this.latestValues.opacity:pt.opacityExit:nt.opacity=ut===this?pt.opacity!==void 0?pt.opacity:"":pt.opacityExit!==void 0?pt.opacityExit:0;for(const vt in scaleCorrectors){if(pt[vt]===void 0)continue;const{correct:xt,applyTo:At}=scaleCorrectors[vt],Ct=nt.transform==="none"?pt[vt]:xt(pt[vt],ut);if(At){const Et=At.length;for(let Tt=0;Tt<Et;Tt++)nt[At[Tt]]=Ct}else nt[vt]=Ct}return this.options.layoutId&&(nt.pointerEvents=ut===this?resolveMotionValue(b==null?void 0:b.pointerEvents)||"":"none"),nt}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(b=>{var _e;return(_e=b.currentAnimation)===null||_e===void 0?void 0:_e.stop()}),this.root.nodes.forEach(clearMeasurements),this.root.sharedNodes.clear()}}}function updateLayout(h){h.updateLayout()}function notifyLayoutUpdate(h){var o;const c=((o=h.resumeFrom)===null||o===void 0?void 0:o.snapshot)||h.snapshot;if(h.isLead()&&h.layout&&c&&h.hasListeners("didUpdate")){const{layoutBox:d,measuredBox:_}=h.layout,{animationType:b}=h.options,_e=c.source!==h.layout.source;b==="size"?eachAxis(pt=>{const mt=_e?c.measuredBox[pt]:c.layoutBox[pt],ft=calcLength(mt);mt.min=d[pt].min,mt.max=mt.min+ft}):shouldAnimatePositionOnly(b,c.layoutBox,d)&&eachAxis(pt=>{const mt=_e?c.measuredBox[pt]:c.layoutBox[pt],ft=calcLength(d[pt]);mt.max=mt.min+ft,h.relativeTarget&&!h.currentAnimation&&(h.isProjectionDirty=!0,h.relativeTarget[pt].max=h.relativeTarget[pt].min+ft)});const it=createDelta();calcBoxDelta(it,d,c.layoutBox);const nt=createDelta();_e?calcBoxDelta(nt,h.applyTransform(_,!0),c.measuredBox):calcBoxDelta(nt,d,c.layoutBox);const at=!isDeltaZero(it);let ut=!1;if(!h.resumeFrom){const pt=h.getClosestProjectingParent();if(pt&&!pt.resumeFrom){const{snapshot:mt,layout:ft}=pt;if(mt&&ft){const vt=createBox();calcRelativePosition(vt,c.layoutBox,mt.layoutBox);const xt=createBox();calcRelativePosition(xt,d,ft.layoutBox),boxEqualsRounded(vt,xt)||(ut=!0),pt.options.layoutRoot&&(h.relativeTarget=xt,h.relativeTargetOrigin=vt,h.relativeParent=pt)}}}h.notifyListeners("didUpdate",{layout:d,snapshot:c,delta:nt,layoutDelta:it,hasLayoutChanged:at,hasRelativeTargetChanged:ut})}else if(h.isLead()){const{onExitComplete:d}=h.options;d&&d()}h.options.transition=void 0}function propagateDirtyNodes(h){projectionFrameData.totalNodes++,h.parent&&(h.isProjecting()||(h.isProjectionDirty=h.parent.isProjectionDirty),h.isSharedProjectionDirty||(h.isSharedProjectionDirty=!!(h.isProjectionDirty||h.parent.isProjectionDirty||h.parent.isSharedProjectionDirty)),h.isTransformDirty||(h.isTransformDirty=h.parent.isTransformDirty))}function cleanDirtyNodes(h){h.isProjectionDirty=h.isSharedProjectionDirty=h.isTransformDirty=!1}function clearSnapshot(h){h.clearSnapshot()}function clearMeasurements(h){h.clearMeasurements()}function clearIsLayoutDirty(h){h.isLayoutDirty=!1}function resetTransformStyle(h){const{visualElement:o}=h.options;o&&o.getProps().onBeforeLayoutMeasure&&o.notify("BeforeLayoutMeasure"),h.resetTransform()}function finishAnimation(h){h.finishAnimation(),h.targetDelta=h.relativeTarget=h.target=void 0,h.isProjectionDirty=!0}function resolveTargetDelta(h){h.resolveTargetDelta()}function calcProjection(h){h.calcProjection()}function resetSkewAndRotation(h){h.resetSkewAndRotation()}function removeLeadSnapshots(h){h.removeLeadSnapshot()}function mixAxisDelta(h,o,c){h.translate=mixNumber$1(o.translate,0,c),h.scale=mixNumber$1(o.scale,1,c),h.origin=o.origin,h.originPoint=o.originPoint}function mixAxis(h,o,c,d){h.min=mixNumber$1(o.min,c.min,d),h.max=mixNumber$1(o.max,c.max,d)}function mixBox(h,o,c,d){mixAxis(h.x,o.x,c.x,d),mixAxis(h.y,o.y,c.y,d)}function hasOpacityCrossfade(h){return h.animationValues&&h.animationValues.opacityExit!==void 0}const defaultLayoutTransition={duration:.45,ease:[.4,0,.1,1]},userAgentContains=h=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(h),roundPoint=userAgentContains("applewebkit/")&&!userAgentContains("chrome/")?Math.round:noop;function roundAxis(h){h.min=roundPoint(h.min),h.max=roundPoint(h.max)}function roundBox(h){roundAxis(h.x),roundAxis(h.y)}function shouldAnimatePositionOnly(h,o,c){return h==="position"||h==="preserve-aspect"&&!isNear(aspectRatio(o),aspectRatio(c),.2)}const DocumentProjectionNode=createProjectionNode({attachResizeListener:(h,o)=>addDomEvent(h,"resize",o),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),rootProjectionNode={current:void 0},HTMLProjectionNode=createProjectionNode({measureScroll:h=>({x:h.scrollLeft,y:h.scrollTop}),defaultParent:()=>{if(!rootProjectionNode.current){const h=new DocumentProjectionNode({});h.mount(window),h.setOptions({layoutScroll:!0}),rootProjectionNode.current=h}return rootProjectionNode.current},resetTransform:(h,o)=>{h.style.transform=o!==void 0?o:"none"},checkIsScrollRoot:h=>window.getComputedStyle(h).position==="fixed"}),drag={pan:{Feature:PanGesture},drag:{Feature:DragGesture,ProjectionNode:HTMLProjectionNode,MeasureLayout}},prefersReducedMotion={current:null},hasReducedMotionListener={current:!1};function initPrefersReducedMotion(){if(hasReducedMotionListener.current=!0,!!isBrowser)if(window.matchMedia){const h=window.matchMedia("(prefers-reduced-motion)"),o=()=>prefersReducedMotion.current=h.matches;h.addListener(o),o()}else prefersReducedMotion.current=!1}function updateMotionValuesFromProps(h,o,c){const{willChange:d}=o;for(const _ in o){const b=o[_],_e=c[_];if(isMotionValue(b))h.addValue(_,b),isWillChangeMotionValue(d)&&d.add(_);else if(isMotionValue(_e))h.addValue(_,motionValue(b,{owner:h})),isWillChangeMotionValue(d)&&d.remove(_);else if(_e!==b)if(h.hasValue(_)){const it=h.getValue(_);it.liveStyle===!0?it.jump(b):it.hasAnimated||it.set(b)}else{const it=h.getStaticValue(_);h.addValue(_,motionValue(it!==void 0?it:b,{owner:h}))}}for(const _ in c)o[_]===void 0&&h.removeValue(_);return o}const visualElementStore=new WeakMap,valueTypes=[...dimensionValueTypes,color,complex],findValueType=h=>valueTypes.find(testValueType(h)),featureNames=Object.keys(featureDefinitions),numFeatures=featureNames.length,propEventHandlers=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"],numVariantProps=variantProps.length;function getClosestProjectingNode(h){if(h)return h.options.allowProjection!==!1?h.projection:getClosestProjectingNode(h.parent)}class VisualElement{scrapeMotionValuesFromProps(o,c,d){return{}}constructor({parent:o,props:c,presenceContext:d,reducedMotionConfig:_,blockInitialAnimation:b,visualState:_e},it={}){this.resolveKeyframes=(mt,ft,vt,xt)=>new this.KeyframeResolver(mt,ft,vt,xt,this),this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=KeyframeResolver,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.scheduleRender=()=>frame.render(this.render,!1,!0);const{latestValues:nt,renderState:at}=_e;this.latestValues=nt,this.baseTarget={...nt},this.initialValues=c.initial?{...nt}:{},this.renderState=at,this.parent=o,this.props=c,this.presenceContext=d,this.depth=o?o.depth+1:0,this.reducedMotionConfig=_,this.options=it,this.blockInitialAnimation=!!b,this.isControllingVariants=isControllingVariants(c),this.isVariantNode=isVariantNode(c),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(o&&o.current);const{willChange:ut,...pt}=this.scrapeMotionValuesFromProps(c,{},this);for(const mt in pt){const ft=pt[mt];nt[mt]!==void 0&&isMotionValue(ft)&&(ft.set(nt[mt],!1),isWillChangeMotionValue(ut)&&ut.add(mt))}}mount(o){this.current=o,visualElementStore.set(o,this),this.projection&&!this.projection.instance&&this.projection.mount(o),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((c,d)=>this.bindToMotionValue(d,c)),hasReducedMotionListener.current||initPrefersReducedMotion(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:prefersReducedMotion.current,this.parent&&this.parent.children.add(this),this.update(this.props,this.presenceContext)}unmount(){var o;visualElementStore.delete(this.current),this.projection&&this.projection.unmount(),cancelFrame(this.notifyUpdate),cancelFrame(this.render),this.valueSubscriptions.forEach(c=>c()),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent&&this.parent.children.delete(this);for(const c in this.events)this.events[c].clear();for(const c in this.features)(o=this.features[c])===null||o===void 0||o.unmount();this.current=null}bindToMotionValue(o,c){const d=transformProps.has(o),_=c.on("change",_e=>{this.latestValues[o]=_e,this.props.onUpdate&&frame.preRender(this.notifyUpdate),d&&this.projection&&(this.projection.isTransformDirty=!0)}),b=c.on("renderRequest",this.scheduleRender);this.valueSubscriptions.set(o,()=>{_(),b(),c.owner&&c.stop()})}sortNodePosition(o){return!this.current||!this.sortInstanceNodePosition||this.type!==o.type?0:this.sortInstanceNodePosition(this.current,o.current)}loadFeatures({children:o,...c},d,_,b){let _e,it;for(let nt=0;nt<numFeatures;nt++){const at=featureNames[nt],{isEnabled:ut,Feature:pt,ProjectionNode:mt,MeasureLayout:ft}=featureDefinitions[at];mt&&(_e=mt),ut(c)&&(!this.features[at]&&pt&&(this.features[at]=new pt(this)),ft&&(it=ft))}if((this.type==="html"||this.type==="svg")&&!this.projection&&_e){this.projection=new _e(this.latestValues,getClosestProjectingNode(this.parent));const{layoutId:nt,layout:at,drag:ut,dragConstraints:pt,layoutScroll:mt,layoutRoot:ft}=c;this.projection.setOptions({layoutId:nt,layout:at,alwaysMeasureLayout:!!ut||pt&&isRefObject(pt),visualElement:this,scheduleRender:()=>this.scheduleRender(),animationType:typeof at=="string"?at:"both",initialPromotionConfig:b,layoutScroll:mt,layoutRoot:ft})}return it}updateFeatures(){for(const o in this.features){const c=this.features[o];c.isMounted?c.update():(c.mount(),c.isMounted=!0)}}triggerBuild(){this.build(this.renderState,this.latestValues,this.options,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):createBox()}getStaticValue(o){return this.latestValues[o]}setStaticValue(o,c){this.latestValues[o]=c}update(o,c){(o.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=o,this.prevPresenceContext=this.presenceContext,this.presenceContext=c;for(let d=0;d<propEventHandlers.length;d++){const _=propEventHandlers[d];this.propEventSubscriptions[_]&&(this.propEventSubscriptions[_](),delete this.propEventSubscriptions[_]);const b="on"+_,_e=o[b];_e&&(this.propEventSubscriptions[_]=this.on(_,_e))}this.prevMotionValues=updateMotionValuesFromProps(this,this.scrapeMotionValuesFromProps(o,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(o){return this.props.variants?this.props.variants[o]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}getVariantContext(o=!1){if(o)return this.parent?this.parent.getVariantContext():void 0;if(!this.isControllingVariants){const d=this.parent?this.parent.getVariantContext()||{}:{};return this.props.initial!==void 0&&(d.initial=this.props.initial),d}const c={};for(let d=0;d<numVariantProps;d++){const _=variantProps[d],b=this.props[_];(isVariantLabel(b)||b===!1)&&(c[_]=b)}return c}addVariantChild(o){const c=this.getClosestVariantNode();if(c)return c.variantChildren&&c.variantChildren.add(o),()=>c.variantChildren.delete(o)}addValue(o,c){const d=this.values.get(o);c!==d&&(d&&this.removeValue(o),this.bindToMotionValue(o,c),this.values.set(o,c),this.latestValues[o]=c.get())}removeValue(o){this.values.delete(o);const c=this.valueSubscriptions.get(o);c&&(c(),this.valueSubscriptions.delete(o)),delete this.latestValues[o],this.removeValueFromRenderState(o,this.renderState)}hasValue(o){return this.values.has(o)}getValue(o,c){if(this.props.values&&this.props.values[o])return this.props.values[o];let d=this.values.get(o);return d===void 0&&c!==void 0&&(d=motionValue(c===null?void 0:c,{owner:this}),this.addValue(o,d)),d}readValue(o,c){var d;let _=this.latestValues[o]!==void 0||!this.current?this.latestValues[o]:(d=this.getBaseTargetFromProps(this.props,o))!==null&&d!==void 0?d:this.readValueFromInstance(this.current,o,this.options);return _!=null&&(typeof _=="string"&&(isNumericalString(_)||isZeroValueString(_))?_=parseFloat(_):!findValueType(_)&&complex.test(c)&&(_=getAnimatableNone(o,c)),this.setBaseTarget(o,isMotionValue(_)?_.get():_)),isMotionValue(_)?_.get():_}setBaseTarget(o,c){this.baseTarget[o]=c}getBaseTarget(o){var c;const{initial:d}=this.props;let _;if(typeof d=="string"||typeof d=="object"){const _e=resolveVariantFromProps(this.props,d,(c=this.presenceContext)===null||c===void 0?void 0:c.custom);_e&&(_=_e[o])}if(d&&_!==void 0)return _;const b=this.getBaseTargetFromProps(this.props,o);return b!==void 0&&!isMotionValue(b)?b:this.initialValues[o]!==void 0&&_===void 0?void 0:this.baseTarget[o]}on(o,c){return this.events[o]||(this.events[o]=new SubscriptionManager),this.events[o].add(c)}notify(o,...c){this.events[o]&&this.events[o].notify(...c)}}class DOMVisualElement extends VisualElement{constructor(){super(...arguments),this.KeyframeResolver=DOMKeyframesResolver}sortInstanceNodePosition(o,c){return o.compareDocumentPosition(c)&2?1:-1}getBaseTargetFromProps(o,c){return o.style?o.style[c]:void 0}removeValueFromRenderState(o,{vars:c,style:d}){delete c[o],delete d[o]}}function getComputedStyle(h){return window.getComputedStyle(h)}class HTMLVisualElement extends DOMVisualElement{constructor(){super(...arguments),this.type="html"}readValueFromInstance(o,c){if(transformProps.has(c)){const d=getDefaultValueType(c);return d&&d.default||0}else{const d=getComputedStyle(o),_=(isCSSVariableName(c)?d.getPropertyValue(c):d[c])||0;return typeof _=="string"?_.trim():_}}measureInstanceViewportBox(o,{transformPagePoint:c}){return measureViewportBox(o,c)}build(o,c,d,_){buildHTMLStyles(o,c,d,_.transformTemplate)}scrapeMotionValuesFromProps(o,c,d){return scrapeMotionValuesFromProps$1(o,c,d)}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:o}=this.props;isMotionValue(o)&&(this.childSubscription=o.on("change",c=>{this.current&&(this.current.textContent=`${c}`)}))}renderInstance(o,c,d,_){renderHTML(o,c,d,_)}}class SVGVisualElement extends DOMVisualElement{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1}getBaseTargetFromProps(o,c){return o[c]}readValueFromInstance(o,c){if(transformProps.has(c)){const d=getDefaultValueType(c);return d&&d.default||0}return c=camelCaseAttributes.has(c)?c:camelToDash(c),o.getAttribute(c)}measureInstanceViewportBox(){return createBox()}scrapeMotionValuesFromProps(o,c,d){return scrapeMotionValuesFromProps(o,c,d)}build(o,c,d,_){buildSVGAttrs(o,c,d,this.isSVGTag,_.transformTemplate)}renderInstance(o,c,d,_){renderSVG(o,c,d,_)}mount(o){this.isSVGTag=isSVGTag(o.tagName),super.mount(o)}}const createDomVisualElement=(h,o)=>isSVGComponent(h)?new SVGVisualElement(o,{enableHardwareAcceleration:!1}):new HTMLVisualElement(o,{allowProjection:h!==reactExports.Fragment,enableHardwareAcceleration:!0}),layout={layout:{ProjectionNode:HTMLProjectionNode,MeasureLayout}},preloadedFeatures={...animations,...gestureAnimations,...drag,...layout},motion=createMotionProxy((h,o)=>createDomMotionConfig(h,o,preloadedFeatures,createDomVisualElement));function useIsMounted(){const h=reactExports.useRef(!1);return useIsomorphicLayoutEffect(()=>(h.current=!0,()=>{h.current=!1}),[]),h}function useForceUpdate(){const h=useIsMounted(),[o,c]=reactExports.useState(0),d=reactExports.useCallback(()=>{h.current&&c(o+1)},[o]);return[reactExports.useCallback(()=>frame.postRender(d),[d]),o]}class PopChildMeasure extends reactExports.Component{getSnapshotBeforeUpdate(o){const c=this.props.childRef.current;if(c&&o.isPresent&&!this.props.isPresent){const d=this.props.sizeRef.current;d.height=c.offsetHeight||0,d.width=c.offsetWidth||0,d.top=c.offsetTop,d.left=c.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function PopChild({children:h,isPresent:o}){const c=reactExports.useId(),d=reactExports.useRef(null),_=reactExports.useRef({width:0,height:0,top:0,left:0}),{nonce:b}=reactExports.useContext(MotionConfigContext);return reactExports.useInsertionEffect(()=>{const{width:_e,height:it,top:nt,left:at}=_.current;if(o||!d.current||!_e||!it)return;d.current.dataset.motionPopId=c;const ut=document.createElement("style");return b&&(ut.nonce=b),document.head.appendChild(ut),ut.sheet&&ut.sheet.insertRule(`
          [data-motion-pop-id="${c}"] {
            position: absolute !important;
            width: ${_e}px !important;
            height: ${it}px !important;
            top: ${nt}px !important;
            left: ${at}px !important;
          }
        `),()=>{document.head.removeChild(ut)}},[o]),jsxRuntimeExports.jsx(PopChildMeasure,{isPresent:o,childRef:d,sizeRef:_,children:reactExports.cloneElement(h,{ref:d})})}const PresenceChild=({children:h,initial:o,isPresent:c,onExitComplete:d,custom:_,presenceAffectsLayout:b,mode:_e})=>{const it=useConstant(newChildrenMap),nt=reactExports.useId(),at=reactExports.useMemo(()=>({id:nt,initial:o,isPresent:c,custom:_,onExitComplete:ut=>{it.set(ut,!0);for(const pt of it.values())if(!pt)return;d&&d()},register:ut=>(it.set(ut,!1),()=>it.delete(ut))}),b?[Math.random()]:[c]);return reactExports.useMemo(()=>{it.forEach((ut,pt)=>it.set(pt,!1))},[c]),reactExports.useEffect(()=>{!c&&!it.size&&d&&d()},[c]),_e==="popLayout"&&(h=jsxRuntimeExports.jsx(PopChild,{isPresent:c,children:h})),jsxRuntimeExports.jsx(PresenceContext.Provider,{value:at,children:h})};function newChildrenMap(){return new Map}function useUnmountEffect(h){return reactExports.useEffect(()=>()=>h(),[])}const getChildKey=h=>h.key||"";function updateChildLookup(h,o){h.forEach(c=>{const d=getChildKey(c);o.set(d,c)})}function onlyElements(h){const o=[];return reactExports.Children.forEach(h,c=>{reactExports.isValidElement(c)&&o.push(c)}),o}const AnimatePresence=({children:h,custom:o,initial:c=!0,onExitComplete:d,exitBeforeEnter:_,presenceAffectsLayout:b=!0,mode:_e="sync"})=>{const it=reactExports.useContext(LayoutGroupContext).forceRender||useForceUpdate()[0],nt=useIsMounted(),at=onlyElements(h);let ut=at;const pt=reactExports.useRef(new Map).current,mt=reactExports.useRef(ut),ft=reactExports.useRef(new Map).current,vt=reactExports.useRef(!0);if(useIsomorphicLayoutEffect(()=>{vt.current=!1,updateChildLookup(at,ft),mt.current=ut}),useUnmountEffect(()=>{vt.current=!0,ft.clear(),pt.clear()}),vt.current)return jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{children:ut.map(Et=>jsxRuntimeExports.jsx(PresenceChild,{isPresent:!0,initial:c?void 0:!1,presenceAffectsLayout:b,mode:_e,children:Et},getChildKey(Et)))});ut=[...ut];const xt=mt.current.map(getChildKey),At=at.map(getChildKey),Ct=xt.length;for(let Et=0;Et<Ct;Et++){const Tt=xt[Et];At.indexOf(Tt)===-1&&!pt.has(Tt)&&pt.set(Tt,void 0)}return _e==="wait"&&pt.size&&(ut=[]),pt.forEach((Et,Tt)=>{if(At.indexOf(Tt)!==-1)return;const kt=ft.get(Tt);if(!kt)return;const Dt=xt.indexOf(Tt);let zt=Et;if(!zt){const Bt=()=>{pt.delete(Tt);const Rt=Array.from(ft.keys()).filter(Ut=>!At.includes(Ut));if(Rt.forEach(Ut=>ft.delete(Ut)),mt.current=at.filter(Ut=>{const Ht=getChildKey(Ut);return Ht===Tt||Rt.includes(Ht)}),!pt.size){if(nt.current===!1)return;it(),d&&d()}};zt=jsxRuntimeExports.jsx(PresenceChild,{isPresent:!1,onExitComplete:Bt,custom:o,presenceAffectsLayout:b,mode:_e,children:kt},getChildKey(kt)),pt.set(Tt,zt)}ut.splice(Dt,0,zt)}),ut=ut.map(Et=>{const Tt=Et.key;return pt.has(Tt)?Et:jsxRuntimeExports.jsx(PresenceChild,{isPresent:!0,presenceAffectsLayout:b,mode:_e,children:Et},getChildKey(Et))}),jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{children:pt.size?ut:ut.map(Et=>reactExports.cloneElement(Et))})};function useMotionValue(h){const o=useConstant(()=>motionValue(h)),{isStatic:c}=reactExports.useContext(MotionConfigContext);if(c){const[,d]=reactExports.useState(h);reactExports.useEffect(()=>o.on("change",d),[])}return o}const isCustomValueType=h=>h&&typeof h=="object"&&h.mix,getMixer=h=>isCustomValueType(h)?h.mix:void 0;function transform(...h){const o=!Array.isArray(h[0]),c=o?0:-1,d=h[0+c],_=h[1+c],b=h[2+c],_e=h[3+c],it=interpolate(_,b,{mixer:getMixer(b[0]),..._e});return o?it(d):it}function useCombineMotionValues(h,o){const c=useMotionValue(o()),d=()=>c.set(o());return d(),useIsomorphicLayoutEffect(()=>{const _=()=>frame.preRender(d,!1,!0),b=h.map(_e=>_e.on("change",_));return()=>{b.forEach(_e=>_e()),cancelFrame(d)}}),c}function useComputed(h){collectMotionValues.current=[],h();const o=useCombineMotionValues(collectMotionValues.current,h);return collectMotionValues.current=void 0,o}function useTransform(h,o,c,d){if(typeof h=="function")return useComputed(h);const _=typeof o=="function"?o:transform(o,c,d);return Array.isArray(h)?useListTransform(h,_):useListTransform([h],([b])=>_(b))}function useListTransform(h,o){const c=useConstant(()=>[]);return useCombineMotionValues(h,()=>{c.length=0;const d=h.length;for(let _=0;_<d;_++)c[_]=h[_].get();return o(c)})}function useSpring(h,o={}){const{isStatic:c}=reactExports.useContext(MotionConfigContext),d=reactExports.useRef(null),_=useMotionValue(isMotionValue(h)?h.get():h),b=()=>{d.current&&d.current.stop()};return reactExports.useInsertionEffect(()=>_.attach((_e,it)=>{if(c)return it(_e);const nt=d.current;return nt&&nt.time===0&&nt.sample(frameData.delta),b(),d.current=animateValue({keyframes:[_.get(),_e],velocity:_.getVelocity(),type:"spring",restDelta:.001,restSpeed:.01,...o,onUpdate:it}),_.get()},b),[JSON.stringify(o)]),useIsomorphicLayoutEffect(()=>{if(isMotionValue(h))return h.on("change",_e=>_.set(parseFloat(_e)))},[_]),_}const Uicontext=reactExports.createContext({}),useUi=()=>reactExports.useContext(Uicontext);function useSetupProvider(h){const[o,c]=reactExports.useState(h.digitalZoom||1),[d,_]=reactExports.useState(h.cameraZoom||1),[b,_e]=reactExports.useState(h.image||""),it=h.handleStartAR||(()=>{}),nt=h.loadRing||(()=>{}),at=h.viewer,ut=h.clickImage||(()=>{}),pt=h.flipCamera||(()=>{}),mt=h.rings||[],[ft,vt]=reactExports.useState(3);return{image:b,setImage:_e,digitalZoom:o,setDigitalZoom:c,handleStartAR:it,cameraZoom:d,fingerIndex:ft,setCameraZoom:_,selectPreviousFinger:()=>{vt(xt=>(xt-1+5)%5)},selectNextFinger:()=>{vt(xt=>(xt+1)%5)},loadRing:nt,clickImage:ut,flipCamera:pt,viewer:at,rings:mt}}function UiProvider({children:h,initialValues:o}){const c=useSetupProvider(o);return reactExports.createElement(Uicontext.Provider,{value:c},h)}function Spinner(h){return jsxRuntimeExports.jsx("div",{className:"w-20 h-20 flex "+h.className,children:jsxRuntimeExports.jsx("span",{className:"spinner"})})}const RingOption=h=>{const o=useSpring(useMotionValue(1),{duration:.1,mass:.1}),{loadRing:c,viewer:d,clickImage:_,setImage:b}=useUi(),[_e,it]=reactExports.useState(!1),nt=reactExports.useCallback(()=>{if(h.active){d.renderEnabled=!1;const pt=_();b(pt);const mt=document.getElementById("ui-wrapper");mt&&(mt.style.opacity="0",setTimeout(()=>{mt.style.pointerEvents="none"},200));const ft=document.getElementById("share");ft&&(ft.style.opacity="1",setTimeout(()=>{ft.style.pointerEvents="auto"},200))}},[h.active]),at=reactExports.useCallback(()=>{h.active&&o.set(1.4,!0)},[h.active]),ut=reactExports.useCallback(()=>{h.active&&o.set(1.2,!0)},[h.active]);return reactExports.useEffect(()=>{h.active?(o.set(1.2,!0),it(!0),c(h.ringUrl,h.configUrl).then(()=>{it(!1)})):(it(!1),o.set(1,!0))},[h.active]),jsxRuntimeExports.jsxs(motion.div,{style:{scale:o},ref:h.refrence,className:"w-20 h-20 rounded-full px-2 flex justify-center items-center relative "+(h.active?"pointer-events-auto":"pointer-events-none"),onClick:nt,onPointerDown:at,onPointerUp:ut,children:[_e&&jsxRuntimeExports.jsx(Spinner,{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 h-20 w-20 p-4"}),jsxRuntimeExports.jsx("div",{className:"w-14 h-14 bg-[#ffffff48] rounded-full overflow-hidden "+(h.active?"bg-[#ffffff] ":"")+(_e?"opacity-35":"opacity-100"),children:jsxRuntimeExports.jsx("img",{src:h.icon,alt:"ring",className:"w-full h-full object-cover"})})]})};function RingsWrapper(){const h=reactExports.useRef(null),o=reactExports.useRef(null),c=useMotionValue(0),[d,_]=reactExports.useState(!1),{rings:b}=useUi(),[_e,it]=reactExports.useState(0),[nt,at]=reactExports.useState(0),[ut,pt]=reactExports.useState(Math.floor(b.length/2));reactExports.useEffect(()=>{!h.current||!o.current||(it(h.current.clientWidth),at(o.current.clientWidth))},[h.current,o.current]),reactExports.useEffect(()=>{console.log(_e)},[_e]);const mt=reactExports.useCallback(ft=>{if(!h.current||d)return;const vt=h.current.getBoundingClientRect(),xt=vt.left+vt.width/2-ft.clientX;let At=c.get()+xt;At=Math.round(xt/nt)*nt,c.set(At),console.log(At,"clicked");let Ct=-Math.round(At/nt)+Math.floor(b.length/2);Ct<0&&(Ct=0),Ct>=b.length&&(Ct=b.length-1),pt(Ct)},[c,d,nt,h.current]);return jsxRuntimeExports.jsxs("div",{className:"w-full flex justify-center items-center relative",children:[jsxRuntimeExports.jsx("div",{className:"absolute left-1/2 top-1/2 border-4 pointer-events-none border-primary rounded-full w-20 h-20 -translate-x-1/2 -translate-y-1/2 z-10"}),jsxRuntimeExports.jsx(motion.div,{onClick:mt,ref:h,drag:"x",_dragX:c,style:{x:c},dragConstraints:{left:-_e/2+nt/2,right:_e/2-nt/2},onDragTransitionEnd:()=>{_(!1)},onDragStart:()=>{_(!0)},dragTransition:{power:.1,timeConstant:200,modifyTarget:ft=>{const vt=Math.round(ft/nt)*nt;let xt=-Math.round(vt/nt)+Math.floor(b.length/2);return xt<0&&(xt=0),xt>=b.length&&(xt=b.length-1),pt(xt),vt}},className:"flex w-fit justify-center items-center p-3 px-0",children:b.map((ft,vt)=>jsxRuntimeExports.jsx(RingOption,{active:vt===ut,refrence:vt===0?o:void 0,ringUrl:ft.ringUrl,configUrl:ft.configUrl,icon:ft.icon},vt))})]})}const ConfigOption=h=>{const o=reactExports.useRef(null);return jsxRuntimeExports.jsx("div",{id:h.selected?"selectedOption":"",ref:o,onClick:h.onClick,className:"flex justify-start items-center flex-col cursor-pointer relative md:h-unit-3xl md:w-unit-3xl h-[30px] w-[30px] shrink-0 "+h.className,children:jsxRuntimeExports.jsxs("div",{className:"relative w-full h-full"+(h.rect?" w-32":" "),children:[h.loading&&jsxRuntimeExports.jsx(Spinner,{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 h-full w-full p-1"}),jsxRuntimeExports.jsx("img",{src:h.src,className:"  object-fill rounded-full  outline-1 outline hover:outline-primary outline-transparent outline-default-300 transition-all duration-300 opacity-100 h-full  "+(h.selected?" outline outline-primary ":"")+(h.loading?" opacity-50":"")})]})})},metals=[{name:"gold-white",materialUrl:"./materials/metal/gold-white-750.pmat",img:"./materials/metal/gold-white-750.pmat.png"},{name:"gold-yellow",materialUrl:"./materials/metal/gold-yellow-750.pmat",img:"./materials/metal/gold-yellow-750.pmat.png"},{name:"gold-rose",materialUrl:"./materials/metal/gold-rose-750.pmat",img:"./materials/metal/gold-rose-750.pmat.png"}],gems=[{name:"diamond",materialUrl:"./materials/gem/diamond-white-1.dmat",img:"./materials/gem/diamond-white-1.dmat.png"},{name:"ruby",materialUrl:"./materials/gem/ruby-1.dmat",img:"./materials/gem/ruby-1.dmat.png"},{name:"sapphire-yellow",materialUrl:"./materials/gem/sapphire-yellow.dmat",img:"./materials/gem/sapphire-yellow.dmat.png"},{name:"sapphire-blue",materialUrl:"./materials/gem/sapphire-blue.dmat",img:"./materials/gem/sapphire-blue.dmat.png"},{name:"emerald-1",materialUrl:"./materials/gem/emerald-1.dmat",img:"./materials/gem/emerald-1.dmat.png"}],Configurator=()=>{const[h,o]=reactExports.useState("none"),{viewer:c}=useUi(),[d,_]=reactExports.useState("gold-white"),[b,_e]=reactExports.useState("diamond"),[it,nt]=reactExports.useState(!1),at=async(ut,pt)=>{if(!c)return;nt(!0),pt==="metal"?_(ut.name):_e(ut.name);const mt=c.getPlugin("MaterialPresetPlugin");console.log(mt),mt&&(await mt.apply(pt==="metal"?"Metal":"Gem",ut.materialUrl),nt(!1))};return jsxRuntimeExports.jsx(AnimatePresence,{children:jsxRuntimeExports.jsxs(motion.div,{layout:!0,transition:{duration:.1,ease:"easeInOut"},className:"w-fit rounded-full p-2 px-4 flex justify-center items-center bg-[#00000055] gap-2",children:[h==="none"&&jsxRuntimeExports.jsxs("div",{className:"w-full flex justify-center items-center gap-2",children:[jsxRuntimeExports.jsx(motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1*0},children:jsxRuntimeExports.jsx("img",{src:"./icons/metal.svg",alt:"camera",className:"w-8 h-8 p-1 cursor-pointer",onClick:()=>o("metal")})}),jsxRuntimeExports.jsx(motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1*1},children:jsxRuntimeExports.jsx("img",{src:"./icons/diamond.svg",alt:"camera",className:"w-8 h-8 p-1 cursor-pointer",onClick:()=>o("gem")})})]}),h==="metal"&&jsxRuntimeExports.jsx("div",{className:"w-full flex justify-center items-center gap-2",children:metals.map((ut,pt)=>jsxRuntimeExports.jsx(motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1*pt},children:jsxRuntimeExports.jsx(ConfigOption,{selected:d===ut.name,loading:d===ut.name&&it,onClick:()=>at(ut,"metal"),src:ut.img,name:ut.name},ut.name+pt)},ut.name+pt+"container"))}),h==="gem"&&jsxRuntimeExports.jsx("div",{className:"w-full flex justify-center items-center gap-2",children:gems.map((ut,pt)=>jsxRuntimeExports.jsx(motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1*pt},children:jsxRuntimeExports.jsx(ConfigOption,{selected:b===ut.name,loading:b===ut.name&&it,onClick:()=>at(ut,"gem"),src:ut.img,name:ut.name},ut.name+pt)},ut.name+pt+"container"))}),h!=="none"&&jsxRuntimeExports.jsx("div",{className:"w-full flex justify-center items-center",children:jsxRuntimeExports.jsx("img",{src:"./icons/cancel.svg",alt:"close",className:"w-8 h-8 cursor-pointer",onClick:()=>o("none")})})]})})},SettingsButton=h=>jsxRuntimeExports.jsxs("div",{onClick:h.onClick,className:"flex flex-col justify-center items-center text-primary hover:text-secondary transition duration-200 "+(h.isActive?"text-secondary":""),children:[jsxRuntimeExports.jsx("div",{className:"cursor-pointer "+(h.text?"w-8 h-8":"w-10 h-10 "),children:h.img}),h.text&&jsxRuntimeExports.jsx("p",{className:" text-xs text-center",children:h.text})]}),ArrowDownIcon=h=>jsxRuntimeExports.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 38 43",style:{width:"100%",height:"100%"},fill:"none",className:h.className,children:[jsxRuntimeExports.jsxs("g",{filter:"url(#a)",children:[jsxRuntimeExports.jsx("mask",{id:"b",x:0,y:3,maskUnits:"userSpaceOnUse",style:{maskType:"alpha"},children:jsxRuntimeExports.jsx("path",{fill:"#D9D9D9",d:"M.23 3.241h37.512v37.512H.23z"})}),jsxRuntimeExports.jsx("g",{mask:"url(#b)",children:jsxRuntimeExports.jsx("path",{fill:"currentColor",d:"m18.466 36.635-10.698-10.7 2.14-2.179 7.03 7.032V19.82h3.057v10.968l7.03-6.994 2.14 2.14-10.699 10.701Zm-1.528-19.872v-4.587h3.057v4.586h-3.057Zm0-7.644V6.062h3.057v3.057h-3.057Z"})})]}),jsxRuntimeExports.jsx("defs",{children:jsxRuntimeExports.jsxs("filter",{id:"a",x:2.168,y:.462,colorInterpolationFilters:"sRGB",filterUnits:"userSpaceOnUse",children:[jsxRuntimeExports.jsx("feFlood",{floodOpacity:0,result:"BackgroundImageFix"}),jsxRuntimeExports.jsx("feColorMatrix",{in:"SourceAlpha",result:"hardAlpha",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"}),jsxRuntimeExports.jsx("feOffset",{}),jsxRuntimeExports.jsx("feGaussianBlur",{stdDeviation:2.8}),jsxRuntimeExports.jsx("feComposite",{in2:"hardAlpha",operator:"out"}),jsxRuntimeExports.jsx("feColorMatrix",{values:"0 0 0 0 0.0772917 0 0 0 0 0.08505 0 0 0 0 0.0875 0 0 0 1 0"}),jsxRuntimeExports.jsx("feBlend",{in2:"BackgroundImageFix",result:"effect1_dropShadow_196_816"}),jsxRuntimeExports.jsx("feBlend",{in:"SourceGraphic",in2:"effect1_dropShadow_196_816",result:"shape"})]})})]}),Slider=h=>jsxRuntimeExports.jsx(motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,ease:"easeInOut"},className:"w-full px-4 text-white",children:jsxRuntimeExports.jsx("input",{type:"range",step:h.step,min:h.min,max:h.max,value:h.value,onChange:o=>h.setSliderValue(Number(o.currentTarget.value)),className:"slider",id:"myRange"})}),CameraIcon=()=>jsxRuntimeExports.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 53 56",style:{width:"100%",height:"100%"},children:[jsxRuntimeExports.jsxs("g",{filter:"url(#aa)",children:[jsxRuntimeExports.jsx("mask",{id:"bb",x:0,y:2,maskUnits:"userSpaceOnUse",style:{maskType:"alpha"},children:jsxRuntimeExports.jsx("path",{fill:"#D9D9D9",d:"M.395 2.973h51.609v51.618H.395z"})}),jsxRuntimeExports.jsx("g",{fill:"currentColor",mask:"url(#bb)",children:jsxRuntimeExports.jsx("path",{d:"M19.812 8.625c.33.247.738.37 1.227.37H31.36c.488 0 .896-.123 1.226-.37.33-.248.494-.554.494-.92 0-.367-.165-.673-.494-.92-.33-.247-.738-.37-1.226-.37H21.039c-.489 0-.897.123-1.227.37-.329.247-.494.553-.494.92 0 .366.165.672.494.92ZM26.499 24.756h14.556c-.883-2.317-2.263-4.335-4.137-6.056-1.874-1.72-4.02-2.9-6.435-3.538l-4.774 8.214a.827.827 0 0 0 0 .92c.186.306.449.46.79.46Zm-6.75 2.605c.186.306.448.46.788.46s.604-.154.79-.46l7.332-12.595a11.15 11.15 0 0 0-1.23-.152c-.454-.033-.864-.05-1.23-.05-2.19 0-4.232.415-6.124 1.245a17.264 17.264 0 0 0-5.03 3.338l4.704 8.214Zm-8.987 7.126h9.477c.336 0 .603-.153.802-.46.198-.306.204-.613.018-.92L13.804 20.55a16.75 16.75 0 0 0-2.605 4.608c-.623 1.672-.935 3.454-.935 5.346a15.86 15.86 0 0 0 .498 3.984Zm11.193 11.356 4.743-8.214c.186-.307.18-.613-.018-.92-.199-.306-.466-.46-.802-.46H11.344c.884 2.317 2.27 4.336 4.157 6.056 1.887 1.72 4.039 2.9 6.454 3.538Zm4.245.598c2.19 0 4.233-.415 6.125-1.245a17.264 17.264 0 0 0 5.03-3.337l-4.704-8.215c-.186-.306-.449-.46-.789-.46s-.603.154-.79.46l-7.293 12.56c.365.078.76.138 1.185.178.426.039.837.059 1.236.059Zm12.396-5.985a17.567 17.567 0 0 0 2.566-4.603c.649-1.708.973-3.49.973-5.35a15.86 15.86 0 0 0-.498-3.985H32.16c-.336 0-.603.153-.801.46-.199.306-.205.613-.019.92l7.256 12.558ZM26.194 49.43c-2.59 0-5.036-.496-7.337-1.489-2.3-.993-4.31-2.348-6.026-4.066-1.718-1.718-3.073-3.727-4.066-6.028-.992-2.3-1.489-4.746-1.489-7.337 0-2.623.498-5.08 1.492-7.37.995-2.291 2.35-4.294 4.063-6.008 1.713-1.713 3.722-3.068 6.026-4.063 2.303-.995 4.749-1.492 7.337-1.492 2.619 0 5.074.497 7.366 1.492s4.295 2.35 6.009 4.063c1.713 1.714 3.067 3.717 4.062 6.007.995 2.291 1.492 4.748 1.492 7.37 0 2.592-.497 5.039-1.492 7.341-.995 2.303-2.349 4.31-4.062 6.025-1.714 1.714-3.716 3.068-6.006 4.063-2.29.995-4.747 1.492-7.37 1.492Z"})})]}),jsxRuntimeExports.jsx("defs",{children:jsxRuntimeExports.jsxs("filter",{id:"aa",x:1.676,y:.814,colorInterpolationFilters:"sRGB",filterUnits:"userSpaceOnUse",children:[jsxRuntimeExports.jsx("feFlood",{floodOpacity:0,result:"BackgroundImageFix"}),jsxRuntimeExports.jsx("feColorMatrix",{in:"SourceAlpha",result:"hardAlpha",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"}),jsxRuntimeExports.jsx("feOffset",{}),jsxRuntimeExports.jsx("feGaussianBlur",{stdDeviation:2.8}),jsxRuntimeExports.jsx("feComposite",{in2:"hardAlpha",operator:"out"}),jsxRuntimeExports.jsx("feColorMatrix",{values:"0 0 0 0 0.0772917 0 0 0 0 0.08505 0 0 0 0 0.0875 0 0 0 1 0"}),jsxRuntimeExports.jsx("feBlend",{in2:"BackgroundImageFix",result:"effect1_dropShadow_196_599"}),jsxRuntimeExports.jsx("feBlend",{in:"SourceGraphic",in2:"effect1_dropShadow_196_599",result:"shape"})]})})]}),CameraZoomIcon=()=>jsxRuntimeExports.jsx("svg",{className:"p-1",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 28 29",fill:"none",style:{width:"100%",height:"100%"},children:jsxRuntimeExports.jsx("path",{fill:"currentColor",d:"M14.22 10.036h10.718a11.59 11.59 0 0 0-3.046-4.458 11.12 11.12 0 0 0-4.739-2.605L13.64 9.02a.609.609 0 0 0 0 .677c.136.226.33.339.581.339Zm-4.97 1.918c.137.225.33.338.58.338.251 0 .445-.113.582-.338l5.399-9.272a8.218 8.218 0 0 0-.906-.112A12.54 12.54 0 0 0 14 2.533c-1.613 0-3.117.306-4.51.917a12.71 12.71 0 0 0-3.703 2.457l3.463 6.047ZM2.633 17.2h6.978c.248 0 .444-.113.59-.338a.592.592 0 0 0 .014-.677L4.873 6.939a12.334 12.334 0 0 0-1.918 3.392 11.178 11.178 0 0 0-.688 3.936 11.675 11.675 0 0 0 .366 2.933Zm8.242 8.36 3.492-6.047a.592.592 0 0 0-.014-.677c-.146-.226-.343-.339-.59-.339H3.062c.65 1.706 1.67 3.192 3.06 4.458a11.224 11.224 0 0 0 4.753 2.605ZM14 26c1.613 0 3.117-.306 4.51-.917a12.709 12.709 0 0 0 3.703-2.456l-3.463-6.048a.644.644 0 0 0-.58-.338.646.646 0 0 0-.582.338l-5.37 9.246c.268.058.56.102.872.131.313.03.617.044.91.044Zm9.127-4.406a12.933 12.933 0 0 0 1.89-3.389c.477-1.257.716-2.57.716-3.938a11.677 11.677 0 0 0-.366-2.934h-6.978c-.248 0-.444.113-.59.339a.592.592 0 0 0-.014.677l5.342 9.245ZM13.996 28.2c-1.908 0-3.709-.366-5.402-1.096a14.12 14.12 0 0 1-4.438-2.994 14.12 14.12 0 0 1-2.993-4.437A13.488 13.488 0 0 1 .067 14.27c0-1.93.366-3.74 1.098-5.426a14.172 14.172 0 0 1 2.991-4.422 14.126 14.126 0 0 1 4.437-2.991A13.482 13.482 0 0 1 13.995.333c1.929 0 3.737.366 5.425 1.099a14.167 14.167 0 0 1 4.424 2.991 14.173 14.173 0 0 1 2.99 4.422c.733 1.687 1.1 3.495 1.1 5.426 0 1.907-.367 3.709-1.1 5.404a14.131 14.131 0 0 1-2.99 4.435 14.172 14.172 0 0 1-4.423 2.991c-1.686.733-3.495 1.099-5.425 1.099Z"})}),FlipCameraIcon=()=>jsxRuntimeExports.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",style:{width:"100%",height:"100%"},viewBox:"0 0 51 52",fill:"none",children:[jsxRuntimeExports.jsx("ellipse",{cx:25.473,cy:26.304,fill:"#000",fillOpacity:.4,rx:25.473,ry:25.478}),jsxRuntimeExports.jsx("g",{clipPath:"url(#a)",filter:"url(#b)",children:jsxRuntimeExports.jsx("path",{fill:"currentColor",d:"M33.538 13.254a.832.832 0 1 0-1.177 1.176l1.906 1.904H15.506a3.322 3.322 0 0 0-3.323 3.323v10.8a.83.83 0 1 0 1.661 0v-10.8a1.661 1.661 0 0 1 1.662-1.661h18.76L32.362 19.9a.832.832 0 0 0 1.177 1.177l3.322-3.324a.83.83 0 0 0 0-1.176l-3.322-3.323Zm1.903 21.358a1.661 1.661 0 0 0 1.662-1.662v-10.8a.831.831 0 0 1 1.661 0v10.8a3.324 3.324 0 0 1-3.323 3.323h-18.76l1.905 1.904a.832.832 0 0 1-1.176 1.177l-3.323-3.323a.83.83 0 0 1 0-1.177l3.323-3.323a.83.83 0 0 1 1.42.588.832.832 0 0 1-.244.589l-1.906 1.904h18.761Zm-4.984-8.308a4.985 4.985 0 0 1-8.508 3.525 4.985 4.985 0 1 1 8.508-3.525Zm-1.66 0a3.323 3.323 0 1 0-6.648 0 3.323 3.323 0 0 0 6.647 0Z"})}),jsxRuntimeExports.jsxs("defs",{children:[jsxRuntimeExports.jsx("clipPath",{id:"a",children:jsxRuntimeExports.jsx("path",{fill:"currentColor",d:"M8.86 9.688h33.226V42.92H8.86z"})}),jsxRuntimeExports.jsxs("filter",{id:"b",width:37.781,height:37.788,x:6.583,y:7.41,colorInterpolationFilters:"sRGB",filterUnits:"userSpaceOnUse",children:[jsxRuntimeExports.jsx("feFlood",{floodOpacity:0,result:"BackgroundImageFix"}),jsxRuntimeExports.jsx("feColorMatrix",{in:"SourceAlpha",result:"hardAlpha",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"}),jsxRuntimeExports.jsx("feOffset",{}),jsxRuntimeExports.jsx("feGaussianBlur",{stdDeviation:2.8}),jsxRuntimeExports.jsx("feComposite",{in2:"hardAlpha",operator:"out"}),jsxRuntimeExports.jsx("feColorMatrix",{values:"0 0 0 0 0.0772917 0 0 0 0 0.08505 0 0 0 0 0.0875 0 0 0 1 0"}),jsxRuntimeExports.jsx("feBlend",{in2:"BackgroundImageFix",result:"effect1_dropShadow_196_793"}),jsxRuntimeExports.jsx("feBlend",{in:"SourceGraphic",in2:"effect1_dropShadow_196_793",result:"shape"})]})]})]}),FingerSelectionIcon=()=>jsxRuntimeExports.jsx("svg",{"data-slot":"icon",fill:"none",strokeWidth:"1.5",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10.05 4.575a1.575 1.575 0 1 0-3.15 0v3m3.15-3v-1.5a1.575 1.575 0 0 1 3.15 0v1.5m-3.15 0 .075 5.925m3.075.75V4.575m0 0a1.575 1.575 0 0 1 3.15 0V15M6.9 7.575a1.575 1.575 0 1 0-3.15 0v8.175a6.75 6.75 0 0 0 6.75 6.75h2.018a5.25 5.25 0 0 0 3.712-1.538l1.732-1.732a5.25 5.25 0 0 0 1.538-3.712l.003-2.024a.668.668 0 0 1 .198-.471 1.575 1.575 0 1 0-2.228-2.228 3.818 3.818 0 0 0-1.12 2.687M6.9 7.575V12m6.27 4.318A4.49 4.49 0 0 1 16.35 15m.002 0h-.002"})});function SettingTabs({setShow:h}){const[o,c]=reactExports.useState(0),{setDigitalZoom:d,digitalZoom:_,cameraZoom:b,setCameraZoom:_e,flipCamera:it,selectPreviousFinger:nt,selectNextFinger:at}=useUi();return jsxRuntimeExports.jsxs("div",{className:"w-full h-full flex flex-col gap-6 justify-center items-center",children:[jsxRuntimeExports.jsxs("div",{className:"w-full flex justify-center items-center gap-4",children:[jsxRuntimeExports.jsx(SettingsButton,{img:jsxRuntimeExports.jsx(ArrowDownIcon,{}),text:"Hide",onClick:()=>h(!1)}),jsxRuntimeExports.jsx(SettingsButton,{img:jsxRuntimeExports.jsx(CameraIcon,{}),text:"Digital Zoom",isActive:o===0,onClick:()=>c(0)}),jsxRuntimeExports.jsx(SettingsButton,{img:jsxRuntimeExports.jsx(CameraZoomIcon,{}),text:"Camera Zoom",isActive:o===1,onClick:()=>c(1)}),jsxRuntimeExports.jsx(SettingsButton,{img:jsxRuntimeExports.jsx(FingerSelectionIcon,{}),text:"Finger",isActive:o===2,onClick:()=>c(2)}),jsxRuntimeExports.jsx(SettingsButton,{onClick:it,img:jsxRuntimeExports.jsx(FlipCameraIcon,{})})]}),jsxRuntimeExports.jsx(AnimatePresence,{children:jsxRuntimeExports.jsxs("div",{className:"h-10 w-full max-w-96",children:[o===0&&jsxRuntimeExports.jsx(Slider,{step:.1,value:_,setSliderValue:d,min:1,max:5},"digital-zoom"),o===1&&jsxRuntimeExports.jsx(Slider,{step:.1,value:b,setSliderValue:_e,min:1,max:5},"camera-zoom"),o===2&&jsxRuntimeExports.jsxs("div",{className:"flex justify-center items-center gap-4",children:[jsxRuntimeExports.jsx("button",{className:"p-2 rounded-md w-32 bg-gray-200",onClick:nt,children:"Previous Finger"}),jsxRuntimeExports.jsx("button",{className:"p-2 rounded-md w-32 bg-gray-200",onClick:at,children:"Next Finger"})]})]})})]})}const Settings=({show:h,setShow:o})=>{const c=useSpring(useMotionValue(0),{duration:.2,mass:.1}),d=useTransform(c,[0,.3,1],[0,0,1]),_=useSpring(useMotionValue(100),{duration:.5,mass:.1}),b=reactExports.useRef(null);return reactExports.useEffect(()=>{h?(b.current&&(b.current.style.pointerEvents="auto"),setTimeout(()=>{},400),c.set(1,!0),_.set(0,!0)):(setTimeout(()=>{b.current&&(b.current.style.pointerEvents="none")},400),c.set(0,!0),_.set(100,!0))},[h]),jsxRuntimeExports.jsxs("div",{className:"w-full h-fit relative",children:[jsxRuntimeExports.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 bottom-0 transition-all duration-200 ease-out "+(h?"-translate-y-20 opacity-0 pointer-events-none":"translate-y-0 opacity-100 pointer-events-auto"),children:jsxRuntimeExports.jsx(SettingsButton,{onClick:()=>o(!0),img:jsxRuntimeExports.jsx(ArrowDownIcon,{className:"rotate-180"}),text:"Show"})}),jsxRuntimeExports.jsxs(motion.div,{ref:b,style:{opacity:d,y:_},transition:{duration:.2,ease:"easeInOut"},className:"w-full h-full flex flex-col gap-4 justify-center items-center opacity-0 pointer-events-none",children:[jsxRuntimeExports.jsx(Configurator,{}),jsxRuntimeExports.jsx(SettingTabs,{setShow:o})]})]})};function Share(){const{viewer:h,image:o}=useUi(),c=reactExports.useCallback(()=>{h.renderEnabled=!0;const _=document.getElementById("ui-wrapper");_&&(_.style.opacity="1",_.style.pointerEvents="auto");const b=document.getElementById("share");b&&(b.style.opacity="0",b.style.pointerEvents="none")},[]),d=reactExports.useCallback(async()=>{const _=await(await fetch(o)).blob(),b=new File([_],"fileName.jpeg",{type:_.type});navigator.share({title:"Hello",text:"Check out this image!",files:[b]})},[o]);return jsxRuntimeExports.jsxs("div",{className:"absolute z-10 opacity-0 gap-4 pointer-events-none w-full h-fit flex flex-col justify-center items-center bottom-7 transition-opacity duration-200",id:"share",children:[jsxRuntimeExports.jsx(SettingsButton,{onClick:c,img:jsxRuntimeExports.jsx(ArrowDownIcon,{className:"rotate-90"}),text:"back"}),jsxRuntimeExports.jsx("p",{className:"text-white",children:"Share this moment!"}),jsxRuntimeExports.jsx("button",{onClick:d,className:"w-40 h-10 bg-primary rounded-full active:bg-secondary text-black font-bold",children:"Share"})]})}const Logo="https://tiexbrasil.com.br/logo.svg",Intro=h=>{const{handleStartAR:o,viewer:c}=useUi(),d=reactExports.useRef(null),[_,b]=reactExports.useState(!0),[_e,it]=reactExports.useState(!1),[nt,at]=reactExports.useState(!1),ut=reactExports.useCallback(()=>{b(!0),d.current&&(d.current.style.pointerEvents="none",d.current.style.backgroundColor="#00000090");const pt=mt=>{console.log("Error",mt.detail),b(!1),it(!0),at(!1),d.current&&(d.current.style.backgroundColor="transparent",d.current.style.opacity="1"),h.setShowUi(!1),window.removeEventListener("tryonRunTimeError",pt)};window.addEventListener("tryonRunTimeError",pt),o().then(mt=>{if(!mt){b(!1),it(!0),d.current&&(d.current.style.backgroundColor="transparent"),console.error("AR did not start");return}console.log("AR started"),at(!0),it(!1),b(!1),h.setShowUi(!0),d.current&&(d.current.style.opacity="0",setTimeout(()=>{d.current.style.pointerEvents="none"},200))})},[d.current]);return reactExports.useEffect(()=>{if(!c)return;const pt=()=>{b(!1),c.scene.removeEventListener("addSceneObject",pt)};c.scene.addEventListener("addSceneObject",pt)},[c]),jsxRuntimeExports.jsxs("div",{ref:d,className:"absolute z-50 pointer-events-none flex justify-center items-center flex-col gap-8 py-12 w-full h-full top-0 transition-opacity duration-200",children:[jsxRuntimeExports.jsx("img",{src:Logo,alt:"logo",className:"w-48 h-32 object-contain"}),jsxRuntimeExports.jsx("div",{className:"flex-1"}),!nt&&jsxRuntimeExports.jsx("button",{onClick:ut,className:"w-fit h-10 rounded-full flex justify-center items-center text-black font-bold "+(_?" bg-transparent border-2 border-white transition-all duration-150 px-2 pointer-events-none ":"bg-primary px-14 pointer-events-auto"),children:_?jsxRuntimeExports.jsx(Spinner,{className:"h-6 w-6 text-secondary "}):_e?"Try Again":"Start"})]})};function App(){const[h,o]=reactExports.useState(!1),{setDigitalZoom:c}=useUi(),[d,_]=reactExports.useState(!1),b=reactExports.useCallback(()=>{c(1),console.log("User Swiped up!"),o(!0)},[o]),_e=reactExports.useCallback(()=>{console.log("User Swiped down!"),o(!1)},[o]),it=useSwipeable({trackMouse:!0,swipeDuration:500,onSwipedUp:b,onSwipedDown:_e});return jsxRuntimeExports.jsxs("div",{className:"w-full h-dvh pointer-events-none overflow-hidden bg-transparent font-main font-light relative",children:[jsxRuntimeExports.jsx(Intro,{setShowUi:_}),d&&jsxRuntimeExports.jsxs("div",{className:"w-full pointer-events-auto h-dvh overflow-hidden flex bg-transparent font-main font-light relative",children:[jsxRuntimeExports.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 top-5",children:jsxRuntimeExports.jsx("img",{src:"https://tiexbrasil.com.br/logo.svg",alt:"TieX Brasil",className:"w-20 h-12 object-contain"})}),jsxRuntimeExports.jsx(Share,{}),jsxRuntimeExports.jsxs("div",{...it,className:"w-full h-full flex flex-col transition-opacity opacity-100",id:"ui-wrapper",children:[jsxRuntimeExports.jsx("div",{className:"flex-1 pointer-events-none"}),jsxRuntimeExports.jsx(Settings,{show:h,setShow:o}),jsxRuntimeExports.jsx(RingsWrapper,{})]})]})]})}const By=class extends __webpackgi_exports__AViewerPlugin{constructor(o){super(),this.enabled=!0,this._started=!1,this._fingerIndex=0,this.start=async()=>{var c;if(!this._viewer)return;const d=new URLSearchParams(window.location.search).has("disableInstore"),_=window.ij_vto.InstoreRingTryonPlugin,b=_&&!d&&await _.isAvailable();let _e=_;if(!b){await((c=this.viewer)==null?void 0:c.addPlugin(window.ij_vto.RingTryonUIPlugin));const{RingTryonPlugin:nt}=window.ij_vto;_e=nt}if(this._ringTryonPlugin=await this._viewer.getOrAddPlugin(_e),!this._ringTryonPlugin)return;this._started=this._ringTryonPlugin.running;const it=this._started;if(it||(await this._ringTryonPlugin.start(),this._started=this._ringTryonPlugin.running),!it)return this._started;this._ringTryonPlugin.running&&this._ringTryonPlugin.selectNextCamera()},this.loadRing=async(c,d)=>{var xt,At,Ct,Et,Tt,kt,Dt,zt,Bt;var _,b,_e,it,nt,at,ut,pt,mt;if(this._currentRingUrl=c,!this._viewer)return;(_=this._viewer)==null||_.scene.modelRoot.clear(),(_e=(b=this._viewer)==null?void 0:b.getPlugin(__webpackgi_exports__DiamondPlugin))==null||_e.disposeAllCacheMaps(),console.log("loading ring",c,this._viewer);let ft=null;try{d&&(ft=await fetch(d).then(Rt=>Rt.json()))}catch(Rt){console.warn("Error loading ring config",Rt)}const vt=await((at=(nt=(it=this._viewer)==null?void 0:it.getManager())==null?void 0:nt.importer)==null?void 0:at.importSinglePath(c,{forceImport:!0}));if(vt)if(this._currentRingUrl===c){ft&&(this._ringTryonPlugin.modelScaleFactor=ft.modelScaleFactor,this._ringTryonPlugin.modelPosition=new __webpackgi_exports__Vector3(ft.modelPosition.x,ft.modelPosition.y,ft.modelPosition.z),this._ringTryonPlugin.modelRotation=new __webpackgi_exports__Vector3(ft.modelRotation.x,ft.modelRotation.y,ft.modelRotation.z));const Rt=vt.modelObject;Rt.userData.finger=this._fingerIndex,Rt.visible=!0,this._ringTryonPlugin&&this._ringTryonPlugin.modelRoot?(Rt.name=Rt.name||"RingObject",Rt.userData.isRing=!0,Rt.userData.ringType="band",this._ringTryonPlugin.modelRoot.add(Rt),console.log("Ring added to VTO plugin modelRoot"),this._ringTryonPlugin.setDirty&&this._ringTryonPlugin.setDirty(),this._ringTryonPlugin.refresh&&this._ringTryonPlugin.refresh()):((ut=this._viewer)==null||ut.scene.modelRoot.add(Rt),console.log("Ring added to scene modelRoot as fallback")),ft&&(ft.modelPosition&&(Rt.position.set(ft.modelPosition.x,ft.modelPosition.y,ft.modelPosition.z),console.log("Applied position:",ft.modelPosition)),ft.modelRotation&&(Rt.rotation.set(ft.modelRotation.x,ft.modelRotation.y,ft.modelRotation.z),console.log("Applied rotation:",ft.modelRotation,"in radians"),console.log("Rotation in degrees:",{x:ft.modelRotation.x*57.2958,y:ft.modelRotation.y*57.2958,z:ft.modelRotation.z*57.2958})),ft.modelScaleFactor&&(Rt.scale.setScalar(ft.modelScaleFactor),console.log("Applied scale:",ft.modelScaleFactor))),console.log("=== FORANDO ROTAO PARA ANEL ==="),Rt.rotation.set(1.5708,1.5,0),Rt.position.set(0,0,0),Rt.scale.setScalar(.48),console.log("ROTAO FORADA:",Rt.rotation),console.log("POSIO FORADA:",Rt.position),console.log("ESCALA FORADA:",Rt.scale);const Ut=()=>{Rt&&Rt.rotation&&(Rt.rotation.set(1.5708,1.5,0),console.log("REFORANDO ROTAO:",Rt.rotation))};setTimeout(Ut,100),setTimeout(Ut,500),setTimeout(Ut,1e3),console.log("=== BASE RING DEBUG ==="),console.log("Ring URL:",c),console.log("Ring config:",ft),console.log("Ring object:",Rt),console.log("Ring added to scene. Children count:",(Et=(Ct=(At=(xt=this._viewer)==null?void 0:xt.scene)==null?void 0:At.modelRoot)==null?void 0:Ct.children)==null?void 0:Et.length),console.log("VTO plugin modelRoot children:",(Dt=(kt=(Tt=this._ringTryonPlugin)==null?void 0:Tt.modelRoot)==null?void 0:kt.children)==null?void 0:Dt.length),console.log("Ring visible:",Rt.visible),console.log("Ring userData:",Rt.userData),console.log("Ring position:",Rt.position),console.log("Ring scale:",Rt.scale),console.log("======================"),this._viewer&&this._viewer.scene&&this._viewer.scene.setDirty(),this._ringTryonPlugin&&this._ringTryonPlugin.setDirty&&this._ringTryonPlugin.setDirty(),await new Promise(Jt=>setTimeout(Jt,100));const Ht=(pt=this._viewer)==null?void 0:pt.getPlugin("MaterialPresetPlugin");if(console.log("MaterialPresetPlugin found:",!!Ht),console.log("Applying material to:",c),c.includes("base.glb")||c.includes("base-2.glb")){console.log("Applying premium silver material for Anel N Elegante"),console.log("Using position/scale/rotation from base.json config"),console.log("=== APLICAO FORADA DE MATERIAL ==="),console.log(" CONFIG COMPLETA:",ft),console.log(" PROPERTIES:",ft.properties),console.log(" METAL:",(zt=ft.properties)==null?void 0:zt.metal),console.log(" STONES:",(Bt=ft.properties)==null?void 0:Bt.stones);try{let Jt=!1;if(Rt.traverse(Kt=>{var sr,ir,cr,lr,hr,dr,pr,ur,xr,vr,Dr,_r,rr,mr,Rr,Yr,Zr;if(Kt.isMesh&&Kt.material){const cn=Array.isArray(Kt.material);console.log("  array de materiais?",cn),console.log(" Tipo do material:",typeof Kt.material),console.log("=== MATERIAL DEBUG ==="),console.log("Processing mesh:",Kt.name||"unnamed"),console.log("Original material color:",Kt.material.color.getHex()),console.log("Material type:",Kt.material.type),console.log("Material UUID:",Kt.material.uuid);const Tn=(Kt.name||"").toLowerCase(),yn=(Kt.material.name||"").toLowerCase(),zn=Tn.includes("stone")||Tn.includes("gem")||Tn.includes("diamond")||Tn.includes("zirconia")||Tn.includes("crystal")||Tn.includes("sphere")||Tn.includes("ball")||Tn.includes("dot")||yn.includes("stone")||yn.includes("gem")||yn.includes("crystal")||yn.includes("white")||yn.includes("bright")||yn.includes("clear")||((ir=(sr=Kt.geometry)==null?void 0:sr.boundingSphere)==null?void 0:ir.radius)&&Kt.geometry.boundingSphere.radius<.02||Kt.position&&Kt.position.y>.01||((hr=(lr=(cr=Kt.geometry)==null?void 0:cr.attributes)==null?void 0:lr.position)==null?void 0:hr.count)&&Kt.geometry.attributes.position.count<100;console.log("=== DETECO DEBUG ==="),console.log("Child name:",Tn),console.log("Material name:",yn),console.log("Geometry radius:",(pr=(dr=Kt.geometry)==null?void 0:dr.boundingSphere)==null?void 0:pr.radius),console.log("Position Y:",(ur=Kt.position)==null?void 0:ur.y),console.log("Vertex count:",(Dr=(vr=(xr=Kt.geometry)==null?void 0:xr.attributes)==null?void 0:vr.position)==null?void 0:Dr.count),console.log("Is stone detected:",zn),console.log("======================"),cn?(console.log(" LIMPANDO MLTIPLOS MATERIAIS..."),Kt.material.forEach(jr=>{jr&&jr.dispose&&jr.dispose()})):(console.log(" LIMPANDO MATERIAL NICO..."),Kt.material&&Kt.material.dispose&&Kt.material.dispose());const gs=((_r=ft.properties)==null?void 0:_r.metal)||{},or=((mr=(rr=ft.properties)==null?void 0:rr.stones)==null?void 0:mr.main_diamonds)||{},yr=c.includes("base.glb");let Pr;if(zn){console.log(" CRIANDO MATERIAL ULTRA-REALISTA PARA ZIRCNIA...");const jr=((Yr=(Rr=ft.properties)==null?void 0:Rr.stones)==null?void 0:Yr.main_diamonds)||{},Tr=__webpackgi_exports__MeshPhysicalMaterial||__webpackgi_exports__MeshStandardMaterial;Pr=new Tr({color:parseInt((jr.color||"#F8FFFE").replace("#","0x")),metalness:0,roughness:.005,envMapIntensity:8,ior:2.42,transmission:.95,transparency:1,thickness:.5,clearcoat:1,clearcoatRoughness:0,dispersion:.025,sheen:1,sheenRoughness:0,sheenColor:16777215,emissive:1118498,emissiveIntensity:.05,reflectivity:.9,refractionRatio:.98,transparent:!0,opacity:.98,side:__webpackgi_exports__DoubleSide||2}),console.log(" ZIRCNIA ULTRA-REALISTA CRIADA")}else{console.log(" CRIANDO MATERIAL ULTRA-REALISTA PARA PRATA...");const jr=((Zr=ft.properties)==null?void 0:Zr.metal)||{},Tr=__webpackgi_exports__MeshPhysicalMaterial||__webpackgi_exports__MeshStandardMaterial;Pr=new Tr({color:parseInt((jr.color||"#F6F6F4").replace("#","0x")),metalness:jr.metalness||.98,roughness:jr.roughness||.04,envMapIntensity:jr.envMapIntensity||4.2,clearcoat:jr.clearcoat||.92,clearcoatRoughness:jr.clearcoatRoughness||.015,sheen:.4,sheenRoughness:.15,sheenColor:16316664,reflectivity:.92,ior:1.52,anisotropy:.08,anisotropyRotation:Math.PI*.3,emissive:parseInt((jr.emissive||"#FAFAFA").replace("#","0x")),emissiveIntensity:jr.emissiveIntensity||.035,flatShading:!1,transparent:!1,opacity:1,specularIntensity:.95,specularColor:16777215}),console.log(" PRATA 925 ULTRA-REALISTA CRIADA - COR:",jr.color||"#F6F6F4")}try{Kt.material=Pr,Kt.userData=Kt.userData||{},zn?Kt.userData.isZirconia=!0:Kt.userData.isMetal=!0,console.log(" MATERIAL APLICADO:",zn?"ZIRCNIA":"PRATA","Mesh:",Kt.name||"unnamed"),console.log(" COR FINAL:",Pr.color.getHex().toString(16).toUpperCase())}catch(jr){console.error(" Erro ao aplicar material:",jr),Kt.material=new __webpackgi_exports__MeshStandardMaterial({color:zn?16777215:12632256,metalness:zn?0:.9,roughness:zn?.01:.1,envMapIntensity:zn?4:2.5})}Pr&&(Pr.needsUpdate=!0,Pr.map&&(Pr.map.needsUpdate=!0),Pr.envMap&&(Pr.envMap.needsUpdate=!0),Pr.transmission!==void 0&&(Pr.needsUpdate=!0),Pr.clearcoat!==void 0&&(Pr.needsUpdate=!0),Pr.sheen!==void 0&&(Pr.needsUpdate=!0)),Kt.visible=!0,Kt.castShadow=!0,Kt.receiveShadow=!0,Kt.geometry&&(Kt.geometry.attributes.normal||Kt.geometry.computeVertexNormals(),(Pr.normalMap||Pr.clearcoat)&&Kt.geometry.computeTangents()),Kt.frustumCulled=!0,zn?Kt.renderOrder=1:Kt.renderOrder=0,Jt=!0}}),console.log(" Material customizado aplicado com sucesso:",Jt),console.log(" Posio final do anel:",Rt.position),console.log(" Escala final do anel:",Rt.scale),console.log(" Rotao final do anel:",Rt.rotation),this._viewer&&this._viewer.scene){console.log(" Aplicando configuraes avanadas de iluminao...");const Kt=this._viewer.scene,sr=this._viewer.renderer;sr&&sr.shadowMap&&(sr.shadowMap.enabled=!0,sr.shadowMap.type=__webpackgi_exports__PCFSoftShadowMap||2,sr.shadowMap.autoUpdate=!0),sr&&(sr.toneMapping=__webpackgi_exports__ACESFilmicToneMapping||4,sr.toneMappingExposure=1.2,sr.physicallyCorrectLights=!0),Kt.environment&&(Kt.environmentIntensity=1.5,Rt.traverse(ir=>{ir.isMesh&&ir.material&&!ir.material.envMap&&(ir.material.envMap=Kt.environment,ir.material.needsUpdate=!0)})),console.log(" Configuraes de iluminao aplicadas para mximo realismo")}console.log("Skipping MaterialPresetPlugin to preserve custom materials")}catch(Jt){console.log("Error applying custom material:",Jt)}}else console.log("Skipping diamond material - not base.glb")}else vt.modelObject.dispose(),(mt=vt.dispose)==null||mt.call(vt)},this.flipCamera=()=>{var c;(c=this._ringTryonPlugin)==null||c.flipCamera()},this.clickImage=()=>this._viewer?this._viewer.canvas.toDataURL("image/jpeg"):void 0,this.ControlComponent=()=>{const{digitalZoom:c,cameraZoom:d,fingerIndex:_}=useUi();return reactExports.useEffect(()=>{this.digitalZoom=c},[c]),reactExports.useEffect(()=>{this.cameraZoom=d},[d]),reactExports.useEffect(()=>{this.fingerIndex=_},[_]),jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{})},this.rings=o||[]}get digitalZoom(){var o;return((o=this._ringTryonPlugin)==null?void 0:o.videoScale)??1}set digitalZoom(o){this._ringTryonPlugin&&(this._ringTryonPlugin.videoScale=o)}get cameraZoom(){var o;return((o=this._ringTryonPlugin)==null?void 0:o.cameraZoom)??1}set cameraZoom(o){this._ringTryonPlugin&&(this._ringTryonPlugin.cameraZoom=o)}set fingerIndex(o){var c;this._fingerIndex=o,(c=this._ringTryonPlugin)==null||c.assignMainRingToFinger(o)}get fingerIndex(){return this._fingerIndex}async onAdded(o){await super.onAdded(o);const c=this.createUiContainer();o.container.appendChild(c),client.createRoot(c).render(jsxRuntimeExports.jsxs(UiProvider,{initialValues:{handleStartAR:this.start,digitalZoom:this.digitalZoom,cameraZoom:this.cameraZoom,fingerIndex:this.fingerIndex,loadRing:this.loadRing,viewer:this._viewer,clickImage:this.clickImage,flipCamera:this.flipCamera,rings:this.rings},children:[jsxRuntimeExports.jsx(this.ControlComponent,{}),jsxRuntimeExports.jsx(App,{})]}))}createUiContainer(){const o=document.createElement("div");return o.id="tryon-ui-wrapper",o.style.width="100%",o.style.height="100%",o.style.position="absolute",o.style.top="0",o.style.left="0",o.style.zIndex="100",o.style.pointerEvents="none",o}};By.PluginType="TryOnUiPlugin";let TryOnUiPlugin=By;const rings=[{icon:"./rings/1.png",ringUrl:"./rings/1.glb",configUrl:"./rings/1.json"},{icon:"./rings/2.png",ringUrl:"./rings/2.glb",configUrl:"./rings/2.json"},{icon:"./rings/3.png",ringUrl:"./rings/3.glb",configUrl:"./rings/3.json"},{icon:"./rings/4.png",ringUrl:"./rings/4.glb",configUrl:"./rings/4.json"},{icon:"./rings/5.png",ringUrl:"./rings/5.glb",configUrl:"./rings/5.json"},{icon:"./rings/6.png",ringUrl:"./rings/6.glb",configUrl:"./rings/6.json"},{icon:"./rings/7.png",ringUrl:"./rings/7.glb",configUrl:"./rings/7.json"},{icon:"./rings/base.png",ringUrl:"./rings/base.glb",configUrl:"./rings/base.json"},{icon:"./rings/base-2.png",ringUrl:"./rings/base-2.glb",configUrl:"./rings/base-2.json"}];async function setupViewer(){const{RingTryonPlugin:h,WebCameraBackgroundPlugin:o,WebCameraPlugin:c}=window.ij_vto,d=new __webpackgi_exports__ViewerApp({canvas:document.getElementById("webgi-canvas")}),_=/iPad|iPhone|iPod/.test(navigator.userAgent),b=_?Math.round(window.devicePixelRatio):window.devicePixelRatio,_e=_?1:1.5,it=_?1.4:1.5;d.renderer.displayCanvasScaling=__webpackgi_exports__MathUtils.clamp(b,_e,it),+await d.addPlugin(MaterialPresetPlugin),await __webpackgi_exports__addBasePlugins(d),await d.renderer.refreshPipeline();const nt="./lightmap-r-2b.exr",at=await d.addPlugin(__webpackgi_exports__DiamondPlugin);return at.envMap=await d.load(nt),at.refreshEnvMaps(),d.renderEnabled=!1,await d.addPlugin(new TryOnUiPlugin(rings)),await d.load("./rings/2.glb"),await d.load("./rings/2.json"),await d.load("./tryon-2-web.json"),d.renderEnabled=!0,(__webpackgi_exports__getUrlQueryParam("debug")!==null||__webpackgi_exports__getUrlQueryParam("edit")!==null)&&(await d.addPlugin(__webpackgi_exports__HierarchyUiPlugin),await d.addPlugin(__webpackgi_exports__PickingPlugin),await d.addPlugin(__webpackgi_exports__CameraUiPlugin),await d.addPlugin(__webpackgi_exports__RendererUiPlugin),(await d.addPlugin(__webpackgi_exports__TweakpaneUiPlugin)).setupPlugins(h,__webpackgi_exports__HierarchyUiPlugin,__webpackgi_exports__PickingPlugin,c,o,__webpackgi_exports__TonemapPlugin,__webpackgi_exports__CameraUiPlugin,__webpackgi_exports__RendererUiPlugin,__webpackgi_exports__SSRPlugin,__webpackgi_exports__SSAOPlugin,__webpackgi_exports__VignettePlugin,__webpackgi_exports__BloomPlugin,__webpackgi_exports__FilmicGrainPlugin,__webpackgi_exports__TemporalAAPlugin,__webpackgi_exports__DiamondPlugin,__webpackgi_exports__DepthOfFieldPlugin)),d}Object.entries(WEBGI).forEach(([h,o])=>{h!=="default"&&!window[h]&&(window[h]=o)});const ijVtoVersion="0.0.24";window.webgi=window;const ijVtoScript=document.createElement("script");ijVtoScript.onload=()=>setupViewer();const urlParams=new URLSearchParams(window.location.search),v=urlParams.get("v")||ijVtoVersion;ijVtoScript.src="./web-vto-instore.js";ijVtoScript.onerror=()=>alert("Failed to load web-vto script version "+v);document.head.appendChild(ijVtoScript);const main="";
